<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>SETKEY(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">SETKEY(8)</td>
    <td class="head-vol">System Manager's Manual</td>
    <td class="head-rtitle">SETKEY(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
<b class="Nm" title="Nm">setkey</b> &#x2014;
  <span class="Nd" title="Nd">manually manipulate the IPsec SA/SP
  database</span>
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<table class="Nm">
  <tr>
    <td><b class="Nm" title="Nm">setkey</b></td>
    <td>[<span class="Op"><b class="Fl" title="Fl">-knrv</b></span>]
      <var class="Ar" title="Ar">file ...</var></td>
  </tr>
</table>
<br/>
<table class="Nm">
  <tr>
    <td><b class="Nm" title="Nm">setkey</b></td>
    <td>[<span class="Op"><b class="Fl" title="Fl">-knrv</b></span>]
      <b class="Fl" title="Fl">-c</b></td>
  </tr>
</table>
<br/>
<table class="Nm">
  <tr>
    <td><b class="Nm" title="Nm">setkey</b></td>
    <td>[<span class="Op"><b class="Fl" title="Fl">-krv</b></span>]
      <b class="Fl" title="Fl">-f</b>
      <var class="Ar" title="Ar">filename</var></td>
  </tr>
</table>
<br/>
<table class="Nm">
  <tr>
    <td><b class="Nm" title="Nm">setkey</b></td>
    <td>[<span class="Op"><b class="Fl" title="Fl">-aklPrv</b></span>]
      <b class="Fl" title="Fl">-D</b></td>
  </tr>
</table>
<br/>
<table class="Nm">
  <tr>
    <td><b class="Nm" title="Nm">setkey</b></td>
    <td>[<span class="Op"><b class="Fl" title="Fl">-Pvp</b></span>]
      <b class="Fl" title="Fl">-F</b></td>
  </tr>
</table>
<br/>
<table class="Nm">
  <tr>
    <td><b class="Nm" title="Nm">setkey</b></td>
    <td>[<span class="Op"><b class="Fl" title="Fl">-H</b></span>]
      <b class="Fl" title="Fl">-x</b></td>
  </tr>
</table>
<br/>
<table class="Nm">
  <tr>
    <td><b class="Nm" title="Nm">setkey</b></td>
    <td>[<span class="Op"><b class="Fl" title="Fl">-?V</b></span>]</td>
  </tr>
</table>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<b class="Nm" title="Nm">setkey</b> adds, updates, dumps, or flushes Security
  Association Database (SAD) entries as well as Security Policy Database (SPD)
  entries in the kernel.
<div class="Pp"></div>
<b class="Nm" title="Nm">setkey</b> takes a series of operations from standard
  input (if invoked with <b class="Fl" title="Fl">-c</b>) or the file named
  <var class="Ar" title="Ar">filename</var> (if invoked with
  <b class="Fl" title="Fl">-f</b> <var class="Ar" title="Ar">filename</var>).
<dl class="Bl-tag">
  <dt class="It-tag">(no flag)</dt>
  <dd class="It-tag">Dump the SAD entries or SPD entries contained in the
      specified <var class="Ar" title="Ar">file</var>.</dd>
  <dt class="It-tag"><b class="Fl" title="Fl">-</b>?</dt>
  <dd class="It-tag">Print short help.</dd>
  <dt class="It-tag"><a class="selflink" href="#a"><b class="Fl" title="Fl" id="a">-a</b></a></dt>
  <dd class="It-tag"><b class="Nm" title="Nm">setkey</b> usually does not
      display dead SAD entries with <b class="Fl" title="Fl">-D</b>. If
      <b class="Fl" title="Fl">-a</b> is also specified, the dead SAD entries
      will be displayed as well. A dead SAD entry is one that has expired but
      remains in the system because it is referenced by some SPD entries.</dd>
  <dt class="It-tag"><a class="selflink" href="#D"><b class="Fl" title="Fl" id="D">-D</b></a></dt>
  <dd class="It-tag">Dump the SAD entries. If <b class="Fl" title="Fl">-P</b> is
      also specified, the SPD entries are dumped. If
      <b class="Fl" title="Fl">-p</b> is specified, the ports are
    displayed.</dd>
  <dt class="It-tag"><a class="selflink" href="#F"><b class="Fl" title="Fl" id="F">-F</b></a></dt>
  <dd class="It-tag">Flush the SAD entries. If <b class="Fl" title="Fl">-P</b>
      is also specified, the SPD entries are flushed.</dd>
  <dt class="It-tag"><a class="selflink" href="#H"><b class="Fl" title="Fl" id="H">-H</b></a></dt>
  <dd class="It-tag">Add hexadecimal dump in <b class="Fl" title="Fl">-x</b>
      mode.</dd>
  <dt class="It-tag"><a class="selflink" href="#h"><b class="Fl" title="Fl" id="h">-h</b></a></dt>
  <dd class="It-tag">On <span class="Ux">NetBSD</span>, synonym for
      <b class="Fl" title="Fl">-H</b>. On other systems, synonym for
      <b class="Fl" title="Fl">-</b>?.</dd>
  <dt class="It-tag"><a class="selflink" href="#k"><b class="Fl" title="Fl" id="k">-k</b></a></dt>
  <dd class="It-tag">Use semantics used in kernel. Available only in Linux. See
      also <b class="Fl" title="Fl">-r</b>.</dd>
  <dt class="It-tag"><a class="selflink" href="#l"><b class="Fl" title="Fl" id="l">-l</b></a></dt>
  <dd class="It-tag">Loop forever with short output on
      <b class="Fl" title="Fl">-D</b>.</dd>
  <dt class="It-tag"><a class="selflink" href="#n"><b class="Fl" title="Fl" id="n">-n</b></a></dt>
  <dd class="It-tag">No action. The program will check validity of the input,
      but no changes to the SPD will be made.</dd>
  <dt class="It-tag"><a class="selflink" href="#r"><b class="Fl" title="Fl" id="r">-r</b></a></dt>
  <dd class="It-tag">Use semantics described in IPsec RFCs. This mode is
      default. For details see section
      <a class="Sx" title="Sx" href="#RFC_vs_Linux_kernel_semantics">RFC vs
      Linux kernel semantics</a>. Available only in Linux. See also
      <b class="Fl" title="Fl">-k</b>.</dd>
  <dt class="It-tag"><a class="selflink" href="#x"><b class="Fl" title="Fl" id="x">-x</b></a></dt>
  <dd class="It-tag">Loop forever and dump all the messages transmitted to the
      <code class="Dv" title="Dv">PF_KEY</code> socket.
      <b class="Fl" title="Fl">-xx</b> prints the unformatted timestamps.</dd>
  <dt class="It-tag"><a class="selflink" href="#V"><b class="Fl" title="Fl" id="V">-V</b></a></dt>
  <dd class="It-tag">Print version string.</dd>
  <dt class="It-tag"><a class="selflink" href="#v"><b class="Fl" title="Fl" id="v">-v</b></a></dt>
  <dd class="It-tag">Be verbose. The program will dump messages exchanged on the
      <code class="Dv" title="Dv">PF_KEY</code> socket, including messages sent
      from other processes to the kernel.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Configuration_syntax"><a class="selflink" href="#Configuration_syntax">Configuration
  syntax</a></h2>
With <b class="Fl" title="Fl">-c</b> or <b class="Fl" title="Fl">-f</b> on the
  command line, <b class="Nm" title="Nm">setkey</b> accepts the following
  configuration syntax. Lines starting with hash signs (&#x2018;#&#x2019;) are
  treated as comment lines.
<dl class="Bl-tag">
  <dt class="It-tag"><a class="selflink" href="#add"><code class="Li" id="add">add</code></a>
    [<span class="Op"><b class="Fl" title="Fl">-46n</b></span>]
    <var class="Ar" title="Ar">src</var> <var class="Ar" title="Ar">dst</var>
    <var class="Ar" title="Ar">protocol</var>
    <var class="Ar" title="Ar">spi</var>
    [<span class="Op"><var class="Ar" title="Ar">extensions</var></span>]
    <var class="Ar" title="Ar">algorithm ...</var> ;</dt>
  <dd class="It-tag">Add an SAD entry. <code class="Li">add</code> can fail for
      multiple reasons, including when the key length does not match the
      specified algorithm.</dd>
  <dt class="It-tag"><a class="selflink" href="#get"><code class="Li" id="get">get</code></a>
    [<span class="Op"><b class="Fl" title="Fl">-46n</b></span>]
    <var class="Ar" title="Ar">src</var> <var class="Ar" title="Ar">dst</var>
    <var class="Ar" title="Ar">protocol</var>
    <var class="Ar" title="Ar">spi</var> ;</dt>
  <dd class="It-tag">Show an SAD entry.</dd>
  <dt class="It-tag"><a class="selflink" href="#delete"><code class="Li" id="delete">delete</code></a>
    [<span class="Op"><b class="Fl" title="Fl">-46n</b></span>]
    <var class="Ar" title="Ar">src</var> <var class="Ar" title="Ar">dst</var>
    <var class="Ar" title="Ar">protocol</var>
    <var class="Ar" title="Ar">spi</var> ;</dt>
  <dd class="It-tag">Remove an SAD entry.</dd>
  <dt class="It-tag"><a class="selflink" href="#deleteall"><code class="Li" id="deleteall">deleteall</code></a>
    [<span class="Op"><b class="Fl" title="Fl">-46n</b></span>]
    <var class="Ar" title="Ar">src</var> <var class="Ar" title="Ar">dst</var>
    <var class="Ar" title="Ar">protocol</var> ;</dt>
  <dd class="It-tag">Remove all SAD entries that match the specification.</dd>
  <dt class="It-tag"><a class="selflink" href="#flush"><code class="Li" id="flush">flush</code></a>
    [<span class="Op"><var class="Ar" title="Ar">protocol</var></span>] ;</dt>
  <dd class="It-tag">Clear all SAD entries matched by the options.
      <b class="Fl" title="Fl">-F</b> on the command line achieves the same
      functionality.</dd>
  <dt class="It-tag"><a class="selflink" href="#dump"><code class="Li" id="dump">dump</code></a>
    [<span class="Op"><var class="Ar" title="Ar">protocol</var></span>] ;</dt>
  <dd class="It-tag">Dumps all SAD entries matched by the options.
      <b class="Fl" title="Fl">-D</b> on the command line achieves the same
      functionality.</dd>
  <dt class="It-tag"><a class="selflink" href="#spdadd"><code class="Li" id="spdadd">spdadd</code></a>
    [<span class="Op"><b class="Fl" title="Fl">-46n</b></span>]
    <var class="Ar" title="Ar">src_range</var>
    <var class="Ar" title="Ar">dst_range</var>
    <var class="Ar" title="Ar">upperspec</var>
    <var class="Ar" title="Ar">label</var>
    <var class="Ar" title="Ar">policy</var> ;</dt>
  <dd class="It-tag">Add an SPD entry.</dd>
  <dt class="It-tag"><a class="selflink" href="#spdadd_tagged"><code class="Li" id="spdadd_tagged">spdadd
    tagged</code></a> <var class="Ar" title="Ar">tag</var>
    <var class="Ar" title="Ar">policy</var> ;</dt>
  <dd class="It-tag">Add an SPD entry based on a PF tag.
      <var class="Ar" title="Ar">tag</var> must be a string surrounded by double
      quotes.</dd>
  <dt class="It-tag"><a class="selflink" href="#spdupdate"><code class="Li" id="spdupdate">spdupdate</code></a>
    [<span class="Op"><b class="Fl" title="Fl">-46n</b></span>]
    <var class="Ar" title="Ar">src_range</var>
    <var class="Ar" title="Ar">dst_range</var>
    <var class="Ar" title="Ar">upperspec</var>
    <var class="Ar" title="Ar">label</var>
    <var class="Ar" title="Ar">policy</var> ;</dt>
  <dd class="It-tag">Updates an SPD entry.</dd>
  <dt class="It-tag"><a class="selflink" href="#spdupdate_tagged"><code class="Li" id="spdupdate_tagged">spdupdate
    tagged</code></a> <var class="Ar" title="Ar">tag</var>
    <var class="Ar" title="Ar">policy</var> ;</dt>
  <dd class="It-tag">Update an SPD entry based on a PF tag.
      <var class="Ar" title="Ar">tag</var> must be a string surrounded by double
      quotes.</dd>
  <dt class="It-tag"><a class="selflink" href="#spddelete"><code class="Li" id="spddelete">spddelete</code></a>
    [<span class="Op"><b class="Fl" title="Fl">-46n</b></span>]
    <var class="Ar" title="Ar">src_range</var>
    <var class="Ar" title="Ar">dst_range</var>
    <var class="Ar" title="Ar">upperspec</var> <b class="Fl" title="Fl">-P</b>
    <var class="Ar" title="Ar">direction</var> ;</dt>
  <dd class="It-tag">Delete an SPD entry.</dd>
  <dt class="It-tag"><a class="selflink" href="#spdflush"><code class="Li" id="spdflush">spdflush</code></a>
    ;</dt>
  <dd class="It-tag">Clear all SPD entries. <b class="Fl" title="Fl">-FP</b> on
      the command line achieves the same functionality.</dd>
  <dt class="It-tag"><a class="selflink" href="#spddump"><code class="Li" id="spddump">spddump</code></a>
    ;</dt>
  <dd class="It-tag">Dumps all SPD entries. <b class="Fl" title="Fl">-DP</b> on
      the command line achieves the same functionality.</dd>
</dl>
<div class="Pp"></div>
Meta-arguments are as follows:
<div class="Pp"></div>
<dl class="Bl-tag Bl-compact">
  <dt class="It-tag"><var class="Ar" title="Ar">src</var></dt>
  <dd class="It-tag" style="width: auto;">&#x00A0;</dd>
  <dt class="It-tag"><var class="Ar" title="Ar">dst</var></dt>
  <dd class="It-tag">Source/destination of the secure communication is specified
      as an IPv4/v6 address, and an optional port number between square
      brackets. <b class="Nm" title="Nm">setkey</b> can resolve a FQDN into
      numeric addresses. If the FQDN resolves into multiple addresses,
      <b class="Nm" title="Nm">setkey</b> will install multiple SAD/SPD entries
      into the kernel by trying all possible combinations.
      <b class="Fl" title="Fl">-4</b>, <b class="Fl" title="Fl">-6</b>, and
      <b class="Fl" title="Fl">-n</b> restrict the address resolution of FQDN in
      certain ways. <b class="Fl" title="Fl">-4</b> and
      <b class="Fl" title="Fl">-6</b> restrict results into IPv4/v6 addresses
      only, respectively. <b class="Fl" title="Fl">-n</b> avoids FQDN resolution
      and requires addresses to be numeric addresses.
    <div class="Pp"></div>
  </dd>
  <dt class="It-tag"><var class="Ar" title="Ar">protocol</var></dt>
  <dd class="It-tag"><var class="Ar" title="Ar">protocol</var> is one of
      following:
    <dl class="Bl-tag Bl-compact" style="margin-left: 15.00ex;">
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#esp"><code class="Li" id="esp">esp</code></a></dt>
      <dd class="It-tag">ESP based on rfc2406</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#esp-old"><code class="Li" id="esp-old">esp-old</code></a></dt>
      <dd class="It-tag">ESP based on rfc1827</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#esp-udp"><code class="Li" id="esp-udp">esp-udp</code></a></dt>
      <dd class="It-tag">ESP-UDP based on rfc3948</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#ah"><code class="Li" id="ah">ah</code></a></dt>
      <dd class="It-tag">AH based on rfc2402</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#ah-old"><code class="Li" id="ah-old">ah-old</code></a></dt>
      <dd class="It-tag">AH based on rfc1826</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#ipcomp"><code class="Li" id="ipcomp">ipcomp</code></a></dt>
      <dd class="It-tag">IPComp</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#tcp"><code class="Li" id="tcp">tcp</code></a></dt>
      <dd class="It-tag">TCP-MD5 based on rfc2385</dd>
    </dl>
    <div class="Pp"></div>
  </dd>
  <dt class="It-tag"><var class="Ar" title="Ar">spi</var></dt>
  <dd class="It-tag">Security Parameter Index (SPI) for the SAD and the SPD.
      <var class="Ar" title="Ar">spi</var> must be a decimal number, or a
      hexadecimal number with a &#x201C;<code class="Li">0x</code>&#x201D;
      prefix. SPI values between 0 and 255 are reserved for future use by IANA
      and cannot be used. TCP-MD5 associations must use 0x1000 and therefore
      only have per-host granularity at this time.
    <div class="Pp"></div>
  </dd>
  <dt class="It-tag"><var class="Ar" title="Ar">extensions</var></dt>
  <dd class="It-tag">take some of the following:
    <dl class="Bl-tag Bl-compact" style="margin-left: 15.00ex;">
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#m"><b class="Fl" title="Fl" id="m">-m</b></a>
        <var class="Ar" title="Ar">mode</var></dt>
      <dd class="It-tag">Specify a security protocol mode for use.
          <var class="Ar" title="Ar">mode</var> is one of following:
          <code class="Li">transport</code>, <code class="Li">tunnel</code>, or
          <code class="Li">any</code>. The default value is
          <code class="Li">any</code>.</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#r"><b class="Fl" title="Fl" id="r">-r</b></a>
        <var class="Ar" title="Ar">size</var></dt>
      <dd class="It-tag">Specify window size of bytes for replay prevention.
          <var class="Ar" title="Ar">size</var> must be decimal number in 32-bit
          word. If <var class="Ar" title="Ar">size</var> is zero or not
          specified, replay checks don't take place.</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#u"><b class="Fl" title="Fl" id="u">-u</b></a>
        <var class="Ar" title="Ar">id</var></dt>
      <dd class="It-tag">Specify the identifier of the policy entry in the SPD.
          See <var class="Ar" title="Ar">policy</var>.</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#f"><b class="Fl" title="Fl" id="f">-f</b></a>
        <var class="Ar" title="Ar">pad_option</var></dt>
      <dd class="It-tag">defines the content of the ESP padding.
          <var class="Ar" title="Ar">pad_option</var> is one of following:
        <dl class="Bl-tag Bl-compact" style="margin-left: 15.00ex;">
          <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#zero-pad"><code class="Li" id="zero-pad">zero-pad</code></a></dt>
          <dd class="It-tag">All the paddings are zero.</dd>
          <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#random-pad"><code class="Li" id="random-pad">random-pad</code></a></dt>
          <dd class="It-tag">A series of randomized values are used.</dd>
          <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#seq-pad"><code class="Li" id="seq-pad">seq-pad</code></a></dt>
          <dd class="It-tag">A series of sequential increasing numbers started
              from 1 are used.</dd>
        </dl>
      </dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#f"><b class="Fl" title="Fl" id="f">-f</b></a>
        <code class="Li">nocyclic-seq</code></dt>
      <dd class="It-tag">Don't allow cyclic sequence numbers.</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#lh"><b class="Fl" title="Fl" id="lh">-lh</b></a>
        <var class="Ar" title="Ar">time</var></dt>
      <dd class="It-tag" style="width: auto;">&#x00A0;</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#ls"><b class="Fl" title="Fl" id="ls">-ls</b></a>
        <var class="Ar" title="Ar">time</var></dt>
      <dd class="It-tag">Specify hard/soft life time duration of the SA measured
          in seconds.</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#bh"><b class="Fl" title="Fl" id="bh">-bh</b></a>
        <var class="Ar" title="Ar">bytes</var></dt>
      <dd class="It-tag" style="width: auto;">&#x00A0;</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#bs"><b class="Fl" title="Fl" id="bs">-bs</b></a>
        <var class="Ar" title="Ar">bytes</var></dt>
      <dd class="It-tag">Specify hard/soft life time duration of the SA measured
          in bytes transported.</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#ctx"><b class="Fl" title="Fl" id="ctx">-ctx</b></a>
        <var class="Ar" title="Ar">doi</var>
        <var class="Ar" title="Ar">algorithm</var>
        <var class="Ar" title="Ar">context-name</var></dt>
      <dd class="It-tag">Specify an access control label. The access control
          label is interpreted by the LSM (e.g., SELinux). Ultimately, it
          enables MAC on network communications.
        <dl class="Bl-tag Bl-compact" style="margin-left: 15.00ex;">
          <dt class="It-tag" style="margin-left: -15.00ex;"><var class="Ar" title="Ar">doi</var></dt>
          <dd class="It-tag">The domain of interpretation, which is used by the
              IKE daemon to identify the domain in which negotiation takes
              place.</dd>
          <dt class="It-tag" style="margin-left: -15.00ex;"><var class="Ar" title="Ar">algorithm</var></dt>
          <dd class="It-tag">Indicates the LSM for which the label is generated
              (e.g., SELinux).</dd>
          <dt class="It-tag" style="margin-left: -15.00ex;"><var class="Ar" title="Ar">context-name</var></dt>
          <dd class="It-tag">The string representation of the label that is
              interpreted by the LSM.</dd>
        </dl>
      </dd>
    </dl>
    <div class="Pp"></div>
  </dd>
  <dt class="It-tag"><var class="Ar" title="Ar">algorithm</var></dt>
  <dd class="It-tag">
    <dl class="Bl-tag Bl-compact" style="margin-left: 15.00ex;">
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#E"><b class="Fl" title="Fl" id="E">-E</b></a>
        <var class="Ar" title="Ar">ealgo</var>
        <var class="Ar" title="Ar">key</var></dt>
      <dd class="It-tag">Specify an encryption algorithm
          <var class="Ar" title="Ar">ealgo</var> for ESP.</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#E"><b class="Fl" title="Fl" id="E">-E</b></a>
        <var class="Ar" title="Ar">ealgo</var>
        <var class="Ar" title="Ar">key</var> <b class="Fl" title="Fl">-A</b>
        <var class="Ar" title="Ar">aalgo</var>
        <var class="Ar" title="Ar">key</var></dt>
      <dd class="It-tag">Specify an encryption algorithm
          <var class="Ar" title="Ar">ealgo</var>, as well as a payload
          authentication algorithm <var class="Ar" title="Ar">aalgo</var>, for
          ESP.</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#A"><b class="Fl" title="Fl" id="A">-A</b></a>
        <var class="Ar" title="Ar">aalgo</var>
        <var class="Ar" title="Ar">key</var></dt>
      <dd class="It-tag">Specify an authentication algorithm for AH.</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#C"><b class="Fl" title="Fl" id="C">-C</b></a>
        <var class="Ar" title="Ar">calgo</var>
        [<span class="Op"><b class="Fl" title="Fl">-R</b></span>]</dt>
      <dd class="It-tag">Specify a compression algorithm for IPComp. If
          <b class="Fl" title="Fl">-R</b> is specified, the
          <var class="Ar" title="Ar">spi</var> field value will be used as the
          IPComp CPI (compression parameter index) on wire as-is. If
          <b class="Fl" title="Fl">-R</b> is not specified, the kernel will use
          well-known CPI on wire, and <var class="Ar" title="Ar">spi</var> field
          will be used only as an index for kernel internal usage.</dd>
    </dl>
    <div class="Pp"></div>
    <var class="Ar" title="Ar">key</var> must be a double-quoted character
      string, or a series of hexadecimal digits preceded by
      &#x201C;<code class="Li">0x</code>&#x201D;.
    <div class="Pp"></div>
    Possible values for <var class="Ar" title="Ar">ealgo</var>,
      <var class="Ar" title="Ar">aalgo</var>, and
      <var class="Ar" title="Ar">calgo</var> are specified in the
      <a class="Sx" title="Sx" href="#Algorithms">Algorithms</a> sections.
    <div class="Pp"></div>
  </dd>
  <dt class="It-tag"><var class="Ar" title="Ar">src_range</var></dt>
  <dd class="It-tag" style="width: auto;">&#x00A0;</dd>
  <dt class="It-tag"><var class="Ar" title="Ar">dst_range</var></dt>
  <dd class="It-tag">These select the communications that should be secured by
      IPsec. They can be an IPv4/v6 address or an IPv4/v6 address range, and may
      be accompanied by a TCP/UDP port specification. This takes the following
      form:
    <div class="Pp"></div>
    <div class="Bd" style="margin-left: 0.00ex;">
    <pre class="Li">
<var class="Ar" title="Ar">address</var> 
<var class="Ar" title="Ar">address/prefixlen</var> 
<var class="Ar" title="Ar">address[port]</var> 
<var class="Ar" title="Ar">address/prefixlen[port]</var>
    </pre>
    </div>
    <div class="Pp"></div>
    <var class="Ar" title="Ar">prefixlen</var> and
      <var class="Ar" title="Ar">port</var> must be decimal numbers. The square
      brackets around <var class="Ar" title="Ar">port</var> are really
      necessary, they are not man page meta-characters. For FQDN resolution, the
      rules applicable to <var class="Ar" title="Ar">src</var> and
      <var class="Ar" title="Ar">dst</var> apply here as well.
    <div class="Pp"></div>
  </dd>
  <dt class="It-tag"><var class="Ar" title="Ar">upperspec</var></dt>
  <dd class="It-tag">Upper-layer protocol to be used. You can use one of the
      words in <i class="Pa" title="Pa">/etc/protocols</i> as
      <var class="Ar" title="Ar">upperspec</var>, or
      <code class="Li">icmp6</code>, <code class="Li">ip4</code>,
      <code class="Li">gre</code>, or <code class="Li">any</code>.
      <code class="Li">any</code> stands for &#x201C;any protocol&#x201D;. You
      can also use the protocol number. Additional specification can be placed
      after the protocol name for some protocols. You can specify a type and/or
      a code of ICMP or ICMPv6. The type is separated from a code by single
      comma and the code must always be specified. GRE key can be specified in
      dotted-quad format or as plain number. When a zero is specified, the
      kernel deals with it as a wildcard. Note that the kernel can not
      distinguish a wildcard from an ICPMv6 type of zero.
    <div class="Pp"></div>
    For example, the following means that the policy doesn't require IPsec for
      any inbound Neighbor Solicitation.
    <div class="D1"><code class="Li">spdadd ::/0 ::/0 icmp6 135,0 -P in
      none;</code></div>
    <div class="Pp"></div>
    A second example of requiring transport mode encryption of specific GRE
      tunnel:
    <div class="D1"><code class="Li">spdadd 0.0.0.0 0.0.0.0 gre 1234 ipsec
      esp/transport//require;</code></div>
    <div class="Pp"></div>
    <i class="Em" title="Em">Note</i>:
      <var class="Ar" title="Ar">upperspec</var> does not work against
      forwarding case at this moment, as it requires extra reassembly at the
      forwarding node (not implemented at this moment). There are many protocols
      in <i class="Pa" title="Pa">/etc/protocols</i>, but all protocols except
      of TCP, UDP, GRE, and ICMP may not be suitable to use with IPsec. You have
      to consider carefully what to use.
    <div class="Pp"></div>
  </dd>
  <dt class="It-tag"><var class="Ar" title="Ar">label</var></dt>
  <dd class="It-tag"><var class="Ar" title="Ar">label</var> is the access
      control label for the policy. This label is interpreted by the LSM (e.g.,
      SELinux). Ultimately, it enables MAC on network communications. When a
      policy contains an access control label, SAs negotiated with this policy
      will contain the label. Its format:
    <dl class="Bl-tag Bl-compact" style="margin-left: 15.00ex;">
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#ctx"><b class="Fl" title="Fl" id="ctx">-ctx</b></a>
        <var class="Ar" title="Ar">doi</var>
        <var class="Ar" title="Ar">algorithm</var>
        <var class="Ar" title="Ar">context-name</var></dt>
      <dd class="It-tag">
        <dl class="Bl-tag Bl-compact" style="margin-left: 15.00ex;">
          <dt class="It-tag" style="margin-left: -15.00ex;"><var class="Ar" title="Ar">doi</var></dt>
          <dd class="It-tag">The domain of interpretation, which is used by the
              IKE daemon to identify the domain in which negotiation takes
              place.</dd>
          <dt class="It-tag" style="margin-left: -15.00ex;"><var class="Ar" title="Ar">algorithm</var></dt>
          <dd class="It-tag">Indicates the LSM for which the label is generated
              (e.g., SELinux).</dd>
          <dt class="It-tag" style="margin-left: -15.00ex;"><var class="Ar" title="Ar">context-name</var></dt>
          <dd class="It-tag">The string representation of the label that is
              interpreted by the LSM.</dd>
        </dl>
      </dd>
    </dl>
    <div class="Pp"></div>
  </dd>
  <dt class="It-tag"><var class="Ar" title="Ar">policy</var></dt>
  <dd class="It-tag"><var class="Ar" title="Ar">policy</var> is in one of the
      following three formats:
    <ul class="Bl-item Bl-compact">
      <li class="It-item"><a class="selflink" href="#P"><b class="Fl" title="Fl" id="P">-P</b></a>
          <var class="Ar" title="Ar">direction [priority specification]</var>
          <code class="Li">discard</code></li>
      <li class="It-item"><a class="selflink" href="#P"><b class="Fl" title="Fl" id="P">-P</b></a>
          <var class="Ar" title="Ar">direction [priority specification]</var>
          <code class="Li">none</code></li>
      <li class="It-item"><a class="selflink" href="#P"><b class="Fl" title="Fl" id="P">-P</b></a>
          <var class="Ar" title="Ar">direction [priority specification]</var>
          <code class="Li">ipsec</code>
          <var class="Ar" title="Ar">protocol/mode/src-dst/level</var>
          [<span class="Op">...</span>]</li>
    </ul>
    <div class="Pp"></div>
    You must specify the direction of its policy as
      <var class="Ar" title="Ar">direction</var>. Either
      <var class="Ar" title="Ar">out</var>, <var class="Ar" title="Ar">in</var>,
      or <var class="Ar" title="Ar">fwd</var> can be used.
    <div class="Pp"></div>
    <var class="Ar" title="Ar">priority specification</var> is used to control
      the placement of the policy within the SPD. Policy position is determined
      by a signed integer where higher priorities indicate the policy is placed
      closer to the beginning of the list and lower priorities indicate the
      policy is placed closer to the end of the list. Policies with equal
      priorities are added at the end of groups of such policies.
    <div class="Pp"></div>
    Priority can only be specified when setkey has been compiled against kernel
      headers that support policy priorities (Linux &gt;= 2.6.6). If the kernel
      does not support priorities, a warning message will be printed the first
      time a priority specification is used. Policy priority takes one of the
      following formats:
    <dl class="Bl-tag" style="margin-left: 11.40ex;">
      <dt class="It-tag" style="margin-left: -11.40ex;"><var class="Ar" title="Ar">{priority,prio}
        offset</var></dt>
      <dd class="It-tag"><var class="Ar" title="Ar">offset</var> is an integer
          in the range from -2147483647 to 214783648.</dd>
      <dt class="It-tag" style="margin-left: -11.40ex;"><var class="Ar" title="Ar">{priority,prio}
        base {+,-} offset</var></dt>
      <dd class="It-tag"><var class="Ar" title="Ar">base</var> is either
          <code class="Li">low (-1073741824)</code>, <code class="Li">def
          (0)</code>, or <code class="Li">high (1073741824)</code>
        <div class="Pp"></div>
        <var class="Ar" title="Ar">offset</var> is an unsigned integer. It can
          be up to 1073741824 for positive offsets, and up to 1073741823 for
          negative offsets.</dd>
    </dl>
    <div class="Pp"></div>
    <code class="Li">discard</code> means the packet matching indexes will be
      discarded. <code class="Li">none</code> means that IPsec operation will
      not take place onto the packet. <code class="Li">ipsec</code> means that
      IPsec operation will take place onto the packet.
    <div class="Pp"></div>
    The <var class="Ar" title="Ar">protocol/mode/src-dst/level</var> part
      specifies the rule how to process the packet. Either
      <code class="Li">ah</code>, <code class="Li">esp</code>, or
      <code class="Li">ipcomp</code> must be used as
      <var class="Ar" title="Ar">protocol</var>.
      <var class="Ar" title="Ar">mode</var> is either
      <code class="Li">transport</code> or <code class="Li">tunnel</code>. If
      <var class="Ar" title="Ar">mode</var> is <code class="Li">tunnel</code>,
      you must specify the end-point addresses of the SA as
      <var class="Ar" title="Ar">src</var> and
      <var class="Ar" title="Ar">dst</var> with &#x2018;-&#x2019; between these
      addresses, which is used to specify the SA to use. If
      <var class="Ar" title="Ar">mode</var> is
      <code class="Li">transport</code>, both
      <var class="Ar" title="Ar">src</var> and
      <var class="Ar" title="Ar">dst</var> can be omitted.
      <var class="Ar" title="Ar">level</var> is to be one of the following:
      <code class="Li">default</code>, <code class="Li">use</code>,
      <code class="Li">require</code>, or <code class="Li">unique</code>. If the
      SA is not available in every level, the kernel will ask the key exchange
      daemon to establish a suitable SA. <code class="Li">default</code> means
      the kernel consults the system wide default for the protocol you
      specified, e.g. the <code class="Li">esp_trans_deflev</code> sysctl
      variable, when the kernel processes the packet.
      <code class="Li">use</code> means that the kernel uses an SA if it's
      available, otherwise the kernel keeps normal operation.
      <code class="Li">require</code> means SA is required whenever the kernel
      sends a packet matched with the policy. <code class="Li">unique</code> is
      the same as <code class="Li">require</code>; in addition, it allows the
      policy to match the unique out-bound SA. You just specify the policy level
      <code class="Li">unique</code>, <a class="Xr" title="Xr">racoon(8)</a>
      will configure the SA for the policy. If you configure the SA by manual
      keying for that policy, you can put a decimal number as the policy
      identifier after <code class="Li">unique</code> separated by a colon
      &#x2018;:&#x2019; like: <code class="Li">unique:number</code> in order to
      bind this policy to the SA. <code class="Li">number</code> must be between
      1 and 32767. It corresponds to <var class="Ar" title="Ar">extensions</var>
      <b class="Fl" title="Fl">-u</b> of the manual SA configuration. When you
      want to use SA bundle, you can define multiple rules. For example, if an
      IP header was followed by an AH header followed by an ESP header followed
      by an upper layer protocol header, the rule would be:
    <div class="D1"><code class="Li">esp/transport//require
      ah/transport//require;</code></div>
    The rule order is very important.
    <div class="Pp"></div>
    When NAT-T is enabled in the kernel, policy matching for ESP over UDP
      packets may be done on endpoint addresses and port (this depends on the
      system. System that do not perform the port check cannot support multiple
      endpoints behind the same NAT). When using ESP over UDP, you can specify
      port numbers in the endpoint addresses to get the correct matching. Here
      is an example:
    <div class="Pp"></div>
    <div class="Bd" style="margin-left: 0.00ex;">
    <pre class="Li">
spdadd 10.0.11.0/24[any] 10.0.11.33/32[any] any -P out ipsec 
    esp/tunnel/192.168.0.1[4500]-192.168.1.2[30000]/require ; 

    </pre>
    </div>
    These ports must be left unspecified (which defaults to 0) for anything
      other than ESP over UDP. They can be displayed in SPD dump using
      <b class="Nm" title="Nm">setkey</b> <b class="Fl" title="Fl">-DPp</b>.
    <div class="Pp"></div>
    Note that &#x201C;<code class="Li">discard</code>&#x201D; and
      &#x201C;<code class="Li">none</code>&#x201D; are not in the syntax
      described in <a class="Xr" title="Xr">ipsec_set_policy(3)</a>. There are a
      few differences in the syntax. See
      <a class="Xr" title="Xr">ipsec_set_policy(3)</a> for detail.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Algorithms"><a class="selflink" href="#Algorithms">Algorithms</a></h2>
The following list shows the supported algorithms.
  <b class="Sy" title="Sy">protocol</b> and
  <b class="Sy" title="Sy">algorithm</b> are almost orthogonal. These
  authentication algorithms can be used as
  <var class="Ar" title="Ar">aalgo</var> in <b class="Fl" title="Fl">-A</b>
  <var class="Ar" title="Ar">aalgo</var> of the
  <var class="Ar" title="Ar">protocol</var> parameter:
<div class="Pp"></div>
<div class="Bd" style="margin-left: 5.00ex;">
<pre class="Li">
algorithm	keylen (bits) 
hmac-md5	128		ah: rfc2403 
		128		ah-old: rfc2085 
hmac-sha1	160		ah: rfc2404 
		160		ah-old: 128bit ICV (no document) 
keyed-md5	128		ah: 96bit ICV (no document) 
		128		ah-old: rfc1828 
keyed-sha1	160		ah: 96bit ICV (no document) 
		160		ah-old: 128bit ICV (no document) 
null		0 to 2048	for debugging 
hmac-sha256	256		ah: 96bit ICV 
				(draft-ietf-ipsec-ciph-sha-256-00) 
		256		ah-old: 128bit ICV (no document) 
hmac-sha384	384		ah: 96bit ICV (no document) 
		384		ah-old: 128bit ICV (no document) 
hmac-sha512	512		ah: 96bit ICV (no document) 
		512		ah-old: 128bit ICV (no document) 
hmac-ripemd160	160		ah: 96bit ICV (RFC2857) 
				ah-old: 128bit ICV (no document) 
aes-xcbc-mac	128		ah: 96bit ICV (RFC3566) 
		128		ah-old: 128bit ICV (no document) 
tcp-md5		8 to 640	tcp: rfc2385 (tcp-md5 support only on BSD)
</pre>
</div>
<div class="Pp"></div>
These encryption algorithms can be used as
  <var class="Ar" title="Ar">ealgo</var> in <b class="Fl" title="Fl">-E</b>
  <var class="Ar" title="Ar">ealgo</var> of the
  <var class="Ar" title="Ar">protocol</var> parameter:
<div class="Pp"></div>
<div class="Bd" style="margin-left: 5.00ex;">
<pre class="Li">
algorithm	keylen (bits) 
des-cbc		64		esp-old: rfc1829, esp: rfc2405 
3des-cbc	192		rfc2451 
null		0 to 2048	rfc2410 
blowfish-cbc	40 to 448	rfc2451 
cast128-cbc	40 to 128	rfc2451 
des-deriv	64		ipsec-ciph-des-derived-01 
3des-deriv	192		no document 
rijndael-cbc	128/192/256	rfc3602 
twofish-cbc	0 to 256	draft-ietf-ipsec-ciph-aes-cbc-01 
aes-ctr		160/224/288	draft-ietf-ipsec-ciph-aes-ctr-03 
camellia-cbc	128/192/256	rfc4312
</pre>
</div>
<div class="Pp"></div>
Note that the first 128 bits of a key for <code class="Li">aes-ctr</code> will
  be used as AES key, and the remaining 32 bits will be used as nonce.
<div class="Pp"></div>
These compression algorithms can be used as
  <var class="Ar" title="Ar">calgo</var> in <b class="Fl" title="Fl">-C</b>
  <var class="Ar" title="Ar">calgo</var> of the
  <var class="Ar" title="Ar">protocol</var> parameter:
<div class="Pp"></div>
<div class="Bd" style="margin-left: 5.00ex;">
<pre class="Li">
algorithm 
deflate		rfc2394
</pre>
</div>
<h2 class="Ss" title="Ss" id="RFC_vs_Linux_kernel_semantics"><a class="selflink" href="#RFC_vs_Linux_kernel_semantics">RFC
  vs Linux kernel semantics</a></h2>
The Linux kernel uses the <var class="Ar" title="Ar">fwd</var> policy instead of
  the <var class="Ar" title="Ar">in</var> policy for packets what are forwarded
  through that particular box.
<div class="Pp"></div>
In <var class="Ar" title="Ar">kernel</var> mode,
  <b class="Nm" title="Nm">setkey</b> manages and shows policies and SAs exactly
  as they are stored in the kernel.
<div class="Pp"></div>
In <var class="Ar" title="Ar">RFC</var> mode,
  <b class="Nm" title="Nm">setkey</b>
<ul class="Bl-item">
  <li class="It-item">creates <var class="Ar" title="Ar">fwd</var> policies for
      every <var class="Ar" title="Ar">in</var> policy inserted</li>
  <li class="It-item">(not implemented yet) filters out all
      <var class="Ar" title="Ar">fwd</var> policies</li>
</ul>
<h1 class="Sh" title="Sh" id="RETURN_VALUES"><a class="selflink" href="#RETURN_VALUES">RETURN
  VALUES</a></h1>
The command exits with 0 on success, and non-zero on errors.
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
<div class="Bd" style="margin-left: 0.00ex;">
<pre class="Li">
add 3ffe:501:4819::1 3ffe:501:481d::1 esp 123457 
	-E des-cbc 0x3ffe05014819ffff ; 
 
add -6 myhost.example.com yourhost.example.com ah 123456 
	-A hmac-sha1 &quot;AH SA configuration!&quot; ; 
 
add 10.0.11.41 10.0.11.33 esp 0x10001 
	-E des-cbc 0x3ffe05014819ffff 
	-A hmac-md5 &quot;authentication!!&quot; ; 
 
get 3ffe:501:4819::1 3ffe:501:481d::1 ah 123456 ; 
 
flush ; 
 
dump esp ; 
 
spdadd 10.0.11.41/32[21] 10.0.11.33/32[any] any 
	-P out ipsec esp/tunnel/192.168.0.1-192.168.1.2/require ; 
 
add 10.1.10.34 10.1.10.36 tcp 0x1000 -A tcp-md5 &quot;TCP-MD5 BGP secret&quot; ; 
 
add 10.0.11.41 10.0.11.33 esp 0x10001 
	-ctx 1 1 &quot;system_u:system_r:unconfined_t:SystemLow-SystemHigh&quot; 
	-E des-cbc 0x3ffe05014819ffff; 
 
spdadd 10.0.11.41 10.0.11.33 any 
	-ctx 1 1 &quot;system_u:system_r:unconfined_t:SystemLow-SystemHigh&quot; 
	-P out ipsec esp/transport//require ;
</pre>
</div>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<a class="Xr" title="Xr">ipsec_set_policy(3)</a>,
  <a class="Xr" title="Xr">racoon(8)</a>, <a class="Xr" title="Xr">sysctl(8)</a>
<div class="Pp"></div>
<cite class="Rs" title="Rs"><span class="RsT">Changed manual key configuration
  for IPsec</span>,
  <a class="RsU" href="http://www.kame.net/newsletter/19991007/">http://www.kame.net/newsletter/19991007/</a>,
  <span class="RsD">October 1999</span>.</cite>
<h1 class="Sh" title="Sh" id="HISTORY"><a class="selflink" href="#HISTORY">HISTORY</a></h1>
The <b class="Nm" title="Nm">setkey</b> command first appeared in the WIDE
  Hydrangea IPv6 protocol stack kit. The command was completely re-designed in
  June 1998.
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
<b class="Nm" title="Nm">setkey</b> should report and handle syntax errors
  better.
<div class="Pp"></div>
For IPsec gateway configuration, <var class="Ar" title="Ar">src_range</var> and
  <var class="Ar" title="Ar">dst_range</var> with TCP/UDP port numbers does not
  work, as the gateway does not reassemble packets (it cannot inspect
  upper-layer headers).</div>
<table class="foot">
  <tr>
    <td class="foot-date">June 4, 2010</td>
    <td class="foot-os">Linux 4.12.14-300.fc26.x86_64</td>
  </tr>
</table>
</body>
</html>
