<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>opaswitchadmin(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">opaswitchadmin(8)</td>
    <td class="head-vol">Master map: IFSFFCLIRG (Man Page)</td>
    <td class="head-rtitle">opaswitchadmin(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
opaswitchadmin
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>(Switch)</b> Performs a number of multi-step initialization and verification
  operations against one or more externally managed Intel(R) Omni-Path switches.
  The operations include initial switch setup, firmware upgrades, chassis
  reboot, and others.
<h1 class="Sh" title="Sh" id="Syntax"><a class="selflink" href="#Syntax">Syntax</a></h1>
opaswitchadmin [-c] [-N ' <i>nodes</i>'] [-L <i>nodefile</i>] [-O] [-P
  <i>packages</i>] [-a <i>action</i>] [-t <i>portsfile</i>] [-p <i>ports</i>]
  <i>operation</i>...
<h1 class="Sh" title="Sh" id="Options"><a class="selflink" href="#Options">Options</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag">-help</dt>
  <dd class="It-tag">Produces full help text.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-c</dt>
  <dd class="It-tag">Clobbers result files from any previous run before starting
      this run.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-N <i>nodes</i></dt>
  <dd class="It-tag">List of nodes to execute the operation against.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-L <i>nodefile</i></dt>
  <dd class="It-tag">File with nodes in the cluster. Default is
      /etc/sysconfig/opa/switches file.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-P <i>packages</i></dt>
  <dd class="It-tag">
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
For upgrades File name or directory where the firmware image is to install. For
  the directory specified, .emfw file in the directory tree is used. shell wild
  cards may also be used within quotes.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
For capture File name to upload to. Default is switchcapture file.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">-t <i>portsfile</i></dt>
  <dd class="It-tag">File with list of local HFI ports used to access fabrics
      for switch access. Default is /etc/sysconfig/opa/ports file.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-p <i>ports</i></dt>
  <dd class="It-tag">List of local HFI ports used to access fabrics for switch
      access. Default is first active port. The first HFI in the system is 1.
      The first port on an HFI is 1.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">Uses the format hfi:port, for example:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
0:0 First active port in system.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
0:y Port <i>y</i> within system.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
x:0 First active port on HFI <i>x</i>.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
x:y HFI <i>x</i>, port <i>y</i>.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">-a <i>action</i></dt>
  <dd class="It-tag">Action for firmware file for switch upgrade. The action
      argument can be one or more of the following:
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
select Ensures firmware is in primary (default).
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
run Ensures firmware is in primary and running.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">-O</dt>
  <dd class="It-tag">Override for firmware upgrades, bypasses the previous
      firmware version checks, and forces the update unconditionally.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <br/>
   <i>operation</i></dt>
  <dd class="It-tag">Performs the specified <i>operation</i>, which can be one
      or more of the following:
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
reboot Reboots switches, ensures they go down and come back.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
configure Runs wizard to set up switch configuration.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
upgrade Upgrades installation of all switches.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
info Reports firmware and hardware version, part number, and data rate
  capability of all nodes.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
hwvpd Completes hardware Vital Product Data (VPD) report of all nodes.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
ping Pings all nodes and tests for presence.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
fwverify Reports integrity of failsafe firmware of all nodes.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
getconfig Gets port configurations of an externally managed switch.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
For more information on operations, see <i>opachassisadmin Operation Details</i>
<h1 class="Sh" title="Sh" id="Example"><a class="selflink" href="#Example">Example</a></h1>
opaswitchadmin -c reboot
<div>&#x00A0;</div>
opaswitchadmin -P /root/ChassisFw <i>X.X.X.X.X</i> upgrade
<div>&#x00A0;</div>
opaswitchadmin -a run -P '*.emfw' upgrade
<h1 class="Sh" title="Sh" id="Environment_Variables"><a class="selflink" href="#Environment_Variables">Environment
  Variables</a></h1>
The following environment variables are also used by this command:
<dl class="Bl-tag">
  <dt class="It-tag"><b>OPASWITCHES</b></dt>
  <dd class="It-tag">List of nodes, used in absence of -N and -L options.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>OPASWITCHES_FILE</b></dt>
  <dd class="It-tag">File containing list of nodes, used in absence of -N and -L
      options.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>FF_MAX_PARALLEL</b></dt>
  <dd class="It-tag">Maximum concurrent operations.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>FF_SERIALIZE_OUTPUT</b></dt>
  <dd class="It-tag">Serialize output of parallel operations (yes or no).
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="Details"><a class="selflink" href="#Details">Details</a></h1>
opaswitchadmin provides detailed logging of its results. During each run, the
  following files are produced:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">test.res : Appended with summary results of run.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">test.log : Appended with detailed results of run.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">save_tmp/ : Contains a directory per failed test with
      detailed logs.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">test_tmp*/ : Intermediate result files while test is
      running.</dd>
</dl>
<div class="Pp"></div>
The -c option removes all log files.
<div class="Pp"></div>
Results from opaswitchadmin are grouped into test suites, test cases, and test
  items. A given run of opaswitchadmin represents a single test suite. Within a
  test suite, multiple test cases occur; typically one test case per chassis
  being operated on. Some of the more complex operations may have multiple test
  items per test case. Each test item represents a major step in the overall
  test case.
<div class="Pp"></div>
Each opaswitchadmin run appends to test.res and test.log and creates temporary
  files in test_tmp$PID in the current directory. the test.res file provides an
  overall summary of operations performed and their results. The same
  information is also displayed while opaswitchadmin is executing. test.log
  contains detailed information about what was performed, including the specific
  commands executed and the resulting output. The test_tmp directories contain
  temporary files that reflect tests in progress (or killed). The logs for any
  failures are logged in the save_temp directory with a directory per failed
  test case. If the same test case fails more than once, save_temp retains the
  information from the first failure. Subsequent runs of opaswitchadmin are
  appended to test.log. Intel recommends reviewing failures and using the -c
  option to remove old logs before subsequent runs of opaswitchadmin.
  opaswitchadmin also appends to punchlist.csv for failing switches.
<div class="Pp"></div>
opaswitchadmin implicitly performs its operations in parallel. However, as for
  the other tools, <b>FF_MAX_PARALLEL</b> can be exported to change the degree
  of parallelism. Twenty (20) parallel operations is the default.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="opaswitchadmin_Operation_Details"><a class="selflink" href="#opaswitchadmin_Operation_Details">opaswitchadmin
  Operation Details</a></h1>
<b>(Switch)</b> All operations against Intel(R) Omni-Path Fabric
  externally-managed switches (except ping) securely access the selected
  switches. If a password has been set, the -S option must be used to securely
  prompt for a password. In this case, the same password is used for all
  switches.
<dl class="Bl-tag">
  <dt class="It-tag">reboot</dt>
  <dd class="It-tag">Reboots the given switches.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">Use the <b>FF_MAX_PARALLEL</b> value to select either a
      rolling reboot or a parallel reboot. In most cases, a parallel reboot is
      recommended for expediency.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">upgrade</dt>
  <dd class="It-tag">Upgrades the firmware on each specified switch. The -P
      option selects a directory containing a .emfw file or provides an explicit
      .emfw file for the switches. If more than one .emfw file is specified, the
      operation is undefined. The -a option selects the desired minimal state
      for the new firmware. Only the select and run options are valid for this
      operation.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">When the -a option specifies run, switches are rebooted.
      Use the <b>FF_MAX_PARALLEL</b> value to select a rolling upgrade or a
      parallel upgrade. In most cases, a parallel upgrade is recommended for
      expediency.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">The upgrade process also sets the switch name.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">The upgrade process is used to set, clear, or change the
      password of the switches using the -s option. When this option is
      specified, you are prompted for a new password to be set on the switches.
      To reset (clear) the password, press Enter when prompted. This option can
      be used to configure the switches to not require a password for subsequent
      operations. A change to the password does not take effect until the next
      reboot of the switch.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">For more information about switch firmware, refer to the
      <i>Intel(R) Omni-Path Fabric Switches GUI User Guide</i>
    <div style="height: 1.00em;">&#x00A0;</div>
    and <i>Intel(R) Omni-Path Fabric Externally-Managed Switches Release
      Notes</i>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">configure</dt>
  <dd class="It-tag">Runs the switch setup wizard, which asks a series of
      questions. Once the wizard has finished prompting for configuration
      information, all the selected switches are configured according to the
      entered responses. The following items are configurable for all Intel(R)
      Omni-Path Switch 100 Series :
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">MTU</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">VL Capability</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">VL credit distribution</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Link Width Supported</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">OPA Node Description
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
<b>NOTE:</b> Typically, the Node Description is updated automatically during a
  firmware upgrade, if it is configured properly in the switches file. Updating
  the node description is also available using the configure option without
  performing a firmware upgrade.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">info</dt>
  <dd class="It-tag">Queries the switches and displays the following
      information:
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Firmware version</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Hardware version</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Hardware part number, including revision information</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Speed capability</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Fan status</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Power supply status
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">This operation also outputs a summary of various
      configuration settings for each switch within a fabric.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">hwvpd</dt>
  <dd class="It-tag">Queries the switches and displays the Vital Product Data
      (VPD) including:
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Serial number</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Part number</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Model name</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Hardware version</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Manufacturer</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Product description</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Manufacturer ID</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Manufacture date</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Manufacture time
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">ping</dt>
  <dd class="It-tag">Issues an inband packet to the switches to test for
      presence and reports on presence/non-presence of each selected switch.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
<b>NOTE:</b> It is not necessary to supply a password (using -S) for this
  operation.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">fwverify</dt>
  <dd class="It-tag">Verifies the integrity of the firmware images in the
      EEPROMs of the selected switches.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">capture</dt>
  <dd class="It-tag">Gets switch hardware and firmware state capture of all
      nodes.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">getconfig</dt>
  <dd class="It-tag">Gets port configurations of an externally managed switch.
      This operation also outputs a summary of various configuration settings
      for each switch within a fabric. For example, in a fabric with seven
      switches, a report similar to the following is displayed.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">This summary helps determine if all switches have the same
      configuration, and if not, indicates how many have each value. If some of
      the values are not as expected, view the test.res file to identify which
      switches have the undesirable values.</dd>
</dl>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">Intel Corporation</td>
    <td class="foot-os">Copyright(C) 2015-2016</td>
  </tr>
</table>
</body>
</html>
