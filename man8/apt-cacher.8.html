<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>APT-CACHER(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">APT-CACHER(8)</td>
    <td class="head-vol">System Manager's Manual</td>
    <td class="head-rtitle">APT-CACHER(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
apt-cacher - caching proxy for Debian packages
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<h2 class="Ss" title="Ss" id="Server:"><a class="selflink" href="#Server:">Server:</a></h2>
[<span class="Op"><b>-h|--help</b>]</span>
  [<span class="Op"><b>-i|-d</b>]</span> [<span class="Op"><b>-c</b>
  <i>configfile</i>]</span> [<span class="Op"><b>-p</b> <i>pidfile</i>]</span>
  [<span class="Op"><b>-r</b> <i>directory</i>]</span>
  [<span class="Op"><b>-R</b> <i>retries</i>]</span>
  [<span class="Op"><b>config_option=foo</b>]</span>
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Client:"><a class="selflink" href="#Client:">Client:</a></h2>
<b>http://apt-cacher.server:3142[/apt-cacher]/{mirror}/{distribution}</b>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<b>Apt-cacher</b> is a caching proxy for Debian packages, allowing a number of
  computers to share a single cache. Packages requested from the cache only need
  to be downloaded from the Debian mirrors once, no matter how many local
  machines need to install them. This saves network bandwidth, improves
  performance for users, and reduces the load on the mirrors.
<div class="Pp"></div>
In addition to proxying and caching HTTP requests, apt-cacher can proxy and
  cache FTP and HTTPS GET/HEAD requests, Debian bugs SOAP requests and proxy
  (but not cache) HTTPS CONNECT requests.
<h1 class="Sh" title="Sh" id="COMMAND-LINE_OPTIONS"><a class="selflink" href="#COMMAND-LINE_OPTIONS">COMMAND-LINE
  OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-c configfile</b></dt>
  <dd class="It-tag">Specify alternative configuration file to default
      [/etc/apt-cacher/apt-cacher.conf]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-d</b></dt>
  <dd class="It-tag">Stand-alone daemon-mode. Fork and run in the
    background</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-h, --help</b></dt>
  <dd class="It-tag">Print brief usage.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-i</b></dt>
  <dd class="It-tag">Inetd daemon-mode: Only use in /etc/inetd.conf</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-p pidfile</b></dt>
  <dd class="It-tag">Write PID of running process to this file.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-r directory</b></dt>
  <dd class="It-tag">Experimental option to chroot to given directory</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-R retries</b></dt>
  <dd class="It-tag">Number of attempts to bind to daemon port.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-v, --version</b></dt>
  <dd class="It-tag">Show version and exit.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>config_option=value</b></dt>
  <dd class="It-tag">Override values in configuration file. Can be given
      multiple times.</dd>
</dl>
<h1 class="Sh" title="Sh" id="USAGE"><a class="selflink" href="#USAGE">USAGE</a></h1>
Setting up apt-cacher involves two stages: installing apt-cacher itself on a
  single machine on your network to act as a server and configuring all client
  machines to use the server's cache.
<div class="Pp"></div>
Apt-cacher can be installed to run either as a daemon [preferred] or as a CGI
  script on a web server such as Apache [deprecated]. When a client (apt-get(1),
  aptitude(8), synaptic(8) etc.) requests a package from the cache machine, the
  request is handled by apt-cacher which checks whether it already has that
  particular package. If so, the package is returned immediately to the client
  for installation. If not, or if the package in the local cache has been
  superseded by a more recent version, the package is fetched from the specified
  mirror. While being fetched it is simultaneously streamed to the client, and
  also saved to the local cache for future use.
<div class="Pp"></div>
Other client machines on your network do not need apt-cacher installed in order
  to use the server cache. The only modification on each client computer is to
  direct it to use the server cache. See CLIENT CONFIGURATION below for ways of
  doing this.
<h1 class="Sh" title="Sh" id="SERVER_INSTALLATION"><a class="selflink" href="#SERVER_INSTALLATION">SERVER
  INSTALLATION</a></h1>
Apt-cacher can be installed in various ways on the server. The recommended way
  is by running the program as a daemon. This should give the best performance
  and the lowest overall memory usage.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="Daemon_Mode"><a class="selflink" href="#Daemon_Mode">Daemon
  Mode</a></h1>
<h2 class="Ss" title="Ss" id="Stand-alone_Daemon:"><a class="selflink" href="#Stand-alone_Daemon:">Stand-alone
  Daemon:</a></h2>
Edit the file /etc/default/apt-cacher and change AUTOSTART=1, then run (as root)
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">/etc/init.d/apt-cacher start</dd>
</dl>
<div class="Pp"></div>
to start the daemon.
<h2 class="Ss" title="Ss" id="Inetd_Daemon:"><a class="selflink" href="#Inetd_Daemon:">Inetd
  Daemon:</a></h2>
Edit /etc/inetd.conf and add the line
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">3142 stream tcp nowait www-data /usr/sbin/apt-cacher
      apt-cacher -i</dd>
</dl>
<div class="Pp"></div>
Restart or send SIGHUP to inetd after saving the file. This is a good method if
  you do not wish the daemon to be loaded all the time.
<div class="Pp"></div>
In either daemon mode, clients can access the server using
  <b>http://apt-cacher.server:port/</b>
<div class="Pp"></div>
NOTE: in inetd mode access control checks are not performed and the
  allowed_hosts and denied_hosts options have no effect. Access controls for
  inetd can be implemented using using inetd or tcpd wrapper. See inetd.conf(5)
  and hosts_access(5) for further details.
<h1 class="Sh" title="Sh" id="CGI_Mode"><a class="selflink" href="#CGI_Mode">CGI
  Mode</a></h1>
This mode is deprecated and not recommended for long-term use because it brings
  a visible performance impact on the network and server speed. To use it you
  will need to ensure your webserver supports CGI. Clients can access the server
  using <b>http://apt-cacher.server[:port]/cgi-bin/apt-cacher/.</b>
<div class="Pp"></div>
Migration away from deprecated CGI mode can be smoothed using the following
  configuration options
<dl class="Bl-tag">
  <dt class="It-tag"><b>cgi_advise_to_use []</b></dt>
  <dd class="It-tag">This is a custom error message that is used to advise
      clients to use an alternative to CGI.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>cgi_redirect []</b></dt>
  <dd class="It-tag">If set, this option is an absolute URL that is used to
      redirect any CGI requests. It can be used to seamlessly redirect CGI
      access to an instance of apt-cacher running as an INETD or stand-alone
      daemon.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="SERVER_CONFIGURATION_OPTIONS"><a class="selflink" href="#SERVER_CONFIGURATION_OPTIONS">SERVER
  CONFIGURATION OPTIONS</a></h1>
Apt-cacher uses a configuration file for setting important options. Additionally
  there are few command line options to control behaviour. See COMMAND-LINE
  OPTIONS above.
<div class="Pp"></div>
The default configuration file is <b>/etc/apt-cacher/apt-cacher.conf.</b> It is
  read every time the daemon starts or an inetd/CGI instance is executed.
  Therefore a stand-alone daemon may need to be restarted or reloaded using the
  init script in order to reread its configuration. A running daemon will also
  reread the configuration file on receiving SIGHUP (see SIGNALS below).
<div class="Pp"></div>
As an alternative to editing the configuration file, configuration fragments to
  override the defaults can also be placed in a directory named conf.d in the
  same directory as the main configuration file, e.g. '/etc/apt-cacher/conf.d/'.
  Files placed here can have an arbitrary name. They are read using glob(7)
  semantics: case-insensitive, ascending ASCII order; dot-files (beginning with
  '.') ignored. Also, backup files ending with '~' and any files ending with
  &#x00B4;.disabled' or '.dpkg-{old,new,dist,tmp}' are also ignored. Duplicate
  settings read later will override any previous ones.
<div class="Pp"></div>
Each line in the file consists of
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">configuration_option = value</dd>
</dl>
<div class="Pp"></div>
Long lines can be split by preceding the newlines with '\'. Whitespace is
  ignored. Lines beginning with '#' are comments and are ignored. If multiple
  assignments of the same option occur, only the last one will take effect. For
  binary options, 0 means off or disabled, any other integer means on or
  enabled. Options which can accept lists may use either ';' or ',' to separate
  the individual list members. To include these separators within a list item
  escape them with '\'.
<div class="Pp"></div>
The options available in the config file (and their default settings) are:
<h2 class="Ss" title="Ss" id="Universal_Options"><a class="selflink" href="#Universal_Options">Universal
  Options</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>admin_email [root@localhost]</b></dt>
  <dd class="It-tag">The email address of the administrator is displayed in the
      info page and traffic reports.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>allowed_locations</b></dt>
  <dd class="It-tag">Only allow access to specific upstream mirrors. The
      requested URL must match an item in this list for access to be granted.
      The part of the URL referring to the apt-cacher server itself
      (http://apt-cacher.server:port[/apt-cacher]/) is ignored. Matching begins
      immediately after that. If '%PATH_MAP%' in included in this option, it
      will be expanded to the keys of the path_map setting. Note this item
      contains string(s), not regexps.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>allowed_ssl_locations []</b></dt>
  <dd class="It-tag">Only allow HTTPS/SSL proxy CONNECT to hosts or IPs which
      match an item in this list.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>allowed_ssl_ports [443]</b></dt>
  <dd class="It-tag">Only allow HTTPS/SSL proxy CONNECT to ports which match an
      item in this list. Adding further items to this can pose a significant
      security risk. DO NOT do it unless you understand the full
    implications.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>cache_dir [/var/cache/apt-cacher]</b></dt>
  <dd class="It-tag">The directory where apt-cacher will store local copies of
      all packages requested. This can grow to many hundreds of MB, so make sure
      it is on a partition with plenty of room. NOTE: the cache directory needs
      to contain some subdirectories for correct storage management. If you try
      to create a custom directory, please use the script
      /usr/share/apt-cacher/install.pl or use the initially created cache
      directory as example.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>concurrent_import_limit [</b><i>Number of CPU cores from
    /proc/cpuinfo or 0</i><b>]</b></dt>
  <dd class="It-tag">Importing new checksums can cause high CPU usage on slower
      systems. This option sets a limit to the number of index files that are
      imported simultaneously, thereby limiting CPU load average, but, possibly,
      taking longer. Leave unset or set to 0 for no limit.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>checksum [0]</b></dt>
  <dd class="It-tag">Switches on checksum validation of cached files. Checksum
      validation will slow apt-cacher response as requested files have to be
      downloaded completely before validation can occur. This slow down can be
      prevented by setting this value to 'lazy' in which case files will be
      passed on as they are received and checked afterwards. Requires package
      libberkeleydb-perl to be installed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>checksum_files_regexp [</b><i>see default
    /etc/apt-cacher/apt-cacher.conf</i><b>]</b></dt>
  <dd class="It-tag">Perl regular expression (perlre(1)) which matches the URL
      filename of all index files from which checksums are imported into the
      checksum database if checksum mode is enabled.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>clean_cache [1]</b></dt>
  <dd class="It-tag">Whether to flush obsolete versions of packages from your
      cache daily. You can check what will be done by running</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><b>/usr/share/apt-cacher/apt-cacher-cleanup.pl -s</b></dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">which will just show what would be done to the contents of
      the cache. A package is only obsolete if none of the (optional)
      namespaces, distributions (stable, testing, etc) or architectures you use
      reference it. It should be safe to leave this on.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>curl_idle_timeout [120]</b></dt>
  <dd class="It-tag">The maximum time in seconds the libcurl backend will wait,
      unused, before exiting.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>curl_ssl_insecure []</b></dt>
  <dd class="It-tag">If this is set to 1, HTTPS GET requests (which are
      inherently insecure as transfer from the proxy to the client is
      unverified) is even less secure as the libcurl backend skips peer
      verification with the upstream source. You really shouldn't use this.
      HTTPS CONNECT proxying is more secure.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>curl_throttle [10]</b></dt>
  <dd class="It-tag">Controls how fast the libcurl process runs. Increasing this
      setting will reduce the CPU load of the libcurl process, possibly at the
      expense of slower response times and a lower throughput. On most systems
      this option should be left unchanged.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>data_timeout [120]</b></dt>
  <dd class="It-tag">Time in seconds which, if no data is received from
      upstream, a request will timeout. This option used to be known as
      fetch_timeout. The old name is still recognised for backwards
      compatibility.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>debug [0]</b></dt>
  <dd class="It-tag">Whether debug mode is enabled. Off by default. When turned
      on (non-nil), lots of extra debug information will be written to the error
      log. This can make the error log become quite big, so only use it when
      trying to debug problems. Additional information from the libcurl backend
      can be obtained by increasing this parameter. The correspondence between
      this setting and curl_infotype is:-</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">1</dt>
  <dd class="It-tag">CURLINFO_TEXT</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">2</dt>
  <dd class="It-tag">CURLINFO_HEADER_IN</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">3</dt>
  <dd class="It-tag">CURLINFO_HEADER_OUT</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">4</dt>
  <dd class="It-tag">CURLINFO_DATA_IN</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">5</dt>
  <dd class="It-tag">CURLINFO_DATA_OUT</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">6</dt>
  <dd class="It-tag">CURLINFO_SSL_DATA_IN</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">7</dt>
  <dd class="It-tag">CURLINFO_SSL_DATA_OUT</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">See CURLOPT_DEBUGFUNCTION in curl_easy_setopt(3) for
      further information.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>disk_usage_limit []</b></dt>
  <dd class="It-tag">Optional upper limit for the disk space usage of cache_dir
      in bytes. Units (k, KiB, M, MiB etc.) are recognised with the same
      semantics as the rate limit option above.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>distinct_namespaces [0]</b></dt>
  <dd class="It-tag">Set this to 1 to enable support for caching multiple
      Distributions (e.g Debian and Ubuntu) from a single apt-cacher instance.
      When enabled, package files are stored in a subdirectory, the name of
      which is derived from the matching key of path_map or the part of the URL
      preceding 'pool' or 'dists'. This is typically &#x00B4;debian', 'ubuntu'
      or 'security'. This mechanism prevents clashes between the
    Distributions.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">If you enable this option, any existing namespace specific
      package files which are not in the correct subdirectory of cache_dir would
      be deleted by apt-cacher-cleanup.pl. If you wish to keep them and import
      them into the correct namespace then run (as root)</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">/usr/share/apt-cacher/apt-cacher-import.pl -u
      {cache_dir}/packages</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">If you wish to limit the possible namespaces see
    path_map.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>expire_hours [0]</b></dt>
  <dd class="It-tag">How many hours Package and Release files are cached before
      they are assumed to be too old and must be re-fetched. Setting 0 means
      that the validity of these files is checked on each access by comparing
      time stamps in HTTP headers on the server with those stored locally. Use
      of this setting is deprecated as HTTP header validation and sending
      If-Modified-Requests is much more efficient.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>generate_reports [1]</b></dt>
  <dd class="It-tag">Whether to generate traffic reports daily. Traffic reports
      can be accessed by pointing a browser to</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">http://apt-cacher.server:3142/report/ [daemon mode]</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">or</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">http://apt-cacher.server[:port]/apt-cacher/report/ [CGI
      mode].</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>group [www-data]</b></dt>
  <dd class="It-tag">The effective group id to change to.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>http_proxy []</b></dt>
  <dd class="It-tag">Apt-cacher can pass all its requests to an external http
      proxy like Squid, which could be very useful if you are using an ISP that
      blocks port 80 and requires all web traffic to go through its proxy. The
      option takes a URI of the form</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">[protocol://][user[:password]@]hostname[:port]</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">The default protocol is http and the default port is
    1080.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>http_proxy_auth []</b></dt>
  <dd class="It-tag">External http proxy sometimes need authentication to get
      full access. The format is 'username:password', eg: 'proxyuser:proxypass'.
      This option is deprecated. Proxy authentication details should be
      specified in the http_proxy URI.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>index_files_regexp [</b><i>see default
    /etc/apt-cacher/apt-cacher.conf</i><b>]</b></dt>
  <dd class="It-tag">Perl regular expression (perlre(1)) which matches the URL
      filename of all index-type files (files that are uniquely identified by
      their full path and need to be checked for freshness).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>installer_files_regexp [</b><i>see default
    /etc/apt-cacher/apt-cacher.conf</i><b>]</b></dt>
  <dd class="It-tag">Perl regular expression (perlre(1)) which matches the URL
      filename of all files used by Aptitude, Apt, the Debian/Ubuntu installer
      or Debian Live (files that are uniquely identified by their full path but
      don't need to be checked for freshness). Within this item the shorthand
      '%VALID_UBUNTU_RELEASE_NAMES%' will be expanded to the list configured in
      ubuntu_release_names as regexp alternatives.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>interface []</b></dt>
  <dd class="It-tag">Specify a particular interface to use for the upstream
      connection. Can be an interface name, IP address or host name. If unset,
      the default route is used.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>libcurl []</b></dt>
  <dd class="It-tag">This is a list of configuration options for the libcurl
      backend. Each item consists of the curl_easy_setopt(3) option (without the
      CURLOPT_ prefix) and the desired setting. For example:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">libcurl = dns_cache_timeout 300, maxredirs 10, noproxy
      localhost;</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">Be very careful with this. Apt-cacher depends on the
      libcurl backend working in a predictable way. You can very easily break
      things by configuring this.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>limit [0]</b></dt>
  <dd class="It-tag">Rate limiting sets the maximum rate in bytes per second
      used for fetching files from the upstream mirrors. Optionally, use SI unit
      abbreviations ('k', 'M', 'G' etc.) for decimal multiples (1000) or 'KiB',
      'MiB', or 'GiB' etc. for binary (1024) multiples. Legacy lowercase
      suffixes based on wget(1) syntax are interpreted as decimal for backwards
      compatibility, but should be avoided in new configurations. Use 0 for no
      rate limiting. By default this setting is <i>per libcurl connection.</i>
      For global limiting, see limit_global below.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>limit_global [0]</b></dt>
  <dd class="It-tag">If set, this makes the specified rate limit apply overall.
      The libcurl backend does not have good support for this, so it is
      implemented by a simple division of the rate by the total number of
      downloads. There is no way for downloads, dynamically, to use bandwidth
      released by another idle/finished download. If you really want good global
      bandwidth control, don't use this option at all; use traffic shaping
      instead.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>log_dir [/var/log/apt-cacher]</b></dt>
  <dd class="It-tag">Directory to use for the access and error log files and
      traffic report. The access log records all successful package requests
      using a timestamp, whether the request was fulfilled from cache, the IP
      address of the requesting computer, the size of the package transferred,
      and the name of the package. The error log records major faults, and is
      also used for debug messages if the debug directive is set to 1. Debugging
      is toggled by sending SIGUSR1 (see SIGNALS below).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">This option was formerly named 'logdir', but was renamed
      for consistency. logdir is still recognised but should not be used for new
      installations.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>max_loadavg []</b></dt>
  <dd class="It-tag">If set this limits the maximum 1 minute loadavg permitted
      for apt-cacher to attempt to handle an client connection.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>offline_mode [0]</b></dt>
  <dd class="It-tag">Avoid making any outgoing connections, return files
      available in the cache or just return errors if they are missing.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>package_files_regexp [</b><i>see default
    /etc/apt-cacher/apt-cacher.conf</i><b>]</b></dt>
  <dd class="It-tag">Perl regular expression (refer to the perlre(1) manpage)
      which matches the URL filename of all package-type files (files that are
      uniquely identified, within their Distribution, by their filename).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>path_map []</b></dt>
  <dd class="It-tag">A mapping scheme to rewrite URLs, which converts the first
      part of the URL after the apt-cacher server name (the key) to a remote
      mirror. For example, if you set</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">path_map = debian ftp.debian.org/debian</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">retrieving</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">http://apt-cacher.server:3142/debian/dists/stable/Release</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">will actually fetch</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">http://apt-cacher.server:3142/ftp.debian.org/debian/dists/stable/Release</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">If distinct_namespaces is set, then you can use multiple
      mappings to cache different Distributions separately. For example</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">path_map = debian ftp.debian.org/debian; ubuntu
      archive.ubuntu.com/ubuntu</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">Multiple, space separated, mirrors can be given for each
      mapping. They will be tried in order in the event of
      failure/unavailability of the previous one. For example</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">path_map = debian ftp.uk.debian.org/debian
      ftp.debian.org/debian ;</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">All path_map keys need to be included in allowed_locations,
      if the latter is used. The shorthand '%PATH_MAP%' can be used to simplify
      this.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">There are 4 internal path_map settings for the Debian and
      Ubuntu changelog and AppStream servers which will be merged with the
      specified configuration:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">debian-changelogs packages.debian.org
      metadata.ftp-master.debian.org; ubuntu-changelogs changelogs.ubuntu.com;
      debian-appstream appstream.debian.org; ubuntu-appstream
      appstream.ubuntu.com;</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">These can be overridden by specifying an alternative mirror
      for that key, or deleted by just specifying the key with no mirror.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>pdiff_files_regexp [</b><i>see default
    /etc/apt-cacher/apt-cacher.conf</i><b>]</b></dt>
  <dd class="It-tag">Perl regular expression (perlre(1)) which matches APT pdiff
      files. These are ed(1) scripts which APT use to patch index files rather
      than redownloading the whole file afresh.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>return_buffer_size [1048576]</b></dt>
  <dd class="It-tag">The buffer size that is used for reads when returning a
      file using slower read/write loop. The default is 1MB. You may wish to
      adjust this to trade speed against memory consumption. By default files
      are returned using sendfile(2) which is much faster and does not make use
      of this setting.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>reverse_path_map [1]</b></dt>
  <dd class="It-tag">This setting enables a reverse map from the requested URL
      to the path_map key. It helps prevent having multiple copies of the same
      file cached under different file names.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>skip_checksum_files_regexp [</b><i>see default
    /etc/apt-cacher/apt-cacher.conf</i><b>]</b></dt>
  <dd class="It-tag">Perl regular expression (perlre(1)) which matches the URL
      filename for which checksum validation is not performed. Note that all
      files matched by installer_files_regexp are automatically skipped and do
      not need to be added here as well.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>soap_url_regexp [</b><i>see default
    /etc/apt-cacher/apt-cacher.conf</i><b>]</b></dt>
  <dd class="It-tag">Perl regular expression (perlre(1)) which matches URLs that
      are permitted as upstream source for apt-listbugs(1) requests.
    <div style="height: 1.00em;">&#x00A0;</div>
    apt-listbugs(1) makes requests to the Debian Bugs server via SOAP POST
      requests. These are not cached, but are simply passed through as a
      convenience.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>supported_archs [</b><i>see default
    /etc/apt-cacher/apt-cacher.conf</i><b>]</b></dt>
  <dd class="It-tag">A list of Architectures that is supported and you wish to
      allow in fetched filenames. &#x00B4;all&#x00B4; and &#x00B4;any&#x00B4;
      are automatically added to this list which is then used to expand
      %VALID_ARCHS% in *_files_regexp.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>use_proxy use_proxy_auth [obsolete]</b></dt>
  <dd class="It-tag">Use of external proxy and proxy authentication used to be
      turned on or off with these options. They are now ignored and an upstream
      proxy will always be used if configured.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>use_sendfile
    [</b><i>Sys::Syscall::sendfile_defined()</i><b>]</b></dt>
  <dd class="It-tag">By default, if sendfile(2) is available on the system, it
      is used to return files to client and is much more efficient than
      read/write. The default, which is determined by the value returned by
      Sys::Syscall::sendfile_defined() can be explicitly overridden.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>user [www-data]</b></dt>
  <dd class="It-tag">The effective user id to change to after allocating the
      ports.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Stand-alone_Daemon-mode_Options"><a class="selflink" href="#Stand-alone_Daemon-mode_Options">Stand-alone
  Daemon-mode Options</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>allowed_hosts []</b></dt>
  <dd class="It-tag">If your apt-cacher server is directly connected to the
      Internet and you are worried about unauthorised fetching of packages
      through it, you can specify a range of IP addresses that are allowed to
      use it. Localhost (127.0.0.1/8, ::1) is always allowed, other addresses
      must be matched by allowed_hosts and not by denied_hosts to be permitted
      to use the cache. This option can be a single item, list, IP address with
      netmask or IP range, resolvable hostname, or &#x00B4;*' to allow all
      access. See the default configuration file for further details and
      examples.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>allowed_hosts_6</b></dt>
  <dd class="It-tag">Deprecated option analogous to allowed_hosts, but for IPv6
      clients. allowed_hosts can now take IPv6 addresses directly.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>daemon_addr []</b></dt>
  <dd class="It-tag">The daemon can be restricted to listen only on particular
      local IP address(es). If unset, the daemon will listen on all available
      addresses. Single item or list of IPs. Use with care.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>daemon_port [3142]</b></dt>
  <dd class="It-tag">The TCP port to bind to.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>denied_hosts</b></dt>
  <dd class="It-tag">The opposite of allowed_hosts setting, excludes hosts from
      the list of allowed hosts. Not used in inetd daemon mode.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>denied_hosts_6</b></dt>
  <dd class="It-tag">Deprecated option analogous to denied_hosts, but for IPv6
      clients. denied_hosts can now take IPv6 addresses directly.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>request_empty_lines [5]</b></dt>
  <dd class="It-tag">The number of empty lines tolerated before an incoming
      connection is closed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>request_timeout [10]</b></dt>
  <dd class="It-tag">Maximum time in seconds that will be waited for a incoming
      request before closing the connection.</dd>
</dl>
<h1 class="Sh" title="Sh" id="CLIENT_CONFIGURATION"><a class="selflink" href="#CLIENT_CONFIGURATION">CLIENT
  CONFIGURATION</a></h1>
There are two different ways of configuring clients to use apt-cacher's cache.
  Ensure that you do not use a mixture of both methods. Changing both proxy
  settings and base URLs can create some confusion.
<dl class="Bl-tag">
  <dt class="It-tag"><b>Access cache like a mirror</b></dt>
  <dd class="It-tag">To use the cache in this way, edit /etc/apt/sources.list on
      each client and prepend the address of the apt-cacher server to each
      deb/src line. This mode is limited to using HTTP protocol for the upstream
      source.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">For example, if you have:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">deb http://ftp.debian.org stable main</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">change it to read either</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">deb http://apt-cacher.server[:port]/ftp.debian.org stable
      main [server in daemon mode]</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">or	</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">deb
      http://apt-cacher.server[:port]/apt-cacher/ftp.debian.org stable main
      [server in CGI mode]</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Access cache like a proxy</b></dt>
  <dd class="It-tag">For clients to use the cache in this way, set the
      apt-cacher server as a proxy on each client by setting the proxy URL in
      apt.conf. For example:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">Acquire::http::Proxy
      &quot;http://apt-cacher.server:port&quot;;</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">See apt.conf(5) for further details.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">It is not recommended to set the http_proxy environment
      variable as this may effect a wide variety of applications using a variety
      of URLs. Apt-cacher will not work as a general purpose web cache!</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">In this mode apt-cacher supports HTTP, FTP, HTTPS CONNECT,
      HTTPS GET and Debian Bugs SOAP proxying.</dd>
</dl>
<h1 class="Sh" title="Sh" id="FAQ"><a class="selflink" href="#FAQ">FAQ</a></h1>
<b>Q: Can I just copy some .debs into the cache dir and have it work?</b>
<div class="Pp"></div>
A: Almost! A bit additional work is also required to make them usable and
  persistent in the cache.
<div class="Pp"></div>
First: alongside with the .debs apt-cacher stores the HTTP headers that were
  sent from the server. If you copy .debs straight into the storage directory
  and don't add those things, fetching them *will* fail.
<div class="Pp"></div>
Fortunately Apt-cacher now comes with an import helper script to make things
  easier. Just put a bunch of .debs into /var/cache/apt-cacher/import (or a
  directory called 'import' inside whatever you've set your cache dir to be),
  and run /usr/share/apt-cacher/apt-cacher-import.pl (you can specify
  alternative source directory with the first parameter). The script will run
  through all the package files it finds in that dir and move them around to the
  correct locations plus create additional flag/header files. Run it with
  &quot;-h&quot; to get more information about how to use additional features --
  it can work in recursive mode while discovering the files and save space by
  making links to files located elsewhere in the filesystem.
<div class="Pp"></div>
Second: if the daily cleanup operation is enabled (see clean_cache option above)
  and there is no Packages.gz (or .bz2) file that refers to the new files, the
  package files will be removed really soon. From another point of view: if
  there are potential clients that would download these packages and the clients
  did run &quot;apt-get update&quot; using apt-cacher once, there is no reason
  to worry.
<div class="Pp"></div>
<b>Q: I have an invalid/corrupt file in the cache, how can I remove it?</b>
<div class="Pp"></div>
A: There are several possibilities for this:
<dl class="Bl-tag">
  <dt class="It-tag">1)</dt>
  <dd class="It-tag">In either daemon mode, apt-cacher tries to be a
      well-behaved cache and respects Cache-Control and Pragma headers.
      Refreshing a file can be forced by adding Cache-Control: no-cache to the
      request. The easiest way of doing this is with the --no-cache option of
      wget(1), for example:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">wget -O/dev/null --no-cache
      http://localhost:3142/debian/dists/stable/Release</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag">2)</dt>
  <dd class="It-tag">Enable checksumming which will validate cached files as
      they are fetched.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">3)</dt>
  <dd class="It-tag">Wait until after apt-cacher-cleanup.pl has run (which
      should remove invalid files).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">4)</dt>
  <dd class="It-tag">Manually delete the file from
      /var/cache/apt-cacher/packages.</dd>
</dl>
<div class="Pp"></div>
<b>Q: Does the daily generation of reports or cleaning the cache depend</b>
  <b>on whether apt-cacher is running continuously as a daemon?</b>
<div class="Pp"></div>
A: No, the regular maintenance jobs are independent of a running server. They
  are executed by cron(8) and use only static data like logs and cached index
  files and package directory listing. However, apt-cacher should be configured
  correctly because cleanup runs it directly (in inetd mode) to refresh the
  Packages/Sources files.
<div class="Pp"></div>
<b>Q: Are host names permissible in the configuration file?</b>
<div class="Pp"></div>
A: Since 1.7.0 DNS resolvable hostnames are permissible.
<div class="Pp"></div>
Unlike with some other software like Apache, the access control is slightly
  different because there is no configurable checking order. Instead, a client
  host is checked using both filters, allowed_hosts and denied_hosts. Following
  combinations are possible: allowed_hosts=* and denied_hosts is empty, then
  every host is allowed; allowed_hosts=&lt;ip data&gt; and denied_hosts=empty,
  then only defined hosts are permitted; allowed_hosts=* and denied_hosts=&lt;ip
  data&gt;, then every host is accepted except of those matched by denied_hosts;
  allowed_hosts=&lt;ip data&gt; and denied_hosts=&lt;ip data&gt;, then only the
  clients from allowed_hosts are accepted except of those matched by
  denied_hosts. allowed_hosts=&lt;empty&gt; blocks everything (except
  localhost). denied_hosts must not have an &quot;*&quot; value, use empty
  allowed_hosts setting if you want that.
<div class="Pp"></div>
<b>Q: generate_reports: how does being able to view the reports depend on</b>
  <b>the web server you are running? Are they only available if apt-cacher</b>
  is running on port 80?
<div class="Pp"></div>
The report is generated using a script (started by a cron job, see above) and is
  stored as $log_dir/report.html. You can access it using the
  &quot;/report&quot; path in the access URL. If apt-cacher is running in CGI
  mode, then the URL for the browser looks like
  <b>http://apt-cacher.server[:port]/apt-cacher/report/.</b>
<h1 class="Sh" title="Sh" id="LIMITATIONS"><a class="selflink" href="#LIMITATIONS">LIMITATIONS</a></h1>
Apt-cacher currently handles forwarding GET requests to HTTP, FTP and HTTPS
  sources. Support for other access methods (ssh, rsync) is not currently
  planned.
<h1 class="Sh" title="Sh" id="SIGNALS"><a class="selflink" href="#SIGNALS">SIGNALS</a></h1>
Apt-cacher handles the following signals:
<dl class="Bl-tag">
  <dt class="It-tag"><b>HUP</b></dt>
  <dd class="It-tag">Causes the configuration file to be re-read.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>USR1</b></dt>
  <dd class="It-tag">Toggles printing of debug output to
      /var/log/apt-cacher/error.log</dd>
</dl>
<h1 class="Sh" title="Sh" id="FILES"><a class="selflink" href="#FILES">FILES</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>/etc/apt-cacher/apt-cacher.conf</b></dt>
  <dd class="It-tag">main configuration file</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>/etc/apt-cacher/conf.d/</b></dt>
  <dd class="It-tag">configuration fragments directory</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>/var/cache/apt-cacher/</b></dt>
  <dd class="It-tag">cache/working directory</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>/var/log/apt-cacher</b></dt>
  <dd class="It-tag">log directory, rotated by logrotate(8) if available</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>/var/log/apt-cacher/report.html</b></dt>
  <dd class="It-tag">report page, generated by the helper script</dd>
</dl>
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Apt-cacher was originally written by Nick Andrews &lt;nick@zeta.org.au&gt;. This
  manual page was originally written by Jonathan Oxer &lt;jon@debian.org&gt;,
  for the Debian GNU/Linux system (but may be used by others). It was maintained
  by Eduard Bloch &lt;blade@debian.org&gt;, and it is now maintained by Mark
  Hindley &lt;mark@hindley.org.uk&gt;.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<table class="foot">
  <tr>
    <td class="foot-date"></td>
    <td class="foot-os"></td>
  </tr>
</table>
</body>
</html>
