<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>DIRVISH-EXPIRE(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">DIRVISH-EXPIRE(8)</td>
    <td class="head-vol">System Manager's Manual</td>
    <td class="head-rtitle">DIRVISH-EXPIRE(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
dirvish-expire - delete expired dirvish images
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>dirvish-expire</b><i>[OPTIONS]</i>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
Delete dirvish image trees or whole images that have expired.
<div style="height: 1.00em;">&#x00A0;</div>
Each image <b>summary</b> file is checked for the <b>Expire:</b> field. If that
  field indicates the image has expired <b>dirvish-expire</b> will delete that
  image from the vault.
<div style="height: 1.00em;">&#x00A0;</div>
By default all subdirectories of all banks will be treated as vaults and all
  directories therein except the one named <b>dirvish</b> will be checked for
  summary files.
<div style="height: 1.00em;">&#x00A0;</div>
The removal of an image will have no effect on other images.
<div style="height: 1.00em;">&#x00A0;</div>
<b>Dirvish-expire</b> will not delete an image unless it finds at least one
  image in that branch that has an intact image tree and <b>Status: success</b>
  in the summary that is not expired.
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
Each option on the command line may be specified any number of times. Those
  options that support lists in the config files will accumulate all of their
  arguments otherwise each specification will override the ones before.
<div style="height: 1.00em;">&#x00A0;</div>
Each option may be unambiguously abbreviated.
<dl class="Bl-tag">
  <dt class="It-tag"><b>--time</b><i> time_expression</i></dt>
  <dd class="It-tag">Execute as though <i>time_expression</i> were the current
      time.
    <div style="height: 1.00em;">&#x00A0;</div>
    <i>Time_expression</i> is processed by <b>Time::Parsedate(3pm)</b> so
      relative time and date strings are permitted. See
      <b>Time::Parsedate(3pm)</b> for more details.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--tree</b></dt>
  <dd class="It-tag">Only delete the image tree, leave in place the rest of the
      image directory with summary, log and any other image administrative
      files.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--vault</b><i> vault</i></dt>
  <dd class="It-tag">Restrict expiration to the specified <i>vault</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--no-run</b></dt>
  <dd class="It-tag">Don't actually do anything. Just display what would have
      happened.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--quiet</b></dt>
  <dd class="It-tag">Run quietly, only report errors.
    <div style="height: 1.00em;">&#x00A0;</div>
    Normally <b>dirvish-expire</b> will report the images deleted.</dd>
</dl>
<h1 class="Sh" title="Sh" id="EXIT_CODES"><a class="selflink" href="#EXIT_CODES">EXIT
  CODES</a></h1>
To facilitate further automation and integration of <b>dirvish-expire</b> with
  other tools <b>dirvish-expire</b> provides rationalised exit codes. The exit
  codes are range based. While the code for a specific error may change from one
  version to another it will remain within the specified range. So don't test
  for specific exit codes but instead test for a range of values. To the degree
  possible higher value ranges indicate more severe errors.
<dl class="Bl-tag">
  <dt class="It-tag">0</dt>
  <dd class="It-tag">success</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">200-219</dt>
  <dd class="It-tag">An error was encountered in loading a configuration
    file.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">220-254</dt>
  <dd class="It-tag">An error was detected in the configuration.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">255</dt>
  <dd class="It-tag">Incorrect usage.</dd>
</dl>
<h1 class="Sh" title="Sh" id="FILES"><a class="selflink" href="#FILES">FILES</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>/etc/dirvish/master.conf</b></dt>
  <dd class="It-tag">alternate master configuration file.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>/etc/dirvish.conf</b></dt>
  <dd class="It-tag">master configuration file.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>bank/vault/image/</i><b>summary</b></dt>
  <dd class="It-tag">image creation summary.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>bank/vault/image/</i><b>tree</b></dt>
  <dd class="It-tag">actual image of source directory tree.</dd>
</dl>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<pre>
dirvish.conf(5)
Time::ParseDate(3pm)
</pre>
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
<b>Dirvish-expire</b> will walk the file hierarchy of all banks or the specified
  vault looking for summary files. Anything non-dirvish in there may cause
  excess file-walking.</div>
<table class="foot">
  <tr>
    <td class="foot-date"></td>
    <td class="foot-os"></td>
  </tr>
</table>
</body>
</html>
