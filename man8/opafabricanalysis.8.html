<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>opafabricanalysis(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">opafabricanalysis(8)</td>
    <td class="head-vol">Master map: IFSFFCLIRG (Man Page)</td>
    <td class="head-rtitle">opafabricanalysis(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
opafabricanalysis
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>(All)</b> Performs analysis of the fabric.
<h1 class="Sh" title="Sh" id="Syntax"><a class="selflink" href="#Syntax">Syntax</a></h1>
opafabricanalysis [-b|-e] [-s] [-d <i>dir</i>] [-c <i>file</i>] [-t
  <i>portsfile</i>] [-p <i>ports</i>] [-T <i>topology_input</i>]
<h1 class="Sh" title="Sh" id="Options"><a class="selflink" href="#Options">Options</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag">-- help</dt>
  <dd class="It-tag">Produce full help text.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-b</dt>
  <dd class="It-tag">Baseline mode, default is compare/check mode.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-e</dt>
  <dd class="It-tag">Evaluate health only, default is compare/check mode.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-s</dt>
  <dd class="It-tag">Save history of failures (errors/differences).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-d dir</dt>
  <dd class="It-tag">Top-level directory for saving baseline and history of
      failed checks. Default = /var/lib/opa-ff/analysis</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-c file</dt>
  <dd class="It-tag">Error thresholds config file. Default =
      /etc/sysconfig/opa/opamon.conf</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-t portsfile</dt>
  <dd class="It-tag">File with list of local HFI ports used to access fabric(s)
      for analysis. Default = /etc/sysconfig/opa/ports</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-p ports</dt>
  <dd class="It-tag">List of local HFI ports used to access fabric(s) for
      analysis. Default is the first active port. Specified as HFI:port as
      follows:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
0:0 First active port in system</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
0: <i>y</i> Port <i>y</i> within system</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <i>x</i>:0 First active port on HFI <i>x</i></div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <i>x</i>: <i>y</i> HFI <i>x</i>, port <i>y</i></div>
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">-T <i>topology_input</i></dt>
  <dd class="It-tag">Name of topology input file to use. Any %P markers in this
      filename are replaced with the HFI:port being operated on (such as 0:0 or
      1:2). Default = /etc/sysconfig/opa/topology.%P.xml. If -T NONE is
      specified, no topology input file is used. See <i>opareport</i> for more
      information.</dd>
</dl>
<h1 class="Sh" title="Sh" id="Example"><a class="selflink" href="#Example">Example</a></h1>
opafabricanalysis
<div>&#x00A0;</div>
opafabricanalysis -p '1:1 1:2 2:1 2:2'
<div class="Pp"></div>
The fabric analysis tool checks the following:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Fabric links (both internal to switch chassis and external
      cables)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Fabric components (nodes, links, SMs, systems, and their
      SMA configuration)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Fabric PMA error counters and link speed mismatches</dd>
</dl>
<div class="Pp"></div>
<b>NOTE:</b> The comparison includes components on the fabric. Therefore,
  operations such as shutting down a server cause the server to no longer appear
  on the fabric and are flagged as a fabric change or failure by
  opafabricanalysis.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="Environment_Variables"><a class="selflink" href="#Environment_Variables">Environment
  Variables</a></h1>
The following environment variables are also used by this command:
<dl class="Bl-tag">
  <dt class="It-tag"><b>PORTS</b></dt>
  <dd class="It-tag">List of ports, used in absence of -t and -p.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>PORTS_FILE</b></dt>
  <dd class="It-tag">File containing list of ports, used in absence of -t and
      -p.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>FF_TOPOLOGY_FILE</b></dt>
  <dd class="It-tag">File containing topology_input (may have %P marker in
      filename), used in absence of -T.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>FF_ANALYSIS_DIR</b></dt>
  <dd class="It-tag">Top level directory for baselines and failed health
    checks.</dd>
</dl>
<h1 class="Sh" title="Sh" id="Details"><a class="selflink" href="#Details">Details</a></h1>
For simple fabrics, the Intel(R) Omni-Path Fabric Suite FastFabric Toolset host
  is connected to a single fabric. By default, the first active port on the
  FastFabric Toolset host is used to analyze the fabric. However, in more
  complex fabrics, the FastFabric Toolset host may be connected to more than one
  fabric or subnet. In this case, you can specify the ports or HFIs to use with
  one of the following methods:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">On the command line using the -p option.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">In a file specified using the -t option.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Through the environment variables <b>PORTS</b> or
      <b>PORTS_FILE</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Using the <b>PORTS_FILE</b> configuration option in
      opafastfabric.conf.</dd>
</dl>
<div class="Pp"></div>
If the specified port does not exist or is empty, the first active port on the
  local system is used. In more complex configurations, you must specify the
  exact ports to use for all fabrics to be analyzed. For more information, refer
  to.
<div class="Pp"></div>
You can specify the topology_input file to be used with one of the following
  methods:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">On the command line using the -T option.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">In a file specified through the environment variable
      <b>FF_TOPOLOGY_FILE</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Using the ff_topology_file configuration option in
      opafastfabric.conf.</dd>
</dl>
<div class="Pp"></div>
If the specified file does not exist, no topology_input file is used.
  Alternately the filename can be specified as NONE to prevent use of an input
  file.
<div class="Pp"></div>
For more information, refer to <i>opareport</i>
<div class="Pp"></div>
By default, the error analysis includes PMA counters and slow links (that is,
  links running below enabled speeds). You can change this using the
  <b>FF_FABRIC_HEALTH</b> configuration parameter in opafastfabric.conf. This
  parameter specifies the opareport options and reports to be used for the
  health analysis. It also can specify the PMA counter clearing behavior (-I
  <i>seconds</i>, -C, or none at all). See <i>Appendix#8217#160;A</i> in the
  <i>Intel(R) Omni-Path Fabric Suite FastFabric User Guide</i>
<div style="height: 1.00em;">&#x00A0;</div>
for more information.
<div class="Pp"></div>
When a topology_input file is used, it can also be useful to extend
  <b>FF_FABRIC_HEALTH</b> to include fabric topology verification options such
  as -o verifylinks.
<div class="Pp"></div>
The thresholds for PMA counter analysis default to
  /etc/sysconfig/opa/opamon.conf. However, you can specify an alternate
  configuration file for thresholds using the -c option. The opamon.si.conf file
  can also be used to check for any non-zero values for signal integrity (SI)
  counters.
<div class="Pp"></div>
All files generated by opafabricanalysis start with fabric in their file name.
  This is followed by the port selection option identifying the port used for
  the analysis. Default is 0:0.
<div class="Pp"></div>
The opafabricanalysis tool generates files such as the following within
  FF_ANALYSIS_DIR :
<div class="Pp"></div>
<b>Health Check</b>
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">latest/fabric.0:0.errors stdout of opareport for errors
      encountered during fabric error analysis.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">latest/fabric.0.0.errors.stderr stderr of opareport during
      fabric error analysis.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
<b>Baseline</b>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
During a baseline run, the following files are also created in
  FF_ANALYSIS_DIR/latest.
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">baseline/fabric.0:0.snapshot.xml opareport snapshot of
      complete fabric components and SMA configuration.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">baseline/fabric.0:0.comps opareport summary of fabric
      components and basic SMA configuration.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">baseline/fabric.0.0.links opareport summary of internal and
      external links.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
<b>Full Analysis</b>
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">latest/fabric.0:0.snapshot.xml opareport snapshot of
      complete fabric components and SMA configuration.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">latest/fabric.0:0.snapshot.stderr stderr of opareport
      during snapshot.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">latest/fabric.0:0.errors stdout of opareport for errors
      encountered during fabric error analysis.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">latest/fabric.0.0.errors.stderr stderr of opareport during
      fabric error analysis.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">latest/fabric.0:0.comps stdout of opareport for fabric
      components and SMA configuration.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">latest/fabric.0:0.comps.stderr stderr of opareport for
      fabric components.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">latest/fabric.0:0.comps.diff diff of baseline and latest
      fabric components.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">latest/fabric.0:0.links stdout of opareport summary of
      internal and external links.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">latest/fabric.0:0.links.stderr stderr of opareport summary
      of internal and external links.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">latest/fabric.0:0.links.diff diff of baseline and latest
      fabric internal and external links.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">latest/fabric.0:0.links.changes.stderr stderr of opareport
      comparison of links.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">latest/fabric.0:0.links.changes opareport comparison of
      links against baseline. This is typically easier to read than the
      links.diff file and contains the same information.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">latest/fabric.0:0.comps.changes.stderr stderr of opareport
      comparison of components.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">latest/fabric.0:0.comps.changes opareport comparison of
      components against baseline. This is typically easier to read than the
      comps.diff file and contains the same information.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
The .diff and .changes files are only created if differences are detected.
<div class="Pp"></div>
If the -s option is used and failures are detected, files related to the checks
  that failed are also copied to the time-stamped directory name under
  FF_ANALYSIS_DIR.
<h1 class="Sh" title="Sh" id="Fabric_Items_Checked_Against_the_Baseline"><a class="selflink" href="#Fabric_Items_Checked_Against_the_Baseline">Fabric
  Items Checked Against the Baseline</a></h1>
Based on opareport -o links :
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Unconnected/down/missing cables</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Added/moved cables</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Changes in link width and speed</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Changes to Node GUIDs in fabric (replacement of HFI or
      Switch hardware)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Adding/Removing Nodes [FI, Virtual FIs, Virtual Switches,
      Physical Switches, Physical Switch internal switching cards
    (leaf/spine)]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Changes to server or switch names</dd>
</dl>
<div class="Pp"></div>
Based on opareport -o comps :
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Overlap with items from links report</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Changes in port MTU, LMC, number of VLs</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Changes in port speed/width enabled or supported</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Changes in HFI or switch device IDs/revisions/VendorID (for
      example, ASIC HW changes)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Changes in port Capability mask (which features/agents run
      on port/server)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Changes to ErrorLimits and PKey enforcement per port</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Changes to IOUs/IOCs/IOC Services provided
    <div style="height: 1.00em;">&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
Location (port, node) and number of SMs in fabric. Includes:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Primary and backups</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Configured priority for SM</dd>
</dl>
<h1 class="Sh" title="Sh" id="Fabric_Items_Also_Checked_During_Health_Check"><a class="selflink" href="#Fabric_Items_Also_Checked_During_Health_Check">Fabric
  Items Also Checked During Health Check</a></h1>
Based on opareport -s -C -o errors -o slowlinks :
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">PMA error counters on all Intel(R) Omni-Path Fabric ports
      (HFI, switch external and switch internal) checked against configurable
      thresholds.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Counters are cleared each time a health check is run. Each
      health check reflects a counter delta since last health check.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Typically identifies potential fabric errors, such as
      symbol errors.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">May also identify transient congestion, depending on the
      counters that are monitored.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Link active speed/width as compared to Enabled speed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Identifies links whose active speed/width is #8217lt; min
      (enabled speed/width on each side of link).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">This typically reflects bad cables or bad ports or poor
      connections.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Side effect is the verification of SA health.</dd>
</dl>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">Intel Corporation</td>
    <td class="foot-os">Copyright(C) 2015-2016</td>
  </tr>
</table>
</body>
</html>
