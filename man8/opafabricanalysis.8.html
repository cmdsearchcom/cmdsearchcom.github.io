<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 19:14:03 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p style="margin-top: 1em">opafabricanalysis(8) Master map:
IFSFFCLIRG (Man Page) opafabricanalysis(8)</p>

<p style="margin-top: 1em">NAME <br>
opafabricanalysis</p>

<p style="margin-top: 1em">(All) Performs analysis of the
fabric.</p>

<p style="margin-top: 1em">Syntax <br>
opafabricanalysis [-b|-e] [-s] [-d dir] [-c file] [-t
portsfile] [-p ports] [-T topology_input]</p>

<p style="margin-top: 1em">Options <br>
-- help Produce full help text.</p>

<p style="margin-top: 1em">-b Baseline mode, default is
compare/check mode.</p>

<p style="margin-top: 1em">-e Evaluate health only, default
is compare/check mode.</p>

<p style="margin-top: 1em">-s Save history of failures
(errors/differences).</p>

<p style="margin-top: 1em">-d dir Top-level directory for
saving baseline and history of failed checks. Default =
/var/lib/opa-ff/analysis</p>

<p style="margin-top: 1em">-c file Error thresholds config
file. Default = /etc/sysconfig/opa/opamon.conf</p>

<p style="margin-top: 1em">-t portsfile <br>
File with list of local HFI ports used to access fabric(s)
for analysis. Default = /etc/sysconfig/opa/ports</p>

<p style="margin-top: 1em">-p ports List of local HFI ports
used to access fabric(s) for analysis. Default is the first
active port. Specified as HFI:port as follows:</p>

<p style="margin-top: 1em">0:0 First active port in
system</p>

<p style="margin-top: 1em">0: y Port y within system</p>

<p style="margin-top: 1em">x:0 First active port on HFI
x</p>

<p style="margin-top: 1em">x: y HFI x, port y</p>

<p style="margin-top: 1em">-T topology_input <br>
Name of topology input file to use. Any %P markers in this
filename are replaced with the HFI:port being operated on
(such as 0:0 or 1:2). Default = /etc/syscon&acirc; <br>
fig/opa/topology.%P.xml. If -T NONE is specified, no
topology input file is used. See opareport for more
information.</p>

<p style="margin-top: 1em">Example <br>
opafabricanalysis <br>
opafabricanalysis -p &rsquo;1:1 1:2 2:1 2:2&rsquo;</p>

<p style="margin-top: 1em">The fabric analysis tool checks
the following:</p>

<p style="margin-top: 1em">&Acirc;&middot; Fabric links
(both internal to switch chassis and external cables)</p>

<p style="margin-top: 1em">&Acirc;&middot; Fabric
components (nodes, links, SMs, systems, and their SMA
configuration)</p>

<p style="margin-top: 1em">&Acirc;&middot; Fabric PMA error
counters and link speed mismatches</p>

<p style="margin-top: 1em">NOTE: The comparison includes
components on the fabric. Therefore, operations such as
shutting down a server cause the server to no longer appear
on the fabric and are flagged as <br>
a fabric change or failure by opafabricanalysis.</p>

<p style="margin-top: 1em">Environment Variables <br>
The following environment variables are also used by this
command:</p>

<p style="margin-top: 1em">PORTS List of ports, used in
absence of -t and -p.</p>

<p style="margin-top: 1em">PORTS_FILE <br>
File containing list of ports, used in absence of -t and
-p.</p>

<p style="margin-top: 1em">FF_TOPOLOGY_FILE <br>
File containing topology_input (may have %P marker in
filename), used in absence of -T.</p>

<p style="margin-top: 1em">FF_ANALYSIS_DIR <br>
Top level directory for baselines and failed health
checks.</p>

<p style="margin-top: 1em">Details <br>
For simple fabrics, the Intel(R) Omni-Path Fabric Suite
FastFabric Toolset host is connected to a single fabric. By
default, the first active port on the FastFabric Toolset
host <br>
is used to analyze the fabric. However, in more complex
fabrics, the FastFabric Toolset host may be connected to
more than one fabric or subnet. In this case, you can
specify the <br>
ports or HFIs to use with one of the following methods:</p>

<p style="margin-top: 1em">&Acirc;&middot; On the command
line using the -p option.</p>

<p style="margin-top: 1em">&Acirc;&middot; In a file
specified using the -t option.</p>

<p style="margin-top: 1em">&Acirc;&middot; Through the
environment variables PORTS or PORTS_FILE.</p>

<p style="margin-top: 1em">&Acirc;&middot; Using the
PORTS_FILE configuration option in opafastfabric.conf.</p>

<p style="margin-top: 1em">If the specified port does not
exist or is empty, the first active port on the local system
is used. In more complex configurations, you must specify
the exact ports to use for <br>
all fabrics to be analyzed. For more information, refer
to.</p>

<p style="margin-top: 1em">You can specify the
topology_input file to be used with one of the following
methods:</p>

<p style="margin-top: 1em">&Acirc;&middot; On the command
line using the -T option.</p>

<p style="margin-top: 1em">&Acirc;&middot; In a file
specified through the environment variable
FF_TOPOLOGY_FILE.</p>

<p style="margin-top: 1em">&Acirc;&middot; Using the
ff_topology_file configuration option in
opafastfabric.conf.</p>

<p style="margin-top: 1em">If the specified file does not
exist, no topology_input file is used. Alternately the
filename can be specified as NONE to prevent use of an input
file.</p>

<p style="margin-top: 1em">For more information, refer to
opareport</p>

<p style="margin-top: 1em">By default, the error analysis
includes PMA counters and slow links (that is, links running
below enabled speeds). You can change this using the
FF_FABRIC_HEALTH configuration <br>
parameter in opafastfabric.conf. This parameter specifies
the opareport options and reports to be used for the health
analysis. It also can specify the PMA counter clearing <br>
behavior (-I seconds, -C, or none at all). See
Appendix#8217#160;A in the Intel(R) Omni-Path Fabric Suite
FastFabric User Guide</p>

<p style="margin-top: 1em">for more information.</p>

<p style="margin-top: 1em">When a topology_input file is
used, it can also be useful to extend FF_FABRIC_HEALTH to
include fabric topology verification options such as -o
verifylinks.</p>

<p style="margin-top: 1em">The thresholds for PMA counter
analysis default to /etc/sysconfig/opa/opamon.conf. However,
you can specify an alternate configuration file for
thresholds using the -c option. <br>
The opamon.si.conf file can also be used to check for any
non-zero values for signal integrity (SI) counters.</p>

<p style="margin-top: 1em">All files generated by
opafabricanalysis start with fabric in their file name. This
is followed by the port selection option identifying the
port used for the analysis. Default <br>
is 0:0.</p>

<p style="margin-top: 1em">The opafabricanalysis tool
generates files such as the following within FF_ANALYSIS_DIR
:</p>

<p style="margin-top: 1em">Health Check</p>

<p style="margin-top: 1em">&Acirc;&middot;
latest/fabric.0:0.errors stdout of opareport for errors
encountered during fabric error analysis.</p>

<p style="margin-top: 1em">&Acirc;&middot;
latest/fabric.0.0.errors.stderr stderr of opareport during
fabric error analysis.</p>

<p style="margin-top: 1em">Baseline</p>

<p style="margin-top: 1em">During a baseline run, the
following files are also created in
FF_ANALYSIS_DIR/latest.</p>

<p style="margin-top: 1em">&Acirc;&middot;
baseline/fabric.0:0.snapshot.xml opareport snapshot of
complete fabric components and SMA configuration.</p>

<p style="margin-top: 1em">&Acirc;&middot;
baseline/fabric.0:0.comps opareport summary of fabric
components and basic SMA configuration.</p>

<p style="margin-top: 1em">&Acirc;&middot;
baseline/fabric.0.0.links opareport summary of internal and
external links.</p>

<p style="margin-top: 1em">Full Analysis</p>

<p style="margin-top: 1em">&Acirc;&middot;
latest/fabric.0:0.snapshot.xml opareport snapshot of
complete fabric components and SMA configuration.</p>

<p style="margin-top: 1em">&Acirc;&middot;
latest/fabric.0:0.snapshot.stderr stderr of opareport during
snapshot.</p>

<p style="margin-top: 1em">&Acirc;&middot;
latest/fabric.0:0.errors stdout of opareport for errors
encountered during fabric error analysis.</p>

<p style="margin-top: 1em">&Acirc;&middot;
latest/fabric.0.0.errors.stderr stderr of opareport during
fabric error analysis.</p>

<p style="margin-top: 1em">&Acirc;&middot;
latest/fabric.0:0.comps stdout of opareport for fabric
components and SMA configuration.</p>

<p style="margin-top: 1em">&Acirc;&middot;
latest/fabric.0:0.comps.stderr stderr of opareport for
fabric components.</p>

<p style="margin-top: 1em">&Acirc;&middot;
latest/fabric.0:0.comps.diff diff of baseline and latest
fabric components.</p>

<p style="margin-top: 1em">&Acirc;&middot;
latest/fabric.0:0.links stdout of opareport summary of
internal and external links.</p>

<p style="margin-top: 1em">&Acirc;&middot;
latest/fabric.0:0.links.stderr stderr of opareport summary
of internal and external links.</p>

<p style="margin-top: 1em">&Acirc;&middot;
latest/fabric.0:0.links.diff diff of baseline and latest
fabric internal and external links.</p>

<p style="margin-top: 1em">&Acirc;&middot;
latest/fabric.0:0.links.changes.stderr stderr of opareport
comparison of links.</p>

<p style="margin-top: 1em">&Acirc;&middot;
latest/fabric.0:0.links.changes opareport comparison of
links against baseline. This is typically easier to read
than the links.diff file and contains the same
informa&acirc; <br>
tion.</p>

<p style="margin-top: 1em">&Acirc;&middot;
latest/fabric.0:0.comps.changes.stderr stderr of opareport
comparison of components.</p>

<p style="margin-top: 1em">&Acirc;&middot;
latest/fabric.0:0.comps.changes opareport comparison of
components against baseline. This is typically easier to
read than the comps.diff file and contains the same
infor&acirc; <br>
mation.</p>

<p style="margin-top: 1em">The .diff and .changes files are
only created if differences are detected.</p>

<p style="margin-top: 1em">If the -s option is used and
failures are detected, files related to the checks that
failed are also copied to the time-stamped directory name
under FF_ANALYSIS_DIR.</p>

<p style="margin-top: 1em">Fabric Items Checked Against the
Baseline <br>
Based on opareport -o links :</p>

<p style="margin-top: 1em">&Acirc;&middot;
Unconnected/down/missing cables</p>

<p style="margin-top: 1em">&Acirc;&middot; Added/moved
cables</p>

<p style="margin-top: 1em">&Acirc;&middot; Changes in link
width and speed</p>

<p style="margin-top: 1em">&Acirc;&middot; Changes to Node
GUIDs in fabric (replacement of HFI or Switch hardware)</p>

<p style="margin-top: 1em">&Acirc;&middot; Adding/Removing
Nodes [FI, Virtual FIs, Virtual Switches, Physical Switches,
Physical Switch internal switching cards (leaf/spine)]</p>

<p style="margin-top: 1em">&Acirc;&middot; Changes to
server or switch names</p>

<p style="margin-top: 1em">Based on opareport -o comps
:</p>

<p style="margin-top: 1em">&Acirc;&middot; Overlap with
items from links report</p>

<p style="margin-top: 1em">&Acirc;&middot; Changes in port
MTU, LMC, number of VLs</p>

<p style="margin-top: 1em">&Acirc;&middot; Changes in port
speed/width enabled or supported</p>

<p style="margin-top: 1em">&Acirc;&middot; Changes in HFI
or switch device IDs/revisions/VendorID (for example, ASIC
HW changes)</p>

<p style="margin-top: 1em">&Acirc;&middot; Changes in port
Capability mask (which features/agents run on
port/server)</p>

<p style="margin-top: 1em">&Acirc;&middot; Changes to
ErrorLimits and PKey enforcement per port</p>

<p style="margin-top: 1em">&Acirc;&middot; Changes to
IOUs/IOCs/IOC Services provided</p>

<p style="margin-top: 1em">Location (port, node) and number
of SMs in fabric. Includes:</p>

<p style="margin-top: 1em">&Acirc;&middot; Primary and
backups</p>

<p style="margin-top: 1em">&Acirc;&middot; Configured
priority for SM</p>

<p style="margin-top: 1em">Fabric Items Also Checked During
Health Check <br>
Based on opareport -s -C -o errors -o slowlinks :</p>

<p style="margin-top: 1em">&Acirc;&middot; PMA error
counters on all Intel(R) Omni-Path Fabric ports (HFI, switch
external and switch internal) checked against configurable
thresholds.</p>

<p style="margin-top: 1em">&Acirc;&middot; Counters are
cleared each time a health check is run. Each health check
reflects a counter delta since last health check.</p>

<p style="margin-top: 1em">&Acirc;&middot; Typically
identifies potential fabric errors, such as symbol
errors.</p>

<p style="margin-top: 1em">&Acirc;&middot; May also
identify transient congestion, depending on the counters
that are monitored.</p>

<p style="margin-top: 1em">&Acirc;&middot; Link active
speed/width as compared to Enabled speed.</p>

<p style="margin-top: 1em">&Acirc;&middot; Identifies links
whose active speed/width is #8217lt; min (enabled
speed/width on each side of link).</p>

<p style="margin-top: 1em">&Acirc;&middot; This typically
reflects bad cables or bad ports or poor connections.</p>

<p style="margin-top: 1em">&Acirc;&middot; Side effect is
the verification of SA health.</p>

<p style="margin-top: 1em">Copyright(C) 2015-2016 Intel
Corporation opafabricanalysis(8)</p>
<hr>
</body>
</html>
