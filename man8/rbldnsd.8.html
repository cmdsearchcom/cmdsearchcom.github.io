<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 19:15:08 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>rbldnsd(8) System Manager&rsquo;s Manual rbldnsd(8)</p>

<p style="margin-top: 1em">NAME <br>
rbldnsd - DNS daemon suitable for running DNS-based
blocklists</p>

<p style="margin-top: 1em">SYNOPSIS <br>
rbldnsd options zone:dataset...</p>

<p style="margin-top: 1em">DESCRIPTION <br>
rbldnsd is a small DNS-protocol daemon which is designed to
handle queries to DNS-based IP-listing or NAME-listing
services. Such services are a simple way to share/publish a
<br>
list of IP addresses or (domain) names which are
&quot;listed&quot; for for some reason, for example in order
to be able to refuse a service to a client which is
&quot;listed&quot; in some block&acirc; <br>
list.</p>

<p style="margin-top: 1em">rbldnsd is not a general-purpose
nameserver. It will answer to A and TXT (and SOA and NS if
such RRs are specified) queries, and has limited ability to
answer to some other <br>
types of queries.</p>

<p style="margin-top: 1em">rbldnsd tries to handle data
from two different perspectives: given a set (or several) of
&quot;listed entries&quot; (e.g. IP address ranges or domain
names), it builds and serves a DNS <br>
zone. Note the two are not the same: list of spammer&rsquo;s
IPs is NOT a DNS zone, but may be represented and used as
such, provided that some additional information necessary to
<br>
build complete DNS zone (e.g. NS and SOA records, maybe A
records necessary for http to work) is available. In this
context, rbldnsd is very different from other
general-purpose <br>
nameservers such as BIND or NSD: rbldnsd operates with
datasets (sets of entries - IP addresses or domain names,
logically grouped together), while other general-purpose
name&acirc; <br>
servers operates with zones. The way how rbldnsd operates
may be somewhat confusing to BIND experts.</p>

<p style="margin-top: 1em">For rbldnsd, a building block is
a dataset: e.g., set of insecure/abuseable hosts (IP
addresses), set of network ranges that belongs to various
spam operations (IP ranges), <br>
domain names that belong to spammers (RHSBL) and so on.
Usually, different kind of information is placed into
separate file, for easy maintenance. From a number of such
<br>
datasets, rbldnsd constructs a number of DNS zones as
specified on command line. A single dataset may be used for
several zones, and a single zone may be constructed from
sev&acirc; <br>
eral datasets.</p>

<p style="margin-top: 1em">rbldnsd will answer queries to
DNS zones specified on the command line as a set of zone
specifications. Each zone specification consists of zone
basename, dataset type and a <br>
comma-separated list of files that forms a given dataset:
zone:type:file,file,...</p>

<p style="margin-top: 1em">Several zones may be specified
in command line, so that rbldnsd will answer queries to any
of them. Also, a single zone may be specified several times
with different datasets, <br>
so it is possible to form a zone from a combination of
several different dataset. The same dataset may be reused
for several zones too (and in this case, it will be read
into <br>
memory only once).</p>

<p style="margin-top: 1em">There are several dataset
formats available, each is suitable and optimized (in terms
of memory, speed and ease of use) for a specific task.
Available dataset types may be <br>
grouped into the following categories:</p>

<p style="margin-top: 1em">lists of IP addresses. When a
query is done to a zone with such data, query is interpreted
as an IP address in a reverse form (similar to in-addr.arpa
zone). If the <br>
address is found in dataset data, rbldnsd will return A and
TXT records specified in data for that IP. This is a
classical IP-based blocklist.</p>

<p style="margin-top: 1em">lists of domain names. Similar
to list of IP addresses, but with generic domain names
instead of IPs (wildcards allowed). This type of data may be
used to form a block&acirc; <br>
list of e.g. sender domain names.</p>

<p style="margin-top: 1em">generic list of various types of
records, as an auxilary data to form a complete nameserver.
This format is similar to bind-style datafiles, but very
simplified. One may <br>
specify A, TXT, NS and MX records here.</p>

<p style="margin-top: 1em">combined set, different datasets
from the list above combined in the single (set of) source
files, for easy maintenance.</p>

<p style="margin-top: 1em">acl, or Access Control List.
This is a pseudo dataset, that works by overweriting query
results based on the requestor (peer) IP address.</p>

<p style="margin-top: 1em">OPTIONS <br>
The following options may be specified:</p>

<p style="margin-top: 1em">-u user[:group] <br>
rbldnsd will change its userid to the specified user, which
defaults to rbldns, and group, which by default is the
primary group of a user. rbldnsd will refuse to run as <br>
the root user, since this is insecure.</p>

<p style="margin-top: 1em">-r rootdir <br>
rbldnsd will chroot to rootdir if specified. Data files
should be available inside rootdir.</p>

<p style="margin-top: 1em">-w workdir <br>
rbldnsd will change its working directory to workdir (after
chrooting to rootdir if -r option is also specified). May be
used to shorten filename paths.</p>

<p style="margin-top: 1em">-b address/port <br>
This option is required. rbldnsd will bind to specified
address and port (port defaults to port 53, domain). Either
numeric IP address or a hostname may be specified, <br>
and either port number or service name is accepted. It is
possible to specify several addresses to listen on this way,
by repeating -b option. Additionally, if there are <br>
several addresses listed for a hostname, rbldnsd will listen
on all of them. Note that rbldnsd will work slightly faster
if only one listening address is specified. Note <br>
the delimiter between host and port is a slash (/), not a
colon, to be able to correctly handle IPv6 addresses.</p>

<p style="margin-top: 1em">-4 Use IPv4 listening
socket/transport, do not attempt to use IPv6 (ignored if
rbldnsd was built without IPv6 support).</p>

<p style="margin-top: 1em">-6 Use IPv6 listening
socket/transport, do not attempt to use IPv4 (this option
will be reported as error if IPv6 support was not compiled
in).</p>

<p style="margin-top: 1em">-t defttl:minttl:maxttl <br>
Set default reply time-to-live (TTL) value to be defttl, and
set constraints for TTL to minttl and maxttl. Default
applies when there&rsquo;s no TTL defined in a given scope
<br>
(in data file), and constraints are applied when such value
provided in data. Any of the values may be omitted,
including trailing colon (:) characters, e.g. &quot;-t
30&quot; set <br>
default TTL to be 30 secound, and &quot;-t ::120&quot; or
&quot;-t ::2m&quot; sets maximum allowed TTL to 2 minutes.
All 3 values are in time units, with optional suffix: s
(secounds, <br>
default), m (minutes), h (hours), d (days) or w (weeks).
Zero minttl or maxttl means no corresponding constraint will
be enforced. Default defttl is 35m.</p>

<p style="margin-top: 1em">-c check <br>
Set interval between checking for zone file changes to be
check, default is 1m (one minute). rbldnsd will check zone
file&rsquo;s last modification time every so often, and if
<br>
it detects a change, zone will be automatically reloaded.
Setting this value to 0 disables automatic zone change
detection. This procedure may also be triggered by
send&acirc; <br>
ing a SIGHUP signal to rbldnsd (see SIGNALS section
below).</p>

<p style="margin-top: 1em">-e Allow non-network addresses
to be used in CIDR ranges. Normally, rbldnsd rejects
addresses such as 127.2.3.4/24, where prefix is not within
the network mask derived from <br>
bit number (in this case, correct form is 127.2.3.0/24, note
the trailing zero in prefix). This is done in order to catch
possible typos in zones (rbldnsd will warn about <br>
a problem and will ignore such entry). This option disables
checking whether the CIDR prefix fits within the network
mask.</p>

<p style="margin-top: 1em">-q Quick and quiet start.
Normally, rbldnsd does socket initialization and zone load
in foreground, writing progress and statistic to standard
output, and aborts in case of <br>
any errors. With this flag, nothing will be printed and
first zone load will be done in background (unless -n option
is also given), and zone load errors will be <br>
non-fatal.</p>

<p style="margin-top: 1em">-p pidfile <br>
Write rbldnsd&rsquo;s pid to the specified pidfile, so it
will be easily findable. This file gets written before
entering a chroot jail (if specified) and before changing
<br>
userid, so it&rsquo;s ok to specify e.g.
/var/run/rbldnsd.pid here.</p>

<p style="margin-top: 1em">-l logfile <br>
Specifies a file to which log all requests made. This file
is created after entering a chroot jail and becoming a user.
Logfiles may be quite large, esp. on busy sites <br>
(rbldnsd will log every recognized request if this option is
specified). This option is mainly intended for debugging
purposes. Upon receiption of SIGHUP signal, rbldnsd <br>
reopens its logfile. If logfile prefixed with a plus sign
(+), logging will not be buffered (i.e. each line will be
flushed to disk); by default, logging is buffered to <br>
reduce system load. Specify a single hyphen (-) as a
filename to log to standard output (filedescriptor 1),
either buffered by default, or line-buffered if specified as
<br>
&lsquo;+-&rsquo; (standard output will not be
&quot;reopened&quot; upon receiving SIGHUP signal, but will
be flushed in case logging is buffered).</p>

<p style="margin-top: 1em">-s statsfile <br>
Specifies a file where rbldnsd will write a line with short
statistic summary of queries made per zone, every check (-c)
interval. Format of each line is: <br>
timestamp zone:qtot:qok:qnxd:bin:bout zone:... <br>
where timestamp is unix time (secounds since epoch), zone is
the name of the base zone, qtot is the total number of
queries received, qok - number of positive replies, <br>
qnxd - number of NXDOMAIN replies, bin is the total number
of bytes read from network (excluding IP/UDP overhead and
dropped packets), bout is the total number of bytes <br>
written to network. Ther are as many such tuples as there
are zones, and one extra, total typle at the end, with zone
being &quot;*&quot;, like: <br>
1234 bl1.ex:10:5:4:311:432 bl2.ex:24:13:7:248:375
*:98:35:12:820:987 <br>
Note the total values may be larger than the sum of per-zone
values, due to queries made against unlisted zones, or
bad/broken packets.</p>

<p style="margin-top: 1em">Rbldnsd will write bare
timestamp to statsfile when it is starting up, shutting down
or when statistic counters are being reset after receiving
SIGUSR2 signal (see below), <br>
to indicate the points where the counters are starting back
from zero.</p>

<p style="margin-top: 1em">By default, rbldnsd writes
absolute counter values into statsfile (number of packets
(bytes) since startup or last reset). statsfile may be
prefixed with plus sign (+), <br>
in which case rbldnsd will write delta values, that is,
number of packets or bytes since last write, or number of
packets (bytes) per unit of time (&quot;incremental&quot;
mode, <br>
hence the &quot;+&quot; sign).</p>

<p style="margin-top: 1em">-n Do not become a daemon.
Normally, rbldnsd will fork and go to the background after
successful initialization. This option disables this
behaviour.</p>

<p style="margin-top: 1em">-f Request rbldnsd to continue
processing requests during data reloads. Rbldnsd forks a
child process to handle requests while parent reloads the
data. This ensures smooth <br>
operations, but requires more memory, since two copies of
data is keept in memory during reload process.</p>

<p style="margin-top: 1em">-d Dump all zones to stdout in
BIND format and exit. This may be suitable to convert easily
editable rbldnsd-style data into BIND zone. rbldnsd dumps
all zones as one <br>
stream, so one may want to specify only one zone with -d.
Zone file will have appropriate $ORIGIN tags. Note that data
generated may be really huge (as BIND format isn&rsquo;t
<br>
appropriate for this sort of things), and some entries may
not be really the same in BIND as in rbldnsd (e.g., IP
netblocks of large size will be represented as wildcard <br>
entries - 10.0.0.0/8 will become *.10; excluded entries will
be represented by a CNAME to &lsquo;excluded&rsquo; name, so
such name should not be present in a data set). In this <br>
mode, rbldnsd ignores -r (root directory) option.</p>

<p style="margin-top: 1em">-v Do not show exact version
information in response to version.bind CH TXT queries (by
default rbldnsd responds to such queries since version
0.98). With single -v, rbldnsd <br>
will only return &quot;rbldnsd&quot; to the caller, without
the version number. Second -v disables providing any
information in response to such requests, i.e. rbldnsd will
return <br>
REFUSE code.</p>

<p style="margin-top: 1em">-C Disable automatic on-the-fly
uncompression of data files if this feature is compiled in
(see below).</p>

<p style="margin-top: 1em">-A</p>

<p style="margin-top: 1em">-a Controls &quot;laziness&quot;
of rbldnsd when constructing replies. With -a specified,
rbldnsd does not add AUTH section (containing NS records) to
replies unless explicitly asked <br>
for NS records. It is equivalent to BIND9
&quot;minimal-answers&quot; configuration setting. While
with -A specified, rbldnsd will always fill in AUTH section,
increasing size of <br>
replies dramatically but allowing (caching) resolver clients
to react faster to changes in nameserver lists. Currently
(as of 0.998 version), non-lazy (as with -A) mode <br>
is the default, but it will change in future release.</p>

<p style="margin-top: 1em">-x extension <br>
Load the given extension file (a dynamically-linked library,
usually with &quot;.so&quot; suffix). This allows to gather
custom statistics or perform other custom tasks. See
sepa&acirc; <br>
rate document for details about building and using
extensions. This feature is not available on all platforms,
and can be disabled at compile time.</p>

<p style="margin-top: 1em">-X extarg <br>
Pass the given argument, extarg, to the extension loaded
with -x.</p>

<p style="margin-top: 1em">DATASET TYPES AND FORMATS <br>
Dataset files are text files which are interpreted depending
on type specified in command line. Empty lines and lines
starting with hash character (#) or semicolon (;) are <br>
ignored, except for a special case outlined below in section
titled &quot;Special Entries&quot;.</p>

<p style="margin-top: 1em">A (comma-separated) list of
files in dataset specification (in type:file,file,...) is
interpreted as if all files where logically combined into
one single file.</p>

<p style="margin-top: 1em">When compiled with zlib support,
rbldnsd is able to read gzip-compressed data files. So,
every file in dataset specification can be compressed with
gzip(1), and rbldnsd will <br>
read such a file decompressing it on-the-fly. This feature
may be turned off by specifying -C option.</p>

<p style="margin-top: 1em">rbldnsd is designed to service a
DNSBL, where each entry have single A record and optional
TXT record assotiated with it. rbldnsd allows to specify A
value and TXT template <br>
either for each entry individually, or to use default A
value and TXT template pair for a group of entries. See
section &quot;Resulting A values and TXT templates&quot;
below for a way to <br>
specify them.</p>

<p style="margin-top: 1em">Special Entries <br>
If a line starts with a dollar sign ($), hash character and
a dollar sign (#$), semicolon and dollar sign (;#) or colon
and a dollar sign (:$), it is interpreted in a special <br>
way, regardless of dataset type (this is one exception where
a line starting with hash character is not ignored - to be
able to use zone files for both rbldnsd and for DJB&rsquo;s
<br>
rbldns). The following keywords, following a dollar sign,
are recognized:</p>

<p style="margin-top: 1em">$SOA ttl origindn persondn
serial refresh retry expire minttl <br>
Specifies SOA (Start Of Authority) record for all zones
using this dataset. Only first SOA record is interpreted.
This is the only way to specify SOA - by default, <br>
rbldnsd will not add any SOA record into answers, and will
REFUSE to answer to certain queries (notably, SOA query to
zone&rsquo;s base domain name). It is recommended, but not
<br>
mandatory to specify SOA record for every zone. If no SOA is
given, negative replies will not be cacheable by caching
nameservers. Only one, first $SOA line is recog&acirc; <br>
nized in every dataset (all subsequent $SOA lines
encountered in the same dataset are silently ignored). When
constructing a zone, SOA will be taken from first dataset
<br>
where $SOA line is found, in an order as specified in
command line, subsequent $SOA lines, if any, are ignored.
This way, one may overwrite $SOA found in 3rd party data
<br>
by prepending small local file to the dataset in question,
listing it before any other files.</p>

<p style="margin-top: 1em">If serial value specified is
zero, timestamp of most recent modified file will be
substituted as serial.</p>

<p style="margin-top: 1em">If ttl field is zero, default
ttl (-t option or last $TTL value, see below) will be
used.</p>

<p style="margin-top: 1em">All time fields (ttl, refresh,
retry, expire, minttl) may be specified in time units. See
-t option for details.</p>

<p style="margin-top: 1em">$NS ttl nameserverdn
nameserverdn... <br>
Specifies NS (Name Server) records for all zones using this
dataset. Only first $NS line in a dataset is recognized, all
subsequent lines are silently ignored. When con&acirc; <br>
structing a zone from several datasets, rbldnsd uses
nameservers from $NS line in only first dataset where $NS
line is given, in command-line order, just like for $SOA
<br>
record. Only first 32 namservers are recognized. Individual
nameserver(s) may be prefixed with a minus sign (-), which
means this single nameserver will be ignored by <br>
rbldnsd. This is useful to temporary comment out one
nameserver entry without removing it from the list. If ttl
is zero, default ttl will be used. The list of NS <br>
records, just like $SOA value, are taken from the first data
file in a dataset where the $NS line is found, subsequent
$NS lines, if any, are ignored.</p>

<p style="margin-top: 1em">$TTL time-to-live <br>
Specifies TTL (time-to-live) value for all records in
current dataset. See also -t option. $TTL special overrides
-t value on a per-dataset basis.</p>

<p style="margin-top: 1em">$TIMESTAMP dstamp [expires] <br>
(experimental) Specifies the data timestamp dstamp when the
data has been generated, and optionally when it will expire.
The timestamps are in form <br>
yyyy:mm:dd[:hh[:mi[:ss]]], where yyyy is the year like 2005,
mm is the month number (01..12), dd is the month day number
(01..31), hh is hour (00..23), mi and ss are min&acirc; <br>
utes and secounds (00.59); hours, minutes and secounds are
optional and defaults to 0; the delimiters (either colon or
dash may be used) are optional too, but are allowed <br>
for readability. Also, single zero (0) or dash (-) may be
used as dstamp and/or expires, indicating the value is not
given. expires may also be specified as +rel, where <br>
rel is a time specification (probably with suffix like s, m,
h, d) as an offset to dstamp. rbldnsd compares dstamp with
current timestamp and refuses to load the file if <br>
dstamp specifies time in the future. And if expires is
specified, rbldnsd will refuse to service requests for that
data if current time is greather than the value speci&acirc;
<br>
fied in expires field.</p>

<p style="margin-top: 1em">Note that rbldnsd will check the
data expiry time every time it checks for data file updates
(when receiving SIGHUP signal or every -c interval). If
automatic data reload <br>
timer (-c option) is disabled, zones will not be exipired
automatically.</p>

<p style="margin-top: 1em">$MAXRANGE4 range-size <br>
Specifies maximum size of IPv4 range allowed for IPv4-based
datasets. If an entry covers more IP addresses than
range-size, it will be ignored (and a warning will be <br>
logged). range-size may be specified as a number of hosts,
like 256, or as network prefix lenght, like /24 (the two are
the same): <br>
$MAXRANGE4 /24 <br>
$MAXRANGE4 256 <br>
This constraint is active for a dataset it is specified in,
and can be owerwritten (by subsequent $MAXRANGE statement)
by a smaller value, but can not be increased.</p>

<p style="margin-top: 1em">$n text <br>
(n is a single digit). Specifies a substitution variable for
use as $n placeholders (the $n entries are ignored in
generic daaset). See section &quot;Resulting A values and
<br>
TXT templates&quot; below for description and usage
examples.</p>

<p style="margin-top: 1em">$= text <br>
Set the base template for all individual TXT records. See
section &quot;Resulting A values and TXT templates&quot;
below for more information.</p>

<p style="margin-top: 1em">ip4set Dataset <br>
A set of IP addresses or CIDR address ranges, together with
A and TXT resulting values. IP addresses are specified one
per line, by an IP address prefix (initial octets),
com&acirc; <br>
plete IP address, CIDR range, or IP prefix range (two IP
prefixes or complete addresses delimited by a dash,
inclusive). Examples, to specify 127.0.0.0/24: <br>
127.0.0.0/24 <br>
127.0.0 <br>
127/24 <br>
127-127.0.0 <br>
127.0.0.0-127.0.0.255 <br>
127.0.0.1-255 <br>
to specify 127.16.0.0-127.31.255.255: <br>
127.16.0.0-127.31.255.255 <br>
127.16.0-127.31.255 <br>
127.16-127.31 <br>
127.16-31 <br>
127.16.0.0/12 <br>
127.16.0/12 <br>
127.16/12 <br>
Note that in prefix range, last boundary is completed with
all-ones (255), not all-zeros line with first boundary and a
prefix alone. In prefix ranges, if last boundary is only
<br>
one octet (127.16-31), it is treated as &quot;suffix&quot;,
as value of last specified octet of the first boundary
prefix (127.16.0-31 is treated as 127.16.0.0-127.16.31.255,
i.e. <br>
127.16.0.0/19).</p>

<p style="margin-top: 1em">After an IP address range, A and
TXT values for a given entry may be specified. If none
given, default values in current scope (see below) applies.
If a value starts with a <br>
colon, it is interpreted as a pair of A record and TXT
template, delimited by colon (:127.0.0.2:This entry is
listed). If a value does not start with a colon, it is
interpreted <br>
as TXT template only, with A record defaulting to the
default A value in current scope.</p>

<p style="margin-top: 1em">IP address range may be followed
by a comment char (either hash character (#) or semicolon
(;)), e.g.: <br>
127/8 ; loopback network <br>
In this case all characters up to the end of line are
ignored, and default A and TXT values will be used for this
IP range.</p>

<p style="margin-top: 1em">Every IP address that fits
within any of specified ranges is &quot;listed&quot;, and
rbldnsd will respond to reverse queries against it within
specified zone with positive results. In <br>
contrast, if an entry starts with an exclamation sign (!),
this is an exclusion entry, i.e. corresponding address range
is excluded from being listed (and any value for this <br>
record is ignored). This may be used to specify large range
except some individual addresses, in a compact form.</p>

<p style="margin-top: 1em">If a line starts with a colon
(:), this line specifies the default A value and TXT
template to return (see below) for all subsequent entries up
to end of current file. If no <br>
default entry specified, and no value specified for a given
record, rbldnsd will return 127.0.0.2 for matching A queries
and no record for matching TXT queries. If TXT record <br>
template is specified and contains occurences of of dollar
sign ($), every such occurence is replaced with an IP
address in question, so singe TXT template may be used to
e.g. <br>
refer to a webpage for an additional information for a
specific IP address.</p>

<p style="margin-top: 1em">ip4trie Dataset <br>
Set of IP4 CIDR ranges with corresponding (A, TXT) values.
This dataset is similar to ip4set, but uses a different
internal representation. It accepts CIDR ranges only (not
<br>
a.b.c.d-e.f.g.h), and allows for the specification of A/TXT
values on a per CIDR range basis. (If multiple CIDR ranges
match a query, the value for longest matching prefix is <br>
returned.) Exclusions are supported too.</p>

<p style="margin-top: 1em">This dataset is not particularly
memory-efficient for storing many single IP addresses
&acirc; it uses about 50% more memory than the ip4set
dataset in that case. The ip4trie dataset <br>
is better adapted, however, for listing CIDR ranges (whose
lengths are not a multiple of 8 bits.)</p>

<p style="margin-top: 1em">ip4tset Dataset <br>
&quot;trivial&quot; ip4set: a set of single IP addresses
(one per line), with the same A+TXT template. This dataset
type is more efficient than ip4set (in both memory usage and
access <br>
times), but have obvious limitation. It is intended for
DNSBLs like DSBL.org, ORDB.org and similar, where each entry
uses the same default A+TXT template. This dataset uses <br>
only half a memory for the same list of IP addresses
compared to ip4set.</p>

<p style="margin-top: 1em">ip6trie Dataset <br>
Set of IP6 CIDR ranges. This is the IP6 equivalent of the
ip4trie dataset. It allows the sepecification of individual
A/TXT values for each CIDR range and supports exclusions.
<br>
Compressed (&quot;::&quot;) ip6 notation is supported.</p>

<p style="margin-top: 1em">Example zone data: <br>
# Default A and TXT template valuse <br>
:127.0.1.2: Listed, see http://example.com/lookup?$</p>

<p style="margin-top: 1em"># A listing, note that trailing
:0s can be omitted <br>
2001:21ab:c000/36</p>

<p style="margin-top: 1em"># /64 range with non-default A
and TXT values <br>
2001:21ab:def7:4242 :127.0.1.3: This one smells funny</p>

<p style="margin-top: 1em"># compressed notation <br>
2605:6001:42::/52 <br>
::1 # localhost <br>
!2605:6001:42::bead # exclusion</p>

<p style="margin-top: 1em">ip6tset Dataset <br>
&quot;Trivial&quot; ip6 dataset: a set of /64 IP6 CIDR
ranges (one per line), all sharing a single A+TXT template.
Exclusions of single IP6 (/128) addresses are also
supported. This <br>
dataset type is quite memory-efficient &acirc; it uses about
40% of the memory that the ip6trie dataset would use &acirc;
but has obvious limitations.</p>

<p style="margin-top: 1em">This dataset wants the /64s
listed as four ip6 words, for example: <br>
2001:20fe:23:41ed <br>
abac:adab:ad00:42f <br>
Exclusions are denoted with a leading exclamation mark. You
may also use compressed &quot;::&quot; notation for excluded
addresses. E.g.: <br>
!abac:adab:ad00:42f:face:0f:a:beef <br>
!abac:adab:ad00:42f::2</p>

<p style="margin-top: 1em">dnset Dataset <br>
Set of (possible wildcarded) domain names with associated A
and TXT values. Similar to ip4set, but instead of IP
addresses, data consists of domain names (not in reverse
form). <br>
One domain name per line, possible starting with wildcard
(either with star-dot (*.) or just a dot). Entry starting
with exclamation sign is exclusion. Default value for all
<br>
subsequent lines may be specified by a line starting with a
colon.</p>

<p style="margin-top: 1em">Wildcards are interpreted as
follows:</p>

<p style="margin-top: 1em">example.com <br>
only example.com domain is listed, not subdomains thereof.
Not a wildcard entry.</p>

<p style="margin-top: 1em">*.example.com <br>
all subdomains of example.com are listed, but not
example.com itself.</p>

<p style="margin-top: 1em">.example.com <br>
all subdomains of example.com and example.com itself are
listed. This is a shortcut: to list a domain name itself and
all it&rsquo;s subdomains, one may either specify two <br>
lines (example.com and *.example.com), or one line
(.example.com).</p>

<p style="margin-top: 1em">This dataset type may be used
instead of ip4set, provided all CIDR ranges are expanded and
reversed (but in this case, TXT template will be expanded
differently).</p>

<p style="margin-top: 1em">generic Dataset <br>
Generic type, simplified bind-style format. Every record
should be on one line (line continuations are not
supported), and should be specified completely (i.e. all
domain names <br>
in values should be fully-qualified, entry name may not be
omitted). No wildcards are accepted. Only A, TXT, and MX
records are recognized. TTL value may be specified before
<br>
record type. Examples:</p>

<p style="margin-top: 1em"># bl.ex.com <br>
# specify some values for current zone <br>
$NS 0 ns1.ex.com ns2.ex.com <br>
# record with TTL <br>
www 3000 A 127.0.0.1 <br>
about TXT &quot;ex.com combined blocklist&quot;</p>

<p style="margin-top: 1em">combined Dataset <br>
This is a special dataset that stores no data by itself but
acts like a container for several other datasets of any type
except of combined type itself. The data file contains <br>
an optional common section, where various specials are
recognized like $NS, $SOA, $TTL (see above), and a series of
sections, each of which defines one (nested) dataset and
sev&acirc; <br>
eral subzones of the base zone, for which this dataset
should be consulted. New (nested) dataset starts with a line
<br>
$DATASET type[:name] subzone subzone... <br>
and all subsequent lines up to the end of current file or to
next $DATASET line are interpreted as a part of dataset of
type type, with optional name (name is used for logging <br>
purposes only, and the whole &quot;:name&quot; (without
quotes or square brackets) part is optional). Note that
combined datasets cannot be nested. Every subzone will
always be relative <br>
to the base zone name specified on command line. If subzone
specified as single character &quot;@&quot;, dataset will be
connected to the base zone itself.</p>

<p style="margin-top: 1em">This dataset type aims to
simplify subzone maintenance, in order to be able to include
several subzones in one file for easy data transfer, atomic
operations and to be able to <br>
modify list of subzones on remote secondary nameservers.</p>

<p style="margin-top: 1em">Example of a complete dataset
that contains subzone &lsquo;proxies&rsquo; with a list of
open proxies, subzone &lsquo;relays&rsquo; with a list of
open relays, subzone &lsquo;multihop&rsquo; with output IPs
of mul&acirc; <br>
tihop open relays, and the base zone itself includes proxies
and relays but not multihops: <br>
# common section <br>
$NS 1w ns1.ex.com ns2.ex.com <br>
$SOA 1w ns1.ex.com admin.ex.com 0 2h 2h 1w 1h <br>
# list of open proxies, <br>
# in &lsquo;proxies&rsquo; subzone and in base zone <br>
$DATASET ip4set:proxy proxies @ <br>
:2:Open proxy, see http://bl.ex.com/proxy/$ <br>
127.0.0.2 <br>
127.0.0.10 <br>
# list of open relays, <br>
# in &lsquo;relays&rsquo; subzone and in base zone <br>
$DATASET ip4set:relay relays @ <br>
:3:Open relay, see http://bl.ex.com/relay/$ <br>
127.0.0.2 <br>
127.0.2.10 <br>
# list of optputs of multistage relays, <br>
# in &lsquo;multihop&rsquo; subzone only <br>
$DATASET ip4set:multihop-relay multihop <br>
:4:Multihop open relay, see http://bl.ex.com/relay/$ <br>
127.0.0.2 <br>
127.0.9.12 <br>
# for the base zone and all subzones, <br>
# include several additional records <br>
$DATASET generic:common proxies relays multihop @ <br>
@ A 127.0.0.8 <br>
www A 127.0.0.8 <br>
@ MX 10 mx.ex.com <br>
# the above results in having the following records <br>
# (provided that the base zone specified is bl.ex.com): <br>
# proxies.bl.ex.com A 127.0.0.8 <br>
# www.proxies.bl.ex.com 127.0.0.8 <br>
# relays.bl.ex.com A 127.0.0.8 <br>
# www.relays.bl.ex.com 127.0.0.8 <br>
# multihop.bl.ex.com A 127.0.0.8 <br>
# www.multihop.bl.ex.com 127.0.0.8 <br>
# bl.ex.com A 127.0.0.8 <br>
# www.bl.ex.com 127.0.0.8</p>

<p style="margin-top: 1em">Note that $NS and $SOA values
applies to the base zone only, regardless of the placement
in the file. Unlike the $TTL values and $n substitutions,
which may be both global and <br>
local for a given (sub-)dataset.</p>

<p style="margin-top: 1em">Resulting A values and TXT
templates <br>
In all zone file types except generic, A values and TXT
templates are specified as following: <br>
:127.0.0.2:Blacklisted: http://example.com/bl?$ <br>
If a line starts with a colon, it specifies default A and
TXT for all subsequent entries in this dataset. Similar
format is used to specify values for individual records,
with <br>
the A value (enclosed by colons) being optional: <br>
127.0.0.2 :127.0.0.2:Blacklisted: http://example.com/bl?$
<br>
or, without specific A value: <br>
127.0.0.2 Blacklisted: http://example.com/bl?$</p>

<p style="margin-top: 1em">Two parts of a line, delimited
by second colon, specifies A and TXT record values. Both are
optional. By default (either if no default line specified,
or no IP address within <br>
that line), rbldnsd will return 127.0.0.2 as A record.
127.0.0 prefix for A value may be omitted, so the above
example may be simplified to: <br>
:2:Blacklisted: http://example.com/bl?$ <br>
There is no default TXT value, so rbldnsd will not return
anything for TXT queries it TXT isn&rsquo;t specified.</p>

<p style="margin-top: 1em">When A value is specified for a
given entry, but TXT template is omitted, there may be two
cases interpreted differently, namely, whenever
there&rsquo;s a second semicolon (:) after <br>
the A value. If there&rsquo;s no second semicolon, default
TXT value for this scope will be used. In contrast, when
second semicolon is present, no TXT template will be
generated at <br>
all. All possible cases are outlined in the following
example:</p>

<p style="margin-top: 1em"># default A value and TXT
template <br>
:127.0.0.2:IP address $ is listed <br>
# 127.0.0.4 will use default A and TXT <br>
127.0.0.4 <br>
# 127.0.0.5 will use specific A and default TXT <br>
127.0.0.5 :5 <br>
# 127.0.0.6 will use specific a and no TXT <br>
127.0.0.6 :6: <br>
# 127.0.0.7 will use default A and specific TXT <br>
127.0.0.7 IP address $ running an open relay</p>

<p style="margin-top: 1em">In a TXT template, references to
substitution variables are replaced with values of that
variables. In particular, single dollar sign ($) is replaced
by a listed entry (an IP <br>
address in question for IP-based datasets and the domain
name for domain-based datasets). $n-style constructs, where
n is a single digit, are replaced by a substitution variable
<br>
$n defined for this dataset in current scope (see section
&quot;Special Entries&quot; above). To specify a dollar sign
as-is, use $$.</p>

<p style="margin-top: 1em">For example, the following
lines: <br>
$1 See http://www.example.com/bl <br>
$2 for details <br>
127.0.0.2 $1/spammer/$ $2 <br>
127.0.0.3 $1/relay/$ $2 <br>
127.0.0.4 This spammer wants some $$$$. $1/$ <br>
will result in the following text to be generated: <br>
See http://www.example.com/bl/spammer/127.0.0.2 for details
<br>
See http://www.example.com/bl/relay/127.0.0.3 for details
<br>
This spammer wants some $$. See
http://www.example.com/bl/127.0.0.4</p>

<p style="margin-top: 1em">If the &quot;base template&quot;
($= variable) is defined, this template is used for
expansion, instead of the one specified for an entry being
queried. Inside the base template, $= con&acirc; <br>
struct is substituted with the text given for individual
entries. In order to stop usage of base template $= for a
single record, start it with = (which will be omitted from
the <br>
resulting TXT value). For example, <br>
$0 See http://www.example.com/bl?$= ($) for details <br>
127.0.0.2 r123 <br>
127.0.0.3 <br>
127.0.0.4 =See other blocklists for details about $ <br>
produces the following TXT records: <br>
See http://www.example.com/bl?r123 (127.0.0.2) for details
<br>
See http://www.example.com/bl?127.0.0.3 (127.0.0.3) for
details <br>
See other blocklists for details about 127.0.0.4</p>

<p style="margin-top: 1em">acl Dataset <br>
This is not a real dataset, while the syntax and usage is
the same as with other datasets. Instead of defining which
records exists in a given zone and which do not, the acl
<br>
dataset specifies which client hosts (peers) are allowed to
query the given zone. The dataset specifies a set of IPv4
and/or IPv6 CIDR ranges (with the syntax exactly the same
<br>
as understood by the ip4trie and ip6trie datasets), together
with action specifiers. When a query is made from an IP
address listed (not for the IP address), the specified <br>
action changes rules used to construct the reply. Possible
actions and their meanings are:</p>

<p style="margin-top: 1em">:ignore <br>
ignore all queries from this IP address altogether. rbldnsd
acts like there was no query received at all. This is the
default action.</p>

<p style="margin-top: 1em">:refuse <br>
refuse all queries from the IP in question. rbldnsd will
always return REFUSED DNS response code.</p>

<p style="margin-top: 1em">:empty pretend there&rsquo;s no
data in all other datasets for the given zone. This means
that all the clients in question will always receive reply
from rbldnsd telling that the <br>
requested IP address or domain name is not listed in a given
DNSBL. rbldnsd still replies to metadata queries (SOA and NS
records, and to all queries satisfied by generic <br>
dataset if specified for the given zone) as usual.</p>

<p style="margin-top: 1em">:pass process the request as
usual. This may be used to add a &quot;whitelisting&quot;
entry for a network/host bloked by another (larger) ACL
entry.</p>

<p style="margin-top: 1em">a_txt_template <br>
usual A+TXT template as used by other datasets. This means
that rbldnsd will reply to any valid DNSBL query with
&quot;it is listed&quot; answer, so that the client in
question <br>
will see every IP address or domain name is listed in a
given DNSBL. TXT record used in the reply is taken from the
acl dataset instead of real datasets. Again, just <br>
like with empty case, rbldnsd will continue replying to
metadata queries (including generic datasets if any) as
usual.</p>

<p style="margin-top: 1em">Only one ACL dataset can be
specified for a given zone, and each zone must have at least
one non-acl dataset. It is also possible to specify one
global ACL dataset, by specify&acirc; <br>
ing empty zone name (which is not allowed for other dataset
types), like <br>
rbldnsd ... :acl:filename... <br>
In this case the ACL defined in filename applies to all
zones. If there are both global ACL and local zone-specific
ACL specified, both will be consulted and actions taken in
<br>
the order specified above, ie, if either ACL returns ignore
for this IP, the request will be ignored, else if either ACL
returns refuse, the query will be refused, and so on. If
<br>
both ACLs specifies &quot;always listed&quot; A+TXT
template, the reply will contain A+TXT from global ACL.</p>

<p style="margin-top: 1em">For this dataset type, only a
few $-style specials are recognized. In particular, $SOA and
$NS keywords are not allowed. When rbldnsd performs $
substitution in the TXT tem&acirc; <br>
plate returned from ACL dataset, it will use client IP
address to substitute for a single $ character, instead of
the IP address or domain name found in the original
query.</p>

<p style="margin-top: 1em">SIGNALS <br>
Rbldnsd handles the following signals:</p>

<p style="margin-top: 1em">SIGHUP recheck zone files and
reload any outdated ones. This is done automatically if
enabled, see -c option. Additionally, rbldnsd will reopen
logfile upon receiving SIGHUP, <br>
if specified (-l option).</p>

<p style="margin-top: 1em">SIGTERM, SIGINT <br>
Terminate process.</p>

<p style="margin-top: 1em">SIGUSR1 <br>
Log current statistic counters into syslog. Rbldnsd collects
how many packets it handled, how many bytes was received,
sent, how many OK requests/replies (and how many <br>
answer records) was received/sent, how many NXDOMAIN answers
was sent, and how many errors/refusals/etc was sent, in a
period of time.</p>

<p style="margin-top: 1em">SIGUSR2 <br>
The same as SIGUSR1, but reset all counters and start new
sample period.</p>

<p style="margin-top: 1em">NOTES <br>
Some unsorted usage notes follows.</p>

<p style="margin-top: 1em">Generating and transferring data
files <br>
When creating a data file for rbldnsd (and for anything
else, it is a general advise), it is a good idea to create
the data in temporary file and rename the temp file when all
is <br>
done. Never try to write to the main file directly, it is
possible that at the same time, rbldnsd will try to read it
and will get incomplete data as the result. The same <br>
applies to copying data using cp(1) utility and similar
(including scp(1)), that performs copying over existing
data. Even if you&rsquo;re sure noone is reading the data
while you&rsquo;re <br>
copying or generating it, imagine what will happen if you
will not be able to complete the process for whatever reason
(interrupt, filesystem full, endless number of other
rea&acirc; <br>
sons...). In most cases is better to keep older but correct
data instead of leaving incomplete/corrupt data in
place.</p>

<p style="margin-top: 1em">Right: <br>
scp remote:data target.tmp &amp;&amp; mv target.tmp target
<br>
Wrong: <br>
scp remote:data target <br>
Right: <br>
./generate.pl &gt; target.tmp &amp;&amp; mv target.tmp
target <br>
Wrong: <br>
./generate.pl &gt; target</p>

<p style="margin-top: 1em">From this point of view,
rsync(1) command seems to be safe, as it always creates
temporary file and renames it to the destination only when
all is ok (but note the --partial <br>
option, which is good for downloading something but may be
wrong to transfer data files -- usually you don&rsquo;t want
partial files to be loaded). In contrast, scp(1) command is
not <br>
safe, as it performs direct copying. You may still use
scp(1) in a safe manner, as shown in the example above.</p>

<p style="margin-top: 1em">Also try to eliminate a case
when two (or more) processes performs data
copying/generation at the same time to the same destination.
When your data is generated by a cron job, <br>
use file locking (create separate lock file (which should
never be removed) and flock/fcntl it in exclusive mode
without waiting, exiting if lock fails) before attempting to
do <br>
other file manipulation.</p>

<p style="margin-top: 1em">Absolute vs relative domain
names <br>
All keys specified in dataset files are always relative to
the zone base DN. In contrast, all the values (NS and SOA
records, MX records in generic dataset) are absolute. This
<br>
is different from BIND behaviour, where trailing dot
indicates whenever this is an absolute or relative DN.
Trailing dots in domain names are ignored by rbldnsd.</p>

<p style="margin-top: 1em">Aggregating datasets <br>
Several zones may be served by rbldnsd, every zone may
consist of several datasets. There are numerous ways to
combine several data files into several zones. For example,
sup&acirc; <br>
pose you have a list of dialup ranges in file named
&lsquo;dialups&rsquo;, and a list of spammer&rsquo;s ip
addresses in file named &lsquo;spammers&rsquo;, and want to
serve 3 zones with rbldnsd: <br>
dialups.bl.ex.com, spam.bl.ex.com and bl.ex.com which is a
combination of the two. There are two ways to do this:</p>

<p style="margin-top: 1em">rbldnsd options...
dialups.bl.ex.com:ip4set:dialups
spam.bl.ex.com:ip4set:spammers
bl.ex.com:ip4set:dialups,spammers</p>

<p style="margin-top: 1em">or:</p>

<p style="margin-top: 1em">rbldnsd options...
dialups.bl.ex.com:ip4set:dialups
spam.bl.ex.com:ip4set:spammers bl.ex.com:ip4set:dialups
bl.ex.com:ip4set:spammers</p>

<p style="margin-top: 1em">(note you should specify
combined bl.ex.com zone after all its subzones in a command
line, or else subzones will not be consulted at all).</p>

<p style="margin-top: 1em">In the first form, there will be
3 independent data sets, and every record will be stored 2
times in memory, but only one search in internal data
structures will be needed to <br>
resolve queries for aggregate bl.ex.com. In second form,
there will be only 2 data sets, every record will be stored
only once (both datasets will be reused), but 2 searches
<br>
will be performed by rbldnsd to answer queries against
aggregate zone (but difference in speed is almost
unnoticeable). Note that when aggregating several data files
into one <br>
dataset, an exclusion entry in one file becomes exclusion
entry in the whole dataset (which may be a problem when
aggregating dialups, where exclusions are common, with open
<br>
relays/proxies, where exclusions are rare if at all
used).</p>

<p style="margin-top: 1em">Similar effect may be achieved
by using combined dataset type, sometimes more easily.
combined dataset results in every nested dataset to be used
independantly, like in second <br>
form above.</p>

<p style="margin-top: 1em">combined dataset requires
rbldnsd to be the authoritative nameserver for the whole
base zone. Most important, one may specify SOA and NS
records for the base zone only. So, <br>
some DNSBLs which does not use a common subzone for the
data, cannot use this dataset. An example being DSBL.org
DNSBL, where each of list.dsbl.org, multihop.dsbl.org and
uncon&acirc; <br>
firmed.dsbl.org zones are separate, independant zones with
different set of nameservers. But for DSBL.org, where each
dataset is really independant and used only once
(there&rsquo;s <br>
no (sub)zone that is as a combinations of other zones),
combined dataset isn&rsquo;t necessary. In contrast,
SORBS.net zones, where several subzones used and main zone
is a combina&acirc; <br>
tion of several subzones, combined dataset is a way to
go.</p>

<p style="margin-top: 1em">All authoritative nameservers
should be set up similarily <br>
When you have several nameservers for your zone, set them
all in a similar way. Namely, if one is set up using
combined dataset, all the rest should be too, or else DNS
<br>
meta-data will be broken. This is because metadata (SOA and
NS) records returned by nameservers using combined and other
datasets will have different origin. With combined <br>
dataset, rbldnsd return NS and SOA records for the base
zone, not for any subzone defined inside the dataset. Given
the above example with dialups.bl.ex.com, spammers.bl.ex.com
<br>
and aggregate bl.ex.com zones, and two nameservers, first is
set up in any ways described above (using individual
datasets for every of the 3 zones), and second is set up for
the <br>
whole bl.ex.com zone using combined dataset. In this case,
for queries against dialups.bl.ex.com, first nameserver will
return NS records like <br>
dialups.bl.ex.com. IN NS a.ns.ex.com. <br>
while second will always use base zone, and NS records will
look like <br>
bl.ex.com. IN NS a.ns.ex.com. <br>
All authoritative nameservers for a zone must have
consistent metadata records. The only way to achieve this is
to use similar configuration (combined or not) on all
name&acirc; <br>
servers. Have this in mind when using other software for a
nameserver.</p>

<p style="margin-top: 1em">Generic dataset usage <br>
generic dataset type is very rudimentary. It&rsquo;s purpose
is to complement all the other type to form complete
nameserver that may answer to A, TXT and MX queries. This is
useful <br>
mostly to define A records for HTTP access
(relays.bl.example.com A, www.bl.example.com A just in
case), and maybe descriptive texts as a TXT record.</p>

<p style="margin-top: 1em">Since rbldnsd only searches one,
most closely matching (sub)zone for every request, one
cannot specify a single e.g. generic dataset in form <br>
proxies TXT list of open proxies <br>
www.proxies A 127.0.0.8 <br>
relays TXT list of open relays <br>
www.relays A 127.0.0.9 <br>
for several (sub)zones, each of which are represented as a
zone too (either in command line or as combined dataset).
Instead, several generic datasets should be specified,
sepa&acirc; <br>
rate one for every (sub)zone. If the data for every subzone
is the same, the same, single dataset may be used, but it
should be specified for every zone it should apply to (see
<br>
combined dataset usage example above).</p>

<p style="margin-top: 1em">BUGS <br>
Most of the bugs outlined in this section aren&rsquo;t
really bugs, but present due to non-standartized and thus
unknown expected behaviour of a nameserver that serves a
DNSBL zone. <br>
rbldnsd matches BIND runtime behaviour where appropriate,
but not always.</p>

<p style="margin-top: 1em">rbldnsd lowercases some domain
names (the ones that are lookup keys, e.g. in
&lsquo;generic&rsquo; and &lsquo;dnset&rsquo; datasets) when
loading, to speed up lookup operations. This isn&rsquo;t a
problem in <br>
most cases.</p>

<p style="margin-top: 1em">There is no TCP mode. If a
resource record does not fit in UDP packet (512 bytes), it
will be silently ignored. For most usages, this isn&rsquo;t
a problem, because there should be <br>
only a few RRs in an answer, and because one record is
usually sufficient to decide whenever a given entry is
&quot;listed&quot; or not. rbldnsd isn&rsquo;t a
full-featured nameserver, after <br>
all.</p>

<p style="margin-top: 1em">rbldnsd will not always return a
list of nameserver records in the AUTHORITY section of every
positive answer: NS records will be provided (if given) only
if there&rsquo;s a room for <br>
them in single UDP packet. If records does not fit,
AUTHORITY section will be empty.</p>

<p style="margin-top: 1em">rbldnsd does not allow AXFR
operations. For DNSBLs, AXFR is the stupidiest yet common
thing to do - use rsync for zone transfers instead. This
isn&rsquo;t a bug in rbldnsd itself, <br>
but in common practice of using AXFR and the like to
transfer huge zones in a format which isn&rsquo;t suitable
for such a task. Perhaps in the future, if there will be
some real <br>
demand, I&rsquo;ll implement AXFR &quot;server&quot; support
(so that rbldnsd will be able to act as master for BIND
nameservers, but not as secondary), but the note remains:
use rsync.</p>

<p style="margin-top: 1em">rbldnsd truncates all TXT
records to be at most 255 bytes. DNS specs allows longer
TXTs, but long TXTs is something that should be avoided as
much as possible - TXT record is <br>
used as SMTP rejection string. Note that DNS UDP packet is
limited to 512 bytes. rbldnsd will log a warning when such
truncation occurs.</p>

<p style="margin-top: 1em">VERSION <br>
This manpage corresponds to rbldnsd version 0.998.</p>

<p style="margin-top: 1em">AUTHOR <br>
The rbldnsd daemon written by Michael Tokarev
&lt;mjt+rbldnsd@corpit.ru&gt;, based on ideas by Dan
Bernstein and his djbdns package, with excellent
contributions by Geoffrey T. Dairiki <br>
&lt;dairiki@dairiki.org&gt;.</p>

<p style="margin-top: 1em">LICENCE <br>
Mostly GPL, with some code licensed under 3-clause BSD
license.</p>

<p style="margin-top: 1em">Dec 2015 rbldnsd(8)</p>
<hr>
</body>
</html>
