<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>BACKUPPC(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">BACKUPPC(8)</td>
    <td class="head-vol">BackupPC manual</td>
    <td class="head-rtitle">BACKUPPC(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
backuppc - BackupPC manual
<h1 class="Sh" title="Sh" id="BackupPC_Introduction"><a class="selflink" href="#BackupPC_Introduction">BackupPC
  Introduction</a></h1>
This documentation describes BackupPC version 3.3.1, released on 11 Jan 2015.
<h2 class="Ss" title="Ss" id="Overview"><a class="selflink" href="#Overview">Overview</a></h2>
BackupPC is a high-performance, enterprise-grade system for backing up Unix,
  Linux, WinXX, and MacOSX PCs, desktops and laptops to a server's disk.
  BackupPC is highly configurable and easy to install and maintain.
<div class="Pp"></div>
Given the ever decreasing cost of disks and raid systems, it is now practical
  and cost effective to backup a large number of machines onto a server's local
  disk or network storage. For some sites this might be the complete backup
  solution. For other sites additional permanent archives could be created by
  periodically backing up the server to tape.
<div class="Pp"></div>
Features include:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">A clever pooling scheme minimizes disk storage and disk
      I/O. Identical files across multiple backups of the same or different PC
      are stored only once (using hard links), resulting in substantial savings
      in disk storage and disk writes.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Optional compression provides additional reductions in
      storage (around 40%). The CPU impact of compression is low since only new
      files (those not already in the pool) need to be compressed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">A powerful http/cgi user interface allows administrators to
      view the current status, edit configuration, add/delete hosts, view log
      files, and allows users to initiate and cancel backups and browse and
      restore files from backups.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The http/cgi user interface has internationalization (i18n)
      support, currently providing English, French, German, Spanish, Italian,
      Dutch, Polish, Portuguese-Brazilian and Chinese</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">No client-side software is needed. On WinXX the standard
      smb protocol is used to extract backup data. On linux, unix or MacOSX
      clients, rsync, tar (over ssh/rsh/nfs) or ftp is used to extract backup
      data. Alternatively, rsync can also be used on WinXX (using cygwin), and
      Samba could be installed on the linux or unix client to provide smb
      shares).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Flexible restore options. Single files can be downloaded
      from any backup directly from the CGI interface. Zip or Tar archives for
      selected files or directories from any backup can also be downloaded from
      the CGI interface. Finally, direct restore to the client machine (using
      smb or tar) for selected files or directories is also supported from the
      CGI interface.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">BackupPC supports mobile environments where laptops are
      only intermittently connected to the network and have dynamic IP addresses
      (DHCP). Configuration settings allow machines connected via slower WAN
      connections (eg: dial up, DSL, cable) to not be backed up, even if they
      use the same fixed or dynamic IP address as when they are connected
      directly to the LAN.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Flexible configuration parameters allow multiple backups to
      be performed in parallel, specification of which shares to backup, which
      directories to backup or not backup, various schedules for full and
      incremental backups, schedules for email reminders to users and so on.
      Configuration parameters can be set system-wide or also on a per-PC
    basis.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Users are sent periodic email reminders if their PC has not
      recently been backed up. Email content, timing and policies are
      configurable.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">BackupPC is Open Source software hosted by
    SourceForge.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Backup_basics"><a class="selflink" href="#Backup_basics">Backup
  basics</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">Full Backup</dt>
  <dd class="It-tag">A full backup is a complete backup of a share. BackupPC can
      be configured to do a full backup at a regular interval (typically
      weekly). BackupPC can be configured to keep a certain number of full
      backups. Exponential expiry is also supported, allowing full backups with
      various vintages to be kept (for example, a settable number of most recent
      weekly fulls, plus a settable number of older fulls that are 2, 4, 8, or
      16 weeks apart).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Incremental Backup</dt>
  <dd class="It-tag">An incremental backup is a backup of files that have
      changed since the last successful full or incremental backup. Starting in
      BackupPC 3.0 multi-level incrementals are supported. A full backup has
      level 0. A new incremental of level N will backup all files that have
      changed since the most recent backup of a lower level. $Conf{IncrLevels}
      is used to specify the level of each successive incremental. The default
      value is all level 1, which makes the behavior the same as earlier
      versions of BackupPC: each incremental will back up all the files that
      changed since the last full (level 0).
    <div style="height: 1.00em;">&#x00A0;</div>
    For SMB and tar, BackupPC uses the modification time (mtime) to determine
      which files have changed since the last lower-level backup. That means SMB
      and tar incrementals are not able to detect deleted files, renamed files
      or new files whose modification time is prior to the last lower-level
      backup.
    <div style="height: 1.00em;">&#x00A0;</div>
    Rsync is more clever: any files whose attributes have changed (ie: uid, gid,
      mtime, modes, size) since the last full are backed up. Deleted, new files
      and renamed files are detected by Rsync incrementals.
    <div style="height: 1.00em;">&#x00A0;</div>
    BackupPC can also be configured to keep a certain number of incremental
      backups, and to keep a smaller number of very old incremental backups. If
      multi-level incrementals are specified then it is likely that more
      incrementals will need to be kept since lower-level incrementals (and the
      full backup) are needed to reconstruct a higher-level incremental.
    <div style="height: 1.00em;">&#x00A0;</div>
    BackupPC &quot;fills-in&quot; incremental backups when browsing or
      restoring, based on the levels of each backup, giving every backup a
      &quot;full&quot; appearance. This makes browsing and restoring backups
      much easier: you can restore from any one backup independent of whether it
      was an incremental or full.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Partial Backup</dt>
  <dd class="It-tag">When a full backup fails or is canceled, and some files
      have already been backed up, BackupPC keeps a partial backup containing
      just the files that were backed up successfully. The partial backup is
      removed when the next successful backup completes, or if another full
      backup fails resulting in a newer partial backup. A failed full backup
      that has not backed up any files, or any failed incremental backup, is
      removed; no partial backup is saved in these cases.
    <div style="height: 1.00em;">&#x00A0;</div>
    The partial backup may be browsed or used to restore files just like a
      successful full or incremental backup.
    <div style="height: 1.00em;">&#x00A0;</div>
    With the rsync transfer method the partial backup is used to resume the next
      full backup, avoiding the need to retransfer the file data already in the
      partial backup.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Identical Files</dt>
  <dd class="It-tag">BackupPC pools identical files using hardlinks. By
      &quot;identical files&quot; we mean files with identical contents, not
      necessary the same permissions, ownership or modification time. Two files
      might have different permissions, ownership, or modification time but will
      still be pooled whenever the contents are identical. This is possible
      since BackupPC stores the file meta-data (permissions, ownership, and
      modification time) separately from the file contents.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Backup Policy</dt>
  <dd class="It-tag">Based on your site's requirements you need to decide what
      your backup policy is. BackupPC is not designed to provide exact
      re-imaging of failed disks. See &quot;Some Limitations&quot; for more
      information. However, the addition of tar transport for linux/unix
      clients, plus full support for special file types and unix attributes in
      v1.4.0 likely means an exact image of a linux/unix file system can be
      made.
    <div style="height: 1.00em;">&#x00A0;</div>
    BackupPC saves backups onto disk. Because of pooling you can relatively
      economically keep several weeks of old backups.
    <div style="height: 1.00em;">&#x00A0;</div>
    At some sites the disk-based backup will be adequate, without a secondary
      tape backup. This system is robust to any single failure: if a client disk
      fails or loses files, the BackupPC server can be used to restore files. If
      the server disk fails, BackupPC can be restarted on a fresh file system,
      and create new backups from the clients. The chance of the server disk
      failing can be made very small by spending more money on increasingly
      better RAID systems. However, there is still the risk of catastrophic
      events like fires or earthquakes that can destroy both the BackupPC server
      and the clients it is backing up if they are physically nearby.
    <div style="height: 1.00em;">&#x00A0;</div>
    Some sites might choose to do periodic backups to tape or cd/dvd. This
      backup can be done perhaps weekly using the archive function of BackupPC.
    <div style="height: 1.00em;">&#x00A0;</div>
    Other users have reported success with removable disks to rotate the
      BackupPC data drives, or using rsync to mirror the BackupPC data pool
      offsite.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Resources"><a class="selflink" href="#Resources">Resources</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">BackupPC home page</dt>
  <dd class="It-tag">The BackupPC Open Source project is hosted on SourceForge.
      The home page can be found at:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    http://backuppc.sourceforge.net
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This page has links to the current documentation, the SourceForge project
      page and general information.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">SourceForge project</dt>
  <dd class="It-tag">The SourceForge project page is at:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    http://sourceforge.net/projects/backuppc
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This page has links to the current releases of BackupPC.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">BackupPC Wiki</dt>
  <dd class="It-tag">BackupPC has a Wiki at
      &lt;http://backuppc.wiki.sourceforge.net&gt;. Everyone is encouraged to
      contribute to the Wiki. Anyone with a SourceForge account can edit the
      Wiki.
    <div style="height: 1.00em;">&#x00A0;</div>
    The old FAQ is at &lt;http://backuppc.sourceforge.net/faq&gt;, but is
      deprecated in favor of the Wiki.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Mailing lists</dt>
  <dd class="It-tag">Three BackupPC mailing lists exist for announcements
      (backuppc-announce), developers (backuppc-devel), and a general user list
      for support, asking questions or any other topic relevant to BackupPC
      (backuppc-users).
    <div style="height: 1.00em;">&#x00A0;</div>
    The lists are archived on SourceForge and Gmane. The SourceForge lists are
      not always up to date and the searching is limited, so Gmane is a good
      alternative. See:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    http://news.gmane.org/index.php?prefix=gmane.comp.sysutils.backup.backuppc
    http://sourceforge.net/mailarchive/forum.php?forum=backuppc-users
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    You can subscribe to these lists by visiting:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    http://lists.sourceforge.net/lists/listinfo/backuppc-announce
    http://lists.sourceforge.net/lists/listinfo/backuppc-users
    http://lists.sourceforge.net/lists/listinfo/backuppc-devel
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    The backuppc-announce list is moderated and is used only for important
      announcements (eg: new versions). It is low traffic. You only need to
      subscribe to one of backuppc-announce and backuppc-users: backuppc-users
      also receives any messages on backuppc-announce.
    <div style="height: 1.00em;">&#x00A0;</div>
    The backuppc-devel list is only for developers who are working on BackupPC.
      Do not post questions or support requests there. But detailed technical
      discussions should happen on this list.
    <div style="height: 1.00em;">&#x00A0;</div>
    To post a message to the backuppc-users list, send an email to
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    backuppc-users@lists.sourceforge.net
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Do not send subscription requests to this address!</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Other Programs of Interest</dt>
  <dd class="It-tag">If you want to mirror linux or unix files or directories to
      a remote server you should use rsync, &lt;http://rsync.samba.org&gt;.
      BackupPC uses rsync as a transport mechanism; if you are already an rsync
      user you can think of BackupPC as adding efficient storage (compression
      and pooling) and a convenient user interface to rsync.
    <div style="height: 1.00em;">&#x00A0;</div>
    Two popular open source packages that do tape backup are Amanda
      (&lt;http://www.amanda.org&gt;) and Bacula
      (&lt;http://www.bacula.org&gt;). These packages can be used as complete
      solutions, or also as back ends to BackupPC to backup the BackupPC server
      data to tape.
    <div style="height: 1.00em;">&#x00A0;</div>
    Various programs and scripts use rsync to provide hardlinked backups. See,
      for example, Mike Rubel's site
      (&lt;http://www.mikerubel.org/computers/rsync_snapshots&gt;), JW Schultz's
      dirvish (&lt;http://www.dirvish.org/&gt;), Ben Escoto's rdiff-backup
      (&lt;http://www.nongnu.org/rdiff-backup&gt;), and John Bowman's rlbackup
      (&lt;http://www.math.ualberta.ca/imaging/rlbackup&gt;).
    <div style="height: 1.00em;">&#x00A0;</div>
    Unison is a utility that can do two-way, interactive, synchronization. See
      &lt;http://freshmeat.net/projects/unison&gt;. An external wrapper around
      rsync that maintains transfer data to enable two-way synchronization is
      drsync; see &lt;http://freshmeat.net/projects/drsync&gt;.
    <div style="height: 1.00em;">&#x00A0;</div>
    BackupPC provides many additional features, such as compressed storage,
      hardlinking any matching files (rather than just files with the same
      name), and storing special files without root privileges. But these other
      programs provide simple, effective and fast solutions and are definitely
      worthy of consideration.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Road_map"><a class="selflink" href="#Road_map">Road
  map</a></h2>
The new features planned for future releases of BackupPC are on the Wiki at
  &lt;http://backuppc.wiki.sourceforge.net&gt;.
<div class="Pp"></div>
Comments and suggestions are welcome.
<h2 class="Ss" title="Ss" id="You_can_help"><a class="selflink" href="#You_can_help">You
  can help</a></h2>
BackupPC is free. I work on BackupPC because I enjoy doing it and I like to
  contribute to the open source community.
<div class="Pp"></div>
BackupPC already has more than enough features for my own needs. The main
  compensation for continuing to work on BackupPC is knowing that more and more
  people find it useful. So feedback is certainly appreciated, both positive and
  negative.
<div class="Pp"></div>
Beyond being a satisfied user and telling other people about it, everyone is
  encouraged to add links to &lt;http://backuppc.sourceforge.net&gt; (I'll see
  them via Google) or otherwise publicize BackupPC. Unlike the commercial
  products in this space, I have a zero budget (in both time and money) for
  marketing, PR and advertising, so it's up to all of you! Feel free to vote for
  BackupPC at &lt;http://freshmeat.net/projects/backuppc&gt;.
<div class="Pp"></div>
Also, everyone is encouraged to contribute patches, bug reports, feature and
  design suggestions, new code, Wiki additions (you can do those directly) and
  documentation corrections or improvements. Answering questions on the mailing
  list is a big help too.
<h1 class="Sh" title="Sh" id="Installing_BackupPC"><a class="selflink" href="#Installing_BackupPC">Installing
  BackupPC</a></h1>
<h2 class="Ss" title="Ss" id="Requirements"><a class="selflink" href="#Requirements">Requirements</a></h2>
BackupPC requires:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">A linux, solaris, or unix based server with a substantial
      amount of free disk space (see the next section for what that means). The
      CPU and disk performance on this server will determine how many
      simultaneous backups you can run. You should be able to run 4-8
      simultaneous backups on a moderately configured server.
    <div style="height: 1.00em;">&#x00A0;</div>
    Several users have reported significantly better performance using reiserfs
      compared to ext3 for the BackupPC data file system. It is also recommended
      you consider either an LVM or RAID setup (either in HW or SW; eg: 3Ware
      RAID10 or RAID5) so that you can expand the file system as necessary.
    <div style="height: 1.00em;">&#x00A0;</div>
    When BackupPC starts with an empty pool, all the backup data will be written
      to the pool on disk. After more backups are done, a higher percentage of
      incoming files will already be in the pool. BackupPC is able to avoid
      writing to disk new files that are already in the pool. So over time disk
      writes will reduce significantly (by perhaps a factor of 20 or more),
      since eventually 95% or more of incoming backup files are typically in the
      pool. Disk reads from the pool are still needed to do file compares to
      verify files are an exact match. So, with a mature pool, if a relatively
      fast client generates data at say 1MB/sec, and you run 4 simultaneous
      backups, there will be an average server disk load of about 4MB/sec reads
      and 0.2MB/sec writes (assuming 95% of the incoming files are in the pool).
      These rates will be perhaps 40% lower if compression is on.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Perl version 5.8.0 or later. If you don't have perl, please
      see &lt;http://www.cpan.org&gt;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Perl modules Compress::Zlib, Archive::Zip and File::RsyncP.
      Try &quot;perldoc Compress::Zlib&quot; and &quot;perldoc
      Archive::Zip&quot; to see if you have these modules. If not, fetch them
      from &lt;http://www.cpan.org&gt; and see the instructions below for how to
      build and install them.
    <div style="height: 1.00em;">&#x00A0;</div>
    The File::RsyncP module is available from
      &lt;http://perlrsync.sourceforge.net&gt; or CPAN. You'll need to install
      the File::RsyncP module if you want to use Rsync as a transport
    method.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">If you are using smb to backup WinXX machines you need
      smbclient and nmblookup from the samba package. You will also need
      nmblookup if you are backing up linux/unix DHCP machines. See
      &lt;http://www.samba.org&gt;. Samba versions 3.x are stable and now
      recommended instead of 2.x.
    <div style="height: 1.00em;">&#x00A0;</div>
    See &lt;http://www.samba.org&gt; for source and binaries. It's pretty easy
      to fetch and compile samba, and just grab smbclient and nmblookup, without
      doing the installation. Alternatively, &lt;http://www.samba.org&gt; has
      binary distributions for most platforms.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">If you are using tar to backup linux/unix machines, those
      machines should have version 1.13.7 at a minimum, with version 1.13.20 or
      higher recommended. Use &quot;tar --version&quot; to check your version.
      Various GNU mirrors have the newest versions of tar; see
      &lt;http://www.gnu.org/software/tar/&gt;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">If you are using rsync to backup linux/unix machines you
      should have version 2.6.3 or higher on each client machine. See
      &lt;http://rsync.samba.org&gt;. Use &quot;rsync --version&quot; to check
      your version.
    <div style="height: 1.00em;">&#x00A0;</div>
    For BackupPC to use Rsync you will also need to install the perl
      File::RsyncP module, which is available from
      &lt;http://perlrsync.sourceforge.net&gt;. Version 0.68 or later is
      required.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The Apache web server, see &lt;http://www.apache.org&gt;,
      preferably built with mod_perl support.</dd>
</dl>
<h2 class="Ss" title="Ss" id="What_type_of_storage_space_do_I_need?"><a class="selflink" href="#What_type_of_storage_space_do_I_need?">What
  type of storage space do I need?</a></h2>
BackupPC uses hardlinks to pool files common to different backups. Therefore
  BackupPC's data store (__TOPDIR__) must point to a single file system that
  supports hardlinks. You cannot split this file system with multiple mount
  points or using symbolic links to point a sub-directory to a different file
  system (it is ok to use a single symbolic link at the top-level directory
  (__TOPDIR__) to point the entire data store somewhere else). You can of course
  use any kind of RAID system or logical volume manager that combines the
  capacity of multiple disks into a single, larger, file system. Such approaches
  have the advantage that the file system can be expanded without having to copy
  it.
<div class="Pp"></div>
Any standard linux or unix file system supports hardlinks. NFS mounted file
  systems work too (provided the underlying file system supports hardlinks). But
  windows based FAT and NTFS file systems will not work.
<div class="Pp"></div>
Starting with BackupPC 3.1.0, run-time checks are done at startup and at the
  start of each backup to ensure that the file system can support hardlinks,
  since this is a common area of configuration problems.
<h2 class="Ss" title="Ss" id="How_much_disk_space_do_I_need?"><a class="selflink" href="#How_much_disk_space_do_I_need?">How
  much disk space do I need?</a></h2>
Here's one real example for an environment that is backing up 65 laptops with
  compression off. Each full backup averages 3.2GB. Each incremental backup
  averages about 0.2GB. Storing one full backup and two incremental backups per
  laptop is around 240GB of raw data. But because of the pooling of identical
  files, only 87GB is used. This is without compression.
<div class="Pp"></div>
Another example, with compression on: backing up 95 laptops, where each backup
  averages 3.6GB and each incremental averages about 0.3GB. Keeping three weekly
  full backups, and six incrementals is around 1200GB of raw data. Because of
  pooling and compression, only 150GB is needed.
<div class="Pp"></div>
Here's a rule of thumb. Add up the disk usage of all the machines you want to
  backup (210GB in the first example above). This is a rough minimum space
  estimate that should allow a couple of full backups and at least half a dozen
  incremental backups per machine. If compression is on you can reduce the
  storage requirements by maybe 30-40%. Add some margin in case you add more
  machines or decide to keep more old backups.
<div class="Pp"></div>
Your actual mileage will depend upon the types of clients, operating systems and
  applications you have. The more uniform the clients and applications the
  bigger the benefit from pooling common files.
<div class="Pp"></div>
For example, the Eudora email tool stores each mail folder in a separate file,
  and attachments are extracted as separate files. So in the sadly common case
  of a large attachment emailed to many recipients, Eudora will extract the
  attachment into a new file. When these machines are backed up, only one copy
  of the file will be stored on the server, even though the file appears in many
  different full or incremental backups. In this sense Eudora is a
  &quot;friendly&quot; application from the point of view of backup storage
  requirements.
<div class="Pp"></div>
An example at the other end of the spectrum is Outlook. Everything (email
  bodies, attachments, calendar, contact lists) is stored in a single file,
  which often becomes huge. Any change to this file requires a separate copy of
  the file to be saved during backup. Outlook is even more troublesome, since it
  keeps this file locked all the time, so it cannot be read by smbclient
  whenever Outlook is running. See the &quot;Some Limitations&quot; section for
  more discussion of this problem.
<div class="Pp"></div>
In addition to total disk space, you should make sure you have plenty of inodes
  on your BackupPC data partition. Some users have reported running out of
  inodes on their BackupPC data partition. So even if you have plenty of disk
  space, BackupPC will report failures when the inodes are exhausted. This is a
  particular problem with ext2/ext3 file systems that have a fixed number of
  inodes when the file system is built. Use &quot;df -i&quot; to see your inode
  usage.
<h2 class="Ss" title="Ss" id="Step_1:_Getting_BackupPC"><a class="selflink" href="#Step_1:_Getting_BackupPC">Step
  1: Getting BackupPC</a></h2>
Some linux distributions now include BackupPC. The Debian distribution,
  supported by Ludovic Drolez, can be found at
  &lt;http://packages.debian.org/backuppc&gt; and is included in the current
  stable Debian release. On Debian, BackupPC can be installed with the command:
<div class="Pp"></div>
<pre>
    apt-get install backuppc
</pre>
<div class="Pp"></div>
In the future there might be packages for Gentoo and other linux flavors. If the
  packaged version is older than the released version then you may want to
  install the latest version as described below.
<div class="Pp"></div>
Otherwise, manually fetching and installing BackupPC is easy. Start by
  downloading the latest version from &lt;http://backuppc.sourceforge.net&gt;.
  Hit the &quot;Code&quot; button, then select the &quot;backuppc&quot; or
  &quot;backuppc-beta&quot; package and download the latest version.
<h2 class="Ss" title="Ss" id="Step_2:_Installing_the_distribution"><a class="selflink" href="#Step_2:_Installing_the_distribution">Step
  2: Installing the distribution</a></h2>
Note: most information in this step is only relevant if you build and install
  BackupPC yourself. If you use a package provided by a distribution, the
  package management system should take of installing any needed dependencies.
<div class="Pp"></div>
First off, there are five perl modules you should install. These are all
  optional, but highly recommended:
<dl class="Bl-tag">
  <dt class="It-tag">Compress::Zlib</dt>
  <dd class="It-tag">To enable compression, you will need to install
      Compress::Zlib from &lt;http://www.cpan.org&gt;. You can run &quot;perldoc
      Compress::Zlib&quot; to see if this module is installed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Archive::Zip</dt>
  <dd class="It-tag">To support restore via Zip archives you will need to
      install Archive::Zip, also from &lt;http://www.cpan.org&gt;. You can run
      &quot;perldoc Archive::Zip&quot; to see if this module is installed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">XML::RSS</dt>
  <dd class="It-tag">To support the RSS feature you will need to install
      XML::RSS, also from &lt;http://www.cpan.org&gt;. There is not need to
      install this module if you don't plan on using RSS. You can run
      &quot;perldoc XML::RSS&quot; to see if this module is installed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">File::RsyncP</dt>
  <dd class="It-tag">To use rsync and rsyncd with BackupPC you will need to
      install File::RsyncP. You can run &quot;perldoc File::RsyncP&quot; to see
      if this module is installed. File::RsyncP is available from
      &lt;http://perlrsync.sourceforge.net&gt;. Version 0.68 or later is
      required.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">File::Listing, Net::FTP, Net::FTP::RetrHandle,
    Net::FTP::AutoReconnect</dt>
  <dd class="It-tag">To use ftp with BackupPC you will need four libraries, but
      actually need to install only File::Listing from
      &lt;http://www.cpan.org&gt;. You can run &quot;perldoc File::Listing&quot;
      to see if this module is installed. Net::FTP is a standard module.
      Net::FTP::RetrHandle and Net::FTP::AutoReconnect included in BackupPC
      distribution.</dd>
</dl>
<div class="Pp"></div>
To build and install these packages you should use the cpan program.
  Alternatively, you can fetch the tar.gz file from &lt;http://www.cpan.org&gt;
  and then run these commands:
<div class="Pp"></div>
<pre>
    tar zxvf Archive-Zip-1.26.tar.gz
    cd Archive-Zip-1.26
    perl Makefile.PL
    make
    make test
    make install
</pre>
<div class="Pp"></div>
The same sequence of commands can be used for each module.
<div class="Pp"></div>
Now let's move onto BackupPC itself. After fetching BackupPC-3.3.1.tar.gz, run
  these commands as root:
<div class="Pp"></div>
<pre>
    tar zxf BackupPC-3.3.1.tar.gz
    cd BackupPC-3.3.1
    perl configure.pl
</pre>
<div class="Pp"></div>
In the future this release might also have patches available on the SourceForge
  site. These patch files are text files, with a name of the form
<div class="Pp"></div>
<pre>
    BackupPC-3.3.1plN.diff
</pre>
<div class="Pp"></div>
where N is the patch level, eg: pl2 is patch-level 2. These patch files are
  cumulative: you only need apply the last patch file, not all the earlier patch
  files. If a patch file is available, eg: BackupPC-3.3.1pl2.diff, you should
  apply the patch after extracting the tar file:
<div class="Pp"></div>
<pre>
     # fetch BackupPC-3.3.1.tar.gz
     # fetch BackupPC-3.3.1pl2.diff
     tar zxf BackupPC-3.3.1.tar.gz
     cd BackupPC-3.3.1
     patch -p0 &lt; ../BackupPC-3.3.1pl2.diff
     perl configure.pl
</pre>
<div class="Pp"></div>
A patch file includes comments that describe that bug fixes and changes. Feel
  free to review it before you apply the patch.
<div class="Pp"></div>
The configure.pl script also accepts command-line options if you wish to run it
  in a non-interactive manner. It has self-contained documentation for all the
  command-line options, which you can read with perldoc:
<div class="Pp"></div>
<pre>
    perldoc configure.pl
</pre>
<div class="Pp"></div>
Starting with BackupPC 3.0.0, the configure.pl script by default complies with
  the file system hierarchy (FHS) conventions. The major difference compared to
  earlier versions is that by default configuration files will be stored in
  /etc/BackupPC rather than below the data directory, __TOPDIR__/conf, and the
  log files will be stored in /var/log/BackupPC rather than below the data
  directory, __TOPDIR__/log.
<div class="Pp"></div>
Note that distributions may choose to use different locations for BackupPC files
  than these defaults.
<div class="Pp"></div>
If you are upgrading from an earlier version the configure.pl script will keep
  the configuration files and log files in their original location.
<div class="Pp"></div>
When you run configure.pl you will be prompted for the full paths of various
  executables, and you will be prompted for the following information.
<dl class="Bl-tag">
  <dt class="It-tag">BackupPC User</dt>
  <dd class="It-tag">It is best if BackupPC runs as a special user, eg backuppc,
      that has limited privileges. It is preferred that backuppc belongs to a
      system administrator group so that sys admin members can browse BackupPC
      files, edit the configuration files and so on. Although configurable, the
      default settings leave group read permission on pool files, so make sure
      the BackupPC user's group is chosen restrictively.
    <div style="height: 1.00em;">&#x00A0;</div>
    On this installation, this is __BACKUPPCUSER__.
    <div style="height: 1.00em;">&#x00A0;</div>
    For security purposes you might choose to configure the BackupPC user with
      the shell set to /bin/false. Since you might need to run some BackupPC
      programs as the BackupPC user for testing purposes, you can use the -s
      option to su to explicitly run a shell, eg:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    su -s /bin/bash __BACKUPPCUSER__
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Depending upon your configuration you might also need the -l option.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Data Directory</dt>
  <dd class="It-tag">You need to decide where to put the data directory, below
      which all the BackupPC data is stored. This needs to be a big file system.
    <div style="height: 1.00em;">&#x00A0;</div>
    On this installation, this is __TOPDIR__.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Install Directory</dt>
  <dd class="It-tag">You should decide where the BackupPC scripts, libraries and
      documentation should be installed, eg: /usr/local/BackupPC.
    <div style="height: 1.00em;">&#x00A0;</div>
    On this installation, this is __INSTALLDIR__.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGI bin Directory</dt>
  <dd class="It-tag">You should decide where the BackupPC CGI script resides.
      This will usually be below Apache's cgi-bin directory.
    <div style="height: 1.00em;">&#x00A0;</div>
    It is also possible to use a different directory and use Apache's
      ``&lt;Directory&gt;'' directive to specifiy that location. See the Apache
      HTTP Server documentation for additional information.
    <div style="height: 1.00em;">&#x00A0;</div>
    On this installation, this is __CGIDIR__.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Apache image Directory</dt>
  <dd class="It-tag">A directory where BackupPC's images are stored so that
      Apache can serve them. You should ensure this directory is readable by
      Apache and create a symlink to this directory from the BackupPC CGI bin
      Directory.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Config and Log Directories</dt>
  <dd class="It-tag">In this installation the configuration and log directories
      are located in the following locations:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    __CONFDIR__/config.pl    main config file
    __CONFDIR__/hosts        hosts file
    __CONFDIR__/pc/HOST.pl   per-pc config file
    __LOGDIR__/BackupPC      log files, pid, status
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    The configure.pl script doesn't prompt for these locations but they can be
      set for new installations using command-line options.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Step_3:_Setting_up_config.pl"><a class="selflink" href="#Step_3:_Setting_up_config.pl">Step
  3: Setting up config.pl</a></h2>
After running configure.pl, browse through the config file,
  __CONFDIR__/config.pl, and make sure all the default settings are correct. In
  particular, you will need to decide whether to use smb, tar,or rsync or ftp
  transport (or whether to set it on a per-PC basis) and set the relevant
  parameters for that transport method. See the section &quot;Step 5: Client
  Setup&quot; for more details.
<h2 class="Ss" title="Ss" id="Step_4:_Setting_up_the_hosts_file"><a class="selflink" href="#Step_4:_Setting_up_the_hosts_file">Step
  4: Setting up the hosts file</a></h2>
The file __CONFDIR__/hosts contains the list of clients to backup. BackupPC
  reads this file in three cases:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Upon startup.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">When BackupPC is sent a HUP (-1) signal. Assuming you
      installed the init.d script, you can also do this with
      &quot;/etc/init.d/backuppc reload&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">When the modification time of the hosts file changes.
      BackupPC checks the modification time once during each regular
    wakeup.</dd>
</dl>
<div class="Pp"></div>
Whenever you change the hosts file (to add or remove a host) you can either do a
  kill -HUP BackupPC_pid or simply wait until the next regular wakeup period.
<div class="Pp"></div>
Each line in the hosts file contains three fields, separated by white space:
<dl class="Bl-tag">
  <dt class="It-tag">Host name</dt>
  <dd class="It-tag">This is typically the host name or NetBios name of the
      client machine and should be in lower case. The host name can contain
      spaces (escape with a backslash), but it is not recommended.
    <div style="height: 1.00em;">&#x00A0;</div>
    Please read the section &quot;How BackupPC Finds Hosts&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    In certain cases you might want several distinct clients to refer to the
      same physical machine. For example, you might have a database you want to
      backup, and you want to bracket the backup of the database with
      shutdown/restart using $Conf{DumpPreUserCmd} and $Conf{DumpPostUserCmd}.
      But you also want to backup the rest of the machine while the database is
      still running. In the case you can specify two different clients in the
      host file, using any mnemonic name (eg: myhost_mysql and myhost), and use
      $Conf{ClientNameAlias} in myhost_mysql's config.pl to specify the real
      host name of the machine.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">DHCP flag</dt>
  <dd class="It-tag">Starting with v2.0.0 the way hosts are discovered has
      changed and now in most cases you should specify 0 for the DHCP flag, even
      if the host has a dynamically assigned IP address. Please read the section
      &quot;How BackupPC Finds Hosts&quot; to understand whether you need to set
      the DHCP flag.
    <div style="height: 1.00em;">&#x00A0;</div>
    You only need to set DHCP to 1 if your client machine doesn't respond to the
      NetBios multicast request:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    nmblookup myHost
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    but does respond to a request directed to its IP address:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    nmblookup -A W.X.Y.Z
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    If you do set DHCP to 1 on any client you will need to specify the range of
      DHCP addresses to search is specified in $Conf{DHCPAddressRanges}.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note also that the $Conf{ClientNameAlias} feature does not work for clients
      with DHCP set to 1.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">User name</dt>
  <dd class="It-tag">This should be the unix login/email name of the user who
      &quot;owns&quot; or uses this machine. This is the user who will be sent
      email about this machine, and this user will have permission to
      stop/start/browse/restore backups for this host. Leave this blank if no
      specific person should receive email or be allowed to
      stop/start/browse/restore backups for this host. Administrators will still
      have full permissions.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">More users</dt>
  <dd class="It-tag">Additional user names, separate by commas and with no white
      space, can be specified. These users will also have full permission in the
      CGI interface to stop/start/browse/restore backups for this host. These
      users will not be sent email about this host.</dd>
</dl>
<div class="Pp"></div>
The first non-comment line of the hosts file is special: it contains the names
  of the columns and should not be edited.
<div class="Pp"></div>
Here's a simple example of a hosts file:
<div class="Pp"></div>
<pre>
    host        dhcp    user      moreUsers
    farside     0       craig     jim,dave
    larson      1       gary      andy
</pre>
<h2 class="Ss" title="Ss" id="Step_5:_Client_Setup"><a class="selflink" href="#Step_5:_Client_Setup">Step
  5: Client Setup</a></h2>
Four methods for getting backup data from a client are supported: smb, tar,
  rsync and ftp. Smb or rsync are the preferred methods for WinXX clients and
  rsync or tar are the preferred methods for linux/unix/MacOSX clients.
<div class="Pp"></div>
The transfer method is set using the $Conf{XferMethod} configuration setting. If
  you have a mixed environment (ie: you will use smb for some clients and tar
  for others), you will need to pick the most common choice for
  $Conf{XferMethod} for the main config.pl file, and then override it in the
  per-PC config file for those hosts that will use the other method. (Or you
  could run two completely separate instances of BackupPC, with different data
  directories, one for WinXX and the other for linux/unix, but then common files
  between the different machine types will duplicated.)
<div class="Pp"></div>
Here are some brief client setup notes:
<dl class="Bl-tag">
  <dt class="It-tag">WinXX</dt>
  <dd class="It-tag">One setup for WinXX clients is to set $Conf{XferMethod} to
      &quot;smb&quot;. Actually, rsyncd is the better method for WinXX if you
      are prepared to run rsync/cygwin on your WinXX client.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you want to use rsyncd for WinXX clients you can find a pre-packaged zip
      file on &lt;http://backuppc.sourceforge.net&gt;. The package is called
      cygwin-rsync. It contains rsync.exe, template setup files and the minimal
      set of cygwin libraries for everything to run. The README file contains
      instructions for running rsync as a service, so it starts automatically
      everytime you boot your machine. If you use rsync to backup WinXX
      machines, be sure to set $Conf{ClientCharset} correctly (eg: 'cp1252') so
      that the WinXX file name encoding is correctly converted to utf8.
    <div style="height: 1.00em;">&#x00A0;</div>
    Otherwise, to use SMB, you can either create shares for the data you want to
      backup or your can use the existing C$ share. To create a new share, open
      &quot;My Computer&quot;, right click on the drive (eg: C), and select
      &quot;Sharing...&quot; (or select &quot;Properties&quot; and select the
      &quot;Sharing&quot; tab). In this dialog box you can enable sharing,
      select the share name and permissions.
    <div style="height: 1.00em;">&#x00A0;</div>
    All Windows NT based OS (NT, 2000, XP Pro), are configured by default to
      share the entire C drive as C$. This is a special share used for various
      administration functions, one of which is to grant access to backup
      operators. All you need to do is create a new domain user, specifically
      for backup. Then add the new backup user to the built in &quot;Backup
      Operators&quot; group. You now have backup capability for any directory on
      any computer in the domain in one easy step. This avoids using
      administrator accounts and only grants permission to do exactly what you
      want for the given user, i.e.: backup. Also, for additional security, you
      may wish to deny the ability for this user to logon to computers in the
      default domain policy.
    <div style="height: 1.00em;">&#x00A0;</div>
    If this machine uses DHCP you will also need to make sure the NetBios name
      is set. Go to Control Panel|System|Network Identification (on Win2K) or
      Control Panel|System|Computer Name (on WinXP). Also, you should go to
      Control Panel|Network Connections|Local Area
      Connection|Properties|Internet Protocol (TCP/IP)|Properties|Advanced|WINS
      and verify that NetBios is not disabled.
    <div style="height: 1.00em;">&#x00A0;</div>
    The relevant configuration settings are $Conf{SmbShareName},
      $Conf{SmbShareUserName}, $Conf{SmbSharePasswd}, $Conf{SmbClientPath},
      $Conf{SmbClientFullCmd}, $Conf{SmbClientIncrCmd} and
      $Conf{SmbClientRestoreCmd}.
    <div style="height: 1.00em;">&#x00A0;</div>
    BackupPC needs to know the smb share user name and password for a client
      machine that uses smb. The user name is specified in
      $Conf{SmbShareUserName}. There are four ways to tell BackupPC the smb
      share password:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">As an environment variable BPC_SMB_PASSWD set before
      BackupPC starts. If you start BackupPC manually the BPC_SMB_PASSWD
      variable must be set manually first. For backward compatibility for v1.5.0
      and prior, the environment variable PASSWD can be used if BPC_SMB_PASSWD
      is not set. Warning: on some systems it is possible to see environment
      variables of running processes.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Alternatively the BPC_SMB_PASSWD setting can be included in
      /etc/init.d/backuppc, in which case you must make sure this file is not
      world (other) readable.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">As a configuration variable $Conf{SmbSharePasswd} in
      __CONFDIR__/config.pl. If you put the password here you must make sure
      this file is not world (other) readable.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">As a configuration variable $Conf{SmbSharePasswd} in the
      per-PC configuration file (__CONFDIR__/pc/$host.pl or
      __TOPDIR__/pc/$host/config.pl in non-FHS versions of BackupPC). You will
      have to use this option if the smb share password is different for each
      host. If you put the password here you must make sure this file is not
      world (other) readable.</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
Placement and protection of the smb share password is a possible security risk,
  so please double-check the file and directory permissions. In a future version
  there might be support for encryption of this password, but a private key will
  still have to be stored in a protected place. Suggestions are welcome.
<div style="height: 1.00em;">&#x00A0;</div>
As an alternative to setting $Conf{XferMethod} to &quot;smb&quot; (using
  smbclient) for WinXX clients, you can use an smb network filesystem (eg:
  ksmbfs or similar) on your linux/unix server to mount the share, and then set
  $Conf{XferMethod} to &quot;tar&quot; (use tar on the network mounted file
  system).
<div style="height: 1.00em;">&#x00A0;</div>
Also, to make sure that file names with special characters are correctly
  transferred by smbclient you should make sure that the smb.conf file has (for
  samba 3.x):
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
    [global]
        unix charset = UTF8
</pre>
<div style="height: 1.00em;">&#x00A0;</div>
UTF8 is the default setting, so if the parameter is missing then it is ok. With
  this setting $Conf{ClientCharset} should be emtpy, since smbclient has already
  converted the file names to utf8.</div>
<dl class="Bl-tag">
  <dt class="It-tag">Linux/Unix</dt>
  <dd class="It-tag">The preferred setup for linux/unix clients is to set
      $Conf{XferMethod} to &quot;rsync&quot;, &quot;rsyncd&quot; or
      &quot;tar&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    You can use either rsync, smb, or tar for linux/unix machines. Smb requires
      that the Samba server (smbd) be run to provide the shares. Since the smb
      protocol can't represent special files like symbolic links and fifos, tar
      and rsync are the better transport methods for linux/unix machines. (In
      fact, by default samba makes symbolic links look like the file or
      directory that they point to, so you could get an infinite loop if a
      symbolic link points to the current or parent directory. If you really
      need to use Samba shares for linux/unix backups you should turn off the
      &quot;follow symlinks&quot; samba config setting. See the smb.conf manual
      page.)
    <div style="height: 1.00em;">&#x00A0;</div>
    The requirements for each Xfer Method are:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">tar</dt>
  <dd class="It-tag">You must have GNU tar on the client machine. Use &quot;tar
      --version&quot; or &quot;gtar --version&quot; to verify. The version
      should be at least 1.13.7, and 1.13.20 or greater is recommended. Tar is
      run on the client machine via rsh or ssh.
    <div style="height: 1.00em;">&#x00A0;</div>
    The relevant configuration settings are $Conf{TarClientPath},
      $Conf{TarShareName}, $Conf{TarClientCmd}, $Conf{TarFullArgs},
      $Conf{TarIncrArgs}, and $Conf{TarClientRestoreCmd}.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">rsync</dt>
  <dd class="It-tag">You should have at least rsync 2.6.3, and the latest
      version is recommended. Rsync is run on the remote client via rsh or ssh.
    <div style="height: 1.00em;">&#x00A0;</div>
    The relevant configuration settings are $Conf{RsyncClientPath},
      $Conf{RsyncClientCmd}, $Conf{RsyncClientRestoreCmd},
      $Conf{RsyncShareName}, $Conf{RsyncArgs}, and $Conf{RsyncRestoreArgs}.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">rsyncd</dt>
  <dd class="It-tag">You should have at least rsync 2.6.3, and the latest
      version is recommended. In this case the rsync daemon should be running on
      the client machine and BackupPC connects directly to it.
    <div style="height: 1.00em;">&#x00A0;</div>
    The relevant configuration settings are $Conf{RsyncdClientPort},
      $Conf{RsyncdUserName}, $Conf{RsyncdPasswd}, $Conf{RsyncdAuthRequired},
      $Conf{RsyncShareName}, $Conf{RsyncArgs}, $Conf{RsyncArgsExtra}, and
      $Conf{RsyncRestoreArgs}. $Conf{RsyncShareName} is the name of an rsync
      module (ie: the thing in square brackets in rsyncd's conf file -- see
      rsyncd.conf), not a file system path.
    <div style="height: 1.00em;">&#x00A0;</div>
    Be aware that rsyncd will remove the leading '/' from path names in symbolic
      links if you specify &quot;use chroot = no&quot; in the rsynd.conf file.
      See the rsyncd.conf manual page for more information.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">ftp</dt>
  <dd class="It-tag">You need to be running an ftp server on the client machine.
      The relevant configuration settings are $Conf{FtpShareName},
      $Conf{FtpUserName}, $Conf{FtpPasswd}, $Conf{FtpBlockSize}, $Conf{FtpPort},
      $Conf{FtpTimeout}, and $Conf{FtpFollowSymlinks}.</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
You need to set $Conf{ClientCharset} to the client's charset so that file names
  are correctly converted to utf8. Use &quot;locale charmap&quot; on the client
  to see its charset.
<div style="height: 1.00em;">&#x00A0;</div>
For linux/unix machines you should not backup &quot;/proc&quot;. This directory
  contains a variety of files that look like regular files but they are special
  files that don't need to be backed up (eg: /proc/kcore is a regular file that
  contains physical memory). See $Conf{BackupFilesExclude}. It is safe to back
  up /dev since it contains mostly character-special and block-special files,
  which are correctly handed by BackupPC (eg: backing up /dev/hda5 just saves
  the block-special file information, not the contents of the disk).
<div style="height: 1.00em;">&#x00A0;</div>
Alternatively, rather than backup all the file systems as a single share
  (&quot;/&quot;), it is easier to restore a single file system if you backup
  each file system separately. To do this you should list each file system mount
  point in $Conf{TarShareName} or $Conf{RsyncShareName}, and add the
  --one-file-system option to $Conf{TarClientCmd} or $Conf{RsyncArgs}. In this
  case there is no need to exclude /proc explicitly since it looks like a
  different file system.
<div style="height: 1.00em;">&#x00A0;</div>
Next you should decide whether to run tar over ssh, rsh or nfs. Ssh is the
  preferred method. Rsh is not secure and therefore not recommended. Nfs will
  work, but you need to make sure that the BackupPC user (running on the server)
  has sufficient permissions to read all the files below the nfs mount.
<div style="height: 1.00em;">&#x00A0;</div>
Ssh allows BackupPC to run as a privileged user on the client (eg: root), since
  it needs sufficient permissions to read all the backup files. Ssh is setup so
  that BackupPC on the server (an otherwise low privileged user) can ssh as root
  on the client, without being prompted for a password. There are two common
  versions of ssh: v1 and v2. Here are some instructions for one way to setup
  ssh. (Check which version of SSH you have by typing &quot;ssh&quot; or
  &quot;man ssh&quot;.)</div>
<dl class="Bl-tag">
  <dt class="It-tag">MacOSX</dt>
  <dd class="It-tag">In general this should be similar to Linux/Unix machines.
      In versions 10.4 and later, the native MacOSX tar works, and also supports
      resource forks. xtar is another option, and rsync works too (although the
      MacOSX-supplied rsync has an extension for extended attributes that is not
      compatible with standard rsync).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">SSH Setup</dt>
  <dd class="It-tag">SSH is a secure way to run tar or rsync on a backup client
      to extract the data. SSH provides strong authentication and encryption of
      the network data.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note that if you run rsyncd (rsync daemon), ssh is not used. In this case,
      rsyncd provides its own authentication, but there is no encryption of
      network data. If you want encryption of network data you can use ssh to
      create a tunnel, or use a program like stunnel.
    <div style="height: 1.00em;">&#x00A0;</div>
    Setup instructions for ssh can be found at
      &lt;http://backuppc.sourceforge.net/faq/ssh.html&gt; or on the Wiki.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Clients that use DHCP</dt>
  <dd class="It-tag">If a client machine uses DHCP BackupPC needs some way to
      find the IP address given the host name. One alternative is to set dhcp to
      1 in the hosts file, and BackupPC will search a pool of IP addresses
      looking for hosts. More efficiently, it is better to set dhcp = 0 and
      provide a mechanism for BackupPC to find the IP address given the host
      name.
    <div style="height: 1.00em;">&#x00A0;</div>
    For WinXX machines BackupPC uses the NetBios name server to determine the IP
      address given the host name. For unix machines you can run nmbd (the
      NetBios name server) from the Samba distribution so that the machine
      responds to a NetBios name request. See the manual page and Samba
      documentation for more information.
    <div style="height: 1.00em;">&#x00A0;</div>
    Alternatively, you can set $Conf{NmbLookupFindHostCmd} to any command that
      returns the IP address given the host name.
    <div style="height: 1.00em;">&#x00A0;</div>
    Please read the section &quot;How BackupPC Finds Hosts&quot; for more
      details.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Step_6:_Running_BackupPC"><a class="selflink" href="#Step_6:_Running_BackupPC">Step
  6: Running BackupPC</a></h2>
The installation contains an init.d backuppc script that can be copied to
  /etc/init.d so that BackupPC can auto-start on boot. See init.d/README for
  further instructions.
<div class="Pp"></div>
BackupPC should be ready to start. If you installed the init.d script, then you
  should be able to run BackupPC with:
<div class="Pp"></div>
<pre>
    /etc/init.d/backuppc start
</pre>
<div class="Pp"></div>
(This script can also be invoked with &quot;stop&quot; to stop BackupPC and
  &quot;reload&quot; to tell BackupPC to reload config.pl and the hosts file.)
<div class="Pp"></div>
Otherwise, just run
<div class="Pp"></div>
<pre>
     __INSTALLDIR__/bin/BackupPC -d
</pre>
<div class="Pp"></div>
as user __BACKUPPCUSER__. The -d option tells BackupPC to run as a daemon (ie:
  it does an additional fork).
<div class="Pp"></div>
Any immediate errors will be printed to stderr and BackupPC will quit.
  Otherwise, look in __LOGDIR__/LOG and verify that BackupPC reports it has
  started and all is ok.
<h2 class="Ss" title="Ss" id="Step_7:_Talking_to_BackupPC"><a class="selflink" href="#Step_7:_Talking_to_BackupPC">Step
  7: Talking to BackupPC</a></h2>
You should verify that BackupPC is running by using BackupPC_serverMesg. This
  sends a message to BackupPC via the unix (or TCP) socket and prints the
  response. Like all BackupPC programs, BackupPC_serverMesg should be run as the
  BackupPC user (__BACKUPPCUSER__), so you should
<div class="Pp"></div>
<pre>
    su __BACKUPPCUSER__
</pre>
<div class="Pp"></div>
before running BackupPC_serverMesg. If the BackupPC user is configured with
  /bin/false as the shell, you can use the -s option to su to explicitly run a
  shell, eg:
<div class="Pp"></div>
<pre>
    su -s /bin/bash __BACKUPPCUSER__
</pre>
<div class="Pp"></div>
Depending upon your configuration you might also need the -l option.
<div class="Pp"></div>
You can request status information and start and stop backups using this
  interface. This socket interface is mainly provided for the CGI interface (and
  some of the BackupPC sub-programs use it too). But right now we just want to
  make sure BackupPC is happy. Each of these commands should produce some status
  output:
<div class="Pp"></div>
<pre>
    __INSTALLDIR__/bin/BackupPC_serverMesg status info
    __INSTALLDIR__/bin/BackupPC_serverMesg status jobs
    __INSTALLDIR__/bin/BackupPC_serverMesg status hosts
</pre>
<div class="Pp"></div>
The output should be some hashes printed with Data::Dumper. If it looks cryptic
  and confusing, and doesn't look like an error message, then all is ok.
<div class="Pp"></div>
The jobs status should initially show just BackupPC_trashClean. The hosts status
  should produce a list of every host you have listed in __CONFDIR__/hosts as
  part of a big cryptic output line.
<div class="Pp"></div>
You can also request that all hosts be queued:
<div class="Pp"></div>
<pre>
    __INSTALLDIR__/bin/BackupPC_serverMesg backup all
</pre>
<div class="Pp"></div>
At this point you should make sure the CGI interface works since it will be much
  easier to see what is going on. That's our next subject.
<h2 class="Ss" title="Ss" id="Step_8:_Checking_email_delivery"><a class="selflink" href="#Step_8:_Checking_email_delivery">Step
  8: Checking email delivery</a></h2>
The script BackupPC_sendEmail sends status and error emails to the administrator
  and users. It is usually run each night by BackupPC_nightly.
<div class="Pp"></div>
To verify that it can run sendmail and deliver email correctly you should ask it
  to send a test email to you:
<div class="Pp"></div>
<pre>
    su __BACKUPPCUSER__
    __INSTALLDIR__/bin/BackupPC_sendEmail -u MYNAME@MYDOMAIN.COM
</pre>
<div class="Pp"></div>
BackupPC_sendEmail also takes a -c option that checks if BackupPC is running,
  and it sends an email to $Conf{EMailAdminUserName} if it is not. That can be
  used as a keep-alive check by adding
<div class="Pp"></div>
<pre>
    __INSTALLDIR__/bin/BackupPC_sendEmail -c
</pre>
<div class="Pp"></div>
to __BACKUPPCUSER__'s cron.
<div class="Pp"></div>
The -t option to BackupPC_sendEmail causes it to print the email message instead
  of invoking sendmail to deliver the message.
<h2 class="Ss" title="Ss" id="Step_9:_CGI_interface"><a class="selflink" href="#Step_9:_CGI_interface">Step
  9: CGI interface</a></h2>
The CGI interface script, BackupPC_Admin, is a powerful and flexible way to see
  and control what BackupPC is doing. It is written for an Apache server. If you
  don't have Apache, see &lt;http://www.apache.org&gt;.
<div class="Pp"></div>
There are two options for setting up the CGI interface: standard mode and using
  mod_perl. Mod_perl provides much higher performance (around 15x) and is the
  best choice if your Apache was built with mod_perl support. To see if your
  apache was built with mod_perl run this command:
<div class="Pp"></div>
<pre>
    httpd -l | egrep mod_perl
</pre>
<div class="Pp"></div>
If this prints mod_perl.c then your Apache supports mod_perl.
<div class="Pp"></div>
Note: on some distributions (like Debian) the command is not ``httpd'', but
  ``apache'' or ``apache2''. Those distributions will generally also use
  ``apache'' for the Apache user account and configuration files.
<div class="Pp"></div>
Using mod_perl with BackupPC_Admin requires a dedicated Apache to be run as the
  BackupPC user (__BACKUPPCUSER__). This is because BackupPC_Admin needs
  permission to access various files in BackupPC's data directories. In
  contrast, the standard installation (without mod_perl) solves this problem by
  having BackupPC_Admin installed as setuid to the BackupPC user, so that
  BackupPC_Admin runs as the BackupPC user.
<div class="Pp"></div>
Here are some specifics for each setup:
<dl class="Bl-tag">
  <dt class="It-tag">Standard Setup</dt>
  <dd class="It-tag">The CGI interface should have been installed by the
      configure.pl script in __CGIDIR__/BackupPC_Admin. BackupPC_Admin should
      have been installed as setuid to the BackupPC user (__BACKUPPCUSER__), in
      addition to user and group execute permission.
    <div style="height: 1.00em;">&#x00A0;</div>
    You should be very careful about permissions on BackupPC_Admin and the
      directory __CGIDIR__: it is important that normal users cannot directly
      execute or change BackupPC_Admin, otherwise they can access backup files
      for any PC. You might need to change the group ownership of BackupPC_Admin
      to a group that Apache belongs to so that Apache can execute it (don't add
      &quot;other&quot; execute permission!). The permissions should look like
      this:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    ls -l __CGIDIR__/BackupPC_Admin
    -swxr-x---    1 __BACKUPPCUSER__   web      82406 Jun 17 22:58 __CGIDIR__/BackupPC_Admin
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    The setuid script won't work unless perl on your machine was installed with
      setuid emulation. This is likely the problem if you get an error saying
      such as &quot;Wrong user: my userid is 25, instead of 150&quot;, meaning
      the script is running as the httpd user, not the BackupPC user. This is
      because setuid scripts are disabled by the kernel in most flavors of unix
      and linux.
    <div style="height: 1.00em;">&#x00A0;</div>
    To see if your perl has setuid emulation, see if there is a program called
      sperl5.8.0 (or sperl5.8.2 etc, based on your perl version) in the place
      where perl is installed. If you can't find this program, then you have two
      options: rebuild and reinstall perl with the setuid emulation turned on
      (answer &quot;y&quot; to the question &quot;Do you want to do
      setuid/setgid emulation?&quot; when you run perl's configure script), or
      switch to the mod_perl alternative for the CGI script (which doesn't need
      setuid to work).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Mod_perl Setup</dt>
  <dd class="It-tag">The advantage of the mod_perl setup is that no setuid
      script is needed, and there is a huge performance advantage. Not only does
      all the perl code need to be parsed just once, the config.pl and hosts
      files, plus the connection to the BackupPC server are cached between
      requests. The typical speedup is around 15 times.
    <div style="height: 1.00em;">&#x00A0;</div>
    To use mod_perl you need to run Apache as user __BACKUPPCUSER__. If you need
      to run multiple Apache's for different services then you need to create
      multiple top-level Apache directories, each with their own config file.
      You can make copies of /etc/init.d/httpd and use the -d option to httpd to
      point each http to a different top-level directory. Or you can use the -f
      option to explicitly point to the config file. Multiple Apache's will run
      on different Ports (eg: 80 is standard, 8080 is a typical alternative port
      accessed via http://yourhost.com:8080).
    <div style="height: 1.00em;">&#x00A0;</div>
    Inside BackupPC's Apache http.conf file you should check the settings for
      ServerRoot, DocumentRoot, User, Group, and Port. See
      &lt;http://httpd.apache.org/docs/server-wide.html&gt; for more details.
    <div style="height: 1.00em;">&#x00A0;</div>
    For mod_perl, BackupPC_Admin should not have setuid permission, so you
      should turn it off:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    chmod u-s __CGIDIR__/BackupPC_Admin
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    To tell Apache to use mod_perl to execute BackupPC_Admin, add this to
      Apache's 1.x httpd.conf file:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    &lt;IfModule mod_perl.c&gt;
        PerlModule Apache::Registry
        PerlTaintCheck On
        &lt;Location /cgi-bin/BackupPC/BackupPC_Admin&gt;   # &lt;--- change path as needed
           SetHandler perl-script
           PerlHandler Apache::Registry
           Options ExecCGI
           PerlSendHeader On
        &lt;/Location&gt;
    &lt;/IfModule&gt;
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Apache 2.0.44 with Perl 5.8.0 on RedHat 7.1, Don Silvia reports that this
      works (with tweaks from Michael Tuzi):
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    LoadModule perl_module modules/mod_perl.so
    PerlModule Apache2
    &lt;Directory /path/to/cgi/&gt;
        SetHandler perl-script
        PerlResponseHandler ModPerl::Registry
        PerlOptions +ParseHeaders
        Options +ExecCGI
        Order deny,allow
        Deny from all
        Allow from 192.168.0  
        AuthName &quot;Backup Admin&quot;
        AuthType Basic
        AuthUserFile /path/to/user_file
        Require valid-user
    &lt;/Directory&gt;
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    There are other optimizations and options with mod_perl. For example, you
      can tell mod_perl to preload various perl modules, which saves memory
      compared to loading separate copies in every Apache process after they are
      forked. See Stas's definitive mod_perl guide at
      &lt;http://perl.apache.org/guide&gt;.</dd>
</dl>
<div class="Pp"></div>
BackupPC_Admin requires that users are authenticated by Apache. Specifically, it
  expects that Apache sets the REMOTE_USER environment variable when it runs.
  There are several ways to do this. One way is to create a .htaccess file in
  the cgi-bin directory that looks like:
<div class="Pp"></div>
<pre>
    AuthGroupFile /etc/httpd/conf/group    # &lt;--- change path as needed
    AuthUserFile /etc/http/conf/passwd     # &lt;--- change path as needed
    AuthType basic
    AuthName &quot;access&quot;
    require valid-user
</pre>
<div class="Pp"></div>
You will also need &quot;AllowOverride Indexes AuthConfig&quot; in the Apache
  httpd.conf file to enable the .htaccess file. Alternatively, everything can go
  in the Apache httpd.conf file inside a Location directive. The list of users
  and password file above can be extracted from the NIS passwd file.
<div class="Pp"></div>
One alternative is to use LDAP. In Apache's http.conf add these lines:
<div class="Pp"></div>
<pre>
    LoadModule auth_ldap_module   modules/auth_ldap.so
    AddModule auth_ldap.c
    # cgi-bin - auth via LDAP (for BackupPC)
    &lt;Location /cgi-binBackupPC/BackupPC_Admin&gt;    # &lt;--- change path as needed
      AuthType Basic
      AuthName &quot;BackupPC login&quot;
      # replace MYDOMAIN, PORT, ORG and CO as needed
      AuthLDAPURL ldap://ldap.MYDOMAIN.com:PORT/o=ORG,c=CO?uid?sub?(objectClass=*)
      require valid-user
    &lt;/Location&gt;
</pre>
<div class="Pp"></div>
If you want to disable the user authentication you can set $Conf{CgiAdminUsers}
  to '*', which allows any user to have full access to all hosts and backups. In
  this case the REMOTE_USER environment variable does not have to be set by
  Apache.
<div class="Pp"></div>
Alternatively, you can force a particular user name by getting Apache to set
  REMOTE_USER, eg, to hardcode the user to www you could add this to Apache's
  httpd.conf:
<div class="Pp"></div>
<pre>
    &lt;Location /cgi-bin/BackupPC/BackupPC_Admin&gt;   # &lt;--- change path as needed
        Setenv REMOTE_USER www
    &lt;/Location&gt;
</pre>
<div class="Pp"></div>
Finally, you should also edit the config.pl file and adjust, as necessary, the
  CGI-specific settings. They're near the end of the config file. In particular,
  you should specify which users or groups have administrator (privileged)
  access: see the config settings $Conf{CgiAdminUserGroup} and
  $Conf{CgiAdminUsers}. Also, the configure.pl script placed various images into
  $Conf{CgiImageDir} that BackupPC_Admin needs to serve up. You should make sure
  that $Conf{CgiImageDirURL} is the correct URL for the image directory.
<div class="Pp"></div>
See the section &quot;Fixing installation problems&quot; for suggestions on
  debugging the Apache authentication setup.
<h2 class="Ss" title="Ss" id="How_BackupPC_Finds_Hosts"><a class="selflink" href="#How_BackupPC_Finds_Hosts">How
  BackupPC Finds Hosts</a></h2>
Starting with v2.0.0 the way hosts are discovered has changed. In most cases you
  should specify 0 for the DHCP flag in the conf/hosts file, even if the host
  has a dynamically assigned IP address.
<div class="Pp"></div>
BackupPC (starting with v2.0.0) looks up hosts with DHCP = 0 in this manner:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">First DNS is used to lookup the IP address given the
      client's name using perl's <i>gethostbyname()</i> function. This should
      succeed for machines that have fixed IP addresses that are known via DNS.
      You can manually see whether a given host have a DNS entry according to
      perl's gethostbyname function with this command:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    perl -e 'print(gethostbyname(&quot;myhost&quot;) ? &quot;ok\n&quot; : &quot;not found\n&quot;);'
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">If <i>gethostbyname()</i> fails, BackupPC then attempts a
      NetBios multicast to find the host. Provided your client machine is
      configured properly, it should respond to this NetBios multicast request.
      Specifically, BackupPC runs a command of this form:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    nmblookup myhost
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    If this fails you will see output like:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    querying myhost on 10.10.255.255
    name_query failed to find name myhost
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    If it is successful you will see output like:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    querying myhost on 10.10.255.255
    10.10.1.73 myhost&lt;00&gt;
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Depending on your netmask you might need to specify the -B option to
      nmblookup. For example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    nmblookup -B 10.10.1.255 myhost
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    If necessary, experiment with the nmblookup command which will return the IP
      address of the client given its name. Then update
      $Conf{NmbLookupFindHostCmd} with any necessary options to nmblookup.</dd>
</dl>
<div class="Pp"></div>
For hosts that have the DHCP flag set to 1, these machines are discovered as
  follows:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">A DHCP address pool ($Conf{DHCPAddressRanges}) needs to be
      specified. BackupPC will check the NetBIOS name of each machine in the
      range using a command of the form:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    nmblookup -A W.X.Y.Z
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    where W.X.Y.Z is each candidate address from $Conf{DHCPAddressRanges}. Any
      host that has a valid NetBIOS name returned by this command (ie: matching
      an entry in the hosts file) will be backed up. You can modify the specific
      nmblookup command if necessary via $Conf{NmbLookupCmd}.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">You only need to use this DHCP feature if your client
      machine doesn't respond to the NetBios multicast request:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    nmblookup myHost
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    but does respond to a request directed to its IP address:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    nmblookup -A W.X.Y.Z
    </pre>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="Other_installation_topics"><a class="selflink" href="#Other_installation_topics">Other
  installation topics</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">Removing a client</dt>
  <dd class="It-tag">If there is a machine that no longer needs to be backed up
      (eg: a retired machine) you have two choices. First, you can keep the
      backups accessible and browsable, but disable all new backups.
      Alternatively, you can completely remove the client and all its backups.
    <div style="height: 1.00em;">&#x00A0;</div>
    To disable backups for a client $Conf{BackupsDisable} can be set to two
      different values in that client's per-PC config.pl file:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">1.</dt>
  <dd class="It-tag">Don't do any regular backups on this machine. Manually
      requested backups (via the CGI interface) will still occur.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">2.</dt>
  <dd class="It-tag">Don't do any backups on this machine. Manually requested
      backups (via the CGI interface) will be ignored.</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
This will still allow the client's old backups to be browsable and restorable.
<div style="height: 1.00em;">&#x00A0;</div>
To completely remove a client and all its backups, you should remove its entry
  in the conf/hosts file, and then delete the __TOPDIR__/pc/$host directory.
  Whenever you change the hosts file, you should send BackupPC a HUP (-1) signal
  so that it re-reads the hosts file. If you don't do this, BackupPC will
  automatically re-read the hosts file at the next regular wakeup.
<div style="height: 1.00em;">&#x00A0;</div>
Note that when you remove a client's backups you won't initially recover much
  disk space. That's because the client's files are still in the pool.
  Overnight, when BackupPC_nightly next runs, all the unused pool files will be
  deleted and this will recover the disk space used by the client's
  backups.</div>
<dl class="Bl-tag">
  <dt class="It-tag">Copying the pool</dt>
  <dd class="It-tag">If the pool disk requirements grow you might need to copy
      the entire data directory to a new (bigger) file system. Hopefully you are
      lucky enough to avoid this by having the data directory on a RAID file
      system or LVM that allows the capacity to be grown in place by adding
      disks.
    <div style="height: 1.00em;">&#x00A0;</div>
    The backup data directories contain large numbers of hardlinks. If you try
      to copy the pool the target directory will occupy a lot more space if the
      hardlinks aren't re-established.
    <div style="height: 1.00em;">&#x00A0;</div>
    The best way to copy a pool file system, if possible, is by copying the raw
      device at the block level (eg: using dd). Application level programs that
      understand hardlinks include the GNU cp program with the -a option and
      rsync -H. However, the large number of hardlinks in the pool will make the
      memory usage large and the copy very slow. Don't forget to stop BackupPC
      while the copy runs.
    <div style="height: 1.00em;">&#x00A0;</div>
    Starting in 3.0.0 a new script bin/BackupPC_tarPCCopy can be used to assist
      the copy process. Given one or more pc paths (eg: TOPDIR/pc/HOST or
      TOPDIR/pc/HOST/nnn), BackupPC_tarPCCopy creates a tar archive with all the
      hardlinks pointing to ../cpool/.... Any files not hardlinked (eg: backups,
      LOG etc) are included verbatim.
    <div style="height: 1.00em;">&#x00A0;</div>
    You will need to specify the -P option to tar when you extract the archive
      generated by BackupPC_tarPCCopy since the hardlink targets are outside of
      the directory being extracted.
    <div style="height: 1.00em;">&#x00A0;</div>
    To copy a complete store (ie: __TOPDIR__) using BackupPC_tarPCCopy you
      should:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">stop BackupPC so that the store is static.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">copy the cpool, conf and log directory trees using any
      technique (like cp, rsync or tar) without the need to preserve
    hardlinks.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">copy the pc directory using BackupPC_tarPCCopy:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    su __BACKUPPCUSER__
    cd NEW_TOPDIR
    mkdir pc
    cd pc
    __INSTALLDIR__/bin/BackupPC_tarPCCopy __TOPDIR__/pc | tar xvPf -
    </pre>
  </dd>
</dl>
</div>
<div style="margin-left: 4.00ex;"></div>
<h2 class="Ss" title="Ss" id="Fixing_installation_problems"><a class="selflink" href="#Fixing_installation_problems">Fixing
  installation problems</a></h2>
Please see the Wiki at &lt;http://backuppc.wiki.sourceforge.net&gt; for
  debugging suggestions. If you find a solution to your problem that could help
  other users please add it to the Wiki!
<h1 class="Sh" title="Sh" id="Restore_functions"><a class="selflink" href="#Restore_functions">Restore
  functions</a></h1>
BackupPC supports several different methods for restoring files. The most
  convenient restore options are provided via the CGI interface. Alternatively,
  backup files can be restored using manual commands.
<h2 class="Ss" title="Ss" id="CGI_restore_options"><a class="selflink" href="#CGI_restore_options">CGI
  restore options</a></h2>
By selecting a host in the CGI interface, a list of all the backups for that
  machine will be displayed. By selecting the backup number you can navigate the
  shares and directory tree for that backup.
<div class="Pp"></div>
BackupPC's CGI interface automatically fills incremental backups with the
  corresponding full backup, which means each backup has a filled appearance.
  Therefore, there is no need to do multiple restores from the incremental and
  full backups: BackupPC does all the hard work for you. You simply select the
  files and directories you want from the correct backup vintage in one step.
<div class="Pp"></div>
You can download a single backup file at any time simply by selecting it. Your
  browser should prompt you with the file name and ask you whether to open the
  file or save it to disk.
<div class="Pp"></div>
Alternatively, you can select one or more files or directories in the currently
  selected directory and select &quot;Restore selected files&quot;. (If you need
  to restore selected files and directories from several different parent
  directories you will need to do that in multiple steps.)
<div class="Pp"></div>
If you select all the files in a directory, BackupPC will replace the list of
  files with the parent directory. You will be presented with a screen that has
  three options:
<dl class="Bl-tag">
  <dt class="It-tag">Option 1: Direct Restore</dt>
  <dd class="It-tag">With this option the selected files and directories are
      restored directly back onto the host, by default in their original
      location. Any old files with the same name will be overwritten, so use
      caution. You can optionally change the target host name, target share
      name, and target path prefix for the restore, allowing you to restore the
      files to a different location.
    <div style="height: 1.00em;">&#x00A0;</div>
    Once you select &quot;Start Restore&quot; you will be prompted one last time
      with a summary of the exact source and target files and directories before
      you commit. When you give the final go ahead the restore operation will be
      queued like a normal backup job, meaning that it will be deferred if there
      is a backup currently running for that host. When the restore job is run,
      smbclient, tar, rsync or rsyncd is used (depending upon $Conf{XferMethod})
      to actually restore the files. Sorry, there is currently no option to
      cancel a restore that has been started. Currently ftp restores are not
      fully implemented.
    <div style="height: 1.00em;">&#x00A0;</div>
    A record of the restore request, including the result and list of files and
      directories, is kept. It can be browsed from the host's home page.
      $Conf{RestoreInfoKeepCnt} specifies how many old restore status files to
      keep.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note that for direct restore to work, the $Conf{XferMethod} must be able to
      write to the client. For example, that means an SMB share for smbclient
      needs to be writable, and the rsyncd module needs &quot;read only&quot;
      set to &quot;false&quot;. This creates additional security risks. If you
      only create read-only SMB shares (which is a good idea), then the direct
      restore will fail. You can disable the direct restore option by setting
      $Conf{SmbClientRestoreCmd}, $Conf{TarClientRestoreCmd} and
      $Conf{RsyncRestoreArgs} to undef.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Option 2: Download Zip archive</dt>
  <dd class="It-tag">With this option a zip file containing the selected files
      and directories is downloaded. The zip file can then be unpacked or
      individual files extracted as necessary on the host machine. The
      compression level can be specified. A value of 0 turns off compression.
    <div style="height: 1.00em;">&#x00A0;</div>
    When you select &quot;Download Zip File&quot; you should be prompted where
      to save the restore.zip file.
    <div style="height: 1.00em;">&#x00A0;</div>
    BackupPC does not consider downloading a zip file as an actual restore
      operation, so the details are not saved for later browsing as in the first
      case. However, a mention that a zip file was downloaded by a particular
      user, and a list of the files, does appear in BackupPC's log file.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Option 3: Download Tar archive</dt>
  <dd class="It-tag">This is identical to the previous option, except a tar file
      is downloaded rather than a zip file (and there is currently no
      compression option).</dd>
</dl>
<h2 class="Ss" title="Ss" id="Command-line_restore_options"><a class="selflink" href="#Command-line_restore_options">Command-line
  restore options</a></h2>
Apart from the CGI interface, BackupPC allows you to restore files and
  directories from the command line. The following programs can be used:
<dl class="Bl-tag">
  <dt class="It-tag">BackupPC_zcat</dt>
  <dd class="It-tag">For each file name argument it inflates (uncompresses) the
      file and writes it to stdout. To use BackupPC_zcat you could give it the
      full file name, eg:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    __INSTALLDIR__/bin/BackupPC_zcat __TOPDIR__/pc/host/5/fc/fcraig/fexample.txt &gt; example.txt
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    It's your responsibility to make sure the file is really compressed:
      BackupPC_zcat doesn't check which backup the requested file is from.
      BackupPC_zcat returns a non-zero status if it fails to uncompress a
    file.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">BackupPC_tarCreate</dt>
  <dd class="It-tag">BackupPC_tarCreate creates a tar file for any files or
      directories in a particular backup. Merging of incrementals is done
      automatically, so you don't need to worry about whether certain files
      appear in the incremental or full backup.
    <div style="height: 1.00em;">&#x00A0;</div>
    The usage is:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    BackupPC_tarCreate [options] files/directories...
    Required options:
       -h host         host from which the tar archive is created
       -n dumpNum      dump number from which the tar archive is created
                       A negative number means relative to the end (eg -1
                       means the most recent dump, -2 2nd most recent etc).
       -s shareName    share name from which the tar archive is created
  
    Other options:
       -t              print summary totals
       -r pathRemove   path prefix that will be replaced with pathAdd
       -p pathAdd      new path prefix
       -b BLOCKS       BLOCKS x 512 bytes per record (default 20; same as tar)
       -w writeBufSz   write buffer size (default 1048576 = 1MB)
       -e charset      charset for encoding file names (default: value of
                       $Conf{ClientCharset} when backup was done)
       -l              just print a file listing; don't generate an archive
       -L              just print a detailed file listing; don't generate an archive
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    The command-line files and directories are relative to the specified
      shareName. The tar file is written to stdout.
    <div style="height: 1.00em;">&#x00A0;</div>
    The -h, -n and -s options specify which dump is used to generate the tar
      archive. The -r and -p options can be used to relocate the paths in the
      tar archive so extracted files can be placed in a location different from
      their original location.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">BackupPC_zipCreate</dt>
  <dd class="It-tag">BackupPC_zipCreate creates a zip file for any files or
      directories in a particular backup. Merging of incrementals is done
      automatically, so you don't need to worry about whether certain files
      appear in the incremental or full backup.
    <div style="height: 1.00em;">&#x00A0;</div>
    The usage is:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    BackupPC_zipCreate [options] files/directories...
    Required options:
       -h host         host from which the zip archive is created
       -n dumpNum      dump number from which the tar archive is created
                       A negative number means relative to the end (eg -1
                       means the most recent dump, -2 2nd most recent etc).
       -s shareName    share name from which the zip archive is created
  
    Other options:
       -t              print summary totals
       -r pathRemove   path prefix that will be replaced with pathAdd
       -p pathAdd      new path prefix
       -c level        compression level (default is 0, no compression)
       -e charset      charset for encoding file names (default: utf8)
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    The command-line files and directories are relative to the specified
      shareName. The zip file is written to stdout. The -h, -n and -s options
      specify which dump is used to generate the zip archive. The -r and -p
      options can be used to relocate the paths in the zip archive so extracted
      files can be placed in a location different from their original
    location.</dd>
</dl>
<div class="Pp"></div>
Each of these programs reside in __INSTALLDIR__/bin.
<h1 class="Sh" title="Sh" id="Archive_functions"><a class="selflink" href="#Archive_functions">Archive
  functions</a></h1>
BackupPC supports archiving to removable media. For users that require offsite
  backups, BackupPC can create archives that stream to tape devices, or create
  files of specified sizes to fit onto cd or dvd media.
<div class="Pp"></div>
Each archive type is specified by a BackupPC host with its XferMethod set to
  'archive'. This allows for multiple configurations at sites where there might
  be a combination of tape and cd/dvd backups being made.
<div class="Pp"></div>
BackupPC provides a menu that allows one or more hosts to be archived. The most
  recent backup of each host is archived using BackupPC_tarCreate, and the
  output is optionally compressed and split into fixed-sized files (eg: 650MB).
<div class="Pp"></div>
The archive for each host is done by default using
  __INSTALLDIR__/bin/BackupPC_archiveHost. This script can be copied and
  customized as needed.
<h2 class="Ss" title="Ss" id="Configuring_an_Archive_Host"><a class="selflink" href="#Configuring_an_Archive_Host">Configuring
  an Archive Host</a></h2>
To create an Archive Host, add it to the hosts file just as any other host and
  call it a name that best describes the type of archive, e.g. ArchiveDLT
<div class="Pp"></div>
To tell BackupPC that the Host is for Archives, create a config.pl file in the
  Archive Hosts's pc directory, adding the following line:
<div class="Pp"></div>
$Conf{XferMethod} = 'archive';
<div class="Pp"></div>
To further customise the archive's parameters you can adding the changed
  parameters in the host's config.pl file. The parameters are explained in the
  config.pl file. Parameters may be fixed or the user can be allowed to change
  them (eg: output device).
<div class="Pp"></div>
The per-host archive command is $Conf{ArchiveClientCmd}. By default this invokes
<div class="Pp"></div>
<pre>
     __INSTALLDIR__/bin/BackupPC_archiveHost
</pre>
<div class="Pp"></div>
which you can copy and customize as necessary.
<h2 class="Ss" title="Ss" id="Starting_an_Archive"><a class="selflink" href="#Starting_an_Archive">Starting
  an Archive</a></h2>
In the web interface, click on the Archive Host you wish to use. You will see a
  list of previous archives and a summary on each. By clicking the &quot;Start
  Archive&quot; button you are presented with the list of hosts and the
  approximate backup size (note this is raw size, not projected compressed size)
  Select the hosts you wish to archive and press the &quot;Archive Selected
  Hosts&quot; button.
<div class="Pp"></div>
The next screen allows you to adjust the parameters for this archive run. Press
  the &quot;Start the Archive&quot; to start archiving the selected hosts with
  the parameters displayed.
<h2 class="Ss" title="Ss" id="Starting_an_Archive_from_the_command_line"><a class="selflink" href="#Starting_an_Archive_from_the_command_line">Starting
  an Archive from the command line</a></h2>
The script BackupPC_archiveStart can be used to start an archive from the
  command line (or cron etc). The usage is:
<div class="Pp"></div>
<pre>
    BackupPC_archiveStart archiveHost userName hosts...
</pre>
<div class="Pp"></div>
This creates an archive of the most recent backup of each of the specified
  hosts. The first two arguments are the archive host and the user name making
  the request.
<h1 class="Sh" title="Sh" id="Other_CGI_Functions"><a class="selflink" href="#Other_CGI_Functions">Other
  CGI Functions</a></h1>
<h2 class="Ss" title="Ss" id="Configuration_and_Host_Editor"><a class="selflink" href="#Configuration_and_Host_Editor">Configuration
  and Host Editor</a></h2>
The CGI interface has a complete configuration and host editor. Only the
  administrator can edit the main configuration settings and hosts. The edit
  links are in the left navigation bar.
<div class="Pp"></div>
When changes are made to any parameter a &quot;Save&quot; button appears at the
  top of the page. If you are editing a text box you will need to click outside
  of the text box to make the Save button appear. If you don't select Save then
  the changes won't be saved.
<div class="Pp"></div>
The host-specific configuration can be edited from the host summary page using
  the link in the left navigation bar. The administrator can edit any of the
  host-specific configuration settings.
<div class="Pp"></div>
When editing the host-specific configuration, each parameter has an
  &quot;override&quot; setting that denotes the value is host-specific, meaning
  that it overrides the setting in the main configuration. If you unselect
  &quot;override&quot; then the setting is removed from the host-specific
  configuration, and the main configuration file is displayed.
<div class="Pp"></div>
User's can edit their host-specific configuration if enabled via
  $Conf{CgiUserConfigEditEnable}. The specific subset of configuration settings
  that a user can edit is specified with $Conf{CgiUserConfigEdit}. It is
  recommended to make this list short as possible (you probably don't want your
  users saving dozens of backups) and it is essential that they can't edit any
  of the Cmd configuration settings, otherwise they can specify an arbitrary
  command that will be executed as the BackupPC user.
<h2 class="Ss" title="Ss" id="RSS"><a class="selflink" href="#RSS">RSS</a></h2>
BackupPC supports a very basic RSS feed. Provided you have the XML::RSS perl
  module installed, a URL similar to this will provide RSS information:
<div class="Pp"></div>
<pre>
    http://localhost/cgi-bin/BackupPC/BackupPC_Admin?action=rss
</pre>
<div class="Pp"></div>
This feature is experimental. The information included will probably change.
<h1 class="Sh" title="Sh" id="BackupPC_Design"><a class="selflink" href="#BackupPC_Design">BackupPC
  Design</a></h1>
<h2 class="Ss" title="Ss" id="Some_design_issues"><a class="selflink" href="#Some_design_issues">Some
  design issues</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">Pooling common files</dt>
  <dd class="It-tag">To quickly see if a file is already in the pool, an MD5
      digest of the file length and contents is used as the file name in the
      pool. This can't guarantee a file is identical: it just reduces the search
      to often a single file or handful of files. A complete file comparison is
      always done to verify if two files are really the same.
    <div style="height: 1.00em;">&#x00A0;</div>
    Identical files on multiples backups are represented by hard links.
      Hardlinks are used so that identical files all refer to the same physical
      file on the server's disk. Also, hard links maintain reference counts so
      that BackupPC knows when to delete unused files from the pool.
    <div style="height: 1.00em;">&#x00A0;</div>
    For the computer-science majors among you, you can think of the pooling
      system used by BackupPC as just a chained hash table stored on a (big)
      file system.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">The hashing function</dt>
  <dd class="It-tag">There is a tradeoff between how much of file is used for
      the MD5 digest and the time taken comparing all the files that have the
      same hash.
    <div style="height: 1.00em;">&#x00A0;</div>
    Using the file length and just the first 4096 bytes of the file for the MD5
      digest produces some repetitions. One example: with 900,000 unique files
      in the pool, this hash gives about 7,000 repeated files, and in the worst
      case 500 files have the same hash. That's not bad: we only have to do a
      single file compare 99.2% of the time. But in the worst case we have to
      compare as many as 500 files checking for a match.
    <div style="height: 1.00em;">&#x00A0;</div>
    With a modest increase in CPU time, if we use the file length and the first
      256K of the file we now only have 500 repeated files and in the worst case
      around 20 files have the same hash. Furthermore, if we instead use the
      first and last 128K of the file (more specifically, the first and eighth
      128K chunks for files larger than 1MB) we get only 300 repeated files and
      in the worst case around 20 files have the same hash.
    <div style="height: 1.00em;">&#x00A0;</div>
    Based on this experimentation, this is the hash function used by BackupPC.
      It is important that you don't change the hash function after files are
      already in the pool. Otherwise your pool will grow to twice the size until
      all the old backups (and all the old files with old hashes) eventually
      expire.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Compression</dt>
  <dd class="It-tag">BackupPC supports compression. It uses the deflate and
      inflate methods in the Compress::Zlib module, which is based on the zlib
      compression library (see &lt;http://www.gzip.org/zlib/&gt;).
    <div style="height: 1.00em;">&#x00A0;</div>
    The $Conf{CompressLevel} setting specifies the compression level to use.
      Zero (0) means no compression. Compression levels can be from 1 (least cpu
      time, slightly worse compression) to 9 (most cpu time, slightly better
      compression). The recommended value is 3. Changing it to 5, for example,
      will take maybe 20% more cpu time and will get another 2-3% additional
      compression. Diminishing returns set in above 5. See the zlib
      documentation for more information about compression levels.
    <div style="height: 1.00em;">&#x00A0;</div>
    BackupPC implements compression with minimal CPU load. Rather than
      compressing every incoming backup file and then trying to match it against
      the pool, BackupPC computes the MD5 digest based on the uncompressed file,
      and matches against the candidate pool files by comparing each
      uncompressed pool file against the incoming backup file. Since inflating a
      file takes roughly a factor of 10 less CPU time than deflating there is a
      big saving in CPU time.
    <div style="height: 1.00em;">&#x00A0;</div>
    The combination of pooling common files and compression can yield a factor
      of 8 or more overall saving in backup storage.</dd>
</dl>
<h2 class="Ss" title="Ss" id="BackupPC_operation"><a class="selflink" href="#BackupPC_operation">BackupPC
  operation</a></h2>
BackupPC reads the configuration information from __CONFDIR__/config.pl. It then
  runs and manages all the backup activity. It maintains queues of pending
  backup requests, user backup requests and administrative commands. Based on
  the configuration various requests will be executed simultaneously.
<div class="Pp"></div>
As specified by $Conf{WakeupSchedule}, BackupPC wakes up periodically to queue
  backups on all the PCs. This is a four step process:
<dl class="Bl-tag">
  <dt class="It-tag">1.</dt>
  <dd class="It-tag">For each host and DHCP address backup requests are queued
      on the background command queue.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">2.</dt>
  <dd class="It-tag">For each PC, BackupPC_dump is forked. Several of these may
      be run in parallel, based on the configuration. First a ping is done to
      see if the machine is alive. If this is a DHCP address, nmblookup is run
      to get the netbios name, which is used as the host name. If DNS lookup
      fails, $Conf{NmbLookupFindHostCmd} is run to find the IP address from the
      host name. The file __TOPDIR__/pc/$host/backups is read to decide whether
      a full or incremental backup needs to be run. If no backup is scheduled,
      or the ping to $host fails, then BackupPC_dump exits.
    <div style="height: 1.00em;">&#x00A0;</div>
    The backup is done using the specified XferMethod. Either samba's smbclient
      or tar over ssh/rsh/nfs piped into BackupPC_tarExtract, or rsync over
      ssh/rsh is run, or rsyncd is connected to, with the incoming data
      extracted to __TOPDIR__/pc/$host/new. The XferMethod output is put into
      __TOPDIR__/pc/$host/XferLOG.
    <div style="height: 1.00em;">&#x00A0;</div>
    The letter in the XferLOG file shows the type of object, similar to the
      first letter of the modes displayed by ls -l:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    d -&gt; directory
    l -&gt; symbolic link
    b -&gt; block special file
    c -&gt; character special file
    p -&gt; pipe file (fifo)
    nothing -&gt; regular file
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    The words mean:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">create</dt>
  <dd class="It-tag">new for this backup (ie: directory or file not in
    pool)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">pool</dt>
  <dd class="It-tag">found a match in the pool</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">same</dt>
  <dd class="It-tag">file is identical to previous backup (contents were
      checksummed and verified during full dump).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">skip</dt>
  <dd class="It-tag">file skipped in incremental because attributes are the same
      (only displayed if $Conf{XferLogLevel} &gt;= 2).</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
As BackupPC_tarExtract extracts the files from smbclient or tar, or as rsync or
  ftp runs, it checks each file in the backup to see if it is identical to an
  existing file from any previous backup of any PC. It does this without needed
  to write the file to disk. If the file matches an existing file, a hardlink is
  created to the existing file in the pool. If the file does not match any
  existing files, the file is written to disk and the file name is saved in
  __TOPDIR__/pc/$host/NewFileList for later processing by BackupPC_link.
  BackupPC_tarExtract and rsync can handle arbitrarily large files and multiple
  candidate matching files without needing to write the file to disk in the case
  of a match. This significantly reduces disk writes (and also reads, since the
  pool file comparison is done disk to memory, rather than disk to disk).
<div style="height: 1.00em;">&#x00A0;</div>
Based on the configuration settings, BackupPC_dump checks each old backup to see
  if any should be removed. Any expired backups are moved to __TOPDIR__/trash
  for later removal by BackupPC_trashClean.</div>
<dl class="Bl-tag">
  <dt class="It-tag">3.</dt>
  <dd class="It-tag">For each complete, good, backup, BackupPC_link is run. To
      avoid race conditions as new files are linked into the pool area, only a
      single BackupPC_link program runs at a time and the rest are queued.
    <div style="height: 1.00em;">&#x00A0;</div>
    BackupPC_link reads the NewFileList written by BackupPC_dump and inspects
      each new file in the backup. It re-checks if there is a matching file in
      the pool (another BackupPC_link could have added the file since
      BackupPC_dump checked). If so, the file is removed and replaced by a hard
      link to the existing file. If the file is new, a hard link to the file is
      made in the pool area, so that this file is available for checking against
      each new file and new backup.
    <div style="height: 1.00em;">&#x00A0;</div>
    Then, if $Conf{IncrFill} is set (note that the default setting is off), for
      each incremental backup, hard links are made in the new backup to all
      files that were not extracted during the incremental backups. The means
      the incremental backup looks like a complete image of the PC (with the
      exception that files that were removed on the PC since the last full
      backup will still appear in the backup directory tree).
    <div style="height: 1.00em;">&#x00A0;</div>
    The CGI interface knows how to merge unfilled incremental backups will the
      most recent prior filled (full) backup, giving the incremental backups a
      filled appearance. The default for $Conf{IncrFill} is off, since there is
      no need to fill incremental backups. This saves some level of disk
      activity, since lots of extra hardlinks are no longer needed (and don't
      have to be deleted when the backup expires).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">4.</dt>
  <dd class="It-tag">BackupPC_trashClean is always run in the background to
      remove any expired backups. Every 5 minutes it wakes up and removes all
      the files in __TOPDIR__/trash.
    <div style="height: 1.00em;">&#x00A0;</div>
    Also, once each night, BackupPC_nightly is run to complete some additional
      administrative tasks, such as cleaning the pool. This involves removing
      any files in the pool that only have a single hard link (meaning no
      backups are using that file). Again, to avoid race conditions,
      BackupPC_nightly is only run when there are no BackupPC_link processes
      running. When BackupPC_nightly is run no new BackupPC_link jobs are
      started. If BackupPC_nightly takes too long to run, the settings
      $Conf{MaxBackupPCNightlyJobs} and $Conf{BackupPCNightlyPeriod} can be used
      to run several BackupPC_nightly processes in parallel, and to split its
      job over several nights.</dd>
</dl>
<div class="Pp"></div>
BackupPC also listens for TCP connections on $Conf{ServerPort}, which is used by
  the CGI script BackupPC_Admin for status reporting and user-initiated backup
  or backup cancel requests.
<h2 class="Ss" title="Ss" id="Storage_layout"><a class="selflink" href="#Storage_layout">Storage
  layout</a></h2>
BackupPC resides in several directories:
<dl class="Bl-tag">
  <dt class="It-tag">__INSTALLDIR__</dt>
  <dd class="It-tag">Perl scripts comprising BackupPC reside in
      __INSTALLDIR__/bin, libraries are in __INSTALLDIR__/lib and documentation
      is in __INSTALLDIR__/doc.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">__CGIDIR__</dt>
  <dd class="It-tag">The CGI script BackupPC_Admin resides in this cgi binary
      directory.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">__CONFDIR__</dt>
  <dd class="It-tag">All the configuration information resides below
      __CONFDIR__. This directory contains:
    <div style="height: 1.00em;">&#x00A0;</div>
    The directory __CONFDIR__ contains:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">config.pl</dt>
  <dd class="It-tag">Configuration file. See &quot;Configuration File&quot;
      below for more details.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">hosts</dt>
  <dd class="It-tag">Hosts file, which lists all the PCs to backup.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">pc</dt>
  <dd class="It-tag">The directory __CONFDIR__/pc contains per-client
      configuration files that override settings in the main configuration file.
      Each file is named __CONFDIR__/pc/HOST.pl, where HOST is the host name.
    <div style="height: 1.00em;">&#x00A0;</div>
    In pre-FHS versions of BackupPC these files were located in
      __TOPDIR__/pc/HOST/config.pl.</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;"></div>
<dl class="Bl-tag">
  <dt class="It-tag">__LOGDIR__</dt>
  <dd class="It-tag">The directory __LOGDIR__ (__TOPDIR__/log on pre-FHS
      versions of BackupPC) contains:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">LOG</dt>
  <dd class="It-tag">Current (today's) log file output from BackupPC.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">LOG.0 or LOG.0.z</dt>
  <dd class="It-tag">Yesterday's log file output. Log files are aged daily and
      compressed (if compression is enabled), and old LOG files are
    deleted.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">BackupPC.pid</dt>
  <dd class="It-tag">Contains BackupPC's process id.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">status.pl</dt>
  <dd class="It-tag">A summary of BackupPC's status written periodically by
      BackupPC so that certain state information can be maintained if BackupPC
      is restarted. Should not be edited.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">UserEmailInfo.pl</dt>
  <dd class="It-tag">A summary of what email was last sent to each user, and
      when the last email was sent. Should not be edited.</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;"></div>
<dl class="Bl-tag">
  <dt class="It-tag">__TOPDIR__</dt>
  <dd class="It-tag">All of BackupPC's data (PC backup images, logs,
      configuration information) is stored below this directory.
    <div style="height: 1.00em;">&#x00A0;</div>
    Below __TOPDIR__ are several directories:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">__TOPDIR__/trash</dt>
  <dd class="It-tag">Any directories and files below this directory are
      periodically deleted whenever BackupPC_trashClean checks. When a backup is
      aborted or when an old backup expires, BackupPC_dump simply moves the
      directory to __TOPDIR__/trash for later removal by
    BackupPC_trashClean.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">__TOPDIR__/pool</dt>
  <dd class="It-tag">All uncompressed files from PC backups are stored below
      __TOPDIR__/pool. Each file's name is based on the MD5 hex digest of the
      file contents. Specifically, for files less than 256K, the file length and
      the entire file is used. For files up to 1MB, the file length and the
      first and last 128K are used. Finally, for files longer than 1MB, the file
      length, and the first and eighth 128K chunks for the file are used.
    <div style="height: 1.00em;">&#x00A0;</div>
    Each file is stored in a subdirectory X/Y/Z, where X, Y, Z are the first 3
      hex digits of the MD5 digest.
    <div style="height: 1.00em;">&#x00A0;</div>
    For example, if a file has an MD5 digest of 123456789abcdef0, the file is
      stored in __TOPDIR__/pool/1/2/3/123456789abcdef0.
    <div style="height: 1.00em;">&#x00A0;</div>
    The MD5 digest might not be unique (especially since not all the file's
      contents are used for files bigger than 256K). Different files that have
      the same MD5 digest are stored with a trailing suffix &quot;_n&quot; where
      n is an incrementing number starting at 0. So, for example, if two
      additional files were identical to the first, except the last byte was
      different, and assuming the file was larger than 1MB (so the MD5 digests
      are the same but the files are actually different), the three files would
      be stored as:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
        __TOPDIR__/pool/1/2/3/123456789abcdef0
        __TOPDIR__/pool/1/2/3/123456789abcdef0_0
        __TOPDIR__/pool/1/2/3/123456789abcdef0_1
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Both BackupPC_dump (actually, BackupPC_tarExtract) and BackupPC_link are
      responsible for checking newly backed up files against the pool. For each
      file, the MD5 digest is used to generate a file name in the pool
      directory. If the file exists in the pool, the contents are compared. If
      there is no match, additional files ending in &quot;_n&quot; are checked.
      (Actually, BackupPC_tarExtract compares multiple candidate files in
      parallel.) If the file contents exactly match, the file is created by
      simply making a hard link to the pool file (this is done by
      BackupPC_tarExtract as the backup proceeds). Otherwise,
      BackupPC_tarExtract writes the new file to disk and a new hard link is
      made in the pool to the file (this is done later by BackupPC_link).
    <div style="height: 1.00em;">&#x00A0;</div>
    Therefore, every file in the pool will have at least 2 hard links (one for
      the pool file and one for the backup file below __TOPDIR__/pc). Identical
      files from different backups or PCs will all be linked to the same file.
      When old backups are deleted, some files in the pool might only have one
      link. BackupPC_nightly checks the entire pool and removes all files that
      have only a single link, thereby recovering the storage for that file.
    <div style="height: 1.00em;">&#x00A0;</div>
    One other issue: zero length files are not pooled, since there are a lot of
      these files and on most file systems it doesn't save any disk space to
      turn these files into hard links.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">__TOPDIR__/cpool</dt>
  <dd class="It-tag">All compressed files from PC backups are stored below
      __TOPDIR__/cpool. Its layout is the same as __TOPDIR__/pool, and the
      hashing function is the same (and, importantly, based on the uncompressed
      file, not the compressed file).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">__TOPDIR__/pc/$host</dt>
  <dd class="It-tag">For each PC $host, all the backups for that PC are stored
      below the directory __TOPDIR__/pc/$host. This directory contains the
      following files:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">LOG</dt>
  <dd class="It-tag">Current log file for this PC from BackupPC_dump.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">LOG.DDMMYYYY or LOG.DDMMYYYY.z</dt>
  <dd class="It-tag">Last month's log file. Log files are aged monthly and
      compressed (if compression is enabled), and old LOG files are deleted. In
      earlier versions of BackupPC these files used to have a suffix of 0, 1,
      ....</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">XferERR or XferERR.z</dt>
  <dd class="It-tag">Output from the transport program (ie: smbclient, tar,
      rsync or ftp) for the most recent failed backup.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">new</dt>
  <dd class="It-tag">Subdirectory in which the current backup is stored. This
      directory is renamed if the backup succeeds.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">XferLOG or XferLOG.z</dt>
  <dd class="It-tag">Output from the transport program (ie: smbclient, tar,
      rsync or ftp) for the current backup.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">nnn (an integer)</dt>
  <dd class="It-tag">Successful backups are in directories numbered sequentially
      starting at 0.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">XferLOG.nnn or XferLOG.nnn.z</dt>
  <dd class="It-tag">Output from the transport program (ie: smbclient, tar,
      rsync or ftp) corresponding to backup number nnn.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">RestoreInfo.nnn</dt>
  <dd class="It-tag">Information about restore request #nnn including who, what,
      when, and why. This file is in Data::Dumper format. (Note that the restore
      numbers are not related to the backup number.)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">RestoreLOG.nnn.z</dt>
  <dd class="It-tag">Output from smbclient, tar or rsync during restore #nnn.
      (Note that the restore numbers are not related to the backup number.)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">ArchiveInfo.nnn</dt>
  <dd class="It-tag">Information about archive request #nnn including who, what,
      when, and why. This file is in Data::Dumper format. (Note that the archive
      numbers are not related to the restore or backup number.)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">ArchiveLOG.nnn.z</dt>
  <dd class="It-tag">Output from archive #nnn. (Note that the archive numbers
      are not related to the backup or restore number.)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">config.pl</dt>
  <dd class="It-tag">Old location of optional configuration settings specific to
      this host. Settings in this file override the main configuration file. In
      new versions of BackupPC the per-host configuration files are stored in
      __CONFDIR__/pc/HOST.pl.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">backups</dt>
  <dd class="It-tag">A tab-delimited ascii table listing information about each
      successful backup, one per row. The columns are:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">num</dt>
  <dd class="It-tag">The backup number, an integer that starts at 0 and
      increments for each successive backup. The corresponding backup is stored
      in the directory num (eg: if this field is 5, then the backup is stored in
      __TOPDIR__/pc/$host/5).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">type</dt>
  <dd class="It-tag">Set to &quot;full&quot; or &quot;incr&quot; for full or
      incremental backup.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">startTime</dt>
  <dd class="It-tag">Start time of the backup in unix seconds.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">endTime</dt>
  <dd class="It-tag">Stop time of the backup in unix seconds.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">nFiles</dt>
  <dd class="It-tag">Number of files backed up (as reported by smbclient, tar,
      rsync or ftp).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">size</dt>
  <dd class="It-tag">Total file size backed up (as reported by smbclient, tar,
      rsync or ftp).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">nFilesExist</dt>
  <dd class="It-tag">Number of files that were already in the pool (as
      determined by BackupPC_dump and BackupPC_link).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">sizeExist</dt>
  <dd class="It-tag">Total size of files that were already in the pool (as
      determined by BackupPC_dump and BackupPC_link).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">nFilesNew</dt>
  <dd class="It-tag">Number of files that were not in the pool (as determined by
      BackupPC_link).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">sizeNew</dt>
  <dd class="It-tag">Total size of files that were not in the pool (as
      determined by BackupPC_link).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">xferErrs</dt>
  <dd class="It-tag">Number of errors or warnings from smbclient, tar, rsync or
      ftp.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">xferBadFile</dt>
  <dd class="It-tag">Number of errors from smbclient that were bad file errors
      (zero otherwise).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">xferBadShare</dt>
  <dd class="It-tag">Number of errors from smbclient that were bad share errors
      (zero otherwise).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">tarErrs</dt>
  <dd class="It-tag">Number of errors from BackupPC_tarExtract.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">compress</dt>
  <dd class="It-tag">The compression level used on this backup. Zero or empty
      means no compression.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">sizeExistComp</dt>
  <dd class="It-tag">Total compressed size of files that were already in the
      pool (as determined by BackupPC_dump and BackupPC_link).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">sizeNewComp</dt>
  <dd class="It-tag">Total compressed size of files that were not in the pool
      (as determined by BackupPC_link).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">noFill</dt>
  <dd class="It-tag">Set if this backup has not been filled in with the most
      recent previous filled or full backup. See $Conf{IncrFill}.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">fillFromNum</dt>
  <dd class="It-tag">If this backup was filled (ie: noFill is 0) then this is
      the number of the backup that it was filled from</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mangle</dt>
  <dd class="It-tag">Set if this backup has mangled file names and attributes.
      Always true for backups in v1.4.0 and above. False for all backups prior
      to v1.4.0.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">xferMethod</dt>
  <dd class="It-tag">Set to the value of $Conf{XferMethod} when this dump was
      done.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">level</dt>
  <dd class="It-tag">The level of this dump. A full dump is level 0. Currently
      incrementals are 1. But when multi-level incrementals are supported this
      will reflect each dump's incremental level.</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;"></div>
<dl class="Bl-tag">
  <dt class="It-tag">restores</dt>
  <dd class="It-tag">A tab-delimited ascii table listing information about each
      requested restore, one per row. The columns are:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">num</dt>
  <dd class="It-tag">Restore number (matches the suffix of the RestoreInfo.nnn
      and RestoreLOG.nnn.z file), unrelated to the backup number.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">startTime</dt>
  <dd class="It-tag">Start time of the restore in unix seconds.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">endTime</dt>
  <dd class="It-tag">End time of the restore in unix seconds.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">result</dt>
  <dd class="It-tag">Result (ok or failed).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">errorMsg</dt>
  <dd class="It-tag">Error message if restore failed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">nFiles</dt>
  <dd class="It-tag">Number of files restored.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">size</dt>
  <dd class="It-tag">Size in bytes of the restored files.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">tarCreateErrs</dt>
  <dd class="It-tag">Number of errors from BackupPC_tarCreate during
    restore.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">xferErrs</dt>
  <dd class="It-tag">Number of errors from smbclient, tar, rsync or ftp during
      restore.</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;"></div>
<dl class="Bl-tag">
  <dt class="It-tag">archives</dt>
  <dd class="It-tag">A tab-delimited ascii table listing information about each
      requested archive, one per row. The columns are:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">num</dt>
  <dd class="It-tag">Archive number (matches the suffix of the ArchiveInfo.nnn
      and ArchiveLOG.nnn.z file), unrelated to the backup or restore
    number.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">startTime</dt>
  <dd class="It-tag">Start time of the restore in unix seconds.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">endTime</dt>
  <dd class="It-tag">End time of the restore in unix seconds.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">result</dt>
  <dd class="It-tag">Result (ok or failed).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">errorMsg</dt>
  <dd class="It-tag">Error message if archive failed.</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;"></div>
</div>
<div style="margin-left: 4.00ex;"></div>
</div>
<div style="margin-left: 4.00ex;"></div>
<h2 class="Ss" title="Ss" id="Compressed_file_format"><a class="selflink" href="#Compressed_file_format">Compressed
  file format</a></h2>
The compressed file format is as generated by Compress::Zlib::deflate with one
  minor, but important, tweak. Since Compress::Zlib::inflate fully inflates its
  argument in memory, it could take large amounts of memory if it was inflating
  a highly compressed file. For example, a 200MB file of 0x0 bytes compresses to
  around 200K bytes. If Compress::Zlib::inflate was called with this single 200K
  buffer, it would need to allocate 200MB of memory to return the result.
<div class="Pp"></div>
BackupPC watches how efficiently a file is compressing. If a big file has very
  high compression (meaning it will use too much memory when it is inflated),
  BackupPC calls the <i>flush()</i> method, which gracefully completes the
  current compression. BackupPC then starts another deflate and simply appends
  the output file. So the BackupPC compressed file format is one or more
  concatenated deflations/flushes. The specific ratios that BackupPC uses is
  that if a 6MB chunk compresses to less than 64K then a flush will be done.
<div class="Pp"></div>
Back to the example of the 200MB file of 0x0 bytes. Adding flushes every 6MB
  adds only 200 or so bytes to the 200K output. So the storage cost of flushing
  is negligible.
<div class="Pp"></div>
To easily decompress a BackupPC compressed file, the script BackupPC_zcat can be
  found in __INSTALLDIR__/bin. For each file name argument it inflates the file
  and writes it to stdout.
<h2 class="Ss" title="Ss" id="Rsync_checksum_caching"><a class="selflink" href="#Rsync_checksum_caching">Rsync
  checksum caching</a></h2>
An incremental backup with rsync compares attributes on the client with the last
  full backup. Any files with identical attributes are skipped. A full backup
  with rsync sets the --ignore-times option, which causes every file to be
  examined independent of attributes.
<div class="Pp"></div>
Each file is examined by generating block checksums (default 2K blocks) on the
  receiving side (that's the BackupPC side), sending those checksums to the
  client, where the remote rsync matches those checksums with the corresponding
  file. The matching blocks and new data is sent back, allowing the client file
  to be reassembled. A checksum for the entire file is sent to as an extra check
  the the reconstructed file is correct.
<div class="Pp"></div>
This results in significant disk IO and computation for BackupPC: every file in
  a full backup, or any file with non-matching attributes in an incremental
  backup, needs to be uncompressed, block checksums computed and sent. Then the
  receiving side reassembles the file and has to verify the whole-file checksum.
  Even if the file is identical, prior to 2.1.0, BackupPC had to read and
  uncompress the file twice, once to compute the block checksums and later to
  verify the whole-file checksum.
<div class="Pp"></div>
Starting in 2.1.0, BackupPC supports optional checksum caching, which means the
  block and file checksums only need to be computed once for each file. This
  results in a significant performance improvement. This only works for
  compressed pool files. It is enabled by adding
<div class="Pp"></div>
<pre>
        '--checksum-seed=32761',
</pre>
<div class="Pp"></div>
to $Conf{RsyncArgs} and $Conf{RsyncRestoreArgs}.
<div class="Pp"></div>
Rsync versions prior to and including rsync-2.6.2 need a small patch to add
  support for the --checksum-seed option. This patch is available in the
  cygwin-rsyncd package at &lt;http://backuppc.sourceforge.net&gt;. This patch
  is already included in rsync CVS, so it will be standard in future versions of
  rsync.
<div class="Pp"></div>
When this option is present, BackupPC will add block and file checksums to the
  compressed pool file the next time a pool file is used and it doesn't already
  have cached checksums. The first time a new file is written to the pool, the
  checksums are not appended. The next time checksums are needed for a file,
  they are computed and added. So the full performance benefit of checksum
  caching won't be noticed until the third time a pool file is used (eg: the
  third full backup).
<div class="Pp"></div>
With checksum caching enabled, there is a risk that should a file's contents in
  the pool be corrupted due to a disk problem, but the cached checksums are
  still correct, the corruption will not be detected by a full backup, since the
  file contents are no longer read and compared. To reduce the chance that this
  remains undetected, BackupPC can recheck cached checksums for a fraction of
  the files. This fraction is set with the $Conf{RsyncCsumCacheVerifyProb}
  setting. The default value of 0.01 means that 1% of the time a file's
  checksums are read, the checksums are verified. This reduces performance
  slightly, but, over time, ensures that files contents are in sync with the
  cached checksums.
<div class="Pp"></div>
The format of the cached checksum data can be discovered by looking at the code.
  Basically, the first byte of the compressed file is changed to denote that
  checksums are appended. The block and file checksum data, plus some other
  information and magic word, are appended to the compressed file. This allows
  the cache update to be done in-place.
<h2 class="Ss" title="Ss" id="File_name_mangling"><a class="selflink" href="#File_name_mangling">File
  name mangling</a></h2>
Backup file names are stored in &quot;mangled&quot; form. Each node of a path is
  preceded by &quot;f&quot; (mnemonic: file), and special characters (\n, \r, %
  and /) are URI-encoded as &quot;%xx&quot;, where xx is the ascii character's
  hex value. So c:/craig/example.txt is now stored as fc/fcraig/fexample.txt.
<div class="Pp"></div>
This was done mainly so meta-data could be stored alongside the backup files
  without name collisions. In particular, the attributes for the files in a
  directory are stored in a file called &quot;attrib&quot;, and mangling avoids
  file name collisions (I discarded the idea of having a duplicate directory
  tree for every backup just to store the attributes). Other meta-data (eg:
  rsync checksums) could be stored in file names preceded by, eg, &quot;c&quot;.
  There are two other benefits to mangling: the share name might contain
  &quot;/&quot; (eg: &quot;/home/craig&quot; for tar transport), and I wanted
  that represented as a single level in the storage tree. Secondly, as files are
  written to NewFileList for later processing by BackupPC_link, embedded
  newlines in the file's path will cause problems which are avoided by mangling.
<div class="Pp"></div>
The CGI script undoes the mangling, so it is invisible to the user. Old
  (unmangled) backups are still supported by the CGI interface.
<h2 class="Ss" title="Ss" id="Special_files"><a class="selflink" href="#Special_files">Special
  files</a></h2>
Linux/unix file systems support several special file types: symbolic links,
  character and block device files, fifos (pipes) and unix-domain sockets. All
  except unix-domain sockets are supported by BackupPC (there's no point in
  backing up or restoring unix-domain sockets since they only have meaning after
  a process creates them). Symbolic links are stored as a plain file whose
  contents are the contents of the link (not the file it points to). This file
  is compressed and pooled like any normal file. Character and block device
  files are also stored as plain files, whose contents are two integers
  separated by a comma; the numbers are the major and minor device number. These
  files are compressed and pooled like any normal file. Fifo files are stored as
  empty plain files (which are not pooled since they have zero size). In all
  cases, the original file type is stored in the attrib file so it can be
  correctly restored.
<div class="Pp"></div>
Hardlinks are also supported. When GNU tar first encounters a file with more
  than one link (ie: hardlinks) it dumps it as a regular file. When it sees the
  second and subsequent hardlinks to the same file, it dumps just the hardlink
  information. BackupPC correctly recognizes these hardlinks and stores them
  just like symlinks: a regular text file whose contents is the path of the file
  linked to. The CGI script will download the original file when you click on a
  hardlink.
<div class="Pp"></div>
Also, BackupPC_tarCreate has enough magic to re-create the hardlinks dynamically
  based on whether or not the original file and hardlinks are both included in
  the tar file. For example, imagine a/b/x is a hardlink to a/c/y. If you use
  BackupPC_tarCreate to restore directory a, then the tar file will include
  a/b/x as the original file and a/c/y will be a hardlink to a/b/x. If, instead
  you restore a/c, then the tar file will include a/c/y as the original file,
  not a hardlink.
<h2 class="Ss" title="Ss" id="Attribute_file_format"><a class="selflink" href="#Attribute_file_format">Attribute
  file format</a></h2>
The unix attributes for the contents of a directory (all the files and
  directories in that directory) are stored in a file called attrib. There is a
  single attrib file for each directory in a backup. For example, if c:/craig
  contains a single file c:/craig/example.txt, that file would be stored as
  fc/fcraig/fexample.txt and there would be an attribute file in
  fc/fcraig/attrib (and also fc/attrib and ./attrib). The file fc/fcraig/attrib
  would contain a single entry containing the attributes for
  fc/fcraig/fexample.txt.
<div class="Pp"></div>
The attrib file starts with a magic number, followed by the concatenation of the
  following information for each file:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">File name length in perl's pack &quot;w&quot; format
      (variable length base 128).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">File name.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The unix file type, mode, uid, gid and file size divided by
      4GB and file size modulo 4GB (type mode uid gid sizeDiv4GB sizeMod4GB), in
      perl's pack &quot;w&quot; format (variable length base 128).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The unix mtime (unix seconds) in perl's pack &quot;N&quot;
      format (32 bit integer).</dd>
</dl>
<div class="Pp"></div>
The attrib file is also compressed if compression is enabled. See the
  lib/BackupPC/Attrib.pm module for full details.
<div class="Pp"></div>
Attribute files are pooled just like normal backup files. This saves space if
  all the files in a directory have the same attributes across multiple backups,
  which is common.
<h2 class="Ss" title="Ss" id="Optimizations"><a class="selflink" href="#Optimizations">Optimizations</a></h2>
BackupPC doesn't care about the access time of files in the pool since it saves
  attribute meta-data separate from the files. Since BackupPC mostly does reads
  from disk, maintaining the access time of files generates a lot of unnecessary
  disk writes. So, provided BackupPC has a dedicated data disk, you should
  consider mounting BackupPC's data directory with the noatime (or, with Linux
  kernels &gt;=2.6.20, relatime) attribute (see <i>mount</i>(1)).
<h2 class="Ss" title="Ss" id="Some_Limitations"><a class="selflink" href="#Some_Limitations">Some
  Limitations</a></h2>
BackupPC isn't perfect (but it is getting better). Please see
  &lt;http://backuppc.sourceforge.net/faq/limitations.html&gt; for a discussion
  of some of BackupPC's limitations.
<h2 class="Ss" title="Ss" id="Security_issues"><a class="selflink" href="#Security_issues">Security
  issues</a></h2>
Please see &lt;http://backuppc.sourceforge.net/faq/security.html&gt; for a
  discussion of some of various security issues.
<h1 class="Sh" title="Sh" id="Configuration_File"><a class="selflink" href="#Configuration_File">Configuration
  File</a></h1>
The BackupPC configuration file resides in __CONFDIR__/config.pl. Optional
  per-PC configuration files reside in __CONFDIR__/pc/$host.pl (or
  __TOPDIR__/pc/$host/config.pl in non-FHS versions of BackupPC). This file can
  be used to override settings just for a particular PC.
<h2 class="Ss" title="Ss" id="Modifying_the_main_configuration_file"><a class="selflink" href="#Modifying_the_main_configuration_file">Modifying
  the main configuration file</a></h2>
The configuration file is a perl script that is executed by BackupPC, so you
  should be careful to preserve the file syntax (punctuation, quotes etc) when
  you edit it. It is recommended that you use CVS, RCS or some other method of
  source control for changing config.pl.
<div class="Pp"></div>
BackupPC reads or re-reads the main configuration file and the hosts file in
  three cases:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Upon startup.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">When BackupPC is sent a HUP (-1) signal. Assuming you
      installed the init.d script, you can also do this with
      &quot;/etc/init.d/backuppc reload&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">When the modification time of config.pl file changes.
      BackupPC checks the modification time once during each regular
    wakeup.</dd>
</dl>
<div class="Pp"></div>
Whenever you change the configuration file you can either do a kill -HUP
  BackupPC_pid or simply wait until the next regular wakeup period.
<div class="Pp"></div>
Each time the configuration file is re-read a message is reported in the LOG
  file, so you can tail it (or view it via the CGI interface) to make sure your
  kill -HUP worked. Errors in parsing the configuration file are also reported
  in the LOG file.
<div class="Pp"></div>
The optional per-PC configuration file (__CONFDIR__/pc/$host.pl or
  __TOPDIR__/pc/$host/config.pl in non-FHS versions of BackupPC) is read
  whenever it is needed by BackupPC_dump, BackupPC_link and others.
<h1 class="Sh" title="Sh" id="Configuration_Parameters"><a class="selflink" href="#Configuration_Parameters">Configuration
  Parameters</a></h1>
The configuration parameters are divided into five general groups. The first
  group (general server configuration) provides general configuration for
  BackupPC. The next two groups describe what to backup, when to do it, and how
  long to keep it. The fourth group are settings for email reminders, and the
  final group contains settings for the CGI interface.
<div class="Pp"></div>
All configuration settings in the second through fifth groups can be overridden
  by the per-PC config.pl file.
<h2 class="Ss" title="Ss" id="General_server_configuration"><a class="selflink" href="#General_server_configuration">General
  server configuration</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{ServerHost} = '';</dt>
  <dd class="It-tag">Host name on which the BackupPC server is running.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{ServerPort} = -1;</dt>
  <dd class="It-tag">TCP port number on which the BackupPC server listens for
      and accepts connections. Normally this should be disabled (set to -1). The
      TCP port is only needed if apache runs on a different machine from
      BackupPC. In that case, set this to any spare port number over 1024 (eg:
      2359). If you enable the TCP port, make sure you set
      $Conf{ServerMesgSecret} too!</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{ServerMesgSecret} = '';</dt>
  <dd class="It-tag">Shared secret to make the TCP port secure. Set this to a
      hard to guess string if you enable the TCP port (ie: $Conf{ServerPort}
      &gt; 0).
    <div style="height: 1.00em;">&#x00A0;</div>
    To avoid possible attacks via the TCP socket interface, every client message
      is protected by an MD5 digest. The MD5 digest includes four items:
    <br/>
     - a seed that is sent to the client when the connection opens
    <br/>
     - a sequence number that increments for each message
    <br/>
     - a shared secret that is stored in $Conf{ServerMesgSecret}
    <br/>
     - the message itself.
    <div style="height: 1.00em;">&#x00A0;</div>
    The message is sent in plain text preceded by the MD5 digest. A snooper can
      see the plain-text seed sent by BackupPC and plain-text message from the
      client, but cannot construct a valid MD5 digest since the secret
      $Conf{ServerMesgSecret} is unknown. A replay attack is not possible since
      the seed changes on a per-connection and per-message basis.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{MyPath} = '/bin';</dt>
  <dd class="It-tag">PATH setting for BackupPC. An explicit value is necessary
      for taint mode. Value shouldn't matter too much since all execs use
      explicit paths. However, taint mode in perl will complain if this
      directory is world writable.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{UmaskMode} = 027;</dt>
  <dd class="It-tag">Permission mask for directories and files created by
      BackupPC. Default value prevents any access from group other, and prevents
      group write.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{WakeupSchedule} = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11,
    12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23];</dt>
  <dd class="It-tag">Times at which we wake up, check all the PCs, and schedule
      necessary backups. Times are measured in hours since midnight. Can be
      fractional if necessary (eg: 4.25 means 4:15am).
    <div style="height: 1.00em;">&#x00A0;</div>
    If the hosts you are backing up are always connected to the network you
      might have only one or two wakeups each night. This will keep the backup
      activity after hours. On the other hand, if you are backing up laptops
      that are only intermittently connected to the network you will want to
      have frequent wakeups (eg: hourly) to maximize the chance that each laptop
      is backed up.
    <div style="height: 1.00em;">&#x00A0;</div>
    Examples:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    $Conf{WakeupSchedule} = [22.5];         # once per day at 10:30 pm.
    $Conf{WakeupSchedule} = [2,4,6,8,10,12,14,16,18,20,22];  # every 2 hours
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    The default value is every hour except midnight.
    <div style="height: 1.00em;">&#x00A0;</div>
    The first entry of $Conf{WakeupSchedule} is when BackupPC_nightly is run.
      You might want to re-arrange the entries in $Conf{WakeupSchedule} (they
      don't have to be ascending) so that the first entry is when you want
      BackupPC_nightly to run (eg: when you don't expect a lot of regular
      backups to run).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{MaxBackups} = 4;</dt>
  <dd class="It-tag">Maximum number of simultaneous backups to run. If there are
      no user backup requests then this is the maximum number of simultaneous
      backups.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{MaxUserBackups} = 4;</dt>
  <dd class="It-tag">Additional number of simultaneous backups that users can
      run. As many as $Conf{MaxBackups} + $Conf{MaxUserBackups} requests can run
      at the same time.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{MaxPendingCmds} = 15;</dt>
  <dd class="It-tag">Maximum number of pending link commands. New backups will
      only be started if there are no more than $Conf{MaxPendingCmds} plus
      $Conf{MaxBackups} number of pending link commands, plus running jobs. This
      limit is to make sure BackupPC doesn't fall too far behind in running
      BackupPC_link commands.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CmdQueueNice} = 10;</dt>
  <dd class="It-tag">Nice level at which CmdQueue commands (eg: BackupPC_link
      and BackupPC_nightly) are run at.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{MaxBackupPCNightlyJobs} = 2;</dt>
  <dd class="It-tag">How many BackupPC_nightly processes to run in parallel.
    <div style="height: 1.00em;">&#x00A0;</div>
    Each night, at the first wakeup listed in $Conf{WakeupSchedule},
      BackupPC_nightly is run. Its job is to remove unneeded files in the pool,
      ie: files that only have one link. To avoid race conditions,
      BackupPC_nightly and BackupPC_link cannot run at the same time. Starting
      in v3.0.0, BackupPC_nightly can run concurrently with backups
      (BackupPC_dump).
    <div style="height: 1.00em;">&#x00A0;</div>
    So to reduce the elapsed time, you might want to increase this setting to
      run several BackupPC_nightly processes in parallel (eg: 4, or even
    8).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{BackupPCNightlyPeriod} = 1;</dt>
  <dd class="It-tag">How many days (runs) it takes BackupPC_nightly to traverse
      the entire pool. Normally this is 1, which means every night it runs, it
      does traverse the entire pool removing unused pool files.
    <div style="height: 1.00em;">&#x00A0;</div>
    Other valid values are 2, 4, 8, 16. This causes BackupPC_nightly to traverse
      1/2, 1/4, 1/8 or 1/16th of the pool each night, meaning it takes 2, 4, 8
      or 16 days to completely traverse the pool. The advantage is that each
      night the running time of BackupPC_nightly is reduced roughly in
      proportion, since the total job is split over multiple days. The
      disadvantage is that unused pool files take longer to get deleted, which
      will slightly increase disk usage.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note that even when $Conf{BackupPCNightlyPeriod} &gt; 1, BackupPC_nightly
      still runs every night. It just does less work each time it runs.
    <div style="height: 1.00em;">&#x00A0;</div>
    Examples:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
   $Conf{BackupPCNightlyPeriod} = 1;   # entire pool is checked every night
   $Conf{BackupPCNightlyPeriod} = 2;   # two days to complete pool check
                                       # (different half each night)
   $Conf{BackupPCNightlyPeriod} = 4;   # four days to complete pool check
                                       # (different quarter each night)
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{MaxOldLogFiles} = 14;</dt>
  <dd class="It-tag">Maximum number of log files we keep around in log
      directory. These files are aged nightly. A setting of 14 means the log
      directory will contain about 2 weeks of old log files, in particular at
      most the files LOG, LOG.0, LOG.1, ... LOG.13 (except today's LOG, these
      files will have a .z extension if compression is on).
    <div style="height: 1.00em;">&#x00A0;</div>
    If you decrease this number after BackupPC has been running for a while you
      will have to manually remove the older log files.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{DfPath} = '';</dt>
  <dd class="It-tag">Full path to the df command. Security caution: normal users
      should not allowed to write to this file or directory.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{DfCmd} = '$dfPath $topDir';</dt>
  <dd class="It-tag">Command to run df. The following variables are substituted
      at run-time:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  $dfPath      path to df ($Conf{DfPath})
  $topDir      top-level BackupPC data directory
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: all Cmds are executed directly without a shell, so the prog name needs
      to be a full path and you can't include shell syntax like redirection and
      pipes; put that in a script if you need it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{SplitPath} = '';</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{ParPath} = '';</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CatPath} = '';</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{GzipPath} = '';</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{Bzip2Path} = '';</dt>
  <dd class="It-tag">Full path to various commands for archiving</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{DfMaxUsagePct} = 95;</dt>
  <dd class="It-tag">Maximum threshold for disk utilization on the __TOPDIR__
      filesystem. If the output from $Conf{DfPath} reports a percentage larger
      than this number then no new regularly scheduled backups will be run.
      However, user requested backups (which are usually incremental and tend to
      be small) are still performed, independent of disk usage. Also, currently
      running backups will not be terminated when the disk usage exceeds this
      number.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{TrashCleanSleepSec} = 300;</dt>
  <dd class="It-tag">How long BackupPC_trashClean sleeps in seconds between each
      check of the trash directory. Once every 5 minutes should be
    reasonable.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{DHCPAddressRanges} = [];</dt>
  <dd class="It-tag">List of DHCP address ranges we search looking for PCs to
      backup. This is an array of hashes for each class C address range. This is
      only needed if hosts in the conf/hosts file have the dhcp flag set.
    <div style="height: 1.00em;">&#x00A0;</div>
    Examples:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
   # to specify 192.10.10.20 to 192.10.10.250 as the DHCP address pool
   $Conf{DHCPAddressRanges} = [
       {
           ipAddrBase =&gt; '192.10.10',
           first =&gt; 20,
           last  =&gt; 250,
       },
   ];
   # to specify two pools (192.10.10.20-250 and 192.10.11.10-50)
   $Conf{DHCPAddressRanges} = [
       {
           ipAddrBase =&gt; '192.10.10',
           first =&gt; 20,
           last  =&gt; 250,
       },
       {
           ipAddrBase =&gt; '192.10.11',
           first =&gt; 10,
           last  =&gt; 50,
       },
   ];
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{BackupPCUser} = '';</dt>
  <dd class="It-tag">The BackupPC user.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{TopDir} = '';</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{ConfDir} = '';</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{LogDir} = '';</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{InstallDir} = '';</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CgiDir} = '';</dt>
  <dd class="It-tag">Important installation directories:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  TopDir     - where all the backup data is stored
  ConfDir    - where the main config and hosts files resides
  LogDir     - where log files and other transient information
  InstallDir - where the bin, lib and doc installation dirs reside.
               Note: you cannot change this value since all the
               perl scripts include this path.  You must reinstall
               with configure.pl to change InstallDir.
  CgiDir     - Apache CGI directory for BackupPC_Admin
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: it is STRONGLY recommended that you don't change the values here.
      These are set at installation time and are here for reference and are used
      during upgrades.
    <div style="height: 1.00em;">&#x00A0;</div>
    Instead of changing TopDir here it is recommended that you use a symbolic
      link to the new location, or mount the new BackupPC store at the existing
      $Conf{TopDir} setting.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{BackupPCUserVerify} = 1;</dt>
  <dd class="It-tag">Whether BackupPC and the CGI script BackupPC_Admin verify
      that they are really running as user $Conf{BackupPCUser}. If this flag is
      set and the effective user id (euid) differs from $Conf{BackupPCUser} then
      both scripts exit with an error. This catches cases where BackupPC might
      be accidently started as root or the wrong user, or if the CGI script is
      not installed correctly.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{HardLinkMax} = 31999;</dt>
  <dd class="It-tag">Maximum number of hardlinks supported by the $TopDir file
      system that BackupPC uses. Most linux or unix file systems should support
      at least 32000 hardlinks per file, or 64000 in other cases. If a pool file
      already has this number of hardlinks, a new pool file is created so that
      new hardlinks can be accommodated. This limit will only be hit if an
      identical file appears at least this number of times across all the
      backups.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{PerlModuleLoad} = undef;</dt>
  <dd class="It-tag">Advanced option for asking BackupPC to load additional perl
      modules. Can be a list (array ref) of module names to load at
    startup.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{ServerInitdPath} = '';</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{ServerInitdStartCmd} = '';</dt>
  <dd class="It-tag">Path to init.d script and command to use that script to
      start the server from the CGI interface. The following variables are
      substituted at run-time:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  $sshPath           path to ssh ($Conf{SshPath})
  $serverHost        same as $Conf{ServerHost}
  $serverInitdPath   path to init.d script ($Conf{ServerInitdPath})
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Example:
    <div style="height: 1.00em;">&#x00A0;</div>
    $Conf{ServerInitdPath} = '/etc/init.d/backuppc'; $Conf{ServerInitdStartCmd}
      = '$sshPath -q -x -l root $serverHost'
    <br/>
     . ' $serverInitdPath start'
    <br/>
     . ' &lt; /dev/null &gt;&amp; /dev/null';
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: all Cmds are executed directly without a shell, so the prog name needs
      to be a full path and you can't include shell syntax like redirection and
      pipes; put that in a script if you need it.</dd>
</dl>
<h2 class="Ss" title="Ss" id="What_to_backup_and_when_to_do_it"><a class="selflink" href="#What_to_backup_and_when_to_do_it">What
  to backup and when to do it</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{FullPeriod} = 6.97;</dt>
  <dd class="It-tag">Minimum period in days between full backups. A full dump
      will only be done if at least this much time has elapsed since the last
      full dump, and at least $Conf{IncrPeriod} days has elapsed since the last
      successful dump.
    <div style="height: 1.00em;">&#x00A0;</div>
    Typically this is set slightly less than an integer number of days. The time
      taken for the backup, plus the granularity of $Conf{WakeupSchedule} will
      make the actual backup interval a bit longer.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{IncrPeriod} = 0.97;</dt>
  <dd class="It-tag">Minimum period in days between incremental backups (a user
      requested incremental backup will be done anytime on demand).
    <div style="height: 1.00em;">&#x00A0;</div>
    Typically this is set slightly less than an integer number of days. The time
      taken for the backup, plus the granularity of $Conf{WakeupSchedule} will
      make the actual backup interval a bit longer.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{FullKeepCnt} = 1;</dt>
  <dd class="It-tag">Number of full backups to keep. Must be &gt;= 1.
    <div style="height: 1.00em;">&#x00A0;</div>
    In the steady state, each time a full backup completes successfully the
      oldest one is removed. If this number is decreased, the extra old backups
      will be removed.
    <div style="height: 1.00em;">&#x00A0;</div>
    If filling of incremental dumps is off the oldest backup always has to be a
      full (ie: filled) dump. This might mean one or two extra full dumps are
      kept until the oldest incremental backups expire.
    <div style="height: 1.00em;">&#x00A0;</div>
    Exponential backup expiry is also supported. This allows you to specify:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  - num fulls to keep at intervals of 1 * $Conf{FullPeriod}, followed by
  - num fulls to keep at intervals of 2 * $Conf{FullPeriod},
  - num fulls to keep at intervals of 4 * $Conf{FullPeriod},
  - num fulls to keep at intervals of 8 * $Conf{FullPeriod},
  - num fulls to keep at intervals of 16 * $Conf{FullPeriod},
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    and so on. This works by deleting every other full as each expiry boundary
      is crossed.
    <div style="height: 1.00em;">&#x00A0;</div>
    Exponential expiry is specified using an array for $Conf{FullKeepCnt}:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  $Conf{FullKeepCnt} = [4, 2, 3];
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Entry #n specifies how many fulls to keep at an interval of 2^n *
      $Conf{FullPeriod} (ie: 1, 2, 4, 8, 16, 32, ...).
    <div style="height: 1.00em;">&#x00A0;</div>
    The example above specifies keeping 4 of the most recent full backups (1
      week interval) two full backups at 2 week intervals, and 3 full backups at
      4 week intervals, eg:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
   full 0 19 weeks old   \
   full 1 15 weeks old    &gt;---  3 backups at 4 * $Conf{FullPeriod}
   full 2 11 weeks old   /
   full 3  7 weeks old   \____  2 backups at 2 * $Conf{FullPeriod}
   full 4  5 weeks old   /
   full 5  3 weeks old   \
   full 6  2 weeks old    \___  4 backups at 1 * $Conf{FullPeriod}
   full 7  1 week old     /
   full 8  current       /
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    On a given week the spacing might be less than shown as each backup ages
      through each expiry period. For example, one week later, a new full is
      completed and the oldest is deleted, giving:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
   full 0 16 weeks old   \
   full 1 12 weeks old    &gt;---  3 backups at 4 * $Conf{FullPeriod}
   full 2  8 weeks old   /
   full 3  6 weeks old   \____  2 backups at 2 * $Conf{FullPeriod}
   full 4  4 weeks old   /
   full 5  3 weeks old   \
   full 6  2 weeks old    \___  4 backups at 1 * $Conf{FullPeriod}
   full 7  1 week old     /
   full 8  current       /
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    You can specify 0 as a count (except in the first entry), and the array can
      be as long as you wish. For example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  $Conf{FullKeepCnt} = [4, 0, 4, 0, 0, 2];
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This will keep 10 full dumps, 4 most recent at 1 * $Conf{FullPeriod},
      followed by 4 at an interval of 4 * $Conf{FullPeriod} (approx 1 month
      apart), and then 2 at an interval of 32 * $Conf{FullPeriod} (approx 7-8
      months apart).
    <div style="height: 1.00em;">&#x00A0;</div>
    Example: these two settings are equivalent and both keep just the four most
      recent full dumps:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
   $Conf{FullKeepCnt} = 4;
   $Conf{FullKeepCnt} = [4];
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{FullKeepCntMin} = 1;</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{FullAgeMax} = 90;</dt>
  <dd class="It-tag">Very old full backups are removed after $Conf{FullAgeMax}
      days. However, we keep at least $Conf{FullKeepCntMin} full backups no
      matter how old they are.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note that $Conf{FullAgeMax} will be increased to $Conf{FullKeepCnt} times
      $Conf{FullPeriod} if $Conf{FullKeepCnt} specifies enough full backups to
      exceed $Conf{FullAgeMax}.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{IncrKeepCnt} = 6;</dt>
  <dd class="It-tag">Number of incremental backups to keep. Must be &gt;= 1.
    <div style="height: 1.00em;">&#x00A0;</div>
    In the steady state, each time an incr backup completes successfully the
      oldest one is removed. If this number is decreased, the extra old backups
      will be removed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{IncrKeepCntMin} = 1;</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{IncrAgeMax} = 30;</dt>
  <dd class="It-tag">Very old incremental backups are removed after
      $Conf{IncrAgeMax} days. However, we keep at least $Conf{IncrKeepCntMin}
      incremental backups no matter how old they are.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{IncrLevels} = [1];</dt>
  <dd class="It-tag">Level of each incremental. &quot;Level&quot; follows the
      terminology of <i>dump</i>(1). A full backup has level 0. A new
      incremental of level N will backup all files that have changed since the
      most recent backup of a lower level.
    <div style="height: 1.00em;">&#x00A0;</div>
    The entries of $Conf{IncrLevels} apply in order to each incremental after
      each full backup. It wraps around until the next full backup. For example,
      these two settings have the same effect:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
      $Conf{IncrLevels} = [1, 2, 3];
      $Conf{IncrLevels} = [1, 2, 3, 1, 2, 3];
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This means the 1st and 4th incrementals (level 1) go all the way back to the
      full. The 2nd and 3rd (and 5th and 6th) backups just go back to the
      immediate preceeding incremental.
    <div style="height: 1.00em;">&#x00A0;</div>
    Specifying a sequence of multi-level incrementals will usually mean more
      than $Conf{IncrKeepCnt} incrementals will need to be kept, since lower
      level incrementals are needed to merge a complete view of a backup. For
      example, with
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
      $Conf{FullPeriod}  = 7;
      $Conf{IncrPeriod}  = 1;
      $Conf{IncrKeepCnt} = 6;
      $Conf{IncrLevels}  = [1, 2, 3, 4, 5, 6];
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    there will be up to 11 incrementals in this case:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
      backup #0  (full, level 0, oldest)
      backup #1  (incr, level 1)
      backup #2  (incr, level 2)
      backup #3  (incr, level 3)
      backup #4  (incr, level 4)
      backup #5  (incr, level 5)
      backup #6  (incr, level 6)
      backup #7  (full, level 0)
      backup #8  (incr, level 1)
      backup #9  (incr, level 2)
      backup #10 (incr, level 3)
      backup #11 (incr, level 4)
      backup #12 (incr, level 5, newest)
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Backup #1 (the oldest level 1 incremental) can't be deleted since backups
      2..6 depend on it. Those 6 incrementals can't all be deleted since that
      would only leave 5 (#8..12). When the next incremental happens (level 6),
      the complete set of 6 older incrementals (#1..6) will be deleted, since
      that maintains the required number ($Conf{IncrKeepCnt}) of incrementals.
      This situation is reduced if you set shorter chains of multi-level
      incrementals, eg:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
      $Conf{IncrLevels}  = [1, 2, 3];
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    would only have up to 2 extra incremenals before all 3 are deleted.
    <div style="height: 1.00em;">&#x00A0;</div>
    BackupPC as usual merges the full and the sequence of incrementals together
      so each incremental can be browsed and restored as though it is a complete
      backup. If you specify a long chain of incrementals then more backups need
      to be merged when browsing, restoring, or getting the starting point for
      rsync backups. In the example above (levels 1..6), browing backup #6
      requires 7 different backups (#0..6) to be merged.
    <div style="height: 1.00em;">&#x00A0;</div>
    Because of this merging and the additional incrementals that need to be
      kept, it is recommended that some level 1 incrementals be included in
      $Conf{IncrLevels}.
    <div style="height: 1.00em;">&#x00A0;</div>
    Prior to version 3.0 incrementals were always level 1, meaning each
      incremental backed up all the files that changed since the last full.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{BackupsDisable} = 0;</dt>
  <dd class="It-tag">Disable all full and incremental backups. These settings
      are useful for a client that is no longer being backed up (eg: a retired
      machine), but you wish to keep the last backups available for browsing or
      restoring to other machines.
    <div style="height: 1.00em;">&#x00A0;</div>
    There are three values for $Conf{BackupsDisable}:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  0    Backups are enabled.
  1    Don't do any regular backups on this client.  Manually
       requested backups (via the CGI interface) will still occur.
  2    Don't do any backups on this client.  Manually requested
       backups (via the CGI interface) will be ignored.
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    In versions prior to 3.0 Backups were disabled by setting $Conf{FullPeriod}
      to -1 or -2.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{PartialAgeMax} = 3;</dt>
  <dd class="It-tag">A failed full backup is saved as a partial backup. The
      rsync XferMethod can take advantage of the partial full when the next
      backup is run. This parameter sets the age of the partial full in days: if
      the partial backup is older than this number of days, then rsync will
      ignore (not use) the partial full when the next backup is run. If you set
      this to a negative value then no partials will be saved. If you set this
      to 0, partials will be saved, but will not be used by the next backup.
    <div style="height: 1.00em;">&#x00A0;</div>
    The default setting of 3 days means that a partial older than 3 days is
      ignored when the next full backup is done.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{IncrFill} = 0;</dt>
  <dd class="It-tag">Whether incremental backups are filled. &quot;Filling&quot;
      means that the most recent full (or filled) dump is merged into the new
      incremental dump using hardlinks. This makes an incremental dump look like
      a full dump. Prior to v1.03 all incremental backups were filled. In v1.4.0
      and later the default is off.
    <div style="height: 1.00em;">&#x00A0;</div>
    BackupPC, and the cgi interface in particular, do the right thing on
      un-filled incremental backups. It will correctly display the merged
      incremental backup with the most recent filled backup, giving the
      un-filled incremental backups a filled appearance. That means it invisible
      to the user whether incremental dumps are filled or not.
    <div style="height: 1.00em;">&#x00A0;</div>
    Filling backups takes a little extra disk space, and it does cost some extra
      disk activity for filling, and later removal. Filling is no longer useful,
      since file mangling and compression doesn't make a filled backup very
      useful. It's likely the filling option will be removed from future
      versions: filling will be delegated to the display and extraction of
      backup data.
    <div style="height: 1.00em;">&#x00A0;</div>
    If filling is off, BackupPC makes sure that the oldest backup is a full,
      otherwise the following incremental backups will be incomplete. This might
      mean an extra full backup has to be kept until the following incremental
      backups expire.
    <div style="height: 1.00em;">&#x00A0;</div>
    The default is off. You can turn this on or off at any time without
      affecting existing backups.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{RestoreInfoKeepCnt} = 10;</dt>
  <dd class="It-tag">Number of restore logs to keep. BackupPC remembers
      information about each restore request. This number per client will be
      kept around before the oldest ones are pruned.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: files/dirs delivered via Zip or Tar downloads don't count as restores.
      Only the first restore option (where the files and dirs are written to the
      host) count as restores that are logged.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{ArchiveInfoKeepCnt} = 10;</dt>
  <dd class="It-tag">Number of archive logs to keep. BackupPC remembers
      information about each archive request. This number per archive client
      will be kept around before the oldest ones are pruned.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{BackupFilesOnly} = undef;</dt>
  <dd class="It-tag">List of directories or files to backup. If this is defined,
      only these directories or files will be backed up.
    <div style="height: 1.00em;">&#x00A0;</div>
    When editing from the web interface, you should add a valid ShareName (based
      on $Conf{XferMethod}), and then enter the directories specific to that
      ShareName. A special ShareName &quot;*&quot; matches any ShareName that
      doesn't have an explicit entry.
    <div style="height: 1.00em;">&#x00A0;</div>
    For Smb, only one of $Conf{BackupFilesExclude} and $Conf{BackupFilesOnly}
      can be specified per share. If both are set for a particular share, then
      $Conf{BackupFilesOnly} takes precedence and $Conf{BackupFilesExclude} is
      ignored.
    <div style="height: 1.00em;">&#x00A0;</div>
    This can be set to a string, an array of strings, or, in the case of
      multiple shares, a hash of strings or arrays. A hash is used to give a
      list of directories or files to backup for each share (the share name is
      the key). If this is set to just a string or array, and
      $Conf{SmbShareName} contains multiple share names, then the setting is
      assumed to apply all shares.
    <div style="height: 1.00em;">&#x00A0;</div>
    If a hash is used, a special key &quot;*&quot; means it applies to all
      shares that don't have a specific entry.
    <div style="height: 1.00em;">&#x00A0;</div>
    Examples:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
   $Conf{BackupFilesOnly} = '/myFiles';
   $Conf{BackupFilesOnly} = ['/myFiles'];     # same as first example
   $Conf{BackupFilesOnly} = ['/myFiles', '/important'];
   $Conf{BackupFilesOnly} = {
      'c' =&gt; ['/myFiles', '/important'],      # these are for 'c' share
      'd' =&gt; ['/moreFiles', '/archive'],      # these are for 'd' share
   };
   $Conf{BackupFilesOnly} = {
      'c' =&gt; ['/myFiles', '/important'],      # these are for 'c' share
      '*' =&gt; ['/myFiles', '/important'],      # these are other shares
   };
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{BackupFilesExclude} = undef;</dt>
  <dd class="It-tag">List of directories or files to exclude from the backup.
      For Smb, only one of $Conf{BackupFilesExclude} and $Conf{BackupFilesOnly}
      can be specified per share. If both are set for a particular share, then
      $Conf{BackupFilesOnly} takes precedence and $Conf{BackupFilesExclude} is
      ignored.
    <div style="height: 1.00em;">&#x00A0;</div>
    When editing from the web interface, you should add a valid ShareName (based
      on $Conf{XferMethod}), and then enter the directories or files specific to
      that ShareName. A special ShareName &quot;*&quot; matches any ShareName
      that doesn't have an explicit entry.
    <div style="height: 1.00em;">&#x00A0;</div>
    This can be set to a string, an array of strings, or, in the case of
      multiple shares, a hash of strings or arrays. A hash is used to give a
      list of directories or files to exclude for each share (the share name is
      the key). If this is set to just a string or array, and
      $Conf{SmbShareName} contains multiple share names, then the setting is
      assumed to apply to all shares.
    <div style="height: 1.00em;">&#x00A0;</div>
    The exact behavior is determined by the underlying transport program,
      smbclient or tar. For smbclient the exlclude file list is passed into the
      X option. Simple shell wild-cards using &quot;*&quot; or &quot;?&quot; are
      allowed.
    <div style="height: 1.00em;">&#x00A0;</div>
    For tar, if the exclude file contains a &quot;/&quot; it is assumed to be
      anchored at the start of the string. Since all the tar paths start with
      &quot;./&quot;, BackupPC prepends a &quot;.&quot; if the exclude file
      starts with a &quot;/&quot;. Note that GNU tar version &gt;= 1.13.7 is
      required for the exclude option to work correctly. For linux or unix
      machines you should add &quot;/proc&quot; to $Conf{BackupFilesExclude}
      unless you have specified --one-file-system in $Conf{TarClientCmd} or
      --one-file-system in $Conf{RsyncArgs}. Also, for tar, do not use a
      trailing &quot;/&quot; in the directory name: a trailing &quot;/&quot;
      causes the name to not match and the directory will not be excluded.
    <div style="height: 1.00em;">&#x00A0;</div>
    Users report that for smbclient you should specify a directory followed by
      &quot;/*&quot;, eg: &quot;/proc/*&quot;, instead of just
      &quot;/proc&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    FTP servers are traversed recursively so excluding directories will also
      exclude its contents. You can use the wildcard characters &quot;*&quot;
      and &quot;?&quot; to define files for inclusion and exclusion. Both
      attributes $Conf{BackupFilesOnly} and $Conf{BackupFilesExclude} can be
      defined for the same share.
    <div style="height: 1.00em;">&#x00A0;</div>
    If a hash is used, a special key &quot;*&quot; means it applies to all
      shares that don't have a specific entry.
    <div style="height: 1.00em;">&#x00A0;</div>
    Examples:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
   $Conf{BackupFilesExclude} = '/temp';
   $Conf{BackupFilesExclude} = ['/temp'];     # same as first example
   $Conf{BackupFilesExclude} = ['/temp', '/winnt/tmp'];
   $Conf{BackupFilesExclude} = {
      'c' =&gt; ['/temp', '/winnt/tmp'],         # these are for 'c' share
      'd' =&gt; ['/junk', '/dont_back_this_up'], # these are for 'd' share
   };
   $Conf{BackupFilesExclude} = {
      'c' =&gt; ['/temp', '/winnt/tmp'],         # these are for 'c' share
      '*' =&gt; ['/junk', '/dont_back_this_up'], # these are for other shares
   };
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{BlackoutBadPingLimit} = 3;</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{BlackoutGoodCnt} = 7;</dt>
  <dd class="It-tag">PCs that are always or often on the network can be backed
      up after hours, to reduce PC, network and server load during working
      hours. For each PC a count of consecutive good pings is maintained. Once a
      PC has at least $Conf{BlackoutGoodCnt} consecutive good pings it is
      subject to &quot;blackout&quot; and not backed up during hours and days
      specified by $Conf{BlackoutPeriods}.
    <div style="height: 1.00em;">&#x00A0;</div>
    To allow for periodic rebooting of a PC or other brief periods when a PC is
      not on the network, a number of consecutive bad pings is allowed before
      the good ping count is reset. This parameter is
      $Conf{BlackoutBadPingLimit}.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note that bad and good pings don't occur with the same interval. If a
      machine is always on the network, it will only be pinged roughly once
      every $Conf{IncrPeriod} (eg: once per day). So a setting for
      $Conf{BlackoutGoodCnt} of 7 means it will take around 7 days for a machine
      to be subject to blackout. On the other hand, if a ping is failed, it will
      be retried roughly every time BackupPC wakes up, eg, every one or two
      hours. So a setting for $Conf{BlackoutBadPingLimit} of 3 means that the PC
      will lose its blackout status after 3-6 hours of unavailability.
    <div style="height: 1.00em;">&#x00A0;</div>
    To disable the blackout feature set $Conf{BlackoutGoodCnt} to a negative
      value. A value of 0 will make all machines subject to blackout. But if you
      don't want to do any backups during the day it would be easier to just set
      $Conf{WakeupSchedule} to a restricted schedule.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{BlackoutPeriods} = [ ... ];</dt>
  <dd class="It-tag">One or more blackout periods can be specified. If a client
      is subject to blackout then no regular (non-manual) backups will be
      started during any of these periods. hourBegin and hourEnd specify hours
      fro midnight and weekDays is a list of days of the week where 0 is Sunday,
      1 is Monday etc.
    <div style="height: 1.00em;">&#x00A0;</div>
    For example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
   $Conf{BlackoutPeriods} = [
        {
            hourBegin =&gt;  7.0,
            hourEnd   =&gt; 19.5,
            weekDays  =&gt; [1, 2, 3, 4, 5],
        },
   ];
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    specifies one blackout period from 7:00am to 7:30pm local time on Mon-Fri.
    <div style="height: 1.00em;">&#x00A0;</div>
    The blackout period can also span midnight by setting hourBegin &gt;
      hourEnd, eg:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
   $Conf{BlackoutPeriods} = [
        {
            hourBegin =&gt;  7.0,
            hourEnd   =&gt; 19.5,
            weekDays  =&gt; [1, 2, 3, 4, 5],
        },
        {
            hourBegin =&gt; 23,
            hourEnd   =&gt;  5,
            weekDays  =&gt; [5, 6],
        },
   ];
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This specifies one blackout period from 7:00am to 7:30pm local time on
      Mon-Fri, and a second period from 11pm to 5am on Friday and Saturday
      night.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{BackupZeroFilesIsFatal} = 1;</dt>
  <dd class="It-tag">A backup of a share that has zero files is considered
      fatal. This is used to catch miscellaneous Xfer errors that result in no
      files being backed up. If you have shares that might be empty (and
      therefore an empty backup is valid) you should set this flag to 0.</dd>
</dl>
<h2 class="Ss" title="Ss" id="How_to_backup_a_client"><a class="selflink" href="#How_to_backup_a_client">How
  to backup a client</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{XferMethod} = 'smb';</dt>
  <dd class="It-tag">What transport method to use to backup each host. If you
      have a mixed set of WinXX and linux/unix hosts you will need to override
      this in the per-PC config.pl.
    <div style="height: 1.00em;">&#x00A0;</div>
    The valid values are:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  - 'smb':     backup and restore via smbclient and the SMB protocol.
               Easiest choice for WinXX.
  - 'rsync':   backup and restore via rsync (via rsh or ssh).
               Best choice for linux/unix.  Good choice also for WinXX.
  - 'rsyncd':  backup and restore via rsync daemon on the client.
               Best choice for linux/unix if you have rsyncd running on
               the client.  Good choice also for WinXX.
  - 'tar':    backup and restore via tar, tar over ssh, rsh or nfs.
              Good choice for linux/unix.
  - 'archive': host is a special archive host.  Backups are not done.
               An archive host is used to archive other host's backups
               to permanent media, such as tape, CDR or DVD.
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{XferLogLevel} = 1;</dt>
  <dd class="It-tag">Level of verbosity in Xfer log files. 0 means be quiet, 1
      will give will give one line per file, 2 will also show skipped files on
      incrementals, higher values give more output.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{ClientCharset} = '';</dt>
  <dd class="It-tag">Filename charset encoding on the client. BackupPC uses utf8
      on the server for filename encoding. If this is empty, then utf8 is
      assumed and client filenames will not be modified. If set to a different
      encoding then filenames will converted to/from utf8 automatically during
      backup and restore.
    <div style="height: 1.00em;">&#x00A0;</div>
    If the file names displayed in the browser (eg: accents or special
      characters) don't look right then it is likely you haven't set
      $Conf{ClientCharset} correctly.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you are using smbclient on a WinXX machine, smbclient will convert to the
      &quot;unix charset&quot; setting in smb.conf. The default is utf8, in
      which case leave $Conf{ClientCharset} empty since smbclient does the right
      conversion.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you are using rsync on a WinXX machine then it does no conversion. A
      typical WinXX encoding for latin1/western europe is 'cp1252', so in this
      case set $Conf{ClientCharset} to 'cp1252'.
    <div style="height: 1.00em;">&#x00A0;</div>
    On a linux or unix client, run &quot;locale charmap&quot; to see the
      client's charset. Set $Conf{ClientCharset} to this value. A typical value
      for english/US is 'ISO-8859-1'.
    <div style="height: 1.00em;">&#x00A0;</div>
    Do &quot;perldoc Encode::Supported&quot; to see the list of possible charset
      values. The FAQ at http://www.cl.cam.ac.uk/~mgk25/unicode.html is
      excellent, and http://czyborra.com/charsets/iso8859.html provides more
      information on the iso-8859 charsets.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{ClientCharsetLegacy} = 'iso-8859-1';</dt>
  <dd class="It-tag">Prior to 3.x no charset conversion was done by BackupPC.
      Backups were stored in what ever charset the XferMethod provided -
      typically utf8 for smbclient and the client's locale settings for rsync
      and tar (eg: cp1252 for rsync on WinXX and perhaps iso-8859-1 with rsync
      on linux). This setting tells BackupPC the charset that was used to store
      file names in old backups taken with BackupPC 2.x, so that non-ascii file
      names in old backups can be viewed and restored.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Samba_Configuration"><a class="selflink" href="#Samba_Configuration">Samba
  Configuration</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{SmbShareName} = 'C$';</dt>
  <dd class="It-tag">Name of the host share that is backed up when using SMB.
      This can be a string or an array of strings if there are multiple shares
      per host. Examples:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  $Conf{SmbShareName} = 'c';          # backup 'c' share
  $Conf{SmbShareName} = ['c', 'd'];   # backup 'c' and 'd' shares
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting only matters if $Conf{XferMethod} = 'smb'.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{SmbShareUserName} = '';</dt>
  <dd class="It-tag">Smbclient share user name. This is passed to smbclient's -U
      argument.
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting only matters if $Conf{XferMethod} = 'smb'.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{SmbSharePasswd} = '';</dt>
  <dd class="It-tag">Smbclient share password. This is passed to smbclient via
      its PASSWD environment variable. There are several ways you can tell
      BackupPC the smb share password. In each case you should be very careful
      about security. If you put the password here, make sure that this file is
      not readable by regular users! See the &quot;Setting up config.pl&quot;
      section in the documentation for more information.
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting only matters if $Conf{XferMethod} = 'smb'.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{SmbClientPath} = '';</dt>
  <dd class="It-tag">Full path for smbclient. Security caution: normal users
      should not allowed to write to this file or directory.
    <div style="height: 1.00em;">&#x00A0;</div>
    smbclient is from the Samba distribution. smbclient is used to actually
      extract the incremental or full dump of the share filesystem from the PC.
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting only matters if $Conf{XferMethod} = 'smb'.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{SmbClientFullCmd} = '$smbClientPath
    \\\\$host\\$shareName' ...</dt>
  <dd class="It-tag">Command to run smbclient for a full dump. This setting only
      matters if $Conf{XferMethod} = 'smb'.
    <div style="height: 1.00em;">&#x00A0;</div>
    The following variables are substituted at run-time:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
   $smbClientPath   same as $Conf{SmbClientPath}
   $host            host to backup/restore
   $hostIP          host IP address
   $shareName       share name
   $userName        user name
   $fileList        list of files to backup (based on exclude/include)
   $I_option        optional -I option to smbclient
   $X_option        exclude option (if $fileList is an exclude list)
   $timeStampFile   start time for incremental dump
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: all Cmds are executed directly without a shell, so the prog name needs
      to be a full path and you can't include shell syntax like redirection and
      pipes; put that in a script if you need it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{SmbClientIncrCmd} = '$smbClientPath
    \\\\$host\\$shareName' ...</dt>
  <dd class="It-tag">Command to run smbclient for an incremental dump. This
      setting only matters if $Conf{XferMethod} = 'smb'.
    <div style="height: 1.00em;">&#x00A0;</div>
    Same variable substitutions are applied as $Conf{SmbClientFullCmd}.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: all Cmds are executed directly without a shell, so the prog name needs
      to be a full path and you can't include shell syntax like redirection and
      pipes; put that in a script if you need it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{SmbClientRestoreCmd} = '$smbClientPath
    \\\\$host\\$shareName' ...</dt>
  <dd class="It-tag">Command to run smbclient for a restore. This setting only
      matters if $Conf{XferMethod} = 'smb'.
    <div style="height: 1.00em;">&#x00A0;</div>
    Same variable substitutions are applied as $Conf{SmbClientFullCmd}.
    <div style="height: 1.00em;">&#x00A0;</div>
    If your smb share is read-only then direct restores will fail. You should
      set $Conf{SmbClientRestoreCmd} to undef and the corresponding CGI restore
      option will be removed.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: all Cmds are executed directly without a shell, so the prog name needs
      to be a full path and you can't include shell syntax like redirection and
      pipes; put that in a script if you need it.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Tar_Configuration"><a class="selflink" href="#Tar_Configuration">Tar
  Configuration</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{TarShareName} = '/';</dt>
  <dd class="It-tag">Which host directories to backup when using tar transport.
      This can be a string or an array of strings if there are multiple
      directories to backup per host. Examples:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  $Conf{TarShareName} = '/';                    # backup everything
  $Conf{TarShareName} = '/home';                # only backup /home
  $Conf{TarShareName} = ['/home', '/src'];      # backup /home and /src
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    The fact this parameter is called 'TarShareName' is for historical
      consistency with the Smb transport options. You can use any valid
      directory on the client: there is no need for it to correspond to any Smb
      share or device mount point.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note also that you can also use $Conf{BackupFilesOnly} to specify a specific
      list of directories to backup. It's more efficient to use this option
      instead of $Conf{TarShareName} since a new tar is run for each entry in
      $Conf{TarShareName}.
    <div style="height: 1.00em;">&#x00A0;</div>
    On the other hand, if you add --one-file-system to $Conf{TarClientCmd} you
      can backup each file system separately, which makes restoring one bad file
      system easier. In this case you would list all of the mount points here,
      since you can't get the same result with $Conf{BackupFilesOnly}:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    $Conf{TarShareName} = ['/', '/var', '/data', '/boot'];
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting only matters if $Conf{XferMethod} = 'tar'.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{TarClientCmd} = '$sshPath -q -x -n -l root $host'
    ...</dt>
  <dd class="It-tag">Command to run tar on the client. GNU tar is required. You
      will need to fill in the correct paths for ssh2 on the local host (server)
      and GNU tar on the client. Security caution: normal users should not
      allowed to write to these executable files or directories.
    <div style="height: 1.00em;">&#x00A0;</div>
    $Conf{TarClientCmd} is appended with with either $Conf{TarFullArgs} or
      $Conf{TarIncrArgs} to create the final command that is run.
    <div style="height: 1.00em;">&#x00A0;</div>
    See the documentation for more information about setting up ssh2 keys.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you plan to use NFS then tar just runs locally and ssh2 is not needed.
      For example, assuming the client filesystem is mounted below
      /mnt/hostName, you could use something like:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
   $Conf{TarClientCmd} = '$tarPath -c -v -f - -C /mnt/$host/$shareName'
                       . ' --totals';
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    In the case of NFS or rsh you need to make sure BackupPC's privileges are
      sufficient to read all the files you want to backup. Also, you will
      probably want to add &quot;/proc&quot; to $Conf{BackupFilesExclude}.
    <div style="height: 1.00em;">&#x00A0;</div>
    The following variables are substituted at run-time:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  $host        host name
  $hostIP      host's IP address
  $incrDate    newer-than date for incremental backups
  $shareName   share name to backup (ie: top-level directory path)
  $fileList    specific files to backup or exclude
  $tarPath     same as $Conf{TarClientPath}
  $sshPath     same as $Conf{SshPath}
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    If a variable is followed by a &quot;+&quot; it is shell escaped. This is
      necessary for the command part of ssh or rsh, since it ends up getting
      passed through the shell.
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting only matters if $Conf{XferMethod} = 'tar'.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: all Cmds are executed directly without a shell, so the prog name needs
      to be a full path and you can't include shell syntax like redirection and
      pipes; put that in a script if you need it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{TarFullArgs} = '$fileList+';</dt>
  <dd class="It-tag">Extra tar arguments for full backups. Several variables are
      substituted at run-time. See $Conf{TarClientCmd} for the list of variable
      substitutions.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you are running tar locally (ie: without rsh or ssh) then remove the
      &quot;+&quot; so that the argument is no longer shell escaped.
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting only matters if $Conf{XferMethod} = 'tar'.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{TarIncrArgs} = '--newer=$incrDate+ $fileList+';</dt>
  <dd class="It-tag">Extra tar arguments for incr backups. Several variables are
      substituted at run-time. See $Conf{TarClientCmd} for the list of variable
      substitutions.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note that GNU tar has several methods for specifying incremental backups,
      including:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  --newer-mtime $incrDate+
         This causes a file to be included if the modification time is
         later than $incrDate (meaning its contents might have changed).
         But changes in the ownership or modes will not qualify the
         file to be included in an incremental.
  --newer=$incrDate+
         This causes the file to be included if any attribute of the
         file is later than $incrDate, meaning either attributes or
         the modification time.  This is the default method.  Do
         not use --atime-preserve in $Conf{TarClientCmd} above,
         otherwise resetting the atime (access time) counts as an
         attribute change, meaning the file will always be included
         in each new incremental dump.
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    If you are running tar locally (ie: without rsh or ssh) then remove the
      &quot;+&quot; so that the argument is no longer shell escaped.
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting only matters if $Conf{XferMethod} = 'tar'.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{TarClientRestoreCmd} = '$sshPath -q -x -l root $host'
    ...</dt>
  <dd class="It-tag">Full command to run tar for restore on the client. GNU tar
      is required. This can be the same as $Conf{TarClientCmd}, with tar's -c
      replaced by -x and ssh's -n removed.
    <div style="height: 1.00em;">&#x00A0;</div>
    See $Conf{TarClientCmd} for full details.
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting only matters if $Conf{XferMethod} = &quot;tar&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you want to disable direct restores using tar, you should set
      $Conf{TarClientRestoreCmd} to undef and the corresponding CGI restore
      option will be removed.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: all Cmds are executed directly without a shell, so the prog name needs
      to be a full path and you can't include shell syntax like redirection and
      pipes; put that in a script if you need it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{TarClientPath} = '';</dt>
  <dd class="It-tag">Full path for tar on the client. Security caution: normal
      users should not allowed to write to this file or directory.
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting only matters if $Conf{XferMethod} = 'tar'.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Rsync/Rsyncd_Configuration"><a class="selflink" href="#Rsync/Rsyncd_Configuration">Rsync/Rsyncd
  Configuration</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{RsyncClientPath} = '';</dt>
  <dd class="It-tag">Path to rsync executable on the client</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{RsyncClientCmd} = '$sshPath -q -x -l root $host
    $rsyncPath $argList+';</dt>
  <dd class="It-tag">Full command to run rsync on the client machine. The
      following variables are substituted at run-time:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
       $host           host name being backed up
       $hostIP         host's IP address
       $shareName      share name to backup (ie: top-level directory path)
       $rsyncPath      same as $Conf{RsyncClientPath}
       $sshPath        same as $Conf{SshPath}
       $argList        argument list, built from $Conf{RsyncArgs},
                       $shareName, $Conf{BackupFilesExclude} and
                       $Conf{BackupFilesOnly}
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting only matters if $Conf{XferMethod} = 'rsync'.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{RsyncClientRestoreCmd} = '$sshPath -q -x -l root
    $host $rsyncPath $argList+';</dt>
  <dd class="It-tag">Full command to run rsync for restore on the client. The
      following variables are substituted at run-time:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
       $host           host name being backed up
       $hostIP         host's IP address
       $shareName      share name to backup (ie: top-level directory path)
       $rsyncPath      same as $Conf{RsyncClientPath}
       $sshPath        same as $Conf{SshPath}
       $argList        argument list, built from $Conf{RsyncArgs},
                       $shareName, $Conf{BackupFilesExclude} and
                       $Conf{BackupFilesOnly}
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting only matters if $Conf{XferMethod} = 'rsync'.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: all Cmds are executed directly without a shell, so the prog name needs
      to be a full path and you can't include shell syntax like redirection and
      pipes; put that in a script if you need it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{RsyncShareName} = '/';</dt>
  <dd class="It-tag">Share name to backup. For $Conf{XferMethod} =
      &quot;rsync&quot; this should be a file system path, eg '/' or '/home'.
    <div style="height: 1.00em;">&#x00A0;</div>
    For $Conf{XferMethod} = &quot;rsyncd&quot; this should be the name of the
      module to backup (ie: the name from /etc/rsynd.conf).
    <div style="height: 1.00em;">&#x00A0;</div>
    This can also be a list of multiple file system paths or modules. For
      example, by adding --one-file-system to $Conf{RsyncArgs} you can backup
      each file system separately, which makes restoring one bad file system
      easier. In this case you would list all of the mount points:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    $Conf{RsyncShareName} = ['/', '/var', '/data', '/boot'];
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{RsyncdClientPort} = 873;</dt>
  <dd class="It-tag">Rsync daemon port on the client, for $Conf{XferMethod} =
      &quot;rsyncd&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{RsyncdUserName} = '';</dt>
  <dd class="It-tag">Rsync daemon user name on client, for $Conf{XferMethod} =
      &quot;rsyncd&quot;. The user name and password are stored on the client in
      whatever file the &quot;secrets file&quot; parameter in rsyncd.conf points
      to (eg: /etc/rsyncd.secrets).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{RsyncdPasswd} = '';</dt>
  <dd class="It-tag">Rsync daemon user name on client, for $Conf{XferMethod} =
      &quot;rsyncd&quot;. The user name and password are stored on the client in
      whatever file the &quot;secrets file&quot; parameter in rsyncd.conf points
      to (eg: /etc/rsyncd.secrets).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{RsyncdAuthRequired} = 1;</dt>
  <dd class="It-tag">Whether authentication is mandatory when connecting to the
      client's rsyncd. By default this is on, ensuring that BackupPC will refuse
      to connect to an rsyncd on the client that is not password protected. Turn
      off at your own risk.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{RsyncCsumCacheVerifyProb} = 0.01;</dt>
  <dd class="It-tag">When rsync checksum caching is enabled (by adding the
      --checksum-seed=32761 option to $Conf{RsyncArgs}), the cached checksums
      can be occasionally verified to make sure the file contents matches the
      cached checksums. This is to avoid the risk that disk problems might cause
      the pool file contents to get corrupted, but the cached checksums would
      make BackupPC think that the file still matches the client.
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting is the probability (0 means never and 1 means always) that a
      file will be rechecked. Setting it to 0 means the checksums will not be
      rechecked (unless there is a phase 0 failure). Setting it to 1 (ie: 100%)
      means all files will be checked, but that is not a desirable setting since
      you are better off simply turning caching off (ie: remove the
      --checksum-seed option).
    <div style="height: 1.00em;">&#x00A0;</div>
    The default of 0.01 means 1% (on average) of the files during a full backup
      will have their cached checksum re-checked.
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting has no effect unless checksum caching is turned on.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{RsyncArgs} = [ ... ];</dt>
  <dd class="It-tag">Arguments to rsync for backup. Do not edit the first set
      unless you have a thorough understanding of how File::RsyncP works.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{RsyncArgsExtra} = [];</dt>
  <dd class="It-tag">Additional arguments added to RsyncArgs. This can be used
      in conbination with $Conf{RsyncArgs} to allow customization of the rsync
      arguments on a part-client basis. The standard arguments go in
      $Conf{RsyncArgs} and $Conf{RsyncArgsExtra} can be set on a per-client
      basis.
    <div style="height: 1.00em;">&#x00A0;</div>
    Examples of additional arguments that should work are --exclude/--include,
      eg:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    $Conf{RsyncArgsExtra} = [
          '--exclude', '/proc',
          '--exclude', '*.tmp',
    ];
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Both $Conf{RsyncArgs} and $Conf{RsyncArgsExtra} are subject to the following
      variable substitutions:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
       $client       client name being backed up
       $host         host name (could be different from client name if
                                $Conf{ClientNameAlias} is set)
       $hostIP       IP address of host
       $confDir      configuration directory path
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This allows settings of the form:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    $Conf{RsyncArgsExtra} = [
            '--exclude-from=$confDir/pc/$host.exclude',
    ];
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{RsyncRestoreArgs} = [ ... ];</dt>
  <dd class="It-tag">Arguments to rsync for restore. Do not edit the first set
      unless you have a thorough understanding of how File::RsyncP works.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you want to disable direct restores using rsync (eg: is the module is
      read-only), you should set $Conf{RsyncRestoreArgs} to undef and the
      corresponding CGI restore option will be removed.
    <div style="height: 1.00em;">&#x00A0;</div>
    $Conf{RsyncRestoreArgs} is subject to the following variable substitutions:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
       $client       client name being backed up
       $host         host name (could be different from client name if
                                $Conf{ClientNameAlias} is set)
       $hostIP       IP address of host
       $confDir      configuration directory path
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: $Conf{RsyncArgsExtra} doesn't apply to $Conf{RsyncRestoreArgs}.</dd>
</dl>
<h2 class="Ss" title="Ss" id="FTP_Configuration"><a class="selflink" href="#FTP_Configuration">FTP
  Configuration</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{FtpShareName} = '';</dt>
  <dd class="It-tag">Which host directories to backup when using FTP. This can
      be a string or an array of strings if there are multiple shares per host.
    <div style="height: 1.00em;">&#x00A0;</div>
    This value must be specified in one of two ways: either as a subdirectory of
      the 'share root' on the server, or as the absolute path of the directory.
    <div style="height: 1.00em;">&#x00A0;</div>
    In the following example, if the directory /home/username is the root share
      of the ftp server with the given username, the following two values will
      back up the same directory:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
   $Conf{FtpShareName} = 'www';                # www directory
   $Conf{FtpShareName} = '/home/username/www'; # same directory
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Path resolution is not supported; i.e.; you may not have an ftp share path
      defined as '../otheruser' or '~/games'.
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 Multiple shares may also be specified, as with other protocols:
   $Conf{FtpShareName} = [ 'www',
                           'bin',
                           'config' ];
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Note also that you can also use $Conf{BackupFilesOnly} to specify a specific
      list of directories to backup. It's more efficient to use this option
      instead of $Conf{FtpShareName} since a new tar is run for each entry in
      $Conf{FtpShareName}.
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting only matters if $Conf{XferMethod} = 'ftp'.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{FtpUserName} = '';</dt>
  <dd class="It-tag">FTP user name. This is used to log into the server.
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting is used only if $Conf{XferMethod} = 'ftp'.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{FtpPasswd} = '';</dt>
  <dd class="It-tag">FTP user password. This is used to log into the server.
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting is used only if $Conf{XferMethod} = 'ftp'.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{FtpPassive} = 1;</dt>
  <dd class="It-tag">Whether passive mode is used. The correct setting depends
      upon whether local or remote ports are accessible from the other machine,
      which is affected by any firewall or routers between the FTP server on the
      client and the BackupPC server.
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting is used only if $Conf{XferMethod} = 'ftp'.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{FtpBlockSize} = 10240;</dt>
  <dd class="It-tag">Transfer block size. This sets the size of the amounts of
      data in each frame. While undefined, this value takes the default value.
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting is used only if $Conf{XferMethod} = 'ftp'.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{FtpPort} = 21;</dt>
  <dd class="It-tag">The port of the ftp server. If undefined, 21 is used.
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting is used only if $Conf{XferMethod} = 'ftp'.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{FtpTimeout} = 120;</dt>
  <dd class="It-tag">Connection timeout for FTP. When undefined, the default is
      120 seconds.
    <div style="height: 1.00em;">&#x00A0;</div>
    This setting is used only if $Conf{XferMethod} = 'ftp'.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{FtpFollowSymlinks} = 0;</dt>
  <dd class="It-tag">Behaviour when BackupPC encounters symlinks on the FTP
      share.
    <div style="height: 1.00em;">&#x00A0;</div>
    Symlinks cannot be restored via FTP, so the desired behaviour will be
      different depending on the setup of the share. The default for this
      behavor is 1. Directory shares with more complicated directory structures
      should consider other protocols.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Archive_Configuration"><a class="selflink" href="#Archive_Configuration">Archive
  Configuration</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{ArchiveDest} = '/tmp';</dt>
  <dd class="It-tag">Archive Destination
    <div style="height: 1.00em;">&#x00A0;</div>
    The Destination of the archive e.g. /tmp for file archive or /dev/nst0 for
      device archive</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{ArchiveComp} = 'gzip';</dt>
  <dd class="It-tag">Archive Compression type
    <div style="height: 1.00em;">&#x00A0;</div>
    The valid values are:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  - 'none':  No Compression
  - 'gzip':  Medium Compression. Recommended.
  - 'bzip2': High Compression but takes longer.
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{ArchivePar} = 0;</dt>
  <dd class="It-tag">Archive Parity Files
    <div style="height: 1.00em;">&#x00A0;</div>
    The amount of Parity data to generate, as a percentage of the archive size.
      Uses the commandline par2 (par2cmdline) available from
      http://parchive.sourceforge.net
    <div style="height: 1.00em;">&#x00A0;</div>
    Only useful for file dumps.
    <div style="height: 1.00em;">&#x00A0;</div>
    Set to 0 to disable this feature.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{ArchiveSplit} = 0;</dt>
  <dd class="It-tag">Archive Size Split
    <div style="height: 1.00em;">&#x00A0;</div>
    Only for file archives. Splits the output into the specified size *
      1,000,000. e.g. to split into 650,000,000 bytes, specify 650 below.
    <div style="height: 1.00em;">&#x00A0;</div>
    If the value is 0, or if $Conf{ArchiveDest} is an existing file or device
      (e.g. a streaming tape drive), this feature is disabled.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{ArchiveClientCmd} =
    '$Installdir/bin/BackupPC_archiveHost' ...</dt>
  <dd class="It-tag">Archive Command
    <div style="height: 1.00em;">&#x00A0;</div>
    This is the command that is called to actually run the archive process for
      each host. The following variables are substituted at run-time:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  $Installdir    The installation directory of BackupPC
  $tarCreatePath The path to BackupPC_tarCreate
  $splitpath     The path to the split program
  $parpath       The path to the par2 program
  $host          The host to archive
  $backupnumber  The backup number of the host to archive
  $compression   The path to the compression program
  $compext       The extension assigned to the compression type
  $splitsize     The number of bytes to split archives into
  $archiveloc    The location to put the archive
  $parfile       The amount of parity data to create (percentage)
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: all Cmds are executed directly without a shell, so the prog name needs
      to be a full path and you can't include shell syntax like redirection and
      pipes; put that in a script if you need it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{SshPath} = '';</dt>
  <dd class="It-tag">Full path for ssh. Security caution: normal users should
      not allowed to write to this file or directory.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{NmbLookupPath} = '';</dt>
  <dd class="It-tag">Full path for nmblookup. Security caution: normal users
      should not allowed to write to this file or directory.
    <div style="height: 1.00em;">&#x00A0;</div>
    nmblookup is from the Samba distribution. nmblookup is used to get the
      netbios name, necessary for DHCP hosts.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{NmbLookupCmd} = '$nmbLookupPath -A $host';</dt>
  <dd class="It-tag">NmbLookup command. Given an IP address, does an nmblookup
      on that IP address. The following variables are substituted at run-time:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  $nmbLookupPath      path to nmblookup ($Conf{NmbLookupPath})
  $host               IP address
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This command is only used for DHCP hosts: given an IP address, this command
      should try to find its NetBios name.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: all Cmds are executed directly without a shell, so the prog name needs
      to be a full path and you can't include shell syntax like redirection and
      pipes; put that in a script if you need it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{NmbLookupFindHostCmd} = '$nmbLookupPath $host';</dt>
  <dd class="It-tag">NmbLookup command. Given a netbios name, finds that host by
      doing a NetBios lookup. Several variables are substituted at run-time:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  $nmbLookupPath      path to nmblookup ($Conf{NmbLookupPath})
  $host               NetBios name
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    In some cases you might need to change the broadcast address, for example if
      nmblookup uses 192.168.255.255 by default and you find that doesn't work,
      try 192.168.1.255 (or your equivalent class C address) using the -B
      option:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
   $Conf{NmbLookupFindHostCmd} = '$nmbLookupPath -B 192.168.1.255 $host';
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    If you use a WINS server and your machines don't respond to multicast
      NetBios requests you can use this (replace 1.2.3.4 with the IP address of
      your WINS server):
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
   $Conf{NmbLookupFindHostCmd} = '$nmbLookupPath -R -U 1.2.3.4 $host';
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This is preferred over multicast since it minimizes network traffic.
    <div style="height: 1.00em;">&#x00A0;</div>
    Experiment manually for your site to see what form of nmblookup command
      works.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: all Cmds are executed directly without a shell, so the prog name needs
      to be a full path and you can't include shell syntax like redirection and
      pipes; put that in a script if you need it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{FixedIPNetBiosNameCheck} = 0;</dt>
  <dd class="It-tag">For fixed IP address hosts, BackupPC_dump can also verify
      the netbios name to ensure it matches the host name. An error is generated
      if they do not match. Typically this flag is off. But if you are going to
      transition a bunch of machines from fixed host addresses to DHCP, setting
      this flag is a great way to verify that the machines have their netbios
      name set correctly before turning on DCHP.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{PingPath} = '';</dt>
  <dd class="It-tag">Full path to the ping command. Security caution: normal
      users should not be allowed to write to this file or directory.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you want to disable ping checking, set this to some program that exits
      with 0 status, eg:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    $Conf{PingPath} = '/bin/echo';
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{PingCmd} = '$pingPath -c 1 $host';</dt>
  <dd class="It-tag">Ping command. The following variables are substituted at
      run-time:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  $pingPath      path to ping ($Conf{PingPath})
  $host          host name
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Wade Brown reports that on solaris 2.6 and 2.7 ping -s returns the wrong
      exit status (0 even on failure). Replace with &quot;ping $host 1&quot;,
      which gets the correct exit status but we don't get the round-trip time.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: all Cmds are executed directly without a shell, so the prog name needs
      to be a full path and you can't include shell syntax like redirection and
      pipes; put that in a script if you need it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{PingMaxMsec} = 20;</dt>
  <dd class="It-tag">Maximum round-trip ping time in milliseconds. This
      threshold is set to avoid backing up PCs that are remotely connected
      through WAN or dialup connections. The output from ping -s (assuming it is
      supported on your system) is used to check the round-trip packet time. On
      your local LAN round-trip times should be much less than 20msec. On most
      WAN or dialup connections the round-trip time will be typically more than
      20msec. Tune if necessary.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CompressLevel} = 0;</dt>
  <dd class="It-tag">Compression level to use on files. 0 means no compression.
      Compression levels can be from 1 (least cpu time, slightly worse
      compression) to 9 (most cpu time, slightly better compression). The
      recommended value is 3. Changing to 5, for example, will take maybe 20%
      more cpu time and will get another 2-3% additional compression. See the
      zlib documentation for more information about compression levels.
    <div style="height: 1.00em;">&#x00A0;</div>
    Changing compression on or off after backups have already been done will
      require both compressed and uncompressed pool files to be stored. This
      will increase the pool storage requirements, at least until all the old
      backups expire and are deleted.
    <div style="height: 1.00em;">&#x00A0;</div>
    It is ok to change the compression value (from one non-zero value to another
      non-zero value) after dumps are already done. Since BackupPC matches pool
      files by comparing the uncompressed versions, it will still correctly
      match new incoming files against existing pool files. The new compression
      level will take effect only for new files that are newly compressed and
      added to the pool.
    <div style="height: 1.00em;">&#x00A0;</div>
    If compression was off and you are enabling compression for the first time
      you can use the BackupPC_compressPool utility to compress the pool. This
      avoids having the pool grow to accommodate both compressed and
      uncompressed backups. See the documentation for more information.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: compression needs the Compress::Zlib perl library. If the
      Compress::Zlib library can't be found then $Conf{CompressLevel} is forced
      to 0 (compression off).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{ClientTimeout} = 72000;</dt>
  <dd class="It-tag">Timeout in seconds when listening for the transport
      program's (smbclient, tar etc) stdout. If no output is received during
      this time, then it is assumed that something has wedged during a backup,
      and the backup is terminated.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note that stdout buffering combined with huge files being backed up could
      cause longish delays in the output from smbclient that BackupPC_dump sees,
      so in rare cases you might want to increase this value.
    <div style="height: 1.00em;">&#x00A0;</div>
    Despite the name, this parameter sets the timeout for all transport methods
      (tar, smb etc).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{MaxOldPerPCLogFiles} = 12;</dt>
  <dd class="It-tag">Maximum number of log files we keep around in each PC's
      directory (ie: pc/$host). These files are aged monthly. A setting of 12
      means there will be at most the files LOG, LOG.0, LOG.1, ... LOG.11 in the
      pc/$host directory (ie: about a years worth). (Except this month's LOG,
      these files will have a .z extension if compression is on).
    <div style="height: 1.00em;">&#x00A0;</div>
    If you decrease this number after BackupPC has been running for a while you
      will have to manually remove the older log files.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{DumpPreUserCmd} = undef;</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{DumpPostUserCmd} = undef;</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{DumpPreShareCmd} = undef;</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{DumpPostShareCmd} = undef;</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{RestorePreUserCmd} = undef;</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{RestorePostUserCmd} = undef;</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{ArchivePreUserCmd} = undef;</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{ArchivePostUserCmd} = undef;</dt>
  <dd class="It-tag">Optional commands to run before and after dumps and
      restores, and also before and after each share of a dump.
    <div style="height: 1.00em;">&#x00A0;</div>
    Stdout from these commands will be written to the Xfer (or Restore) log
      file. One example of using these commands would be to shut down and
      restart a database server, dump a database to files for backup, or doing a
      snapshot of a share prior to a backup. Example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
   $Conf{DumpPreUserCmd} = '$sshPath -q -x -l root $host /usr/bin/dumpMysql';
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    The following variable substitutions are made at run time for
      $Conf{DumpPreUserCmd}, $Conf{DumpPostUserCmd}, $Conf{DumpPreShareCmd} and
      $Conf{DumpPostShareCmd}:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
       $type         type of dump (incr or full)
       $xferOK       1 if the dump succeeded, 0 if it didn't
       $client       client name being backed up
       $host         host name (could be different from client name if
                                $Conf{ClientNameAlias} is set)
       $hostIP       IP address of host
       $user         user name from the hosts file
       $moreUsers    list of additional users from the hosts file
       $share        the first share name (or current share for
                       $Conf{DumpPreShareCmd} and $Conf{DumpPostShareCmd})
       $shares       list of all the share names
       $XferMethod   value of $Conf{XferMethod} (eg: tar, rsync, smb)
       $sshPath      value of $Conf{SshPath},
       $cmdType      set to DumpPreUserCmd or DumpPostUserCmd
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    The following variable substitutions are made at run time for
      $Conf{RestorePreUserCmd} and $Conf{RestorePostUserCmd}:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
       $client       client name being backed up
       $xferOK       1 if the restore succeeded, 0 if it didn't
       $host         host name (could be different from client name if
                                $Conf{ClientNameAlias} is set)
       $hostIP       IP address of host
       $user         user name from the hosts file
       $moreUsers    list of additional users from the hosts file
       $share        the first share name
       $XferMethod   value of $Conf{XferMethod} (eg: tar, rsync, smb)
       $sshPath      value of $Conf{SshPath},
       $type         set to &quot;restore&quot;
       $bkupSrcHost  host name of the restore source
       $bkupSrcShare share name of the restore source
       $bkupSrcNum   backup number of the restore source
       $pathHdrSrc   common starting path of restore source
       $pathHdrDest  common starting path of destination
       $fileList     list of files being restored
       $cmdType      set to RestorePreUserCmd or RestorePostUserCmd
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    The following variable substitutions are made at run time for
      $Conf{ArchivePreUserCmd} and $Conf{ArchivePostUserCmd}:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
       $client       client name being backed up
       $xferOK       1 if the archive succeeded, 0 if it didn't
       $host         Name of the archive host
       $user         user name from the hosts file
       $share        the first share name
       $XferMethod   value of $Conf{XferMethod} (eg: tar, rsync, smb)
       $HostList     list of hosts being archived
       $BackupList   list of backup numbers for the hosts being archived
       $archiveloc   location where the archive is sent to
       $parfile      amount of parity data being generated (percentage)
       $compression  compression program being used (eg: cat, gzip, bzip2)
       $compext      extension used for compression type (eg: raw, gz, bz2)
       $splitsize    size of the files that the archive creates
       $sshPath      value of $Conf{SshPath},
       $type         set to &quot;archive&quot;
       $cmdType      set to ArchivePreUserCmd or ArchivePostUserCmd
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: all Cmds are executed directly without a shell, so the prog name needs
      to be a full path and you can't include shell syntax like redirection and
      pipes; put that in a script if you need it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{UserCmdCheckStatus} = 0;</dt>
  <dd class="It-tag">Whether the exit status of each PreUserCmd and PostUserCmd
      is checked.
    <div style="height: 1.00em;">&#x00A0;</div>
    If set and the Dump/Restore/Archive Pre/Post UserCmd returns a non-zero exit
      status then the dump/restore/archive is aborted. To maintain backward
      compatibility (where the exit status in early versions was always
      ignored), this flag defaults to 0.
    <div style="height: 1.00em;">&#x00A0;</div>
    If this flag is set and the Dump/Restore/Archive PreUserCmd fails then the
      matching Dump/Restore/Archive PostUserCmd is not executed. If
      DumpPreShareCmd returns a non-exit status, then DumpPostShareCmd is not
      executed, but the DumpPostUserCmd is still run (since DumpPreUserCmd must
      have previously succeeded).
    <div style="height: 1.00em;">&#x00A0;</div>
    An example of a DumpPreUserCmd that might fail is a script that snapshots or
      dumps a database which fails because of some database error.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{ClientNameAlias} = undef;</dt>
  <dd class="It-tag">Override the client's host name. This allows multiple
      clients to all refer to the same physical host. This should only be set in
      the per-PC config file and is only used by BackupPC at the last moment
      prior to generating the command used to backup that machine (ie: the value
      of $Conf{ClientNameAlias} is invisible everywhere else in BackupPC). The
      setting can be a host name or IP address, eg:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
        $Conf{ClientNameAlias} = 'realHostName';
        $Conf{ClientNameAlias} = '192.1.1.15';
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    will cause the relevant smb/tar/rsync backup/restore commands to be directed
      to realHostName, not the client name.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: this setting doesn't work for hosts with DHCP set to 1.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Email_reminders,_status_and_messages"><a class="selflink" href="#Email_reminders,_status_and_messages">Email
  reminders, status and messages</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{SendmailPath} = '';</dt>
  <dd class="It-tag">Full path to the sendmail command. Security caution: normal
      users should not allowed to write to this file or directory.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{EMailNotifyMinDays} = 2.5;</dt>
  <dd class="It-tag">Minimum period between consecutive emails to a single user.
      This tries to keep annoying email to users to a reasonable level. Email
      checks are done nightly, so this number is effectively rounded up (ie: 2.5
      means a user will never receive email more than once every 3 days).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{EMailFromUserName} = '';</dt>
  <dd class="It-tag">Name to use as the &quot;from&quot; name for email.
      Depending upon your mail handler this is either a plain name (eg:
      &quot;admin&quot;) or a fully-qualified name (eg:
      &quot;admin@mydomain.com&quot;).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{EMailAdminUserName} = '';</dt>
  <dd class="It-tag">Destination address to an administrative user who will
      receive a nightly email with warnings and errors. If there are no warnings
      or errors then no email will be sent. Depending upon your mail handler
      this is either a plain name (eg: &quot;admin&quot;) or a fully-qualified
      name (eg: &quot;admin@mydomain.com&quot;).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{EMailUserDestDomain} = '';</dt>
  <dd class="It-tag">Destination domain name for email sent to users. By default
      this is empty, meaning email is sent to plain, unqualified addresses.
      Otherwise, set it to the destintation domain, eg:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
   $Cong{EMailUserDestDomain} = '@mydomain.com';
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    With this setting user email will be set to 'user@mydomain.com'.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{EMailNoBackupEverSubj} = undef;</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{EMailNoBackupEverMesg} = undef;</dt>
  <dd class="It-tag">This subject and message is sent to a user if their PC has
      never been backed up.
    <div style="height: 1.00em;">&#x00A0;</div>
    These values are language-dependent. The default versions can be found in
      the language file (eg: lib/BackupPC/Lang/en.pm). If you need to change the
      message, copy it here and edit it, eg:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  $Conf{EMailNoBackupEverMesg} = &lt;&lt;'EOF';
  To: $user$domain
  cc:
  Subject: $subj
  Dear $userName,
  This is a site-specific email message.
  EOF
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{EMailNotifyOldBackupDays} = 7.0;</dt>
  <dd class="It-tag">How old the most recent backup has to be before notifying
      user. When there have been no backups in this number of days the user is
      sent an email.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{EMailNoBackupRecentSubj} = undef;</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{EMailNoBackupRecentMesg} = undef;</dt>
  <dd class="It-tag">This subject and message is sent to a user if their PC has
      not recently been backed up (ie: more than $Conf{EMailNotifyOldBackupDays}
      days ago).
    <div style="height: 1.00em;">&#x00A0;</div>
    These values are language-dependent. The default versions can be found in
      the language file (eg: lib/BackupPC/Lang/en.pm). If you need to change the
      message, copy it here and edit it, eg:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  $Conf{EMailNoBackupRecentMesg} = &lt;&lt;'EOF';
  To: $user$domain
  cc:
  Subject: $subj
  Dear $userName,
  This is a site-specific email message.
  EOF
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{EMailNotifyOldOutlookDays} = 5.0;</dt>
  <dd class="It-tag">How old the most recent backup of Outlook files has to be
      before notifying user.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{EMailOutlookBackupSubj} = undef;</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{EMailOutlookBackupMesg} = undef;</dt>
  <dd class="It-tag">This subject and message is sent to a user if their Outlook
      files have not recently been backed up (ie: more than
      $Conf{EMailNotifyOldOutlookDays} days ago).
    <div style="height: 1.00em;">&#x00A0;</div>
    These values are language-dependent. The default versions can be found in
      the language file (eg: lib/BackupPC/Lang/en.pm). If you need to change the
      message, copy it here and edit it, eg:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  $Conf{EMailOutlookBackupMesg} = &lt;&lt;'EOF';
  To: $user$domain
  cc:
  Subject: $subj
  Dear $userName,
  This is a site-specific email message.
  EOF
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{EMailHeaders} = &lt;&lt;EOF;</dt>
  <dd class="It-tag">Additional email headers. This sets to charset to
    utf8.</dd>
</dl>
<h2 class="Ss" title="Ss" id="CGI_user_interface_configuration_settings"><a class="selflink" href="#CGI_user_interface_configuration_settings">CGI
  user interface configuration settings</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CgiAdminUserGroup} = '';</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CgiAdminUsers} = '';</dt>
  <dd class="It-tag">Normal users can only access information specific to their
      host. They can start/stop/browse/restore backups.
    <div style="height: 1.00em;">&#x00A0;</div>
    Administrative users have full access to all hosts, plus overall status and
      log information.
    <div style="height: 1.00em;">&#x00A0;</div>
    The administrative users are the union of the unix/linux group
      $Conf{CgiAdminUserGroup} and the manual list of users, separated by
      spaces, in $Conf{CgiAdminUsers}. If you don't want a group or manual list
      of users set the corresponding configuration setting to undef or an empty
      string.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you want every user to have admin privileges (careful!), set
      $Conf{CgiAdminUsers} = '*'.
    <div style="height: 1.00em;">&#x00A0;</div>
    Examples:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
   $Conf{CgiAdminUserGroup} = 'admin';
   $Conf{CgiAdminUsers}     = 'craig celia';
   --&gt; administrative users are the union of group admin, plus
     craig and celia.
   $Conf{CgiAdminUserGroup} = '';
   $Conf{CgiAdminUsers}     = 'craig celia';
   --&gt; administrative users are only craig and celia'.
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CgiURL} = undef;</dt>
  <dd class="It-tag">URL of the BackupPC_Admin CGI script. Used for email
      messages.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{Language} = 'en';</dt>
  <dd class="It-tag">Language to use. See lib/BackupPC/Lang for the list of
      supported languages, which include English (en), French (fr), Spanish
      (es), German (de), Italian (it), Dutch (nl), Polish (pl), Portuguese
      Brazillian (pt_br) and Chinese (zh_CH).
    <div style="height: 1.00em;">&#x00A0;</div>
    Currently the Language setting applies to the CGI interface and email
      messages sent to users. Log files and other text are still in
    English.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CgiUserHomePageCheck} = '';</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CgiUserUrlCreate} = 'mailto:%s';</dt>
  <dd class="It-tag">User names that are rendered by the CGI interface can be
      turned into links into their home page or other information about the
      user. To set this up you need to create two <i>sprintf()</i> strings, that
      each contain a single '%s' that will be replaced by the user name. The
      default is a mailto: link.
    <div style="height: 1.00em;">&#x00A0;</div>
    $Conf{CgiUserHomePageCheck} should be an absolute file path that is used to
      check (via &quot;-f&quot;) that the user has a valid home page. Set this
      to undef or an empty string to turn off this check.
    <div style="height: 1.00em;">&#x00A0;</div>
    $Conf{CgiUserUrlCreate} should be a full URL that points to the user's home
      page. Set this to undef or an empty string to turn off generation of URLs
      for user names.
    <div style="height: 1.00em;">&#x00A0;</div>
    Example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
   $Conf{CgiUserHomePageCheck} = '/var/www/html/users/%s.html';
   $Conf{CgiUserUrlCreate}     = 'http://myhost/users/%s.html';
   --&gt; if /var/www/html/users/craig.html exists, then 'craig' will
     be rendered as a link to http://myhost/users/craig.html.
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CgiDateFormatMMDD} = 1;</dt>
  <dd class="It-tag">Date display format for CGI interface. A value of 1 uses
      US-style dates (MM/DD), a value of 2 uses full YYYY-MM-DD format, and zero
      for international dates (DD/MM).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CgiNavBarAdminAllHosts} = 1;</dt>
  <dd class="It-tag">If set, the complete list of hosts appears in the left
      navigation bar pull-down for administrators. Otherwise, just the hosts for
      which the user is listed in the host file (as either the user or in
      moreUsers) are displayed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CgiSearchBoxEnable} = 1;</dt>
  <dd class="It-tag">Enable/disable the search box in the navigation bar.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CgiNavBarLinks} = [ ... ];</dt>
  <dd class="It-tag">Additional navigation bar links. These appear for both
      regular users and administrators. This is a list of hashes giving the link
      (URL) and the text (name) for the link. Specifying lname instead of name
      uses the language specific string (ie: $Lang-&gt;{lname}) instead of just
      literally displaying name.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CgiStatusHilightColor} = { ...</dt>
  <dd class="It-tag">Hilight colors based on status that are used in the PC
      summary page.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CgiHeaders} = '&lt;meta http-equiv=&quot;pragma&quot;
    content=&quot;no-cache&quot;&gt;';</dt>
  <dd class="It-tag">Additional CGI header text.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CgiImageDir} = '';</dt>
  <dd class="It-tag">Directory where images are stored. This directory should be
      below Apache's DocumentRoot. This value isn't used by BackupPC but is used
      by configure.pl when you upgrade BackupPC.
    <div style="height: 1.00em;">&#x00A0;</div>
    Example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    $Conf{CgiImageDir} = '/var/www/htdocs/BackupPC';
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CgiExt2ContentType} = { };</dt>
  <dd class="It-tag">Additional mappings of file name extenions to Content-Type
      for individual file restore. See $Ext2ContentType in BackupPC_Admin for
      the default setting. You can add additional settings here, or override any
      default settings. Example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    $Conf{CgiExt2ContentType} = {
                'pl'  =&gt; 'text/plain',
         };
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CgiImageDirURL} = '';</dt>
  <dd class="It-tag">URL (without the leading http://host) for BackupPC's image
      directory. The CGI script uses this value to serve up image files.
    <div style="height: 1.00em;">&#x00A0;</div>
    Example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    $Conf{CgiImageDirURL} = '/BackupPC';
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CgiCSSFile} = 'BackupPC_stnd.css';</dt>
  <dd class="It-tag">CSS stylesheet &quot;skin&quot; for the CGI interface. It
      is stored in the $Conf{CgiImageDir} directory and accessed via the
      $Conf{CgiImageDirURL} URL.
    <div style="height: 1.00em;">&#x00A0;</div>
    For BackupPC v3.x several color, layout and font changes were made. The
      previous v2.x version is available as BackupPC_stnd_orig.css, so if you
      prefer the old skin, change this to BackupPC_stnd_orig.css.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CgiUserConfigEditEnable} = 1;</dt>
  <dd class="It-tag">Whether the user is allowed to edit their per-PC
    config.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$Conf{CgiUserConfigEdit} = { ...</dt>
  <dd class="It-tag">Which per-host config variables a non-admin user is allowed
      to edit. Admin users can edit all per-host config variables, even if
      disabled in this list.
    <div style="height: 1.00em;">&#x00A0;</div>
    SECURITY WARNING: Do not let users edit any of the Cmd config variables!
      That's because a user could set a Cmd to a shell script of their choice
      and it will be run as the BackupPC user. That script could do all sorts of
      bad things.</dd>
</dl>
<h1 class="Sh" title="Sh" id="Version_Numbers"><a class="selflink" href="#Version_Numbers">Version
  Numbers</a></h1>
Starting with v1.4.0 BackupPC uses a X.Y.Z version numbering system, instead of
  X.0Y. The first digit is for major new releases, the middle digit is for
  significant feature releases and improvements (most of the releases have been
  in this category), and the last digit is for bug fixes. You should think of
  the old 1.00, 1.01, 1.02 and 1.03 as 1.0.0, 1.1.0, 1.2.0 and 1.3.0.
<div class="Pp"></div>
Additionally, patches might be made available. A patched version number is of
  the form X.Y.ZplN (eg: 2.1.0pl2), where N is the patch level.
<h1 class="Sh" title="Sh" id="Author"><a class="selflink" href="#Author">Author</a></h1>
Craig Barratt &lt;cbarratt@users.sourceforge.net&gt;
<div class="Pp"></div>
See &lt;http://backuppc.sourceforge.net&gt;.
<h1 class="Sh" title="Sh" id="Copyright"><a class="selflink" href="#Copyright">Copyright</a></h1>
Copyright (C) 2001-2015 Craig Barratt
<h1 class="Sh" title="Sh" id="Credits"><a class="selflink" href="#Credits">Credits</a></h1>
Ryan Kucera contributed the directory navigation code and images for v1.5.0. He
  contributed the first skeleton of BackupPC_restore. He also added a
  significant revision to the CGI interface, including CSS tags, in v2.1.0, and
  designed the BackupPC logo.
<div class="Pp"></div>
Xavier Nicollet, with additions from Guillaume Filion, added the
  internationalization (i18n) support to the CGI interface for v2.0.0. Xavier
  provided the French translation fr.pm, with additions from Guillaume.
<div class="Pp"></div>
Guillaume Filion wrote BackupPC_zipCreate and added the CGI support for zip
  download, in addition to some CGI cleanup, for v1.5.0. Guillaume continues to
  support fr.pm updates for each new version.
<div class="Pp"></div>
Josh Marshall implemented the Archive feature in v2.1.0.
<div class="Pp"></div>
Ludovic Drolez supports the BackupPC Debian package.
<div class="Pp"></div>
Javier Gonzalez provided the Spanish translation, es.pm for v2.0.0.
<div class="Pp"></div>
Manfred Herrmann provided the German translation, de.pm for v2.0.0. Manfred
  continues to support de.pm updates for each new version, together with some
  help from Ralph Passgang.
<div class="Pp"></div>
Lorenzo Cappelletti provided the Italian translation, it.pm for v2.1.0. Giuseppe
  Iuculano and Vittorio Macchi updated it for 3.0.0.
<div class="Pp"></div>
Lieven Bridts provided the Dutch translation, nl.pm, for v2.1.0, with some
  tweaks from Guus Houtzager, and updates for 3.0.0.
<div class="Pp"></div>
Reginaldo Ferreira provided the Portuguese Brazillian translation pt_br.pm for
  v2.2.0.
<div class="Pp"></div>
Rich Duzenbury provided the RSS feed option to the CGI interface.
<div class="Pp"></div>
Jono Woodhouse from CapeSoft Software (www.capesoft.com) provided a new CSS skin
  for 3.0.0 with several layout improvements. Sean Cameron (also from CapeSoft)
  designed new and more compact file icons for 3.0.0.
<div class="Pp"></div>
Youlin Feng provided the Chinese translation for 3.1.0.
<div class="Pp"></div>
Karol 'Semper' Stelmaczonek provided the Polish translation for 3.1.0.
<div class="Pp"></div>
Jeremy Tietsort provided the host summary table sorting feature for 3.1.0.
<div class="Pp"></div>
Paul Mantz contributed the ftp Xfer method for 3.2.0.
<div class="Pp"></div>
Petr Pokorny provided the Czech translation for 3.2.1.
<div class="Pp"></div>
Rikiya Yamamoto provided the Japanese translation for 3.3.0.
<div class="Pp"></div>
Yakim provided the Ukrainian translation for 3.3.0.
<div class="Pp"></div>
Sergei Butakov provided the Russian translation for 3.3.0.
<div class="Pp"></div>
Many people have reported bugs, made useful suggestions and helped with testing;
  see the ChangeLog and the mailing lists.
<div class="Pp"></div>
Your name could appear here in the next version!
<h1 class="Sh" title="Sh" id="License"><a class="selflink" href="#License">License</a></h1>
This program is free software; you can redistribute it and/or modify it under
  the terms of the GNU General Public License as published by the Free Software
  Foundation; either version 2 of the License, or (at your option) any later
  version.
<div class="Pp"></div>
This program is distributed in the hope that it will be useful, but WITHOUT ANY
  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
  A PARTICULAR PURPOSE. See the GNU General Public License for more details.
<div class="Pp"></div>
You should have received a copy of the GNU General Public License in the LICENSE
  file along with this program; if not, write to the Free Software Foundation,
  Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.</div>
<table class="foot">
  <tr>
    <td class="foot-date">2016-12-14</td>
    <td class="foot-os">perl v5.24.1</td>
  </tr>
</table>
</body>
</html>
