<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 19:08:52 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>BACKUPPC(8) BackupPC manual BACKUPPC(8)</p>

<p style="margin-top: 1em">backuppc &acirc; BackupPC
manual</p>

<p style="margin-top: 1em">BackupPC Introduction <br>
This documentation describes BackupPC version 3.3.1,
released on 11 Jan 2015.</p>

<p style="margin-top: 1em">Overview <br>
BackupPC is a high-performance, enterprise-grade system for
backing up Unix, Linux, WinXX, and MacOSX PCs, desktops and
laptops to a server&rsquo;s disk. BackupPC is highly <br>
configurable and easy to install and maintain.</p>

<p style="margin-top: 1em">Given the ever decreasing cost
of disks and raid systems, it is now practical and cost
effective to backup a large number of machines onto a
server&rsquo;s local disk or network <br>
storage. For some sites this might be the complete backup
solution. For other sites additional permanent archives
could be created by periodically backing up the server to
<br>
tape.</p>

<p style="margin-top: 1em">Features include:</p>

<p style="margin-top: 1em">&Acirc;&middot; A clever pooling
scheme minimizes disk storage and disk I/O. Identical files
across multiple backups of the same or different PC are
stored only once (using hard links), <br>
resulting in substantial savings in disk storage and disk
writes.</p>

<p style="margin-top: 1em">&Acirc;&middot; Optional
compression provides additional reductions in storage
(around 40%). The CPU impact of compression is low since
only new files (those not already in the pool) need <br>
to be compressed.</p>

<p style="margin-top: 1em">&Acirc;&middot; A powerful
http/cgi user interface allows administrators to view the
current status, edit configuration, add/delete hosts, view
log files, and allows users to initiate and <br>
cancel backups and browse and restore files from
backups.</p>

<p style="margin-top: 1em">&Acirc;&middot; The http/cgi
user interface has internationalization (i18n) support,
currently providing English, French, German, Spanish,
Italian, Dutch, Polish, Portuguese-Brazilian and <br>
Chinese</p>

<p style="margin-top: 1em">&Acirc;&middot; No client-side
software is needed. On WinXX the standard smb protocol is
used to extract backup data. On linux, unix or MacOSX
clients, rsync, tar (over ssh/rsh/nfs) or ftp <br>
is used to extract backup data. Alternatively, rsync can
also be used on WinXX (using cygwin), and Samba could be
installed on the linux or unix client to provide smb <br>
shares).</p>

<p style="margin-top: 1em">&Acirc;&middot; Flexible restore
options. Single files can be downloaded from any backup
directly from the CGI interface. Zip or Tar archives for
selected files or directories from any <br>
backup can also be downloaded from the CGI interface.
Finally, direct restore to the client machine (using smb or
tar) for selected files or directories is also supported
<br>
from the CGI interface.</p>

<p style="margin-top: 1em">&Acirc;&middot; BackupPC
supports mobile environments where laptops are only
intermittently connected to the network and have dynamic IP
addresses (DHCP). Configuration settings allow <br>
machines connected via slower WAN connections (eg: dial up,
DSL, cable) to not be backed up, even if they use the same
fixed or dynamic IP address as when they are connected <br>
directly to the LAN.</p>

<p style="margin-top: 1em">&Acirc;&middot; Flexible
configuration parameters allow multiple backups to be
performed in parallel, specification of which shares to
backup, which directories to backup or not backup, <br>
various schedules for full and incremental backups,
schedules for email reminders to users and so on.
Configuration parameters can be set system-wide or also on a
per-PC <br>
basis.</p>

<p style="margin-top: 1em">&Acirc;&middot; Users are sent
periodic email reminders if their PC has not recently been
backed up. Email content, timing and policies are
configurable.</p>

<p style="margin-top: 1em">&Acirc;&middot; BackupPC is Open
Source software hosted by SourceForge.</p>

<p style="margin-top: 1em">Backup basics <br>
Full Backup <br>
A full backup is a complete backup of a share. BackupPC can
be configured to do a full backup at a regular interval
(typically weekly). BackupPC can be configured to keep a
<br>
certain number of full backups. Exponential expiry is also
supported, allowing full backups with various vintages to be
kept (for example, a settable number of most recent <br>
weekly fulls, plus a settable number of older fulls that are
2, 4, 8, or 16 weeks apart).</p>

<p style="margin-top: 1em">Incremental Backup <br>
An incremental backup is a backup of files that have changed
since the last successful full or incremental backup.
Starting in BackupPC 3.0 multi-level incrementals are <br>
supported. A full backup has level 0. A new incremental of
level N will backup all files that have changed since the
most recent backup of a lower level. $Conf{IncrLevels} <br>
is used to specify the level of each successive incremental.
The default value is all level 1, which makes the behavior
the same as earlier versions of BackupPC: each <br>
incremental will back up all the files that changed since
the last full (level 0).</p>

<p style="margin-top: 1em">For SMB and tar, BackupPC uses
the modification time (mtime) to determine which files have
changed since the last lower-level backup. That means SMB
and tar incrementals are <br>
not able to detect deleted files, renamed files or new files
whose modification time is prior to the last lower-level
backup.</p>

<p style="margin-top: 1em">Rsync is more clever: any files
whose attributes have changed (ie: uid, gid, mtime, modes,
size) since the last full are backed up. Deleted, new files
and renamed files are <br>
detected by Rsync incrementals.</p>

<p style="margin-top: 1em">BackupPC can also be configured
to keep a certain number of incremental backups, and to keep
a smaller number of very old incremental backups. If
multi-level incrementals <br>
are specified then it is likely that more incrementals will
need to be kept since lower-level incrementals (and the full
backup) are needed to reconstruct a higher-level <br>
incremental.</p>

<p style="margin-top: 1em">BackupPC &quot;fills-in&quot;
incremental backups when browsing or restoring, based on the
levels of each backup, giving every backup a
&quot;full&quot; appearance. This makes browsing and <br>
restoring backups much easier: you can restore from any one
backup independent of whether it was an incremental or
full.</p>

<p style="margin-top: 1em">Partial Backup <br>
When a full backup fails or is canceled, and some files have
already been backed up, BackupPC keeps a partial backup
containing just the files that were backed up <br>
successfully. The partial backup is removed when the next
successful backup completes, or if another full backup fails
resulting in a newer partial backup. A failed full <br>
backup that has not backed up any files, or any failed
incremental backup, is removed; no partial backup is saved
in these cases.</p>

<p style="margin-top: 1em">The partial backup may be
browsed or used to restore files just like a successful full
or incremental backup.</p>

<p style="margin-top: 1em">With the rsync transfer method
the partial backup is used to resume the next full backup,
avoiding the need to retransfer the file data already in the
partial backup.</p>

<p style="margin-top: 1em">Identical Files <br>
BackupPC pools identical files using hardlinks. By
&quot;identical files&quot; we mean files with identical
contents, not necessary the same permissions, ownership or
modification <br>
time. Two files might have different permissions, ownership,
or modification time but will still be pooled whenever the
contents are identical. This is possible since <br>
BackupPC stores the file meta-data (permissions, ownership,
and modification time) separately from the file
contents.</p>

<p style="margin-top: 1em">Backup Policy <br>
Based on your site&rsquo;s requirements you need to decide
what your backup policy is. BackupPC is not designed to
provide exact re-imaging of failed disks. See &quot;Some
<br>
Limitations&quot; for more information. However, the
addition of tar transport for linux/unix clients, plus full
support for special file types and unix attributes in v1.4.0
<br>
likely means an exact image of a linux/unix file system can
be made.</p>

<p style="margin-top: 1em">BackupPC saves backups onto
disk. Because of pooling you can relatively economically
keep several weeks of old backups.</p>

<p style="margin-top: 1em">At some sites the disk-based
backup will be adequate, without a secondary tape backup.
This system is robust to any single failure: if a client
disk fails or loses files, the <br>
BackupPC server can be used to restore files. If the server
disk fails, BackupPC can be restarted on a fresh file
system, and create new backups from the clients. The chance
<br>
of the server disk failing can be made very small by
spending more money on increasingly better RAID systems.
However, there is still the risk of catastrophic events like
<br>
fires or earthquakes that can destroy both the BackupPC
server and the clients it is backing up if they are
physically nearby.</p>

<p style="margin-top: 1em">Some sites might choose to do
periodic backups to tape or cd/dvd. This backup can be done
perhaps weekly using the archive function of BackupPC.</p>

<p style="margin-top: 1em">Other users have reported
success with removable disks to rotate the BackupPC data
drives, or using rsync to mirror the BackupPC data pool
offsite.</p>

<p style="margin-top: 1em">Resources <br>
BackupPC home page <br>
The BackupPC Open Source project is hosted on SourceForge.
The home page can be found at:</p>


<p style="margin-top: 1em">http://backuppc.sourceforge.net</p>

<p style="margin-top: 1em">This page has links to the
current documentation, the SourceForge project page and
general information.</p>

<p style="margin-top: 1em">SourceForge project <br>
The SourceForge project page is at:</p>


<p style="margin-top: 1em">http://sourceforge.net/projects/backuppc</p>

<p style="margin-top: 1em">This page has links to the
current releases of BackupPC.</p>

<p style="margin-top: 1em">BackupPC Wiki <br>
BackupPC has a Wiki at
&lt;http://backuppc.wiki.sourceforge.net&gt;. Everyone is
encouraged to contribute to the Wiki. Anyone with a
SourceForge account can edit the Wiki.</p>

<p style="margin-top: 1em">The old FAQ is at
&lt;http://backuppc.sourceforge.net/faq&gt;, but is
deprecated in favor of the Wiki.</p>

<p style="margin-top: 1em">Mailing lists <br>
Three BackupPC mailing lists exist for announcements
(backuppc-announce), developers (backuppc-devel), and a
general user list for support, asking questions or any other
<br>
topic relevant to BackupPC (backuppc-users).</p>

<p style="margin-top: 1em">The lists are archived on
SourceForge and Gmane. The SourceForge lists are not always
up to date and the searching is limited, so Gmane is a good
alternative. See:</p>


<p style="margin-top: 1em">http://news.gmane.org/index.php?prefix=gmane.comp.sysutils.backup.backuppc
<br>

http://sourceforge.net/mailarchive/forum.php?forum=backuppc-users</p>

<p style="margin-top: 1em">You can subscribe to these lists
by visiting:</p>


<p style="margin-top: 1em">http://lists.sourceforge.net/lists/listinfo/backuppc-announce
<br>
http://lists.sourceforge.net/lists/listinfo/backuppc-users
<br>

http://lists.sourceforge.net/lists/listinfo/backuppc-devel</p>

<p style="margin-top: 1em">The backuppc-announce list is
moderated and is used only for important announcements (eg:
new versions). It is low traffic. You only need to subscribe
to one of backuppc- <br>
announce and backuppc-users: backuppc-users also receives
any messages on backuppc-announce.</p>

<p style="margin-top: 1em">The backuppc-devel list is only
for developers who are working on BackupPC. Do not post
questions or support requests there. But detailed technical
discussions should <br>
happen on this list.</p>

<p style="margin-top: 1em">To post a message to the
backuppc-users list, send an email to</p>


<p style="margin-top: 1em">backuppc-users@lists.sourceforge.net</p>

<p style="margin-top: 1em">Do not send subscription
requests to this address!</p>

<p style="margin-top: 1em">Other Programs of Interest <br>
If you want to mirror linux or unix files or directories to
a remote server you should use rsync,
&lt;http://rsync.samba.org&gt;. BackupPC uses rsync as a
transport mechanism; if <br>
you are already an rsync user you can think of BackupPC as
adding efficient storage (compression and pooling) and a
convenient user interface to rsync.</p>

<p style="margin-top: 1em">Two popular open source packages
that do tape backup are Amanda
(&lt;http://www.amanda.org&gt;) and Bacula
(&lt;http://www.bacula.org&gt;). These packages can be used
as complete <br>
solutions, or also as back ends to BackupPC to backup the
BackupPC server data to tape.</p>

<p style="margin-top: 1em">Various programs and scripts use
rsync to provide hardlinked backups. See, for example, Mike
Rubel&rsquo;s site
(&lt;http://www.mikerubel.org/computers/rsync_snapshots&gt;),
JW <br>
Schultz&rsquo;s dirvish (&lt;http://www.dirvish.org/&gt;),
Ben Escoto&rsquo;s rdiff-backup
(&lt;http://www.nongnu.org/rdiff-backup&gt;), and John
Bowman&rsquo;s rlbackup <br>
(&lt;http://www.math.ualberta.ca/imaging/rlbackup&gt;).</p>

<p style="margin-top: 1em">Unison is a utility that can do
two-way, interactive, synchronization. See
&lt;http://freshmeat.net/projects/unison&gt;. An external
wrapper around rsync that maintains transfer <br>
data to enable two-way synchronization is drsync; see
&lt;http://freshmeat.net/projects/drsync&gt;.</p>

<p style="margin-top: 1em">BackupPC provides many
additional features, such as compressed storage, hardlinking
any matching files (rather than just files with the same
name), and storing special files <br>
without root privileges. But these other programs provide
simple, effective and fast solutions and are definitely
worthy of consideration.</p>

<p style="margin-top: 1em">Road map <br>
The new features planned for future releases of BackupPC are
on the Wiki at
&lt;http://backuppc.wiki.sourceforge.net&gt;.</p>

<p style="margin-top: 1em">Comments and suggestions are
welcome.</p>

<p style="margin-top: 1em">You can help <br>
BackupPC is free. I work on BackupPC because I enjoy doing
it and I like to contribute to the open source
community.</p>

<p style="margin-top: 1em">BackupPC already has more than
enough features for my own needs. The main compensation for
continuing to work on BackupPC is knowing that more and more
people find it useful. <br>
So feedback is certainly appreciated, both positive and
negative.</p>

<p style="margin-top: 1em">Beyond being a satisfied user
and telling other people about it, everyone is encouraged to
add links to &lt;http://backuppc.sourceforge.net&gt;
(I&rsquo;ll see them via Google) or otherwise <br>
publicize BackupPC. Unlike the commercial products in this
space, I have a zero budget (in both time and money) for
marketing, PR and advertising, so it&rsquo;s up to all of
you! <br>
Feel free to vote for BackupPC at
&lt;http://freshmeat.net/projects/backuppc&gt;.</p>

<p style="margin-top: 1em">Also, everyone is encouraged to
contribute patches, bug reports, feature and design
suggestions, new code, Wiki additions (you can do those
directly) and documentation <br>
corrections or improvements. Answering questions on the
mailing list is a big help too.</p>

<p style="margin-top: 1em">Installing BackupPC <br>
Requirements <br>
BackupPC requires:</p>

<p style="margin-top: 1em">&Acirc;&middot; A linux,
solaris, or unix based server with a substantial amount of
free disk space (see the next section for what that means).
The CPU and disk performance on this server <br>
will determine how many simultaneous backups you can run.
You should be able to run 4-8 simultaneous backups on a
moderately configured server.</p>

<p style="margin-top: 1em">Several users have reported
significantly better performance using reiserfs compared to
ext3 for the BackupPC data file system. It is also
recommended you consider either an <br>
LVM or RAID setup (either in HW or SW; eg: 3Ware RAID10 or
RAID5) so that you can expand the file system as
necessary.</p>

<p style="margin-top: 1em">When BackupPC starts with an
empty pool, all the backup data will be written to the pool
on disk. After more backups are done, a higher percentage of
incoming files will <br>
already be in the pool. BackupPC is able to avoid writing to
disk new files that are already in the pool. So over time
disk writes will reduce significantly (by perhaps a <br>
factor of 20 or more), since eventually 95% or more of
incoming backup files are typically in the pool. Disk reads
from the pool are still needed to do file compares to <br>
verify files are an exact match. So, with a mature pool, if
a relatively fast client generates data at say 1MB/sec, and
you run 4 simultaneous backups, there will be an <br>
average server disk load of about 4MB/sec reads and
0.2MB/sec writes (assuming 95% of the incoming files are in
the pool). These rates will be perhaps 40% lower if <br>
compression is on.</p>

<p style="margin-top: 1em">&Acirc;&middot; Perl version
5.8.0 or later. If you don&rsquo;t have perl, please see
&lt;http://www.cpan.org&gt;.</p>

<p style="margin-top: 1em">&Acirc;&middot; Perl modules
Compress::Zlib, Archive::Zip and File::RsyncP. Try
&quot;perldoc Compress::Zlib&quot; and &quot;perldoc
Archive::Zip&quot; to see if you have these modules. If not,
fetch them <br>
from &lt;http://www.cpan.org&gt; and see the instructions
below for how to build and install them.</p>

<p style="margin-top: 1em">The File::RsyncP module is
available from &lt;http://perlrsync.sourceforge.net&gt; or
CPAN. You&rsquo;ll need to install the File::RsyncP module
if you want to use Rsync as a transport <br>
method.</p>

<p style="margin-top: 1em">&Acirc;&middot; If you are using
smb to backup WinXX machines you need smbclient and
nmblookup from the samba package. You will also need
nmblookup if you are backing up linux/unix DHCP <br>
machines. See &lt;http://www.samba.org&gt;. Samba versions
3.x are stable and now recommended instead of 2.x.</p>

<p style="margin-top: 1em">See &lt;http://www.samba.org&gt;
for source and binaries. It&rsquo;s pretty easy to fetch and
compile samba, and just grab smbclient and nmblookup,
without doing the installation. <br>
Alternatively, &lt;http://www.samba.org&gt; has binary
distributions for most platforms.</p>

<p style="margin-top: 1em">&Acirc;&middot; If you are using
tar to backup linux/unix machines, those machines should
have version 1.13.7 at a minimum, with version 1.13.20 or
higher recommended. Use &quot;tar --version&quot; <br>
to check your version. Various GNU mirrors have the newest
versions of tar; see
&lt;http://www.gnu.org/software/tar/&gt;.</p>

<p style="margin-top: 1em">&Acirc;&middot; If you are using
rsync to backup linux/unix machines you should have version
2.6.3 or higher on each client machine. See
&lt;http://rsync.samba.org&gt;. Use &quot;rsync
--version&quot; to <br>
check your version.</p>

<p style="margin-top: 1em">For BackupPC to use Rsync you
will also need to install the perl File::RsyncP module,
which is available from
&lt;http://perlrsync.sourceforge.net&gt;. Version 0.68 or
later is <br>
required.</p>

<p style="margin-top: 1em">&Acirc;&middot; The Apache web
server, see &lt;http://www.apache.org&gt;, preferably built
with mod_perl support.</p>

<p style="margin-top: 1em">What type of storage space do I
need? <br>
BackupPC uses hardlinks to pool files common to different
backups. Therefore BackupPC&rsquo;s data store (__TOPDIR__)
must point to a single file system that supports hardlinks.
You <br>
cannot split this file system with multiple mount points or
using symbolic links to point a sub-directory to a different
file system (it is ok to use a single symbolic link at <br>
the top-level directory (__TOPDIR__) to point the entire
data store somewhere else). You can of course use any kind
of RAID system or logical volume manager that combines the
<br>
capacity of multiple disks into a single, larger, file
system. Such approaches have the advantage that the file
system can be expanded without having to copy it.</p>

<p style="margin-top: 1em">Any standard linux or unix file
system supports hardlinks. NFS mounted file systems work too
(provided the underlying file system supports hardlinks).
But windows based FAT and <br>
NTFS file systems will not work.</p>

<p style="margin-top: 1em">Starting with BackupPC 3.1.0,
run-time checks are done at startup and at the start of each
backup to ensure that the file system can support hardlinks,
since this is a common <br>
area of configuration problems.</p>

<p style="margin-top: 1em">How much disk space do I need?
<br>
Here&rsquo;s one real example for an environment that is
backing up 65 laptops with compression off. Each full backup
averages 3.2GB. Each incremental backup averages about
0.2GB. <br>
Storing one full backup and two incremental backups per
laptop is around 240GB of raw data. But because of the
pooling of identical files, only 87GB is used. This is
without <br>
compression.</p>

<p style="margin-top: 1em">Another example, with
compression on: backing up 95 laptops, where each backup
averages 3.6GB and each incremental averages about 0.3GB.
Keeping three weekly full backups, and <br>
six incrementals is around 1200GB of raw data. Because of
pooling and compression, only 150GB is needed.</p>

<p style="margin-top: 1em">Here&rsquo;s a rule of thumb.
Add up the disk usage of all the machines you want to backup
(210GB in the first example above). This is a rough minimum
space estimate that should allow <br>
a couple of full backups and at least half a dozen
incremental backups per machine. If compression is on you
can reduce the storage requirements by maybe 30-40%. Add
some margin <br>
in case you add more machines or decide to keep more old
backups.</p>

<p style="margin-top: 1em">Your actual mileage will depend
upon the types of clients, operating systems and
applications you have. The more uniform the clients and
applications the bigger the benefit from <br>
pooling common files.</p>

<p style="margin-top: 1em">For example, the Eudora email
tool stores each mail folder in a separate file, and
attachments are extracted as separate files. So in the sadly
common case of a large attachment <br>
emailed to many recipients, Eudora will extract the
attachment into a new file. When these machines are backed
up, only one copy of the file will be stored on the server,
even <br>
though the file appears in many different full or
incremental backups. In this sense Eudora is a
&quot;friendly&quot; application from the point of view of
backup storage requirements.</p>

<p style="margin-top: 1em">An example at the other end of
the spectrum is Outlook. Everything (email bodies,
attachments, calendar, contact lists) is stored in a single
file, which often becomes huge. Any <br>
change to this file requires a separate copy of the file to
be saved during backup. Outlook is even more troublesome,
since it keeps this file locked all the time, so it cannot
<br>
be read by smbclient whenever Outlook is running. See the
&quot;Some Limitations&quot; section for more discussion of
this problem.</p>

<p style="margin-top: 1em">In addition to total disk space,
you should make sure you have plenty of inodes on your
BackupPC data partition. Some users have reported running
out of inodes on their BackupPC <br>
data partition. So even if you have plenty of disk space,
BackupPC will report failures when the inodes are exhausted.
This is a particular problem with ext2/ext3 file systems
<br>
that have a fixed number of inodes when the file system is
built. Use &quot;df -i&quot; to see your inode usage.</p>

<p style="margin-top: 1em">Step 1: Getting BackupPC <br>
Some linux distributions now include BackupPC. The Debian
distribution, supported by Ludovic Drolez, can be found at
&lt;http://packages.debian.org/backuppc&gt; and is included
in the <br>
current stable Debian release. On Debian, BackupPC can be
installed with the command:</p>

<p style="margin-top: 1em">apt-get install backuppc</p>

<p style="margin-top: 1em">In the future there might be
packages for Gentoo and other linux flavors. If the packaged
version is older than the released version then you may want
to install the latest <br>
version as described below.</p>

<p style="margin-top: 1em">Otherwise, manually fetching and
installing BackupPC is easy. Start by downloading the latest
version from &lt;http://backuppc.sourceforge.net&gt;. Hit
the &quot;Code&quot; button, then select <br>
the &quot;backuppc&quot; or &quot;backuppc-beta&quot;
package and download the latest version.</p>

<p style="margin-top: 1em">Step 2: Installing the
distribution <br>
Note: most information in this step is only relevant if you
build and install BackupPC yourself. If you use a package
provided by a distribution, the package management system
<br>
should take of installing any needed dependencies.</p>

<p style="margin-top: 1em">First off, there are five perl
modules you should install. These are all optional, but
highly recommended:</p>

<p style="margin-top: 1em">Compress::Zlib <br>
To enable compression, you will need to install
Compress::Zlib from &lt;http://www.cpan.org&gt;. You can run
&quot;perldoc Compress::Zlib&quot; to see if this module is
installed.</p>

<p style="margin-top: 1em">Archive::Zip <br>
To support restore via Zip archives you will need to install
Archive::Zip, also from &lt;http://www.cpan.org&gt;. You can
run &quot;perldoc Archive::Zip&quot; to see if this module
is <br>
installed.</p>

<p style="margin-top: 1em">XML::RSS <br>
To support the RSS feature you will need to install
XML::RSS, also from &lt;http://www.cpan.org&gt;. There is
not need to install this module if you don&rsquo;t plan on
using RSS. You <br>
can run &quot;perldoc XML::RSS&quot; to see if this module
is installed.</p>

<p style="margin-top: 1em">File::RsyncP <br>
To use rsync and rsyncd with BackupPC you will need to
install File::RsyncP. You can run &quot;perldoc
File::RsyncP&quot; to see if this module is installed.
File::RsyncP is <br>
available from &lt;http://perlrsync.sourceforge.net&gt;.
Version 0.68 or later is required.</p>

<p style="margin-top: 1em">File::Listing, Net::FTP,
Net::FTP::RetrHandle, Net::FTP::AutoReconnect <br>
To use ftp with BackupPC you will need four libraries, but
actually need to install only File::Listing from
&lt;http://www.cpan.org&gt;. You can run &quot;perldoc
File::Listing&quot; to see <br>
if this module is installed. Net::FTP is a standard module.
Net::FTP::RetrHandle and Net::FTP::AutoReconnect included in
BackupPC distribution.</p>

<p style="margin-top: 1em">To build and install these
packages you should use the cpan program. Alternatively, you
can fetch the tar.gz file from &lt;http://www.cpan.org&gt;
and then run these commands:</p>

<p style="margin-top: 1em">tar zxvf Archive-Zip-1.26.tar.gz
<br>
cd Archive-Zip-1.26 <br>
perl Makefile.PL <br>
make <br>
make test <br>
make install</p>

<p style="margin-top: 1em">The same sequence of commands
can be used for each module.</p>

<p style="margin-top: 1em">Now let&rsquo;s move onto
BackupPC itself. After fetching BackupPC-3.3.1.tar.gz, run
these commands as root:</p>

<p style="margin-top: 1em">tar zxf BackupPC-3.3.1.tar.gz
<br>
cd BackupPC-3.3.1 <br>
perl configure.pl</p>

<p style="margin-top: 1em">In the future this release might
also have patches available on the SourceForge site. These
patch files are text files, with a name of the form</p>

<p style="margin-top: 1em">BackupPC-3.3.1plN.diff</p>

<p style="margin-top: 1em">where N is the patch level, eg:
pl2 is patch-level 2. These patch files are cumulative: you
only need apply the last patch file, not all the earlier
patch files. If a patch <br>
file is available, eg: BackupPC-3.3.1pl2.diff, you should
apply the patch after extracting the tar file:</p>

<p style="margin-top: 1em"># fetch BackupPC-3.3.1.tar.gz
<br>
# fetch BackupPC-3.3.1pl2.diff <br>
tar zxf BackupPC-3.3.1.tar.gz <br>
cd BackupPC-3.3.1 <br>
patch -p0 &lt; ../BackupPC-3.3.1pl2.diff <br>
perl configure.pl</p>

<p style="margin-top: 1em">A patch file includes comments
that describe that bug fixes and changes. Feel free to
review it before you apply the patch.</p>

<p style="margin-top: 1em">The configure.pl script also
accepts command-line options if you wish to run it in a
non-interactive manner. It has self-contained documentation
for all the command-line <br>
options, which you can read with perldoc:</p>

<p style="margin-top: 1em">perldoc configure.pl</p>

<p style="margin-top: 1em">Starting with BackupPC 3.0.0,
the configure.pl script by default complies with the file
system hierarchy (FHS) conventions. The major difference
compared to earlier versions is <br>
that by default configuration files will be stored in
/etc/BackupPC rather than below the data directory,
__TOPDIR__/conf, and the log files will be stored in
/var/log/BackupPC <br>
rather than below the data directory, __TOPDIR__/log.</p>

<p style="margin-top: 1em">Note that distributions may
choose to use different locations for BackupPC files than
these defaults.</p>

<p style="margin-top: 1em">If you are upgrading from an
earlier version the configure.pl script will keep the
configuration files and log files in their original
location.</p>

<p style="margin-top: 1em">When you run configure.pl you
will be prompted for the full paths of various executables,
and you will be prompted for the following information.</p>

<p style="margin-top: 1em">BackupPC User <br>
It is best if BackupPC runs as a special user, eg backuppc,
that has limited privileges. It is preferred that backuppc
belongs to a system administrator group so that sys <br>
admin members can browse BackupPC files, edit the
configuration files and so on. Although configurable, the
default settings leave group read permission on pool files,
so <br>
make sure the BackupPC user&rsquo;s group is chosen
restrictively.</p>

<p style="margin-top: 1em">On this installation, this is
__BACKUPPCUSER__.</p>

<p style="margin-top: 1em">For security purposes you might
choose to configure the BackupPC user with the shell set to
/bin/false. Since you might need to run some BackupPC
programs as the BackupPC <br>
user for testing purposes, you can use the -s option to su
to explicitly run a shell, eg:</p>

<p style="margin-top: 1em">su -s /bin/bash
__BACKUPPCUSER__</p>

<p style="margin-top: 1em">Depending upon your
configuration you might also need the -l option.</p>

<p style="margin-top: 1em">Data Directory <br>
You need to decide where to put the data directory, below
which all the BackupPC data is stored. This needs to be a
big file system.</p>

<p style="margin-top: 1em">On this installation, this is
__TOPDIR__.</p>

<p style="margin-top: 1em">Install Directory <br>
You should decide where the BackupPC scripts, libraries and
documentation should be installed, eg:
/usr/local/BackupPC.</p>

<p style="margin-top: 1em">On this installation, this is
__INSTALLDIR__.</p>

<p style="margin-top: 1em">CGI bin Directory <br>
You should decide where the BackupPC CGI script resides.
This will usually be below Apache&rsquo;s cgi-bin
directory.</p>

<p style="margin-top: 1em">It is also possible to use a
different directory and use Apache&rsquo;s
&lsquo;&lsquo;&lt;Directory&gt;&rsquo;&rsquo; directive to
specifiy that location. See the Apache HTTP Server
documentation for <br>
additional information.</p>

<p style="margin-top: 1em">On this installation, this is
__CGIDIR__.</p>

<p style="margin-top: 1em">Apache image Directory <br>
A directory where BackupPC&rsquo;s images are stored so that
Apache can serve them. You should ensure this directory is
readable by Apache and create a symlink to this directory
<br>
from the BackupPC CGI bin Directory.</p>

<p style="margin-top: 1em">Config and Log Directories <br>
In this installation the configuration and log directories
are located in the following locations:</p>

<p style="margin-top: 1em">__CONFDIR__/config.pl main
config file <br>
__CONFDIR__/hosts hosts file <br>
__CONFDIR__/pc/HOST.pl per-pc config file <br>
__LOGDIR__/BackupPC log files, pid, status</p>

<p style="margin-top: 1em">The configure.pl script
doesn&rsquo;t prompt for these locations but they can be set
for new installations using command-line options.</p>

<p style="margin-top: 1em">Step 3: Setting up config.pl
<br>
After running configure.pl, browse through the config file,
__CONFDIR__/config.pl, and make sure all the default
settings are correct. In particular, you will need to decide
<br>
whether to use smb, tar,or rsync or ftp transport (or
whether to set it on a per-PC basis) and set the relevant
parameters for that transport method. See the section
&quot;Step 5: <br>
Client Setup&quot; for more details.</p>

<p style="margin-top: 1em">Step 4: Setting up the hosts
file <br>
The file __CONFDIR__/hosts contains the list of clients to
backup. BackupPC reads this file in three cases:</p>

<p style="margin-top: 1em">&Acirc;&middot; Upon
startup.</p>

<p style="margin-top: 1em">&Acirc;&middot; When BackupPC is
sent a HUP (-1) signal. Assuming you installed the init.d
script, you can also do this with &quot;/etc/init.d/backuppc
reload&quot;.</p>

<p style="margin-top: 1em">&Acirc;&middot; When the
modification time of the hosts file changes. BackupPC checks
the modification time once during each regular wakeup.</p>

<p style="margin-top: 1em">Whenever you change the hosts
file (to add or remove a host) you can either do a kill -HUP
BackupPC_pid or simply wait until the next regular wakeup
period.</p>

<p style="margin-top: 1em">Each line in the hosts file
contains three fields, separated by white space:</p>

<p style="margin-top: 1em">Host name <br>
This is typically the host name or NetBios name of the
client machine and should be in lower case. The host name
can contain spaces (escape with a backslash), but it is not
<br>
recommended.</p>

<p style="margin-top: 1em">Please read the section
&quot;How BackupPC Finds Hosts&quot;.</p>

<p style="margin-top: 1em">In certain cases you might want
several distinct clients to refer to the same physical
machine. For example, you might have a database you want to
backup, and you want to <br>
bracket the backup of the database with shutdown/restart
using $Conf{DumpPreUserCmd} and $Conf{DumpPostUserCmd}. But
you also want to backup the rest of the machine while <br>
the database is still running. In the case you can specify
two different clients in the host file, using any mnemonic
name (eg: myhost_mysql and myhost), and use <br>
$Conf{ClientNameAlias} in myhost_mysql&rsquo;s config.pl to
specify the real host name of the machine.</p>

<p style="margin-top: 1em">DHCP flag <br>
Starting with v2.0.0 the way hosts are discovered has
changed and now in most cases you should specify 0 for the
DHCP flag, even if the host has a dynamically assigned IP
<br>
address. Please read the section &quot;How BackupPC Finds
Hosts&quot; to understand whether you need to set the DHCP
flag.</p>

<p style="margin-top: 1em">You only need to set DHCP to 1
if your client machine doesn&rsquo;t respond to the NetBios
multicast request:</p>

<p style="margin-top: 1em">nmblookup myHost</p>

<p style="margin-top: 1em">but does respond to a request
directed to its IP address:</p>

<p style="margin-top: 1em">nmblookup -A W.X.Y.Z</p>

<p style="margin-top: 1em">If you do set DHCP to 1 on any
client you will need to specify the range of DHCP addresses
to search is specified in $Conf{DHCPAddressRanges}.</p>

<p style="margin-top: 1em">Note also that the
$Conf{ClientNameAlias} feature does not work for clients
with DHCP set to 1.</p>

<p style="margin-top: 1em">User name <br>
This should be the unix login/email name of the user who
&quot;owns&quot; or uses this machine. This is the user who
will be sent email about this machine, and this user will
have <br>
permission to stop/start/browse/restore backups for this
host. Leave this blank if no specific person should receive
email or be allowed to stop/start/browse/restore backups
<br>
for this host. Administrators will still have full
permissions.</p>

<p style="margin-top: 1em">More users <br>
Additional user names, separate by commas and with no white
space, can be specified. These users will also have full
permission in the CGI interface to <br>
stop/start/browse/restore backups for this host. These users
will not be sent email about this host.</p>

<p style="margin-top: 1em">The first non-comment line of
the hosts file is special: it contains the names of the
columns and should not be edited.</p>

<p style="margin-top: 1em">Here&rsquo;s a simple example of
a hosts file:</p>

<p style="margin-top: 1em">host dhcp user moreUsers <br>
farside 0 craig jim,dave <br>
larson 1 gary andy</p>

<p style="margin-top: 1em">Step 5: Client Setup <br>
Four methods for getting backup data from a client are
supported: smb, tar, rsync and ftp. Smb or rsync are the
preferred methods for WinXX clients and rsync or tar are the
<br>
preferred methods for linux/unix/MacOSX clients.</p>

<p style="margin-top: 1em">The transfer method is set using
the $Conf{XferMethod} configuration setting. If you have a
mixed environment (ie: you will use smb for some clients and
tar for others), you will <br>
need to pick the most common choice for $Conf{XferMethod}
for the main config.pl file, and then override it in the
per-PC config file for those hosts that will use the other
<br>
method. (Or you could run two completely separate instances
of BackupPC, with different data directories, one for WinXX
and the other for linux/unix, but then common files <br>
between the different machine types will duplicated.)</p>

<p style="margin-top: 1em">Here are some brief client setup
notes:</p>

<p style="margin-top: 1em">WinXX <br>
One setup for WinXX clients is to set $Conf{XferMethod} to
&quot;smb&quot;. Actually, rsyncd is the better method for
WinXX if you are prepared to run rsync/cygwin on your WinXX
<br>
client.</p>

<p style="margin-top: 1em">If you want to use rsyncd for
WinXX clients you can find a pre-packaged zip file on
&lt;http://backuppc.sourceforge.net&gt;. The package is
called cygwin-rsync. It contains <br>
rsync.exe, template setup files and the minimal set of
cygwin libraries for everything to run. The README file
contains instructions for running rsync as a service, so it
<br>
starts automatically everytime you boot your machine. If you
use rsync to backup WinXX machines, be sure to set
$Conf{ClientCharset} correctly (eg: &rsquo;cp1252&rsquo;) so
that the <br>
WinXX file name encoding is correctly converted to utf8.</p>

<p style="margin-top: 1em">Otherwise, to use SMB, you can
either create shares for the data you want to backup or your
can use the existing C$ share. To create a new share, open
&quot;My Computer&quot;, right <br>
click on the drive (eg: C), and select
&quot;Sharing...&quot; (or select &quot;Properties&quot; and
select the &quot;Sharing&quot; tab). In this dialog box you
can enable sharing, select the share name <br>
and permissions.</p>

<p style="margin-top: 1em">All Windows NT based OS (NT,
2000, XP Pro), are configured by default to share the entire
C drive as C$. This is a special share used for various
administration functions, <br>
one of which is to grant access to backup operators. All you
need to do is create a new domain user, specifically for
backup. Then add the new backup user to the built in <br>
&quot;Backup Operators&quot; group. You now have backup
capability for any directory on any computer in the domain
in one easy step. This avoids using administrator accounts
and only <br>
grants permission to do exactly what you want for the given
user, i.e.: backup. Also, for additional security, you may
wish to deny the ability for this user to logon to <br>
computers in the default domain policy.</p>

<p style="margin-top: 1em">If this machine uses DHCP you
will also need to make sure the NetBios name is set. Go to
Control Panel|System|Network Identification (on Win2K) or
Control <br>
Panel|System|Computer Name (on WinXP). Also, you should go
to Control Panel|Network Connections|Local Area
Connection|Properties|Internet Protocol <br>
(TCP/IP)|Properties|Advanced|WINS and verify that NetBios is
not disabled.</p>

<p style="margin-top: 1em">The relevant configuration
settings are $Conf{SmbShareName}, $Conf{SmbShareUserName},
$Conf{SmbSharePasswd}, $Conf{SmbClientPath},
$Conf{SmbClientFullCmd}, <br>
$Conf{SmbClientIncrCmd} and $Conf{SmbClientRestoreCmd}.</p>

<p style="margin-top: 1em">BackupPC needs to know the smb
share user name and password for a client machine that uses
smb. The user name is specified in $Conf{SmbShareUserName}.
There are four ways to <br>
tell BackupPC the smb share password:</p>

<p style="margin-top: 1em">&Acirc;&middot; As an
environment variable BPC_SMB_PASSWD set before BackupPC
starts. If you start BackupPC manually the BPC_SMB_PASSWD
variable must be set manually first. For <br>
backward compatibility for v1.5.0 and prior, the environment
variable PASSWD can be used if BPC_SMB_PASSWD is not set.
Warning: on some systems it is possible to see <br>
environment variables of running processes.</p>

<p style="margin-top: 1em">&Acirc;&middot; Alternatively
the BPC_SMB_PASSWD setting can be included in
/etc/init.d/backuppc, in which case you must make sure this
file is not world (other) readable.</p>

<p style="margin-top: 1em">&Acirc;&middot; As a
configuration variable $Conf{SmbSharePasswd} in
__CONFDIR__/config.pl. If you put the password here you must
make sure this file is not world (other) readable.</p>

<p style="margin-top: 1em">&Acirc;&middot; As a
configuration variable $Conf{SmbSharePasswd} in the per-PC
configuration file (__CONFDIR__/pc/$host.pl or
__TOPDIR__/pc/$host/config.pl in non-FHS versions of <br>
BackupPC). You will have to use this option if the smb share
password is different for each host. If you put the password
here you must make sure this file is not world <br>
(other) readable.</p>

<p style="margin-top: 1em">Placement and protection of the
smb share password is a possible security risk, so please
double-check the file and directory permissions. In a future
version there might be <br>
support for encryption of this password, but a private key
will still have to be stored in a protected place.
Suggestions are welcome.</p>

<p style="margin-top: 1em">As an alternative to setting
$Conf{XferMethod} to &quot;smb&quot; (using smbclient) for
WinXX clients, you can use an smb network filesystem (eg:
ksmbfs or similar) on your linux/unix <br>
server to mount the share, and then set $Conf{XferMethod} to
&quot;tar&quot; (use tar on the network mounted file
system).</p>

<p style="margin-top: 1em">Also, to make sure that file
names with special characters are correctly transferred by
smbclient you should make sure that the smb.conf file has
(for samba 3.x):</p>

<p style="margin-top: 1em">[global] <br>
unix charset = UTF8</p>

<p style="margin-top: 1em">UTF8 is the default setting, so
if the parameter is missing then it is ok. With this setting
$Conf{ClientCharset} should be emtpy, since smbclient has
already converted the <br>
file names to utf8.</p>

<p style="margin-top: 1em">Linux/Unix <br>
The preferred setup for linux/unix clients is to set
$Conf{XferMethod} to &quot;rsync&quot;, &quot;rsyncd&quot;
or &quot;tar&quot;.</p>

<p style="margin-top: 1em">You can use either rsync, smb,
or tar for linux/unix machines. Smb requires that the Samba
server (smbd) be run to provide the shares. Since the smb
protocol can&rsquo;t represent <br>
special files like symbolic links and fifos, tar and rsync
are the better transport methods for linux/unix machines.
(In fact, by default samba makes symbolic links look <br>
like the file or directory that they point to, so you could
get an infinite loop if a symbolic link points to the
current or parent directory. If you really need to use Samba
<br>
shares for linux/unix backups you should turn off the
&quot;follow symlinks&quot; samba config setting. See the
smb.conf manual page.)</p>

<p style="margin-top: 1em">The requirements for each Xfer
Method are:</p>

<p style="margin-top: 1em">tar You must have GNU tar on the
client machine. Use &quot;tar --version&quot; or &quot;gtar
--version&quot; to verify. The version should be at least
1.13.7, and 1.13.20 or greater is <br>
recommended. Tar is run on the client machine via rsh or
ssh.</p>

<p style="margin-top: 1em">The relevant configuration
settings are $Conf{TarClientPath}, $Conf{TarShareName},
$Conf{TarClientCmd}, $Conf{TarFullArgs}, $Conf{TarIncrArgs},
and <br>
$Conf{TarClientRestoreCmd}.</p>

<p style="margin-top: 1em">rsync <br>
You should have at least rsync 2.6.3, and the latest version
is recommended. Rsync is run on the remote client via rsh or
ssh.</p>

<p style="margin-top: 1em">The relevant configuration
settings are $Conf{RsyncClientPath}, $Conf{RsyncClientCmd},
$Conf{RsyncClientRestoreCmd}, $Conf{RsyncShareName},
$Conf{RsyncArgs}, and <br>
$Conf{RsyncRestoreArgs}.</p>

<p style="margin-top: 1em">rsyncd <br>
You should have at least rsync 2.6.3, and the latest version
is recommended. In this case the rsync daemon should be
running on the client machine and BackupPC connects <br>
directly to it.</p>

<p style="margin-top: 1em">The relevant configuration
settings are $Conf{RsyncdClientPort}, $Conf{RsyncdUserName},
$Conf{RsyncdPasswd}, $Conf{RsyncdAuthRequired},
$Conf{RsyncShareName}, <br>
$Conf{RsyncArgs}, $Conf{RsyncArgsExtra}, and
$Conf{RsyncRestoreArgs}. $Conf{RsyncShareName} is the name
of an rsync module (ie: the thing in square brackets in
rsyncd&rsquo;s <br>
conf file -- see rsyncd.conf), not a file system path.</p>

<p style="margin-top: 1em">Be aware that rsyncd will remove
the leading &rsquo;/&rsquo; from path names in symbolic
links if you specify &quot;use chroot = no&quot; in the
rsynd.conf file. See the rsyncd.conf manual <br>
page for more information.</p>

<p style="margin-top: 1em">ftp You need to be running an
ftp server on the client machine. The relevant configuration
settings are $Conf{FtpShareName}, $Conf{FtpUserName},
$Conf{FtpPasswd}, <br>
$Conf{FtpBlockSize}, $Conf{FtpPort}, $Conf{FtpTimeout}, and
$Conf{FtpFollowSymlinks}.</p>

<p style="margin-top: 1em">You need to set
$Conf{ClientCharset} to the client&rsquo;s charset so that
file names are correctly converted to utf8. Use &quot;locale
charmap&quot; on the client to see its charset.</p>

<p style="margin-top: 1em">For linux/unix machines you
should not backup &quot;/proc&quot;. This directory contains
a variety of files that look like regular files but they are
special files that don&rsquo;t need to <br>
be backed up (eg: /proc/kcore is a regular file that
contains physical memory). See $Conf{BackupFilesExclude}. It
is safe to back up /dev since it contains mostly <br>
character-special and block-special files, which are
correctly handed by BackupPC (eg: backing up /dev/hda5 just
saves the block-special file information, not the contents
of <br>
the disk).</p>

<p style="margin-top: 1em">Alternatively, rather than
backup all the file systems as a single share
(&quot;/&quot;), it is easier to restore a single file
system if you backup each file system separately. To do <br>
this you should list each file system mount point in
$Conf{TarShareName} or $Conf{RsyncShareName}, and add the
--one-file-system option to $Conf{TarClientCmd} or <br>
$Conf{RsyncArgs}. In this case there is no need to exclude
/proc explicitly since it looks like a different file
system.</p>

<p style="margin-top: 1em">Next you should decide whether
to run tar over ssh, rsh or nfs. Ssh is the preferred
method. Rsh is not secure and therefore not recommended. Nfs
will work, but you need to <br>
make sure that the BackupPC user (running on the server) has
sufficient permissions to read all the files below the nfs
mount.</p>

<p style="margin-top: 1em">Ssh allows BackupPC to run as a
privileged user on the client (eg: root), since it needs
sufficient permissions to read all the backup files. Ssh is
setup so that BackupPC on <br>
the server (an otherwise low privileged user) can ssh as
root on the client, without being prompted for a password.
There are two common versions of ssh: v1 and v2. Here are
<br>
some instructions for one way to setup ssh. (Check which
version of SSH you have by typing &quot;ssh&quot; or
&quot;man ssh&quot;.)</p>

<p style="margin-top: 1em">MacOSX <br>
In general this should be similar to Linux/Unix machines. In
versions 10.4 and later, the native MacOSX tar works, and
also supports resource forks. xtar is another option, <br>
and rsync works too (although the MacOSX-supplied rsync has
an extension for extended attributes that is not compatible
with standard rsync).</p>

<p style="margin-top: 1em">SSH Setup <br>
SSH is a secure way to run tar or rsync on a backup client
to extract the data. SSH provides strong authentication and
encryption of the network data.</p>

<p style="margin-top: 1em">Note that if you run rsyncd
(rsync daemon), ssh is not used. In this case, rsyncd
provides its own authentication, but there is no encryption
of network data. If you want <br>
encryption of network data you can use ssh to create a
tunnel, or use a program like stunnel.</p>

<p style="margin-top: 1em">Setup instructions for ssh can
be found at
&lt;http://backuppc.sourceforge.net/faq/ssh.html&gt; or on
the Wiki.</p>

<p style="margin-top: 1em">Clients that use DHCP <br>
If a client machine uses DHCP BackupPC needs some way to
find the IP address given the host name. One alternative is
to set dhcp to 1 in the hosts file, and BackupPC will <br>
search a pool of IP addresses looking for hosts. More
efficiently, it is better to set dhcp = 0 and provide a
mechanism for BackupPC to find the IP address given the host
<br>
name.</p>

<p style="margin-top: 1em">For WinXX machines BackupPC uses
the NetBios name server to determine the IP address given
the host name. For unix machines you can run nmbd (the
NetBios name server) from <br>
the Samba distribution so that the machine responds to a
NetBios name request. See the manual page and Samba
documentation for more information.</p>

<p style="margin-top: 1em">Alternatively, you can set
$Conf{NmbLookupFindHostCmd} to any command that returns the
IP address given the host name.</p>

<p style="margin-top: 1em">Please read the section
&quot;How BackupPC Finds Hosts&quot; for more details.</p>

<p style="margin-top: 1em">Step 6: Running BackupPC <br>
The installation contains an init.d backuppc script that can
be copied to /etc/init.d so that BackupPC can auto-start on
boot. See init.d/README for further instructions.</p>

<p style="margin-top: 1em">BackupPC should be ready to
start. If you installed the init.d script, then you should
be able to run BackupPC with:</p>

<p style="margin-top: 1em">/etc/init.d/backuppc start</p>

<p style="margin-top: 1em">(This script can also be invoked
with &quot;stop&quot; to stop BackupPC and
&quot;reload&quot; to tell BackupPC to reload config.pl and
the hosts file.)</p>

<p style="margin-top: 1em">Otherwise, just run</p>

<p style="margin-top: 1em">__INSTALLDIR__/bin/BackupPC
-d</p>

<p style="margin-top: 1em">as user __BACKUPPCUSER__. The -d
option tells BackupPC to run as a daemon (ie: it does an
additional fork).</p>

<p style="margin-top: 1em">Any immediate errors will be
printed to stderr and BackupPC will quit. Otherwise, look in
__LOGDIR__/LOG and verify that BackupPC reports it has
started and all is ok.</p>

<p style="margin-top: 1em">Step 7: Talking to BackupPC <br>
You should verify that BackupPC is running by using
BackupPC_serverMesg. This sends a message to BackupPC via
the unix (or TCP) socket and prints the response. Like all
<br>
BackupPC programs, BackupPC_serverMesg should be run as the
BackupPC user (__BACKUPPCUSER__), so you should</p>

<p style="margin-top: 1em">su __BACKUPPCUSER__</p>

<p style="margin-top: 1em">before running
BackupPC_serverMesg. If the BackupPC user is configured with
/bin/false as the shell, you can use the -s option to su to
explicitly run a shell, eg:</p>

<p style="margin-top: 1em">su -s /bin/bash
__BACKUPPCUSER__</p>

<p style="margin-top: 1em">Depending upon your
configuration you might also need the -l option.</p>

<p style="margin-top: 1em">You can request status
information and start and stop backups using this interface.
This socket interface is mainly provided for the CGI
interface (and some of the BackupPC sub- <br>
programs use it too). But right now we just want to make
sure BackupPC is happy. Each of these commands should
produce some status output:</p>


<p style="margin-top: 1em">__INSTALLDIR__/bin/BackupPC_serverMesg
status info <br>
__INSTALLDIR__/bin/BackupPC_serverMesg status jobs <br>
__INSTALLDIR__/bin/BackupPC_serverMesg status hosts</p>

<p style="margin-top: 1em">The output should be some hashes
printed with Data::Dumper. If it looks cryptic and
confusing, and doesn&rsquo;t look like an error message,
then all is ok.</p>

<p style="margin-top: 1em">The jobs status should initially
show just BackupPC_trashClean. The hosts status should
produce a list of every host you have listed in
__CONFDIR__/hosts as part of a big <br>
cryptic output line.</p>

<p style="margin-top: 1em">You can also request that all
hosts be queued:</p>


<p style="margin-top: 1em">__INSTALLDIR__/bin/BackupPC_serverMesg
backup all</p>

<p style="margin-top: 1em">At this point you should make
sure the CGI interface works since it will be much easier to
see what is going on. That&rsquo;s our next subject.</p>

<p style="margin-top: 1em">Step 8: Checking email delivery
<br>
The script BackupPC_sendEmail sends status and error emails
to the administrator and users. It is usually run each night
by BackupPC_nightly.</p>

<p style="margin-top: 1em">To verify that it can run
sendmail and deliver email correctly you should ask it to
send a test email to you:</p>

<p style="margin-top: 1em">su __BACKUPPCUSER__ <br>
__INSTALLDIR__/bin/BackupPC_sendEmail -u
MYNAME@MYDOMAIN.COM</p>

<p style="margin-top: 1em">BackupPC_sendEmail also takes a
-c option that checks if BackupPC is running, and it sends
an email to $Conf{EMailAdminUserName} if it is not. That can
be used as a keep-alive <br>
check by adding</p>


<p style="margin-top: 1em">__INSTALLDIR__/bin/BackupPC_sendEmail
-c</p>

<p style="margin-top: 1em">to __BACKUPPCUSER__&rsquo;s
cron.</p>

<p style="margin-top: 1em">The -t option to
BackupPC_sendEmail causes it to print the email message
instead of invoking sendmail to deliver the message.</p>

<p style="margin-top: 1em">Step 9: CGI interface <br>
The CGI interface script, BackupPC_Admin, is a powerful and
flexible way to see and control what BackupPC is doing. It
is written for an Apache server. If you don&rsquo;t have
<br>
Apache, see &lt;http://www.apache.org&gt;.</p>

<p style="margin-top: 1em">There are two options for
setting up the CGI interface: standard mode and using
mod_perl. Mod_perl provides much higher performance (around
15x) and is the best choice if your <br>
Apache was built with mod_perl support. To see if your
apache was built with mod_perl run this command:</p>

<p style="margin-top: 1em">httpd -l | egrep mod_perl</p>

<p style="margin-top: 1em">If this prints mod_perl.c then
your Apache supports mod_perl.</p>

<p style="margin-top: 1em">Note: on some distributions
(like Debian) the command is not
&lsquo;&lsquo;httpd&rsquo;&rsquo;, but
&lsquo;&lsquo;apache&rsquo;&rsquo; or
&lsquo;&lsquo;apache2&rsquo;&rsquo;. Those distributions
will generally also use &lsquo;&lsquo;apache&rsquo;&rsquo;
for the Apache user <br>
account and configuration files.</p>

<p style="margin-top: 1em">Using mod_perl with
BackupPC_Admin requires a dedicated Apache to be run as the
BackupPC user (__BACKUPPCUSER__). This is because
BackupPC_Admin needs permission to access <br>
various files in BackupPC&rsquo;s data directories. In
contrast, the standard installation (without mod_perl)
solves this problem by having BackupPC_Admin installed as
setuid to the <br>
BackupPC user, so that BackupPC_Admin runs as the BackupPC
user.</p>

<p style="margin-top: 1em">Here are some specifics for each
setup:</p>

<p style="margin-top: 1em">Standard Setup <br>
The CGI interface should have been installed by the
configure.pl script in __CGIDIR__/BackupPC_Admin.
BackupPC_Admin should have been installed as setuid to the
BackupPC <br>
user (__BACKUPPCUSER__), in addition to user and group
execute permission.</p>

<p style="margin-top: 1em">You should be very careful about
permissions on BackupPC_Admin and the directory __CGIDIR__:
it is important that normal users cannot directly execute or
change <br>
BackupPC_Admin, otherwise they can access backup files for
any PC. You might need to change the group ownership of
BackupPC_Admin to a group that Apache belongs to so that
<br>
Apache can execute it (don&rsquo;t add &quot;other&quot;
execute permission!). The permissions should look like
this:</p>

<p style="margin-top: 1em">ls -l __CGIDIR__/BackupPC_Admin
<br>
-swxr-x--- 1 __BACKUPPCUSER__ web 82406 Jun 17 22:58
__CGIDIR__/BackupPC_Admin</p>

<p style="margin-top: 1em">The setuid script won&rsquo;t
work unless perl on your machine was installed with setuid
emulation. This is likely the problem if you get an error
saying such as &quot;Wrong user: my <br>
userid is 25, instead of 150&quot;, meaning the script is
running as the httpd user, not the BackupPC user. This is
because setuid scripts are disabled by the kernel in most
<br>
flavors of unix and linux.</p>

<p style="margin-top: 1em">To see if your perl has setuid
emulation, see if there is a program called sperl5.8.0 (or
sperl5.8.2 etc, based on your perl version) in the place
where perl is installed. If <br>
you can&rsquo;t find this program, then you have two
options: rebuild and reinstall perl with the setuid
emulation turned on (answer &quot;y&quot; to the question
&quot;Do you want to do <br>
setuid/setgid emulation?&quot; when you run perl&rsquo;s
configure script), or switch to the mod_perl alternative for
the CGI script (which doesn&rsquo;t need setuid to
work).</p>

<p style="margin-top: 1em">Mod_perl Setup <br>
The advantage of the mod_perl setup is that no setuid script
is needed, and there is a huge performance advantage. Not
only does all the perl code need to be parsed just <br>
once, the config.pl and hosts files, plus the connection to
the BackupPC server are cached between requests. The typical
speedup is around 15 times.</p>

<p style="margin-top: 1em">To use mod_perl you need to run
Apache as user __BACKUPPCUSER__. If you need to run multiple
Apache&rsquo;s for different services then you need to
create multiple top-level <br>
Apache directories, each with their own config file. You can
make copies of /etc/init.d/httpd and use the -d option to
httpd to point each http to a different top-level <br>
directory. Or you can use the -f option to explicitly point
to the config file. Multiple Apache&rsquo;s will run on
different Ports (eg: 80 is standard, 8080 is a typical <br>
alternative port accessed via http://yourhost.com:8080).</p>

<p style="margin-top: 1em">Inside BackupPC&rsquo;s Apache
http.conf file you should check the settings for ServerRoot,
DocumentRoot, User, Group, and Port. See <br>
&lt;http://httpd.apache.org/docs/server-wide.html&gt; for
more details.</p>

<p style="margin-top: 1em">For mod_perl, BackupPC_Admin
should not have setuid permission, so you should turn it
off:</p>

<p style="margin-top: 1em">chmod u-s
__CGIDIR__/BackupPC_Admin</p>

<p style="margin-top: 1em">To tell Apache to use mod_perl
to execute BackupPC_Admin, add this to Apache&rsquo;s 1.x
httpd.conf file:</p>

<p style="margin-top: 1em">&lt;IfModule mod_perl.c&gt; <br>
PerlModule Apache::Registry <br>
PerlTaintCheck On <br>
&lt;Location /cgi-bin/BackupPC/BackupPC_Admin&gt; # &lt;---
change path as needed <br>
SetHandler perl-script <br>
PerlHandler Apache::Registry <br>
Options ExecCGI <br>
PerlSendHeader On <br>
&lt;/Location&gt; <br>
&lt;/IfModule&gt;</p>

<p style="margin-top: 1em">Apache 2.0.44 with Perl 5.8.0 on
RedHat 7.1, Don Silvia reports that this works (with tweaks
from Michael Tuzi):</p>

<p style="margin-top: 1em">LoadModule perl_module
modules/mod_perl.so <br>
PerlModule Apache2</p>

<p style="margin-top: 1em">&lt;Directory /path/to/cgi/&gt;
<br>
SetHandler perl-script <br>
PerlResponseHandler ModPerl::Registry <br>
PerlOptions +ParseHeaders <br>
Options +ExecCGI <br>
Order deny,allow <br>
Deny from all <br>
Allow from 192.168.0 <br>
AuthName &quot;Backup Admin&quot; <br>
AuthType Basic <br>
AuthUserFile /path/to/user_file <br>
Require valid-user <br>
&lt;/Directory&gt;</p>

<p style="margin-top: 1em">There are other optimizations
and options with mod_perl. For example, you can tell
mod_perl to preload various perl modules, which saves memory
compared to loading separate <br>
copies in every Apache process after they are forked. See
Stas&rsquo;s definitive mod_perl guide at
&lt;http://perl.apache.org/guide&gt;.</p>

<p style="margin-top: 1em">BackupPC_Admin requires that
users are authenticated by Apache. Specifically, it expects
that Apache sets the REMOTE_USER environment variable when
it runs. There are several <br>
ways to do this. One way is to create a .htaccess file in
the cgi-bin directory that looks like:</p>

<p style="margin-top: 1em">AuthGroupFile
/etc/httpd/conf/group # &lt;--- change path as needed <br>
AuthUserFile /etc/http/conf/passwd # &lt;--- change path as
needed <br>
AuthType basic <br>
AuthName &quot;access&quot; <br>
require valid-user</p>

<p style="margin-top: 1em">You will also need
&quot;AllowOverride Indexes AuthConfig&quot; in the Apache
httpd.conf file to enable the .htaccess file. Alternatively,
everything can go in the Apache httpd.conf file <br>
inside a Location directive. The list of users and password
file above can be extracted from the NIS passwd file.</p>

<p style="margin-top: 1em">One alternative is to use LDAP.
In Apache&rsquo;s http.conf add these lines:</p>

<p style="margin-top: 1em">LoadModule auth_ldap_module
modules/auth_ldap.so <br>
AddModule auth_ldap.c</p>

<p style="margin-top: 1em"># cgi-bin - auth via LDAP (for
BackupPC) <br>
&lt;Location /cgi-binBackupPC/BackupPC_Admin&gt; # &lt;---
change path as needed <br>
AuthType Basic <br>
AuthName &quot;BackupPC login&quot; <br>
# replace MYDOMAIN, PORT, ORG and CO as needed <br>
AuthLDAPURL
ldap://ldap.MYDOMAIN.com:PORT/o=ORG,c=CO?uid?sub?(objectClass=*)
<br>
require valid-user <br>
&lt;/Location&gt;</p>

<p style="margin-top: 1em">If you want to disable the user
authentication you can set $Conf{CgiAdminUsers} to
&rsquo;*&rsquo;, which allows any user to have full access
to all hosts and backups. In this case the <br>
REMOTE_USER environment variable does not have to be set by
Apache.</p>

<p style="margin-top: 1em">Alternatively, you can force a
particular user name by getting Apache to set REMOTE_USER,
eg, to hardcode the user to www you could add this to
Apache&rsquo;s httpd.conf:</p>

<p style="margin-top: 1em">&lt;Location
/cgi-bin/BackupPC/BackupPC_Admin&gt; # &lt;--- change path
as needed <br>
Setenv REMOTE_USER www <br>
&lt;/Location&gt;</p>

<p style="margin-top: 1em">Finally, you should also edit
the config.pl file and adjust, as necessary, the
CGI-specific settings. They&rsquo;re near the end of the
config file. In particular, you should specify <br>
which users or groups have administrator (privileged)
access: see the config settings $Conf{CgiAdminUserGroup} and
$Conf{CgiAdminUsers}. Also, the configure.pl script placed
<br>
various images into $Conf{CgiImageDir} that BackupPC_Admin
needs to serve up. You should make sure that
$Conf{CgiImageDirURL} is the correct URL for the image
directory.</p>

<p style="margin-top: 1em">See the section &quot;Fixing
installation problems&quot; for suggestions on debugging the
Apache authentication setup.</p>

<p style="margin-top: 1em">How BackupPC Finds Hosts <br>
Starting with v2.0.0 the way hosts are discovered has
changed. In most cases you should specify 0 for the DHCP
flag in the conf/hosts file, even if the host has a
dynamically <br>
assigned IP address.</p>

<p style="margin-top: 1em">BackupPC (starting with v2.0.0)
looks up hosts with DHCP = 0 in this manner:</p>

<p style="margin-top: 1em">&Acirc;&middot; First DNS is
used to lookup the IP address given the client&rsquo;s name
using perl&rsquo;s gethostbyname() function. This should
succeed for machines that have fixed IP addresses that <br>
are known via DNS. You can manually see whether a given host
have a DNS entry according to perl&rsquo;s gethostbyname
function with this command:</p>

<p style="margin-top: 1em">perl -e
&rsquo;print(gethostbyname(&quot;myhost&quot;) ? &quot;ok0 :
&quot;not found0);&rsquo;</p>

<p style="margin-top: 1em">&Acirc;&middot; If
gethostbyname() fails, BackupPC then attempts a NetBios
multicast to find the host. Provided your client machine is
configured properly, it should respond to this NetBios <br>
multicast request. Specifically, BackupPC runs a command of
this form:</p>

<p style="margin-top: 1em">nmblookup myhost</p>

<p style="margin-top: 1em">If this fails you will see
output like:</p>

<p style="margin-top: 1em">querying myhost on 10.10.255.255
<br>
name_query failed to find name myhost</p>

<p style="margin-top: 1em">If it is successful you will see
output like:</p>

<p style="margin-top: 1em">querying myhost on 10.10.255.255
<br>
10.10.1.73 myhost&lt;00&gt;</p>

<p style="margin-top: 1em">Depending on your netmask you
might need to specify the -B option to nmblookup. For
example:</p>

<p style="margin-top: 1em">nmblookup -B 10.10.1.255
myhost</p>

<p style="margin-top: 1em">If necessary, experiment with
the nmblookup command which will return the IP address of
the client given its name. Then update
$Conf{NmbLookupFindHostCmd} with any necessary <br>
options to nmblookup.</p>

<p style="margin-top: 1em">For hosts that have the DHCP
flag set to 1, these machines are discovered as follows:</p>

<p style="margin-top: 1em">&Acirc;&middot; A DHCP address
pool ($Conf{DHCPAddressRanges}) needs to be specified.
BackupPC will check the NetBIOS name of each machine in the
range using a command of the form:</p>

<p style="margin-top: 1em">nmblookup -A W.X.Y.Z</p>

<p style="margin-top: 1em">where W.X.Y.Z is each candidate
address from $Conf{DHCPAddressRanges}. Any host that has a
valid NetBIOS name returned by this command (ie: matching an
entry in the hosts <br>
file) will be backed up. You can modify the specific
nmblookup command if necessary via $Conf{NmbLookupCmd}.</p>

<p style="margin-top: 1em">&Acirc;&middot; You only need to
use this DHCP feature if your client machine doesn&rsquo;t
respond to the NetBios multicast request:</p>

<p style="margin-top: 1em">nmblookup myHost</p>

<p style="margin-top: 1em">but does respond to a request
directed to its IP address:</p>

<p style="margin-top: 1em">nmblookup -A W.X.Y.Z</p>

<p style="margin-top: 1em">Other installation topics <br>
Removing a client <br>
If there is a machine that no longer needs to be backed up
(eg: a retired machine) you have two choices. First, you can
keep the backups accessible and browsable, but <br>
disable all new backups. Alternatively, you can completely
remove the client and all its backups.</p>

<p style="margin-top: 1em">To disable backups for a client
$Conf{BackupsDisable} can be set to two different values in
that client&rsquo;s per-PC config.pl file:</p>

<p style="margin-top: 1em">1. Don&rsquo;t do any regular
backups on this machine. Manually requested backups (via the
CGI interface) will still occur.</p>

<p style="margin-top: 1em">2. Don&rsquo;t do any backups on
this machine. Manually requested backups (via the CGI
interface) will be ignored.</p>

<p style="margin-top: 1em">This will still allow the
client&rsquo;s old backups to be browsable and
restorable.</p>

<p style="margin-top: 1em">To completely remove a client
and all its backups, you should remove its entry in the
conf/hosts file, and then delete the __TOPDIR__/pc/$host
directory. Whenever you change <br>
the hosts file, you should send BackupPC a HUP (-1) signal
so that it re-reads the hosts file. If you don&rsquo;t do
this, BackupPC will automatically re-read the hosts file at
<br>
the next regular wakeup.</p>

<p style="margin-top: 1em">Note that when you remove a
client&rsquo;s backups you won&rsquo;t initially recover
much disk space. That&rsquo;s because the client&rsquo;s
files are still in the pool. Overnight, when <br>
BackupPC_nightly next runs, all the unused pool files will
be deleted and this will recover the disk space used by the
client&rsquo;s backups.</p>

<p style="margin-top: 1em">Copying the pool <br>
If the pool disk requirements grow you might need to copy
the entire data directory to a new (bigger) file system.
Hopefully you are lucky enough to avoid this by having the
<br>
data directory on a RAID file system or LVM that allows the
capacity to be grown in place by adding disks.</p>

<p style="margin-top: 1em">The backup data directories
contain large numbers of hardlinks. If you try to copy the
pool the target directory will occupy a lot more space if
the hardlinks aren&rsquo;t re- <br>
established.</p>

<p style="margin-top: 1em">The best way to copy a pool file
system, if possible, is by copying the raw device at the
block level (eg: using dd). Application level programs that
understand hardlinks <br>
include the GNU cp program with the -a option and rsync -H.
However, the large number of hardlinks in the pool will make
the memory usage large and the copy very slow. <br>
Don&rsquo;t forget to stop BackupPC while the copy runs.</p>

<p style="margin-top: 1em">Starting in 3.0.0 a new script
bin/BackupPC_tarPCCopy can be used to assist the copy
process. Given one or more pc paths (eg: TOPDIR/pc/HOST or
TOPDIR/pc/HOST/nnn), <br>
BackupPC_tarPCCopy creates a tar archive with all the
hardlinks pointing to ../cpool/.... Any files not hardlinked
(eg: backups, LOG etc) are included verbatim.</p>

<p style="margin-top: 1em">You will need to specify the -P
option to tar when you extract the archive generated by
BackupPC_tarPCCopy since the hardlink targets are outside of
the directory being <br>
extracted.</p>

<p style="margin-top: 1em">To copy a complete store (ie:
__TOPDIR__) using BackupPC_tarPCCopy you should:</p>

<p style="margin-top: 1em">&Acirc;&middot; stop BackupPC so
that the store is static.</p>

<p style="margin-top: 1em">&Acirc;&middot; copy the cpool,
conf and log directory trees using any technique (like cp,
rsync or tar) without the need to preserve hardlinks.</p>

<p style="margin-top: 1em">&Acirc;&middot; copy the pc
directory using BackupPC_tarPCCopy:</p>

<p style="margin-top: 1em">su __BACKUPPCUSER__ <br>
cd NEW_TOPDIR <br>
mkdir pc <br>
cd pc <br>
__INSTALLDIR__/bin/BackupPC_tarPCCopy __TOPDIR__/pc | tar
xvPf -</p>

<p style="margin-top: 1em">Fixing installation problems
<br>
Please see the Wiki at
&lt;http://backuppc.wiki.sourceforge.net&gt; for debugging
suggestions. If you find a solution to your problem that
could help other users please add it to the <br>
Wiki!</p>

<p style="margin-top: 1em">Restore functions <br>
BackupPC supports several different methods for restoring
files. The most convenient restore options are provided via
the CGI interface. Alternatively, backup files can be <br>
restored using manual commands.</p>

<p style="margin-top: 1em">CGI restore options <br>
By selecting a host in the CGI interface, a list of all the
backups for that machine will be displayed. By selecting the
backup number you can navigate the shares and directory <br>
tree for that backup.</p>

<p style="margin-top: 1em">BackupPC&rsquo;s CGI interface
automatically fills incremental backups with the
corresponding full backup, which means each backup has a
filled appearance. Therefore, there is no need <br>
to do multiple restores from the incremental and full
backups: BackupPC does all the hard work for you. You simply
select the files and directories you want from the correct
<br>
backup vintage in one step.</p>

<p style="margin-top: 1em">You can download a single backup
file at any time simply by selecting it. Your browser should
prompt you with the file name and ask you whether to open
the file or save it to <br>
disk.</p>

<p style="margin-top: 1em">Alternatively, you can select
one or more files or directories in the currently selected
directory and select &quot;Restore selected files&quot;. (If
you need to restore selected files <br>
and directories from several different parent directories
you will need to do that in multiple steps.)</p>

<p style="margin-top: 1em">If you select all the files in a
directory, BackupPC will replace the list of files with the
parent directory. You will be presented with a screen that
has three options:</p>

<p style="margin-top: 1em">Option 1: Direct Restore <br>
With this option the selected files and directories are
restored directly back onto the host, by default in their
original location. Any old files with the same name will be
<br>
overwritten, so use caution. You can optionally change the
target host name, target share name, and target path prefix
for the restore, allowing you to restore the files to <br>
a different location.</p>

<p style="margin-top: 1em">Once you select &quot;Start
Restore&quot; you will be prompted one last time with a
summary of the exact source and target files and directories
before you commit. When you give the <br>
final go ahead the restore operation will be queued like a
normal backup job, meaning that it will be deferred if there
is a backup currently running for that host. When the <br>
restore job is run, smbclient, tar, rsync or rsyncd is used
(depending upon $Conf{XferMethod}) to actually restore the
files. Sorry, there is currently no option to cancel a <br>
restore that has been started. Currently ftp restores are
not fully implemented.</p>

<p style="margin-top: 1em">A record of the restore request,
including the result and list of files and directories, is
kept. It can be browsed from the host&rsquo;s home page.
$Conf{RestoreInfoKeepCnt} <br>
specifies how many old restore status files to keep.</p>

<p style="margin-top: 1em">Note that for direct restore to
work, the $Conf{XferMethod} must be able to write to the
client. For example, that means an SMB share for smbclient
needs to be writable, and <br>
the rsyncd module needs &quot;read only&quot; set to
&quot;false&quot;. This creates additional security risks.
If you only create read-only SMB shares (which is a good
idea), then the direct <br>
restore will fail. You can disable the direct restore option
by setting $Conf{SmbClientRestoreCmd},
$Conf{TarClientRestoreCmd} and $Conf{RsyncRestoreArgs} to
undef.</p>

<p style="margin-top: 1em">Option 2: Download Zip archive
<br>
With this option a zip file containing the selected files
and directories is downloaded. The zip file can then be
unpacked or individual files extracted as necessary on the
<br>
host machine. The compression level can be specified. A
value of 0 turns off compression.</p>

<p style="margin-top: 1em">When you select &quot;Download
Zip File&quot; you should be prompted where to save the
restore.zip file.</p>

<p style="margin-top: 1em">BackupPC does not consider
downloading a zip file as an actual restore operation, so
the details are not saved for later browsing as in the first
case. However, a mention <br>
that a zip file was downloaded by a particular user, and a
list of the files, does appear in BackupPC&rsquo;s log
file.</p>

<p style="margin-top: 1em">Option 3: Download Tar archive
<br>
This is identical to the previous option, except a tar file
is downloaded rather than a zip file (and there is currently
no compression option).</p>

<p style="margin-top: 1em">Command-line restore options
<br>
Apart from the CGI interface, BackupPC allows you to restore
files and directories from the command line. The following
programs can be used:</p>

<p style="margin-top: 1em">BackupPC_zcat <br>
For each file name argument it inflates (uncompresses) the
file and writes it to stdout. To use BackupPC_zcat you could
give it the full file name, eg:</p>


<p style="margin-top: 1em">__INSTALLDIR__/bin/BackupPC_zcat
__TOPDIR__/pc/host/5/fc/fcraig/fexample.txt &gt;
example.txt</p>

<p style="margin-top: 1em">It&rsquo;s your responsibility
to make sure the file is really compressed: BackupPC_zcat
doesn&rsquo;t check which backup the requested file is from.
BackupPC_zcat returns a non-zero <br>
status if it fails to uncompress a file.</p>

<p style="margin-top: 1em">BackupPC_tarCreate <br>
BackupPC_tarCreate creates a tar file for any files or
directories in a particular backup. Merging of incrementals
is done automatically, so you don&rsquo;t need to worry
about <br>
whether certain files appear in the incremental or full
backup.</p>

<p style="margin-top: 1em">The usage is:</p>

<p style="margin-top: 1em">BackupPC_tarCreate [options]
files/directories... <br>
Required options: <br>
-h host host from which the tar archive is created <br>
-n dumpNum dump number from which the tar archive is created
<br>
A negative number means relative to the end (eg -1 <br>
means the most recent dump, -2 2nd most recent etc). <br>
-s shareName share name from which the tar archive is
created</p>

<p style="margin-top: 1em">Other options: <br>
-t print summary totals <br>
-r pathRemove path prefix that will be replaced with pathAdd
<br>
-p pathAdd new path prefix <br>
-b BLOCKS BLOCKS x 512 bytes per record (default 20; same as
tar) <br>
-w writeBufSz write buffer size (default 1048576 = 1MB) <br>
-e charset charset for encoding file names (default: value
of <br>
$Conf{ClientCharset} when backup was done) <br>
-l just print a file listing; don&rsquo;t generate an
archive <br>
-L just print a detailed file listing; don&rsquo;t generate
an archive</p>

<p style="margin-top: 1em">The command-line files and
directories are relative to the specified shareName. The tar
file is written to stdout.</p>

<p style="margin-top: 1em">The -h, -n and -s options
specify which dump is used to generate the tar archive. The
-r and -p options can be used to relocate the paths in the
tar archive so extracted <br>
files can be placed in a location different from their
original location.</p>

<p style="margin-top: 1em">BackupPC_zipCreate <br>
BackupPC_zipCreate creates a zip file for any files or
directories in a particular backup. Merging of incrementals
is done automatically, so you don&rsquo;t need to worry
about <br>
whether certain files appear in the incremental or full
backup.</p>

<p style="margin-top: 1em">The usage is:</p>

<p style="margin-top: 1em">BackupPC_zipCreate [options]
files/directories... <br>
Required options: <br>
-h host host from which the zip archive is created <br>
-n dumpNum dump number from which the tar archive is created
<br>
A negative number means relative to the end (eg -1 <br>
means the most recent dump, -2 2nd most recent etc). <br>
-s shareName share name from which the zip archive is
created</p>

<p style="margin-top: 1em">Other options: <br>
-t print summary totals <br>
-r pathRemove path prefix that will be replaced with pathAdd
<br>
-p pathAdd new path prefix <br>
-c level compression level (default is 0, no compression)
<br>
-e charset charset for encoding file names (default:
utf8)</p>

<p style="margin-top: 1em">The command-line files and
directories are relative to the specified shareName. The zip
file is written to stdout. The -h, -n and -s options specify
which dump is used to <br>
generate the zip archive. The -r and -p options can be used
to relocate the paths in the zip archive so extracted files
can be placed in a location different from their <br>
original location.</p>

<p style="margin-top: 1em">Each of these programs reside in
__INSTALLDIR__/bin.</p>

<p style="margin-top: 1em">Archive functions <br>
BackupPC supports archiving to removable media. For users
that require offsite backups, BackupPC can create archives
that stream to tape devices, or create files of specified
<br>
sizes to fit onto cd or dvd media.</p>

<p style="margin-top: 1em">Each archive type is specified
by a BackupPC host with its XferMethod set to
&rsquo;archive&rsquo;. This allows for multiple
configurations at sites where there might be a combination
of <br>
tape and cd/dvd backups being made.</p>

<p style="margin-top: 1em">BackupPC provides a menu that
allows one or more hosts to be archived. The most recent
backup of each host is archived using BackupPC_tarCreate,
and the output is optionally <br>
compressed and split into fixed-sized files (eg: 650MB).</p>

<p style="margin-top: 1em">The archive for each host is
done by default using
__INSTALLDIR__/bin/BackupPC_archiveHost. This script can be
copied and customized as needed.</p>

<p style="margin-top: 1em">Configuring an Archive Host <br>
To create an Archive Host, add it to the hosts file just as
any other host and call it a name that best describes the
type of archive, e.g. ArchiveDLT</p>

<p style="margin-top: 1em">To tell BackupPC that the Host
is for Archives, create a config.pl file in the Archive
Hosts&rsquo;s pc directory, adding the following line:</p>

<p style="margin-top: 1em">$Conf{XferMethod} =
&rsquo;archive&rsquo;;</p>

<p style="margin-top: 1em">To further customise the
archive&rsquo;s parameters you can adding the changed
parameters in the host&rsquo;s config.pl file. The
parameters are explained in the config.pl file. Parameters
<br>
may be fixed or the user can be allowed to change them (eg:
output device).</p>

<p style="margin-top: 1em">The per-host archive command is
$Conf{ArchiveClientCmd}. By default this invokes</p>


<p style="margin-top: 1em">__INSTALLDIR__/bin/BackupPC_archiveHost</p>

<p style="margin-top: 1em">which you can copy and customize
as necessary.</p>

<p style="margin-top: 1em">Starting an Archive <br>
In the web interface, click on the Archive Host you wish to
use. You will see a list of previous archives and a summary
on each. By clicking the &quot;Start Archive&quot; button
you are <br>
presented with the list of hosts and the approximate backup
size (note this is raw size, not projected compressed size)
Select the hosts you wish to archive and press the <br>
&quot;Archive Selected Hosts&quot; button.</p>

<p style="margin-top: 1em">The next screen allows you to
adjust the parameters for this archive run. Press the
&quot;Start the Archive&quot; to start archiving the
selected hosts with the parameters displayed.</p>

<p style="margin-top: 1em">Starting an Archive from the
command line <br>
The script BackupPC_archiveStart can be used to start an
archive from the command line (or cron etc). The usage
is:</p>

<p style="margin-top: 1em">BackupPC_archiveStart
archiveHost userName hosts...</p>

<p style="margin-top: 1em">This creates an archive of the
most recent backup of each of the specified hosts. The first
two arguments are the archive host and the user name making
the request.</p>

<p style="margin-top: 1em">Other CGI Functions <br>
Configuration and Host Editor <br>
The CGI interface has a complete configuration and host
editor. Only the administrator can edit the main
configuration settings and hosts. The edit links are in the
left <br>
navigation bar.</p>

<p style="margin-top: 1em">When changes are made to any
parameter a &quot;Save&quot; button appears at the top of
the page. If you are editing a text box you will need to
click outside of the text box to make the <br>
Save button appear. If you don&rsquo;t select Save then the
changes won&rsquo;t be saved.</p>

<p style="margin-top: 1em">The host-specific configuration
can be edited from the host summary page using the link in
the left navigation bar. The administrator can edit any of
the host-specific <br>
configuration settings.</p>

<p style="margin-top: 1em">When editing the host-specific
configuration, each parameter has an &quot;override&quot;
setting that denotes the value is host-specific, meaning
that it overrides the setting in the main <br>
configuration. If you unselect &quot;override&quot; then the
setting is removed from the host-specific configuration, and
the main configuration file is displayed.</p>

<p style="margin-top: 1em">User&rsquo;s can edit their
host-specific configuration if enabled via
$Conf{CgiUserConfigEditEnable}. The specific subset of
configuration settings that a user can edit is specified
<br>
with $Conf{CgiUserConfigEdit}. It is recommended to make
this list short as possible (you probably don&rsquo;t want
your users saving dozens of backups) and it is essential
that they <br>
can&rsquo;t edit any of the Cmd configuration settings,
otherwise they can specify an arbitrary command that will be
executed as the BackupPC user.</p>

<p style="margin-top: 1em">RSS <br>
BackupPC supports a very basic RSS feed. Provided you have
the XML::RSS perl module installed, a URL similar to this
will provide RSS information:</p>


<p style="margin-top: 1em">http://localhost/cgi-bin/BackupPC/BackupPC_Admin?action=rss</p>

<p style="margin-top: 1em">This feature is experimental.
The information included will probably change.</p>

<p style="margin-top: 1em">BackupPC Design <br>
Some design issues <br>
Pooling common files <br>
To quickly see if a file is already in the pool, an MD5
digest of the file length and contents is used as the file
name in the pool. This can&rsquo;t guarantee a file is
identical: <br>
it just reduces the search to often a single file or handful
of files. A complete file comparison is always done to
verify if two files are really the same.</p>

<p style="margin-top: 1em">Identical files on multiples
backups are represented by hard links. Hardlinks are used so
that identical files all refer to the same physical file on
the server&rsquo;s disk. <br>
Also, hard links maintain reference counts so that BackupPC
knows when to delete unused files from the pool.</p>

<p style="margin-top: 1em">For the computer-science majors
among you, you can think of the pooling system used by
BackupPC as just a chained hash table stored on a (big) file
system.</p>

<p style="margin-top: 1em">The hashing function <br>
There is a tradeoff between how much of file is used for the
MD5 digest and the time taken comparing all the files that
have the same hash.</p>

<p style="margin-top: 1em">Using the file length and just
the first 4096 bytes of the file for the MD5 digest produces
some repetitions. One example: with 900,000 unique files in
the pool, this hash <br>
gives about 7,000 repeated files, and in the worst case 500
files have the same hash. That&rsquo;s not bad: we only have
to do a single file compare 99.2% of the time. But in the
<br>
worst case we have to compare as many as 500 files checking
for a match.</p>

<p style="margin-top: 1em">With a modest increase in CPU
time, if we use the file length and the first 256K of the
file we now only have 500 repeated files and in the worst
case around 20 files have <br>
the same hash. Furthermore, if we instead use the first and
last 128K of the file (more specifically, the first and
eighth 128K chunks for files larger than 1MB) we get only
<br>
300 repeated files and in the worst case around 20 files
have the same hash.</p>

<p style="margin-top: 1em">Based on this experimentation,
this is the hash function used by BackupPC. It is important
that you don&rsquo;t change the hash function after files
are already in the pool. <br>
Otherwise your pool will grow to twice the size until all
the old backups (and all the old files with old hashes)
eventually expire.</p>

<p style="margin-top: 1em">Compression <br>
BackupPC supports compression. It uses the deflate and
inflate methods in the Compress::Zlib module, which is based
on the zlib compression library (see <br>
&lt;http://www.gzip.org/zlib/&gt;).</p>

<p style="margin-top: 1em">The $Conf{CompressLevel} setting
specifies the compression level to use. Zero (0) means no
compression. Compression levels can be from 1 (least cpu
time, slightly worse <br>
compression) to 9 (most cpu time, slightly better
compression). The recommended value is 3. Changing it to 5,
for example, will take maybe 20% more cpu time and will get
<br>
another 2-3% additional compression. Diminishing returns set
in above 5. See the zlib documentation for more information
about compression levels.</p>

<p style="margin-top: 1em">BackupPC implements compression
with minimal CPU load. Rather than compressing every
incoming backup file and then trying to match it against the
pool, BackupPC computes the <br>
MD5 digest based on the uncompressed file, and matches
against the candidate pool files by comparing each
uncompressed pool file against the incoming backup file.
Since <br>
inflating a file takes roughly a factor of 10 less CPU time
than deflating there is a big saving in CPU time.</p>

<p style="margin-top: 1em">The combination of pooling
common files and compression can yield a factor of 8 or more
overall saving in backup storage.</p>

<p style="margin-top: 1em">BackupPC operation <br>
BackupPC reads the configuration information from
__CONFDIR__/config.pl. It then runs and manages all the
backup activity. It maintains queues of pending backup
requests, user <br>
backup requests and administrative commands. Based on the
configuration various requests will be executed
simultaneously.</p>

<p style="margin-top: 1em">As specified by
$Conf{WakeupSchedule}, BackupPC wakes up periodically to
queue backups on all the PCs. This is a four step
process:</p>

<p style="margin-top: 1em">1. For each host and DHCP
address backup requests are queued on the background command
queue.</p>

<p style="margin-top: 1em">2. For each PC, BackupPC_dump is
forked. Several of these may be run in parallel, based on
the configuration. First a ping is done to see if the
machine is alive. If this is a <br>
DHCP address, nmblookup is run to get the netbios name,
which is used as the host name. If DNS lookup fails,
$Conf{NmbLookupFindHostCmd} is run to find the IP address
from <br>
the host name. The file __TOPDIR__/pc/$host/backups is read
to decide whether a full or incremental backup needs to be
run. If no backup is scheduled, or the ping to $host <br>
fails, then BackupPC_dump exits.</p>

<p style="margin-top: 1em">The backup is done using the
specified XferMethod. Either samba&rsquo;s smbclient or tar
over ssh/rsh/nfs piped into BackupPC_tarExtract, or rsync
over ssh/rsh is run, or rsyncd <br>
is connected to, with the incoming data extracted to
__TOPDIR__/pc/$host/new. The XferMethod output is put into
__TOPDIR__/pc/$host/XferLOG.</p>

<p style="margin-top: 1em">The letter in the XferLOG file
shows the type of object, similar to the first letter of the
modes displayed by ls -l:</p>

<p style="margin-top: 1em">d -&gt; directory <br>
l -&gt; symbolic link <br>
b -&gt; block special file <br>
c -&gt; character special file <br>
p -&gt; pipe file (fifo) <br>
nothing -&gt; regular file</p>

<p style="margin-top: 1em">The words mean:</p>

<p style="margin-top: 1em">create <br>
new for this backup (ie: directory or file not in pool)</p>

<p style="margin-top: 1em">pool <br>
found a match in the pool</p>

<p style="margin-top: 1em">same <br>
file is identical to previous backup (contents were
checksummed and verified during full dump).</p>

<p style="margin-top: 1em">skip <br>
file skipped in incremental because attributes are the same
(only displayed if $Conf{XferLogLevel} &gt;= 2).</p>

<p style="margin-top: 1em">As BackupPC_tarExtract extracts
the files from smbclient or tar, or as rsync or ftp runs, it
checks each file in the backup to see if it is identical to
an existing file from <br>
any previous backup of any PC. It does this without needed
to write the file to disk. If the file matches an existing
file, a hardlink is created to the existing file in the <br>
pool. If the file does not match any existing files, the
file is written to disk and the file name is saved in
__TOPDIR__/pc/$host/NewFileList for later processing by <br>
BackupPC_link. BackupPC_tarExtract and rsync can handle
arbitrarily large files and multiple candidate matching
files without needing to write the file to disk in the case
<br>
of a match. This significantly reduces disk writes (and also
reads, since the pool file comparison is done disk to
memory, rather than disk to disk).</p>

<p style="margin-top: 1em">Based on the configuration
settings, BackupPC_dump checks each old backup to see if any
should be removed. Any expired backups are moved to
__TOPDIR__/trash for later <br>
removal by BackupPC_trashClean.</p>

<p style="margin-top: 1em">3. For each complete, good,
backup, BackupPC_link is run. To avoid race conditions as
new files are linked into the pool area, only a single
BackupPC_link program runs at a <br>
time and the rest are queued.</p>

<p style="margin-top: 1em">BackupPC_link reads the
NewFileList written by BackupPC_dump and inspects each new
file in the backup. It re-checks if there is a matching file
in the pool (another <br>
BackupPC_link could have added the file since BackupPC_dump
checked). If so, the file is removed and replaced by a hard
link to the existing file. If the file is new, a hard <br>
link to the file is made in the pool area, so that this file
is available for checking against each new file and new
backup.</p>

<p style="margin-top: 1em">Then, if $Conf{IncrFill} is set
(note that the default setting is off), for each incremental
backup, hard links are made in the new backup to all files
that were not <br>
extracted during the incremental backups. The means the
incremental backup looks like a complete image of the PC
(with the exception that files that were removed on the PC
<br>
since the last full backup will still appear in the backup
directory tree).</p>

<p style="margin-top: 1em">The CGI interface knows how to
merge unfilled incremental backups will the most recent
prior filled (full) backup, giving the incremental backups a
filled appearance. The <br>
default for $Conf{IncrFill} is off, since there is no need
to fill incremental backups. This saves some level of disk
activity, since lots of extra hardlinks are no longer <br>
needed (and don&rsquo;t have to be deleted when the backup
expires).</p>

<p style="margin-top: 1em">4. BackupPC_trashClean is always
run in the background to remove any expired backups. Every 5
minutes it wakes up and removes all the files in
__TOPDIR__/trash.</p>

<p style="margin-top: 1em">Also, once each night,
BackupPC_nightly is run to complete some additional
administrative tasks, such as cleaning the pool. This
involves removing any files in the pool that <br>
only have a single hard link (meaning no backups are using
that file). Again, to avoid race conditions,
BackupPC_nightly is only run when there are no BackupPC_link
<br>
processes running. When BackupPC_nightly is run no new
BackupPC_link jobs are started. If BackupPC_nightly takes
too long to run, the settings $Conf{MaxBackupPCNightlyJobs}
<br>
and $Conf{BackupPCNightlyPeriod} can be used to run several
BackupPC_nightly processes in parallel, and to split its job
over several nights.</p>

<p style="margin-top: 1em">BackupPC also listens for TCP
connections on $Conf{ServerPort}, which is used by the CGI
script BackupPC_Admin for status reporting and
user-initiated backup or backup cancel <br>
requests.</p>

<p style="margin-top: 1em">Storage layout <br>
BackupPC resides in several directories:</p>

<p style="margin-top: 1em">__INSTALLDIR__ <br>
Perl scripts comprising BackupPC reside in
__INSTALLDIR__/bin, libraries are in __INSTALLDIR__/lib and
documentation is in __INSTALLDIR__/doc.</p>

<p style="margin-top: 1em">__CGIDIR__ <br>
The CGI script BackupPC_Admin resides in this cgi binary
directory.</p>

<p style="margin-top: 1em">__CONFDIR__ <br>
All the configuration information resides below __CONFDIR__.
This directory contains:</p>

<p style="margin-top: 1em">The directory __CONFDIR__
contains:</p>

<p style="margin-top: 1em">config.pl <br>
Configuration file. See &quot;Configuration File&quot; below
for more details.</p>

<p style="margin-top: 1em">hosts <br>
Hosts file, which lists all the PCs to backup.</p>

<p style="margin-top: 1em">pc The directory __CONFDIR__/pc
contains per-client configuration files that override
settings in the main configuration file. Each file is named
__CONFDIR__/pc/HOST.pl, <br>
where HOST is the host name.</p>

<p style="margin-top: 1em">In pre-FHS versions of BackupPC
these files were located in
__TOPDIR__/pc/HOST/config.pl.</p>

<p style="margin-top: 1em">__LOGDIR__ <br>
The directory __LOGDIR__ (__TOPDIR__/log on pre-FHS versions
of BackupPC) contains:</p>

<p style="margin-top: 1em">LOG Current (today&rsquo;s) log
file output from BackupPC.</p>

<p style="margin-top: 1em">LOG.0 or LOG.0.z <br>
Yesterday&rsquo;s log file output. Log files are aged daily
and compressed (if compression is enabled), and old LOG
files are deleted.</p>

<p style="margin-top: 1em">BackupPC.pid <br>
Contains BackupPC&rsquo;s process id.</p>

<p style="margin-top: 1em">status.pl <br>
A summary of BackupPC&rsquo;s status written periodically by
BackupPC so that certain state information can be maintained
if BackupPC is restarted. Should not be edited.</p>

<p style="margin-top: 1em">UserEmailInfo.pl <br>
A summary of what email was last sent to each user, and when
the last email was sent. Should not be edited.</p>

<p style="margin-top: 1em">__TOPDIR__ <br>
All of BackupPC&rsquo;s data (PC backup images, logs,
configuration information) is stored below this
directory.</p>

<p style="margin-top: 1em">Below __TOPDIR__ are several
directories:</p>

<p style="margin-top: 1em">__TOPDIR__/trash <br>
Any directories and files below this directory are
periodically deleted whenever BackupPC_trashClean checks.
When a backup is aborted or when an old backup expires, <br>
BackupPC_dump simply moves the directory to __TOPDIR__/trash
for later removal by BackupPC_trashClean.</p>

<p style="margin-top: 1em">__TOPDIR__/pool <br>
All uncompressed files from PC backups are stored below
__TOPDIR__/pool. Each file&rsquo;s name is based on the MD5
hex digest of the file contents. Specifically, for files
<br>
less than 256K, the file length and the entire file is used.
For files up to 1MB, the file length and the first and last
128K are used. Finally, for files longer than <br>
1MB, the file length, and the first and eighth 128K chunks
for the file are used.</p>

<p style="margin-top: 1em">Each file is stored in a
subdirectory X/Y/Z, where X, Y, Z are the first 3 hex digits
of the MD5 digest.</p>

<p style="margin-top: 1em">For example, if a file has an
MD5 digest of 123456789abcdef0, the file is stored in
__TOPDIR__/pool/1/2/3/123456789abcdef0.</p>

<p style="margin-top: 1em">The MD5 digest might not be
unique (especially since not all the file&rsquo;s contents
are used for files bigger than 256K). Different files that
have the same MD5 digest are <br>
stored with a trailing suffix &quot;_n&quot; where n is an
incrementing number starting at 0. So, for example, if two
additional files were identical to the first, except the
last <br>
byte was different, and assuming the file was larger than
1MB (so the MD5 digests are the same but the files are
actually different), the three files would be stored as:</p>


<p style="margin-top: 1em">__TOPDIR__/pool/1/2/3/123456789abcdef0
<br>
__TOPDIR__/pool/1/2/3/123456789abcdef0_0 <br>
__TOPDIR__/pool/1/2/3/123456789abcdef0_1</p>

<p style="margin-top: 1em">Both BackupPC_dump (actually,
BackupPC_tarExtract) and BackupPC_link are responsible for
checking newly backed up files against the pool. For each
file, the MD5 digest is <br>
used to generate a file name in the pool directory. If the
file exists in the pool, the contents are compared. If there
is no match, additional files ending in &quot;_n&quot; are
<br>
checked. (Actually, BackupPC_tarExtract compares multiple
candidate files in parallel.) If the file contents exactly
match, the file is created by simply making a hard <br>
link to the pool file (this is done by BackupPC_tarExtract
as the backup proceeds). Otherwise, BackupPC_tarExtract
writes the new file to disk and a new hard link is made <br>
in the pool to the file (this is done later by
BackupPC_link).</p>

<p style="margin-top: 1em">Therefore, every file in the
pool will have at least 2 hard links (one for the pool file
and one for the backup file below __TOPDIR__/pc). Identical
files from different <br>
backups or PCs will all be linked to the same file. When old
backups are deleted, some files in the pool might only have
one link. BackupPC_nightly checks the entire <br>
pool and removes all files that have only a single link,
thereby recovering the storage for that file.</p>

<p style="margin-top: 1em">One other issue: zero length
files are not pooled, since there are a lot of these files
and on most file systems it doesn&rsquo;t save any disk
space to turn these files into <br>
hard links.</p>

<p style="margin-top: 1em">__TOPDIR__/cpool <br>
All compressed files from PC backups are stored below
__TOPDIR__/cpool. Its layout is the same as __TOPDIR__/pool,
and the hashing function is the same (and, <br>
importantly, based on the uncompressed file, not the
compressed file).</p>

<p style="margin-top: 1em">__TOPDIR__/pc/$host <br>
For each PC $host, all the backups for that PC are stored
below the directory __TOPDIR__/pc/$host. This directory
contains the following files:</p>

<p style="margin-top: 1em">LOG Current log file for this PC
from BackupPC_dump.</p>

<p style="margin-top: 1em">LOG.DDMMYYYY or LOG.DDMMYYYY.z
<br>
Last month&rsquo;s log file. Log files are aged monthly and
compressed (if compression is enabled), and old LOG files
are deleted. In earlier versions of BackupPC these <br>
files used to have a suffix of 0, 1, ....</p>

<p style="margin-top: 1em">XferERR or XferERR.z <br>
Output from the transport program (ie: smbclient, tar, rsync
or ftp) for the most recent failed backup.</p>

<p style="margin-top: 1em">new Subdirectory in which the
current backup is stored. This directory is renamed if the
backup succeeds.</p>

<p style="margin-top: 1em">XferLOG or XferLOG.z <br>
Output from the transport program (ie: smbclient, tar, rsync
or ftp) for the current backup.</p>

<p style="margin-top: 1em">nnn (an integer) <br>
Successful backups are in directories numbered sequentially
starting at 0.</p>

<p style="margin-top: 1em">XferLOG.nnn or XferLOG.nnn.z
<br>
Output from the transport program (ie: smbclient, tar, rsync
or ftp) corresponding to backup number nnn.</p>

<p style="margin-top: 1em">RestoreInfo.nnn <br>
Information about restore request #nnn including who, what,
when, and why. This file is in Data::Dumper format. (Note
that the restore numbers are not related to the <br>
backup number.)</p>

<p style="margin-top: 1em">RestoreLOG.nnn.z <br>
Output from smbclient, tar or rsync during restore #nnn.
(Note that the restore numbers are not related to the backup
number.)</p>

<p style="margin-top: 1em">ArchiveInfo.nnn <br>
Information about archive request #nnn including who, what,
when, and why. This file is in Data::Dumper format. (Note
that the archive numbers are not related to the <br>
restore or backup number.)</p>

<p style="margin-top: 1em">ArchiveLOG.nnn.z <br>
Output from archive #nnn. (Note that the archive numbers are
not related to the backup or restore number.)</p>

<p style="margin-top: 1em">config.pl <br>
Old location of optional configuration settings specific to
this host. Settings in this file override the main
configuration file. In new versions of BackupPC the <br>
per-host configuration files are stored in
__CONFDIR__/pc/HOST.pl.</p>

<p style="margin-top: 1em">backups <br>
A tab-delimited ascii table listing information about each
successful backup, one per row. The columns are:</p>

<p style="margin-top: 1em">num The backup number, an
integer that starts at 0 and increments for each successive
backup. The corresponding backup is stored in the directory
num (eg: if this <br>
field is 5, then the backup is stored in
__TOPDIR__/pc/$host/5).</p>

<p style="margin-top: 1em">type <br>
Set to &quot;full&quot; or &quot;incr&quot; for full or
incremental backup.</p>

<p style="margin-top: 1em">startTime <br>
Start time of the backup in unix seconds.</p>

<p style="margin-top: 1em">endTime <br>
Stop time of the backup in unix seconds.</p>

<p style="margin-top: 1em">nFiles <br>
Number of files backed up (as reported by smbclient, tar,
rsync or ftp).</p>

<p style="margin-top: 1em">size <br>
Total file size backed up (as reported by smbclient, tar,
rsync or ftp).</p>

<p style="margin-top: 1em">nFilesExist <br>
Number of files that were already in the pool (as determined
by BackupPC_dump and BackupPC_link).</p>

<p style="margin-top: 1em">sizeExist <br>
Total size of files that were already in the pool (as
determined by BackupPC_dump and BackupPC_link).</p>

<p style="margin-top: 1em">nFilesNew <br>
Number of files that were not in the pool (as determined by
BackupPC_link).</p>

<p style="margin-top: 1em">sizeNew <br>
Total size of files that were not in the pool (as determined
by BackupPC_link).</p>

<p style="margin-top: 1em">xferErrs <br>
Number of errors or warnings from smbclient, tar, rsync or
ftp.</p>

<p style="margin-top: 1em">xferBadFile <br>
Number of errors from smbclient that were bad file errors
(zero otherwise).</p>

<p style="margin-top: 1em">xferBadShare <br>
Number of errors from smbclient that were bad share errors
(zero otherwise).</p>

<p style="margin-top: 1em">tarErrs <br>
Number of errors from BackupPC_tarExtract.</p>

<p style="margin-top: 1em">compress <br>
The compression level used on this backup. Zero or empty
means no compression.</p>

<p style="margin-top: 1em">sizeExistComp <br>
Total compressed size of files that were already in the pool
(as determined by BackupPC_dump and BackupPC_link).</p>

<p style="margin-top: 1em">sizeNewComp <br>
Total compressed size of files that were not in the pool (as
determined by BackupPC_link).</p>

<p style="margin-top: 1em">noFill <br>
Set if this backup has not been filled in with the most
recent previous filled or full backup. See
$Conf{IncrFill}.</p>

<p style="margin-top: 1em">fillFromNum <br>
If this backup was filled (ie: noFill is 0) then this is the
number of the backup that it was filled from</p>

<p style="margin-top: 1em">mangle <br>
Set if this backup has mangled file names and attributes.
Always true for backups in v1.4.0 and above. False for all
backups prior to v1.4.0.</p>

<p style="margin-top: 1em">xferMethod <br>
Set to the value of $Conf{XferMethod} when this dump was
done.</p>

<p style="margin-top: 1em">level <br>
The level of this dump. A full dump is level 0. Currently
incrementals are 1. But when multi-level incrementals are
supported this will reflect each dump&rsquo;s <br>
incremental level.</p>

<p style="margin-top: 1em">restores <br>
A tab-delimited ascii table listing information about each
requested restore, one per row. The columns are:</p>

<p style="margin-top: 1em">num Restore number (matches the
suffix of the RestoreInfo.nnn and RestoreLOG.nnn.z file),
unrelated to the backup number.</p>

<p style="margin-top: 1em">startTime <br>
Start time of the restore in unix seconds.</p>

<p style="margin-top: 1em">endTime <br>
End time of the restore in unix seconds.</p>

<p style="margin-top: 1em">result <br>
Result (ok or failed).</p>

<p style="margin-top: 1em">errorMsg <br>
Error message if restore failed.</p>

<p style="margin-top: 1em">nFiles <br>
Number of files restored.</p>

<p style="margin-top: 1em">size <br>
Size in bytes of the restored files.</p>

<p style="margin-top: 1em">tarCreateErrs <br>
Number of errors from BackupPC_tarCreate during restore.</p>

<p style="margin-top: 1em">xferErrs <br>
Number of errors from smbclient, tar, rsync or ftp during
restore.</p>

<p style="margin-top: 1em">archives <br>
A tab-delimited ascii table listing information about each
requested archive, one per row. The columns are:</p>

<p style="margin-top: 1em">num Archive number (matches the
suffix of the ArchiveInfo.nnn and ArchiveLOG.nnn.z file),
unrelated to the backup or restore number.</p>

<p style="margin-top: 1em">startTime <br>
Start time of the restore in unix seconds.</p>

<p style="margin-top: 1em">endTime <br>
End time of the restore in unix seconds.</p>

<p style="margin-top: 1em">result <br>
Result (ok or failed).</p>

<p style="margin-top: 1em">errorMsg <br>
Error message if archive failed.</p>

<p style="margin-top: 1em">Compressed file format <br>
The compressed file format is as generated by
Compress::Zlib::deflate with one minor, but important,
tweak. Since Compress::Zlib::inflate fully inflates its
argument in memory, <br>
it could take large amounts of memory if it was inflating a
highly compressed file. For example, a 200MB file of 0x0
bytes compresses to around 200K bytes. If <br>
Compress::Zlib::inflate was called with this single 200K
buffer, it would need to allocate 200MB of memory to return
the result.</p>

<p style="margin-top: 1em">BackupPC watches how efficiently
a file is compressing. If a big file has very high
compression (meaning it will use too much memory when it is
inflated), BackupPC calls the <br>
flush() method, which gracefully completes the current
compression. BackupPC then starts another deflate and simply
appends the output file. So the BackupPC compressed file
<br>
format is one or more concatenated deflations/flushes. The
specific ratios that BackupPC uses is that if a 6MB chunk
compresses to less than 64K then a flush will be done.</p>

<p style="margin-top: 1em">Back to the example of the 200MB
file of 0x0 bytes. Adding flushes every 6MB adds only 200 or
so bytes to the 200K output. So the storage cost of flushing
is negligible.</p>

<p style="margin-top: 1em">To easily decompress a BackupPC
compressed file, the script BackupPC_zcat can be found in
__INSTALLDIR__/bin. For each file name argument it inflates
the file and writes it to <br>
stdout.</p>

<p style="margin-top: 1em">Rsync checksum caching <br>
An incremental backup with rsync compares attributes on the
client with the last full backup. Any files with identical
attributes are skipped. A full backup with rsync sets the
<br>
--ignore-times option, which causes every file to be
examined independent of attributes.</p>

<p style="margin-top: 1em">Each file is examined by
generating block checksums (default 2K blocks) on the
receiving side (that&rsquo;s the BackupPC side), sending
those checksums to the client, where the remote <br>
rsync matches those checksums with the corresponding file.
The matching blocks and new data is sent back, allowing the
client file to be reassembled. A checksum for the entire
<br>
file is sent to as an extra check the the reconstructed file
is correct.</p>

<p style="margin-top: 1em">This results in significant disk
IO and computation for BackupPC: every file in a full
backup, or any file with non-matching attributes in an
incremental backup, needs to be <br>
uncompressed, block checksums computed and sent. Then the
receiving side reassembles the file and has to verify the
whole-file checksum. Even if the file is identical, prior to
<br>
2.1.0, BackupPC had to read and uncompress the file twice,
once to compute the block checksums and later to verify the
whole-file checksum.</p>

<p style="margin-top: 1em">Starting in 2.1.0, BackupPC
supports optional checksum caching, which means the block
and file checksums only need to be computed once for each
file. This results in a <br>
significant performance improvement. This only works for
compressed pool files. It is enabled by adding</p>


<p style="margin-top: 1em">&rsquo;--checksum-seed=32761&rsquo;,</p>

<p style="margin-top: 1em">to $Conf{RsyncArgs} and
$Conf{RsyncRestoreArgs}.</p>

<p style="margin-top: 1em">Rsync versions prior to and
including rsync-2.6.2 need a small patch to add support for
the --checksum-seed option. This patch is available in the
cygwin-rsyncd package at <br>
&lt;http://backuppc.sourceforge.net&gt;. This patch is
already included in rsync CVS, so it will be standard in
future versions of rsync.</p>

<p style="margin-top: 1em">When this option is present,
BackupPC will add block and file checksums to the compressed
pool file the next time a pool file is used and it
doesn&rsquo;t already have cached <br>
checksums. The first time a new file is written to the pool,
the checksums are not appended. The next time checksums are
needed for a file, they are computed and added. So the <br>
full performance benefit of checksum caching won&rsquo;t be
noticed until the third time a pool file is used (eg: the
third full backup).</p>

<p style="margin-top: 1em">With checksum caching enabled,
there is a risk that should a file&rsquo;s contents in the
pool be corrupted due to a disk problem, but the cached
checksums are still correct, the <br>
corruption will not be detected by a full backup, since the
file contents are no longer read and compared. To reduce the
chance that this remains undetected, BackupPC can <br>
recheck cached checksums for a fraction of the files. This
fraction is set with the $Conf{RsyncCsumCacheVerifyProb}
setting. The default value of 0.01 means that 1% of the time
<br>
a file&rsquo;s checksums are read, the checksums are
verified. This reduces performance slightly, but, over time,
ensures that files contents are in sync with the cached
checksums.</p>

<p style="margin-top: 1em">The format of the cached
checksum data can be discovered by looking at the code.
Basically, the first byte of the compressed file is changed
to denote that checksums are <br>
appended. The block and file checksum data, plus some other
information and magic word, are appended to the compressed
file. This allows the cache update to be done in-place.</p>

<p style="margin-top: 1em">File name mangling <br>
Backup file names are stored in &quot;mangled&quot; form.
Each node of a path is preceded by &quot;f&quot; (mnemonic:
file), and special, % and /) are URI-encoded as
&quot;%xx&quot;, where characters (0 <br>
xx is the ascii character&rsquo;s hex value. So
c:/craig/example.txt is now stored as
fc/fcraig/fexample.txt.</p>

<p style="margin-top: 1em">This was done mainly so
meta-data could be stored alongside the backup files without
name collisions. In particular, the attributes for the files
in a directory are stored in a <br>
file called &quot;attrib&quot;, and mangling avoids file
name collisions (I discarded the idea of having a duplicate
directory tree for every backup just to store the
attributes). Other <br>
meta-data (eg: rsync checksums) could be stored in file
names preceded by, eg, &quot;c&quot;. There are two other
benefits to mangling: the share name might contain
&quot;/&quot; (eg: &quot;/home/craig&quot; <br>
for tar transport), and I wanted that represented as a
single level in the storage tree. Secondly, as files are
written to NewFileList for later processing by
BackupPC_link, <br>
embedded newlines in the file&rsquo;s path will cause
problems which are avoided by mangling.</p>

<p style="margin-top: 1em">The CGI script undoes the
mangling, so it is invisible to the user. Old (unmangled)
backups are still supported by the CGI interface.</p>

<p style="margin-top: 1em">Special files <br>
Linux/unix file systems support several special file types:
symbolic links, character and block device files, fifos
(pipes) and unix-domain sockets. All except unix-domain <br>
sockets are supported by BackupPC (there&rsquo;s no point in
backing up or restoring unix-domain sockets since they only
have meaning after a process creates them). Symbolic links
are <br>
stored as a plain file whose contents are the contents of
the link (not the file it points to). This file is
compressed and pooled like any normal file. Character and
block <br>
device files are also stored as plain files, whose contents
are two integers separated by a comma; the numbers are the
major and minor device number. These files are compressed
<br>
and pooled like any normal file. Fifo files are stored as
empty plain files (which are not pooled since they have zero
size). In all cases, the original file type is stored in
<br>
the attrib file so it can be correctly restored.</p>

<p style="margin-top: 1em">Hardlinks are also supported.
When GNU tar first encounters a file with more than one link
(ie: hardlinks) it dumps it as a regular file. When it sees
the second and subsequent <br>
hardlinks to the same file, it dumps just the hardlink
information. BackupPC correctly recognizes these hardlinks
and stores them just like symlinks: a regular text file
whose <br>
contents is the path of the file linked to. The CGI script
will download the original file when you click on a
hardlink.</p>

<p style="margin-top: 1em">Also, BackupPC_tarCreate has
enough magic to re-create the hardlinks dynamically based on
whether or not the original file and hardlinks are both
included in the tar file. For <br>
example, imagine a/b/x is a hardlink to a/c/y. If you use
BackupPC_tarCreate to restore directory a, then the tar file
will include a/b/x as the original file and a/c/y will be
<br>
a hardlink to a/b/x. If, instead you restore a/c, then the
tar file will include a/c/y as the original file, not a
hardlink.</p>

<p style="margin-top: 1em">Attribute file format <br>
The unix attributes for the contents of a directory (all the
files and directories in that directory) are stored in a
file called attrib. There is a single attrib file for each
<br>
directory in a backup. For example, if c:/craig contains a
single file c:/craig/example.txt, that file would be stored
as fc/fcraig/fexample.txt and there would be an attribute
<br>
file in fc/fcraig/attrib (and also fc/attrib and ./attrib).
The file fc/fcraig/attrib would contain a single entry
containing the attributes for fc/fcraig/fexample.txt.</p>

<p style="margin-top: 1em">The attrib file starts with a
magic number, followed by the concatenation of the following
information for each file:</p>

<p style="margin-top: 1em">&Acirc;&middot; File name length
in perl&rsquo;s pack &quot;w&quot; format (variable length
base 128).</p>

<p style="margin-top: 1em">&Acirc;&middot; File name.</p>

<p style="margin-top: 1em">&Acirc;&middot; The unix file
type, mode, uid, gid and file size divided by 4GB and file
size modulo 4GB (type mode uid gid sizeDiv4GB sizeMod4GB),
in perl&rsquo;s pack &quot;w&quot; format (variable length
<br>
base 128).</p>

<p style="margin-top: 1em">&Acirc;&middot; The unix mtime
(unix seconds) in perl&rsquo;s pack &quot;N&quot; format (32
bit integer).</p>

<p style="margin-top: 1em">The attrib file is also
compressed if compression is enabled. See the
lib/BackupPC/Attrib.pm module for full details.</p>

<p style="margin-top: 1em">Attribute files are pooled just
like normal backup files. This saves space if all the files
in a directory have the same attributes across multiple
backups, which is common.</p>

<p style="margin-top: 1em">Optimizations <br>
BackupPC doesn&rsquo;t care about the access time of files
in the pool since it saves attribute meta-data separate from
the files. Since BackupPC mostly does reads from disk, <br>
maintaining the access time of files generates a lot of
unnecessary disk writes. So, provided BackupPC has a
dedicated data disk, you should consider mounting
BackupPC&rsquo;s data <br>
directory with the noatime (or, with Linux kernels
&gt;=2.6.20, relatime) attribute (see mount(1)).</p>

<p style="margin-top: 1em">Some Limitations <br>
BackupPC isn&rsquo;t perfect (but it is getting better).
Please see
&lt;http://backuppc.sourceforge.net/faq/limitations.html&gt;
for a discussion of some of BackupPC&rsquo;s
limitations.</p>

<p style="margin-top: 1em">Security issues <br>
Please see
&lt;http://backuppc.sourceforge.net/faq/security.html&gt;
for a discussion of some of various security issues.</p>

<p style="margin-top: 1em">Configuration File <br>
The BackupPC configuration file resides in
__CONFDIR__/config.pl. Optional per-PC configuration files
reside in __CONFDIR__/pc/$host.pl (or
__TOPDIR__/pc/$host/config.pl in non- <br>
FHS versions of BackupPC). This file can be used to override
settings just for a particular PC.</p>

<p style="margin-top: 1em">Modifying the main configuration
file <br>
The configuration file is a perl script that is executed by
BackupPC, so you should be careful to preserve the file
syntax (punctuation, quotes etc) when you edit it. It is
<br>
recommended that you use CVS, RCS or some other method of
source control for changing config.pl.</p>

<p style="margin-top: 1em">BackupPC reads or re-reads the
main configuration file and the hosts file in three
cases:</p>

<p style="margin-top: 1em">&Acirc;&middot; Upon
startup.</p>

<p style="margin-top: 1em">&Acirc;&middot; When BackupPC is
sent a HUP (-1) signal. Assuming you installed the init.d
script, you can also do this with &quot;/etc/init.d/backuppc
reload&quot;.</p>

<p style="margin-top: 1em">&Acirc;&middot; When the
modification time of config.pl file changes. BackupPC checks
the modification time once during each regular wakeup.</p>

<p style="margin-top: 1em">Whenever you change the
configuration file you can either do a kill -HUP
BackupPC_pid or simply wait until the next regular wakeup
period.</p>

<p style="margin-top: 1em">Each time the configuration file
is re-read a message is reported in the LOG file, so you can
tail it (or view it via the CGI interface) to make sure your
kill -HUP worked. <br>
Errors in parsing the configuration file are also reported
in the LOG file.</p>

<p style="margin-top: 1em">The optional per-PC
configuration file (__CONFDIR__/pc/$host.pl or
__TOPDIR__/pc/$host/config.pl in non-FHS versions of
BackupPC) is read whenever it is needed by BackupPC_dump,
<br>
BackupPC_link and others.</p>

<p style="margin-top: 1em">Configuration Parameters <br>
The configuration parameters are divided into five general
groups. The first group (general server configuration)
provides general configuration for BackupPC. The next two
<br>
groups describe what to backup, when to do it, and how long
to keep it. The fourth group are settings for email
reminders, and the final group contains settings for the CGI
<br>
interface.</p>

<p style="margin-top: 1em">All configuration settings in
the second through fifth groups can be overridden by the
per-PC config.pl file.</p>

<p style="margin-top: 1em">General server configuration
<br>
$Conf{ServerHost} = &rsquo;&rsquo;; <br>
Host name on which the BackupPC server is running.</p>

<p style="margin-top: 1em">$Conf{ServerPort} = -1; <br>
TCP port number on which the BackupPC server listens for and
accepts connections. Normally this should be disabled (set
to -1). The TCP port is only needed if apache runs <br>
on a different machine from BackupPC. In that case, set this
to any spare port number over 1024 (eg: 2359). If you enable
the TCP port, make sure you set <br>
$Conf{ServerMesgSecret} too!</p>

<p style="margin-top: 1em">$Conf{ServerMesgSecret} =
&rsquo;&rsquo;; <br>
Shared secret to make the TCP port secure. Set this to a
hard to guess string if you enable the TCP port (ie:
$Conf{ServerPort} &gt; 0).</p>

<p style="margin-top: 1em">To avoid possible attacks via
the TCP socket interface, every client message is protected
by an MD5 digest. The MD5 digest includes four items: <br>
- a seed that is sent to the client when the connection
opens <br>
- a sequence number that increments for each message <br>
- a shared secret that is stored in $Conf{ServerMesgSecret}
<br>
- the message itself.</p>

<p style="margin-top: 1em">The message is sent in plain
text preceded by the MD5 digest. A snooper can see the
plain-text seed sent by BackupPC and plain-text message from
the client, but cannot <br>
construct a valid MD5 digest since the secret
$Conf{ServerMesgSecret} is unknown. A replay attack is not
possible since the seed changes on a per-connection and
per-message <br>
basis.</p>

<p style="margin-top: 1em">$Conf{MyPath} =
&rsquo;/bin&rsquo;; <br>
PATH setting for BackupPC. An explicit value is necessary
for taint mode. Value shouldn&rsquo;t matter too much since
all execs use explicit paths. However, taint mode in perl
<br>
will complain if this directory is world writable.</p>

<p style="margin-top: 1em">$Conf{UmaskMode} = 027; <br>
Permission mask for directories and files created by
BackupPC. Default value prevents any access from group
other, and prevents group write.</p>

<p style="margin-top: 1em">$Conf{WakeupSchedule} = [1, 2,
3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
20, 21, 22, 23]; <br>
Times at which we wake up, check all the PCs, and schedule
necessary backups. Times are measured in hours since
midnight. Can be fractional if necessary (eg: 4.25 means
<br>
4:15am).</p>

<p style="margin-top: 1em">If the hosts you are backing up
are always connected to the network you might have only one
or two wakeups each night. This will keep the backup
activity after hours. On <br>
the other hand, if you are backing up laptops that are only
intermittently connected to the network you will want to
have frequent wakeups (eg: hourly) to maximize the chance
<br>
that each laptop is backed up.</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">$Conf{WakeupSchedule} = [22.5];
# once per day at 10:30 pm. <br>
$Conf{WakeupSchedule} = [2,4,6,8,10,12,14,16,18,20,22]; #
every 2 hours</p>

<p style="margin-top: 1em">The default value is every hour
except midnight.</p>

<p style="margin-top: 1em">The first entry of
$Conf{WakeupSchedule} is when BackupPC_nightly is run. You
might want to re-arrange the entries in
$Conf{WakeupSchedule} (they don&rsquo;t have to be
ascending) <br>
so that the first entry is when you want BackupPC_nightly to
run (eg: when you don&rsquo;t expect a lot of regular
backups to run).</p>

<p style="margin-top: 1em">$Conf{MaxBackups} = 4; <br>
Maximum number of simultaneous backups to run. If there are
no user backup requests then this is the maximum number of
simultaneous backups.</p>

<p style="margin-top: 1em">$Conf{MaxUserBackups} = 4; <br>
Additional number of simultaneous backups that users can
run. As many as $Conf{MaxBackups} + $Conf{MaxUserBackups}
requests can run at the same time.</p>

<p style="margin-top: 1em">$Conf{MaxPendingCmds} = 15; <br>
Maximum number of pending link commands. New backups will
only be started if there are no more than
$Conf{MaxPendingCmds} plus $Conf{MaxBackups} number of
pending link <br>
commands, plus running jobs. This limit is to make sure
BackupPC doesn&rsquo;t fall too far behind in running
BackupPC_link commands.</p>

<p style="margin-top: 1em">$Conf{CmdQueueNice} = 10; <br>
Nice level at which CmdQueue commands (eg: BackupPC_link and
BackupPC_nightly) are run at.</p>

<p style="margin-top: 1em">$Conf{MaxBackupPCNightlyJobs} =
2; <br>
How many BackupPC_nightly processes to run in parallel.</p>

<p style="margin-top: 1em">Each night, at the first wakeup
listed in $Conf{WakeupSchedule}, BackupPC_nightly is run.
Its job is to remove unneeded files in the pool, ie: files
that only have one link. <br>
To avoid race conditions, BackupPC_nightly and BackupPC_link
cannot run at the same time. Starting in v3.0.0,
BackupPC_nightly can run concurrently with backups <br>
(BackupPC_dump).</p>

<p style="margin-top: 1em">So to reduce the elapsed time,
you might want to increase this setting to run several
BackupPC_nightly processes in parallel (eg: 4, or even
8).</p>

<p style="margin-top: 1em">$Conf{BackupPCNightlyPeriod} =
1; <br>
How many days (runs) it takes BackupPC_nightly to traverse
the entire pool. Normally this is 1, which means every night
it runs, it does traverse the entire pool removing <br>
unused pool files.</p>

<p style="margin-top: 1em">Other valid values are 2, 4, 8,
16. This causes BackupPC_nightly to traverse 1/2, 1/4, 1/8
or 1/16th of the pool each night, meaning it takes 2, 4, 8
or 16 days to <br>
completely traverse the pool. The advantage is that each
night the running time of BackupPC_nightly is reduced
roughly in proportion, since the total job is split over
<br>
multiple days. The disadvantage is that unused pool files
take longer to get deleted, which will slightly increase
disk usage.</p>

<p style="margin-top: 1em">Note that even when
$Conf{BackupPCNightlyPeriod} &gt; 1, BackupPC_nightly still
runs every night. It just does less work each time it
runs.</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">$Conf{BackupPCNightlyPeriod} =
1; # entire pool is checked every night</p>

<p style="margin-top: 1em">$Conf{BackupPCNightlyPeriod} =
2; # two days to complete pool check <br>
# (different half each night)</p>

<p style="margin-top: 1em">$Conf{BackupPCNightlyPeriod} =
4; # four days to complete pool check <br>
# (different quarter each night)</p>

<p style="margin-top: 1em">$Conf{MaxOldLogFiles} = 14; <br>
Maximum number of log files we keep around in log directory.
These files are aged nightly. A setting of 14 means the log
directory will contain about 2 weeks of old log <br>
files, in particular at most the files LOG, LOG.0, LOG.1,
... LOG.13 (except today&rsquo;s LOG, these files will have
a .z extension if compression is on).</p>

<p style="margin-top: 1em">If you decrease this number
after BackupPC has been running for a while you will have to
manually remove the older log files.</p>

<p style="margin-top: 1em">$Conf{DfPath} = &rsquo;&rsquo;;
<br>
Full path to the df command. Security caution: normal users
should not allowed to write to this file or directory.</p>

<p style="margin-top: 1em">$Conf{DfCmd} = &rsquo;$dfPath
$topDir&rsquo;; <br>
Command to run df. The following variables are substituted
at run-time:</p>

<p style="margin-top: 1em">$dfPath path to df
($Conf{DfPath}) <br>
$topDir top-level BackupPC data directory</p>

<p style="margin-top: 1em">Note: all Cmds are executed
directly without a shell, so the prog name needs to be a
full path and you can&rsquo;t include shell syntax like
redirection and pipes; put that in a <br>
script if you need it.</p>

<p style="margin-top: 1em">$Conf{SplitPath} =
&rsquo;&rsquo;; <br>
$Conf{ParPath} = &rsquo;&rsquo;; <br>
$Conf{CatPath} = &rsquo;&rsquo;; <br>
$Conf{GzipPath} = &rsquo;&rsquo;; <br>
$Conf{Bzip2Path} = &rsquo;&rsquo;; <br>
Full path to various commands for archiving</p>

<p style="margin-top: 1em">$Conf{DfMaxUsagePct} = 95; <br>
Maximum threshold for disk utilization on the __TOPDIR__
filesystem. If the output from $Conf{DfPath} reports a
percentage larger than this number then no new regularly
<br>
scheduled backups will be run. However, user requested
backups (which are usually incremental and tend to be small)
are still performed, independent of disk usage. Also, <br>
currently running backups will not be terminated when the
disk usage exceeds this number.</p>

<p style="margin-top: 1em">$Conf{TrashCleanSleepSec} = 300;
<br>
How long BackupPC_trashClean sleeps in seconds between each
check of the trash directory. Once every 5 minutes should be
reasonable.</p>

<p style="margin-top: 1em">$Conf{DHCPAddressRanges} = [];
<br>
List of DHCP address ranges we search looking for PCs to
backup. This is an array of hashes for each class C address
range. This is only needed if hosts in the conf/hosts <br>
file have the dhcp flag set.</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em"># to specify 192.10.10.20 to
192.10.10.250 as the DHCP address pool <br>
$Conf{DHCPAddressRanges} = [ <br>
{ <br>
ipAddrBase =&gt; &rsquo;192.10.10&rsquo;, <br>
first =&gt; 20, <br>
last =&gt; 250, <br>
}, <br>
]; <br>
# to specify two pools (192.10.10.20-250 and
192.10.11.10-50) <br>
$Conf{DHCPAddressRanges} = [ <br>
{ <br>
ipAddrBase =&gt; &rsquo;192.10.10&rsquo;, <br>
first =&gt; 20, <br>
last =&gt; 250, <br>
}, <br>
{ <br>
ipAddrBase =&gt; &rsquo;192.10.11&rsquo;, <br>
first =&gt; 10, <br>
last =&gt; 50, <br>
}, <br>
];</p>

<p style="margin-top: 1em">$Conf{BackupPCUser} =
&rsquo;&rsquo;; <br>
The BackupPC user.</p>

<p style="margin-top: 1em">$Conf{TopDir} = &rsquo;&rsquo;;
<br>
$Conf{ConfDir} = &rsquo;&rsquo;; <br>
$Conf{LogDir} = &rsquo;&rsquo;; <br>
$Conf{InstallDir} = &rsquo;&rsquo;; <br>
$Conf{CgiDir} = &rsquo;&rsquo;; <br>
Important installation directories:</p>

<p style="margin-top: 1em">TopDir - where all the backup
data is stored <br>
ConfDir - where the main config and hosts files resides <br>
LogDir - where log files and other transient information
<br>
InstallDir - where the bin, lib and doc installation dirs
reside. <br>
Note: you cannot change this value since all the <br>
perl scripts include this path. You must reinstall <br>
with configure.pl to change InstallDir. <br>
CgiDir - Apache CGI directory for BackupPC_Admin</p>

<p style="margin-top: 1em">Note: it is STRONGLY recommended
that you don&rsquo;t change the values here. These are set
at installation time and are here for reference and are used
during upgrades.</p>

<p style="margin-top: 1em">Instead of changing TopDir here
it is recommended that you use a symbolic link to the new
location, or mount the new BackupPC store at the existing
$Conf{TopDir} setting.</p>

<p style="margin-top: 1em">$Conf{BackupPCUserVerify} = 1;
<br>
Whether BackupPC and the CGI script BackupPC_Admin verify
that they are really running as user $Conf{BackupPCUser}. If
this flag is set and the effective user id (euid) <br>
differs from $Conf{BackupPCUser} then both scripts exit with
an error. This catches cases where BackupPC might be
accidently started as root or the wrong user, or if the CGI
<br>
script is not installed correctly.</p>

<p style="margin-top: 1em">$Conf{HardLinkMax} = 31999; <br>
Maximum number of hardlinks supported by the $TopDir file
system that BackupPC uses. Most linux or unix file systems
should support at least 32000 hardlinks per file, or <br>
64000 in other cases. If a pool file already has this number
of hardlinks, a new pool file is created so that new
hardlinks can be accommodated. This limit will only be hit
<br>
if an identical file appears at least this number of times
across all the backups.</p>

<p style="margin-top: 1em">$Conf{PerlModuleLoad} = undef;
<br>
Advanced option for asking BackupPC to load additional perl
modules. Can be a list (array ref) of module names to load
at startup.</p>

<p style="margin-top: 1em">$Conf{ServerInitdPath} =
&rsquo;&rsquo;; <br>
$Conf{ServerInitdStartCmd} = &rsquo;&rsquo;; <br>
Path to init.d script and command to use that script to
start the server from the CGI interface. The following
variables are substituted at run-time:</p>

<p style="margin-top: 1em">$sshPath path to ssh
($Conf{SshPath}) <br>
$serverHost same as $Conf{ServerHost} <br>
$serverInitdPath path to init.d script
($Conf{ServerInitdPath})</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">$Conf{ServerInitdPath} =
&rsquo;/etc/init.d/backuppc&rsquo;;
$Conf{ServerInitdStartCmd} = &rsquo;$sshPath -q -x -l root
$serverHost&rsquo; <br>
. &rsquo; $serverInitdPath start&rsquo; <br>
. &rsquo; &lt; /dev/null &gt;&amp; /dev/null&rsquo;;</p>

<p style="margin-top: 1em">Note: all Cmds are executed
directly without a shell, so the prog name needs to be a
full path and you can&rsquo;t include shell syntax like
redirection and pipes; put that in a <br>
script if you need it.</p>

<p style="margin-top: 1em">What to backup and when to do it
<br>
$Conf{FullPeriod} = 6.97; <br>
Minimum period in days between full backups. A full dump
will only be done if at least this much time has elapsed
since the last full dump, and at least $Conf{IncrPeriod}
<br>
days has elapsed since the last successful dump.</p>

<p style="margin-top: 1em">Typically this is set slightly
less than an integer number of days. The time taken for the
backup, plus the granularity of $Conf{WakeupSchedule} will
make the actual backup <br>
interval a bit longer.</p>

<p style="margin-top: 1em">$Conf{IncrPeriod} = 0.97; <br>
Minimum period in days between incremental backups (a user
requested incremental backup will be done anytime on
demand).</p>

<p style="margin-top: 1em">Typically this is set slightly
less than an integer number of days. The time taken for the
backup, plus the granularity of $Conf{WakeupSchedule} will
make the actual backup <br>
interval a bit longer.</p>

<p style="margin-top: 1em">$Conf{FullKeepCnt} = 1; <br>
Number of full backups to keep. Must be &gt;= 1.</p>

<p style="margin-top: 1em">In the steady state, each time a
full backup completes successfully the oldest one is
removed. If this number is decreased, the extra old backups
will be removed.</p>

<p style="margin-top: 1em">If filling of incremental dumps
is off the oldest backup always has to be a full (ie:
filled) dump. This might mean one or two extra full dumps
are kept until the oldest <br>
incremental backups expire.</p>

<p style="margin-top: 1em">Exponential backup expiry is
also supported. This allows you to specify:</p>

<p style="margin-top: 1em">- num fulls to keep at intervals
of 1 * $Conf{FullPeriod}, followed by <br>
- num fulls to keep at intervals of 2 * $Conf{FullPeriod},
<br>
- num fulls to keep at intervals of 4 * $Conf{FullPeriod},
<br>
- num fulls to keep at intervals of 8 * $Conf{FullPeriod},
<br>
- num fulls to keep at intervals of 16 *
$Conf{FullPeriod},</p>

<p style="margin-top: 1em">and so on. This works by
deleting every other full as each expiry boundary is
crossed.</p>

<p style="margin-top: 1em">Exponential expiry is specified
using an array for $Conf{FullKeepCnt}:</p>

<p style="margin-top: 1em">$Conf{FullKeepCnt} = [4, 2,
3];</p>

<p style="margin-top: 1em">Entry #n specifies how many
fulls to keep at an interval of 2^n * $Conf{FullPeriod} (ie:
1, 2, 4, 8, 16, 32, ...).</p>

<p style="margin-top: 1em">The example above specifies
keeping 4 of the most recent full backups (1 week interval)
two full backups at 2 week intervals, and 3 full backups at
4 week intervals, eg:</p>

<p style="margin-top: 1em">full 0 19 weeks old full 1 15
weeks old &gt;--- 3 backups at 4 * $Conf{FullPeriod} <br>
full 2 11 weeks old / <br>
full 3 7 weeks old ____ 2 backups at 2 * $Conf{FullPeriod}
<br>
full 4 5 weeks old / <br>
full 5 3 weeks old full 6 2 weeks old ___ 4 backups at 1 *
$Conf{FullPeriod} <br>
full 7 1 week old / <br>
full 8 current /</p>

<p style="margin-top: 1em">On a given week the spacing
might be less than shown as each backup ages through each
expiry period. For example, one week later, a new full is
completed and the oldest is <br>
deleted, giving:</p>

<p style="margin-top: 1em">full 0 16 weeks old full 1 12
weeks old &gt;--- 3 backups at 4 * $Conf{FullPeriod} <br>
full 2 8 weeks old / <br>
full 3 6 weeks old ____ 2 backups at 2 * $Conf{FullPeriod}
<br>
full 4 4 weeks old / <br>
full 5 3 weeks old full 6 2 weeks old ___ 4 backups at 1 *
$Conf{FullPeriod} <br>
full 7 1 week old / <br>
full 8 current /</p>

<p style="margin-top: 1em">You can specify 0 as a count
(except in the first entry), and the array can be as long as
you wish. For example:</p>

<p style="margin-top: 1em">$Conf{FullKeepCnt} = [4, 0, 4,
0, 0, 2];</p>

<p style="margin-top: 1em">This will keep 10 full dumps, 4
most recent at 1 * $Conf{FullPeriod}, followed by 4 at an
interval of 4 * $Conf{FullPeriod} (approx 1 month apart),
and then 2 at an interval <br>
of 32 * $Conf{FullPeriod} (approx 7-8 months apart).</p>

<p style="margin-top: 1em">Example: these two settings are
equivalent and both keep just the four most recent full
dumps:</p>

<p style="margin-top: 1em">$Conf{FullKeepCnt} = 4; <br>
$Conf{FullKeepCnt} = [4];</p>

<p style="margin-top: 1em">$Conf{FullKeepCntMin} = 1; <br>
$Conf{FullAgeMax} = 90; <br>
Very old full backups are removed after $Conf{FullAgeMax}
days. However, we keep at least $Conf{FullKeepCntMin} full
backups no matter how old they are.</p>

<p style="margin-top: 1em">Note that $Conf{FullAgeMax} will
be increased to $Conf{FullKeepCnt} times $Conf{FullPeriod}
if $Conf{FullKeepCnt} specifies enough full backups to
exceed $Conf{FullAgeMax}.</p>

<p style="margin-top: 1em">$Conf{IncrKeepCnt} = 6; <br>
Number of incremental backups to keep. Must be &gt;= 1.</p>

<p style="margin-top: 1em">In the steady state, each time
an incr backup completes successfully the oldest one is
removed. If this number is decreased, the extra old backups
will be removed.</p>

<p style="margin-top: 1em">$Conf{IncrKeepCntMin} = 1; <br>
$Conf{IncrAgeMax} = 30; <br>
Very old incremental backups are removed after
$Conf{IncrAgeMax} days. However, we keep at least
$Conf{IncrKeepCntMin} incremental backups no matter how old
they are.</p>

<p style="margin-top: 1em">$Conf{IncrLevels} = [1]; <br>
Level of each incremental. &quot;Level&quot; follows the
terminology of dump(1). A full backup has level 0. A new
incremental of level N will backup all files that have
changed <br>
since the most recent backup of a lower level.</p>

<p style="margin-top: 1em">The entries of $Conf{IncrLevels}
apply in order to each incremental after each full backup.
It wraps around until the next full backup. For example,
these two settings have <br>
the same effect:</p>

<p style="margin-top: 1em">$Conf{IncrLevels} = [1, 2, 3];
<br>
$Conf{IncrLevels} = [1, 2, 3, 1, 2, 3];</p>

<p style="margin-top: 1em">This means the 1st and 4th
incrementals (level 1) go all the way back to the full. The
2nd and 3rd (and 5th and 6th) backups just go back to the
immediate preceeding <br>
incremental.</p>

<p style="margin-top: 1em">Specifying a sequence of
multi-level incrementals will usually mean more than
$Conf{IncrKeepCnt} incrementals will need to be kept, since
lower level incrementals are needed <br>
to merge a complete view of a backup. For example, with</p>

<p style="margin-top: 1em">$Conf{FullPeriod} = 7; <br>
$Conf{IncrPeriod} = 1; <br>
$Conf{IncrKeepCnt} = 6; <br>
$Conf{IncrLevels} = [1, 2, 3, 4, 5, 6];</p>

<p style="margin-top: 1em">there will be up to 11
incrementals in this case:</p>

<p style="margin-top: 1em">backup #0 (full, level 0,
oldest) <br>
backup #1 (incr, level 1) <br>
backup #2 (incr, level 2) <br>
backup #3 (incr, level 3) <br>
backup #4 (incr, level 4) <br>
backup #5 (incr, level 5) <br>
backup #6 (incr, level 6) <br>
backup #7 (full, level 0) <br>
backup #8 (incr, level 1) <br>
backup #9 (incr, level 2) <br>
backup #10 (incr, level 3) <br>
backup #11 (incr, level 4) <br>
backup #12 (incr, level 5, newest)</p>

<p style="margin-top: 1em">Backup #1 (the oldest level 1
incremental) can&rsquo;t be deleted since backups 2..6
depend on it. Those 6 incrementals can&rsquo;t all be
deleted since that would only leave 5 <br>
(#8..12). When the next incremental happens (level 6), the
complete set of 6 older incrementals (#1..6) will be
deleted, since that maintains the required number <br>
($Conf{IncrKeepCnt}) of incrementals. This situation is
reduced if you set shorter chains of multi-level
incrementals, eg:</p>

<p style="margin-top: 1em">$Conf{IncrLevels} = [1, 2,
3];</p>

<p style="margin-top: 1em">would only have up to 2 extra
incremenals before all 3 are deleted.</p>

<p style="margin-top: 1em">BackupPC as usual merges the
full and the sequence of incrementals together so each
incremental can be browsed and restored as though it is a
complete backup. If you specify <br>
a long chain of incrementals then more backups need to be
merged when browsing, restoring, or getting the starting
point for rsync backups. In the example above (levels <br>
1..6), browing backup #6 requires 7 different backups
(#0..6) to be merged.</p>

<p style="margin-top: 1em">Because of this merging and the
additional incrementals that need to be kept, it is
recommended that some level 1 incrementals be included in
$Conf{IncrLevels}.</p>

<p style="margin-top: 1em">Prior to version 3.0
incrementals were always level 1, meaning each incremental
backed up all the files that changed since the last
full.</p>

<p style="margin-top: 1em">$Conf{BackupsDisable} = 0; <br>
Disable all full and incremental backups. These settings are
useful for a client that is no longer being backed up (eg: a
retired machine), but you wish to keep the last <br>
backups available for browsing or restoring to other
machines.</p>

<p style="margin-top: 1em">There are three values for
$Conf{BackupsDisable}:</p>

<p style="margin-top: 1em">0 Backups are enabled.</p>

<p style="margin-top: 1em">1 Don&rsquo;t do any regular
backups on this client. Manually <br>
requested backups (via the CGI interface) will still
occur.</p>

<p style="margin-top: 1em">2 Don&rsquo;t do any backups on
this client. Manually requested <br>
backups (via the CGI interface) will be ignored.</p>

<p style="margin-top: 1em">In versions prior to 3.0 Backups
were disabled by setting $Conf{FullPeriod} to -1 or -2.</p>

<p style="margin-top: 1em">$Conf{PartialAgeMax} = 3; <br>
A failed full backup is saved as a partial backup. The rsync
XferMethod can take advantage of the partial full when the
next backup is run. This parameter sets the age of <br>
the partial full in days: if the partial backup is older
than this number of days, then rsync will ignore (not use)
the partial full when the next backup is run. If you set
<br>
this to a negative value then no partials will be saved. If
you set this to 0, partials will be saved, but will not be
used by the next backup.</p>

<p style="margin-top: 1em">The default setting of 3 days
means that a partial older than 3 days is ignored when the
next full backup is done.</p>

<p style="margin-top: 1em">$Conf{IncrFill} = 0; <br>
Whether incremental backups are filled. &quot;Filling&quot;
means that the most recent full (or filled) dump is merged
into the new incremental dump using hardlinks. This makes an
<br>
incremental dump look like a full dump. Prior to v1.03 all
incremental backups were filled. In v1.4.0 and later the
default is off.</p>

<p style="margin-top: 1em">BackupPC, and the cgi interface
in particular, do the right thing on un-filled incremental
backups. It will correctly display the merged incremental
backup with the most <br>
recent filled backup, giving the un-filled incremental
backups a filled appearance. That means it invisible to the
user whether incremental dumps are filled or not.</p>

<p style="margin-top: 1em">Filling backups takes a little
extra disk space, and it does cost some extra disk activity
for filling, and later removal. Filling is no longer useful,
since file mangling <br>
and compression doesn&rsquo;t make a filled backup very
useful. It&rsquo;s likely the filling option will be removed
from future versions: filling will be delegated to the
display and <br>
extraction of backup data.</p>

<p style="margin-top: 1em">If filling is off, BackupPC
makes sure that the oldest backup is a full, otherwise the
following incremental backups will be incomplete. This might
mean an extra full backup <br>
has to be kept until the following incremental backups
expire.</p>

<p style="margin-top: 1em">The default is off. You can turn
this on or off at any time without affecting existing
backups.</p>

<p style="margin-top: 1em">$Conf{RestoreInfoKeepCnt} = 10;
<br>
Number of restore logs to keep. BackupPC remembers
information about each restore request. This number per
client will be kept around before the oldest ones are
pruned.</p>

<p style="margin-top: 1em">Note: files/dirs delivered via
Zip or Tar downloads don&rsquo;t count as restores. Only the
first restore option (where the files and dirs are written
to the host) count as <br>
restores that are logged.</p>

<p style="margin-top: 1em">$Conf{ArchiveInfoKeepCnt} = 10;
<br>
Number of archive logs to keep. BackupPC remembers
information about each archive request. This number per
archive client will be kept around before the oldest ones
are <br>
pruned.</p>

<p style="margin-top: 1em">$Conf{BackupFilesOnly} = undef;
<br>
List of directories or files to backup. If this is defined,
only these directories or files will be backed up.</p>

<p style="margin-top: 1em">When editing from the web
interface, you should add a valid ShareName (based on
$Conf{XferMethod}), and then enter the directories specific
to that ShareName. A special <br>
ShareName &quot;*&quot; matches any ShareName that
doesn&rsquo;t have an explicit entry.</p>

<p style="margin-top: 1em">For Smb, only one of
$Conf{BackupFilesExclude} and $Conf{BackupFilesOnly} can be
specified per share. If both are set for a particular share,
then $Conf{BackupFilesOnly} <br>
takes precedence and $Conf{BackupFilesExclude} is
ignored.</p>

<p style="margin-top: 1em">This can be set to a string, an
array of strings, or, in the case of multiple shares, a hash
of strings or arrays. A hash is used to give a list of
directories or files to <br>
backup for each share (the share name is the key). If this
is set to just a string or array, and $Conf{SmbShareName}
contains multiple share names, then the setting is <br>
assumed to apply all shares.</p>

<p style="margin-top: 1em">If a hash is used, a special key
&quot;*&quot; means it applies to all shares that
don&rsquo;t have a specific entry.</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">$Conf{BackupFilesOnly} =
&rsquo;/myFiles&rsquo;; <br>
$Conf{BackupFilesOnly} = [&rsquo;/myFiles&rsquo;]; # same as
first example <br>
$Conf{BackupFilesOnly} = [&rsquo;/myFiles&rsquo;,
&rsquo;/important&rsquo;]; <br>
$Conf{BackupFilesOnly} = { <br>
&rsquo;c&rsquo; =&gt; [&rsquo;/myFiles&rsquo;,
&rsquo;/important&rsquo;], # these are for &rsquo;c&rsquo;
share <br>
&rsquo;d&rsquo; =&gt; [&rsquo;/moreFiles&rsquo;,
&rsquo;/archive&rsquo;], # these are for &rsquo;d&rsquo;
share <br>
}; <br>
$Conf{BackupFilesOnly} = { <br>
&rsquo;c&rsquo; =&gt; [&rsquo;/myFiles&rsquo;,
&rsquo;/important&rsquo;], # these are for &rsquo;c&rsquo;
share <br>
&rsquo;*&rsquo; =&gt; [&rsquo;/myFiles&rsquo;,
&rsquo;/important&rsquo;], # these are other shares <br>
};</p>

<p style="margin-top: 1em">$Conf{BackupFilesExclude} =
undef; <br>
List of directories or files to exclude from the backup. For
Smb, only one of $Conf{BackupFilesExclude} and
$Conf{BackupFilesOnly} can be specified per share. If both
are <br>
set for a particular share, then $Conf{BackupFilesOnly}
takes precedence and $Conf{BackupFilesExclude} is
ignored.</p>

<p style="margin-top: 1em">When editing from the web
interface, you should add a valid ShareName (based on
$Conf{XferMethod}), and then enter the directories or files
specific to that ShareName. A <br>
special ShareName &quot;*&quot; matches any ShareName that
doesn&rsquo;t have an explicit entry.</p>

<p style="margin-top: 1em">This can be set to a string, an
array of strings, or, in the case of multiple shares, a hash
of strings or arrays. A hash is used to give a list of
directories or files to <br>
exclude for each share (the share name is the key). If this
is set to just a string or array, and $Conf{SmbShareName}
contains multiple share names, then the setting is <br>
assumed to apply to all shares.</p>

<p style="margin-top: 1em">The exact behavior is determined
by the underlying transport program, smbclient or tar. For
smbclient the exlclude file list is passed into the X
option. Simple shell wild- <br>
cards using &quot;*&quot; or &quot;?&quot; are allowed.</p>

<p style="margin-top: 1em">For tar, if the exclude file
contains a &quot;/&quot; it is assumed to be anchored at the
start of the string. Since all the tar paths start with
&quot;./&quot;, BackupPC prepends a &quot;.&quot; if the
<br>
exclude file starts with a &quot;/&quot;. Note that GNU tar
version &gt;= 1.13.7 is required for the exclude option to
work correctly. For linux or unix machines you should add
&quot;/proc&quot; <br>
to $Conf{BackupFilesExclude} unless you have specified
--one-file-system in $Conf{TarClientCmd} or
--one-file-system in $Conf{RsyncArgs}. Also, for tar, do not
use a <br>
trailing &quot;/&quot; in the directory name: a trailing
&quot;/&quot; causes the name to not match and the directory
will not be excluded.</p>

<p style="margin-top: 1em">Users report that for smbclient
you should specify a directory followed by &quot;/*&quot;,
eg: &quot;/proc/*&quot;, instead of just
&quot;/proc&quot;.</p>

<p style="margin-top: 1em">FTP servers are traversed
recursively so excluding directories will also exclude its
contents. You can use the wildcard characters &quot;*&quot;
and &quot;?&quot; to define files for inclusion <br>
and exclusion. Both attributes $Conf{BackupFilesOnly} and
$Conf{BackupFilesExclude} can be defined for the same
share.</p>

<p style="margin-top: 1em">If a hash is used, a special key
&quot;*&quot; means it applies to all shares that
don&rsquo;t have a specific entry.</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">$Conf{BackupFilesExclude} =
&rsquo;/temp&rsquo;; <br>
$Conf{BackupFilesExclude} = [&rsquo;/temp&rsquo;]; # same as
first example <br>
$Conf{BackupFilesExclude} = [&rsquo;/temp&rsquo;,
&rsquo;/winnt/tmp&rsquo;]; <br>
$Conf{BackupFilesExclude} = { <br>
&rsquo;c&rsquo; =&gt; [&rsquo;/temp&rsquo;,
&rsquo;/winnt/tmp&rsquo;], # these are for &rsquo;c&rsquo;
share <br>
&rsquo;d&rsquo; =&gt; [&rsquo;/junk&rsquo;,
&rsquo;/dont_back_this_up&rsquo;], # these are for
&rsquo;d&rsquo; share <br>
}; <br>
$Conf{BackupFilesExclude} = { <br>
&rsquo;c&rsquo; =&gt; [&rsquo;/temp&rsquo;,
&rsquo;/winnt/tmp&rsquo;], # these are for &rsquo;c&rsquo;
share <br>
&rsquo;*&rsquo; =&gt; [&rsquo;/junk&rsquo;,
&rsquo;/dont_back_this_up&rsquo;], # these are for other
shares <br>
};</p>

<p style="margin-top: 1em">$Conf{BlackoutBadPingLimit} = 3;
<br>
$Conf{BlackoutGoodCnt} = 7; <br>
PCs that are always or often on the network can be backed up
after hours, to reduce PC, network and server load during
working hours. For each PC a count of consecutive good <br>
pings is maintained. Once a PC has at least
$Conf{BlackoutGoodCnt} consecutive good pings it is subject
to &quot;blackout&quot; and not backed up during hours and
days specified by <br>
$Conf{BlackoutPeriods}.</p>

<p style="margin-top: 1em">To allow for periodic rebooting
of a PC or other brief periods when a PC is not on the
network, a number of consecutive bad pings is allowed before
the good ping count is <br>
reset. This parameter is $Conf{BlackoutBadPingLimit}.</p>

<p style="margin-top: 1em">Note that bad and good pings
don&rsquo;t occur with the same interval. If a machine is
always on the network, it will only be pinged roughly once
every $Conf{IncrPeriod} (eg: once <br>
per day). So a setting for $Conf{BlackoutGoodCnt} of 7 means
it will take around 7 days for a machine to be subject to
blackout. On the other hand, if a ping is failed, it <br>
will be retried roughly every time BackupPC wakes up, eg,
every one or two hours. So a setting for
$Conf{BlackoutBadPingLimit} of 3 means that the PC will lose
its blackout <br>
status after 3-6 hours of unavailability.</p>

<p style="margin-top: 1em">To disable the blackout feature
set $Conf{BlackoutGoodCnt} to a negative value. A value of 0
will make all machines subject to blackout. But if you
don&rsquo;t want to do any <br>
backups during the day it would be easier to just set
$Conf{WakeupSchedule} to a restricted schedule.</p>

<p style="margin-top: 1em">$Conf{BlackoutPeriods} = [ ...
]; <br>
One or more blackout periods can be specified. If a client
is subject to blackout then no regular (non-manual) backups
will be started during any of these periods. <br>
hourBegin and hourEnd specify hours fro midnight and
weekDays is a list of days of the week where 0 is Sunday, 1
is Monday etc.</p>

<p style="margin-top: 1em">For example:</p>

<p style="margin-top: 1em">$Conf{BlackoutPeriods} = [ <br>
{ <br>
hourBegin =&gt; 7.0, <br>
hourEnd =&gt; 19.5, <br>
weekDays =&gt; [1, 2, 3, 4, 5], <br>
}, <br>
];</p>

<p style="margin-top: 1em">specifies one blackout period
from 7:00am to 7:30pm local time on Mon-Fri.</p>

<p style="margin-top: 1em">The blackout period can also
span midnight by setting hourBegin &gt; hourEnd, eg:</p>

<p style="margin-top: 1em">$Conf{BlackoutPeriods} = [ <br>
{ <br>
hourBegin =&gt; 7.0, <br>
hourEnd =&gt; 19.5, <br>
weekDays =&gt; [1, 2, 3, 4, 5], <br>
}, <br>
{ <br>
hourBegin =&gt; 23, <br>
hourEnd =&gt; 5, <br>
weekDays =&gt; [5, 6], <br>
}, <br>
];</p>

<p style="margin-top: 1em">This specifies one blackout
period from 7:00am to 7:30pm local time on Mon-Fri, and a
second period from 11pm to 5am on Friday and Saturday
night.</p>

<p style="margin-top: 1em">$Conf{BackupZeroFilesIsFatal} =
1; <br>
A backup of a share that has zero files is considered fatal.
This is used to catch miscellaneous Xfer errors that result
in no files being backed up. If you have shares that <br>
might be empty (and therefore an empty backup is valid) you
should set this flag to 0.</p>

<p style="margin-top: 1em">How to backup a client <br>
$Conf{XferMethod} = &rsquo;smb&rsquo;; <br>
What transport method to use to backup each host. If you
have a mixed set of WinXX and linux/unix hosts you will need
to override this in the per-PC config.pl.</p>

<p style="margin-top: 1em">The valid values are:</p>

<p style="margin-top: 1em">- &rsquo;smb&rsquo;: backup and
restore via smbclient and the SMB protocol. <br>
Easiest choice for WinXX.</p>

<p style="margin-top: 1em">- &rsquo;rsync&rsquo;: backup
and restore via rsync (via rsh or ssh). <br>
Best choice for linux/unix. Good choice also for WinXX.</p>

<p style="margin-top: 1em">- &rsquo;rsyncd&rsquo;: backup
and restore via rsync daemon on the client. <br>
Best choice for linux/unix if you have rsyncd running on
<br>
the client. Good choice also for WinXX.</p>

<p style="margin-top: 1em">- &rsquo;tar&rsquo;: backup and
restore via tar, tar over ssh, rsh or nfs. <br>
Good choice for linux/unix.</p>

<p style="margin-top: 1em">- &rsquo;archive&rsquo;: host is
a special archive host. Backups are not done. <br>
An archive host is used to archive other host&rsquo;s
backups <br>
to permanent media, such as tape, CDR or DVD.</p>

<p style="margin-top: 1em">$Conf{XferLogLevel} = 1; <br>
Level of verbosity in Xfer log files. 0 means be quiet, 1
will give will give one line per file, 2 will also show
skipped files on incrementals, higher values give more <br>
output.</p>

<p style="margin-top: 1em">$Conf{ClientCharset} =
&rsquo;&rsquo;; <br>
Filename charset encoding on the client. BackupPC uses utf8
on the server for filename encoding. If this is empty, then
utf8 is assumed and client filenames will not be <br>
modified. If set to a different encoding then filenames will
converted to/from utf8 automatically during backup and
restore.</p>

<p style="margin-top: 1em">If the file names displayed in
the browser (eg: accents or special characters) don&rsquo;t
look right then it is likely you haven&rsquo;t set
$Conf{ClientCharset} correctly.</p>

<p style="margin-top: 1em">If you are using smbclient on a
WinXX machine, smbclient will convert to the &quot;unix
charset&quot; setting in smb.conf. The default is utf8, in
which case leave <br>
$Conf{ClientCharset} empty since smbclient does the right
conversion.</p>

<p style="margin-top: 1em">If you are using rsync on a
WinXX machine then it does no conversion. A typical WinXX
encoding for latin1/western europe is &rsquo;cp1252&rsquo;,
so in this case set <br>
$Conf{ClientCharset} to &rsquo;cp1252&rsquo;.</p>

<p style="margin-top: 1em">On a linux or unix client, run
&quot;locale charmap&quot; to see the client&rsquo;s
charset. Set $Conf{ClientCharset} to this value. A typical
value for english/US is &rsquo;ISO-8859-1&rsquo;.</p>

<p style="margin-top: 1em">Do &quot;perldoc
Encode::Supported&quot; to see the list of possible charset
values. The FAQ at
http://www.cl.cam.ac.uk/~mgk25/unicode.html is excellent,
and <br>
http://czyborra.com/charsets/iso8859.html provides more
information on the iso-8859 charsets.</p>

<p style="margin-top: 1em">$Conf{ClientCharsetLegacy} =
&rsquo;iso-8859-1&rsquo;; <br>
Prior to 3.x no charset conversion was done by BackupPC.
Backups were stored in what ever charset the XferMethod
provided - typically utf8 for smbclient and the
client&rsquo;s <br>
locale settings for rsync and tar (eg: cp1252 for rsync on
WinXX and perhaps iso-8859-1 with rsync on linux). This
setting tells BackupPC the charset that was used to store
<br>
file names in old backups taken with BackupPC 2.x, so that
non-ascii file names in old backups can be viewed and
restored.</p>

<p style="margin-top: 1em">Samba Configuration <br>
$Conf{SmbShareName} = &rsquo;C$&rsquo;; <br>
Name of the host share that is backed up when using SMB.
This can be a string or an array of strings if there are
multiple shares per host. Examples:</p>

<p style="margin-top: 1em">$Conf{SmbShareName} =
&rsquo;c&rsquo;; # backup &rsquo;c&rsquo; share <br>
$Conf{SmbShareName} = [&rsquo;c&rsquo;, &rsquo;d&rsquo;]; #
backup &rsquo;c&rsquo; and &rsquo;d&rsquo; shares</p>

<p style="margin-top: 1em">This setting only matters if
$Conf{XferMethod} = &rsquo;smb&rsquo;.</p>

<p style="margin-top: 1em">$Conf{SmbShareUserName} =
&rsquo;&rsquo;; <br>
Smbclient share user name. This is passed to
smbclient&rsquo;s -U argument.</p>

<p style="margin-top: 1em">This setting only matters if
$Conf{XferMethod} = &rsquo;smb&rsquo;.</p>

<p style="margin-top: 1em">$Conf{SmbSharePasswd} =
&rsquo;&rsquo;; <br>
Smbclient share password. This is passed to smbclient via
its PASSWD environment variable. There are several ways you
can tell BackupPC the smb share password. In each <br>
case you should be very careful about security. If you put
the password here, make sure that this file is not readable
by regular users! See the &quot;Setting up config.pl&quot;
<br>
section in the documentation for more information.</p>

<p style="margin-top: 1em">This setting only matters if
$Conf{XferMethod} = &rsquo;smb&rsquo;.</p>

<p style="margin-top: 1em">$Conf{SmbClientPath} =
&rsquo;&rsquo;; <br>
Full path for smbclient. Security caution: normal users
should not allowed to write to this file or directory.</p>

<p style="margin-top: 1em">smbclient is from the Samba
distribution. smbclient is used to actually extract the
incremental or full dump of the share filesystem from the
PC.</p>

<p style="margin-top: 1em">This setting only matters if
$Conf{XferMethod} = &rsquo;smb&rsquo;.</p>

<p style="margin-top: 1em">$Conf{SmbClientFullCmd} =
&rsquo;$smbClientPath \\$host\$shareName&rsquo; ... <br>
Command to run smbclient for a full dump. This setting only
matters if $Conf{XferMethod} = &rsquo;smb&rsquo;.</p>

<p style="margin-top: 1em">The following variables are
substituted at run-time:</p>

<p style="margin-top: 1em">$smbClientPath same as
$Conf{SmbClientPath} <br>
$host host to backup/restore <br>
$hostIP host IP address <br>
$shareName share name <br>
$userName user name <br>
$fileList list of files to backup (based on exclude/include)
<br>
$I_option optional -I option to smbclient <br>
$X_option exclude option (if $fileList is an exclude list)
<br>
$timeStampFile start time for incremental dump</p>

<p style="margin-top: 1em">Note: all Cmds are executed
directly without a shell, so the prog name needs to be a
full path and you can&rsquo;t include shell syntax like
redirection and pipes; put that in a <br>
script if you need it.</p>

<p style="margin-top: 1em">$Conf{SmbClientIncrCmd} =
&rsquo;$smbClientPath \\$host\$shareName&rsquo; ... <br>
Command to run smbclient for an incremental dump. This
setting only matters if $Conf{XferMethod} =
&rsquo;smb&rsquo;.</p>

<p style="margin-top: 1em">Same variable substitutions are
applied as $Conf{SmbClientFullCmd}.</p>

<p style="margin-top: 1em">Note: all Cmds are executed
directly without a shell, so the prog name needs to be a
full path and you can&rsquo;t include shell syntax like
redirection and pipes; put that in a <br>
script if you need it.</p>

<p style="margin-top: 1em">$Conf{SmbClientRestoreCmd} =
&rsquo;$smbClientPath \\$host\$shareName&rsquo; ... <br>
Command to run smbclient for a restore. This setting only
matters if $Conf{XferMethod} = &rsquo;smb&rsquo;.</p>

<p style="margin-top: 1em">Same variable substitutions are
applied as $Conf{SmbClientFullCmd}.</p>

<p style="margin-top: 1em">If your smb share is read-only
then direct restores will fail. You should set
$Conf{SmbClientRestoreCmd} to undef and the corresponding
CGI restore option will be removed.</p>

<p style="margin-top: 1em">Note: all Cmds are executed
directly without a shell, so the prog name needs to be a
full path and you can&rsquo;t include shell syntax like
redirection and pipes; put that in a <br>
script if you need it.</p>

<p style="margin-top: 1em">Tar Configuration <br>
$Conf{TarShareName} = &rsquo;/&rsquo;; <br>
Which host directories to backup when using tar transport.
This can be a string or an array of strings if there are
multiple directories to backup per host. Examples:</p>

<p style="margin-top: 1em">$Conf{TarShareName} =
&rsquo;/&rsquo;; # backup everything <br>
$Conf{TarShareName} = &rsquo;/home&rsquo;; # only backup
/home <br>
$Conf{TarShareName} = [&rsquo;/home&rsquo;,
&rsquo;/src&rsquo;]; # backup /home and /src</p>

<p style="margin-top: 1em">The fact this parameter is
called &rsquo;TarShareName&rsquo; is for historical
consistency with the Smb transport options. You can use any
valid directory on the client: there is no <br>
need for it to correspond to any Smb share or device mount
point.</p>

<p style="margin-top: 1em">Note also that you can also use
$Conf{BackupFilesOnly} to specify a specific list of
directories to backup. It&rsquo;s more efficient to use this
option instead of <br>
$Conf{TarShareName} since a new tar is run for each entry in
$Conf{TarShareName}.</p>

<p style="margin-top: 1em">On the other hand, if you add
--one-file-system to $Conf{TarClientCmd} you can backup each
file system separately, which makes restoring one bad file
system easier. In this <br>
case you would list all of the mount points here, since you
can&rsquo;t get the same result with
$Conf{BackupFilesOnly}:</p>

<p style="margin-top: 1em">$Conf{TarShareName} =
[&rsquo;/&rsquo;, &rsquo;/var&rsquo;, &rsquo;/data&rsquo;,
&rsquo;/boot&rsquo;];</p>

<p style="margin-top: 1em">This setting only matters if
$Conf{XferMethod} = &rsquo;tar&rsquo;.</p>

<p style="margin-top: 1em">$Conf{TarClientCmd} =
&rsquo;$sshPath -q -x -n -l root $host&rsquo; ... <br>
Command to run tar on the client. GNU tar is required. You
will need to fill in the correct paths for ssh2 on the local
host (server) and GNU tar on the client. Security <br>
caution: normal users should not allowed to write to these
executable files or directories.</p>

<p style="margin-top: 1em">$Conf{TarClientCmd} is appended
with with either $Conf{TarFullArgs} or $Conf{TarIncrArgs} to
create the final command that is run.</p>

<p style="margin-top: 1em">See the documentation for more
information about setting up ssh2 keys.</p>

<p style="margin-top: 1em">If you plan to use NFS then tar
just runs locally and ssh2 is not needed. For example,
assuming the client filesystem is mounted below
/mnt/hostName, you could use something <br>
like:</p>

<p style="margin-top: 1em">$Conf{TarClientCmd} =
&rsquo;$tarPath -c -v -f - -C /mnt/$host/$shareName&rsquo;
<br>
. &rsquo; --totals&rsquo;;</p>

<p style="margin-top: 1em">In the case of NFS or rsh you
need to make sure BackupPC&rsquo;s privileges are sufficient
to read all the files you want to backup. Also, you will
probably want to add &quot;/proc&quot; to <br>
$Conf{BackupFilesExclude}.</p>

<p style="margin-top: 1em">The following variables are
substituted at run-time:</p>

<p style="margin-top: 1em">$host host name <br>
$hostIP host&rsquo;s IP address <br>
$incrDate newer-than date for incremental backups <br>
$shareName share name to backup (ie: top-level directory
path) <br>
$fileList specific files to backup or exclude <br>
$tarPath same as $Conf{TarClientPath} <br>
$sshPath same as $Conf{SshPath}</p>

<p style="margin-top: 1em">If a variable is followed by a
&quot;+&quot; it is shell escaped. This is necessary for the
command part of ssh or rsh, since it ends up getting passed
through the shell.</p>

<p style="margin-top: 1em">This setting only matters if
$Conf{XferMethod} = &rsquo;tar&rsquo;.</p>

<p style="margin-top: 1em">Note: all Cmds are executed
directly without a shell, so the prog name needs to be a
full path and you can&rsquo;t include shell syntax like
redirection and pipes; put that in a <br>
script if you need it.</p>

<p style="margin-top: 1em">$Conf{TarFullArgs} =
&rsquo;$fileList+&rsquo;; <br>
Extra tar arguments for full backups. Several variables are
substituted at run-time. See $Conf{TarClientCmd} for the
list of variable substitutions.</p>

<p style="margin-top: 1em">If you are running tar locally
(ie: without rsh or ssh) then remove the &quot;+&quot; so
that the argument is no longer shell escaped.</p>

<p style="margin-top: 1em">This setting only matters if
$Conf{XferMethod} = &rsquo;tar&rsquo;.</p>

<p style="margin-top: 1em">$Conf{TarIncrArgs} =
&rsquo;--newer=$incrDate+ $fileList+&rsquo;; <br>
Extra tar arguments for incr backups. Several variables are
substituted at run-time. See $Conf{TarClientCmd} for the
list of variable substitutions.</p>

<p style="margin-top: 1em">Note that GNU tar has several
methods for specifying incremental backups, including:</p>

<p style="margin-top: 1em">--newer-mtime $incrDate+ <br>
This causes a file to be included if the modification time
is <br>
later than $incrDate (meaning its contents might have
changed). <br>
But changes in the ownership or modes will not qualify the
<br>
file to be included in an incremental.</p>

<p style="margin-top: 1em">--newer=$incrDate+ <br>
This causes the file to be included if any attribute of the
<br>
file is later than $incrDate, meaning either attributes or
<br>
the modification time. This is the default method. Do <br>
not use --atime-preserve in $Conf{TarClientCmd} above, <br>
otherwise resetting the atime (access time) counts as an
<br>
attribute change, meaning the file will always be included
<br>
in each new incremental dump.</p>

<p style="margin-top: 1em">If you are running tar locally
(ie: without rsh or ssh) then remove the &quot;+&quot; so
that the argument is no longer shell escaped.</p>

<p style="margin-top: 1em">This setting only matters if
$Conf{XferMethod} = &rsquo;tar&rsquo;.</p>

<p style="margin-top: 1em">$Conf{TarClientRestoreCmd} =
&rsquo;$sshPath -q -x -l root $host&rsquo; ... <br>
Full command to run tar for restore on the client. GNU tar
is required. This can be the same as $Conf{TarClientCmd},
with tar&rsquo;s -c replaced by -x and ssh&rsquo;s -n
removed.</p>

<p style="margin-top: 1em">See $Conf{TarClientCmd} for full
details.</p>

<p style="margin-top: 1em">This setting only matters if
$Conf{XferMethod} = &quot;tar&quot;.</p>

<p style="margin-top: 1em">If you want to disable direct
restores using tar, you should set
$Conf{TarClientRestoreCmd} to undef and the corresponding
CGI restore option will be removed.</p>

<p style="margin-top: 1em">Note: all Cmds are executed
directly without a shell, so the prog name needs to be a
full path and you can&rsquo;t include shell syntax like
redirection and pipes; put that in a <br>
script if you need it.</p>

<p style="margin-top: 1em">$Conf{TarClientPath} =
&rsquo;&rsquo;; <br>
Full path for tar on the client. Security caution: normal
users should not allowed to write to this file or
directory.</p>

<p style="margin-top: 1em">This setting only matters if
$Conf{XferMethod} = &rsquo;tar&rsquo;.</p>

<p style="margin-top: 1em">Rsync/Rsyncd Configuration <br>
$Conf{RsyncClientPath} = &rsquo;&rsquo;; <br>
Path to rsync executable on the client</p>

<p style="margin-top: 1em">$Conf{RsyncClientCmd} =
&rsquo;$sshPath -q -x -l root $host $rsyncPath
$argList+&rsquo;; <br>
Full command to run rsync on the client machine. The
following variables are substituted at run-time:</p>

<p style="margin-top: 1em">$host host name being backed up
<br>
$hostIP host&rsquo;s IP address <br>
$shareName share name to backup (ie: top-level directory
path) <br>
$rsyncPath same as $Conf{RsyncClientPath} <br>
$sshPath same as $Conf{SshPath} <br>
$argList argument list, built from $Conf{RsyncArgs}, <br>
$shareName, $Conf{BackupFilesExclude} and <br>
$Conf{BackupFilesOnly}</p>

<p style="margin-top: 1em">This setting only matters if
$Conf{XferMethod} = &rsquo;rsync&rsquo;.</p>

<p style="margin-top: 1em">$Conf{RsyncClientRestoreCmd} =
&rsquo;$sshPath -q -x -l root $host $rsyncPath
$argList+&rsquo;; <br>
Full command to run rsync for restore on the client. The
following variables are substituted at run-time:</p>

<p style="margin-top: 1em">$host host name being backed up
<br>
$hostIP host&rsquo;s IP address <br>
$shareName share name to backup (ie: top-level directory
path) <br>
$rsyncPath same as $Conf{RsyncClientPath} <br>
$sshPath same as $Conf{SshPath} <br>
$argList argument list, built from $Conf{RsyncArgs}, <br>
$shareName, $Conf{BackupFilesExclude} and <br>
$Conf{BackupFilesOnly}</p>

<p style="margin-top: 1em">This setting only matters if
$Conf{XferMethod} = &rsquo;rsync&rsquo;.</p>

<p style="margin-top: 1em">Note: all Cmds are executed
directly without a shell, so the prog name needs to be a
full path and you can&rsquo;t include shell syntax like
redirection and pipes; put that in a <br>
script if you need it.</p>

<p style="margin-top: 1em">$Conf{RsyncShareName} =
&rsquo;/&rsquo;; <br>
Share name to backup. For $Conf{XferMethod} =
&quot;rsync&quot; this should be a file system path, eg
&rsquo;/&rsquo; or &rsquo;/home&rsquo;.</p>

<p style="margin-top: 1em">For $Conf{XferMethod} =
&quot;rsyncd&quot; this should be the name of the module to
backup (ie: the name from /etc/rsynd.conf).</p>

<p style="margin-top: 1em">This can also be a list of
multiple file system paths or modules. For example, by
adding --one-file-system to $Conf{RsyncArgs} you can backup
each file system separately, <br>
which makes restoring one bad file system easier. In this
case you would list all of the mount points:</p>

<p style="margin-top: 1em">$Conf{RsyncShareName} =
[&rsquo;/&rsquo;, &rsquo;/var&rsquo;, &rsquo;/data&rsquo;,
&rsquo;/boot&rsquo;];</p>

<p style="margin-top: 1em">$Conf{RsyncdClientPort} = 873;
<br>
Rsync daemon port on the client, for $Conf{XferMethod} =
&quot;rsyncd&quot;.</p>

<p style="margin-top: 1em">$Conf{RsyncdUserName} =
&rsquo;&rsquo;; <br>
Rsync daemon user name on client, for $Conf{XferMethod} =
&quot;rsyncd&quot;. The user name and password are stored on
the client in whatever file the &quot;secrets file&quot;
parameter in <br>
rsyncd.conf points to (eg: /etc/rsyncd.secrets).</p>

<p style="margin-top: 1em">$Conf{RsyncdPasswd} =
&rsquo;&rsquo;; <br>
Rsync daemon user name on client, for $Conf{XferMethod} =
&quot;rsyncd&quot;. The user name and password are stored on
the client in whatever file the &quot;secrets file&quot;
parameter in <br>
rsyncd.conf points to (eg: /etc/rsyncd.secrets).</p>

<p style="margin-top: 1em">$Conf{RsyncdAuthRequired} = 1;
<br>
Whether authentication is mandatory when connecting to the
client&rsquo;s rsyncd. By default this is on, ensuring that
BackupPC will refuse to connect to an rsyncd on the client
<br>
that is not password protected. Turn off at your own
risk.</p>

<p style="margin-top: 1em">$Conf{RsyncCsumCacheVerifyProb}
= 0.01; <br>
When rsync checksum caching is enabled (by adding the
--checksum-seed=32761 option to $Conf{RsyncArgs}), the
cached checksums can be occasionally verified to make sure
the <br>
file contents matches the cached checksums. This is to avoid
the risk that disk problems might cause the pool file
contents to get corrupted, but the cached checksums would
<br>
make BackupPC think that the file still matches the
client.</p>

<p style="margin-top: 1em">This setting is the probability
(0 means never and 1 means always) that a file will be
rechecked. Setting it to 0 means the checksums will not be
rechecked (unless there is <br>
a phase 0 failure). Setting it to 1 (ie: 100%) means all
files will be checked, but that is not a desirable setting
since you are better off simply turning caching off (ie:
<br>
remove the --checksum-seed option).</p>

<p style="margin-top: 1em">The default of 0.01 means 1% (on
average) of the files during a full backup will have their
cached checksum re-checked.</p>

<p style="margin-top: 1em">This setting has no effect
unless checksum caching is turned on.</p>

<p style="margin-top: 1em">$Conf{RsyncArgs} = [ ... ]; <br>
Arguments to rsync for backup. Do not edit the first set
unless you have a thorough understanding of how File::RsyncP
works.</p>

<p style="margin-top: 1em">$Conf{RsyncArgsExtra} = []; <br>
Additional arguments added to RsyncArgs. This can be used in
conbination with $Conf{RsyncArgs} to allow customization of
the rsync arguments on a part-client basis. The <br>
standard arguments go in $Conf{RsyncArgs} and
$Conf{RsyncArgsExtra} can be set on a per-client basis.</p>

<p style="margin-top: 1em">Examples of additional arguments
that should work are --exclude/--include, eg:</p>

<p style="margin-top: 1em">$Conf{RsyncArgsExtra} = [ <br>
&rsquo;--exclude&rsquo;, &rsquo;/proc&rsquo;, <br>
&rsquo;--exclude&rsquo;, &rsquo;*.tmp&rsquo;, <br>
];</p>

<p style="margin-top: 1em">Both $Conf{RsyncArgs} and
$Conf{RsyncArgsExtra} are subject to the following variable
substitutions:</p>

<p style="margin-top: 1em">$client client name being backed
up <br>
$host host name (could be different from client name if <br>
$Conf{ClientNameAlias} is set) <br>
$hostIP IP address of host <br>
$confDir configuration directory path</p>

<p style="margin-top: 1em">This allows settings of the
form:</p>

<p style="margin-top: 1em">$Conf{RsyncArgsExtra} = [ <br>
&rsquo;--exclude-from=$confDir/pc/$host.exclude&rsquo;, <br>
];</p>

<p style="margin-top: 1em">$Conf{RsyncRestoreArgs} = [ ...
]; <br>
Arguments to rsync for restore. Do not edit the first set
unless you have a thorough understanding of how File::RsyncP
works.</p>

<p style="margin-top: 1em">If you want to disable direct
restores using rsync (eg: is the module is read-only), you
should set $Conf{RsyncRestoreArgs} to undef and the
corresponding CGI restore option <br>
will be removed.</p>

<p style="margin-top: 1em">$Conf{RsyncRestoreArgs} is
subject to the following variable substitutions:</p>

<p style="margin-top: 1em">$client client name being backed
up <br>
$host host name (could be different from client name if <br>
$Conf{ClientNameAlias} is set) <br>
$hostIP IP address of host <br>
$confDir configuration directory path</p>

<p style="margin-top: 1em">Note: $Conf{RsyncArgsExtra}
doesn&rsquo;t apply to $Conf{RsyncRestoreArgs}.</p>

<p style="margin-top: 1em">FTP Configuration <br>
$Conf{FtpShareName} = &rsquo;&rsquo;; <br>
Which host directories to backup when using FTP. This can be
a string or an array of strings if there are multiple shares
per host.</p>

<p style="margin-top: 1em">This value must be specified in
one of two ways: either as a subdirectory of the
&rsquo;share root&rsquo; on the server, or as the absolute
path of the directory.</p>

<p style="margin-top: 1em">In the following example, if the
directory /home/username is the root share of the ftp server
with the given username, the following two values will back
up the same <br>
directory:</p>

<p style="margin-top: 1em">$Conf{FtpShareName} =
&rsquo;www&rsquo;; # www directory <br>
$Conf{FtpShareName} = &rsquo;/home/username/www&rsquo;; #
same directory</p>

<p style="margin-top: 1em">Path resolution is not
supported; i.e.; you may not have an ftp share path defined
as &rsquo;../otheruser&rsquo; or &rsquo;~/games&rsquo;.</p>

<p style="margin-top: 1em">Multiple shares may also be
specified, as with other protocols:</p>

<p style="margin-top: 1em">$Conf{FtpShareName} = [
&rsquo;www&rsquo;, <br>
&rsquo;bin&rsquo;, <br>
&rsquo;config&rsquo; ];</p>

<p style="margin-top: 1em">Note also that you can also use
$Conf{BackupFilesOnly} to specify a specific list of
directories to backup. It&rsquo;s more efficient to use this
option instead of <br>
$Conf{FtpShareName} since a new tar is run for each entry in
$Conf{FtpShareName}.</p>

<p style="margin-top: 1em">This setting only matters if
$Conf{XferMethod} = &rsquo;ftp&rsquo;.</p>

<p style="margin-top: 1em">$Conf{FtpUserName} =
&rsquo;&rsquo;; <br>
FTP user name. This is used to log into the server.</p>

<p style="margin-top: 1em">This setting is used only if
$Conf{XferMethod} = &rsquo;ftp&rsquo;.</p>

<p style="margin-top: 1em">$Conf{FtpPasswd} =
&rsquo;&rsquo;; <br>
FTP user password. This is used to log into the server.</p>

<p style="margin-top: 1em">This setting is used only if
$Conf{XferMethod} = &rsquo;ftp&rsquo;.</p>

<p style="margin-top: 1em">$Conf{FtpPassive} = 1; <br>
Whether passive mode is used. The correct setting depends
upon whether local or remote ports are accessible from the
other machine, which is affected by any firewall or <br>
routers between the FTP server on the client and the
BackupPC server.</p>

<p style="margin-top: 1em">This setting is used only if
$Conf{XferMethod} = &rsquo;ftp&rsquo;.</p>

<p style="margin-top: 1em">$Conf{FtpBlockSize} = 10240;
<br>
Transfer block size. This sets the size of the amounts of
data in each frame. While undefined, this value takes the
default value.</p>

<p style="margin-top: 1em">This setting is used only if
$Conf{XferMethod} = &rsquo;ftp&rsquo;.</p>

<p style="margin-top: 1em">$Conf{FtpPort} = 21; <br>
The port of the ftp server. If undefined, 21 is used.</p>

<p style="margin-top: 1em">This setting is used only if
$Conf{XferMethod} = &rsquo;ftp&rsquo;.</p>

<p style="margin-top: 1em">$Conf{FtpTimeout} = 120; <br>
Connection timeout for FTP. When undefined, the default is
120 seconds.</p>

<p style="margin-top: 1em">This setting is used only if
$Conf{XferMethod} = &rsquo;ftp&rsquo;.</p>

<p style="margin-top: 1em">$Conf{FtpFollowSymlinks} = 0;
<br>
Behaviour when BackupPC encounters symlinks on the FTP
share.</p>

<p style="margin-top: 1em">Symlinks cannot be restored via
FTP, so the desired behaviour will be different depending on
the setup of the share. The default for this behavor is 1.
Directory shares with <br>
more complicated directory structures should consider other
protocols.</p>

<p style="margin-top: 1em">Archive Configuration <br>
$Conf{ArchiveDest} = &rsquo;/tmp&rsquo;; <br>
Archive Destination</p>

<p style="margin-top: 1em">The Destination of the archive
e.g. /tmp for file archive or /dev/nst0 for device
archive</p>

<p style="margin-top: 1em">$Conf{ArchiveComp} =
&rsquo;gzip&rsquo;; <br>
Archive Compression type</p>

<p style="margin-top: 1em">The valid values are:</p>

<p style="margin-top: 1em">- &rsquo;none&rsquo;: No
Compression</p>

<p style="margin-top: 1em">- &rsquo;gzip&rsquo;: Medium
Compression. Recommended.</p>

<p style="margin-top: 1em">- &rsquo;bzip2&rsquo;: High
Compression but takes longer.</p>

<p style="margin-top: 1em">$Conf{ArchivePar} = 0; <br>
Archive Parity Files</p>

<p style="margin-top: 1em">The amount of Parity data to
generate, as a percentage of the archive size. Uses the
commandline par2 (par2cmdline) available from
http://parchive.sourceforge.net</p>

<p style="margin-top: 1em">Only useful for file dumps.</p>

<p style="margin-top: 1em">Set to 0 to disable this
feature.</p>

<p style="margin-top: 1em">$Conf{ArchiveSplit} = 0; <br>
Archive Size Split</p>

<p style="margin-top: 1em">Only for file archives. Splits
the output into the specified size * 1,000,000. e.g. to
split into 650,000,000 bytes, specify 650 below.</p>

<p style="margin-top: 1em">If the value is 0, or if
$Conf{ArchiveDest} is an existing file or device (e.g. a
streaming tape drive), this feature is disabled.</p>

<p style="margin-top: 1em">$Conf{ArchiveClientCmd} =
&rsquo;$Installdir/bin/BackupPC_archiveHost&rsquo; ... <br>
Archive Command</p>

<p style="margin-top: 1em">This is the command that is
called to actually run the archive process for each host.
The following variables are substituted at run-time:</p>

<p style="margin-top: 1em">$Installdir The installation
directory of BackupPC <br>
$tarCreatePath The path to BackupPC_tarCreate <br>
$splitpath The path to the split program <br>
$parpath The path to the par2 program <br>
$host The host to archive <br>
$backupnumber The backup number of the host to archive <br>
$compression The path to the compression program <br>
$compext The extension assigned to the compression type <br>
$splitsize The number of bytes to split archives into <br>
$archiveloc The location to put the archive <br>
$parfile The amount of parity data to create
(percentage)</p>

<p style="margin-top: 1em">Note: all Cmds are executed
directly without a shell, so the prog name needs to be a
full path and you can&rsquo;t include shell syntax like
redirection and pipes; put that in a <br>
script if you need it.</p>

<p style="margin-top: 1em">$Conf{SshPath} = &rsquo;&rsquo;;
<br>
Full path for ssh. Security caution: normal users should not
allowed to write to this file or directory.</p>

<p style="margin-top: 1em">$Conf{NmbLookupPath} =
&rsquo;&rsquo;; <br>
Full path for nmblookup. Security caution: normal users
should not allowed to write to this file or directory.</p>

<p style="margin-top: 1em">nmblookup is from the Samba
distribution. nmblookup is used to get the netbios name,
necessary for DHCP hosts.</p>

<p style="margin-top: 1em">$Conf{NmbLookupCmd} =
&rsquo;$nmbLookupPath -A $host&rsquo;; <br>
NmbLookup command. Given an IP address, does an nmblookup on
that IP address. The following variables are substituted at
run-time:</p>

<p style="margin-top: 1em">$nmbLookupPath path to nmblookup
($Conf{NmbLookupPath}) <br>
$host IP address</p>

<p style="margin-top: 1em">This command is only used for
DHCP hosts: given an IP address, this command should try to
find its NetBios name.</p>

<p style="margin-top: 1em">Note: all Cmds are executed
directly without a shell, so the prog name needs to be a
full path and you can&rsquo;t include shell syntax like
redirection and pipes; put that in a <br>
script if you need it.</p>

<p style="margin-top: 1em">$Conf{NmbLookupFindHostCmd} =
&rsquo;$nmbLookupPath $host&rsquo;; <br>
NmbLookup command. Given a netbios name, finds that host by
doing a NetBios lookup. Several variables are substituted at
run-time:</p>

<p style="margin-top: 1em">$nmbLookupPath path to nmblookup
($Conf{NmbLookupPath}) <br>
$host NetBios name</p>

<p style="margin-top: 1em">In some cases you might need to
change the broadcast address, for example if nmblookup uses
192.168.255.255 by default and you find that doesn&rsquo;t
work, try 192.168.1.255 (or <br>
your equivalent class C address) using the -B option:</p>

<p style="margin-top: 1em">$Conf{NmbLookupFindHostCmd} =
&rsquo;$nmbLookupPath -B 192.168.1.255 $host&rsquo;;</p>

<p style="margin-top: 1em">If you use a WINS server and
your machines don&rsquo;t respond to multicast NetBios
requests you can use this (replace 1.2.3.4 with the IP
address of your WINS server):</p>

<p style="margin-top: 1em">$Conf{NmbLookupFindHostCmd} =
&rsquo;$nmbLookupPath -R -U 1.2.3.4 $host&rsquo;;</p>

<p style="margin-top: 1em">This is preferred over multicast
since it minimizes network traffic.</p>

<p style="margin-top: 1em">Experiment manually for your
site to see what form of nmblookup command works.</p>

<p style="margin-top: 1em">Note: all Cmds are executed
directly without a shell, so the prog name needs to be a
full path and you can&rsquo;t include shell syntax like
redirection and pipes; put that in a <br>
script if you need it.</p>

<p style="margin-top: 1em">$Conf{FixedIPNetBiosNameCheck} =
0; <br>
For fixed IP address hosts, BackupPC_dump can also verify
the netbios name to ensure it matches the host name. An
error is generated if they do not match. Typically this <br>
flag is off. But if you are going to transition a bunch of
machines from fixed host addresses to DHCP, setting this
flag is a great way to verify that the machines have <br>
their netbios name set correctly before turning on DCHP.</p>

<p style="margin-top: 1em">$Conf{PingPath} =
&rsquo;&rsquo;; <br>
Full path to the ping command. Security caution: normal
users should not be allowed to write to this file or
directory.</p>

<p style="margin-top: 1em">If you want to disable ping
checking, set this to some program that exits with 0 status,
eg:</p>

<p style="margin-top: 1em">$Conf{PingPath} =
&rsquo;/bin/echo&rsquo;;</p>

<p style="margin-top: 1em">$Conf{PingCmd} =
&rsquo;$pingPath -c 1 $host&rsquo;; <br>
Ping command. The following variables are substituted at
run-time:</p>

<p style="margin-top: 1em">$pingPath path to ping
($Conf{PingPath}) <br>
$host host name</p>

<p style="margin-top: 1em">Wade Brown reports that on
solaris 2.6 and 2.7 ping -s returns the wrong exit status (0
even on failure). Replace with &quot;ping $host 1&quot;,
which gets the correct exit status but <br>
we don&rsquo;t get the round-trip time.</p>

<p style="margin-top: 1em">Note: all Cmds are executed
directly without a shell, so the prog name needs to be a
full path and you can&rsquo;t include shell syntax like
redirection and pipes; put that in a <br>
script if you need it.</p>

<p style="margin-top: 1em">$Conf{PingMaxMsec} = 20; <br>
Maximum round-trip ping time in milliseconds. This threshold
is set to avoid backing up PCs that are remotely connected
through WAN or dialup connections. The output from <br>
ping -s (assuming it is supported on your system) is used to
check the round-trip packet time. On your local LAN
round-trip times should be much less than 20msec. On most
<br>
WAN or dialup connections the round-trip time will be
typically more than 20msec. Tune if necessary.</p>

<p style="margin-top: 1em">$Conf{CompressLevel} = 0; <br>
Compression level to use on files. 0 means no compression.
Compression levels can be from 1 (least cpu time, slightly
worse compression) to 9 (most cpu time, slightly <br>
better compression). The recommended value is 3. Changing to
5, for example, will take maybe 20% more cpu time and will
get another 2-3% additional compression. See the <br>
zlib documentation for more information about compression
levels.</p>

<p style="margin-top: 1em">Changing compression on or off
after backups have already been done will require both
compressed and uncompressed pool files to be stored. This
will increase the pool <br>
storage requirements, at least until all the old backups
expire and are deleted.</p>

<p style="margin-top: 1em">It is ok to change the
compression value (from one non-zero value to another
non-zero value) after dumps are already done. Since BackupPC
matches pool files by comparing the <br>
uncompressed versions, it will still correctly match new
incoming files against existing pool files. The new
compression level will take effect only for new files that
are <br>
newly compressed and added to the pool.</p>

<p style="margin-top: 1em">If compression was off and you
are enabling compression for the first time you can use the
BackupPC_compressPool utility to compress the pool. This
avoids having the pool <br>
grow to accommodate both compressed and uncompressed
backups. See the documentation for more information.</p>

<p style="margin-top: 1em">Note: compression needs the
Compress::Zlib perl library. If the Compress::Zlib library
can&rsquo;t be found then $Conf{CompressLevel} is forced to
0 (compression off).</p>

<p style="margin-top: 1em">$Conf{ClientTimeout} = 72000;
<br>
Timeout in seconds when listening for the transport
program&rsquo;s (smbclient, tar etc) stdout. If no output is
received during this time, then it is assumed that something
has <br>
wedged during a backup, and the backup is terminated.</p>

<p style="margin-top: 1em">Note that stdout buffering
combined with huge files being backed up could cause longish
delays in the output from smbclient that BackupPC_dump sees,
so in rare cases you <br>
might want to increase this value.</p>

<p style="margin-top: 1em">Despite the name, this parameter
sets the timeout for all transport methods (tar, smb
etc).</p>

<p style="margin-top: 1em">$Conf{MaxOldPerPCLogFiles} = 12;
<br>
Maximum number of log files we keep around in each
PC&rsquo;s directory (ie: pc/$host). These files are aged
monthly. A setting of 12 means there will be at most the
files LOG, <br>
LOG.0, LOG.1, ... LOG.11 in the pc/$host directory (ie:
about a years worth). (Except this month&rsquo;s LOG, these
files will have a .z extension if compression is on).</p>

<p style="margin-top: 1em">If you decrease this number
after BackupPC has been running for a while you will have to
manually remove the older log files.</p>

<p style="margin-top: 1em">$Conf{DumpPreUserCmd} = undef;
<br>
$Conf{DumpPostUserCmd} = undef; <br>
$Conf{DumpPreShareCmd} = undef; <br>
$Conf{DumpPostShareCmd} = undef; <br>
$Conf{RestorePreUserCmd} = undef; <br>
$Conf{RestorePostUserCmd} = undef; <br>
$Conf{ArchivePreUserCmd} = undef; <br>
$Conf{ArchivePostUserCmd} = undef; <br>
Optional commands to run before and after dumps and
restores, and also before and after each share of a
dump.</p>

<p style="margin-top: 1em">Stdout from these commands will
be written to the Xfer (or Restore) log file. One example of
using these commands would be to shut down and restart a
database server, dump a <br>
database to files for backup, or doing a snapshot of a share
prior to a backup. Example:</p>

<p style="margin-top: 1em">$Conf{DumpPreUserCmd} =
&rsquo;$sshPath -q -x -l root $host
/usr/bin/dumpMysql&rsquo;;</p>

<p style="margin-top: 1em">The following variable
substitutions are made at run time for
$Conf{DumpPreUserCmd}, $Conf{DumpPostUserCmd},
$Conf{DumpPreShareCmd} and $Conf{DumpPostShareCmd}:</p>

<p style="margin-top: 1em">$type type of dump (incr or
full) <br>
$xferOK 1 if the dump succeeded, 0 if it didn&rsquo;t <br>
$client client name being backed up <br>
$host host name (could be different from client name if <br>
$Conf{ClientNameAlias} is set) <br>
$hostIP IP address of host <br>
$user user name from the hosts file <br>
$moreUsers list of additional users from the hosts file <br>
$share the first share name (or current share for <br>
$Conf{DumpPreShareCmd} and $Conf{DumpPostShareCmd}) <br>
$shares list of all the share names <br>
$XferMethod value of $Conf{XferMethod} (eg: tar, rsync, smb)
<br>
$sshPath value of $Conf{SshPath}, <br>
$cmdType set to DumpPreUserCmd or DumpPostUserCmd</p>

<p style="margin-top: 1em">The following variable
substitutions are made at run time for
$Conf{RestorePreUserCmd} and $Conf{RestorePostUserCmd}:</p>

<p style="margin-top: 1em">$client client name being backed
up <br>
$xferOK 1 if the restore succeeded, 0 if it didn&rsquo;t
<br>
$host host name (could be different from client name if <br>
$Conf{ClientNameAlias} is set) <br>
$hostIP IP address of host <br>
$user user name from the hosts file <br>
$moreUsers list of additional users from the hosts file <br>
$share the first share name <br>
$XferMethod value of $Conf{XferMethod} (eg: tar, rsync, smb)
<br>
$sshPath value of $Conf{SshPath}, <br>
$type set to &quot;restore&quot; <br>
$bkupSrcHost host name of the restore source <br>
$bkupSrcShare share name of the restore source <br>
$bkupSrcNum backup number of the restore source <br>
$pathHdrSrc common starting path of restore source <br>
$pathHdrDest common starting path of destination <br>
$fileList list of files being restored <br>
$cmdType set to RestorePreUserCmd or RestorePostUserCmd</p>

<p style="margin-top: 1em">The following variable
substitutions are made at run time for
$Conf{ArchivePreUserCmd} and $Conf{ArchivePostUserCmd}:</p>

<p style="margin-top: 1em">$client client name being backed
up <br>
$xferOK 1 if the archive succeeded, 0 if it didn&rsquo;t
<br>
$host Name of the archive host <br>
$user user name from the hosts file <br>
$share the first share name <br>
$XferMethod value of $Conf{XferMethod} (eg: tar, rsync, smb)
<br>
$HostList list of hosts being archived <br>
$BackupList list of backup numbers for the hosts being
archived <br>
$archiveloc location where the archive is sent to <br>
$parfile amount of parity data being generated (percentage)
<br>
$compression compression program being used (eg: cat, gzip,
bzip2) <br>
$compext extension used for compression type (eg: raw, gz,
bz2) <br>
$splitsize size of the files that the archive creates <br>
$sshPath value of $Conf{SshPath}, <br>
$type set to &quot;archive&quot; <br>
$cmdType set to ArchivePreUserCmd or ArchivePostUserCmd</p>

<p style="margin-top: 1em">Note: all Cmds are executed
directly without a shell, so the prog name needs to be a
full path and you can&rsquo;t include shell syntax like
redirection and pipes; put that in a <br>
script if you need it.</p>

<p style="margin-top: 1em">$Conf{UserCmdCheckStatus} = 0;
<br>
Whether the exit status of each PreUserCmd and PostUserCmd
is checked.</p>

<p style="margin-top: 1em">If set and the
Dump/Restore/Archive Pre/Post UserCmd returns a non-zero
exit status then the dump/restore/archive is aborted. To
maintain backward compatibility (where the <br>
exit status in early versions was always ignored), this flag
defaults to 0.</p>

<p style="margin-top: 1em">If this flag is set and the
Dump/Restore/Archive PreUserCmd fails then the matching
Dump/Restore/Archive PostUserCmd is not executed. If
DumpPreShareCmd returns a non-exit <br>
status, then DumpPostShareCmd is not executed, but the
DumpPostUserCmd is still run (since DumpPreUserCmd must have
previously succeeded).</p>

<p style="margin-top: 1em">An example of a DumpPreUserCmd
that might fail is a script that snapshots or dumps a
database which fails because of some database error.</p>

<p style="margin-top: 1em">$Conf{ClientNameAlias} = undef;
<br>
Override the client&rsquo;s host name. This allows multiple
clients to all refer to the same physical host. This should
only be set in the per-PC config file and is only used by
<br>
BackupPC at the last moment prior to generating the command
used to backup that machine (ie: the value of
$Conf{ClientNameAlias} is invisible everywhere else in
BackupPC). <br>
The setting can be a host name or IP address, eg:</p>

<p style="margin-top: 1em">$Conf{ClientNameAlias} =
&rsquo;realHostName&rsquo;; <br>
$Conf{ClientNameAlias} = &rsquo;192.1.1.15&rsquo;;</p>

<p style="margin-top: 1em">will cause the relevant
smb/tar/rsync backup/restore commands to be directed to
realHostName, not the client name.</p>

<p style="margin-top: 1em">Note: this setting doesn&rsquo;t
work for hosts with DHCP set to 1.</p>

<p style="margin-top: 1em">Email reminders, status and
messages <br>
$Conf{SendmailPath} = &rsquo;&rsquo;; <br>
Full path to the sendmail command. Security caution: normal
users should not allowed to write to this file or
directory.</p>

<p style="margin-top: 1em">$Conf{EMailNotifyMinDays} = 2.5;
<br>
Minimum period between consecutive emails to a single user.
This tries to keep annoying email to users to a reasonable
level. Email checks are done nightly, so this number <br>
is effectively rounded up (ie: 2.5 means a user will never
receive email more than once every 3 days).</p>

<p style="margin-top: 1em">$Conf{EMailFromUserName} =
&rsquo;&rsquo;; <br>
Name to use as the &quot;from&quot; name for email.
Depending upon your mail handler this is either a plain name
(eg: &quot;admin&quot;) or a fully-qualified name (eg:
&quot;admin@mydomain.com&quot;).</p>

<p style="margin-top: 1em">$Conf{EMailAdminUserName} =
&rsquo;&rsquo;; <br>
Destination address to an administrative user who will
receive a nightly email with warnings and errors. If there
are no warnings or errors then no email will be sent. <br>
Depending upon your mail handler this is either a plain name
(eg: &quot;admin&quot;) or a fully-qualified name (eg:
&quot;admin@mydomain.com&quot;).</p>

<p style="margin-top: 1em">$Conf{EMailUserDestDomain} =
&rsquo;&rsquo;; <br>
Destination domain name for email sent to users. By default
this is empty, meaning email is sent to plain, unqualified
addresses. Otherwise, set it to the destintation <br>
domain, eg:</p>

<p style="margin-top: 1em">$Cong{EMailUserDestDomain} =
&rsquo;@mydomain.com&rsquo;;</p>

<p style="margin-top: 1em">With this setting user email
will be set to &rsquo;user@mydomain.com&rsquo;.</p>

<p style="margin-top: 1em">$Conf{EMailNoBackupEverSubj} =
undef; <br>
$Conf{EMailNoBackupEverMesg} = undef; <br>
This subject and message is sent to a user if their PC has
never been backed up.</p>

<p style="margin-top: 1em">These values are
language-dependent. The default versions can be found in the
language file (eg: lib/BackupPC/Lang/en.pm). If you need to
change the message, copy it here <br>
and edit it, eg:</p>

<p style="margin-top: 1em">$Conf{EMailNoBackupEverMesg} =
&lt;&lt;&rsquo;EOF&rsquo;; <br>
To: $user$domain <br>
cc: <br>
Subject: $subj</p>

<p style="margin-top: 1em">Dear $userName,</p>

<p style="margin-top: 1em">This is a site-specific email
message. <br>
EOF</p>

<p style="margin-top: 1em">$Conf{EMailNotifyOldBackupDays}
= 7.0; <br>
How old the most recent backup has to be before notifying
user. When there have been no backups in this number of days
the user is sent an email.</p>

<p style="margin-top: 1em">$Conf{EMailNoBackupRecentSubj} =
undef; <br>
$Conf{EMailNoBackupRecentMesg} = undef; <br>
This subject and message is sent to a user if their PC has
not recently been backed up (ie: more than
$Conf{EMailNotifyOldBackupDays} days ago).</p>

<p style="margin-top: 1em">These values are
language-dependent. The default versions can be found in the
language file (eg: lib/BackupPC/Lang/en.pm). If you need to
change the message, copy it here <br>
and edit it, eg:</p>

<p style="margin-top: 1em">$Conf{EMailNoBackupRecentMesg} =
&lt;&lt;&rsquo;EOF&rsquo;; <br>
To: $user$domain <br>
cc: <br>
Subject: $subj</p>

<p style="margin-top: 1em">Dear $userName,</p>

<p style="margin-top: 1em">This is a site-specific email
message. <br>
EOF</p>


<p style="margin-top: 1em">$Conf{EMailNotifyOldOutlookDays}
= 5.0; <br>
How old the most recent backup of Outlook files has to be
before notifying user.</p>

<p style="margin-top: 1em">$Conf{EMailOutlookBackupSubj} =
undef; <br>
$Conf{EMailOutlookBackupMesg} = undef; <br>
This subject and message is sent to a user if their Outlook
files have not recently been backed up (ie: more than
$Conf{EMailNotifyOldOutlookDays} days ago).</p>

<p style="margin-top: 1em">These values are
language-dependent. The default versions can be found in the
language file (eg: lib/BackupPC/Lang/en.pm). If you need to
change the message, copy it here <br>
and edit it, eg:</p>

<p style="margin-top: 1em">$Conf{EMailOutlookBackupMesg} =
&lt;&lt;&rsquo;EOF&rsquo;; <br>
To: $user$domain <br>
cc: <br>
Subject: $subj</p>

<p style="margin-top: 1em">Dear $userName,</p>

<p style="margin-top: 1em">This is a site-specific email
message. <br>
EOF</p>

<p style="margin-top: 1em">$Conf{EMailHeaders} =
&lt;&lt;EOF; <br>
Additional email headers. This sets to charset to utf8.</p>

<p style="margin-top: 1em">CGI user interface configuration
settings <br>
$Conf{CgiAdminUserGroup} = &rsquo;&rsquo;; <br>
$Conf{CgiAdminUsers} = &rsquo;&rsquo;; <br>
Normal users can only access information specific to their
host. They can start/stop/browse/restore backups.</p>

<p style="margin-top: 1em">Administrative users have full
access to all hosts, plus overall status and log
information.</p>

<p style="margin-top: 1em">The administrative users are the
union of the unix/linux group $Conf{CgiAdminUserGroup} and
the manual list of users, separated by spaces, in
$Conf{CgiAdminUsers}. If you <br>
don&rsquo;t want a group or manual list of users set the
corresponding configuration setting to undef or an empty
string.</p>

<p style="margin-top: 1em">If you want every user to have
admin privileges (careful!), set $Conf{CgiAdminUsers} =
&rsquo;*&rsquo;.</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">$Conf{CgiAdminUserGroup} =
&rsquo;admin&rsquo;; <br>
$Conf{CgiAdminUsers} = &rsquo;craig celia&rsquo;; <br>
--&gt; administrative users are the union of group admin,
plus <br>
craig and celia.</p>

<p style="margin-top: 1em">$Conf{CgiAdminUserGroup} =
&rsquo;&rsquo;; <br>
$Conf{CgiAdminUsers} = &rsquo;craig celia&rsquo;; <br>
--&gt; administrative users are only craig and
celia&rsquo;.</p>

<p style="margin-top: 1em">$Conf{CgiURL} = undef; <br>
URL of the BackupPC_Admin CGI script. Used for email
messages.</p>

<p style="margin-top: 1em">$Conf{Language} =
&rsquo;en&rsquo;; <br>
Language to use. See lib/BackupPC/Lang for the list of
supported languages, which include English (en), French
(fr), Spanish (es), German (de), Italian (it), Dutch (nl),
<br>
Polish (pl), Portuguese Brazillian (pt_br) and Chinese
(zh_CH).</p>

<p style="margin-top: 1em">Currently the Language setting
applies to the CGI interface and email messages sent to
users. Log files and other text are still in English.</p>

<p style="margin-top: 1em">$Conf{CgiUserHomePageCheck} =
&rsquo;&rsquo;; <br>
$Conf{CgiUserUrlCreate} = &rsquo;mailto:%s&rsquo;; <br>
User names that are rendered by the CGI interface can be
turned into links into their home page or other information
about the user. To set this up you need to create two <br>
sprintf() strings, that each contain a single
&rsquo;%s&rsquo; that will be replaced by the user name. The
default is a mailto: link.</p>

<p style="margin-top: 1em">$Conf{CgiUserHomePageCheck}
should be an absolute file path that is used to check (via
&quot;-f&quot;) that the user has a valid home page. Set
this to undef or an empty string to <br>
turn off this check.</p>

<p style="margin-top: 1em">$Conf{CgiUserUrlCreate} should
be a full URL that points to the user&rsquo;s home page. Set
this to undef or an empty string to turn off generation of
URLs for user names.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">$Conf{CgiUserHomePageCheck} =
&rsquo;/var/www/html/users/%s.html&rsquo;; <br>
$Conf{CgiUserUrlCreate} =
&rsquo;http://myhost/users/%s.html&rsquo;; <br>
--&gt; if /var/www/html/users/craig.html exists, then
&rsquo;craig&rsquo; will <br>
be rendered as a link to http://myhost/users/craig.html.</p>

<p style="margin-top: 1em">$Conf{CgiDateFormatMMDD} = 1;
<br>
Date display format for CGI interface. A value of 1 uses
US-style dates (MM/DD), a value of 2 uses full YYYY-MM-DD
format, and zero for international dates (DD/MM).</p>

<p style="margin-top: 1em">$Conf{CgiNavBarAdminAllHosts} =
1; <br>
If set, the complete list of hosts appears in the left
navigation bar pull-down for administrators. Otherwise, just
the hosts for which the user is listed in the host file <br>
(as either the user or in moreUsers) are displayed.</p>

<p style="margin-top: 1em">$Conf{CgiSearchBoxEnable} = 1;
<br>
Enable/disable the search box in the navigation bar.</p>

<p style="margin-top: 1em">$Conf{CgiNavBarLinks} = [ ... ];
<br>
Additional navigation bar links. These appear for both
regular users and administrators. This is a list of hashes
giving the link (URL) and the text (name) for the link. <br>
Specifying lname instead of name uses the language specific
string (ie: $Lang-&gt;{lname}) instead of just literally
displaying name.</p>

<p style="margin-top: 1em">$Conf{CgiStatusHilightColor} = {
... <br>
Hilight colors based on status that are used in the PC
summary page.</p>

<p style="margin-top: 1em">$Conf{CgiHeaders} =
&rsquo;&lt;meta http-equiv=&quot;pragma&quot;
content=&quot;no-cache&quot;&gt;&rsquo;; <br>
Additional CGI header text.</p>

<p style="margin-top: 1em">$Conf{CgiImageDir} =
&rsquo;&rsquo;; <br>
Directory where images are stored. This directory should be
below Apache&rsquo;s DocumentRoot. This value isn&rsquo;t
used by BackupPC but is used by configure.pl when you
upgrade <br>
BackupPC.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">$Conf{CgiImageDir} =
&rsquo;/var/www/htdocs/BackupPC&rsquo;;</p>

<p style="margin-top: 1em">$Conf{CgiExt2ContentType} = { };
<br>
Additional mappings of file name extenions to Content-Type
for individual file restore. See $Ext2ContentType in
BackupPC_Admin for the default setting. You can add <br>
additional settings here, or override any default settings.
Example:</p>

<p style="margin-top: 1em">$Conf{CgiExt2ContentType} = {
<br>
&rsquo;pl&rsquo; =&gt; &rsquo;text/plain&rsquo;, <br>
};</p>

<p style="margin-top: 1em">$Conf{CgiImageDirURL} =
&rsquo;&rsquo;; <br>
URL (without the leading http://host) for BackupPC&rsquo;s
image directory. The CGI script uses this value to serve up
image files.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">$Conf{CgiImageDirURL} =
&rsquo;/BackupPC&rsquo;;</p>

<p style="margin-top: 1em">$Conf{CgiCSSFile} =
&rsquo;BackupPC_stnd.css&rsquo;; <br>
CSS stylesheet &quot;skin&quot; for the CGI interface. It is
stored in the $Conf{CgiImageDir} directory and accessed via
the $Conf{CgiImageDirURL} URL.</p>

<p style="margin-top: 1em">For BackupPC v3.x several color,
layout and font changes were made. The previous v2.x version
is available as BackupPC_stnd_orig.css, so if you prefer the
old skin, change <br>
this to BackupPC_stnd_orig.css.</p>

<p style="margin-top: 1em">$Conf{CgiUserConfigEditEnable} =
1; <br>
Whether the user is allowed to edit their per-PC config.</p>

<p style="margin-top: 1em">$Conf{CgiUserConfigEdit} = { ...
<br>
Which per-host config variables a non-admin user is allowed
to edit. Admin users can edit all per-host config variables,
even if disabled in this list.</p>

<p style="margin-top: 1em">SECURITY WARNING: Do not let
users edit any of the Cmd config variables! That&rsquo;s
because a user could set a Cmd to a shell script of their
choice and it will be run as the <br>
BackupPC user. That script could do all sorts of bad
things.</p>

<p style="margin-top: 1em">Version Numbers <br>
Starting with v1.4.0 BackupPC uses a X.Y.Z version numbering
system, instead of X.0Y. The first digit is for major new
releases, the middle digit is for significant feature <br>
releases and improvements (most of the releases have been in
this category), and the last digit is for bug fixes. You
should think of the old 1.00, 1.01, 1.02 and 1.03 as 1.0.0,
<br>
1.1.0, 1.2.0 and 1.3.0.</p>

<p style="margin-top: 1em">Additionally, patches might be
made available. A patched version number is of the form
X.Y.ZplN (eg: 2.1.0pl2), where N is the patch level.</p>

<p style="margin-top: 1em">Author <br>
Craig Barratt &lt;cbarratt@users.sourceforge.net&gt;</p>

<p style="margin-top: 1em">See
&lt;http://backuppc.sourceforge.net&gt;.</p>

<p style="margin-top: 1em">Copyright <br>
Copyright (C) 2001-2015 Craig Barratt</p>

<p style="margin-top: 1em">Credits <br>
Ryan Kucera contributed the directory navigation code and
images for v1.5.0. He contributed the first skeleton of
BackupPC_restore. He also added a significant revision to
the <br>
CGI interface, including CSS tags, in v2.1.0, and designed
the BackupPC logo.</p>

<p style="margin-top: 1em">Xavier Nicollet, with additions
from Guillaume Filion, added the internationalization (i18n)
support to the CGI interface for v2.0.0. Xavier provided the
French translation <br>
fr.pm, with additions from Guillaume.</p>

<p style="margin-top: 1em">Guillaume Filion wrote
BackupPC_zipCreate and added the CGI support for zip
download, in addition to some CGI cleanup, for v1.5.0.
Guillaume continues to support fr.pm updates <br>
for each new version.</p>

<p style="margin-top: 1em">Josh Marshall implemented the
Archive feature in v2.1.0.</p>

<p style="margin-top: 1em">Ludovic Drolez supports the
BackupPC Debian package.</p>

<p style="margin-top: 1em">Javier Gonzalez provided the
Spanish translation, es.pm for v2.0.0.</p>

<p style="margin-top: 1em">Manfred Herrmann provided the
German translation, de.pm for v2.0.0. Manfred continues to
support de.pm updates for each new version, together with
some help from Ralph Passgang.</p>

<p style="margin-top: 1em">Lorenzo Cappelletti provided the
Italian translation, it.pm for v2.1.0. Giuseppe Iuculano and
Vittorio Macchi updated it for 3.0.0.</p>

<p style="margin-top: 1em">Lieven Bridts provided the Dutch
translation, nl.pm, for v2.1.0, with some tweaks from Guus
Houtzager, and updates for 3.0.0.</p>

<p style="margin-top: 1em">Reginaldo Ferreira provided the
Portuguese Brazillian translation pt_br.pm for v2.2.0.</p>

<p style="margin-top: 1em">Rich Duzenbury provided the RSS
feed option to the CGI interface.</p>

<p style="margin-top: 1em">Jono Woodhouse from CapeSoft
Software (www.capesoft.com) provided a new CSS skin for
3.0.0 with several layout improvements. Sean Cameron (also
from CapeSoft) designed new and <br>
more compact file icons for 3.0.0.</p>

<p style="margin-top: 1em">Youlin Feng provided the Chinese
translation for 3.1.0.</p>

<p style="margin-top: 1em">Karol &rsquo;Semper&rsquo;
Stelmaczonek provided the Polish translation for 3.1.0.</p>

<p style="margin-top: 1em">Jeremy Tietsort provided the
host summary table sorting feature for 3.1.0.</p>

<p style="margin-top: 1em">Paul Mantz contributed the ftp
Xfer method for 3.2.0.</p>

<p style="margin-top: 1em">Petr Pokorny provided the Czech
translation for 3.2.1.</p>

<p style="margin-top: 1em">Rikiya Yamamoto provided the
Japanese translation for 3.3.0.</p>

<p style="margin-top: 1em">Yakim provided the Ukrainian
translation for 3.3.0.</p>

<p style="margin-top: 1em">Sergei Butakov provided the
Russian translation for 3.3.0.</p>

<p style="margin-top: 1em">Many people have reported bugs,
made useful suggestions and helped with testing; see the
ChangeLog and the mailing lists.</p>

<p style="margin-top: 1em">Your name could appear here in
the next version!</p>

<p style="margin-top: 1em">License <br>
This program is free software; you can redistribute it
and/or modify it under the terms of the GNU General Public
License as published by the Free Software Foundation; either
<br>
version 2 of the License, or (at your option) any later
version.</p>

<p style="margin-top: 1em">This program is distributed in
the hope that it will be useful, but WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or
FITNESS FOR A PARTICULAR <br>
PURPOSE. See the GNU General Public License for more
details.</p>

<p style="margin-top: 1em">You should have received a copy
of the GNU General Public License in the LICENSE file along
with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple <br>
Place, Suite 330, Boston, MA 02111-1307 USA.</p>

<p style="margin-top: 1em">perl v5.24.1 2016-12-14
BACKUPPC(8)</p>
<hr>
</body>
</html>
