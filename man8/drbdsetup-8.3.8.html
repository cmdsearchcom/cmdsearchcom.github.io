<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>DRBDSETUP(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">DRBDSETUP(8)</td>
    <td class="head-vol">System Administration</td>
    <td class="head-rtitle">DRBDSETUP(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
drbdsetup - Setup tool for DRBD
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} disk {<i>lower_dev</i>} {<i>meta_data_dev</i>}
  {<i>meta_data_index</i>} [-d&#x00A0;{ <i>size</i>}]
  [-e&#x00A0;{<i>err_handler</i>}] [-f&#x00A0;{ <i>fencing_policy</i>}] [-b]
  [-t&#x00A0;{ <i>disk_timeout</i>}]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} net [<i>af:</i>] {<i>local_addr</i>} [<i>:port</i>]
  [<i>af:</i>] { <i>remote_addr</i>} [<i>:port</i>] {<i>protocol</i>}
  [-c&#x00A0;{ <i>time</i>}] [-i&#x00A0;{<i>time</i>}] [-t&#x00A0;{<i>val</i>}]
  [-S&#x00A0;{ <i>size</i>}] [-r&#x00A0;{<i>size</i>}]
  [-k&#x00A0;{<i>count</i>}] [-e&#x00A0;{ <i>max_epoch_size</i>}]
  [-b&#x00A0;{<i>max_buffers</i>}] [-m] [-a&#x00A0;{<i>hash_alg</i>}]
  [-x&#x00A0;{ <i>shared_secret</i>}] [-A&#x00A0;{<i>asb-0p-policy</i>}]
  [-B&#x00A0;{ <i>asb-1p-policy</i>}] [-C&#x00A0;{<i>asb-2p-policy</i>}] [-D]
  [-R&#x00A0;{ <i>role-resync-conflict-policy</i>}]
  [-p&#x00A0;{<i>ping_timeout</i>}] [-u&#x00A0;{ <i>val</i>}]
  [-d&#x00A0;{<i>hash_alg</i>}] [-o] [-n] [-g&#x00A0;{
  <i>congestion_policy</i>}] [-f&#x00A0;{ <i>val</i>}]
  [-h&#x00A0;{<i>val</i>}]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} syncer [-a&#x00A0;{<i>dev_minor</i>}]
  [-r&#x00A0;{<i>rate</i>}] [-e&#x00A0;{ <i>extents</i>}]
  [-v&#x00A0;{<i>verify-hash-alg</i>}] [-c&#x00A0;{ <i>cpu-mask</i>}]
  [-C&#x00A0;{ <i>csums-hash-alg</i>}] [-R] [-p&#x00A0;{<i>plan_time</i>}]
  [-s&#x00A0;{ <i>fill_target</i>}] [-d&#x00A0;{<i>delay_target</i>}]
  [-m&#x00A0;{ <i>max_rate</i>}] [-n&#x00A0;{<i>ond-policy</i>}]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} disconnect</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} detach [-f]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} down</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} primary [-f] [-o]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} secondary</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} verify [-s&#x00A0;{<i>start-position</i>}]
  [-S&#x00A0;{<i>stop-position</i>}]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} invalidate</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} invalidate-remote</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} wait-connect [-t&#x00A0;{<i>wfc_timeout</i>}]
  [-d&#x00A0;{<i>degr_wfc_timeout</i>}] [-o&#x00A0;{
  <i>outdated_wfc_timeout</i>}] [-w]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} wait-sync [-t&#x00A0;{<i>wfc_timeout</i>}]
  [-d&#x00A0;{<i>degr_wfc_timeout</i>}] [-o&#x00A0;{
  <i>outdated_wfc_timeout</i>}] [-w]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} role</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} cstate</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} dstate</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} status</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} resize [-d&#x00A0;{<i>size</i>}]
  [-f&#x00A0;{<i>assume-peer-has-space</i>}] [-c&#x00A0;{
  <i>assume-clean</i>}]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} check-resize</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} pause-sync</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} resume-sync</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} outdate</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} show-gi</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} get-gi</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} show</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} suspend-io</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} resume-io</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} events [-u] [-a]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 10.00ex; text-indent: -10.00ex;"><b>drbdsetup</b>
  { <i>device</i>} new-current-uuid [-c]</div>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
drbdsetup is used to associate DRBD devices with their backing block devices, to
  set up DRBD device pairs to mirror their backing block devices, and to inspect
  the configuration of running DRBD devices.
<h1 class="Sh" title="Sh" id="NOTE"><a class="selflink" href="#NOTE">NOTE</a></h1>
drbdsetup is a low level tool of the DRBD program suite. It is used by the data
  disk and drbd scripts to communicate with the device driver.
<h1 class="Sh" title="Sh" id="COMMANDS"><a class="selflink" href="#COMMANDS">COMMANDS</a></h1>
Each drbdsetup sub-command might require arguments and bring its own set of
  options. All values have default units which might be overruled by K, M or G.
  These units are defined in the usual way (e.g. K = 2^10 = 1024).
<h2 class="Ss" title="Ss" id="Common_options"><a class="selflink" href="#Common_options">Common
  options</a></h2>
All drbdsetup sub-commands accept these two options
<div class="Pp"></div>
<b>--create-device</b>
<div style="margin-left: 4.00ex;">In case the specified DRBD device (minor
  number) does not exist yet, create it implicitly.</div>
<div class="Pp"></div>
<b>--set-defaults</b>
<div style="margin-left: 4.00ex;">When <b>--set-defaults</b> is given on the
  command line, all options of the invoked sub-command that are not explicitly
  set are reset to their default values.</div>
<h2 class="Ss" title="Ss" id="disk"><a class="selflink" href="#disk">disk</a></h2>
Associates <i>device</i> with <i>lower_device</i> to store its data blocks on.
  The <b>-d</b> (or <b>--disk-size</b>) should only be used if you wish not to
  use as much as possible from the backing block devices. If you do not use
  <b>-d</b>, the <i>device</i> is only ready for use as soon as it was connected
  to its peer once. (See the <b>net</b> command.)
<div class="Pp"></div>
<b>-d</b>, <b>--disk-size </b><b></b><i>size</i>
<div style="margin-left: 4.00ex;">You can override DRBD's size determination
  method with this option. If you need to use the device before it was ever
  connected to its peer, use this option to pass the <i>size</i> of the DRBD
  device to the driver. Default unit is sectors (1s = 512 bytes).
<div style="height: 1.00em;">&#x00A0;</div>
If you use the <i>size</i> parameter in drbd.conf, we strongly recommend to add
  an explicit unit postfix. drbdadm and drbdsetup used to have mismatching
  default units.</div>
<div class="Pp"></div>
<b>-e</b>, <b>--on-io-error </b><b></b><i>err_handler</i>
<div style="margin-left: 4.00ex;">If the driver of the <i>lower_device</i>
  reports an error to DRBD, DRBD will mark the disk as inconsistent, call a
  helper program, or detach the device from its backing storage and perform all
  further IO by requesting it from the peer. The valid <i>err_handlers</i> are:
  <b>pass_on</b>, <b>call-local-io-error</b> and <b>detach</b>.</div>
<div class="Pp"></div>
<b>-f</b>, <b>--fencing </b><b></b><i>fencing_policy</i>
<div style="margin-left: 4.00ex;">Under <b>fencing</b> we understand preventive
  measures to avoid situations where both nodes are primary and disconnected
  (AKA split brain).
<div style="height: 1.00em;">&#x00A0;</div>
Valid fencing policies are:
<div class="Pp"></div>
<b>dont-care</b>
<div style="margin-left: 4.00ex;">This is the default policy. No fencing actions
  are done.</div>
<div class="Pp"></div>
<b>resource-only</b>
<div style="margin-left: 4.00ex;">If a node becomes a disconnected primary, it
  tries to outdate the peer's disk. This is done by calling the fence-peer
  handler. The handler is supposed to reach the other node over alternative
  communication paths and call 'drbdadm outdate res' there.</div>
<div class="Pp"></div>
<b>resource-and-stonith</b>
<div style="margin-left: 4.00ex;">If a node becomes a disconnected primary, it
  freezes all its IO operations and calls its fence-peer handler. The fence-peer
  handler is supposed to reach the peer over alternative communication paths and
  call 'drbdadm outdate res' there. In case it cannot reach the peer, it should
  stonith the peer. IO is resumed as soon as the situation is resolved. In case
  your handler fails, you can resume IO with the <b>resume-io</b> command.</div>
</div>
<div class="Pp"></div>
<b>-b</b>, <b>--use-bmbv</b>
<div style="margin-left: 4.00ex;">In case the backing storage's driver has a
  merge_bvec_fn() function, DRBD has to pretend that it can only process IO
  requests in units not larger than 4 KiB. (At time of writing the only known
  drivers which have such a function are: md (software raid driver), dm (device
  mapper - LVM) and DRBD itself)
<div style="height: 1.00em;">&#x00A0;</div>
To get best performance out of DRBD on top of software raid (or any other driver
  with a merge_bvec_fn() function) you might enable this option, if you know for
  sure that the merge_bvec_fn() function will deliver the same results on all
  nodes of your cluster. I.e. the physical disks of the software raid are
  exactly of the same type. USE THIS OPTION ONLY IF YOU KNOW WHAT YOU ARE
  DOING.</div>
<div class="Pp"></div>
<b>-a</b>, <b>--no-disk-barrier</b>, <b>-i</b>, <b>--no-disk-flushes</b>,
  <b>-D</b>, <b>--no-disk-drain</b>
<div style="margin-left: 4.00ex;">DRBD has four implementations to express
  write-after-write dependencies to its backing storage device. DRBD will use
  the first method that is supported by the backing storage device and that is
  not disabled by the user.
<div style="height: 1.00em;">&#x00A0;</div>
When selecting the method you should not only base your decision on the
  measurable performance. In case your backing storage device has a volatile
  write cache (plain disks, RAID of plain disks) you should use one of the first
  two. In case your backing storage device has battery-backed write cache you
  may go with option 3. Option 4 (disable everything, use &quot;none&quot;)
  <i>is dangerous</i> on most IO stacks, may result in write-reordering, and if
  so, can theoretically be the reason for data corruption, or disturb the DRBD
  protocol, causing spurious disconnect/reconnect cycles. <i>Do not use</i>
  <b>no-disk-drain</b>.
<div style="height: 1.00em;">&#x00A0;</div>
Unfortunately device mapper (LVM) might not support barriers.
<div style="height: 1.00em;">&#x00A0;</div>
The letter after &quot;wo:&quot; in /proc/drbd indicates with method is
  currently in use for a device: b, f, d, n. The implementations:
<div class="Pp"></div>
barrier
<div style="margin-left: 4.00ex;">The first requires that the driver of the
  backing storage device support barriers (called 'tagged command queuing' in
  SCSI and 'native command queuing' in SATA speak). The use of this method can
  be disabled by the <b>--no-disk-barrier</b> option. Note: Since Linux-2.6.36
  (or RHEL's 2.6.32) this method is disabled.</div>
<div class="Pp"></div>
flush
<div style="margin-left: 4.00ex;">The second requires that the backing device
  support disk flushes (called 'force unit access' in the drive vendors speak).
  The use of this method can be disabled using the <b>--no-disk-flushes</b>
  option.</div>
<div class="Pp"></div>
drain
<div style="margin-left: 4.00ex;">The third method is simply to let write
  requests drain before write requests of a new reordering domain are issued.
  That was the only implementation before 8.0.9.</div>
<div class="Pp"></div>
none
<div style="margin-left: 4.00ex;">The fourth method is to not express
  write-after-write dependencies to the backing store at all, by also specifying
  <b>--no-disk-drain</b>. This <i>is dangerous</i> on most IO stacks, may result
  in write-reordering, and if so, can theoretically be the reason for data
  corruption, or disturb the DRBD protocol, causing spurious
  disconnect/reconnect cycles. <i>Do not use</i> <b>--no-disk-drain</b>.</div>
</div>
<div class="Pp"></div>
<b>-m</b>, <b>--no-md-flushes</b>
<div style="margin-left: 4.00ex;">Disables the use of disk flushes and barrier
  BIOs when accessing the meta data device. See the notes on
  <b>--no-disk-flushes</b>.</div>
<div class="Pp"></div>
<b>-s</b>, <b>--max-bio-bvecs</b>
<div style="margin-left: 4.00ex;">In some special circumstances the device
  mapper stack manages to pass BIOs to DRBD that violate the constraints that
  are set forth by DRBD's merge_bvec() function and which have more than one
  bvec. A known example is: phys-disk -&gt; DRBD -&gt; LVM -&gt; Xen -&gt;
  missaligned partition (63) -&gt; DomU FS. Then you might see &quot;bio would
  need to, but cannot, be split:&quot; in the Dom0's kernel log.
<div style="height: 1.00em;">&#x00A0;</div>
The best workaround is to proper align the partition within the VM (E.g. start
  it at sector 1024). That costs 480 KiB of storage. Unfortunately the default
  of most Linux partitioning tools is to start the first partition at an odd
  number (63). Therefore most distributions install helpers for virtual linux
  machines will end up with missaligned partitions. The second best workaround
  is to limit DRBD's max bvecs per BIO (i.e., the <b>max-bio-bvecs</b> option)
  to 1, but that might cost performance.
<div style="height: 1.00em;">&#x00A0;</div>
The default value of <b>max-bio-bvecs</b> is 0, which means that there is no
  user imposed limitation.</div>
<div class="Pp"></div>
<b>-t</b>, <b>--disk-timeout </b><b></b><i>disk_timeout</i>
<div style="margin-left: 4.00ex;">If the driver of the <i>lower_device</i> does
  not finish an IO request within <i>disk_timeout</i>, DRBD considers the disk
  as failed. If DRBD is connected to a remote host, it will reissue local
  pending IO requests to the peer, and ship all new IO requests to the peer
  only. The disk state advances to diskless, as soon as the backing block device
  has finished all IO requests.
<div style="height: 1.00em;">&#x00A0;</div>
The default value of is 0, which means that no timeout is enforced. The default
  unit is 100ms. This option is available since 8.3.12.</div>
<h2 class="Ss" title="Ss" id="net"><a class="selflink" href="#net">net</a></h2>
Sets up the <i>device</i> to listen on <i>af:local_addr:port</i> for incoming
  connections and to try to connect to <i>af:remote_addr:port</i>. If
  <i>port</i> is omitted, 7788 is used as default. If <i>af</i> is omitted
  <b>ipv4</b> gets used. Other supported address families are <b>ipv6</b>,
  <b>ssocks</b> for Dolphin Interconnect Solutions' &quot;super sockets&quot;
  and <b>sdp</b> for Sockets Direct Protocol (Infiniband).
<div class="Pp"></div>
On the TCP/IP link the specified <i>protocol</i> is used. Valid protocol
  specifiers are A, B, and C.
<div class="Pp"></div>
Protocol A: write IO is reported as completed, if it has reached local disk and
  local TCP send buffer.
<div class="Pp"></div>
Protocol B: write IO is reported as completed, if it has reached local disk and
  remote buffer cache.
<div class="Pp"></div>
Protocol C: write IO is reported as completed, if it has reached both local and
  remote disk.
<div class="Pp"></div>
<b>-c</b>, <b>--connect-int </b><b></b><i>time</i>
<div style="margin-left: 4.00ex;">In case it is not possible to connect to the
  remote DRBD device immediately, DRBD keeps on trying to connect. With this
  option you can set the time between two retries. The default value is 10
  seconds, the unit is 1 second.</div>
<div class="Pp"></div>
<b>-i</b>, <b>--ping-int </b><b></b><i>time</i>
<div style="margin-left: 4.00ex;">If the TCP/IP connection linking a DRBD device
  pair is idle for more than <i>time</i> seconds, DRBD will generate a
  keep-alive packet to check if its partner is still alive. The default value is
  10 seconds, the unit is 1 second.</div>
<div class="Pp"></div>
<b>-t</b>, <b>--timeout </b><b></b><i>val</i>
<div style="margin-left: 4.00ex;">If the partner node fails to send an expected
  response packet within <i>val</i> tenths of a second, the partner node is
  considered dead and therefore the TCP/IP connection is abandoned. The default
  value is 60 (= 6 seconds).</div>
<div class="Pp"></div>
<b>-S</b>, <b>--sndbuf-size </b><b></b><i>size</i>
<div style="margin-left: 4.00ex;">The socket send buffer is used to store
  packets sent to the secondary node, which are not yet acknowledged (from a
  network point of view) by the secondary node. When using protocol A, it might
  be necessary to increase the size of this data structure in order to increase
  asynchronicity between primary and secondary nodes. But keep in mind that more
  asynchronicity is synonymous with more data loss in the case of a primary node
  failure. Since 8.0.13 resp. 8.2.7 setting the <i>size</i> value to 0 means
  that the kernel should autotune this. The default <i>size</i> is 0, i.e.
  autotune.</div>
<div class="Pp"></div>
<b>-r</b>, <b>--rcvbuf-size </b><b></b><i>size</i>
<div style="margin-left: 4.00ex;">Packets received from the network are stored
  in the socket receive buffer first. From there they are consumed by DRBD.
  Before 8.3.2 the receive buffer's size was always set to the size of the
  socket send buffer. Since 8.3.2 they can be tuned independently. A value of 0
  means that the kernel should autotune this. The default <i>size</i> is 0, i.e.
  autotune.</div>
<div class="Pp"></div>
<b>-k</b>, <b>--ko-count </b><b></b><i>count</i>
<div style="margin-left: 4.00ex;">In case the secondary node fails to complete a
  single write request for <i>count</i> times the <i>timeout</i>, it is expelled
  from the cluster, i.e. the primary node goes into StandAlone mode. To disable
  this feature, you should explicitly set it to 0; defaults may change between
  versions.</div>
<div class="Pp"></div>
<b>-e</b>, <b>--max-epoch-size </b><b></b><i>val</i>
<div style="margin-left: 4.00ex;">With this option the maximal number of write
  requests between two barriers is limited. Typically set to the same as
  <b>--max-buffers</b>, or the allowed maximum. Values smaller than 10 can lead
  to degraded performance. The default value is 2048.</div>
<div class="Pp"></div>
<b>-b</b>, <b>--max-buffers </b><b></b><i>val</i>
<div style="margin-left: 4.00ex;">With this option the maximal number of buffer
  pages allocated by DRBD's receiver thread is limited. Typically set to the
  same as <b>--max-epoch-size</b>. Small values could lead to degraded
  performance. The default value is 2048, the minimum 32. Increase this if you
  cannot saturate the IO backend of the receiving side during linear write or
  during resync while otherwise idle.
<div style="height: 1.00em;">&#x00A0;</div>
See also <b>drbd.conf</b>(5)</div>
<div class="Pp"></div>
<b>-u</b>, <b>--unplug-watermark </b><b></b><i>val</i>
<div style="margin-left: 4.00ex;">This setting has no effect with recent kernels
  that use explicit on-stack plugging (upstream Linux kernel 2.6.39,
  distributions may have backported).
<div style="height: 1.00em;">&#x00A0;</div>
When the number of pending write requests on the standby (secondary) node
  exceeds the unplug-watermark, we trigger the request processing of our backing
  storage device. Some storage controllers deliver better performance with small
  values, others deliver best performance when the value is set to the same
  value as max-buffers, yet others don't feel much effect at all. Minimum 16,
  default 128, maximum 131072.</div>
<div class="Pp"></div>
<b>-m</b>, <b>--allow-two-primaries </b>
<div style="margin-left: 4.00ex;">With this option set you may assign primary
  role to both nodes. You only should use this option if you use a shared
  storage file system on top of DRBD. At the time of writing the only ones are:
  OCFS2 and GFS. If you use this option with any other file system, you are
  going to crash your nodes and to corrupt your data!</div>
<div class="Pp"></div>
<b>-a</b>, <b>--cram-hmac-alg </b><i>alg</i>
<div style="margin-left: 4.00ex;">You need to specify the HMAC algorithm to
  enable peer authentication at all. You are strongly encouraged to use peer
  authentication. The HMAC algorithm will be used for the challenge response
  authentication of the peer. You may specify any digest algorithm that is named
  in /proc/crypto.</div>
<div class="Pp"></div>
<b>-x</b>, <b>--shared-secret </b><i>secret</i>
<div style="margin-left: 4.00ex;">The shared secret used in peer authentication.
  May be up to 64 characters.</div>
<div class="Pp"></div>
<b>-A</b>, <b>--after-sb-0pri </b><i>asb-0p-policy</i>
<div style="margin-left: 4.00ex;">possible policies are:
<div class="Pp"></div>
<b>disconnect</b>
<div style="margin-left: 4.00ex;">No automatic resynchronization, simply
  disconnect.</div>
<div class="Pp"></div>
<b>discard-younger-primary</b>
<div style="margin-left: 4.00ex;">Auto sync from the node that was primary
  before the split-brain situation occurred.</div>
<div class="Pp"></div>
<b>discard-older-primary</b>
<div style="margin-left: 4.00ex;">Auto sync from the node that became primary as
  second during the split-brain situation.</div>
<div class="Pp"></div>
<b>discard-zero-changes</b>
<div style="margin-left: 4.00ex;">In case one node did not write anything since
  the split brain became evident, sync from the node that wrote something to the
  node that did not write anything. In case none wrote anything this policy uses
  a random decision to perform a &quot;resync&quot; of 0 blocks. In case both
  have written something this policy disconnects the nodes.</div>
<div class="Pp"></div>
<b>discard-least-changes</b>
<div style="margin-left: 4.00ex;">Auto sync from the node that touched more
  blocks during the split brain situation.</div>
<div class="Pp"></div>
<b>discard-node-NODENAME</b>
<div style="margin-left: 4.00ex;">Auto sync to the named node.</div>
</div>
<div class="Pp"></div>
<b>-B</b>, <b>--after-sb-1pri </b><i>asb-1p-policy</i>
<div style="margin-left: 4.00ex;">possible policies are:
<div class="Pp"></div>
<b>disconnect</b>
<div style="margin-left: 4.00ex;">No automatic resynchronization, simply
  disconnect.</div>
<div class="Pp"></div>
<b>consensus</b>
<div style="margin-left: 4.00ex;">Discard the version of the secondary if the
  outcome of the <b>after-sb-0pri</b> algorithm would also destroy the current
  secondary's data. Otherwise disconnect.</div>
<div class="Pp"></div>
<b>discard-secondary</b>
<div style="margin-left: 4.00ex;">Discard the secondary's version.</div>
<div class="Pp"></div>
<b>call-pri-lost-after-sb</b>
<div style="margin-left: 4.00ex;">Always honor the outcome of the
  <b>after-sb-0pri </b> algorithm. In case it decides the current secondary has
  the correct data, call the <b>pri-lost-after-sb</b> on the current
  primary.</div>
<div class="Pp"></div>
<b>violently-as0p</b>
<div style="margin-left: 4.00ex;">Always honor the outcome of the
  <b>after-sb-0pri </b> algorithm. In case it decides the current secondary has
  the correct data, accept a possible instantaneous change of the primary's
  data.</div>
</div>
<div class="Pp"></div>
<b>-C</b>, <b>--after-sb-2pri </b><i>asb-2p-policy</i>
<div style="margin-left: 4.00ex;">possible policies are:
<div class="Pp"></div>
<b>disconnect</b>
<div style="margin-left: 4.00ex;">No automatic resynchronization, simply
  disconnect.</div>
<div class="Pp"></div>
<b>call-pri-lost-after-sb</b>
<div style="margin-left: 4.00ex;">Always honor the outcome of the
  <b>after-sb-0pri </b> algorithm. In case it decides the current secondary has
  the right data, call the <b>pri-lost-after-sb</b> on the current
  primary.</div>
<div class="Pp"></div>
<b>violently-as0p</b>
<div style="margin-left: 4.00ex;">Always honor the outcome of the
  <b>after-sb-0pri </b> algorithm. In case it decides the current secondary has
  the right data, accept a possible instantaneous change of the primary's
  data.</div>
</div>
<div class="Pp"></div>
<b>-P</b>, <b>--always-asbp</b>
<div style="margin-left: 4.00ex;">Normally the automatic after-split-brain
  policies are only used if current states of the UUIDs do not indicate the
  presence of a third node.
<div style="height: 1.00em;">&#x00A0;</div>
With this option you request that the automatic after-split-brain policies are
  used as long as the data sets of the nodes are somehow related. This might
  cause a full sync, if the UUIDs indicate the presence of a third node. (Or
  double faults have led to strange UUID sets.)</div>
<div class="Pp"></div>
<b>-R</b>, <b>--rr-conflict </b><i>role-resync-conflict-policy</i>
<div style="margin-left: 4.00ex;">This option sets DRBD's behavior when DRBD
  deduces from its meta data that a resynchronization is needed, and the
  SyncTarget node is already primary. The possible settings are:
  <b>disconnect</b>, <b>call-pri-lost</b> and <b>violently</b>. While
  <b>disconnect</b> speaks for itself, with the <b>call-pri-lost</b> setting the
  <b>pri-lost</b> handler is called which is expected to either change the role
  of the node to secondary, or remove the node from the cluster. The default is
  <b>disconnect</b>.
<div style="height: 1.00em;">&#x00A0;</div>
With the <b>violently</b> setting you allow DRBD to force a primary node into
  SyncTarget state. This means that the data exposed by DRBD changes to the
  SyncSource's version of the data instantaneously. USE THIS OPTION ONLY IF YOU
  KNOW WHAT YOU ARE DOING.</div>
<div class="Pp"></div>
<b>-d</b>, <b>--data-integrity-alg </b><i>hash_alg</i>
<div style="margin-left: 4.00ex;">DRBD can ensure the data integrity of the
  user's data on the network by comparing hash values. Normally this is ensured
  by the 16 bit checksums in the headers of TCP/IP packets. This option can be
  set to any of the kernel's data digest algorithms. In a typical kernel
  configuration you should have at least one of <b>md5</b>, <b>sha1</b>, and
  <b>crc32c</b> available. By default this is not enabled.
<div style="height: 1.00em;">&#x00A0;</div>
See also the notes on data integrity on the drbd.conf manpage.</div>
<div class="Pp"></div>
<b>-o</b>, <b>--no-tcp-cork </b>
<div style="margin-left: 4.00ex;">DRBD usually uses the TCP socket option
  TCP_CORK to hint to the network stack when it can expect more data, and when
  it should flush out what it has in its send queue. There is at least one
  network stack that performs worse when one uses this hinting method. Therefore
  we introduced this option, which disable the setting and clearing of the
  TCP_CORK socket option by DRBD.</div>
<div class="Pp"></div>
<b>-p</b>, <b>--ping-timeout </b><i>ping_timeout</i>
<div style="margin-left: 4.00ex;">The time the peer has to answer to a
  keep-alive packet. In case the peer's reply is not received within this time
  period, it is considered dead. The default unit is tenths of a second, the
  default value is 5 (for half a second).</div>
<div class="Pp"></div>
<b>-D</b>, <b>--discard-my-data </b>
<div style="margin-left: 4.00ex;">Use this option to manually recover from a
  split-brain situation. In case you do not have any automatic after-split-brain
  policies selected, the nodes refuse to connect. By passing this option you
  make this node a sync target immediately after successful connect.</div>
<div class="Pp"></div>
<b>-n</b>, <b>--dry-run </b>
<div style="margin-left: 4.00ex;">Causes DRBD to abort the connection process
  after the resync handshake, i.e. no resync gets performed. You can find out
  which resync DRBD would perform by looking at the kernel's log file.</div>
<div class="Pp"></div>
<b>-g</b>, <b>--on-congestion </b><i>congestion_policy</i>, <b>-f</b>,
  <b>--congestion-fill </b> <i>fill_threshold</i>, <b>-h</b>,
  <b>--congestion-extents </b> <i>active_extents_threshold</i>
<div style="margin-left: 4.00ex;">By default DRBD blocks when the available TCP
  send queue becomes full. That means it will slow down the application that
  generates the write requests that cause DRBD to send more data down that TCP
  connection.
<div style="height: 1.00em;">&#x00A0;</div>
When DRBD is deployed with DRBD-proxy it might be more desirable that DRBD goes
  into AHEAD/BEHIND mode shortly before the send queue becomes full. In
  AHEAD/BEHIND mode DRBD does no longer replicate data, but still keeps the
  connection open.
<div style="height: 1.00em;">&#x00A0;</div>
The advantage of the AHEAD/BEHIND mode is that the application is not slowed
  down, even if DRBD-proxy's buffer is not sufficient to buffer all write
  requests. The downside is that the peer node falls behind, and that a resync
  will be necessary to bring it back into sync. During that resync the peer node
  will have an inconsistent disk.
<div style="height: 1.00em;">&#x00A0;</div>
Available <i>congestion_policy</i>s are <b>block</b> and <b>pull-ahead</b>. The
  default is <b>block</b>. <i>Fill_threshold</i> might be in the range of 0 to
  10GiBytes. The default is 0 which disables the check.
  <i>Active_extents_threshold</i> has the same limits as <b>al-extents</b>.
<div style="height: 1.00em;">&#x00A0;</div>
The AHEAD/BEHIND mode and its settings are available since DRBD 8.3.10.</div>
<h2 class="Ss" title="Ss" id="syncer"><a class="selflink" href="#syncer">syncer</a></h2>
Changes the synchronization daemon parameters of <i>device</i> at runtime.
<div class="Pp"></div>
<b>-r</b>, <b>--rate </b><b></b><i>rate</i>
<div style="margin-left: 4.00ex;">To ensure smooth operation of the application
  on top of DRBD, it is possible to limit the bandwidth that may be used by
  background synchronization. The default is 250 KiB/sec, the default unit is
  KiB/sec.</div>
<div class="Pp"></div>
<b>-a</b>, <b>--after </b><b></b><i>minor</i>
<div style="margin-left: 4.00ex;">Start resync on this device only if the device
  with <i>minor</i> is already in connected state. Otherwise this device waits
  in SyncPause state.</div>
<div class="Pp"></div>
<b>-e</b>, <b>--al-extents </b><b></b><i>extents</i>
<div style="margin-left: 4.00ex;">DRBD automatically performs hot area
  detection. With this parameter you control how big the hot area (=active set)
  can get. Each extent marks 4M of the backing storage. In case a primary node
  leaves the cluster unexpectedly, the areas covered by the active set must be
  resynced upon rejoining of the failed node. The data structure is stored in
  the meta-data area, therefore each change of the active set is a write
  operation to the meta-data device. A higher number of extents gives longer
  resync times but less updates to the meta-data. The default number of
  <i>extents</i> is 127. (Minimum: 7, Maximum: 3843)</div>
<div class="Pp"></div>
<b>-v</b>, <b>--verify-alg </b><b></b><i>hash-alg</i>
<div style="margin-left: 4.00ex;">During online verification (as initiated by
  the <b>verify</b> sub-command), rather than doing a bit-wise comparison, DRBD
  applies a hash function to the contents of every block being verified, and
  compares that hash with the peer. This option defines the hash algorithm being
  used for that purpose. It can be set to any of the kernel's data digest
  algorithms. In a typical kernel configuration you should have at least one of
  <b>md5</b>, <b>sha1</b>, and <b>crc32c</b> available. By default this is not
  enabled; you must set this option explicitly in order to be able to use
  on-line device verification.
<div style="height: 1.00em;">&#x00A0;</div>
See also the notes on data integrity on the drbd.conf manpage.</div>
<div class="Pp"></div>
<b>-c</b>, <b>--cpu-mask </b><b></b><i>cpu-mask</i>
<div style="margin-left: 4.00ex;">Sets the cpu-affinity-mask for DRBD's kernel
  threads of this device. The default value of <i>cpu-mask</i> is 0, which means
  that DRBD's kernel threads should be spread over all CPUs of the machine. This
  value must be given in hexadecimal notation. If it is too big it will be
  truncated.</div>
<div class="Pp"></div>
<b>-C</b>, <b>--csums-alg </b><b></b><i>hash-alg</i>
<div style="margin-left: 4.00ex;">A resync process sends all marked data blocks
  form the source to the destination node, as long as no <b>csums-alg</b> is
  given. When one is specified the resync process exchanges hash values of all
  marked blocks first, and sends only those data blocks over, that have
  different hash values.
<div style="height: 1.00em;">&#x00A0;</div>
This setting is useful for DRBD setups with low bandwidth links. During the
  restart of a crashed primary node, all blocks covered by the activity log are
  marked for resync. But a large part of those will actually be still in sync,
  therefore using <b>csums-alg</b> will lower the required bandwidth in exchange
  for CPU cycles.</div>
<div class="Pp"></div>
<b>-R</b>, <b>--use-rle</b>
<div style="margin-left: 4.00ex;">During resync-handshake, the dirty-bitmaps of
  the nodes are exchanged and merged (using bit-or), so the nodes will have the
  same understanding of which blocks are dirty. On large devices, the fine
  grained dirty-bitmap can become large as well, and the bitmap exchange can
  take quite some time on low-bandwidth links.
<div style="height: 1.00em;">&#x00A0;</div>
Because the bitmap typically contains compact areas where all bits are unset
  (clean) or set (dirty), a simple run-length encoding scheme can considerably
  reduce the network traffic necessary for the bitmap exchange.
<div style="height: 1.00em;">&#x00A0;</div>
For backward compatibilty reasons, and because on fast links this possibly does
  not improve transfer time but consumes cpu cycles, this defaults to off.
<div style="height: 1.00em;">&#x00A0;</div>
Introduced in 8.3.2.</div>
<div class="Pp"></div>
<b>-p</b>, <b>--c-plan-ahead </b><b></b><i>plan_time</i>, <b>-s</b>,
  <b>--c-fill-target </b> <b></b><i>fill_target</i>, <b>-d</b>,
  <b>--c-delay-target </b> <b></b><i>delay_target</i>, <b>-M</b>,
  <b>--c-max-rate </b> <b></b><i>max_rate</i>
<div style="margin-left: 4.00ex;">The dynamic resync speed controller gets
  enabled with setting <i>plan_time</i> to a positive value. It aims to fill the
  buffers along the data path with either a constant amount of data
  <i>fill_target</i>, or aims to have a constant delay time of
  <i>delay_target</i> along the path. The controller has an upper bound of
  <i>max_rate</i>.
<div style="height: 1.00em;">&#x00A0;</div>
By <i>plan_time</i> the agility of the controller is configured. Higher values
  yield for slower/lower responses of the controller to deviation from the
  target value. It should be at least 5 times RTT. For regular data paths a
  <i>fill_target</i> in the area of 4k to 100k is appropriate. For a setup that
  contains drbd-proxy it is advisable to use <i>delay_target</i> instead. Only
  when <i>fill_target</i> is set to 0 the controller will use
  <i>delay_target</i>. 5 times RTT is a reasonable starting value.
  <i>Max_rate</i> should be set to the bandwidth available between the
  DRBD-hosts and the machines hosting DRBD-proxy, or to the available
  disk-bandwidth.
<div style="height: 1.00em;">&#x00A0;</div>
The default value of <i>plan_time</i> is 0, the default unit is 0.1 seconds.
  <i>Fill_target</i> has 0 and sectors as default unit. <i>Delay_target</i> has
  1 (100ms) and 0.1 as default unit. <i>Max_rate</i> has 10240 (100MiB/s) and
  KiB/s as default unit.</div>
<div class="Pp"></div>
<b>-m</b>, <b>--c-min-rate </b><b></b><i>min_rate</i>
<div style="margin-left: 4.00ex;">We track the disk IO rate caused by the
  resync, so we can detect non-resync IO on the lower level device. If the lower
  level device seems to be busy, and the current resync rate is above
  <i>min_rate</i>, we throttle the resync.
<div style="height: 1.00em;">&#x00A0;</div>
The default value of <i>min_rate</i> is 4M, the default unit is k. If you want
  to not throttle at all, set it to zero, if you want to throttle always, set it
  to one.</div>
<div class="Pp"></div>
<b>-n</b>, <b>--on-no-data-accessible </b><b></b><i>ond-policy</i>
<div style="margin-left: 4.00ex;">This setting controls what happens to IO
  requests on a degraded, disk less node (I.e. no data store is reachable). The
  available policies are <b>io-error</b> and <b>suspend-io</b>.
<div style="height: 1.00em;">&#x00A0;</div>
If <i>ond-policy</i> is set to <b>suspend-io</b> you can either resume IO by
  attaching/connecting the last lost data storage, or by the <b>drbdadm
  resume-io </b> <b></b><i>res</i> command. The latter will result in IO errors
  of course.
<div style="height: 1.00em;">&#x00A0;</div>
The default is <b>io-error</b>. This setting is available since DRBD
  8.3.9.</div>
<h2 class="Ss" title="Ss" id="primary"><a class="selflink" href="#primary">primary</a></h2>
Sets the <i>device</i> into primary role. This means that applications (e.g. a
  file system) may open the <i>device</i> for read and write access. Data
  written to the <i>device</i> in primary role are mirrored to the device in
  secondary role.
<div class="Pp"></div>
Normally it is not possible to set both devices of a connected DRBD device pair
  to primary role. By using the <b>--allow-two-primaries</b> option, you
  override this behavior and instruct DRBD to allow two primaries.
<div class="Pp"></div>
<b>-o</b>, <b>--overwrite-data-of-peer</b>
<div style="margin-left: 4.00ex;">Alias for --force.</div>
<div class="Pp"></div>
<b>-f</b>, <b>--force</b>
<div style="margin-left: 4.00ex;">Becoming primary fails if the local replica is
  not up-to-date. I.e. when it is inconsistent, outdated of consistent. By using
  this option you can force it into primary role anyway. USE THIS OPTION ONLY IF
  YOU KNOW WHAT YOU ARE DOING.</div>
<h2 class="Ss" title="Ss" id="secondary"><a class="selflink" href="#secondary">secondary</a></h2>
Brings the <i>device</i> into secondary role. This operation fails as long as at
  least one application (or file system) has opened the device.
<div class="Pp"></div>
It is possible that both devices of a connected DRBD device pair are secondary.
<h2 class="Ss" title="Ss" id="verify"><a class="selflink" href="#verify">verify</a></h2>
This initiates on-line device verification. During on-line verification, the
  contents of every block on the local node are compared to those on the peer
  node. Device verification progress can be monitored via /proc/drbd. Any blocks
  whose content differs from that of the corresponding block on the peer node
  will be marked out-of-sync in DRBD's on-disk bitmap; they are <i>not</i>
  brought back in sync automatically. To do that, simply disconnect and
  reconnect the resource.
<div class="Pp"></div>
If on-line verification is already in progress (and this node is
  &quot;VerifyS&quot;), this command silently &quot;succeeds&quot;. In this
  case, any start-sector (see below) will be ignored, and any stop-sector (see
  below) will be honored. This can be used to stop a running verify, or to
  update/shorten/extend the coverage of the currently running verify.
<div class="Pp"></div>
This command will fail if the <i>device</i> is not part of a connected device
  pair.
<div class="Pp"></div>
See also the notes on data integrity on the drbd.conf manpage.
<div class="Pp"></div>
<b>-s</b>, <b>--start </b><b></b><i>start-sector</i>
<div style="margin-left: 4.00ex;">Since version 8.3.2, on-line verification
  should resume from the last position after connection loss. It may also be
  started from an arbitrary position by setting this option. If you had reached
  some stop-sector before, and you do not specify an explicit start-sector,
  verify should resume from the previous stop-sector.
<div style="height: 1.00em;">&#x00A0;</div>
Default unit is sectors. You may also specify a unit explicitly. The
  <b>start-sector</b> will be rounded down to a multiple of 8 sectors
  (4kB).</div>
<div class="Pp"></div>
<b>-S</b>, <b>--stop </b><b></b><i>stop-sector</i>
<div style="margin-left: 4.00ex;">Since version 8.3.14, on-line verification can
  be stopped before it reaches end-of-device. This can be
<div style="height: 1.00em;">&#x00A0;</div>
Default unit is sectors. You may also specify a unit explicitly. The
  <b>stop-sector</b> may be updated by issuing an additional drbdsetup verify
  command on the same node while the verify is running.</div>
<h2 class="Ss" title="Ss" id="invalidate"><a class="selflink" href="#invalidate">invalidate</a></h2>
This forces the local device of a pair of connected DRBD devices into SyncTarget
  state, which means that all data blocks of the device are copied over from the
  peer.
<div class="Pp"></div>
This command will fail if the <i>device</i> is not either part of a connected
  device pair, or disconnected Secondary.
<h2 class="Ss" title="Ss" id="invalidate-remote"><a class="selflink" href="#invalidate-remote">invalidate-remote</a></h2>
This forces the local device of a pair of connected DRBD devices into SyncSource
  state, which means that all data blocks of the device are copied to the peer.
<div class="Pp"></div>
On a disconnected Primary device, this will set all bits in the out of sync
  bitmap. As a side affect this suspends updates to the on disk activity log.
  Updates to the on disk activity log resume automatically when necessary.
<h2 class="Ss" title="Ss" id="wait-connect"><a class="selflink" href="#wait-connect">wait-connect</a></h2>
Returns as soon as the <i>device</i> can communicate with its partner device.
<div class="Pp"></div>
<b>-t</b>, <b>--wfc-timeout </b><b></b><i>wfc_timeout</i>, <b>-d</b>,
  <b>--degr-wfc-timeout </b> <b></b><i>degr_wfc_timeout</i>, <b>-o</b>,
  <b>--outdated-wfc-timeout </b> <b></b><i>outdated_wfc_timeout</i>, <b>-w</b>,
  <b>--wait-after-sb</b>
<div style="margin-left: 4.00ex;">This command will fail if the <i>device</i>
  cannot communicate with its partner for <i>timeout</i> seconds. If the peer
  was working before this node was rebooted, the <i>wfc_timeout</i> is used. If
  the peer was already down before this node was rebooted, the
  <i>degr_wfc_timeout</i> is used. If the peer was sucessfully outdated before
  this node was rebooted the <i>outdated_wfc_timeout</i> is used. The default
  value for all those timeout values is 0 which means to wait forever. In case
  the connection status goes down to StandAlone because the peer appeared but
  the devices had a split brain situation, the default for the command is to
  terminate. You can change this behavior with the <b>--wait-after-sb</b>
  option.</div>
<h2 class="Ss" title="Ss" id="wait-sync"><a class="selflink" href="#wait-sync">wait-sync</a></h2>
Returns as soon as the <i>device</i> leaves any synchronization into connected
  state. The options are the same as with the <i>wait-connect</i> command.
<h2 class="Ss" title="Ss" id="disconnect"><a class="selflink" href="#disconnect">disconnect</a></h2>
Removes the information set by the <b>net</b> command from the <i>device</i>.
  This means that the <i>device</i> goes into unconnected state and will no
  longer listen for incoming connections.
<h2 class="Ss" title="Ss" id="detach"><a class="selflink" href="#detach">detach</a></h2>
Removes the information set by the <b>disk</b> command from the <i>device</i>.
  This means that the <i>device</i> is detached from its backing storage device.
<div class="Pp"></div>
<b>-f</b>, <b>--force</b>
<div style="margin-left: 4.00ex;">A regular detach returns after the disk state
  finally reached diskless. As a consequence detaching from a frozen backing
  block device never terminates.
<div style="height: 1.00em;">&#x00A0;</div>
On the other hand A forced detach returns immediately. It allows you to detach
  DRBD from a frozen backing block device. Please note that the disk will be
  marked as failed until all pending IO requests where finished by the backing
  block device.</div>
<h2 class="Ss" title="Ss" id="down"><a class="selflink" href="#down">down</a></h2>
Removes all configuration information from the <i>device</i> and forces it back
  to unconfigured state.
<h2 class="Ss" title="Ss" id="role"><a class="selflink" href="#role">role</a></h2>
Shows the current roles of the <i>device</i> and its peer, as
  <i>local</i>/<i>peer</i>.
<h2 class="Ss" title="Ss" id="state"><a class="selflink" href="#state">state</a></h2>
Deprecated alias for &quot;role&quot;
<h2 class="Ss" title="Ss" id="cstate"><a class="selflink" href="#cstate">cstate</a></h2>
Shows the current connection state of the <i>device</i>.
<h2 class="Ss" title="Ss" id="dstate"><a class="selflink" href="#dstate">dstate</a></h2>
Shows the current states of the backing storage devices, as
  <i>local</i>/<i>peer</i>.
<h2 class="Ss" title="Ss" id="status"><a class="selflink" href="#status">status</a></h2>
Shows the current status of the device in XML-like format. Example output:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
&lt;resource minor=&quot;0&quot; name=&quot;s0&quot; cs=&quot;SyncTarget&quot; st1=&quot;Secondary&quot; st2=&quot;Secondary&quot;
         ds1=&quot;Inconsistent&quot; ds2=&quot;UpToDate&quot; resynced_precent=&quot;5.9&quot; /&gt;
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="resize"><a class="selflink" href="#resize">resize</a></h2>
This causes DRBD to reexamine the size of the <i>device</i>'s backing storage
  device. To actually do online growing you need to extend the backing storages
  on both devices and call the <b>resize</b> command on one of your nodes.
<div class="Pp"></div>
The <b>--assume-peer-has-space</b> allows you to resize a device which is
  currently not connected to the peer. Use with care, since if you do not resize
  the peer's disk as well, further connect attempts of the two will fail.
<div class="Pp"></div>
When the <b>--assume-clean</b> option is given DRBD will skip the resync of the
  new storage. Only do this if you know that the new storage was initialized to
  the same content by other means.
<h2 class="Ss" title="Ss" id="check-resize"><a class="selflink" href="#check-resize">check-resize</a></h2>
To enable DRBD to detect offline resizing of backing devices this command may be
  used to record the current size of backing devices. The size is stored in
  files in /var/lib/drbd/ named drbd-minor-??.lkbd
<div class="Pp"></div>
This command is called by <b>drbdadm resize </b><b></b><i>res</i> after
  <b>drbdsetup </b> <b></b><i>device</i><b> resize</b> returned.
<h2 class="Ss" title="Ss" id="pause-sync"><a class="selflink" href="#pause-sync">pause-sync</a></h2>
Temporarily suspend an ongoing resynchronization by setting the local pause
  flag. Resync only progresses if neither the local nor the remote pause flag is
  set. It might be desirable to postpone DRBD's resynchronization after eventual
  resynchronization of the backing storage's RAID setup.
<h2 class="Ss" title="Ss" id="resume-sync"><a class="selflink" href="#resume-sync">resume-sync</a></h2>
Unset the local sync pause flag.
<h2 class="Ss" title="Ss" id="outdate"><a class="selflink" href="#outdate">outdate</a></h2>
Mark the data on the local backing storage as outdated. An outdated device
  refuses to become primary. This is used in conjunction with <b>fencing</b> and
  by the peer's <b>fence-peer</b> handler.
<h2 class="Ss" title="Ss" id="show-gi"><a class="selflink" href="#show-gi">show-gi</a></h2>
Displays the device's data generation identifiers verbosely.
<h2 class="Ss" title="Ss" id="get-gi"><a class="selflink" href="#get-gi">get-gi</a></h2>
Displays the device's data generation identifiers.
<h2 class="Ss" title="Ss" id="show"><a class="selflink" href="#show">show</a></h2>
Shows all available configuration information of the <i>device</i>.
<h2 class="Ss" title="Ss" id="suspend-io"><a class="selflink" href="#suspend-io">suspend-io</a></h2>
This command is of no apparent use and just provided for the sake of
  completeness.
<h2 class="Ss" title="Ss" id="resume-io"><a class="selflink" href="#resume-io">resume-io</a></h2>
If the fence-peer handler fails to stonith the peer node, and your
  <b>fencing</b> policy is set to resource-and-stonith, you can unfreeze IO
  operations with this command.
<h2 class="Ss" title="Ss" id="events"><a class="selflink" href="#events">events</a></h2>
Displays every state change of DRBD and all calls to helper programs. This might
  be used to get notified of DRBD's state changes by piping the output to
  another program.
<div class="Pp"></div>
<b>-a</b>, <b>--all-devices</b>
<div style="margin-left: 4.00ex;">Display the events of all DRBD minors.</div>
<div class="Pp"></div>
<b>-u</b>, <b>--unfiltered</b>
<div style="margin-left: 4.00ex;">This is a debugging aid that displays the
  content of all received netlink messages.</div>
<h2 class="Ss" title="Ss" id="new-current-uuid"><a class="selflink" href="#new-current-uuid">new-current-uuid</a></h2>
Generates a new current UUID and rotates all other UUID values. This has at
  least two use cases, namely to skip the initial sync, and to reduce network
  bandwidth when starting in a single node configuration and then later
  (re-)integrating a remote site.
<div class="Pp"></div>
Available option:
<div class="Pp"></div>
<b>-c</b>, <b>--clear-bitmap</b>
<div style="margin-left: 4.00ex;">Clears the sync bitmap in addition to
  generating a new current UUID.</div>
<div class="Pp"></div>
This can be used to skip the initial sync, if you want to start from scratch.
  This use-case does only work on &quot;Just Created&quot; meta data. Necessary
  steps:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 1.On <i>both</i> nodes, initialize meta data
  and configure the device.
<div style="height: 1.00em;">&#x00A0;</div>
<b>drbdadm -- --force create-md </b><b></b><i>res</i></div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 2.They need to do the initial handshake, so
  they know their sizes.
<div style="height: 1.00em;">&#x00A0;</div>
<b>drbdadm up </b><b></b><i>res</i></div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 3.They are now Connected Secondary/Secondary
  Inconsistent/Inconsistent. Generate a new current-uuid and clear the dirty
  bitmap.
<div style="height: 1.00em;">&#x00A0;</div>
<b>drbdadm -- --clear-bitmap new-current-uuid </b><b></b><i>res</i></div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 4.They are now Connected Secondary/Secondary
  UpToDate/UpToDate. Make one side primary and create a file system.
<div style="height: 1.00em;">&#x00A0;</div>
<b>drbdadm primary </b><b></b><i>res</i>
<div style="height: 1.00em;">&#x00A0;</div>
<b>mkfs -t </b><b></b><i>fs-type</i><b> $(drbdadm sh-dev
  </b><b></b><i>res</i><b>)</b></div>
<div class="Pp"></div>
One obvious side-effect is that the replica is full of old garbage (unless you
  made them identical using other means), so any online-verify is expected to
  find any number of out-of-sync blocks.
<div class="Pp"></div>
<i>You must not use this on pre-existing data!</i> Even though it may appear to
  work at first glance, once you switch to the other node, your data is toast,
  as it never got replicated. So <i>do not leave out the mkfs</i> (or
  equivalent).
<div class="Pp"></div>
This can also be used to shorten the initial resync of a cluster where the
  second node is added after the first node is gone into production, by means of
  disk shipping. This use-case works on disconnected devices only, the device
  may be in primary or secondary role.
<div class="Pp"></div>
The necessary steps on the current active server are:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 1.<b>drbdsetup </b><b></b><i>device</i><b>
  new-current-uuid --clear-bitmap</b></div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 2.Take the copy of the current active server.
  E.g. by pulling a disk out of the RAID1 controller, or by copying with dd. You
  need to copy the actual data, and the meta data.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 3.<b>drbdsetup </b><b></b><i>device</i><b>
  new-current-uuid</b></div>
<div style="height: 1.00em;">&#x00A0;</div>
Now add the disk to the new secondary node, and join it to the cluster. You will
  get a resync of that parts that were changed since the first call to
  <b>drbdsetup</b> in step 1.
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
For examples, please have a look at the <b>DRBD User's Guide</b>[1].
<h1 class="Sh" title="Sh" id="VERSION"><a class="selflink" href="#VERSION">VERSION</a></h1>
This document was revised for version 8.3.2 of the DRBD distribution.
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Written by Philipp Reisner &lt;philipp.reisner@linbit.com&gt; and Lars Ellenberg
  &lt;lars.ellenberg@linbit.com&gt;
<h1 class="Sh" title="Sh" id="REPORTING_BUGS"><a class="selflink" href="#REPORTING_BUGS">REPORTING
  BUGS</a></h1>
Report bugs to &lt;drbd-user@lists.linbit.com&gt;.
<h1 class="Sh" title="Sh" id="COPYRIGHT"><a class="selflink" href="#COPYRIGHT">COPYRIGHT</a></h1>
Copyright 2001-2008 LINBIT Information Technologies, Philipp Reisner, Lars
  Ellenberg. This is free software; see the source for copying conditions. There
  is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR
  PURPOSE.
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>drbd.conf</b>(5), <b>drbd</b>(8), <b>drbddisk</b>(8), <b>drbdadm</b>(8),
  <b>DRBD User's Guide</b>[1], <b>DRBD web site</b>[2]
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"> 1.</dt>
  <dd class="It-tag">DRBD User's Guide</dd>
</dl>
<div style="margin-left: 4.00ex;">http://www.drbd.org/users-guide/</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 2.</dt>
  <dd class="It-tag">DRBD web site</dd>
</dl>
<div style="margin-left: 4.00ex;">http://www.drbd.org/</div>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">5 Dec 2008</td>
    <td class="foot-os">DRBD 8.3.2</td>
  </tr>
</table>
</body>
</html>
