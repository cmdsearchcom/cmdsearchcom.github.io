<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>keycloak-httpd-client-install(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">keycloak-httpd-client-install(1)</td>
    <td class="head-vol">General Commands Manual</td>
    <td class="head-rtitle">keycloak-httpd-client-install(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
keycloak-httpd-client-install - Tools to configure Apache HTTPD as Keycloak
  client
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>keycloak-httpd-client-install</b> [ <b>-h</b>] [ <b>--no-root-check</b>] [
  <b>-v</b>] [ <b>-d</b>] [ <b>--show-traceback</b>] [ <b>--log-file</b>
  <i>LOG_FILE</i>] <b>--app-name</b> <i>APP_NAME</i> [ <b>--force</b>] [
  <b>--permit-insecure-transport</b>] [ <b>--tls-verify</b>] [
  <b>--template-dir</b> <i>TEMPLATE_DIR</i>] [ <b>--httpd-dir</b>
  <i>HTTPD_DIR</i>] -r KEYCLOAK_REALM <b>-s</b> <i>KEYCLOAK_SERVER_URL</i> [
  <b>-a</b> <i>root-admin|realm-admin|anonymous</i>] [ <b>-u</b>
  <i>KEYCLOAK_ADMIN_USERNAME</i>] <b>-p</b> <i>KEYCLOAK_ADMIN_PASSWORD</i> [
  <b>--keycloak-admin-realm</b> <i>KEYCLOAK_ADMIN_REALM</i>] [
  <b>--initial-access-token</b> <i>INITIAL_ACCESS_TOKEN</i>] [
  <b>--client-originate-method</b> <i>descriptor|registration</i>] [
  <b>--mellon-key-file</b> <i>MELLON_KEY_FILE</i>] [ <b>--mellon-cert-file</b>
  <i>MELLON_CERT_FILE</i>] [ <b>--mellon-hostname</b> <i>MELLON_HOSTNAME</i>] [
  <b>--mellon-https-port</b> <i>MELLON_HTTPS_PORT</i>] [ <b>--mellon-root</b>
  <i>MELLON_ROOT</i>] [ <b>--mellon-endpoint</b> <i>MELLON_ENDPOINT</i>] [
  <b>--mellon-entity-id</b> <i>MELLON_ENTITY_ID</i>] [
  <b>--mellon-idp-attr-name</b> <i>MELLON_IDP_ATTR_NAME</i>] [
  <b>--mellon-organization-name</b> <i>MELLON_ORGANIZATION_NAME</i>] [
  <b>--mellon-organization-display-name</b>
  <i>MELLON_ORGANIZATION_DISPLAY_NAME</i>] [ <b>--mellon-organization-url</b>
  <i>MELLON_ORGANIZATION_URL</i>] [ <b>-l</b> <i>MELLON_PROTECTED_LOCATIONS</i>]
<div style="height: 1.00em;">&#x00A0;</div>
Configure mod_auth_mellon as Keycloak client
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-h</b>, <b>--help</b></dt>
  <dd class="It-tag">show this help message and exit</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--no-root-check</b></dt>
  <dd class="It-tag">permit running by non-root (default: False)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-v</b>, <b>--verbose</b></dt>
  <dd class="It-tag">be chatty (default: False)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-d</b>, <b>--debug</b></dt>
  <dd class="It-tag">turn on debug info (default: False)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--show-traceback</b></dt>
  <dd class="It-tag">exceptions print traceback in addition to error message
      (default: False)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--log-file</b> <b><i>LOG_FILE</i></b></dt>
  <dd class="It-tag">log file pathname (default:
      /var/log/python-keycloak-httpd-client/keycloak-httpd-client-install.log)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--app-name</b> <b><i>APP_NAME</i></b></dt>
  <dd class="It-tag">name of the web app being protected by mellon (default:
      None)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--force</b></dt>
  <dd class="It-tag">forcefully override safety checks (default: False)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--permit-insecure-transport</b></dt>
  <dd class="It-tag">Normally secure transport such as TLS is required, defeat
      this check (default: False)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--tls-verify</b></dt>
  <dd class="It-tag">TLS certificate verification for requests to the server.
      May be one of case insenstive [true, yes, on] to enable, [false, no, off]
      to disable. Or the pathname to a OpenSSL CA bundle to use. (default: True)
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
Program Configuration:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--template-dir</b> <b><i>TEMPLATE_DIR</i></b></dt>
  <dd class="It-tag">Template location (default:
      /usr/share/keycloak-httpd-client/templates)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--httpd-dir</b> <b><i>HTTPD_DIR</i></b></dt>
  <dd class="It-tag">Template location (default: /etc/httpd)
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
Keycloak IdP:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-r</b>, <b>--keycloak-realm</b>
    <b><i>KEYCLOAK_REALM</i></b></dt>
  <dd class="It-tag">realm name (default: None)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-s</b>, <b>--keycloak-server-url</b>
    <b><i>KEYCLOAK_SERVER_URL</i></b></dt>
  <dd class="It-tag">Keycloak server URL (default: None)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-a</b>, <b>--keycloak-auth-role</b>
    <b><i>root-admin|realm-admin|anonymous</i></b></dt>
  <dd class="It-tag">authenticating as what type of user (default:
    root-admin)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-u</b>, <b>--keycloak-admin-username</b>
    <b><i>KEYCLOAK_ADMIN_USERNAME</i></b></dt>
  <dd class="It-tag">admin user name (default: admin)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-p</b>, <b>--keycloak-admin-password</b>
    <b><i>KEYCLOAK_ADMIN_PASSWORD</i></b></dt>
  <dd class="It-tag">admin password (use - to read from stdin) (default:
    None)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--keycloak-admin-realm</b>
    <b><i>KEYCLOAK_ADMIN_REALM</i></b></dt>
  <dd class="It-tag">realm admin belongs to (default: master)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--initial-access-token</b>
    <b><i>INITIAL_ACCESS_TOKEN</i></b></dt>
  <dd class="It-tag">realm initial access token for client registeration
      (default: None)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--client-originate-method</b>
    <b><i>descriptor|registration</i></b></dt>
  <dd class="It-tag">select Keycloak method for creating SAML client (default:
      descriptor)
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
Mellon SP:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--mellon-key-file</b> <b><i>MELLON_KEY_FILE</i></b></dt>
  <dd class="It-tag">certficate key file (default: None)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--mellon-cert-file</b>
    <b><i>MELLON_CERT_FILE</i></b></dt>
  <dd class="It-tag">certficate file (default: None)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--mellon-hostname</b> <b><i>MELLON_HOSTNAME</i></b></dt>
  <dd class="It-tag">Machine's fully qualified host name</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--mellon-https-port</b>
    <b><i>MELLON_HTTPS_PORT</i></b></dt>
  <dd class="It-tag">SSL/TLS port on mellon-hostname</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--mellon-root</b> <b><i>MELLON_ROOT</i></b></dt>
  <dd class="It-tag">Common root ancestor for all mellon endpoints</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--mellon-endpoint</b> <b><i>MELLON_ENDPOINT</i></b></dt>
  <dd class="It-tag">Used to form the MellonEndpointPath, e.g.
      {mellon_root}/{mellon_endpoint} (default: mellon)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--mellon-entity-id</b>
    <b><i>MELLON_ENTITY_ID</i></b></dt>
  <dd class="It-tag">SP SAML Entity ID (default:
      {mellon_http_url}/{mellon_root}/{mellon_endpoint_path}/metadata)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--mellon-idp-attr-name</b>
    <b><i>MELLON_IDP_ATTR_NAME</i></b></dt>
  <dd class="It-tag">Name of the attribute Mellon adds which will contain the
      IdP entity id (default:
      {mellon_http_url}/{mellon_root}/{mellon_endpoint_path}/metadata)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--mellon-organization-name</b>
    <b><i>MELLON_ORGANIZATION_NAME</i></b></dt>
  <dd class="It-tag">Add SAML OrganizationName to SP metadata (default:
    None)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--mellon-organization-display-name</b>
    <b><i>MELLON_ORGANIZATION_DISPLAY_NAME</i></b></dt>
  <dd class="It-tag">Add SAML OrganizationDisplayName to SP metadata (default:
      None)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--mellon-organization-url</b>
    <b><i>MELLON_ORGANIZATION_URL</i></b></dt>
  <dd class="It-tag">Add SAML OrganizationURL to SP metadata (default:
    None)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-l</b>, <b>--mellon-protected-locations</b>
    <b><i>MELLON_PROTECTED_LOCATIONS</i></b></dt>
  <dd class="It-tag">Web location to protect with Mellon. May be specified
      multiple times (default: [])
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<b>keycloak-httpd-client-install</b> will configure a node running Apache with
  mod_auth_mellon as SAML Service Provider ( <b>SP</b>) utilizing a
  <b>Keycloak</b> server as an Identity Provider( <b>IdP</b>).
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>Authentication Levels and Permissions</b>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
The tool is capable of range of configuration steps. But the extent of those
  operations may be circumscribed by the privilege level (authorization) the
  tool is run with. The privilege level is determined by the
  <b>--keycloak-auth-role</b> command line option which may be one of:
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>root-admin</b>: The Keycloak installation has a super realm normally called
  <i>master</i> which is the container for all realms hosted by the Keycloak
  instance. A user with administration priviliges in the <i>master</i> realm can
  perform all operations on all realms hosted by the instance. Think of such a
  user as a root user or root admin.
<div class="Pp"></div>
<b>realm-admin</b>: Each subordinate realm in the Keycloak instance may have
  it's own administrator(s) whose privileges are restricted exclusively to that
  realm.
<div class="Pp"></div>
<b>anonymous</b>: The tool does not authenticate as a user and hence no
  priviliges are granted. Any privilege is granted by virtue of an <i>initial
  access token</i> passed in via the <b>-initial-access-token</b> command line
  option. Think of an initial access token as a one time password scoped to a
  specific realm. The initial access token must be generated by an administrator
  with sufficient priviliges on the realm and given to the user of the tool. The
  priviliges conferred by the initial access token are limited to registering
  the client in the realm utilizing the Keycloak client registration service.
<div class="Pp"></div>
Selecting which authencation role will be used is determined by a combination of
  the <b>--keycloak-auth-role</b> option and the <b>--keycloak-admin-realm</b>
  option. When the authentication role is one of <i>root-admin</i> or
  <i>realm-admin</i> the tool will authenticate as a user in a specific realm,
  the <b>--keycloak-admin-realm</b> option declares the realm the administrator
  will authenticate to. For the <i>root-admin</i> role this is typically the
  <i>master</i> realm. For the <i>realm-admin</i> role this would be realm the
  tool is registrating the client in.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>Determining which authentication role to use</b>
<div style="height: 1.00em;">&#x00A0;</div>
In general the principle of <i>least privilige</i> should apply. Grant to the
  tool the least privilige necessary to perform the required action. In oder of
  least privilige to greatest privilige the following operations are possible
  under the defined authentication roles:
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>anonymous</b>
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
<b>*</b> Can register the client using only the Keycloak client registration
  service. The tool cannot determine a prori if the client already exists in the
  realm nor can it adjust any configuration options on the client.
<div class="Pp"></div>
<b>*</b> The realm must pre-exist.</div>
<div class="Pp"></div>
<b>realm-admin</b>
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
<b>*</b> Can enumerate the existing clients in the realm to determine if a
  conflict would occur.
<div class="Pp"></div>
<b>*</b> Can delete a pre-existing client and replace it with the new client
  definition if the <b>--force</b> option is supplied.
<div class="Pp"></div>
<b>*</b> Can modify the clients configuration.
<div class="Pp"></div>
<b>*</b> Can use either the client registration service or the REST API to
  create the client.
<div class="Pp"></div>
<b>*</b> The realm must pre-exist and contain the realm admin user.</div>
<div class="Pp"></div>
<b>root-admin</b>
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
<b>*</b> Includes all of the priviliged operation conferred by the
  <i>realm-admin</i>.
<div class="Pp"></div>
<b>*</b> Can enumerate existing realms on the Keycloak instance to verify the
  existence of the target realm the client is to be installed in.
<div class="Pp"></div>
<b>*</b> Can create the target realm if it does not exist.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>Client creation methods</b>
<div style="height: 1.00em;">&#x00A0;</div>
Keycloak offers two methods to add a client to a realm
<div class="Pp"></div>
<div style="margin-left: 5.00ex;"><b>*</b> The OpenID Connect client
  registration service. Note even though we are registering a SAML Service
  Provider (SP) which is not part of OAuth2 nor OpenID Connect the client
  registration service is still capable of registering a SAML SP client.
  Selected with <b>--client-originate-method register</b>.
<div class="Pp"></div>
<b>*</b> Utilizing the Keycloak REST API to create and configure the SAML SP
  client. The Keycloak REST API utilizes a 2-step process whereby the SP
  metadata is sent to the the Keycloak instance and it returns a client
  descriptor which is then used to create the client. Selected with
  <b>--client-originate-method descriptor</b>.</div>
<div class="Pp"></div>
At the time of this writing the client registration service behaves differently
  than the REST API. Advice on which to use is likely to be dependent upone the
  Keycloak version. Note, if anonymous authentication is used in conjunction
  with a initial access token then the client registration service <i>must</i>
  be used.
<div class="Pp"></div>
The client registration service requies the use of an initial access token. For
  all authentiction roles an initial access token can be provided on the command
  line via the <b>initial-access-token</b> option. The initial access token will
  have to have been provided by a Keycloak administrator who pre-creates it. If
  the authencation role is either <i>root-admin</i> or <i>realm-admin</i> the
  tool has sufficient privilige to obtain an initial access token on it's behalf
  negating the need for a Keycloak admin to supply one externally.
<div class="Pp"></div>
The client registration service may be used by the following authentication
  roles:
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
<b>*</b> root-admin
<div class="Pp"></div>
<b>*</b> realm-admin
<div class="Pp"></div>
<b>*</b> anonymous (requires use of <b>--initial-access-token</b>)</div>
<div class="Pp"></div>
The REST API may be used by the following authentication roles:
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
<b>*</b> root-admin
<div class="Pp"></div>
<b>*</b> realm-admin</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="OPERATION"><a class="selflink" href="#OPERATION">OPERATION</a></h1>
<b>keycloak-httpd-client-install</b> performs the following operational steps:
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>*</b> Connect to Keycloak Server.
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
A session is established with the Keycloak server. OAuth2 is used to log in as
  the admin user using the <b>--keycloak-admin-username</b> and
  <b>--keycloak-admin-password</b> options. The Keycloak server is identified by
  the <b>-keycloak-server-url</b> option. This step is performed first to assure
  the remaining steps can complete successfully. A session is maintained for
  efficiency reasons. You may also need to specify <b>--keycloak-admin-role</b>
  and <b>--keycloak-admin-realm</b> to indicate the privilege level you are
  authenticating with. An anonymous auth role connects to the Keycloak service
  without any authentication.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>*</b> Create directories.
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
Files written by <b>keycloak-httpd-client-install</b> need a destination
  directory (see <b>FILES</b>). If the necessary directories are not present
  they are created.</div>
<div class="Pp"></div>
<b>*</b> Set up template environment
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
Many of the files written by <b>keycloak-httpd-client-install</b> are based on
  <i>jinga2</i> templates. The default template file location can be overridden
  with the <b>--template-dir</b> option.</div>
<div class="Pp"></div>
<b>*</b> Set up Service Provider X509 Certificiates.
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
A SAML SP must have a X509 certificate and key used to sign and optionally
  encrypt it's SAML messages sent to the SAML IdP.
  <b>keycloak-httpd-client-install</b> can generate a self-signed certificate
  for you or you may supply your own key and certificate via the
  <b>--mellon-key-file</b> and <b>--mellon-cert-file</b> options. The files must
  be in PEM format.</div>
<div class="Pp"></div>
<b>*</b> Build Mellon httpd config file.
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
The Mellon HTTPD configuration file tells <i>mod_auth_mellon</i> where to find
  things such as certificates and metadata files as well as what web resources
  to protect. It is generated from the <i>mellon_httpd.conf</i> template file.
  (see <b>FILES</b>). There is one mellon httpd conf file per application.</div>
<div class="Pp"></div>
<b>*</b> Build Mellon SP metadata file.
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
The Mellon SP needs to be registered with the Keycloak IdP. This forms a trust
  relationship and provides infomation to the IdP about the Mellon SP.
  Registering an SP with an IdP is done via a SP metadata file. The Mellon SP
  metadata also instructs <i>mod_auth_mellon</i> how to operate. The Mellon SP
  is generated from the <i>sp_metadata.tpl</i> template file.</div>
<div class="Pp"></div>
<b>*</b> Query realms from Keycloak server, optionally create new realm.
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
Keycloak supports multi-tenancy, it may serve many IdP's each one specified by a
  Keycloak realm. The <b>--keycloak-realm</b> option identifies which Keycloak
  realm we will bind to. The Keycloak realm may already exist on the Keycloak
  server, if it does <b>keycloak-httpd-client-install</b> will use it. If the
  Keycloak realm does not exist yet it will be created for you.
<div class="Pp"></div>
Requires the <i>root-admin</i> auth role.</div>
<div class="Pp"></div>
<b>*</b> Query realm clients from Keycloak server, optionally delete existing.
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
SAML SP's are one type of Keycloak client that can be serviced by the Keycloak
  realm IdP. The Mellon SP is a new Keycloak client which needs to be added to
  the Keycloak realm. However we must assure the new client does not conflict
  with an existing client on the Keycloak realm. If the Mellon SP is already
  registered on the Keycloak realm <b>keycloak-httpd-client-install</b> will
  stop processing and exit with an error unless the <b>--force</b> option is
  used. <b>--force</b> will cause the existing client on the Keycloak realm to
  be deleted first so that it can be replaced in the next step.
<div class="Pp"></div>
Requires either the <i>root-admin</i> or <i>realm-admin</i> auth role.</div>
<div class="Pp"></div>
<b>*</b> Create new SP client in Keycloak realm.
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
The Mellon SP is registered with the Keycloak realm on the Keycloak server by
  sending the Keycloak server the Mellon SP metadata to the Keycloak server.
<div class="Pp"></div>
When the client-originate-method is <i>descriptor</i> either the
  <i>root-admin</i> or <i>realm-admin</i> auth role is required. When the
  <i>client-originate-method</i> is <i>registration</i> the initial access token
  is mandatory for the <i>anonymous</i> auth role and optional for the
  <i>root-admin</i> or <i>realm-admin</i> roles.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>*</b> Adjust client configuration
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
Override default Keycloak client values. This varies by Keycloak release.
<div class="Pp"></div>
Requires either the <i>root-admin</i> or <i>realm-admin</i> auth role.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>*</b> Add attributes to be returned in assertion
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
The client is configured to return necessary attributes. The added attributes
  are:
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
<b>*</b> Groups user is a member of.</div>
<div class="Pp"></div>
Requires either the <i>root-admin</i> or <i>realm-admin</i> auth role.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>*</b> Retrieve IdP metadata from Keycloak server.
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
The Mellon SP needs SAML metadata that describes the Keycloak IdP. The metadata
  for the Keycloak IdP is fetched from the Keycloak server and stored in a
  location referenced in the Mellon SP httpd configuration file. (see
  <b>FILES</b>)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>STRUCTURE</b>
<div class="Pp"></div>
The overarching organization is the web application. An independent set of
  Mellon files are created per application and registered with the Keycloak
  server. This permits multiple indpendent SAML Service Providers and/or
  protected web resources to be handled by one Apache instance. When you run
  <b>keycloak-httpd-client-install</b> you must supply an application name via
  the <b>--app-name</b> option.
<div class="Pp"></div>
Within the web application you may protect via SAML multiple independent web
  resources specified via the <b>--mellon-protected-locations</b> /xxx option.
  This will cause a:
<div class="Pp"></div>
<div style="margin-left: 5.00ex;">
<pre>
&lt;Location&gt;
    AuthType Mellon
    MellonEnable auth
    Require valid-user
&lt;/Location&gt;
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
directive to be added to the Mellon HTTPD configuration file. The Mellon SP
  parameters are located at the root of the web application root, each protected
  location inherits from that.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="FILES"><a class="selflink" href="#FILES">FILES</a></h1>
Files created by running <b>keycloak-httpd-client-install</b>:
<dl class="Bl-tag">
  <dt class="It-tag"><b>{httpd-dir}/conf.d/{app-name}_mellon_keycloak_{realm}.conf</b></dt>
  <dd class="It-tag">This is the primary Mellon configuration file for the
      application. It binds to the Keycloak realm IdP. It is generated from the
      <i>mellon_httpd.conf</i> template file.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>{httpd-dir}/saml2/{app-name}.cert</b></dt>
  <dd class="It-tag">The Mellon SP X509 certficate file in PEM format.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>{httpd-dir}/saml2/{app-name}.key</b></dt>
  <dd class="It-tag">The Mellon SP X509 key file in PEM format.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>{httpd-dir}/saml2/{app-name}_keycloak_{realm}_idp_metadata.xml</b></dt>
  <dd class="It-tag">The Keycloak SAML2 IdP metadata file. It is fetched from
      the Keycloak server.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>{httpd-dir}/saml2/{app-name}_sp_metadata.xml</b></dt>
  <dd class="It-tag">The Mellon SAML2 SP metadata file. It is generated from the
      <i>sp_metadata.xml</i> template file.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
<b>Files referenced by <b>keycloak-httpd-client-install</b> when it runs:</b>
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>/usr/share/python-keycloak-httpd-client/templates/*</b></dt>
  <dd class="It-tag">jinja2 templates
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
<b>Log files:</b>
<dl class="Bl-tag">
  <dt class="It-tag"><b>/var/log/python-keycloak-httpd-client/keycloak-httpd-client-install.log</b></dt>
  <dd class="It-tag">Installation log file
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
<b>DEBUGGING</b>
<div class="Pp"></div>
The <b>--verbose</b> and <b>--debug</b> options can be used to increase the
  level of detail emitted on the console. However, note the log file logs
  everything at the <i>DEBUG</i> level so it is usually easier to consult the
  log file when debugging (see <b>LOGGING</b>)
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>LOGGING</b>
<div class="Pp"></div>
<b>keycloak-httpd-client-install</b> logs all it's operations to a rotated log
  file. The default log file can be overridden with the <b>--log-file</b>
  option. Each run of <b>keycloak-httpd-client-install</b> will create a new log
  file. Any previous log file will be rotated as a numbered verson keeping a
  maximum of 3 previous log files. Logging to the log file occurs at the
  <i>DEBUG</i> level that includes all HTTP requests and responses, this is
  useful for debugging.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>TEMPLATES</b>
<div class="Pp"></div>
Many of the files generated by <b>keycloak-httpd-client-install</b> are produced
  via jinja2 templates substituting values determined by
  <b>keycloak-httpd-client-install</b> when it runs. The default template file
  location can be overridden with the <b>--template-dir</b> option.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="EXIT_STATUS"><a class="selflink" href="#EXIT_STATUS">EXIT
  STATUS</a></h1>
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
<b>0</b>: SUCCESS
<div class="Pp"></div>
<b>1</b>: OPERATION_ERROR
<div class="Pp"></div>
<b>2</b>: CONFIGURATION_ERROR
<div class="Pp"></div>
<b>3</b>: INSUFFICIENT_PRIVILEGE
<div class="Pp"></div>
<b>4</b>: COMMUNICATION_ERROR
<div class="Pp"></div>
<b>5</b>: ALREADY_EXISTS_ERROR</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
John Dennis &lt;jdennis@redhat.com&gt;</div>
<table class="foot">
  <tr>
    <td class="foot-date"></td>
    <td class="foot-os"></td>
  </tr>
</table>
</body>
</html>
