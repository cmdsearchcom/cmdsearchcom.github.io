<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>opaxlattopology(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">opaxlattopology(8)</td>
    <td class="head-vol">Master map: IFSFFCLIRG (Man Page)</td>
    <td class="head-rtitle">opaxlattopology(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
opaxlattopology
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
Generates a topology XML file of a cluster using topology.csv,
  linksum_swd06.csv, and linksum_swd24.csv as input. The topology file can be
  used to bring up and verify the cluster.
<div class="Pp"></div>
<b>NOTE:</b> The topology.csv input file must be present in the same directory
  from which the script operates, but the linksum CSV files are read from the
  /usr/lib/opa-ff/samples directory.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="Syntax"><a class="selflink" href="#Syntax">Syntax</a></h1>
opaxlattopology [-d <i>level</i>-v <i>level</i>-i <i>level</i>-c <i>char</i>-K
  -?]
<div>&#x00A0;</div>
[source [dest]]
<h1 class="Sh" title="Sh" id="Options"><a class="selflink" href="#Options">Options</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag">-d <i>level</i></dt>
  <dd class="It-tag">Output detail level. Default = 0. Levels are additive.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">By default, the top level is always produced. Switch, rack,
      and rack group topology files can be added to the output by choosing the
      appropriate level. If the output at the group or rack level is specified,
      then group or rack names must be provided in the spreadsheet. Detailed
      output can be specified in any combination. A directory for each topology
      XML file is created hierarchically, with group directories (if specified)
      at the highest level, followed by rack and switch directories (if
      specified).</dd>
</dl>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
1 Intel(R) Omni-Path Edge Switch 100 Series topology files.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
2 Rack topology files.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
4 Rack group topology files.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">-v <i>level</i></dt>
  <dd class="It-tag">Verbose level. Range = 0 - 8. Default = 2.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
0 No output.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
1 Progress output.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
2 Reserved.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
4 Time stamps.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
8 Reserved.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">-i <i>level</i></dt>
  <dd class="It-tag">Output indent level. Range = 0 - 15. Default = 0.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-c <i>char</i></dt>
  <dd class="It-tag">NodeDesc concatenation character. Used when creating
      NodeDesc values (that is, Name to Name-2, Name to HFI-1, and so on). A
      space is used by default, but another character, such as underscore, can
      be specified.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-K</dt>
  <dd class="It-tag">Does not clean temporary files. Prevents temporary files in
      each topology directory from being removed. Temporary files contain CSV
      formatted lists of links, HFIs, and switches used to create a topology XML
      file. Temporary files are not typically needed after a topology file is
      created, however they are used for creating linksum_swd06.csv and
      linksum_swd24.csv files, or can be retained for subsequent inspection or
      processing.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-?</dt>
  <dd class="It-tag">Prints this output.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="Description"><a class="selflink" href="#Description">Description</a></h1>
The opaxlattopology script reads the topology.csv file from the local directory,
  and reads the other files from /usr/lib/opa-ff/samples/linksum_swd06.csv and
  /usr/lib/opa-ff/samples/linksum_swd24.csv. The topology.csv file is created
  from the topology.xlsx spreadsheet by saving the Fabric Links tab as a .CSV
  file to topology.csv. A sample topology.xlsx is located in the
  /usr/lib/opa-ff/samples/ directory. Inspect the topology.csv file to ensure
  that each row contains the correct and same number of comma separators. Any
  extraneous entries in the spreadsheet can cause the CSV output to have extra
  fields.
<div class="Pp"></div>
The script outputs one or more topology files starting with topology.0:0.xml.
  The topology.csv input file must be present in the same directory from which
  the script operates, but the linksum CSV files are read from the
  /usr/lib/opa-ff/samples directory.
<h1 class="Sh" title="Sh" id="Example"><a class="selflink" href="#Example">Example</a></h1>
opaxlattopology
<div>&#x00A0;</div>
# reads default input 'topology.csv' and creates default
<div>&#x00A0;</div>
# output 'topology.0:0.xml'
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
opaxlattopology fabric_2.csv
<div>&#x00A0;</div>
# reads input 'fabric_2.csv' and creates default output
<div class="Pp"></div>
See topology.xlsx for examples of links between HFI and Edge SW (rows 4-7), HFI
  and Core SW (rows 8-11), and Edge SW and Core SW (rows 12-15).
<h1 class="Sh" title="Sh" id="Environment_Variables"><a class="selflink" href="#Environment_Variables">Environment
  Variables</a></h1>
The following environment variables allow user-specified MTU.
<dl class="Bl-tag">
  <dt class="It-tag"><b>MTU_SW_SW</b></dt>
  <dd class="It-tag">If set, it overrides default MTU on switch-to-switch links.
      Default = 10240
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>MTU_SW_HFI</b></dt>
  <dd class="It-tag">If set, it overrides default MTU on switch-to-HFI links.
      Default = 8192
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="Creating_linksum_Files"><a class="selflink" href="#Creating_linksum_Files">Creating
  linksum Files</a></h1>
The linksum_swd06.csv and linksum_swd24.csv files are provided as stand-alone
  files in the /usr/lib/opa-ff/samples directory. However, they can be recreated
  (or modified) from the spreadsheet, if needed, by performing the following
  steps:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">1)</dt>
  <dd class="It-tag">Save each of the following from the topology.xlsx file as
      individual .csv files:</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Internal SWD06 Links tab as linksum_swd06.csv</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Internal SWD24 Links tab as linksum_swd24.csv</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Fabric Links tab as topology.csv
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">2)</dt>
  <dd class="It-tag">For each saved topology.csv file, run the script with the
      -K option.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">3)</dt>
  <dd class="It-tag">Upon completion of the script, save the top level
      linksum.csv file as linksum_swd06.csv or linksum_swd24.csv as appropriate.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="Including_SM_Blocks_in_Topology"><a class="selflink" href="#Including_SM_Blocks_in_Topology">Including
  SM Blocks in Topology</a></h1>
You must manually edit the /etc/sysconfig/opa/topology.0:0.xml file to include
  SM blocks for each SM in your fabric. opaxlattopology translates the
  topology.csv file which does not include SM blocks in the xml file by default.
  If manual edits are not completed, then the command opareport -o verifyall -T
  topology.0:0.xml fails with errors similar to the following:# opareport -o
  verifyall -T topology.0:0.xml
<div>&#x00A0;</div>
SMs Topology Verification
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
SMs Found with incorrect configuration:
<div>&#x00A0;</div>
NodeGUID Port PortGUID Type Name
<div>&#x00A0;</div>
0x0011750101671ed9 1 0x0011750101671ed9 FI phkp3un86 hfi1_0
<div>&#x00A0;</div>
NodeDetails: koplab
<div>&#x00A0;</div>
Unexpected SM
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
1 of 1 Fabric SMs Checked
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
SMs Expected but Missing or Duplicate in input:
<div>&#x00A0;</div>
0 of 0 Input SMs Checked
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
Total of 1 Incorrect SMs found
<div>&#x00A0;</div>
0 Missing, 1 Unexpected, 0 Duplicate, 0 Different
<div class="Pp"></div>
To retrieve the info for the SM block, use the command opareport -o nodes -F sm
  as shown in the following example.
<div>&#x00A0;</div>
# opareport -o nodes -F sm
<div>&#x00A0;</div>
Getting All Node Records...
<div>&#x00A0;</div>
Done Getting All Node Records
<div>&#x00A0;</div>
Done Getting All Link Records
<div>&#x00A0;</div>
Done Getting All Cable Info Records
<div>&#x00A0;</div>
Done Getting All SM Info Records
<div>&#x00A0;</div>
Node Type Summary
<div>&#x00A0;</div>
Focused on:
<div>&#x00A0;</div>
Port: 1 0x0011750101671ed9
<div>&#x00A0;</div>
in Node: 0x0011750101671ed9 FI phkp3un86 hfi1_0
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
3 Connected FIs in Fabric:
<div>&#x00A0;</div>
Name: phkp3un86 hfi1_0
<div>&#x00A0;</div>
NodeGUID: 0x0011750101671ed9 Type: FI
<div>&#x00A0;</div>
Ports: 1 PartitionCap: 16 SystemImageGuid: 0x0011750101671ed9
<div>&#x00A0;</div>
BaseVer: 128 SmaVer: 128 VendorID: 0x1175 DeviceID: 0x24f0 Rev: 0x10
<div>&#x00A0;</div>
1 Connected Ports:
<div>&#x00A0;</div>
PortNum: 1 LID: 0x0001 GUID: 0x0011750101671ed9
<div>&#x00A0;</div>
Neighbor: Name: phedfim20
<div>&#x00A0;</div>
NodeGUID: 0x0011750102648205 Type: SW PortNum: 46
<div>&#x00A0;</div>
Width: 4 Speed: 25Gb Downgraded? No
<div>&#x00A0;</div>
1 Matching FIs Found
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
1 Connected Switches in Fabric:
<div>&#x00A0;</div>
0 Matching Switches Found
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
1 Connected SMs in Fabric:
<div>&#x00A0;</div>
State: Master Name: phkp3un86 hfi1_0
<div>&#x00A0;</div>
NodeGUID: 0x0011750101671ed9 Type: FI
<div>&#x00A0;</div>
PortNum: 1 LID: 0x0001 PortGUID: 0x0011750101671ed9
<div>&#x00A0;</div>
SM_Key: 0x0000000000000000 Priority: 0 ActCount: 0x0000bcb2
<div>&#x00A0;</div>
1 Matching SMs Found</div>
<table class="foot">
  <tr>
    <td class="foot-date">Intel Corporation</td>
    <td class="foot-os">Copyright(C) 2015-2016</td>
  </tr>
</table>
</body>
</html>
