<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 19:14:06 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p style="margin-top: 1em">opaxlattopology(8) Master map:
IFSFFCLIRG (Man Page) opaxlattopology(8)</p>

<p style="margin-top: 1em">NAME <br>
opaxlattopology</p>

<p style="margin-top: 1em">Generates a topology XML file of
a cluster using topology.csv, linksum_swd06.csv, and
linksum_swd24.csv as input. The topology file can be used to
bring up and verify the clus&acirc; <br>
ter.</p>

<p style="margin-top: 1em">NOTE: The topology.csv input
file must be present in the same directory from which the
script operates, but the linksum CSV files are read from the
/usr/lib/opa-ff/samples direc&acirc; <br>
tory.</p>

<p style="margin-top: 1em">Syntax <br>
opaxlattopology [-d level-v level-i level-c char-K -?] <br>
[source [dest]]</p>

<p style="margin-top: 1em">Options <br>
-d level Output detail level. Default = 0. Levels are
additive.</p>

<p style="margin-top: 1em">By default, the top level is
always produced. Switch, rack, and rack group topology files
can be added to the output by choosing the appropriate
level. If the output at <br>
the group or rack level is specified, then group or rack
names must be provided in the spreadsheet. Detailed output
can be specified in any combination. A directory for <br>
each topology XML file is created hierarchically, with group
directories (if specified) at the highest level, followed by
rack and switch directories (if specified).</p>

<p style="margin-top: 1em">1 Intel(R) Omni-Path Edge Switch
100 Series topology files.</p>

<p style="margin-top: 1em">2 Rack topology files.</p>

<p style="margin-top: 1em">4 Rack group topology files.</p>

<p style="margin-top: 1em">-v level Verbose level. Range =
0 - 8. Default = 2.</p>

<p style="margin-top: 1em">0 No output.</p>

<p style="margin-top: 1em">1 Progress output.</p>

<p style="margin-top: 1em">2 Reserved.</p>

<p style="margin-top: 1em">4 Time stamps.</p>

<p style="margin-top: 1em">8 Reserved.</p>

<p style="margin-top: 1em">-i level Output indent level.
Range = 0 - 15. Default = 0.</p>

<p style="margin-top: 1em">-c char NodeDesc concatenation
character. Used when creating NodeDesc values (that is, Name
to Name-2, Name to HFI-1, and so on). A space is used by
default, but another char&acirc; <br>
acter, such as underscore, can be specified.</p>

<p style="margin-top: 1em">-K Does not clean temporary
files. Prevents temporary files in each topology directory
from being removed. Temporary files contain CSV formatted
lists of links, HFIs, and <br>
switches used to create a topology XML file. Temporary files
are not typically needed after a topology file is created,
however they are used for creating <br>
linksum_swd06.csv and linksum_swd24.csv files, or can be
retained for subsequent inspection or processing.</p>

<p style="margin-top: 1em">-? Prints this output.</p>

<p style="margin-top: 1em">Description <br>
The opaxlattopology script reads the topology.csv file from
the local directory, and reads the other files from
/usr/lib/opa-ff/samples/linksum_swd06.csv and
/usr/lib/opa-ff/sam&acirc; <br>
ples/linksum_swd24.csv. The topology.csv file is created
from the topology.xlsx spreadsheet by saving the Fabric
Links tab as a .CSV file to topology.csv. A sample
topology.xlsx <br>
is located in the /usr/lib/opa-ff/samples/ directory.
Inspect the topology.csv file to ensure that each row
contains the correct and same number of comma separators.
Any extrane&acirc; <br>
ous entries in the spreadsheet can cause the CSV output to
have extra fields.</p>

<p style="margin-top: 1em">The script outputs one or more
topology files starting with topology.0:0.xml. The
topology.csv input file must be present in the same
directory from which the script operates, <br>
but the linksum CSV files are read from the
/usr/lib/opa-ff/samples directory.</p>

<p style="margin-top: 1em">Example <br>
opaxlattopology <br>
# reads default input &rsquo;topology.csv&rsquo; and creates
default <br>
# output &rsquo;topology.0:0.xml&rsquo;</p>

<p style="margin-top: 1em">opaxlattopology fabric_2.csv
<br>
# reads input &rsquo;fabric_2.csv&rsquo; and creates default
output</p>

<p style="margin-top: 1em">See topology.xlsx for examples
of links between HFI and Edge SW (rows 4-7), HFI and Core SW
(rows 8-11), and Edge SW and Core SW (rows 12-15).</p>

<p style="margin-top: 1em">Environment Variables <br>
The following environment variables allow user-specified
MTU.</p>

<p style="margin-top: 1em">MTU_SW_SW If set, it overrides
default MTU on switch-to-switch links. Default = 10240</p>

<p style="margin-top: 1em">MTU_SW_HFI <br>
If set, it overrides default MTU on switch-to-HFI links.
Default = 8192</p>

<p style="margin-top: 1em">Creating linksum Files <br>
The linksum_swd06.csv and linksum_swd24.csv files are
provided as stand-alone files in the /usr/lib/opa-ff/samples
directory. However, they can be recreated (or modified) from
<br>
the spreadsheet, if needed, by performing the following
steps:</p>

<p style="margin-top: 1em">1) Save each of the following
from the topology.xlsx file as individual .csv files:</p>

<p style="margin-top: 1em">&Acirc;&middot; Internal SWD06
Links tab as linksum_swd06.csv</p>

<p style="margin-top: 1em">&Acirc;&middot; Internal SWD24
Links tab as linksum_swd24.csv</p>

<p style="margin-top: 1em">&Acirc;&middot; Fabric Links tab
as topology.csv</p>

<p style="margin-top: 1em">2) For each saved topology.csv
file, run the script with the -K option.</p>

<p style="margin-top: 1em">3) Upon completion of the
script, save the top level linksum.csv file as
linksum_swd06.csv or linksum_swd24.csv as appropriate.</p>

<p style="margin-top: 1em">Including SM Blocks in Topology
<br>
You must manually edit the
/etc/sysconfig/opa/topology.0:0.xml file to include SM
blocks for each SM in your fabric. opaxlattopology
translates the topology.csv file which does <br>
not include SM blocks in the xml file by default. If manual
edits are not completed, then the command opareport -o
verifyall -T topology.0:0.xml fails with errors similar to
the <br>
following:# opareport -o verifyall -T topology.0:0.xml <br>
SMs Topology Verification</p>

<p style="margin-top: 1em">SMs Found with incorrect
configuration: <br>
NodeGUID Port PortGUID Type Name <br>
0x0011750101671ed9 1 0x0011750101671ed9 FI phkp3un86 hfi1_0
<br>
NodeDetails: koplab <br>
Unexpected SM</p>

<p style="margin-top: 1em">1 of 1 Fabric SMs Checked</p>

<p style="margin-top: 1em">SMs Expected but Missing or
Duplicate in input: <br>
0 of 0 Input SMs Checked</p>

<p style="margin-top: 1em">Total of 1 Incorrect SMs found
<br>
0 Missing, 1 Unexpected, 0 Duplicate, 0 Different</p>

<p style="margin-top: 1em">To retrieve the info for the SM
block, use the command opareport -o nodes -F sm as shown in
the following example. <br>
# opareport -o nodes -F sm <br>
Getting All Node Records... <br>
Done Getting All Node Records <br>
Done Getting All Link Records <br>
Done Getting All Cable Info Records <br>
Done Getting All SM Info Records <br>
Node Type Summary <br>
Focused on: <br>
Port: 1 0x0011750101671ed9 <br>
in Node: 0x0011750101671ed9 FI phkp3un86 hfi1_0</p>

<p style="margin-top: 1em">3 Connected FIs in Fabric: <br>
Name: phkp3un86 hfi1_0 <br>
NodeGUID: 0x0011750101671ed9 Type: FI <br>
Ports: 1 PartitionCap: 16 SystemImageGuid:
0x0011750101671ed9 <br>
BaseVer: 128 SmaVer: 128 VendorID: 0x1175 DeviceID: 0x24f0
Rev: 0x10 <br>
1 Connected Ports: <br>
PortNum: 1 LID: 0x0001 GUID: 0x0011750101671ed9 <br>
Neighbor: Name: phedfim20 <br>
NodeGUID: 0x0011750102648205 Type: SW PortNum: 46 <br>
Width: 4 Speed: 25Gb Downgraded? No <br>
1 Matching FIs Found</p>

<p style="margin-top: 1em">1 Connected Switches in Fabric:
<br>
0 Matching Switches Found</p>

<p style="margin-top: 1em">1 Connected SMs in Fabric: <br>
State: Master Name: phkp3un86 hfi1_0 <br>
NodeGUID: 0x0011750101671ed9 Type: FI <br>
PortNum: 1 LID: 0x0001 PortGUID: 0x0011750101671ed9 <br>
SM_Key: 0x0000000000000000 Priority: 0 ActCount: 0x0000bcb2
<br>
1 Matching SMs Found</p>

<p style="margin-top: 1em">Copyright(C) 2015-2016 Intel
Corporation opaxlattopology(8)</p>
<hr>
</body>
</html>
