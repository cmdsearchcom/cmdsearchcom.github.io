<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>DACS_AUTH_TRANSFER(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">DACS_AUTH_TRANSFER(8)</td>
    <td class="head-vol">DACS Web Services Manual</td>
    <td class="head-rtitle">DACS_AUTH_TRANSFER(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
dacs_auth_transfer - transfer credentials between federations
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<div class="Pp" style="margin-left: 19.00ex; text-indent: -19.00ex;"><b>dacs_auth_transfer</b>
  [ <i></i><b>dacsoptions</b>[1]]</div>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
This web service is part of the <b>DACS</b> suite.
<div class="Pp"></div>
The <b>dacs_auth_transfer</b> service securely exports credentials (which
  represent an identity) from one <b>DACS</b> federation to another (or from
  <b>DACS</b> to a different identity management system), or securely imports an
  identity from one <b>DACS</b> federation to another (or from a different
  identity management system to <b>DACS</b>). This ability to <i>transfer</i>
  credentials (i.e., import or export them) lets a <b>DACS</b> federation
  federate with another system, creating a &quot;super federation&quot; with
  single sign-on capability. <b>DACS</b> calls such federations affiliated
  federations.
<div class="Pp"></div>
A <b>DACS</b> federation can use <b>dacs_auth_transfer</b> to leverage
  authentication mechanisms not available to it, other systems can use it to
  leverage <b>DACS</b>, and users can potentially access any access-controlled
  resource located in any of the cooperating federations.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>In a Nutshell</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
<div class="Pp"></div>
For two <b>DACS</b> federations, here is how the service is typically used. One
  or more jurisdictions in Federation A provide links labelled &quot;Transfer
  Login To Federation B&quot; (or similar). Following any of these links will
  initiate the mechanism to <i>export</i> the user's identity to Federation B.
  Alternatively, or additionally, one or more jurisdictions in Federation B
  provide links labelled &quot;Transfer Login From Federation A&quot;. Following
  any of these links will initiate the mechanism to <i>import</i> the user's
  identity from Federation A.
<div class="Pp"></div>
A user authenticates in Federation A, obtaining credentials understood only in
  that federation. When the user decides to access resources in Federation B, he
  follows one of the links. Assuming all access control constraints are
  satisfied, new credentials will be returned to him that are understood in
  Federation B. His existing Federation A credentials continue to exist.
<div class="Pp"></div>
The user is now recognized by both federations. If the user is known as
  FedA::J1:bobo in Federation A, then he will also be known by that name in
  Federation B. If Federation B happens to have a jurisdiction named J1 and a
  user at that jurisdiction named bobo, that user (FedB::J1:bobo) is separate
  and distinct as far as <b>DACS</b> is concerned.
<div class="Pp"></div>
Note that, in general, it is not correct in the scenario above for Federation B
  to <i>automatically initiate</i> a credential transfer if an unauthenticated
  user (with respect to Federation B) is denied access. This is because
  Federation B cannot tell with which federation it should be initiated (if
  there is more than one) or even if this is something that the user wants done
  (perhaps the user needs to authenticate in the usual way at Federation A).
  Therefore, except perhaps in special circumstances, explicit user interaction
  is necessary.
<div style="height: 0.50em;">&#x00A0;</div>
</div>
<div class="Pp"></div>
For <b>DACS</b>, the complete protocol is implemented by one program,
  <b>dacs_auth_transfer</b>. It provides the importing, exporting, and
  server-to-server stages of the protocol and it can also optionally assist
  middleware with the initial presentation stage of the protocol. The protocol
  is described below.
<div class="Pp"></div>
If an identity needs to be imported to a non- <b>DACS</b> system, that system
  must implement the identity transfer protocol described here, or a subset of
  it. If a non- <b>DACS</b> system only needs to export an identity to a
  <b>DACS</b> federation, it may only need a small amount of middleware to
  initiate the transfer.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>Security</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 1.A small degree of cooperation is required
  between <b>DACS</b> administrators at two affiliated federations so that they
  each know how to configure the feature. The two federations remain autonomous,
  however.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 2.Transferring credentials <i>to</i> a
  <b>DACS</b> federation (exporting) neither creates a new account nor creates a
  new identity. It merely converts credentials that were obtained in one
  federation into <b>DACS</b> credentials that are recognized within another
  federation. Because a <b>DACS</b> user identity includes a federation name,
  among federated <b>DACS</b> systems a user's identity is unique. After
  transfer to a different federation, the original credentials continue to exist
  and are unaltered.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 3.Exporting credentials to another federation
  and later transferring them back to the initial <b>DACS</b> federation (or
  exporting credentials within a federation) will replace the initial
  credentials with new ones for the same identity. The two sets of credentials
  will not be identical, however, and the imported ones may be less complete and
  therefore &quot;weaker&quot; than the original credentials with respect to
  authorization processing.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 4.System administrators should ensure that
  <b>dacs_auth_transfer</b> is configured so that it is impossible to import
  credentials to a federation from which they were exported, otherwise it may be
  possible for users to defeat the expiry of credentials by repeatedly
  regenerating them.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 5.The identity transfer protocol includes a
  server-to-server operation that must use SSL/TLS. The identity of the server
  issuing the request must be verified, either through its X.509 (SSL) client
  certificate, <b>DACS</b> credentials, or perhaps its IP address.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 6.As an additional security measure, a
  jurisdiction will only accept credentials for an identity outside of its
  federation if enabled by <b>ACCEPT_ALIEN_CREDENTIALS</b>[2].</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 7.While this document talks in terms of a
  <b>DACS</b> <i>federation</i> importing credentials, importation actually
  takes place at a <b>DACS</b> <i>jurisdiction</i>, just as authentication does.
  That target jurisdiction is similarly responsible for the resulting
  credentials and is identified within the new credentials for access control
  testing and audit purposes.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 8.Any appropriately configured jurisdiction
  is capable of exporting or importing credentials. Some federations might
  choose to create &quot;administrative jurisdictions&quot; solely for this
  purpose (e.g., export.example.com and import.example.com), however, just as a
  federation might be structured to limit authentication services to a
  designated jurisdiction.</div>
<div style="height: 0.50em;">&#x00A0;</div>
</div>
<h2 class="Ss" title="Ss" id="The_Identity_Transfer_Protocol"><a class="selflink" href="#The_Identity_Transfer_Protocol">The
  Identity Transfer Protocol</a></h2>
The ability to transfer credentials from one identity management system to
  another is a feature that can be beneficial to both users and system
  administrators. For users, it can provide the convenience of single sign-on; a
  user need only be authenticated by one federation to be able to access
  resources within a different federated system. For a system administrator, it
  means that fewer user identities need to be created and managed.
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Overview</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div class="Pp"></div>
The systems being federated might exist within a single organization or be
  associated with different, autonomous organizations that have a trust
  relationship, very much as <b>DACS</b> jurisdictions do. The transfer of
  credentials need not be reciprocal; that is, Federation A may allow identities
  to be imported from Federation B but not <i>vice versa</i>.
<div class="Pp"></div>
The architecture of the transfer mechanism is primarily constrained by the
  typical browser-oriented usage of <b>DACS</b>, where credentials are
  encapsulated within an HTTP cookie, thereby dictating how credentials are set
  in an off-the-shelf browser and when credentials will be sent by the browser.
  The approach is complicated somewhat because a <b>DACS</b> user may have
  multiple concurrent credentials or may be unauthenticated. Also, a <b>DACS</b>
  federation may wish to federate with more than one foreign federation.
  Therefore, interaction with the user will sometimes be necessary so that she
  can select the particular identity to be transferred and a <i>target
  federation</i> to which that identity is to be transferred. A jurisdiction or
  federation must be able to customize this interaction for appropriate web site
  integration (i.e., look and feel), but a bare-bones capability must still be
  provided by <b>dacs_auth_transfer</b>.
<div class="Pp"></div>
The design tries to balance security, usability, performance, availability,
  configuration complexity, implementation effort, administrative needs,
  generality, and extensibility, all within the constraints of the <b>DACS</b>
  architecture and requirements.
<div class="Pp"></div>
Though it is assumed that SSL/TLS is used to secure all network communication
  and identify the communicating hosts where necessary, some major potential
  threats against a transfer capability must be addressed by the design:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 1.<i>Replay</i>: the system must prevent the
  malicious or accidental use of expired credentials, reuse of authentication
  material by a different browser user (such as through browser history or a
  bookmark), use of authentication material discovered in a log file, and so
  on</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 2.<i>Forgery and Tampering</i>: the system
  must prevent a malicious user from changing authentication material to get
  different or &quot;better&quot; credentials using the transfer protocol</div>
<div style="height: 1.00em;">&#x00A0;</div>
Replay is addressed in the transfer protocol by restricting the exposure of
  authentication and protocol material and by limiting its validity period.
  Injection of copied material is also made difficult. Forgery and tampering are
  addressed through cryptographic means; using well-established techniques, it
  is thought to be practically impossible to create forged authentication
  material or modify it undetectably.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>Security</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
<div class="Pp"></div>
Importation of identities has federation-wide ramifications but it is the
  responsibility of each jurisdiction to decide whether it will allow its
  <b>dacs_auth_transfer</b> service to import an identity or its rules to honour
  an identity imported by another jurisdiction within the federation. A
  jurisdiction may independently allow identities to be imported from an
  external system, just as it may unilaterally decide whether it will
  authenticate users and how it will do so. On the other hand, a jurisdiction is
  free to reject imported identities, just as it is free to reject an identity
  vouched for by another jurisdiction in its federation. Federation members may
  wish to establish guidelines and procedures for importing identities.
<div style="height: 0.50em;">&#x00A0;</div>
</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Protocol Operation</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div class="Pp"></div>
The purpose of the protocol is to transfer an identity understood by the initial
  federation to the <i>target federation</i>. The initial federation
  <i>exports</i> an identity; the target federation <i>imports</i> the identity.
<div class="Pp"></div>
The four stages (operations) of the protocol are now described, in the order in
  which they are used. In all cases, &quot;the user&quot; can be a browser or
  middleware.
<div class="Pp"></div>
<div style="margin-left: 4.00ex;"> 1.The PRESENTATION operation, which is
  performed in the initial federation and is optional, is used for prompting the
  user to select the credentials to be transferred and identify the target
  federation. The purpose of the PRESENTATION operation is simply to make it
  easier for a user or middleware to invoke the EXPORT operation; the EXPORT
  operation can be invoked directly without engaging in this step of the
  protocol, however.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 2.The EXPORT operation is invoked at the
  initial federation by a user to request that the initial federation initiate
  the transfer of credentials representing a given identity to a given
  federation. After receiving and validating its arguments, the EXPORT operation
  invokes the TOKEN operation at the target federation. If the target federation
  tentatively approves the importation of the identity, it returns a URL to
  which the EXPORT stage redirects the user. If the target federation rejects
  the request (or the request fails), the EXPORT stage returns an error
  indication that should be reflected back to the user and terminates the
  protocol.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 3.The TOKEN operation is the heart of the
  protocol. By invoking it at the target federation, the initial federation
  vouches for the identity to be transferred and requests that the target
  federation honour the user's request for credentials valid within the target
  federation; the latter is free to reject the request for any reason. To
  accomplish the transfer, the initial federation requests a token from the
  target federation.
<div style="height: 1.00em;">&#x00A0;</div>
A token is cryptographically protected, opaque information encapsulated within a
  URL as its query component; the token is meaningful only to the target
  federation (i.e., its meaning is unspecified by the protocol). It could
  contain a database key for the transaction, a nonce, or a self-contained
  description of the transaction. All that is required by the protocol is that
  it be kept secret among the communicating parties for as long as it is valid,
  that its validity period be no longer than what is required to complete the
  last stage of identity transfer, that it be difficult to forge, and that it be
  tamper-resistant.
<div style="height: 1.00em;">&#x00A0;</div>
If the request for a token is granted, the target federation returns a URL that
  encapsulates it, otherwise an error indication is returned to the initial
  federation which in turn returns an error indication to the user and
  terminates the protocol.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 4.The IMPORT request is sent by the user to
  the target federation. A complete URL containing the IMPORT request will
  typically be created by the target federation, returned to the initial
  federation, and forwarded to the user as a browser redirect by the EXPORT
  stage. Upon successfully validating the request, which includes an examination
  of the token and checking for revocation of the identity (see
  <b>dacs.acls(5)</b>[3] for a description of how authentication/access
  revocation works), the target federation returns credentials (as an HTTP
  cookie) that are returned to the user in the final step of the IMPORT
  operation - this is the end-goal of the protocol - and the user is redirected
  by the target federation to an appropriate &quot;success&quot; URL as a
  convenience to the user. If the transfer fails, no new credentials are
  returned and the user is redirected to an appropriate &quot;failure&quot; URL
  by the target federation.</div>
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Implementation</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div class="Pp"></div>
The <b>dacs_auth_transfer</b> service implements all of the stages as separate
  operations of a single web service; a different implementation might create
  separate services for each stage or operation, or implement a subset of the
  functionality (e.g., it might only support exporting identities).
<div class="Pp"></div>
Each of the federating systems must be assigned a unique name (for <b>DACS</b>,
  through the FEDERATION_NAME directive) so that identities can be globally
  unique. <i>The federating systems need not share a common domain name
  suffix</i>.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>Note</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
<div class="Pp"></div>
In the current implementation of <b>dacs_auth_transfer</b>, configuration
  information associated with target federations is not automatically
  distributed by <b>DACS</b> to a federation's jurisdictions. This means that
  only those jurisdictions that have been specifically configured to import
  identities will be able to do so; a jurisdiction will not automatically
  understand how to interact with a given target federation that is configured
  at a different jurisdiction. Each jurisdiction's administrator wanting to
  provide this service must configure his site's <b>dacs_auth_transfer</b>
  service appropriately.
<div style="height: 0.50em;">&#x00A0;</div>
</div>
<div class="Pp"></div>
Details of the <b>dacs_auth_transfer</b> implementation and configuration
  requirements are now presented. A different implementation of the protocol
  could look very different.
<div class="Pp"></div>
PRESENTATION
<div style="margin-left: 4.00ex;"><b>dacs_auth_transfer</b> can emit an HTML
  document to prompt the user (by default, using the style sheet
  <b>dacs_auth_transfer.css</b>[4]). The user selects an identity and target
  federation and submits a form. Alternatively, the information necessary to
  construct prompts can be returned within an XML document that conforms to
  <b>dacs_auth_transfer.dtd</b>[5]. A site is also free to implement its own
  presentation stage.
<div style="height: 1.00em;">&#x00A0;</div>
The list of known target federation names from which a user can select is
  obtained from mappings that have been configured at this jurisdiction (see
  below).
<div style="height: 1.00em;">&#x00A0;</div>
When emitting HTML, the web page generated by <b>dacs_auth_transfer</b> can be
  customized through the auth_transfer VFS item type. The following items are
  emitted if they exist:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;header: Initial HTML to emit instead
  of the default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;prologue: HTML to emit immediately
  after the header.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;instructions: HTML to emit immediately
  after the prologue and before the form.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;form: Additional HTML to emit within
  the form. A likely use of this is to specify a hidden
  <i>TRANSFER_SUCCESS_URL</i> argument.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;epilogue: HTML to emit immediately
  after the form.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;trailer: Final HTML to emit instead of
  the default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
For example, consider the configuration directive:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
VFS &quot;[auth_transfer]dacs-fs:${Conf::DACS_HOME}/auth_transfer&quot;
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
If files named header and trailer exist in the directory
  ${Conf::DACS_HOME}/auth_transfer, they are expected to contain the initial and
  final HTML content, respectively. Note that these files consist of text and
  HTML markup but are not complete HTML documents.
<div style="height: 1.00em;">&#x00A0;</div>
Customization of the HTML form is possible using configuration variables:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;<i>transfer_export_uri</i>: the URL of
  the program to which the form should be submitted. By default, the URL is
  created from the one used to invoke the presentation stage, which will usually
  be that of <b>dacs_auth_transfer</b>.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;<i>transfer_submit_label</i>: the text
  label to put in the form's submit button.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;<i>transfer_submit_method</i>: the
  HTTP method to use to submit the form (GET is the default).</div>
<div style="height: 1.00em;">&#x00A0;</div>
For example, the submit button's text can be specified using the directive:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
EVAL ${Conf::transfer_submit_label} = &quot;Execute the transfer!&quot;
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div class="Pp"></div>
EXPORT
<div style="margin-left: 4.00ex;">The identity to be transferred and the name of
  the target federation are submitted to <b>dacs_auth_transfer</b> as arguments
  of the EXPORT operation. The request must be accompanied by <b>DACS</b>
  credentials that match this identity and the target federation must be
  recognized by the receiving jurisdiction.
<div style="height: 1.00em;">&#x00A0;</div>
For example, this URL asks the jurisdiction associated with example.com to
  export the identity EXAMPLE:bobo to the target federation DSS:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
https://example.com/dacs/dacs_auth_transfer?OPERATION=EXPORT\
    &amp;TARGET_FEDERATION=DSS\
    &amp;DACS_IDENTITY=EXAMPLE:bobo
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
For the request to succeed, credentials for EXAMPLE:bobo must be sent with the
  request, permission must be granted (by example.com) to export the identity,
  example.com must be configured with an appropriate mapping, described below,
  such that it knows how to submit a TOKEN request to a service associated with
  federation DSS, and that service must allow importation of the identity.
<div style="height: 1.00em;">&#x00A0;</div>
The mappings of federation identifiers to URLs for export purposes are provided
  through the <b>AUTH_TRANSFER_EXPORT</b>[6] directive. That is, these mappings
  indicate which target federations have been configured at this jurisdiction
  and associate a target federation identifier (a short, descriptive keyword)
  with a URL of a web service that implements the TOKEN operation for the target
  federation. It is from these mappings that the list of selectable target
  federations is obtained.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>Note</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
Unless jurisdictions coordinate mappings with each other, the same jurisdiction
  must perform both the PRESENTATION and EXPORT operations.
<div style="height: 0.50em;">&#x00A0;</div>
</div>
For example, dacs.conf might include the directive:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
AUTH_TRANSFER_EXPORT &quot;DSS https://dacs.dss.ca/cgi-bin/dacs/dacs_auth_transfer&quot;
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
This directive specifies one target federation, identified by the name DSS, and
  associates it with the URL of a service implementing the TOKEN operation.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>Security</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
The TOKEN operation must be performed over a secure communication channel,
  typically using SSL/TLS. URLs appearing in these mappings should therefore
  specify https. The issuer of the TOKEN operation may identify itself using an
  SSL client certificate; if <b>SSL_PROG_CLIENT_CRT</b>[7] is configured, that
  certificate will automatically be used.
<div style="height: 1.00em;">&#x00A0;</div>
If the issuer of the TOKEN operation possesses <b>DACS</b> credentials obtained
  offline from the target federation (e.g., using <b>dacscookie(1)</b>[8]), it
  can specify that they be sent with the request by putting them in an object
  named <i>FEDNAME</i>.cookies relative to the auth_transfer item type.
  directory ${Conf::DACS_HOME}/auth_transfer, one cookie per line. The
  <i>FEDNAME</i> filename suffix is the federation identifier for the importing
  federation.
<div style="height: 1.00em;">&#x00A0;</div>
For instance, given the AUTH_TRANSFER_EXPORT directive and the VFS directive for
  auth_transfer above, all cookies found in a file named
  /usr/local/dacs/auth_transfer/DSS.cookies would be sent with the TOKEN
  operation to identify the initial federation. These cookies would have been
  obtained from federation DSS over a secure communication channel.
<div style="height: 0.50em;">&#x00A0;</div>
</div>
</div>
<div class="Pp"></div>
TOKEN
<div style="margin-left: 4.00ex;">The syntax and semantics of a token are
  meaningful only to the target federation and can be changed without affecting
  any initial federation. In the current implementation, the token is comprised
  of information such as the identity to be transferred, the current date at the
  transfer federation, the client's IP address, and (optionally) the client's
  role string, which is encrypted using the target federation's federation-wide
  key and base-64 encoded.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>Note</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
The identity to be transferred must be a syntactically valid <b>DACS</b>
  username.
<div style="height: 0.50em;">&#x00A0;</div>
</div>
The period during which a token is valid is determined solely by the target
  federation. Its lifetime will ordinarily be just a few seconds, after which it
  will be treated as invalid by the IMPORT stage. The
  <b>AUTH_TRANSFER_TOKEN_LIFETIME_SECS</b>[9] directive specifies this value for
  <b>dacs_auth_transfer</b>; if not given, a compile-time default is used.
<div style="height: 1.00em;">&#x00A0;</div>
A jurisdiction within the target federation that provides identity importation
  must must configure at least one Transfer clause. The transfer directives are
  largely analogous to the authentication and roles directives. Each Transfer
  element must have an id attribute. Its value is merely a label (an alphabetic
  followed by zero or more alphanumerics, hyphens, and underscores) that allows
  the clause to be referenced. The id attribute values must be unique
  (case-sensitively) within the clause's Jurisdiction section.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>Security</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;An access control rule must be in
  place to ensure that this operation can only be executed by a legitimate
  server belonging to a recognized initial federation.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;The caller may not have supplied
  <b>DACS</b> credentials to identify itself and therefore the <b>user()</b>[10]
  function may not be of use.</div>
<div style="height: 0.50em;">&#x00A0;</div>
</div>
<div class="Pp"></div>
<b>Transfer Clause Directives Index:</b>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 1.CREDENTIALS_LIFETIME_SECS (Optional1)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 2.ERROR_URL (Optional1)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 3.EXIT* (Optional1)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 4.IMPORT_FROM (Required)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 5.IMPORT_ROLES (Optional1)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 6.IMPORT_URL (Optional1)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 7.PREDICATE (Optional1)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 8.REFEDERATE (Optional1)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 9.ROLES* (Optional1)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">10.SUCCESS_URL (Optional1)</div>
<div class="Pp"></div>
IMPORT_FROM (Required)
<div style="margin-left: 4.00ex;">This directive, which may be repeated, names
  an initial federation, as identified by the <i>INITIAL_FEDERATION</i>
  argument, to which this clause applies. It must be a syntactically valid
  federation name. These names are case-sensitive.</div>
<div class="Pp"></div>
REFEDERATE (Optional1)
<div style="margin-left: 4.00ex;">If &quot;yes&quot; (case insensitive), the
  federation and jurisdiction of the imported identity (i.e., the
  <i>DACS_IDENTITY</i> argument) are changed to that of the target jurisdiction.
  If this directive is unspecified or has another value, the original identity
  is retained.
<div style="height: 1.00em;">&#x00A0;</div>
For example, if the TOKEN operation at jurisdiction ALPHA of federation FED2 is
  passed <i>DACS_IDENTITY</i> with a value of FED1::BETA:bobo and REFEDERATE is
  enabled, then the imported identity will be FED2::ALPHA:bobo .
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>Security</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
This directive is useful in certain circumstances in that it can prevent a
  particular individual from being known by multiple names, which may complicate
  access control rules. It must be used with care, however.
<div style="height: 1.00em;">&#x00A0;</div>
Say Bobo is naturally known as ALPHA:bobo within federation FED2. If she
  authenticates as FED1::BETA:bobo and uses <b>dacs_auth_transfer</b> to obtain
  credentials in FED2, then by default her new credentials will be for the name
  FED1::BETA:bobo; i.e., her <b>DACS</b> identity is retained.
<div style="height: 1.00em;">&#x00A0;</div>
Access control rules in FED2 may need to handle both names, however, which can
  lead to problems. Some <b>DACS</b> administrators in FED2 may not even be
  aware of FED1, and so access to FED1::BETA:bobo may be denied while access to
  the same resource may be granted to FED2::ALPHA:bobo.
<div style="height: 1.00em;">&#x00A0;</div>
If no two distinct identities in FED1 can be mapped to the same identity in FED2
  (i.e., the same <i>username</i> component is not associated with more than one
  jurisdiction that can export the identity to FED2), then the administrator at
  the initial federation can advise the administrator at the target federation
  that the REFEDERATE directive should be enabled. Transferred identities will
  then be modified to appear to have been authenticated by FED2::ALPHA. When
  this feature is configured, although Bobo authenticates as FED1::BETA:bobo,
  her imported identity will be FED2::ALPHA:bobo.
<div style="height: 1.00em;">&#x00A0;</div>
If enabling this directive would cause two or more distinct identities to be
  mapped to the same <b>DACS</b> identity, the directive should not be used
  because different individuals may be assigned the same <b>DACS</b> name in the
  target federation.
<div style="height: 0.50em;">&#x00A0;</div>
</div>
</div>
<div class="Pp"></div>
PREDICATE (Optional1)
<div style="margin-left: 4.00ex;">The value of this directive is an expression.
  If the expression does not evaluate to <b>True</b>, importation will not be
  permitted.</div>
<div class="Pp"></div>
CREDENTIALS_LIFETIME_SECS (Optional1)
<div style="margin-left: 4.00ex;">This directive is used to override the value
  of the <b>AUTH_CREDENTIALS_DEFAULT_LIFETIME_SECS</b>[11] directive or the
  default.</div>
<div class="Pp"></div>
IMPORT_ROLES (Optional1)
<div style="margin-left: 4.00ex;">If &quot;yes&quot; (case insensitive), any
  roles in the existing credentials will be copied to the new credentials. The
  roles must be syntactically valid at the target jurisdiction. Within the
  context of the clause, the variable <i>${Auth::IMPORTED_ROLES}</i> is assigned
  the roles string. The default is &quot;no&quot;.</div>
<div class="Pp"></div>
IMPORT_URL (Optional1)
<div style="margin-left: 4.00ex;">This is the URL of the IMPORT stage of the
  protocol. By default, this is the same as that of the TOKEN stage, which is
  correct for <b>dacs_auth_transfer</b> since it implements all stages of the
  protocol.</div>
<div class="Pp"></div>
SUCCESS_URL (Optional1)
<div style="margin-left: 4.00ex;">If the transfer is successful and the user has
  not specified another URL via the <i>TRANSFER_SUCCESS_URL</i> argument, the
  user will be redirected to SUCCESS_URL. This directive is used by
  <b>dacs_auth_transfer</b> in the IMPORT stage.</div>
<div class="Pp"></div>
ERROR_URL (Optional1)
<div style="margin-left: 4.00ex;">If the transfer fails and the user has not
  specified another URL via the <i>TRANSFER_ERROR_URL</i> argument, the user
  will be redirected to ERROR_URL. This directive is used by
  <b>dacs_auth_transfer</b> in the IMPORT stage.</div>
<div class="Pp"></div>
ROLES* (Optional1)
<div style="margin-left: 4.00ex;">The value of this directive is an expression
  that is evaluated at run-time. Provided an error does not occur, the resulting
  string becomes the role string for the new credentials. The new role string
  must be syntactically valid at the target jurisdiction. The variable
  <i>${Auth::IMPORTED_ROLES}</i> is initialized to the role string (if any - see
  IMPORT_ROLES) from the existing credentials and is assigned the value of the
  expression.
<div style="height: 1.00em;">&#x00A0;</div>
For example, to add fed1 to those found in the existing credentials:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
IMPORT_ROLES &quot;yes&quot;
ROLES* '${Auth::IMPORTED_ROLES} . &quot;,fed1&quot;'
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div class="Pp"></div>
EXIT* (Optional1)
<div style="margin-left: 4.00ex;">The value of this directive is an expression
  that is evaluated at run-time. Provided an error does not occur, side effects
  from the evaluation may alter the final result of the clause. The variable
  <i>${Auth::IMPORTED_ROLES}</i> is initialized to the role string (if any - see
  IMPORT_ROLES) from the existing credentials and
  <i>${Auth::IMPORTED_USERNAME}</i> is assigned the (tentative) imported
  username component from the imported credentials. Either variable may be
  modified by the expression. The new role string must be syntactically valid at
  the target jurisdiction. The new username must be syntactically valid.
<div style="height: 1.00em;">&#x00A0;</div>
This directive maps all imported usernames to guest, relative to the target
  jurisdiction:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
EXIT* '${Auth::IMPORTED_USERNAME} = &quot;guest&quot;'
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
</div>
</div>
<div class="Pp"></div>
IMPORT
<div style="margin-left: 4.00ex;">An IMPORT request is validated before being
  accepted, which includes examining the token and checking for revocation of
  the identity. There is no guarantee that if the TOKEN operation succeeds the
  IMPORT operation will also.
<div style="height: 1.00em;">&#x00A0;</div>
<b>DACS</b> credentials imported by <b>dacs_auth_transfer</b> are marked as
  being alien and imported, the jurisdiction that executed the importation is
  recorded, and the IP address associated with the user's initial credentials
  are associated with the new credentials; these characteristics can be tested
  using the <b>dacs.exprs(5)</b>[10] function.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>Security</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
An access control rule must be in place to ensure that this operation can only
  be executed by appropriate users. Access might well be granted to any user but
  might reasonably be restricted based on IP address, etc.
<div style="height: 0.50em;">&#x00A0;</div>
</div>
</div>
<div class="Pp"></div>
To recap, assuming <b>dacs_auth_transfer</b> is used to transfer credentials
  between two <b>DACS</b> federations (which we will call Federation A and
  Federation B) and no errors occur, the flow of control will typically be as
  follows:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 1.The user follows a link that invokes
  <b>dacs_auth_transfer</b> at some jurisdiction within Federation A.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 2.<b>dacs_auth_transfer</b> generates an HTML
  document that is displayed on the user's browser. The user selects a target
  federation (Federation B) and credentials to transfer from those presented
  within an HTML form and submits it, invoking <b>dacs_auth_transfer</b> at
  Federation A again, but this time to perform the EXPORT operation. The list of
  credentials from which the user can choose depends on the user's current
  credentials in Federation A. The list of target federations depends on those
  known to the jurisdiction that processes the request.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 3.The <b>dacs_auth_transfer</b> at Federation
  A processes the EXPORT operation and invokes the TOKEN operation at Federation
  B. This action is transparent to the user. The response from Federation B is a
  URL that represents a complete IMPORT operation directed at Federation B. The
  EXPORT operation redirects the user's browser to that URL.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 4.Upon receiving the redirect, the user's
  browser invokes the IMPORT operation at Federation B. Federation B returns new
  credentials and redirects the user's browser to a configured or requested
  URL.</div>
<div class="Pp"></div>
To interoperate with <b>dacs_auth_transfer</b> to import <b>DACS</b>
  credentials, a program must implement the TOKEN operation. It must also
  provide functionality similar to that of the IMPORT operation. Because the
  TOKEN operation returns a URL encapsulating an IMPORT request to which the
  client is redirected, however, the IMPORT operation can be
  implementation-dependent and does need to interoperate with
  <b>dacs_auth_transfer</b>.
<div class="Pp"></div>
To interoperate with <b>dacs_auth_transfer</b> to export credentials to a
  <b>DACS</b> federation, a program must be capable of invoking
  <b>dacs_auth_transfer</b> with the TOKEN operation and its arguments, and
  redirect the client to the URL provided by <b>dacs_auth_transfer</b>.</div>
<h2 class="Ss" title="Ss" id="Web_Service_Arguments"><a class="selflink" href="#Web_Service_Arguments">Web
  Service Arguments</a></h2>
In addition to the <b>standard CGI arguments</b>[12], <b>dacs_auth_agent</b>
  understands a variety of arguments that depend on the operation being
  requested. The descriptions of the arguments that follow are therefore grouped
  by operation.
<div class="Pp"></div>
The additional arguments accepted by <b>dacs_auth_transfer</b> follow.
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Presentation</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div class="Pp"></div>
For this stage, the value of the <i>OPERATION</i> argument is PRESENTATION (case
  insensitive).
<div class="Pp"></div>
The <i>FORMAT</i> argument (see <b>dacs(1)</b>[13]) determines the type of
  output, with the default being HTML.
<div class="Pp"></div>
Additional arguments:
<div class="Pp"></div>
<i>REDIRECT_DEFAULT</i>
<div style="margin-left: 4.00ex;">If &quot;yes&quot; and there is exactly one
  set of credentials and one target federation (i.e., there is nothing for the
  client to select), then automatically redirect the client to a URL
  representing the EXPORT stage of the protocol. Though the client will not be
  required to submit a form, he will not have the opportunity to see which
  identity is being transferred or the name of the target federation.</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Export</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div class="Pp"></div>
For this stage, the value of the <i>OPERATION</i> argument is EXPORT (case
  insensitive).
<div class="Pp"></div>
Additional arguments:
<div class="Pp"></div>
<i>DACS_IDENTITY</i>
<div style="margin-left: 4.00ex;">This is the identity corresponding to the
  credentials to be exported, expressed as a full <b>DACS</b> user identity (see
  <b>dacs(1)</b>[14]).</div>
<div class="Pp"></div>
<i>TARGET_FEDERATION</i>
<div style="margin-left: 4.00ex;">This is the jurisdiction's identifier for the
  federation to which the selected credentials are to be transferred. The user
  will typically select this identifier from a list produced by the same
  jurisdiction that performs the PRESENTATION operation.</div>
<div class="Pp"></div>
<i>TRANSFER_SUCCESS_URL</i>
<div style="margin-left: 4.00ex;">If the transfer operation is successful, the
  user will be redirected to this URL.</div>
<div class="Pp"></div>
<i>TRANSFER_ERROR_URL</i>
<div style="margin-left: 4.00ex;">If the transfer operation fails, the user will
  be redirected to this URL. If unspecified, the AUTH_TRANSFER_ERROR_URL will be
  used if configured, otherwise a message will be emitted.</div>
<div class="Pp"></div>
<i>DACS_DEBUG</i>
<div style="margin-left: 4.00ex;">If &quot;yes&quot;, operate in a debugging
  mode.</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Token</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div class="Pp"></div>
For this stage, the value of the <i>OPERATION</i> argument is TOKEN (case
  insensitive).
<div class="Pp"></div>
Additional arguments:
<div class="Pp"></div>
<i>DACS_IDENTITY</i>
<div style="margin-left: 4.00ex;">The value of this argument is identical to the
  argument of the same name that is passed to the EXPORT stage. If the transfer
  succeeds, this is the identity for which new credentials will be issued.</div>
<div class="Pp"></div>
<i>INITIAL_FEDERATION</i>
<div style="margin-left: 4.00ex;">This is the identifier for the federation that
  received the EXPORT request. The target federation must have a mapping for
  this identifier.</div>
<div class="Pp"></div>
<i>CLIENT_ADDR</i>
<div style="margin-left: 4.00ex;">The IP address from which the EXPORT request
  was issued.</div>
<div class="Pp"></div>
<i>TRANSFER_SUCCESS_URL</i>
<div style="margin-left: 4.00ex;">If the transfer operation is successful, the
  user wants to be redirected to this URL. If unspecified, a default URL will be
  used.</div>
<div class="Pp"></div>
<i>TRANSFER_ERROR_URL</i>
<div style="margin-left: 4.00ex;">If the transfer operation fails, the user will
  be redirected to this URL. If unspecified, a default URL will be used.</div>
<div class="Pp"></div>
<i>DACS_DEBUG</i>
<div style="margin-left: 4.00ex;">If &quot;yes&quot;, operate in a debugging
  mode.</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Import</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div class="Pp"></div>
For this stage, the value of the <i>OPERATION</i> argument is IMPORT (case
  insensitive).
<div class="Pp"></div>
Additional arguments:
<div class="Pp"></div>
<i>TOKEN</i>
<div style="margin-left: 4.00ex;">This is the value of the token returned by a
  previous call to the TOKEN stage of the protocol.</div>
<div class="Pp"></div>
<i>TRANSFER_SUCCESS_URL</i>
<div style="margin-left: 4.00ex;">If the transfer operation is successful, the
  user wants to be redirected to this URL. If unspecified, a default URL
  configured at the target federation using the
  <b>AUTH_TRANSFER_SUCCESS_URL</b>[15] directive will be used.</div>
<div class="Pp"></div>
<i>TRANSFER_ERROR_URL</i>
<div style="margin-left: 4.00ex;">If the transfer operation fails, the user
  wants to be redirected to this URL. If unspecified, a default URL configured
  at the target federation using the <b>AUTH_TRANSFER_ERROR_URL</b>[16] will be
  used.</div>
<div class="Pp"></div>
<i>DACS_DEBUG</i>
<div style="margin-left: 4.00ex;">If &quot;yes&quot;, operate in a debugging
  mode.</div>
</div>
<h1 class="Sh" title="Sh" id="EXAMPLE"><a class="selflink" href="#EXAMPLE">EXAMPLE</a></h1>
The following example describes step-by-step how to configure two <b>DACS</b>
  federations, FED_EX1 (example.com) and FED_EX2 (example.net), to enable
  credentials to be transferred <i>from</i> FED_EX1 <i>to</i> FED_EX2. For
  FED_EX1, the jurisdiction J1 (j1.example.com) will be configured to export
  credentials and for FED_EX2, J2 (j2.example.net) will be configured to import
  credentials. The example assumes that these two jurisdictions have already
  installed and configured <b>DACS</b> and that it is possible to authenticate
  (obtain credentials) somewhere within FED_EX1.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>Note</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
<div class="Pp"></div>
This example will not actually work without changing the domain names, URLs, and
  identities that it uses for demonstration purposes to those configured for
  your federations and jurisdictions. Having successfully reproduced this
  example functionality on your systems, it should be apparent how to extend it
  for additional jurisdictions and federations, and how to make credential
  transfer bidirectional.
<div style="height: 0.50em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 1.At J1, add a jurisdiction-specific access
  control rule that allows <b>dacs_auth_transfer</b> to be used to export an
  identity:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
&lt;acl_rule status=&quot;enabled&quot;&gt;
 &lt;services&gt;
  &lt;service url_expr='&quot;${Conf::dacs_cgi_bin_prefix}/dacs_auth_transfer&quot;'/&gt;
 &lt;/services&gt;
<div class="Pp"></div>
 &lt;rule order=&quot;allow,deny&quot; pass_credentials=&quot;all&quot;&gt;
  &lt;allow&gt;
    user(&quot;auth&quot;) and (${Args::OPERATION} eq &quot;PRESENTATION&quot;
      or ${Args::OPERATION} eq &quot;EXPORT&quot;)
  &lt;/allow&gt;
 &lt;/rule&gt;
&lt;/acl_rule&gt;
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
At J2, add a jurisdiction-specific access control rule that allows
  <b>dacs_auth_transfer</b> to be used to import an identity:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
&lt;acl_rule status=&quot;enabled&quot;&gt;
 &lt;services&gt;
  &lt;service url_expr='&quot;${Conf::dacs_cgi_bin_prefix}/dacs_auth_transfer&quot;'/&gt;
 &lt;/services&gt;
<div class="Pp"></div>
 &lt;rule order=&quot;allow,deny&quot; pass_credentials=&quot;all&quot;&gt;
  &lt;allow&gt;
    (from(&quot;j1.example.com&quot;) and ${Args::OPERATION} eq &quot;TOKEN&quot;)
      or ${Args::OPERATION} eq &quot;IMPORT&quot;
  &lt;/allow&gt;
 &lt;/rule&gt;
&lt;/acl_rule&gt;
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>Security</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
In particular, the rule at the target federation must restrict access based on
  the identity, or possibly the IP address, associated with the request. If the
  cookie-based authentication method is used, the rule would test for that
  specific identity.
<div style="height: 0.50em;">&#x00A0;</div>
</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 2.At J1, configure <b>dacs_auth_transfer</b>
  to know how to invoke the TOKEN operation so that it can export credentials to
  FED_EX2. Add this directive to dacs.conf:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
AUTH_TRANSFER_EXPORT \
  &quot;FED_EX2 https://j2.example.net/cgi-bin/dacs/dacs_auth_transfer&quot;
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
Note that this is the only required additional configuration at J1.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 3.At J2, configure <b>dacs_auth_transfer</b>
  so that it will import credentials from FED_EX1. Add a Transfer clause to
  dacs.conf:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
ACCEPT_ALIEN_CREDENTIALS &quot;yes&quot;
<div class="Pp"></div>
&lt;Transfer id=&quot;fed_ex1&quot;&gt;
IMPORT_FROM &quot;FED_EX1&quot;
SUCCESS_URL \
  &quot;https://j2.example.net/cgi-bin/dacs/dacs_current_credentials&quot;
&lt;/Transfer&gt;
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
This configuration allows credentials to be imported from federation FED_EX1. As
  the default, after successful importation users will be redirected to a page
  that lists their identities in federation FED_EX2. In practice this might
  point to the site's home page, for example. The jurisdiction must be told to
  recognize credentials imported from FED_EX2 using the ACCEPT_ALIEN_CREDENTIALS
  directive.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 4.The configuration can now be tested. First,
  authenticate somewhere within FED_EX1 using your browser. Let's assume that
  you authenticated as the identity FED_EX1::J1:bob so that this example can
  refer to a specific name. Invoke this URL from the browser:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
https://j1.example.com/cgi-bin/dacs/dacs_auth_transfer?OPERATION=PRESENTATION
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
You should be presented with a web page that displays the identity
  FED_EX1::J1:bob (and any others that happen to be in effect) and the target
  federation name FED_EX2 (and any other federations specified by a
  AUTH_TRANSFER_EXPORT directive). It might be instructive to view the source
  for the HTML page if you are still not clear about what the PRESENTATION
  operation does. Click on the Transfer button (if necessary, first selecting an
  identity and target federation).
<div style="height: 1.00em;">&#x00A0;</div>
One can bypass the PRESENTATION operation by directly invoking the URL:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
https://j1.example.com/cgi-bin/dacs/dacs_auth_transfer?\
OPERATION=EXPORT&amp;DACS_IDENTITY=FED_EX1::J1:bob
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
If the transfer is successful, your browser should now possess the original
  credentials for the identity FED_EX1::J1:bob, valid within FED_EX1, and
  credentials for the identity FED_EX1::J1:bob that are valid within FED_EX2;
  <b>dacs_current_credentials</b>, where your browser should be redirected to in
  this example, should display the latter. Note that though issued by different
  sites, the two cookies have the same cookie name.</div>
<div class="Pp"></div>
The following example illustrates how an identity might be transferred from a
  non- <b>DACS</b> federation (SOME_FED) to a <b>DACS</b> federation (again,
  FED_EX2 via its jurisdiction J2). We will assume that an appropriate access
  control rule has been configured at J2.
<div class="Pp"></div>
As in the previous example, at J2, configure <b>dacs_auth_transfer</b> so that
  it will import credentials from SOME_FED by adding a Transfer clause to
  dacs.conf:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
ACCEPT_ALIEN_CREDENTIALS &quot;yes&quot;
<div class="Pp"></div>
&lt;Transfer id=&quot;some_fed&quot;&gt;
IMPORT_FROM  &quot;SOME_FED&quot;
REFEDERATE   &quot;YES&quot;
IMPORT_ROLES &quot;NO&quot;
&lt;/Transfer&gt;
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
This configuration allows credentials to be imported from federation SOME_FED.
<div class="Pp"></div>
A system administrator must write a small program, run somewhere within
  SOME_FED, that will invoke <b>dacs_auth_transfer</b> at J2 with appropriate
  arguments. The program might be run automatically as part of the login
  procedure at SOME_FED or explicitly by providing a link that a user can follow
  (e.g., labelled &quot;Transfer Login To FED_EX2&quot;, or similar). The
  program simply invokes the TOKEN operation at J2 and, if successful, redirects
  the user to the URL that is returned to it by <b>dacs_auth_transfer</b> (which
  represents an IMPORT operation). If the IMPORT operation succeeds, the user
  will be issued an HTTP cookie bearing the <b>DACS</b> credentials. If desired,
  the URL that the user should visit after a successful transfer can be
  specified through the <i>TRANSFER_SUCCESS_URL</i> argument.
<div class="Pp"></div>
The program might initiate the transfer by constructing and invoking a URL (via
  the POST method) much like this:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
import_url=`http -p INITIAL_FEDERATION &quot;SOME_FED&quot; \
  -p DACS_IDENTITY &quot;FED_EX2::J2:bobo&quot; \
  -p CLIENT_ADDR 127.0.0.1 \
  -p TRANSFER_SUCCESS_URL \
    &quot;https://j2.example.net/cgi-bin/dacs/dacs_current_credentials&quot; \
  -p OPERATION TOKEN \
  'https://j2.example.net/cgi-bin/dacs/dacs_auth_transfer'`
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
Here, the requested <b>DACS</b> identity is FED_EX2::J2:bobo. If the response
  looks like a URL, then the TOKEN operation succeeded; to continue the
  transfer, the program must redirect the user to the URL. In this example, if
  credentials are returned to the user, the user will be redirected to
  <b>dacs_current_credentials</b> by <b>DACS</b> (which is useful for testing
  but unlikely in actual use).
<h1 class="Sh" title="Sh" id="FILES"><a class="selflink" href="#FILES">FILES</a></h1>
<b>dacs_auth_transfer.css</b>[4]
<h1 class="Sh" title="Sh" id="DIAGNOSTICS"><a class="selflink" href="#DIAGNOSTICS">DIAGNOSTICS</a></h1>
The program exits 0 if everything was fine, 1 if an error occurred.
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>dacs_authenticate(8)</b>[17], <b>dacs_auth_agent(8)</b>[18],
  <b>dacs.conf(5)</b>[19]
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
The jurisdictional meta information should be extended to identify importing and
  exporting jurisdictions (e.g., as reported by
  <b>dacs_list_jurisdictions(8)</b>[20]).
<div class="Pp"></div>
It should be possible to optionally perform comparative checks on the IP address
  from which the EXPORT request was issued and the IP address from which the
  IMPORT request was issued. At present, if they are not identical a warning
  message is logged but importation is allowed.
<div class="Pp"></div>
The current implementation is stateless on the server side. By including a nonce
  in the token, the possibility of replay could be further reduced.
<div class="Pp"></div>
A mechanism for mapping imported names may be needed.
<div class="Pp"></div>
Although the credential's <b>DACS</b> role string is passed to the target
  federation, a flexible mechanism for optionally including them in the imported
  credentials should be added.
<div class="Pp"></div>
The protocol should be improved with respect to peer identification for the
  TOKEN operation.
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Distributed Systems Software ( <b>www.dss.ca</b>[21])
<h1 class="Sh" title="Sh" id="COPYING"><a class="selflink" href="#COPYING">COPYING</a></h1>
Copyright2003-2015 Distributed Systems Software. See the <b>LICENSE</b>[22] file
  that accompanies the distribution for licensing information.
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"> 1.</dt>
  <dd class="It-tag">dacsoptions</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.1.html#dacsoptions</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 2.</dt>
  <dd class="It-tag">ACCEPT_ALIEN_CREDENTIALS</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.conf.5.html#ACCEPT_ALIEN_CREDENTIALS</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 3.</dt>
  <dd class="It-tag">dacs.acls(5)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.acls.5.html</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 4.</dt>
  <dd class="It-tag">dacs_auth_transfer.css</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man//css/dacs_auth_transfer.css</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 5.</dt>
  <dd class="It-tag">dacs_auth_transfer.dtd</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/../dtd-xsd/dacs_auth_transfer.dtd</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 6.</dt>
  <dd class="It-tag">AUTH_TRANSFER_EXPORT</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.conf.5.html#AUTH_TRANSFER_EXPORT</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 7.</dt>
  <dd class="It-tag">SSL_PROG_CLIENT_CRT</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.conf.5.html#SSL_PROG_CLIENT_CRT</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 8.</dt>
  <dd class="It-tag">dacscookie(1)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacscookie.1.html</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 9.</dt>
  <dd class="It-tag">AUTH_TRANSFER_TOKEN_LIFETIME_SECS</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.conf.5.html#AUTH_TRANSFER_TOKEN_LIFETIME_SECS</div>
<dl class="Bl-tag">
  <dt class="It-tag">10.</dt>
  <dd class="It-tag">user()</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.exprs.5.html#user</div>
<dl class="Bl-tag">
  <dt class="It-tag">11.</dt>
  <dd class="It-tag">AUTH_CREDENTIALS_DEFAULT_LIFETIME_SECS</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.conf.5.html#AUTH_CREDENTIALS_DEFAULT_LIFETIME_SECS</div>
<dl class="Bl-tag">
  <dt class="It-tag">12.</dt>
  <dd class="It-tag">standard CGI arguments</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.services.8.html#standard_cgi_args</div>
<dl class="Bl-tag">
  <dt class="It-tag">13.</dt>
  <dd class="It-tag">dacs(1)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.1.html</div>
<dl class="Bl-tag">
  <dt class="It-tag">14.</dt>
  <dd class="It-tag">dacs(1)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.1.html#naming</div>
<dl class="Bl-tag">
  <dt class="It-tag">15.</dt>
  <dd class="It-tag">AUTH_TRANSFER_SUCCESS_URL</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.conf.5.html#AUTH_TRANSFER_SUCCESS_URL</div>
<dl class="Bl-tag">
  <dt class="It-tag">16.</dt>
  <dd class="It-tag">AUTH_TRANSFER_ERROR_URL</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.conf.5.html#AUTH_TRANSFER_ERROR_URL</div>
<dl class="Bl-tag">
  <dt class="It-tag">17.</dt>
  <dd class="It-tag">dacs_authenticate(8)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_authenticate.8.html</div>
<dl class="Bl-tag">
  <dt class="It-tag">18.</dt>
  <dd class="It-tag">dacs_auth_agent(8)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_auth_agent.8.html</div>
<dl class="Bl-tag">
  <dt class="It-tag">19.</dt>
  <dd class="It-tag">dacs.conf(5)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.conf.5.html</div>
<dl class="Bl-tag">
  <dt class="It-tag">20.</dt>
  <dd class="It-tag">dacs_list_jurisdictions(8)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_list_jurisdictions.8.html</div>
<dl class="Bl-tag">
  <dt class="It-tag">21.</dt>
  <dd class="It-tag">www.dss.ca</dd>
</dl>
<div style="margin-left: 4.00ex;">http://www.dss.ca</div>
<dl class="Bl-tag">
  <dt class="It-tag">22.</dt>
  <dd class="It-tag">LICENSE</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/../misc/LICENSE</div>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">01/12/2017</td>
    <td class="foot-os">DACS 1.4.38a</td>
  </tr>
</table>
</body>
</html>
