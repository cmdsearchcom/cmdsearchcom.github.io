<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 19:10:00 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>DACS_AUTH_AGENT(8) DACS Web Services Manual
DACS_AUTH_AGENT(8)</p>

<p style="margin-top: 1em">NAME <br>
dacs_auth_agent - DACS delegated authentication service</p>

<p style="margin-top: 1em">SYNOPSIS <br>
dacs_auth_agent [dacsoptions[1]]</p>

<p style="margin-top: 1em">DESCRIPTION <br>
This web service is part of the DACS suite.</p>

<p style="margin-top: 1em">The dacs_auth_agent web service
is used to request DACS credentials outside of the usual
DACS authentication procedure (see dacs_authenticate(8)[2]).
The client making the <br>
service request, whether a user agent or middleware, is
considered to be an &quot;agent&quot; trusted by the
jurisdiction that receives the request by virtue of having
obtained DACS <br>
credentials and satisfying DACS access control rules that
grant it access to this service. In other words, an agent
simply requests credentials for a given identity from <br>
dacs_auth_agent and they are returned if an access control
rule grants access and dacs_auth_agent is configured
appropriately.</p>

<p style="margin-top: 1em">The agent&rsquo;s DACS
credentials can be obtained through dacs_authenticate(8)[2],
dacs_auth_transfer(8)[3], dacscred(1)[4], dacscookie(1)[5],
or even dacs_auth_agent.</p>

<p style="margin-top: 1em">If the request is successful,
credentials are returned to the client within an HTTP
cookie. Credentials generated by this service can be
distinguished from those created by one <br>
of the other methods.</p>

<p style="margin-top: 1em">Security <br>
Access control rules are responsible for expressing
restrictions on the types of operations to be granted to
various trusted agents. Access to this web service must not
be <br>
granted without establishing and testing carefully crafted
access control rules and appropriate configuration. By
default, all access to this service is denied.</p>

<p style="margin-top: 1em">Much like Unix&rsquo;s su(1)[6]
command lets the superuser assume the Unix identity of any
other user, this service provides a way for a privileged
client to request credentials for a <br>
user known to the receiving jurisdiction. Any other
credentials in the possession of the client remain in
effect. Help desk personnel and system administrators can
use this <br>
capability to assist users by temporarily impersonating a
user without having to know the user&rsquo;s password,
obtaining the user&rsquo;s client certificate, or following
the user&rsquo;s usual <br>
authentication procedure.</p>

<p style="margin-top: 1em">The service can also be invoked
to effectively import an identity that is recognized by the
agent but possibly not known to the receiving jurisdiction.
This provides a way to <br>
convert foreign credentials, whether from a non-DACS based
system or a different DACS federation, into credentials
understood by the federation of the receiving jurisdiction.
It <br>
is only necessary for the agent to understand the foreign
credentials; DACS never sees them.</p>

<p style="margin-top: 1em">Another use of this service is
in conjunction with middleware that does its own
authentication. Having authenticated a user, an application
can ask dacs_auth_agent for DACS <br>
credentials for the user.</p>

<p style="margin-top: 1em">Web Service Arguments <br>
In addition to the standard CGI arguments[7],
dacs_auth_agent understands the following CGI arguments:</p>

<p style="margin-top: 1em">USERNAME <br>
If present, the agent asserts that USERNAME is in some sense
known to this jurisdiction.</p>

<p style="margin-top: 1em">ALIEN_FEDERATION <br>
If present, the agent asserts that ALIEN_USERNAME, which
must be provided, is associated with the named external
system. This can be any string comprised of characters <br>
allowed in a DACS username; presumably the agent and DACS
jurisdiction have agreed on the name to use. This name, or a
string mapped from it, will be incorporated into the <br>
resulting DACS username and credentials.</p>

<p style="margin-top: 1em">ALIEN_USERNAME <br>
If present, the ALIEN_FEDERATION argument must also be
given. The agent asserts that the given name, relative to
ALIEN_FEDERATION, has been authenticated. This can be any
<br>
string comprised of characters allowed in a DACS username.
This name, or a string mapped from it, will be incorporated
into the resulting DACS username and credentials.</p>

<p style="margin-top: 1em">DACS_JURISDICTION <br>
This identifies the receiving jurisdiction.</p>

<p style="margin-top: 1em">DACS_BROWSER <br>
This optional parameter is as described for the
dacs_authenticate(8)[2] service.</p>

<p style="margin-top: 1em">OPERATION <br>
This optional parameter is as described for the
dacs_authenticate(8)[2] service.</p>

<p style="margin-top: 1em">COOKIE_SYNTAX <br>
This optional parameter is as described for the
dacs_authenticate(8)[2] service.</p>

<p style="margin-top: 1em">Operation <br>
There are two modes of operation. In local mode, the
USERNAME argument is provided and is purported to be the
DACS username of a user known to the receiving
jurisdiction.</p>

<p style="margin-top: 1em">The second mode, called alien
mode, is selected if both an ALIEN_FEDERATION argument and
an ALIEN_USERNAME argument are present. It is an error if
only one of these arguments is <br>
given, and the USERNAME is ignored. The mode checks that the
ALIEN_FEDERATION and the ALIEN_USERNAME relative to it are
satisfactory. This is done by requiring the <br>
ALIEN_FEDERATION to be recognized by the receiving
jurisdiction; it may optionally be mapped to a different
string. Similarly, the ALIEN_USERNAME argument must be
recognized, <br>
relative to ALIEN_FEDERATION or the string mapped from
it.</p>

<p style="margin-top: 1em">Credentials that have been
designated as an ADMIN_IDENTITY[8] will be returned only if
the AUTH_AGENT_ALLOW_ADMIN_IDENTITY[9] configuration
directive has the value &quot;yes&quot;. Refer <br>
to dacs.conf(5)[10] for a description of these configuration
directives.</p>

<p style="margin-top: 1em">A revocation test is always
performed on the DACS identity; see dacs.acls(5)[11] for a
description of how authentication revocation works.</p>

<p style="margin-top: 1em">Local Mode <br>
If the USERNAME argument is provided, it must consist of
printable characters, as determined by isprint(3)[12].</p>

<p style="margin-top: 1em">By default, dacs_auth_agent will
blindly accept the trusted client&rsquo;s assertion that
USERNAME is known to the receiving jurisdiction. An
administrator can constrain USERNAME, <br>
however, and optionally map it into a replacement that is a
valid DACS username.</p>

<p style="margin-top: 1em">If the virtual filestore item
type &quot;auth_agent_local&quot; is configured, it is
expected to name a file consisting of expressions, one per
line (a continued line ends with a <br>
backslash). Each expression is evaluated in turn until one
returns a non-empty string value; this value, which must be
a syntactically correct DACS username, becomes the <br>
mapped username. An evaluation error is fatal. The value of
the USERNAME argument is available to each expression as
${Expr::_} (reminiscent of Perl&rsquo;s $_ variable).</p>

<p style="margin-top: 1em">For example, consider the
configuration directive:</p>

<p style="margin-top: 1em">VFS
&quot;[auth_agent_local]dacs-fs:/usr/local/dacs/auth_agent_local_users&quot;</p>

<p style="margin-top: 1em">and the file
/usr/local/dacs/auth_agent_local_users, which contains:</p>

<p style="margin-top: 1em">regsub(${Expr::_}, &quot;^auggie
doggie$&quot;, &quot;auggie&quot;) <br>
regsub(${Expr::_}, &quot;^julia$&quot;, &quot;sara&quot;)
<br>
strtr(regsub(${Expr::_}, &quot;:]*://.]*\.&quot;,
&rsquo;${1}-${2}@${3}&rsquo;), &quot;A-Z&quot;,
&quot;a-z&quot;)</p>

<p style="margin-top: 1em">If USERNAME is &quot;auggie
doggie&quot;, credentials will be issued for
&quot;auggie&quot;. If USERNAME is &quot;julia&quot;,
credentials will be issued for &quot;sara&quot;. If USERNAME
is <br>
&quot;https://Bob.Example.com&quot;, the third expression
will return the string &quot;https-bob@example.com&quot;,
which will become the mapped name (this example is apropos
of mapping <br>
OpenID[13] names).</p>

<p style="margin-top: 1em">When configured, roles are
obtained for USERNAME in the same way as is done for
dacs_authenticate(8)[2].</p>

<p style="margin-top: 1em">Alien Mode <br>
The alien mode of operation proceeds as follows:</p>

<p style="margin-top: 1em">1. It looks up ALIEN_FEDERATION
using item type auth_agent_federations. When forming a key,
the lookup operation will percent-encode any &rsquo;:&rsquo;
and &rsquo;%&rsquo; characters in <br>
ALIEN_FEDERATION, so the same encoding is required for keys
that appear in auth_agent_federations. If it is not found,
authentication fails. If found, it may optionally <br>
have a value; that value will be used within the resulting
DACS credentials instead of the ALIEN_FEDERATION argument.
In any case, the resulting value must be valid for a <br>
DACS username.</p>

<p style="margin-top: 1em">2. It looks up ALIEN_USERNAME
using an item type constructed by prepending the string
&quot;auth_agent_federation_&quot; to the federation name
derived during the previous step. When <br>
forming a key, the lookup operation will percent-encode any
&rsquo;:&rsquo; and &rsquo;%&rsquo; characters in
ALIEN_USERNAME, so the same encoding is required for stored
keys. If it is not <br>
found, authentication fails. If found, it may optionally
have a value; that value will be used within the resulting
DACS credentials instead of the ALIEN_USERNAME <br>
argument. In any case, the resulting string must be valid
for a DACS username.</p>

<p style="margin-top: 1em">3. A DACS username will be
formed using the federation name and username strings
derived in the previous steps.</p>

<p style="margin-top: 1em">EXAMPLES <br>
The following is an example of local mode operation. Assume
the following configuration directive is in effect:</p>

<p style="margin-top: 1em">VFS
&quot;[auth_agent_local]dacs-fs:/usr/local/dacs/auth_agent_local_users&quot;</p>

<p style="margin-top: 1em">Also assume that the file
/usr/local/dacs/auth_agent_local_users contains the
expression:</p>

<p style="margin-top: 1em">regsub(${Expr::_},
&quot;:]*://.]*\.&quot;, &rsquo;${1}-${2}@${3}&rsquo;)</p>

<p style="margin-top: 1em">If a request is made with
USERNAME equal to &quot;http://Bob.Example.com&quot;, new
credentials will be issued for
&quot;http-Bob@Example.com&quot; relative to the current
jurisdiction.</p>

<p style="margin-top: 1em">The following is an example of
alien mode operation. Assume the following configuration
directives are in effect:</p>

<p style="margin-top: 1em">VFS
&quot;[auth_agent_federations]dacs-kwv-fs:/usr/local/dacs/auth_agent_feds&quot;
<br>
VFS
&quot;[auth_agent_federation_mars]dacs-kwv-fs:/usr/local/dacs/auth_agent_fed_mars&quot;</p>

<p style="margin-top: 1em">Also assume that the file
/usr/local/dacs/auth_agent_feds consists of the line</p>

<p style="margin-top: 1em">MARS:</p>

<p style="margin-top: 1em">and the file
/usr/local/dacs/auth_agent_fed_mars consists of the line</p>

<p style="margin-top: 1em">gazoo:</p>

<p style="margin-top: 1em">If a request is made with
ALIEN_FEDERATION equal to &quot;MARS&quot; and
ALIEN_USERNAME equal to &quot;gazoo&quot;, the request will
satisfy alien mode&rsquo;s rules of operation with the
strings &quot;MARS&quot; <br>
and &quot;gazoo&quot; being used to form the DACS username
relative to the current jurisdiction
(DACS_JURISDICTION).</p>

<p style="margin-top: 1em">If instead ALIEN_FEDERATION were
&quot;http://example.com&quot; and the file
/usr/local/dacs/auth_agent_feds looked like:</p>


<p style="margin-top: 1em">http%3A//example.com:example</p>

<p style="margin-top: 1em">then the string
&quot;example&quot; would be used with &quot;gazoo&quot; to
form the DACS username.</p>

<p style="margin-top: 1em">DIAGNOSTICS <br>
The program exits 0 if everything was fine, 1 if an error
occurred.</p>

<p style="margin-top: 1em">NOTES <br>
The word &quot;alien&quot; is used because it sounds cooler
than &quot;foreign&quot; and is arguably easier to
spell.</p>

<p style="margin-top: 1em">A superficially similar feature
called &quot;affiliated DACS federations&quot;, which
provides single sign-on across federation boundaries, is
sometimes a more appropriate solution; see <br>
dacs_auth_transfer(8)[3].</p>

<p style="margin-top: 1em">BUGS <br>
It should be possible for keys that are matched against
USERNAME to be regular expressions and for the corresponding
replacement values to interpolate matched substrings.</p>

<p style="margin-top: 1em">SEE ALSO <br>
dacs_authenticate(8)[2], dacs_auth_transfer(8)[3],
dacs_current_credentials(8)[14], dacs_signout(8)[15],
dacs.exprs(5)[16], dacscred(1)[4], dacscookie(1)[5].</p>

<p style="margin-top: 1em">AUTHOR <br>
Distributed Systems Software (www.dss.ca[17])</p>

<p style="margin-top: 1em">COPYING <br>
Copyright2003-2014 Distributed Systems Software. See the
LICENSE[18] file that accompanies the distribution for
licensing information.</p>

<p style="margin-top: 1em">NOTES <br>
1. dacsoptions <br>
http://dacs.dss.ca/man/dacs.1.html#dacsoptions</p>

<p style="margin-top: 1em">2. dacs_authenticate(8) <br>
http://dacs.dss.ca/man/dacs_authenticate.8.html</p>

<p style="margin-top: 1em">3. dacs_auth_transfer(8) <br>
http://dacs.dss.ca/man/dacs_auth_transfer.8.html</p>

<p style="margin-top: 1em">4. dacscred(1) <br>
http://dacs.dss.ca/man/dacscred.1.html</p>

<p style="margin-top: 1em">5. dacscookie(1) <br>
http://dacs.dss.ca/man/dacscookie.1.html</p>

<p style="margin-top: 1em">6. su(1) <br>

http://www.freebsd.org/cgi/man.cgi?query=su&amp;apropos=0&amp;sektion=1&amp;manpath=FreeBSD+10.1-RELEASE&amp;format=html</p>

<p style="margin-top: 1em">7. standard CGI arguments <br>

http://dacs.dss.ca/man/dacs.services.8.html#standard_cgi_args</p>

<p style="margin-top: 1em">8. ADMIN_IDENTITY <br>
http://dacs.dss.ca/man/dacs.conf.5.html#ADMIN_IDENTITY</p>

<p style="margin-top: 1em">9.
AUTH_AGENT_ALLOW_ADMIN_IDENTITY <br>

http://dacs.dss.ca/man/dacs.conf.5.html#AUTH_AGENT_ALLOW_ADMIN_IDENTITY</p>

<p style="margin-top: 1em">10. dacs.conf(5) <br>
http://dacs.dss.ca/man/dacs.conf.5.html</p>

<p style="margin-top: 1em">11. dacs.acls(5) <br>
http://dacs.dss.ca/man/dacs.acls.5.html</p>

<p style="margin-top: 1em">12. isprint(3) <br>

http://www.freebsd.org/cgi/man.cgi?query=isprint&amp;apropos=0&amp;sektion=3&amp;manpath=FreeBSD+10.1-RELEASE&amp;format=html</p>

<p style="margin-top: 1em">13. OpenID <br>
http://openid.net/</p>

<p style="margin-top: 1em">14. dacs_current_credentials(8)
<br>
http://dacs.dss.ca/man/dacs_current_credentials.8.html</p>

<p style="margin-top: 1em">15. dacs_signout(8) <br>
http://dacs.dss.ca/man/dacs_signout.8.html</p>

<p style="margin-top: 1em">16. dacs.exprs(5) <br>
http://dacs.dss.ca/man/dacs.exprs.5.html</p>

<p style="margin-top: 1em">17. www.dss.ca <br>
http://www.dss.ca</p>

<p style="margin-top: 1em">18. LICENSE <br>
http://dacs.dss.ca/man/../misc/LICENSE</p>

<p style="margin-top: 1em">DACS 1.4.38a 01/12/2017
DACS_AUTH_AGENT(8)</p>
<hr>
</body>
</html>
