<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>DACS_AUTH_AGENT(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">DACS_AUTH_AGENT(8)</td>
    <td class="head-vol">DACS Web Services Manual</td>
    <td class="head-rtitle">DACS_AUTH_AGENT(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
dacs_auth_agent - <b>DACS</b> delegated authentication service
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<div class="Pp" style="margin-left: 16.00ex; text-indent: -16.00ex;"><b>dacs_auth_agent</b>
  [ <i></i><b>dacsoptions</b>[1]]</div>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
This web service is part of the <b>DACS</b> suite.
<div class="Pp"></div>
The <b>dacs_auth_agent</b> web service is used to request <b>DACS</b>
  credentials outside of the usual <b>DACS</b> authentication procedure (see
  <b>dacs_authenticate(8)</b>[2]). The client making the service request,
  whether a user agent or middleware, is considered to be an &quot;agent&quot;
  trusted by the jurisdiction that receives the request by virtue of having
  obtained <b>DACS</b> credentials and satisfying <b>DACS</b> access control
  rules that grant it access to this service. In other words, an agent simply
  requests credentials for a given identity from <b>dacs_auth_agent</b> and they
  are returned if an access control rule grants access and
  <b>dacs_auth_agent</b> is configured appropriately.
<div class="Pp"></div>
The agent's <b>DACS</b> credentials can be obtained through
  <b>dacs_authenticate(8)</b>[2], <b>dacs_auth_transfer(8)</b>[3],
  <b>dacscred(1)</b>[4], <b>dacscookie(1)</b>[5], or even
  <b>dacs_auth_agent</b>.
<div class="Pp"></div>
If the request is successful, credentials are returned to the client within an
  HTTP cookie. Credentials generated by this service can be distinguished from
  those created by one of the other methods.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>Security</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
<div class="Pp"></div>
Access control rules are responsible for expressing restrictions on the types of
  operations to be granted to various trusted agents. Access to this web service
  must not be granted without establishing and testing carefully crafted access
  control rules and appropriate configuration. By default, all access to this
  service is denied.
<div style="height: 0.50em;">&#x00A0;</div>
</div>
<div class="Pp"></div>
Much like Unix's <b>su(1)</b>[6] command lets the superuser assume the Unix
  identity of any other user, this service provides a way for a privileged
  client to request credentials for a user known to the receiving jurisdiction.
  Any other credentials in the possession of the client remain in effect. Help
  desk personnel and system administrators can use this capability to assist
  users by temporarily impersonating a user without having to know the user's
  password, obtaining the user's client certificate, or following the user's
  usual authentication procedure.
<div class="Pp"></div>
The service can also be invoked to effectively import an identity that is
  recognized by the agent but possibly not known to the receiving jurisdiction.
  This provides a way to convert foreign credentials, whether from a non-
  <b>DACS</b> based system or a different <b>DACS</b> federation, into
  credentials understood by the federation of the receiving jurisdiction. It is
  only necessary for the agent to understand the foreign credentials;
  <b>DACS</b> never sees them.
<div class="Pp"></div>
Another use of this service is in conjunction with middleware that does its own
  authentication. Having authenticated a user, an application can ask
  <b>dacs_auth_agent</b> for <b>DACS</b> credentials for the user.
<h2 class="Ss" title="Ss" id="Web_Service_Arguments"><a class="selflink" href="#Web_Service_Arguments">Web
  Service Arguments</a></h2>
In addition to the <b>standard CGI arguments</b>[7], <b>dacs_auth_agent</b>
  understands the following CGI arguments:
<div class="Pp"></div>
<i>USERNAME</i>
<div style="margin-left: 4.00ex;">If present, the agent asserts that
  <i>USERNAME</i> is in some sense known to this jurisdiction.</div>
<div class="Pp"></div>
<i>ALIEN_FEDERATION</i>
<div style="margin-left: 4.00ex;">If present, the agent asserts that
  <i>ALIEN_USERNAME</i>, which must be provided, is associated with the named
  external system. This can be any string comprised of characters allowed in a
  <b>DACS</b> username; presumably the agent and <b>DACS</b> jurisdiction have
  agreed on the name to use. This name, or a string mapped from it, will be
  incorporated into the resulting <b>DACS</b> username and credentials.</div>
<div class="Pp"></div>
<i>ALIEN_USERNAME</i>
<div style="margin-left: 4.00ex;">If present, the <i>ALIEN_FEDERATION</i>
  argument must also be given. The agent asserts that the given name, relative
  to <i>ALIEN_FEDERATION</i>, has been authenticated. This can be any string
  comprised of characters allowed in a <b>DACS</b> username. This name, or a
  string mapped from it, will be incorporated into the resulting <b>DACS</b>
  username and credentials.</div>
<div class="Pp"></div>
<i>DACS_JURISDICTION</i>
<div style="margin-left: 4.00ex;">This identifies the receiving
  jurisdiction.</div>
<div class="Pp"></div>
<i>DACS_BROWSER</i>
<div style="margin-left: 4.00ex;">This optional parameter is as described for
  the <b>dacs_authenticate(8)</b>[2] service.</div>
<div class="Pp"></div>
<i>OPERATION</i>
<div style="margin-left: 4.00ex;">This optional parameter is as described for
  the <b>dacs_authenticate(8)</b>[2] service.</div>
<div class="Pp"></div>
<i>COOKIE_SYNTAX</i>
<div style="margin-left: 4.00ex;">This optional parameter is as described for
  the <b>dacs_authenticate(8)</b>[2] service.</div>
<h2 class="Ss" title="Ss" id="Operation"><a class="selflink" href="#Operation">Operation</a></h2>
There are two modes of operation. In local mode, the <i>USERNAME</i> argument is
  provided and is purported to be the <b>DACS</b> username of a user known to
  the receiving jurisdiction.
<div class="Pp"></div>
The second mode, called alien mode, is selected if both an
  <i>ALIEN_FEDERATION</i> argument and an <i>ALIEN_USERNAME</i> argument are
  present. It is an error if only one of these arguments is given, and the
  <i>USERNAME</i> is ignored. The mode checks that the <i>ALIEN_FEDERATION</i>
  and the <i>ALIEN_USERNAME</i> relative to it are satisfactory. This is done by
  requiring the <i>ALIEN_FEDERATION</i> to be recognized by the receiving
  jurisdiction; it may optionally be mapped to a different string. Similarly,
  the <i>ALIEN_USERNAME</i> argument must be recognized, relative to
  <i>ALIEN_FEDERATION</i> or the string mapped from it.
<div class="Pp"></div>
Credentials that have been designated as an <b>ADMIN_IDENTITY</b>[8] will be
  returned only if the <b>AUTH_AGENT_ALLOW_ADMIN_IDENTITY</b>[9] configuration
  directive has the value &quot;yes&quot;. Refer to <b>dacs.conf(5)</b>[10] for
  a description of these configuration directives.
<div class="Pp"></div>
A revocation test is always performed on the <b>DACS</b> identity; see
  <b>dacs.acls(5)</b>[11] for a description of how authentication revocation
  works.
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Local Mode</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div class="Pp"></div>
If the <i>USERNAME</i> argument is provided, it must consist of printable
  characters, as determined by <b>isprint(3)</b>[12].
<div class="Pp"></div>
By default, <b>dacs_auth_agent</b> will blindly accept the trusted client's
  assertion that <i>USERNAME</i> is known to the receiving jurisdiction. An
  administrator can constrain <i>USERNAME</i>, however, and optionally map it
  into a replacement that is a valid <b>DACS</b> username.
<div class="Pp"></div>
If the virtual filestore item type &quot;auth_agent_local&quot; is configured,
  it is expected to name a file consisting of expressions, one per line (a
  continued line ends with a backslash). Each expression is evaluated in turn
  until one returns a non-empty string value; this value, which must be a
  syntactically correct <b>DACS</b> username, becomes the mapped username. An
  evaluation error is fatal. The value of the <i>USERNAME</i> argument is
  available to each expression as <i>${Expr::_}</i> (reminiscent of Perl's
  <i>$_</i> variable).
<div class="Pp"></div>
For example, consider the configuration directive:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
VFS &quot;[auth_agent_local]dacs-fs:/usr/local/dacs/auth_agent_local_users&quot;
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
and the file /usr/local/dacs/auth_agent_local_users, which contains:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
regsub(${Expr::_}, &quot;^auggie doggie$&quot;, &quot;auggie&quot;)
regsub(${Expr::_}, &quot;^julia$&quot;, &quot;sara&quot;)
strtr(regsub(${Expr::_}, \
    &quot;\([^:]*\)://\([^.]*\)\\.\(.*\)&quot;, '${1}-${2}@${3}'), \
      &quot;A-Z&quot;, &quot;a-z&quot;)
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
If <i>USERNAME</i> is &quot;auggie doggie&quot;, credentials will be issued for
  &quot;auggie&quot;. If <i>USERNAME</i> is &quot;julia&quot;, credentials will
  be issued for &quot;sara&quot;. If <i>USERNAME</i> is
  &quot;https://Bob.Example.com&quot;, the third expression will return the
  string &quot;https-bob@example.com&quot;, which will become the mapped name
  (this example is apropos of mapping <b>OpenID</b>[13] names).
<div class="Pp"></div>
When configured, roles are obtained for <i>USERNAME</i> in the same way as is
  done for <b>dacs_authenticate(8)</b>[2].</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Alien Mode</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div class="Pp"></div>
The alien mode of operation proceeds as follows:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 1.It looks up <i>ALIEN_FEDERATION</i> using
  item type auth_agent_federations. When forming a key, the lookup operation
  will percent-encode any ':' and '%' characters in <i>ALIEN_FEDERATION</i>, so
  the same encoding is required for keys that appear in auth_agent_federations.
  If it is not found, authentication fails. If found, it may optionally have a
  value; that value will be used within the resulting <b>DACS</b> credentials
  instead of the <i>ALIEN_FEDERATION</i> argument. In any case, the resulting
  value must be valid for a <b>DACS</b> username.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 2.It looks up <i>ALIEN_USERNAME</i> using an
  item type constructed by prepending the string
  &quot;auth_agent_federation_&quot; to the federation name derived during the
  previous step. When forming a key, the lookup operation will percent-encode
  any ':' and '%' characters in <i>ALIEN_USERNAME</i>, so the same encoding is
  required for stored keys. If it is not found, authentication fails. If found,
  it may optionally have a value; that value will be used within the resulting
  <b>DACS</b> credentials instead of the <i>ALIEN_USERNAME</i> argument. In any
  case, the resulting string must be valid for a <b>DACS</b> username.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 3.A <b>DACS</b> username will be formed using
  the federation name and username strings derived in the previous steps.</div>
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
The following is an example of local mode operation. Assume the following
  configuration directive is in effect:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
VFS &quot;[auth_agent_local]dacs-fs:/usr/local/dacs/auth_agent_local_users&quot;
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
Also assume that the file /usr/local/dacs/auth_agent_local_users contains the
  expression:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
regsub(${Expr::_}, \
    &quot;\([^:]*\)://\([^.]*\)\\.\(.*\)&quot;, '${1}-${2}@${3}')
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
If a request is made with <i>USERNAME</i> equal to
  &quot;http://Bob.Example.com&quot;, new credentials will be issued for
  &quot;http-Bob@Example.com&quot; relative to the current jurisdiction.
<div class="Pp"></div>
The following is an example of alien mode operation. Assume the following
  configuration directives are in effect:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
VFS &quot;[auth_agent_federations]dacs-kwv-fs:/usr/local/dacs/auth_agent_feds&quot;
VFS &quot;[auth_agent_federation_mars]dacs-kwv-fs:/usr/local/dacs/auth_agent_fed_mars&quot;
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
Also assume that the file /usr/local/dacs/auth_agent_feds consists of the line
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
MARS:
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
and the file /usr/local/dacs/auth_agent_fed_mars consists of the line
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
gazoo:
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
If a request is made with <i>ALIEN_FEDERATION</i> equal to &quot;MARS&quot; and
  <i>ALIEN_USERNAME</i> equal to &quot;gazoo&quot;, the request will satisfy
  alien mode's rules of operation with the strings &quot;MARS&quot; and
  &quot;gazoo&quot; being used to form the <b>DACS</b> username relative to the
  current jurisdiction ( <i>DACS_JURISDICTION</i>).
<div class="Pp"></div>
If instead <i>ALIEN_FEDERATION</i> were &quot;http://example.com&quot; and the
  file /usr/local/dacs/auth_agent_feds looked like:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
http%3A//example.com:example
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
then the string &quot;example&quot; would be used with &quot;gazoo&quot; to form
  the <b>DACS</b> username.
<h1 class="Sh" title="Sh" id="DIAGNOSTICS"><a class="selflink" href="#DIAGNOSTICS">DIAGNOSTICS</a></h1>
The program exits 0 if everything was fine, 1 if an error occurred.
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
The word &quot;alien&quot; is used because it sounds cooler than
  &quot;foreign&quot; and is arguably easier to spell.
<div class="Pp"></div>
A superficially similar feature called &quot;affiliated <b>DACS</b>
  federations&quot;, which provides single sign-on across federation boundaries,
  is sometimes a more appropriate solution; see <b>dacs_auth_transfer(8)</b>[3].
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
It should be possible for keys that are matched against <i>USERNAME</i> to be
  regular expressions and for the corresponding replacement values to
  interpolate matched substrings.
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>dacs_authenticate(8)</b>[2], <b>dacs_auth_transfer(8)</b>[3],
  <b>dacs_current_credentials(8)</b>[14], <b>dacs_signout(8)</b>[15],
  <b>dacs.exprs(5)</b>[16], <b>dacscred(1)</b>[4], <b>dacscookie(1)</b>[5].
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Distributed Systems Software ( <b>www.dss.ca</b>[17])
<h1 class="Sh" title="Sh" id="COPYING"><a class="selflink" href="#COPYING">COPYING</a></h1>
Copyright2003-2014 Distributed Systems Software. See the <b>LICENSE</b>[18] file
  that accompanies the distribution for licensing information.
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"> 1.</dt>
  <dd class="It-tag">dacsoptions</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.1.html#dacsoptions</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 2.</dt>
  <dd class="It-tag">dacs_authenticate(8)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_authenticate.8.html</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 3.</dt>
  <dd class="It-tag">dacs_auth_transfer(8)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_auth_transfer.8.html</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 4.</dt>
  <dd class="It-tag">dacscred(1)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacscred.1.html</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 5.</dt>
  <dd class="It-tag">dacscookie(1)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacscookie.1.html</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 6.</dt>
  <dd class="It-tag">su(1)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://www.freebsd.org/cgi/man.cgi?query=su&amp;apropos=0&amp;sektion=1&amp;manpath=FreeBSD+10.1-RELEASE&amp;format=html</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 7.</dt>
  <dd class="It-tag">standard CGI arguments</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.services.8.html#standard_cgi_args</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 8.</dt>
  <dd class="It-tag">ADMIN_IDENTITY</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.conf.5.html#ADMIN_IDENTITY</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 9.</dt>
  <dd class="It-tag">AUTH_AGENT_ALLOW_ADMIN_IDENTITY</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.conf.5.html#AUTH_AGENT_ALLOW_ADMIN_IDENTITY</div>
<dl class="Bl-tag">
  <dt class="It-tag">10.</dt>
  <dd class="It-tag">dacs.conf(5)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.conf.5.html</div>
<dl class="Bl-tag">
  <dt class="It-tag">11.</dt>
  <dd class="It-tag">dacs.acls(5)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.acls.5.html</div>
<dl class="Bl-tag">
  <dt class="It-tag">12.</dt>
  <dd class="It-tag">isprint(3)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://www.freebsd.org/cgi/man.cgi?query=isprint&amp;apropos=0&amp;sektion=3&amp;manpath=FreeBSD+10.1-RELEASE&amp;format=html</div>
<dl class="Bl-tag">
  <dt class="It-tag">13.</dt>
  <dd class="It-tag">OpenID</dd>
</dl>
<div style="margin-left: 4.00ex;">http://openid.net/</div>
<dl class="Bl-tag">
  <dt class="It-tag">14.</dt>
  <dd class="It-tag">dacs_current_credentials(8)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_current_credentials.8.html</div>
<dl class="Bl-tag">
  <dt class="It-tag">15.</dt>
  <dd class="It-tag">dacs_signout(8)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_signout.8.html</div>
<dl class="Bl-tag">
  <dt class="It-tag">16.</dt>
  <dd class="It-tag">dacs.exprs(5)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.exprs.5.html</div>
<dl class="Bl-tag">
  <dt class="It-tag">17.</dt>
  <dd class="It-tag">www.dss.ca</dd>
</dl>
<div style="margin-left: 4.00ex;">http://www.dss.ca</div>
<dl class="Bl-tag">
  <dt class="It-tag">18.</dt>
  <dd class="It-tag">LICENSE</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/../misc/LICENSE</div>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">01/12/2017</td>
    <td class="foot-os">DACS 1.4.38a</td>
  </tr>
</table>
</body>
</html>
