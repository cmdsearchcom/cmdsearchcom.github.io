<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 19:14:53 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>ptpd2(8) Precision Time Protocol daemon ptpd2(8)</p>

<p style="margin-top: 1em">NAME <br>
ptpd2 - Precision Time Protocol daemon (1588-2008)</p>

<p style="margin-top: 1em">SYNOPSIS <br>
ptpd2 [ -?hH ] [ -e SETTING ] [ -kvOLAl ] [ -smMyEPanCV ] [
-c FILE ] [ -R DIR ] [ -f FILE ] [ -S FILE ] [ -d DOMAIN ] [
-u ADDRESS ] [ -r NUMBER ] -i INTERFACE</p>

<p style="margin-top: 1em">DESCRIPTION <br>
PTPd is a daemon that implements the Precision Time Protocol
(PTP) Version 2 as defined by the IEEE 1588-2008 standard.
PTP was developed to provide very precise time
coordina&acirc; <br>
tion of LAN connected computers. The daemon must run as root
in order to be able to manipluate the system clock and use
low port numbers. PTPd is feature rich, supports IPv4 <br>
multicast, unicast and hybrid mode (mixed) operation, as
well as Ethernet mode. Even without hardware assistance,
PTPd is able to achieve and maintain sub-microsecond level
tim&acirc; <br>
ing precision and is able to withstand PTP Grandmaster
failovers, link failures and restarts with minimal impact to
timing performance. PTPd is lightweight, portable and
cur&acirc; <br>
rently supports Linux, FreeBSD and Mac OS X and runs on
multiple CPU architectures, 32-bit and 64-bit, including x86
and ARM.</p>

<p style="margin-top: 1em">COMMAND-LINE CONFIGURATION <br>
As of version 2.3.0, configuration file is the preferred
mechanism for configuring PTPd, therefore the options
available as short (-x) and long options (--xxxxx) mostly
provide <br>
basic control over the daemon operation, and only provide
the very basic PTP protocol settings. The rest of the
settings (see ptpd2.conf(5)) can also be specified as
command-line <br>
options, but they take the long
--key:section=&quot;value&quot; form.</p>

<p style="margin-top: 1em">BASIC DAEMON OPTIONS <br>
-c --config-file PATH <br>
Path to configuration file (see ptpd2.conf(5))</p>

<p style="margin-top: 1em">-k --check-config <br>
Check configuration and exit - return 0 if configuration is
correct.</p>

<p style="margin-top: 1em">-v --version <br>
Print version string and exit</p>

<p style="margin-top: 1em">-h --help <br>
Show help screen</p>

<p style="margin-top: 1em">-H --long-help <br>
Show detailed help for all settings and behaviours</p>

<p style="margin-top: 1em">-e --explain SETTING <br>
Show help for a single setting (section:key)</p>

<p style="margin-top: 1em">-O --default-config <br>
Show default configuration and exit (output usable as a
configuration file)</p>

<p style="margin-top: 1em">-L --ignore-lock <br>
Skip lock file checks and locking (also
global:ignore_lock)</p>

<p style="margin-top: 1em">-A --auto-lock <br>
Use preset / port mode specific lock file names - useful
when running multiple instances</p>

<p style="margin-top: 1em">-l --lockfile <br>
Specify lock file path (also global:lock_file)</p>

<p style="margin-top: 1em">-p --print-lockfile <br>
Print path to lock file and exit (useful for init scripts in
combination with auto lock files)</p>

<p style="margin-top: 1em">-R --lock-directory DIR <br>
Directory to store lock files (also
global:lock_directory)</p>

<p style="margin-top: 1em">-f --log-file PATH <br>
Path to log file (also global:logfile)</p>

<p style="margin-top: 1em">-S --statistics-file PATH <br>
Path to statistics file (also global:statistics_file)</p>

<p style="margin-top: 1em">BASIC PTP PROTOCOL OPTIONS <br>
-i --interface DEV <br>
REQUIRED:Interface to use - eth0, etc (also
ptpengine:interface)</p>

<p style="margin-top: 1em">-d --domain NUMBER <br>
PTP domain number to become part of (also
ptpengine:domain)</p>

<p style="margin-top: 1em">-s --slaveonly <br>
Slave only mode (also ptpengine:preset=slaveonly)</p>

<p style="margin-top: 1em">-m --masterslave <br>
Full IEEE 1588 implementation: master, slave when not best
GM (also ptpengine:preset=masterslave)</p>

<p style="margin-top: 1em">-M --masteronly <br>
Master only mode: passive when not best GM (also
ptpengine:preset=masteronly)</p>

<p style="margin-top: 1em">-y --hybrid <br>
Hybrid mode - mixed multicast and unicast operation
(multicast for sync and announce, unicast for delay request
and response (also ptpengine:ip_mode=hybrid)</p>

<p style="margin-top: 1em">-U --unicast <br>
Unicast operation - (also ptpengine:ip_mode=unicast). For a
GM, unicast destinations must be specified (-u,
--unicast-destinations, ptpengine:unicast_destinations)
unless <br>
using unicast negotiation (-g, --unicast-negotiation,
ptpengine:unicast_negotiation=y) for delay request and
response (also ptpengine:ip_mode=hybrid). For a slave,
unicast <br>
destinations must be specified if not using unicast
negotiation.</p>

<p style="margin-top: 1em">-g --unicast-negotiation <br>
Enable unicast message delivery and interval negotiation
usin signaling messages, as used by the Telecom profile
(also enables ptpengine:ip_mode=unicast)</p>

<p style="margin-top: 1em">-u --unicast-destinations
ip/host, ip/host, ... <br>
List of unicast destinations - see --unicast (also
ptpengine:ip_mode=unicast + ptpengine:unicast_destinations)
-E --e2e End to end delay mechanism (also <br>
ptpengine:delay_mechanism=E2E)</p>

<p style="margin-top: 1em">-E --p2p <br>
Peer to peer delay mechanism (also
ptpengine:delay_mechanism=P2P)</p>

<p style="margin-top: 1em">-a --delay-override <br>
In slave state, override delay request interval announced by
master (also ptpengine:log_delayreq_override) - the value of
ptpengine:log_delayreq_interval is used</p>

<p style="margin-top: 1em">-r --delay-interval NUMBER <br>
Specify delay request message interval (log 2) - (also
ptpengine:log_delayreq_interval)</p>

<p style="margin-top: 1em">-n --clock:no_adjust <br>
Do not adjust the clock (also clock:no_adjust)</p>

<p style="margin-top: 1em">-D&lt;DD...&gt; --debug <br>
Debug level (also global:debug_level) - only if compiled
with RUNTIME_DEBUG</p>

<p style="margin-top: 1em">-C --foreground <br>
Don&rsquo;t run in background (also global:foreground=Y)</p>

<p style="margin-top: 1em">-V --verbose <br>
Run in foreground, log all the messages to standard output
(also global:verbose_foreground=Y)</p>

<p style="margin-top: 1em">COMPATIBILITY OPTIONS <br>
PTPd supports the following options compatible with versions
before 2.3.0:</p>

<p style="margin-top: 1em">-b DEV Network interface to
use</p>

<p style="margin-top: 1em">-i NUMBER <br>
PTP domain number</p>

<p style="margin-top: 1em">-g Slave only mode</p>

<p style="margin-top: 1em">-G &Acirc;&acute;Master mode
with NTP&Acirc;&acute; (master only mode)</p>

<p style="margin-top: 1em">-W &Acirc;&acute;Master mode
without NTP&Acirc;&acute; (master / slave mode)</p>

<p style="margin-top: 1em">-U Hybrid mode (mixed unicast +
multicast operation)</p>

<p style="margin-top: 1em">-Y NUMBER <br>
Delay request interval (log 2)</p>

<p style="margin-top: 1em">-t Do not adjust the clock</p>

<p style="margin-top: 1em">NOTE: the above options are
deprecated and will be removed in subsequent versions. Until
then, their use will issue a warning.</p>

<p style="margin-top: 1em">PTPD PORT STATES <br>
init INITIALIZING</p>

<p style="margin-top: 1em">flt FAULTY</p>

<p style="margin-top: 1em">lstn_init <br>
LISTENING (first time)</p>

<p style="margin-top: 1em">lstn_reset <br>
LISTENING (subsequent reset)</p>

<p style="margin-top: 1em">pass PASSIVE (not best master,
not announcing)</p>

<p style="margin-top: 1em">uncl UNCALIBRATED</p>

<p style="margin-top: 1em">slv SLAVE</p>

<p style="margin-top: 1em">pmst PRE-MASTER</p>

<p style="margin-top: 1em">mst MASTER (active)</p>

<p style="margin-top: 1em">dsbl DISABLED</p>

<p style="margin-top: 1em">? (unk) <br>
UNKNOWN state</p>

<p style="margin-top: 1em">STATISTICS LOG FILE FORMAT <br>
When the statistics log is enabled
(ptpengine:log_statistics, verbose foreground mode or log
file - ptpengine:statistics_file), a PTPd slave will log
clock sync information upon <br>
the receipt of every Sync and Delay Response message. When
PTPd starts up or flushes the log, a comment line (starting
with #) will be logged, containing the names of all
col&acirc; <br>
umns. The format of this log is a series of comma-separated
values (CSV) and can be easily imported into statistics
tools and most spreadsheet software packages for analysis
and <br>
graphing. This log can get very large when running PTPd for
longer periods of time and with high message rates,
therefore to reduce the number of messages logged, the <br>
global:statistics_log_interval setting can be used, to limit
the log output to one message per configured interval only.
The size and maximum number of the statistics log can <br>
also be controlled - (see ptpd2.conf(5)).</p>

<p style="margin-top: 1em">The meaning of the columns is as
follows:</p>

<p style="margin-top: 1em">Timestamp <br>
Time when message received. This can take the form of text
date / time or Unix timestamp (with fractional seconds), or
both (in which case an exra field is <br>
added), depending onthe global:statistics_timestamp_format
setting (see ptpd2.conf(5)). When importing the log into
plotting software, if the software can under&acirc; <br>
stand Unix time, it is best to set the timestamp format to
unix or both, as some software will not properly deal with
the fractional part of the second when con&acirc; <br>
verting the date and time from text.</p>

<p style="margin-top: 1em">State Port state (see PTP PORT
STATES).</p>

<p style="margin-top: 1em">Clock ID <br>
Port identity of the current best master, as defined by IEEE
1588. This will be the local clock&rsquo;s ID if the local
clock is the best master. Displayed as <br>
clock_id/port(host) Port is the PTP clock port number, not
to be confused with UDP ports. The clock ID is an EUI-64
64-bit ID, usually converted from the 48-bit <br>
MAC address, by inserting 0xfffe between the lower and upper
half of the MAC address. PTPd will attempt to convert the
clock ID back to MAC address and look up <br>
the hostname from /etc/ethers (see ethers(5)). Populating
the ethers file will help the administrator recognise the
masters by familiar hostnames.</p>

<p style="margin-top: 1em">One Way Delay <br>
Current value of one-way delay (or mean path delay) in
seconds, calculated by PTPd in slave state from the Delay
Request - Delay Response message exchange. Note: <br>
if this value remains at zero, this usually means that no
Delay Response messages are being received, likely due to a
network issue.</p>

<p style="margin-top: 1em">Offset From Master <br>
Current value of offset from master in seconds - this is the
main output of the PTP engine in slave state, which is the
input of the clock servo for clock correc&acirc; <br>
tions. This is the value typically observed when estimating
the slave performance.</p>

<p style="margin-top: 1em">Slave to Master <br>
Intermediate offset value (seconds) extracted from the Delay
Request - Delay Response message exchange, used for
computing one-way delay. If the last value was <br>
rejected by a filter, the previous value will be shown in
the log. This value will also be zero if no Delay Response
messages are being received.</p>

<p style="margin-top: 1em">Master to Slave <br>
Intermediate offset value (seconds) extracted from the Sync
messages, used for computing the offset from master. If the
last value was rejected by a filter, the <br>
previous value will be shown in the log.</p>

<p style="margin-top: 1em">Observed Drift <br>
The integral accumulator of the clock control PI servo model
- frequency difference between the slave clock and master
clock. This value becomes stable when the <br>
clock offset has stabilised, and can be used (and is) to
detect clock stability.</p>

<p style="margin-top: 1em">Last Packet Received <br>
This field shows what message was received last - this will
be S for Sync and D for Delay Response. If a slave logs no D
entries, this means it&rsquo;s not receiving <br>
Delay Response messages, which could be a network issue.</p>

<p style="margin-top: 1em">One Way Delay Mean <br>
One-way delay mean computed over the last sampling
window.</p>

<p style="margin-top: 1em">One Way Delay Std Dev <br>
One-way delay standard deviation computed over the last
sampling window.</p>

<p style="margin-top: 1em">Offset From Master Mean <br>
Offset from master mean computed over the last sampling
window.</p>

<p style="margin-top: 1em">Offset From Master Std Dev <br>
Offset from master standard deviation computed over the last
sampling window.</p>

<p style="margin-top: 1em">Observed Drift Mean <br>
Observed drift / local clock frequency adjustment mean
computed over the last sampling window.</p>

<p style="margin-top: 1em">Observed Drift Std Dev <br>
Observed drift / local clock frequency adjustment standard
deviation computed over the last sampling window. The lower
the value, the less aggressively the clock <br>
is being controlled and therefore the more stable it is.</p>

<p style="margin-top: 1em">raw delayMS <br>
Raw (unfiltered) delayMS value - useful for evaluating
outliers and filter performance.</p>

<p style="margin-top: 1em">raw delaySM <br>
Raw (unfiltered) delaySM value - useful for evaluating
outliers and filter performance.</p>

<p style="margin-top: 1em">NOTE: All the statistical
measures (mean and std dev) will only be computed and
displayed if PTPd was built without --disable-statistics.
The duration of the sampling period is <br>
controlled with the global:statistics_update_interval
setting - (see ptpd2.conf(5)).</p>

<p style="margin-top: 1em">HANDLED SIGNALS <br>
PTPd handles the following signals:</p>

<p style="margin-top: 1em">SIGHUP Reload configuration file
(if used) and reopen log files</p>

<p style="margin-top: 1em">SIGUSR1 When in slave state,
force clock step to current Offset from Master value</p>

<p style="margin-top: 1em">SIGUSR2 Dump all PTP protocol
counters to current log target (and clear if
ptpengine:sigusr2_clears_counters set)</p>

<p style="margin-top: 1em">SIGINT|SIGTERM <br>
Clean exit - close logs and other open files, clean up lock
file and exit.</p>

<p style="margin-top: 1em">SIGKILL Force an unclean
exit.</p>

<p style="margin-top: 1em">EXIT CODES <br>
Upon exit, ptpd2 returns 0 on success - either successfully
started in daemon mode, or otherwise exited cleanly. 0 is
also returned when the -k (--check-config) option is used
<br>
and the configuration was correct. A non-zero exit code is
returned on errors. 3 is returned on lock file errors and
when ptpd2 could not be started as daemon. 2 is returned on
<br>
memory allocation errors during startup. For all other error
conditions such as configuration errors, running ptpd2 in
help mode or with no parameters, on self shutdown, network
<br>
startup errors and when attempting to run ptpd2 as non-root
- 1 is returned.</p>

<p style="margin-top: 1em">SUPPORTED PLATFORMS AND
ARCHITECTURES <br>
PTPd is fully supported on Linux and FreeBSD as this is what
the core developers focus on. OpenBSD and NetBSD are also
supported, but get less developers&rsquo; attention. So is
Max <br>
OS X, and as of PTPd 2.3.1 also OpenSolaris (11) derivatives
(tested on OmniOS). Sun&rsquo;s / Oracle&rsquo;s Solaris 11
has not been tested but in essence, it should work as
intended. <br>
Solaris 10 is NOT supported because it does not provide the
SO_TIMESTAMP socket option. It should theoretically be
possible to use Solaris 10 using the pf facility as used by
<br>
snoop, but there is currently no ongoing effort to acheive
this. Patches for QNX/Neutrino have been provided, but
cannot yet officially be merged because of no availability
of <br>
QNX to the developers. Some users have ported PTPd to other
RTOS, but this has not been merged either.</p>

<p style="margin-top: 1em">As of 2.3.1, PTPd runs entirely
in software and only relies on kernel and OS APIs, so there
are no hardware dependencies. Any little-endian or
big-endian port of modern versions <br>
of the supported OSes should work, but only x86 and ARM are
actively tested. The only dependencies close to hardware can
be NIC drivers and how and if they impact software
times&acirc; <br>
tamping.</p>

<p style="margin-top: 1em">HARDWARE TIMESTAMPING SUPPORT
<br>
As of 2.3.1, PTPd still does not support hardware
timestamping. This functionality will appear in the upcoming
version 2.4 - potentially an interim version of 2.3.x may be
deliv&acirc; <br>
ered that will support hardware clocks and timestamping on
Linux. This is very much OS-specific and to a large extent,
hardware-specific. Linux has a PTP kernel API but not all
<br>
hardware supports it. Because PTPd supports multiple OS
platforms, where hardware timestamping may use different
mechanisms on every platform, it has to be re-written in a
modu&acirc; <br>
lar way to allow this without unnecessarily increasing code
complexity, which already is a problem.</p>

<p style="margin-top: 1em">BUGS <br>
As of ptpd 2.3.1, the (Open)Solaris (11) OS family is
supported, but libpcap functionality is currently broken -
IPv4/pcap and Ethernet transports cannot be used on those
sys&acirc; <br>
tems. PTPd will compile and run, <br>
but will not receive any data.</p>

<p style="margin-top: 1em">Please report any bugs using the
bug tracker on the SourceForge page:
http://sourceforge.net/projects/ptpd/</p>

<p style="margin-top: 1em">SEE ALSO <br>
ptpd2.conf(5)</p>

<p style="margin-top: 1em">AUTHORS <br>
Gael Mace &lt;gael_mace@users.sourceforge.net&gt;</p>

<p style="margin-top: 1em">Alexandre Van Kempen</p>

<p style="margin-top: 1em">Steven Kreuzer
&lt;skreuzer@freebsd.org&gt;</p>

<p style="margin-top: 1em">George Neville-Neil
&lt;gnn@freebsd.org&gt;</p>

<p style="margin-top: 1em">Wojciech Owczarek
&lt;wojciech@owczarek.co.uk&gt;</p>

<p style="margin-top: 1em">ptpd2(8) man page was written by
Wojciech Owczarek for ptpd 2.3.0 in November 2013</p>

<p style="margin-top: 1em">version 2.3.1 June, 2015
ptpd2(8)</p>
<hr>
</body>
</html>
