<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>FWKNOPD(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">FWKNOPD(8)</td>
    <td class="head-vol">Fwknop Server</td>
    <td class="head-rtitle">FWKNOPD(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
fwknopd - Firewall Knock Operator Daemon
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>fwknopd</b> [<i>options</i>]
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<b>fwknopd</b> is the server component for the FireWall Knock Operator, and is
  responsible for monitoring and processing Single Packet Authorization (SPA)
  packets that are generated by <b>fwknop</b> clients, modifying a firewall or
  ACL policy to allow the desired access after authenticating and decrypting a
  valid SPA packet (in that order), and removing access after a configurable
  timeout.
<div style="height: 1.00em;">&#x00A0;</div>
The main application of this program is to conceal services such as <i>SSH</i>
  with an additional layer of security in order to make the exploitation of
  vulnerabilities (both 0-day and unpatched code) much more difficult. In
  addition, services that are concealed in this fashion naturally cannot be
  scanned for with <i>Nmap</i> or <i>Shodan</i>.
<div style="height: 1.00em;">&#x00A0;</div>
The main configuration for <b>fwknopd</b> is maintained within two files:
  <i>fwknopd.conf</i> and <i>access.conf</i>. The default location for these
  files is determined at package configuration (typically <i>/etc/fwknop</i>).
  The configuration variables within these files are described below.
<div style="height: 1.00em;">&#x00A0;</div>
Additional information may be found in the tutorial &#x201C;Single Packet
  Authorization: A Comprehensive Guide to Strong Service Concealment with
  fwknop&#x201D; available online (see:
  <i>http://www.cipherdyne.org/fwknop/docs/fwknop-tutorial.html</i>).
<h1 class="Sh" title="Sh" id="COMMAND-LINE_OPTIONS"><a class="selflink" href="#COMMAND-LINE_OPTIONS">COMMAND-LINE
  OPTIONS</a></h1>
<b>-i, --interface</b>=<i>&lt;interface&gt;</i>
<div style="margin-left: 4.00ex;">Manually specify interface on which to sniff,
  e.g. &#x201C;-i eth0&#x201D;. This option is not usually needed because the
  &#x201C;PCAP_INTF&#x201D; keyword in the <i>fwknopd.conf</i> file defines the
  sniffing interface.</div>
<div class="Pp"></div>
<b>-f, --foreground</b>
<div style="margin-left: 4.00ex;">Run <b>fwknopd</b> in the foreground instead
  of becoming a daemon. When run in the foreground, message that would go to the
  log would instead be sent to stderr. This mode is usually used when testing
  and/or debugging.</div>
<div class="Pp"></div>
<b>--fw-list</b>
<div style="margin-left: 4.00ex;">List only firewall rules that any running
  <b>fwknopd</b> daemon has created and then exit.</div>
<div class="Pp"></div>
<b>-a, --access-file</b>=<i>&lt;access-file&gt;</i>
<div style="margin-left: 4.00ex;">Specify the location of the <i>access.conf</i>
  file. If this option is not given, <i>fwknopd</i> will use the compile-time
  default location (typically <i>/etc/fwknop/access.conf</i>).</div>
<div class="Pp"></div>
<b>--access-folder</b>=<i>&lt;access-folder&gt;</i>
<div style="margin-left: 4.00ex;">Specify the location of the <i>access.conf</i>
  folder. If this option is given, rather than load a single access.conf file,
  all the .conf files in the given folders are processed.</div>
<div class="Pp"></div>
<b>-c, --config</b>=<i>&lt;config-file&gt;</i>
<div style="margin-left: 4.00ex;">Specify the location of the
  <i>fwknopd.conf</i> file. If this option is not given, <i>fwknopd</i> will use
  the default location (typically <i>/etc/fwknop/fwknopd.conf</i>.</div>
<div class="Pp"></div>
<b>-C, --packet-limit</b>=<i>&lt;n&gt;</i>
<div style="margin-left: 4.00ex;">Specify the number of candidate SPA packets to
  process and exit when this limit is reached.</div>
<div class="Pp"></div>
<b>-d, --digest-file</b>=<i>&lt;digest-file&gt;</i>
<div style="margin-left: 4.00ex;">Specify the location of the
  <i>digest.cache</i> file. If this option is not given, <i>fwknopd</i> will use
  the compile-time default location (typically
  <i>/var/fwknop/digest.cache</i>).</div>
<div class="Pp"></div>
<b>-D, --dump-config</b>
<div style="margin-left: 4.00ex;">Dump the configuration values that
  <b>fwknopd</b> derives from the <i>/etc/fwknop/fwknopd.conf</i> (or override
  files) and <i>/etc/fwknop/access.conf</i> on stderr.</div>
<div class="Pp"></div>
<b>--dump-serv-err-codes</b>
<div style="margin-left: 4.00ex;">Dump all possible <b>fwknopd</b> error codes
  to stdout and exit. This option is rarely needed in practice, and was added to
  assist with test coverage.</div>
<div class="Pp"></div>
<b>--fault-injection-tag</b>=<i>&lt;tag&gt;</i>
<div style="margin-left: 4.00ex;">This option is only used for fault injection
  testing when <b>fwknop</b> is compiled to support the libfiu library (see:
  <i>http://blitiri.com.ar/p/libfiu/</i>). Under normal circumstances this
  option is not used, and any packaged version of fwknop will not have code
  compiled in so this capability is not enabled at run time. It is documented
  here for completeness. version of fwknop will not have code compiled in to
  enable this capability at run time. It is documented here for
  completeness.</div>
<div class="Pp"></div>
<b>-A, --afl-fuzzing</b>
<div style="margin-left: 4.00ex;">Instruct <b>fwknopd</b> to acquire SPA packets
  directly from stdin in support of fuzzing operations from the <i>American
  Fuzzy Lop</i> (AFL) fuzzer written by Michal Zalewski. This requires that
  <b>fwknop</b> is compiled with the <i>--enable-afl-fuzzing</i> argument to the
  <b>configure</b> script as this allows encryption/digest short circuiting in a
  manner necessary for AFL to function properly. The benefit of this strategy is
  that AFL can fuzz the SPA packet decoding routines implemented by
  <b>libfko</b>.</div>
<div class="Pp"></div>
<b>--fw-list-all</b>
<div style="margin-left: 4.00ex;">List all firewall rules including those that
  have nothing to do with <b>fwknopd</b>.</div>
<div class="Pp"></div>
<b>--fw-flush</b>
<div style="margin-left: 4.00ex;">Flush any firewall rules created by a running
  <b>fwknopd</b> process. This option allows the used to easily delete
  <b>fwknopd</b> firewall rules without having to wait for them to be timed
  out.</div>
<div class="Pp"></div>
<b>-K, --kill</b>
<div style="margin-left: 4.00ex;">Kill the current <b>fwknopd</b> process. This
  provides a quick and easy way to stop <b>fwknopd</b> without having to look in
  the process table.</div>
<div class="Pp"></div>
<b>--exit-parse-config</b>
<div style="margin-left: 4.00ex;">Parse config files
  (<i>/etc/fwknop/fwknopd.conf</i>, and <i>/etc/fwknop/access.conf</i>) and then
  exit. This provides a way to test whether the config files are properly
  structured without having to start processing network traffic.</div>
<div class="Pp"></div>
<b>--exit-parse-digest-cache</b>
<div style="margin-left: 4.00ex;">Parse the digest cache file
  <i>/var/fwknop/digest.cache</i> and exit. This validates the structure of the
  digest cache file without having to start processing network traffic. Note
  that the standard configuration files are also parsed in this mode.</div>
<div class="Pp"></div>
<b>-l, --locale</b>=<i>&lt;locale&gt;</i>
<div style="margin-left: 4.00ex;">Set/override the system default locale
  setting.</div>
<div class="Pp"></div>
<b>--no-ipt-check-support</b>
<div style="margin-left: 4.00ex;">Disable the usage of the iptables <i>-C</i>
  option. This is not normally needed, and is only useful on older Linux
  distributions where iptables does not have <i>-C</i> support.</div>
<div class="Pp"></div>
<b>-O, --override-config</b>=<i>&lt;file&gt;</i>
<div style="margin-left: 4.00ex;">Override config variable values that are
  normally read from the <i>/etc/fwknop/fwknopd.conf</i> file with values from
  the specified file. Multiple override config files can be given as a
  comma-separated list.</div>
<div class="Pp"></div>
<b>--key-gen</b>
<div style="margin-left: 4.00ex;">Have <b>fwknopd</b> generate both Rijndael and
  HMAC keys that can be used for SPA packet encryption and authentication. These
  keys are derived from /dev/urandom and then base64 encoded before being
  printed to stdout, and are meant to be manually included in a stanza within
  the <i>/etc/fwknop/access.conf</i> file. Such keys are generally more secure
  than passphrases.</div>
<div class="Pp"></div>
<b>--key-gen-file</b>=<i>&lt;file&gt;</i>
<div style="margin-left: 4.00ex;">Write generated keys to the specified file.
  Note that the file is overwritten if it already exists. If this option is not
  given, then <b>--key-gen</b> writes the keys to stdout.</div>
<div class="Pp"></div>
<b>--key-len</b>=<i>&lt;length&gt;</i>
<div style="margin-left: 4.00ex;">Specify the number of bytes for a generated
  Rijndael key. The maximum size is currently 128 bytes.</div>
<div class="Pp"></div>
<b>--hmac-key-len</b>=<i>&lt;length&gt;</i>
<div style="margin-left: 4.00ex;">Specify the number of bytes for a generated
  HMAC key. The maximum size is currently 128 bytes.</div>
<div class="Pp"></div>
<b>-p, --pid-file</b>=<i>&lt;pid-file&gt;</i>
<div style="margin-left: 4.00ex;">Specify the location of the <i>fwknopd.pid</i>
  file. If this option is not given, <i>fwknopd</i> will use the compile-time
  default location (typically <i>/var/fwknop/fwknopd.pid</i>).</div>
<div class="Pp"></div>
<b>-P, --pcap-filter</b>=<i>&lt;filter&gt;</i>
<div style="margin-left: 4.00ex;">Specify a Berkeley packet filter statement on
  the <b>fwknopd</b> command line. This overrides the value of the PCAP_FILTER
  variable taken from the <i>/etc/fwknop/fwknopd.conf</i> file.</div>
<div class="Pp"></div>
<b>--pcap-file</b>=<i>&lt;pcap-file&gt;</i>
<div style="margin-left: 4.00ex;">This option instructs <b>fwknopd</b> to read
  packet data from a pcap file instead of sniffing an interface directly. This
  mode is usually used for debugging purposes, and will disable SPA packet age
  checking unless it is manually enabled in the <i>/etc/fwknop/fwknopd.conf</i>
  file.</div>
<div class="Pp"></div>
<b>--pcap-any-direction</b>
<div style="margin-left: 4.00ex;">Allow <b>fwknopd</b> to sniff SPA packets
  regardless of whether they are received on the sniffing interface or sent from
  the sniffing interface. In the later case, this can be useful to have fwknopd
  sniff SPA packets that are forwarded through a system and destined for a
  different network. If the sniffing interface is the egress interface for such
  packets (and hence SPA packets are sent by this interface instead of
  received), then this option will need to used in order for <b>fwknopd</b> to
  see them. The default is to only sniff packets that are received on the
  sniffing interface. Note that this setting is independent of promiscuous
  mode.</div>
<div class="Pp"></div>
<b>-R, --restart</b>
<div style="margin-left: 4.00ex;">Restart the currently running <b>fwknopd</b>
  processes. This option will preserve the command line options that were
  supplied to the original <b>fwknopd</b> process but will force <b>fwknopd</b>
  to re-read the <i>fwknopd.conf</i> and <i>/etc/fwknop/access.conf</i> files.
  This will also force a flush of the current &#x201C;FWKNOP&#x201D; iptables
  chain(s).</div>
<div class="Pp"></div>
<b>--rotate-digest-cache</b>
<div style="margin-left: 4.00ex;">Rotate the digest cache file by renaming it to
  &#x201C;&lt;name&gt;-old&#x201D;, and starting a new one. The digest cache
  file is typically found in <i>/var/fwknop/digest.cache</i>.</div>
<div class="Pp"></div>
<b>-r, --run-dir</b>=<i>&lt;path&gt;</i>
<div style="margin-left: 4.00ex;">Specify the directory where <b>fwknopd</b>
  writes run time state files. The default is <i>/var</i>.</div>
<div class="Pp"></div>
<b>-S, --status</b>
<div style="margin-left: 4.00ex;">Display the status of any <b>fwknopd</b>
  processes that may or not be running. If there is an existing fwknopd process
  then 0 is returned for the exit status and 1 is returned otherwise.</div>
<div class="Pp"></div>
<b>--syslog-enable</b>
<div style="margin-left: 4.00ex;">Allow messages to be sent to syslog even if
  the foreground mode is set.</div>
<div class="Pp"></div>
<b>-t, --test</b>
<div style="margin-left: 4.00ex;">Run <b>fwknopd</b> in test mode. This
  instructs <b>fwknopd</b> to acquire and process SPA packets, but not
  manipulate firewall rules or execute commands that are provided by SPA
  clients. This option is mostly useful for the fuzzing tests in the test suite
  to ensure broad code coverage under adverse conditions.</div>
<div class="Pp"></div>
<b>-U, --udp-server</b>
<div style="margin-left: 4.00ex;">Run <b>fwknopd</b> in UDP server mode so that
  SPA packets are acquired via a UDP socket directly without having to use
  libpcap. See the discussion of the &#x201C;ENABLE_UDP_SERVER&#x201D;
  configuration variable below for more information.</div>
<div class="Pp"></div>
<b>-v, --verbose</b>
<div style="margin-left: 4.00ex;">Run <b>fwknopd</b> in verbose mode. This can
  option can be specified multiple times to increase the verbosity of the output
  to the system log file (or to the screen if running in the foreground).</div>
<div class="Pp"></div>
<b>-h, --help</b>
<div style="margin-left: 4.00ex;">Display usage information and exit.</div>
<div class="Pp"></div>
<b>-V, --Version</b>
<div style="margin-left: 4.00ex;">Display version information and exit.</div>
<h1 class="Sh" title="Sh" id="FWKNOPD_CONFIG_AND_ACCESS_VARIABLES"><a class="selflink" href="#FWKNOPD_CONFIG_AND_ACCESS_VARIABLES">FWKNOPD
  CONFIG AND ACCESS VARIABLES</a></h1>
<b>fwknopd</b> references the <i>/etc/fwknop/fwknopd.conf</i> file for
  configuration variables to define operational parameters (what network
  interface and port to sniff, what features to enable/disable, etc.). The
  <i>fwknopd.conf</i> file does not define any access control directives or set
  any encryption or authentication keys.
<div style="height: 1.00em;">&#x00A0;</div>
The access control directives are contained in the
  <i>/etc/fwknop/access.conf</i> file. Access control directives define
  encryption keys and level of access that is granted to an fwknop client that
  has generated the appropriate encrypted SPA message.
<h2 class="Ss" title="Ss" id="FWKNOPD.CONF_VARIABLES"><a class="selflink" href="#FWKNOPD.CONF_VARIABLES">FWKNOPD.CONF
  VARIABLES</a></h2>
This section list the more prominent configuration variables used by
  <b>fwknopd</b>. You will want to make sure to check these to make sure they
  have appropriate values, but sensible defaults are provided for most systems.
  See the <i>/etc/fwknop/fwknopd.conf</i> file for additional details.
<div class="Pp"></div>
<b>PCAP_INTF</b> <i>&lt;interface&gt;</i>
<div style="margin-left: 4.00ex;">Specify the ethernet interface on which
  <b>fwknopd</b> will sniff packets.</div>
<div class="Pp"></div>
<b>ENABLE_PCAP_PROMISC</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">By default <b>fwknopd</b> puts the pcap
  interface into promiscuous mode. Set this to &#x201C;N&#x201D; to disable that
  behavior (non-promiscuous).</div>
<div class="Pp"></div>
<b>PCAP_FILTER</b> <i>&lt;pcap filter spec&gt;</i>
<div style="margin-left: 4.00ex;">Define the filter used for <i>PCAP</i> modes;
  <b>fwknopd</b> defaults to UDP port 62201. However, if an <b>fwknop</b> client
  uses the <b>--rand-port</b> option to send the SPA packet over a random port,
  then this variable should be updated to something like &#x201C;udp dst
  portrange 10000-65535&#x201D;.</div>
<div class="Pp"></div>
<b>ENABLE_SPA_PACKET_AGING</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">This instructs <b>fwknopd</b> to not honor SPA
  packets that have an old time stamp. The value for &#x201C;old&#x201D; is
  defined by the &#x201C;MAX_SPA_PACKET_AGE&#x201D; variable. If
  &#x201C;ENABLE_SPA_PACKET_AGING&#x201D; is set to &#x201C;N&#x201D;,
  <b>fwknopd</b> will not use the client time stamp at all.</div>
<div class="Pp"></div>
<b>MAX_SPA_PACKET_AGE</b> <i>&lt;seconds&gt;</i>
<div style="margin-left: 4.00ex;">Defines the maximum age (in seconds) that an
  SPA packet will be accepted. This requires that the client system is in
  relatively close time synchronization with the <b>fwknopd</b> server system
  (NTP is good). The default age is 120 seconds (two minutes).</div>
<div class="Pp"></div>
<b>ENABLE_DIGEST_PERSISTENCE</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">Track digest sums associated with previous SPA
  packets processed by <b>fwknopd</b>. This allows digest sums to remain
  persistent across executions of <b>fwknopd</b>. The default is
  &#x201C;Y&#x201D;. If set to &#x201C;N&#x201D;, <b>fwknopd</b> will not check
  incoming SPA packet data against any previously save digests. It is a good
  idea to leave this feature on to reduce the possibility of being vulnerable to
  a replay attack.</div>
<div class="Pp"></div>
<b>RULES_CHECK_THRESHOLD</b> <i>&lt;count&gt;</i>
<div style="margin-left: 4.00ex;">Defines the number of times firewall rule
  expiration times must be checked before a &quot;deep&quot; check is run. This
  allows <b>fwknopd</b> to remove rules that contain a proper
  <i></i><i>exp</i><i>&lt;time&gt;</i> even if a third party program added them
  instead of <b>fwknopd</b>. The default value for this variable is 20, and this
  typically results in this check being run every two seconds or so. To disable
  this type of checking altogether, set this variable to zero.</div>
<div class="Pp"></div>
<b>ENABLE_IPT_FORWARDING</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">Allow SPA clients to request access to
  services through an iptables firewall instead of just to it (i.e. access
  through the FWKNOP_FORWARD chain instead of the INPUT chain).</div>
<div class="Pp"></div>
<b>ENABLE_IPT_LOCAL_NAT</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">Allow SPA clients to request access to a local
  socket via NAT. This still puts an ACCEPT rule into the FWKNOP_INPUT chain,
  but a different port is translated via DNAT rules to the real one. So, the
  user would do &#x201C;ssh -p &lt;port&gt;&#x201D; to access the local service
  (see the <b>--NAT-local</b> and <b>--NAT-rand-port</b> on the <b>fwknop</b>
  client command line).</div>
<div class="Pp"></div>
<b>ENABLE_IPT_SNAT</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">Set this to &#x201C;Y&#x201D; to enable a
  corresponding SNAT rule. By default, if forwarding access is enabled (see the
  &#x201C;ENABLE_IPT_FORWARDING&#x201D; variable above), then <b>fwknopd</b>
  creates DNAT rules for incoming connections, but does not also complement
  these rules with SNAT rules at the same time. In some situations, internal
  systems may not have a route back out for the source address of the incoming
  connection, so it is necessary to also apply SNAT rules so that the internal
  systems see the IP of the internal interface where <b>fwknopd</b> is
  running.</div>
<div class="Pp"></div>
<b>SNAT_TRANSLATE_IP</b> <i>&lt;ip_address&gt;</i>
<div style="margin-left: 4.00ex;">Specify the IP address for SNAT. This
  functionality is only enabled when &#x201C;ENABLE_IPT_SNAT&#x201D; is set to
  &#x201C;Y&#x201D; and by default SNAT rules are built with the MASQUERADE
  target (since then the internal IP does not have to be defined here in the
  <i>/etc/fwknop/fwknopd.conf</i> file), but if you want <b>fwknopd</b> to use
  the SNAT target, you must also define an IP address with the
  &#x201C;SNAT_TRANSLATE_IP&#x201D; variable. Note that this variable is
  generally deprecated in favor of the &#x201C;FORCE_SNAT&#x201D; variable in
  the <i>/etc/fwknop/access.conf</i> file which enables per-stanza control over
  the SNAT IP.</div>
<div class="Pp"></div>
<b>ENABLE_IPT_OUTPUT</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">Add ACCEPT rules to the FWKNOP_OUTPUT chain.
  This is usually only useful if there are no state tracking rules to allow
  connection responses out and the OUTPUT chain has a default-drop stance.</div>
<div class="Pp"></div>
<b>MAX_SNIFF_BYTES</b> <i>&lt;bytes&gt;</i>
<div style="margin-left: 4.00ex;">Specify the the maximum number of bytes to
  sniff per frame. 1500 is the default.</div>
<div class="Pp"></div>
<b>FLUSH_IPT_AT_INIT</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">Flush all existing rules in the fwknop chains
  at <b>fwknopd</b> start time. The default is &#x201C;Y&#x201D;.</div>
<div class="Pp"></div>
<b>FLUSH_IPT_AT_EXIT</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">Flush all existing rules in the fwknop chains
  when <b>fwknopd</b> is stopped or otherwise exits cleanly. The default is
  &#x201C;Y&#x201D;.</div>
<div class="Pp"></div>
<b>EXIT_AT_INTF_DOWN</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">When <b>fwknopd</b> is sniffing an interface,
  if the interface is administratively downed or unplugged, fwknopd will cleanly
  exit and an assumption is made that any process monitoring infrastructure like
  systemd or upstart will restart it. However, if fwknopd is not being monitored
  by systemd, upstart, or anything else, this behavior can be disabled with the
  &#x201C;EXIT_AT_INTF_DOWN&#x201D; variable. If disabled, fwknopd will try to
  recover when a downed interface comes back up.</div>
<div class="Pp"></div>
<b>ENABLE_RULE_PREPEND</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">For systems running iptables or firewalld,
  have <b>fwknopd</b> insert new SPA rules at the beginning of the relevant
  chain (such as &#x201C;FWKNOP_INPUT&#x201D;) instead of appending them to the
  end of the chain. This causes newly created rules to have precedence over
  older ones.</div>
<div class="Pp"></div>
<b>ENABLE_NAT_DNS</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">Allow fwknopd to resolve hostnames in NAT
  access messages.</div>
<div class="Pp"></div>
<b>GPG_HOME_DIR</b> <i>&lt;path&gt;</i>
<div style="margin-left: 4.00ex;">If GPG keys are used instead of a Rijndael
  symmetric key, this is the default GPG keys directory. Note that each access
  stanza in <i>/etc/fwknop/access.conf</i> can specify its own GPG directory to
  override this default. If not set here or in an <i>access.conf</i> stanza,
  then the <i>$HOME/.gnupg</i> directory of the user running <b>fwknopd</b>
  (most likely root).</div>
<div class="Pp"></div>
<b>GPG_EXE</b> <i>&lt;path&gt;</i>
<div style="margin-left: 4.00ex;">Specify the path to GPG, and defaults to
  <i>/usr/bin/gpg</i> if not set.</div>
<div class="Pp"></div>
<b>LOCALE</b> <i>&lt;locale&gt;</i>
<div style="margin-left: 4.00ex;">Set the locale (via the LC_ALL variable). This
  can be set to override the default system locale.</div>
<div class="Pp"></div>
<b>ENABLE_SPA_OVER_HTTP</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">Allow <b>fwknopd</b> to acquire SPA data from
  HTTP requests (generated with the fwknop client in <b>--HTTP</b> mode). Note
  that when this is enabled, the &#x201C;PCAP_FILTER&#x201D; variable would need
  to be updated to sniff traffic over TCP/80 connections and a web server should
  be running on the same server as <b>fwknopd</b>.</div>
<div class="Pp"></div>
<b>ENABLE_X_FORWARDED_FOR</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">Allows <b>fwknopd</b> to use the
  X-Forwarded-for header from a captured SPA packet over HTTP as the source IP.
  This can happen when using SPA through an HTTP proxy.</div>
<div class="Pp"></div>
<b>ENABLE_TCP_SERVER</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">Enable the fwknopd TCP server. This is a
  &quot;dummy&quot; TCP server that will accept TCP connection requests on the
  specified TCPSERV_PORT. If set to &quot;Y&quot;, fwknopd will fork off a child
  process to listen for, and accept incoming TCP request. This server only
  accepts the request. It does not otherwise communicate. This is only to allow
  the incoming SPA over TCP packet which is detected via PCAP. The connection is
  closed after 1 second regardless. Note that fwknopd still only gets its data
  via pcap, so the filter defined by PCAP_FILTER needs to be updated to include
  this TCP port.</div>
<div class="Pp"></div>
<b>TCPSERV_PORT</b> <i>&lt;port&gt;</i>
<div style="margin-left: 4.00ex;">Set the port number that the
  &#x201C;dummy&#x201D; TCP server listens on. This server is only spawned when
  &#x201C;ENABLE_TCP_SERVER&#x201D; is set to &#x201C;Y&#x201D;.</div>
<div class="Pp"></div>
<b>ENABLE_UDP_SERVER</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">Enable the <b>fwknopd</b> UDP server. This
  instructs <b>fwknopd</b> to acquire SPA packets via a UDP socket directly
  without having to use libpcap. When this mode is enabled, <b>fwknop</b> should
  be compiled with <b>--enable-udp-server</b> (passed to the <b>configure</b>
  script) so that libpcap can be removed as a dependency. As one would expect,
  when the UDP server is used, no incoming packets are ever acknowledged by
  <b>fwknopd</b> and therefore collecting SPA packets in this mode is a good
  alternative to sniffing the wire directly.</div>
<div class="Pp"></div>
<b>UDPSERV_PORT</b> <i>&lt;port&gt;</i>
<div style="margin-left: 4.00ex;">Set the port number that the UDP server
  listens on. This server is only spawned when &#x201C;ENABLE_UDP_SERVER&#x201D;
  is set to &#x201C;Y&#x201D;.</div>
<div class="Pp"></div>
<b>PCAP_DISPATCH_COUNT</b> <i>&lt;count&gt;</i>
<div style="margin-left: 4.00ex;">Sets the number of packets that are processed
  when the <b>pcap_dispatch()</b> call is made. The default is zero, since this
  allows <b>fwknopd</b> to process as many packets as possible in the
  corresponding callback where the SPA handling routine is called for packets
  that pass a set of prerequisite checks. However, if <b>fwknopd</b> is running
  on a platform with an old version of libpcap, it may be necessary to change
  this value to a positive non-zero integer. More information can be found in
  the <b>pcap_dispatch(3)</b> man page.</div>
<div class="Pp"></div>
<b>PCAP_LOOP_SLEEP</b> <i>&lt;microseconds&gt;</i>
<div style="margin-left: 4.00ex;">Sets the number of microseconds to passed as
  an argument to usleep() in the pcap loop. The default is 10000, or 1/10th of a
  second.</div>
<div class="Pp"></div>
<b>ENABLE_PCAP_ANY_DIRECTION</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">Controls whether fwknopd is permitted to sniff
  SPA packets regardless of whether they are received on the sniffing interface
  or sent from the sniffing interface. In the later case, this can be useful to
  have fwknopd sniff SPA packets that are forwarded through a system and
  destined for a different network. If the sniffing interface is the egress
  interface for such packets, then this variable will need to be set to
  &quot;Y&quot; in order for fwknopd to see them. The default is &quot;N&quot;
  so that fwknopd only looks for SPA packets that are received on the sniffing
  interface (note that this is independent of promiscuous mode).</div>
<div class="Pp"></div>
<b>SYSLOG_IDENTITY</b> <i>&lt;identity&gt;</i>
<div style="margin-left: 4.00ex;">Override syslog identity on message logged by
  <b>fwknopd</b>. The defaults are usually ok.</div>
<div class="Pp"></div>
<b>SYSLOG_FACILITY</b> <i>&lt;facility&gt;</i>
<div style="margin-left: 4.00ex;">Override syslog facility. The
  &#x201C;SYSLOG_FACILITY&#x201D; variable can be set to</div>
<div class="Pp"></div>
<b>ENABLE_DESTINATION_RULE</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">Controls whether <b>fwknopd</b> will set the
  destination field on the firewall rule to the destination address specified on
  the incoming SPA packet. This is useful for interfaces with multiple IP
  addresses hosting separate services. If &#x201C;ENABLE_IPT_OUTPUT&#x201D; is
  set to &#x201C;Y&#x201D;, the source field of the firewall rule is set.
  FORWARD and SNAT rules are not affected however, DNAT rules will also have
  their destination field set. The default is &#x201C;N&#x201D;, which sets the
  destination field to 0.0.0.0/0 (any).</div>
<div class="Pp"></div>
<b>FWKNOP_RUN_DIR</b> <i>&lt;path&gt;</i>
<div style="margin-left: 4.00ex;">Specify the directory where <b>fwknopd</b>
  writes run time state files. The default is <i>/var</i>.</div>
<h2 class="Ss" title="Ss" id="ACCESS.CONF_VARIABLES"><a class="selflink" href="#ACCESS.CONF_VARIABLES">ACCESS.CONF
  VARIABLES</a></h2>
This section describes the access control directives in the
  <i>/etc/fwknop/access.conf</i> file. Theses directives define encryption and
  authentication keys, and the level of access that is granted to <b>fwknop</b>
  clients that have generated an appropriate encrypted and authenticated SPA
  packet.
<div style="height: 1.00em;">&#x00A0;</div>
The <i>access.conf</i> variables described below provide the access directives
  for the SPA packets with a source (or embedded request) IP that matches an
  address or network range defined by the &#x201C;SOURCE&#x201D; variable. All
  variables following &#x201C;SOURCE&#x201D; apply to the source <i>stanza</i>.
  Each &#x201C;SOURCE&#x201D; directive starts a new stanza.
<div class="Pp"></div>
<b>SOURCE</b> <i>&lt;IP,..,IP/NET,..,NET/ANY&gt;</i>
<div style="margin-left: 4.00ex;">This defines the source address from which the
  SPA packet will be accepted. The string &#x201C;ANY&#x201D; is also accepted
  if a valid SPA packet should be honored from any source IP. Every
  authorization stanza in <i>/etc/fwknop/access.conf</i> definition must start
  with the &#x201C;SOURCE&#x201D; keyword. Networks should be specified in CIDR
  notation (e.g. &#x201C;192.168.10.0/24&#x201D;), and individual IP addresses
  can be specified as well. Also, multiple IP&#x2019;s and/or networks can be
  defined as a comma separated list (e.g.
  &#x201C;192.168.10.0/24,10.1.1.123&#x201D;)</div>
<div class="Pp"></div>
<b>DESTINATION</b> <i>&lt;IP,..,IP/NET,..,NET/ANY&gt;</i>
<div style="margin-left: 4.00ex;">This defines the destination address for which
  the SPA packet will be accepted. The string &#x201C;ANY&#x201D; is also
  accepted if a valid SPA packet should be honored to any destination IP.
  Networks should be specified in CIDR notation (e.g.
  &#x201C;192.168.10.0/24&#x201D;), and individual IP addresses can be specified
  as well. Also, multiple IP&#x2019;s and/or networks can be defined as a comma
  separated list (e.g. &#x201C;192.168.10.0/24,10.1.1.123&#x201D;)</div>
<div class="Pp"></div>
<b>OPEN_PORTS</b> <i>&lt;proto/port&gt;,...,&lt;proto/port&gt;</i>
<div style="margin-left: 4.00ex;">Define a set of ports and protocols (tcp or
  udp) that will be opened if a valid knock sequence is seen. If this entry is
  not set, <b>fwknopd</b> will attempt to honor any proto/port request specified
  in the SPA data (unless of it matches any &#x201C;RESTRICT_PORTS&#x201D;
  entries). Multiple entries are comma-separated.</div>
<div class="Pp"></div>
<b>RESTRICT_PORTS</b> <i>&lt;proto/port&gt;,...,&lt;proto/port&gt;</i>
<div style="margin-left: 4.00ex;">Define a set of ports and protocols (tcp or
  udp) that are explicitly <b>not</b> allowed regardless of the validity of the
  incoming SPA packet. Multiple entries are comma-separated.</div>
<div class="Pp"></div>
<b>KEY</b> <i>&lt;passphrase&gt;</i>
<div style="margin-left: 4.00ex;">Define the symmetric key used for decrypting
  an incoming SPA packet that is encrypted by the <b>fwknop</b> client with
  Rijndael. The actual encryption key that is used is derived from the standard
  PBKDF1 algorithm. This variable is required for all SPA packets unless GnuPG
  is used instead (see the GPG variables below).</div>
<div class="Pp"></div>
<b>KEY_BASE64</b> <i>&lt;base64 encoded passphrase&gt;</i>
<div style="margin-left: 4.00ex;">Same as the <b>KEY</b> option above, but
  specify the symmetric key as a base64 encoded string. This allows non-ascii
  characters to be included in the base64-decoded key.</div>
<div class="Pp"></div>
<b>HMAC_KEY</b> <i>&lt;key&gt;</i>
<div style="margin-left: 4.00ex;">Specify the HMAC key for authenticated
  encryption of SPA packets. This supports both Rijndael and GPG encryption
  modes, and is applied according to the encrypt-then-authenticate model.</div>
<div class="Pp"></div>
<b>HMAC_KEY_BASE64</b> <i>&lt;base64 encoded key&gt;</i>
<div style="margin-left: 4.00ex;">Specify the HMAC key as a base64 encoded
  string. This allows non-ascii characters to be included in the base64-decoded
  key.</div>
<div class="Pp"></div>
<b>FW_ACCESS_TIMEOUT</b> <i>&lt;seconds&gt;</i>
<div style="margin-left: 4.00ex;">Define the length of time access will be
  granted by <b>fwknopd</b> through the firewall after a valid knock sequence
  from a source IP address. If &#x201C;FW_ACCESS_TIMEOUT&#x201D; is not set then
  the default timeout of 30 seconds will automatically be set.</div>
<div class="Pp"></div>
<b>%include</b> <i>&lt;file&gt;</i>
<div style="margin-left: 4.00ex;">Have <b>fwknopd</b> import an additional
  <i>access.conf</i> file. This allows more access stanzas to be defined in
  other locations in the filesystem, and this can be advantageous in some
  scenarios by letting non-privileged users define their own encryption and
  authentication keys for SPA operations. This way, users do not need write
  access to the main <i>/etc/fwknop/access.conf</i> file to change keys around
  or define new ones.</div>
<div class="Pp"></div>
<b>%include_folder</b> <i>&lt;directory&gt;</i>
<div style="margin-left: 4.00ex;">Similarly to the <i>%include</i> option above,
  the <i>%include_folder</i> directive has <b>fwknopd</b> import all .conf files
  from the specified directory. There is also command line support for this via
  the <i>access-folder</i> option.</div>
<div class="Pp"></div>
<b>ENCRYPTION_MODE</b> <i>&lt;mode&gt;</i>
<div style="margin-left: 4.00ex;">Specify the encryption mode when AES is used.
  The default is CBC mode, but other modes can be selected such as OFB and CFB.
  In general, it is recommended to not use this variable and leave it as the
  default. Note that the string &#x201C;legacy&#x201D; can be specified in order
  to generate SPA packets with the old initialization vector strategy used by
  versions of <b>fwknop</b> before 2.5. With the 2.5 release, <b>fwknop</b> uses
  PBKDF1 for key derivation.</div>
<div class="Pp"></div>
<b>HMAC_DIGEST_TYPE</b> <i>&lt;digest algorithm&gt;</i>
<div style="margin-left: 4.00ex;">Specify the digest algorithm for incoming SPA
  packet authentication. Must be one of <b>MD5</b>, <b>SHA1</b>, <b>SHA256</b>,
  <b>SHA384</b>, <b>SHA512</b>, <b>SHA3_256</b>, or <b>SHA3_512</b>. This is an
  optional field, and if not specified then <b>fwknopd</b> defaults to using
  SHA256 if the access stanza requires an HMAC.</div>
<div class="Pp"></div>
<b>ACCESS_EXPIRE</b> <i>&lt;MM/DD/YYYY&gt;</i>
<div style="margin-left: 4.00ex;">Defines an expiration date for the access
  stanza in MM/DD/YYYY format. All SPA packets that match an expired stanza will
  be ignored. This parameter is optional.</div>
<div class="Pp"></div>
<b>ACCESS_EXPIRE_EPOCH</b> <i>&lt;seconds&gt;</i>
<div style="margin-left: 4.00ex;">Defines an expiration date for the access
  stanza as the epoch time, and is useful if a more accurate expiration time
  needs to be given than the day resolution offered by the ACCESS_EXPIRE
  variable above. All SPA packets that match an expired stanza will be ignored.
  This parameter is optional.</div>
<div class="Pp"></div>
<b>ENABLE_CMD_EXEC</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">This instructs <b>fwknopd</b> to accept
  complete commands that are contained within an authorization packet. Any such
  command will be executed on the <b>fwknopd</b> server as the user specified by
  the &#x201C;CMD_EXEC_USER&#x201D; or as the user that started <b>fwknopd</b>
  if that is not set.</div>
<div class="Pp"></div>
<b>ENABLE_CMD_SUDO_EXEC</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;"><b>sudo</b> provides a powerful means of
  restricting the sets of commands that users can execute via the
  &#x201C;sudoers&#x201D; file. By enabling this feature (and in
  &#x201C;ENABLE_CMD_EXEC&#x201D; mode), all incoming commands from valid SPA
  packets will be prefixed by &#x201C;/path/to/sudo -u &lt;user&gt; -g
  &lt;group&gt;&#x201D; where the path to sudo is set by the
  &#x201C;SUDO_EXE&#x201D; variable, &#x201C;&lt;user&gt;&#x201D; is set by the
  &#x201C;CMD_SUDO_EXEC_USER&#x201D; variable (default is &#x201C;root&#x201D;
  if not set), and &#x201C;&lt;group&gt;&#x201D; is set by
  &#x201C;CMD_SUDO_EXEC_GROUP&#x201D; (default is also &#x201C;root&#x201D; if
  not set).</div>
<div class="Pp"></div>
<b>CMD_EXEC_USER</b> <i>&lt;username&gt;</i>
<div style="margin-left: 4.00ex;">Specify the user (via setuid) that will
  execute a command contained within a SPA packet. If this variable is not
  given, fwknopd will execute the command as the user it is running as (most
  likely root). Setting this to a non-root user such as &#x201C;nobody&#x201D;
  is highly recommended if elevated permissions are not needed.</div>
<div class="Pp"></div>
<b>CMD_SUDO_EXEC_USER</b> <i>&lt;username&gt;</i>
<div style="margin-left: 4.00ex;">Specify the user (via &#x201C;sudo -u
  &lt;user&gt;&#x201D;) that will execute a command contained within a SPA
  packet. If this variable is not given, fwknopd will assume the command should
  be executed as root.</div>
<div class="Pp"></div>
<b>CMD_EXEC_GROUP</b> <i>&lt;groupname&gt;</i>
<div style="margin-left: 4.00ex;">Specify the group (via setgid) that will
  execute a command contained within a SPA packet. If this variable is not
  given, fwknopd will execute the command as the user it is running as (most
  likely root). Setting this to a non-root user such as &#x201C;nobody&#x201D;
  is highly recommended if elevated permissions are not needed.</div>
<div class="Pp"></div>
<b>CMD_SUDO_EXEC_GROUP</b> <i>&lt;groupname&gt;</i>
<div style="margin-left: 4.00ex;">Specify the group (via &#x201C;sudo -g
  &lt;group&gt;&#x201D;) that will execute a command contained within a SPA
  packet. If this variable is not given, fwknopd will assume the command should
  be executed as root.</div>
<div class="Pp"></div>
<b>CMD_CYCLE_OPEN</b> <i>&lt;command&gt;</i>
<div style="margin-left: 4.00ex;">Specify a command open/close cycle to be
  executed upon receipt of a valid SPA packet. This directive sets the initial
  command, and is meant to be used in conjunction with the
  &#x201C;CMD_CYCLE_CLOSE&#x201D; variable below. The main application of this
  feature is to allow <b>fwknopd</b> to interact with firewall or ACL&#x2019;s
  that are not natively supported, and facilitate the same access model as for
  the main supported firewalls such as iptables. That is, a command is executed
  to open the firewall or ACL, and then a corresponding close command is
  executed after a timer expires. Both the &#x201C;CMD_CYCLE_OPEN&#x201D; and
  &#x201C;CMD_CYCLE_CLOSE&#x201D; variables support special substitution strings
  to allow values to be taken from the SPA payload and used on the command line
  of the executed command. These strings begin with a &#x201C;$&#x201D;
  character, and include &#x201C;$IP&#x201D; (the allow IP decrypted from the
  SPA payload), &#x201C;$SRC&#x201D; (synonym for &#x201C;$IP&#x201D;) ,
  &#x201C;$PKT_SRC&#x201D; (the source IP in the network layer header of the SPA
  packet), &#x201C;$DST&#x201D; (the destination IP), &#x201C;$PORT&#x201D; (the
  allow port), and &#x201C;$PROTO&#x201D; (the allow protocol),
  &#x201C;$TIMEOUT&#x201D; (set the client timeout if specified).</div>
<div class="Pp"></div>
<b>CMD_CYCLE_CLOSE</b> <i>&lt;command&gt;</i>
<div style="margin-left: 4.00ex;">Specify the close command that corresponds to
  the open command set by the &#x201C;CMD_CYCLE_OPEN&#x201D; variable described
  above. The same string substitutions such as &#x201C;$IP&#x201D;,
  &#x201C;$PORT&#x201D;, and &#x201C;$PROTO&#x201D; are supported. In addition,
  the special value &#x201C;NONE&#x201D; can be set to allow no close command to
  be executed after the open command. This might be handy in certain situations
  where, say, indefinite access is desired and allowed.</div>
<div class="Pp"></div>
<b>CMD_CYCLE_TIMER</b> <i>&lt;seconds&gt;</i>
<div style="margin-left: 4.00ex;">Set the number of seconds after which the
  close command set in &#x201C;CMD_CYCLE_CLOSE&#x201D; will be executed. This
  defines the open/close timer interval.</div>
<div class="Pp"></div>
<b>SUDO_EXE</b> <i>&lt;path&gt;</i>
<div style="margin-left: 4.00ex;">Define the path to the sudo binary. Default is
  &#x201C;/usr/bin/sudo&#x201D;.</div>
<div class="Pp"></div>
<b>REQUIRE_USERNAME</b> <i>&lt;username&gt;</i>
<div style="margin-left: 4.00ex;">Require a specific username from the client
  system as encoded in the SPA data. This variable is optional and if not
  specified, the username data in the SPA data is ignored.</div>
<div class="Pp"></div>
<b>REQUIRE_SOURCE_ADDRESS</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">Force all SPA packets to contain a real IP
  address within the encrypted data. This makes it impossible to use the
  <b>-s</b> command line argument on the <b>fwknop</b> client command line, so
  either <b>-R</b> has to be used to automatically resolve the external address
  (if the client behind a NAT) or the client must know the external IP and set
  it via the <b>-a</b> argument.</div>
<div class="Pp"></div>
<b>REQUIRE_SOURCE_ADDRESS</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">Synonym for
  &#x201C;REQUIRE_SOURCE_ADDRESS&#x201D;.</div>
<div class="Pp"></div>
<b>FORCE_NAT</b> <i>&lt;IP&gt; &lt;PORT&gt;</i>
<div style="margin-left: 4.00ex;">For any valid SPA packet, force the requested
  connection to be NAT&#x2019;d through to the specified (usually internal) IP
  and port value. This is useful if there are multiple internal systems running
  a service such as SSHD, and you want to give transparent access to only one
  internal system for each stanza in the access.conf file. This way, multiple
  external users can each directly access only one internal system per SPA
  key.</div>
<div class="Pp"></div>
<b>FORCE_SNAT</b> <i>&lt;IP&gt;</i>
<div style="margin-left: 4.00ex;">For any valid SPA packet, add an SNAT rule in
  addition to any DNAT rule created with a corresponding (required) FORCE_NAT
  variable. This is analogous to &#x201C;SNAT_TRANSLATE_IP&#x201D; from the
  <i>/etc/fwknop/fwknopd.conf</i> file except that it is per access stanza and
  overrides any value set with &#x201C;SNAT_TRANSLATE_IP&#x201D;. This is useful
  for situations where an incoming NAT&#x2019;d connection may be otherwise
  unanswerable due to routing constraints (i.e. the system receiving the SPA
  authenticated connection has a default route to a different device than the
  SPA system itself).</div>
<div class="Pp"></div>
<b>FORCE_MASQUERADE</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">This is similar to the
  &#x201C;FORCE_SNAT&#x201D; variable, except that it is not necessary to also
  specify an IP address for SNAT rules because the MASQUERADE target is used
  instead.</div>
<div class="Pp"></div>
<b>FORWARD_ALL</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">In NAT scenarios, control whether all traffic
  is forwarded through the <b>fwknopd</b> system as opposed to just forwarding
  connections to specific services as requested by the <b>fwknop</b>
  client.</div>
<div class="Pp"></div>
<b>DISABLE_DNAT</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">Control whether DNAT rules are created in
  FORCE_NAT scenarios. This is mainly used in conjunction with the FORWARD_ALL
  variable to allow <b>fwknopd</b> to act essentially as an SPA gateway. I.e.,
  the <b>fwknop</b> client is used to gain access via SPA to the broader
  Internet after being granted an IP via DHCP, but prior to sending the SPA
  packet all traffic is blocked by default to the Internet.</div>
<div class="Pp"></div>
<b>GPG_DECRYPT_ID</b> <i>&lt;keyID&gt;</i>
<div style="margin-left: 4.00ex;">Define a GnuPG key ID to use for decrypting
  SPA messages that have been encrypted by an <b>fwknop</b> client. This keyword
  is required for authentication that is based on GPG keys. The GPG key ring on
  the client must have imported and signed the <b>fwknopd</b> server key, and
  vice versa. It is ok to use a sensitive personal GPG key on the client, but
  each <b>fwknopd</b> server should have its own GPG key that is generated
  specifically for fwknop communications. The reason for this is that the
  decryption password for the server key must be placed within the
  <i>/etc/fwknop/access.conf</i> file for <b>fwknopd</b> to function (it has to
  be able to decrypt SPA messages that have been encrypted with the
  server&#x2019;s public key). For more information on using fwknop with GnuPG
  keys, see the following link:
  &#x201C;http://www.cipherdyne.org/fwknop/docs/gpghowto.html&#x201D;.</div>
<div class="Pp"></div>
<b>GPG_DECRYPT_PW</b> <i>&lt;decrypt password&gt;</i>
<div style="margin-left: 4.00ex;">Specify the decryption password for the gpg
  key defined by the &#x201C;GPG_DECRYPT_ID&#x201D; above. This is a required
  field for gpg-based authentication.</div>
<div class="Pp"></div>
<b>GPG_ALLOW_NO_PW</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">Allow <b>fwknopd</b> to leverage a GnuPG key
  pair that does not have an associated password. While this may sound like a
  controversial deployment mode, in automated environments it makes sense
  because &quot;there is usually no way to store a password more securely than
  on the secret keyring itself&quot; according to:
  &#x201C;http://www.gnupg.org/faq/GnuPG-FAQ.html#how-can-i-use-gnupg-in-an-automated-environment&#x201D;.
  Using this feature and removing the passphrase from a GnuPG key pair is useful
  in some environments where libgpgme is forced to use gpg-agent and/or pinentry
  to collect a passphrase.</div>
<div class="Pp"></div>
<b>GPG_REQUIRE_SIG</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">With this setting set to <i>Y</i>, fwknopd
  check all GPG-encrypted SPA messages for a signature (signed by the
  sender&#x2019;s key). If the incoming message is not signed, the decryption
  process will fail. If not set, the default is <i>Y</i>.</div>
<div class="Pp"></div>
<b>GPG_DISABLE_SIG</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">Disable signature verification for incoming
  SPA messages. This is not a recommended setting, and the default is
  <i>N</i>.</div>
<div class="Pp"></div>
<b>GPG_IGNORE_SIG_VERIFY_ERROR</b> <i>&lt;Y/N&gt;</i>
<div style="margin-left: 4.00ex;">Setting this will allow fwknopd to accept
  incoming GPG-encrypted packets that are signed, but the signature did not pass
  verification (i.e. the signer key was expired, etc.). This setting only
  applies if the GPG_REQUIRE_SIG is also set to <i>Y</i>.</div>
<div class="Pp"></div>
<b>GPG_REMOTE_ID</b> <i>&lt;keyID,...,keyID&gt;</i>
<div style="margin-left: 4.00ex;">Define a list of gpg key ID&#x2019;s that are
  required to have signed any incoming SPA message that has been encrypted with
  the <b>fwknopd</b> server key. This ensures that the verification of the
  remote user is accomplished via a strong cryptographic mechanism. Signature
  verification is enabled by default, and can only be disabled if
  &#x201C;GPG_DISABLE_SIG&#x201D; is set to <i>Y</i> (not a recommended
  setting). Separate multiple entries with a comma.</div>
<div class="Pp"></div>
<b>GPG_FINGERPRINT_ID</b> <i>&lt;keyID,...,keyID&gt;</i>
<div style="margin-left: 4.00ex;">Specify a set of full-length GnuPG key
  fingerprints instead of the shorter key identifiers set with the
  &#x201C;GPG_REMOTE_ID&#x201D; variable. Here is an example fingerprint for one
  of the fwknop test suite keys:
  <i>00CC95F05BC146B6AC4038C9E36F443C6A3FAD56</i>.</div>
<div class="Pp"></div>
<b>GPG_HOME_DIR</b> <i>&lt;path&gt;</i>
<div style="margin-left: 4.00ex;">Define the path to the GnuPG directory to be
  used by the <b>fwknopd</b> server. If this keyword is not specified within
  <i>/etc/fwknop/access.conf</i> then <b>fwknopd</b> will default to using the
  <i>/root/.gnupg</i> directory for the server key(s) for incoming SPA packets
  handled by the matching <i>access.conf</i> stanza.</div>
<div class="Pp"></div>
<b>GPG_EXE</b> <i>&lt;path&gt;</i>
<div style="margin-left: 4.00ex;">Define the path to the GnuPG executable. If
  this keyword is not specified within <i>/etc/fwknop/access.conf</i> then
  <b>fwknopd</b> will default to using <i>/usr/bin/gpg</i>.</div>
<h1 class="Sh" title="Sh" id="FILES"><a class="selflink" href="#FILES">FILES</a></h1>
<b>/etc/fwknop/fwknopd.conf</b>
<div style="margin-left: 4.00ex;">The main configuration file for fwknop.</div>
<div class="Pp"></div>
<b>/etc/fwknop/access.conf</b>
<div style="margin-left: 4.00ex;">Defines all knock sequences and access control
  directives.</div>
<h1 class="Sh" title="Sh" id="DEPENDENCIES"><a class="selflink" href="#DEPENDENCIES">DEPENDENCIES</a></h1>
<b>fwknopd</b> requires <i>libfko</i> which is normally included with both
  source and binary distributions, and is a dedicated library developed by the
  fwknop project.
<div style="height: 1.00em;">&#x00A0;</div>
For packet sniffing, <b>fwknopd</b> currently requires libpcap, but future
  versions will (optionally) remove this as a dependency.
<div style="height: 1.00em;">&#x00A0;</div>
For GPG functionality, GnuPG must also be correctly installed and configured
  along with the libgpgme library.
<div style="height: 1.00em;">&#x00A0;</div>
To take advantage of all of the authentication and access management features of
  the <b>fwknopd</b> daemon/service a functioning iptables, ipfw, or pf firewall
  is required on the underlying operating system.
<h1 class="Sh" title="Sh" id="DIAGNOSTICS"><a class="selflink" href="#DIAGNOSTICS">DIAGNOSTICS</a></h1>
<b>fwknopd</b> can be run in debug mode by combining the <b>-f, --foreground</b>
  and the <b>-v, --verbose</b> command line options. This will disable daemon
  mode execution, and print verbose information to the screen on stderr as
  packets are received.
<div style="height: 1.00em;">&#x00A0;</div>
The most comprehensive way to gain diagnostic information on <b>fwknopd</b> is
  to run the test suite <i>test-fwknop.pl</i> script located in the <i>test/</i>
  directory in the fwknop sources. The test suite runs sends fwknop through a
  large number of run time tests, has <i>valgrind</i> support, validates both
  SPA encryption and HMAC results against OpenSSL, and even has its own built in
  fuzzer for SPA communications.
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
fwknopd(8), iptables(8), pf(4), pfctl(8), ipfw(8), gpg(1), libfko documentation.
<div style="height: 1.00em;">&#x00A0;</div>
More information on Single Packet Authorization can be found in the paper
  &#x201C;Single Packet Authorization with fwknop&#x201D; available at
  <i>http://www.cipherdyne.org/fwknop/docs/SPA.html</i>. A comprehensive
  tutorial on <b>fwknop</b> operations and theory can be found at
  <i>http://www.cipherdyne.org/fwknop/docs/fwknop-tutorial.html</i>. This
  tutorial also includes information about the design of <b>fwknop</b> that may
  be worth reading for those interested in why fwknop is different from other
  SPA implementations.
<div style="height: 1.00em;">&#x00A0;</div>
<b>fwknop</b> uses the <i>git</i> versioning system as its source code
  repository along with <i>Github</i> for tracking of issues and milestones:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
    $ git clone https://github.com/mrash/fwknop.git fwknop.git
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
Additional commentary on Single Packet Authorization can be found via Michael
  Rash&#x2019;s Twitter feed: http://twitter.com/michaelrash, @michaelrash
<h1 class="Sh" title="Sh" id="AUTHORS"><a class="selflink" href="#AUTHORS">AUTHORS</a></h1>
The primary developers of <b>fwknop</b> are Michael Rash (project creator)
  &lt;mbr@cipherdyne.org&gt;, Damien Stuart &lt;dstuart@dstuart.org&gt;, and
  Jonathan Bennett &lt;jbennett@incomsystems.biz&gt;.
<h1 class="Sh" title="Sh" id="CONTRIBUTORS"><a class="selflink" href="#CONTRIBUTORS">CONTRIBUTORS</a></h1>
This &#x201C;C&#x201D; version of fwknop was derived from the original
  Perl-based version on which many people who are active in the open source
  community have contributed. See the CREDITS file in the fwknop sources, or
  visit <i>https://github.com/mrash/fwknop/blob/master/CREDITS</i> to view the
  online list of contributors. A few contributors deserve to be singled out
  including: Franck Joncourt, Max Kastanas, Vlad Glagolev, Sean Greven, Hank
  Leininger, Fernando Arnaboldi, and Erik Gomez.
<div style="height: 1.00em;">&#x00A0;</div>
The phrase &#x201C;Single Packet Authorization&#x201D; was coined by MadHat and
  Simple Nomad at the BlackHat Briefings of 2005.
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
Send bug reports to dstuart@dstuart.org or mbr@cipherdyne.org, or open a new
  issue on Github (see <i>https://github.com/mrash/fwknop.git</i>). Suggestions
  and/or comments are always welcome as well. Additional information may be
  found in the <b>fwknop</b> mailing list archives (see:
  <i>https://lists.sourceforge.net/lists/listinfo/fwknop-discuss</i>).
<h1 class="Sh" title="Sh" id="DISTRIBUTION"><a class="selflink" href="#DISTRIBUTION">DISTRIBUTION</a></h1>
<b>fwknopd</b> is distributed under the GNU General Public License (GPL v2+),
  and the latest version may be downloaded from
  <i>http://www.cipherdyne.org</i>.</div>
<table class="foot">
  <tr>
    <td class="foot-date">06/08/2016</td>
    <td class="foot-os">Fwknop Server</td>
  </tr>
</table>
</body>
</html>
