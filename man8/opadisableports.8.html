<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>opadisableports(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">opadisableports(8)</td>
    <td class="head-vol">Master map: IFSFFCLIRG (Man Page)</td>
    <td class="head-rtitle">opadisableports(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
opadisableports
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>(Linux)</b> Accepts a CSV file listing links to disable. For each HFI-SW
  link, the switch side of the link is disabled. For each SW-SW link, the side
  of the link with the lower LID (typically, the side closest to the SM) is
  disabled. This approach generally permits a future opaenableports operation to
  re-enable the port once the issue is corrected or ready to be retested. When
  using the -R option, this tool does not look at the routes, it disables the
  switch ports with the lower value LID. The list of disabled ports is tracked
  in /etc/sysconfig/opa/disabled*.csv.
<h1 class="Sh" title="Sh" id="Syntax"><a class="selflink" href="#Syntax">Syntax</a></h1>
opadisableports [-R] [-t <i>portsfile</i>] [-p <i>ports</i>] [ <i>reason</i>]
  #8217lt; disable.csv
<h1 class="Sh" title="Sh" id="Options"><a class="selflink" href="#Options">Options</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag">--help</dt>
  <dd class="It-tag">Produces full help text.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-R</dt>
  <dd class="It-tag">Does not attempt to get routes for computation of distance.
      Instead, disables switch port with lower LID assuming that it is closer to
      this node.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-t <i>portsfile</i></dt>
  <dd class="It-tag">File with list of local HFI ports used to access fabric(s)
      for operation. Default is /etc/sysconfig/opa/ports.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-p <i>ports</i></dt>
  <dd class="It-tag">List of local HFI ports used to access fabric(s) for
      operation. Default is first active port. The first HFI in the system is 1.
      The first port on an HFI is 1.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
<b>NOTE:</b> In this release, in multi-rail fabrics, this script does not work
  as expected when supplied with multiple egress ports. The script processes the
  entire input file against the first egress port specified, leaving no data to
  be applied against other egress ports. As a workaround, call the script once
  for each egress port.
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">Uses the format hfi:port :</dd>
</dl>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
0:0 First active port in system.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
0:y Port <i>y</i> within system.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
x:0 First active port on HFI <i>x</i>.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
x:y HFI <i>x</i>, port <i>y</i>.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">
  <br/>
   <i>reason</i></dt>
  <dd class="It-tag">Optional text describing why ports are being disabled. If
      used, text is saved in the reason field of the output file.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">disable.csv</dt>
  <dd class="It-tag">Input file listing the links to disable. The list is of the
      form: NodeGUID;PortNum;NodeType;NodeDesc;NodeGUID;PortNum;
      NodeType;NodeDesc;Reason
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">For each listed link, the switch port closer to this node
      is disabled. The <i>reason</i> field is optional. An input file such as
      this can be generated by using opaextractbadlinks or
    opaextractsellinks.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">Information about the links disabled and the reason is
      saved (in the same format) to an output file named
      /etc/sysconfig/opa/disabled:hfi:port.csv where the hfi:port part of the
      file name is replaced by the HFI number and the port number being operated
      on (such as 0:0 or 1:2). This CSV file can be used as input to
      opaenableports.</dd>
</dl>
<h1 class="Sh" title="Sh" id="Environment_Variables"><a class="selflink" href="#Environment_Variables">Environment
  Variables</a></h1>
The following environment variables are also used by this command:
<dl class="Bl-tag">
  <dt class="It-tag"><b>PORTS</b></dt>
  <dd class="It-tag">List of ports, used in absence of -t and -p.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>PORTS_FILE</b></dt>
  <dd class="It-tag">File containing list of ports, used in absence of -t and
      -p.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="Examples"><a class="selflink" href="#Examples">Examples</a></h1>
opadisableports 'bad cable' #8217lt; disable.csv
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
opadisableports -p '1:1 1:2 2:1 2:2' 'dead servers' #8217lt; disable.csv</div>
<table class="foot">
  <tr>
    <td class="foot-date">Intel Corporation</td>
    <td class="foot-os">Copyright(C) 2015-2016</td>
  </tr>
</table>
</body>
</html>
