<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 19:10:29 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>DNSTOP(8) BSD System Manager&rsquo;s Manual
DNSTOP(8)</p>

<p style="margin-top: 1em">NAME <br>
dnstop &acirc; displays various tables of DNS traffic on
your network</p>

<p style="margin-top: 1em">SYNOPSIS <br>
dnstop [-46apsQR] [-b expression] [-i address] [-f filter]
[-r interval] [device] [savefile]</p>

<p style="margin-top: 1em">DESCRIPTION <br>
dnstop is a small tool to listen on device or to parse the
file savefile and collect and print statistics on the local
network&rsquo;s DNS traffic. You must have read access to
<br>
/dev/bpf*.</p>

<p style="margin-top: 1em">COMMAND LINE OPTIONS <br>
The options are as follows:</p>

<p style="margin-top: 1em">-4 count only messages with IPv4
addresses</p>

<p style="margin-top: 1em">-6 count only messages with IPv6
addresses</p>

<p style="margin-top: 1em">-Q count only DNS query
messages</p>

<p style="margin-top: 1em">-R count only DNS reply
messages</p>

<p style="margin-top: 1em">-a anonymize addresses</p>

<p style="margin-top: 1em">-b expression <br>
BPF filter expression <br>
(default: udp port 53)</p>

<p style="margin-top: 1em">-i address <br>
ignore select addresses</p>

<p style="margin-top: 1em">-p Do not put the interface into
promiscuous mode.</p>

<p style="margin-top: 1em">-r Redraw interval
(seconds).</p>

<p style="margin-top: 1em">-l level <br>
keep counts on names up to level domain name levels.</p>

<p style="margin-top: 1em">For example, with -l 2 (the
default), dnstop will keep two tables: one with top-level
domain names, and another with second-level domain names.
Increasing the level pro&acirc; <br>
vides more details, but also requires more memory and
CPU.</p>

<p style="margin-top: 1em">-f input filter name</p>

<p style="margin-top: 1em">The &quot;unknown-tlds&quot;
filter includes only queries for TLDs that are bogus. Useful
for identifying hosts/servers that leak queries for things
like &quot;localhost&quot; or &quot;workgroup.&quot;</p>

<p style="margin-top: 1em">The &quot;A-for-A&quot; filter
includes only A queries for names that are already IP
addresses. Certain Microsoft Windows DNS servers have a
known bug that forward these queries.</p>

<p style="margin-top: 1em">The &quot;rfc1918-ptr&quot;
filter includes only PTR queries for addresses in RFC1918
space. These should never leak from inside an
organization.</p>

<p style="margin-top: 1em">The &quot;refused&quot; filter,
when used with the -R option, tells dnstop to count only
replies with rcode REFUSED.</p>

<p style="margin-top: 1em">The &quot;qtype-any&quot; filter
tells dnstop to count only message of type ANY.</p>

<p style="margin-top: 1em">-n name <br>
Only count messages within the domain name</p>

<p style="margin-top: 1em">-P Print &quot;progress&quot;
messages on stderr when in non-interactive mode.</p>

<p style="margin-top: 1em">-B buckets <br>
Use buckets hash table buckets.</p>

<p style="margin-top: 1em">-X Do not tabulate the sources +
query name counters. This can significantly reduce memory
usage on busy servers and large savefiles.</p>

<p style="margin-top: 1em">savefile <br>
a captured network trace in pcap format</p>

<p style="margin-top: 1em">device ethernet device (ie
fxp0)</p>

<p style="margin-top: 1em">RUN TIME OPTIONS <br>
While running, the following options are available to alter
the display:</p>

<p style="margin-top: 1em">s display the source address
table</p>

<p style="margin-top: 1em">d display the destination
address table</p>

<p style="margin-top: 1em">t display the breakdown of query
types seen</p>

<p style="margin-top: 1em">r display the breakdown of
response codes seen</p>

<p style="margin-top: 1em">o display the breakdown of
opcodes seen</p>

<p style="margin-top: 1em">1 show 1st level query names</p>

<p style="margin-top: 1em">2 show 2nd level query names</p>

<p style="margin-top: 1em">3 show 3rd level query names</p>

<p style="margin-top: 1em">4 show 4th level query names</p>

<p style="margin-top: 1em">5 show 5th level query names</p>

<p style="margin-top: 1em">6 show 6th level query names</p>

<p style="margin-top: 1em">7 show 7th level query names</p>

<p style="margin-top: 1em">8 show 8th level query names</p>

<p style="margin-top: 1em">9 show 9th level query names</p>

<p style="margin-top: 1em">! show sources + 1st level query
names</p>

<p style="margin-top: 1em">@ show sources + 2nd level query
names</p>

<p style="margin-top: 1em"># show sources + 3rd level query
names</p>

<p style="margin-top: 1em">$ show sources + 4th level query
names</p>

<p style="margin-top: 1em">% show sources + 5th level query
names</p>

<p style="margin-top: 1em">^ show sources + 6th level query
names</p>

<p style="margin-top: 1em">&amp; show sources + 7th level
query names</p>

<p style="margin-top: 1em">* show sources + 8th level query
names</p>

<p style="margin-top: 1em">( show sources + 9th level query
names</p>

<p style="margin-top: 1em">^R reset the counters</p>

<p style="margin-top: 1em">^X exit the program</p>

<p style="margin-top: 1em">space redraw</p>

<p style="margin-top: 1em">? help</p>

<p style="margin-top: 1em">NON-INTERACTIVE MODE <br>
If stdout is not a tty, dnstop runs in non-interactive mode.
In this case, you must supply a savefile for reading,
instead of capturing live packets. After reading the entire
<br>
savefile, dnstop prints the top 50 entries for each
table.</p>

<p style="margin-top: 1em">HOW MESSAGES ARE COUNTED <br>
By default dnstop examines only query messages and ignores
replies. In this case the response code table is meaningless
and will likely show 100% &quot;Noerror.&quot;</p>

<p style="margin-top: 1em">If you supply (only) the -R
command line option, dnstop examines replies and ignores
queries. This allows you to see meaningful response code
values, as well as all the other <br>
tables. In this case all the query attributes (such as type
and name) are taken from the Question section of the
reply.</p>

<p style="margin-top: 1em">Note, however, that it is common
for a stream of DNS messages to contain more queries than
replies. This could happen, for example, if the server is
too busy to respond to every <br>
single query, or if the server is designed to ignore
malformed query messages. Therefore, you might want to
examine both queries and replies by giving both -R and -Q
command line <br>
options. In this case, only the response code counts are
taken from the replies and all other attributes are taken
from the queries.</p>

<p style="margin-top: 1em">AUTHORS <br>
Duane Wessels (wessels@measurement-factory.com) <br>
Mark Foster (mark@foster.cc) <br>
Jose Nazario (jose@monkey.org) <br>
Sam Norris &lt;@ChangeIP.com&gt; <br>
Max Horn &lt;@quendi.de&gt; <br>
John Morrissey &lt;jwm@horde.net&gt; <br>
Florian Forster &lt;octo@verplant.org&gt; <br>
Dave Plonka &lt;plonka@cs.wisc.edu&gt; <br>
http://dnstop.measurement-factory.com/</p>

<p style="margin-top: 1em">BUGS <br>
Does not support TCP at this time.</p>

<p style="margin-top: 1em">BSD 21 March, 2008 BSD</p>
<hr>
</body>
</html>
