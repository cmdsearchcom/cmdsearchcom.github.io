<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>opacaptureall(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">opacaptureall(8)</td>
    <td class="head-vol">Master map: IFSFFCLIRG (Man Page)</td>
    <td class="head-rtitle">opacaptureall(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
opacaptureall
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>(Chassis and Host)</b> Captures supporting information for a problem report
  from all hosts or Intel(R) Omni-Path Chassis and uploads to this system.
<div class="Pp"></div>
<b>For Hosts :</b> When a host opacaptureall is performed, opacapture is run to
  create the specified capture file within ~root on each host (with the .tgz
  suffix added as needed). The files are uploaded and unpacked into a matching
  directory name within upload_dir/ <i>hostname</i>/ on the local system. The
  default file name is hostcapture.
<div class="Pp"></div>
<b>For Chassis:</b> When a chassis opacaptureall is performed, opacapture is run
  on each chassis and its output is saved to upload_dir/
  <i>chassisname</i>/<i>file</i> on the local system. The default file name is
  chassiscapture.
<div class="Pp"></div>
For both host and chassis capture, the uploaded captures are combined into a
  .tgz file with the file name specified and the suffix .all.tgz added.
<h1 class="Sh" title="Sh" id="Syntax"><a class="selflink" href="#Syntax">Syntax</a></h1>
opacaptureall [-C] [-p] [-f <i>hostfile</i>] [-F <i>chassisfile</i>]
<div>&#x00A0;</div>
[-h ' <i>hosts</i>']
<div>&#x00A0;</div>
[-H ' <i>chassis</i>'] [-t <i>portsfile</i>] [-d <i>upload_dir</i>] [-S] [-D
  <i>detail_level</i>] [ <i>file</i>]
<h1 class="Sh" title="Sh" id="Options"><a class="selflink" href="#Options">Options</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag">--help</dt>
  <dd class="It-tag">Produces full help text.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-C</dt>
  <dd class="It-tag">Performs capture against chassis. Default is hosts.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-p</dt>
  <dd class="It-tag">Performs capture upload in parallel on all host/chassis.
      For a host capture, this only affects the upload phase.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-f <i>hostfile</i></dt>
  <dd class="It-tag">File with hosts in cluster. Default is
      /etc/sysconfig/opa/hosts file.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-F <i>chassisfile</i></dt>
  <dd class="It-tag">File containing a list of chassis in the cluster. Default
      is /etc/sysconfig/opa/chassis file.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-h <i>hosts</i></dt>
  <dd class="It-tag">List of hosts on which to perform a capture.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-H <i>chassis</i></dt>
  <dd class="It-tag">List of chassis on which to perform a capture.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-t <i>portsfile</i></dt>
  <dd class="It-tag">File with list of local HFI ports used to access fabric(s)
      for switch access, default is /etc/sysconfig/opa/ports file.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-d <i>upload_dir</i></dt>
  <dd class="It-tag">Directory to upload to, default is uploads. If not
      specified, the environment variable <b>UPLOADS_DIR</b> is used. If that is
      not exported, the default (./uploads) is used.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-S</dt>
  <dd class="It-tag">Securely prompts for password for administrator on a
      chassis.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-D <i>detail_level</i></dt>
  <dd class="It-tag">Level of detail of the capture passed to host opacapture.
      (Only used for host captures; ignored for chassis captures.)</dd>
</dl>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
1 Local. Obtains local information from each host.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
2 Fabric. In addition to <i>Local</i>, also obtains basic fabric information by
  queries to the SM and fabric error analysis using opareport.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
3 Fabric+FDB. In addition to <i>Fabric</i>, also obtains the Forwarding Database
  (FDB), which includes the switch forwarding tables from the SM.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
4 Analysis. In addition to <i>Fabric+FDB</i>, also obtains opaallanalysis
  results. If opaallanalysis has not yet been run, it is run as part of the
  capture.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
<b>NOTE:</b> Detail levels 2-4 can be used when fabric operational problems
  occur. If the problem is node-specific, detail level 1 should be sufficient.
  Detail levels 2-4 require an operational Intel(R) Omni-Path Fabric Suite
  Fabric Manager. Typically your support representative requests a given detail
  level. If a given detail level takes excessively long or fails to be gathered,
  try a lower detail level.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
For detail levels 2-4, the additional information is only gathered on the node
  running the opacaptureall command. The information is gathered for every
  fabric specified in the /etc/sysconfig/opa/ports file.
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">
  <br/>
   <i>file</i></dt>
  <dd class="It-tag">Name for capture file. The suffix .tgz is appended if it is
      not specified in the name.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="Examples"><a class="selflink" href="#Examples">Examples</a></h1>
<h1 class="Sh" title="Sh" id="Host_Capture_Examples"><a class="selflink" href="#Host_Capture_Examples">Host
  Capture Examples</a></h1>
opacaptureall
<div>&#x00A0;</div>
# Creates a hostcapture directory in upload_dir/hostname/ for each host in
<div>&#x00A0;</div>
/etc/sysconfig/opa/hosts file, then creates hostcapture.all.tgz.
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
opacaptureall mycapture
<div>&#x00A0;</div>
# Creates a mycapture directory in upload_dir/hostname/ for each host in
<div>&#x00A0;</div>
/etc/sysconfig/opa/hosts file, then creates mycapture.all.tgz.
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
opacaptureall -h #8217#180;arwen elrond&#x00B4; 030127capture
<div>&#x00A0;</div>
# Gets the list of hosts from arwen elrond file and creates 030127cap#8217#8208;
<div>&#x00A0;</div>
ture.tgz file.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="Chassis_Capture_Examples"><a class="selflink" href="#Chassis_Capture_Examples">Chassis
  Capture Examples</a></h1>
opacaptureall -C
<div>&#x00A0;</div>
# Creates a chassiscapture file in upload_dir/chassisname/ for each chassis
<div>&#x00A0;</div>
in /etc/sysconfig/opa/chassis file, then creates chassiscapture.all.tgz.
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
opacaptureall -C mycapture
<div>&#x00A0;</div>
# Creates a mycapture.tgz file in upload_dir/chassisname/ for each chassis
<div>&#x00A0;</div>
in /etc/sysconfig/opa/chassis file, then creates mycapture.all.tgz.
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
opacaptureall -C -H #8217#180;chassis1 chassis2&#x00B4; 030127capture
<div>&#x00A0;</div>
# Captures from chassis1 and chassis2, and creates 030127capture.tgz file.
<h1 class="Sh" title="Sh" id="Environment_Variables"><a class="selflink" href="#Environment_Variables">Environment
  Variables</a></h1>
The following environment variables are also used by this command:
<dl class="Bl-tag">
  <dt class="It-tag"><b>HOSTS</b></dt>
  <dd class="It-tag">List of hosts, used if -h option not supplied.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>CHASSIS</b></dt>
  <dd class="It-tag">List of chassis, used if -C is used and -h option is not
      supplied.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>HOSTS_FILE</b></dt>
  <dd class="It-tag">File containing a list of hosts, used in the absence of -f
      and -h.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>CHASSIS_FILE</b></dt>
  <dd class="It-tag">File containing a list of chassis, used in the absence of
      -F and -H.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>UPLOADS_DIR</b></dt>
  <dd class="It-tag">Directory to upload to, used in the absence of -d.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>FF_MAX_PARALLEL</b></dt>
  <dd class="It-tag">When -p option is used, maximum concurrent operations are
      performed.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>FF_CHASSIS_LOGIN_METHOD</b></dt>
  <dd class="It-tag">How to log into chassis. Can be Telnet or SSH.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>FF_CHASSIS_ADMIN_PASSWORD</b></dt>
  <dd class="It-tag">Password for administrator on all chassis. Used in absence
      of -S option.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="More_Information"><a class="selflink" href="#More_Information">More
  Information</a></h1>
When performing opacaptureall against hosts, internally SSH is used. The command
  opacaptureall requires that password-less SSH be set up between the host
  running Intel(R) Omni-Path Fabric Suite FastFabric Toolset and the hosts
  opacaptureall is operating against. The opasetupssh command can aid in setting
  up password-less SSH.
<div class="Pp"></div>
When performing operations against chassis, set up of SSH keys is recommended
  (see <i>opasetupssh</i> ). If SSH keys are not set up, all chassis must be
  configured with the same admin password and use of the -S option is
  recommended. The -S option avoids the need to keep the password in
  configuration files.
<div class="Pp"></div>
<b>NOTE:</b> The resulting host capture files can require significant amounts of
  space on the Intel(R) Omni-Path Fabric Suite FastFabric Toolset host. Actual
  size varies, but sizes can be multiple megabytes per host. Intel recommends
  that you ensure adequate space is available on the Intel(R) Omni-Path Fabric
  Suite FastFabric Toolset system. In many cases, it may not be necessary to run
  opacaptureall against all hosts or chassis; instead, a representative subset
  may be sufficient. Consult with your support representative for further
  information.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">Intel Corporation</td>
    <td class="foot-os">Copyright(C) 2015-2016</td>
  </tr>
</table>
</body>
</html>
