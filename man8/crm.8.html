<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 19:09:46 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>CRM(8) crmsh documentation CRM(8)</p>

<p style="margin-top: 1em">NAME <br>
crm - Pacemaker command line interface for configuration and
management</p>

<p style="margin-top: 1em">SYNOPSIS <br>
crm [OPTIONS] [SUBCOMMAND ARGS...]</p>

<p style="margin-top: 1em">DESCRIPTION <br>
The crm shell is a command-line based cluster configuration
and management tool. Its goal is to assist as much as
possible with the configuration and maintenance of <br>
Pacemaker-based High Availability clusters.</p>

<p style="margin-top: 1em">For more information on
Pacemaker itself, see http://clusterlabs.org/.</p>

<p style="margin-top: 1em">crm works both as a command-line
tool to be called directly from the system shell, and as an
interactive shell with extensive tab completion and
help.</p>

<p style="margin-top: 1em">The primary focus of the crm
shell is to provide a simplified and consistent interface to
Pacemaker, but it also provides tools for managing the
creation and configuration of <br>
High Availability clusters from scratch. To learn more about
this aspect of crm, see the cluster section below.</p>

<p style="margin-top: 1em">The crm shell can be used to
manage every aspect of configuring and maintaining a
cluster. It provides a simplified line-based syntax on top
of the XML configuration format used <br>
by Pacemaker, commands for starting and stopping resources,
tools for exploring the history of a cluster including log
scraping and a set of cluster scripts useful for automating
<br>
the setup and installation of services on the cluster
nodes.</p>

<p style="margin-top: 1em">The crm shell is line oriented:
every command must start and finish on the same line. It is
possible to use a continuation character ( to write one
command in two or more <br>
lines. The continuation character is commonly used when
displaying configurations.</p>

<p style="margin-top: 1em">OPTIONS <br>
-f, --file=FILE <br>
Load commands from the given file. If a dash - is used in
place of a file name, crm will read commands from the shell
standard input (stdin).</p>

<p style="margin-top: 1em">-c, --cib=CIB <br>
Start the session using the given shadow CIB file.
Equivalent to cib use &lt;CIB&gt;.</p>

<p style="margin-top: 1em">-D, --display=OUTPUT_TYPE <br>
Choose one of the output options: plain, color-always,
color, or uppercase. The default is color if the terminal
emulation supports colors. Otherwise, plain is used.</p>

<p style="margin-top: 1em">-F, --force <br>
Make crm proceed with applying changes where it would
normally ask the user to confirm before proceeding. This
option is mainly useful in scripts, and should be used with
<br>
care.</p>

<p style="margin-top: 1em">-w, --wait <br>
Make crm wait for the cluster transition to finish (for the
changes to take effect) after each processed line.</p>

<p style="margin-top: 1em">-H, --history=DIR|FILE|SESSION
<br>
A directory or file containing a cluster report to load into
the history commands, or the name of a previously saved
history session.</p>

<p style="margin-top: 1em">-h, --help <br>
Print help page.</p>

<p style="margin-top: 1em">--version <br>
Print crmsh version and build information (Mercurial Hg
changeset hash).</p>

<p style="margin-top: 1em">-d, --debug <br>
Print verbose debugging information.</p>

<p style="margin-top: 1em">-R, --regression-tests <br>
Enables extra verbose trace logging used by the regression
tests. Logs all external calls made by crmsh.</p>

<p style="margin-top: 1em">--scriptdir=DIR <br>
Extra directory where crm looks for cluster scripts, or a
list of directories separated by semi-colons (e.g.
/dir1;/dir2;etc.).</p>

<p style="margin-top: 1em">-o, --opt=OPTION=VALUE <br>
Set crmsh option temporarily. If the options are saved using
options save then the value passed here will also be saved.
Multiple options can be set by using -o multiple <br>
times.</p>

<p style="margin-top: 1em">INTRODUCTION <br>
This section of the user guide covers general topics about
the user interface and describes some of the features of
crmsh in detail.</p>

<p style="margin-top: 1em">User interface <br>
The main purpose of crmsh is to provide a simple yet
powerful interface to the cluster stack. There are two main
modes of operation with the user interface of crmsh:</p>

<p style="margin-top: 1em">&Acirc;&middot; Command line
(single-shot) use - Use crm as a regular UNIX command from
your usual shell. crm has full bash completion built in, so
using it in this manner should be as <br>
comfortable and familiar as using any other command-line
tool.</p>

<p style="margin-top: 1em">&Acirc;&middot; Interactive mode
- By calling crm without arguments, or by calling it with
only a sublevel as argument, crm enters the interactive
mode. In this mode, it acts as its own <br>
command shell, which remembers which sublevel you are
currently in and allows for rapid and convenient execution
of multiple commands within the same sublevel. This mode
also <br>
has full tab completion, as well as built-in interactive
help and syntax highlighting.</p>

<p style="margin-top: 1em">Here are a few examples of using
crm both as a command-line tool and as an interactive
shell:</p>

<p style="margin-top: 1em">Command line (one-shot)
use:.</p>

<p style="margin-top: 1em"># crm resource stop www_app</p>

<p style="margin-top: 1em">Interactive use:.</p>

<p style="margin-top: 1em"># crm <br>
crm(live)# resource <br>
crm(live)resource# unmanage tetris_1 <br>
crm(live)resource# up <br>
crm(live)# node standby node4</p>

<p style="margin-top: 1em">Cluster configuration:.</p>

<p style="margin-top: 1em"># crm configure&lt;&lt;EOF <br>
# <br>
# resources <br>
# <br>
primitive disk0 iscsi params portal=192.168.2.108:3260
target=iqn.2008-07.com.suse:disk0 <br>
primitive fs0 Filesystem params
device=/dev/disk/by-label/disk0 directory=/disk0 fstype=ext3
<br>
primitive internal_ip IPaddr params ip=192.168.1.101 <br>
primitive apache apache params
configfile=/disk0/etc/apache2/site0.conf <br>
primitive apcfence stonith:apcsmart params ttydev=/dev/ttyS0
hostlist=&quot;node1 node2&quot; op start timeout=60s <br>
primitive pingd pingd params name=pingd dampen=5s
multiplier=100 host_list=&quot;r1 r2&quot; <br>
# <br>
# monitor apache and the UPS <br>
# <br>
monitor apache 60s:30s <br>
monitor apcfence 120m:60s <br>
# <br>
# cluster layout <br>
# <br>
group internal_www disk0 fs0 internal_ip apache <br>
clone fence apcfence meta globally-unique=false clone-max=2
clone-node-max=1 <br>
clone conn pingd meta globally-unique=false clone-max=2
clone-node-max=1 <br>
location node_pref internal_www rule 50: #uname eq node1
rule pingd: defined pingd <br>
# <br>
# cluster properties <br>
# <br>
property stonith-enabled=true <br>
commit <br>
EOF</p>

<p style="margin-top: 1em">The crm interface is
hierarchical, with commands organized into separate levels
by functionality. To list the available levels and commands,
either execute help &lt;level&gt;, or, if <br>
at the top level of the shell, simply typing help will
provide an overview of all available levels and
commands.</p>

<p style="margin-top: 1em">The (live) string in the crm
prompt signifies that the current CIB in use is the cluster
live configuration. It is also possible to work with
so-called shadow CIBs. These are <br>
separate, inactive configurations stored in files, that can
be applied and thereby replace the live configuration at any
time.</p>

<p style="margin-top: 1em">Tab completion <br>
The crm makes extensive use of tab completion. The
completion is both static (i.e. for crm commands) and
dynamic. The latter takes into account the current status of
the cluster <br>
or information from installed resource agents. Sometimes,
completion may also be used to get short help on resource
parameters. Here are a few examples:</p>

<p style="margin-top: 1em">crm(live)resource#
&lt;TAB&gt;&lt;TAB&gt; <br>
bye failcount move restart unmigrate <br>
cd help param show unmove <br>
cleanup list promote start up <br>
demote manage quit status utilization <br>
end meta refresh stop <br>
exit migrate reprobe unmanage</p>

<p style="margin-top: 1em">crm(live)configure# primitive
fence-1 &lt;TAB&gt;&lt;TAB&gt; <br>
heartbeat: lsb: ocf: stonith:</p>

<p style="margin-top: 1em">crm(live)configure# primitive
fence-1 stonith:&lt;TAB&gt;&lt;TAB&gt; <br>
apcmaster external/ippower9258 fence_legacy <br>
apcmastersnmp external/kdumpcheck ibmhmc <br>
apcsmart external/libvirt ipmilan</p>

<p style="margin-top: 1em">crm(live)configure# primitive
fence-1 stonith:ipmilan params &lt;TAB&gt;&lt;TAB&gt; <br>
auth= hostname= ipaddr= login= password= port= priv=</p>

<p style="margin-top: 1em">crm(live)configure# primitive
fence-1 stonith:ipmilan params auth=&lt;TAB&gt;&lt;TAB&gt;
<br>
auth* (string) <br>
The authorization type of the IPMI session
(&quot;none&quot;, &quot;straight&quot;, &quot;md2&quot;, or
&quot;md5&quot;)</p>

<p style="margin-top: 1em">crmsh also comes with bash
completion usable directly from the system shell. This
should be installed automatically with the command
itself.</p>

<p style="margin-top: 1em">Shorthand syntax <br>
When using the crm shell to manage clusters, you will end up
typing a lot of commands many times over. Clear command
names like configure help in understanding and learning to
<br>
use the cluster shell, but is easy to misspell and is
tedious to type repeatedly. The interactive mode and tab
completion both help with this, but the crm shell also has
the <br>
ability to understand a variety of shorthand aliases for all
of the commands.</p>

<p style="margin-top: 1em">For example, instead of typing
crm status, you can type crm st or crm stat. Instead of crm
configure you can type crm cfg or even crm cf. crm resource
can be shorted as crm rsc, <br>
and so on.</p>

<p style="margin-top: 1em">The exact list of accepted
aliases is too long to print in full, but experimentation
and typoes should help in discovering more of them.</p>

<p style="margin-top: 1em">FEATURES <br>
The feature set of crmsh covers a wide range of
functionality, and understanding how and when to use the
various features of the shell can be difficult. This section
of the guide <br>
describes some of the features and use cases of crmsh in
more depth. The intention is to provide a deeper
understanding of these features, but also to serve as a
guide to using <br>
them.</p>

<p style="margin-top: 1em">Shadow CIB usage <br>
A Shadow CIB is a normal cluster configuration stored in a
file. They may be manipulated in much the same way as the
live CIB, with the key difference that changes to a shadow
<br>
CIB have no effect on the actual cluster resources. An
administrator may choose to apply any of them to the
cluster, thus replacing the running configuration with the
one found <br>
in the shadow CIB.</p>

<p style="margin-top: 1em">The crm prompt always contains
the name of the configuration which is currently in use, or
the string live if using the live cluster configuration.</p>

<p style="margin-top: 1em">When editing the configuration
in the configure level, no changes are actually applied
until the commit command is executed. It is possible to
start editing a configuration as <br>
usual, but instead of committing the changes to the active
CIB, save them to a shadow CIB.</p>

<p style="margin-top: 1em">The following example configure
session demonstrates how this can be done:</p>

<p style="margin-top: 1em">crm(live)configure# cib new
test-2 <br>
INFO: test-2 shadow CIB created <br>
crm(test-2)configure# commit</p>

<p style="margin-top: 1em">Configuration semantic checks
<br>
Resource definitions may be checked against the meta-data
provided with the resource agents. These checks are
currently carried out:</p>

<p style="margin-top: 1em">&Acirc;&middot; are required
parameters set</p>

<p style="margin-top: 1em">&Acirc;&middot; existence of
defined parameters</p>

<p style="margin-top: 1em">&Acirc;&middot; timeout values
for operations</p>

<p style="margin-top: 1em">The parameter checks are obvious
and need no further explanation. Failures in these checks
are treated as configuration errors.</p>

<p style="margin-top: 1em">The timeouts for operations
should be at least as long as those recommended in the
meta-data. Too short timeout values are a common mistake in
cluster configurations and, even <br>
worse, they often slip through if cluster testing was not
thorough. Though operation timeouts issues are treated as
warnings, make sure that the timeouts are usable in your
<br>
environment. Note also that the values given are just
advisory minimum---your resources may require longer
timeouts.</p>

<p style="margin-top: 1em">User may tune the frequency of
checks and the treatment of errors by the check-frequency
and check-mode preferences.</p>

<p style="margin-top: 1em">Note that if the check-frequency
is set to always and the check-mode to strict, errors are
not tolerated and such configuration cannot be saved.</p>

<p style="margin-top: 1em">Configuration templates <br>
Deprecation note</p>

<p style="margin-top: 1em">Configuration templates have
been deprecated in favor of the more capable cluster
scripts. To learn how to use cluster scripts, see the
dedicated documentation on the crmsh <br>
website at http://crmsh.github.io/, or in the Script
section.</p>

<p style="margin-top: 1em">Configuration templates are
ready made configurations created by cluster experts. They
are designed in such a way so that users may generate valid
cluster configurations with <br>
minimum effort. If you are new to Pacemaker, templates may
be the best way to start.</p>

<p style="margin-top: 1em">We will show here how to create
a simple yet functional Apache configuration:</p>

<p style="margin-top: 1em"># crm configure <br>
crm(live)configure# template <br>
crm(live)configure template# list templates <br>
apache filesystem virtual-ip <br>
crm(live)configure template# new web &lt;TAB&gt;&lt;TAB&gt;
<br>
apache filesystem virtual-ip <br>
crm(live)configure template# new web apache <br>
INFO: pulling in template apache <br>
INFO: pulling in template virtual-ip <br>
crm(live)configure template# list <br>
web2-d web2 vip2 web3 vip web</p>

<p style="margin-top: 1em">We enter the template level from
configure. Use the list command to show templates available
on the system. The new command creates a configuration from
the apache template. You <br>
can use tab completion to pick templates. Note that the
apache template depends on a virtual IP address which is
automatically pulled along. The list command shows the just
<br>
created web configuration, among other configurations (I
hope that you, unlike me, will use more sensible and
descriptive names).</p>

<p style="margin-top: 1em">The show command, which displays
the resulting configuration, may be used to get an idea
about the minimum required changes which have to be done.
All ERROR messages show the <br>
line numbers in which the respective parameters are to be
defined:</p>

<p style="margin-top: 1em">crm(live)configure template#
show <br>
ERROR: 23: required parameter ip not set <br>
ERROR: 61: required parameter id not set <br>
ERROR: 65: required parameter configfile not set <br>
crm(live)configure template# edit</p>

<p style="margin-top: 1em">The edit command invokes the
preferred text editor with the web configuration. At the top
of the file, the user is advised how to make changes. A good
template should require <br>
from the user to specify only parameters. For example, the
web configuration we created above has the following
required and optional parameters (all parameter lines start
with <br>
%%):</p>

<p style="margin-top: 1em">$ grep -n ^%% ~/.crmconf/web
<br>
23:%% ip <br>
31:%% netmask <br>
35:%% lvs_support <br>
61:%% id <br>
65:%% configfile <br>
71:%% options <br>
76:%% envfiles</p>

<p style="margin-top: 1em">These lines are the only ones
that should be modified. Simply append the parameter value
at the end of the line. For instance, after editing this
template, the result could look <br>
like this (we used tabs instead of spaces to make the values
stand out):</p>

<p style="margin-top: 1em">$ grep -n ^%% ~/.crmconf/web
<br>
23:%% ip 192.168.1.101 <br>
31:%% netmask <br>
35:%% lvs_support <br>
61:%% id websvc <br>
65:%% configfile /etc/apache2/httpd.conf <br>
71:%% options <br>
76:%% envfiles</p>

<p style="margin-top: 1em">As you can see, the parameter
line format is very simple:</p>

<p style="margin-top: 1em">%% &lt;name&gt;
&lt;value&gt;</p>

<p style="margin-top: 1em">After editing the file, use show
again to display the configuration:</p>

<p style="margin-top: 1em">crm(live)configure template#
show <br>
primitive virtual-ip IPaddr params ip=192.168.1.101 <br>
primitive apache apache params
configfile=&quot;/etc/apache2/httpd.conf&quot; <br>
monitor apache 120s:60s <br>
group websvc apache virtual-ip</p>

<p style="margin-top: 1em">The target resource of the
apache template is a group which we named websvc in this
sample session.</p>

<p style="margin-top: 1em">This configuration looks exactly
as you could type it at the configure level. The point of
templates is to save you some typing. It is important,
however, to understand the <br>
configuration produced.</p>

<p style="margin-top: 1em">Finally, the configuration may
be applied to the current crm configuration (note how the
configuration changed slightly, though it is still
equivalent, after being digested at <br>
the configure level):</p>

<p style="margin-top: 1em">crm(live)configure template#
apply <br>
crm(live)configure template# cd .. <br>
crm(live)configure# show <br>
node xen-b <br>
node xen-c <br>
primitive apache apache params
configfile=&quot;/etc/apache2/httpd.conf&quot; op monitor
interval=120s timeout=60s <br>
primitive virtual-ip IPaddr params ip=192.168.1.101 <br>
group websvc apache virtual-ip</p>

<p style="margin-top: 1em">Note that this still does not
commit the configuration to the CIB which is used in the
shell, either the running one (live) or some shadow CIB. For
that you still need to execute <br>
the commit command.</p>

<p style="margin-top: 1em">To complete our example, we
should also define the preferred node to run the
service:</p>

<p style="margin-top: 1em">crm(live)configure# location
websvc-pref websvc 100: xen-b</p>

<p style="margin-top: 1em">If you are not happy with some
resource names which are provided by default, you can rename
them now:</p>

<p style="margin-top: 1em">crm(live)configure# rename
virtual-ip intranet-ip <br>
crm(live)configure# show <br>
node xen-b <br>
node xen-c <br>
primitive apache apache params
configfile=&quot;/etc/apache2/httpd.conf&quot; op monitor
interval=120s timeout=60s <br>
primitive intranet-ip IPaddr params ip=192.168.1.101 <br>
group websvc apache intranet-ip <br>
location websvc-pref websvc 100: xen-b</p>

<p style="margin-top: 1em">To summarize, working with
templates typically consists of the following steps:</p>

<p style="margin-top: 1em">&Acirc;&middot; new: create a
new configuration from templates</p>

<p style="margin-top: 1em">&Acirc;&middot; edit: define
parameters, at least the required ones</p>

<p style="margin-top: 1em">&Acirc;&middot; show: see if the
configuration is valid</p>

<p style="margin-top: 1em">&Acirc;&middot; apply: apply the
configuration to the configure level</p>

<p style="margin-top: 1em">Resource testing <br>
The amount of detail in a cluster makes all configurations
prone to errors. By far the largest number of issues in a
cluster is due to bad resource configuration. The shell can
<br>
help quickly diagnose such problems. And considerably reduce
your keyboard wear.</p>

<p style="margin-top: 1em">Let&acirc;s say that we entered
the following configuration:</p>

<p style="margin-top: 1em">node xen-b <br>
node xen-c <br>
node xen-d <br>
primitive fencer stonith:external/libvirt params
hypervisor_uri=&quot;qemu+tcp://10.2.13.1/system&quot;
hostlist=&quot;xen-b xen-c xen-d&quot; op monitor
interval=2h <br>
primitive svc Xinetd params service=systat op monitor
interval=30s <br>
primitive intranet-ip IPaddr2 params ip=10.2.13.100 op
monitor interval=30s <br>
primitive apache apache params
configfile=&quot;/etc/apache2/httpd.conf&quot; op monitor
interval=120s timeout=60s <br>
group websvc apache intranet-ip <br>
location websvc-pref websvc 100: xen-b</p>

<p style="margin-top: 1em">Before typing commit to submit
the configuration to the cib we can make sure that all
resources are usable on all nodes:</p>

<p style="margin-top: 1em">crm(live)configure# rsctest
websvc svc fencer</p>

<p style="margin-top: 1em">It is important that resources
being tested are not running on any nodes. Otherwise, the
rsctest command will refuse to do anything. Of course, if
the current configuration <br>
resides in a CIB shadow, then a commit is irrelevant. The
point being that resources are not running on any node. Note
on stopping all resources</p>

<p style="margin-top: 1em">Alternatively to not committing
a configuration, it is also possible to tell Pacemaker not
to start any resources:</p>

<p style="margin-top: 1em">crm(live)configure# property
stop-all-resources=yes</p>

<p style="margin-top: 1em">Almost none---resources of class
stonith are still started. But shell is not as strict when
it comes to stonith resources.</p>

<p style="margin-top: 1em">Order of resources is
significant insofar that a resource depends on all resources
to its left. In most configurations, it&acirc;s probably
practical to test resources in several runs, <br>
based on their dependencies.</p>

<p style="margin-top: 1em">Apart from groups, crm does not
interpret constraints and therefore knows nothing about
resource dependencies. It also doesn&acirc;t know if a
resource can run on a node at all in case <br>
of an asymmetric cluster. It is up to the user to specify a
list of eligible nodes if a resource is not meant to run on
every node.</p>

<p style="margin-top: 1em">Access Control Lists (ACL) <br>
Note on ACLs in Pacemaker 1.1.12</p>

<p style="margin-top: 1em">The support for ACLs has been
revised in Pacemaker version 1.1.12 and up. Depending on
which version you are using, the information in this section
may no longer be accurate. <br>
Look for the acl_target configuration element for more
details on the new syntax.</p>

<p style="margin-top: 1em">By default, the users from the
haclient group have full access to the cluster (or, more
precisely, to the CIB). Access control lists allow for finer
access control to the <br>
cluster.</p>

<p style="margin-top: 1em">Access control lists consist of
an ordered set of access rules. Each rule allows read or
write access or denies access completely. Rules are
typically combined to produce a <br>
specific role. Then, users may be assigned a role.</p>

<p style="margin-top: 1em">For instance, this is a role
which defines a set of rules allowing management of a single
resource:</p>

<p style="margin-top: 1em">role bigdb_admin write
meta:bigdb:target-role write meta:bigdb:is-managed write
location:bigdb read ref:bigdb</p>

<p style="margin-top: 1em">The first two rules allow
modifying the target-role and is-managed meta attributes
which effectively enables users in this role to stop/start
and manage/unmanage the resource. <br>
The constraints write access rule allows moving the resource
around. Finally, the user is granted read access to the
resource definition.</p>

<p style="margin-top: 1em">For proper operation of all
Pacemaker programs, it is advisable to add the following
role to all users:</p>

<p style="margin-top: 1em">role read_all read cib</p>

<p style="margin-top: 1em">For finer grained read access
try with the rules listed in the following role:</p>

<p style="margin-top: 1em">role basic_read read node
attribute:uname read node attribute:type read property read
status</p>

<p style="margin-top: 1em">It is however possible that some
Pacemaker programs (e.g. ptest) may not function correctly
if the whole CIB is not readable.</p>

<p style="margin-top: 1em">Some of the ACL rules in the
examples above are expanded by the shell to XPath
specifications. For instance, meta:bigdb:target-role expands
to:</p>


<p style="margin-top: 1em">//primitive[@id=&rsquo;bigdb&rsquo;]/meta_attributes/nvpair[@name=&rsquo;target-role&rsquo;]</p>

<p style="margin-top: 1em">You can see the expansion by
showing XML:</p>

<p style="margin-top: 1em">crm(live) configure# show xml
bigdb_admin <br>
... <br>
&lt;acls&gt; <br>
&lt;acl_role id=&quot;bigdb_admin&quot;&gt; <br>
&lt;write id=&quot;bigdb_admin-write&quot; <br>

xpath=&quot;//primitive[@id=&rsquo;bigdb&rsquo;]/meta_attributes/nvpair[@name=&rsquo;target-role&rsquo;]&quot;/&gt;</p>

<p style="margin-top: 1em">Many different XPath expressions
can have equal meaning. For instance, the following two are
equal, but only the first one is going to be recognized as
shortcut:</p>


<p style="margin-top: 1em">//primitive[@id=&rsquo;bigdb&rsquo;]/meta_attributes/nvpair[@name=&rsquo;target-role&rsquo;]
<br>

//resources/primitive[@id=&rsquo;bigdb&rsquo;]/meta_attributes/nvpair[@name=&rsquo;target-role&rsquo;]</p>

<p style="margin-top: 1em">XPath is a powerful language,
but you should try to keep your ACL xpaths simple and the
builtin shortcuts should be used whenever possible.</p>

<p style="margin-top: 1em">Syntax: Resource sets <br>
Using resource sets can be a bit confusing unless one knows
the details of the implementation in Pacemaker as well as
how to interpret the syntax provided by crmsh.</p>

<p style="margin-top: 1em">Three different types of
resource sets are provided by crmsh, and each one implies
different values for the two resource set attributes,
sequential and require-all.</p>

<p style="margin-top: 1em">sequential <br>
If false, the resources in the set do not depend on each
other internally. Setting sequential to true implies a
strict order of dependency within the set.</p>

<p style="margin-top: 1em">require-all <br>
If false, only one resource in the set is required to fulfil
the requirements of the set. The set of A, B and C with
require-all set to false is be read as &quot;A OR B OR
C&quot; when <br>
its dependencies are resolved.</p>

<p style="margin-top: 1em">The three types of resource sets
modify the attributes in the following way:</p>

<p style="margin-top: 1em">1. Implicit sets (no brackets).
sequential=true, require-all=true</p>

<p style="margin-top: 1em">2. Parenthesis set (( ... )).
sequential=false, require-all=true</p>

<p style="margin-top: 1em">3. Bracket set ([ ... ]).
sequential=false, require-all=false</p>

<p style="margin-top: 1em">To create a set with the
properties sequential=true and require-all=false, explicitly
set sequential in a bracketed set, [ A B C sequential=true
].</p>

<p style="margin-top: 1em">To create multiple sets with
both sequential and require-all set to true, explicitly set
sequential in a parenthesis set: A B ( C D sequential=true
).</p>

<p style="margin-top: 1em">Syntax: Attribute list
references <br>
Attribute lists are used to set attributes and parameters
for resources, constraints and property definitions. For
example, to set the virtual IP used by an IPAddr2 resource
the <br>
attribute ip can be set in an attribute list for that
resource.</p>

<p style="margin-top: 1em">Attribute lists can have
identifiers that name them, and other resources can reuse
the same attribute list by referring to that name using an
$id-ref. For example, the following <br>
statement defines a simple dummy resource with an attribute
list which sets the parameter state to the value 1 and sets
the identifier for the attribute list to on-state:</p>

<p style="margin-top: 1em">primitive dummy-1 Dummy params
$id=on-state state=1</p>

<p style="margin-top: 1em">To refer to this attribute list
from a different resource, refer to the on-state name using
an id-ref:</p>

<p style="margin-top: 1em">primitive dummy-2 Dummy params
$id-ref=on-state</p>

<p style="margin-top: 1em">The resource dummy-2 will now
also have the parameter state set to the value 1.</p>

<p style="margin-top: 1em">Syntax: Attribute references
<br>
In some cases, referencing complete attribute lists is too
coarse-grained, for example if two different parameters with
different names should have the same value set. Instead of
<br>
having to copy the value in multiple places, it is possible
to create references to individual attributes in attribute
lists.</p>

<p style="margin-top: 1em">To name an attribute in order to
be able to refer to it later, prefix the attribute name with
a $ character (as seen above with the special names $id and
$id-ref:</p>

<p style="margin-top: 1em">primitive dummy-1 Dummy params
$state=1</p>

<p style="margin-top: 1em">The identifier state can now be
used to refer to this attribute from other primitives, using
the @&lt;id&gt; syntax:</p>

<p style="margin-top: 1em">primitive dummy-2 Dummy params
@state</p>

<p style="margin-top: 1em">In some cases, using the
attribute name as the identifier doesn&acirc;t work due to
name clashes. In this case, the syntax
$&lt;id&gt;:&lt;name&gt;=&lt;value&gt; can be used to give
the attribute a <br>
different identifier:</p>

<p style="margin-top: 1em">primitive dummy-1 params
$dummy-state-on:state=1 <br>
primitive dummy-2 params @dummy-state-on</p>

<p style="margin-top: 1em">There is also the possibility
that two resources both use the same attribute value but
with different names. For example, a web server may have a
parameter server_ip for setting <br>
the IP address where it listens for incoming requests, and a
virtual IP resource may have a parameter called ip which
sets the IP address it creates. To configure these two <br>
resources with an IP without repeating the value, the
reference can be given a name using the syntax
@&lt;id&gt;:&lt;name&gt;.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">primitive virtual-ip IPaddr2
params $vip:ip=192.168.1.100 <br>
primitive webserver apache params @vip:server_ip</p>

<p style="margin-top: 1em">Syntax: Rule expressions <br>
Many of the configuration commands in crmsh now support the
use of rule expressions, which can influence what attributes
apply to a resource or under which conditions a <br>
constraint is applied, depending on changing conditions like
date, time, the value of attributes and more.</p>

<p style="margin-top: 1em">Here is an example of a simple
rule expression used to apply a a different resource
parameter on the node named node1:</p>

<p style="margin-top: 1em">primitive my_resource Special
params 2: rule #uname eq node1 interface=eth1 params 1:
interface=eth0</p>

<p style="margin-top: 1em">This primitive resource has two
lists of parameters with descending priority. The parameter
list with the highest priority is applied first, but only if
the rule expressions for <br>
that parameter list all apply. In this case, the rule #uname
eq node1 limits the parameter list so that it is only
applied on node1.</p>

<p style="margin-top: 1em">Note that rule expressions are
not terminated and are immediately followed by the data to
which the rule is applied. In this case, the name-value pair
interface=eth1.</p>

<p style="margin-top: 1em">Rule expressions can contain
multiple expressions connected using the boolean operator or
and and. The full syntax for rule expressions is listed
below.</p>

<p style="margin-top: 1em">rules :: <br>
rule [id_spec] [$role=&lt;role&gt;] &lt;score&gt;:
&lt;expression&gt; <br>
[rule [id_spec] [$role=&lt;role&gt;] &lt;score&gt;:
&lt;expression&gt; ...]</p>

<p style="margin-top: 1em">id_spec :: $id=&lt;id&gt; |
$id-ref=&lt;id&gt; <br>
score :: &lt;number&gt; | &lt;attribute&gt; | [-]inf <br>
expression :: &lt;simple_exp&gt; [&lt;bool_op&gt;
&lt;simple_exp&gt; ...] <br>
bool_op :: or | and <br>
simple_exp :: &lt;attribute&gt; [type:]&lt;binary_op&gt;
&lt;value&gt; <br>
| &lt;unary_op&gt; &lt;attribute&gt; <br>
| date &lt;date_expr&gt; <br>
type :: &lt;string&gt; | &lt;version&gt; | &lt;number&gt;
<br>
binary_op :: lt | gt | lte | gte | eq | ne <br>
unary_op :: defined | not_defined</p>

<p style="margin-top: 1em">date_expr :: lt &lt;end&gt; <br>
| gt &lt;start&gt; <br>
| in start=&lt;start&gt; end=&lt;end&gt; <br>
| in start=&lt;start&gt; &lt;duration&gt; <br>
| spec &lt;date_spec&gt; <br>
duration|date_spec :: <br>
hours=&lt;value&gt; <br>
| monthdays=&lt;value&gt; <br>
| weekdays=&lt;value&gt; <br>
| yearsdays=&lt;value&gt; <br>
| months=&lt;value&gt; <br>
| weeks=&lt;value&gt; <br>
| years=&lt;value&gt; <br>
| weekyears=&lt;value&gt; <br>
| moon=&lt;value&gt;</p>

<p style="margin-top: 1em">COMMAND REFERENCE <br>
The commands are structured to be compatible with the shell
command line. Sometimes, the underlying Pacemaker grammar
uses characters that have special meaning in bash, that will
<br>
need to be quoted. This includes the hash or pound sign (#),
single and double quotes, and any significant
whitespace.</p>

<p style="margin-top: 1em">Whitespace is also significant
when assigning values, meaning that key=value is different
from key = value.</p>

<p style="margin-top: 1em">Commands can be referenced using
short-hand as long as the short-hand is unique. This can be
either a prefix of the command name or a prefix string of
characters found in the <br>
name.</p>

<p style="margin-top: 1em">For example, status can be
abbreviated as st or su, and configure as conf or cfg.</p>

<p style="margin-top: 1em">The syntax for the commands is
given below in an informal, BNF-like grammar.</p>

<p style="margin-top: 1em">&Acirc;&middot; &lt;value&gt;
denotes a string.</p>

<p style="margin-top: 1em">&Acirc;&middot; [value] means
that the construct is optional.</p>

<p style="margin-top: 1em">&Acirc;&middot; The ellipsis
(...) signifies that the previous construct may be
repeated.</p>

<p style="margin-top: 1em">&Acirc;&middot; first|second
means either first or second.</p>

<p style="margin-top: 1em">&Acirc;&middot; The rest are
literals (strings, :, =).</p>

<p style="margin-top: 1em">status <br>
Show cluster status. The status is displayed by crm_mon.
Supply additional arguments for more information or
different format. See crm_mon(8) for more details.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">status <br>
status simple <br>
status full</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">status [&lt;option&gt; ...]</p>

<p style="margin-top: 1em">option :: full <br>
| bynode <br>
| inactive <br>
| ops <br>
| timing <br>
| failcounts <br>
| verbose <br>
| quiet <br>
| html <br>
| xml <br>
| simple <br>
| tickets <br>
| noheaders <br>
| detail <br>
| brief</p>

<p style="margin-top: 1em">verify <br>
Performs basic checks for the cluster configuration and
current status, reporting potential issues.</p>

<p style="margin-top: 1em">See crm_verify(8) and
crm_simulate(8) for more details.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">verify <br>
verify scores</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">verify [scores]</p>

<p style="margin-top: 1em">cluster - Cluster setup and
management <br>
Whole-cluster configuration management with High
Availability awareness.</p>

<p style="margin-top: 1em">The commands on the cluster
level allows configuration and modification of the
underlying cluster infrastructure, and also supplies tools
to do whole-cluster systems management.</p>

<p style="margin-top: 1em">These commands enable easy
installation and maintenance of a HA cluster, by providing
support for package installation, configuration of the
cluster messaging layer, file system <br>
setup and more.</p>

<p style="margin-top: 1em">add <br>
This command simplifies the process of adding a new node to
a running cluster. The new node will be installed and
configured with the packages and configuration files needed
<br>
to run the cluster resources. If a cluster file system is
used, the new node will be set up to host the file
system.</p>

<p style="margin-top: 1em">This command should be executed
from a node already in the cluster.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">add &lt;node&gt;</p>

<p style="margin-top: 1em">copy <br>
Copy file to other cluster nodes.</p>

<p style="margin-top: 1em">Copies the given file to all
other nodes unless given a list of nodes to copy to as
argument.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">copy &lt;filename&gt; [nodes
...]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">copy /etc/motd</p>

<p style="margin-top: 1em">diff <br>
Displays the difference, if any, between a given file on
different nodes. If the second argument is --checksum, a
checksum of the file will be calculated and displayed for
<br>
each node.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">diff &lt;file&gt; [--checksum]
[nodes...]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">diff /etc/crm/crm.conf node2
<br>
diff /etc/resolv.conf --checksum</p>

<p style="margin-top: 1em">health <br>
Runs a larger set of tests and queries on all nodes in the
cluster to verify the general system health and detect
potential problems.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">health</p>

<p style="margin-top: 1em">init <br>
Installs and configures a basic HA cluster on a set of
nodes.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">init node1 node2 node3 <br>
init --dry-run node1 node2 node3</p>

<p style="margin-top: 1em">remove <br>
This command simplifies the process of removing a node from
the cluster, moving any resources hosted by that node to
other nodes.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">remove &lt;node&gt;</p>

<p style="margin-top: 1em">run <br>
This command takes a shell statement as argument, executes
that statement on all nodes in the cluster, and reports the
result.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">run &lt;command&gt;</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">run &quot;cat
/proc/uptime&quot;</p>

<p style="margin-top: 1em">start <br>
Starts the cluster-related system services on this node.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">start</p>

<p style="margin-top: 1em">status <br>
Reports the status for the cluster messaging layer on the
local node.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">status</p>

<p style="margin-top: 1em">stop <br>
Stops the cluster-related system services on this node.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">stop</p>

<p style="margin-top: 1em">wait_for_startup <br>
Mostly useful in scripts or automated workflows, this
command will attempt to connect to the local cluster node
repeatedly. The command will keep trying until the cluster
<br>
node responds, or the timeout elapses. The timeout can be
changed by supplying a value in seconds as an argument.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">wait_for_startup</p>

<p style="margin-top: 1em">script - Cluster script
management <br>
A big part of the configuration and management of a cluster
is collecting information about all cluster nodes and
deploying changes to those nodes. Often, just performing the
<br>
same procedure on all nodes will encounter problems, due to
subtle differences in the configuration.</p>

<p style="margin-top: 1em">For example, when configuring a
cluster for the first time, the software needs to be
installed and configured on all nodes before the cluster
software can be launched and <br>
configured using crmsh. This process is cumbersome and
error-prone, and the goal is for scripts to make this
process easier.</p>

<p style="margin-top: 1em">Scripts are implemented using
the python parallax package which provides a thin wrapper on
top of SSH. This allows the scripts to function through the
usual SSH channels used for <br>
system maintenance, requiring no additional software to be
installed or maintained.</p>

<p style="margin-top: 1em">json <br>
This command provides a JSON API for the cluster scripts,
intended for use in user interface tools that want to
interact with the cluster via scripts.</p>

<p style="margin-top: 1em">The command takes a single
argument, which should be a JSON array with the first member
identifying the command to perform.</p>

<p style="margin-top: 1em">The output is line-based:
Commands that return multiple results will return them
line-by-line, ending with a terminator value:
&quot;end&quot;.</p>

<p style="margin-top: 1em">When providing parameter values
to this command, they should be provided as nested objects,
so virtual-ip:ip=192.168.0.5 on the command line becomes the
JSON object <br>

{&quot;virtual-ip&quot;:{&quot;ip&quot;:&quot;192.168.0.5&quot;}}.</p>

<p style="margin-top: 1em">API:</p>

<p style="margin-top: 1em">[&quot;list&quot;] <br>
=&gt; [{name, shortdesc, category}]</p>

<p style="margin-top: 1em">[&quot;show&quot;, &lt;name&gt;]
<br>
=&gt; [{name, shortdesc, longdesc, category,
&lt;&lt;steps&gt;&gt;}]</p>

<p style="margin-top: 1em">&lt;&lt;steps&gt;&gt; := [{name,
shortdesc], longdesc, required, parameters, steps}]</p>

<p style="margin-top: 1em">&lt;&lt;params&gt;&gt; :=
[{name, shortdesc, longdesc, required, unique, advanced,
<br>
type, value, example}]</p>

<p style="margin-top: 1em">[&quot;verify&quot;,
&lt;name&gt;, &lt;&lt;values&gt;&gt;] <br>
=&gt; [{shortdesc, longdesc, text, nodes}]</p>

<p style="margin-top: 1em">[&quot;run&quot;, &lt;name&gt;,
&lt;&lt;values&gt;&gt;] <br>
=&gt; [{shortdesc, rc, output|error}]</p>

<p style="margin-top: 1em">list <br>
Lists the available scripts, sorted by category. Scripts
that have the special Script category are hidden by default,
since they are mainly used by other scripts or commands.
<br>
To also show these, pass all as argument.</p>

<p style="margin-top: 1em">To get a flat list of script
names, not sorted by category, pass names as an extra
argument.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">list [all] [names]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">list <br>
list all names</p>

<p style="margin-top: 1em">run <br>
Given a list of parameter values, this command will execute
the actions specified by the cluster script. The format for
the parameter values is the same as for the verify <br>
command.</p>

<p style="margin-top: 1em">Can optionally take at least two
parameters: * nodes=&lt;nodes&gt;: List of nodes that the
script runs over * dry_run=yes|no: If set, the script will
not perform any modifications.</p>

<p style="margin-top: 1em">Additional parameters may be
available depending on the script.</p>

<p style="margin-top: 1em">Use the show command to see what
parameters are available.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">run &lt;script&gt; [args...]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">run apache install=true <br>
run sbd id=sbd-1 node=node1
sbd_device=/dev/disk/by-uuid/F00D-CAFE</p>

<p style="margin-top: 1em">show <br>
Prints a description and short summary of the script, with
descriptions of the accepted parameters.</p>

<p style="margin-top: 1em">Advanced parameters are hidden
by default. To show the complete list of parameters accepted
by the script, pass all as argument.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">show &lt;script&gt; [all]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">show virtual-ip</p>

<p style="margin-top: 1em">verify <br>
Checks the given parameter values, and returns a list of
actions that will be executed when running the script if
provided the same list of parameter values.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">verify &lt;script&gt;
[args...]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">verify sbd id=sbd-1 node=node1
sbd_device=/dev/disk/by-uuid/F00D-CAFE</p>

<p style="margin-top: 1em">corosync - Corosync management
<br>
Corosync is the underlying messaging layer for most HA
clusters. This level provides commands for editing and
managing the corosync configuration.</p>

<p style="margin-top: 1em">add-node <br>
Adds a node to the corosync configuration. This is used with
the udpu type configuration in corosync.</p>

<p style="margin-top: 1em">A nodeid for the added node is
generated automatically.</p>

<p style="margin-top: 1em">Note that this command assumes
that only a single ring is used, and sets only the address
for ring0.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">add-node &lt;addr&gt; [name]</p>

<p style="margin-top: 1em">del-node <br>
Removes a node from the corosync configuration. The argument
given is the ring0_addr address set in the configuration
file.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">del-node &lt;addr&gt;</p>

<p style="margin-top: 1em">diff <br>
Diffs the corosync configurations on different nodes. If no
nodes are given as arguments, the corosync configurations on
all nodes in the cluster are compared.</p>

<p style="margin-top: 1em">diff takes an option argument
--checksum, to display a checksum for each file instead of
calculating a diff.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">diff [--checksum] [node...]</p>

<p style="margin-top: 1em">edit <br>
Opens the Corosync configuration file in an editor.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">edit</p>

<p style="margin-top: 1em">get <br>
Returns the value configured in corosync.conf, which is not
necessarily the value used in the running configuration. See
reload for telling corosync about configuration <br>
changes.</p>

<p style="margin-top: 1em">The argument is the complete
dot-separated path to the value.</p>

<p style="margin-top: 1em">If there are multiple values
configured with the same path, the command returns all
values for that path. For example, to get all configured
ring0_addr values, use this <br>
command:</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">get nodelist.node.ring0_addr</p>

<p style="margin-top: 1em">log <br>
Opens the log file specified in the corosync configuration
file. If no log file is configured, this command returns an
error.</p>

<p style="margin-top: 1em">The pager used can be configured
either using the PAGER environment variable or in
crm.conf.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">log</p>

<p style="margin-top: 1em">pull <br>
Gets the corosync configuration from another node and copies
it to this node.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">pull &lt;node&gt;</p>

<p style="margin-top: 1em">push <br>
Pushes the corosync configuration file on this node to the
list of nodes provided. If no target nodes are given, the
configuration is pushed to all other nodes in the <br>
cluster.</p>

<p style="margin-top: 1em">It is recommended to use csync2
to distribute the cluster configuration files rather than
relying on this command.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">push [node] ...</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">push node-2 node-3</p>

<p style="margin-top: 1em">reload <br>
Tells all instances of corosync in this cluster to reload
corosync.conf.</p>

<p style="margin-top: 1em">After pushing a new
configuration to all cluster nodes, call this command to
make corosync use the new configuration.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">reload</p>

<p style="margin-top: 1em">set <br>
Sets the value identified by the given path. If the value
does not exist in the configuration file, it will be added.
However, if the section containing the value does not <br>
exist, the command will fail.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">set quorum.expected_votes 2</p>

<p style="margin-top: 1em">show <br>
Displays the corosync configuration on the current node.</p>

<p style="margin-top: 1em">show</p>

<p style="margin-top: 1em">status <br>
Displays the status of Corosync, including the votequorum
state.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">status</p>

<p style="margin-top: 1em">cib - CIB shadow management <br>
This level is for management of shadow CIBs. It is available
both at the top level and the configure level.</p>

<p style="margin-top: 1em">All the commands are implemented
using cib_shadow(8) and the CIB_shadow environment variable.
The user prompt always includes the name of the currently
active shadow or the live <br>
CIB.</p>

<p style="margin-top: 1em">cibstatus <br>
Enter edit and manage the CIB status section level. See the
CIB status management section.</p>

<p style="margin-top: 1em">commit <br>
Apply a shadow CIB to the cluster. If the shadow name is
omitted then the current shadow CIB is applied.</p>

<p style="margin-top: 1em">Temporary shadow CIBs are
removed automatically on commit.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">commit [&lt;cib&gt;]</p>

<p style="margin-top: 1em">delete <br>
Delete an existing shadow CIB.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">delete &lt;cib&gt;</p>

<p style="margin-top: 1em">diff <br>
Print differences between the current cluster configuration
and the active shadow CIB.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">diff</p>

<p style="margin-top: 1em">import <br>
At times it may be useful to create a shadow file from the
existing CIB. The CIB may be specified as file or as a PE
input file number. The shell will look up files in the <br>
local directory first and then in the PE directory
(typically /var/lib/pengine). Once the CIB file is found, it
is copied to a shadow and this shadow is immediately
available <br>
for use at both configure and cibstatus levels.</p>

<p style="margin-top: 1em">If the shadow name is omitted
then the target shadow is named after the input CIB
file.</p>

<p style="margin-top: 1em">Note that there are often more
than one PE input file, so you may need to specify the full
name.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">import
{&lt;file&gt;|&lt;number&gt;} [&lt;shadow&gt;]</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">import pe-warn-2222 <br>
import 2289 issue2</p>

<p style="margin-top: 1em">list <br>
List existing shadow CIBs.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">list</p>

<p style="margin-top: 1em">new <br>
Create a new shadow CIB. The live cluster configuration and
status is copied to the shadow CIB.</p>

<p style="margin-top: 1em">If the name of the shadow is
omitted, we create a temporary CIB shadow. It is useful if
multiple level sessions are desired without affecting the
cluster. A temporary CIB <br>
shadow is short lived and will be removed either on commit
or on program exit. Note that if the temporary shadow is not
committed all changes in the temporary shadow are <br>
lost.</p>

<p style="margin-top: 1em">Specify withstatus if you want
to edit the status section of the shadow CIB (see the
cibstatus section). Add force to force overwriting the
existing shadow CIB.</p>

<p style="margin-top: 1em">To start with an empty
configuration that is not copied from the live CIB, specify
the empty keyword. (This also allows a shadow CIB to be
created in case no cluster is <br>
running.)</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">new [&lt;cib&gt;] [withstatus]
[force] [empty]</p>

<p style="margin-top: 1em">reset <br>
Copy the current cluster configuration into the shadow
CIB.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">reset &lt;cib&gt;</p>

<p style="margin-top: 1em">use <br>
Choose a CIB source. If you want to edit the status from the
shadow CIB specify withstatus (see cibstatus). Leave out the
CIB name to switch to the running CIB.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">use [&lt;cib&gt;]
[withstatus]</p>

<p style="margin-top: 1em">ra - Resource Agents (RA) lists
and documentation <br>
This level contains commands which show various information
about the installed resource agents. It is available both at
the top level and at the configure level.</p>

<p style="margin-top: 1em">classes <br>
Print all resource agents&rsquo; classes and, where
appropriate, a list of available providers.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">classes</p>

<p style="margin-top: 1em">info (meta) <br>
Show the meta-data of a resource agent type. This is where
users can find information on how to use a resource agent.
It is also possible to get information from some <br>
programs: pengine, crmd, cib, and stonithd. Just specify the
program name instead of an RA.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">info
[&lt;class&gt;:[&lt;provider&gt;:]]&lt;type&gt; <br>
info &lt;type&gt; &lt;class&gt; [&lt;provider&gt;]
(obsolete)</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">info apache <br>
info ocf:pacemaker:Dummy <br>
info stonith:ipmilan <br>
info pengine</p>

<p style="margin-top: 1em">list <br>
List available resource agents for the given class. If the
class is ocf, supply a provider to get agents which are
available only from that provider.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">list &lt;class&gt;
[&lt;provider&gt;]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">list ocf pacemaker</p>

<p style="margin-top: 1em">providers <br>
List providers for a resource agent type. The class
parameter defaults to ocf.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">providers &lt;type&gt;
[&lt;class&gt;]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">providers apache</p>

<p style="margin-top: 1em">validate <br>
If the resource agent supports the validate-all action, this
calls the action with the given parameters, printing any
warnings or errors reported by the agent.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">validate &lt;agent&gt;
[&lt;key&gt;=&lt;value&gt; ...]</p>

<p style="margin-top: 1em">resource - Resource management
<br>
At this level resources may be managed.</p>

<p style="margin-top: 1em">All (or almost all) commands are
implemented with the CRM tools such as crm_resource(8).</p>

<p style="margin-top: 1em">ban <br>
Ban a resource from running on a certain node. If no node is
given as argument, the resource is banned from the current
location.</p>

<p style="margin-top: 1em">See move for details on other
arguments.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">ban &lt;rsc&gt; [&lt;node&gt;]
[&lt;lifetime&gt;] [force]</p>

<p style="margin-top: 1em">cleanup <br>
Cleanup resource status. Typically done after the resource
has temporarily failed. If a node is omitted, cleanup on all
nodes. If there are many nodes, the command may take a <br>
while.</p>

<p style="margin-top: 1em">(Pacemaker 1.1.14) Pass force to
cleanup the resource itself, otherwise the cleanup command
will apply to the parent resource (if any).</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">cleanup &lt;rsc&gt;
[&lt;node&gt;] [force]</p>

<p style="margin-top: 1em">clear (unmove, unmigrate, unban)
<br>
Remove any relocation constraint created by the move,
migrate or ban command.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">clear &lt;rsc&gt; <br>
unmigrate &lt;rsc&gt; <br>
unban &lt;rsc&gt;</p>

<p style="margin-top: 1em">constraints <br>
Display the location and colocation constraints affecting
the resource.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">constraints &lt;rsc&gt;</p>

<p style="margin-top: 1em">demote <br>
Demote a master-slave resource using the target-role
attribute.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">demote &lt;rsc&gt;</p>

<p style="margin-top: 1em">failcount <br>
Show/edit/delete the failcount of a resource.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">failcount &lt;rsc&gt; set
&lt;node&gt; &lt;value&gt; <br>
failcount &lt;rsc&gt; delete &lt;node&gt; <br>
failcount &lt;rsc&gt; show &lt;node&gt;</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">failcount fs_0 delete node2</p>

<p style="margin-top: 1em">locate <br>
Show the current location of one or more resources.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">locate [&lt;rsc&gt; ...]</p>

<p style="margin-top: 1em">maintenance <br>
Enables or disables the per-resource maintenance mode. When
this mode is enabled, no monitor operations will be
triggered for the resource.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">maintenance &lt;resource&gt;
[on|off|true|false]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">maintenance rsc1 <br>
maintenance rsc2 off</p>

<p style="margin-top: 1em">manage <br>
Manage a resource using the is-managed attribute. If there
are multiple meta attributes sets, the attribute is set in
all of them. If the resource is a clone, all is-managed <br>
attributes are removed from the children resources.</p>

<p style="margin-top: 1em">For details on group management
see options manage-children.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">manage &lt;rsc&gt;</p>

<p style="margin-top: 1em">meta <br>
Show/edit/delete a meta attribute of a resource. Currently,
all meta attributes of a resource may be managed with other
commands such as resource stop.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">meta &lt;rsc&gt; set
&lt;attr&gt; &lt;value&gt; <br>
meta &lt;rsc&gt; delete &lt;attr&gt; <br>
meta &lt;rsc&gt; show &lt;attr&gt;</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">meta ip_0 set target-role
stopped</p>

<p style="margin-top: 1em">move (migrate) <br>
Move a resource away from its current location.</p>

<p style="margin-top: 1em">If the destination node is left
out, the resource is migrated by creating a constraint which
prevents it from running on the current node. For this type
of constraint to be <br>
created, the force argument is required.</p>

<p style="margin-top: 1em">A lifetime may be given for the
constraint. Once it expires, the location constraint will no
longer be active.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">move &lt;rsc&gt; [&lt;node&gt;]
[&lt;lifetime&gt;] [force]</p>

<p style="margin-top: 1em">operations <br>
Show active operations, optionally filtered by resource and
node.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">operations [&lt;rsc&gt;]
[&lt;node&gt;]</p>

<p style="margin-top: 1em">param <br>
Show/edit/delete a parameter of a resource.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">param &lt;rsc&gt; set
&lt;param&gt; &lt;value&gt; <br>
param &lt;rsc&gt; delete &lt;param&gt; <br>
param &lt;rsc&gt; show &lt;param&gt;</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">param ip_0 show ip</p>

<p style="margin-top: 1em">promote <br>
Promote a master-slave resource using the target-role
attribute.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">promote &lt;rsc&gt;</p>

<p style="margin-top: 1em">refresh <br>
Refresh CIB from the LRM status. Note</p>

<p style="margin-top: 1em">refresh has been deprecated and
is now an alias for cleanup.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">refresh [&lt;node&gt;]</p>

<p style="margin-top: 1em">reprobe <br>
Probe for resources not started by the CRM. Note</p>

<p style="margin-top: 1em">reprobe has been deprecated and
is now an alias for cleanup.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">reprobe [&lt;node&gt;]</p>

<p style="margin-top: 1em">restart <br>
Restart one or more resources. This is essentially a
shortcut for resource stop followed by a start. The shell is
first going to wait for the stop to finish, that is for all
<br>
resources to really stop, and only then to order the start
action. Due to this command entailing a whole set of
operations, informational messages are printed to let the
user <br>
see some progress.</p>

<p style="margin-top: 1em">For details on group management
see options manage-children.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">restart &lt;rsc&gt; [&lt;rsc&gt;
...]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em"># crm resource restart
g_webserver <br>
INFO: ordering g_webserver to stop <br>
waiting for stop to finish .... done <br>
INFO: ordering g_webserver to start <br>
#</p>

<p style="margin-top: 1em">scores <br>
Display the allocation scores for all resources.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">scores</p>

<p style="margin-top: 1em">secret <br>
Sensitive parameters can be kept in local files rather than
CIB in order to prevent accidental data exposure. Use the
secret command to manage such parameters. stash and <br>
unstash move the value from the CIB and back to the CIB
respectively. The set subcommand sets the parameter to the
provided value. delete removes the parameter completely.
<br>
show displays the value of the parameter from the local
file. Use check to verify if the local file content is
valid.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">secret &lt;rsc&gt; set
&lt;param&gt; &lt;value&gt; <br>
secret &lt;rsc&gt; stash &lt;param&gt; <br>
secret &lt;rsc&gt; unstash &lt;param&gt; <br>
secret &lt;rsc&gt; delete &lt;param&gt; <br>
secret &lt;rsc&gt; show &lt;param&gt; <br>
secret &lt;rsc&gt; check &lt;param&gt;</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">secret fence_1 show password
<br>
secret fence_1 stash password <br>
secret fence_1 set password secret_value</p>

<p style="margin-top: 1em">start <br>
Start one or more resources by setting the target-role
attribute. If there are multiple meta attributes sets, the
attribute is set in all of them. If the resource is a clone,
<br>
all target-role attributes are removed from the children
resources.</p>

<p style="margin-top: 1em">For details on group management
see options manage-children.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">start &lt;rsc&gt; [&lt;rsc&gt;
...]</p>

<p style="margin-top: 1em">status (show, list) <br>
Print resource status. More than one resource can be shown
at once. If the resource parameter is left out, the status
of all resources is printed.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">status [&lt;rsc&gt; ...]</p>

<p style="margin-top: 1em">stop <br>
Stop one or more resources using the target-role attribute.
If there are multiple meta attributes sets, the attribute is
set in all of them. If the resource is a clone, all <br>
target-role attributes are removed from the children
resources.</p>

<p style="margin-top: 1em">For details on group management
see options manage-children.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">stop &lt;rsc&gt; [&lt;rsc&gt;
...]</p>

<p style="margin-top: 1em">trace <br>
Start tracing RA for the given operation. The trace files
are stored in $HA_VARLIB/trace_ra. If the operation to be
traced is monitor, note that the number of trace files can
<br>
grow very quickly.</p>

<p style="margin-top: 1em">If no operation name is given,
crmsh will attempt to trace all operations for the RA. This
includes any configured operations, start and stop as well
as promote/demote for <br>
multistate resources.</p>

<p style="margin-top: 1em">To trace the probe operation
which exists for all resources, either set a trace for
monitor with interval 0, or use probe as the operation
name.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">trace &lt;rsc&gt; [&lt;op&gt;
[&lt;interval&gt;] ]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">trace fs start <br>
trace webserver <br>
trace webserver probe <br>
trace fs monitor 0</p>

<p style="margin-top: 1em">unmanage <br>
Unmanage a resource using the is-managed attribute. If there
are multiple meta attributes sets, the attribute is set in
all of them. If the resource is a clone, all <br>
is-managed attributes are removed from the children
resources.</p>

<p style="margin-top: 1em">For details on group management
see options manage-children.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">unmanage &lt;rsc&gt;</p>

<p style="margin-top: 1em">untrace <br>
Stop tracing RA for the given operation. If no operation
name is given, crmsh will attempt to stop tracing all
operations in resource.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">untrace &lt;rsc&gt; [&lt;op&gt;
[&lt;interval&gt;] ]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">untrace fs start <br>
untrace webserver</p>

<p style="margin-top: 1em">utilization <br>
Show/edit/delete a utilization attribute of a resource.
These attributes describe hardware requirements. By setting
the placement-strategy cluster property appropriately, it
<br>
is possible then to distribute resources based on resource
requirements and node size. See also node utilization
attributes.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">utilization &lt;rsc&gt; set
&lt;attr&gt; &lt;value&gt; <br>
utilization &lt;rsc&gt; delete &lt;attr&gt; <br>
utilization &lt;rsc&gt; show &lt;attr&gt;</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">utilization xen1 set memory
4096</p>

<p style="margin-top: 1em">node - Node management <br>
Node management and status commands.</p>

<p style="margin-top: 1em">attribute <br>
Edit node attributes. This kind of attribute should refer to
relatively static properties, such as memory size.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">attribute &lt;node&gt; set
&lt;attr&gt; &lt;value&gt; <br>
attribute &lt;node&gt; delete &lt;attr&gt; <br>
attribute &lt;node&gt; show &lt;attr&gt;</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">attribute node_1 set memory_size
4096</p>

<p style="margin-top: 1em">clearstate <br>
Resets and clears the state of the specified node. This node
is afterwards assumed clean and offline. This command can be
used to manually confirm that a node has been fenced <br>
(e.g., powered off).</p>

<p style="margin-top: 1em">Be careful! This can cause data
corruption if you confirm that a node is down that is, in
fact, not cleanly down - the cluster will proceed as if the
fence had succeeded, <br>
possibly starting resources multiple times.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">clearstate &lt;node&gt;</p>

<p style="margin-top: 1em">delete <br>
Delete a node. This command will remove the node from the
CIB and, in case the cluster stack is running, use the
appropriate program (crm_node or hb_delnode) to remove the
<br>
node from the membership.</p>

<p style="margin-top: 1em">If the node is still listed as
active and a member of our partition we refuse to remove it.
With the global force option (-F) we will try to delete the
node anyway.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">delete &lt;node&gt;</p>

<p style="margin-top: 1em">fence <br>
Make CRM fence a node. This functionality depends on stonith
resources capable of fencing the specified node. No such
stonith resources, no fencing will happen.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">fence &lt;node&gt;</p>

<p style="margin-top: 1em">maintenance <br>
Set the node status to maintenance. This is equivalent to
the cluster-wide maintenance-mode property but puts just one
node into the maintenance mode.</p>

<p style="margin-top: 1em">The node parameter defaults to
the node where the command is run.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">maintenance [&lt;node&gt;]</p>

<p style="margin-top: 1em">online <br>
Set a node to online status.</p>

<p style="margin-top: 1em">The node parameter defaults to
the node where the command is run.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">online [&lt;node&gt;]</p>

<p style="margin-top: 1em">ready <br>
Set the node&acirc;s maintenance status to off. The node
should be now again fully operational and capable of running
resource operations.</p>

<p style="margin-top: 1em">The node parameter defaults to
the node where the command is run.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">ready [&lt;node&gt;]</p>

<p style="margin-top: 1em">server <br>
Remote nodes may have a configured server address which
should be used when contacting the node. This command prints
the server address if configured, else the node name.</p>

<p style="margin-top: 1em">If no parameter is given, the
adresses or names for all nodes are printed.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">server [&lt;node&gt; ...]</p>

<p style="margin-top: 1em">show <br>
Show a node definition. If the node parameter is omitted
then all nodes are shown.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">show [&lt;node&gt;]</p>

<p style="margin-top: 1em">standby <br>
Set a node to standby status. The node parameter defaults to
the node where the command is run.</p>

<p style="margin-top: 1em">Additionally, you may specify a
lifetime for the standby---if set to reboot, the node will
be back online once it reboots. forever will keep the node
in standby after reboot. <br>
The life time defaults to forever.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">standby [&lt;node&gt;]
[&lt;lifetime&gt;]</p>

<p style="margin-top: 1em">lifetime :: reboot | forever</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">standby bob reboot</p>

<p style="margin-top: 1em">status <br>
Show nodes&rsquo; status as XML. If the node parameter is
omitted then all nodes are shown.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">status [&lt;node&gt;]</p>

<p style="margin-top: 1em">status-attr <br>
Edit node attributes which are in the CIB status section,
i.e. attributes which hold properties of a more volatile
nature. One typical example is attribute generated by the
<br>
pingd utility.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">status-attr &lt;node&gt; set
&lt;attr&gt; &lt;value&gt; <br>
status-attr &lt;node&gt; delete &lt;attr&gt; <br>
status-attr &lt;node&gt; show &lt;attr&gt;</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">status-attr node_1 show
pingd</p>

<p style="margin-top: 1em">utilization <br>
Edit node utilization attributes. These attributes describe
hardware characteristics as integer numbers such as memory
size or the number of CPUs. By setting the <br>
placement-strategy cluster property appropriately, it is
possible then to distribute resources based on resource
requirements and node size. See also resource utilization
<br>
attributes.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">utilization &lt;node&gt; set
&lt;attr&gt; &lt;value&gt; <br>
utilization &lt;node&gt; delete &lt;attr&gt; <br>
utilization &lt;node&gt; show &lt;attr&gt;</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">utilization node_1 set memory
16384 <br>
utilization node_1 show cpu</p>

<p style="margin-top: 1em">site - GEO clustering site
support <br>
A cluster may consist of two or more subclusters in
different and distant locations. This set of commands
supports such setups.</p>

<p style="margin-top: 1em">ticket <br>
Tickets are cluster-wide attributes. They can be managed at
the site where this command is executed.</p>

<p style="margin-top: 1em">It is then possible to constrain
resources depending on the ticket availability (see the
rsc_ticket command for more details).</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">ticket
{grant|revoke|standby|activate|show|time|delete}
&lt;ticket&gt;</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">ticket grant ticket1</p>

<p style="margin-top: 1em">options - User preferences <br>
The user may set various options for the crm shell
itself.</p>

<p style="margin-top: 1em">add-quotes <br>
The shell (as in /bin/sh) parser strips quotes from the
command line. This may sometimes make it really difficult to
type values which contain white space. One typical <br>
example is the configure filter command. The crm shell will
supply extra quotes around arguments which contain white
space. The default is yes. Note on quotes use</p>

<p style="margin-top: 1em">Adding quotes around arguments
automatically has been introduced with version 1.2.2 and it
is technically a regression. Being a regression is the only
reason the add-quotes <br>
option exists. If you have custom shell scripts which would
break, just set the add-quotes option to no.</p>

<p style="margin-top: 1em">For instance, with adding quotes
enabled, it is possible to do the following:</p>

<p style="margin-top: 1em"># crm configure primitive d1
Dummy meta description=&quot;some description here&quot;
<br>
# crm configure filter &rsquo;sed
&quot;s/hostlist=./&amp;node-c /&quot;&rsquo; fencing</p>

<p style="margin-top: 1em">check-frequency <br>
Semantic check of the CIB or elements modified or created
may be done on every configuration change (always), when
verifying (on-verify) or never. It is by default set to <br>
always. Experts may want to change the setting to
on-verify.</p>

<p style="margin-top: 1em">The checks require that resource
agents are present. If they are not installed at the
configuration time set this preference to never.</p>

<p style="margin-top: 1em">See Configuration semantic
checks for more details.</p>

<p style="margin-top: 1em">check-mode <br>
Semantic check of the CIB or elements modified or created
may be done in the strict mode or in the relaxed mode. In
the former certain problems are treated as configuration
<br>
errors. In the relaxed mode all are treated as warnings. The
default is strict.</p>

<p style="margin-top: 1em">See Configuration semantic
checks for more details.</p>

<p style="margin-top: 1em">colorscheme <br>
With output set to color, a comma separated list of colors
from this option are used to emphasize:</p>

<p style="margin-top: 1em">&Acirc;&middot; keywords</p>

<p style="margin-top: 1em">&Acirc;&middot; object ids</p>

<p style="margin-top: 1em">&Acirc;&middot; attribute
names</p>

<p style="margin-top: 1em">&Acirc;&middot; attribute
values</p>

<p style="margin-top: 1em">&Acirc;&middot; scores</p>

<p style="margin-top: 1em">&Acirc;&middot; resource
references</p>

<p style="margin-top: 1em">crm can show colors only if
there is curses support for python installed (usually
provided by the python-curses package). The colors are
whatever is available in your <br>
terminal. Use normal if you want to keep the default
foreground color.</p>

<p style="margin-top: 1em">This user preference defaults to
yellow,normal,cyan,red,green,magenta which is good for
terminals with dark background. You may want to change the
color scheme and save it in <br>
the preferences file for other color setups.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">colorscheme
yellow,normal,blue,red,green,magenta</p>

<p style="margin-top: 1em">editor <br>
The edit command invokes an editor. Use this to specify your
preferred editor program. If not set, it will default to
either the value of the EDITOR environment variable or <br>
to one of the standard UNIX editors (vi,emacs,nano).</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">editor program</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">editor vim</p>

<p style="margin-top: 1em">manage-children <br>
Some resource management commands, such as resource stop,
when the target resource is a group, may not always produce
desired result. Each element, group and the primitive <br>
members, can have a meta attribute and those attributes may
end up with conflicting values. Consider the following
construct:</p>

<p style="margin-top: 1em">crm(live)# configure show svc fs
virtual-ip <br>
primitive fs Filesystem params device=&quot;/dev/drbd0&quot;
directory=&quot;/srv/nfs&quot; fstype=ext3 op monitor
interval=10s meta target-role=Started <br>
primitive virtual-ip IPaddr2 params ip=10.2.13.110 iflabel=1
op monitor interval=10s op start interval=0 meta
target-role=Started <br>
group svc fs virtual-ip meta target-role=Stopped</p>

<p style="margin-top: 1em">Even though the element svc
should be stopped, the group is actually running because all
its members have the target-role set to Started:</p>

<p style="margin-top: 1em">crm(live)# resource show svc
<br>
resource svc is running on: xen-f</p>

<p style="margin-top: 1em">Hence, if the user invokes
resource stop svc the intention is not clear. This
preference gives the user an opportunity to better control
what happens if attributes of group <br>
members have values which are in conflict with the same
attribute of the group itself.</p>

<p style="margin-top: 1em">Possible values are ask (the
default), always, and never. If set to always, the crm shell
removes all children attributes which have values different
from the parent. If set <br>
to never, all children attributes are left intact. Finally,
if set to ask, the user will be asked for each member what
is to be done.</p>

<p style="margin-top: 1em">output <br>
crm can adorn configurations in two ways: in color (similar
to for instance the ls --color command) and by showing
keywords in upper case. Possible values are plain, <br>
color-always, color, and uppercase. It is possible to
combine uppercase with one of the color values in order to
get an upper case xmass tree. Just set this option to <br>
color,uppercase or color-always,uppercase. In case you need
color codes in pipes, color-always forces color codes even
in case the terminal is not a tty (just like ls <br>
--color=always).</p>

<p style="margin-top: 1em">pager <br>
The view command displays text through a pager. Use this to
specify your preferred pager program. If not set, it will
default to either the value of the PAGER environment <br>
variable or to one of the standard UNIX system pagers
(less,more,pg).</p>

<p style="margin-top: 1em">reset <br>
This command resets all user options to the defaults. If
used as a single-shot command, the rc file
($HOME/.config/crm/rc) is reset to the defaults too.</p>

<p style="margin-top: 1em">save <br>
Save current settings to the rc file ($HOME/.config/crm/rc).
On further crm runs, the rc file is automatically read and
parsed.</p>

<p style="margin-top: 1em">set <br>
Sets the value of an option. Takes the fully qualified name
of the option as argument, as displayed by show all.</p>

<p style="margin-top: 1em">The modified option value is
stored in the user-local configuration file, usually found
in ~/.config/crm/crm.conf.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">set &lt;option&gt;
&lt;value&gt;</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">set color.warn &quot;magenta
bold&quot; <br>
set editor nano</p>

<p style="margin-top: 1em">show <br>
Display all current settings.</p>

<p style="margin-top: 1em">Given an option name as
argument, show will display only the value of that
argument.</p>

<p style="margin-top: 1em">Given all as argument, show
displays all available user options.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">show [all|&lt;option&gt;]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">show <br>
show skill-level <br>
show all</p>

<p style="margin-top: 1em">skill-level <br>
Based on the skill-level setting, the user is allowed to use
only a subset of commands. There are three levels: operator,
administrator, and expert. The operator level allows <br>
only commands at the resource and node levels, but not
editing or deleting resources. The administrator may do that
and may also configure the cluster at the configure level
<br>
and manage the shadow CIBs. The expert may do all.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">skill-level &lt;level&gt;</p>

<p style="margin-top: 1em">level :: operator |
administrator | expert <br>
Note on security</p>

<p style="margin-top: 1em">The skill-level option is
advisory only. There is nothing stopping any users change
their skill level (see Access Control Lists (ACL) on how to
enforce access control).</p>

<p style="margin-top: 1em">sort-elements <br>
crm by default sorts CIB elements. If you want them appear
in the order they were created, set this option to no.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">sort-elements {yes|no}</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">sort-elements no</p>

<p style="margin-top: 1em">user <br>
Sufficient privileges are necessary in order to manage a
cluster: programs such as crm_verify or crm_resource and,
ultimately, cibadmin have to be run either as root or as
<br>
the CRM owner user (typically hacluster). You don&acirc;t
have to worry about that if you run crm as root. A more
secure way is to run the program with your usual privileges,
set <br>
this option to the appropriate user (such as hacluster), and
setup the sudoers file.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">user system-user</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">user hacluster</p>

<p style="margin-top: 1em">wait <br>
In normal operation, crm runs a command and gets back
immediately to process other commands or get input from the
user. With this option set to yes it will wait for the <br>
started transition to finish. In interactive mode dots are
printed to indicate progress.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">wait {yes|no}</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">wait yes</p>

<p style="margin-top: 1em">configure - CIB configuration
<br>
This level enables all CIB object definition commands.</p>

<p style="margin-top: 1em">The configuration may be
logically divided into four parts: nodes, resources,
constraints, and (cluster) properties and attributes. Each
of these commands support one or more <br>
basic CIB objects.</p>

<p style="margin-top: 1em">Nodes and attributes describing
nodes are managed using the node command.</p>

<p style="margin-top: 1em">Commands for resources are:</p>

<p style="margin-top: 1em">&Acirc;&middot; primitive</p>

<p style="margin-top: 1em">&Acirc;&middot; monitor</p>

<p style="margin-top: 1em">&Acirc;&middot; group</p>

<p style="margin-top: 1em">&Acirc;&middot; clone</p>

<p style="margin-top: 1em">&Acirc;&middot; ms/master
(master-slave)</p>

<p style="margin-top: 1em">In order to streamline large
configurations, it is possible to define a template which
can later be referenced in primitives:</p>

<p style="margin-top: 1em">&Acirc;&middot; rsc_template</p>

<p style="margin-top: 1em">In that case the primitive
inherits all attributes defined in the template.</p>

<p style="margin-top: 1em">There are three types of
constraints:</p>

<p style="margin-top: 1em">&Acirc;&middot; location</p>

<p style="margin-top: 1em">&Acirc;&middot; colocation</p>

<p style="margin-top: 1em">&Acirc;&middot; order</p>

<p style="margin-top: 1em">It is possible to define fencing
order (stonith resource priorities):</p>

<p style="margin-top: 1em">&Acirc;&middot;
fencing_topology</p>

<p style="margin-top: 1em">Finally, there are the cluster
properties, resource meta attributes defaults, and
operations defaults. All are just a set of attributes. These
attributes are managed by the <br>
following commands:</p>

<p style="margin-top: 1em">&Acirc;&middot; property</p>

<p style="margin-top: 1em">&Acirc;&middot; rsc_defaults</p>

<p style="margin-top: 1em">&Acirc;&middot; op_defaults</p>

<p style="margin-top: 1em">In addition to the cluster
configuration, the Access Control Lists (ACL) can be setup
to allow access to parts of the CIB for users other than
root and hacluster. The following <br>
commands manage ACL:</p>

<p style="margin-top: 1em">&Acirc;&middot; user</p>

<p style="margin-top: 1em">&Acirc;&middot; role</p>

<p style="margin-top: 1em">In Pacemaker 1.1.12 and up, this
command replaces the user command for handling ACLs:</p>

<p style="margin-top: 1em">&Acirc;&middot; acl_target</p>

<p style="margin-top: 1em">The changes are applied to the
current CIB only on ending the configuration session or
using the commit command.</p>

<p style="margin-top: 1em">Comments start with # in the
first line. The comments are tied to the element which
follows. If the element moves, its comments will follow.</p>

<p style="margin-top: 1em">acl_target <br>
Defines an ACL target.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">acl_target &lt;tid&gt;
[&lt;role&gt; ...]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">acl_target joe resource_admin
constraint_editor</p>

<p style="margin-top: 1em">alert <br>
Version note</p>

<p style="margin-top: 1em">This feature is only available
in Pacemaker 1.1.15+.</p>

<p style="margin-top: 1em">Event-driven alerts enables
calling scripts whenever interesting events occur in the
cluster (nodes joining or leaving, resources starting or
stopping, etc.).</p>

<p style="margin-top: 1em">The path is an arbitrary file
path to an alert script. Existing external scripts used with
ClusterMon resources can be used as alert scripts, since the
interface is <br>
compatible.</p>

<p style="margin-top: 1em">Each alert may have a number of
receipients configured. These will be passed to the script
as arguments. The first recipient will also be passed as the
CRM_alert_recipient <br>
environment variable, for compatibility with existing
scripts that only support one recipient.</p>

<p style="margin-top: 1em">The available meta attributes
are timeout (default 30s) and timestamp-format (default
&quot;%H:%M:%S.%06N&quot;).</p>

<p style="margin-top: 1em">Some configurations may require
each recipient to be delimited by brackets, to avoid
ambiguity. In the example alert-2 below, the meta attribute
for timeout is defined after <br>
the recipient, so the brackets are used to ensure that the
meta attribute is set for the alert and not just the
recipient. This can be avoided by setting any alert
attributes <br>
before defining the recipients.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">alert &lt;id&gt; &lt;path&gt;
[attributes &lt;nvpair&gt; ...] [meta &lt;nvpair&gt; ...]
[to [{] &lt;recipient&gt; <br>
[attributes &lt;nvpair&gt; ...] [meta &lt;nvpair&gt; ...]
[}] ...]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">alert alert-1
/srv/pacemaker/pcmk_alert_sample.sh to
/var/log/cluster-alerts.log</p>

<p style="margin-top: 1em">alert alert-2
/srv/pacemaker/example_alert.sh meta timeout=60s to {
/var/log/cluster-alerts.log }</p>

<p style="margin-top: 1em">cib <br>
This level is for management of shadow CIBs. It is available
at the configure level to enable saving intermediate changes
to a shadow CIB instead of to the live cluster. This <br>
short excerpt shows how:</p>

<p style="margin-top: 1em">crm(live)configure# cib new
test-2 <br>
INFO: test-2 shadow CIB created <br>
crm(test-2)configure# commit</p>

<p style="margin-top: 1em">Note how the current CIB in the
prompt changed from live to test-2 after issuing the cib new
command. See also the CIB shadow management for more
information.</p>

<p style="margin-top: 1em">cibstatus <br>
Enter edit and manage the CIB status section level. See the
CIB status management section.</p>

<p style="margin-top: 1em">clone <br>
The clone command creates a resource clone. It may contain a
single primitive resource or one group of resources.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">clone &lt;name&gt; &lt;rsc&gt;
<br>
[description=&lt;description&gt;] <br>
[meta &lt;attr_list&gt;] <br>
[params &lt;attr_list&gt;]</p>

<p style="margin-top: 1em">attr_list :: [$id=&lt;id&gt;]
&lt;attr&gt;=&lt;val&gt; [&lt;attr&gt;=&lt;val&gt;...] |
$id-ref=&lt;id&gt;</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">clone cl_fence apc_1 meta
clone-node-max=1 globally-unique=false</p>

<p style="margin-top: 1em">colocation (collocation) <br>
This constraint expresses the placement relation between two
or more resources. If there are more than two resources,
then the constraint is called a resource set.</p>

<p style="margin-top: 1em">The score is used to indicate
the priority of the constraint. A positive score indicates
that the resources should run on the same node. A negative
score that they should not <br>
run on the same node. Values of positive or negative
infinity indicate a mandatory constraint.</p>

<p style="margin-top: 1em">In the two resource form, the
cluster will place &lt;with-rsc&gt; first, and then decide
where to put the &lt;rsc&gt; resource.</p>

<p style="margin-top: 1em">Collocation resource sets have
an extra attribute (sequential) to allow for sets of
resources which don&acirc;t depend on each other in terms of
state. The shell syntax for such <br>
sets is to put resources in parentheses.</p>

<p style="margin-top: 1em">Sets cannot be nested.</p>

<p style="margin-top: 1em">The optional node-attribute can
be used to colocate resources on a set of nodes and not
necessarily on the same node. For example, by setting a node
attribute color on all <br>
nodes and setting the node-attribute value to color as well,
the colocated resources will be placed on any node that has
the same color.</p>

<p style="margin-top: 1em">For more details on how to
configure resource sets, see Syntax: Resource sets.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">colocation &lt;id&gt;
&lt;score&gt;: &lt;rsc&gt;[:&lt;role&gt;]
&lt;with-rsc&gt;[:&lt;role&gt;] <br>
[node-attribute=&lt;node_attr&gt;]</p>

<p style="margin-top: 1em">colocation &lt;id&gt;
&lt;score&gt;: &lt;resource_sets&gt; <br>
[node-attribute=&lt;node_attr&gt;]</p>

<p style="margin-top: 1em">resource_sets ::
&lt;resource_set&gt; [&lt;resource_set&gt; ...]</p>

<p style="margin-top: 1em">resource_set ::
[&quot;(&quot;|&quot;[&quot;] &lt;rsc&gt;[:&lt;role&gt;]
[&lt;rsc&gt;[:&lt;role&gt;] ...] [&lt;attributes&gt;]
[&quot;)&quot;|&quot;]&quot;]</p>

<p style="margin-top: 1em">attributes ::
[require-all=(true|false)] [sequential=(true|false)]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">colocation
never_put_apache_with_dummy -inf: apache dummy <br>
colocation c1 inf: A ( B C )</p>

<p style="margin-top: 1em">commit <br>
Commit the current configuration to the CIB in use. As noted
elsewhere, commands in a configure session don&acirc;t have
immediate effect on the CIB. All changes are applied at one
<br>
point in time, either using commit or when the user leaves
the configure level. In case the CIB in use changed in the
meantime, presumably by somebody else, the crm shell <br>
will refuse to apply the changes.</p>

<p style="margin-top: 1em">If you know that it&acirc;s fine
to still apply them, add force to the command line.</p>

<p style="margin-top: 1em">To disable CIB patching and
apply the changes by replacing the CIB completely, add
replace to the command line. Note that this can lead to
previous changes being overwritten <br>
if some other process concurrently modifies the CIB.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">commit [force] [replace]</p>

<p style="margin-top: 1em">default-timeouts <br>
This command takes the timeouts from the actions section of
the resource agent meta-data and sets them for the
operations of the primitive.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">default-timeouts &lt;id&gt;
[&lt;id&gt;...] <br>
Note on default-timeouts</p>

<p style="margin-top: 1em">The use of this command is
discouraged in favor of manually determining the best
timeouts required for the particular configuration. Relying
on the resource agent to supply <br>
appropriate timeouts can cause the resource to fail at the
worst possible moment.</p>

<p style="margin-top: 1em">Appropriate timeouts for
resource actions are context-sensitive, and should be
carefully considered with the whole configuration in
mind.</p>

<p style="margin-top: 1em">delete <br>
Delete one or more objects. If an object to be deleted
belongs to a container object, such as a group, and it is
the only resource in that container, then the container is
<br>
deleted as well. Any related constraints are removed as
well.</p>

<p style="margin-top: 1em">If the object is a started
resource, it will not be deleted unless the --force flag is
passed to the command, or the force option is set.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">delete [--force] &lt;id&gt;
[&lt;id&gt;...]</p>

<p style="margin-top: 1em">edit <br>
This command invokes the editor with the object description.
As with the show command, the user may choose to edit all
objects or a set of objects.</p>

<p style="margin-top: 1em">If the user insists, he or she
may edit the XML edition of the object. If you do that,
don&acirc;t modify any id attributes.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">edit [xml] [&lt;id&gt; ...] <br>
edit [xml] changed <br>
Note on renaming element ids</p>

<p style="margin-top: 1em">The edit command sometimes
cannot properly handle modifying element ids. In particular
for elements which belong to group or ms resources. Group
and ms resources themselves <br>
also cannot be renamed. Please use the rename command
instead.</p>

<p style="margin-top: 1em">erase <br>
The erase clears all configuration. Apart from nodes. To
remove nodes, you have to specify an additional keyword
nodes.</p>

<p style="margin-top: 1em">Note that removing nodes from
the live cluster may have some strange/interesting/unwelcome
effects.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">erase [nodes]</p>

<p style="margin-top: 1em">fencing_topology <br>
If multiple fencing (stonith) devices are available capable
of fencing a node, their order may be specified by
fencing_topology. The order is specified per node.</p>

<p style="margin-top: 1em">Stonith resources can be
separated by , in which case all of them need to succeed. If
they fail, the next stonith resource (or set of resources)
is used. In other words, use <br>
comma to separate resources which all need to succeed and
whitespace for serial order. It is not allowed to use
whitespace around comma.</p>

<p style="margin-top: 1em">If the node is left out, the
order is used for all nodes. That should reduce the
configuration size in some stonith setups.</p>

<p style="margin-top: 1em">From Pacemaker version 1.1.14,
it is possible to use a node attribute as the target in a
fencing topology. The syntax for this usage is described
below.</p>

<p style="margin-top: 1em">From Pacemaker version 1.1.14,
it is also possible to use regular expression patterns as
the target in a fencing topology. The configured fencing
sequence then applies to all <br>
devices matching the pattern.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">fencing_topology
&lt;stonith_resources&gt; [&lt;stonith_resources&gt; ...]
<br>
fencing_topology &lt;fencing_order&gt;
[&lt;fencing_order&gt; ...]</p>

<p style="margin-top: 1em">fencing_order :: &lt;target&gt;
&lt;stonith_resources&gt; [&lt;stonith_resources&gt;
...]</p>

<p style="margin-top: 1em">stonith_resources ::
&lt;rsc&gt;[,&lt;rsc&gt;...] <br>
target :: &lt;node&gt;: |
attr:&lt;node-attribute&gt;=&lt;value&gt; |
pattern:&lt;pattern&gt;</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em"># Only kill the power if
poison-pill fails <br>
fencing_topology poison-pill power</p>

<p style="margin-top: 1em"># As above for node-a, but a
different strategy for node-b <br>
fencing_topology node-a: poison-pill power node-b: ipmi
serial</p>

<p style="margin-top: 1em"># Fencing anything on rack 1
requires fencing via both APC 1 and 2, <br>
# to defeat the redundancy provided by two separate UPS
units. <br>
fencing_topology attr:rack=1 apc01,apc02</p>

<p style="margin-top: 1em"># Fencing for all machines named
green.* is done using the pear <br>
# fencing device first, while all machines named red.* are
fenced <br>
# using the apple fencing device first. <br>
fencing_topology pattern:green.* pear apple pattern:red.*
apple pear</p>

<p style="margin-top: 1em">filter <br>
This command filters the given CIB elements through an
external program. The program should accept input on stdin
and send output to stdout (the standard UNIX filter <br>
conventions). As with the show command, the user may choose
to filter all or just a subset of elements.</p>

<p style="margin-top: 1em">It is possible to filter the XML
representation of objects, but probably not as useful as the
configuration language. The presentation is somewhat
different from what would <br>
be displayed by the show command---each element is shown on
a single line, i.e. there are no backslashes and no other
embelishments.</p>

<p style="margin-top: 1em">Don&acirc;t forget to put quotes
around the filter if it contains spaces.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">filter &lt;prog&gt; [xml]
[&lt;id&gt; ...] <br>
filter &lt;prog&gt; [xml] changed</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">filter &quot;sed
&rsquo;/^primitive/s/target-role=[^ ]*//&rsquo;&quot; <br>
# crm configure filter &quot;sed
&rsquo;/^primitive/s/target-role=[^ ]*//&rsquo;&quot; <br>
crm configure &lt;&lt;END <br>
filter &quot;sed &rsquo;/threshold= <br>
END <br>
Note on quotation marks</p>

<p style="margin-top: 1em">Filter commands which feature a
blend of quotation marks can be difficult to get right,
especially when used directly from bash, since bash does its
own quotation parsing. In <br>
these cases, it can be easier to supply the filter command
as standard input. See the last example above.</p>

<p style="margin-top: 1em">get-property <br>
Show the value of the given property. If the value is not
set, the command will print the default value for the
property, if known.</p>

<p style="margin-top: 1em">If no property name is passed to
the command, the list of known cluster properties is
printed.</p>

<p style="margin-top: 1em">If the property is set multiple
times, for example using multiple property sets with
different rule expressions, the output of this command is
undefined.</p>

<p style="margin-top: 1em">Pass the argument -t or --true
to get-property to translate the argument value into true or
false. If the value is not set, the command will print
false.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">get-property [-t|--true]
[&lt;name&gt;]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">get-property stonith-enabled
<br>
get-property -t maintenance-mode</p>

<p style="margin-top: 1em">graph <br>
Create a graphviz graphical layout from the current cluster
configuration.</p>

<p style="margin-top: 1em">Currently, only dot (directed
graph) is supported. It is essentially a visualization of
resource ordering.</p>

<p style="margin-top: 1em">The graph may be saved to a file
which can be used as source for various graphviz tools (by
default it is displayed in the user&acirc;s X11 session).
Optionally, by specifying the <br>
format, one can also produce an image instead.</p>

<p style="margin-top: 1em">For more or different graphviz
attributes, it is possible to save the default set of
attributes to an ini file. If this file exists it will
always override the builtin <br>
settings. The exportsettings subcommand also prints the
location of the ini file.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">graph [&lt;gtype&gt;
[&lt;file&gt; [&lt;img_format&gt;]]] <br>
graph exportsettings</p>

<p style="margin-top: 1em">gtype :: dot <br>
img_format :: &lsquo;dot&lsquo; output format (see the +-T+
option)</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">graph dot <br>
graph dot clu1.conf.dot <br>
graph dot clu1.conf.svg svg</p>

<p style="margin-top: 1em">group <br>
The group command creates a group of resources. This can be
useful when resources depend on other resources and require
that those resources start in order on the same node. <br>
A commmon use of resource groups is to ensure that a server
and a virtual IP are located together, and that the virtual
IP is started before the server.</p>

<p style="margin-top: 1em">Grouped resources are started in
the order they appear in the group, and stopped in the
reverse order. If a resource in the group cannot run
anywhere, resources following it <br>
in the group will not start.</p>

<p style="margin-top: 1em">group can be passed the
&quot;container&quot; meta attribute, to indicate that it is
to be used to group VM resources monitored using Nagios. The
resource referred to by the container <br>
attribute must be of type ocf:heartbeat:Xen,
oxf:heartbeat:VirtualDomain or ocf:heartbeat:lxc.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">group &lt;name&gt; &lt;rsc&gt;
[&lt;rsc&gt;...] <br>
[description=&lt;description&gt;] <br>
[meta attr_list] <br>
[params attr_list]</p>

<p style="margin-top: 1em">attr_list :: [$id=&lt;id&gt;]
&lt;attr&gt;=&lt;val&gt; [&lt;attr&gt;=&lt;val&gt;...] |
$id-ref=&lt;id&gt;</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">group internal_www disk0 fs0
internal_ip apache meta target_role=stopped</p>

<p style="margin-top: 1em">group vm-and-services vm vm-sshd
meta container=&quot;vm&quot;</p>

<p style="margin-top: 1em">load <br>
Load a part of configuration (or all of it) from a local
file or a network URL. The replace method replaces the
current configuration with the one from the source. The
update <br>
method tries to import the contents into the current
configuration. The push method imports the contents into the
current configuration and removes any lines that are not
<br>
present in the given configuration. The file may be a CLI
file or an XML file.</p>

<p style="margin-top: 1em">If the URL is -, the
configuration is read from standard input.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">load [xml] &lt;method&gt;
URL</p>

<p style="margin-top: 1em">method :: replace | update |
push</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">load xml update myfirstcib.xml
<br>
load xml replace http://storage.big.com/cibs/bigcib.xml <br>
load xml push smallcib.xml</p>

<p style="margin-top: 1em">location <br>
location defines the preference of nodes for the given
resource. The location constraints consist of one or more
rules which specify a score to be awarded if the rule <br>
matches.</p>

<p style="margin-top: 1em">The resource referenced by the
location constraint can be one of the following:</p>

<p style="margin-top: 1em">&Acirc;&middot; Plain resource
reference: location loc1 webserver 100: node1</p>

<p style="margin-top: 1em">&Acirc;&middot; Resource set in
curly brackets: location loc1 { virtual-ip webserver } 100:
node1</p>

<p style="margin-top: 1em">&Acirc;&middot; Tag containing
resource ids: location loc1 tag1 100: node1</p>

<p style="margin-top: 1em">&Acirc;&middot; Resource
pattern: location loc1 /web.*/ 100: node1</p>

<p style="margin-top: 1em">The resource-discovery attribute
allows probes to be selectively enabled or disabled per
resource and node.</p>

<p style="margin-top: 1em">The syntax for resource sets is
described in detail for colocation.</p>

<p style="margin-top: 1em">For more details on how to
configure resource sets, see Syntax: Resource sets.</p>

<p style="margin-top: 1em">For more information on rule
expressions, see Syntax: Rule expressions.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">location &lt;id&gt; &lt;rsc&gt;
[&lt;attributes&gt;] {&lt;node_pref&gt;|&lt;rules&gt;}</p>

<p style="margin-top: 1em">rsc :: /&lt;rsc-pattern&gt;/
<br>
| { resource_sets } <br>
| &lt;rsc&gt;</p>

<p style="margin-top: 1em">attributes :: role=&lt;role&gt;
| resource-discovery=always|never|exclusive</p>

<p style="margin-top: 1em">node_pref :: &lt;score&gt;:
&lt;node&gt;</p>

<p style="margin-top: 1em">rules :: <br>
rule [id_spec] [$role=&lt;role&gt;] &lt;score&gt;:
&lt;expression&gt; <br>
[rule [id_spec] [$role=&lt;role&gt;] &lt;score&gt;:
&lt;expression&gt; ...]</p>

<p style="margin-top: 1em">id_spec :: $id=&lt;id&gt; |
$id-ref=&lt;id&gt; <br>
score :: &lt;number&gt; | &lt;attribute&gt; | [-]inf <br>
expression :: &lt;simple_exp&gt; [&lt;bool_op&gt;
&lt;simple_exp&gt; ...] <br>
bool_op :: or | and <br>
simple_exp :: &lt;attribute&gt; [type:]&lt;binary_op&gt;
&lt;value&gt; <br>
| &lt;unary_op&gt; &lt;attribute&gt; <br>
| date &lt;date_expr&gt; <br>
type :: string | version | number <br>
binary_op :: lt | gt | lte | gte | eq | ne <br>
unary_op :: defined | not_defined</p>

<p style="margin-top: 1em">date_expr :: lt &lt;end&gt; <br>
| gt &lt;start&gt; <br>
| in start=&lt;start&gt; end=&lt;end&gt; <br>
| in start=&lt;start&gt; &lt;duration&gt; <br>
| spec &lt;date_spec&gt; <br>
duration|date_spec :: <br>
hours=&lt;value&gt; <br>
| monthdays=&lt;value&gt; <br>
| weekdays=&lt;value&gt; <br>
| yearsdays=&lt;value&gt; <br>
| months=&lt;value&gt; <br>
| weeks=&lt;value&gt; <br>
| years=&lt;value&gt; <br>
| weekyears=&lt;value&gt; <br>
| moon=&lt;value&gt;</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">location conn_1 internal_www
100: node1</p>

<p style="margin-top: 1em">location conn_1 internal_www
rule 50: #uname eq node1 rule pingd: defined pingd</p>

<p style="margin-top: 1em">location conn_2 dummy_float rule
-inf: not_defined pingd or pingd number:lte 0</p>

<p style="margin-top: 1em"># never probe for rsc1 on node1
<br>
location no-probe rsc1 resource-discovery=never -inf:
node1</p>

<p style="margin-top: 1em">modgroup <br>
Add or remove primitives in a group. The add subcommand
appends the new group member by default. Should it go
elsewhere, there are after and before clauses.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">modgroup &lt;id&gt; add
&lt;id&gt; [after &lt;id&gt;|before &lt;id&gt;] <br>
modgroup &lt;id&gt; remove &lt;id&gt;</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">modgroup share1 add storage2
before share1-fs</p>

<p style="margin-top: 1em">monitor <br>
Monitor is by far the most common operation. It is possible
to add it without editing the whole resource. Also, long
primitive definitions may be a bit uncluttered. In order
<br>
to make this command as concise as possible, less common
operation attributes are not available. If you need them,
then use the op part of the primitive command.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">monitor
&lt;rsc&gt;[:&lt;role&gt;]
&lt;interval&gt;[:&lt;timeout&gt;]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">monitor apcfence 60m:60s</p>

<p style="margin-top: 1em">Note that after executing the
command, the monitor operation may be shown as part of the
primitive definition.</p>

<p style="margin-top: 1em">ms (master) <br>
The ms command creates a master/slave resource type. It may
contain a single primitive resource or one group of
resources.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">ms &lt;name&gt; &lt;rsc&gt; <br>
[description=&lt;description&gt;] <br>
[meta attr_list] <br>
[params attr_list]</p>

<p style="margin-top: 1em">attr_list :: [$id=&lt;id&gt;]
&lt;attr&gt;=&lt;val&gt; [&lt;attr&gt;=&lt;val&gt;...] |
$id-ref=&lt;id&gt;</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">ms disk1 drbd1 meta notify=true
globally-unique=false <br>
Note on id-ref usage</p>

<p style="margin-top: 1em">Instance or meta attributes
(&acirc;params&lsquo; and meta) may contain a reference to
another set of attributes. In that case, no other attributes
are allowed. Since attribute sets&acirc; <br>
ids, though they do exist, are not shown in the crm, it is
also possible to reference an object instead of an attribute
set. crm will automatically replace such a reference <br>
with the right id:</p>

<p style="margin-top: 1em">crm(live)configure# primitive a2
www-2 meta $id-ref=a1 <br>
crm(live)configure# show a2 <br>
primitive a2 apache meta $id-ref=a1-meta_attributes <br>
[...]</p>

<p style="margin-top: 1em">It is advisable to give
meaningful names to attribute sets which are going to be
referenced.</p>

<p style="margin-top: 1em">node <br>
The node command describes a cluster node. Nodes in the CIB
are commonly created automatically by the CRM. Hence, you
should not need to deal with nodes unless you also want <br>
to define node attributes. Note that it is also possible to
manage node attributes at the node level.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">node [$id=&lt;id&gt;]
&lt;uname&gt;[:&lt;type&gt;] <br>
[description=&lt;description&gt;] <br>
[attributes [$id=&lt;id&gt;] [&lt;score&gt;:] [rule...] <br>
&lt;param&gt;=&lt;value&gt;
[&lt;param&gt;=&lt;value&gt;...]] | $id-ref=&lt;ref&gt; <br>
[utilization [$id=&lt;id&gt;] [&lt;score&gt;:] [rule...]
<br>
&lt;param&gt;=&lt;value&gt;
[&lt;param&gt;=&lt;value&gt;...]] | $id-ref=&lt;ref&gt;</p>

<p style="margin-top: 1em">type :: normal | member | ping |
remote</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">node node1 <br>
node big_node attributes memory=64</p>

<p style="margin-top: 1em">op_defaults <br>
Set defaults for the operations meta attributes.</p>

<p style="margin-top: 1em">For more information on rule
expressions, see Syntax: Rule expressions.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">op_defaults [$id=&lt;set_id&gt;]
[rule ...] &lt;option&gt;=&lt;value&gt;
[&lt;option&gt;=&lt;value&gt; ...]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">op_defaults
record-pending=true</p>

<p style="margin-top: 1em">order <br>
This constraint expresses the order of actions on two
resources or more resources. If there are more than two
resources, then the constraint is called a resource set.</p>

<p style="margin-top: 1em">Ordered resource sets have an
extra attribute to allow for sets of resources whose actions
may run in parallel. The shell syntax for such sets is to
put resources in <br>
parentheses.</p>

<p style="margin-top: 1em">If the subsequent resource can
start or promote after any one of the resources in a set has
done, enclose the set in brackets ([ and ]).</p>

<p style="margin-top: 1em">Sets cannot be nested.</p>

<p style="margin-top: 1em">Three strings are reserved to
specify a kind of order constraint: Mandatory, Optional, and
Serialize. It is preferred to use one of these settings
instead of score. Previous <br>
versions mapped scores 0 and inf to keywords advisory and
mandatory. That is still valid but deprecated.</p>

<p style="margin-top: 1em">For more details on how to
configure resource sets, see Syntax: Resource sets.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">order &lt;id&gt;
[{kind|&lt;score&gt;}:] first then
[symmetrical=&lt;bool&gt;]</p>

<p style="margin-top: 1em">order &lt;id&gt;
[{kind|&lt;score&gt;}:] resource_sets
[symmetrical=&lt;bool&gt;]</p>

<p style="margin-top: 1em">kind :: Mandatory | Optional |
Serialize</p>

<p style="margin-top: 1em">first ::
&lt;rsc&gt;[:&lt;action&gt;]</p>

<p style="margin-top: 1em">then ::
&lt;rsc&gt;[:&lt;action&gt;]</p>

<p style="margin-top: 1em">resource_sets :: resource_set
[resource_set ...]</p>

<p style="margin-top: 1em">resource_set ::
[&quot;[&quot;|&quot;(&quot;] &lt;rsc&gt;[:&lt;action&gt;]
[&lt;rsc&gt;[:&lt;action&gt;] ...] [attributes]
[&quot;]&quot;|&quot;)&quot;]</p>

<p style="margin-top: 1em">attributes ::
[require-all=(true|false)] [sequential=(true|false)]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">order o-1 Mandatory:
apache:start ip_1 <br>
order o-2 Serialize: A ( B C ) <br>
order o-3 inf: [ A B ] C <br>
order o-4 first-resource then-resource</p>

<p style="margin-top: 1em">primitive <br>
The primitive command describes a resource. It may be
referenced only once in group, clone, or master-slave
objects. If it&acirc;s not referenced, then it is placed as
a single <br>
resource in the CIB.</p>

<p style="margin-top: 1em">Operations may be specified
anonymously, as a group or by reference:</p>

<p style="margin-top: 1em">&Acirc;&middot;
&quot;Anonymous&quot;, as a list of op specifications. Use
this method if you don&acirc;t need to reference the set of
operations elsewhere. This is the most common way to define
<br>
operations.</p>

<p style="margin-top: 1em">&Acirc;&middot; If reusing
operation sets is desired, use the operations keyword along
with an id to give the operations set a name. Use the
operations keyword and an id-ref value set to <br>
the id of another operations set, to apply the same set of
operations to this primitive.</p>

<p style="margin-top: 1em">Operation attributes which are
not recognized are saved as instance attributes of that
operation. A typical example is OCF_CHECK_LEVEL.</p>

<p style="margin-top: 1em">For multistate resources, roles
are specified as role=&lt;role&gt;.</p>

<p style="margin-top: 1em">A template may be defined for
resources which are of the same type and which share most of
the configuration. See rsc_template for more
information.</p>

<p style="margin-top: 1em">Attributes containing time
values, such as the interval attribute on operations, are
configured either as a plain number, which is interpreted as
a time in seconds, or using <br>
one of the following suffixes:</p>

<p style="margin-top: 1em">&Acirc;&middot; s, sec - time in
seconds (same as no suffix)</p>

<p style="margin-top: 1em">&Acirc;&middot; ms, msec - time
in milliseconds</p>

<p style="margin-top: 1em">&Acirc;&middot; us, usec - time
in microseconds</p>

<p style="margin-top: 1em">&Acirc;&middot; m, min - time in
minutes</p>

<p style="margin-top: 1em">&Acirc;&middot; h, hr - time in
hours</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">primitive &lt;rsc&gt;
{[&lt;class&gt;:[&lt;provider&gt;:]]&lt;type&gt;|@&lt;template&gt;}
<br>
[description=&lt;description&gt;] <br>
[[params] attr_list] <br>
[meta attr_list] <br>
[utilization attr_list] <br>
[operations id_spec] <br>
[op op_type [&lt;attribute&gt;=&lt;value&gt;...] ...]</p>

<p style="margin-top: 1em">attr_list :: [$id=&lt;id&gt;]
[&lt;score&gt;:] [rule...] <br>
&lt;attr&gt;=&lt;val&gt; [&lt;attr&gt;=&lt;val&gt;...]] |
$id-ref=&lt;id&gt; <br>
id_spec :: $id=&lt;id&gt; | $id-ref=&lt;id&gt; <br>
op_type :: start | stop | monitor</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">primitive apcfence
stonith:apcsmart params ttydev=/dev/ttyS0
hostlist=&quot;node1 node2&quot; op start timeout=60s op
monitor interval=30m timeout=60s</p>

<p style="margin-top: 1em">primitive www8 apache
configfile=/etc/apache/www8.conf operations
$id-ref=apache_ops</p>

<p style="margin-top: 1em">primitive db0 mysql params
config=/etc/mysql/db0.conf op monitor interval=60s op
monitor interval=300s OCF_CHECK_LEVEL=10</p>

<p style="margin-top: 1em">primitive r0 ocf:linbit:drbd
params drbd_resource=r0 op monitor role=Master interval=60s
op monitor role=Slave interval=300s</p>

<p style="margin-top: 1em">primitive xen0 @vm_scheme1
xmfile=/etc/xen/vm/xen0</p>

<p style="margin-top: 1em">primitive mySpecialRsc Special
params 3: rule #uname eq node1 interface=eth1 params 2: rule
#uname eq node2 interface=eth2 port=8888 params 1:
interface=eth0 port=9999</p>

<p style="margin-top: 1em">property <br>
Set cluster configuration properties. To list the available
cluster configuration properties, use the ra info command
with pengine, crmd, cib and stonithd as arguments.</p>

<p style="margin-top: 1em">For more information on rule
expressions, see Syntax: Rule expressions.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">property [&lt;set_id&gt;:] [rule
...] &lt;option&gt;=&lt;value&gt;
[&lt;option&gt;=&lt;value&gt; ...]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">property stonith-enabled=true
<br>
property rule date spec years=2014 stonith-enabled=false</p>

<p style="margin-top: 1em">ptest (simulate) <br>
Show PE (Policy Engine) motions using ptest(8) or
crm_simulate(8).</p>

<p style="margin-top: 1em">A CIB is constructed using the
current user edited configuration and the status from the
running CIB. The resulting CIB is run through ptest (or
crm_simulate) to show changes <br>
which would happen if the configuration is committed.</p>

<p style="margin-top: 1em">The status section may be loaded
from another source and modified using the cibstatus level
commands. In that case, the ptest command will issue a
message informing the user <br>
that the Policy Engine graph is not calculated based on the
current status section and therefore won&acirc;t show what
would happen to the running but some imaginary cluster.</p>

<p style="margin-top: 1em">If you have graphviz installed
and X11 session, dotty(1) is run to display the changes
graphically.</p>

<p style="margin-top: 1em">Add a string of v characters to
increase verbosity. ptest can also show allocation scores.
utilization turns on information about the remaining
capacity of nodes. With the <br>
actions option, ptest will print all resource actions.</p>

<p style="margin-top: 1em">The ptest program has been
replaced by crm_simulate in newer Pacemaker versions. In
some installations both could be installed. Use simulate to
enfore using crm_simulate.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">ptest [nograph] [v...] [scores]
[actions] [utilization]</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">ptest scores <br>
ptest vvvvv <br>
simulate actions</p>

<p style="margin-top: 1em">refresh <br>
Refresh the internal structures from the CIB. All changes
made during this session are lost.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">refresh</p>

<p style="margin-top: 1em">rename <br>
Rename an object. It is recommended to use this command to
rename a resource, because it will take care of updating all
related constraints and a parent resource. Changing <br>
ids with the edit command won&acirc;t have the same
effect.</p>

<p style="margin-top: 1em">If you want to rename a
resource, it must be in the stopped state.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">rename &lt;old_id&gt;
&lt;new_id&gt;</p>

<p style="margin-top: 1em">role <br>
An ACL role is a set of rules which describe access rights
to CIB. Rules consist of an access right read, write, or
deny and a specification denoting part of the <br>
configuration to which the access right applies. The
specification can be an XPath or a combination of tag and id
references. If an attribute is appended, then the <br>
specification applies only to that attribute of the matching
element.</p>

<p style="margin-top: 1em">There is a number of shortcuts
for XPath specifications. The meta, params, and utilization
shortcuts reference resource meta attributes, parameters,
and utilization <br>
respectively. The location may be used to specify location
constraints most of the time to allow resource move and
unmove commands. The property references cluster <br>
properties. The node allows reading node attributes.
nodeattr and nodeutil reference node attributes and node
capacity (utilization). The status shortcut references the
whole <br>
status section of the CIB. Read access to status is
necessary for various monitoring tools such as crm_mon(8)
(aka crm status).</p>

<p style="margin-top: 1em">For more information on rule
expressions, see Syntax: Rule expressions.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">role &lt;role-id&gt; rule [rule
...]</p>

<p style="margin-top: 1em">rule :: acl-right cib-spec
[attribute:&lt;attribute&gt;]</p>

<p style="margin-top: 1em">acl-right :: read | write |
deny</p>

<p style="margin-top: 1em">cib-spec :: xpath-spec |
tag-ref-spec <br>
xpath-spec :: xpath:&lt;xpath&gt; | shortcut <br>
tag-ref-spec :: tag:&lt;tag&gt; | ref:&lt;id&gt; |
tag:&lt;tag&gt; ref:&lt;id&gt;</p>

<p style="margin-top: 1em">shortcut ::
meta:&lt;rsc&gt;[:&lt;attr&gt;] <br>
params:&lt;rsc&gt;[:&lt;attr&gt;] <br>
utilization:&lt;rsc&gt; <br>
location:&lt;rsc&gt; <br>
property[:&lt;attr&gt;] <br>
node[:&lt;node&gt;] <br>
nodeattr[:&lt;attr&gt;] <br>
nodeutil[:&lt;node&gt;] <br>
status</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">role app1_admin write
meta:app1:target-role write meta:app1:is-managed write
location:app1 read ref:app1</p>

<p style="margin-top: 1em">rsc_defaults <br>
Set defaults for the resource meta attributes.</p>

<p style="margin-top: 1em">For more information on rule
expressions, see Syntax: Rule expressions.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">rsc_defaults [&lt;set_id&gt;:]
[rule ...] &lt;option&gt;=&lt;value&gt;
[&lt;option&gt;=&lt;value&gt; ...]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">rsc_defaults
failure-timeout=3m</p>

<p style="margin-top: 1em">rsc_template <br>
The rsc_template command creates a resource template. It may
be referenced in primitives. It is used to reduce large
configurations with many similar resources.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">rsc_template &lt;name&gt;
[&lt;class&gt;:[&lt;provider&gt;:]]&lt;type&gt; <br>
[description=&lt;description&gt;] <br>
[params attr_list] <br>
[meta attr_list] <br>
[utilization attr_list] <br>
[operations id_spec] <br>
[op op_type [&lt;attribute&gt;=&lt;value&gt;...] ...]</p>

<p style="margin-top: 1em">attr_list :: [$id=&lt;id&gt;]
&lt;attr&gt;=&lt;val&gt; [&lt;attr&gt;=&lt;val&gt;...] |
$id-ref=&lt;id&gt; <br>
id_spec :: $id=&lt;id&gt; | $id-ref=&lt;id&gt; <br>
op_type :: start | stop | monitor</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">rsc_template public_vm Xen op
start timeout=300s op stop timeout=300s op monitor
interval=30s timeout=60s op migrate_from timeout=600s op
migrate_to timeout=600s <br>
primitive xen0 @public_vm params xmfile=/etc/xen/xen0 <br>
primitive xen1 @public_vm params xmfile=/etc/xen/xen1</p>

<p style="margin-top: 1em">rsc_ticket <br>
This constraint expresses dependency of resources on
cluster-wide attributes, also known as tickets. Tickets are
mainly used in geo-clusters, which consist of multiple
sites. <br>
A ticket may be granted to a site, thus allowing resources
to run there.</p>

<p style="margin-top: 1em">The loss-policy attribute
specifies what happens to the resource (or resources) if the
ticket is revoked. The default is either stop or demote
depending on whether a resource <br>
is multi-state.</p>

<p style="margin-top: 1em">See also the site set of
commands.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">rsc_ticket &lt;id&gt;
&lt;ticket_id&gt;: &lt;rsc&gt;[:&lt;role&gt;]
[&lt;rsc&gt;[:&lt;role&gt;] ...] <br>
[loss-policy=&lt;loss_policy_action&gt;]</p>

<p style="margin-top: 1em">loss_policy_action :: stop |
demote | fence | freeze</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">rsc_ticket ticket-A_public-ip
ticket-A: public-ip <br>
rsc_ticket ticket-A_bigdb ticket-A: bigdb loss-policy=fence
<br>
rsc_ticket ticket-B_storage ticket-B: drbd-a:Master
drbd-b:Master</p>

<p style="margin-top: 1em">rsctest <br>
Test resources with current resource configuration. If no
nodes are specified, tests are run on all known nodes.</p>

<p style="margin-top: 1em">The order of resources is
significant: it is assumed that later resources depend on
earlier ones.</p>

<p style="margin-top: 1em">If a resource is multi-state, it
is assumed that the role on which later resources depend is
master.</p>

<p style="margin-top: 1em">Tests are run sequentially to
prevent running the same resource on two or more nodes.
Tests are carried out only if none of the specified nodes
currently run any of the <br>
specified resources. However, it won&acirc;t verify whether
resources run on the other nodes.</p>

<p style="margin-top: 1em">Superuser privileges are
obviously required: either run this as root or setup the
sudoers file appropriately.</p>

<p style="margin-top: 1em">Note that resource testing may
take some time.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">rsctest &lt;rsc_id&gt;
[&lt;rsc_id&gt; ...] [&lt;node_id&gt; ...]</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">rsctest my_ip websvc <br>
rsctest websvc nodeB</p>

<p style="margin-top: 1em">save <br>
Save the current configuration to a file. Optionally, as
XML. Use - instead of file name to write the output to
stdout.</p>

<p style="margin-top: 1em">The save command accepts the
same selection arguments as the show command. See the help
section for show for more details.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">save [xml] [&lt;id&gt; |
type:&lt;type | tag:&lt;tag&gt; | <br>
related:&lt;obj&gt; | changed ...] &lt;file&gt;</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">save myfirstcib.txt <br>
save web-server server-config.txt</p>

<p style="margin-top: 1em">schema <br>
CIB&acirc;s content is validated by a RNG schema. Pacemaker
supports several, depending on version. At least the
following schemas are accepted by crmsh:</p>

<p style="margin-top: 1em">&Acirc;&middot;
pacemaker-1.0</p>

<p style="margin-top: 1em">&Acirc;&middot;
pacemaker-1.1</p>

<p style="margin-top: 1em">&Acirc;&middot;
pacemaker-1.2</p>

<p style="margin-top: 1em">&Acirc;&middot;
pacemaker-1.3</p>

<p style="margin-top: 1em">&Acirc;&middot;
pacemaker-2.0</p>

<p style="margin-top: 1em">Use this command to display or
switch to another RNG schema.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">schema [&lt;schema&gt;]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">schema pacemaker-1.1</p>

<p style="margin-top: 1em">set <br>
Set the value of a configured attribute. The attribute must
have a value configured previously, and can be an agent
parameter, meta attribute or utilization value.</p>

<p style="margin-top: 1em">The first argument to the
command is a path to an attribute. This is a dot-separated
sequence beginning with the name of the resource, and ending
with the name of the <br>
attribute to set.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">set &lt;path&gt;
&lt;value&gt;</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">set vip1.ip 192.168.20.5 <br>
set vm-a.force_stop 1</p>

<p style="margin-top: 1em">show <br>
The show command displays CIB objects. Without any argument,
it displays all objects in the CIB, but the set of objects
displayed by show can be limited to only objects with <br>
the given IDs or by using one or more of the special
prefixes described below.</p>

<p style="margin-top: 1em">The XML representation for the
objects can be displayed by passing xml as the first
argument.</p>

<p style="margin-top: 1em">To show one or more specific
objects, pass the object IDs as arguments.</p>

<p style="margin-top: 1em">To show all objects of a certain
type, use the type: prefix.</p>

<p style="margin-top: 1em">To show all objects in a tag,
use the tag: prefix.</p>

<p style="margin-top: 1em">To show all constraints related
to a primitive, use the related: prefix.</p>

<p style="margin-top: 1em">To show all modified objects,
pass the argument changed.</p>

<p style="margin-top: 1em">The prefixes can be used
together on a single command line. For example, to show both
the tag itself and the objects tagged by it the following
combination can be used: show <br>
tag:my-tag my-tag.</p>

<p style="margin-top: 1em">To refine a selection of objects
using multiple modifiers, the keywords and and or can be
used. For example, to select all primitives tagged foo, the
following combination <br>
can be used: show type:primitive and tag:foo.</p>

<p style="margin-top: 1em">To hide values when displaying
the configuration, use the obscure:&lt;glob&gt; argument.
This can be useful when sending the configuration over a
public channel, to avoid exposing <br>
potentially sensitive information. The &lt;glob&gt; argument
is a bash-style pattern matching attribute keys.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">show [xml] [&lt;id&gt; <br>
| changed <br>
| type:&lt;type&gt; <br>
| tag:&lt;id&gt; <br>
| related:&lt;obj&gt; <br>
| obscure:&lt;glob&gt; <br>
...]</p>

<p style="margin-top: 1em">type :: node | primitive | group
| clone | ms | rsc_template <br>
| location | colocation | order <br>
| rsc_ticket <br>
| property | rsc_defaults | op_defaults <br>
| fencing_topology <br>
| role | user | acl_target <br>
| tag</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">show webapp <br>
show type:primitive <br>
show xml tag:db tag:fs <br>
show related:webapp <br>
show type:primitive obscure:passwd</p>

<p style="margin-top: 1em">tag <br>
Define a resource tag. A tag is an id referring to one or
more resources, without implying any constraints between the
tagged resources. This can be useful for grouping <br>
conceptually related resources.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">tag &lt;tag-name&gt;:
&lt;rsc&gt; [&lt;rsc&gt; ...] <br>
tag &lt;tag-name&gt; &lt;rsc&gt; [&lt;rsc&gt; ...]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">tag web: p-webserver p-vip <br>
tag ips server-vip admin-vip</p>

<p style="margin-top: 1em">template <br>
The specified template is loaded into the editor. It&acirc;s
up to the user to make a good CRM configuration out of it.
See also the template section.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">template [xml] url</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">template two-apaches.txt</p>

<p style="margin-top: 1em">upgrade <br>
Attempts to upgrade the CIB to validate with the current
version. Commonly, this is required if the error CIB not
supported occurs. It typically means that the active CIB
<br>
version is coming from an older release.</p>

<p style="margin-top: 1em">As a safety precaution, the
force argument is required if the validation-with attribute
is set to anything other than 0.6. Thus in most cases, it is
required.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">upgrade [force]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">upgrade force</p>

<p style="margin-top: 1em">user <br>
Users which normally cannot view or manage cluster
configuration can be allowed access to parts of the CIB. The
access is defined by a set of read, write, and deny rules as
<br>
in role definitions or by referencing roles. The latter is
considered best practice.</p>

<p style="margin-top: 1em">For more information on rule
expressions, see Syntax: Rule expressions.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">user &lt;uid&gt;
{roles|rules}</p>

<p style="margin-top: 1em">roles :: role:&lt;role-ref&gt;
[role:&lt;role-ref&gt; ...] <br>
rules :: rule [rule ...]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">user joe role:app1_admin
role:read_all</p>

<p style="margin-top: 1em">validate-all <br>
Call the validate-all action for the resource, if
possible.</p>

<p style="margin-top: 1em">Limitations:</p>

<p style="margin-top: 1em">&Acirc;&middot; The resource
agent must implement the validate-all action.</p>

<p style="margin-top: 1em">&Acirc;&middot; The current user
must be root.</p>

<p style="margin-top: 1em">&Acirc;&middot; The primitive
resource must not use nvpair references.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">validate-all &lt;rsc&gt;</p>

<p style="margin-top: 1em">verify <br>
Verify the contents of the CIB which would be committed.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">verify</p>

<p style="margin-top: 1em">xml <br>
Even though we promissed no xml, it may happen, but
hopefully very very seldom, that an element from the CIB
cannot be rendered in the configuration language. In that
case, <br>
the element will be shown as raw xml, prefixed by this
command. That element can then be edited like any other. If
the shell finds out that after the change it can digest it,
<br>
then it is going to be converted into the normal
configuration language. Otherwise, there is no need to use
xml for configuration.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">xml &lt;xml&gt;</p>

<p style="margin-top: 1em">template - Import configuration
from templates <br>
User may be assisted in the cluster configuration by
templates prepared in advance. Templates consist of a
typical ready configuration which may be edited to suit
particular user <br>
needs.</p>

<p style="margin-top: 1em">This command enters a template
level where additional commands for configuration/template
management are available.</p>

<p style="margin-top: 1em">apply <br>
Copy the current or given configuration to the current CIB.
By default, the CIB is replaced, unless the method is set to
&quot;update&quot;.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">apply [&lt;method&gt;]
[&lt;config&gt;]</p>

<p style="margin-top: 1em">method :: replace | update</p>

<p style="margin-top: 1em">delete <br>
Remove a configuration. The loaded (active) configuration
may be removed by force.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">delete &lt;config&gt;
[force]</p>

<p style="margin-top: 1em">edit <br>
Edit current or given configuration using your favourite
editor.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">edit [&lt;config&gt;]</p>

<p style="margin-top: 1em">list <br>
When called with no argument, lists existing templates and
configurations.</p>

<p style="margin-top: 1em">Given the argument templates,
lists the available templates.</p>

<p style="margin-top: 1em">Given the argument configs,
lists the available configurations.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">list [templates|configs]</p>

<p style="margin-top: 1em">load <br>
Load an existing configuration. Further edit, show, and
apply commands will refer to this configuration.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">load &lt;config&gt;</p>

<p style="margin-top: 1em">new <br>
Create a new configuration from one or more templates. Note
that configurations and templates are kept in different
places, so it is possible to have a configuration name <br>
equal a template name.</p>

<p style="margin-top: 1em">If you already know which
parameters are required, you can set them directly on the
command line.</p>

<p style="margin-top: 1em">The parameter name id is set by
default to the name of the configuration.</p>

<p style="margin-top: 1em">If no parameters are being set
and you don&acirc;t want a particular name for your
configuration, you can call this command with a template
name as the only parameter. A unique <br>
configuration name based on the template name will be
generated.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">new [&lt;config&gt;]
&lt;template&gt; [&lt;template&gt; ...] [params name=value
...]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">new vip virtual-ip <br>
new bigfs ocfs2 params device=/dev/sdx8 directory=/bigfs
<br>
new apache</p>

<p style="margin-top: 1em">show <br>
Process the current or given configuration and display the
result.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">show [&lt;config&gt;]</p>

<p style="margin-top: 1em">cibstatus - CIB status
management and editing <br>
The status section of the CIB keeps the current status of
nodes and resources. It is modified only on events, i.e.
when some resource operation is run or node status changes.
For <br>
obvious reasons, the CRM has no user interface with which it
is possible to affect the status section. From the
user&acirc;s point of view, the status section is
essentially a <br>
read-only part of the CIB. The current status is never even
written to disk, though it is available in the PE (Policy
Engine) input files which represent the history of cluster
<br>
motions. The current status may be read using the cibadmin
-Q command.</p>

<p style="margin-top: 1em">It may sometimes be of interest
to see how status changes would affect the Policy Engine.
The set of &acirc;cibstatus&lsquo; level commands allow the
user to load status sections from <br>
various sources and then insert or modify resource
operations or change nodes&acirc; state.</p>

<p style="margin-top: 1em">The effect of those changes may
then be observed by running the ptest command at the
configure level or simulate and run commands at this level.
The ptest runs with the user <br>
edited CIB whereas the latter two commands run with the CIB
which was loaded along with the status section.</p>

<p style="margin-top: 1em">The simulate and run commands as
well as all status modification commands are implemented
using crm_simulate(8).</p>

<p style="margin-top: 1em">load <br>
Load a status section from a file, a shadow CIB, or the
running cluster. By default, the current (live) status
section is modified. Note that if the live status section is
<br>
modified it is not going to be updated if the cluster status
changes, because that would overwrite the user changes. To
make crm drop changes and resume use of the running <br>
cluster status, run load live.</p>

<p style="margin-top: 1em">All CIB shadow configurations
contain the status section which is a snapshot of the status
section taken at the time the shadow was created. Obviously,
this status section <br>
doesn&acirc;t have much to do with the running cluster
status, unless the shadow CIB has just been created.
Therefore, the ptest command by default uses the running
cluster status <br>
section.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">load
{&lt;file&gt;|shadow:&lt;cib&gt;|live}</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">load bug-12299.xml <br>
load shadow:test1</p>

<p style="margin-top: 1em">node <br>
Change the node status. It is possible to throw a node out
of the cluster, make it a member, or set its state to
unclean.</p>

<p style="margin-top: 1em">online <br>
Set the node_state crmd attribute to online and the expected
and join attributes to member. The effect is that the node
becomes a cluster member.</p>

<p style="margin-top: 1em">offline <br>
Set the node_state crmd attribute to offline and the
expected attribute to empty. This makes the node cleanly
removed from the cluster.</p>

<p style="margin-top: 1em">unclean <br>
Set the node_state crmd attribute to offline and the
expected attribute to member. In this case the node has
unexpectedly disappeared.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">node &lt;node&gt;
{online|offline|unclean}</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">node xen-b unclean</p>

<p style="margin-top: 1em">op <br>
Edit the outcome of a resource operation. This way you can
tell CRM that it ran an operation and that the resource
agent returned certain exit code. It is also possible to
<br>
change the operation&acirc;s status. In case the operation
status is set to something other than done, the exit code is
effectively ignored.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">op &lt;operation&gt;
&lt;resource&gt; &lt;exit_code&gt; [&lt;op_status&gt;]
[&lt;node&gt;]</p>

<p style="margin-top: 1em">operation :: probe |
monitor[:&lt;n&gt;] | start | stop | <br>
promote | demote | notify | migrate_to | migrate_from <br>
exit_code :: &lt;rc&gt; | success | generic | args | <br>
unimplemented | perm | installed | configured | not_running
| <br>
master | failed_master <br>
op_status :: pending | done | cancelled | timeout |
notsupported | error</p>

<p style="margin-top: 1em">n :: the monitor interval in
seconds; if omitted, the first <br>
recurring operation is referenced <br>
rc :: numeric exit code in range 0..9</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">op start d1 xen-b generic <br>
op start d1 xen-b 1 <br>
op monitor d1 xen-b not_running <br>
op stop d1 xen-b 0 timeout</p>

<p style="margin-top: 1em">origin <br>
Show the origin of the status section currently in use. This
essentially shows the latest load argument.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">origin</p>

<p style="margin-top: 1em">quorum <br>
Set the quorum value.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">quorum &lt;bool&gt;</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">quorum false</p>

<p style="margin-top: 1em">run <br>
Run the policy engine with the edited status section.</p>

<p style="margin-top: 1em">Add a string of v characters to
increase verbosity. Specify scores to see allocation scores
also. utilization turns on information about the remaining
capacity of nodes.</p>

<p style="margin-top: 1em">If you have graphviz installed
and X11 session, dotty(1) is run to display the changes
graphically.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">run [nograph] [v...] [scores]
[utilization]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">run</p>

<p style="margin-top: 1em">save <br>
The current internal status section with whatever
modifications were performed can be saved to a file or
shadow CIB.</p>

<p style="margin-top: 1em">If the file exists and contains
a complete CIB, only the status section is going to be
replaced and the rest of the CIB will remain intact.
Otherwise, the current user edited <br>
configuration is saved along with the status section.</p>

<p style="margin-top: 1em">Note that all modifications are
saved in the source file as soon as they are run.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">save
[&lt;file&gt;|shadow:&lt;cib&gt;]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">save bug-12299.xml</p>

<p style="margin-top: 1em">show <br>
Show the current status section in the XML format. Brace
yourself for some unreadable output. Add changed option to
get a human readable output of all changes.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">show [changed]</p>

<p style="margin-top: 1em">simulate <br>
Run the policy engine with the edited status section and
simulate the transition.</p>

<p style="margin-top: 1em">Add a string of v characters to
increase verbosity. Specify scores to see allocation scores
also. utilization turns on information about the remaining
capacity of nodes.</p>

<p style="margin-top: 1em">If you have graphviz installed
and X11 session, dotty(1) is run to display the changes
graphically.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">simulate [nograph] [v...]
[scores] [utilization]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">simulate</p>

<p style="margin-top: 1em">ticket <br>
Modify the ticket status. Tickets can be granted and
revoked. Granted tickets could be activated or put in
standby.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">ticket &lt;ticket&gt;
{grant|revoke|activate|standby}</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">ticket ticketA grant</p>

<p style="margin-top: 1em">assist - Configuration assistant
<br>
The assist sublevel is a collection of helper commands that
create or modify resources and constraints, to simplify the
creation of certain configurations.</p>

<p style="margin-top: 1em">For more information on
individual commands, see the help text for those
commands.</p>

<p style="margin-top: 1em">template <br>
This command takes a list of primitives as argument, and
creates a new rsc_template for these primitives. It can only
do this if the primitives do not already share a <br>
template and are of the same type.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">template primitive-1 primitive-2
primitive-3</p>

<p style="margin-top: 1em">weak-bond <br>
A colocation between a group of resources says that the
resources should be located together, but it also means that
those resources are dependent on each other. If one of <br>
the resources fails, the others will be restarted.</p>

<p style="margin-top: 1em">If this is not desired, it is
possible to circumvent: By placing the resources in a
non-sequential set and colocating the set with a dummy
resource which is not monitored, <br>
the resources will be placed together but will have no
further dependency on each other.</p>

<p style="margin-top: 1em">This command creates both the
constraint and the dummy resource needed for such a
colocation.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">weak-bond resource-1
resource-2</p>

<p style="margin-top: 1em">maintenance - Maintenance mode
commands <br>
Maintenance mode commands are commands that manipulate
resources directly without going through the cluster
infrastructure. Therefore, it is essential to ensure that
the cluster <br>
does not attempt to monitor or manipulate the resources
while these commands are being executed.</p>

<p style="margin-top: 1em">To ensure this, these commands
require that maintenance mode is set either for the
particular resource, or for the whole cluster.</p>

<p style="margin-top: 1em">action <br>
Invokes the given action for the resource. This is done
directly via the resource agent, so the command must be
issued while the cluster or the resource is in maintenance
<br>
mode.</p>

<p style="margin-top: 1em">Unless the action is start or
monitor, the action must be invoked on the same node as
where the resource is running. If the resource is running on
multiple nodes, the command <br>
will fail.</p>

<p style="margin-top: 1em">To use SSH for executing
resource actions on multiple nodes, append ssh after the
action name. This requires SSH access to be configured
between the nodes and the parallax <br>
python package to be installed.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">action &lt;rsc&gt;
&lt;action&gt; <br>
action &lt;rsc&gt; &lt;action&gt; ssh</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">action webserver reload <br>
action webserver monitor ssh</p>

<p style="margin-top: 1em">off <br>
Disables maintenances mode, either for the whole cluster or
for the given resource.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">off <br>
off &lt;rsc&gt;</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">off rsc1</p>

<p style="margin-top: 1em">on <br>
Enables maintenances mode, either for the whole cluster or
for the given resource.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">on <br>
on &lt;rsc&gt;</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">on rsc1</p>

<p style="margin-top: 1em">history - Cluster history <br>
Examining Pacemaker&acirc;s history is a particularly
involved task. The number of subsystems to be considered,
the complexity of the configuration, and the set of various
information <br>
sources, most of which are not exactly human readable, keep
analyzing resource or node problems accessible to only the
most knowledgeable. Or, depending on the point of view, to
<br>
the most persistent. The following set of commands has been
devised in hope to make cluster history more accessible.</p>

<p style="margin-top: 1em">Of course, looking at all
history could be time consuming regardless of how good the
tools at hand are. Therefore, one should first say which
period he or she wants to analyze. <br>
If not otherwise specified, the last hour is considered.
Logs and other relevant information is collected using crm
report. Since this process takes some time and we always
need <br>
fresh logs, information is refreshed in a much faster way
using the python parallax module. If python-parallax is not
found on the system, examining a live cluster is still <br>
possible &acirc; though not as comfortable.</p>

<p style="margin-top: 1em">Apart from examining a live
cluster, events may be retrieved from a report generated by
crm report (see also the -H option). In that case we assume
that the period stretching the <br>
whole report needs to be investigated. Of course, it is
still possible to further reduce the time range.</p>

<p style="margin-top: 1em">If you have discovered an issue
that you want to show someone else, you can use the session
pack command to save the current session as a tarball,
similar to those generated by <br>
crm report.</p>

<p style="margin-top: 1em">In order to minimize the size of
the tarball, and to make it easier for others to find the
interesting events, it is recommended to limit the time
frame which the saved session <br>
covers. This can be done using the timeframe command
(example below).</p>

<p style="margin-top: 1em">It is also possible to name the
saved session using the session save command.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">crm(live)history# limit
&quot;Jul 18 12:00&quot; &quot;Jul 18 12:30&quot; <br>
crm(live)history# session save strange_restart <br>
crm(live)history# session pack <br>
Report saved in .../strange_restart.tar.bz2 <br>
crm(live)history#</p>

<p style="margin-top: 1em">detail <br>
How much detail to show from the logs. Valid detail levels
are either 0 or 1, where 1 is the highest detail level. The
default detail level is 0.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">detail &lt;detail_level&gt;</p>

<p style="margin-top: 1em">detail_level :: small integer
(defaults to 0)</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">detail 1</p>

<p style="margin-top: 1em">diff <br>
A transition represents a change in cluster configuration or
state. Use diff to see what has changed between two
transitions.</p>

<p style="margin-top: 1em">If you want to specify the
current cluster configuration and status, use the string
live.</p>

<p style="margin-top: 1em">Normally, the first transition
specified should be the one which is older, but we are not
going to enforce that.</p>

<p style="margin-top: 1em">Note that a single configuration
update may result in more than one transition.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">diff &lt;pe&gt; &lt;pe&gt;
[status] [html]</p>

<p style="margin-top: 1em">pe ::
&lt;number&gt;|&lt;index&gt;|&lt;file&gt;|live</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">diff 2066 2067 <br>
diff pe-input-2080.bz2 live status</p>

<p style="margin-top: 1em">events <br>
By analysing the log output and looking for particular
patterns, the events command helps sifting through the logs
to find when particular events like resources changing <br>
state or node failure may have occurred.</p>

<p style="margin-top: 1em">This can be used to generate a
combined list of events from all nodes.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">events</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">events</p>

<p style="margin-top: 1em">exclude <br>
If a log is infested with irrelevant messages, those
messages may be excluded by specifying a regular expression.
The regular expressions used are Python extended. This <br>
command is additive. To drop all regular expressions, use
exclude clear. Run exclude only to see the current list of
regular expressions. Excludes are saved along with the <br>
history sessions.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">exclude
[&lt;regex&gt;|clear]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">exclude kernel.*ocfs2</p>

<p style="margin-top: 1em">graph <br>
Create a graphviz graphical layout from the PE file (the
transition). Every transition contains the cluster
configuration which was active at the time. See also
generate a <br>
directed graph from configuration.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">graph &lt;pe&gt; [&lt;gtype&gt;
[&lt;file&gt; [&lt;img_format&gt;]]]</p>

<p style="margin-top: 1em">gtype :: dot <br>
img_format :: &lsquo;dot&lsquo; output format (see the +-T+
option)</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">graph -1 <br>
graph 322 dot clu1.conf.dot <br>
graph 322 dot clu1.conf.svg svg</p>

<p style="margin-top: 1em">info <br>
The info command provides a summary of the information
source, which can be either a live cluster snapshot or a
previously generated report.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">info</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">info</p>

<p style="margin-top: 1em">latest <br>
The latest command shows a bit of recent history, more
precisely whatever happened since the last cluster change
(the latest transition). If the transition is running, the
<br>
shell will first wait until it finishes.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">latest</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">latest</p>

<p style="margin-top: 1em">limit (timeframe) <br>
This command can be used to modify the time span to examine.
All history commands look at events within a certain time
span.</p>

<p style="margin-top: 1em">For the live source, the default
time span is the last hour.</p>

<p style="margin-top: 1em">There is no time span limit for
the hb_report source.</p>

<p style="margin-top: 1em">The time period is parsed by the
dateutil python module. It covers a wide range of date
formats. For instance:</p>

<p style="margin-top: 1em">&Acirc;&middot; 3:00 (today at
3am)</p>

<p style="margin-top: 1em">&Acirc;&middot; 15:00 (today at
3pm)</p>

<p style="margin-top: 1em">&Acirc;&middot; 2010/9/1 2pm
(September 1st 2010 at 2pm)</p>

<p style="margin-top: 1em">For more examples of valid
time/date statements, please refer to the python-dateutil
documentation:</p>

<p style="margin-top: 1em">&Acirc;&middot;
dateutil.readthedocs.org</p>

<p style="margin-top: 1em">If the dateutil module is not
available, then the time is parsed using strptime and only
the kind as printed by date(1) is allowed:</p>

<p style="margin-top: 1em">&Acirc;&middot; Tue Sep 15
20:46:27 CEST 2010</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">limit [&lt;from_time&gt;]
[&lt;to_time&gt;]</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">limit 10:15 <br>
limit 15h22m 16h <br>
limit &quot;Sun 5 20:46&quot; &quot;Sun 5 22:00&quot;</p>

<p style="margin-top: 1em">log <br>
Show messages logged on one or more nodes. Leaving out a
node name produces combined logs of all nodes. Messages are
sorted by time and, if the terminal emulations supports <br>
it, displayed in different colours depending on the node to
allow for easier reading.</p>

<p style="margin-top: 1em">The sorting key is the timestamp
as written by syslog which normally has the maximum
resolution of one second. Obviously, messages generated by
events which share the same <br>
timestamp may not be sorted in the same way as they
happened. Such close events may actually happen fairly
often.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">log [&lt;node&gt; [&lt;node&gt;
...] ]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">log node-a</p>

<p style="margin-top: 1em">node <br>
Show important events that happened on a node. Important
events are node lost and join, standby and online, and
fence. Use either node names or extended regular
expressions.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">node &lt;node&gt; [&lt;node&gt;
...]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">node node1</p>

<p style="margin-top: 1em">peinputs <br>
Every event in the cluster results in generating one or more
Policy Engine (PE) files. These files describe future
motions of resources. The files are listed as full paths in
<br>
the current report directory. Add v to also see the creation
time stamps.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">peinputs
[{&lt;range&gt;|&lt;number&gt;} ...] [v]</p>

<p style="margin-top: 1em">range ::
&lt;n1&gt;:&lt;n2&gt;</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">peinputs <br>
peinputs 440:444 446 <br>
peinputs v</p>

<p style="margin-top: 1em">refresh <br>
This command makes sense only for the live source and makes
crm collect the latest logs and other relevant information
from the logs. If you want to make a completely new <br>
report, specify force.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">refresh [force]</p>

<p style="margin-top: 1em">resource <br>
Show actions and any failures that happened on all specified
resources on all nodes. Normally, one gives resource names
as arguments, but it is also possible to use extended <br>
regular expressions. Note that neither groups nor clones or
master/slave names are ever logged. The resource command is
going to expand all of these appropriately, so that <br>
clone instances or resources which are part of a group are
shown.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">resource &lt;rsc&gt;
[&lt;rsc&gt; ...]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">resource bigdb public_ip <br>
resource my_.*_db2 <br>
resource ping_clone</p>

<p style="margin-top: 1em">session <br>
Sometimes you may want to get back to examining a particular
history period or bug report. In order to make that easier,
the current settings can be saved and later <br>
retrieved.</p>

<p style="margin-top: 1em">If the current history being
examined is coming from a live cluster the logs, PE inputs,
and other files are saved too, because they may disappear
from nodes. For the <br>
existing reports coming from hb_report, only the directory
location is saved (not to waste space).</p>

<p style="margin-top: 1em">A history session may also be
packed into a tarball which can then be sent to support.</p>

<p style="margin-top: 1em">Leave out subcommand to see the
current session.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">session [{save|load|delete}
&lt;name&gt; | pack [&lt;name&gt;] | update | list]</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">session save bnc966622 <br>
session load rsclost-2 <br>
session list</p>

<p style="margin-top: 1em">setnodes <br>
In case the host this program runs on is not part of the
cluster, it is necessary to set the list of nodes.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">setnodes node &lt;node&gt;
[&lt;node&gt; ...]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">setnodes node_a node_b</p>

<p style="margin-top: 1em">show <br>
Every transition is saved as a PE file. Use this command to
render that PE file either as configuration or status. The
configuration output is the same as crm configure show.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">show &lt;pe&gt; [status]</p>

<p style="margin-top: 1em">pe ::
&lt;number&gt;|&lt;index&gt;|&lt;file&gt;|live</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">show 2066 <br>
show pe-input-2080.bz2 status</p>

<p style="margin-top: 1em">source <br>
Events to be examined can come from the current cluster or
from a hb_report report. This command sets the source.
source live sets source to the running cluster and system
<br>
logs. If no source is specified, the current source
information is printed.</p>

<p style="margin-top: 1em">In case a report source is
specified as a file reference, the file is going to be
unpacked in place where it resides. This directory is not
removed on exit.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">source
[&lt;dir&gt;|&lt;file&gt;|live]</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">source live <br>
source /tmp/customer_case_22.tar.bz2 <br>
source /tmp/customer_case_22 <br>
source</p>

<p style="margin-top: 1em">transition <br>
This command will print actions planned by the PE and run
graphviz (dotty) to display a graphical representation of
the transition. Of course, for the latter an X11 session
<br>
is required. This command invokes ptest(8) in
background.</p>

<p style="margin-top: 1em">The showdot subcommand runs
graphviz (dotty) to display a graphical representation of
the .dot file which has been included in the report.
Essentially, it shows the <br>
calculation produced by pengine which is installed on the
node where the report was produced. In optimal case this
output should not differ from the one produced by the <br>
locally installed pengine.</p>

<p style="margin-top: 1em">The log subcommand shows the
full log for the duration of the transition.</p>

<p style="margin-top: 1em">A transition can also be saved
to a CIB shadow for further analysis or use with cib or
configure commands (use the save subcommand). The shadow
file name defaults to the name <br>
of the PE input file.</p>

<p style="margin-top: 1em">If the PE input file number is
not provided, it defaults to the last one, i.e. the last
transition. The last transition can also be referenced with
number 0. If the number is <br>
negative, then the corresponding transition relative to the
last one is chosen.</p>

<p style="margin-top: 1em">If there are warning and error
PE input files or different nodes were the DC in the
observed timeframe, it may happen that PE input file numbers
collide. In that case provide <br>
some unique part of the path to the file.</p>

<p style="margin-top: 1em">After the ptest output, logs
about events that happened during the transition are
printed.</p>

<p style="margin-top: 1em">The tags subcommand scans the
logs for the transition and return a list of key events
during that transition. For example, the tag error will be
returned if there are any <br>
errors logged during the transition.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">transition
[&lt;number&gt;|&lt;index&gt;|&lt;file&gt;] [nograph] [v...]
[scores] [actions] [utilization] <br>
transition showdot
[&lt;number&gt;|&lt;index&gt;|&lt;file&gt;] <br>
transition log [&lt;number&gt;|&lt;index&gt;|&lt;file&gt;]
<br>
transition save [&lt;number&gt;|&lt;index&gt;|&lt;file&gt;
[name]] <br>
transition tags
[&lt;number&gt;|&lt;index&gt;|&lt;file&gt;]</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">transition <br>
transition 444 <br>
transition -1 <br>
transition pe-error-3.bz2 <br>
transition node-a/pengine/pe-input-2.bz2 <br>
transition showdot 444 <br>
transition log <br>
transition save 0 enigma-22</p>

<p style="margin-top: 1em">transitions <br>
A transition represents a change in cluster configuration or
state. This command lists the transitions in the current
timeframe.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">transitions</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">transitions</p>

<p style="margin-top: 1em">wdiff <br>
A transition represents a change in cluster configuration or
state. Use wdiff to see what has changed between two
transitions as word differences on a line-by-line basis.</p>

<p style="margin-top: 1em">If you want to specify the
current cluster configuration and status, use the string
live.</p>

<p style="margin-top: 1em">Normally, the first transition
specified should be the one which is older, but we are not
going to enforce that.</p>

<p style="margin-top: 1em">Note that a single configuration
update may result in more than one transition.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">wdiff &lt;pe&gt; &lt;pe&gt;
[status]</p>

<p style="margin-top: 1em">pe ::
&lt;number&gt;|&lt;index&gt;|&lt;file&gt;|live</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">wdiff 2066 2067 <br>
wdiff pe-input-2080.bz2 live status</p>

<p style="margin-top: 1em">report <br>
Interface to a tool for creating a cluster report. A report
is an archive containing log files, configuration files,
system information and other relevant data for a given time
<br>
period. This is a useful tool for collecting data to attach
to bug reports, or for detecting the root cause of errors
resulting in resource failover, for example.</p>

<p style="margin-top: 1em">See crmsh_hb_report(8) for more
details on arguments, or call crm report -h</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">report -f
{time|&quot;cts:&quot;testnum} [-t time] [-u user] [-l file]
<br>
[-n nodes] [-E files] [-p patt] [-L patt] [-e prog] <br>
[-MSDZAVsvhd] [dest]</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">report -f 2pm report_1 <br>
report -f &quot;2007/9/5 12:30&quot; -t &quot;2007/9/5
14:00&quot; report_2 <br>
report -f 1:00 -t 3:00 -l /var/log/cluster/ha-debug report_3
<br>
report -f &quot;09sep07 2:00&quot; -u hbadmin report_4 <br>
report -f 18:00 -p &quot;usern.*&quot; -p
&quot;admin.*&quot; report_5 <br>
report -f cts:133 ctstest_133</p>

<p style="margin-top: 1em">end (cd, up) <br>
The end command ends the current level and the user moves to
the parent level. This command is available everywhere.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">end</p>

<p style="margin-top: 1em">help <br>
The help command prints help for the current level or for
the specified topic (command). This command is available
everywhere.</p>

<p style="margin-top: 1em">Usage:</p>

<p style="margin-top: 1em">help [&lt;topic&gt;]</p>

<p style="margin-top: 1em">quit (exit, bye) <br>
Leave the program.</p>

<p style="margin-top: 1em">BUGS <br>
Even though all sensible configurations (and most of those
that are not) are going to be supported by the crm shell, I
suspect that it may still happen that certain XML <br>
constructs may confuse the tool. When that happens, please
file a bug report.</p>

<p style="margin-top: 1em">The crm shell will not try to
update the objects it does not understand. Of course, it is
always possible to edit such objects in the XML format.</p>

<p style="margin-top: 1em">AUTHORS <br>
Dejan Muhamedagic, &lt;dejan@suse.de&gt; Kristoffer Gronlund
&lt;kgronlund@suse.com&gt; and many OTHERS</p>

<p style="margin-top: 1em">SEE ALSO <br>
crm_resource(8), crm_attribute(8), crm_mon(8),
cib_shadow(8), ptest(8), dotty(1), crm_simulate(8),
cibadmin(8)</p>

<p style="margin-top: 1em">COPYING <br>
Copyright (C) 2008-2013 Dejan Muhamedagic. Copyright (C)
2013 Kristoffer Gronlund.</p>

<p style="margin-top: 1em">Free use of this software is
granted under the terms of the GNU General Public License
(GPL).</p>

<p style="margin-top: 1em">crm 2.3.2 11/03/2016 CRM(8)</p>
<hr>
</body>
</html>
