<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 19:09:41 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>COURIER(8) Double Precision, Inc. COURIER(8)</p>

<p style="margin-top: 1em">NAME <br>
courier - The Courier mail server</p>

<p style="margin-top: 1em">SYNOPSIS <br>
courier {start | stop | restart | flush | flush qid | clear
user@domain | clear all | show all }</p>

<p style="margin-top: 1em">DESCRIPTION <br>
The Courier mail server is a modular multi-protocol E-mail
transport agent. The courier command is an administrative
command, and most of its options are only available to the
<br>
superuser.</p>

<p style="margin-top: 1em">&quot;courier start&quot; starts
the server by running /usr/lib/courier/courierctl.start in
the background. &quot;courier stop&quot; immediately stops
all the Courier mail server processes and <br>
aborts all current mail deliveries. &quot;courier
restart&quot; restarts the Courier mail server server. A
restart is often needed for certain configuration changes to
take effect. <br>
&quot;courier restart&quot; waits for all current deliveries
to complete before restarting. This is the &quot;nice&quot;
way to restart the mail server. &quot;courier flush&quot;
takes all undelivered <br>
messages in the queue and attempts to deliver them
immediately, instead of waiting until their next scheduled
attempted delivery time. &quot;courier flush&quot; can be
optionally followed <br>
by a message queue ID in order to schedule an immediate
delivery attempt for only a single message. Message queue
IDs are displayed by the mailq(1)[1] command.</p>

<p style="margin-top: 1em">Please note that courier start
runs the main Courier mail server scheduling engine only. It
does not start any other daemons that you may have, such as
the ESMTP or the IMAP <br>
daemon.</p>

<p style="margin-top: 1em">&quot;courier show all&quot;
lists all E-mail addresses currently blacklisted for
backscatter. &quot;courier clear user@domain&quot; manually
clears &lt;user@domain&gt; from the backscatter blacklist.
<br>
&quot;courier clear all&quot; removes all addresses from the
backscatter blacklist. When the Courier mail server
encounters a delivery failure to an E-mail address the
Courier mail server <br>
may stop accepting any more messages to the same address in
order to minimize generation of so-called &quot;backscatter
bounces&quot;. This does not occur in all cases, see
&quot;Backscatter <br>
suppression&quot; in the Courier mail server&rsquo;s
installation instructions for more information.</p>

<p style="margin-top: 1em">The Courier mail server will
resume accepting messages to the blacklisted address if the
delivery attempt originally encountered a temporary failure,
and a subsequent retry <br>
succesfully delivered the message, or if more than two hours
elapsed since the delivery failure. Use the
&quot;clear&quot; command to manually clear the E-mail
address from the backscatter <br>
blacklist. This may be useful if the undeliverable message
is manually removed from the Courier mail server&rsquo;s
mail queue, using the &quot;cancel&quot; command. Even if
the message is <br>
cancelled, the Courier mail server will continue to refuse
accepting mail for this address for up to two hours. The
&quot;clear&quot; command can be use to reenable mail
acceptance before <br>
then.</p>

<p style="margin-top: 1em">CONFIGURATION FILES <br>
The Courier mail server uses several configuration files
which are located in /etc/courier. These configuration files
are plain text files that can be modified with any text <br>
editor. In certain instances a subdirectory is used, and all
plain text files in the subdirectory are concatenated and
are considered to be a single, consolidated, configuration
<br>
file. Unless otherwise specified, you must run courier
restart for any changes to these files to take effect.</p>

<p style="margin-top: 1em">aliasfilteracct <br>
This file contains one line, containing the home directory
of the account that&rsquo;s used for filtering mail
addressed to local alias lists.</p>

<p style="margin-top: 1em">When mail filtering is enabled,
local recipients have the ability to define mail filters
which can selectively reject unwanted mail.
/etc/courier/aliases may define local <br>
mail aliases that contain one or more recipients. If it is
desired to use local mail filtering for mail addressed to an
alias address, designate a local account that will be <br>
used to specify filtering instructions, and put its home
directory into this control file. The filtering argument
will be &quot;alias-address&quot; where address is the name
of the <br>
alias. See localmailfilter(7)[2] for more information.</p>

<p style="margin-top: 1em">Due to technical limitations,
content filtering is not available for multiple-recipient
aliases.</p>

<p style="margin-top: 1em">Changes to this file take effect
immediately.</p>

<p style="margin-top: 1em">autoresponsesquota <br>
This file sets the systemwide quota on autoreplies, if
autoreplies and mail filtering are enabled. Note that this
can only really be effective if there is no login access to
<br>
the mail account, since this autoreply quota can be
trivially overriden.</p>

<p style="margin-top: 1em">The autoresponsesquota file
contains one line: &quot;Cnnn&quot; or &quot;Snnn&quot; (or
both strings, on the same line). Cnnn: allow up to #nnn
autoreplies to be created. Snnn: allow up to <br>
#nnn bytes as the total size of all autoreplies, combined.
If both Cnnn and Snnn are specified, both quotas apply. If
this file does not exist, there is no limit on <br>
autoreplies. This quota setting applies systemwide. To
override the quota setting for a particular Maildir, create
the autoresponsesquota file in that Maildir (which takes
<br>
precedence).</p>

<p style="margin-top: 1em">backuprelay <br>
This file contains one line, containing a name of a machine
where mail will be rerouted if it cannot be immediately
delivered. Spaces are not allowed in this file.</p>

<p style="margin-top: 1em">Mail gets rerouted if it cannot
be delivered after the time interval specified by the
warntime configuration file. When backuprelay is provided a
delayed delivery status <br>
notification will NOT be generated. The message will be
rerouted even if the recipient&rsquo;s delivery status
notification setting does not include a delayed notification
request.</p>

<p style="margin-top: 1em">This feature is intended for use
by relays that handle large quantities of mail, where you
don&rsquo;t want to accumulate a large mail queue for
unreachable mail servers. Please <br>
note that ALL undeliverable mail will be rerouted in this
fashion. Even if the recipient of a message is a local
recipient - and the recipient&rsquo;s mail filter is
rejecting the <br>
message with a temporary error code - the message will still
be rerouted if it&rsquo;s undeliverable after the specified
amount of time.</p>

<p style="margin-top: 1em">Although currently SMTP is the
only meaningful application for this feature, the Courier
mail server is a protocol-independent mail server, and the
backup relay function can <br>
be extended to other protocols, as they become
available.</p>

<p style="margin-top: 1em">Multiple backup relays can be
used by simply assigning multiple IP addresses to the same
machine name. Note that the Courier mail server checks for
both MX and A records for <br>
the machine specified in this configuration file.</p>

<p style="margin-top: 1em">It&rsquo;s important to note
that when this setting is specified, warning messages get
turned off for all messages, including messages addressed to
local recipients. If a temporary <br>
delivery error prevents a message from being delivered to a
local mailbox, it remains in the queue until the temporary
error condition gets cleared. Normally, if the message <br>
remains in the queue beyond the warning interval, the
warning message gets generated. When this setting is
specified, the warning message gets replaced with a forward
to the <br>
backup relay, but this occurs only for messages that are
delivered via SMTP.</p>

<p style="margin-top: 1em">batchsize <br>
This file contains one line, containing a single number.
This number specifies the absolute maximum number of
recipients for a single message. If the Courier mail server
<br>
receives a message with more recipients, the message is
duplicated as often as necessary until each copy of the
message has no more than batchsize recipients. If batchsize
is <br>
missing, it defaults to 100 recipients per message.</p>

<p style="margin-top: 1em">bofh <br>
This configuration file configures domain-based junk mail
filters. Lines in this configuration files that begin with
the # character are considered comments, and are ignored.
<br>
The remaining lines contain the following directives, in any
order:</p>

<p style="margin-top: 1em">badfrom user@domain <br>
Reject all mail with the return address of
&lt;user@domain&gt;.</p>

<p style="margin-top: 1em">badfrom @domain <br>
Reject all mail with the return address of
&lt;anything@domain&gt;.</p>

<p style="margin-top: 1em">badfrom @.domain <br>
Reject all mail with the return address of
&lt;anything@anything.domain&gt;.</p>

<p style="margin-top: 1em">badfrom user@.domain <br>
Reject all mail with the return address of
&lt;user@anything.domain&gt;.</p>

<p style="margin-top: 1em">badmx N <br>
Reject all mail with a return address in any mail domain
whose listed mail servers include server &quot;N&quot;.
&quot;N&quot; is an IP address. The BOFHCHECKDNS option in
the esmtp <br>
configuration file must also be enabled (this is the default
setting) in order for this additional checking to take
place. Note that this is &quot;best effort&quot; check. A
DNS <br>
failure to look up A records for hostnames returned in the
MX record may hide the blacklisted server from view.</p>

<p style="margin-top: 1em">freemail domain [domain2]
[domain3]... <br>
Reject all mail with a return address
&lt;anything@domain&gt; unless the mail is received from a
mail relay whose hostname is in the same domain.
&quot;domain2&quot; and &quot;domain3&quot; are <br>
optional, and specifies other domains that the mail
relay&rsquo;s hostname may belong to. For example:
&quot;freemail example.com domain.com&quot; specifies that
mail with a return <br>
address @example.com will be accepted only from a mail relay
with a hostname in the example.com or domain.com domain.
Note that this setting requires that DNS lookup be <br>
enabled for incoming ESMTP connections (which is the default
setting).</p>

<p style="margin-top: 1em">spamtrap user@domain <br>
Reject all mail that has &lt;user@domain&gt; listed as one
of its recipients.</p>

<p style="margin-top: 1em">Note <br>
For local mailboxes, &rsquo;domain&rsquo; must be set to the
contents of the me configuration file, or the server&rsquo;s
hostname. Also, this check is made after any alias
processing <br>
takes place. Suggested usage: create a single local spamtrap
account, then create aliases in the alias file that point to
the spamtrap account.</p>

<p style="margin-top: 1em">maxrcpts N [hard] <br>
Accept the first N recipient addresses per message, maximum.
The remaining recipients are rejected. An optional verbatim
token &quot;hard&quot; specifies that the remaining <br>
recipients will immediately be returned as undeliverable
(otherwise the remaining recipients are rejected as
&quot;temporary unavailable&quot;, and may be accepted on a
later <br>
delivery attempt). If not specified, the first 100
recipients are accepted.</p>

<p style="margin-top: 1em">opt BOFHCHECKHELO=1 <br>
Verify the hostname provided in the ESMTP HELO/EHLO
statement. &acirc;opt BOFHCHECKHELO=1&acirc; is a global
default, which may be overridden by setting the
BOFHCHECKHELO <br>
environment variable in the SMTP access file. See
makesmtpaccess(8)[3] for more information. &acirc;opt
BOFHCHECKHELO=1&acirc; enables ESMTP HELO/EHLO checking by
default, and ESMTP <br>
HELO/EHLO checking may be turned off for individual IP
address ranges by setting BOFHCHECKHELO to 0 using
makesmtpaccess(8)[3]. Alternatively, HELO/EHLO checking may
be <br>
turned off by default, and enabled for specific IP address
ranges by using makesmtpaccess(8)[3] to set BOFHCHECKHELO to
1. See makesmtpaccess(8)[3] for more information.</p>

<p style="margin-top: 1em">opt BOFHCHECKHELO=2 <br>
Setting to BOFHCHECKHELO2 has the effect of returning a
temporary SMTP error code, instead of a permanent SMTP error
code, for a failed HELO/EHLO SPF check.</p>

<p style="margin-top: 1em">opt BOFHHEADERLIMIT=n <br>
Reject messages whose headers exceed n bytes in size
(minimum 1,000 bytes, default 100,000 bytes).</p>

<p style="margin-top: 1em">opt BOFHNOBASE64TEXT=1 <br>
Reject messages with base64-encoded text/plain or text/html
content.</p>

<p style="margin-top: 1em">opt BOFHSPFHELO=keywords <br>
Use Sender Policy Framework to verify the HELO or EHLO
domain sent by the connecting SMTP client. See Sender Policy
Framework Keywords below for a list of possible <br>
keywords.</p>

<p style="margin-top: 1em">SPF checking is not used for
HELO or EHLO commands that specify an IP address instead of
a domain name.</p>

<p style="margin-top: 1em">Note <br>
This setting may be used in combination with opt
BOFHCHECKHELO=1. The BOFHCHECKHELO=1 check is disabled if
SPF verification of the HELO/EHLO results in the SPF status
<br>
of &acirc;pass&acirc;. This makes sense: if the HELO/EHLO
domains complies with the domain&rsquo;s SPF, it is not
necessary to check it further.</p>

<p style="margin-top: 1em">opt BOFHSPFMAILFROM=keywords
<br>
Use Sender Policy Framework to verify the return address in
the MAIL FROM command sent by the connecting SMTP client.
See Sender Policy Framework Keywords below for a <br>
list of possible keywords.</p>

<p style="margin-top: 1em">Note <br>
No SPF checking is done for if the MAIL FROM command
specifies an empty return address (a bounce). There&rsquo;s
nothing to check.</p>

<p style="margin-top: 1em">opt BOFHSPFFROM=keywords <br>
Use Sender Policy Framework to verify the return address in
the From: header. See Sender Policy Framework Keywords below
for important information, and a list of possible <br>
keywords.</p>

<p style="margin-top: 1em">opt BOFHSPFHARDERROR=keywords
<br>
This setting lists the unacceptable SPF results that should
result in a permanent error. All other unacceptable SPF
results are kicked back with a temporary error <br>
indication, inviting the sender to try again later.</p>

<p style="margin-top: 1em">The default setting for
BOFHSPFHARDERROR is fail,softfail.</p>

<p style="margin-top: 1em">opt BOFHSPFTRUSTME=1 <br>
Disable all SPF checks for any connecting client that has
relaying privileges (RELAYCLIENT is explicitly set, or
inherited after a successful SMTP authentication).</p>

<p style="margin-top: 1em">opt BOFHSPFNOVERBOSE=1 <br>
This setting disables custom SPF rejection messages. Any SPF
rejection message specified by the SPF policy is replaced by
a stock, bland message. The author of this SPF <br>
implementation believes that there&rsquo;s a minor security
issue with letting an external site control the error
messages issued by your mail server. The same author does
not <br>
believe that this is such a big deal, but security-sensitive
minds may choose to enable this setting, and sleep easy at
night.</p>

<p style="margin-top: 1em">opt BOFHSUPPRESSBACKSCATTER=list
<br>
This is one of the two settings that controls which messages
are subject to backscatter suppression. The other setting,
ESMTP_BLOCKBACKSCATTER is set in the courierd <br>
configuration file, which contains further
documentation.</p>

<p style="margin-top: 1em">&acirc;list&acirc; is a
comma-separated list of message sources. The possible
message sources are:</p>

<p style="margin-top: 1em">authsmtp <br>
Messages received via SMTP from clients with relaying
privileges (authenticated SMTP, or IP addresses that always
have relaying privileges.</p>

<p style="margin-top: 1em">smtp <br>
All other messages received via SMTP.</p>

<p style="margin-top: 1em">none <br>
Do not suppress backscatter messages from any source.</p>

<p style="margin-top: 1em">The default setting is
&acirc;opt BOFHSUPPRESSBACKSCATTER=smtp&acirc;. The other
possible values are &acirc;opt
BOFHSUPPRESSBACKSCATTER=smtp,authsmtp&acirc; (which
suppresses backscatter from <br>
all SMTP mail), and &acirc;opt
BOFHSUPPRESSBACKSCATTER=none&acirc;.</p>

<p style="margin-top: 1em">calendarmode <br>
This configuration file enables basic calendaring features
in the webmail server. Calendaring is currently considered
experimental in nature, and the current implementation <br>
provides basic calendaring services. If this file does not
exist, calendaring options are disabled. If this file exists
it should contain a single word: &quot;local&quot;. For
example:</p>

<p style="margin-top: 1em">echo &quot;local&quot;
&gt;/etc/courier/calendarmode <br>
This configuration file must be globally readable, so make
sure that your umask is not set too tight.</p>

<p style="margin-top: 1em">courierd <br>
This configuration file specifies several parameters
relating to general the Courier mail server configuration. A
default configuration file will be installed, and you should
<br>
consult its contents for additional information.</p>

<p style="margin-top: 1em">defaultdomain <br>
This file contains one line whose contents is a valid mail
domain. Most header rewriting functions will append
@defaultdomain to all E-mail addresses that do not specify a
<br>
domain. If defaultdomain is missing, the Courier mail server
uses the contents of the me control file.</p>

<p style="margin-top: 1em">When the ESMTP server receives a
&acirc;RCPT TO&acirc; command containing the address
&lt;user@[ip.address]&gt;, and the IP address is the same as
the IP address of the socket it&rsquo;s listening <br>
on, the ESMTP server replaces the IP address with the
contents of the defaultdomain control file. If defaultdomain
is missing, the Courier mail server uses the contents of
<br>
the me control file.</p>

<p style="margin-top: 1em">The contents of defaultdomain
are also appended to return addresses to mail sent from the
Courier mail server&rsquo;s webmail server, if they
don&rsquo;t already have a domain. If <br>
defaultdomain does not exist, the Courier mail
server&rsquo;s webmail server obtain the machine hostname,
and uses that.</p>

<p style="margin-top: 1em">Note <br>
The mail domain in defaultdomain should be one of the local
domains, as defined by the locals and the hosteddomains
control files.</p>

<p style="margin-top: 1em">Otherwise, if a domain-less
address in mail headers gets augmented with defaultdomain
and the recipient replies to the message, upon receipt
Courier won&rsquo;t recognize the <br>
recipient address as a local mailbox. This might not
necessarily be wrong, but the consequences of such an action
must be clearly understood.</p>

<p style="margin-top: 1em">Warning <br>
If you change the contents of this configuration file, it
may be necessary to rerun the makealiases command again,
else your mail will promptly begin to bounce. If you <br>
don&rsquo;t have this configuration file defined, and you
change the system&rsquo;s network host name, you may also
need to run makealiases.</p>

<p style="margin-top: 1em">dotextension <br>
This file contains one line whose contents specify the name
of dot-files in users&rsquo; home directories which contain
delivery instructions. If this file does not exist, the <br>
Courier mail server reads $HOME/.courier,
$HOME/.courier-foo, $HOME/.courier-default, and so on. If
this file contains the text &quot;qmail&quot;, the Courier
mail server will instead <br>
read $HOME/.qmail, $HOME/.qmail-foo, $HOME/.qmail-default,
and so on.</p>

<p style="margin-top: 1em">dsnfrom <br>
This file contains one line specifying the contents of the
From: header that the Courier mail server puts in all
delivery status notifications. This file specifies a
complete <br>
header, except for the &quot;From: &quot; part. If dsnfrom
is missing, then the Courier mail server uses the following
header: &quot;Courier mail server mail server at me&quot;
&lt;@&gt;</p>

<p style="margin-top: 1em">dsnlimit <br>
Maximum size, in bytes, of a message whose contents are
included in delivery status notifications. By default, the
entire message is only included in non-delivery notices <br>
(failures). Only the headers will be returned for delay
notifications (warnings) and return receipts; or for
failures if the original message is larger than dsnlimit. If
<br>
missing, dsnlimit is set to 32K.</p>

<p style="margin-top: 1em">The sender can request that the
entire message be returned even on delayed notices or return
receipts, however the Courier mail server will ignore this
request if the message <br>
size exceeds this limit.</p>

<p style="margin-top: 1em">enablefiltering <br>
This configuration file enables the global mail filtering
API for selected mail sources. This file, if it exists,
contains a single line of text that specifies which kind of
<br>
mail will be filtered. The possible values are:</p>

<p style="margin-top: 1em">esmtp <br>
Enables global mail filtering for mail received via
ESMTP.</p>

<p style="margin-top: 1em">local <br>
Specifies that mail received from logged on users, via
sendmail, and mail forwarded from dot-courier(5)[4] will be
filtered using the global mail filtering API.</p>

<p style="margin-top: 1em">uucp <br>
Specifies that mail received from UUCP will be filtered.</p>

<p style="margin-top: 1em">If you want to specify more than
one source of mail, such as ESMTP and local mail, specify
both esmtp and local, separated by a space character.</p>

<p style="margin-top: 1em">Note <br>
The global mail filtering API is described, in detail, in
the courierfilter(8)[5] manual page. This is NOT the
traditional user-controlled mail filtering, such as <br>
maildrop(1)[6]. A global mail filter is a daemon process
that selectively accepts or rejects incoming mail, based on
arbitrary criteria.</p>

<p style="margin-top: 1em">esmtpacceptmailfor <br>
This file lists all domains that the Courier mail server
accepts mail for via ESMTP. This file is in the same format
as the locals file. If this file is missing, the Courier
<br>
mail server uses the single domain specified in me (or the
system machine name).</p>

<p style="margin-top: 1em">esmtpacceptmailfor.dat <br>
This is a binary database file that lists additional domains
that the Courier mail server accepts mail for, just like
esmtpacceptmailfor. A binary database file will be <br>
faster than a flat text file when the number of domains is
large. The Courier mail server will accept mail for domains
listed in either esmtpacceptmailfor or <br>
esmtpacceptmailfor.dat. esmtpacceptmailfor.dat is created by
the makeacceptmailfor command. You can use both
esmtpacceptmailfor.dat and esmtpacceptmailfor at the same
time. <br>
Put your most popular domains in esmtpacceptmailfor, and put
the rest of them into esmtpacceptmailfor.dat.</p>

<p style="margin-top: 1em">esmtpauthclient <br>
This configuration file configures ESMTP authentication for
the ESMTP client. This is a text file of zero or more lines
that contain the following fields:</p>

<p style="margin-top: 1em">relay userid password <br>
When the Courier mail server connects to a remote ESMTP
relay, the Courier mail server will authenticate itself
using userid and password. These fields are separated by one
<br>
or more whitespace characters. Because this file contains
passwords, it must not be world or group readable, and owned
by the user &quot;courier&quot;.</p>

<p style="margin-top: 1em">ESMTP negotiation will take
place, and the Courier mail server will use a SASL
authentication method supported by both the Courier mail
server and the remote ESMTP server. <br>
Currently the Courier mail server supports PLAIN, LOGIN and
CRAM-MD5 authentication. CRAM-MD5 is preferred over the
other two, and PLAIN is preferred over LOGIN.</p>

<p style="margin-top: 1em">The Courier mail server also
supports ESMTP over SSL (the ESMTP STARTTLS extension). If
ESMTP STARTTLS is enabled, STARTTLS will be used to
establish a secure link first. The <br>
authentication will take place afterwards, over a secure
channel.</p>

<p style="margin-top: 1em">Changes to this file take
effect, more or less, immediately (existing connections are
not affected, but new connections will read the updated
data).</p>

<p style="margin-top: 1em">esmtpd <br>
This file is used to initialize the environment and
parameters for courieresmtpd. A default file will be
provided during installation. See the comments in the file
for more <br>
information. For changes to this file to take effect you run
the esmtpd stop command followed by esmtpd start.</p>

<p style="margin-top: 1em">esmtpdelay <br>
This file contains one line of text that specifies how long
courieresmtp waits after a failure to contact the remote
mail server before another attempt is made. courieresmtp
<br>
(not to be confused with courieresmtpd) delivers outgoing
mail to remote mail servers. The timeout is specified as an
integral number, optionally followed by m - minutes, or <br>
h - hours. Otherwise it is specified in seconds.</p>

<p style="margin-top: 1em">The courieresmtp process
delivers mail that&rsquo;s routed to external mail relays,
via ESMTP. When attempting to initally contact a mail server
courieresmtp waits for the amount <br>
of time specified by esmtptimeoutconnect (see below).
esmtptimeoutconnect is usually set to a relatively long
period of time, in order to accomodate slow mail servers. A
<br>
large number of messages queued up for an unreachable mail
server can tie up delivery slots that can be put to a better
use by reassigning them for mail to another domain. <br>
Although the Courier mail server does not usually assign all
delivery slots for messages to the same domain (this is a
tuneable parameter), it is still not very healthy to <br>
have a bunch of courieresmtp daemons spinning their wheels,
doing nothing.</p>

<p style="margin-top: 1em">The situation worsens when there
is a large number of mail relays that accept mail for the
same domain, and all of them are unreachable due to a
network failure. That&rsquo;s <br>
because the esmtptimeout waiting period is used for each
individual mail relay. Multiply esmtptimeout by the number
of servers to see how large the delay really will be.</p>

<p style="margin-top: 1em">esmtpdelay is implemented
internally in the courieresmtp module. The main the Courier
mail server scheduling daemon is not aware of what&rsquo;s
happening internally in <br>
courieresmtp. When courieresmtp fails to contact any mail
relay for the domain, the message is postponed, and the
esmtpdelay timer is set. Any additional messages received by
<br>
the same courieresmtp daemon (for the same domain), are
immediately postponed without any attempt to contact a
remote mail relay. When the amount of time set by esmtpdelay
<br>
expires, courieresmtp will attempt to make another delivery
attempt as usual.</p>

<p style="margin-top: 1em">If esmtpdelay does not exist,
the default delay is five minutes. Any messages that are
postponed look like any other temporary failure to courierd.
Delivery attempts are <br>
rescheduled as if a real temporary failure took place.
Therefore it does not make sense to set esmtpdelay to be
greater than retryalpha (see below). When retryalpha is <br>
smaller is esmtpdelay, you&rsquo;ll just messages spinning
through the mail queue, with useless delivery attempts being
attempted because esmtpdelay still hasn&rsquo;t expired.</p>

<p style="margin-top: 1em">Occasionally you might observe
somewhat strange behavior on systems with heavy mail
traffic. esmtpdelay applies separately to each individual
instance of courieresmtp. When <br>
a remote mail server keeps going up and down, it is possible
to end up with multiple courieresmtp daemons handling mail
for the same domain, but only some of them will <br>
encounter a network failure, purely by the luck of the draw.
The remaining daemons will be able to establish a
connection. So you&rsquo;ll end up with some courieresmtp
daemons <br>
being able to deliver mail immediately, while the rest are
still waiting patiently for esmtpdelay to expire, postponing
all messages in the meantime. Some messages - but not <br>
all - will be immediately postponed without a delivery
attempt, becauses they ended up getting to a daemon which is
waiting for esmtpdelay to expire.</p>

<p style="margin-top: 1em">Another anomalous situation may
happen when a courieresmtp daemon gets reassigned to another
domain, and then receives more mail for the previous domain.
This can happen when <br>
you have a lot of mail going through. Although the Courier
mail server tries to shuffle all mail for same domain into
one pile, the scheduler still tries to dispatch mail on <br>
&quot;first-come, first-serve&quot; basis, as much as
possible. When that happens another delivery attempt will be
made immediately, because the previous esmtpdelay was
cancelled when <br>
the daemon got reassigned to another domain.</p>

<p style="margin-top: 1em">There can also be occasional
abnormalities that affect systems with light traffic. When
there is a domain with several mail relays of equal
priority, one mail relay is chosen <br>
at random for the connection attempt. If some of the
equal-priority mail relays are unreachable and a
courieresmtp daemon picks it, it will start the esmtpdelay
timer and <br>
refuse to deliver any more mail until it expires, even if
most of the mail servers are functional. This will happen
only with mail relays of the lowest priority. Otherwise,
<br>
courieresmtp will always try to contact another mail relay
of a still lower priority, before giving up and setting the
esmtpdelay timer. Another courieresmtp daemon will not <br>
be started for the same domain if there&rsquo;s already an
existing one, so all delivery attempts will be turned away
until esmtpdelay expires. Another courieresmtp daemon will
be <br>
started only in the event of multiple simultaneous delivery
attempts that happen to coincide at the same time.</p>

<p style="margin-top: 1em">This is somewhat mitigated by
the fact that all courieresmtp daemons are killed after a
short period of total inactivity (currently one minute), so
that longer intervals <br>
specified by esmtpdelay are ignored. Note, however, that
receiving a message to deliver, and then postponing it
immediately, does count as some activity.</p>

<p style="margin-top: 1em">esmtpdelay can be turned off by
setting it to 0 seconds. esmtpdelay is designed for servers
that handle heavy amount of mail that wish to avoid having
outbound delivery <br>
slots tied up due to network failures, at an expense of an
occasional anomalous behavior due to harmless paranoia.
esmtpdelay may prove to actually make things worse for <br>
systems that carry only light mail traffic, if they are
burdened with a task of exchanging mail primarily with
external systems that are not properly maintained.</p>

<p style="margin-top: 1em">esmtpgreeting <br>
The complete greeting banner displayed by courieresmtpd.
Changes to this file take effect immediately.</p>

<p style="margin-top: 1em">esmtphelo <br>
This file contains one line of text, what the Courier mail
server calls itself in the EHLO or HELO command sent to a
remote SMTP server. me is used if this file does not <br>
exist.</p>

<p style="margin-top: 1em">esmtphelo may also be set to a
special value of &acirc;*&acirc;:</p>

<p style="margin-top: 1em">echo &rsquo;*&rsquo;
&gt;esmtphelo <br>
(Note the single quotes, to prevent &acirc;*&acirc; from
being expanded by the shell). The Courier mail server will
take the IP address of the local side of the connection to
the remote <br>
SMTP server, look up the IP address in DNS, and use the
hostname from the reverse DNS lookup. This might be useful
when the Courier mail server server is multihomed. The <br>
Courier mail server will look up the local IP address of
each individual connection, and use that in its EHLO or HELO
command.</p>

<p style="margin-top: 1em">Note <br>
Functioning DNS is required. Using the hosts file, or an
equivalent, won&rsquo;t work. This function uses the Courier
mail server&rsquo;s native DNS resolver, which reads <br>
/etc/resolv.conf and queries the listed DNS servers
directly.</p>

<p style="margin-top: 1em">Note <br>
See the section called &acirc;Servers with multiple IP
addresses&acirc; for a better way of accomplishing the same
results.</p>

<p style="margin-top: 1em">esmtproutes <br>
This file is used by the ESMTP module, and it contains one
or more lines in the following form:</p>


<p style="margin-top: 1em">domain:relay[,port][/SECURITY=STARTTLS][/SECURITY=REQUIRED][/SECURITY=SMTPS]
<br>
domain is any SMTP domain. relay specifies a fixed mail
relay for this domain. relay is optionally followed by a
comma and a port number, to specify a port other than the
<br>
default port 25. If an address&rsquo;s domain is not found
in esmtproutes, the Courier mail server looks for MX and A
records as usual (and always delivers to port 25). If the
<br>
domain is found in esmtproutes, however, any MX or A records
for the domain are ignored; instead the Courier mail server
delivers the message to the specified relay.</p>

<p style="margin-top: 1em">relay can be another domain, or
an explicit IP address inside brackets. For example, if
esmtproutes contains the following:</p>

<p style="margin-top: 1em">example.com: relay.domain.com
<br>
domain.com: [192.168.0.2] <br>
Mail for example.com is delivered to relay.domain.com,
ignoring any MX records for example.com. Mail for domain.com
will be delivered to the machine at IP address <br>
192.168.0.2. All other domains will have their MX and A
records looked up.</p>

<p style="margin-top: 1em">Note <br>
Unlike Qmail, the Courier mail server looks up MX and A
records for relay.example.com (Qmail only looks up A
records). <br>
esmtproutes may contain comments, any line that starts with
the # character is ignored. Also, wildcards are allowed:</p>

<p style="margin-top: 1em">.example.com: [192.168.0.3],26
<br>
This specifies that any address of the form
&lt;anything@anything.example.com&gt; will be delivered to
the mail server at this IP address, but on port 26.</p>

<p style="margin-top: 1em">esmtproutes is read from top to
bottom, stopping as soon as a first match is found.</p>

<p style="margin-top: 1em">domain may be empty, this
specifies a smarthost for all domains. For example, if
esmtproutes contains the following text:</p>

<p style="margin-top: 1em">example.com: relay.example.com
<br>
:[192.168.0.4] <br>
This specifies that all mail to example.com is rerouted to
relay.example.com. All other mail is routed to the IP
address 192.168.0.4.</p>

<p style="margin-top: 1em">If relay is empty, the Courier
mail server interprets it as an explicit directive to use MX
and A records from DNS. For example:</p>

<p style="margin-top: 1em">example.com: <br>
:[192.168.0.4] <br>
This uses MX and A records for all messages to example.com.
All other mail is rerouted to the IP address
192.168.0.4.</p>

<p style="margin-top: 1em">The /SECURITY=STARTTLS flag
indicates that mail to this domain will use the SECURITY
ESMTP extension. See the Courier mail server installation
notes for a description of <br>
SECURITY, what it does, and how to configure it.</p>

<p style="margin-top: 1em">Note <br>
/SECURITY=STARTTLS does not refer to the standard
implementation of SMTP over TLS, but a Courier-specific
extension. Courier automatically sends mail using encryption
if <br>
it&rsquo;s enabled and the remote server advertises
STARTTLS. <br>
/SECURITY=SMTPS uses an encrypted SMTP connection. This is
an alternative to STARTTLS. Encrypted SMTP uses a different
port, port 465, which must be specified explicitly:</p>

<p style="margin-top: 1em">: relay.example.com,465
/SECURITY=SMTPS <br>
This example forwards all mail to relay.example.com on port
465 using encrypted SMTP.</p>

<p style="margin-top: 1em">Note <br>
If you intend to use /SECURITY=SMTPS to forward all your
mail to your provider&rsquo;s mail server over smtps
additional you should also set ESMTP_TLS_VERIFY_DOMAIN=1,
<br>
TLS_VERIFYPEER=PEER, and TLS_TRUSTCERTS to a list of trusted
certificate authorities (Courier&rsquo;s configuration
script should provide a default value for TLS_TRUSTCERTS on
<br>
most platforms), in the courierd configuration file.</p>

<p style="margin-top: 1em">Otherwise, TLS still gets used
to send mail, but the smarthost&rsquo;s certificate does not
get validated. Properly-managed Internet providers should
install a valid <br>
certificate, signed by a trusted authority, if they require
SMTPS. Poorly-managed Internet providers will just install a
self-signed certificate, and will not be able to <br>
explain why they require SMTPS, if it&rsquo;s trivially
compromised with a man-in-the-middle attack that a
non-validated certificate enables, so either find a more
competent <br>
provider, or use /SECURITY=SMTPS without actually enabling
all the extra validation that&rsquo;s actually needed to
gain any kind of a secure mail transmission channel. <br>
A combination of broken mail servers written by incompetent
programmers, and poorly-managed Internet providers will
result in a mail server that advertises the ability to use
<br>
an encrypted connection to receive mail, but either
disconnect immediately, or return an error message when the
sender takes up the receiver&rsquo;s offer to do so.</p>

<p style="margin-top: 1em">When the Courier mail server
connects to another server that claims to support an
encrypted connection, tries to enable it, then fails because
the other mail server drops the <br>
connection or returns an error message, all subsequent
connection attempts to the same mail server will ignore the
server&rsquo;s false advertising, and proceed to send mail
<br>
without attempting to enable encryption. The Courier mail
server remembers not to use the encryption with this server
for the next 2-4 hours (depending on an internal log <br>
file&rsquo;s rotation schedule). Once the remote mail server
emerges from the penalty box, the next connection attempt
will try again, and see if it&rsquo;s still doesn&rsquo;t
work.</p>

<p style="margin-top: 1em">The /SECURITY=REQUIRED flag
blocks the Courier mail server from sending mail to the
remote server unless a standard encryped connection can get
established. If it&rsquo;s known <br>
that the given mail server should only receive encrypted
mail, /SECURITY=REQUIRED prevents a man-in-the-middle attack
where the remote mail server&rsquo;s advertisement of is
<br>
STARTTLS capability gets suppressed, and the mail gets sent
in the clear.</p>

<p style="margin-top: 1em">Note <br>
ESMTP_TLS_VERIFY_DOMAIN=1, TLS_VERIFYPEER=PEER, and
TLS_TRUSTCERTS should also be set, in the courierd
configuration file, as described above, for the same
reasons, in <br>
this case. <br>
To summarize:</p>

<p style="margin-top: 1em">/SECURITY=STARTTLS <br>
Courier-specific extension, use a private certificate
authority to set up a secure mail network, while supporting
regular encrypted TLS with the rest of the world.</p>

<p style="margin-top: 1em">/SECURITY=SMTPS <br>
Use regular encrypted SSL/TLS with this mail server. Use
this flag with an esmtproutes entry to a server on port 465
(smtps).</p>

<p style="margin-top: 1em">/SECURITY=REQUIRED <br>
Must use the STARTTLS extension to open a regular encrypted
TLS connection with this server on the regular SMTP port
25.</p>

<p style="margin-top: 1em">Changes to esmtproutes take
effect immediately, more or less. Existing courieresmtp
processes that already have an established connection will
ignore any changes.</p>

<p style="margin-top: 1em">esmtptimeout <br>
This file contains one line of text that specifies the
timeout for an SMTP command. The timeout is specified as an
integral number, optionally followed by m - minutes, or h -
<br>
hours. Otherwise it is specified in seconds. This timeout is
used for all SMTP commands, unless the SMTP command has a
dedicated timeout defined by a different configuration <br>
file. The default timeout is ten minutes.</p>

<p style="margin-top: 1em">esmtptimeoutconnect <br>
This file contains one line of text that specifies the
timeout for an SMTP connection attempt. Most TCP/IP stacks
wait an extraordinary long period of time for SMTP <br>
connections to go through. This configuration setting limits
the amount of time the Courier mail server waits for the
SMTP connection to complete. The default timeout is one <br>
minute. Set esmtptimeoutconnect to 0 in order to use
whatever default timeout your TCP/IP stack uses.</p>

<p style="margin-top: 1em">esmtptimeoutdata <br>
This file contains one line of text that specifies the
timeout for transferring the message contents or individual
replies. The default timeout is five minutes. You WILL HAVE
<br>
TO bump this up if you&rsquo;re on a slow link, and you want
to send large messages. A 28.8Kbps link can be
optimistically expected to push 3,000 bytes per second. With
a five <br>
minute cutoff, you will not be able to send or receive
anything larger than about 870 Kb. You have no business
sending or receiving 870 Kb messagesl, if all you have is an
<br>
analog 28.8Kbps connection.</p>

<p style="margin-top: 1em">esmtptimeouthelo <br>
This file contains one line of text that specifies the
timeout for the initial EHLO or HELO command. The Courier
mail server will wait this amount of time to receive the
<br>
initial greeting banner from the remote SMTP server, and a
response to the subsequent EHLO/HELO command. The default
value is 5 minutes.</p>

<p style="margin-top: 1em">esmtptimeoutkeepalive <br>
This file contains one line of text that specifies how often
outbound SMTP sessions are kept idle after delivering a
message. After the Courier mail server connects to an <br>
SMTP server and completes the attempt to deliver the
message, the SMTP session is kept idle for this time
interval before being shut down. If the Courier mail server
receives <br>
another message for the same domain, it will be delivered
using the existing SMTP session, instead of establishing a
new one. Note that some SMTP servers have a very short <br>
idle timeout, Qmail&rsquo;s is only two minutes. The default
value is 60 seconds.</p>

<p style="margin-top: 1em">Note that there&rsquo;s also a
separate limit to the maximum number of simultaneous SMTP
sessions to the same domain. That limit is currently four,
which is adequate for nearly <br>
every situation, so for now it will be set by an
undocumented configuration file.</p>

<p style="margin-top: 1em">esmtptimeoutkeepaliveping <br>
This file contains one line of text that specifies how often
the Courier mail server will issue a useless RSET command
when the connection is idle (see <br>
esmtptimeoutkeepalive). While waiting for any more messages
to deliver to the same domain, or for the
esmtptimeoutkeepalive interval to expire, courieresmtp will
transmit <br>
RSET commands at regular intervals specified by this
configuration file. The default value is 0 seconds, which
turns off the keepalive ping altogether. This configuration
<br>
settings must be for a shorter time interval than
esmtptimeoutkeepalive for it to make any sense. Note that
other system administrators may consider this to be a very
rude <br>
thing to do. Also keep in mind that this may generate quite
a bit of idle traffic. If you have the Courier mail server
configured for a maximum number of 200 outbound SMTP <br>
sessions and a 30 second esmtptimeoutkeepaliveping setting,
then you can have as much as an average of around seven
pings every second!</p>

<p style="margin-top: 1em">esmtptimeoutquit <br>
This file contains one line of text that specifies how long
the Courier mail server waits for the external SMTP server
to acknowledge the QUIT command, before the Courier <br>
mail server unilaterally tears down the connection. The
default value is 10 seconds. This must be a small value
because the Courier mail server needs to be able to shut
down <br>
quickly, on very short notice.</p>

<p style="margin-top: 1em">faxqueuetime <br>
This file specifies how long the Courier mail server
normally tries to repeatedly resend a fax message (if the
courierfax module is enabled). The default E-mail message
retry <br>
timeout (the queuetime setting) is one week, which is a
reasonable timeout value for E-mail messages (taking into
account downed circuits, or crashed servers). However, it
<br>
doesn&rsquo;t make sense to keep trying to redeliver fax
messages for a whole week.</p>

<p style="margin-top: 1em">faxqueuetime specifies the
timeout for fax messages. This time interval is specified in
the same way as queuetime (see queuetime for more
information).</p>

<p style="margin-top: 1em">faxnotifyrc <br>
This file specifies which mailbox the Courier mail server
should deliver received faxes (if this option is enabled).
See the Courier mail server&rsquo;s installation notes for
more <br>
information.</p>

<p style="margin-top: 1em">faxrc <br>
This file configures the Courier mail server&rsquo;s
outbound faxing and dialing parameters. Consult the comments
in the default file for additional information, and the <br>
courierfax(8)[7] manual page for more information.</p>

<p style="margin-top: 1em">hosteddomains <br>
This file lists locally-hosted domains. It is very similar
in function to the locals control file. Any address with a
domain listed in hosteddomains is considered to be a <br>
local address. The difference between hosteddomains and
locals is that domains listed in hosteddomains are not
removed from individual addresses before looking up the <br>
location of their mailboxes. For example, if the domain
&quot;example.com&quot; appears in locals, the address
user@example.com will have example.com removed, and then the
Courier mail <br>
server will look for a local mailbox named
&quot;user&quot;.</p>

<p style="margin-top: 1em">If the domain
&quot;example.com&quot; appears in hosteddomains instead,
the Courier mail server will look for a local mailbox named
&quot;user@example.com&quot; instead.</p>

<p style="margin-top: 1em">The contents of the
hosteddomains configuration file is a list of domains, one
per line, in lowercase. You must run the makehosteddomains
command, followed by courier restart <br>
(this restarts the server) for any changes to take
effect.</p>

<p style="margin-top: 1em">Additionally, hosteddomains can
specify simple domain aliases. See the complete description
in the makehosteddomains(8)[8] manual page.</p>

<p style="margin-top: 1em">ipout, ip6out <br>
Non-default IP addresses to send outgoing ESMTP messages
from. See the section called &acirc;Servers with multiple IP
addresses&acirc; and the section called &acirc;Simulating a
server with <br>
multiple IP addresses&acirc;, below, for more
information.</p>

<p style="margin-top: 1em">ldapaddressbook <br>
This file is used by the webmail server. It contain a
default systemwide list of accessible LDAP address books. A
default file will be installed, listing some common Internet
<br>
address books. Each line in this file contains the following
information:</p>


<p style="margin-top: 1em">name&lt;tab&gt;host&lt;tab&gt;port&lt;tab&gt;suffix&lt;tab&gt;binddn&lt;tab&gt;bindpw
<br>
&quot;&lt;tab&gt;&quot; is the ASCII tab character.
&acirc;name&acirc; is the unique name for this LDAP server.
&acirc;host&acirc; and &acirc;port&acirc; specify the
connection parameters. &acirc;suffix&acirc; specifies the
root LDAP <br>
entry whose subtree gets searched. The &acirc;binddn&acirc;
and &acirc;bindpw&acirc; fields are not presently used (they
were used in earlier version of the webmail server, before
the LDAP search <br>
interface was rewritten and simplified).</p>

<p style="margin-top: 1em">ldapaliasrc <br>
This file is used by the courierldapaliasd process. See
courierldapaliasd(8)[9] for more information.</p>

<p style="margin-top: 1em">locallowercase <br>
If this file exists, the Courier mail server will not
distinguish being lowercase and uppercase local accounts, so
that john@example.com and John@example.com will refer to
<br>
the same local mailbox (where example.com is your domain).
Postmaster, postmaster, and POSTMASTER always refer to the
same account, even if locallowercase does not exist.</p>

<p style="margin-top: 1em">Note <br>
If locallowercase exists you cannot have any system accounts
that contain uppercase letters. locallowercase applies only
to local mail. Mail addressed to external <br>
domains will always have the case of the addresses
preserved.</p>

<p style="margin-top: 1em">locals <br>
This file contains one or more lines of text, where each
line contains a valid mail domain. Any E-mail address
without @domain, or with a domain that can be found in
locals <br>
will be considered to be an address of a local mailbox. A
domain can be specified with a leading dot:</p>

<p style="margin-top: 1em">.domain.com <br>
This is called a &quot;wildcard&quot;. Any domain ending in
domain.com, such as a.domain.com, b.domain.com,
a.b.c.domain.com - but NOT somedomain.com - will be
considered local. Note <br>
that domain.com is NOT included in this wildcard. Both
&quot;domain.com&quot; and &quot;.domain.com&quot; should be
listed.</p>

<p style="margin-top: 1em">Specific hosts can be excluded
from the wildcard. Example:</p>

<p style="margin-top: 1em">!host.domain.com <br>
.domain.com <br>
anything.domain.com is considered to be a local domain,
except for host.domain.com. Note that
&quot;!host.domain.com&quot; must appear in locals before
the .domain.com wildcard.</p>

<p style="margin-top: 1em">The &quot;!hostname&quot; syntax
is also valid in the esmtpacceptmailfor control file.</p>

<p style="margin-top: 1em">If locals does not exist, the
Courier mail server uses the contents of the me control file
(note that me specifies only one domain, second and
subsequent lines are ignored). <br>
Also, see hosteddomains.</p>

<p style="margin-top: 1em">localtimeout <br>
This file specifies the watchdog timer for local mail
deliveries. If a local mail delivery attempt does not
complete in the proscribed time interval, the delivering
process <br>
ID is killed. The time interval in localtimeout is specified
in the same way as queuetime (see queuetime for more
information).</p>

<p style="margin-top: 1em">logindomainlist <br>
If this file exists then the webmail login screen will have
a drop-down list whose contents will be read from this file.
This file should contain a list of E-mail domains, <br>
one per line. It should be created if the Courier mail
server&rsquo;s webmail server is used to provide mail access
for more than one domain. Instead of typing
&quot;user@domain&quot; to log <br>
in, it will only be necessary to enter &quot;user&quot;, and
select the domain from the drop-down list. If this file does
not exist it will be necessary to enter the full E-mail <br>
address into the webmail login screen. The enhanced
logindomainlist makes it possible to specify a separate list
of domain for each virtual web site, and more control over
<br>
the defaults.</p>

<p style="margin-top: 1em">What if you don&rsquo;t want to
display a drop down menu? Administrators can now specify
records that generate a hidden field in login.html, or an
editable text field, allowing <br>
sqwebmail to show only one mail login domain to each user
per access URL or IP address. This functionality can greatly
reduce confusion for first time webmail users, and <br>
greatly speed the login process for frequent webmail
users.</p>

<p style="margin-top: 1em">Finally, the new logindomainlist
file offers a new tool to ease maintenance. Administrators
can now use wildcards to &quot;rewrite&quot; the domain
portion of the access URL to the <br>
mail domain equivalent. For example, the following record
can rewrite the URL &quot;mail.*.com&quot; to the mail
domain &quot;*.com&quot;</p>

<p style="margin-top: 1em">*.com:mail.*.com:@</p>

<p style="margin-top: 1em">This powerful wildcard
functionality can ease the login process for most of your
server&rsquo;s mail domains with just one or two
logindomainlist records.</p>

<p style="margin-top: 1em">File Format <br>
Let&rsquo;s take a look at the NEW logindomainlist file
format:</p>


<p style="margin-top: 1em">firstfield:secondfield:thirdfield</p>

<p style="margin-top: 1em">Above, we can see that the new
logindomainlist records are made up of three fields
delimited by colons. But what does each field do?</p>

<p style="margin-top: 1em">First Field - the first field
contains the &quot;mail domain&quot; for which we would like
the user to log in under. The mail domain is the part of an
email address after the @ <br>
symbol. For example, in the email address
&quot;user@domain.com&quot;, &quot;domain.com&quot; is the
mail domain.</p>

<p style="margin-top: 1em">Second Field - the second field
contains the &quot;access domain&quot;. The access domain
contains an URL or IP address that is used to figure out
which mail domain to use by <br>
default. For example, in the following logindomainlist
record:</p>

<p style="margin-top: 1em">domain1.com:domain2.com</p>

<p style="margin-top: 1em">&quot;domain2.com&quot; is the
&quot;access domain&quot; and &quot;domain1.com&quot; is the
&quot;mail domain&quot;. If the user logs into the following
URL:</p>


<p style="margin-top: 1em">http://domain2.com/cgi-bin/sqwebmail</p>

<p style="margin-top: 1em">His default &quot;mail
domain&quot; will be &quot;domain1.com&quot;.</p>

<p style="margin-top: 1em">Third Field - the third field
may contain a modifier. The modifier may be either a single
character modifier, or a group identification string. The
single character <br>
modifiers and the group modifier are described in detail
below.</p>

<p style="margin-top: 1em">Finally, the logindomainlist
file may also contain comments and empty lines. Empty lines
can be used to group records visually, and comments can be
used to explain why a <br>
certain record or group of records look the way they do.</p>

<p style="margin-top: 1em">If the first character of a line
is a &rsquo;#&rsquo;, then the entire line is considered a
comment and is ignored. If the first character of a line
contains whitespace, the entire <br>
line is assumed to be an empty line and is ignored.</p>

<p style="margin-top: 1em">Modifiers <br>
@ - the &rsquo;@&rsquo; modifier can be used to create a
hidden field on the login.html page which contains the
default mail domain. In addition, this field will
automatically <br>
display the default mail domain in plain text to the right
of the userid text box.</p>

<p style="margin-top: 1em">Note <br>
The &rsquo;@&rsquo; modifier ALLOWS the use of wildcards to
automate the relationship between &quot;access domains&quot;
and &quot;mail domains&quot;. See the heading
&quot;Wildcards&quot; below for more <br>
information about wildcarding. <br>
- - the &rsquo;-&rsquo; modifier can be used to create an
editable text field on the login.html page which contains
the default mail domain.</p>

<p style="margin-top: 1em">Note <br>
The &rsquo;-&rsquo; modifier ALLOWS the use of wildcards to
automate the relationship between &quot;access domains&quot;
and &quot;mail domains&quot;. See the heading
&quot;Wildcards&quot; below for more <br>
information about wildcarding. <br>
group string - If no modifier is specified in the third
field, or if the third field modifier is a group identifier
string, then a drop down menu will be displayed on the <br>
login.html page. Records with the SAME group string will be
displayed together in the drop down. For example, if your
logindomainlist file contains the following records:</p>


<p style="margin-top: 1em">domain1.com:domain2.com:firstgroup
<br>
domain3.com:domain4.com:firstgroup <br>
domain5.com:domain6.com:firstgroup <br>
domain7.com:domain8.com:secondgroup <br>
domain9.com:domain10.com:secondgroup <br>
And the user logs into sqwebmail with the following URL:</p>


<p style="margin-top: 1em">http://domain4.com/cgi-bin/sqwebmail</p>

<p style="margin-top: 1em">He will see a drop down
containing ONLY the following domains:</p>

<p style="margin-top: 1em">domain1.com <br>
domain3.com <br>
domain5.com <br>
&quot;domain3.com&quot; will be automatically selected, or
defaulted. Only the records in the firstgroup will be
visible to the user. This functionality is great for
organizations <br>
with more than one mail domain.</p>

<p style="margin-top: 1em">Note <br>
The group string modifier does NOT allow the use of
wildcards to automate the relationship between &quot;access
domains&quot; and &quot;mail domains&quot;. This is because
drop down <br>
menus are fundamentally incompatible with wildcards.</p>

<p style="margin-top: 1em">Wildcards <br>
If a record&rsquo;s modifier allows wildcarding (See
&quot;Modifiers&quot; above for information about which
modifiers allow wildcarding and which do not.) then the
first and second <br>
fields of that record _MAY_ contain wildcards. Wildcards
match against the HTTP_HOST CGI environment variable only.
IP addresses can NOT be used if either the first or <br>
second fields contain the wildcard character. However, if
neither the first nor second fields contain the wildcard
character, then the second field can contain an IP <br>
address.</p>

<p style="margin-top: 1em">In the logindomainlist file, an
asterisk (*) character in either the first and/or second
field represents a wildcard. Any asterisk in the second
field will be used to <br>
match an access domain. If an asterisk exists in the first
field then any characters which the asterisk in the second
field represents will replace the asterisk in the <br>
first field when sqwebmail determines the default mail
domain. However, asterisks are not required in either the
first or second fields. They are totally optional. For <br>
example, given the following logindomainlist record:</p>

<p style="margin-top: 1em">*.com:mail.*.com:@</p>

<p style="margin-top: 1em">If the user logs into sqwebmail
with the following URL:</p>


<p style="margin-top: 1em">http://mail.mydomain.com/cgi-bin/sqwebmail</p>

<p style="margin-top: 1em">The asterisk in the second field
will represent the string &quot;mydomain&quot;. This string
will then replace the asterisk in the first field to give
the following default mail <br>
domain: mydomain.com</p>

<p style="margin-top: 1em">Similarly, if the following
record exists in the logindomainlist file:</p>

<p style="margin-top: 1em">*:*:@</p>

<p style="margin-top: 1em">Then ANY URL the user uses to
access sqwebmail will be automatically used for the default
mail domain.</p>

<p style="margin-top: 1em">But the first field
doesn&rsquo;t _HAVE_ to contain an asterisk. The following
will work just fine:</p>

<p style="margin-top: 1em">mydomain.com:mydomain.*:@</p>

<p style="margin-top: 1em">The above example will allow the
user to access the &quot;mydomain.com&quot; mail domain from
any of the following URLs: &quot;mydomain.org&quot;,
&quot;mydomain.net&quot;, &quot;mydomain.us&quot;,
etc...</p>

<p style="margin-top: 1em">And finally, the first field
doesn&rsquo;t have to contain anything at all! If the first
field is empty, that record will serve as an explicit
no-default mail domain. No <br>
default mail domain will be specified if the second field
matches the user&rsquo;s login URL. This is useful because
the logindomainlist is searched from the top down. Any <br>
wildcard records at the bottom of the list will be
overridden by records closer to the top. An &quot;explicit
no-default&quot; record can be used to specify certain
domains as <br>
&quot;system account&quot; domains so that no default mail
domain is specified.</p>

<p style="margin-top: 1em">maildirfilterconfig <br>
This file, if exists, sets the global defaults for mail
filtering in the webmail server. Mail filtering in the
webmail server is a subject worthy of special mention. A
full <br>
description of how to install and configure webmail-based
mail filtering is included in the installation notes for the
Courier mail server. Refer to the installlation <br>
instructions for additional information.</p>

<p style="margin-top: 1em">maildirshared <br>
This file, if exists, specifies the location of shared
maildirs for the webmail and IMAP server. Normally, each
mailbox must be separately configured to access every shared
<br>
maildir, by the maildirmake(1)[10] command. This file allows
shared maildirs to be set globally for everyone.
Everyone&rsquo;s webmail and IMAP server will pick up the
shared <br>
maildirs specified in this file. See maildirmake(1)[10] for
more information.</p>

<p style="margin-top: 1em">maildrop <br>
This file contains one line whose contents is a pathname to
the maildrop(1)[6] mail delivery agent. If the Courier mail
server knows that the delivery agent used to delivery <br>
mail locally is maildrop(1)[6] then certain delivery
optimizations are possible. This configuration file does NOT
actually specify that maildrop(1)[6] should be used as a
<br>
local mail delivery agent, it only specifies where
maildrop(1)[6] is installed. The default local mail delivery
instructions are specified in the courierd configuration
file. <br>
If the specified delivery instruction specify running an
external program whose pathname matches the one specified by
this configuration file, the Courier mail server assumes
<br>
that it&rsquo;s maildrop(1)[6], and will use
maildrop-specific options to optimize mail delivery.</p>

<p style="margin-top: 1em">This configuration file is
initialized, by default, to point to the version of
maildrop(1)[6] that&rsquo;s integrated with the Courier mail
server. The integrated version of <br>
maildrop(1)[6] is configured slightly differently than the
standalone version of maildrop(1)[6].</p>

<p style="margin-top: 1em">Although you can set the
maildrop configuration file to point to some other version
of the maildrop mail filter, you MUST set the maildropfilter
configuration file (see <br>
below), to point to the integrated version of maildrop.</p>

<p style="margin-top: 1em">maildropfilter <br>
This file contains one line whose contents is a pathname to
the maildrop(1)[6] mail delivery filter. In addition to
being a delivery agent, maildrop can also be used as a <br>
mail filtering engine. If this file exists, the Courier mail
server will be capable of invoking recipient-specified mail
filters when a message is received. If the mail <br>
filtering rules reject the message, the Courier mail server
will not accept the message for delivery. This means that
when receiving mail via ESMTP, the Courier mail server <br>
will reject the ESMTP transaction without even accepting the
message from the remote mail server.</p>

<p style="margin-top: 1em">This file is not installed by
default. To activate mail filtering for local recipients,
simply copy the contents of the maildrop configuration file
to maildropfilter.</p>

<p style="margin-top: 1em">maildroprc <br>
This file contains systemwide mail filtering instructions
for maildrop(1)[6] deliveries. This configuration file is
optional, and is used by maildrop(1)[6] when it is invoked
<br>
as a traditional post-delivery mail filter. See
maildropfilter(6)[11] for more information.</p>

<p style="margin-top: 1em">me <br>
This file contains one line whose contents is a valid
machine name. When a single installation of the Courier mail
server is shared over a network, each machine that&rsquo;s
<br>
running the Courier mail server must have a unique me file.
If me is missing, The Courier mail server uses the result of
the gethostname() system call.</p>

<p style="margin-top: 1em">Warning <br>
If you change the contents of this configuration file, it
may be necessary to rerun the makealiases command again,
else your mail will promptly begin to bounce. If you <br>
don&rsquo;t have this configuration file defined, and you
change the system&rsquo;s network host name, you may also
need to run makealiases.</p>

<p style="margin-top: 1em">msgidhost <br>
If a message does not have a Message-ID: header, the Courier
mail server may decide to create one. The host portion of
the new header will be set to the contents of <br>
msgidhost, which contains one line of text. If msgidhost
does not exist, me will be used in its place. Changes to
this file take effect immediately.</p>

<p style="margin-top: 1em">nochangingfrom <br>
The Courier mail server&rsquo;s webmail server lets the
contents of the From: header be set for mailed messages. If
this configuration file exists, the ability to set the
contents <br>
of the From: header is disabled.</p>

<p style="margin-top: 1em">queuelo, queuehi, queuefill <br>
These configuration settings tune the Courier mail
server&rsquo;s mail queue processing. The Courier mail
server does not load the entire mail queue metadata in
memory. queuelo <br>
contains a number that specifies the queue &acirc;low
watermark&acirc; message count. queuehi contains a number
that specifies the queue &acirc;high watermark&acirc;
message count. queuefill <br>
specifies a time interval, &acirc;queue refill&acirc; in
seconds. The number in queuefill may optionally be followed
by &quot;m&quot;, indicating that the queue refill is
specified in minutes.</p>

<p style="margin-top: 1em">queuehi specifies the maximum
number of messages that are loaded into memory. The Courier
mail server reads the mail queue on disk until either it
reads all of it, or it <br>
reads the number of messages specified by queuehi. As
messages are delivered they are removed from the memory and
disk. Messages that are deferred for another delivery <br>
attempt are removed from memory, but kept on the disk.</p>

<p style="margin-top: 1em">When the number of messages in
memory falls below queuelo, The Courier mail server goes
back to disk and attempts to fill the memory queue to the
top, again.</p>

<p style="margin-top: 1em">This is, basically, a capsule
summary of the mail queue processing logic. Many small, low
level details are omitted; this is just an executive
overview. When new messages <br>
arrive during a large mail backlog, the new messages are
also loaded into the memory queue, if there&rsquo;s room for
them. Therefore, during a large mail backlog the Courier
mail <br>
server simultaneously tries to clear the existing backlog,
and process any new mail at the same time. Up to the Courier
mail server 0.41, all of this generally translates to <br>
the Courier mail server giving priority to newly arrived
mail, and processing the backed up mail queue if spare
resources are available.</p>

<p style="margin-top: 1em">The queuefill setting was added
in the Courier mail server 0.42, in an attempt to keep new
mail from excessively delaying existing mail during a major
queue backup. <br>
queuefill specifies a time interval. When the Courier mail
server completely fills the memory queue it sets a timer.
After the interval given by queuefill The Courier mail <br>
server will go back and re-fill the mail queue even if the
number of messages did not fall below the low watermark. If
the Courier mail server finds older messages in the <br>
mail queue they will be pushed to the top of the scheduling
queue, and given priority.</p>

<p style="margin-top: 1em">Smaller queuefill time intervals
means more frequent trips to the disk, and more overhead.
But, in exchange for that, during a mail backlog the Courier
mail server will spend <br>
more time handling a greater number of delayed messages.
Larger queuefill time intervals means less frequent trips to
the disk, and less overhead, in exchange for less <br>
&quot;fairness&quot; during large mail backlogs.</p>

<p style="margin-top: 1em">queuefill defaults to five
minutes, if not specified. Explicitly setting it to 0
seconds turns off the queue re-filling completely,
essentially reverting to pre-0.42 <br>
behavior. The default queuelo and queuehi values are
computed at run time. queuelo defaults to the larger of 200,
and the sum total of configured mail delivery slots, both
<br>
local and remote. queuehi, if not explicitly set, defaults
to the smaller of twice the queuelo, or queuelo plus
1000.</p>

<p style="margin-top: 1em">queuetime <br>
This file specifies how long the Courier mail server
normally tries to repeatedly deliver a message, before
giving up and returning it as undeliverable. Messages are
<br>
immediately returned as undeliverable when a permanent
failure is encountered (such as the recipient address not
being valid). Attempts to deliver the message when
there&rsquo;s a <br>
temporary, transient, error (such as the network being down)
will be repeatedly made for the duration of time specified
by this configuration file. This file contains a <br>
number followed by the letter &rsquo;w&rsquo; for weeks, or
&rsquo;d&rsquo; for days. It is also possible to use
&rsquo;h&rsquo; for hours, &rsquo;m&rsquo; for minutes, or
&rsquo;s&rsquo; for seconds. Only integers are allowed, <br>
fractions are prohibited. However, you can use
&rsquo;1w2d&rsquo; to specify one week and two days. If
queuetime is missing, the Courier mail server makes repeated
delivery attempts for <br>
one week.</p>

<p style="margin-top: 1em">retryalpha, retrybeta,
retrygamma, retrymaxdelta <br>
These control files specify the schedule with which the
Courier mail server tries to deliver each message that has a
temporary, transient, delivery failure. retryalpha and <br>
retrygamma contain a time interval, specified in the same
way as queuetime. retrybeta and retrymaxdelta contain small
integral numbers only.</p>

<p style="margin-top: 1em">The Courier mail server will
first make retrybeta delivery attempts, waiting for the time
interval specified by retryalpha between each attempt. Then,
the Courier mail server <br>
waits for the amount of time specified by retrygamma, then
the Courier mail server will make another retrybeta delivery
attempts, retryalpha amount of time apart. If still <br>
undeliverable, the Courier mail server waits retrygamma*2
amount of time before another retrybeta delivery attempts,
with retryalpha amount of time apart. The next delay will
<br>
be retrygamma*4 amount of time long, the next one
retrygamma*8, and so on. retrymaxdelta sets the upper limit
on the exponential backoff. Eventually the Courier mail
server <br>
will keep waiting retrygamma*(2^retrymaxdelta) amount of
time before making retrybeta delivery attempts retryalpha
amount of time apart, until the queuetime interval
expires.</p>

<p style="margin-top: 1em">The default values are:</p>

<p style="margin-top: 1em">retryalpha <br>
Five minutes</p>

<p style="margin-top: 1em">retrybeta <br>
Three times</p>

<p style="margin-top: 1em">retrygamma <br>
Fifteen minutes</p>

<p style="margin-top: 1em">retrymaxdelta <br>
Three</p>

<p style="margin-top: 1em">This results in the Courier mail
server delivering each message according to the following
schedule, in minutes: 5, 5, 5, 15, 5, 5, 30, 5, 5, 60, 5, 5,
then repeating 120, 5, <br>
5, until the message expires.</p>

<p style="margin-top: 1em">sizelimit <br>
Maximum size of the message, in bytes, that the Courier mail
server accepts for delivery. The Courier mail server rejects
larger messages. If sizelimit is set to zero, The <br>
Courier mail server accepts as large message as available
disk space permits. If the environment variable SIZELIMIT is
set at the time a new message is received, it takes <br>
precedence and the Courier mail server uses the contents of
the environment variable instead. Changes to this file take
effect immediately. The SIZELIMIT environment variable <br>
is for use by individual mail submission agents. For
example, it can be set by the smtpaccess configuration file
(see makesmtpaccess(8)[3] for more information) for mail
from <br>
certain IP addresses.</p>

<p style="margin-top: 1em">If sizelimit does not exist, and
SIZELIMIT is not set, the maximum message size defaults to
10485760 bytes.</p>

<p style="margin-top: 1em">submitdelay <br>
submitdelay specifies the delay before the first delivery
attempt for a message that has been entered into the mail
queue. Normally, the first delivery attempt is made as <br>
soon as possible. This setting delays the initial delivery
attempt. It is normally used when you have a mail filter
installed that detects duplicate messages arriving in a <br>
short period of time. If the mail filter detects this
situation it can use the cancelmsg(1)[12] command to reject
duplicate messages in the queue (and return them back to the
<br>
envelope sender).</p>

<p style="margin-top: 1em">submitdelay specifies a time
interval in the same format as queuetime.</p>

<p style="margin-top: 1em">usexsender <br>
If this configuration file exists, the Courier mail
server&rsquo;s webmail server will set the X-Sender: header
on all outgoing messages. This is a good idea if the webmail
server <br>
allows the user to set the contents of the From: header.
Note that the Courier mail server records the system userid
of the sender in all locally-sent messages (which <br>
includes messages mailed by the webmail server), which is
sufficient in most cases. In cases where you have many
virtual accounts that share the same system userid, this
<br>
configuration file provides a way to positively identify the
sender of the outgoing message.</p>

<p style="margin-top: 1em">uucpme <br>
uucpme sets the UUCP nodename of the Courier mail server
mail relay. See courieruucp(8)[13] for more information.</p>

<p style="margin-top: 1em">uucpneighbors <br>
uucpneighbors is used by the courieruucp module to specify
the Courier mail server&rsquo;s configuration for relaying
mail via UUCP. See courieruucp(8)[13] for more
information.</p>

<p style="margin-top: 1em">uucprewriteheaders <br>
If this file exists, headers of messages sent to/from UUCP
addresses will be rewritten. Normally, only the message
envelope sender and recipients are rewritten, the existence
<br>
of this file causes the headers to be rewritten as well.</p>

<p style="margin-top: 1em">vhost.ip-address, vhost.domain
<br>
Enable per-message virtual configuration settings described
in the section called &acirc;Servers with multiple IP
addresses&acirc; and the section called &acirc;Simulating a
server with <br>
multiple IP addresses&acirc;, below, for more
information.</p>

<p style="margin-top: 1em">warntime <br>
warntime specifies an amount of time in the same format as
queuetime. If a message still has not been delivered after
this period of time, the Courier mail server sends a <br>
warning message (a &quot;delayed&quot; Delivery Status
Notification) to the sender. If warntime is missing, the
Courier mail server sets warntime to four hours.</p>

<p style="margin-top: 1em">Note <br>
The time interval specified by warntime is only approximate.
The Courier mail server sends a delayed Delivery Status
Notification at the conclusion of the first attempted <br>
delivery after warntime has elapsed.</p>

<p style="margin-top: 1em">Webmail template files <br>
HTML output from the webmail server is generated from the
template files in /usr/lib/courier/sqwebmail/html/en-us. It
is possible to translate the webmail interface into another
<br>
language simply by creating another subdirectory underneath
/usr/lib/courier/sqwebmail/html, then meticulously
translating each .html file. Each template file contains
<br>
well-formed HTML, with dynamic content marked off by tags.
Note that the large comment blocks in each HTML file need to
be translated too, since they are inserted as dynamic <br>
content, elsewhere.</p>

<p style="margin-top: 1em">The directory
/usr/lib/courier/sqwebmail/html/en-us also contains several
configuration files, in addition to the HTML template files.
Doing so allows this configuration <br>
information to be defined for each available language.</p>

<p style="margin-top: 1em">CHARSET <br>
This file consists of a single line of text, which names the
character set used by the HTML template files. It is
possible to specify multiple character set, by separating
<br>
them with commas, provided that HTML templates use only the
common portions of all listed character set.</p>

<p style="margin-top: 1em">The default English HTML
templates use strictly the &acirc;us-ascii&acirc; subset,
and the CHARSET contains utf-8,iso-8859-1. When multiple
character sets are listed, the first character <br>
set that&rsquo;s supported by the browser is picked, so with
UTF-8 capable browsers the default webmail interface will
use UTF-8, falling back to ISO-8859-1 for browsers that do
<br>
not support UTF-8.</p>

<p style="margin-top: 1em">footer <br>
The contents of this file, if it exists, are appended to all
messages sent by the webmail server.</p>

<p style="margin-top: 1em">ISPELLDICT <br>
This file consists of a single line of text, which contains
the name of the dictionary used for spell-checking. It is
passed as an argument to ispell, or aspell.</p>

<p style="margin-top: 1em">LANGUAGE <br>
This file consists of a single line of text, which should
always be the same as the name of its directory (en-us).</p>

<p style="margin-top: 1em">LANGUAGE_PREF <br>
This file is not needed at runtime, its contents are used
during installation. See webmail/html/README_LANG in the
source distribution for more information.</p>

<p style="margin-top: 1em">LOCALE <br>
The corresponding C locale for these templates.</p>

<p style="margin-top: 1em">TIMEZONELIST <br>
This file lists the available timezones on the login screen.
See the comments in this file for more information.</p>

<p style="margin-top: 1em">Sender Policy Framework Keywords
<br>
The Courier mail server can perform &acirc;Sender Policy
Framework&acirc; checks on up to three addresses for each
message. This is controlled by setting the following
variables: <br>
BOFHSPFHELO, BOFHSPFMAILFROM, and BOFHSPFFROM. Each variable
is set to a comma-separated list of the following keywords:
&acirc;off&acirc; - SPF verification disabled (default);
&acirc;none&acirc;, <br>
&acirc;neutral&acirc;, &acirc;pass&acirc;,
&acirc;fail&acirc;, &acirc;softfail&acirc;,
&acirc;error&acirc;, &acirc;unknown&acirc; - these keywords
correspond to the possible results of an SPF check, the
message is accepted for the listed SPF results <br>
only, any other SPF result is rejected; &acirc;all&acirc; -
shorthand for all possible SPF results, use
&acirc;all&acirc; to run SPF in informational mode only,
recording the SPF status in the <br>
Received-SPF: header; &acirc;allowok&acirc; - automatically
pass the SPF verification if the sender&rsquo;s IP address
is found in a DNS access whitelist, any whitelist given in
the -allow option <br>
to couriertcpd, see the &acirc;DNS ACCESS LISTS&acirc;
section in couriertcpd(1)[14].</p>

<p style="margin-top: 1em">A rejected SPF result gets
kicked back with a permanent error indication if the SPF
result is listed in BOFHSPFHARDERROR, and a temporary error
indication otherwise.</p>

<p style="margin-top: 1em">When enabling SPF checking, the
keyword list should always include &acirc;pass&acirc; (it
makes no sense to do otherwise) and &acirc;none&acirc;. The
keyword list should also include &acirc;softfail&acirc;,
<br>
&acirc;neutral&acirc;, and &acirc;unknown&acirc;. See the
SPF draft for a description of these status results. At some
distant future, the keyword list will only include
&acirc;pass&acirc;, rejecting all senders <br>
without a stated policy. This might be desirable at some
point in the future, but not right now.</p>

<p style="margin-top: 1em">The BOFHSPFFROM list may also
include an additional keyword, &acirc;mailfromok&acirc;.
BOFHSPFMAILFROM and BOFHSPFFROM are trade-offs. Using
BOFHSPFMAILFROM is faster, and it does not <br>
require the entire message to be received, before running
the SPF check. BOFHSPFFROM checking can only occur after the
entire message is received, but it&rsquo;s more reliable. If
<br>
&acirc;mailfromok&acirc; is listed, the From: is not checked
if the MAIL FROM command was checked with the
&acirc;pass&acirc; result.</p>

<p style="margin-top: 1em">In other words: the From: header
is checked if MAIL FROM was empty, or did not pass the SPF
checks. If MAIL FROM passed the SPF check the Courier mail
server won&rsquo;t bother looking <br>
at the From: header.</p>

<p style="margin-top: 1em">Note <br>
A conservative policy should not reject failed SPF checks
from the From:header, because it can be counterproductive in
some situations. This is because when a sender from a <br>
domain with a published SPF policy sends a message to a
mailing list, the message goes through the mailing list
processor&rsquo;s IP address, and it will fail the SPF check
unless <br>
the domain SPF explicitly authorizes the mailing list
processor&rsquo;s IP address.</p>

<p style="margin-top: 1em">This is very unlikely. The end
result is that domains with a published SPF record get
punished, and domains without an SPF record get off scott
free. Mailing lists should be <br>
encouraged to publish their own SPF records for mailing list
traffic; then the &acirc;mailfromok&acirc; keyword can
validate the mailing list&rsquo;s return address, and forego
checking of the <br>
&acirc;From:&acirc; header from the mailing list, while
still checking the &acirc;From:&acirc; header from everyone
else.</p>

<p style="margin-top: 1em">Another alternative is to use
opt BOFHSPFFROM=all for advisory purposes only.
Post-delivery mail filters can key off the
&acirc;Received-SPF&acirc; header.</p>

<p style="margin-top: 1em">Note <br>
The Courier mail server can add up to three
&acirc;Received-SPF&acirc; headers of its own, one for each
SPF check. The Courier mail server renames any existing
&acirc;Received-SPF&acirc; header as <br>
&acirc;Old-Received-SPF&acirc;. All
&acirc;Received-SPF&acirc; headers delivered to a local
mailbox will always come from the Courier mail server.</p>

<p style="margin-top: 1em">Servers with multiple IP
addresses <br>
The Courier mail server&rsquo;s default configuration
listens on port 25 on all IP addresses. If the server has
more than one IP address, Courier accepts connections on any
IP address. <br>
Adjust the settings in the esmtpd configuration file to
explicitly list which IP addresses Courier should listenson.
This also applies to the ESMTP over SSL server on port 465
<br>
configured by esmtpd-ssl, and the MSA server on port 587,
configured by esmtpd-msa.</p>

<p style="margin-top: 1em">That&rsquo;s for incoming EMSTP.
For outgoing ESMTP connections, the Courier mail server does
not specify an IP address by default, and lets the server
select one. The server selects a <br>
default IP address based on a server&rsquo;s network
configuration. The selection criteria is platform specific,
and is typically based on the system&rsquo;s IP routing
tables.</p>

<p style="margin-top: 1em">The ipout and ip6out
configuration files set an explicit IP address for
Courier&rsquo;s outgoing connections:</p>

<p style="margin-top: 1em"># echo &quot;192.168.0.1&quot;
&gt;/etc/courier/ipout <br>
# echo &quot;fec0::230:48ff:fec4:429c&quot;
&gt;/etc/courier/ip6out</p>

<p style="margin-top: 1em">This example specifies
192.168.0.1 as the IP address to make connections from for
IPv4 destinations, and fec0::230:48ff:fec4:429c for IPv6
destinations.</p>

<p style="margin-top: 1em">If the Courier mail server runs
on a host with two IPv4 addresses, 192.168.0.1, 192.168.1.1,
the above example uses 192.168.0.1 to send the relayed
message to IPv4 destinations <br>
even if Courier received the message from a client that
connected to the other addresses.</p>

<p style="margin-top: 1em">If the Courier mail server
accepts an ESMTP connection and a message from an
authenticated client with relaying privileges, in a
smarthost role, and forwards the message via <br>
ESMTP, Courier normally uses the server&rsquo;s default IP
address, or the one set by ipout or ipout6. When the Courier
mail servers runs on more than one IP address, it&rsquo;s
possible to <br>
selectively set the outgoing IP address based on which one
of those IP addresses the message was received at. A simple,
basic configuration forwards the message from the same IP
<br>
addresses it was received from, but it doesn&rsquo;t have to
be, it can be a different one.</p>

<p style="margin-top: 1em">The first step is to enable a
per-message, non-default configuration settings, like the
outgoing IP address, by creating a zero-length
vhost.ip-address file:</p>

<p style="margin-top: 1em"># touch
&gt;/etc/courier/vhost.192.168.0.1 <br>
# touch
&gt;&quot;/etc/courier/vhost.fec0::230:48ff:fec4:429c&quot;</p>

<p style="margin-top: 1em">This enables non-default
settings for messages received from a client that connects
to one of these IP addresses. These two IP addresses (one
IPv4 and one IPv6 address) are, <br>
presumably, two of the server&rsquo;s IP addresses. This is
not a client&rsquo;s IP address, these are the
server&rsquo;s IP addresses. These may be the only two IP
addresses the server has, or <br>
the server can have more IP addresses, but these are the
only two IP addresses for which custom settings get
enabled.</p>

<p style="margin-top: 1em">One such custom setting would be
a different IP address for outgoing connections depending on
the IP address of the connection the message was originally
received from:</p>

<p style="margin-top: 1em"># echo &quot;192.168.0.1&quot;
&gt;/etc/courier/ipout.192.168.0.1 <br>
# echo &quot;192.168.1.1&quot;
&gt;/etc/courier/ipout.192.168.1.1</p>

<p style="margin-top: 1em">&acirc;ipout.address&acirc; sets
the IP address for outgoing connections for messages
received from a client connection to &acirc;address&acirc;
only. Just an ipout applies to all other messages, except
<br>
ones which have an ipout.address in existence. The above
example specifies that, on a server with these two IP
addresses, messages received from a client that&rsquo;s
connected to <br>
either IP address get forwarded (from a client that normally
authenticates and receives relaying privileges) using a
connection from the same IP address. If the server has any
<br>
other IP addresses, the IP address in ipout takes effect (or
the default system-specified IP address).</p>

<p style="margin-top: 1em">For convenience, an empty
ipout.address gets interpreted as if it contains the same
address. The above example is equivalent to:</p>

<p style="margin-top: 1em"># touch
/etc/courier/ipout.192.168.0.1 <br>
# touch /etc/courier/ipout.192.168.1.1</p>

<p style="margin-top: 1em">The formal configuration rules
are as follows, for a message received from IP address
&acirc;address&acirc;, which may be an IPv4 or an IPv6
address:</p>

<p style="margin-top: 1em">&Acirc;&middot; The IPv4 address
and the IPv6 address for outgoing ESMTP connections get
specified by the contents of /etc/courier/ipout.address and
/etc/courier/ip6out.address, <br>
respectively.</p>

<p style="margin-top: 1em">&Acirc;&middot; If the file
exists, but is empty, the same address becomes the IP
address for the outgoing connection.</p>

<p style="margin-top: 1em">&Acirc;&middot; The above rules
are in effect only if /etc/courier/vhost.address exists,</p>

<p style="margin-top: 1em">&Acirc;&middot; If the file does
not exist, or if /etc/courier/vhost.address does not exist,
the contents of /etc/courier/ipout, for IPv4 connections,
and /etc/courier/ip6out, for IPv6 <br>
connections set the IP address.</p>

<p style="margin-top: 1em">&Acirc;&middot; Otherwise, the
Courier mail server uses the default IP address determined
by the system&rsquo;s network configuration.</p>

<p style="margin-top: 1em">&Acirc;&middot; In
/etc/courier/ipout.address and /etc/courier/ip6out.address,
an address of &quot;0&quot; also specifies the
system&rsquo;s default IP address.</p>

<p style="margin-top: 1em">It is possible for the Courier
mail server to receive a message from an IPv6 connection,
and forward it to an IPv4 address, or vice versa. The
address portion of <br>
/etc/courier/ipout.address and /etc/courier/ip6out.address,
specifies the IP address the client used to connect to
Courier and may be either an IPv4 or an IPv6 address, in
both <br>
cases! For example:</p>

<p style="margin-top: 1em"># echo &quot;192.168.0.1&quot;
&gt;/etc/courier/ipout.192.168.0.1 <br>
# echo &quot;fec0::230:48ff:fec4:429c&quot;
&gt;/etc/courier/ip6out.192.168.0.1</p>

<p style="margin-top: 1em">This means that when a client
connects to the Courier mail server using the IP address
192.168.0.1 and relays a message, if the message gets
forwarded to an IPv4 address, Courier <br>
uses the same IP address, and if it gets forwarded to an
IPv6 address Courier uses this IPv6 address. The above also
probably means that:</p>

<p style="margin-top: 1em"># echo &quot;192.168.0.1&quot;
&gt;&quot;/etc/courier/ipout.fec0::230:48ff:fec4:429c&quot;
<br>
# echo &quot;fec0::230:48ff:fec4:429c&quot;
&gt;&quot;/etc/courier/ipout.fec0::230:48ff:fec4:429c&quot;</p>

<p style="margin-top: 1em">So if an IPv6 client connects to
Courier on this IPv6 address and relays a message, Courier
uses the same IPv6 address, or 192.168.0.1 depending on the
destination.</p>

<p style="margin-top: 1em">Note <br>
Notwithstanding the IP address set in an ipout or an ip6out
file, the server&rsquo;s network configuration must be able
to actually establish a network connection to the <br>
destination address from the explicitly specified IP
address. Specifying an explicit IP address for outgoing
connections implies that the IP addresses are fully and
globally <br>
routable.</p>

<p style="margin-top: 1em">Additionally, for all other
configuration files described in this manual page, the
Courier mail server uses &acirc;filename.address&acirc; if
it exists, in place of &acirc;filename&acirc; when <br>
processing messages received from &acirc;address&acirc;,
either an IPv4 or an IPv6 address.</p>

<p style="margin-top: 1em">This is used in all contexts
where it makes sense to do so:</p>

<p style="margin-top: 1em"># echo
&quot;relay.example.com&quot;
&gt;/etc/courier/me.192.168.0.1 <br>
# echo &quot;firewall.example.com&quot;
&gt;/etc/courier/me.192.168.1.1</p>

<p style="margin-top: 1em">This example specifies
&acirc;relay.example.com&acirc; as the contents of the me
configuration file, described earlier in this manual page,
when processing messages received by clients that <br>
connect to 192.168.0.1, and
&acirc;firewall.example.com&acirc; for processing messages
received by clients that connect to 192.168.1.1.</p>

<p style="margin-top: 1em">&acirc;me&acirc; is the default
hostname for most common Courier mail server configuration
settings, such as the server&rsquo;s name in the ESMTP
greeting banner, what Courier calls itself in the <br>
ESMTP EHLO/HELO commands, and other contexts, unless
overridden by a more specific setting.</p>

<p style="margin-top: 1em">Note <br>
The IP address-specific configuration settings get used only
in the context of processing messages, and have no impact on
other parts of the Courier mail server that do not <br>
have a direct relationship to a specific message. One such
example would be when Courier authenticates a client&rsquo;s
username or password. This is not directly related to any
<br>
message the client may or may not send after it
authenticates, so this happens in exactly the same way no
matter which IP address the client connected to.</p>

<p style="margin-top: 1em">Simulating a server with
multiple IP addresses <br>
As described in the previous section, the existence of
vhost.ip-address enables configuration settings only for
messages that were received at one of the IP addresses that
the <br>
Courier mail server accepts connections on.</p>

<p style="margin-top: 1em">It&rsquo;s possible to partially
achieve the same end results by creating vhost.domain:</p>

<p style="margin-top: 1em"># touch
&gt;/etc/courier/vhost.example.com</p>

<p style="margin-top: 1em">This enables per-message
specific configuration for messages received from
authenticated clients whose authenticated ID ends with
&acirc;@example.com&acirc;. If the server has more than one
<br>
IP address, but, for whatever reason, only receives mail on
one of them but wants to use the other one for outgoing mail
for this domain:</p>

<p style="margin-top: 1em"># echo &rsquo;192.168.0.1&rsquo;
&gt;/etc/courier/ipout.example.com</p>

<p style="margin-top: 1em">This sets this IP address for
all outgoing messages with a &acirc;@example.com&acirc;
authenticated client. It&rsquo;s important to note the
following limitations:</p>

<p style="margin-top: 1em">&Acirc;&middot; The Courier
authentication library (see installation instructions) must
be configured with accounts and mailboxes that follow the
&acirc;user@domain&acirc; format.</p>

<p style="margin-top: 1em">&Acirc;&middot; Not all
configuration settings can be customized in a
setting.domain. The trivial example would be the ESMTP
server banner. The mail server emits the banner before
it&rsquo;s ready <br>
to receive the first message, so no return address-based
customization is possible, of course, to select an ESMTP
server banner. Additionally, the &acirc;me&acirc;
configuration setting <br>
gets set before the return address is received, so the
contents of a domain-specific &acirc;me&acirc; may not be in
effect in all contexts.</p>

<p style="margin-top: 1em">&Acirc;&middot; Anyone can use
any return address they wish. Some mitigation is possible,
of course, using measures such as SPF, but it would be
mistake to believe that this is much more <br>
than just eye candy.</p>

<p style="margin-top: 1em">&Acirc;&middot; Both an IP
address and domain-based &acirc;vhost&acirc;s are allowed.
An IP address-based vhost takes precedence.</p>

<p style="margin-top: 1em">BUGS <br>
Flushing a single message will not work if the message queue
is backed up. When that happens, your only available option
is to flush the entire queue.</p>

<p style="margin-top: 1em">courier start fails if the
Courier mail server has detected a fatal operational error.
In this situation the top-level courierd daemon sleeps for a
minute, before automatically <br>
restarting. During this sleep interval courier stop does not
work.</p>

<p style="margin-top: 1em">SEE ALSO <br>
cancelmsg(1)[12], maildirmake(1)[10], maildrop(1)[6],
preline(1)[15], sendmail(1)[16], testmxlookup(1)[17],
dot-courier(5)[4], authlib(7)[18], courierfax(8)[7], <br>
courierfilter(8)[5], filterctl(8)[5],
courierldapaliasd(8)[9], courierpop3d(8)[19],
courierpop3d(8)[19], couriertcpd(8)[14], courieruucp(8)[13],
esmtpd(8)[20], imapd(8)[21], <br>
localmailfilter(7)[2], mailq(1)[1],
makeacceptmailfor(8)[22], makealiases(8)[23],
makehosteddomains(8)[8], makepercentrelay(8)[24],
makesmtpaccess(8)[3], makeuserdb(8)[25], <br>
pw2userdb(8)[25], mkdhparams(8)[26], mkesmtpdcert(8)[27],
mkimapdcert(8)[28], pop3d(8)[29], submit(8)[30],
userdb(8)[31].</p>

<p style="margin-top: 1em">AUTHOR <br>
Sam Varshavchik <br>
Author</p>

<p style="margin-top: 1em">NOTES <br>
1. mailq(1) <br>
[set $man.base.url.for.relative.links]/mailq.html</p>

<p style="margin-top: 1em">2. localmailfilter(7) <br>
[set
$man.base.url.for.relative.links]/localmailfilter.html</p>

<p style="margin-top: 1em">3. makesmtpaccess(8) <br>
[set
$man.base.url.for.relative.links]/makesmtpaccess.html</p>

<p style="margin-top: 1em">4. dot-courier(5) <br>
[set $man.base.url.for.relative.links]/dot-courier.html</p>

<p style="margin-top: 1em">5.</p>

<p style="margin-top: 1em">courierfilter(8) <br>
[set
$man.base.url.for.relative.links]/courierfilter.html</p>

<p style="margin-top: 1em">6.</p>

<p style="margin-top: 1em">maildrop(1) <br>
[set $man.base.url.for.relative.links]/maildrop.html</p>

<p style="margin-top: 1em">7. courierfax(8) <br>
[set $man.base.url.for.relative.links]/courierfax.html</p>

<p style="margin-top: 1em">8. makehosteddomains(8) <br>
[set
$man.base.url.for.relative.links]/makehosteddomains.html</p>

<p style="margin-top: 1em">9. courierldapaliasd(8) <br>
[set
$man.base.url.for.relative.links]/courierldapaliasd.html</p>

<p style="margin-top: 1em">10. maildirmake(1) <br>
[set $man.base.url.for.relative.links]/maildirmake.html</p>

<p style="margin-top: 1em">11. maildropfilter(6) <br>
[set
$man.base.url.for.relative.links]/maildropfilter.html</p>

<p style="margin-top: 1em">12. cancelmsg(1) <br>
[set $man.base.url.for.relative.links]/cancelmsg.html</p>

<p style="margin-top: 1em">13. courieruucp(8) <br>
[set $man.base.url.for.relative.links]/courieruucp.html</p>

<p style="margin-top: 1em">14. couriertcpd(1) <br>
[set $man.base.url.for.relative.links]/couriertcpd.html</p>

<p style="margin-top: 1em">15.</p>

<p style="margin-top: 1em">preline(1) <br>
[set $man.base.url.for.relative.links]/preline.html</p>

<p style="margin-top: 1em">16.</p>

<p style="margin-top: 1em">sendmail(1) <br>
[set $man.base.url.for.relative.links]/sendmail.html</p>

<p style="margin-top: 1em">17.</p>

<p style="margin-top: 1em">testmxlookup(1) <br>
[set $man.base.url.for.relative.links]/testmxlookup.html</p>

<p style="margin-top: 1em">18.</p>

<p style="margin-top: 1em">authlib(7) <br>
[set $man.base.url.for.relative.links]/authlib.html</p>

<p style="margin-top: 1em">19.</p>

<p style="margin-top: 1em">courierpop3d(8) <br>
[set $man.base.url.for.relative.links]/courierpop3d.html</p>

<p style="margin-top: 1em">20.</p>

<p style="margin-top: 1em">esmtpd(8) <br>
[set $man.base.url.for.relative.links]/esmtpd.html</p>

<p style="margin-top: 1em">21.</p>

<p style="margin-top: 1em">imapd(8) <br>
[set $man.base.url.for.relative.links]/imapd.html</p>

<p style="margin-top: 1em">22.</p>

<p style="margin-top: 1em">makeacceptmailfor(8) <br>
[set
$man.base.url.for.relative.links]/makeacceptmailfor.html</p>

<p style="margin-top: 1em">23.</p>

<p style="margin-top: 1em">makealiases(8) <br>
[set $man.base.url.for.relative.links]/makealiases.html</p>

<p style="margin-top: 1em">24.</p>

<p style="margin-top: 1em">makepercentrelay(8) <br>
[set
$man.base.url.for.relative.links]/makepercentrelay.html</p>

<p style="margin-top: 1em">25.</p>

<p style="margin-top: 1em">makeuserdb(8) <br>
[set $man.base.url.for.relative.links]/makeuserdb.html</p>

<p style="margin-top: 1em">26.</p>

<p style="margin-top: 1em">mkdhparams(8) <br>
[set $man.base.url.for.relative.links]/mkdhparams.html</p>

<p style="margin-top: 1em">27.</p>

<p style="margin-top: 1em">mkesmtpdcert(8) <br>
[set $man.base.url.for.relative.links]/mkesmtpdcert.html</p>

<p style="margin-top: 1em">28.</p>

<p style="margin-top: 1em">mkimapdcert(8) <br>
[set $man.base.url.for.relative.links]/mkimapdcert.html</p>

<p style="margin-top: 1em">29.</p>

<p style="margin-top: 1em">pop3d(8) <br>
[set $man.base.url.for.relative.links]/pop3d.html</p>

<p style="margin-top: 1em">30.</p>

<p style="margin-top: 1em">submit(8) <br>
[set $man.base.url.for.relative.links]/submit.html</p>

<p style="margin-top: 1em">31.</p>

<p style="margin-top: 1em">userdb(8) <br>
[set $man.base.url.for.relative.links]/userdb.html</p>

<p style="margin-top: 1em">Courier Mail Server 08/17/2016
COURIER(8)</p>
<hr>
</body>
</html>
