<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>IPSEC_EROUTE(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">IPSEC_EROUTE(8)</td>
    <td class="head-vol">Executable programs</td>
    <td class="head-rtitle">IPSEC_EROUTE(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
ipsec_eroute - manipulate IPSEC extended routing tables
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<div class="Pp" style="margin-left: 13.00ex; text-indent: -13.00ex;"><b>ipsec
  eroute</b>
  <b></b><i>--add</i>&#x00A0;<b>--eraf</b>&#x00A0;<i>(inet&#x00A0;|&#x00A0;inet6)</i>&#x00A0;
  <b>--src</b>&#x00A0;<i>src/srcmaskbits|srcmask</i>&#x00A0;<b>--dst</b>&#x00A0;<i>dst/dstmaskbits|dstmask</i>&#x00A0;[[<b>--transport-proto</b>&#x00A0;<i>transport-protocol</i>]]&#x00A0;[<b>--src-port&#x00A0;</b><b></b><i>source-port</i>]&#x00A0;[<b>--dst-port&#x00A0;</b><b></b><i>dest-port</i>]&#x00A0;[&lt;SAID&gt;]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 13.00ex; text-indent: -13.00ex;"><b>ipsec
  eroute</b>
  <b></b><i>--replace</i>&#x00A0;<b>--eraf</b>&#x00A0;<i>(inet&#x00A0;|&#x00A0;inet6)</i>&#x00A0;
  <b>--src</b>&#x00A0;<i>src/srcmaskbits|srcmask</i>&#x00A0;<b>--dst</b>&#x00A0;<i>dst/dstmaskbits|dstmask</i>&#x00A0;[[<b>--transport-proto</b>&#x00A0;<i>transport-protocol</i>]]&#x00A0;[<b>--src-port&#x00A0;</b><b></b><i>source-port</i>]&#x00A0;[<b>--dst-port&#x00A0;</b><b></b><i>dest-port</i>]&#x00A0;[&lt;SAID&gt;]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 13.00ex; text-indent: -13.00ex;"><b>ipsec
  eroute</b>
  <b></b><i>--del</i>--del<b>--eraf</b>&#x00A0;<i>(inet&#x00A0;|&#x00A0;inet6)</i>&#x00A0;
  <b>--src</b><i>src/srcmaskbits|srcmask</i><b>--dst</b><i>dst/dstmaskbits|dstmask</i>&#x00A0;[[<b>--transport-proto</b>&#x00A0;<i>transport-protocol</i>]]&#x00A0;[<b>--src-port&#x00A0;</b><b></b><i>source-port</i>]&#x00A0;[<b>--dst-port&#x00A0;</b><b></b><i>dest-port</i>]&#x00A0;[&lt;SAID&gt;]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 13.00ex; text-indent: -13.00ex;"><b>ipsec
  eroute</b> --clear</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 13.00ex; text-indent: -13.00ex;"><b>ipsec
  eroute</b> --help</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 13.00ex; text-indent: -13.00ex;"><b>ipsec
  eroute</b> --version</div>
<h1 class="Sh" title="Sh" id="SAID_DESCRIPTION"><a class="selflink" href="#SAID_DESCRIPTION">SAID
  DESCRIPTION</a></h1>
Where &lt;SAID&gt; is --af (inet | inet6) --edst edst --spi spi --proto proto OR
  --said said OR --said (%passthrough | %passthrough4 | %passthrough6 | %drop |
  %reject | %trap | %hold | %pass )
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<i>Eroute</i> manages the IPSEC extended routing tables, which control what (if
  any) processing is applied to non-encrypted packets arriving for IPSEC
  processing and forwarding. The form with no additional arguments lists the
  contents of /proc/net/ipsec_eroute. The <b>--add</b> form adds a table entry,
  the <b>--replace</b> form replaces a table entry, while the <b>--del</b> form
  deletes one. The <b>--clear</b> form deletes the entire table.
<div class="Pp"></div>
A table entry consists of:
<div class="Pp"></div>
+
<div style="margin-left: 4.00ex;">source and destination addresses, with masks,
  source and destination ports and protocol for selection of packets. The source
  and destination ports are only legal if the transport protocol is <b>TCP</b>
  or <b>UDP.</b> A port can be specified as either decimal, hexadecimal (leading
  0x), octal (leading 0) or a name listed in the first column of /etc/services.
  A transport protocol can be specified as either decimal, hexadecimal (leading
  0x), octal (leading 0) or a name listed in the first column of /etc/protocols.
  If a transport protocol or port is not specified then it defaults to 0 which
  means all protocols or all ports respectively.</div>
<div class="Pp"></div>
+
<div style="margin-left: 4.00ex;">Security Association IDentifier, comprised
  of:</div>
<div class="Pp"></div>
+
<div style="margin-left: 4.00ex;">protocol (<i>proto</i>), indicating (together
  with the effective destination and the security parameters index) which
  Security Association should be used to process the packet</div>
<div class="Pp"></div>
+
<div style="margin-left: 4.00ex;">address family (<i>af</i>),</div>
<div class="Pp"></div>
+
<div style="margin-left: 4.00ex;">Security Parameters Index (<i>spi</i>),
  indicating (together with the effective destination and protocol) which
  Security Association should be used to process the packet (must be larger than
  or equal to 0x100)</div>
<div class="Pp"></div>
+
<div style="margin-left: 4.00ex;">effective destination (<i>edst</i>), where the
  packet should be forwarded after processing (normally the other security
  gateway)</div>
<div class="Pp"></div>
+
<div style="margin-left: 4.00ex;">OR</div>
<div class="Pp"></div>
+
<div style="margin-left: 4.00ex;">SAID (<i>said</i>), indicating which Security
  Association should be used to process the packet</div>
<div class="Pp"></div>
Addresses are written as IPv4 dotted quads or IPv6 coloned hex, protocol is one
  of &quot;ah&quot;, &quot;esp&quot;, &quot;comp&quot; or &quot;tun&quot; and
  SPIs are prefixed hexadecimal numbers where '.' represents IPv4 and ':' stands
  for IPv6.
<div class="Pp"></div>
SAIDs are written as &quot;protoafSPI@address&quot;. There are also 5
  &quot;magic&quot; SAIDs which have special meaning:
<div class="Pp"></div>
+
<div style="margin-left: 4.00ex;"><b>%drop</b> means that matches are to be
  dropped</div>
<div class="Pp"></div>
+
<div style="margin-left: 4.00ex;"><b>%reject</b> means that matches are to be
  dropped and an ICMP returned, if possible to inform</div>
<div class="Pp"></div>
+
<div style="margin-left: 4.00ex;"><b>%trap</b> means that matches are to trigger
  an ACQUIRE message to the Key Management daemon(s) and a hold eroute will be
  put in place to prevent subsequent packets also triggering ACQUIRE
  messages.</div>
<div class="Pp"></div>
+
<div style="margin-left: 4.00ex;"><b>%hold</b> means that matches are to stored
  until the eroute is replaced or until that eroute gets reaped</div>
<div class="Pp"></div>
+
<div style="margin-left: 4.00ex;"><b>%pass</b> means that matches are to allowed
  to pass without IPSEC processing</div>
<div class="Pp"></div>
The format of /proc/net/ipsec_eroute is listed in ipsec_eroute(5).
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
<b>ipsec eroute --add --eraf inet --src 192.168.0.1/32 \</b><b> --dst
  192.168.2.0/24 --af inet --edst 192.168.0.2 \</b> <b> --spi 0x135 --proto
  tun</b>
<div class="Pp"></div>
sets up an <b>eroute</b> on a Security Gateway to protect traffic between the
  host 192.168.0.1 and the subnet 192.168.2.0 with 24 bits of subnet mask via
  Security Gateway 192.168.0.2 using the Security Association with address
  192.168.0.2, Security Parameters Index <b>0x135</b> and protocol <b>tun</b>
  (50, IPPROTO_ESP).
<div class="Pp"></div>
<b>ipsec eroute --add --eraf inet6 --src 3049:1::1/128 \</b><b> --dst
  3049:2::/64 --af inet6 --edst 3049:1::2 \</b> <b> --spi 0x145 --proto tun</b>
<div class="Pp"></div>
sets up an <b>eroute</b> on a Security Gateway to protect traffic between the
  host <b>3049:1::1</b> and the subnet <b>3049:2::</b> with 64 bits of subnet
  mask via Security Gateway <b>3049:1::2</b> using the Security Association with
  address <b>3049:1::2</b>, Security Parameters Index <b>0x145</b> and protocol
  <b>tun</b> (50, IPPROTO_ESP).
<div class="Pp"></div>
<b>ipsec eroute --replace --eraf inet --src company.com/24 \</b><b> --dst
  ftp.ngo.org/32 --said tun.135@gw.ngo.org</b>
<div class="Pp"></div>
replaces an <b>eroute</b> on a Security Gateway to protect traffic between the
  subnet <b>company.com</b> with 24 bits of subnet mask and the host
  <b>ftp.ngo.org</b> via Security Gateway <b>gw.ngo.org</b> using the Security
  Association with Security Association ID <b>tun0x135@gw.ngo.org</b>
<div class="Pp"></div>
<b>ipsec eroute --del --eraf inet --src company.com/24 \</b><b> --dst
  www.ietf.org/32 --said %passthrough4</b>
<div class="Pp"></div>
deletes an <b>eroute</b> on a Security Gateway that allowed traffic between the
  subnet <b>company.com</b> with 24 bits of subnet mask and the host
  <b>www.ietf.org</b> to pass in the clear, unprocessed.
<div class="Pp"></div>
<b>ipsec eroute --add --eraf inet --src company.com/24 \</b><b> --dst
  mail.ngo.org/32 --transport-proto 6 \</b> <b> --dst-port 110 --said
  tun.135@mail.ngo.org</b>
<div class="Pp"></div>
sets up an <b>eroute</b> on on a Security Gateway to protect only TCP traffic on
  port 110 (pop3) between the subnet <b>company.com</b> with 24 bits of subnet
  mask and the host <b>ftp.ngo.org</b> via Security Gateway <b>mail.ngo.org</b>
  using the Security Association with Security Association ID
  <b>tun0x135@mail.ngo.org.</b> Note that any other traffic bound for
  <b>mail.ngo.org</b> that is routed via the ipsec device will be dropped. If
  you wish to allow other traffic to pass through then you must add a %pass
  rule. For example the following rule when combined with the above will ensure
  that POP3 messages read from <b>mail.ngo.org</b> will be encrypted but all
  other traffic to/from <b>mail.ngo.org</b> will be in clear text.
<div class="Pp"></div>
<b>ipsec eroute --add --eraf inet --src company.com/24 \</b><b> --dst
  mail.ngo.org/32 --said %pass</b>
<h1 class="Sh" title="Sh" id="FILES"><a class="selflink" href="#FILES">FILES</a></h1>
/proc/net/ipsec_eroute, /usr/local/bin/ipsec
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
ipsec(8), ipsec_tncfg(8), ipsec_spi(8), ipsec_spigrp(8), ipsec_klipsdebug(8),
  ipsec_eroute(5)
<h1 class="Sh" title="Sh" id="HISTORY"><a class="selflink" href="#HISTORY">HISTORY</a></h1>
Written for the Linux FreeS/WAN project &lt; <b>http://www.freeswan.org/</b>&gt;
  by Richard Guy Briggs.
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
<b>Paul Wouters</b>
<div style="margin-left: 4.00ex;">placeholder to suppress warning</div>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">11/12/2016</td>
    <td class="foot-os">libreswan</td>
  </tr>
</table>
</body>
</html>
