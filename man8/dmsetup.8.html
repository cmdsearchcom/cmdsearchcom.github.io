<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 19:10:22 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>DMSETUP(8) MAINTENANCE COMMANDS DMSETUP(8)</p>

<p style="margin-top: 1em">NAME <br>
dmsetup &acirc; low level logical volume management</p>

<p style="margin-top: 1em">SYNOPSIS <br>
dmsetup clear device_name <br>
dmsetup create device_name [-u|--uuid uuid]
[--addnodeoncreate|--addnodeonresume] [-n|--notable|--table
{table|table_file}] [--readahead {[+]sectors|auto|none}]
<br>
dmsetup deps [-o options] [device_name] <br>
dmsetup help [-c|-C|--columns] <br>
dmsetup info [device_name] <br>
dmsetup info -c|-C|--columns [--count count] [--interval
seconds] [--nameprefixes] [--noheadings] [-o fields]
[-O|--sort sort_fields] [--separator separator]
[device_name] <br>
dmsetup load device_name [--table {table|table_file}] <br>
dmsetup ls [--target target_type] [--exec command] [--tree]
[-o options] <br>
dmsetup mangle [device_name] <br>
dmsetup message device_name sector message <br>
dmsetup mknodes [device_name] <br>
dmsetup reload device_name [--table {table|table_file}] <br>
dmsetup remove [-f|--force] [--retry] [--deferred]
device_name <br>
dmsetup remove_all [-f|--force] [--deferred] <br>
dmsetup rename device_name new_name <br>
dmsetup rename device_name --setuuid uuid <br>
dmsetup resume device_name
[--addnodeoncreate|--addnodeonresume] [--noflush]
[--nolockfs] [--readahead {[+]sectors|auto|none}] <br>
dmsetup setgeometry device_name cyl head sect start <br>
dmsetup splitname device_name [subsystem] <br>
dmsetup stats command [options] <br>
dmsetup status [--target target_type] [--noflush]
[device_name] <br>
dmsetup suspend [--nolockfs] [--noflush] device_name <br>
dmsetup table [--target target_type] [--showkeys]
[device_name] <br>
dmsetup targets <br>
dmsetup udevcomplete cookie <br>
dmsetup udevcomplete_all [age_in_minutes] <br>
dmsetup udevcookie <br>
dmsetup udevcreatecookie <br>
dmsetup udevflags cookie <br>
dmsetup udevreleasecookie [cookie] <br>
dmsetup version <br>
dmsetup wait [--noflush] device_name [event_nr] <br>
dmsetup wipe_table device_name [-f|--force] [--noflush]
[--nolockfs]</p>

<p style="margin-top: 1em">devmap_name major minor <br>
devmap_name major:minor</p>

<p style="margin-top: 1em">DESCRIPTION <br>
dmsetup manages logical devices that use the device-mapper
driver. Devices are created by loading a table that
specifies a target for each sector (512 bytes) in the
logical <br>
device.</p>

<p style="margin-top: 1em">The first argument to dmsetup is
a command. The second argument is the logical device name or
uuid.</p>

<p style="margin-top: 1em">Invoking the dmsetup tool as
devmap_name (which is not normally distributed and is
supported only for historical reasons) is equivalent to <br>
dmsetup info -c --noheadings -j major -m minor.</p>

<p style="margin-top: 1em">OPTIONS <br>
--addnodeoncreate <br>
Ensure /dev/mapper node exists after dmsetup create.</p>

<p style="margin-top: 1em">--addnodeonresume <br>
Ensure /dev/mapper node exists after dmsetup resume (default
with udev).</p>

<p style="margin-top: 1em">--checks <br>
Perform additional checks on the operations requested and
report potential problems. Useful when debugging scripts. In
some cases these checks may slow down operations <br>
noticeably.</p>

<p style="margin-top: 1em">-c|-C|--columns <br>
Display output in columns rather than as Field: Value
lines.</p>

<p style="margin-top: 1em">--count count <br>
Specify the number of times to repeat a report. Set this to
zero continue until interrupted. The default interval is one
second.</p>

<p style="margin-top: 1em">-f|--force <br>
Try harder to complete operation.</p>

<p style="margin-top: 1em">-h|--help <br>
Outputs a summary of the commands available, optionally
including the list of report fields (synonym with help
command).</p>

<p style="margin-top: 1em">--inactive <br>
When returning any table information from the kernel report
on the inactive table instead of the live table. Requires
kernel driver version 4.16.0 or above.</p>

<p style="margin-top: 1em">--interval seconds <br>
Specify the interval in seconds between successive
iterations for repeating reports. If --interval is specified
but --count is not, reports will continue to repeat until
<br>
interrupted. The default interval is one second.</p>

<p style="margin-top: 1em">--manglename {auto|hex|none}
<br>
Mangle any character not on a whitelist using mangling_mode
when processing device-mapper device names and UUIDs. The
names and UUIDs are mangled on input and unmangled on <br>
output where the mangling mode is one of: auto (only do the
mangling if not mangled yet, do nothing if already mangled,
error on mixed), hex (always do the mangling) and <br>
none (no mangling). Default mode is auto. Character
whitelist: 0-9, A-Z, a-z, #+-.:=@_. This whitelist is also
supported by udev. Any character not on a whitelist is <br>
replaced with its hex value (two digits) prefixed by
Mangling mode could be also set through
DM_DEFAULT_NAME_MANGLING_MODE environment variable.</p>

<p style="margin-top: 1em">-j|--major major <br>
Specify the major number.</p>

<p style="margin-top: 1em">-m|--minor minor <br>
Specify the minor number.</p>

<p style="margin-top: 1em">-n|--notable <br>
When creating a device, don&rsquo;t load any table.</p>

<p style="margin-top: 1em">--nameprefixes <br>
Add a &quot;DM_&quot; prefix plus the field name to the
output. Useful with --noheadings to produce a list of
field=value pairs that can be used to set environment
variables (for <br>
example, in udev(7) rules).</p>

<p style="margin-top: 1em">--noheadings Suppress the
headings line when using columnar output.</p>

<p style="margin-top: 1em">--noflush Do not flush
outstading I/O when suspending a device, or do not commit
thin-pool metadata when obtaining thin-pool status.</p>

<p style="margin-top: 1em">--nolockfs <br>
Do not attempt to synchronize filesystem eg, when suspending
a device.</p>

<p style="margin-top: 1em">--noopencount <br>
Tell the kernel not to supply the open reference count for
the device.</p>

<p style="margin-top: 1em">--noudevrules <br>
Do not allow udev to manage nodes for devices in
device-mapper directory.</p>

<p style="margin-top: 1em">--noudevsync <br>
Do not synchronise with udev when creating, renaming or
removing devices.</p>

<p style="margin-top: 1em">-o|--options options <br>
Specify which fields to display.</p>

<p style="margin-top: 1em">--readahead
{[+]sectors|auto|none} <br>
Specify read ahead size in units of sectors. The default
value is auto which allows the kernel to choose a suitable
value automatically. The + prefix lets you specify a <br>
minimum value which will not be used if it is smaller than
the value chosen by the kernel. The value none is equivalent
to specifying zero.</p>

<p style="margin-top: 1em">-r|--readonly <br>
Set the table being loaded read-only.</p>

<p style="margin-top: 1em">-S|--select selection <br>
Display only rows that match selection criteria. All rows
are displayed with the additional &quot;selected&quot;
column (-o selected) showing 1 if the row matches the
selection and <br>
0 otherwise. The selection criteria are defined by
specifying column names and their valid values while making
use of supported comparison operators. As a quick help and
<br>
to see full list of column names that can be used in
selection and the set of supported selection operators,
check the output of dmsetup info -c -S help command.</p>

<p style="margin-top: 1em">--table table <br>
Specify a one-line table directly on the command line. See
below for more information on the table format.</p>

<p style="margin-top: 1em">--udevcookie cookie <br>
Use cookie for udev synchronisation. Note: Same cookie
should be used for same type of operations i.e. creation of
multiple different devices. It&rsquo;s not adviced to
combine <br>
different operations on the single device.</p>

<p style="margin-top: 1em">-u|--uuid <br>
Specify the uuid.</p>

<p style="margin-top: 1em">-y|--yes <br>
Answer yes to all prompts automatically.</p>

<p style="margin-top: 1em">-v|--verbose [-v|--verbose] <br>
Produce additional output.</p>

<p style="margin-top: 1em">--verifyudev <br>
If udev synchronisation is enabled, verify that udev
operations get performed correctly and try to fix up the
device nodes afterwards if not.</p>

<p style="margin-top: 1em">--version <br>
Display the library and kernel driver version.</p>

<p style="margin-top: 1em">COMMANDS <br>
clear device_name <br>
Destroys the table in the inactive table slot for
device_name.</p>

<p style="margin-top: 1em">create device_name [-u|--uuid
uuid] [--addnodeoncreate|--addnodeonresume]
[-n|--notable|--table {table|table_file}] [--readahead
{[+]sectors|auto|none}] <br>
Creates a device with the given name. If table or table_file
is supplied, the table is loaded and made live. Otherwise a
table is read from standard input unless <br>
--notable is used. The optional uuid can be used in place of
device_name in subsequent dmsetup commands. If successful
the device will appear in table and for live <br>
device the node /dev/mapper/device_name is created. See
below for more information on the table format.</p>

<p style="margin-top: 1em">deps [-o options] [device_name]
<br>
Outputs a list of devices referenced by the live table for
the specified device. Device names on output can be
customised by following options: devno (major and minor <br>
pair, used by default), blkdevname (block device name),
devname (map name for device-mapper devices, equal to
blkdevname otherwise).</p>

<p style="margin-top: 1em">help [-c|-C|--columns] <br>
Outputs a summary of the commands available, optionally
including the list of report fields.</p>

<p style="margin-top: 1em">info [device_name] <br>
Outputs some brief information about the device in the form:
<br>
State: SUSPENDED|ACTIVE, READ-ONLY <br>
Tables present: LIVE and/or INACTIVE <br>
Open reference count <br>
Last event sequence number (used by wait) <br>
Major and minor device number <br>
Number of targets in the live table <br>
UUID</p>

<p style="margin-top: 1em">info -c|-C|--columns [--count
count] [--interval seconds] [--nameprefixes] [--noheadings]
[-o fields] [-O|--sort sort_fields] [--separator separator]
[device_name] <br>
Output you can customise. Fields are comma-separated and
chosen from the following list: name, major, minor, attr,
open, segments, events, uuid. Attributes are: (L)ive, <br>
(I)nactive, (s)uspended, (r)ead-only, read-(w)rite. Precede
the list with &rsquo;+&rsquo; to append to the default
selection of columns instead of replacing it. Precede any
sort <br>
field with &rsquo;-&rsquo; for a reverse sort on that
column.</p>

<p style="margin-top: 1em">ls [--target target_type]
[--exec command] [--tree] [-o options] <br>
List device names. Optionally only list devices that have at
least one target of the specified type. Optionally execute a
command for each device. The device name is <br>
appended to the supplied command. Device names on output can
be customised by following options: devno (major and minor
pair, used by default), blkdevname (block device <br>
name), devname (map name for device-mapper devices, equal to
blkdevname otherwise). --tree displays dependencies between
devices as a tree. It accepts a comma-separate <br>
list of options. Some specify the information displayed
against each node: device/nodevice; blkdevname; active,
open, rw, uuid. Others specify how the tree is displayed:
<br>
ascii, utf, vt100; compact, inverted, notrunc.</p>

<p style="margin-top: 1em">load|reload device_name [--table
{table|table_file}] <br>
Loads table or table_file into the inactive table slot for
device_name. If neither is supplied, reads a table from
standard input.</p>

<p style="margin-top: 1em">mangle [device_name] <br>
Ensure existing device-mapper device_name and UUID is in the
correct mangled form containing only whitelisted characters
(supported by udev) and do a rename if necessary. <br>
Any character not on the whitelist will be mangled based on
the --manglename setting. Automatic rename works only for
device names and not for device UUIDs because the <br>
kernel does not allow changing the UUID of active devices.
Any incorrect UUIDs are reported only and they must be
manually corrected by deactivating the device first and <br>
then reactivating it with proper mangling mode used (see
also --manglename).</p>

<p style="margin-top: 1em">message device_name sector
message <br>
Send message to target. If sector not needed use 0.</p>

<p style="margin-top: 1em">mknodes [device_name] <br>
Ensure that the node in /dev/mapper for device_name is
correct. If no device_name is supplied, ensure that all
nodes in /dev/mapper correspond to mapped devices currently
<br>
loaded by the device-mapper kernel driver, adding, changing
or removing nodes as necessary.</p>

<p style="margin-top: 1em">remove [-f|--force] [--retry]
[--deferred] device_name <br>
Removes a device. It will no longer be visible to dmsetup.
Open devices cannot be removed, but adding --force will
replace the table with one that fails all I/O. <br>
--deferred will enable deferred removal of open devices -
the device will be removed when the last user closes it. The
deferred removal feature is supported since version <br>
4.27.0 of the device-mapper driver available in upstream
kernel version 3.13. (Use dmsetup version to check this.) If
an attempt to remove a device fails, perhaps <br>
because a process run from a quick udev rule temporarily
opened the device, the --retry option will cause the
operation to be retried for a few seconds before failing. Do
<br>
NOT combine --force and --udevcookie, as udev may start to
process udev rules in the middle of error target replacement
and result in nondeterministic result.</p>

<p style="margin-top: 1em">remove_all [-f|--force]
[--deferred] <br>
Attempts to remove all device definitions i.e. reset the
driver. This also runs mknodes afterwards. Use with care!
Open devices cannot be removed, but adding --force <br>
will replace the table with one that fails all I/O.
--deferred will enable deferred removal of open devices -
the device will be removed when the last user closes it.
<br>
The deferred removal feature is supported since version
4.27.0 of the device-mapper driver available in upstream
kernel version 3.13.</p>

<p style="margin-top: 1em">rename device_name new_name <br>
Renames a device.</p>

<p style="margin-top: 1em">rename device_name --setuuid
uuid <br>
Sets the uuid of a device that was created without a uuid.
After a uuid has been set it cannot be changed.</p>

<p style="margin-top: 1em">resume device_name
[--addnodeoncreate|--addnodeonresume] [--noflush]
[--nolockfs] [--readahead {[+]sectors|auto|none}] <br>
Un-suspends a device. If an inactive table has been loaded,
it becomes live. Postponed I/O then gets re-queued for
processing.</p>

<p style="margin-top: 1em">setgeometry device_name cyl head
sect start <br>
Sets the device geometry to C/H/S.</p>

<p style="margin-top: 1em">splitname device_name
[subsystem] <br>
Splits given device name into subsystem constituents. The
default subsystem is LVM. LVM currently generates device
names by concatenating the names of the Volume Group, <br>
Logical Volume and any internal Layer with a hyphen as
separator. Any hyphens within the names are doubled to
escape them. The precise encoding might change without <br>
notice in any future release, so we recommend you always
decode using the current version of this command.</p>

<p style="margin-top: 1em">stats command [options] <br>
Manages IO statistics regions for devices. See dmstats(8)
for more details.</p>

<p style="margin-top: 1em">status [--target target_type]
[--noflush] [device_name] <br>
Outputs status information for each of the device&rsquo;s
targets. With --target, only information relating to the
specified target type any is displayed. With --noflush, the
<br>
thin target (from version 1.3.0) doesn&rsquo;t commit any
outstanding changes to disk before reporting its
statistics.</p>

<p style="margin-top: 1em">suspend [--nolockfs] [--noflush]
device_name <br>
Suspends a device. Any I/O that has already been mapped by
the device but has not yet completed will be flushed. Any
further I/O to that device will be postponed for as <br>
long as the device is suspended. If there&rsquo;s a
filesystem on the device which supports the operation, an
attempt will be made to sync it first unless --nolockfs is
speci&acirc; <br>
fied. Some targets such as recent (October 2006) versions of
multipath may support the --noflush option. This lets
outstanding I/O that has not yet reached the device to <br>
remain unflushed.</p>

<p style="margin-top: 1em">table [--target target_type]
[--showkeys] [device_name] <br>
Outputs the current table for the device in a format that
can be fed back in using the create or load commands. With
--target, only information relating to the specified <br>
target type is displayed. Encryption keys are suppressed in
the table output for the crypt target unless the --showkeys
parameter is supplied.</p>

<p style="margin-top: 1em">targets <br>
Displays the names and versions of the currently-loaded
targets.</p>

<p style="margin-top: 1em">udevcomplete cookie <br>
Wake any processes that are waiting for udev to complete
processing the specified cookie.</p>

<p style="margin-top: 1em">udevcomplete_all
[age_in_minutes] <br>
Remove all cookies older than the specified number of
minutes. Any process waiting on a cookie will be resumed
immediately.</p>

<p style="margin-top: 1em">udevcookie <br>
List all existing cookies. Cookies are system-wide
semaphores with keys prefixed by two predefined bytes
(0x0D4D).</p>

<p style="margin-top: 1em">udevcreatecookie <br>
Creates a new cookie to synchronize actions with udev
processing. The output is a cookie value. Normally we
don&rsquo;t need to create cookies since dmsetup creates and
<br>
destroys them for each action automatically. However, we can
generate one explicitly to group several actions together
and use only one cookie instead. We can define a <br>
cookie to use for each relevant command by using
--udevcookie option. Alternatively, we can export this value
into the environment of the dmsetup process as
DM_UDEV_COOKIE <br>
variable and it will be used automatically with all
subsequent commands until it is unset. Invoking this command
will create system-wide semaphore that needs to be <br>
cleaned up explicitly by calling udevreleasecookie
command.</p>

<p style="margin-top: 1em">udevflags cookie <br>
Parses given cookie value and extracts any udev control
flags encoded. The output is in environment key format that
is suitable for use in udev rules. If the flag has its <br>
symbolic name assigned then the output is
DM_UDEV_FLAG_&lt;flag_name&gt; = &rsquo;1&rsquo;,
DM_UDEV_FLAG&lt;flag_position&gt; = &rsquo;1&rsquo;
otherwise. Subsystem udev flags don&rsquo;t have symbolic
names <br>
assigned and these ones are always reported as
DM_SUBSYSTEM_UDEV_FLAG&lt;flag_position&gt; =
&rsquo;1&rsquo;. There are 16 udev flags altogether.</p>

<p style="margin-top: 1em">udevreleasecookie [cookie] <br>
Waits for all pending udev processing bound to given cookie
value and clean up the cookie with underlying semaphore. If
the cookie is not given directly, the command will <br>
try to use a value defined by DM_UDEV_COOKIE environment
variable.</p>

<p style="margin-top: 1em">version <br>
Outputs version information.</p>

<p style="margin-top: 1em">wait [--noflush] device_name
[event_nr] <br>
Sleeps until the event counter for device_name exceeds
event_nr. Use -v to see the event number returned. To wait
until the next event is triggered, use info to find the <br>
last event number. With --noflush, the thin target (from
version 1.3.0) doesn&rsquo;t commit any outstanding changes
to disk before reporting its statistics.</p>

<p style="margin-top: 1em">wipe_table device_name
[-f|--force] [--noflush] [--nolockfs] <br>
Wait for any I/O in-flight through the device to complete,
then replace the table with a new table that fails any new
I/O sent to the device. If successful, this should <br>
release any devices held open by the device&rsquo;s
table(s).</p>

<p style="margin-top: 1em">TABLE FORMAT <br>
Each line of the table specifies a single target and is of
the form:</p>

<p style="margin-top: 1em">logical_start_sector num_sectors
target_type target_args</p>

<p style="margin-top: 1em">Simple target types and target
args include:</p>

<p style="margin-top: 1em">linear destination_device
start_sector <br>
The traditional linear mapping.</p>

<p style="margin-top: 1em">striped num_stripes chunk_size
[destination start_sector]... <br>
Creates a striped area. <br>
e.g. striped 2 32 /dev/hda1 0 /dev/hdb1 0 will map the first
chunk (16k) as follows: <br>
LV chunk 1 -&gt; hda1, chunk 1 <br>
LV chunk 2 -&gt; hdb1, chunk 1 <br>
LV chunk 3 -&gt; hda1, chunk 2 <br>
LV chunk 4 -&gt; hdb1, chunk 2 <br>
etc.</p>

<p style="margin-top: 1em">error Errors any I/O that goes
to this area. Useful for testing or for creating devices
with holes in them.</p>

<p style="margin-top: 1em">zero Returns blocks of zeroes on
reads. Any data written is discarded silently. This is a
block-device equivalent of the /dev/zero character-device
data sink described in <br>
null(4).</p>

<p style="margin-top: 1em">More complex targets
include:</p>

<p style="margin-top: 1em">cache Improves performance of a
block device (eg, a spindle) by dynamically migrating some
of its data to a faster smaller device (eg, an SSD).</p>

<p style="margin-top: 1em">crypt Transparent encryption of
block devices using the kernel crypto API.</p>

<p style="margin-top: 1em">delay Delays reads and/or writes
to different devices. Useful for testing.</p>

<p style="margin-top: 1em">flakey Creates a similar mapping
to the linear target but exhibits unreliable behaviour
periodically. Useful for simulating failing devices when
testing.</p>

<p style="margin-top: 1em">mirror Mirrors data across two
or more devices.</p>

<p style="margin-top: 1em">multipath <br>
Mediates access through multiple paths to the same
device.</p>

<p style="margin-top: 1em">raid Offers an interface to the
kernel&rsquo;s software raid driver, md.</p>

<p style="margin-top: 1em">snapshot <br>
Supports snapshots of devices.</p>

<p style="margin-top: 1em">thin, thin-pool <br>
Supports thin provisioning of devices and also provides a
better snapshot support.</p>

<p style="margin-top: 1em">To find out more about the
various targets and their table formats and status lines,
please read the files in the Documentation/device-mapper
directory in the kernel source tree. <br>
(Your distribution might include a copy of this information
in the documentation directory for the device-mapper
package.)</p>

<p style="margin-top: 1em">EXAMPLES <br>
# A table to join two disks together <br>
0 1028160 linear /dev/hda 0 <br>
1028160 3903762 linear /dev/hdb 0 <br>
# A table to stripe across the two disks, <br>
# and add the spare space from <br>
# hdb to the back of the volume <br>
0 2056320 striped 2 32 /dev/hda 0 /dev/hdb 0 <br>
2056320 2875602 linear /dev/hdb 1028160</p>

<p style="margin-top: 1em">ENVIRONMENT VARIABLES <br>
DM_DEV_DIR <br>
The device directory name. Defaults to &quot;/dev&quot; and
must be an absolute path.</p>

<p style="margin-top: 1em">DM_UDEV_COOKIE <br>
A cookie to use for all relevant commands to synchronize
with udev processing. It is an alternative to using
--udevcookie option.</p>

<p style="margin-top: 1em">DM_DEFAULT_NAME_MANGLING_MODE
<br>
A default mangling mode. Defaults to &quot;auto&quot; and it
is an alternative to using --manglename option.</p>

<p style="margin-top: 1em">AUTHORS <br>
Original version: Joe Thornber
&lt;thornber@redhat.com&gt;</p>

<p style="margin-top: 1em">SEE ALSO <br>
dmstats(8), udev(7), udevadm(8)</p>

<p style="margin-top: 1em">LVM2 resource page:
https://www.sourceware.org/lvm2/ <br>
Device-mapper resource page:
http://sources.redhat.com/dm/</p>

<p style="margin-top: 1em">Linux Apr 06 2006 DMSETUP(8)</p>
<hr>
</body>
</html>
