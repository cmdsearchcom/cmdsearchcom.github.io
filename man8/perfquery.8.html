<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>PERFQUERY(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">PERFQUERY(8)</td>
    <td class="head-vol">Open IB Diagnostics</td>
    <td class="head-rtitle">PERFQUERY(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
PERFQUERY -
<h1 class="Sh" title="Sh" id="QUERY_INFINIBAND_PORT_COUNTERS_ON_A_SINGLE_PORT"><a class="selflink" href="#QUERY_INFINIBAND_PORT_COUNTERS_ON_A_SINGLE_PORT">QUERY
  INFINIBAND PORT COUNTERS ON A SINGLE PORT</a></h1>
<h2 class="Ss" title="Ss" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h2>
perfquery [options] [&lt;lid|guid&gt; [[port(s)] [reset_mask]]]
<h2 class="Ss" title="Ss" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h2>
perfquery uses PerfMgt GMPs to obtain the PortCounters (basic performance and
  error counters), PortExtendedCounters, PortXmitDataSL, PortRcvDataSL,
  PortRcvErrorDetails, PortXmitDiscardDetails, PortExtendedSpeedsCounters, or
  PortSamplesControl from the PMA at the node/port specified. Optionally shows
  aggregated counters for all ports of node. Finally it can, reset after read,
  or just reset the counters.
<div style="height: 1.00em;">&#x00A0;</div>
Note: In PortCounters, PortCountersExtended, PortXmitDataSL, and PortRcvDataSL,
  components that represent Data (e.g. PortXmitData and PortRcvData) indicate
  octets divided by 4 rather than just octets.
<div style="height: 1.00em;">&#x00A0;</div>
Note: Inputting a port of 255 indicates an operation be performed on all ports.
<div style="height: 1.00em;">&#x00A0;</div>
Note: For PortCounters, ExtendedCounters, and resets, multiple ports can be
  specified by either a comma separated list or a port range. See examples
  below.
<h2 class="Ss" title="Ss" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-x, --extended</b></b></dt>
  <dd class="It-tag">show extended port counters rather than (basic) port
      counters. Note that extended port counters attribute is optional.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-X, --xmtsl</b></b></dt>
  <dd class="It-tag">show transmit data SL counter. This is an optional counter
      for QoS.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-S, --rcvsl</b></b></dt>
  <dd class="It-tag">show receive data SL counter. This is an optional counter
      for QoS.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-D, --xmtdisc</b></b></dt>
  <dd class="It-tag">show transmit discard details. This is an optional
    counter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-E, --rcverr</b></b></dt>
  <dd class="It-tag">show receive error details. This is an optional
    counter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-D, --xmtdisc</b></b></dt>
  <dd class="It-tag">show transmit discard details. This is an optional
    counter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-T, --extended_speeds</b></b></dt>
  <dd class="It-tag">show extended speeds port counters. This is an optional
      counter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--oprcvcounters</b></b></dt>
  <dd class="It-tag">show Rcv Counters per Op code. This is an optional
    counter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--flowctlcounters</b></b></dt>
  <dd class="It-tag">show flow control counters. This is an optional
    counter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--vloppackets</b></b></dt>
  <dd class="It-tag">show packets received per Op code per VL. This is an
      optional counter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--vlopdata</b></b></dt>
  <dd class="It-tag">show data received per Op code per VL. This is an optional
      counter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--vlxmitflowctlerrors</b></b></dt>
  <dd class="It-tag">show flow control update errors per VL. This is an optional
      counter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--vlxmitcounters</b></b></dt>
  <dd class="It-tag">show ticks waiting to transmit counters per VL. This is an
      optional counter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--swportvlcong</b></b></dt>
  <dd class="It-tag">show sw port VL congestion. This is an optional
    counter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--rcvcc</b></b></dt>
  <dd class="It-tag">show Rcv congestion control counters. This is an optional
      counter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--slrcvfecn</b></b></dt>
  <dd class="It-tag">show SL Rcv FECN counters. This is an optional
    counter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--slrcvbecn</b></b></dt>
  <dd class="It-tag">show SL Rcv BECN counters. This is an optional
    counter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--xmitcc</b></b></dt>
  <dd class="It-tag">show Xmit congestion control counters. This is an optional
      counter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--vlxmittimecc</b></b></dt>
  <dd class="It-tag">show VL Xmit Time congestion control counters. This is an
      optional counter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-c, --smplctl</b></b></dt>
  <dd class="It-tag">show port samples control.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-a, --all_ports</b></b></dt>
  <dd class="It-tag">show aggregated counters for all ports of the destination
      lid, reset all counters for all ports, or if multiple ports are specified,
      aggregate the counters of the specified ports. If the destination lid does
      not support the AllPortSelect flag, all ports will be iterated through to
      emulate AllPortSelect behavior.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-l, --loop_ports</b></b></dt>
  <dd class="It-tag">If all ports are selected by the user (either through the
      <b>-a</b> option or port 255) or multiple ports are specified iterate
      through each port rather than doing than aggregate operation.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-r, --reset_after_read</b></b></dt>
  <dd class="It-tag">reset counters after read</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-R, --Reset_only</b></b></dt>
  <dd class="It-tag">only reset counters</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Addressing_Flags"><a class="selflink" href="#Addressing_Flags">Addressing
  Flags</a></h2>
<b>-G, --Guid</b> The address specified is a Port GUID
<div style="height: 1.00em;">&#x00A0;</div>
<b>-L, --Lid</b> The address specified is a LID
<div style="height: 1.00em;">&#x00A0;</div>
<b>-s, --sm_port &lt;smlid&gt;</b> use 'smlid' as the target lid for SA queries.
<h2 class="Ss" title="Ss" id="Port_Selection_flags"><a class="selflink" href="#Port_Selection_flags">Port
  Selection flags</a></h2>
<b>-C, --Ca &lt;ca_name&gt;</b> use the specified ca_name.
<div style="height: 1.00em;">&#x00A0;</div>
<b>-P, --Port &lt;ca_port&gt;</b> use the specified ca_port.
<h2 class="Ss" title="Ss" id="Local_port_Selection"><a class="selflink" href="#Local_port_Selection">Local
  port Selection</a></h2>
Multiple port/Multiple CA support: when no IB device or port is specified (see
  the &quot;local umad parameters&quot; below), the libibumad library selects
  the port to use by the following criteria:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">1.</dt>
  <dd class="It-tag">the first port that is ACTIVE.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">2.</dt>
  <dd class="It-tag">if not found, the first port that is UP (physical link
    up).</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
If a port and/or CA name is specified, the libibumad library attempts to fulfill
  the user request, and will fail if it is not possible.
<div style="height: 1.00em;">&#x00A0;</div>
For example:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
ibaddr                 # use the first port (criteria #1 above)
ibaddr -C mthca1       # pick the best port from &quot;mthca1&quot; only.
ibaddr -P 2            # use the second (active/up) port from the first available IB device.
ibaddr -C mthca0 -P 2  # use the specified port only.
</pre>
</div>
<br/>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Debugging_flags"><a class="selflink" href="#Debugging_flags">Debugging
  flags</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>-d</b></dt>
  <dd class="It-tag">raise the IB debugging level. May be used several times
      (-ddd or -d -d -d).</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>-e</b></dt>
  <dd class="It-tag">show send and receive errors (timeouts and others)</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>-h, --help</b> show the usage message
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-v, --verbose</b></b></dt>
  <dd class="It-tag">increase the application verbosity level. May be used
      several times (-vv or -v -v -v)</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>-V, --version</b> show the version info.
<h2 class="Ss" title="Ss" id="Configuration_flags"><a class="selflink" href="#Configuration_flags">Configuration
  flags</a></h2>
<b>-t, --timeout &lt;timeout_ms&gt;</b> override the default timeout for the
  solicited mads.
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-y, --m_key &lt;key&gt;</b></b></dt>
  <dd class="It-tag">use the specified M_key for requests. If non-numeric value
      (like 'x') is specified then a value will be prompted for.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--config, -z &lt;config_file&gt;</b> Specify alternate config file.
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">Default:
  /etc/infiniband-diags/ibdiag.conf</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="FILES"><a class="selflink" href="#FILES">FILES</a></h2>
<h2 class="Ss" title="Ss" id="CONFIG_FILE"><a class="selflink" href="#CONFIG_FILE">CONFIG
  FILE</a></h2>
/etc/infiniband-diags/ibdiag.conf
<div style="height: 1.00em;">&#x00A0;</div>
A global config file is provided to set some of the common options for all
  tools. See supplied config file for details.
<h2 class="Ss" title="Ss" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
perfquery                # read local port performance counters
perfquery 32 1           # read performance counters from lid 32, port 1
perfquery -x 32 1        # read extended performance counters from lid 32, port 1
perfquery -a 32          # read perf counters from lid 32, all ports
perfquery -r 32 1        # read performance counters and reset
perfquery -x -r 32 1     # read extended performance counters and reset
perfquery -R 0x20 1      # reset performance counters of port 1 only
perfquery -x -R 0x20 1   # reset extended performance counters of port 1 only
perfquery -R -a 32       # reset performance counters of all ports
perfquery -R 32 2 0x0fff # reset only error counters of port 2
perfquery -R 32 2 0xf000 # reset only non-error counters of port 2
perfquery -a 32 1-10     # read performance counters from lid 32, port 1-10, aggregate output
perfquery -l 32 1-10     # read performance counters from lid 32, port 1-10, output each port
perfquery -a 32 1,4,8    # read performance counters from lid 32, port 1, 4, and 8, aggregate output
perfquery -l 32 1,4,8    # read performance counters from lid 32, port 1, 4, and 8, output each port
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Hal Rosenstock</b></dt>
  <dd class="It-tag">&lt; <i>hal.rosenstock@gmail.com</i> &gt;</dd>
</dl>
</div>
<br/>
</div>
<table class="foot">
  <tr>
    <td class="foot-date"></td>
    <td class="foot-os"></td>
  </tr>
</table>
</body>
</html>
