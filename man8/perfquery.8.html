<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 19:14:34 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>PERFQUERY(8) Open IB Diagnostics PERFQUERY(8)</p>

<p style="margin-top: 1em">NAME <br>
PERFQUERY -</p>

<p style="margin-top: 1em">QUERY INFINIBAND PORT COUNTERS
ON A SINGLE PORT <br>
SYNOPSIS <br>
perfquery [options] [&lt;lid|guid&gt; [[port(s)]
[reset_mask]]]</p>

<p style="margin-top: 1em">DESCRIPTION <br>
perfquery uses PerfMgt GMPs to obtain the PortCounters
(basic performance and error counters),
PortExtendedCounters, PortXmitDataSL, PortRcvDataSL,
PortRcvErrorDetails, PortXmit&acirc; <br>
DiscardDetails, PortExtendedSpeedsCounters, or
PortSamplesControl from the PMA at the node/port specified.
Optionally shows aggregated counters for all ports of node.
Finally it <br>
can, reset after read, or just reset the counters.</p>

<p style="margin-top: 1em">Note: In PortCounters,
PortCountersExtended, PortXmitDataSL, and PortRcvDataSL,
components that represent Data (e.g. PortXmitData and
PortRcvData) indicate octets divided by 4 <br>
rather than just octets.</p>

<p style="margin-top: 1em">Note: Inputting a port of 255
indicates an operation be performed on all ports.</p>

<p style="margin-top: 1em">Note: For PortCounters,
ExtendedCounters, and resets, multiple ports can be
specified by either a comma separated list or a port range.
See examples below.</p>

<p style="margin-top: 1em">OPTIONS <br>
-x, --extended <br>
show extended port counters rather than (basic) port
counters. Note that extended port counters attribute is
optional.</p>

<p style="margin-top: 1em">-X, --xmtsl <br>
show transmit data SL counter. This is an optional counter
for QoS.</p>

<p style="margin-top: 1em">-S, --rcvsl <br>
show receive data SL counter. This is an optional counter
for QoS.</p>

<p style="margin-top: 1em">-D, --xmtdisc <br>
show transmit discard details. This is an optional
counter.</p>

<p style="margin-top: 1em">-E, --rcverr <br>
show receive error details. This is an optional counter.</p>

<p style="margin-top: 1em">-D, --xmtdisc <br>
show transmit discard details. This is an optional
counter.</p>

<p style="margin-top: 1em">-T, --extended_speeds <br>
show extended speeds port counters. This is an optional
counter.</p>

<p style="margin-top: 1em">--oprcvcounters <br>
show Rcv Counters per Op code. This is an optional
counter.</p>

<p style="margin-top: 1em">--flowctlcounters <br>
show flow control counters. This is an optional counter.</p>

<p style="margin-top: 1em">--vloppackets <br>
show packets received per Op code per VL. This is an
optional counter.</p>

<p style="margin-top: 1em">--vlopdata <br>
show data received per Op code per VL. This is an optional
counter.</p>

<p style="margin-top: 1em">--vlxmitflowctlerrors <br>
show flow control update errors per VL. This is an optional
counter.</p>

<p style="margin-top: 1em">--vlxmitcounters <br>
show ticks waiting to transmit counters per VL. This is an
optional counter.</p>

<p style="margin-top: 1em">--swportvlcong <br>
show sw port VL congestion. This is an optional counter.</p>

<p style="margin-top: 1em">--rcvcc <br>
show Rcv congestion control counters. This is an optional
counter.</p>

<p style="margin-top: 1em">--slrcvfecn <br>
show SL Rcv FECN counters. This is an optional counter.</p>

<p style="margin-top: 1em">--slrcvbecn <br>
show SL Rcv BECN counters. This is an optional counter.</p>

<p style="margin-top: 1em">--xmitcc <br>
show Xmit congestion control counters. This is an optional
counter.</p>

<p style="margin-top: 1em">--vlxmittimecc <br>
show VL Xmit Time congestion control counters. This is an
optional counter.</p>

<p style="margin-top: 1em">-c, --smplctl <br>
show port samples control.</p>

<p style="margin-top: 1em">-a, --all_ports <br>
show aggregated counters for all ports of the destination
lid, reset all counters for all ports, or if multiple ports
are specified, aggregate the counters of the speci&acirc;
<br>
fied ports. If the destination lid does not support the
AllPortSelect flag, all ports will be iterated through to
emulate AllPortSelect behavior.</p>

<p style="margin-top: 1em">-l, --loop_ports <br>
If all ports are selected by the user (either through the -a
option or port 255) or multiple ports are specified iterate
through each port rather than doing than aggregate <br>
operation.</p>

<p style="margin-top: 1em">-r, --reset_after_read <br>
reset counters after read</p>

<p style="margin-top: 1em">-R, --Reset_only <br>
only reset counters</p>

<p style="margin-top: 1em">Addressing Flags <br>
-G, --Guid The address specified is a Port GUID</p>

<p style="margin-top: 1em">-L, --Lid The address specified
is a LID</p>

<p style="margin-top: 1em">-s, --sm_port &lt;smlid&gt; use
&rsquo;smlid&rsquo; as the target lid for SA queries.</p>

<p style="margin-top: 1em">Port Selection flags <br>
-C, --Ca &lt;ca_name&gt; use the specified ca_name.</p>

<p style="margin-top: 1em">-P, --Port &lt;ca_port&gt; use
the specified ca_port.</p>

<p style="margin-top: 1em">Local port Selection <br>
Multiple port/Multiple CA support: when no IB device or port
is specified (see the &quot;local umad parameters&quot;
below), the libibumad library selects the port to use by the
following <br>
criteria:</p>

<p style="margin-top: 1em">1. the first port that is
ACTIVE.</p>

<p style="margin-top: 1em">2. if not found, the first port
that is UP (physical link up).</p>

<p style="margin-top: 1em">If a port and/or CA name is
specified, the libibumad library attempts to fulfill the
user request, and will fail if it is not possible.</p>

<p style="margin-top: 1em">For example:</p>

<p style="margin-top: 1em">ibaddr # use the first port
(criteria #1 above) <br>
ibaddr -C mthca1 # pick the best port from
&quot;mthca1&quot; only. <br>
ibaddr -P 2 # use the second (active/up) port from the first
available IB device. <br>
ibaddr -C mthca0 -P 2 # use the specified port only.</p>

<p style="margin-top: 1em">Debugging flags <br>
-d raise the IB debugging level. May be used several times
(-ddd or -d -d -d).</p>

<p style="margin-top: 1em">-e show send and receive errors
(timeouts and others)</p>

<p style="margin-top: 1em">-h, --help show the usage
message</p>

<p style="margin-top: 1em">-v, --verbose <br>
increase the application verbosity level. May be used
several times (-vv or -v -v -v)</p>

<p style="margin-top: 1em">-V, --version show the version
info.</p>

<p style="margin-top: 1em">Configuration flags <br>
-t, --timeout &lt;timeout_ms&gt; override the default
timeout for the solicited mads.</p>

<p style="margin-top: 1em">-y, --m_key &lt;key&gt; <br>
use the specified M_key for requests. If non-numeric value
(like &rsquo;x&rsquo;) is specified then a value will be
prompted for.</p>

<p style="margin-top: 1em">--config, -z &lt;config_file&gt;
Specify alternate config file. <br>
Default: /etc/infiniband-diags/ibdiag.conf</p>

<p style="margin-top: 1em">FILES <br>
CONFIG FILE <br>
/etc/infiniband-diags/ibdiag.conf</p>

<p style="margin-top: 1em">A global config file is provided
to set some of the common options for all tools. See
supplied config file for details.</p>

<p style="margin-top: 1em">EXAMPLES <br>
perfquery # read local port performance counters <br>
perfquery 32 1 # read performance counters from lid 32, port
1 <br>
perfquery -x 32 1 # read extended performance counters from
lid 32, port 1 <br>
perfquery -a 32 # read perf counters from lid 32, all ports
<br>
perfquery -r 32 1 # read performance counters and reset <br>
perfquery -x -r 32 1 # read extended performance counters
and reset <br>
perfquery -R 0x20 1 # reset performance counters of port 1
only <br>
perfquery -x -R 0x20 1 # reset extended performance counters
of port 1 only <br>
perfquery -R -a 32 # reset performance counters of all ports
<br>
perfquery -R 32 2 0x0fff # reset only error counters of port
2 <br>
perfquery -R 32 2 0xf000 # reset only non-error counters of
port 2 <br>
perfquery -a 32 1-10 # read performance counters from lid
32, port 1-10, aggregate output <br>
perfquery -l 32 1-10 # read performance counters from lid
32, port 1-10, output each port <br>
perfquery -a 32 1,4,8 # read performance counters from lid
32, port 1, 4, and 8, aggregate output <br>
perfquery -l 32 1,4,8 # read performance counters from lid
32, port 1, 4, and 8, output each port</p>

<p style="margin-top: 1em">AUTHOR <br>
Hal Rosenstock <br>
&lt; hal.rosenstock@gmail.com &gt;</p>
 
<p style="margin-top: 1em">PERFQUERY(8)</p>
<hr>
</body>
</html>
