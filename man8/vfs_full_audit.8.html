<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>VFS_FULL_AUDIT(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">VFS_FULL_AUDIT(8)</td>
    <td class="head-vol">System Administration tools</td>
    <td class="head-rtitle">VFS_FULL_AUDIT(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
vfs_full_audit - record Samba VFS operations in the system log
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<div class="Pp" style="margin-left: 1.00ex; text-indent: -1.00ex;">vfs objects =
  full_audit</div>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
This VFS module is part of the <b>samba</b>(7) suite.
<div class="Pp"></div>
The vfs_full_audit VFS module records selected client operations to the system
  log using <b>syslog</b>(3).
<div class="Pp"></div>
vfs_full_audit is able to record the complete set of Samba VFS operations:
<div style="margin-left: 4.00ex;">chdir</div>
<div style="margin-left: 4.00ex;">chflags</div>
<div style="margin-left: 4.00ex;">chmod</div>
<div style="margin-left: 4.00ex;">chmod_acl</div>
<div style="margin-left: 4.00ex;">chown</div>
<div style="margin-left: 4.00ex;">close</div>
<div style="margin-left: 4.00ex;">closedir</div>
<div style="margin-left: 4.00ex;">connect</div>
<div style="margin-left: 4.00ex;">copy_chunk_send</div>
<div style="margin-left: 4.00ex;">copy_chunk_recv</div>
<div style="margin-left: 4.00ex;">disconnect</div>
<div style="margin-left: 4.00ex;">disk_free</div>
<div style="margin-left: 4.00ex;">fchmod</div>
<div style="margin-left: 4.00ex;">fchmod_acl</div>
<div style="margin-left: 4.00ex;">fchown</div>
<div style="margin-left: 4.00ex;">fget_nt_acl</div>
<div style="margin-left: 4.00ex;">fgetxattr</div>
<div style="margin-left: 4.00ex;">flistxattr</div>
<div style="margin-left: 4.00ex;">fremovexattr</div>
<div style="margin-left: 4.00ex;">fset_nt_acl</div>
<div style="margin-left: 4.00ex;">fsetxattr</div>
<div style="margin-left: 4.00ex;">fstat</div>
<div style="margin-left: 4.00ex;">fsync</div>
<div style="margin-left: 4.00ex;">ftruncate</div>
<div style="margin-left: 4.00ex;">get_compression</div>
<div style="margin-left: 4.00ex;">get_nt_acl</div>
<div style="margin-left: 4.00ex;">get_quota</div>
<div style="margin-left: 4.00ex;">get_shadow_copy_data</div>
<div style="margin-left: 4.00ex;">getlock</div>
<div style="margin-left: 4.00ex;">getwd</div>
<div style="margin-left: 4.00ex;">getxattr</div>
<div style="margin-left: 4.00ex;">kernel_flock</div>
<div style="margin-left: 4.00ex;">link</div>
<div style="margin-left: 4.00ex;">linux_setlease</div>
<div style="margin-left: 4.00ex;">listxattr</div>
<div style="margin-left: 4.00ex;">lock</div>
<div style="margin-left: 4.00ex;">lseek</div>
<div style="margin-left: 4.00ex;">lstat</div>
<div style="margin-left: 4.00ex;">mkdir</div>
<div style="margin-left: 4.00ex;">mknod</div>
<div style="margin-left: 4.00ex;">open</div>
<div style="margin-left: 4.00ex;">opendir</div>
<div style="margin-left: 4.00ex;">pread</div>
<div style="margin-left: 4.00ex;">pwrite</div>
<div style="margin-left: 4.00ex;">read</div>
<div style="margin-left: 4.00ex;">readdir</div>
<div style="margin-left: 4.00ex;">readlink</div>
<div style="margin-left: 4.00ex;">realpath</div>
<div style="margin-left: 4.00ex;">removexattr</div>
<div style="margin-left: 4.00ex;">rename</div>
<div style="margin-left: 4.00ex;">rewinddir</div>
<div style="margin-left: 4.00ex;">rmdir</div>
<div style="margin-left: 4.00ex;">seekdir</div>
<div style="margin-left: 4.00ex;">sendfile</div>
<div style="margin-left: 4.00ex;">set_compression</div>
<div style="margin-left: 4.00ex;">set_nt_acl</div>
<div style="margin-left: 4.00ex;">set_quota</div>
<div style="margin-left: 4.00ex;">setxattr</div>
<div style="margin-left: 4.00ex;">snap_check_path</div>
<div style="margin-left: 4.00ex;">snap_create</div>
<div style="margin-left: 4.00ex;">snap_delete</div>
<div style="margin-left: 4.00ex;">stat</div>
<div style="margin-left: 4.00ex;">statvfs</div>
<div style="margin-left: 4.00ex;">symlink</div>
<div style="margin-left: 4.00ex;">sys_acl_delete_def_file</div>
<div style="margin-left: 4.00ex;">sys_acl_get_fd</div>
<div style="margin-left: 4.00ex;">sys_acl_get_file</div>
<div style="margin-left: 4.00ex;">sys_acl_set_fd</div>
<div style="margin-left: 4.00ex;">sys_acl_set_file</div>
<div style="margin-left: 4.00ex;">telldir</div>
<div style="margin-left: 4.00ex;">unlink</div>
<div style="margin-left: 4.00ex;">utime</div>
<div style="margin-left: 4.00ex;">write</div>
<div class="Pp"></div>
In addition to these operations, vfs_full_audit recognizes the special operation
  names &quot;all&quot; and &quot;none &quot;, which refer to all the VFS
  operations and none of the VFS operations respectively.
<div class="Pp"></div>
vfs_full_audit records operations in fixed format consisting of fields separated
  by '|' characters. The format is:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
		smbd_audit: PREFIX|OPERATION|RESULT|FILE
	
</pre>
</div>
<div class="Pp"></div>
The record fields are:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;PREFIX - the result of the
  full_audit:prefix string after variable substitutions</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;OPERATION - the name of the VFS
  operation</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;RESULT - whether the operation
  succeeded or failed</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;FILE - the name of the file or
  directory the operation was performed on</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
This module is stackable.
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
full_audit:prefix = STRING
<div style="margin-left: 4.00ex;">Prepend audit messages with STRING. STRING is
  processed for standard substitution variables listed in <b>smb.conf</b>(5).
  The default prefix is &quot;%u|%I&quot;.</div>
<div class="Pp"></div>
full_audit:success = LIST
<div style="margin-left: 4.00ex;">LIST is a list of VFS operations that should
  be recorded if they succeed. Operations are specified using the names listed
  above. Operations can be unset by prefixing the names with &quot;!&quot;. The
  default is all operations.</div>
<div class="Pp"></div>
full_audit:failure = LIST
<div style="margin-left: 4.00ex;">LIST is a list of VFS operations that should
  be recorded if they failed. Operations are specified using the names listed
  above. Operations can be unset by prefixing the names with &quot;!&quot;. The
  default is all operations.</div>
<div class="Pp"></div>
full_audit:facility = FACILITY
<div style="margin-left: 4.00ex;">Log messages to the named <b>syslog</b>(3)
  facility.</div>
<div class="Pp"></div>
full_audit:priority = PRIORITY
<div style="margin-left: 4.00ex;">Log messages with the named <b>syslog</b>(3)
  priority.</div>
<div class="Pp"></div>
full_audit:syslog = true/false
<div style="margin-left: 4.00ex;">Log messages to syslog (default) or as a debug
  level 1 message.</div>
<div class="Pp"></div>
full_audit:log_secdesc = true/false
<div style="margin-left: 4.00ex;">Log an sddl form of the security descriptor
  coming in when a client sets an acl. Defaults to false.</div>
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
Log file and directory open operations on the [records] share using the LOCAL7
  facility and ALERT priority, including the username and IP address. Logging
  excludes the open VFS function on failures:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
         <i>[records]</i>
	 <b>path = /data/records</b>
	 <b>vfs objects = full_audit</b>
	 <b>full_audit:prefix = %u|%I</b>
	 <b>full_audit:success = open opendir</b>
	 <b>full_audit:failure = all !open</b>
	 <b>full_audit:facility = LOCAL7</b>
	 <b>full_audit:priority = ALERT</b>
</pre>
</div>
<h1 class="Sh" title="Sh" id="VERSION"><a class="selflink" href="#VERSION">VERSION</a></h1>
This man page is correct for version 3.0.25 of the Samba suite.
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
The original Samba software and related utilities were created by Andrew
  Tridgell. Samba is now developed by the Samba Team as an Open Source project
  similar to the way the Linux kernel is developed.</div>
<table class="foot">
  <tr>
    <td class="foot-date">05/25/2017</td>
    <td class="foot-os">Samba 4.4</td>
  </tr>
</table>
</body>
</html>
