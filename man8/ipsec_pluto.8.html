<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>IPSEC_PLUTO(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">IPSEC_PLUTO(8)</td>
    <td class="head-vol">Executable programs</td>
    <td class="head-rtitle">IPSEC_PLUTO(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
ipsec_pluto, ipsec_whack, pluto - ipsec whack : IPsec IKE keying daemon and
  control interface
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>pluto</i> [--help] [--version] [--leak-detective]
  [--config&#x00A0;<i>filename</i>] [--vendorid&#x00A0; <i>VID</i>] [--nofork]
  [--stderrlog] [----plutostderrlogtime] [--logfile&#x00A0; <i>filename</i>]
  [--use-klips] [--use-mast] [--use-netkey] [--use-nostack] [--uniqueids]
  [--virtual-private&#x00A0; <i>network_list</i>]
  [--keep-alive&#x00A0;<i>delay_sec</i>] [--force-busy] [--nocrsend]
  [--strictcrlpolicy] [--crlcheckinterval] [--interface&#x00A0;
  <i>interfacename</i>] [--listen&#x00A0; <i>ipaddr</i>]
  [--ikeport&#x00A0;<i>portnumber</i>] [--natikeport&#x00A0; <i>portnumber</i>]
  [--ctlbase&#x00A0; <i>path</i>] [--secretsfile&#x00A0;<i>secrets-file</i>]
  [--adns&#x00A0; <i>pathname</i>] [--nhelpers&#x00A0;<i>number</i>]
  [--seedbits&#x00A0; <i>numbits</i>] [--perpeerlog]
  [--perpeerlogbase&#x00A0;<i>dirname</i>] [--ipsecdir&#x00A0;<i>dirname</i>]
  [--coredir&#x00A0; <i>dirname</i>] [--statsbin&#x00A0;<i>filename</i>]
  [--secctx-attr-type&#x00A0; <i>number</i>]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> [--help] [--version]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> [--debug-none] [--debug-all] [--debug-raw] [--debug-crypt]
  [--debug-parsing] [--debug-emitting] [--debug-control] [--debug-lifecycle]
  [--debug-kernel] [--debug-pfkey] [--debug-nat-t] [--debug-dpd] [--debug-dns]
  [--debug-oppo] [--debug-oppoinfo] [--debug-whackwatch] [--debug-private]
  [--debug-x509]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> --name&#x00A0;<i>connection-name</i> [[--ipv4] | [--ipv6]]
  [[--tunnelipv4] | [--tunnelipv6]]
<div>&#x00A0;</div>
[--id&#x00A0; <i>identity</i>] [--host&#x00A0;<i>ip-address</i>]
  [--cert&#x00A0;<i>path</i>] [--ca&#x00A0;<i>distinguished&#x00A0;name</i>]
  [--groups&#x00A0; <i>access&#x00A0;control&#x00A0;groups</i>]
  [--sendcert&#x00A0;yes&#x00A0;|&#x00A0;forced&#x00A0;|&#x00A0;always&#x00A0;|&#x00A0;ifasked&#x00A0;|&#x00A0;no&#x00A0;|&#x00A0;never]
  [--sendca&#x00A0;none&#x00A0;|&#x00A0;issuer&#x00A0;|&#x00A0;all]
  [--certtype&#x00A0; <i>number</i>] [--ikeport&#x00A0;<i>portnumber</i>]
  [--nexthop&#x00A0; <i>ip-address</i>] [[--client&#x00A0;<i>subnet</i>] |
  [--clientwithin&#x00A0; <i>subnet</i>]]
  [--clientprotoport&#x00A0;<i>protocol</i>/ <i>port</i>]
  [--srcip&#x00A0;<i>ip-address</i>] [--xauthserver] [--xauthclient]
  [--modecfgserver] [--modecfgclient] [--modecfgdns1&#x00A0; <i>ip-address</i>]
  [--modecfgdns2&#x00A0; <i>ip-address</i>]
  [--modecfgdomain&#x00A0;<i>DNS-domain</i>] [--modecfgbanner&#x00A0;
  <i>login-banner</i>] [--dnskeyondemand] [--updown&#x00A0; <i>updown</i>]
<div>&#x00A0;</div>
--to
<div>&#x00A0;</div>
[--id&#x00A0; <i>identity</i>] [--host&#x00A0;<i>ip-address</i>]
  [--cert&#x00A0;<i>path</i>] [--ca&#x00A0;<i>distinguished&#x00A0;name</i>]
  [--groups&#x00A0; <i>access&#x00A0;control&#x00A0;groups</i>]
  [--sendcert&#x00A0;yes&#x00A0;|&#x00A0;always&#x00A0;|&#x00A0;ifasked&#x00A0;|&#x00A0;no&#x00A0;|&#x00A0;never]
  [--certtype&#x00A0; <i>number</i>] [--ikeport&#x00A0;<i>port-number</i>]
  [--nexthop&#x00A0; <i>ip-address</i>] [--client&#x00A0;<i>subnet</i>]
  [--clientwithin&#x00A0; <i>subnet</i>]
  [--clientprotoport&#x00A0;<i>protocol</i>/ <i>port</i>]
  [--srcip&#x00A0;<i>ip-address</i>] [--xauthserver] [--xauthclient]
  [--modecfgserver] [--modecfgclient] [--modecfgdns1&#x00A0; <i>ip-address</i>]
  [--modecfgdns2&#x00A0; <i>ip-address</i>]
  [--modecfgdomain&#x00A0;<i>DNS-domain</i>] [--dnskeyondemand]
  [--updown&#x00A0; <i>updown</i>]
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
[--tunnel] [--psk] [--rsasig] [--encrypt] [--authenticate] [--compress] [--pfs]
  [--pfsgroup&#x00A0;[modp1024]&#x00A0;|&#x00A0;[modp1536]&#x00A0;|&#x00A0;[modp2048]&#x00A0;|&#x00A0;[modp3072]&#x00A0;|&#x00A0;[modp4096]&#x00A0;|&#x00A0;[modp6144]&#x00A0;|&#x00A0;[modp8192]&#x00A0;|&#x00A0;[dh22]&#x00A0;|&#x00A0;[dh23]&#x00A0;|&#x00A0;[dh24]]
  [--disablearrivalcheck] [--ikelifetime&#x00A0; <i>seconds</i>]
  [--ipseclifetime&#x00A0; <i>seconds</i>] [--rekeymargin&#x00A0;<i>seconds</i>]
  [--rekeyfuzz&#x00A0; <i>percentage</i>] [--keyingtries&#x00A0;<i>count</i>]
  [--esp&#x00A0; <i>esp-algos</i>] [--dontrekey] [--aggrmode] [--modecfgpull]
  [--metric&#x00A0; <i>metric</i>] [--nflog-group&#x00A0;<i>nflognum</i>]
  [[--dpddelay&#x00A0; <i>seconds</i>] | [--dpdtimeout&#x00A0;<i>seconds</i>]]
  [--dpdaction&#x00A0;[clear]&#x00A0;|&#x00A0;[hold]&#x00A0;|&#x00A0;[restart]]
  [--forceencaps] [--no-keep-alive]
  [[--initiateontraffic]&#x00A0;|&#x00A0;[--pass]&#x00A0;|&#x00A0;[--drop]&#x00A0;|&#x00A0;[--reject]]
  [[--failnone]&#x00A0;|&#x00A0;[--failpass]&#x00A0;|&#x00A0;[--faildrop]&#x00A0;|&#x00A0;[--failreject]]
  [--ctlbase&#x00A0; <i>path</i>] [--label&#x00A0;<i>string</i>]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> --keyid&#x00A0;<i>id</i> [--addkey]
  [--pubkeyrsa&#x00A0;<i>key</i>] [--ctlbase&#x00A0; <i>path</i>]
  [--label&#x00A0; <i>string</i>]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> --myid&#x00A0;<i>id</i></div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> --listen | --unlisten [--ctlbase&#x00A0;<i>path</i>]
  [--label&#x00A0; <i>string</i>]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> --busy | --relax [--ctlbase&#x00A0;<i>path</i>]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> --route | --unroute --name&#x00A0;<i>connection-name</i>
  [--ctlbase&#x00A0; <i>path</i>] [--label&#x00A0;<i>string</i>]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> --initiate | --terminate --name&#x00A0;<i>connection-name</i>
  [--xauthuser&#x00A0; <i>user</i>] [--xauthpass&#x00A0;<i>pass</i>]
  [--asynchronous] [--ctlbase&#x00A0; <i>path</i>]
  [--label&#x00A0;<i>string</i>]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> [[--tunnelipv4] | [--tunnelipv6]]
  --oppohere&#x00A0;<i>ip-address</i> --oppothere&#x00A0;
  <i>ip-address</i></div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> --crash [ipaddress]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> --whackrecord [filename]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> --whackstoprecord</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> --name&#x00A0;<i>connection-name</i> --delete
  [--ctlbase&#x00A0;<i>path</i>] [--label&#x00A0;<i>string</i>]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> --deletestate&#x00A0;<i>state-number</i>
  [--ctlbase&#x00A0;<i>path</i>] [--label&#x00A0; <i>string</i>]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> --deleteuser --name&#x00A0;<i>username</i>
  [--ctlbase&#x00A0;<i>path</i>] [--label&#x00A0; <i>string</i>]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> [--name&#x00A0;<i>connection-name</i>] [--debug-none]
  [--debug-all] [--debug-raw] [--debug-crypt] [--debug-parsing]
  [--debug-emitting] [--debug-control] [--debug-controlmore] [--debug-lifecycle]
  [--debug-klips] [--debug-pfkey] [--debug-dns] [--debug-dpd] [--debug-natt]
  [--debug-oppo] [--debug-oppoinfo] [--debug-whackwatch] [--debug-private]
  [--impair-bust-mi2] [--impair-bust-mr2] [--impair-sa-fail]
  [--impair-die-oninfo] [--impair-jacob-two-two] [--impair-major-version-bump]
  [--impair-minor-version-bump] [--impair-retransmits]
  [--impair-send-bogus-isakmp-flag] [--impair-send-ikev2-ke]
  [--impair-send-key-size-check] [--impair-send-no-delete]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> [--utc] [--listall] [--listpubkeys] [--listcerts] [--listcacerts]
  [--listcrls]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> [--utc] [--rereadsecrets] [--rereadcrls] [--rereadall]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> --listevents</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> --purgeocsp</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> --status [--ctlbase&#x00A0;<i>path</i>]
  [--label&#x00A0;<i>string</i>]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> --trafficstatus --shuntstatus [--ctlbase&#x00A0;<i>path</i>]
  [--label&#x00A0; <i>string</i>]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 6.00ex; text-indent: -6.00ex;"><b>ipsec</b>
  <i>whack</i> --shutdown [--ctlbase&#x00A0;<i>path</i>]
  [--label&#x00A0;<i>string</i>]</div>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<b>pluto</b> is an IKE (&#x201C;IPsec Key Exchange&#x201D;) daemon. <b>whack</b>
  is an auxiliary program to allow requests to be made to a running
  <b>pluto</b>.
<div class="Pp"></div>
<b>pluto</b> is used to automatically build shared &#x201C;security
  associations&#x201D; on a system that has IPsec, the secure IP protocol. In
  other words, <b>pluto</b> can eliminate much of the work of manual keying. The
  actual secure transmission of packets is the responsibility of other parts of
  the system - the kernel. Pluto can talk to various kernel implementations,
  such as <b>KLIPS</b>, such as <b>NETKEY</b>, and such as <b>KAME</b> IPsec
  stacks. <b>ipsec_auto</b>(8) provides a more convenient interface to
  <b>pluto</b> and <b>whack</b>.
<h2 class="Ss" title="Ss" id="IKE's_Job"><a class="selflink" href="#IKE's_Job">IKE's
  Job</a></h2>
A <i>Security Association</i> ( <i>SA</i>) is an agreement between two network
  nodes on how to process certain traffic between them. This processing involves
  encapsulation, authentication, encryption, or compression.
<div class="Pp"></div>
IKE can be deployed on a network node to negotiate Security Associations for
  that node. These IKE implementations can only negotiate with other IKE
  implementations, so IKE must be on each node that is to be an endpoint of an
  IKE-negotiated Security Association. No other nodes need to be running IKE.
<div class="Pp"></div>
An IKE instance (i.e. an IKE implementation on a particular network node)
  communicates with another IKE instance using UDP IP packets, so there must be
  a route between the nodes in each direction.
<div class="Pp"></div>
The negotiation of Security Associations requires a number of choices that
  involve tradeoffs between security, convenience, trust, and efficiency. These
  are policy issues and are normally specified to the IKE instance by the system
  administrator.
<div class="Pp"></div>
IKE deals with two kinds of Security Associations. The first part of a
  negotiation between IKE instances is to build an ISAKMP SA. An ISAKMP SA is
  used to protect communication between the two IKEs. IPsec SAs can then be
  built by the IKEs - these are used to carry protected IP traffic between the
  systems.
<div class="Pp"></div>
The negotiation of the ISAKMP SA is known as Phase 1. In theory, Phase 1 can be
  accomplished by a couple of different exchange types. Currently, Main Mode and
  Aggressive Mode are implemented.
<div class="Pp"></div>
Any negotiation under the protection of an ISAKMP SA, including the negotiation
  of IPsec SAs, is part of Phase 2. The exchange type that we use to negotiate
  an IPsec SA is called Quick Mode.
<div class="Pp"></div>
IKE instances must be able to authenticate each other as part of their
  negotiation of an ISAKMP SA. This can be done by several mechanisms described
  in the draft standards.
<div class="Pp"></div>
IKE negotiation can be initiated by any instance with any other. If both can
  find an agreeable set of characteristics for a Security Association, and both
  recognize each others authenticity, they can set up a Security Association.
  The standards do not specify what causes an IKE instance to initiate a
  negotiation.
<div class="Pp"></div>
In summary, an IKE instance is prepared to automate the management of Security
  Associations in an IPsec environment, but a number of issues are considered
  policy and are left in the system administrator's hands.
<h2 class="Ss" title="Ss" id="Pluto"><a class="selflink" href="#Pluto">Pluto</a></h2>
<b>pluto</b> is an implementation of IKE. It runs as a daemon on a network node.
  Currently, this network node must be a LINUX system running the <b>KLIPS</b>
  or <b>NETKEY</b> implementation of IPsec, or a FreeBSD/NetBSD/Mac OSX system
  running the <b>KAME</b> implementation of IPsec.
<div class="Pp"></div>
<b>pluto</b> implements a large subset of IKE. This is enough for it to
  interoperate with other instances of <b>pluto</b>, and many other IKE
  implementations.
<div class="Pp"></div>
The policy for acceptable characteristics for Security Associations is mostly
  hardwired into the code of <b>pluto</b> (spdb.c). Eventually this will be
  moved into a security policy database with reasonable expressive power and
  more convenience.
<div class="Pp"></div>
<b>pluto</b> uses shared secrets or RSA signatures to authenticate peers with
  whom it is negotiating. These RSA signatures can come from DNS(SEC), a
  configuration file, or from X.509 and CA certificates.
<div class="Pp"></div>
<b>pluto</b> initiates negotiation of a Security Association when it is manually
  prodded: the program <b>whack</b> is run to trigger this. It will also
  initiate a negotiation when <b>KLIPS</b> traps an outbound packet for
  Opportunistic Encryption.
<div class="Pp"></div>
<b>pluto</b> implements ISAKMP SAs itself. After it has negotiated the
  characteristics of an IPsec SA, it directs the <b>kernel</b> to implement it.
  If necessary, it also invokes a script to adjust any firewall and issue
  <b>route</b>(8) commands to direct IP packets.
<div class="Pp"></div>
When <b>pluto</b> shuts down, it closes all Security Associations.
<h2 class="Ss" title="Ss" id="Before_Running_Pluto"><a class="selflink" href="#Before_Running_Pluto">Before
  Running Pluto</a></h2>
<b>pluto</b> runs as a daemon with userid root. Before running it, a few things
  must be set up.
<div class="Pp"></div>
<b>pluto</b> requires a working IPsec stack.
<div class="Pp"></div>
<b>pluto</b> supports multiple public networks (that is, networks that are
  considered insecure and thus need to have their traffic encrypted or
  authenticated). It discovers the public interfaces to use by looking at all
  interfaces that are configured (the <b>--interface</b> option can be used to
  limit the interfaces considered). It does this only when <b>whack</b> tells it
  to --listen, so the interfaces must be configured by then. Each interface with
  a name of the form <b>ipsec</b>[0-9] is taken as a <b>KLIPS</b> virtual public
  interface. Another network interface with the same IP address (the first one
  found will be used) is taken as the corresponding real public interface. The
  <b>--listen</b> can be used to limit listening on only 1 IP address of a
  certain interface. <b>ifconfig</b>(8) or <b>ip</b>(8) with the <b>-a</b> flag
  will show the name and status of each network interface.
<div class="Pp"></div>
<b>pluto</b> requires a database of preshared secrets and RSA private keys. This
  is described in the <b>ipsec.secrets</b>(5). <b>pluto</b> is told of RSA
  public keys via <b>whack</b> commands. If the connection is Opportunistic, and
  no RSA public key is known, <b>pluto</b> will attempt to fetch RSA keys using
  the Domain Name System.
<h2 class="Ss" title="Ss" id="Setting_up_KLIPS_for_pluto"><a class="selflink" href="#Setting_up_KLIPS_for_pluto">Setting
  up KLIPS for pluto</a></h2>
The most basic network topology that <b>pluto</b> supports has two security
  gateways negotiating on behalf of client subnets. The diagram of RGB's testbed
  is a good example (see <i>klips/doc/rgb_setup.txt</i>).
<div class="Pp"></div>
The file INSTALL in the base directory of this distribution explains how to
  start setting up the whole system, including <b>KLIPS</b>.
<div class="Pp"></div>
Make sure that the security gateways have routes to each other. This is usually
  covered by the default route, but may require issuing <b>route</b>(8)
  commands. The route must go through a particular IP interface (we will assume
  it is <i>eth0</i>, but it need not be). The interface that connects the
  security gateway to its client must be a different one.
<div class="Pp"></div>
It is necessary to issue a <b>ipsec_tncfg</b>(8) command on each gateway. The
  required command is:
<div class="Pp"></div>
&#x00A0;&#x00A0;&#x00A0;ipsec tncfg --attach&#x00A0;--virtual&#x00A0;ipsec0
  --physical&#x00A0;eth0
<div class="Pp"></div>
A command to set up the ipsec0 virtual interface will also need to be run. It
  will have the same parameters as the command used to set up the physical
  interface to which it has just been connected using <b>ipsec_tncfg</b>(8).
<h2 class="Ss" title="Ss" id="Setting_up_NETKEY_for_pluto"><a class="selflink" href="#Setting_up_NETKEY_for_pluto">Setting
  up NETKEY for pluto</a></h2>
No special requirements are necessary to use NETKEY - it ships with all modern
  versions of Linux 2.4 and 2.6. however, note that certain vendors or older
  distributions use old versions or backports of NETKEY which are broken. If
  possible use a NETKEY version that is at least based on, or backported from
  Linux 2.6.11 or newer.
<h2 class="Ss" title="Ss" id="ipsec.secrets_file"><a class="selflink" href="#ipsec.secrets_file">ipsec.secrets
  file</a></h2>
A <b>pluto</b> daemon and another IKE daemon (for example, another instance of
  <b>pluto</b>) must convince each other that they are who they are supposed to
  be before any negotiation can succeed. This authentication is accomplished by
  using either secrets that have been shared beforehand (manually) or by using
  RSA signatures. There are other techniques, but they have not been implemented
  in <b>pluto</b>.
<div class="Pp"></div>
The file /etc/ipsec.secrets is used to keep preshared secret keys and XAUTH
  passwords. RSA private keys, X.509 certificates, CRLs, OCSP and smartcards are
  handled via NSS. For debugging, there is an argument to the <b>pluto</b>
  command to use a different file. This file is described in
  <b>ipsec.secrets</b>(5).
<h2 class="Ss" title="Ss" id="Running_Pluto"><a class="selflink" href="#Running_Pluto">Running
  Pluto</a></h2>
To fire up the daemon, just type <b>pluto</b> (be sure to be running as the
  superuser). The default IKE port number is 500, the UDP port assigned by IANA
  for IKE Daemons. <b>pluto</b> must be run by the superuser to be able to use
  the UDP 500 port. If pluto is told to enable NAT-Traversal, then UDP port 4500
  is also taken by pluto to listen on.
<div class="Pp"></div>
Pluto supports different IPstacks on different operating systems. This can be
  configured using one of the options <b>--use-netkey</b> (the default),
  <b>--use-klips</b>, <b>--use-mast</b>, <b>--use-bsdkame</b>,
  <b>--use-win2k</b> or <b>--use-nostack</b>. The latter is meant for testing
  only - no actual IPsec connections will be loaded into the kernel. The option
  <b>--use-auto</b> has been obsoleted. On startup, pluto might also read the
  <b>protostack=</b> option to select the IPsec stack to use if <b>--config
  /etc/ipsec.conf</b> is given as argument to pluto. If both <b>--use-XXX</b>
  and <b>--config /etc/ipsec.conf</b> are specified, the last command line
  argument specified takes precedence.
<div class="Pp"></div>
Pluto supports RFC 3947 NAT-Traversal. The allowed range behind the NAT routers
  is submitted using the <b>--virtual-private</b> option. See
  <b>ipsec.conf</b>(5) for the syntax. The option <b>--force-keepalive</b>
  forces the sending of the <i>keep-alive packets</i>, which are send to prevent
  the NAT router from closing its port when there is not enough traffic on the
  IPsec connection. The <b>--keep-alive</b> sets the delay (in seconds) of these
  keep-alive packets. The newer NAT-T standards support <i>port floating</i>,
  and Libreswan enables this per default.
<div class="Pp"></div>
Pluto supports the use of X.509 certificates and sends it certificate when
  needed. This can confuse IKE implementations that do not implement this, such
  as the old FreeS/WAN implementation. The <b>--nocrsend</b> prevents pluto from
  sending these. At startup, pluto loads all the X.509 related files from the
  directories /etc/ipsec.d/certs, /etc/ipsec.d/cacerts, /etc/ipsec.d/aacerts,
  /etc/ipsec.d/private and /etc/ipsec.d/crls. The <i>Certificate Revocation
  Lists</i> can also be retrieved from an URL. The option
  <b>--crlcheckinterval</b> sets the time between checking for CRL expiration
  and issuing new fetch commands. The first attempt to update a CRL is started
  at <i>2*crlcheckinterval</i> before the next update time. Pluto logs a warning
  if no valid CRL was loaded or obtained for a connection. If
  <b>--strictcrlpolicy</b> is given, the connection will be rejected until a
  valid CRL has been loaded.
<div class="Pp"></div>
Pluto can also use helper children to off-load cryptographic operations. This
  behavior can be fine tuned using the <b>--nhelpers</b>. Pluto will start
  <i>(n-1)</i> of them, where <i>n</i> is the number of CPU&#x2019;s you have
  (including hypherthreaded CPU&#x2019;s). A value of <i>0</i> forces pluto to
  do all operations in the main process. A value of <i>-1</i> tells pluto to
  perform the above calculation. Any other value forces the number to that
  amount.
<div class="Pp"></div>
Pluto uses the NSS crypto library as its random source. Some government Three
  Letter Agency requires that pluto reads 440 bits from /dev/random and feed
  this into the NSS RNG before drawing random from the NSS library, despite the
  NSS library itself already seeding its internal state. As this process can
  block pluto for an extended time, the default is to not perform this redundant
  seeding. The <b>--seedbits</b> option can be used to specify the number of
  bits that will be pulled from /dev/random and seeded into the NSS RNG. This
  can also be accomplished by specifying seedbits in the &quot;config
  setup&quot; section of ipsec.conf. This option should not be used by most
  people.
<div class="Pp"></div>
<b>pluto</b> attempts to create a lockfile with the name
  /var/run/pluto/pluto.pid. If the lockfile cannot be created, <b>pluto</b>
  exits - this prevents multiple <b>pluto</b>s from competing Any
  &#x201C;leftover&#x201D; lockfile must be removed before <b>pluto</b> will
  run. <b>pluto</b> writes its PID into this file so that scripts can find it.
  This lock will not function properly if it is on an NFS volume (but sharing
  locks on multiple machines doesn't make sense anyway).
<div class="Pp"></div>
<b>pluto</b> then forks and the parent exits. This is the conventional
  &#x201C;daemon fork&#x201D;. It can make debugging awkward, so there is an
  option to suppress this fork. In certain configurations, pluto might also
  launch helper programs to assist with DNS queries or to offload cryptographic
  operations.
<div class="Pp"></div>
All logging, including diagnostics, is sent to <b>syslog</b>(3) with
  facility=authpriv; it decides where to put these messages (possibly in
  /var/log/secure or /var/log/auth.log). Since this too can make debugging
  awkward, the option <b>--stderrlog</b> is used to steer logging to stderr.
<div class="Pp"></div>
Alternatively, <b>--logfile</b> can be used to send all logging information to a
  specific file.
<div class="Pp"></div>
If the <b>--perpeerlog</b> option is given, then pluto will open a log file per
  connection. By default, this is in /var/log/pluto/peer, in a subdirectory
  formed by turning all dot (.) [IPv4} or colon (:) [IPv6] into slashes (/).
<div class="Pp"></div>
The base directory can be changed with the <b>--perpeerlogbase</b>.
<div class="Pp"></div>
Once <b>pluto</b> is started, it waits for requests from <b>whack</b>.
<h2 class="Ss" title="Ss" id="Pluto's_Internal_State"><a class="selflink" href="#Pluto's_Internal_State">Pluto's
  Internal State</a></h2>
To understand how to use <b>pluto</b>, it is helpful to understand a little
  about its internal state. Furthermore, the terminology is needed to decipher
  some of the diagnostic messages.
<div class="Pp"></div>
Pluto supports <b>food groups</b>, and X.509 certificates. These are located in
  /etc/ipsec.d, or another directory as specified by <b>--ipsecdir</b>.
<div class="Pp"></div>
Pluto may core dump. It will normally do so into the current working directory.
  You can specify the --coredir option for pluto, or specify the dumpdir= option
  in ipsec.conf.
<div class="Pp"></div>
If you are investigating a potential memory leak in pluto, start pluto with the
  --leak-detective option. Before the leak causes the system or pluto to die,
  shut down pluto in the regular way. pluto will display a list of leaks it has
  detected.
<div class="Pp"></div>
The <i>(potential) connection</i> database describes attributes of a connection.
  These include the IP addresses of the hosts and client subnets and the
  security characteristics desired. <b>pluto</b> requires this information
  (simply called a connection) before it can respond to a request to build an
  SA. Each connection is given a name when it is created, and all references are
  made using this name.
<div class="Pp"></div>
During the IKE exchange to build an SA, the information about the negotiation is
  represented in a <i>state object</i>. Each state object reflects how far the
  negotiation has reached. Once the negotiation is complete and the SA
  established, the state object remains to represent the SA. When the SA is
  terminated, the state object is discarded. Each State object is given a serial
  number and this is used to refer to the state objects in logged messages.
<div class="Pp"></div>
Each state object corresponds to a connection and can be thought of as an
  instantiation of that connection. At any particular time, there may be any
  number of state objects corresponding to a particular connection. Often there
  is one representing an ISAKMP SA and another representing an IPsec SA.
<div class="Pp"></div>
<b>KLIPS</b> hooks into the routing code in a LINUX kernel. Traffic to be
  processed by an IPsec SA must be directed through <b>KLIPS</b> by routing
  commands. Furthermore, the processing to be done is specified by <i>ipsec
  eroute(8)</i> commands. <b>pluto</b> takes the responsibility of managing both
  of these special kinds of routes.
<div class="Pp"></div>
<b>NETKEY</b> requires no special routing.
<div class="Pp"></div>
Each connection may be routed, and must be while it has an IPsec SA. The
  connection specifies the characteristics of the route: the interface on this
  machine, the &#x201C;gateway&#x201D; (the nexthop), and the peer's client
  subnet. Two connections may not be simultaneously routed if they are for the
  same peer's client subnet but use different interfaces or gateways (
  <b>pluto</b>'s logic does not reflect any advanced routing capabilities).
<div class="Pp"></div>
On KLIPS, each eroute is associated with the state object for an IPsec SA
  because it has the particular characteristics of the SA. Two eroutes conflict
  if they specify the identical local and remote clients (unlike for routes, the
  local clients are taken into account).
<div class="Pp"></div>
When <b>pluto</b> needs to install a route for a connection, it must make sure
  that no conflicting route is in use. If another connection has a conflicting
  route, that route will be taken down, as long as there is no IPsec SA
  instantiating that connection. If there is such an IPsec SA, the attempt to
  install a route will fail.
<div class="Pp"></div>
There is an exception. If <b>pluto</b>, as Responder, needs to install a route
  to a fixed client subnet for a connection, and there is already a conflicting
  route, then the SAs using the route are deleted to make room for the new SAs.
  The rationale is that the new connection is probably more current. The need
  for this usually is a product of Road Warrior connections (these are explained
  later; they cannot be used to initiate).
<div class="Pp"></div>
When <b>pluto</b> needs to install an eroute for an IPsec SA (for a state
  object), first the state object's connection must be routed (if this cannot be
  done, the eroute and SA will not be installed). If a conflicting eroute is
  already in place for another connection, the eroute and SA will not be
  installed (but note that the routing exception mentioned above may have
  already deleted potentially conflicting SAs). If another IPsec SA for the same
  connection already has an eroute, all its outgoing traffic is taken over by
  the new eroute. The incoming traffic will still be processed. This
  characteristic is exploited during rekeying.
<div class="Pp"></div>
All of these routing characteristics are expected change when <b>KLIPS</b> and
  <b>NETKEY</b> merge into a single new stack.
<h2 class="Ss" title="Ss" id="Using_whack"><a class="selflink" href="#Using_whack">Using
  whack</a></h2>
<b>whack</b> is used to command a running <b>pluto</b>. <b>whack</b> uses a UNIX
  domain socket to speak to <b>pluto</b> (by default, /var/pluto.ctl).
<div class="Pp"></div>
<b>whack</b> has an intricate argument syntax. This syntax allows many different
  functions to be specified. The help form shows the usage or version
  information. The connection form gives <b>pluto</b> a description of a
  potential connection. The public key form informs <b>pluto</b> of the RSA
  public key for a potential peer. The delete form deletes a connection
  description and all SAs corresponding to it. The listen form tells
  <b>pluto</b> to start or stop listening on the public interfaces for IKE
  requests from peers. The route form tells <b>pluto</b> to set up routing for a
  connection; the unroute form undoes this. The initiate form tells <b>pluto</b>
  to negotiate an SA corresponding to a connection. The terminate form tells
  <b>pluto</b> to remove all SAs corresponding to a connection, including those
  being negotiated. The status form displays the <b>pluto</b>'s internal state.
  The debug form tells <b>pluto</b> to change the selection of debugging output
  &#x201C;on the fly&#x201D;. The shutdown form tells <b>pluto</b> to shut down,
  deleting all SAs.
<div class="Pp"></div>
The crash option asks pluto to consider a particularly target IP to have
  crashed, and to attempt to restart all connections with that IP address as a
  gateway. In general, you should use Dead Peer Detection to detect this kind of
  situation automatically, but this is not always possible.
<div class="Pp"></div>
Most options are specific to one of the forms, and will be described with that
  form. There are three options that apply to all forms.
<div class="Pp"></div>
<b>--ctlbase</b>&#x00A0;<i>path</i>
<div style="margin-left: 4.00ex;"><i>path</i>.ctl is used as the UNIX domain
  socket for talking to <b>pluto</b>. This option facilitates debugging.</div>
<div class="Pp"></div>
<b>--label</b>&#x00A0;<i>string</i>
<div style="margin-left: 4.00ex;">adds the string to all error messages
  generated by <b>whack</b>.</div>
<div class="Pp"></div>
The help form of <b>whack</b> is self-explanatory.
<div class="Pp"></div>
<b>--help</b>
<div style="margin-left: 4.00ex;">display the usage message.</div>
<div class="Pp"></div>
<b>--version</b>
<div style="margin-left: 4.00ex;">display the version of <b>whack</b>.</div>
<div class="Pp"></div>
The connection form describes a potential connection to <b>pluto</b>.
  <b>pluto</b> needs to know what connections can and should be negotiated. When
  <b>pluto</b> is the initiator, it needs to know what to propose. When
  <b>pluto</b> is the responder, it needs to know enough to decide whether is is
  willing to set up the proposed connection.
<div class="Pp"></div>
The description of a potential connection can specify a large number of details.
  Each connection has a unique name. This name will appear in a updown shell
  command, so it should not contain punctuation that would make the command
  ill-formed.
<div class="Pp"></div>
<b>--name</b>&#x00A0;<i>connection-name</i>
<div style="margin-left: 4.00ex;">sets the name of the connection</div>
<div class="Pp"></div>
The topology of a connection is symmetric, so to save space here is half a
  picture:
<div class="Pp"></div>
&#x00A0;&#x00A0;&#x00A0;client_subnet&lt;--&gt;host:ikeport&lt;--&gt;nexthop&lt;---
<div class="Pp"></div>
A similar trick is used in the flags. The same flag names are used for both
  ends. Those before the <b>--to</b> flag describe the left side and those
  afterwards describe the right side. When <b>pluto</b> attempts to use the
  connection, it decides whether it is the left side or the right side of the
  connection, based on the IP numbers of its interfaces.
<div class="Pp"></div>
<b>--id</b>&#x00A0;<i>id</i>
<div style="margin-left: 4.00ex;">the identity of the end. Currently, this can
  be an IP address (specified as dotted quad or as a Fully Qualified Domain
  Name, which will be resolved immediately) or as a Fully Qualified Domain Name
  itself (prefixed by &#x201C;@&#x201D; to signify that it should not be
  resolved), or as user@FQDN, or an X.509 DN, or as the magic value
  <b>%myid</b>. <b>Pluto</b> only authenticates the identity, and does not use
  it for addressing, so, for example, an IP address need not be the one to which
  packets are to be sent. If the option is absent, the identity defaults to the
  IP address specified by <b>--host</b>. <b>%myid</b> allows the identity to be
  separately specified (by the <b>pluto</b> or <b>whack</b> option <b>--myid</b>
  or by the <b>ipsec.conf</b>(5)<b>config setup</b> parameter <i>myid</i>).
  Otherwise, <b>pluto</b> tries to guess what <b>%myid</b> should stand for: the
  IP address of <b>%defaultroute</b>, if it is supported by a suitable TXT
  record in the reverse domain for that IP address, or the system's hostname, if
  it is supported by a suitable TXT record in its forward domain.</div>
<div class="Pp"></div>
<b>--host</b>&#x00A0;<i>ip-address</i>, <b>--host</b>&#x00A0;<b>%any</b>,
  <b>--host</b>&#x00A0; <b>%opportunistic</b>
<div style="margin-left: 4.00ex;">the IP address of the end (generally the
  public interface). If <b>pluto</b> is to act as a responder for IKE
  negotiations initiated from unknown IP addresses (the &#x201C;Road
  Warrior&#x201D; case), the IP address should be specified as <b>%any</b>
  (currently, the obsolete notation 0.0.0.0 is also accepted for this). If
  <b>pluto</b> is to opportunistically initiate the connection, use
  <b>%opportunistic</b></div>
<div class="Pp"></div>
<b>--cert</b>&#x00A0;<i>filename</i>
<div style="margin-left: 4.00ex;">The filename of the X.509 certificate. This
  must be the public key certificate only, and cannot be the PKCS#12 certificate
  file. See <b>ipsec.conf</b>(5) on how to extrac this from the PKCS#12
  file.</div>
<div class="Pp"></div>
<b>--ca</b>&#x00A0;<i>distinguished name</i>
<div style="margin-left: 4.00ex;">the X.509 Certificate Authority's
  Distinguished Name (DN) used as trust anchor for this connection. This is the
  CA certificate that signed the host certificate, as well as the certificate of
  the incoming client.</div>
<div class="Pp"></div>
<b>--groups</b>&#x00A0;<i>access control groups</i>
<div style="margin-left: 4.00ex;">the access control groups used.</div>
<div class="Pp"></div>
<b>--sendcert</b>&#x00A0;<i>yes|forced|always|ifasked|no|never</i>
<div style="margin-left: 4.00ex;">Whether or not to send our X.509 certificate
  credentials. This could potentially give an attacker too much information
  about which identities are allowed to connect to this host. The default is to
  use <b>ifasked</b> when we are a Responder, and to use <b>yes</b> (which is
  the same as <b>forced</b> and <b>always</b> if we are an Initiator. The values
  <b>no</b> and <b>never</b> are equivalent. NOTE: &quot;forced&quot; does not
  seem to be actually implemented - do not use it.</div>
<div class="Pp"></div>
<b>--sendca</b>&#x00A0;<i>none|issuer|all</i>
<div style="margin-left: 4.00ex;">How much of our available X.509 trust chain to
  send with the end certificate, excluding any root CAs. Specifying
  <b>issuer</b> sends just the issuing intermediate CA, while <b> all</b> will
  send the entire chain of intermediate CAs. <b>none</b> will not send any CA
  certs. The default is <b>none</b> which maintains the current libreswan
  behavior.</div>
<div class="Pp"></div>
<b>--certtype</b>&#x00A0;<i>number</i>
<div style="margin-left: 4.00ex;">The X.509 certificate type number.</div>
<div class="Pp"></div>
<b>--ikeport</b>&#x00A0;<i>port-number</i>
<div style="margin-left: 4.00ex;">the UDP port that IKE listens to on that host.
  The default is 500. ( <b>pluto</b> on this machine uses the port specified by
  its own command line argument, so this only affects where <b>pluto</b> sends
  messages.)</div>
<div class="Pp"></div>
<b>--nexthop</b>&#x00A0;<i>ip-address</i>
<div style="margin-left: 4.00ex;">where to route packets for the peer's client
  (presumably for the peer too, but it will not be used for this). When
  <b>pluto</b> installs an IPsec SA, it issues a route command. It uses the
  nexthop as the gateway. The default is the peer's IP address (this can be
  explicitly written as <b>%direct</b>; the obsolete notation 0.0.0.0 is
  accepted). This option is necessary if <b>pluto</b>'s host's interface used
  for sending packets to the peer is neither point-to-point nor directly
  connected to the peer.</div>
<div class="Pp"></div>
<b>--client</b>&#x00A0;<i>subnet</i>
<div style="margin-left: 4.00ex;">the subnet for which the IPsec traffic will be
  destined. If not specified, the host will be the client. The subnet can be
  specified in any of the forms supported by <b>ipsec_atosubnet</b>(3). The
  general form is <i>address</i>/<i>mask</i>. The <i>address</i> can be either a
  domain name or four decimal numbers (specifying octets) separated by dots. The
  most convenient form of the <i>mask</i> is a decimal integer, specifying the
  number of leading one bits in the mask. So, for example, 10.0.0.0/8 would
  specify the class A network &#x201C;Net 10&#x201D;.</div>
<div class="Pp"></div>
<b>--clientwithin</b>&#x00A0;<i>subnet</i>
<div style="margin-left: 4.00ex;">This option is obsolete and will be removed.
  Do not use this option anymore.</div>
<div class="Pp"></div>
<b>--clientprotoport</b>&#x00A0;<i>protocol/port</i>
<div style="margin-left: 4.00ex;">specify the Port Selectors (filters) to be
  used on this connection. The general form is <i>protocol</i>/<i>port</i>. This
  is most commonly used to limit the connection to L2TP traffic only by
  specifying a value of <i>17/1701</i> for UDP (protocol 17) and port 1701. The
  notation <i>17/%any</i> can be used to allow all UDP traffic and is needed for
  L2TP connections with Windows XP machines before Service Pack 2.</div>
<div class="Pp"></div>
<b>--srcip</b>&#x00A0;<i>ip-address</i>
<div style="margin-left: 4.00ex;">the IP address for this host to use when
  transmitting a packet to the remote IPsec gateway itself. This option is used
  to make the gateway itself use its internal IP, which is part of the
  <b>--client subnet</b>. Otherwise it will use its nearest IP address, which is
  its public IP address, which is not part of the subnet-subnet IPsec tunnel,
  and would therefor not get encrypted.</div>
<div class="Pp"></div>
<b>--xauthserver</b>
<div style="margin-left: 4.00ex;">this end is an xauthserver. It will lookup the
  xauth user name and password and verify this before allowing the connection to
  get established.</div>
<div class="Pp"></div>
<b>--xauthclient</b>
<div style="margin-left: 4.00ex;">this end is an xauthclient. To bring this
  connection up with the <b>--initiate</b> also requires the client to specify
  <b>--xauthuser username</b> and <b>--xauthpass password </b></div>
<div class="Pp"></div>
<b>--xauthuser</b>
<div style="margin-left: 4.00ex;">The username for the xauth authentication.This
  option is normally passed along by <b>ipsec_auto</b>(8) when an xauth
  connection is started using <i>ipsec auto --up conn</i></div>
<div class="Pp"></div>
<b>--xauthpass</b>
<div style="margin-left: 4.00ex;">The password for the xauth authentication.
  This option is normally passed along by <b>ipsec_auto</b>(8) when an xauth
  connection is started using <i>ipsec auto --up conn</i></div>
<div class="Pp"></div>
<b>--modecfgserver</b>
<div style="margin-left: 4.00ex;">this end is an Mode Config server</div>
<div class="Pp"></div>
<b>--modecfgclient</b>
<div style="margin-left: 4.00ex;">this end is an Mode Config client</div>
<div class="Pp"></div>
<b>--modecfgdns1</b>
<div style="margin-left: 4.00ex;">The IP address of the first DNS server to pass
  along to the ModeConfig Client</div>
<div class="Pp"></div>
<b>--modecfgdns2</b>
<div style="margin-left: 4.00ex;">The IP address of the second DNS server to
  pass along to the ModeConfig Client</div>
<div class="Pp"></div>
<b>--dnskeyondemand</b>
<div style="margin-left: 4.00ex;">specifies that when an RSA public key is
  needed to authenticate this host, and it isn't already known, fetch it from
  DNS.</div>
<div class="Pp"></div>
<b>--updown</b>&#x00A0;<i>updown</i>
<div style="margin-left: 4.00ex;">specifies an external shell command to be run
  whenever <b>pluto</b> brings up or down a connection. The script is used to
  build a shell command, so it may contain positional parameters, but ought not
  to have punctuation that would cause the resulting command to be ill-formed.
  The default is <i>ipsec _updown</i>. Pluto passes a dozen environment
  variables to the script about the connection involved.</div>
<div class="Pp"></div>
<b>--to</b>
<div style="margin-left: 4.00ex;">separates the specification of the left and
  right ends of the connection. Pluto tries to decide whether it is <i>left</i>
  or <i>right</i> based on the information provided on both sides of this
  option.</div>
<div class="Pp"></div>
The potential connection description also specifies characteristics of rekeying
  and security.
<div class="Pp"></div>
<b>--psk</b>
<div style="margin-left: 4.00ex;">Propose and allow preshared secret
  authentication for IKE peers. This authentication requires that each side use
  the same secret. May be combined with <b>--rsasig</b>; at least one must be
  specified.</div>
<div class="Pp"></div>
<b>--rsasig</b>
<div style="margin-left: 4.00ex;">Propose and allow RSA signatures for
  authentication of IKE peers. This authentication requires that each side have
  have a private key of its own and know the public key of its peer. May be
  combined with <b>--psk</b>; at least one must be specified.</div>
<div class="Pp"></div>
<b>--encrypt</b>
<div style="margin-left: 4.00ex;">All proposed or accepted IPsec SAs will
  include non-null ESP. The actual choices of transforms are wired into
  <b>pluto</b>.</div>
<div class="Pp"></div>
<b>--authenticate</b>
<div style="margin-left: 4.00ex;">All proposed IPsec SAs will include AH. All
  accepted IPsec SAs will include AH or ESP with authentication. The actual
  choices of transforms are wired into <b>pluto</b>. Note that this has nothing
  to do with IKE authentication.</div>
<div class="Pp"></div>
<b>--compress</b>
<div style="margin-left: 4.00ex;">All proposed IPsec SAs will include IPCOMP
  (compression). This will be ignored if KLIPS is not configured with IPCOMP
  support.</div>
<div class="Pp"></div>
<b>--tunnel</b>
<div style="margin-left: 4.00ex;">the IPsec SA should use tunneling. Implicit if
  the SA is for clients. Must only be used with <b>--authenticate</b> or
  <b>--encrypt</b>.</div>
<div class="Pp"></div>
<b>--ipv4</b>
<div style="margin-left: 4.00ex;">The host addresses will be interpreted as IPv4
  addresses. This is the default. Note that for a connection, all host addresses
  must be of the same Address Family (IPv4 and IPv6 use different Address
  Families).</div>
<div class="Pp"></div>
<b>--ipv6</b>
<div style="margin-left: 4.00ex;">The host addresses (including nexthop) will be
  interpreted as IPv6 addresses. Note that for a connection, all host addresses
  must be of the same Address Family (IPv4 and IPv6 use different Address
  Families).</div>
<div class="Pp"></div>
<b>--tunnelipv4</b>
<div style="margin-left: 4.00ex;">The client addresses will be interpreted as
  IPv4 addresses. The default is to match what the host will be. This does not
  imply <b>--tunnel</b> so the flag can be safely used when no tunnel is
  actually specified. Note that for a connection, all tunnel addresses must be
  of the same Address Family.</div>
<div class="Pp"></div>
<b>--tunnelipv6</b>
<div style="margin-left: 4.00ex;">The client addresses will be interpreted as
  IPv6 addresses. The default is to match what the host will be. This does not
  imply <b>--tunnel</b> so the flag can be safely used when no tunnel is
  actually specified. Note that for a connection, all tunnel addresses must be
  of the same Address Family.</div>
<div class="Pp"></div>
<b>--pfs</b>
<div style="margin-left: 4.00ex;">There should be Perfect Forward Secrecy - new
  keying material will be generated for each IPsec SA rather than being derived
  from the ISAKMP SA keying material. Since the group to be used cannot be
  negotiated (a dubious feature of the standard), <b>pluto</b> will propose the
  same group that was used during Phase 1. We don't implement a stronger form of
  PFS which would require that the ISAKMP SA be deleted after the IPSEC SA is
  negotiated.</div>
<div class="Pp"></div>
<b>--pfsgroup</b>&#x00A0;<i>modp-group</i>
<div style="margin-left: 4.00ex;">Sets the Diffie-Hellman group used. Currently
  the following values are supported: <b>modp1024</b> (DHgroup 2),
  <b>modp1536</b> (DHgroup 5), <b>modp2048</b> (DHgroup 14), <b>modp3072</b>
  (DHgroup 15), <b>modp4096</b> (DHgroup 16), <b>modp6144</b> (DHgroup 17), and
  <b>modp8192</b> (DHgroup 18). It is possible to support the weak and broken
  <b>modp768</b> (DHgroup 1), but this requires a manual recompile and is
  strongly discouraged.</div>
<div class="Pp"></div>
<b>--disablearrivalcheck</b>
<div style="margin-left: 4.00ex;">If the connection is a tunnel, allow packets
  arriving through the tunnel to have any source and destination
  addresses.</div>
<div class="Pp"></div>
<b>--esp</b>&#x00A0;<i>esp-algos</i>
<div style="margin-left: 4.00ex;">ESP encryption/authentication algorithm to be
  used for the connection (phase2 aka IPsec SA). The options must be suitable as
  a value of <b>ipsec_spi</b>(8). See <b>ipsec.conf</b>(5) for a detailed
  description of the algorithm format.</div>
<div class="Pp"></div>
<b>--aggrmode</b>
<div style="margin-left: 4.00ex;">This tunnel is using aggressive mode ISAKMP
  negotiation. The default is main mode. Aggressive mode is less secure than
  main mode as it reveals your identity to an eavesdropper, but is needed to
  support road warriors using PSK keys or to interoperate with other buggy
  implementations insisting on using aggressive mode.</div>
<div class="Pp"></div>
<b>--modecfgpull</b>
<div style="margin-left: 4.00ex;">Pull the Mode Config network information from
  the peer.</div>
<div class="Pp"></div>
<b>--dpddelay</b>&#x00A0;<i>seconds</i>
<div style="margin-left: 4.00ex;">Set the delay (in seconds) between Dead Peer
  Detection (RFC 3706) keepalives (R_U_THERE, R_U_THERE_ACK) that are sent for
  this connection (default 30 seconds).</div>
<div class="Pp"></div>
<b>--timeout</b>&#x00A0;<i>seconds</i>
<div style="margin-left: 4.00ex;">Set the length of time (in seconds) we will
  idle without hearing either an R_U_THERE poll from our peer, or an
  R_U_THERE_ACK reply. After this period has elapsed with no response and no
  traffic, we will declare the peer dead, and remove the SA (default 120
  seconds).</div>
<div class="Pp"></div>
<b>--dpdaction</b>&#x00A0;<i>action</i>
<div style="margin-left: 4.00ex;">When a DPD enabled peer is declared dead, what
  action should be taken. <b>hold</b>(default) means the eroute will be put into
  <i>%hold</i> status, while <b>clear</b>means the eroute and SA with both be
  cleared. Clear is really only useful on the server of a Road Warrior config.
  The action <b>restart</b> is used on tunnels that need to be permanently up,
  and have static IP addresses. The action <b>restart_by_peer</b>has been
  obsoleted and its functionality has been moved into the restart action.</div>
<div class="Pp"></div>
<b>--forceencaps</b>
<div style="margin-left: 4.00ex;">In some cases, for example when ESP packets
  are filtered or when a broken IPsec peer does not properly recognise NAT, it
  can be useful to force RFC-3948 encapsulation using this option. It causes
  pluto lie and tell the remote peer that RFC-3948 encapsulation (ESP in UDP
  port 4500 packets) is required.</div>
<div class="Pp"></div>
If none of the <b>--encrypt</b>, <b>--authenticate</b>, <b>--compress</b>, or
  <b>--pfs</b> flags is given, the initiating the connection will only build an
  ISAKMP SA. For such a connection, client subnets have no meaning and must not
  be specified.
<div class="Pp"></div>
Apart from initiating directly using the <b>--initiate</b> option, a tunnel can
  be loaded with a different policy
<div class="Pp"></div>
<b>--initiateontraffic</b>
<div style="margin-left: 4.00ex;">Only initiate the connection when we have
  traffic to send over the connection</div>
<div class="Pp"></div>
<b>--pass</b>
<div style="margin-left: 4.00ex;">Allow <b>unencrypted</b> traffic to flow until
  the tunnel is initiated.</div>
<div class="Pp"></div>
<b>--drop</b>
<div style="margin-left: 4.00ex;">Drop unencrypted traffic silently.</div>
<div class="Pp"></div>
<b>--reject</b>
<div style="margin-left: 4.00ex;">Drop unencrypted traffic silently, but send an
  ICMP message notifying the other end.</div>
<div class="Pp"></div>
These options need to be documented
<div class="Pp"></div>
<b>--failnone</b>
<div style="margin-left: 4.00ex;">to be documented</div>
<div class="Pp"></div>
<b>--failpass</b>
<div style="margin-left: 4.00ex;">to be documented</div>
<div class="Pp"></div>
<b>--faildrop</b>
<div style="margin-left: 4.00ex;">to be documented</div>
<div class="Pp"></div>
<b>--failreject</b>
<div style="margin-left: 4.00ex;">to be documented</div>
<div class="Pp"></div>
<b>pluto</b> supports various X.509 Certificate related options.
<div class="Pp"></div>
<b>--utc</b>
<div style="margin-left: 4.00ex;">display all times in UTC.</div>
<div class="Pp"></div>
<b>--listall</b>
<div style="margin-left: 4.00ex;">lists all of the X.509 information known to
  pluto.</div>
<div class="Pp"></div>
<b>--listpubkeys</b>
<div style="margin-left: 4.00ex;">list all the public keys that have been
  successfully loaded.</div>
<div class="Pp"></div>
<b>--listcerts</b>
<div style="margin-left: 4.00ex;">list all the X.509 certificates that are
  currently loaded.</div>
<div class="Pp"></div>
<b>--checkpubkeys</b>
<div style="margin-left: 4.00ex;">list all the loaded X.509 certificates which
  are about to expire or have been expired.</div>
<div class="Pp"></div>
<b>--listcacerts</b>
<div style="margin-left: 4.00ex;">list all the Certificate Authority X.509
  certificates that are currently loaded.</div>
<div class="Pp"></div>
<b>--listcrls</b>
<div style="margin-left: 4.00ex;">list all the loaded <i>Certificate Revocation
  Lists</i> (CRLs)</div>
<div class="Pp"></div>
The corresponding options <b>--rereadsecrets</b>, <b>--rereadall</b>, and
  <b>--rereadcrls</b> options reread this information from their respective
  sources, and purge all the online obtained information. The option
  <b>--listevents</b> lists all pending CRL fetch commands.
<div class="Pp"></div>
<b>--ikelifetime</b>&#x00A0;<i>seconds</i>
<div style="margin-left: 4.00ex;">how long <b>pluto</b> will propose that an
  ISAKMP SA be allowed to live. The default is 3600 (one hour) and the maximum
  is 86400 (1 day). This option will not affect what is accepted. <b>pluto</b>
  will reject proposals that exceed the maximum.</div>
<div class="Pp"></div>
<b>--ipseclifetime</b>&#x00A0;<i>seconds</i>
<div style="margin-left: 4.00ex;">how long <b>pluto</b> will propose that an
  IPsec SA be allowed to live. The default is 28800 (eight hours) and the
  maximum is 86400 (one day). This option will not affect what is accepted.
  <b>pluto</b> will reject proposals that exceed the maximum.</div>
<div class="Pp"></div>
<b>--rekeymargin</b>&#x00A0;<i>seconds</i>
<div style="margin-left: 4.00ex;">how long before an SA's expiration should
  <b>pluto</b> try to negotiate a replacement SA. This will only happen if
  <b>pluto</b> was the initiator. The default is 540 (nine minutes).</div>
<div class="Pp"></div>
<b>--rekeyfuzz</b>&#x00A0;<i>percentage</i>
<div style="margin-left: 4.00ex;">maximum size of random component to add to
  rekeymargin, expressed as a percentage of rekeymargin. <b>pluto</b> will
  select a delay uniformly distributed within this range. By default, the
  percentage will be 100. If greater determinism is desired, specify 0. It may
  be appropriate for the percentage to be much larger than 100.</div>
<div class="Pp"></div>
<b>--keyingtries</b>&#x00A0;<i>count</i>
<div style="margin-left: 4.00ex;">how many times <b>pluto</b> should try to
  negotiate an SA, either for the first time or for rekeying. A value of 0 is
  interpreted as a very large number: never give up. The default is three.</div>
<div class="Pp"></div>
<b>--dontrekey</b>
<div style="margin-left: 4.00ex;">A misnomer. Only rekey a connection if we were
  the Initiator and there was recent traffic on the existing connection. This
  applies to Phase 1 and Phase 2. This is currently the only automatic way for a
  connection to terminate. It may be useful with Road Warrior or Opportunistic
  connections. Since SA lifetime negotiation is take-it-or-leave it, a Responder
  normally uses the shorter of the negotiated or the configured lifetime. This
  only works because if the lifetime is shorter than negotiated, the Responder
  will rekey in time so that everything works. This interacts badly with
  <b>--dontrekey</b>. In this case, the Responder will end up rekeying to
  rectify a shortfall in an IPsec SA lifetime; for an ISAKMP SA, the Responder
  will accept the negotiated lifetime.</div>
<div class="Pp"></div>
<b>--delete</b>
<div style="margin-left: 4.00ex;">when used in the connection form, it causes
  any previous connection with this name to be deleted before this one is added.
  Unlike a normal delete, no diagnostic is produced if there was no previous
  connection to delete. Any routing in place for the connection is undone.</div>
<div class="Pp"></div>
<b>--delete</b>, <b>--name</b>&#x00A0;<i>connection-name</i>
<div style="margin-left: 4.00ex;">The delete form deletes a named connection
  description and any SAs established or negotiations initiated using this
  connection. Any routing in place for the connection is undone.</div>
<div class="Pp"></div>
<b>--deletestate</b>&#x00A0;<i>state-number</i>
<div style="margin-left: 4.00ex;">The deletestate form deletes the state object
  with the specified serial number. This is useful for selectively deleting
  instances of connections.</div>
<div class="Pp"></div>
The route form of the <b>whack</b> command tells <b>pluto</b> to set up routing
  for a connection. Although like a traditional route, it uses an ipsec device
  as a virtual interface. Once routing is set up, no packets will be sent
  &#x201C;in the clear&#x201D; to the peer's client specified in the connection.
  A TRAP shunt eroute will be installed; if outbound traffic is caught, Pluto
  will initiate the connection. An explicit <b>whack</b> route is not always
  needed: if it hasn't been done when an IPsec SA is being installed, one will
  be automatically attempted.
<div class="Pp"></div>
<b>--route</b>, <b>--name</b>&#x00A0;<i>connection-name</i>
<div style="margin-left: 4.00ex;">When a routing is attempted for a connection,
  there must not already be a routing for a different connection with the same
  subnet but different interface or destination, or if there is, it must not be
  being used by an IPsec SA. Otherwise the attempt will fail.</div>
<div class="Pp"></div>
<b>--unroute</b>, <b>--name</b>&#x00A0;<i>connection-name</i>
<div style="margin-left: 4.00ex;">The unroute form of the <b>whack</b> command
  tells <b>pluto</b> to undo a routing. <b>pluto</b> will refuse if an IPsec SA
  is using the connection. If another connection is sharing the same routing, it
  will be left in place. Without a routing, packets will be sent without
  encryption or authentication.</div>
<div class="Pp"></div>
The initiate form tells <b>pluto</b> to initiate a negotiation with another
  <b>pluto</b> (or other IKE daemon) according to the named connection.
  Initiation requires a route that <b>--route</b> would provide; if none is in
  place at the time an IPsec SA is being installed, <b>pluto</b> attempts to set
  one up.
<div class="Pp"></div>
<b>--initiate</b>, <b>--name</b>&#x00A0;<i>connection-name</i>,
  <b>--asynchronous</b>
<div style="margin-left: 4.00ex;">The initiate form of the <b>whack</b> command
  will relay back from <b>pluto</b> status information via the UNIX domain
  socket (unless --asynchronous is specified). The status information is meant
  to look a bit like that from <b>FTP</b>. Currently <b>whack</b> simply copies
  this to stderr. When the request is finished (eg. the SAs are established or
  <b>pluto</b> gives up), <b>pluto</b> closes the channel, causing <b>whack</b>
  to terminate.</div>
<div class="Pp"></div>
The opportunistic initiate form is mainly used for debugging.
<div class="Pp"></div>
<b>--tunnelipv4</b>, <b>--tunnelipv6</b>,
  <b>--oppohere</b>&#x00A0;<i>ip-address</i>,
  <b>--oppothere</b>&#x00A0;<i>ip-address</i>
<div style="margin-left: 4.00ex;">This will cause <b>pluto</b> to attempt to
  opportunistically initiate a connection from here to the there, even if a
  previous attempt had been made. The whack log will show the progress of this
  attempt.</div>
<div class="Pp"></div>
Ending an connection
<div class="Pp"></div>
<b>--terminate</b>, <b>--name</b>&#x00A0;<i>connection-name</i>
<div style="margin-left: 4.00ex;">the terminate form tells <i>pluto</i> to
  delete any SAs that use the specified connection and to stop any negotiations
  in process. it does not prevent new negotiations from starting (the delete
  form has this effect).</div>
<div class="Pp"></div>
<b>--crash</b>&#x00A0;<i>ip-address</i>
<div style="margin-left: 4.00ex;">If the remote peer has crashed, and therefor
  did not notify us, we keep sending encrypted traffic, and rejecting all
  plaintext (non-IKE) traffic from that remote peer. The <b>--crash</b> brings
  our end down as well for all the known connections to the specified
  <i>ip-address</i></div>
<div class="Pp"></div>
<b>--whackrecord</b><i>filename</i>, <b>--whackstoprecord</b>
<div style="margin-left: 4.00ex;">this causes <i>pluto</i>to open the given
  filename for write, and record each of the messages received from whack or
  addconn. This continues until the whackstoprecord option is used. This option
  may not be combined with any other command. The start/stop commands are not
  recorded themselves. These files are usually used to create input files for
  unit tests, particularly for complex setups where policies may in fact
  overlap.
<div style="height: 1.00em;">&#x00A0;</div>
The format of the file consists of a line starting with #!pluto-whack and the
  date that the file was started, as well as the hostname, and a linefeed. What
  follows are binary format records consisting of a 32-bit record length in
  bytes, (including the length record itself), a 64-bit timestamp, and then the
  literal contents of the whack message that was received. All integers are in
  host format. In order to unambigously determine the host order, the first
  record is an empty record that contains only the current WHACK_MAGIC value.
  This record is 16 bytes long.</div>
<div class="Pp"></div>
<i>ip-address</i>
<div style="margin-left: 4.00ex;">If the remote peer has crashed, and therefor
  did not notify us, we keep sending encrypted traffic, and rejecting all
  plaintext (non-IKE) traffic from that remote peer. The <b>--crash</b> brings
  our end down as well for all the known connections to the specified
  <i>ip-address</i></div>
<div class="Pp"></div>
The public key for informs <b>pluto</b> of the RSA public key for a potential
  peer. Private keys must be kept secret, so they are kept in
  <b>ipsec.secrets</b>(5).
<div class="Pp"></div>
<b>--keyid&#x00A0;</b><i>id</i>
<div style="margin-left: 4.00ex;">specififies the identity of the peer for which
  a public key should be used. Its form is identical to the identity in the
  connection. If no public key is specified, <b>pluto</b> attempts to find KEY
  records from DNS for the id (if a FQDN) or through reverse lookup (if an IP
  address). Note that there several interesting ways in which this is not
  secure.</div>
<div class="Pp"></div>
<b>--addkey</b>
<div style="margin-left: 4.00ex;">specifies that the new key is added to the
  collection; otherwise the new key replaces any old ones.</div>
<div class="Pp"></div>
<b>--pubkeyrsa&#x00A0;</b><i>key</i>
<div style="margin-left: 4.00ex;">specifies the value of the RSA public key. It
  is a sequence of bytes as described in RFC 2537 &#x201C;RSA/MD5 KEYs and SIGs
  in the Domain Name System (DNS)&#x201D;. It is denoted in a way suitable for
  <b>ipsec_ttodata</b>(3). For example, a base 64 numeral starts with 0s.</div>
<div class="Pp"></div>
The listen form tells <b>pluto</b> to start listening for IKE requests on its
  public interfaces. To avoid race conditions, it is normal to load the
  appropriate connections into <b>pluto</b> before allowing it to listen. If
  <b>pluto</b> isn't listening, it is pointless to initiate negotiations, so it
  will refuse requests to do so. Whenever the listen form is used, <b>pluto</b>
  looks for public interfaces and will notice when new ones have been added and
  when old ones have been removed. This is also the trigger for <b>pluto</b> to
  read the <i>ipsec.secrets</i> file. So listen may useful more than once.
<div class="Pp"></div>
<b>--listen</b>
<div style="margin-left: 4.00ex;">start listening for IKE traffic on public
  interfaces.</div>
<div class="Pp"></div>
<b>--unlisten</b>
<div style="margin-left: 4.00ex;">stop listening for IKE traffic on public
  interfaces.</div>
<div class="Pp"></div>
The busy and relax options tells <b>pluto</b> to explicitly activate or
  deactivate additional DDoS protection. Normally, these meassures are
  automatically activate or deactivate based on the number of states inside
  pluto. One of these DDoS protection methods is to active IKEv2 DCOOKIEs to
  defend against spoofed IKE packets.
<div class="Pp"></div>
<b>--busy</b>
<div style="margin-left: 4.00ex;">place pluto into busy mode and activate
  anti-DDoS measures.</div>
<div class="Pp"></div>
<b>--relax</b>
<div style="margin-left: 4.00ex;">pull pluto out of busy mode and deactivate
  anti-DDoS measures.</div>
<div class="Pp"></div>
The status form will display information about the internal state of
  <b>pluto</b>: information about each potential connection, about each state
  object, and about each shunt that <b>pluto</b> is managing without an
  associated connection.
<div class="Pp"></div>
<b>--status</b>
<div style="margin-left: 4.00ex;"></div>
<div class="Pp"></div>
The trafficstatus form will display the xauth username, add_time and the total
  in and out bytes of the IPsec SA's.
<div class="Pp"></div>
<b>--trafficstatus</b>
<div style="margin-left: 4.00ex;"></div>
<div class="Pp"></div>
The shutdown form is the proper way to shut down <b>pluto</b>. It will tear down
  the SAs on this machine that <b>pluto</b> has negotiated. It does not inform
  its peers, so the SAs on their machines remain.
<div class="Pp"></div>
<b>--shutdown</b>
<div style="margin-left: 4.00ex;"></div>
<h2 class="Ss" title="Ss" id="Examples"><a class="selflink" href="#Examples">Examples</a></h2>
It would be normal to start <b>pluto</b> in one of the system initialization
  scripts. It needs to be run by the superuser. Generally, no arguments are
  needed. To run in manually, the superuser can simply type
<div class="Pp"></div>
&#x00A0;&#x00A0;&#x00A0;ipsec pluto
<div class="Pp"></div>
The command will immediately return, but a <b>pluto</b> process will be left
  running, waiting for requests from <b>whack</b> or a peer.
<div class="Pp"></div>
Using <b>whack</b>, several potential connections would be described:
<div class="Pp"></div>
&#x00A0;&#x00A0;&#x00A0;ipsec whack --name&#x00A0;silly --host&#x00A0;127.0.0.1
  --to --host&#x00A0;127.0.0.2 --ikelifetime&#x00A0;900
  --ipseclifetime&#x00A0;800 --keyingtries&#x00A0;3
<div class="Pp"></div>
Since this silly connection description specifies neither encryption,
  authentication, nor tunneling, it could only be used to establish an ISAKMP
  SA.
<div class="Pp"></div>
&#x00A0;&#x00A0;&#x00A0;ipsec whack --name&#x00A0;conn_name
  --host&#x00A0;10.0.0.1 --client&#x00A0;10.0.1.0/24 --to --host&#x00A0;10.0.0.2
  --client&#x00A0;10.0.2.0/24 --encrypt
<div class="Pp"></div>
This is something that must be done on both sides. If the other side is
  <b>pluto</b>, the same <b>whack</b> command could be used on it (the command
  syntax is designed to not distinguish which end is ours).
<div class="Pp"></div>
Now that the connections are specified, <b>pluto</b> is ready to handle requests
  and replies via the public interfaces. We must tell it to discover those
  interfaces and start accepting messages from peers:
<div class="Pp"></div>
&#x00A0;&#x00A0;&#x00A0;ipsec whack --listen
<div class="Pp"></div>
If we don't immediately wish to bring up a secure connection between the two
  clients, we might wish to prevent insecure traffic. The routing form asks
  <b>pluto</b> to cause the packets sent from our client to the peer's client to
  be routed through the ipsec0 device; if there is no SA, they will be
  discarded:
<div class="Pp"></div>
&#x00A0;&#x00A0;&#x00A0;ipsec whack --route conn_name
<div class="Pp"></div>
Finally, we are ready to get <b>pluto</b> to initiate negotiation for an IPsec
  SA (and implicitly, an ISAKMP SA):
<div class="Pp"></div>
&#x00A0;&#x00A0;&#x00A0;ipsec whack --initiate&#x00A0;--name&#x00A0;conn_name
<div class="Pp"></div>
A small log of interesting events will appear on standard output (other logging
  is sent to syslog).
<div class="Pp"></div>
<b>whack</b> can also be used to terminate <b>pluto</b> cleanly, tearing down
  all SAs that it has negotiated.
<div class="Pp"></div>
&#x00A0;&#x00A0;&#x00A0;ipsec whack --shutdown
<div class="Pp"></div>
Notification of any IPSEC SA deletion, but not ISAKMP SA deletion is sent to the
  peer. Unfortunately, such Notification is not reliable. Furthermore,
  <b>pluto</b> itself ignores Notifications.
<h2 class="Ss" title="Ss" id="XAUTH"><a class="selflink" href="#XAUTH">XAUTH</a></h2>
If <b>pluto</b> needs additional authentication, such as defined by the XAUTH
  specifications, then it may ask <b>whack</b> to prompt the operator for
  username or passwords. Typically, these will be entered interactively. A GUI
  that wraps around <b>whack</b> may look for the 041 (username) or 040
  (password) prompts, and display them to the user.
<div class="Pp"></div>
For testing purposes, the options
  <b>--xauthuser&#x00A0;</b><i>user</i><b>--xauthpass&#x00A0;</b> <i>pass</i>
  may be be given prior to the <b>--initiate&#x00A0;</b> to provide responses to
  the username and password prompts.
<h2 class="Ss" title="Ss" id="The_updown_command"><a class="selflink" href="#The_updown_command">The
  updown command</a></h2>
Whenever <b>pluto</b> brings a connection up or down, it invokes the updown
  command. This command is specified using the <b>--updown</b> option. This
  allows for customized control over routing and firewall manipulation.
<div class="Pp"></div>
The updown is invoked for five different operations. Each of these operations
  can be for our client subnet or for our host itself.
<div class="Pp"></div>
<b>prepare-host</b> or <b>prepare-client</b>
<div style="margin-left: 4.00ex;">is run before bringing up a new connection if
  no other connection with the same clients is up. Generally, this is useful for
  deleting a route that might have been set up before <b>pluto</b> was run or
  perhaps by some agent not known to <b>pluto</b>.</div>
<div class="Pp"></div>
<b>route-host</b> or <b>route-client</b>
<div style="margin-left: 4.00ex;">is run when bringing up a connection for a new
  peer client subnet (even if <b>prepare-host</b> or <b>prepare-client</b> was
  run). The command should install a suitable route. Routing decisions are based
  only on the destination (peer's client) subnet address, unlike eroutes which
  discriminate based on source too.</div>
<div class="Pp"></div>
<b>unroute-host</b> or <b>unroute-client</b>
<div style="margin-left: 4.00ex;">is run when bringing down the last connection
  for a particular peer client subnet. It should undo what the <b>route-host</b>
  or <b>route-client</b> did.</div>
<div class="Pp"></div>
<b>up-host</b> or <b>up-client</b>
<div style="margin-left: 4.00ex;">is run when bringing up a tunnel eroute with a
  pair of client subnets that does not already have a tunnel eroute. This
  command should install firewall rules as appropriate. It is generally a good
  idea to allow IKE messages (UDP port 500) travel between the hosts.</div>
<div class="Pp"></div>
<b>down-host</b> or <b>down-client</b>
<div style="margin-left: 4.00ex;">is run when bringing down the eroute for a
  pair of client subnets. This command should delete firewall rules as
  appropriate. Note that there may remain some inbound IPsec SAs with these
  client subnets.</div>
<div class="Pp"></div>
The script is passed a large number of environment variables to specify what
  needs to be done.
<div class="Pp"></div>
<b>PLUTO_VERSION</b>
<div style="margin-left: 4.00ex;">indicates what version of this interface is
  being used. This document describes version 1.1. This is upwardly compatible
  with version 1.0.</div>
<div class="Pp"></div>
<b>PLUTO_VERB</b>
<div style="margin-left: 4.00ex;">specifies the name of the operation to be
  performed ( <b>prepare-host</b>,r <b>prepare-client</b>, <b>up-host</b>,
  <b>up-client</b>, <b>down-host</b>, or <b>down-client</b>). If the address
  family for security gateway to security gateway communications is IPv6, then a
  suffix of -v6 is added to the verb.</div>
<div class="Pp"></div>
<b>PLUTO_CONNECTION</b>
<div style="margin-left: 4.00ex;">is the name of the connection for which we are
  routing.</div>
<div class="Pp"></div>
<b>PLUTO_NEXT_HOP</b>
<div style="margin-left: 4.00ex;">is the next hop to which packets bound for the
  peer must be sent.</div>
<div class="Pp"></div>
<b>PLUTO_INTERFACE</b>
<div style="margin-left: 4.00ex;">is the name of the ipsec interface to be
  used.</div>
<div class="Pp"></div>
<b>PLUTO_ME</b>
<div style="margin-left: 4.00ex;">is the IP address of our host.</div>
<div class="Pp"></div>
<b>PLUTO_MY_CLIENT</b>
<div style="margin-left: 4.00ex;">is the IP address / count of our client
  subnet. If the client is just the host, this will be the host's own IP address
  / max (where max is 32 for IPv4 and 128 for IPv6).</div>
<div class="Pp"></div>
<b>PLUTO_MY_CLIENT_NET</b>
<div style="margin-left: 4.00ex;">is the IP address of our client net. If the
  client is just the host, this will be the host's own IP address.</div>
<div class="Pp"></div>
<b>PLUTO_MY_CLIENT_MASK</b>
<div style="margin-left: 4.00ex;">is the mask for our client net. If the client
  is just the host, this will be 255.255.255.255.</div>
<div class="Pp"></div>
<b>PLUTO_PEER</b>
<div style="margin-left: 4.00ex;">is the IP address of our peer.</div>
<div class="Pp"></div>
<b>PLUTO_PEER_CLIENT</b>
<div style="margin-left: 4.00ex;">is the IP address / count of the peer's client
  subnet. If the client is just the peer, this will be the peer's own IP address
  / max (where max is 32 for IPv4 and 128 for IPv6).</div>
<div class="Pp"></div>
<b>PLUTO_PEER_CLIENT_NET</b>
<div style="margin-left: 4.00ex;">is the IP address of the peer's client net. If
  the client is just the peer, this will be the peer's own IP address.</div>
<div class="Pp"></div>
<b>PLUTO_PEER_CLIENT_MASK</b>
<div style="margin-left: 4.00ex;">is the mask for the peer's client net. If the
  client is just the peer, this will be 255.255.255.255.</div>
<div class="Pp"></div>
<b>PLUTO_MY_PROTOCOL</b>
<div style="margin-left: 4.00ex;">lists the protocols allowed over this IPsec
  SA.</div>
<div class="Pp"></div>
<b>PLUTO_PEER_PROTOCOL</b>
<div style="margin-left: 4.00ex;">lists the protocols the peer allows over this
  IPsec SA.</div>
<div class="Pp"></div>
<b>PLUTO_MY_PORT</b>
<div style="margin-left: 4.00ex;">lists the ports allowed over this IPsec
  SA.</div>
<div class="Pp"></div>
<b>PLUTO_PEER_PORT</b>
<div style="margin-left: 4.00ex;">lists the ports the peer allows over this
  IPsec SA.</div>
<div class="Pp"></div>
<b>PLUTO_MY_ID</b>
<div style="margin-left: 4.00ex;">lists our id.</div>
<div class="Pp"></div>
<b>PLUTO_PEER_ID</b>
<div style="margin-left: 4.00ex;">Dlists our peer's id.</div>
<div class="Pp"></div>
<b>PLUTO_PEER_CA</b>
<div style="margin-left: 4.00ex;">lists the peer's CA.</div>
<div class="Pp"></div>
All output sent by the script to stderr or stdout is logged. The script should
  return an exit status of 0 if and only if it succeeds.
<div class="Pp"></div>
<b>Pluto</b> waits for the script to finish and will not do any other processing
  while it is waiting. The script may assume that <b>pluto</b> will not change
  anything while the script runs. The script should avoid doing anything that
  takes much time and it should not issue any command that requires processing
  by <b>pluto</b>. Either of these activities could be performed by a background
  subprocess of the script.
<h2 class="Ss" title="Ss" id="Rekeying"><a class="selflink" href="#Rekeying">Rekeying</a></h2>
When an SA that was initiated by <b>pluto</b> has only a bit of lifetime left,
  <b>pluto</b> will initiate the creation of a new SA. This applies to ISAKMP
  and IPsec SAs. The rekeying will be initiated when the SA's remaining lifetime
  is less than the rekeymargin plus a random percentage, between 0 and
  rekeyfuzz, of the rekeymargin.
<div class="Pp"></div>
Similarly, when an SA that was initiated by the peer has only a bit of lifetime
  left, <b>pluto</b> will try to initiate the creation of a replacement. To give
  preference to the initiator, this rekeying will only be initiated when the
  SA's remaining lifetime is half of rekeymargin. If rekeying is done by the
  responder, the roles will be reversed: the responder for the old SA will be
  the initiator for the replacement. The former initiator might also initiate
  rekeying, so there may be redundant SAs created. To avoid these complications,
  make sure that rekeymargin is generous.
<div class="Pp"></div>
One risk of having the former responder initiate is that perhaps none of its
  proposals is acceptable to the former initiator (they have not been used in a
  successful negotiation). To reduce the chances of this happening, and to
  prevent loss of security, the policy settings are taken from the old SA (this
  is the case even if the former initiator is initiating). These may be stricter
  than those of the connection.
<div class="Pp"></div>
<b>pluto</b> will not rekey an SA if that SA is not the most recent of its type
  (IPsec or ISAKMP) for its potential connection. This avoids creating redundant
  SAs.
<div class="Pp"></div>
The random component in the rekeying time (rekeyfuzz) is intended to make
  certain pathological patterns of rekeying unstable. If both sides decide to
  rekey at the same time, twice as many SAs as necessary are created. This could
  become a stable pattern without the randomness.
<div class="Pp"></div>
Another more important case occurs when a security gateway has SAs with many
  other security gateways. Each of these connections might need to be rekeyed at
  the same time. This would cause a high peek requirement for resources (network
  bandwidth, CPU time, entropy for random numbers). The rekeyfuzz can be used to
  stagger the rekeying times.
<div class="Pp"></div>
Once a new set of SAs has been negotiated, <b>pluto</b> will never send traffic
  on a superseded one. Traffic will be accepted on an old SA until it expires.
<h2 class="Ss" title="Ss" id="Selecting_a_Connection_When_Responding:_Road_Warrior_Support"><a class="selflink" href="#Selecting_a_Connection_When_Responding:_Road_Warrior_Support">Selecting
  a Connection When Responding: Road Warrior Support</a></h2>
When <b>pluto</b> receives an initial Main Mode message, it needs to decide
  which connection this message is for. It picks based solely on the source and
  destination IP addresses of the message. There might be several connections
  with suitable IP addresses, in which case one of them is arbitrarily chosen.
  (The ISAKMP SA proposal contained in the message could be taken into account,
  but it is not.)
<div class="Pp"></div>
The ISAKMP SA is negotiated before the parties pass further identifying
  information, so all ISAKMP SA characteristics specified in the connection
  description should be the same for every connection with the same two host IP
  addresses. At the moment, the only characteristic that might differ is
  authentication method.
<div class="Pp"></div>
Up to this point, all configuring has presumed that the IP addresses are known
  to all parties ahead of time. This will not work when either end is mobile (or
  assigned a dynamic IP address for other reasons). We call this situation
  &#x201C;Road Warrior&#x201D;. It is fairly tricky and has some important
  limitations, most of which are features of the IKE protocol.
<div class="Pp"></div>
Only the initiator may be mobile: the initiator may have an IP number unknown to
  the responder. When the responder doesn't recognize the IP address on the
  first Main Mode packet, it looks for a connection with itself as one end and
  <b>%any</b> as the other. If it cannot find one, it refuses to negotiate. If
  it does find one, it creates a temporary connection that is a duplicate except
  with the <b>%any</b> replaced by the source IP address from the packet; if
  there was no identity specified for the peer, the new IP address will be used.
<div class="Pp"></div>
When <b>pluto</b> is using one of these temporary connections and needs to find
  the preshared secret or RSA private key in <i>ipsec.secrets</i>, and and the
  connection specified no identity for the peer, <b>%any</b> is used as its
  identity. After all, the real IP address was apparently unknown to the
  configuration, so it is unreasonable to require that it be used in this table.
<div class="Pp"></div>
Part way into the Phase 1 (Main Mode) negotiation using one of these temporary
  connection descriptions, <b>pluto</b> will be receive an Identity Payload. At
  this point, <b>pluto</b> checks for a more appropriate connection, one with an
  identity for the peer that matches the payload but which would use the same
  keys so-far used for authentication. If it finds one, it will switch to using
  this better connection (or a temporary derived from this, if it has
  <b>%any</b> for the peer's IP address). It may even turn out that no
  connection matches the newly discovered identity, including the current
  connection; if so, <b>pluto</b> terminates negotiation.
<div class="Pp"></div>
Unfortunately, if preshared secret authentication is being used, the Identity
  Payload is encrypted using this secret, so the secret must be selected by the
  responder without knowing this payload. This limits there to being at most one
  preshared secret for all Road Warrior systems connecting to a host. RSA
  Signature authentications does not require that the responder know how to
  select the initiator's public key until after the initiator's Identity Payload
  is decoded (using the responder's private key, so that must be preselected).
<div class="Pp"></div>
When <b>pluto</b> is responding to a Quick Mode negotiation via one of these
  temporary connection descriptions, it may well find that the subnets specified
  by the initiator don't match those in the temporary connection description. If
  so, it will look for a connection with matching subnets, its own host address,
  a peer address of <b>%any</b> and matching identities. If it finds one, a new
  temporary connection is derived from this one and used for the Quick Mode
  negotiation of IPsec SAs. If it does not find one, <b>pluto</b> terminates
  negotiation.
<div class="Pp"></div>
Be sure to specify an appropriate nexthop for the responder to send a message to
  the initiator: <b>pluto</b> has no way of guessing it (if forwarding isn't
  required, use an explicit <b>%direct</b> as the nexthop and the IP address of
  the initiator will be filled in; the obsolete notation 0.0.0.0 is still
  accepted).
<div class="Pp"></div>
<b>pluto</b> has no special provision for the initiator side. The current
  (possibly dynamic) IP address and nexthop must be used in defining
  connections. These must be properly configured each time the initiator's IP
  address changes. <b>pluto</b> has no mechanism to do this automatically.
<div class="Pp"></div>
Although we call this Road Warrior Support, it could also be used to support
  encrypted connections with anonymous initiators. The responder's organization
  could announce the preshared secret that would be used with unrecognized
  initiators and let anyone connect. Of course the initiator's identity would
  not be authenticated.
<div class="Pp"></div>
If any Road Warrior connections are supported, <b>pluto</b> cannot reject an
  exchange initiated by an unknown host until it has determined that the secret
  is not shared or the signature is invalid. This must await the third Main Mode
  message from the initiator. If no Road Warrior connection is supported, the
  first message from an unknown source would be rejected. This has implications
  for ease of debugging configurations and for denial of service attacks.
<div class="Pp"></div>
Although a Road Warrior connection must be initiated by the mobile side, the
  other side can and will rekey using the temporary connection it has created.
  If the Road Warrior wishes to be able to disconnect, it is probably wise to
  set <b>--keyingtries</b> to 1 in the connection on the non-mobile side to
  prevent it trying to rekey the connection. Unfortunately, there is no
  mechanism to unroute the connection automatically.
<h2 class="Ss" title="Ss" id="Debugging"><a class="selflink" href="#Debugging">Debugging</a></h2>
<b>pluto</b> accepts several optional arguments, useful mostly for debugging.
  Except for <b>--interface</b>, each should appear at most once.
<div class="Pp"></div>
<b>--interface</b> <i>interfacename</i>
<div style="margin-left: 4.00ex;">specifies that the named real public network
  interface should be considered. The interface name specified should not be
  <b>ipsec</b> <i>N</i>. If the option doesn't appear, all interfaces are
  considered. To specify several interfaces, use the option once for each. One
  use of this option is to specify which interface should be used when two or
  more share the same IP address.</div>
<div class="Pp"></div>
<b>--ikeport</b> <i>port-number</i>
<div style="margin-left: 4.00ex;">changes the UDP port that <b>pluto</b> will
  use (default, specified by IANA: 500)</div>
<div class="Pp"></div>
<b>--ctlbase</b> <i>path</i>
<div style="margin-left: 4.00ex;">basename for control files. <i>path</i>.ctl is
  the socket through which <b>whack</b> communicates with <b>pluto</b>.
  <i>path</i>.pid is the lockfile to prevent multiple <b>pluto</b> instances.
  The default is /var/run/pluto/pluto).</div>
<div class="Pp"></div>
<b>--secretsfile</b> <i>file</i>
<div style="margin-left: 4.00ex;">specifies the file for authentication secrets
  (default: /etc/ipsec.secrets). This name is subject to
  &#x201C;globbing&#x201D; as in <b>sh</b>(1), so every file with a matching
  name is processed. Quoting is generally needed to prevent the shell from doing
  the globbing.</div>
<div class="Pp"></div>
<b>--adns</b> <i>path to adns</i>
<div style="margin-left: 4.00ex;">specifies where to find <b>pluto</b>'s helper
  program for asynchronous DNS lookup. <b>pluto</b> can be built to use
  <b>_pluto_adns</b>. By default, <b>pluto</b> will look for the program in
  <b>$IPSEC_DIR</b> (if that environment variable is defined) or, failing that,
  in the same directory as <b>pluto</b>.</div>
<div class="Pp"></div>
<b>--nofork</b>
<div style="margin-left: 4.00ex;">disable &#x201C;daemon fork&#x201D; (default
  is to fork). In addition, after the lock file and control socket are created,
  print the line &#x201C;Pluto initialized&#x201D; to standard out.</div>
<div class="Pp"></div>
<b>--uniqueids</b>
<div style="margin-left: 4.00ex;">if this option has been selected, whenever a
  new ISAKMP SA is established, any connection with the same Peer ID but a
  different Peer IP address is unoriented (causing all its SAs to be deleted).
  This helps clean up dangling SAs when a connection is lost and then regained
  at another IP address.</div>
<div class="Pp"></div>
<b>--force-busy</b>
<div style="margin-left: 4.00ex;">if this option has been selected, pluto will
  be forced to be &quot;busy&quot;. In this state, which happens when there is a
  Denial of Service attack, will force pluto to use cookies before accepting new
  incoming IKE packets. Cookies are send and required in ikev1 Aggressive Mode
  and in ikev2. This option is mostly used for testing purposes, but can be
  selected by paranoid administrators as well.</div>
<div class="Pp"></div>
<b>--stderrlog</b>
<div style="margin-left: 4.00ex;">log goes to standard out {default is to use
  <b>syslogd</b>(8))</div>
<div class="Pp"></div>
For example
<div class="Pp"></div>
pluto --secretsfile&#x00A0;ipsec.secrets --ctlbase&#x00A0;pluto.base
  --ikeport&#x00A0;8500 --nofork --use-nostack --stderrlog
<div style="margin-left: 4.00ex;"></div>
<div class="Pp"></div>
lets one test <b>pluto</b> without using the superuser account.
<div class="Pp"></div>
<b>pluto</b> is willing to produce a prodigious amount of debugging information.
  There are several classes of debugging output, and <b>pluto</b> may be
  directed to produce a selection of them. All lines of debugging output are
  prefixed with &#x201C;|&#x00A0;&#x201D; to distinguish them from error
  messages.
<div class="Pp"></div>
When <b>pluto</b> is invoked, it may be given arguments to specify which classes
  to output. The current options are:
<div class="Pp"></div>
<b>--debug-none</b>
<div style="margin-left: 4.00ex;">disable all debugging</div>
<div class="Pp"></div>
<b>--debug-all</b>
<div style="margin-left: 4.00ex;">enable all debugging</div>
<div class="Pp"></div>
<b>--debug-raw</b>
<div style="margin-left: 4.00ex;">show the raw bytes of messages</div>
<div class="Pp"></div>
<b>--debug-crypt</b>
<div style="margin-left: 4.00ex;">show the encryption and decryption of
  messages</div>
<div class="Pp"></div>
<b>--debug-parsing</b>
<div style="margin-left: 4.00ex;">show the structure of input messages</div>
<div class="Pp"></div>
<b>--debug-emitting</b>
<div style="margin-left: 4.00ex;">show the structure of output messages</div>
<div class="Pp"></div>
<b>--debug-control</b>
<div style="margin-left: 4.00ex;">show <b>pluto</b>'s decision making</div>
<div class="Pp"></div>
<b>--debug-controlmore</b>
<div style="margin-left: 4.00ex;">show even more detailed <b>pluto</b> decision
  making</div>
<div class="Pp"></div>
<b>--debug-lifecycle</b>
<div style="margin-left: 4.00ex;">[this option is temporary] log more detail of
  lifecycle of SAs</div>
<div class="Pp"></div>
<b>--debug-klips</b>
<div style="margin-left: 4.00ex;">show <b>pluto</b>'s interaction with
  <b>KLIPS</b></div>
<div class="Pp"></div>
<b>--debug-pfkey</b>
<div style="margin-left: 4.00ex;">show <b>pluto</b>'s <b>PFKEY</b>interface
  communication</div>
<div class="Pp"></div>
<b>--debug-dns</b>
<div style="margin-left: 4.00ex;">show <b>pluto</b>'s interaction with
  <b>DNS</b> for KEY and TXT records</div>
<div class="Pp"></div>
<b>--debug-dpd</b>
<div style="margin-left: 4.00ex;">show <b>pluto</b>'s <b>Dead Peer Detection</b>
  handling</div>
<div class="Pp"></div>
<b>--debug-natt</b>
<div style="margin-left: 4.00ex;">show <b>pluto</b>'s <b>NAT Traversal</b>
  handling</div>
<div class="Pp"></div>
<b>--debug-oppo</b>
<div style="margin-left: 4.00ex;">show why <b>pluto</b> didn't find a suitable
  DNS TXT record to authorize opportunistic initiation</div>
<div class="Pp"></div>
<b>--debug-oppoinfo</b>
<div style="margin-left: 4.00ex;">log when connections are initiated due to
  acquires from the kernel. This is often useful to know, but can be extremely
  chatty on a busy system.</div>
<div class="Pp"></div>
<b>--debug-whackwatch</b>
<div style="margin-left: 4.00ex;">if set, causes pluto not to release the whack
  --initiate channel until the SA is completely up. This will cause the
  requestor to possibly wait forever while pluto unsuccessfully negotiates. Used
  often in test cases.</div>
<div class="Pp"></div>
<b>--debug-private</b>
<div style="margin-left: 4.00ex;">allow debugging output with private
  keys.</div>
<div class="Pp"></div>
The debug form of the <b>whack</b> command will change the selection in a
  running <b>pluto</b>. If a connection name is specified, the flags are added
  whenever <b>pluto</b> has identified that it is dealing with that connection.
  Unfortunately, this is often part way into the operation being observed.
<div class="Pp"></div>
For example, to start a <b>pluto</b> with a display of the structure of input
  and output:
<div class="Pp"></div>
pluto --debug-emitting --debug-parsing
<div class="Pp"></div>
To later change this <b>pluto</b> to only display raw bytes:
<div class="Pp"></div>
whack --debug-raw
<div class="Pp"></div>
Hint: ISAKMP SAs are often kept alive by IKEs even after the IPsec SA is
  established. This allows future IPsec SA's to be negotiated directly. If one
  of the IKEs is restarted, the other may try to use the ISAKMP SA but the new
  IKE won't know about it. This can lead to much confusion. <b>pluto</b> is not
  yet smart enough to get out of such a mess.
<h2 class="Ss" title="Ss" id="Pluto's_Behaviour_When_Things_Go_Wrong"><a class="selflink" href="#Pluto's_Behaviour_When_Things_Go_Wrong">Pluto's
  Behaviour When Things Go Wrong</a></h2>
When <b>pluto</b> doesn't understand or accept a message, it just ignores the
  message. It is not yet capable of communicating the problem to the other IKE
  daemon (in the future it might use Notifications to accomplish this in many
  cases). It does log a diagnostic.
<div class="Pp"></div>
When <b>pluto</b> gets no response from a message, it resends the same message
  (a message will be sent at most three times). This is appropriate: UDP is
  unreliable.
<div class="Pp"></div>
When pluto gets a message that it has already seen, there are many cases when it
  notices and discards it. This too is appropriate for UDP.
<div class="Pp"></div>
Combine these three rules, and you can explain many apparently mysterious
  behaviours. In a <b>pluto</b> log, retrying isn't usually the interesting
  event. The critical thing is either earlier ( <b>pluto</b> got a message which
  it didn't like and so ignored, so it was still awaiting an acceptable message
  and got impatient) or on the other system ( <b>pluto</b> didn't send a reply
  because it wasn't happy with the previous message).
<h2 class="Ss" title="Ss" id="Notes"><a class="selflink" href="#Notes">Notes</a></h2>
If <b>pluto</b> is compiled without -DKLIPS, it negotiates Security Associations
  but never ask the kernel to put them in place and never makes routing changes.
  This allows <b>pluto</b> to be tested on systems without <b>KLIPS</b>, but
  makes it rather useless.
<div class="Pp"></div>
Each IPsec SA is assigned an SPI, a 32-bit number used to refer to the SA. The
  IKE protocol lets the destination of the SA choose the SPI. The range 0 to
  0xFF is reserved for IANA. <b>Pluto</b> also avoids choosing an SPI in the
  range 0x100 to 0xFFF, leaving these SPIs free for manual keying. Remember that
  the peer, if not <b>pluto</b>, may well chose SPIs in this range.
<h2 class="Ss" title="Ss" id="Policies"><a class="selflink" href="#Policies">Policies</a></h2>
This catalogue of policies may be of use when trying to configure <b>Pluto</b>
  and another IKE implementation to interoperate.
<div class="Pp"></div>
In Phase 1, only Main Mode is supported. We are not sure that Aggressive Mode is
  secure. For one thing, it does not support identity protection. It may allow
  more severe Denial Of Service attacks.
<div class="Pp"></div>
No Informational Exchanges are supported. These are optional and since their
  delivery is not assured, they must not matter. It is the case that some IKE
  implementations won't interoperate without Informational Exchanges, but we
  feel they are broken.
<div class="Pp"></div>
No Informational Payloads are supported. These are optional, but useful. It is
  of concern that these payloads are not authenticated in Phase 1, nor in those
  Phase 2 messages authenticated with HASH(3).
<div class="Pp"></div>
&#x2022;
<div style="margin-left: 4.00ex;">Diffie Hellman Groups MODP 1024 and MODP 1536
  (2 and 5) are supported. Group MODP768 (1) is not supported because it is too
  weak.</div>
<div class="Pp"></div>
&#x2022;
<div style="margin-left: 4.00ex;">Host authentication can be done by RSA
  Signatures or Pre-Shared Secrets.</div>
<div class="Pp"></div>
&#x2022;
<div style="margin-left: 4.00ex;">3DES CBC (Cypher Block Chaining mode) is the
  only encryption supported, both for ISAKMP SAs and IPSEC SAs.</div>
<div class="Pp"></div>
&#x2022;
<div style="margin-left: 4.00ex;">MD5 and SHA1 hashing are supported for packet
  authentication in both kinds of SAs.</div>
<div class="Pp"></div>
&#x2022;
<div style="margin-left: 4.00ex;">The ESP, AH, or AH plus ESP are supported. If,
  and only if, AH and ESP are combined, the ESP need not have its own
  authentication component. The selection is controlled by the --encrypt and
  --authenticate flags.</div>
<div class="Pp"></div>
&#x2022;
<div style="margin-left: 4.00ex;">Each of these may be combined with IPCOMP
  Deflate compression, but only if the potential connection specifies
  compression and only if KLIPS is configured with IPCOMP support.</div>
<div class="Pp"></div>
&#x2022;
<div style="margin-left: 4.00ex;">The IPSEC SAs may be tunnel or transport mode,
  where appropriate. The --tunnel flag controls this when <b>pluto</b> is
  initiating.</div>
<div class="Pp"></div>
&#x2022;
<div style="margin-left: 4.00ex;">When responding to an ISAKMP SA proposal, the
  maximum acceptable lifetime is eight hours. The default is one hour. There is
  no minimum. The --ikelifetime flag controls this when <b>pluto</b> is
  initiating.</div>
<div class="Pp"></div>
&#x2022;
<div style="margin-left: 4.00ex;">When responding to an IPSEC SA proposal, the
  maximum acceptable lifetime is one day. The default is eight hours. There is
  no minimum. The --ipseclifetime flag controls this when <b>pluto</b> is
  initiating.</div>
<div class="Pp"></div>
&#x2022;
<div style="margin-left: 4.00ex;">PFS is acceptable, and will be proposed if the
  --pfs flag was specified. The DH group proposed will be the same as negotiated
  for Phase 1.</div>
<h1 class="Sh" title="Sh" id="SIGNALS"><a class="selflink" href="#SIGNALS">SIGNALS</a></h1>
<b>Pluto</b> responds to <b>SIGHUP</b> by issuing a suggestion that ``
  <b>whack</b> --listen'' might have been intended.
<div class="Pp"></div>
<b>Pluto</b> exits when it receives <b>SIGTERM</b>.
<h1 class="Sh" title="Sh" id="EXIT_STATUS"><a class="selflink" href="#EXIT_STATUS">EXIT
  STATUS</a></h1>
<b>pluto</b> normally forks a daemon process, so the exit status is normally a
  very preliminary result.
<div class="Pp"></div>
0
<div style="margin-left: 4.00ex;">means that all is OK so far.</div>
<div class="Pp"></div>
1
<div style="margin-left: 4.00ex;">means that something was wrong.</div>
<div class="Pp"></div>
10
<div style="margin-left: 4.00ex;">means that the lock file already exists.</div>
<div class="Pp"></div>
If <b>whack</b> detects a problem, it will return an exit status of 1. If it
  received progress messages from <b>pluto</b>, it returns as status the value
  of the numeric prefix from the last such message that was not a message sent
  to syslog or a comment (but the prefix for success is treated as 0).
  Otherwise, the exit status is 0.
<h1 class="Sh" title="Sh" id="FILES"><a class="selflink" href="#FILES">FILES</a></h1>
/var/run/pluto/pluto.pid/var/run/pluto/pluto.ctl/etc/ipsec.secrets/dev/urandom
<h1 class="Sh" title="Sh" id="ENVIRONMENT"><a class="selflink" href="#ENVIRONMENT">ENVIRONMENT</a></h1>
<i>IPSEC_EXECDIR</i><i>IPSECmyid</i><i>PLUTO_CORE_DIR</i>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
The rest of the Libreswan distribution, in particular <b>ipsec</b>(8).
<div class="Pp"></div>
<b>ipsec_auto</b>(8) is designed to make using <b>pluto</b> more pleasant. Use
  it!
<div class="Pp"></div>
<b>ipsec.secrets</b>(5) describes the format of the secrets file.
<div class="Pp"></div>
<b>ipsec_atoaddr</b>(3), part of the Libreswan distribution, describes the forms
  that IP addresses may take. <b>ipsec_atosubnet</b>(3), part of the Libreswan
  distribution, describes the forms that subnet specifications.
<div class="Pp"></div>
For more information on IPsec, the mailing list, and the relevant documents,
  see:
<div class="Pp"></div>
<i></i><b>https://datatracker.ietf.org/wg/ipsecme/charter/</b>
<div class="Pp"></div>
At the time of writing, the most relevant IETF RFCs are:
<div class="Pp"></div>
RFC5996 Internet Key Exchange Protocol Version 2 (IKEv2)
<div class="Pp"></div>
The Libreswan web site &lt;https://libreswan.org&gt; and the mailing lists
  described there.
<h1 class="Sh" title="Sh" id="HISTORY"><a class="selflink" href="#HISTORY">HISTORY</a></h1>
This code is released under the GPL terms. See the accompanying files COPYING
  and CREDITS.* for more details.
<div class="Pp"></div>
This software was originally written for the FreeS/WAN project &lt;
  <b>http://www.freeswan.org</b>&gt;, founded by John Gilmore and managed by
  Hugh Daniel. It was written by Angelos D. Keromytis
  (angelos@dsl.cis.upenn.edu), in May/June 1997, in Athens, Greece. Thanks go to
  John Ioannidis for his help.
<div class="Pp"></div>
FreeS/WAN's Pluto was developed/maintained from 2000-2004 by D. Hugh Redelmeier
  (hugh@mimosa.com), in Canada. The regulations of Greece and Canada allow the
  code to be freely redistributable.
<div class="Pp"></div>
Richard Guy Briggs &lt;rgb@conscoop.ottawa.on.ca&gt; was the main resource on
  KLIPS development
<div class="Pp"></div>
IKE version 2 was initially written by Michael Richardson, Antony Antony and
  Paul Wouters. It has since been extended by Avesh Agarwal, D. Hugh Redelmeier,
  Matt Rogers, Antony Antony and Paul Wouters.
<div class="Pp"></div>
From 2003 onwards, the code was developed and maintained by The Openswan Project
  by developers worldwide and distributed from The Netherland and Finland. Due
  to a lawsuit by Xelerance over the trademark, the project was forced to rename
  itself and the code to The Libreswan Project in 2012.
<div class="Pp"></div>
See further: the CHANGES/CREDITS files in the main directory and the doc/
  directory.
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
Please see &lt; <b>https://bugs.libreswan.org</b>&gt; for a list of currently
  known bugs and missing features.
<div class="Pp"></div>
Bugs should be reported to the &lt;swan-dev@lists.libreswan.org&gt; mailing
  list.
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
<b>Paul Wouters</b>
<div style="margin-left: 4.00ex;">placeholder to suppress warning</div>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">11/12/2016</td>
    <td class="foot-os">libreswan</td>
  </tr>
</table>
</body>
</html>
