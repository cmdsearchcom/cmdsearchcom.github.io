<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 19:12:33 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>ISNSADM(8) System Manager&rsquo;s Manual ISNSADM(8)</p>

<p style="margin-top: 1em">NAME <br>
isnsadm - iSNS client utility</p>

<p style="margin-top: 1em">SYNOPSIS <br>
isnsadm [options...] --register object...</p>

<p style="margin-top: 1em">isnsadm [...] --query
attr[=value]</p>

<p style="margin-top: 1em">isnsadm [...] --deregister
attr=value</p>

<p style="margin-top: 1em">isnsadm [...] --list type
attr=value</p>

<p style="margin-top: 1em">isnsadm [...] --dd-register
attr=value</p>

<p style="margin-top: 1em">isnsadm [...] --enroll
client-name attr=value</p>

<p style="margin-top: 1em">isnsadm [...] --edit-policy
attr=value</p>

<p style="margin-top: 1em">DESCRIPTION <br>
Isnsadm is a command line utility for interacting with an
iSNS server. It operates in one of several modes, which are
mutually exclusive. Currently, isnsadm supports
registra&acirc; <br>
tion, query, and deregistration.</p>

<p style="margin-top: 1em">OPTIONS <br>
By default, isnsadm will take most of its settings from the
configuration file /etc/isns/isnsadm.conf, with the
exception of the following options:</p>

<p style="margin-top: 1em">--config filename, -c filename
<br>
This option overrides the default configuration file.</p>

<p style="margin-top: 1em">--debug facility, -d facility
<br>
enables debugging. Valid facilities are</p>


<p style="margin-top: 1em">&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&not;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;
<br>
&acirc;socket &acirc; network send/receive &acirc; <br>
&acirc;auth &acirc; authentication and security related
information &acirc; <br>
&acirc;message &acirc; iSNS protocol layer &acirc; <br>
&acirc;state &acirc; database state &acirc; <br>
&acirc;scn &acirc; SCN (state change notification) messages
&acirc; <br>
&acirc;esi &acirc; ESI (entity status inquiry) messages
&acirc; <br>
&acirc;all &acirc; all of the above &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acute;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;
<br>
--local <br>
makes isnsadm use a Local (aka Unix) socket when talking to
the iSNS server. This can be used by the administrator to
perform management tasks, such as enrolling new <br>
clients, editing access control and so on. Local mode is
only available to the super user.</p>

<p style="margin-top: 1em">--control <br>
makes isnsadm assume the identity of a control node. Control
nodes are special in that they have more rights in accessing
and modifying the database than normal storage <br>
nodes have.</p>

<p style="margin-top: 1em">When using this option, isnsadm
will use the source name and DSA key specified by the
Control.SourceName and Control.AuthKeyFile configuration
options, respectively.</p>

<p style="margin-top: 1em">--key attr=value <br>
This option is recognized in registration mode only, and
lets you specify an object key. For a more detailed
explanation, refer to section Registration mode.</p>

<p style="margin-top: 1em">--keyfile=filename <br>
When creating a policy for a new iSNS client, isnsadm is
able to generate a DSA key for the client. The public part
of the key is stored in a policy object in the iSNS <br>
server&rsquo;s database, whereas the private portion is
stored in the file specified by the keyfile option.</p>

<p style="margin-top: 1em">--help This will print a help
message and exit.</p>

<p style="margin-top: 1em">Built-in help <br>
Isnsadm has built-in help functions. When invoked with
--help, it will print a general help message showing all
supported command modes, and exit. Specific help on an
individual <br>
command mode is available by invoking that mode with a
single argument of help, like this:</p>

<p style="margin-top: 1em">isnsadm --register help</p>

<p style="margin-top: 1em">This will print a help message
describing how to use this command mode, followed by a list
of attributes this command supports and a help text
describing the attribute.</p>

<p style="margin-top: 1em">Supported attributes <br>
Most command modes take a list of attributes as arguments on
the command line. The naming and syntax of these attributes
as the same for all commands modes, however certain modes
<br>
support only a limited set of attributes.</p>

<p style="margin-top: 1em">Attributes are usually given as
name=value pairs. Where empty (or NIL) attributes are
supported, the attribute name by itself can be given.</p>

<p style="margin-top: 1em">The syntax of attribute value
depends on the attribute type. For strings and numeric
values, no special conventions apply, but bitfields have a
special syntax described below.</p>

<p style="margin-top: 1em">The attribute name is usually
preceded by the object type it applies to (such as entity),
followed by a hyphen and the name itself. However, where the
context clearly determines <br>
a specific object type, the prefix can be omitted. For
instance, when editing a policy object using --edit-policy,
it is acceptable to use node-type as shorthand for
policy-node- <br>
type.</p>

<p style="margin-top: 1em">Likewise, in a query command, it
is not permitted to mix attributes from different object
types. Thus, the first attribute of a query string
establishes a type context, so that <br>
the following two invocations are equivalent:</p>

<p style="margin-top: 1em">isnsadm --query
pg-name=iqn.com.foo pg-addr=10.1.1.1 pg-port=860/tcp <br>
isnsadm --query pg-name=iqn.com.foo addr=10.1.1.1
port=860/tcp</p>

<p style="margin-top: 1em">Isnsadm currently supports the
following attributes:</p>


<p style="margin-top: 1em">&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&not;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;
<br>
&acirc;Context &acirc; Attribute iSNS tag Aliases &acirc;
<br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;Network Entity &acirc; entity-id 1 eid &acirc; <br>
&acirc; &acirc; entity-prot 2 &acirc; <br>
&acirc; &acirc; entity-index 7 &acirc; <br>
&acirc;iSCSI Storage Node &acirc; iscsi-name 32 &acirc; <br>
&acirc; &acirc; iscsi-node-type 33 &acirc; <br>
&acirc; &acirc; iscsi-alias 34 &acirc; <br>
&acirc; &acirc; iscsi-idx 36 &acirc; <br>
&acirc; &acirc; iscsi-authmethod 42 &acirc; <br>
&acirc;Portal &acirc; portal-addr 16 &acirc; <br>
&acirc; &acirc; portal-port 17 &acirc; <br>
&acirc; &acirc; portal-name 18 &acirc; <br>
&acirc; &acirc; portal-esi-port 20 &acirc; <br>
&acirc; &acirc; portal-esi-interval 21 &acirc; <br>
&acirc; &acirc; portal-idx 22 &acirc; <br>
&acirc; &acirc; portal-scn-port 23 &acirc; <br>
&acirc;Portal Group &acirc; portal-group-index 52 &acirc;
<br>
&acirc; &acirc; pg-name 48 &acirc; <br>
&acirc; &acirc; pg-addr 49 &acirc; <br>
&acirc; &acirc; pg-port 50 &acirc; <br>
&acirc; &acirc; pg-tag 51 pgt &acirc; <br>
&acirc; &acirc; pg-idx 52 &acirc; <br>
&acirc;Discovery Domain &acirc; dd-id 2065 &acirc; <br>
&acirc; &acirc; dd-name 2066 &acirc; <br>
&acirc; &acirc; dd-member-iscsi-idx 2067 &acirc; <br>
&acirc; &acirc; dd-member-name 2068 &acirc; <br>
&acirc; &acirc; dd-member-fc-name 2069 &acirc; <br>
&acirc; &acirc; dd-member-portal-idx 2070 &acirc; <br>
&acirc; &acirc; dd-member-addr 2071 &acirc; <br>
&acirc; &acirc; dd-member-port 2072 &acirc; <br>
&acirc; &acirc; dd-features 2078 &acirc; <br>
&acirc;Policy Object &acirc; policy-name - spi &acirc; <br>
&acirc; &acirc; policy-key - &acirc; <br>
&acirc; &acirc; policy-entity - &acirc; <br>
&acirc; &acirc; policy-node-type - &acirc; <br>
&acirc; &acirc; policy-object-type - &acirc; <br>
&acirc; &acirc; policy-functions - &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acute;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;
<br>
Portal attributes <br>
Portal information is conveyed by two separate attributes in
iSNS; an address attribute holding the IP address, and a
TCP/UDP port attribute holding the port number and an
indi&acirc; <br>
cation of the protocol to be used (TCP or UDP).</p>

<p style="margin-top: 1em">When parsing a TCP/UDP port,
Open-iSNS will expect a port number, optionally followed by
a slash and the protocol. Port names such as
&quot;iscsi-target&quot; are not supported.</p>

<p style="margin-top: 1em">As a convenience, isnsadm
supports a notation representing a portal as one
pseudo-attribute. Separating address and port by a colon.
Thus, the following two are equivalent, with <br>
the latter being the shorthand representation of the
former:</p>

<p style="margin-top: 1em">addr=&lt;address&gt;
port=&lt;port&gt;[/protocol].
portal=&lt;adress&gt;:port[/protocol]</p>

<p style="margin-top: 1em">This notation can be used in any
context where an addr/port attribute pair can appear, and
may be prefixed by a type name, as in pg-portal=....</p>

<p style="margin-top: 1em">When using literal IPv6
addresses, the address has to be surrounded by square
brackets, otherwise the embedded colons would create
ambiguity: portal=[2001:5c0:0:2::24]:860/tcp</p>

<p style="margin-top: 1em">Bitfield attributes <br>
Some iSNS attributes are words representing a bit field.
Isnsadm displays and parses these attributes in
human-readable form rather than using the numerical value.
The names of <br>
the bit values are displayed by built-in help facilities.
When specifying a bitfield attribute on the command line,
you can combine them using the plus (+) or comma (,)
charac&acirc; <br>
ter, like this:</p>

<p style="margin-top: 1em">node-type=control+initiator</p>

<p style="margin-top: 1em">Registration mode <br>
Registration mode is selected by using the --register
option, followed by a list of one or more objects to
register with the iSNS server. By default, this will create
a network <br>
entity for the client (if none exists), and place the new
objects inside it. Usually, you register all objects for a
network entity in one operation, rather than each one
sepa&acirc; <br>
rately.</p>

<p style="margin-top: 1em">Each object is specified as a
type, optionally followed by a comma-separated list of
attributes, such as this:</p>


<p style="margin-top: 1em">target=iqn.2005-01.org.open-iscsi.foo:disk1,alias=disk1</p>

<p style="margin-top: 1em">The following object types are
currently supported:</p>

<p style="margin-top: 1em">entity=name <br>
Tells the server to group all objects in the specified
Network Entity container object. Normally, the iSNS server
will automatically assign an entity name that is in line
<br>
with its policies, and there is no need to specify it
explicitly.</p>

<p style="margin-top: 1em">initiator[=name] <br>
This will register an iSCSI storage node of type initiator.
By default, the name is set to the iSNS source name.</p>

<p style="margin-top: 1em">This can be followed by any
number of iSCSI storage node attributes.</p>

<p style="margin-top: 1em">target[=name] <br>
This will register an iSCSI storage node of type target. By
default, the name is set to the iSNS source name.</p>

<p style="margin-top: 1em">This object accepts the same set
of attributes as initiator.</p>

<p style="margin-top: 1em">control[=name] <br>
This will register an iSCSI storage node of type control. By
default, the name is set to the iSNS source name. Only
management nodes should be registered as control <br>
nodes, as this gives a node complete control over the iSNS
database.</p>

<p style="margin-top: 1em">This object accepts the same set
of attributes as initiator.</p>

<p style="margin-top: 1em">portal=[address:port/proto] <br>
This will register a portal using the given address, port
and protocol triple. If the triple is omitted, isnsadm will
use the client host&rsquo;s IP address. If the portal is
<br>
preceded by an initiator registration (on the command line),
the port defaults to 860/tcp; if it is preceded by a target
registration, the port defaults to 3260/tcp. For <br>
multi-homed hosts, the choice of address is implementation
dependant.</p>

<p style="margin-top: 1em">This can be followed by any
number of portal attributes.</p>

<p style="margin-top: 1em">pg This will register a portal
group joining the preceding portal and node. Portal groups
can be used to describe the preferred portals for a given
node; please refer to RFC <br>
4711 for details.</p>

<p style="margin-top: 1em">This can be followed by any
number of portal group attributes. The attribute list must
specify a portal group tag (PGT) via the pgt attribute.</p>

<p style="margin-top: 1em">There are two additional command
line options of interest, which are used exclusively with
Registration mode. One is --replace. Normally, registration
mode will add new objects <br>
to the network entity associated with the client host. If
you specify --replace on the command line, the server will
wipe the network entity completely, and remove all portals
<br>
and storage nodes it contained. Then it will create a new
network entity, and place the portals and storage nodes
provided by the caller inside.</p>

<p style="margin-top: 1em">In addition, it is possible to
replace just parts of a network entity. This is achieved by
using the command line option --key to specify the object
that should be replaced.</p>

<p style="margin-top: 1em">For instance, assume a network
entity contains the portal 10.1.1.1:860, and the
client&rsquo;s network address changed to 10.2.7.7. Then the
following command will atomically update <br>
the database, replacing just the portal without touching the
registered storage nodes:</p>

<p style="margin-top: 1em">isnsadm --replace --key
portal=10.1.1.1:860 portal=10.2.7.7:860</p>

<p style="margin-top: 1em">The --key option recognizes only
a subset of the usual attributes:</p>


<p style="margin-top: 1em">&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&not;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;
<br>
&acirc;Object type &acirc; Syntax &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;Entity &acirc; eid=identifier &acirc; <br>
&acirc;Portal &acirc; portal=address:port &acirc; <br>
&acirc;iSCSI Node &acirc; iscsi-name=name &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acute;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;
<br>
To get a list of supported attributes, invoke isnsadm
--register help.</p>

<p style="margin-top: 1em">Query mode <br>
Query mode is selected by using the --query option. A query
consists of a list of attr=value pairs. All attributes must
belong to the same object type, i.e. queries that mix a <br>
Network Entity attribute with e.g. a Portal attribute will
be rejected.</p>

<p style="margin-top: 1em">It is also possible to specify
an attribute name without value (i.e. just attr), which will
will match any object that has such an attribute, regardless
of its value. This is <br>
useful when you want to query for all objects of a given
type.</p>

<p style="margin-top: 1em">To obtain a list of supported
attributes, invoke isnsadm --query help.</p>

<p style="margin-top: 1em">List Mode <br>
In this mode, isnsadm will display all objects of a given
type, optionally restricted to those matching certain
attribute values.</p>

<p style="margin-top: 1em">The arguments to list mode are a
type name, optionally followed by one or more attr=value
pairs. Only attributes pertaining to the given type are
permitted; for instance, if you <br>
specify a type name of portals, only portal attributes are
permitted.</p>

<p style="margin-top: 1em">Possible type names are:
entities, nodes, portals, dds, ddsets, portal-groups, and
policies.</p>

<p style="margin-top: 1em">Additional information is
available via isnsadm --list help.</p>

<p style="margin-top: 1em">Deregistration mode <br>
In this mode, you can deregister objects previously
registered. Only the node which registered an entity in the
first place is permitted to remove it, or any of its child
<br>
objects. (Control nodes are not bound by this
restriction).</p>

<p style="margin-top: 1em">In deregistration mode, the
argument list consists of a list of attr=value pairs.
Deregistration supports the same set of attributes as query
mode.</p>

<p style="margin-top: 1em">Discovery Domain Registration
<br>
This mode, allows to register a discovery domain or to add
new members to an existing discovery domain. Again,
attributes are specified as a list of attr=value pairs. Only
dis&acirc; <br>
covery domain attributes are recognized.</p>

<p style="margin-top: 1em">Note, in order to add members to
an existing domain, you must specify the domain&rsquo;s
numeric ID. The domain&rsquo;s symbolic name is not a valid
handle when referring to a discovery <br>
domain.</p>

<p style="margin-top: 1em">Client Enrollment <br>
This mode only works when the server recognizes the client
as having control node capabilities, which is possible in
two ways:</p>

<p style="margin-top: 1em">Invoke isnsadm --local as super
user on the host isnsd is running on. The --local options
tells it to communicate with the server through the local
control socket.</p>

<p style="margin-top: 1em">Invoke isnsadm --control, which
tells it to assume the identity of a control node. When
given this option, isnsadm will use the source name and DSA
key specified by the Con&acirc; <br>
trol.SourceName and Control.AuthKeyFile configuration
options, respectively. The server must be configured to
grant this identity control node status.</p>

<p style="margin-top: 1em">To enroll a client, use the
--enroll option, followed by the (source) name of the client
to enroll. This string will be used as the name of the
security policy the client will <br>
use to identify itself.</p>

<p style="margin-top: 1em">This is followed by a list of
attribute/value pairs, where the following set of attributes
is supported:</p>


<p style="margin-top: 1em">&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&not;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;
<br>
&acirc;Attribute &acirc; Description Aliases &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;name &acirc; Policy Name spi &acirc; <br>
&acirc;key &acirc; Client&rsquo;s DSA public key &acirc;
<br>
&acirc;entity &acirc; Assigned Entity Identifier &acirc;
<br>
&acirc;node-type &acirc; Permitted node type(s) &acirc; <br>
&acirc;node-name &acirc; Permitted node name(s) &acirc; <br>
&acirc;functions &acirc; Bitmap of permitted functions
&acirc; <br>
&acirc;object-type &acirc; Object access mask &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acute;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;
<br>
The key attribute is used to specify the DSA public key that
the server should use to authenticate messages from this
client. You can either provide a file name; in which case
<br>
isnsadm will try to read the PEM encoded public key from
that file. If no key attribute is given, or when using
key=gen, isnsadm will generate a DSA key. The private
portion of <br>
the newly generated key will be stored in the file specified
by --keyfile=filename.</p>

<p style="margin-top: 1em">The object-type attribute is
used to specify which object types the client is permitted
to access. This is a comma separated list of type:perm
pairs, where type can be any of <br>
entity, iscsi-node, portal, portal-group, dd, ddset, and
policy. The permissions can be either rw, or r.</p>

<p style="margin-top: 1em">The functions attribute can be
used to restrict which functions the client is permitted to
invoke. This is a bitfield, using the standard function
names from RFC 4171, such as <br>
DevAttrReg, DevAttrQry, etc.</p>

<p style="margin-top: 1em">For a description of the
open-isns security model and policies, please refer to the
isns_config(5) manual page.</p>

<p style="margin-top: 1em">Important note: In order to
generate a DSA key, you have to have a set of DSA parameters
installed. By default, isnsadm expects to find them in
/etc/isns/dsa.params. These <br>
parameters are created by calling isnsd --init once on the
server machine. Alternatively, you can use the following
command:</p>

<p style="margin-top: 1em">openssl dsaparam 1024 -out
/etc/isns/dsa.params</p>

<p style="margin-top: 1em">where 1024 is the chosen DSA key
size, in bits.</p>

<p style="margin-top: 1em">EXAMPLES <br>
If you want to use Open-iSNS in authenticated mode, you
first need to initialize the server&rsquo;s DSA key and DSA
parameters. This can be done conveniently by using</p>

<p style="margin-top: 1em">isnsd --init</p>

<p style="margin-top: 1em">This will create the
server&rsquo;s private and public key, and place them in
/etc/isns/auth_key and auth_key.pub, respectively.</p>

<p style="margin-top: 1em">The following command will
create a policy object for a node named isns.control , and
grant it control privileges:</p>

<p style="margin-top: 1em">isnsadm --local
--keyfile=control.key --enroll isns.control node-type=ALL
functions=ALL object-type=ALL</p>

<p style="margin-top: 1em">In the process of entrolling the
client, this will generate a DSA key pair, and place the
private key portion in the file control.key. This file must
be installed as <br>
/etc/isns/control.key on the host you wish to use as an iSNS
management station.</p>

<p style="margin-top: 1em">Next, you need to create a
storage node object for the management station:</p>

<p style="margin-top: 1em">isnsadm --local --register
control</p>

<p style="margin-top: 1em">On the management station, you
can then enroll additional hosts:</p>

<p style="margin-top: 1em">isnsadm --control
--keyfile=somehost.key --enroll
iqn.2005-01.org.open-iscsi.somehost
node-type=target+initiator</p>

<p style="margin-top: 1em">Again, this will generate a DSA
key pair and store the private key portion in auth_key. Note
the use of the --control option that tells isnsadm to use
the identity of the control <br>
node instead of the default key and source name.</p>

<p style="margin-top: 1em">You then need to copy
somehost.key to the client host and install it as
/etc/isns/auth_key. Likewise, the server&rsquo;s public key
(which resides in /etc/isns/auth_key.pub on the <br>
server) needs to be copied to the client machine, and placed
in /etc/isns/server_key.pub.</p>

<p style="margin-top: 1em">By default, when a client
registers a storage node (be it initiator or target) with
iSNS, the client will not be able to see any other storage
nodes. In order for targets to be <br>
visible to a given initiator, you need to create so-called
Discovery Domains (or DDs for short).</p>

<p style="margin-top: 1em">Currently, domain membership
operations require administrator privilege. Future
extensions may allow iSNS clients to add themselves to one
or more DDs upon registration.</p>

<p style="margin-top: 1em">To create a discovery domain,
and add nodes to it, you can use</p>

<p style="margin-top: 1em">isnsadm --control --dd-register
dd-name=mydomain member-name=iqn.org.bozo.client
iqn.org.bozo.jbod ...</p>

<p style="margin-top: 1em">In order to add members to an
existing DD, you have to specify the numeric domain ID -
using the DD name is not sufficient, unfortunately (this is
a requirement of the RFC, not <br>
an implementation issue):</p>

<p style="margin-top: 1em">isnsadm --control --dd-register
dd-id=42 member-name=iqn.com.foo member-name=iqn.com.bar</p>

<p style="margin-top: 1em">The DD ID can be obtained by
doing a query for the DD name:</p>

<p style="margin-top: 1em">isnsadm --control --query
dd-name=mydomain</p>

<p style="margin-top: 1em">In management mode, you can also
register and deregister nodes and portals manually, in case
you want to fix up an inconsisteny in the database. For
instance, this will register <br>
a node and portal on a host named client.bozo.org:</p>

<p style="margin-top: 1em">isnsadm --control --register
entity=client.bozo.org initiator=iqn.org.bozo.client
portal=191.168.7.1:860</p>

<p style="margin-top: 1em">Note that this registration
explicitly specifies the network entity in which to place
the new objects. If you omit this, the new objects will be
placed in an entity named CON&acirc; <br>
TROL, which is decidedly not what you want.</p>

<p style="margin-top: 1em">SEE ALSO <br>
RFC 4171, isnsd(8), isns_config(5).</p>

<p style="margin-top: 1em">AUTHORS <br>
Olaf Kirch &lt;olaf.kirch@oracle.com&gt;</p>

<p style="margin-top: 1em">11 May 2007 ISNSADM(8)</p>
<hr>
</body>
</html>
