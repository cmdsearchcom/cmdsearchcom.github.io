<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>pkispawn(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">pkispawn(8)</td>
    <td class="head-vol">PKI Instance Creation Utility</td>
    <td class="head-rtitle">pkispawn(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
pkispawn - Sets up an instance of Certificate Server.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
pkispawn -s &lt;subsystem&gt; -f &lt;config_file&gt; [-h] [-v] [-p
  &lt;prefix&gt;]
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
Sets up a Certificate Server subsystem (CA, KRA, OCSP, TKS, or TPS) in a Tomcat
  instance.
<dl class="Bl-tag">
  <dt class="It-tag"><b>Note:</b></dt>
  <dd class="It-tag">A 389 Directory Server instance must be configured and
      running before this script can be run. Certificate Server requires an
      internal directory database. The default configuration assumes a Directory
      Server instance running on the same machine on port 389. For more
      information on creating a Directory Server instance, see
      <b>setup-ds.pl(8).</b></dd>
</dl>
<div class="Pp"></div>
An instance can contain multiple subsystems, although it may contain at most one
  of each type of subsystem on a single machine. So, for example, an instance
  could contain CA and KRA subsystems, but not two CA subsystems. To create an
  instance with a CA and a KRA, simply run pkispawn twice, with values <i>-s
  CA</i> and <i>-s KRA</i> respectively.
<div class="Pp"></div>
The instances are created based on values for configuration parameters in the
  default configuration (/etc/pki/default.cfg) and the user-provided
  configuration file. The user-provided configuration file is read after the
  default configuration file, so any parameters defined in that file will
  override parameters in the default configuration file. In general, most users
  will store only those parameters which are different from the default
  configuration in their user-provided configuration file.
<div class="Pp"></div>
This configuration file contains parameters that are grouped into sections.
  These sections are stacked, so that parameters defined in earlier sections can
  be overwritten by parameters defined in later sections. The sections are read
  in the following order: [DEFAULT], [Tomcat], and the subsystem section ([CA],
  [KRA], [OCSP], [TKS], or [TPS]). This allows the ability to specify parameters
  to be shared by all subsystems in [DEFAULT] or [Tomcat], and system-specific
  customization.
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Note:</b></dt>
  <dd class="It-tag">Any non-password related parameter values in the
      configuration file that needs to contain a <b>%</b> character must be
      properly escaped. For example, a value of <b>foo%bar</b> would be
      specified as <b>foo%%bar</b> in the configuration file.</dd>
</dl>
<div class="Pp"></div>
At a minimum, the user-defined configuration file must provide some passwords
  needed for the install. An example configuration file is provided in the
  <b>EXAMPLES</b> section below. For more information on the default
  configuration file and the parameters it contains (and can be customized), see
  <b>pki_default.cfg(5).</b>
<div class="Pp"></div>
The <b>pkispawn</b> run creates several different installation files that can be
  referenced later, if need be:
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">* For Tomcat-based instances, a Tomcat instance is created
      at /var/lib/pki/&lt;pki_instance_name&gt;, where pki_instance_name is
      defined in the configuration file.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">* A log file of <b>pkispawn</b> operations is written to
      <i>/var/log/pki/pki-&lt;subsystem&gt;-spawn.&lt;timestamp&gt;.log</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">* A .p12 (PKCS #12) file containing a certificate for a
      subsystem administrator is stored in pki_client_dir.</dd>
</dl>
<div class="Pp"></div>
When the utility is done running, the CA can be accessed by pointing a browser
  to https://&lt;hostname&gt;:&lt;pki_https_port&gt;/. The agent pages can be
  accessed by importing the CA certificate and administrator certificate into
  the browser.
<div class="Pp"></div>
The Certificate Server instance can also be accessed using the <b>pki</b>
  command line interface. See <b>pki(1)</b>. For more extensive documentation on
  how to use Certificate Server features, see the Red Hat Certificate System
  Documentation at
  https://access.redhat.com/knowledge/docs/Red_Hat_Certificate_System/.
<div class="Pp"></div>
Instances created using <b>pkispawn</b> can be removed using <b>pkidestroy</b>.
  See <b>pkidestroy(8).</b>
<div class="Pp"></div>
<b>pkispawn</b> supersedes and combines the functionality of <b>pkicreate</b>
  and <b>pkisilent</b>, which were available in earlier releases of Certificate
  Server. It is now possible to completely create and configure the Certificate
  Server subsystem in a single step using <b>pkispawn</b>.
<dl class="Bl-tag">
  <dt class="It-tag"><b>Note:</b></dt>
  <dd class="It-tag">Previously, as an alternative to using <b>pkisilent</b> to
      perform a non-interactive batch configuration, a PKI instance could be
      interactively configured by a GUI-based configuration wizard via a Firefox
      browser. GUI-based configuration of a PKI instance is unavailable in this
      version of the product.</dd>
</dl>
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-s &lt;subsystem&gt;</b></dt>
  <dd class="It-tag">Specifies the subsystem to be installed and configured,
      where &lt;subsystem&gt; is CA, KRA, OCSP, TKS, or TPS.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-f &lt;config_file&gt;</b></dt>
  <dd class="It-tag">Specifies the path to the user-defined configuration file.
      This file contains differences between the default configuration and the
      custom configuration.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--precheck</b></dt>
  <dd class="It-tag">Execute pre-checks and exit.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-h, --help</b></dt>
  <dd class="It-tag">Prints additional help information.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-v</b></dt>
  <dd class="It-tag">Displays verbose information about the installation. This
      flag can be provided multiple times to increase verbosity. See <b>pkispawn
      -h</b> for details.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="SEPARATE_VERSUS_SHARED_INSTANCES"><a class="selflink" href="#SEPARATE_VERSUS_SHARED_INSTANCES">SEPARATE
  VERSUS SHARED INSTANCES</a></h1>
<h2 class="Ss" title="Ss" id="Separate_PKI_instances:"><a class="selflink" href="#Separate_PKI_instances:">Separate
  PKI instances:</a></h2>
<div class="Pp"></div>
As described above, this version of Certificate System continues to support
  separate PKI instances for all subsystems.
<div class="Pp"></div>
Separate PKI instances run as a single Java-based Apache Tomcat instance,
  contain a single PKI subsystem (CA, KRA, OCSP, TKS, or TPS), and must utilize
  unique ports if co-located on the same physical machine or virtual machine
  (VM).
<h2 class="Ss" title="Ss" id="Shared_PKI_instances:"><a class="selflink" href="#Shared_PKI_instances:">Shared
  PKI instances:</a></h2>
<div class="Pp"></div>
Additionally, this version of Certificate System introduces the notion of a
  shared PKI instance.
<div class="Pp"></div>
Shared PKI instances also run as a single Java-based Apache Tomcat instance, but
  may contain any combination of up to one of each type of PKI subsystem:
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
CA
TKS
CA, KRA
CA, OCSP
TKS, TPS
CA, KRA, TKS, TPS
CA, KRA, OCSP, TKS, TPS
etc.
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
Shared PKI instances allow all of their subsystems contained within that
  instance to share the same ports, and must utilize unique ports if more than
  one shared PKI instance is co-located on the same physical machine or VM.
<div class="Pp"></div>
Semantically, a shared PKI instance that contains a single PKI subsystem is
  identical to a separate PKI instance.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="INTERACTIVE_MODE"><a class="selflink" href="#INTERACTIVE_MODE">INTERACTIVE
  MODE</a></h1>
If no options are specified, pkispawn will provide an interactive menu to
  collect the parameters needed to install the Certificate Server instance. Note
  that only the most basic installation options are provided. This includes root
  CA, KRA, OCSP, TKS, and TPS connecting to an existing directory server. More
  advanced setups such as cloned subsystems, subordinate or externally signed
  CA, subsystems that connect to the directory server using LDAPS, and
  subsystems that are customized beyond the options described below require the
  use of a configuration file with the -f option.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
The interactive option is most useful for those users getting familiar with
  Certificate Server. The parameters collected are written to the installation
  file of the subsystem, which can be found at
  <b>/etc/sysconfig/pki/tomcat/&lt;instance
  name&gt;/&lt;subsystem&gt;/deployment.cfg.</b>
<div class="Pp"></div>
The following parameters are queried interactively during the installation
  process:
<div class="Pp"></div>
<b>Subsystem Type</b>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Subsystem (CA/KRA/OCSP/TKS/TPS):</i></dt>
  <dd class="It-tag">the type of subsystem to be installed. Prompted when the -s
      option is not specified. The default value chosen is CA.</dd>
</dl>
<div class="Pp"></div>
<b>Instance Specific Parameters</b>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Instance name:</i></dt>
  <dd class="It-tag">the name of the tomcat instance in which the subsystem is
      to be installed. The default value is pki-tomcat.
    <div>&#x00A0;</div>
     <b>Note:</b> Only one subsystem of a given type (CA, KRA, OCSP, TKS, TPS)
      can exist within a given instance.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>HTTP port:</i></dt>
  <dd class="It-tag">the HTTP port of the Tomcat instance. The default value is
      8080.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Secure HTTP port:</i></dt>
  <dd class="It-tag">the HTTPS port of the Tomcat instance. The default value is
      8443.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>AJP port:</i></dt>
  <dd class="It-tag">the AJP port of the Tomcat instance. The default value is
      8009.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Management port:</i></dt>
  <dd class="It-tag">the management port of the Tomcat instance. The default
      value is 8005.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Note:</b> When deploying a new subsystem into an
    existing instance, pkispawn will attempt to read the ports from
    <b>deployment.cfg</b> files stored for previously installed subsystems for
    this instance. If successful, the installer will not prompt for these
    ports.</dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
<b>Administrative User Parameters</b>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Username:</i></dt>
  <dd class="It-tag">the username of the administrator of this subsystem. The
      default value is &lt;ca/kra/ocsp/tks/tps&gt;admin.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Password:</i></dt>
  <dd class="It-tag">password for the administrator user.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Import certificate:</i></dt>
  <dd class="It-tag">An optional parameter that can be used to import an already
      available CA admin certificate into this instance.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Export certificate:</i></dt>
  <dd class="It-tag">setup the path where the admin certificate of this
      &lt;subsystem&gt; should be stored. The default value is
      $HOME/.dogtag/pki-tomcat/&lt;ca/kra/ocsp/tks/tps&gt;_admin.cert.</dd>
</dl>
<div class="Pp"></div>
<b>Directory Server Parameters</b>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Hostname:</i></dt>
  <dd class="It-tag">Hostname of the directory server instance. The default
      value is the hostname of the system.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Use a secure LDAPS connection?</i></dt>
  <dd class="It-tag">Answering yes to this question will cause prompts for
      <i>Secure LDAPS Port:</i> and <i>Directory Server CA certificate pem
      file:</i>. Answering no to this question will cause a prompt for <i>LDAP
      Port</i>. The initial default value for this question is no.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Secure LDAPS Port:</i></dt>
  <dd class="It-tag">Secure LDAPS port for the directory server instance. The
      default value is 636.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Directory Server CA certificate pem file:</i></dt>
  <dd class="It-tag">The fully-qualified path including the filename of the file
      which contains an exported copy of the Directory Server's CA certificate
      (e. g. - $HOME/dscacert.pem). This file must exist prior to
      <b>pkispawn</b> being able to utilize it. For details on creation of this
      file see the <b>EXAMPLES</b> section below entitled <b>Installing a CA
      connecting securely to a Directory Server via LDAPS.</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>LDAP Port:</i></dt>
  <dd class="It-tag">LDAP port for the directory server instance. The default
      value is 389.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Base DN:</i></dt>
  <dd class="It-tag">the Base DN to be used for the internal database for this
      subsystem. The default value is o=pki-tomcat-&lt;subsystem&gt;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Bind DN:</i></dt>
  <dd class="It-tag">the bind DN required to connect for the directory server.
      This user must have sufficient permissions to install the required schema
      and database. The default value is cn=Directory Manager.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Password:</i></dt>
  <dd class="It-tag">password for the bind DN.</dd>
</dl>
<div class="Pp"></div>
<b>Security Domain Parameters</b>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Name:</i></dt>
  <dd class="It-tag">the name of the security domain. Required only if
      installing a root CA. Default value: &lt;DNS domain name&gt; Security
      Domain.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Hostname:</i></dt>
  <dd class="It-tag">the hostname for the security domain CA. Required only for
      non-CA subsystems. The default value is the hostname of this system.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Secure HTTP port:</i></dt>
  <dd class="It-tag">the https port for the security domain. Required only for
      non-CA subsystems. The default value is 8443.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Username:</i></dt>
  <dd class="It-tag">the username of the security domain administrator of the
      CA. Required only for non-CA subsystems. The default value is
    caadmin.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Password:</i></dt>
  <dd class="It-tag">password for the security domain administrator. Required
      for all subsystems that are not root CAs.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="PRE-CHECK_MODE"><a class="selflink" href="#PRE-CHECK_MODE">PRE-CHECK
  MODE</a></h1>
This option is only available when pkispawn is invoked in a non-interactive
  mode. When the <b>--precheck</b> option is provided, a set of basic tests are
  performed to ensure that the parameters provided to pkispawn are valid and
  consistent.
<div style="height: 1.00em;">&#x00A0;</div>
pkispawn will then exit with an exit code of 0 on success, or 1 on failure. This
  mode can be used to perform basic tests prior to doing any actual installation
  of the Certificate Server instance.
<div style="height: 1.00em;">&#x00A0;</div>
Flags are available to disable specific tests. For instance, one might want to
  disable validation of the credentials for the internal database user if the
  directory server instance has not yet been created.
<div style="height: 1.00em;">&#x00A0;</div>
See <b> pki_default.cfg(5) </b> for more details about available flags.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
<h2 class="Ss" title="Ss" id="Installing_a_root_CA"><a class="selflink" href="#Installing_a_root_CA">Installing
  a root CA</a></h2>
<div class="Pp"></div>
To install a root CA in a new instance execute the following command:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><b>pkispawn -s CA -f myconfig.txt</b>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
where <i>myconfig.txt</i> contains the following text:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
Prior to running this command, a Directory Server instance should be created and
  running. This command assumes that the Directory Server instance is using its
  default configuration:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">* Installed on the local machine
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">* Listening on port 389
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">* The user is cn=Directory Manager, with the password
      specified in pki_ds_password
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
This invocation of <b>pkispawn</b> creates a Tomcat instance containing a CA
  running on the local machine with secure port 8443 and unsecure port 8080. To
  access this CA, simply point a browser to https://&lt;hostname&gt;:8443.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
The instance name (defined by pki_instance_name) is pki-tomcat, and it is
  located at <i>/var/lib/pki/pki-tomcat</i>. Logs for the instance are located
  at <i>/var/log/pki/pki-tomcat</i>, and an installation log is written to
  <i>/var/log/pki/pki-&lt;subsystem&gt;-spawn.&lt;timestamp&gt;.log</i>.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
A PKCS #12 file containing the administrator certificate is created in
  <i>$HOME/.dogtag/pki-tomcat</i>. This PKCS #12 file uses the password
  designated by pki_client_pkcs12_password in the configuration file.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
To access the agent pages, first import the CA certificate by accessing the CA
  End Entity Pages and clicking on the Retrieval Tab. Be sure to trust the CA
  certificate. Then, import the administrator certificate in the PKCS #12 file.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Installing_a_root_CA_using_ECC"><a class="selflink" href="#Installing_a_root_CA_using_ECC">Installing
  a root CA using ECC</a></h2>
<div class="Pp"></div>
To install a root CA in a new instance using ECC execute the following command:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><b>pkispawn -s CA -f myconfig.txt</b>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
where <i>myconfig.txt</i> contains the following text:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_admin_keysize=nistp256
pki_admin_key_type=ecc
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
pki_ssl_server_key_algorithm=SHA256withEC
pki_ssl_server_key_size=nistp256
pki_ssl_server_key_type=ecc
pki_subsystem_key_algorithm=SHA256withEC
pki_subsystem_key_size=nistp256
pki_subsystem_key_type=ecc
<div class="Pp"></div>
[CA]
pki_ca_signing_key_algorithm=SHA256withEC
pki_ca_signing_key_size=nistp256
pki_ca_signing_key_type=ecc
pki_ca_signing_signing_algorithm=SHA256withEC
pki_ocsp_signing_key_algorithm=SHA256withEC
pki_ocsp_signing_key_size=nistp256
pki_ocsp_signing_key_type=ecc
pki_ocsp_signing_signing_algorithm=SHA256withEC
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
In order to utilize ECC, the SSL Server and Subsystem key algorithm, key size,
  and key type should be changed from SHA256withRSA --&gt; SHA256withEC, 2048
  --&gt; nistp256, and rsa --&gt; ecc, respectively. To use an ECC admin key
  size and key type, the values should also be changed from 2048 --&gt;
  nistp256, and rsa --&gt; ecc.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
Additionally, for a CA subsystem, both the CA and OCSP Signing key algorithm,
  key size, key type, and signing algorithm should be changed from SHA256withRSA
  --&gt; SHA256withEC, 2048 --&gt; nistp256, rsa --&gt; ecc, and SHA256withRSA
  --&gt; SHA256withEC,respectively.
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Note:</b></dt>
  <dd class="It-tag">For all PKI subsystems including the CA, ECC is not
      supported for the corresponding Audit Signing parameters. Similarly, for
      KRA subsystems, ECC is not supported for either of the corresponding
      Storage or Transport parameters.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="Installing_a_KRA,_OCSP,_TKS,_or_TPS_in_a_shared_instance"><a class="selflink" href="#Installing_a_KRA,_OCSP,_TKS,_or_TPS_in_a_shared_instance">Installing
  a KRA, OCSP, TKS, or TPS in a shared instance</a></h2>
<div class="Pp"></div>
For this example, assume that a new CA instance has been installed by executing
  the following command:
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><b>pkispawn -s CA -f myconfig.txt</b></dd>
</dl>
<div class="Pp"></div>
where <i>myconfig.txt</i> contains the following text:
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
# Optionally keep client databases
pki_client_database_purge=False
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
To install a shared KRA in the same instance used by the CA execute
the following command:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>pkispawn -s KRA -f myconfig.txt</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
where  <i>myconfig.txt</i> contains the following text:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_database_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
pki_security_domain_password= <i>Secret123</i>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
To install a shared OCSP in the same instance used by the CA execute
the following command:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>pkispawn -s OCSP -f myconfig.txt</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
where  <i>myconfig.txt</i> contains the following text:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_database_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
pki_security_domain_password= <i>Secret123</i>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
To install a shared TKS in the same instance used by the CA execute
the following command:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>pkispawn -s TKS -f myconfig.txt</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
where  <i>myconfig.txt</i> contains the following text:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_database_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
pki_security_domain_password= <i>Secret123</i>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
To install a shared TPS in the same instance used by the CA execute
the following command:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>pkispawn -s TPS -f myconfig.txt</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
where  <i>myconfig.txt</i> contains the following text:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_database_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
pki_security_domain_password= <i>Secret123</i>
[TPS]
# Shared TPS instances optionally utilize their shared KRA
# for server-side keygen
pki_enable_server_side_keygen=True
pki_authdb_basedn= <i>dc=example,dc=com</i>
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Note:</b></dt>
  <dd class="It-tag">
    <pre>
For this particular example, the computed default values for a
PKI instance name including its ports, URLs, machine names, etc.
were utilized as defined in  <i>/etc/pki/default.cfg</i>.  Each
subsystem in this example will reside under the
<i>/var/lib/pki/pki-tomcat</i> instance housed within their own
<i>ca</i>, <i>kra</i>, <i>ocsp</i>, <i>tks</i>, and <i>tps</i>
subdirectories, utilizing the same default port values of
8080 (http), 8443 (https), 8009 (ajp), 8005 (tomcat), using the
same computed hostname and URL information, and sharing a single
common PKI Administrator Certificate.
<div class="Pp"></div>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
The  <b>pki_security_domain_password</b> is the admin password of the
CA installed in the same instance. This command should be run after
a CA is installed. This installs another subsystem within the same
instance using the certificate generated for the CA administrator
for the subsystem's administrator. This allows a user to access
both subsystems on the browser with a single administrator
certificate. To access the new subsystem's functionality, simply
point the browser to https://&lt;hostname&gt;:8443 and click the
relevant top-level links.
<div class="Pp"></div>
</pre>
<div class="Pp"></div>
<pre>
To install TPS in a shared instance the following section must be
added to  <i>myconfig.txt</i>:
<div class="Pp"></div>
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[TPS]
pki_authdb_basedn= <i>dc=example,dc=com</i>
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
TPS requires an authentication database. The <b>pki_authdb_basedn</b> specifies
  the base DN of the authentication database.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
TPS also requires that a CA and a TKS subsystems are already installed in the
  same instance. Since they are in the same instance, a shared secret key will
  automatically be generated in TKS and imported into TPS.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
Optionally, server-side key generation can be enabled in TPS by adding the
  following parameter in [TPS]:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
pki_enable_server_side_keygen= <i>True</i>
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
Enabling server-side key generation requires that a KRA subsystem is already
  installed in the same instance.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Installing_a_KRA,_OCSP,_TKS,_or_TPS_in_a_separate_instance"><a class="selflink" href="#Installing_a_KRA,_OCSP,_TKS,_or_TPS_in_a_separate_instance">Installing
  a KRA, OCSP, TKS, or TPS in a separate instance</a></h2>
<div class="Pp"></div>
For this example, assume that a new CA instance has been installed by executing
  the following command:
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><b>pkispawn -s CA -f myconfig.txt</b></dd>
</dl>
<div class="Pp"></div>
where <i>myconfig.txt</i> contains the following text:
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
# Optionally keep client databases
pki_client_database_purge=False
# Separated CA instance name and ports
pki_instance_name= <i>pki-ca</i>
pki_http_port= <i>18080</i>
pki_https_port= <i>18443</i>
# This Separated CA instance will be its own security domain
pki_security_domain_https_port= <i>18443</i>
[Tomcat]
# Separated CA Tomcat ports
pki_ajp_port= <i>18009</i>
pki_tomcat_server_port= <i>18005</i>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
To install a separate KRA which connects to this remote CA execute
the following command:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>pkispawn -s KRA -f myconfig.txt</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
where  <i>myconfig.txt</i> contains the following text:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_database_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
pki_security_domain_password= <i>Secret123</i>
# Optionally keep client databases
pki_client_database_purge=False
# Separated KRA instance name and ports
pki_instance_name= <i>pki-kra</i>
pki_http_port= <i>28080</i>
pki_https_port= <i>28443</i>
# Separated KRA instance security domain references
pki_issuing_ca= <i>https://pki.example.com:18443</i>
pki_security_domain_hostname= <i>pki.example.com</i>
pki_security_domain_https_port= <i>18443</i>
pki_security_domain_user=caadmin
[Tomcat]
# Separated KRA Tomcat ports
pki_ajp_port= <i>28009</i>
pki_tomcat_server_port= <i>28005</i>
[KRA]
# A Separated KRA instance requires its own
# PKI Administrator Certificate
pki_import_admin_cert=False
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
To install a separate OCSP which connects to this remote CA execute
the following command:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>pkispawn -s OCSP -f myconfig.txt</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
where  <i>myconfig.txt</i> contains the following text:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_database_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
pki_security_domain_password= <i>Secret123</i>
# Optionally keep client databases
pki_client_database_purge=False
# Separated OCSP instance name and ports
pki_instance_name= <i>pki-ocsp</i>
pki_http_port= <i>29080</i>
pki_https_port= <i>29443</i>
# Separated OCSP instance security domain references
pki_issuing_ca= <i>https://pki.example.com:18443</i>
pki_security_domain_hostname= <i>pki.example.com</i>
pki_security_domain_https_port= <i>18443</i>
pki_security_domain_user=caadmin
[Tomcat]
# Separated OCSP Tomcat ports
pki_ajp_port= <i>29009</i>
pki_tomcat_server_port= <i>29005</i>
[OCSP]
# A Separated OCSP instance requires its own
# PKI Administrator Certificate
pki_import_admin_cert=False
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
To install a separate TKS which connects to this remote CA execute
the following command:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>pkispawn -s TKS -f myconfig.txt</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
where  <i>myconfig.txt</i> contains the following text:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_database_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
pki_security_domain_password= <i>Secret123</i>
# Optionally keep client databases
pki_client_database_purge=False
# Separated TKS instance name and ports
pki_instance_name= <i>pki-tks</i>
pki_http_port= <i>30080</i>
pki_https_port= <i>30443</i>
# Separated TKS instance security domain references
pki_issuing_ca= <i>https://pki.example.com:18443</i>
pki_security_domain_hostname= <i>pki.example.com</i>
pki_security_domain_https_port= <i>18443</i>
pki_security_domain_user=caadmin
[Tomcat]
# Separated TKS Tomcat ports
pki_ajp_port= <i>30009</i>
pki_tomcat_server_port= <i>30005</i>
[TKS]
# A Separated TKS instance requires its own
# PKI Administrator Certificate
pki_import_admin_cert=False
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
To install a separate TPS which connects to this remote CA execute
the following command:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>pkispawn -s TPS -f myconfig.txt</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
where  <i>myconfig.txt</i> contains the following text:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_database_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
pki_security_domain_password= <i>Secret123</i>
# Optionally keep client databases
pki_client_database_purge=False
# Separated TPS instance name and ports
pki_instance_name= <i>pki-tps</i>
pki_http_port= <i>31080</i>
pki_https_port= <i>31443</i>
# Separated TPS instance security domain references
pki_issuing_ca= <i>https://pki.example.com:18443</i>
pki_security_domain_hostname= <i>pki.example.com</i>
pki_security_domain_https_port= <i>18443</i>
pki_security_domain_user=caadmin
[Tomcat]
# Separated TPS Tomcat ports
pki_ajp_port= <i>31009</i>
pki_tomcat_server_port= <i>31005</i>
[TPS]
# Separated TPS instances require specifying a remote CA
pki_ca_uri= <i>https://pki.example.com:18443</i>
# Separated TPS instances optionally utilize a remote KRA
# for server-side keygen
pki_kra_uri= <i>https://pki.example.com:28443</i>
pki_enable_server_side_keygen=True
pki_authdb_basedn= <i>dc=example,dc=com</i>
# Separated TPS instances require specifying a remote TKS
pki_tks_uri= <i>https://pki.example.com:30443</i>
pki_import_shared_secret=True
# A Separated TPS instance requires its own
# PKI Administrator Certificate
pki_import_admin_cert=False
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Note:</b></dt>
  <dd class="It-tag">
    <pre>
For this particular example, besides passwords, sample
values were also utilized for PKI instance names, ports,
URLs, machine names, etc.  Under no circumstances should
these demonstrative values be construed to be required
literal values.
<div class="Pp"></div>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
A remote CA is one where the CA resides in another
Certificate Server instance, either on the local machine
or a remote machine.  In this case,  <i>myconfig.txt</i> must
specify the connection information for the remote CA and the
information about the security domain (the trusted collection
of subsystems within an instance).
<div class="Pp"></div>
</pre>
<div class="Pp"></div>
<pre>
The subsystem section is [KRA], [OCSP], [TKS], or [TPS].
This example assumes that the specified CA hosts the security
domain.  The CA must be running and accessible.
<div class="Pp"></div>
</pre>
<div class="Pp"></div>
<pre>
A new administrator certificate is generated for the new
subsystem and stored in a PKCS #12 file
in  <i>$HOME/.dogtag/&lt;pki_instance_name&gt;</i>.
<div class="Pp"></div>
</pre>
<div class="Pp"></div>
<pre>
As in a shared instance, to install TPS in a separate instance
the authentication database must be specified in the [TPS] section,
and optionally the server-side key generation can be enabled.
If the CA, KRA, or TKS subsystems required by TPS are running
on a remote instance the following parameters must be added into
the [TPS] section to specify their locations:
<div class="Pp"></div>
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
pki_ca_uri= <i>https://&lt;ca_hostname&gt;:&lt;ca_https_port&gt;</i>
pki_kra_uri= <i>https://&lt;kra_hostname&gt;:&lt;kra_https_port&gt;</i>
pki_tks_uri= <i>https://&lt;tks_hostname&gt;:&lt;tks_https_port&gt;</i>
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
If TPS and TKS are installed on separate instances the shared secret key should
  be imported over the wire between the TKS and TPS automatically.
<div style="height: 1.00em;">&#x00A0;</div>
If the automated procedure fails for any unlikely reason the following manual
  procedure will serve as a fallback. The key needs to be created on the TKS
  side and imported into the TPS side in this case.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
Generate the shared secret key (if needed) in TKS with the following command:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">tkstool -T -d /var/lib/pki/pki-tomcat/alias -n sharedSecret
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
Verify the shared secret key in TKS with the following command:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">tkstool -L -d /var/lib/pki/pki-tomcat/alias
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
Once TPS is installed, shutdown TPS instance, then import the shared secret key
  into TPS with the following command:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">tkstool -I -d /var/lib/pki/pki-tomcat/alias -n sharedSecret
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
Verify the shared secret key in TPS with the following command:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">tkstool -L -d /var/lib/pki/pki-tomcat/alias
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
The shared secret key nickname should be stored in the following property in the
  TPS's CS.cfg:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">conn.tks1.tksSharedSymKeyName=sharedSecret
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
Finally, restart the TPS instance.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Installing_a_CA,_KRA,_OCSP,_TKS,_or_TPS_using_a_Hardware_Security_Module_(HSM)"><a class="selflink" href="#Installing_a_CA,_KRA,_OCSP,_TKS,_or_TPS_using_a_Hardware_Security_Module_(HSM)">Installing
  a CA, KRA, OCSP, TKS, or TPS using a Hardware Security Module (HSM)</a></h2>
<div class="Pp"></div>
This section provides sample <b>myconfig.txt</b> files when an HSM is being
  utilized in a shared PKI instance.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
For this example, assume that a new CA instance has been installed by executing
  the following command:
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><b>pkispawn -s CA -f myconfig.txt</b></dd>
</dl>
<div class="Pp"></div>
where <i>myconfig.txt</i> contains the following text:
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
# Optionally keep client databases
pki_client_database_purge=False
# Provide HSM parameters
pki_hsm_enable=True
pki_hsm_libfile=&lt;hsm_libfile&gt;
pki_hsm_modulename=&lt;hsm_modulename&gt;
pki_token_name=&lt;hsm_token_name&gt;
pki_token_password=&lt;pki_token_password&gt;
# Provide PKI-specific HSM token names
pki_audit_signing_token=&lt;hsm_token_name&gt;
pki_ssl_server_token=&lt;hsm_token_name&gt;
pki_subsystem_token=&lt;hsm_token_name&gt;
[CA]
# Provide CA-specific HSM token names
pki_ca_signing_token=&lt;hsm_token_name&gt;
pki_ocsp_signing_token=&lt;hsm_token_name&gt;
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
To install a shared KRA in the same instance used by the CA execute
the following command:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>pkispawn -s KRA -f myconfig.txt</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
where  <i>myconfig.txt</i> contains the following text:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_database_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
pki_security_domain_password= <i>Secret123</i>
# Provide HSM parameters
pki_hsm_enable=True
pki_hsm_libfile=&lt;hsm_libfile&gt;
pki_hsm_modulename=&lt;hsm_modulename&gt;
pki_token_name=&lt;hsm_token_name&gt;
pki_token_password=&lt;pki_token_password&gt;
# Provide PKI-specific HSM token names
pki_audit_signing_token=&lt;hsm_token_name&gt;
pki_ssl_server_token=&lt;hsm_token_name&gt;
pki_subsystem_token=&lt;hsm_token_name&gt;
[KRA]
# Provide KRA-specific HSM token names
pki_storage_token=&lt;hsm_token_name&gt;
pki_transport_token=&lt;hsm_token_name&gt;
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
To install a shared OCSP in the same instance used by the CA execute
the following command:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>pkispawn -s OCSP -f myconfig.txt</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
where  <i>myconfig.txt</i> contains the following text:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_database_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
pki_security_domain_password= <i>Secret123</i>
# Provide HSM parameters
pki_hsm_enable=True
pki_hsm_libfile=&lt;hsm_libfile&gt;
pki_hsm_modulename=&lt;hsm_modulename&gt;
pki_token_name=&lt;hsm_token_name&gt;
pki_token_password=&lt;pki_token_password&gt;
# Provide PKI-specific HSM token names
pki_audit_signing_token=&lt;hsm_token_name&gt;
pki_ssl_server_token=&lt;hsm_token_name&gt;
pki_subsystem_token=&lt;hsm_token_name&gt;
[OCSP]
# Provide OCSP-specific HSM token names
pki_ocsp_signing_token=&lt;hsm_token_name&gt;
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
To install a shared TKS in the same instance used by the CA execute
the following command:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>pkispawn -s TKS -f myconfig.txt</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
where  <i>myconfig.txt</i> contains the following text:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_database_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
pki_security_domain_password= <i>Secret123</i>
# Provide HSM parameters
pki_hsm_enable=True
pki_hsm_libfile=&lt;hsm_libfile&gt;
pki_hsm_modulename=&lt;hsm_modulename&gt;
pki_token_name=&lt;hsm_token_name&gt;
pki_token_password=&lt;pki_token_password&gt;
# Provide PKI-specific HSM token names
pki_audit_signing_token=&lt;hsm_token_name&gt;
pki_ssl_server_token=&lt;hsm_token_name&gt;
pki_subsystem_token=&lt;hsm_token_name&gt;
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
To install a shared TPS in the same instance used by the CA execute
the following command:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>pkispawn -s TPS -f myconfig.txt</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
<pre>
where  <i>myconfig.txt</i> contains the following text:
</pre>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_database_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
pki_security_domain_password= <i>Secret123</i>
# Provide HSM parameters
pki_hsm_enable=True
pki_hsm_libfile=&lt;hsm_libfile&gt;
pki_hsm_modulename=&lt;hsm_modulename&gt;
pki_token_name=&lt;hsm_token_name&gt;
pki_token_password=&lt;pki_token_password&gt;
# Provide PKI-specific HSM token names
pki_audit_signing_token=&lt;hsm_token_name&gt;
pki_ssl_server_token=&lt;hsm_token_name&gt;
pki_subsystem_token=&lt;hsm_token_name&gt;
[TPS]
# Shared TPS instances optionally utilize their shared KRA
# for server-side keygen
pki_enable_server_side_keygen=True
pki_authdb_basedn= <i>dc=example,dc=com</i>
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Important:</b></dt>
  <dd class="It-tag">
    <pre>
Since HSM keys are stored in the HSM (hardware), they cannot be
backed up, moved, or copied to a PKCS #12 file (software).
For example, if  <b>pki_hsm_enable</b> is set to True,
<b>pki_backup_keys</b> should be set to False and
<b>pki_backup_password</b> should be left unset (the default
values in  <b>/etc/pki/default.cfg</b>).  Similarly, for the case
of clones using an HSM, this means that the HSM keys must be
shared between the master and its clones.  Therefore, if
<b>pki_hsm_enable</b> is set to True, both
<b>pki_clone_pkcs12_path</b> and <b>pki_clone_pkcs12_password</b>
should be left unset (the default values in
<b>/etc/pki/default.cfg</b>).  Failure to comply with these rules
will result in  <b>pkispawn</b> reporting an appropriate error and
exiting.
<div class="Pp"></div>
    </pre>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="Installing_a_CA_clone"><a class="selflink" href="#Installing_a_CA_clone">Installing
  a CA clone</a></h2>
<div class="Pp"></div>
To install a CA clone execute the following command:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><b>pkispawn -s CA -f myconfig.txt</b>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
where <i>myconfig.txt</i> contains the following text:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_database_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
pki_security_domain_password= <i>Secret123</i>
pki_security_domain_hostname=&lt;master_ca_hostname&gt;
pki_security_domain_https_port=&lt;master_ca_https_port&gt;
pki_security_domain_user=caadmin
<div class="Pp"></div>
[Tomcat]
pki_clone=True
pki_clone_pkcs12_password= <i>Secret123</i>
pki_clone_pkcs12_path=&lt;path_to_pkcs12_file&gt;
pki_clone_replicate_schema=True
pki_clone_uri=https://&lt;master_ca_hostname&gt;:&lt;master_ca_https_port&gt;
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
A cloned CA is a CA which uses the same signing, OCSP signing, and audit signing
  certificates as the master CA, but issues certificates within a different
  serial number range. It has its own internal database -- separate from the
  master CA database -- but using the same base DN, that keeps in sync with the
  master CA through replication agreements between the databases. This is very
  useful for load sharing and disaster recovery. To create a clone, the
  <i>myconfig.txt</i> uses pki_clone-* parameters in its [Tomcat] section which
  identify the original CA to use as a master template. Additionally, it
  connects to the master CA as a remote CA and uses its security domain.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
Before the clone can be generated, the Directory Server must be created that is
  separate from the master CA's Directory Server. The example assumes that the
  master CA and cloned CA are on different machines, and that their Directory
  Servers are on port 389.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
In addition, since this example does not utilize an HSM, the master's system
  certs and keys have been stored in a PKCS #12 file that is copied over to the
  clone subsystem in the location specified in &lt;path_to_pkcs12_file&gt;. This
  file needs to be readable by the user the Certificate Server runs as (by
  default, pkiuser) and be given the SELinux context pki_tomcat_cert_t.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
The master's system certificates can be exported to a PKCS#12 file when the
  master is installed if the parameter <b>pki_backup_keys</b> is set to
  <b>True</b> and the <b>pki_backup_password</b> is set. The PKCS#12 file is
  then found under <b>/var/lib/pki/&lt;instance_name&gt;/alias</b>.
  Alternatively, the PKCS#12 file can be generated at any time post-installation
  using <b>PKCS12Export</b>.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
An example invocation showing the export of the system certificates and keys,
  copying the keys to the replica subsystem, and setting the relevant SELinux
  and file permissions is shown below. <b>pwfile</b> is a text file containing
  the password for the master NSS DB (found in
  <b>/etc/pki/&lt;instance_name&gt;/password.conf</b>). <b>
  pkcs12_password_file</b> is a text file containing the password selected for
  the generated PKCS12 file.
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>master# PKCS12Export -d /etc/pki/pki-tomcat/alias -p pwfile \</b>
<b>        -w pkcs12_password_file -o backup_keys.p12</b>
<b>master# scp backup_keys.p12 clone:/backup_keys.p12</b>
<div class="Pp"></div>
<b>clone# chown pkiuser: /backup_keys.p12</b>
<b>clone# semanage -a -t pki_tomcat_cert_t /backup_keys.p12</b>
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
<b>Note:</b> From Dogtag 10.3, a slightly different mechanism has been provided
  to create and specify the required PKCS#12 file to the clone subsystem. This
  new method is provided in addition to the method above, but will become the
  preferred method in future releases.
<div style="height: 1.00em;">&#x00A0;</div>
This method can be used if both master and clone are 10.3 or above.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
To export the required keys from the master, use the <b>pki-server</b> command
  line tool.
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b></b>
<b>master# pki-server ca-clone-prepare -i pki-tomcat \</b>
<b>        --pkcs12-file backup_keys.p12 \</b>
<b>        --pkcs12-password Secret123</b>
<div class="Pp"></div>
<b>master# scp backup_keys.p12 clone:/backup_keys.p12</b>
<b>master# scp /etc/pki/pki-tomcat/external_certs.conf \</b>
<b>         clone:/external_certs.conf</b>
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
The <b>external_certs.conf</b> file contains information about third party
  certificates that were added to the master's certificate database using the
  <b>pki-server</b> command. The certificates themselves are stored in the
  backup_keys.p12 file. If there are no third-party certifcates that have been
  added, then the <b>external_certs.conf</b> file may not exist and should be
  ignored.
<div style="height: 1.00em;">&#x00A0;</div>
The two files ( <b>backup_keys.p12</b> and <b>external_certs.conf</b>) are
  specified to pkispawn as below.
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_database_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
pki_security_domain_password= <i>Secret123</i>
pki_security_domain_hostname=&lt;master_ca_hostname&gt;
pki_security_domain_https_port=&lt;master_ca_https_port&gt;
pki_security_domain_user=caadmin
<div class="Pp"></div>
[Tomcat]
pki_server_pkcs12_path=&lt;path to pkcs12 file&gt;
pki_server_pkcs12_password= <i>Secret123</i>
pki_server_external_certs_path=&lt;path to external_certs.conf file&gt;
pki_clone=True
pki_clone_replicate_schema=True
pki_clone_uri=https://&lt;master_ca_hostname&gt;:&lt;master_ca_https_port&gt;
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
Note that the previous p12 parameters (pki_clone_pkcs12_*) are no longer needed,
  and will be ignored.
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
Note: One current cloning anomaly to mention is the following scenario:
<div class="Pp"></div>
1. Create a clone of a CA or of any other subsystem.
2. Remove that just created clone.
3. Immediately attempt the exact same clone again, in place of
   the recently destroyed instance. Before recreating this clone,
   make sure the &quot;pki_ds_remove_data=True&quot; is used in the clone's
   deployment config file. This will remove the old data from the previous
   clone.
<div class="Pp"></div>
Here the Director Server instance may have worked itself in into a state
where it no longer accepts connections, aborting the clone configuration quickly.
<div class="Pp"></div>
The fix to this is to simply restart the Directory Server instance before
creating the clone for the second time. After restarting the Directory Server
it should be possible to create the mentioned clone instance.
</pre>
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Installing_a_KRA_or_TKS_clone"><a class="selflink" href="#Installing_a_KRA_or_TKS_clone">Installing
  a KRA or TKS clone</a></h2>
<div class="Pp"></div>
To install a KRA or TKS (OCSP and TPS unsupported as of now) execute the
  following command:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><b>pkispawn -s &lt;subsystem&gt; -f myconfig.txt</b>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
where subsystem is KRA or TKS and <i>myconfig.txt</i> contains the following
  text:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_database_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
pki_security_domain_password= <i>Secret123</i>
pki_security_domain_hostname=&lt;master_ca_hostname&gt;
pki_security_domain_https_port=&lt;master_ca_https_port&gt;
pki_security_domain_user=caadmin
<div class="Pp"></div>
[Tomcat]
pki_clone=True
pki_clone_pkcs12_password= <i>Secret123</i>
pki_clone_pkcs12_path=&lt;path_to_pkcs12_file&gt;
pki_clone_replicate_schema=True
pki_clone_uri=https://&lt;master_subsystem_host&gt;:&lt;master_subsystem_https_port&gt;
pki_issuing_ca=https://&lt;ca_hostname&gt;:&lt;ca_https_port&gt;
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
As with a CA clone, a KRA or TKS clone uses the same certificates and basic
  configuration as the original subsystem. The configuration points to the
  original subsystem to copy its configuration. This example also assumes that
  the CA is on a remote machine and specifies the CA and security domain
  information.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
The parameter <b>pki_clone_uri</b> should be modified to point to the required
  master (KRA or TKS).
<div style="height: 1.00em;">&#x00A0;</div>
As of 10.3, a slightly different mechanism has been introduced to generate and
  specify the PKCS#12 file and any third-party certificates. See the
  <b>Installing a CA clone</b> section for details.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Installing_a_CA_clone_on_the_same_host"><a class="selflink" href="#Installing_a_CA_clone_on_the_same_host">Installing
  a CA clone on the same host</a></h2>
<div class="Pp"></div>
For testing purposes, it is useful to configure cloned CAs which exist (with
  their internal databases) on the same host as the master CA. To configure the
  cloned CA execute the following command:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><b>pkispawn -s CA -f myconfig.txt</b>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
where <i>myconfig.txt</i> contains the following text:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password=Secret123
pki_client_database_password=Secret123
pki_client_pkcs12_password=Secret123
pki_ds_password=Secret123
pki_ds_ldap_port=&lt;unique port different from master&gt;
pki_ds_ldaps_port=&lt;unique port different from master&gt;
pki_http_port=&lt;unique port different from master&gt;
pki_https_port=&lt;unique port different from master&gt;
pki_instance_name=&lt;unique name different from master&gt;
pki_security_domain_hostname=&lt;master_ca_hostname&gt;
pki_security_domain_https_port=&lt;master_ca_https_port&gt;
pki_security_domain_password=Secret123
<div class="Pp"></div>
[Tomcat]
pki_ajp_port=&lt;unique port different from master&gt;
pki_clone=True
pki_clone_pkcs12_password=Secret123
pki_clone_pkcs12_path=&lt;path_to_pkcs12_file&gt;
pki_clone_uri=https://&lt;master_ca_hostname&gt;:&lt;master_ca_https_port&gt;
pki_tomcat_server_port=&lt;unique port different from master&gt;
<div class="Pp"></div>
[CA]
pki_ds_base_dn=&lt;identical value as master&gt;
pki_ds_database=&lt;identical value as master&gt;
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
In this case, because both CA Tomcat instances are on the same host, they must
  have distinct ports. Similarly, each CA must use a distinct directory server
  instance for its internal database. Like the Tomcat instances, these are
  distinguished by distinct ports. The suffix being replicated (
  <b>pki_ds_base</b>), however, must be the same for both master and clone.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Installing_a_subordinate_CA_in_existing_security_domain"><a class="selflink" href="#Installing_a_subordinate_CA_in_existing_security_domain">Installing
  a subordinate CA in existing security domain</a></h2>
<div class="Pp"></div>
To install a subordinate CA in an existing security domain execute the following
  command:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><b>pkispawn -s CA -f myconfig.txt</b>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
where <i>myconfig.txt</i> contains the following text:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_database_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
pki_security_domain_password= <i>Secret123</i>
pki_security_domain_hostname=&lt;security_domain_ca_hostname&gt;
pki_security_domain_https_port=&lt;security_domain_ca_https_port&gt;
pki_security_domain_user=caadmin
<div class="Pp"></div>
[CA]
pki_subordinate=True
pki_issuing_ca=https://&lt;master_ca_hostname&gt;:&lt;master_ca_https_port&gt;
pki_ca_signing_subject_dn=cn=CA Subordinate Signing,o=example.com
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
A sub-CA derives its certificate configuration -- such as allowed extensions and
  validity periods -- from a superior or root CA. Otherwise, the configuration
  of the CA is independent of the root CA, so it is its own instance rather than
  a clone. A sub-CA is configured using the pki_subordinate parameter and a
  pointer to the CA which issues the sub-CA's certificates.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>Note:</b> The value of <b>pki_ca_signing_subject_dn</b> of a subordinate CA
  should be different from the root CA's signing subject DN.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Installing_a_subordinate_CA_in_new_security_domain"><a class="selflink" href="#Installing_a_subordinate_CA_in_new_security_domain">Installing
  a subordinate CA in new security domain</a></h2>
<div class="Pp"></div>
To install a subordinate CA in a new security domain execute the following
  command:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><b>pkispawn -s CA -f myconfig.txt</b>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
where <i>myconfig.txt</i> contains the following text:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_database_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
pki_security_domain_password= <i>Secret123</i>
pki_security_domain_hostname=&lt;master CA security domain hostname&gt;
pki_security_domain_https_port=&lt;master CA security domain https port&gt;
pki_security_domain_user=caadmin
<div class="Pp"></div>
[CA]
pki_subordinate=True
pki_issuing_ca=https://&lt;master_ca_hostname&gt;:&lt;master_ca_https_port&gt;
pki_ca_signing_subject_dn= <i>cn=CA Subordinate Signing,o=example.com</i>
pki_subordinate_create_new_security_domain=True
pki_subordinate_security_domain_name= <i>Subordinate CA Security Domain</i>
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
In this section, the subordinate CA logs onto and registers with the security
  domain CA (using parameters <b>pki_security_domain_hostname</b>,
  <b>pki_security_domain_user</b> and <b>pki_security_domain_password</b>) as in
  the previous section, but also creates and hosts a new security domain. To do
  this, <b>pki_subordinate_create_new_security_domain</b> must be set to
  <b>True</b>. The subordinate CA security domain name can also be specified by
  specifying a value for <b>pki_subordinate_security_domain_name</b>.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>Note:</b> The value of <b>pki_ca_signing_subject_dn</b> of a subordinate CA
  should be different from the root CA's signing subject DN.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Installing_an_externally_signed_CA"><a class="selflink" href="#Installing_an_externally_signed_CA">Installing
  an externally signed CA</a></h2>
<div class="Pp"></div>
To install an externally signed CA execute the following command:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><b>pkispawn -s CA -f myconfig.txt</b>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
This is a two step process.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
In the first step, a certificate signing request (CSR) is generated for the
  signing certificate and <i>myconfig.txt</i> contains the following text:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_database_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
pki_security_domain_password= <i>Secret123</i>
<div class="Pp"></div>
[CA]
pki_external=True
pki_external_csr_path= <i>/tmp/ca_signing.csr</i>
pki_ca_signing_subject_dn= <i>cn=CA Signing,ou=External,o=example.com</i>
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
The CSR is written to pki_external_csr_path. The pki_ca_signing_subject_dn
  should be different from the subject DN of the external CA that is signing the
  request. The pki_ca_signing_subject_dn parameter can be used to specify the
  signing certificate's subject DN.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
The CSR is then submitted to the external CA, and the resulting certificate and
  certificate chain are saved to files on the system.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
In the second step, the configuration file has been modified to install the
  issued certificates. In place of the original CSR, the configuration file now
  points to the issued CA certificate and certificate chain. There is also a
  flag to indicate that this completes the installation process
  (pki_external_step_two).
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
[DEFAULT]
pki_admin_password= <i>Secret123</i>
pki_client_database_password= <i>Secret123</i>
pki_client_pkcs12_password= <i>Secret123</i>
pki_ds_password= <i>Secret123</i>
pki_security_domain_password= <i>Secret123</i>
<div class="Pp"></div>
[CA]
pki_external=True
pki_external_ca_cert_chain_path= <i>/tmp/ca_cert_chain.cert</i>
pki_external_ca_cert_path= <i>/tmp/ca_signing.cert</i>
pki_external_step_two=True
pki_ca_signing_subject_dn= <i>cn=CA Signing Certificate,ou=External,o=example.com</i>
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
Then, the <b>pkispawn</b> command is run again:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><b>pkispawn -s CA -f myconfig.txt</b>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="Installing_a_PKI_subsystem_with_a_secure_LDAP_connection"><a class="selflink" href="#Installing_a_PKI_subsystem_with_a_secure_LDAP_connection">Installing
  a PKI subsystem with a secure LDAP connection</a></h2>
<div class="Pp"></div>
There are three scenarios in which a PKI subsystem (e.g. a CA) needs to
  communicate securely via LDAPS with a directory server:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">* A directory server exists which is already running LDAPS
      using a CA certificate that has been issued by some other CA. For this
      scenario, the CA certificate must be made available via a PEM file (e.g.
      $HOME/dscacert.pem) prior to running <b>pkispawn</b> such that the new CA
      may be installed and configured to communicate with this directory server
      using LDAPS.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">* A directory server exists which is currently running
      LDAP. Once a CA has been created, there is a desire to use its CA
      certificate to issue an SSL certificate for this directory server so that
      this CA and this directory server can communicate via LDAPS. For this
      scenario, since there is no need to communicate securely during the
      <b>pkispawn</b> installation/configuration, simply use <b>pkispawn</b> to
      install and configure the CA using the LDAP port of the directory server,
      issue an SSL certificate from this CA for the directory server, and then
      reconfigure the CA and directory server to communicate with each other via
      LDAPS.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">* Similar to the previous scenario, a directory server
      exists which is currently running LDAP, and the desire is to create a CA
      and use it to establish LDAPS communications between this CA and this
      directory server. However, for this scenario, there is a need for the CA
      and the directory server to communicate securely during <b>pkispawn</b>
      installation and configuration. For this to succeed, the directory server
      must generate a temporary self-signed certificate which then must be made
      available via a PEM file (e.g. $HOME/dscacert.pem) prior to running
      <b>pkispawn</b>. Once the CA has been created, swap things out to
      reconfigure the CA and directory server to utilize LDAPS through the
      desired certificates.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
The following example demonstrates the steps to generate a temporary self-signed
  certificate in the Directory Server which requires an Admin Server. Directory
  Server and Admin Server instances can be created with the following command:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><b>setup-ds-admin.pl</b>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
Enable LDAPS in the Directory Server with the following command:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><b>/usr/sbin/setupssl2.sh
      /etc/dirsrv/</b><i>slapd-pki</i><b> 389 636 </b><i>Secret123</i><b></b>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
<b>Note:</b> The <b>setupssl2.sh</b> script may be downloaded from
  <b>https://raw.githubusercontent.com/richm/scripts/master/setupssl2.sh</b>.
<div style="height: 1.00em;">&#x00A0;</div>
Restart the Directory Server with the following command:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><b>systemctl restart dirsrv.target</b>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
Verify that a client can connect securely over LDAPS with the following command:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><b>/usr/lib64/mozldap/ldapsearch -Z -h
      </b><i>pki.example.com</i> <b> -p 636 -D 'cn=Directory Manager' -w
      </b><i>Secret123</i> <b> -b </b><i>&quot;dc=example, dc=com&quot;</i><b>
      &quot;objectclass=*&quot;</b> <i></i>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
<b>Note:</b> The <b>mozldap ldapsearch</b> utility is available from the
  <b>mozldap-tools</b> package.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
Export the self-signed CA certificate with the following command:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><b>certutil -L -d /etc/dirsrv/</b><i>slapd-pki</i><b> -n
      &quot;CA certificate&quot; -a &gt; </b> <i>$HOME/dscacert.pem</i><b></b>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
Once the self-signed CA certificate is obtained, add the following parameters
  into the [DEFAULT] section in <i>myconfig.txt</i>:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
pki_ds_secure_connection=True
pki_ds_secure_connection_ca_pem_file= <i>$HOME/dscacert.pem</i>
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
Then execute <b>pkispawn</b> to create the CA subsystem.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Managing_PKI_instance"><a class="selflink" href="#Managing_PKI_instance">Managing
  PKI instance</a></h2>
<div class="Pp"></div>
To start all 389 instances (local PKI databases):
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>systemctl start dirsrv.target</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
To stop all 389 instances (local PKI databases):
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>systemctl stop dirsrv.target</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
To restart all 389 instances (local PKI databases):
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>systemctl restart dirsrv.target</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
To obtain the status of all 389 instances (local PKI databases):
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>systemctl status dirsrv.target</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
To start a PKI instance named &lt;pki_instance_name&gt;:
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>systemctl start pki-tomcatd@&lt;pki_instance_name&gt;.service</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
To stop a PKI instance named &lt;pki_instance_name&gt;:
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>systemctl stop pki-tomcatd@&lt;pki_instance_name&gt;.service</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
To restart a PKI instance named &lt;pki_instance_name&gt;:
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>systemctl restart pki-tomcatd@&lt;pki_instance_name&gt;.service</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
To obtain the status of a PKI instance named &lt;pki_instance_name&gt;:
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>systemctl status pki-tomcatd@&lt;pki_instance_name&gt;.service</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
To obtain a detailed status of a Tomcat PKI instance named
  &lt;pki_instance_name&gt;:
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>pkidaemon status tomcat &lt;pki_instance_name&gt;</b>
    </pre>
  </dd>
</dl>
<div class="Pp"></div>
To obtain a detailed status of all Tomcat PKI instances:
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <pre>
<b>pkidaemon status tomcat</b>
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
Report bugs to http://bugzilla.redhat.com.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="AUTHORS"><a class="selflink" href="#AUTHORS">AUTHORS</a></h1>
Ade Lee &lt;alee@redhat.com&gt;. <b>pkispawn</b> was written by the Certificate
  Server project.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="COPYRIGHT"><a class="selflink" href="#COPYRIGHT">COPYRIGHT</a></h1>
Copyright (c) 2012 Red Hat, Inc. This is licensed under the GNU General Public
  License, version 2 (GPLv2). A copy of this license is available at
  http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>pkidestroy(8),</b> <b>pki_default.cfg(5),</b> <b>pki(1),</b>
  <b>setup-ds.pl(8)</b></div>
<table class="foot">
  <tr>
    <td class="foot-date">December 13, 2012</td>
    <td class="foot-os">version 1.0</td>
  </tr>
</table>
</body>
</html>
