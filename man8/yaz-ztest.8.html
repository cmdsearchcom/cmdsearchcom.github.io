<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 19:17:49 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>YAZ-ZTEST(8) System management commands YAZ-ZTEST(8)</p>

<p style="margin-top: 1em">NAME <br>
yaz-ztest - Z39.50/SRU Test Server</p>

<p style="margin-top: 1em">SYNOPSIS <br>
application [-install] [-installa] [-remove] [-a file] [-v
level] [-l file] [-u uid] [-c config] [-f vconfig] [-C
fname] [-t minutes] [-k kilobytes] [-K] [-d daemon] [-w dir]
<br>
[-p pidfile] [-r kilobytes] [-ziDSTV1]
[listener-spec...]</p>

<p style="margin-top: 1em">DESCRIPTION <br>
yaz-ztest is a Z39.50/SRU test server that uses the YAZ
generic frontend server (GFS) API. The server acts as a real
Z39.50/SRU server but does not use a database. It returns a
<br>
random hit count and returns a subset of a few built-in
records.</p>

<p style="margin-top: 1em">The listener-spec consists of a
transport mode followed by a colon, followed by a listener
address. The transport mode is either tcp, unix, or ssl.</p>

<p style="margin-top: 1em">For TCP and SSL, an address has
the form:</p>

<p style="margin-top: 1em">hostname | IP-number [ :
portnumber ]</p>

<p style="margin-top: 1em">For UNIX local socket, the
address is the filename of the local socket.</p>

<p style="margin-top: 1em">OPTIONS <br>
-a file <br>
Specify a file for dumping PDUs (for diagnostic purposes).
The special name - (dash) sends output to stderr.</p>

<p style="margin-top: 1em">-S <br>
Don&rsquo;t fork or make threads on connection requests.
This is good for debugging, but not recommended for real
operation: Although the server is asynchronous and
non-blocking, <br>
it can be nice to keep a software malfunction (okay then, a
crash) from affecting all current users.</p>

<p style="margin-top: 1em">-1 <br>
Like -S but after one session the server exits. This mode is
for debugging only.</p>

<p style="margin-top: 1em">-T <br>
Operate the server in threaded mode. The server creates a
thread for each connection rather than fork a process. Only
available on UNIX systems that offer POSIX threads.</p>

<p style="margin-top: 1em">-s <br>
Use the SR protocol (obsolete).</p>

<p style="margin-top: 1em">-z <br>
Use the Z39.50 protocol (default). This option and -s
complement each other. You can use both multiple times on
the same command line, between listener-specifications (see
<br>
below). This way, you can set up the server to listen for
connections in both protocols concurrently, on different
local ports.</p>

<p style="margin-top: 1em">-l file <br>
The logfile.</p>

<p style="margin-top: 1em">-c config <br>
A user option that serves as a specifier for some sort of
configuration, usually a filename. The argument to this
option is transferred to member configname of the <br>
statserv_options_block.</p>

<p style="margin-top: 1em">-f vconfig <br>
This specifies an XML file that describes one or more YAZ
frontend virtual servers.</p>

<p style="margin-top: 1em">-C fname <br>
Sets SSL certificate file name for server (PEM).</p>

<p style="margin-top: 1em">-v level <br>
The log level. Use a comma-separated list of members of the
set {fatal,debug,warn,log,malloc,all,none}.</p>

<p style="margin-top: 1em">-u uid <br>
Set user ID. Sets the real UID of the server process to that
of the given user. It&rsquo;s useful if you aren&rsquo;t
comfortable with having the server run as root, but you need
to <br>
start it as such to bind a privileged port.</p>

<p style="margin-top: 1em">-w dir <br>
The server changes to this directory before listening to
incoming connections. This option is useful when the server
is operating from the inetd daemon (see -i).</p>

<p style="margin-top: 1em">-p pidfile <br>
Specifies that the server should write its Process ID to the
file given by pidfile. A typical location would be
/var/run/yaz-ztest.pid.</p>

<p style="margin-top: 1em">-i <br>
Use this to make the the server run from the inetd server
(UNIX only).</p>

<p style="margin-top: 1em">-D <br>
Use this to make the server put itself in the background and
run as a daemon. If neither -i nor -D is given, the server
starts in the foreground.</p>

<p style="margin-top: 1em">-install <br>
Use this to install the server as an NT service (Windows
NT/2000/XP only). Control the server by going to the
Services in the Control Panel.</p>

<p style="margin-top: 1em">-installa <br>
Use this to install the server as an NT service and mark it
as &quot;auto-start. Control the server by going to the
Services in the Control Panel.</p>

<p style="margin-top: 1em">-remove <br>
Use this to remove the server from the NT services (Windows
NT/2000/XP only).</p>

<p style="margin-top: 1em">-t minutes <br>
Idle session timeout, in minutes.</p>

<p style="margin-top: 1em">-k size <br>
Maximum record size/message size, in kilobytes.</p>

<p style="margin-top: 1em">-K <br>
Forces no-keepalive for HTTP sessions. By default GFS will
keep sessions alive for HTTP 1.1 sessions (as defined by the
standard). Using this option will force GFS to close <br>
the connection for each operation.</p>

<p style="margin-top: 1em">-r size <br>
Maximum size of log file before rotation occurs, in
kilobytes. Default size is 1048576 k (=1 GB).</p>

<p style="margin-top: 1em">-d daemon <br>
Set name of daemon to be used in hosts access file. See
hosts_access(5) and tcpd(8).</p>

<p style="margin-top: 1em">-m time-format <br>
Sets the format of time-stamps in the log-file. Specify a
string in the input format to strftime().</p>

<p style="margin-top: 1em">-V <br>
Display YAZ version and exit.</p>

<p style="margin-top: 1em">TESTING <br>
yaz-ztest normally returns a random hit count between 0 and
24. However, if a query term includes leading digits, then
the integer value of that term is used as hit count. This
<br>
allows testers to return any number of hits. yaz-ztest
includes 24 MARC records for testing. Hit counts exceeding
24 will make yaz-ztest return the same record batch over and
<br>
over. So record at position 1, 25, 49, etc. are
equivalent.</p>

<p style="margin-top: 1em">For XML, if no element set is
given or element has value &quot;marcxml&quot;, MARCXML is
returned (each of the 24 dummy records converted from
ISO2709 to XML). For element set OP, then <br>
OPAC XML is returned.</p>

<p style="margin-top: 1em">yaz-ztest may also return
predefined XML records (for testing). This is enabled if
YAZ_ZTEST_XML_FETCH environment variable is defined. A
record is fetched from a file (one <br>
record per file). The path for the filename is FE.d.xml
where F is the YAZ_ZTEST_XML_FETCH value (possibly empty), E
is element-set, d is record position (starting from 1).</p>

<p style="margin-top: 1em">The following databases are
honored by yaz-ztest: Default, slow and db.* (all databases
with prefix &quot;db&quot;). Any other database will make
yaz-ztest return diagnostic 109: <br>
&quot;Database unavailable&quot;.</p>

<p style="margin-top: 1em">Options for search may be
included in the form or URL get arguments included as part
of the Z39.50 database name. The following database options
are present: search-delay, <br>
present-delay, fetch-delay and seed.</p>

<p style="margin-top: 1em">The former, delay type options,
specify a fake delay (sleep) that yaz-ztest will perform
when searching, presenting, fetching records respectively.
The value of the delay may <br>
either be a fixed floating point value which specifies the
delay in seconds. Alternatively the value may be given as
two floating point numbers separated by colon, which will
<br>
make yaz-ztest perform a random sleep between the first and
second number.</p>

<p style="margin-top: 1em">The database parameter seed
takes an integer as value. This will call srand with this
integer to ensure that the random behavior can be
re-played.</p>

<p style="margin-top: 1em">Suppose we want searches to take
between 0.1 and 0.5 seconds and a fetch to take 0.2 second.
To access test database Default we&rsquo;d use: <br>
Default?search-delay=0.1:0.5&amp;fetch-delay=0.2.</p>

<p style="margin-top: 1em">GFS CONFIGURATION AND VIRTUAL
HOSTS <br>
The Virtual hosts mechanism allows a YAZ frontend server to
support multiple backends. A backend is selected on the
basis of the TCP/IP binding (port+listening adddress) and/or
<br>
the virtual host.</p>

<p style="margin-top: 1em">A backend can be configured to
execute in a particular working directory. Or the YAZ
frontend may perform CQL to RPN conversion, thus allowing
traditional Z39.50 backends to be <br>
offered as a SRW/SRU service. SRW/SRU Explain information
for a particular backend may also be specified.</p>

<p style="margin-top: 1em">For the HTTP protocol, the
virtual host is specified in the Host header. For the Z39.50
protocol, the virtual host is specified as in the Initialize
Request in the OtherInfo, OID <br>
1.2.840.10003.10.1000.81.1.</p>

<p style="margin-top: 1em">Note <br>
Not all Z39.50 clients allow the VHOST information to be
set. For those, the selection of the backend must rely on
the TCP/IP information alone (port and address).</p>

<p style="margin-top: 1em">The YAZ frontend server uses XML
to describe the backend configurations. Command-line option
-f specifies filename of the XML configuration.</p>

<p style="margin-top: 1em">The configuration uses the root
element yazgfs. This element includes a list of listen
elements, followed by one or more server elements.</p>

<p style="margin-top: 1em">The listen describes listener
(transport end point), such as TCP/IP, Unix file socket or
SSL server. Content for a listener:</p>

<p style="margin-top: 1em">CDATA (required) <br>
The CDATA for the listen element holds the listener string,
such as tcp:@:210, tcp:server1:2100, etc.</p>

<p style="margin-top: 1em">attribute id (optional) <br>
Identifier for this listener. This may be referred to from
server sections.</p>

<p style="margin-top: 1em">Note <br>
We expect more information to be added for the listen
section in a future version, such as CERT file for SSL
servers.</p>

<p style="margin-top: 1em">The server describes a server
and the parameters for this server type. Content for a
server:</p>

<p style="margin-top: 1em">attribute id (optional) <br>
Identifier for this server. Currently not used for anything,
but it might be for logging purposes.</p>

<p style="margin-top: 1em">attribute listenref (optional)
<br>
Specifies one or more listeners for this server. Each server
ID is separated by a comma. If this attribute is not given,
the server is accessible from all listeners. In order <br>
for the server to be used for real, however, the virtual
host must match if specified in the configuration.</p>

<p style="margin-top: 1em">element config (optional) <br>
Specifies the server configuration. This is equivalent to
the config specified using command line option -c.</p>

<p style="margin-top: 1em">element directory (optional)
<br>
Specifies a working directory for this backend server. If
specified, the YAZ frontend changes current working
directory to this directory whenever a backend of this type
is <br>
started (backend handler bend_start), stopped (backend
handler hand_stop) and initialized (bend_init).</p>

<p style="margin-top: 1em">element host (optional) <br>
Specifies the virtual host for this server. If this is
specified a client must specify this host string in order to
use this backend.</p>

<p style="margin-top: 1em">element cql2rpn (optional) <br>
Specifies a filename that includes CQL to RPN conversion for
this backend server. See ???. If given, the backend server
will only &quot;see&quot; a Type-1/RPN query.</p>

<p style="margin-top: 1em">element ccl2rpn (optional) <br>
Specifies a filename that includes CCL to RPN conversion for
this backend server. See ???. If given, the backend server
will only &quot;see&quot; a Type-1/RPN query.</p>

<p style="margin-top: 1em">element stylesheet (optional)
<br>
Specifies the stylesheet reference to be part of SRU HTTP
responses when the client does not specify one. If none is
given, then if the client does not specify one, then no <br>
stylesheet reference is part of the SRU HTTP response.</p>

<p style="margin-top: 1em">element client_query_charset
(optional) <br>
If specified, a conversion from the character set given to
UTF-8 is performed by the generic frontend server. It is
only executed for Z39.50 search requests (SRU/Solr are <br>
assumed to be UTF-8 encoded already).</p>

<p style="margin-top: 1em">element docpath (optional) <br>
Specifies a path for local file access using HTTP. All URLs
with a leading prefix (/ excluded) that matches the value of
docpath are used for file access. For example, if the <br>
server is to offer access in directory xsl, the docpath
would be xsl and all URLs of the form http://host/xsl will
result in a local file access.</p>

<p style="margin-top: 1em">element explain (optional) <br>
Specifies SRW/SRU ZeeRex content for this server. Copied
verbatim to the client. As things are now, some of the
Explain content seem redundant because host information,
etc. <br>
is also stored elsewhere.</p>

<p style="margin-top: 1em">element maximumrecordsize
(optional) <br>
Specifies maximum record size/message size, in bytes. This
value also serves as the maximum size of incoming packages
(for Record Updates etc). It&rsquo;s the same value as that
<br>
given by the -k option.</p>

<p style="margin-top: 1em">element retrievalinfo (optional)
<br>
Enables the retrieval facility to support conversions and
specifications of record formats/types. See ??? for more
information.</p>

<p style="margin-top: 1em">The XML below configures a
server that accepts connections from two ports, TCP/IP port
9900 and a local UNIX file socket. We name the TCP/IP server
public and the other server <br>
internal.</p>

<p style="margin-top: 1em">&lt;yazgfs&gt; <br>
&lt;listen
id=&quot;public&quot;&gt;tcp:@:9900&lt;/listen&gt; <br>
&lt;listen
id=&quot;internal&quot;&gt;unix:/var/tmp/socket&lt;/listen&gt;
<br>
&lt;server id=&quot;server1&quot;&gt; <br>
&lt;host&gt;server1.mydomain&lt;/host&gt; <br>
&lt;directory&gt;/var/www/s1&lt;/directory&gt; <br>
&lt;config&gt;config.cfg&lt;/config&gt; <br>
&lt;/server&gt; <br>
&lt;server id=&quot;server2&quot;
listenref=&quot;public,internal&quot;&gt; <br>
&lt;host&gt;server2.mydomain&lt;/host&gt; <br>
&lt;directory&gt;/var/www/s2&lt;/directory&gt; <br>
&lt;config&gt;config.cfg&lt;/config&gt; <br>
&lt;cql2rpn&gt;../etc/pqf.properties&lt;/cql2rpn&gt; <br>
&lt;explain
xmlns=&quot;http://explain.z3950.org/dtd/2.0/&quot;&gt; <br>
&lt;serverInfo&gt; <br>
&lt;host&gt;server2.mydomain&lt;/host&gt; <br>
&lt;port&gt;9900&lt;/port&gt; <br>
&lt;database&gt;a&lt;/database&gt; <br>
&lt;/serverInfo&gt; <br>
&lt;/explain&gt; <br>
&lt;/server&gt; <br>
&lt;server id=&quot;server3&quot;
listenref=&quot;internal&quot;&gt; <br>
&lt;directory&gt;/var/www/s3&lt;/directory&gt; <br>
&lt;config&gt;config.cfg&lt;/config&gt; <br>
&lt;/server&gt; <br>
&lt;/yazgfs&gt;</p>

<p style="margin-top: 1em">There are three configured
backend servers. The first two servers, &quot;server1&quot;
and &quot;server2&quot;, can be reached by both listener
addresses. &quot;server1&quot; is reached by all (two) since
no <br>
listenref attribute is specified. &quot;server2&quot; is
reached by the two listeners specified. In order to
distinguish between the two, a virtual host has been
specified for each server <br>
in the host elements.</p>

<p style="margin-top: 1em">For &quot;server2&quot; elements
for CQL to RPN conversion is supported and explain
information has been added (a short one here to keep the
example small).</p>

<p style="margin-top: 1em">The third server,
&quot;server3&quot; can only be reached via listener
&quot;internal&quot;.</p>

<p style="margin-top: 1em">FILES <br>
yaz-&lt;version&gt;/ztest/yaz-ztest.c</p>


<p style="margin-top: 1em">yaz-&lt;version&gt;/include/yaz/backend.h</p>

<p style="margin-top: 1em">SEE ALSO <br>
yaz(7)yaz-log(7)</p>

<p style="margin-top: 1em">YAZ 5.14.11 10/09/2015
YAZ-ZTEST(8)</p>
<hr>
</body>
</html>
