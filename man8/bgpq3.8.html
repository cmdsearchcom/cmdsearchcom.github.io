<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>BGPQ3(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">BGPQ3(8)</td>
    <td class="head-vol">System Manager's Manual</td>
    <td class="head-rtitle">BGPQ3(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
<b class="Nm" title="Nm">bgpq3</b> &#x2014; <span class="Nd" title="Nd">bgp
  filtering automation for cisco and juniper routers</span>
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<table class="Nm">
  <tr>
    <td><b class="Nm" title="Nm">bgpq3</b></td>
    <td>[<span class="Op"><b class="Fl" title="Fl">-h</b>
      <var class="Ar" title="Ar">host[:port]</var></span>]
      [<span class="Op"><b class="Fl" title="Fl">-S</b>
      <var class="Ar" title="Ar">sources</var></span>]
      [<span class="Op"><b class="Fl" title="Fl">-EP</b></span>]
      [<span class="Op"><b class="Fl" title="Fl">-f</b>
      <var class="Ar" title="Ar">asn</var> | <b class="Fl" title="Fl">-G</b>
      <var class="Ar" title="Ar">asn</var></span>]
      [<span class="Op"><b class="Fl" title="Fl">-346ABbDdJjsX</b></span>]
      [<span class="Op"><b class="Fl" title="Fl">-r</b>
      <var class="Ar" title="Ar">len</var></span>]
      [<span class="Op"><b class="Fl" title="Fl">-R</b>
      <var class="Ar" title="Ar">len</var></span>]
      [<span class="Op"><b class="Fl" title="Fl">-m</b>
      <var class="Ar" title="Ar">max</var></span>]
      [<span class="Op"><b class="Fl" title="Fl">-W</b>
      <var class="Ar" title="Ar">len</var></span>]
      <var class="Ar" title="Ar">OBJECTS</var>
      [<span class="Op">...</span>]</td>
  </tr>
</table>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
The <b class="Nm" title="Nm">bgpq3</b> utility used to generate Cisco and
  Juniper prefix-lists, extended access-lists, policy-statement terms and
  as-path lists based on RADB data.
<div class="Pp"></div>
The options are as follows:
<dl class="Bl-tag">
  <dt class="It-tag"><a class="selflink" href="#3"><b class="Fl" title="Fl" id="3">-3</b></a></dt>
  <dd class="It-tag">assume that your device is asn32-safe.</dd>
  <dt class="It-tag"><a class="selflink" href="#4"><b class="Fl" title="Fl" id="4">-4</b></a></dt>
  <dd class="It-tag">generate IPv4 prefix/access-lists (default).</dd>
  <dt class="It-tag"><a class="selflink" href="#6"><b class="Fl" title="Fl" id="6">-6</b></a></dt>
  <dd class="It-tag">generate IPv6 prefix/access-lists (IPv4 by default).</dd>
  <dt class="It-tag"><a class="selflink" href="#A"><b class="Fl" title="Fl" id="A">-A</b></a></dt>
  <dd class="It-tag">try to aggregate prefix-lists as much as possible (not all
      output formats supported).</dd>
  <dt class="It-tag"><a class="selflink" href="#B"><b class="Fl" title="Fl" id="B">-B</b></a></dt>
  <dd class="It-tag">generate output in OpenBGPD format (default: Cisco)</dd>
  <dt class="It-tag"><a class="selflink" href="#b"><b class="Fl" title="Fl" id="b">-b</b></a></dt>
  <dd class="It-tag">generate output in BIRD format (default: Cisco).</dd>
  <dt class="It-tag"><a class="selflink" href="#d"><b class="Fl" title="Fl" id="d">-d</b></a></dt>
  <dd class="It-tag">enable some debugging output.</dd>
  <dt class="It-tag"><a class="selflink" href="#D"><b class="Fl" title="Fl" id="D">-D</b></a></dt>
  <dd class="It-tag">use asdot notation for Cisco as-path access-lists.</dd>
  <dt class="It-tag"><a class="selflink" href="#E"><b class="Fl" title="Fl" id="E">-E</b></a></dt>
  <dd class="It-tag">generate extended access-list (Cisco) or policy-statement
      term using route-filters (Juniper).</dd>
  <dt class="It-tag"><a class="selflink" href="#f"><b class="Fl" title="Fl" id="f">-f</b></a>
    <var class="Ar" title="Ar">number</var></dt>
  <dd class="It-tag">generate input as-path access-list.</dd>
  <dt class="It-tag"><a class="selflink" href="#G"><b class="Fl" title="Fl" id="G">-G</b></a>
    <var class="Ar" title="Ar">number</var></dt>
  <dd class="It-tag">generate output as-path access-list.</dd>
  <dt class="It-tag"><a class="selflink" href="#h"><b class="Fl" title="Fl" id="h">-h</b></a>
    <var class="Ar" title="Ar">host[:port]</var></dt>
  <dd class="It-tag">host running IRRD database (default: whois.radb.net).</dd>
  <dt class="It-tag"><a class="selflink" href="#J"><b class="Fl" title="Fl" id="J">-J</b></a></dt>
  <dd class="It-tag">generate config for Juniper (default: Cisco).</dd>
  <dt class="It-tag"><a class="selflink" href="#j"><b class="Fl" title="Fl" id="j">-j</b></a></dt>
  <dd class="It-tag">generate output in JSON format (default: Cisco).</dd>
  <dt class="It-tag"><a class="selflink" href="#m"><b class="Fl" title="Fl" id="m">-m</b></a>
    <var class="Ar" title="Ar">len</var></dt>
  <dd class="It-tag">maximum prefix-length of accepted prefixes (default: 32 for
      IPv4 and 128 for IPv6).</dd>
  <dt class="It-tag"><a class="selflink" href="#M"><b class="Fl" title="Fl" id="M">-M</b></a>
    <var class="Ar" title="Ar">match</var></dt>
  <dd class="It-tag">extra match conditions for Juniper route-filters.</dd>
  <dt class="It-tag"><a class="selflink" href="#l"><b class="Fl" title="Fl" id="l">-l</b></a>
    <var class="Ar" title="Ar">name</var></dt>
  <dd class="It-tag">name of generated entry.</dd>
  <dt class="It-tag"><a class="selflink" href="#P"><b class="Fl" title="Fl" id="P">-P</b></a></dt>
  <dd class="It-tag">generate prefix-list (default, backward
    compatibility).</dd>
  <dt class="It-tag"><a class="selflink" href="#r"><b class="Fl" title="Fl" id="r">-r</b></a>
    <var class="Ar" title="Ar">len</var></dt>
  <dd class="It-tag">allow more specific routes starting with specified masklen
      too.</dd>
  <dt class="It-tag"><a class="selflink" href="#R"><b class="Fl" title="Fl" id="R">-R</b></a>
    <var class="Ar" title="Ar">len</var></dt>
  <dd class="It-tag">allow more specific routes up to specified masklen
    too.</dd>
  <dt class="It-tag"><a class="selflink" href="#s"><b class="Fl" title="Fl" id="s">-s</b></a></dt>
  <dd class="It-tag">generate sequence numbers in IOS-style prefix-lists.</dd>
  <dt class="It-tag"><a class="selflink" href="#S"><b class="Fl" title="Fl" id="S">-S</b></a>
    <var class="Ar" title="Ar">sources</var></dt>
  <dd class="It-tag">use specified sources only (recommended:
    RADB,RIPE,APNIC).</dd>
  <dt class="It-tag"><a class="selflink" href="#T"><b class="Fl" title="Fl" id="T">-T</b></a></dt>
  <dd class="It-tag">disable pipelining.</dd>
  <dt class="It-tag"><a class="selflink" href="#W"><b class="Fl" title="Fl" id="W">-W</b></a>
    <var class="Ar" title="Ar">len</var></dt>
  <dd class="It-tag">generate as-path strings of no more than len items (use 0
      for inifinity).</dd>
  <dt class="It-tag"><a class="selflink" href="#X"><b class="Fl" title="Fl" id="X">-X</b></a></dt>
  <dd class="It-tag">generate config for Cisco IOS XR devices (plain IOS by
      default).</dd>
  <dt class="It-tag"><var class="Ar" title="Ar">OBJECTS</var></dt>
  <dd class="It-tag">means networks (in prefix format), autonomous systems,
      as-sets and route-sets.</dd>
</dl>
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
Generating named juniper prefix-filter for AS20597:
  <cite class="Rs" title="Rs">~&gt;bgpq3 -Jl eltel AS20597 policy-options {
  replace:
<br/>
 prefix-list eltel {
<br/>
 81.9.0.0/20;
<br/>
 81.9.32.0/20;
<br/>
 81.9.96.0/20;
<br/>
 81.222.128.0/20;
<br/>
 81.222.192.0/18;
<br/>
 85.249.8.0/21;
<br/>
 85.249.224.0/19;
<br/>
 89.112.0.0/19;
<br/>
 89.112.4.0/22;
<br/>
 89.112.32.0/19;
<br/>
 89.112.64.0/19;
<br/>
 217.170.64.0/20;
<br/>
 217.170.80.0/20;
<br/>
 } }</cite>
<div class="Pp"></div>
For Cisco we can use aggregation (-A) flag to make this prefix-filter more
  compact: <cite class="Rs" title="Rs">~&gt;bgpq3 -Al eltel AS20597 no ip
  prefix-list eltel ip prefix-list eltel permit 81.9.0.0/20 ip prefix-list eltel
  permit 81.9.32.0/20 ip prefix-list eltel permit 81.9.96.0/20 ip prefix-list
  eltel permit 81.222.128.0/20 ip prefix-list eltel permit 81.222.192.0/18 ip
  prefix-list eltel permit 85.249.8.0/21 ip prefix-list eltel permit
  85.249.224.0/19 ip prefix-list eltel permit 89.112.0.0/18 ge 19 le 19 ip
  prefix-list eltel permit 89.112.4.0/22 ip prefix-list eltel permit
  89.112.64.0/19 ip prefix-list eltel permit 217.170.64.0/19 ge 20 le 20</cite>
  - you see, prefixes 89.112.0.0/19 and 89.112.32.0/19 now aggregated into
  single entry 89.112.0.0/18 ge 19 le 19.
<div class="Pp"></div>
Well, for Juniper we can generate even more interesting policy-options, using -M
  &lt;extra match conditions&gt;, -R &lt;len&gt; and hierarchical names:
  <cite class="Rs" title="Rs">~&gt;bgpq3 -AJEl eltel/specifics -r 29 -R 32 -M
  &quot;community blackhole&quot; AS20597 policy-options {
<br/>
 policy-statement eltel {
<br/>
 term specifics { replace:
<br/>
 from {
<br/>
 community blackhole;
<br/>
 route-filter 81.9.0.0/20 prefix-length-range /29-/32;
<br/>
 route-filter 81.9.32.0/20 prefix-length-range /29-/32;
<br/>
 route-filter 81.9.96.0/20 prefix-length-range /29-/32;
<br/>
 route-filter 81.222.128.0/20 prefix-length-range /29-/32;
<br/>
 route-filter 81.222.192.0/18 prefix-length-range /29-/32;
<br/>
 route-filter 85.249.8.0/21 prefix-length-range /29-/32;
<br/>
 route-filter 85.249.224.0/19 prefix-length-range /29-/32;
<br/>
 route-filter 89.112.0.0/17 prefix-length-range /29-/32;
<br/>
 route-filter 217.170.64.0/19 prefix-length-range /29-/32;
<br/>
 }
<br/>
 }
<br/>
 } }</cite> generated policy-option term now allows all specifics with
  prefix-length between /29 and /32 for eltel networks if they match with
  special community &#x00B4;blackhole' (defined elsewhere in configuration).
<div class="Pp"></div>
Of course, this version supports IPv6 (-6):
  <cite class="Rs" title="Rs">~&gt;bgpq3 -6l as-retn-6 AS-RETN6 no ipv6
  prefix-list as-retn-6 ipv6 prefix-list as-retn-6 permit 2001:7fb:fe00::/48
  ipv6 prefix-list as-retn-6 permit 2001:7fb:fe01::/48 [....]</cite> and support
  for ASN 32 is also here <cite class="Rs" title="Rs">~&gt;bgpq3 -J3f 112
  AS-SPACENET policy-options { replace:
<br/>
 as-path-group NN {
<br/>
 as-path a0 &quot;^112(112)*$&quot;;
<br/>
 as-path a1 &quot;^112(.)*(1898|5539|8495|8763|8878|12136|12931|15909)$&quot;;
<br/>
 as-path a2
  &quot;^112(.)*(21358|23456|23600|24151|25152|31529|34127|34906)$&quot;;
<br/>
 as-path a3 &quot;^112(.)*(35052|41720|43628|44450|196611)$&quot;;
<br/>
 } }</cite> see AS196611 in the end of the list ? That's AS3.3 in 'asplain'
  notation.
<div class="Pp"></div>
For non-ASN32 capable routers you should not use switch -3, and the result will
  be next: <cite class="Rs" title="Rs">~&gt;bgpq3 -f 112 AS-SPACENET no ip
  as-path access-list NN ip as-path access-list NN permit ^112(_112)*$ ip
  as-path access-list NN permit ^112(_[0-9]+)*_(1898|5539|8495|8763)$ ip as-path
  access-list NN permit ^112(_[0-9]+)*_(8878|12136|12931|15909)$ ip as-path
  access-list NN permit ^112(_[0-9]+)*_(21358|23456|23600|24151)$ ip as-path
  access-list NN permit ^112(_[0-9]+)*_(25152|31529|34127|34906)$ ip as-path
  access-list NN permit ^112(_[0-9]+)*_(35052|41720|43628|44450)$</cite>
<div class="Pp"></div>
AS196611 is no more in the list, however, AS23456 (transition AS) would be added
  to list if it were not present.
<h1 class="Sh" title="Sh" id="DIAGNOSTICS"><a class="selflink" href="#DIAGNOSTICS">DIAGNOSTICS</a></h1>
When everything is OK, <b class="Nm" title="Nm">bgpq3</b> generates access-list
  to standard output and exits with status == 0. In case of errors they are
  printed to stderr and program exits with non-zero status.
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b class="Sy" title="Sy">http://www.radb.net/</b> Routing Arbiter project
<div class="Pp"></div>
<b class="Sy" title="Sy">http://tools.ietf.org/html/draft-michaelson-4byte-as-representation-05</b>
  for information on 'asdot' and 'asplain' notations.
<div class="Pp"></div>
<b class="Sy" title="Sy">http://www.cisco.com/en/US/docs/ios/12_0s/release/ntes/120SNEWF.html#wp3521658</b>
  for information on Cisco implementation of ASN32.
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
<span class="An" title="An">Alexandre Snarskii</span>
  &#x27E8;snar@snar.spb.ru&#x27E9;</div>
<table class="foot">
  <tr>
    <td class="foot-date">October 27, 2008</td>
    <td class="foot-os">Linux 4.12.14-300.fc26.x86_64</td>
  </tr>
</table>
</body>
</html>
