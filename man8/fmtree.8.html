<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>MTREE(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">MTREE(8)</td>
    <td class="head-vol">System Manager's Manual</td>
    <td class="head-rtitle">MTREE(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
<b class="Nm" title="Nm">mtree</b> &#x2014; <span class="Nd" title="Nd">map a
  directory hierarchy</span>
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<table class="Nm">
  <tr>
    <td><b class="Nm" title="Nm">mtree</b></td>
    <td>[<span class="Op"><b class="Fl" title="Fl">-LPUcdeinqruxw</b></span>]
      [<span class="Op"><b class="Fl" title="Fl">-f</b>&#x00A0;<var class="Ar" title="Ar">spec</var></span>]
      [<span class="Op"><b class="Fl" title="Fl">-K</b>&#x00A0;<var class="Ar" title="Ar">keywords</var></span>]
      [<span class="Op"><b class="Fl" title="Fl">-k</b>&#x00A0;<var class="Ar" title="Ar">keywords</var></span>]
      [<span class="Op"><b class="Fl" title="Fl">-p</b>&#x00A0;<var class="Ar" title="Ar">path</var></span>]
      [<span class="Op"><b class="Fl" title="Fl">-s</b>&#x00A0;<var class="Ar" title="Ar">seed</var></span>]
      [<span class="Op"><b class="Fl" title="Fl">-X</b>&#x00A0;<var class="Ar" title="Ar">exclude-list</var></span>]</td>
  </tr>
</table>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
The <b class="Nm" title="Nm">mtree</b> utility compares the file hierarchy
  rooted in the current directory against a specification read from the standard
  input. Messages are written to the standard output for any files whose
  characteristics do not match the specifications, or which are missing from
  either the file hierarchy or the specification.
<div class="Pp"></div>
The options are as follows:
<dl class="Bl-tag" style="margin-left: 7.80ex;">
  <dt class="It-tag" style="margin-left: -7.80ex;"><a class="selflink" href="#L"><b class="Fl" title="Fl" id="L">-L</b></a></dt>
  <dd class="It-tag">Follow all symbolic links in the file hierarchy.</dd>
  <dt class="It-tag" style="margin-left: -7.80ex;"><a class="selflink" href="#P"><b class="Fl" title="Fl" id="P">-P</b></a></dt>
  <dd class="It-tag">Do not follow symbolic links in the file hierarchy, instead
      consider the symbolic link itself in any comparisons. This is the
    default.</dd>
  <dt class="It-tag" style="margin-left: -7.80ex;"><a class="selflink" href="#U"><b class="Fl" title="Fl" id="U">-U</b></a></dt>
  <dd class="It-tag">Modify the owner, group, permissions, and modification time
      of existing files to match the specification and create any missing
      directories or symbolic links. User, group and permissions must all be
      specified for missing directories to be created. Corrected mismatches are
      not considered errors.</dd>
  <dt class="It-tag" style="margin-left: -7.80ex;"><a class="selflink" href="#c"><b class="Fl" title="Fl" id="c">-c</b></a></dt>
  <dd class="It-tag">Print a specification for the file hierarchy to the
      standard output.</dd>
  <dt class="It-tag" style="margin-left: -7.80ex;"><a class="selflink" href="#d"><b class="Fl" title="Fl" id="d">-d</b></a></dt>
  <dd class="It-tag">Ignore everything except directory type files.</dd>
  <dt class="It-tag" style="margin-left: -7.80ex;"><a class="selflink" href="#e"><b class="Fl" title="Fl" id="e">-e</b></a></dt>
  <dd class="It-tag">Do not complain about files that are in the file hierarchy,
      but not in the specification.</dd>
  <dt class="It-tag" style="margin-left: -7.80ex;"><a class="selflink" href="#i"><b class="Fl" title="Fl" id="i">-i</b></a></dt>
  <dd class="It-tag">Indent the output 4 spaces each time a directory level is
      descended when creating a specification with the
      <b class="Fl" title="Fl">-c</b> option. This does not affect either the
      /set statements or the comment before each directory. It does however
      affect the comment before the close of each directory.</dd>
  <dt class="It-tag" style="margin-left: -7.80ex;"><a class="selflink" href="#n"><b class="Fl" title="Fl" id="n">-n</b></a></dt>
  <dd class="It-tag">Do not emit pathname comments when creating a
      specification. Normally a comment is emitted before each directory and
      before the close of that directory when using the
      <b class="Fl" title="Fl">-c</b> option.</dd>
  <dt class="It-tag" style="margin-left: -7.80ex;"><a class="selflink" href="#q"><b class="Fl" title="Fl" id="q">-q</b></a></dt>
  <dd class="It-tag">Quiet mode. Do not complain when a &#x201C;missing&#x201D;
      directory cannot be created because it already exists. This occurs when
      the directory is a symbolic link.</dd>
  <dt class="It-tag" style="margin-left: -7.80ex;"><a class="selflink" href="#r"><b class="Fl" title="Fl" id="r">-r</b></a></dt>
  <dd class="It-tag">Remove any files in the file hierarchy that are not
      described in the specification.</dd>
  <dt class="It-tag" style="margin-left: -7.80ex;"><a class="selflink" href="#u"><b class="Fl" title="Fl" id="u">-u</b></a></dt>
  <dd class="It-tag">Same as <b class="Fl" title="Fl">-U</b> except a status of
      2 is returned if the file hierarchy did not match the specification.</dd>
  <dt class="It-tag" style="margin-left: -7.80ex;"><a class="selflink" href="#w"><b class="Fl" title="Fl" id="w">-w</b></a></dt>
  <dd class="It-tag">Make some errors non-fatal warnings.</dd>
  <dt class="It-tag" style="margin-left: -7.80ex;"><a class="selflink" href="#x"><b class="Fl" title="Fl" id="x">-x</b></a></dt>
  <dd class="It-tag">Do not descend below mount points in the file
    hierarchy.</dd>
  <dt class="It-tag" style="margin-left: -7.80ex;"><a class="selflink" href="#f"><b class="Fl" title="Fl" id="f">-f</b></a>
    <var class="Ar" title="Ar">file</var></dt>
  <dd class="It-tag">Read the specification from
      <var class="Ar" title="Ar">file</var>, instead of from the standard input.
    <div class="Pp"></div>
    If this option is specified twice, the two specifications are compared to
      each other rather than to the file hierarchy. The specifications will be
      sorted like output generated using <b class="Fl" title="Fl">-c</b>. The
      output format in this case is somewhat remniscent of
      <a class="Xr" title="Xr">comm(1)</a>, having &quot;in first spec
      only&quot;, &quot;in second spec only&quot;, and &quot;different&quot;
      columns, prefixed by zero, one and two TAB characters respectively. Each
      entry in the &quot;different&quot; column occupies two lines, one from
      each specification.</dd>
  <dt class="It-tag" style="margin-left: -7.80ex;"><a class="selflink" href="#K"><b class="Fl" title="Fl" id="K">-K</b></a>
    <var class="Ar" title="Ar">keywords</var></dt>
  <dd class="It-tag">Add the specified (whitespace or comma separated)
      <var class="Ar" title="Ar">keywords</var> to the current set of
    keywords.</dd>
  <dt class="It-tag" style="margin-left: -7.80ex;"><a class="selflink" href="#k"><b class="Fl" title="Fl" id="k">-k</b></a>
    <var class="Ar" title="Ar">keywords</var></dt>
  <dd class="It-tag">Use the ``type'' keyword plus the specified (whitespace or
      comma separated) <var class="Ar" title="Ar">keywords</var> instead of the
      current set of keywords.</dd>
  <dt class="It-tag" style="margin-left: -7.80ex;"><a class="selflink" href="#p"><b class="Fl" title="Fl" id="p">-p</b></a>
    <var class="Ar" title="Ar">path</var></dt>
  <dd class="It-tag">Use the file hierarchy rooted in
      <var class="Ar" title="Ar">path</var>, instead of the current
    directory.</dd>
  <dt class="It-tag" style="margin-left: -7.80ex;"><a class="selflink" href="#s"><b class="Fl" title="Fl" id="s">-s</b></a>
    <var class="Ar" title="Ar">seed</var></dt>
  <dd class="It-tag">Display a single checksum to the standard error output that
      represents all of the files for which the keyword
      <b class="Cm" title="Cm">cksum</b> was specified. The checksum is seeded
      with the specified value.</dd>
  <dt class="It-tag" style="margin-left: -7.80ex;"><a class="selflink" href="#X"><b class="Fl" title="Fl" id="X">-X</b></a>
    <var class="Ar" title="Ar">exclude-list</var></dt>
  <dd class="It-tag">The specified file contains
      <a class="Xr" title="Xr">fnmatch(3)</a> patterns matching files to be
      excluded from the specification, one to a line. If the pattern contains a
      &#x2018;<code class="Li">/</code>&#x2019; character, it will be matched
      against entire pathnames (relative to the starting directory); otherwise,
      it will be matched against basenames only. No comments are allowed in the
      <var class="Ar" title="Ar">exclude-list</var> file.</dd>
</dl>
<div class="Pp"></div>
Specifications are mostly composed of ``keywords'', i.e., strings that specify
  values relating to files. No keywords have default values, and if a keyword
  has no value set, no checks based on it are performed.
<div class="Pp"></div>
Currently supported keywords are as follows:
<dl class="Bl-tag" style="margin-left: 15.00ex;">
  <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#cksum"><b class="Cm" title="Cm" id="cksum">cksum</b></a></dt>
  <dd class="It-tag">The checksum of the file using the default algorithm
      specified by the <a class="Xr" title="Xr">cksum(1)</a> utility.</dd>
  <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#flags"><b class="Cm" title="Cm" id="flags">flags</b></a></dt>
  <dd class="It-tag">The file flags as a symbolic name. See
      <a class="Xr" title="Xr">chflags(1)</a> for information on these names. If
      no flags are to be set the string &#x201C;none&#x201D; may be used to
      override the current default.</dd>
  <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#ignore"><b class="Cm" title="Cm" id="ignore">ignore</b></a></dt>
  <dd class="It-tag">Ignore any file hierarchy below this file.</dd>
  <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#gid"><b class="Cm" title="Cm" id="gid">gid</b></a></dt>
  <dd class="It-tag">The file group as a numeric value.</dd>
  <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#gname"><b class="Cm" title="Cm" id="gname">gname</b></a></dt>
  <dd class="It-tag">The file group as a symbolic name.</dd>
  <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#md5digest"><b class="Cm" title="Cm" id="md5digest">md5digest</b></a></dt>
  <dd class="It-tag">The MD5 message digest of the file.</dd>
  <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#sha1digest"><b class="Cm" title="Cm" id="sha1digest">sha1digest</b></a></dt>
  <dd class="It-tag">The FIPS 160-1 (&#x201C;SHA-1&#x201D;) message digest of
      the file.</dd>
  <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#sha256digest"><b class="Cm" title="Cm" id="sha256digest">sha256digest</b></a></dt>
  <dd class="It-tag">The FIPS 180-2 (&#x201C;SHA-256&#x201D;) message digest of
      the file.</dd>
  <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#ripemd160digest"><b class="Cm" title="Cm" id="ripemd160digest">ripemd160digest</b></a></dt>
  <dd class="It-tag">The RIPEMD160 message digest of the file.</dd>
  <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#mode"><b class="Cm" title="Cm" id="mode">mode</b></a></dt>
  <dd class="It-tag">The current file's permissions as a numeric (octal) or
      symbolic value.</dd>
  <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#nlink"><b class="Cm" title="Cm" id="nlink">nlink</b></a></dt>
  <dd class="It-tag">The number of hard links the file is expected to have.</dd>
  <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#nochange"><b class="Cm" title="Cm" id="nochange">nochange</b></a></dt>
  <dd class="It-tag">Make sure this file or directory exists but otherwise
      ignore all attributes.</dd>
  <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#optional"><b class="Cm" title="Cm" id="optional">optional</b></a></dt>
  <dd class="It-tag">The file is optional; do not complain about the file if it
      is not in the file hierarchy.</dd>
  <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#uid"><b class="Cm" title="Cm" id="uid">uid</b></a></dt>
  <dd class="It-tag">The file owner as a numeric value.</dd>
  <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#uname"><b class="Cm" title="Cm" id="uname">uname</b></a></dt>
  <dd class="It-tag">The file owner as a symbolic name.</dd>
  <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#size"><b class="Cm" title="Cm" id="size">size</b></a></dt>
  <dd class="It-tag">The size, in bytes, of the file.</dd>
  <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#link"><b class="Cm" title="Cm" id="link">link</b></a></dt>
  <dd class="It-tag">The file the symbolic link is expected to reference.</dd>
  <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#time"><b class="Cm" title="Cm" id="time">time</b></a></dt>
  <dd class="It-tag">The last modification time of the file, in seconds and
      nanoseconds. The value should include a period character and exactly nine
      digits after the period.</dd>
  <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#type"><b class="Cm" title="Cm" id="type">type</b></a></dt>
  <dd class="It-tag">The type of the file; may be set to any one of the
      following:
    <div class="Pp"></div>
    <dl class="Bl-tag Bl-compact" style="margin-left: 15.00ex;">
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#block"><b class="Cm" title="Cm" id="block">block</b></a></dt>
      <dd class="It-tag">block special device</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#char"><b class="Cm" title="Cm" id="char">char</b></a></dt>
      <dd class="It-tag">character special device</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#dir"><b class="Cm" title="Cm" id="dir">dir</b></a></dt>
      <dd class="It-tag">directory</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#fifo"><b class="Cm" title="Cm" id="fifo">fifo</b></a></dt>
      <dd class="It-tag">fifo</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#file"><b class="Cm" title="Cm" id="file">file</b></a></dt>
      <dd class="It-tag">regular file</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#link"><b class="Cm" title="Cm" id="link">link</b></a></dt>
      <dd class="It-tag">symbolic link</dd>
      <dt class="It-tag" style="margin-left: -15.00ex;"><a class="selflink" href="#socket"><b class="Cm" title="Cm" id="socket">socket</b></a></dt>
      <dd class="It-tag">socket</dd>
    </dl>
  </dd>
</dl>
<div class="Pp"></div>
The default set of keywords are <b class="Cm" title="Cm">flags</b>,
  <b class="Cm" title="Cm">gid</b>, <b class="Cm" title="Cm">link</b>,
  <b class="Cm" title="Cm">mode</b>, <b class="Cm" title="Cm">nlink</b>,
  <b class="Cm" title="Cm">size</b>, <b class="Cm" title="Cm">time</b>, and
  <b class="Cm" title="Cm">uid</b>.
<div class="Pp"></div>
There are four types of lines in a specification.
<div class="Pp"></div>
The first type of line sets a global value for a keyword, and consists of the
  string ``/set'' followed by whitespace, followed by sets of keyword/value
  pairs, separated by whitespace. Keyword/value pairs consist of a keyword,
  followed by an equals sign (``=''), followed by a value, without whitespace
  characters. Once a keyword has been set, its value remains unchanged until
  either reset or unset.
<div class="Pp"></div>
The second type of line unsets keywords and consists of the string ``/unset'',
  followed by whitespace, followed by one or more keywords, separated by
  whitespace.
<div class="Pp"></div>
The third type of line is a file specification and consists of a file name,
  followed by whitespace, followed by zero or more whitespace separated
  keyword/value pairs. The file name may be preceded by whitespace characters.
  The file name may contain any of the standard file name matching characters
  (``['', ``]'', ``?'' or ``*''), in which case files in the hierarchy will be
  associated with the first pattern that they match.
<div class="Pp"></div>
Each of the keyword/value pairs consist of a keyword, followed by an equals sign
  (``=''), followed by the keyword's value, without whitespace characters. These
  values override, without changing, the global value of the corresponding
  keyword.
<div class="Pp"></div>
All paths are relative. Specifying a directory will cause subsequent files to be
  searched for in that directory hierarchy. Which brings us to the last type of
  line in a specification: a line containing only the string
  &#x201C;<i class="Pa" title="Pa">..</i>&#x201D; causes the current directory
  path to ascend one level.
<div class="Pp"></div>
Empty lines and lines whose first non-whitespace character is a hash mark
  (``#'') are ignored.
<div class="Pp"></div>
The <b class="Nm" title="Nm">mtree</b> utility exits with a status of 0 on
  success, 1 if any error occurred, and 2 if the file hierarchy did not match
  the specification. A status of 2 is converted to a status of 0 if the
  <b class="Fl" title="Fl">-U</b> option is used.
<h1 class="Sh" title="Sh" id="FILES"><a class="selflink" href="#FILES">FILES</a></h1>
<dl class="Bl-tag Bl-compact" style="margin-left: 15.00ex;">
  <dt class="It-tag" style="margin-left: -15.00ex;"><i class="Pa" title="Pa">/etc/mtree</i></dt>
  <dd class="It-tag">system specification directory</dd>
</dl>
<h1 class="Sh" title="Sh" id="EXIT_STATUS"><a class="selflink" href="#EXIT_STATUS">EXIT
  STATUS</a></h1>
The <b class="Nm" title="Nm">mtree</b> utility exits&#x00A0;0 on success,
  and&#x00A0;&gt;0 if an error occurs.
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
To detect system binaries that have been ``trojan horsed'', it is recommended
  that <b class="Nm" title="Nm">mtree</b> <b class="Fl" title="Fl">-K</b>
  <b class="Cm" title="Cm">sha256digest</b> be run on the file systems, and a
  copy of the results stored on a different machine, or, at least, in encrypted
  form. The output file itself should be digested using the
  <a class="Xr" title="Xr">sha256(1)</a> utility. Then, periodically,
  <b class="Nm" title="Nm">mtree</b> and <a class="Xr" title="Xr">sha256(1)</a>
  should be run against the on-line specifications. While it is possible for the
  bad guys to change the on-line specifications to conform to their modified
  binaries, it is believed to be impractical for them to create a modified
  specification which has the same SHA-256 digest as the original.
<div class="Pp"></div>
The <b class="Fl" title="Fl">-d</b> and <b class="Fl" title="Fl">-u</b> options
  can be used in combination to create directory hierarchies for distributions
  and other such things; the files in <i class="Pa" title="Pa">/etc/mtree</i>
  were used to create almost all directories in this
  <span class="Ux">FreeBSD</span> distribution.
<div class="Pp"></div>
To create an <i class="Pa" title="Pa">/etc/mtree</i> style BSD.*.dist file, use
  <b class="Nm" title="Nm">mtree</b> <b class="Fl" title="Fl">-c</b>
  <b class="Fl" title="Fl">-d</b> <b class="Fl" title="Fl">-i</b>
  <b class="Fl" title="Fl">-n</b> <b class="Fl" title="Fl">-k</b>
  <b class="Cm" title="Cm">uname,gname,mode,nochange.</b>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<a class="Xr" title="Xr">chflags(1)</a>, <a class="Xr" title="Xr">chgrp(1)</a>,
  <a class="Xr" title="Xr">chmod(1)</a>, <a class="Xr" title="Xr">cksum(1)</a>,
  <a class="Xr" title="Xr">md5(1)</a>, <a class="Xr" title="Xr">stat(2)</a>,
  <a class="Xr" title="Xr">fts(3)</a>, <a class="Xr" title="Xr">md5(3)</a>,
  <a class="Xr" title="Xr">chown(8)</a>
<h1 class="Sh" title="Sh" id="HISTORY"><a class="selflink" href="#HISTORY">HISTORY</a></h1>
The <b class="Nm" title="Nm">mtree</b> utility appeared in
  <span class="Ux">4.3BSD-Reno</span>. The MD5 digest capability was added in
  <span class="Ux">FreeBSD 2.1</span>, in response to the widespread use of
  programs which can spoof <a class="Xr" title="Xr">cksum(1)</a>. The SHA-1 and
  RIPEMD160 digests were added in <span class="Ux">FreeBSD 4.0</span>, as new
  attacks have demonstrated weaknesses in MD5. The SHA-256 digest was added in
  <span class="Ux">FreeBSD 6.0</span>. Support for file flags was added in
  <span class="Ux">FreeBSD 4.0</span>, and mostly comes from
  <span class="Ux">NetBSD</span>.</div>
<table class="foot">
  <tr>
    <td class="foot-date">June 16, 2007</td>
    <td class="foot-os">Linux 4.12.14-300.fc26.x86_64</td>
  </tr>
</table>
</body>
</html>
