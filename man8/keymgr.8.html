<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>KEYMGR(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">KEYMGR(8)</td>
    <td class="head-vol">Knot DNS</td>
    <td class="head-rtitle">KEYMGR(8)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
keymgr - DNSSEC key management utility
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>keymgr</b> [<i>global-options</i>] [<i>command</i>...] [<i>arguments</i>...]
<div style="height: 1.00em;">&#x00A0;</div>
<b>keymgr</b> [<i>global-options</i>] [<i>command</i>...] <b>help</b>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
The <b>keymgr</b> utility serves for key management in Knot DNS server.
<div style="height: 1.00em;">&#x00A0;</div>
Primarily functions for DNSSEC keys and KASP (Key And Signature Policy)
  management are provided. However the utility also provides functions for TSIG
  key generation.
<div style="height: 1.00em;">&#x00A0;</div>
The DNSSEC and KASP configuration is stored in a so called KASP database. The
  database is simply a directory in the file-system containing files in the JSON
  format.
<div style="height: 1.00em;">&#x00A0;</div>
The operations are organized into commands and subcommands. A command specifies
  the operation to be performed with the KASP database. It is usually followed
  by named arguments. The special command <b>help</b> can be used to list
  available subcommands in that area. The listing of available command arguments
  is not supported yet.
<div style="height: 1.00em;">&#x00A0;</div>
Command and argument names are parsed in a smart way. Only a beginning of a name
  can be entered and it will be recognized. The specified part of a name must be
  unique amongst the other names.
<h2 class="Ss" title="Ss" id="Global_options"><a class="selflink" href="#Global_options">Global
  options</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>-c</b>, <b>--config</b> <i>file</i></dt>
  <dd class="It-tag">Use a textual configuration file to get the KASP database
      location.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-C</b>, <b>--confdb</b> <i>directory</i></dt>
  <dd class="It-tag">Use a binary configuration database directory to get the
      KASP database location.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-d</b>, <b>--dir</b> <i>path</i></dt>
  <dd class="It-tag">Use a specified KASP database path to work with.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-h</b>, <b>--help</b></dt>
  <dd class="It-tag">Print the program help.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-l</b>, <b>--legacy</b></dt>
  <dd class="It-tag">Enable legacy mode. Zone, policy, and keystore
      configuration is stored in KASP database (not in server
    configuration).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-V</b>, <b>--version</b></dt>
  <dd class="It-tag">Print the program version.</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="KASP_database_location"><a class="selflink" href="#KASP_database_location">KASP
  database location</a></h2>
The location of the KASP database is determined as follows:
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">1.</dt>
  <dd class="It-tag">The path specified with <b>--dir</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">2.</dt>
  <dd class="It-tag">The path read from the server configuration specified with
      <b>--confdb</b> or <b>--config</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">3.</dt>
  <dd class="It-tag">The path read from the server default configuration
      database.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">4.</dt>
  <dd class="It-tag">The path read from the server default configuration
    file.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
In legacy mode, the path is determined as follows:
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">1.</dt>
  <dd class="It-tag">The path specified with <b>--dir</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">2.</dt>
  <dd class="It-tag">The path specified in the <b>KEYMGR_DIR</b> environment
      variable.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">3.</dt>
  <dd class="It-tag">The current working dir.</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Main_commands"><a class="selflink" href="#Main_commands">Main
  commands</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>tsig</b> ...</dt>
  <dd class="It-tag">Operations with TSIG keys.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>zone</b> ...</dt>
  <dd class="It-tag">Operations with zones in the database. A zone holds
      assigned signing configuration and signing metadata.</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Main_commands_(legacy)"><a class="selflink" href="#Main_commands_(legacy)">Main
  commands (legacy)</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>init</b></dt>
  <dd class="It-tag">Initialize new KASP database or upgrade existing one. The
      command is idempotent and therefore it is safe to be run multiple times.
    <div style="height: 1.00em;">&#x00A0;</div>
    The command creates a default policy and default key store (both named
      <i>default</i>). In case of upgrade, existing objects are checked and any
      missing attributes are filled in.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>policy</b> ...</dt>
  <dd class="It-tag">Operations with KASP policies. A policy holds parameters
      that define the way how a zone is signed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>keystore</b> ...</dt>
  <dd class="It-tag">Operations with key stores configured for the KASP
      database. A private key store holds private key material for zone signing
      separately from the zone metadata.</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="tsig_commands"><a class="selflink" href="#tsig_commands">tsig
  commands</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>tsig</b> <b>generate</b> <i>name</i> [<b>algorithm</b>
    <i>id</i>] [<b>size</b> <i>bits</i>]</dt>
  <dd class="It-tag">Generate new TSIG key and print it on the standard output.
      The algorithm defaults to <i>hmac-sha256</i>. The default key size is
      determined optimally based on the selected algorithm.
    <div style="height: 1.00em;">&#x00A0;</div>
    The generated key is printed out in the server configuration format to allow
      direct inclusion into the server configuration. The first line of the
      output contains a comment with the key in the one-line key format accepted
      by client utilities.</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="zone_commands"><a class="selflink" href="#zone_commands">zone
  commands</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>zone</b> <b>key</b> <b>list</b> <i>zone-name</i>
    [<b>filter</b> [ <b>filter</b>]]</dt>
  <dd class="It-tag">List key IDs and tags of zone keys. The <b>filter</b> can
      be a key tag, a key ID prefix, a key state (active, published, retired,
      removed) or ksk/zsk. Key state and ksk/zsk combination is possible. Use
      these key state and ksk/zsk with prefix '+' ('+ksk', '+active').</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>zone</b> <b>key</b> <b>show</b> <i>zone-name</i>
    <i>key</i></dt>
  <dd class="It-tag">Show zone key details. The <i>key</i> can be a key tag or a
      key ID prefix.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>zone</b> <b>key</b> <b>ds</b> <i>zone-name</i>
    <i>filter</i></dt>
  <dd class="It-tag">Show DS records for a zone key. The <i>filter</i> can be a
      key tag, a key ID prefix or key state (limited to active and published
      ksk). Use these key state as '+active' or '+published'.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>zone</b> <b>key</b> <b>generate</b> <i>zone-name</i>
    [<i>key-parameter</i>...]</dt>
  <dd class="It-tag">Generate a new key for a zone.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>zone</b> <b>key</b> <b>import</b> <i>zone-name</i>
    <i>key-file</i></dt>
  <dd class="It-tag">Import an existing key in the legacy format. The
      <i>key-file</i> suffix <b>.private</b> or <b>.key</b> is not required. A
      public key without a matching private key cannot be imported.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>zone</b> <b>key</b> <b>set</b> <i>zone-name</i>
    <i>key</i> [ <i>key-parameter</i>...]</dt>
  <dd class="It-tag">Change a key parameter. Only key timing parameters can be
      changed.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Available <i>key-parameter</i>s:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>algorithm</b> <i>id</i></dt>
  <dd class="It-tag">Algorithm number or IANA mnemonic.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>size</b> <i>bits</i></dt>
  <dd class="It-tag">Size of the key in bits.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>ksk</b></dt>
  <dd class="It-tag">Set the DNSKEY SEP (Secure Entry Point) flag.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>publish</b> <i>time</i></dt>
  <dd class="It-tag">The time the key is published as a DNSKEY record.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>active</b> <i>time</i></dt>
  <dd class="It-tag">The time the key is started to be used for signing.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>retire</b> <i>time</i></dt>
  <dd class="It-tag">The time the key is stopped to be used for signing.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>remove</b> <i>time</i></dt>
  <dd class="It-tag">The time the key's DNSKEY is removed from the zone.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The <i>time</i> accepts YYYYMMDDHHMMSS format, unix timestamp, or offset from
  the current time. For the offset, add <b>+</b> or <b>-</b> prefix and
  optionally a suffix <b>mi</b>, <b>h</b>, <b>d</b>, <b>w</b>, <b>mo</b>, or
  <b>y</b>. If no suffix is specified, the offset is in seconds.
<h2 class="Ss" title="Ss" id="zone_commands_(legacy)"><a class="selflink" href="#zone_commands_(legacy)">zone
  commands (legacy)</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>zone</b> <b>add</b> <i>zone-name</i> [<b>policy</b>
    <i>policy-name</i>]</dt>
  <dd class="It-tag">Add a zone into the database. The policy defaults to
      'default'.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>zone</b> <b>list</b> [<i>pattern</i>]</dt>
  <dd class="It-tag">List zones in the database matching the <i>pattern</i> as a
      substring.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>zone</b> <b>remove</b> <i>zone-name</i>
    [<b>force</b>]</dt>
  <dd class="It-tag">Remove a zone from the database. If some keys are currently
      active, the <b>force</b> argument must be specified.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>zone</b> <b>set</b> <i>zone-name</i> [<b>policy</b>
    <i>policy-name</i>]</dt>
  <dd class="It-tag">Change zone configuration. At the moment, only a policy can
      be changed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>zone</b> <b>show</b> <i>zone-name</i></dt>
  <dd class="It-tag">Show zone details.</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="policy_commands_(legacy)"><a class="selflink" href="#policy_commands_(legacy)">policy
  commands (legacy)</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>policy</b> <b>list</b></dt>
  <dd class="It-tag">List policies in the database.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>policy</b> <b>show</b> <i>policy-name</i></dt>
  <dd class="It-tag">Show policy details.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>policy</b> <b>add</b> <i>policy-name</i>
    [<i>policy-parameter</i>...]</dt>
  <dd class="It-tag">Add a new policy into the database.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>policy</b> <b>set</b> <i>policy-name</i>
    [<i>policy-parameter</i>...]</dt>
  <dd class="It-tag">Change policy configuration.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>policy</b> <b>remove</b> <i>policy-name</i></dt>
  <dd class="It-tag">Remove a policy from the database. <b>Note</b>, the utility
      does not check if the policy is used.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Available <i>policy-parameter</i>s:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>algorithm</b> <i>id</i></dt>
  <dd class="It-tag">DNSKEY algorithm number or IANA mnemonic.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>dnskey-ttl</b> <i>seconds</i></dt>
  <dd class="It-tag">TTL value for DNSKEY records.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>ksk-size</b> <i>bits</i></dt>
  <dd class="It-tag">Size of the KSK.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>zsk-size</b> <i>bits</i></dt>
  <dd class="It-tag">Size of the ZSK.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>zsk-lifetime</b> <i>seconds</i></dt>
  <dd class="It-tag">Period between ZSK publication and the next rollover
      initiation.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>rrsig-lifetime</b> <i>seconds</i></dt>
  <dd class="It-tag">Validity period of issued signatures.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>rrsig-refresh</b> <i>seconds</i></dt>
  <dd class="It-tag">Period before signature expiration when the signature will
      be refreshed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>nsec3</b> <i>enable</i></dt>
  <dd class="It-tag">Specifies if NSEC3 will be used instead of NSEC.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>nsec3-iterations</b> <i>iterations</i></dt>
  <dd class="It-tag">Specifies the number of additional iterations in NSEC3
      computation.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>nsec3-salt-length</b> <i>bytes</i></dt>
  <dd class="It-tag">Specifies salt length for NSEC3 computation.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>nsec3-salt-lifetime</b> <i>seconds</i></dt>
  <dd class="It-tag">Period after which a new NSEC3 salt is generated.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>soa-min-ttl</b> <i>seconds</i></dt>
  <dd class="It-tag">SOA Minimum TTL field. <b>Note</b>, Knot DNS overwrites the
      value with the real used value.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>zone-max-ttl</b> <i>seconds</i></dt>
  <dd class="It-tag">Max TTL in the zone. <b>Note</b>, Knot DNS will determine
      the value automatically in the future.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>delay</b> <i>seconds</i></dt>
  <dd class="It-tag">Zone signing and data propagation delay. The value is added
      for safety to timing of all rollover steps.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>manual</b> <i>enable</i></dt>
  <dd class="It-tag">Enable manual key management. If enabled, no keys will be
      generated or rolled automatically.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>keystore</b> <i>name</i></dt>
  <dd class="It-tag">Name of the key store to be used for private key
    material.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="keystore_commands_(legacy)"><a class="selflink" href="#keystore_commands_(legacy)">keystore
  commands (legacy)</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>keystore</b> <b>list</b></dt>
  <dd class="It-tag">List names of configured key stores.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>keystore</b> <b>show</b> <i>name</i></dt>
  <dd class="It-tag">Show configuration of a key store named <i>name</i> and
      list key IDs of private key material present in that key store.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>keystore</b> <b>add</b> <i>name</i> [<b>backend</b>
    <i>backend</i>] [ <b>config</b> <i>config</i>]</dt>
  <dd class="It-tag">Configure new key store. The <i>name</i> is a unique key
      store identifier. The <i>backend</i> and backend-specific configuration
      string <i>config</i> determine where the private key material will be
      physically stored.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Supported key store backends:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>pkcs8</b> (default)</dt>
  <dd class="It-tag">The backend stores private key material in unencrypted
      X.509 PEM files in a directory specified as the backend configuration
      string. The path can be specified relatively to the KASP database
      location.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>pkcs11</b></dt>
  <dd class="It-tag">The backend stores private key material in a cryptographic
      token accessible via the PKCS #11 interface. The configuration string
      consists of a token PKCS #11 URL and PKCS #11 module path separated by the
      space character.
    <div style="height: 1.00em;">&#x00A0;</div>
    The format of the PKCS #11 URL is described in <i>RFC 7512</i>. If the token
      is protected by a PIN, make sure to include <i>pin-value</i> or
      <i>pin-source</i> attribute in the URL.
    <div style="height: 1.00em;">&#x00A0;</div>
    The PKCS #11 module path can be an absolute path or just a module name. In
      the later case, the module is looked up in the default modules
    location.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">1.</dt>
  <dd class="It-tag">Generate two RSA-SHA-256 signing keys. The first key will
      be used as a KSK, the second one as a ZSK:</dd>
</dl>
<div style="margin-left: 3.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ keymgr zone key generate example.com algorithm rsasha256 size 2048 ksk
$ keymgr zone key generate example.com algorithm rsasha256 size 1024
</pre>
</div>
<br/>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag">2.</dt>
  <dd class="It-tag">Import a key in legacy format. The used algorithm must
      match with the one configured in the policy:</dd>
</dl>
<div style="margin-left: 3.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ keymgr zone key import example.com Kexample.com+010+12345.private
</pre>
</div>
<br/>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag">3.</dt>
  <dd class="It-tag">Generate a TSIG key named <i>operator.key</i>:</dd>
</dl>
<div style="margin-left: 3.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ keymgr tsig generate operator.key algorithm hmac-sha512
</pre>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<i>RFC 6781</i> - DNSSEC Operational Practices.
<div style="height: 1.00em;">&#x00A0;</div>
<b>knot.conf(5)</b>, <b>knotc(8)</b>, <b>knotd(8)</b>.
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
CZ.NIC Labs &lt;http://www.knot-dns.cz&gt;
<h1 class="Sh" title="Sh" id="COPYRIGHT"><a class="selflink" href="#COPYRIGHT">COPYRIGHT</a></h1>
Copyright 2010&#x2013;2017, CZ.NIC, z.s.p.o.</div>
<table class="foot">
  <tr>
    <td class="foot-date">2017-02-10</td>
    <td class="foot-os">2.4.1</td>
  </tr>
</table>
</body>
</html>
