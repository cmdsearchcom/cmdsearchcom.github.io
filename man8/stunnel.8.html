<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 19:16:22 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>STUNNEL(8) stunnel STUNNEL(8)</p>

<p style="margin-top: 1em">NAME <br>
stunnel - universal SSL tunnel</p>

<p style="margin-top: 1em">SYNOPSIS <br>
Unix: <br>
stunnel [&lt;filename&gt;] | -fd&Acirc;&nbsp;n | -help |
-version | -sockets</p>

<p style="margin-top: 1em">WIN32: <br>
stunnel [ [-install | -uninstall | -start | -stop] | -exit]
<br>
[-quiet] [&lt;filename&gt;] ] | -help | -version |
-sockets</p>

<p style="margin-top: 1em">DESCRIPTION <br>
The stunnel program is designed to work as SSL encryption
wrapper between remote clients and local (inetd-startable)
or remote servers. The concept is that having non-SSL aware
<br>
daemons running on your system you can easily set them up to
communicate with clients over secure SSL channels.</p>

<p style="margin-top: 1em">stunnel can be used to add SSL
functionality to commonly used Inetd daemons like POP-2,
POP-3, and IMAP servers, to standalone daemons like NNTP,
SMTP and HTTP, and in tunneling <br>
PPP over network sockets without changes to the source
code.</p>

<p style="margin-top: 1em">This product includes
cryptographic software written by Eric Young
(eay@cryptsoft.com)</p>

<p style="margin-top: 1em">OPTIONS <br>
&lt;filename&gt; <br>
Use specified configuration file</p>

<p style="margin-top: 1em">-fd n (Unix only) <br>
Read the config file from specified file descriptor</p>

<p style="margin-top: 1em">-help <br>
Print stunnel help menu</p>

<p style="margin-top: 1em">-version <br>
Print stunnel version and compile time defaults</p>

<p style="margin-top: 1em">-sockets <br>
Print default socket options</p>

<p style="margin-top: 1em">-install (NT/2000/XP only) <br>
Install NT Service</p>

<p style="margin-top: 1em">-uninstall (NT/2000/XP only)
<br>
Uninstall NT Service</p>

<p style="margin-top: 1em">-start (NT/2000/XP only) <br>
Start NT Service</p>

<p style="margin-top: 1em">-stop (NT/2000/XP only) <br>
Stop NT Service</p>

<p style="margin-top: 1em">-exit (Win32 only) <br>
Exit an already started stunnel</p>

<p style="margin-top: 1em">-quiet (NT/2000/XP only) <br>
Don&rsquo;t display any message boxes</p>

<p style="margin-top: 1em">CONFIGURATION FILE <br>
Each line of the configuration file can be either:</p>

<p style="margin-top: 1em">&Acirc;&middot; An empty line
(ignored).</p>

<p style="margin-top: 1em">&Acirc;&middot; A comment
starting with &rsquo;;&rsquo; (ignored).</p>

<p style="margin-top: 1em">&Acirc;&middot; An
&rsquo;option_name = option_value&rsquo; pair.</p>

<p style="margin-top: 1em">&Acirc;&middot;
&rsquo;[service_name]&rsquo; indicating a start of a service
definition.</p>

<p style="margin-top: 1em">An address parameter of an
option may be either:</p>

<p style="margin-top: 1em">&Acirc;&middot; A port
number.</p>

<p style="margin-top: 1em">&Acirc;&middot; A
colon-separated pair of IP address (either IPv4, IPv6, or
domain name) and port number.</p>

<p style="margin-top: 1em">&Acirc;&middot; A Unix socket
path (Unix only).</p>

<p style="margin-top: 1em">GLOBAL OPTIONS <br>
chroot = directory (Unix only) <br>
directory to chroot stunnel process</p>

<p style="margin-top: 1em">chroot keeps stunnel in chrooted
jail. CApath, CRLpath, pid and exec are located inside the
jail and the patches have to be relative to the directory
specified with chroot.</p>

<p style="margin-top: 1em">Several functions of the
operating system also need their files to be located within
chroot jail, e.g.:</p>

<p style="margin-top: 1em">&Acirc;&middot; Delayed resolver
typically needs /etc/nsswitch.conf and /etc/resolv.conf.</p>

<p style="margin-top: 1em">&Acirc;&middot; Local time in
log files needs /etc/timezone.</p>

<p style="margin-top: 1em">&Acirc;&middot; Some other
functions may need devices, e.g. /dev/zero or /dev/null.</p>

<p style="margin-top: 1em">compression = deflate | zlib |
rle <br>
select data compression algorithm</p>

<p style="margin-top: 1em">default: no compression</p>

<p style="margin-top: 1em">deflate is the standard
compression method as described in RFC 1951.</p>

<p style="margin-top: 1em">zlib compression of OpenSSL
0.9.8 or above is not backward compatible with OpenSSL
0.9.7.</p>

<p style="margin-top: 1em">rle compression is currently not
implemented by the OpenSSL library.</p>

<p style="margin-top: 1em">debug = [facility.]level <br>
debugging level</p>

<p style="margin-top: 1em">Level is a one of the syslog
level names or numbers emerg (0), alert (1), crit (2), err
(3), warning (4), notice (5), info (6), or debug (7). All
logs for the specified <br>
level and all levels numerically less than it will be shown.
Use debug = debug or debug = 7 for greatest debugging
output. The default is notice (5).</p>

<p style="margin-top: 1em">The syslog facility
&rsquo;authpriv&rsquo; will be used unless a facility name
is supplied. (Facilities are not supported on Win32.)</p>

<p style="margin-top: 1em">Case is ignored for both
facilities and levels.</p>

<p style="margin-top: 1em">EGD = egd path (Unix only) <br>
path to Entropy Gathering Daemon socket</p>

<p style="margin-top: 1em">Entropy Gathering Daemon socket
to use to feed OpenSSL random number generator. (Available
only if compiled with OpenSSL 0.9.5a or higher)</p>

<p style="margin-top: 1em">engine = auto | &lt;engine
id&gt; <br>
select hardware engine</p>

<p style="margin-top: 1em">default: software-only
cryptography</p>

<p style="margin-top: 1em">Here is an example of advanced
engine configuration to read private key from an OpenSC
engine</p>

<p style="margin-top: 1em">engine=dynamic <br>
engineCtrl=SO_PATH:/usr/lib/opensc/engine_pkcs11.so <br>
engineCtrl=ID:pkcs11 <br>
engineCtrl=LIST_ADD:1 <br>
engineCtrl=LOAD <br>
engineCtrl=MODULE_PATH:/usr/lib/pkcs11/opensc-pkcs11.so <br>
engineCtrl=INIT</p>

<p style="margin-top: 1em">[service] <br>
engineNum=1 <br>
key=id_45</p>

<p style="margin-top: 1em">engineCtrl = command[:parameter]
<br>
control hardware engine</p>

<p style="margin-top: 1em">Special commands
&quot;LOAD&quot; and &quot;INIT&quot; can be used to load
and initialize the engine cryptogaphic module.</p>

<p style="margin-top: 1em">fips = yes | no <br>
Enable or disable FIPS 140-2 mode.</p>

<p style="margin-top: 1em">This option allows to disable
entering FIPS mode if stunnel was compiled with FIPS 140-2
support.</p>

<p style="margin-top: 1em">default: yes</p>

<p style="margin-top: 1em">foreground = yes | no (Unix
only) <br>
foreground mode</p>

<p style="margin-top: 1em">Stay in foreground (don&rsquo;t
fork) and log to stderr instead of via syslog (unless output
is specified).</p>

<p style="margin-top: 1em">default: background in daemon
mode</p>

<p style="margin-top: 1em">output = file <br>
append log messages to a file</p>

<p style="margin-top: 1em">/dev/stdout device can be used
to send log messages to the standard output (for example to
log them with daemontools splogger).</p>

<p style="margin-top: 1em">pid = file (Unix only) <br>
pid file location</p>

<p style="margin-top: 1em">If the argument is empty, then
no pid file will be created.</p>

<p style="margin-top: 1em">pid path is relative to chroot
directory if specified.</p>

<p style="margin-top: 1em">RNDbytes = bytes <br>
bytes to read from random seed files</p>

<p style="margin-top: 1em">Number of bytes of data read
from random seed files. With SSL versions less than 0.9.5a,
also determines how many bytes of data are considered
sufficient to seed the PRNG. <br>
More recent OpenSSL versions have a builtin function to
determine when sufficient randomness is available.</p>

<p style="margin-top: 1em">RNDfile = file <br>
path to file with random seed data</p>

<p style="margin-top: 1em">The SSL library will use data
from this file first to seed the random number
generator.</p>

<p style="margin-top: 1em">RNDoverwrite = yes | no <br>
overwrite the random seed files with new random data</p>

<p style="margin-top: 1em">default: yes</p>

<p style="margin-top: 1em">service = servicename (Unix
only) <br>
use specified string as inetd mode service name for TCP
Wrapper library</p>

<p style="margin-top: 1em">default: stunnel</p>

<p style="margin-top: 1em">setgid = groupname (Unix only)
<br>
setgid() to groupname in daemon mode and clears all other
groups</p>

<p style="margin-top: 1em">setuid = username (Unix only)
<br>
setuid() to username in daemon mode</p>

<p style="margin-top: 1em">socket =
a|l|r:option=value[:value] <br>
Set an option on accept/local/remote socket</p>

<p style="margin-top: 1em">The values for linger option are
l_onof:l_linger. The values for time are tv_sec:tv_usec.</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">socket = l:SO_LINGER=1:60 <br>
set one minute timeout for closing local socket <br>
socket = r:SO_OOBINLINE=yes <br>
place out-of-band data directly into the <br>
receive data stream for remote sockets <br>
socket = a:SO_REUSEADDR=no <br>
disable address reuse (enabled by default) <br>
socket = a:SO_BINDTODEVICE=lo <br>
only accept connections on loopback interface</p>

<p style="margin-top: 1em">syslog = yes | no (Unix only)
<br>
enable logging via syslog</p>

<p style="margin-top: 1em">default: yes</p>

<p style="margin-top: 1em">taskbar = yes | no (WIN32 only)
<br>
enable the taskbar icon</p>

<p style="margin-top: 1em">default: yes</p>

<p style="margin-top: 1em">SERVICE-LEVEL OPTIONS <br>
Each configuration section begins with service name in
square brackets. The service name is used for libwrap (TCP
Wrappers) access control and lets you distinguish stunnel
<br>
services in your log files.</p>

<p style="margin-top: 1em">Note that if you wish to run
stunnel in inetd mode (where it is provided a network socket
by a server such as inetd, xinetd, or tcpserver) then you
should read the section <br>
entitled INETD MODE below.</p>

<p style="margin-top: 1em">accept = address <br>
accept connections on specified address</p>

<p style="margin-top: 1em">If no host specified, defaults
to all IPv4 addresses for the local host.</p>

<p style="margin-top: 1em">To listen on all IPv6 addresses
use:</p>

<p style="margin-top: 1em">accept = :::port</p>

<p style="margin-top: 1em">CApath = directory <br>
Certificate Authority directory</p>

<p style="margin-top: 1em">This is the directory in which
stunnel will look for certificates when using the verify.
Note that the certificates in this directory should be named
XXXXXXXX.0 where <br>
XXXXXXXX is the hash value of the DER encoded subject of the
cert.</p>

<p style="margin-top: 1em">The hash algorithm has been
changed in OpenSSL 1.0.0. It is required to c_rehash the
directory on upgrade from OpenSSL 0.x.x to OpenSSL
1.x.x.</p>

<p style="margin-top: 1em">CApath path is relative to
chroot directory if specified.</p>

<p style="margin-top: 1em">CAfile = certfile <br>
Certificate Authority file</p>

<p style="margin-top: 1em">This file contains multiple CA
certificates, used with the verify.</p>

<p style="margin-top: 1em">cert = pemfile <br>
certificate chain PEM file name</p>

<p style="margin-top: 1em">A PEM is always needed in server
mode. Specifying this flag in client mode will use this
certificate chain as a client side certificate chain. Using
client side certs is <br>
optional. The certificates must be in PEM format and must be
sorted starting with the certificate to the highest level
(root CA).</p>

<p style="margin-top: 1em">ciphers = cipherlist <br>
Select permitted SSL ciphers</p>

<p style="margin-top: 1em">A colon delimited list of the
ciphers to allow in the SSL connection. For example
DES-CBC3-SHA:IDEA-CBC-MD5</p>

<p style="margin-top: 1em">client = yes | no <br>
client mode (remote service uses SSL)</p>

<p style="margin-top: 1em">default: no (server mode)</p>

<p style="margin-top: 1em">connect = address <br>
connect to a remote address</p>

<p style="margin-top: 1em">If no host is specified, the
host defaults to localhost.</p>

<p style="margin-top: 1em">Multiple connect options are
allowed in a single service section.</p>

<p style="margin-top: 1em">If host resolves to multiple
addresses and/or if multiple connect options are specified,
then the remote address is chosen using a round-robin
algorithm.</p>

<p style="margin-top: 1em">CRLpath = directory <br>
Certificate Revocation Lists directory</p>

<p style="margin-top: 1em">This is the directory in which
stunnel will look for CRLs when using the verify. Note that
the CRLs in this directory should be named XXXXXXXX.r0 where
XXXXXXXX is the hash <br>
value of the CRL.</p>

<p style="margin-top: 1em">The hash algorithm has been
changed in OpenSSL 1.0.0. It is required to c_rehash the
directory on upgrade from OpenSSL 0.x.x to OpenSSL
1.x.x.</p>

<p style="margin-top: 1em">CRLpath path is relative to
chroot directory if specified.</p>

<p style="margin-top: 1em">CRLfile = certfile <br>
Certificate Revocation Lists file</p>

<p style="margin-top: 1em">This file contains multiple
CRLs, used with the verify.</p>

<p style="margin-top: 1em">curve = nid <br>
specify ECDH curve name for server</p>

<p style="margin-top: 1em">To get a list of supported
curves use:</p>

<p style="margin-top: 1em">openssl ecparam -list_curves</p>

<p style="margin-top: 1em">default: prime256v1</p>

<p style="margin-top: 1em">delay = yes | no <br>
delay DNS lookup for &rsquo;connect&rsquo; option</p>

<p style="margin-top: 1em">This option is useful for
dynamic DNS, or when DNS is not available during stunnel
startup (road warrior VPN, dial-up configurations).</p>

<p style="margin-top: 1em">engineNum = engine number <br>
select engine number to read private key</p>

<p style="margin-top: 1em">The engines are numbered
starting from 1.</p>

<p style="margin-top: 1em">exec = executable_path <br>
execute local inetd-type program</p>

<p style="margin-top: 1em">exec path is relative to chroot
directory if specified.</p>

<p style="margin-top: 1em">execargs = $0 $1 $2 ... <br>
arguments for exec including program name ($0)</p>

<p style="margin-top: 1em">Quoting is currently not
supported. Arguments are separated with arbitrary number of
whitespaces.</p>

<p style="margin-top: 1em">failover = rr | prio <br>
Failover strategy for multiple &quot;connect&quot;
targets.</p>

<p style="margin-top: 1em">rr (round robin) - fair load
distribution <br>
prio (priority) - use the order specified in config file</p>

<p style="margin-top: 1em">default: rr</p>

<p style="margin-top: 1em">ident = username <br>
use IDENT (RFC 1413) username checking</p>

<p style="margin-top: 1em">key = keyfile <br>
private key for certificate specified with cert option</p>

<p style="margin-top: 1em">Private key is needed to
authenticate certificate owner. Since this file should be
kept secret it should only be readable to its owner. On Unix
systems you can use the <br>
following command:</p>

<p style="margin-top: 1em">chmod 600 keyfile</p>

<p style="margin-top: 1em">default: value of cert
option</p>

<p style="margin-top: 1em">libwrap = yes | no <br>
Enable or disable the use of /etc/hosts.allow and
/etc/hosts.deny.</p>

<p style="margin-top: 1em">default: yes</p>

<p style="margin-top: 1em">local = host <br>
IP of the outgoing interface is used as source for remote
connections. Use this option to bind a static local IP
address, instead.</p>

<p style="margin-top: 1em">sni =
service_name:server_name_pattern (server mode) <br>
Use the service as a slave service (a name-based virtual
server) for Server Name Indication TLS extension (RFC
3546).</p>

<p style="margin-top: 1em">service_name specifies the
master service that accepts client connections with accept
option. server_name_pattern specifies the host name to be
redirected. The pattern may <br>
start with &rsquo;*&rsquo; character, e.g.
&rsquo;*.example.com&rsquo;. Multiple slave services are
normally specified for a single master service. sni option
can also be specified more than once <br>
within a single slave service.</p>

<p style="margin-top: 1em">This service, as well as the
master service, may not be configured in client mode.</p>

<p style="margin-top: 1em">connect option of the slave
service is ignored when protocol option is specified, as
protocol connects remote host before TLS handshake.</p>

<p style="margin-top: 1em">Libwrap checks (Unix only) are
performed twice: with master service name after TCP
connection is accepted, and with slave service name during
TLS handshake.</p>

<p style="margin-top: 1em">Option sni is only available
when compiled with OpenSSL 1.0.0 and later.</p>

<p style="margin-top: 1em">sni = server_name (client mode)
<br>
Use the parameter as the value of TLS Server Name Indication
(RFC 3546) extension.</p>

<p style="margin-top: 1em">Option sni is only available
when compiled with OpenSSL 1.0.0 and later.</p>

<p style="margin-top: 1em">OCSP = url <br>
select OCSP server for certificate verification</p>

<p style="margin-top: 1em">OCSPflag = flag <br>
specify OCSP server flag</p>

<p style="margin-top: 1em">Several OCSPflag can be used to
specify multiple flags.</p>

<p style="margin-top: 1em">currently supported flags:
NOCERTS, NOINTERN NOSIGS, NOCHAIN, NOVERIFY, NOEXPLICIT,
NOCASIGN, NODELEGATED, NOCHECKS, TRUSTOTHER, RESPID_KEY,
NOTIME</p>

<p style="margin-top: 1em">options = SSL_options <br>
OpenSSL library options</p>

<p style="margin-top: 1em">The parameter is the OpenSSL
option name as described in the SSL_CTX_set_options(3ssl)
manual, but without SSL_OP_ prefix. Several options can be
used to specify multiple <br>
options.</p>

<p style="margin-top: 1em">For example for compatibility
with erroneous Eudora SSL implementation the following
option can be used:</p>

<p style="margin-top: 1em">options =
DONT_INSERT_EMPTY_FRAGMENTS</p>

<p style="margin-top: 1em">protocol = proto <br>
application protocol to negotiate SSL</p>

<p style="margin-top: 1em">This option enables initial,
protocol-specific negotiation of the SSL/TLS encryption.
protocol option should not be used with SSL encryption on a
separate port.</p>

<p style="margin-top: 1em">Currently supported
protocols:</p>

<p style="margin-top: 1em">cifs <br>
Proprietary (undocummented) extension of CIFS protocol
implemented in Samba. Support for this extension was dropped
in Samba 3.0.0.</p>

<p style="margin-top: 1em">connect <br>
Based on RFC 2817 - Upgrading to TLS Within HTTP/1.1,
section 5.2 - Requesting a Tunnel with CONNECT</p>

<p style="margin-top: 1em">This protocol is only supported
in client mode.</p>

<p style="margin-top: 1em">imap <br>
Based on RFC 2595 - Using TLS with IMAP, POP3 and ACAP</p>

<p style="margin-top: 1em">nntp <br>
Based on RFC 4642 - Using Transport Layer Security (TLS)
with Network News Transfer Protocol (NNTP)</p>

<p style="margin-top: 1em">This protocol is only supported
in client mode.</p>

<p style="margin-top: 1em">pgsql <br>
Based on
http://www.postgresql.org/docs/8.3/static/protocol-flow.html#AEN73982</p>

<p style="margin-top: 1em">pop3 <br>
Based on RFC 2449 - POP3 Extension Mechanism</p>

<p style="margin-top: 1em">proxy <br>
Haproxy client IP address
http://haproxy.1wt.eu/download/1.5/doc/proxy-protocol.txt</p>

<p style="margin-top: 1em">smtp <br>
Based on RFC 2487 - SMTP Service Extension for Secure SMTP
over TLS</p>

<p style="margin-top: 1em">protocolAuthentication =
auth_type <br>
authentication type for protocol negotiations</p>

<p style="margin-top: 1em">currently supported: basic,
NTLM</p>

<p style="margin-top: 1em">Currently authentication type
only applies to the &rsquo;connect&rsquo; protocol.</p>

<p style="margin-top: 1em">default: basic</p>

<p style="margin-top: 1em">protocolHost = host:port <br>
destination address for protocol negotiations</p>

<p style="margin-top: 1em">protocolHost specifies the final
SSL server to be connected by the proxy, and not the proxy
server directly connected by stunnel. The proxy server
should be specified with <br>
the &rsquo;connect&rsquo; option.</p>

<p style="margin-top: 1em">Currently protocol destination
address only applies to &rsquo;connect&rsquo; protocol.</p>

<p style="margin-top: 1em">protocolPassword = password <br>
password for protocol negotiations</p>

<p style="margin-top: 1em">protocolUsername = username <br>
username for protocol negotiations</p>

<p style="margin-top: 1em">pty = yes | no (Unix only) <br>
allocate pseudo terminal for &rsquo;exec&rsquo; option</p>

<p style="margin-top: 1em">renegotiation = yes | no <br>
support SSL renegotiation</p>

<p style="margin-top: 1em">Applications of the SSL
renegotiation include some authentication scenarios, or
re-keying long lasting connections.</p>

<p style="margin-top: 1em">On the other hand this feature
can facilitate a trivial CPU-exhaustion DoS attack:</p>


<p style="margin-top: 1em">http://vincent.bernat.im/en/blog/2011-ssl-dos-mitigation.html</p>

<p style="margin-top: 1em">Please note that disabling SSL
renegotiation does not fully mitigate this issue.</p>

<p style="margin-top: 1em">default: yes (if supported by
OpenSSL)</p>

<p style="margin-top: 1em">reset = yes | no <br>
attempt to use TCP RST flag to indicate an error</p>

<p style="margin-top: 1em">This option is not supported on
some platforms.</p>

<p style="margin-top: 1em">default: yes</p>

<p style="margin-top: 1em">retry = yes | no <br>
reconnect a connect+exec section after it&rsquo;s
disconnected</p>

<p style="margin-top: 1em">default: no</p>

<p style="margin-top: 1em">sessionCacheSize = size <br>
session cache size</p>

<p style="margin-top: 1em">sessionCacheSize specifies the
maximum number of the internal session cache entries.</p>

<p style="margin-top: 1em">The value of 0 can be used for
unlimited size. It is not recommended for production use due
to the risk of memory exhaustion DoS attack.</p>

<p style="margin-top: 1em">sessionCacheTimeout = timeout
<br>
session cache timeout</p>

<p style="margin-top: 1em">This is the number of seconds to
keep cached SSL sessions.</p>

<p style="margin-top: 1em">sessiond = host:port <br>
address of sessiond SSL cache server</p>

<p style="margin-top: 1em">sslVersion = version <br>
select version of SSL protocol</p>

<p style="margin-top: 1em">Allowed options: all, SSLv2,
SSLv3, TLSv1, TLSv1.1, TLSv1.2</p>

<p style="margin-top: 1em">stack = bytes (except for FORK
model) <br>
thread stack size</p>

<p style="margin-top: 1em">TIMEOUTbusy = seconds <br>
time to wait for expected data</p>

<p style="margin-top: 1em">TIMEOUTclose = seconds <br>
time to wait for close_notify (set to 0 for buggy MSIE)</p>

<p style="margin-top: 1em">TIMEOUTconnect = seconds <br>
time to wait to connect a remote host</p>

<p style="margin-top: 1em">TIMEOUTidle = seconds <br>
time to keep an idle connection</p>

<p style="margin-top: 1em">transparent = none | source |
destination | both (Unix only) <br>
enable transparent proxy support on selected platforms</p>

<p style="margin-top: 1em">Supported values:</p>

<p style="margin-top: 1em">none <br>
Disable transparent proxy support. This is the default.</p>

<p style="margin-top: 1em">source <br>
Re-write address to appear as if wrapped daemon is
connecting from the SSL client machine instead of the
machine running stunnel.</p>

<p style="margin-top: 1em">This option is currently
available in:</p>

<p style="margin-top: 1em">Remote mode (connect option) on
Linux &gt;=2.6.28 <br>
This configuration requires stunnel to be executed as root
and without setuid option.</p>

<p style="margin-top: 1em">This configuration requires the
following setup for iptables and routing (possibly in
/etc/rc.local or equivalent file):</p>

<p style="margin-top: 1em">iptables -t mangle -N DIVERT
<br>
iptables -t mangle -A PREROUTING -p tcp -m socket -j DIVERT
<br>
iptables -t mangle -A DIVERT -j MARK --set-mark 1 <br>
iptables -t mangle -A DIVERT -j ACCEPT <br>
ip rule add fwmark 1 lookup 100 <br>
ip route add local 0.0.0.0/0 dev lo table 100 <br>
echo 0 &gt;/proc/sys/net/ipv4/conf/lo/rp_filter</p>

<p style="margin-top: 1em">stunnel must also to be executed
as root and without setuid option.</p>

<p style="margin-top: 1em">Remote mode (connect option) on
Linux 2.2.x <br>
This configuration requires kernel to be compiled with
transparent proxy option. Connected service must be
installed on a separate host. Routing towards the clients
<br>
has to go through the stunnel box.</p>

<p style="margin-top: 1em">stunnel must also to be executed
as root and without setuid option.</p>

<p style="margin-top: 1em">Remote mode (connect option) on
FreeBSD &gt;=8.0 <br>
This configuration requires additional firewall and routing
setup. stunnel must also to be executed as root and without
setuid option.</p>

<p style="margin-top: 1em">Local mode (exec option) <br>
This configuration works by pre-loading libstunnel.so shared
library. _RLD_LIST environment variable is used on Tru64,
and LD_PRELOAD variable on other platforms.</p>

<p style="margin-top: 1em">destination <br>
Original destination is used instead of connect option.</p>

<p style="margin-top: 1em">A service section for
transparent destination may look like this:</p>

<p style="margin-top: 1em">[transparent] <br>
client=yes <br>
accept=&lt;stunnel_port&gt; <br>
transparent=destination</p>

<p style="margin-top: 1em">This configuration requires the
following setup for iptables (possibly in /etc/rc.local or
equivalent file):</p>

<p style="margin-top: 1em">/sbin/iptables -I INPUT -i eth0
-p tcp --dport &lt;stunnel_port&gt; -j ACCEPT <br>
/sbin/iptables -t nat -I PREROUTING -i eth0 -p tcp --dport
&lt;redirected_port&gt; -j DNAT --to-destination
&lt;local_ip&gt;:&lt;stunnel_port&gt;</p>

<p style="margin-top: 1em">Transparent destination option
is currently only supported on Linux.</p>

<p style="margin-top: 1em">both <br>
Use both source and destination transparent proxy.</p>

<p style="margin-top: 1em">Two legacy options are also
supported for backward compatibility:</p>

<p style="margin-top: 1em">yes This options has been
renamed to source.</p>

<p style="margin-top: 1em">no This options has been renamed
to none.</p>

<p style="margin-top: 1em">verify = level <br>
verify peer certificate</p>

<p style="margin-top: 1em">level 0 <br>
Request and ignore peer certificate.</p>

<p style="margin-top: 1em">level 1 <br>
Verify peer certificate if present.</p>

<p style="margin-top: 1em">level 2 <br>
Verify peer certificate.</p>

<p style="margin-top: 1em">level 3 <br>
Verify peer with locally installed certificate.</p>

<p style="margin-top: 1em">level 4 <br>
Ignore CA chain and only verify peer certificate.</p>

<p style="margin-top: 1em">default <br>
No verify.</p>

<p style="margin-top: 1em">It is important to understand,
that this option was solely designed for access control and
not for authorization. Specifically for level 2 every
non-revoked certificate is <br>
accepted regardless of its Common Name. For this reason a
dedicated CA should be used with level 2, and not a generic
CA commonly used for webservers. Level 3 is preferred <br>
for point-to-point connections.</p>

<p style="margin-top: 1em">RETURN VALUE <br>
stunnel returns zero on success, non-zero on error.</p>

<p style="margin-top: 1em">SIGNALS <br>
The following signals can be used to control stunnel in Unix
environment:</p>

<p style="margin-top: 1em">SIGHUP <br>
Force a reload of the configuration file.</p>

<p style="margin-top: 1em">Some global options will not be
reloaded:</p>

<p style="margin-top: 1em">&Acirc;&middot; chroot</p>

<p style="margin-top: 1em">&Acirc;&middot; foreground</p>

<p style="margin-top: 1em">&Acirc;&middot; pid</p>

<p style="margin-top: 1em">&Acirc;&middot; setgid</p>

<p style="margin-top: 1em">&Acirc;&middot; setuid</p>

<p style="margin-top: 1em">The use of &rsquo;setuid&rsquo;
option will also prevent stunnel from binding privileged
(&lt;1024) ports during configuration reloading.</p>

<p style="margin-top: 1em">When &rsquo;chroot&rsquo; option
is used, stunnel will look for all its files (including
configuration file, certificates, log file and pid file)
within the chroot jail.</p>

<p style="margin-top: 1em">SIGUSR1 <br>
Close and reopen stunnel log file. This function can be used
for log rotation.</p>

<p style="margin-top: 1em">SIGTERM, SIGQUIT, SIGINT <br>
Shut stunnel down.</p>

<p style="margin-top: 1em">The result of sending any other
signals to the server is undefined.</p>

<p style="margin-top: 1em">EXAMPLES <br>
In order to provide SSL encapsulation to your local imapd
service, use</p>

<p style="margin-top: 1em">[imapd] <br>
accept = 993 <br>
exec = /usr/sbin/imapd <br>
execargs = imapd</p>

<p style="margin-top: 1em">If you want to provide tunneling
to your pppd daemon on port 2020, use something like</p>

<p style="margin-top: 1em">[vpn] <br>
accept = 2020 <br>
exec = /usr/sbin/pppd <br>
execargs = pppd local <br>
pty = yes</p>

<p style="margin-top: 1em">If you want to use stunnel in
inetd mode to launch your imapd process, you&rsquo;d use
this stunnel.conf. Note there must be no [service_name]
section.</p>

<p style="margin-top: 1em">exec = /usr/sbin/imapd <br>
execargs = imapd</p>

<p style="margin-top: 1em">NOTES <br>
RESTRICTIONS <br>
stunnel cannot be used for the FTP daemon because of the
nature of the FTP protocol which utilizes multiple ports for
data transfers. There are available SSL enabled versions of
<br>
FTP and telnet daemons, however.</p>

<p style="margin-top: 1em">INETD MODE <br>
The most common use of stunnel is to listen on a network
port and establish communication with either a new port via
the connect option, or a new program via the exec option.
<br>
However there is a special case when you wish to have some
other program accept incoming connections and launch
stunnel, for example with inetd, xinetd, or tcpserver.</p>

<p style="margin-top: 1em">For example, if you have the
following line in inetd.conf:</p>

<p style="margin-top: 1em">imaps stream tcp nowait root
/usr/bin/stunnel stunnel /etc/stunnel/imaps.conf</p>

<p style="margin-top: 1em">In these cases, the inetd-style
program is responsible for binding a network socket (imaps
above) and handing it to stunnel when a connection is
received. Thus you do not want <br>
stunnel to have any accept option. All the Service Level
Options should be placed in the global options section, and
no [service_name] section will be present. See the EXAMPLES
<br>
section for example configurations.</p>

<p style="margin-top: 1em">CERTIFICATES <br>
Each SSL enabled daemon needs to present a valid X.509
certificate to the peer. It also needs a private key to
decrypt the incoming data. The easiest way to obtain a
certificate <br>
and a key is to generate them with the free OpenSSL package.
You can find more information on certificates generation on
pages listed below.</p>

<p style="margin-top: 1em">The order of contents of the
.pem file is important. It should contain the unencrypted
private key first, then a signed certificate (not
certificate request). There should be <br>
also empty lines after certificate and private key.
Plaintext certificate information appended on the top of
generated certificate should be discarded. So the file
should look <br>
like this:</p>

<p style="margin-top: 1em">-----BEGIN RSA PRIVATE KEY-----
<br>
[encoded key] <br>
-----END RSA PRIVATE KEY----- <br>
[empty line] <br>
-----BEGIN CERTIFICATE----- <br>
[encoded certificate] <br>
-----END CERTIFICATE----- <br>
[empty line]</p>

<p style="margin-top: 1em">RANDOMNESS <br>
stunnel needs to seed the PRNG (pseudo random number
generator) in order for SSL to use good randomness. The
following sources are loaded in order until sufficient
random data <br>
has been gathered:</p>

<p style="margin-top: 1em">&Acirc;&middot; The file
specified with the RNDfile flag.</p>

<p style="margin-top: 1em">&Acirc;&middot; The file
specified by the RANDFILE environment variable, if set.</p>

<p style="margin-top: 1em">&Acirc;&middot; The file .rnd in
your home directory, if RANDFILE not set.</p>

<p style="margin-top: 1em">&Acirc;&middot; The file
specified with &rsquo;--with-random&rsquo; at compile
time.</p>

<p style="margin-top: 1em">&Acirc;&middot; The contents of
the screen if running on Windows.</p>

<p style="margin-top: 1em">&Acirc;&middot; The egd socket
specified with the EGD flag.</p>

<p style="margin-top: 1em">&Acirc;&middot; The egd socket
specified with &rsquo;--with-egd-sock&rsquo; at compile
time.</p>

<p style="margin-top: 1em">&Acirc;&middot; The /dev/urandom
device.</p>

<p style="margin-top: 1em">With recent (OpenSSL 0.9.5a or
later) version of SSL it will stop loading random data
automatically when sufficient entropy has been gathered.
With previous versions it will <br>
continue to gather from all the above sources since no SSL
function exists to tell when enough data is available.</p>

<p style="margin-top: 1em">Note that on Windows machines
that do not have console user interaction (mouse movements,
creating windows, etc.) the screen contents are not variable
enough to be sufficient, <br>
and you should provide a random file for use with the
RNDfile flag.</p>

<p style="margin-top: 1em">Note that the file specified
with the RNDfile flag should contain random data -- that
means it should contain different information each time
stunnel is run. This is handled <br>
automatically unless the RNDoverwrite flag is used. If you
wish to update this file manually, the openssl rand command
in recent versions of OpenSSL, would be useful.</p>

<p style="margin-top: 1em">Important note: If /dev/urandom
is available, OpenSSL often seeds the PRNG with it while
checking the random state. On systems with /dev/urandom
OpenSSL is likely to use it even <br>
though it is listed at the very bottom of the list above.
This is the behaviour of OpenSSL and not stunnel.</p>

<p style="margin-top: 1em">DH PARAMETERS <br>
Stunnel 4.40 and later contains hardcoded 2048-bit DH
parameters.</p>

<p style="margin-top: 1em">It is also possible to specify
DH parameters in the certificate file:</p>

<p style="margin-top: 1em">openssl dhparam 2048 &gt;&gt;
stunnel.pem</p>

<p style="margin-top: 1em">DH parameter generation may take
several minutes.</p>

<p style="margin-top: 1em">FILES <br>
stunnel.conf <br>
stunnel configuration file</p>

<p style="margin-top: 1em">BUGS <br>
Option execargs and Win32 command line does not support
quoting.</p>

<p style="margin-top: 1em">SEE ALSO <br>
tcpd(8) <br>
access control facility for internet services</p>

<p style="margin-top: 1em">inetd(8) <br>
internet &rsquo;super-server&rsquo;</p>

<p style="margin-top: 1em">http://www.stunnel.org/ <br>
stunnel homepage</p>

<p style="margin-top: 1em">http://www.openssl.org/ <br>
OpenSSL project website</p>

<p style="margin-top: 1em">AUTHOR <br>
Micha&Aring; Trojnara <br>
&lt;Michal.Trojnara@mirt.net&gt;</p>

<p style="margin-top: 1em">4.56 2013.03.20 STUNNEL(8)</p>
<hr>
</body>
</html>
