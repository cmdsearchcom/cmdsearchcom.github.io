<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>BKR-WORKFLOW-XSLT(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">BKR-WORKFLOW-XSLT(1)</td>
    <td class="head-vol">Beaker</td>
    <td class="head-rtitle">BKR-WORKFLOW-XSLT(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
bkr-workflow-xslt - XSLT-based Beaker job generator
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>
<b>bkr workflow-xslt</b> [<i>options</i>]
<br/>
[--defaults=&lt;filename&gt;] [--profile=&lt;profile-name&gt;] [--job-xml=&lt;filename&gt;]
[--dry-run | --wait]
[--xslt-override=&lt;filename&gt;] [--xslt-name=&lt;name&gt;] [--whiteboard=&lt;text&gt;]
[--save-xml=&lt;filename&gt;] [--save-internal-xml=&lt;filename&gt;]
[ <i>job-specific options</i>]
<br/>
</pre>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
Job-specific options are defined in the Job Configuration XML, and will be
  described with <b>--help</b>.
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
This program will use a Job Configuration XML file which defines variables
  useful in a kernel workflow. It will use this information to process the
  generate a Beaker job XML document, as defined in the configured XSLT files.
<h2 class="Ss" title="Ss" id="Beaker_arguments"><a class="selflink" href="#Beaker_arguments">Beaker
  arguments</a></h2>
Common <b>bkr</b> options are described in the Options section of <b>bkr(1)</b>.
  Note that, in spite of its name, this program does not accept the common
  workflow options described in the Workflow options section of <b>bkr(1)</b>.
<div style="height: 1.00em;">&#x00A0;</div>
It is important that the arguments in this section comes before any other
  options. These arguments define how the rest of the arguments should be
  processed and their default values.
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--defaults &lt;filename&gt;</b></dt>
  <dd class="It-tag">Adds more default values in addition to what may be
      configured in <b>~/.beaker-client/bks-defaults</b> and
      <b>./bks-defaults</b>.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--profile &lt;profile-name&gt;</b></dt>
  <dd class="It-tag">The defaults files can be configured with different
      profiles for the same Job XML file. This argument will define which
      profile set to use for default values.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--job-xml &lt;filename&gt;</b></dt>
  <dd class="It-tag">Defines which Job XML Configuration file to load. This
      argument is mandatory, unless configured in a defaults file.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--dry-run</b></dt>
  <dd class="It-tag">When this option is used, the job will not be sent to the
      Beaker scheduler at all. If you don't use <i>--save-xml</i> or
      <i>--save-internal-xml</i> the generated Beaker job XML will be dumped to
      stdout.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--wait</b></dt>
  <dd class="It-tag">This will cause the <b>bkr workflow-xslt</b> operation to
      wait for the Beaker job to complete before exiting.</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Global_job_arguments"><a class="selflink" href="#Global_job_arguments">Global
  job arguments</a></h2>
The global options are specific to the <b>bkr workflow-xslt</b> module, and will
  use the defaults as defined in the <i>SETTINGS ARGUMENTS</i>. Short arguments
  may be overrided by the Job XML definition.
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--xslt-override &lt;filename&gt;</b></dt>
  <dd class="It-tag">This will override the configured XSLT file defined in the
      Job Configuration.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>-X &lt;name&gt;, --xslt-name &lt;name&gt;</b></dt>
  <dd class="It-tag">The Job Configuration can have several XSLT templates
      configured. This option will define which XSLT to use. If this option is
      not set, it will use the XSLT template which has no name configured.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>-W &lt;text&gt;, --whiteboard &lt;text&gt;</b></dt>
  <dd class="It-tag">Adds the given &lt;text&gt; as a text for the Beaker job
      whiteboard.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--save-xml &lt;filename&gt;</b></dt>
  <dd class="It-tag">Saves the generated Beaker Job XML to the given
      &lt;filename&gt;.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--save-internal-xml &lt;filename&gt;</b></dt>
  <dd class="It-tag">Saves the internal XML document which is passed to the XSLT
      processor to the given &lt;filename&gt;. This is useful during
    debugging.</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Job_XML_configuration"><a class="selflink" href="#Job_XML_configuration">Job
  XML configuration</a></h2>
A Job XML Configuration is needed to be able to generate XML files to the Beaker
  scheduler. The purpose of the Job XML Configuration is to define which
  parameters and variables which are needed for the XSLT processing to work.
  This configuration will also define parts of the XML document being sent to
  the XSLT processor. This configuration file is also an XML document.
<div style="height: 1.00em;">&#x00A0;</div>
It will not be explained how to write the needed XSLT documents in this manual.
<h2 class="Ss" title="Ss" id="The_structure"><a class="selflink" href="#The_structure">The
  structure</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
&lt;JobConfig&gt;
    &lt;name&gt;{Descriptive name of the job configuration}&lt;/name&gt;
    &lt;xslt&gt;{Default XSLT file}&lt;/xslt&gt;
    [&lt;xslt name=&quot;variant2&quot;&gt;{Named XSLT file}&lt;/xslt&gt;]
    [...more &lt;xslt/&gt; tags...]
    &lt;arguments&gt;
        &lt;arg section=&quot;recipe&quot; type=&quot;{string|bool}&quot; [optional=&quot;1&quot;]&gt;
            &lt;name short=&quot;a&quot;&gt;{long argument}&lt;/name&gt;
            &lt;tag type=&quot;{tagtype}&quot;&gt;{XML tag name}&lt;/tag&gt;
            [&lt;default&gt;{default value}&lt;/default&gt;]
            &lt;description&gt;{Argument description&lt;/description&gt;
            &lt;metavar&gt;{Descriptive value substitution&lt;metavar&gt;
        &lt;/arg&gt;
        [...more &lt;arg/&gt; tags...]
    &lt;/arguments&gt;
&lt;/JobConfig&gt;
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Tag_descriptions"><a class="selflink" href="#Tag_descriptions">Tag
  descriptions</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>&lt;JobConfig/&gt;</b></dt>
  <dd class="It-tag">The XML root node must be a &lt;JobConfig/&gt; tag.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>&lt;name/&gt;</b></dt>
  <dd class="It-tag">The first &lt;name/&gt; in &lt;JobConfig/&gt; is a plain
      and short string describing the purpose of this Job Configuration.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>&lt;xslt [name=&quot;{XSLT-NAME}&quot;]/&gt;</b></dt>
  <dd class="It-tag">This tag defines which XSLT templates this Job
      Configuration depends on. It must be at least one &lt;xslt/&gt; present.
      If no <b>name</b> attribute exists, it is defined as the default XSLT
      file. When the <b>name</b> attribute is set, this XSLT file is used when
      using the <i>--xslt-name</i> option.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>&lt;arguments/&gt;</b></dt>
  <dd class="It-tag">All variable options the defined XSLT template needs must
      be configured in separate &lt;arg/&gt; tags inside this tag.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>&lt;arg section=&quot;recipe&quot;
    type=&quot;{string|bool}&quot;&gt;</b></dt>
  <dd class="It-tag">Each option individually is defined by &lt;arg/&gt; tags.
      The <b>section</b> and <b>type</b> attributes are mandatory. Currently
      only the <b>recipe</b> section is supported. The <b>type</b> attribute
      defines the type of argument. If the <b>type</b> attribute is set to
      <b>bool</b> it will define a command line argument which takes no
      arguments. If this argument is given to <b>bkr workflow-xslt</b>, it will
      result in the tag or attribute value being set to <b>true</b>. The
      <b>optional</b> attribute is optional. If set to <b>1</b> it will make
      this argument purely optional. The default is to require the
    argument.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>&lt;name short=&quot;{short arg}&quot;/&gt;</b></dt>
  <dd class="It-tag">The &lt;name/&gt; defines the short and long option names.
      The <b>short</b> attribute is mandatory and can only be one character. If
      the same argument name is defined several times, the last defined argument
      will override all other conflicting arguments.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>&lt;tag type=&quot;{attribute|value|list}&quot;
    [attrname=&quot;{Attribute name}&quot;] [element_tag=&quot;{list element tag
    name}&quot;]/&gt;</b></dt>
  <dd class="It-tag">This tag defines which XML tag name the internal XML tag
      the option value will be stored under. The <b>type</b> attribute is
      mandatory and can be either <b>attribute</b>, <b>value</b> or <b>list</b>.
      When set to <b>value</b> the option value given at the command line of
      <b>bkr workflow-xslt</b> will be embraced by the defined tag name. If
      <b>type</b> is set to <b>attribute</b> the option value from the command
      line will be placed as an attribute value to the defined XML tag name.
      When using <b>attribute</b> the <b>attrname</b> attribute is mandatory.
      This attribute defines the attribute name to be used in the internal XML.
      If <b>type</b> is set to <b>list</b>, it will create a list of XML tags
      based on the value string. The default value for the children of the tag
      name is 'value', unless the <b>element_tag</b> is set. The value string
      will be split into separate tokens using comma (,) as the separator.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>&lt;default/&gt;</b></dt>
  <dd class="It-tag">This tag is optional. It will set a default value if this
      option is not used on the command line.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>&lt;description/&gt;</b></dt>
  <dd class="It-tag">This tag is used for the <b>--help</b> screen, describing
      the command line option to <b>bkr workflow-xslt</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>&lt;metavar/&gt;</b></dt>
  <dd class="It-tag">This is used for the <b>--help</b> screen as well. This is
      used as a substitute for the variable contents, purely for. To make it
      obvious, it is recommended to put use capital letters.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Example"><a class="selflink" href="#Example">Example</a></h2>
Save the contents below as <b>example-job.xml</b>:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;jobConfig&gt;
  &lt;name&gt;Example Job&lt;/name&gt;
  &lt;xslt&gt;example.xsl&lt;/xslt&gt;
  &lt;arguments&gt;
    &lt;arg section=&quot;recipe&quot; type=&quot;string&quot;&gt;
      &lt;name short=&quot;i&quot;&gt;id&lt;/name&gt;
      &lt;metavar&gt;INTEGER&lt;/metavar&gt;
      &lt;tag type=&quot;attribute&quot; attrname=&quot;version&quot;&gt;name&lt;/tag&gt;
      &lt;description&gt;Unique numeric ID&lt;/description&gt;
    &lt;/arg&gt;
    &lt;arg section=&quot;recipe&quot; type=&quot;string&quot;&gt;
      &lt;name short=&quot;n&quot;&gt;name&lt;/name&gt;
      &lt;metavar&gt;FULL-NAME&lt;/metavar&gt;
      &lt;tag type=&quot;value&quot;&gt;name&lt;/tag&gt;
      &lt;description&gt;Full name&lt;/description&gt;
    &lt;/arg&gt;
    &lt;arg section=&quot;recipe&quot; type=&quot;string&quot; optional=&quot;1&quot;&gt;
      &lt;name short=&quot;g&quot;&gt;group&lt;/name&gt;
      &lt;metavar&gt;GROUP-NAME&lt;/metavar&gt;
      &lt;tag type=&quot;attribute&quot; attrname=&quot;group&quot;&gt;name&lt;/tag&gt;
      &lt;description&gt;Group identifier&lt;/description&gt;
    &lt;/arg&gt;
    &lt;arg section=&quot;recipe&quot; type=&quot;string&quot; optional=&quot;1&quot;&gt;
      &lt;name&gt;phone-numbers&lt;/name&gt;
      &lt;metavar&gt;PHONE\-NUMBERS&lt;/metavar&gt;
      &lt;tag type=&quot;list&quot; element_tag=&quot;number&quot;&gt;phones&lt;/tag&gt;
      &lt;description&gt;List of phone numbers, comma separated&lt;/description&gt;
   &lt;/arg&gt;
  &lt;/arguments&gt;
&lt;/jobConfig&gt;
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Save this dummy XSLT file as <b>example.xsl</b>:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;xsl:stylesheet version=&quot;1.0&quot;
        xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt;
   &lt;xsl:output method=&quot;xml&quot; version=&quot;1.0&quot;
           encoding=&quot;UTF-8&quot; indent=&quot;yes&quot;/&gt;
&lt;/xsl:stylesheet&gt;
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Run from a terminal the following command:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ bkr workflow-xslt --dry-run --job-xml example-job.xml \\
     --save-internal-xml example.xml \\
     -i 99 -n &quot;Example&quot; -g &quot;Group1&quot; --phone-numbers 123,456,789
----------------------------------------------------
Generating Beaker XML
   Job config:    example-job.xml
   XSLT template: example.xsl
   Job name:      Example Job
   Whiteboard:    None
   Job arguments:
      - group: Group1
      - id: 99
      - name: Example
----------------------------------------------------
$ cat example.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;submit&gt;
   &lt;whiteboard/&gt;
   &lt;recipe&gt;
     &lt;phones&gt;
        &lt;number&gt;123&lt;/number&gt;
        &lt;number&gt;456&lt;/number&gt;
        &lt;number&gt;789&lt;/number&gt;
     &lt;/phones&gt;
     &lt;name group=&quot;Group1&quot; version=&quot;99&quot;&gt;Example&lt;/name&gt;
   &lt;/recipe&gt;
&lt;/submit&gt;
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Setting_defaults"><a class="selflink" href="#Setting_defaults">Setting
  defaults</a></h2>
It is possible to define defaults in a separate file. This is useful if you
  often use the same Job Configuration or have other arguments which do not
  change so often. Two files are attempted read upon startup:
  <b>~/.beaker_client/bks-defaults</b> and <b>./bks-defaults</b>.
<div style="height: 1.00em;">&#x00A0;</div>
The bks-defaults file is an INI-styled configuration file. It requires a
  <b>[defaults]</b> section which has one parameter, <b>jobxml</b>.
<div style="height: 1.00em;">&#x00A0;</div>
You can set individual default values depending on which Job XML Configuration
  you are using. Use the Job XML Configuration filename as the section name. The
  parameters uses the long options of the Job Configuration to define the
  default values.
<h2 class="Ss" title="Ss" id="Example"><a class="selflink" href="#Example">Example</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
[defaults]
jobxml: example-job.xml
<div class="Pp"></div>
[example-job.xml]
group: Group1
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Default_profiles"><a class="selflink" href="#Default_profiles">Default
  profiles</a></h2>
It is possible to define several sets of default values for the same Job XML
  Configuration. This is used by appending :&lt;profilename&gt; to the section
  name. Notice the 'colon'.
<h2 class="Ss" title="Ss" id="Example"><a class="selflink" href="#Example">Example</a></h2>
This builds upon the example above:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
[example-job.xml:setup2]
group: Group2b
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
To run the example in the Example section above, execute:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ bkr workflow-xslt --dry-run --save-internal-xml example.xml \\
    -i 99 -n &quot;Example&quot;
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This will use the value <b>Group1</b> as a default value in the <b>group</b>
  attribute. If you instead do this:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ bkr workflow-xslt --dry-run --profile setup2 \\
    --save-internal-xml example.xml \\
    -i 99 -n &quot;Example&quot;
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
the generated example.xml will have the value <b>Group2b</b> as a default value
  in the <b>group</b> attribute.
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
David Sommerseth &lt;davids@redhat.com&gt;
<h1 class="Sh" title="Sh" id="COPYRIGHT"><a class="selflink" href="#COPYRIGHT">COPYRIGHT</a></h1>
2013, Red Hat, Inc</div>
<table class="foot">
  <tr>
    <td class="foot-date">May 30, 2017</td>
    <td class="foot-os">24.3</td>
  </tr>
</table>
</body>
</html>
