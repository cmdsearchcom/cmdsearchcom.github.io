<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 15:55:16 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>BKR-WORKFLOW-XSLT(1) Beaker BKR-WORKFLOW-XSLT(1)</p>

<p style="margin-top: 1em">NAME <br>
bkr-workflow-xslt - XSLT-based Beaker job generator</p>

<p style="margin-top: 1em">SYNOPSIS <br>
bkr workflow-xslt [options] <br>
[--defaults=&lt;filename&gt;]
[--profile=&lt;profile-name&gt;]
[--job-xml=&lt;filename&gt;] <br>
[--dry-run | --wait] <br>
[--xslt-override=&lt;filename&gt;]
[--xslt-name=&lt;name&gt;] [--whiteboard=&lt;text&gt;] <br>
[--save-xml=&lt;filename&gt;]
[--save-internal-xml=&lt;filename&gt;] <br>
[job-specific options]</p>

<p style="margin-top: 1em">Job-specific options are defined
in the Job Configuration XML, and will be described with
--help.</p>

<p style="margin-top: 1em">DESCRIPTION <br>
This program will use a Job Configuration XML file which
defines variables useful in a kernel workflow. It will use
this information to process the generate a Beaker job XML
<br>
document, as defined in the configured XSLT files.</p>

<p style="margin-top: 1em">Beaker arguments <br>
Common bkr options are described in the Options section of
bkr(1). Note that, in spite of its name, this program does
not accept the common workflow options described in the <br>
Workflow options section of bkr(1).</p>

<p style="margin-top: 1em">It is important that the
arguments in this section comes before any other options.
These arguments define how the rest of the arguments should
be processed and their default val&acirc; <br>
ues.</p>

<p style="margin-top: 1em">--defaults &lt;filename&gt; <br>
Adds more default values in addition to what may be
configured in ~/.beaker-client/bks-defaults and
./bks-defaults.</p>

<p style="margin-top: 1em">--profile &lt;profile-name&gt;
<br>
The defaults files can be configured with different profiles
for the same Job XML file. This argument will define which
profile set to use for default values.</p>

<p style="margin-top: 1em">--job-xml &lt;filename&gt; <br>
Defines which Job XML Configuration file to load. This
argument is mandatory, unless configured in a defaults
file.</p>

<p style="margin-top: 1em">--dry-run <br>
When this option is used, the job will not be sent to the
Beaker scheduler at all. If you don&rsquo;t use --save-xml
or --save-internal-xml the generated Beaker job XML will be
<br>
dumped to stdout.</p>

<p style="margin-top: 1em">--wait This will cause the bkr
workflow-xslt operation to wait for the Beaker job to
complete before exiting.</p>

<p style="margin-top: 1em">Global job arguments <br>
The global options are specific to the bkr workflow-xslt
module, and will use the defaults as defined in the SETTINGS
ARGUMENTS. Short arguments may be overrided by the Job XML
<br>
definition.</p>

<p style="margin-top: 1em">--xslt-override &lt;filename&gt;
<br>
This will override the configured XSLT file defined in the
Job Configuration.</p>

<p style="margin-top: 1em">-X &lt;name&gt;, --xslt-name
&lt;name&gt; <br>
The Job Configuration can have several XSLT templates
configured. This option will define which XSLT to use. If
this option is not set, it will use the XSLT template which
<br>
has no name configured.</p>

<p style="margin-top: 1em">-W &lt;text&gt;, --whiteboard
&lt;text&gt; <br>
Adds the given &lt;text&gt; as a text for the Beaker job
whiteboard.</p>

<p style="margin-top: 1em">--save-xml &lt;filename&gt; <br>
Saves the generated Beaker Job XML to the given
&lt;filename&gt;.</p>

<p style="margin-top: 1em">--save-internal-xml
&lt;filename&gt; <br>
Saves the internal XML document which is passed to the XSLT
processor to the given &lt;filename&gt;. This is useful
during debugging.</p>

<p style="margin-top: 1em">Job XML configuration <br>
A Job XML Configuration is needed to be able to generate XML
files to the Beaker scheduler. The purpose of the Job XML
Configuration is to define which parameters and variables
<br>
which are needed for the XSLT processing to work. This
configuration will also define parts of the XML document
being sent to the XSLT processor. This configuration file is
also <br>
an XML document.</p>

<p style="margin-top: 1em">It will not be explained how to
write the needed XSLT documents in this manual.</p>

<p style="margin-top: 1em">The structure <br>
&lt;JobConfig&gt; <br>
&lt;name&gt;{Descriptive name of the job
configuration}&lt;/name&gt; <br>
&lt;xslt&gt;{Default XSLT file}&lt;/xslt&gt; <br>
[&lt;xslt name=&quot;variant2&quot;&gt;{Named XSLT
file}&lt;/xslt&gt;] <br>
[...more &lt;xslt/&gt; tags...] <br>
&lt;arguments&gt; <br>
&lt;arg section=&quot;recipe&quot;
type=&quot;{string|bool}&quot; [optional=&quot;1&quot;]&gt;
<br>
&lt;name short=&quot;a&quot;&gt;{long argument}&lt;/name&gt;
<br>
&lt;tag type=&quot;{tagtype}&quot;&gt;{XML tag
name}&lt;/tag&gt; <br>
[&lt;default&gt;{default value}&lt;/default&gt;] <br>
&lt;description&gt;{Argument description&lt;/description&gt;
<br>
&lt;metavar&gt;{Descriptive value
substitution&lt;metavar&gt; <br>
&lt;/arg&gt; <br>
[...more &lt;arg/&gt; tags...] <br>
&lt;/arguments&gt; <br>
&lt;/JobConfig&gt;</p>

<p style="margin-top: 1em">Tag descriptions <br>
&lt;JobConfig/&gt; <br>
The XML root node must be a &lt;JobConfig/&gt; tag.</p>

<p style="margin-top: 1em">&lt;name/&gt; <br>
The first &lt;name/&gt; in &lt;JobConfig/&gt; is a plain and
short string describing the purpose of this Job
Configuration.</p>

<p style="margin-top: 1em">&lt;xslt
[name=&quot;{XSLT-NAME}&quot;]/&gt; <br>
This tag defines which XSLT templates this Job Configuration
depends on. It must be at least one &lt;xslt/&gt; present.
If no name attribute exists, it is defined as the <br>
default XSLT file. When the name attribute is set, this XSLT
file is used when using the --xslt-name option.</p>

<p style="margin-top: 1em">&lt;arguments/&gt; <br>
All variable options the defined XSLT template needs must be
configured in separate &lt;arg/&gt; tags inside this
tag.</p>

<p style="margin-top: 1em">&lt;arg
section=&quot;recipe&quot;
type=&quot;{string|bool}&quot;&gt; <br>
Each option individually is defined by &lt;arg/&gt; tags.
The section and type attributes are mandatory. Currently
only the recipe section is supported. The type attribute
<br>
defines the type of argument. If the type attribute is set
to bool it will define a command line argument which takes
no arguments. If this argument is given to bkr <br>
workflow-xslt, it will result in the tag or attribute value
being set to true. The optional attribute is optional. If
set to 1 it will make this argument purely <br>
optional. The default is to require the argument.</p>

<p style="margin-top: 1em">&lt;name short=&quot;{short
arg}&quot;/&gt; <br>
The &lt;name/&gt; defines the short and long option names.
The short attribute is mandatory and can only be one
character. If the same argument name is defined several
times, <br>
the last defined argument will override all other
conflicting arguments.</p>

<p style="margin-top: 1em">&lt;tag
type=&quot;{attribute|value|list}&quot;
[attrname=&quot;{Attribute name}&quot;]
[element_tag=&quot;{list element tag name}&quot;]/&gt; <br>
This tag defines which XML tag name the internal XML tag the
option value will be stored under. The type attribute is
mandatory and can be either attribute, value or <br>
list. When set to value the option value given at the
command line of bkr workflow-xslt will be embraced by the
defined tag name. If type is set to attribute the option
<br>
value from the command line will be placed as an attribute
value to the defined XML tag name. When using attribute the
attrname attribute is mandatory. This attribute <br>
defines the attribute name to be used in the internal XML.
If type is set to list, it will create a list of XML tags
based on the value string. The default value for <br>
the children of the tag name is &rsquo;value&rsquo;, unless
the element_tag is set. The value string will be split into
separate tokens using comma (,) as the separator.</p>

<p style="margin-top: 1em">&lt;default/&gt; <br>
This tag is optional. It will set a default value if this
option is not used on the command line.</p>

<p style="margin-top: 1em">&lt;description/&gt; <br>
This tag is used for the --help screen, describing the
command line option to bkr workflow-xslt.</p>

<p style="margin-top: 1em">&lt;metavar/&gt; <br>
This is used for the --help screen as well. This is used as
a substitute for the variable contents, purely for. To make
it obvious, it is recommended to put use capital <br>
letters.</p>

<p style="margin-top: 1em">Example <br>
Save the contents below as example-job.xml:</p>

<p style="margin-top: 1em">&lt;?xml
version=&quot;1.0&quot;?&gt; <br>
&lt;jobConfig&gt; <br>
&lt;name&gt;Example Job&lt;/name&gt; <br>
&lt;xslt&gt;example.xsl&lt;/xslt&gt; <br>
&lt;arguments&gt; <br>
&lt;arg section=&quot;recipe&quot;
type=&quot;string&quot;&gt; <br>
&lt;name short=&quot;i&quot;&gt;id&lt;/name&gt; <br>
&lt;metavar&gt;INTEGER&lt;/metavar&gt; <br>
&lt;tag type=&quot;attribute&quot;
attrname=&quot;version&quot;&gt;name&lt;/tag&gt; <br>
&lt;description&gt;Unique numeric ID&lt;/description&gt;
<br>
&lt;/arg&gt; <br>
&lt;arg section=&quot;recipe&quot;
type=&quot;string&quot;&gt; <br>
&lt;name short=&quot;n&quot;&gt;name&lt;/name&gt; <br>
&lt;metavar&gt;FULL-NAME&lt;/metavar&gt; <br>
&lt;tag type=&quot;value&quot;&gt;name&lt;/tag&gt; <br>
&lt;description&gt;Full name&lt;/description&gt; <br>
&lt;/arg&gt; <br>
&lt;arg section=&quot;recipe&quot; type=&quot;string&quot;
optional=&quot;1&quot;&gt; <br>
&lt;name short=&quot;g&quot;&gt;group&lt;/name&gt; <br>
&lt;metavar&gt;GROUP-NAME&lt;/metavar&gt; <br>
&lt;tag type=&quot;attribute&quot;
attrname=&quot;group&quot;&gt;name&lt;/tag&gt; <br>
&lt;description&gt;Group identifier&lt;/description&gt; <br>
&lt;/arg&gt; <br>
&lt;arg section=&quot;recipe&quot; type=&quot;string&quot;
optional=&quot;1&quot;&gt; <br>
&lt;name&gt;phone-numbers&lt;/name&gt; <br>
&lt;metavar&gt;PHONE&minus;NUMBERS&lt;/metavar&gt; <br>
&lt;tag type=&quot;list&quot;
element_tag=&quot;number&quot;&gt;phones&lt;/tag&gt; <br>
&lt;description&gt;List of phone numbers, comma
separated&lt;/description&gt; <br>
&lt;/arg&gt; <br>
&lt;/arguments&gt; <br>
&lt;/jobConfig&gt;</p>

<p style="margin-top: 1em">Save this dummy XSLT file as
example.xsl:</p>

<p style="margin-top: 1em">&lt;?xml
version=&quot;1.0&quot;?&gt; <br>
&lt;xsl:stylesheet version=&quot;1.0&quot; <br>

xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt;
<br>
&lt;xsl:output method=&quot;xml&quot;
version=&quot;1.0&quot; <br>
encoding=&quot;UTF-8&quot; indent=&quot;yes&quot;/&gt; <br>
&lt;/xsl:stylesheet&gt;</p>

<p style="margin-top: 1em">Run from a terminal the
following command:</p>

<p style="margin-top: 1em">$ bkr workflow-xslt --dry-run
--job-xml example-job.xml \ <br>
--save-internal-xml example.xml \ <br>
-i 99 -n &quot;Example&quot; -g &quot;Group1&quot;
--phone-numbers 123,456,789 <br>
---------------------------------------------------- <br>
Generating Beaker XML <br>
Job config: example-job.xml <br>
XSLT template: example.xsl <br>
Job name: Example Job <br>
Whiteboard: None <br>
Job arguments: <br>
- group: Group1 <br>
- id: 99 <br>
- name: Example <br>
---------------------------------------------------- <br>
$ cat example.xml <br>
&lt;?xml version=&quot;1.0&quot;
encoding=&quot;UTF-8&quot;?&gt; <br>
&lt;submit&gt; <br>
&lt;whiteboard/&gt; <br>
&lt;recipe&gt; <br>
&lt;phones&gt; <br>
&lt;number&gt;123&lt;/number&gt; <br>
&lt;number&gt;456&lt;/number&gt; <br>
&lt;number&gt;789&lt;/number&gt; <br>
&lt;/phones&gt; <br>
&lt;name group=&quot;Group1&quot;
version=&quot;99&quot;&gt;Example&lt;/name&gt; <br>
&lt;/recipe&gt; <br>
&lt;/submit&gt;</p>

<p style="margin-top: 1em">Setting defaults <br>
It is possible to define defaults in a separate file. This
is useful if you often use the same Job Configuration or
have other arguments which do not change so often. Two files
<br>
are attempted read upon startup:
~/.beaker_client/bks-defaults and ./bks-defaults.</p>

<p style="margin-top: 1em">The bks-defaults file is an
INI-styled configuration file. It requires a [defaults]
section which has one parameter, jobxml.</p>

<p style="margin-top: 1em">You can set individual default
values depending on which Job XML Configuration you are
using. Use the Job XML Configuration filename as the section
name. The parameters uses the <br>
long options of the Job Configuration to define the default
values.</p>

<p style="margin-top: 1em">Example <br>
[defaults] <br>
jobxml: example-job.xml</p>

<p style="margin-top: 1em">[example-job.xml] <br>
group: Group1</p>

<p style="margin-top: 1em">Default profiles <br>
It is possible to define several sets of default values for
the same Job XML Configuration. This is used by appending
:&lt;profilename&gt; to the section name. Notice the
&rsquo;colon&rsquo;.</p>

<p style="margin-top: 1em">Example <br>
This builds upon the example above:</p>

<p style="margin-top: 1em">[example-job.xml:setup2] <br>
group: Group2b</p>

<p style="margin-top: 1em">To run the example in the
Example section above, execute:</p>

<p style="margin-top: 1em">$ bkr workflow-xslt --dry-run
--save-internal-xml example.xml \ <br>
-i 99 -n &quot;Example&quot;</p>

<p style="margin-top: 1em">This will use the value Group1
as a default value in the group attribute. If you instead do
this:</p>

<p style="margin-top: 1em">$ bkr workflow-xslt --dry-run
--profile setup2 \ <br>
--save-internal-xml example.xml \ <br>
-i 99 -n &quot;Example&quot;</p>

<p style="margin-top: 1em">the generated example.xml will
have the value Group2b as a default value in the group
attribute.</p>

<p style="margin-top: 1em">AUTHOR <br>
David Sommerseth &lt;davids@redhat.com&gt;</p>

<p style="margin-top: 1em">COPYRIGHT <br>
2013, Red Hat, Inc</p>

<p style="margin-top: 1em">24.3 May 30, 2017
BKR-WORKFLOW-XSLT(1)</p>
<hr>
</body>
</html>
