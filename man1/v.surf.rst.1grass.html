<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:42:38 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>v.surf.rst(1grass) Grass User&rsquo;s Manual
v.surf.rst(1grass)</p>

<p style="margin-top: 1em">NAME <br>
v.surf.rst - Performs surface interpolation from vector
points map by splines. <br>
Spatial approximation and topographic analysis from given
point or isoline data in vector format to floating point
raster format using regularized spline with tension.</p>

<p style="margin-top: 1em">KEYWORDS <br>
vector, surface, interpolation, 3D</p>

<p style="margin-top: 1em">SYNOPSIS <br>
v.surf.rst <br>
v.surf.rst --help <br>
v.surf.rst [-ctd] input=name [layer=string] [zcolumn=name]
[where=sql_query] [elevation=name] [slope=name]
[aspect=name] [pcurvature=name] [tcurvature=name] <br>
[mcurvature=name] [deviations=name] [cvdev=name]
[treeseg=name] [overwin=name] [mask=name] [tension=float]
[smooth=float] [smooth_column=string] [segmax=inte&acirc;
<br>
ger] [npmin=integer] [dmin=float] [dmax=float]
[zscale=float] [theta=float] [scalex=float] [--overwrite]
[--help] [--verbose] [--quiet] [--ui]</p>

<p style="margin-top: 1em">Flags: <br>
-c <br>
Perform cross-validation procedure without raster
approximation</p>

<p style="margin-top: 1em">-t <br>
Use scale dependent tension</p>

<p style="margin-top: 1em">-d <br>
Output partial derivatives instead of topographic
parameters</p>

<p style="margin-top: 1em">--overwrite <br>
Allow output files to overwrite existing files</p>

<p style="margin-top: 1em">--help <br>
Print usage summary</p>

<p style="margin-top: 1em">--verbose <br>
Verbose module output</p>

<p style="margin-top: 1em">--quiet <br>
Quiet module output</p>

<p style="margin-top: 1em">--ui <br>
Force launching GUI dialog</p>

<p style="margin-top: 1em">Parameters: <br>
input=name [required] <br>
Name of input vector map <br>
Or data source for direct OGR access</p>

<p style="margin-top: 1em">layer=string <br>
Layer number or name <br>
Vector features can have category values in different
layers. This number determines which layer to use. When used
with direct OGR access this is the layer name. <br>
Default: 1</p>

<p style="margin-top: 1em">zcolumn=name <br>
Name of the attribute column with values to be used for
approximation <br>
If not given and input is 2D vector map then category values
are used. If input is 3D vector map then z-coordinates are
used.</p>

<p style="margin-top: 1em">where=sql_query <br>
WHERE conditions of SQL statement without
&acirc;where&acirc; keyword <br>
Example: income &lt; 1000 and inhab &gt;= 10000</p>

<p style="margin-top: 1em">elevation=name <br>
Name for output surface elevation raster map</p>

<p style="margin-top: 1em">slope=name <br>
Name for output slope raster map</p>

<p style="margin-top: 1em">aspect=name <br>
Name for output aspect raster map</p>

<p style="margin-top: 1em">pcurvature=name <br>
Name for output profile curvature raster map</p>

<p style="margin-top: 1em">tcurvature=name <br>
Name for output tangential curvature raster map</p>

<p style="margin-top: 1em">mcurvature=name <br>
Name for output mean curvature raster map</p>

<p style="margin-top: 1em">deviations=name <br>
Name for output deviations vector point map</p>

<p style="margin-top: 1em">cvdev=name <br>
Name for output cross-validation errors vector point map</p>

<p style="margin-top: 1em">treeseg=name <br>
Name for output vector map showing quadtree segmentation</p>

<p style="margin-top: 1em">overwin=name <br>
Name for output vector map showing overlapping windows</p>

<p style="margin-top: 1em">mask=name <br>
Name of raster map used as mask</p>

<p style="margin-top: 1em">tension=float <br>
Tension parameter <br>
Default: 40.</p>

<p style="margin-top: 1em">smooth=float <br>
Smoothing parameter</p>

<p style="margin-top: 1em">smooth_column=string <br>
Name of the attribute column with smoothing parameters</p>

<p style="margin-top: 1em">segmax=integer <br>
Maximum number of points in a segment <br>
Default: 40</p>

<p style="margin-top: 1em">npmin=integer <br>
Minimum number of points for approximation in a segment
(&gt;segmax) <br>
Default: 300</p>

<p style="margin-top: 1em">dmin=float <br>
Minimum distance between points (to remove almost identical
points)</p>

<p style="margin-top: 1em">dmax=float <br>
Maximum distance between points on isoline (to insert
additional points)</p>

<p style="margin-top: 1em">zscale=float <br>
Conversion factor for values used for approximation <br>
Default: 1.0</p>

<p style="margin-top: 1em">theta=float <br>
Anisotropy angle (in degrees counterclockwise from East)</p>

<p style="margin-top: 1em">scalex=float <br>
Anisotropy scaling factor</p>

<p style="margin-top: 1em">DESCRIPTION <br>
v.surf.rst program performs spatial approximation based on
z-values (input vector map is 3D and zcolumn parameter is
not given), categories (input vector map is 2D and zcolumn
<br>
parameter is not given), or attributes (zcolumn parameter is
given) of point or isoline data given in a vector map named
input to grid cells in the output raster map elevation <br>
representing a surface.</p>

<p style="margin-top: 1em">As an option, simultaneously
with approximation, topographic parameters slope, aspect,
profile curvature (measured in the direction of the steepest
slope), tangential curvature <br>
(measured in the direction of a tangent to contour line) or
mean curvature are computed and saved as raster maps
specified by the options slope, aspect, pcurv, tcurv, mcurv
<br>
respectively. If -d flag is set, v.surf.rst outputs partial
derivatives fx,fy,fxx, fyy,fxy instead of slope, aspect,
profile, tangential and mean curvatures respectively. If the
<br>
input vector map have time stamp, the program creates time
stamp for all output maps.</p>

<p style="margin-top: 1em">User can either use r.maskto set
a mask or specify a raster map in mask option, which will be
used as a mask. The approximation is skipped for cells which
have zero or NULL value <br>
in mask. NULL values will be assigned to these cells in all
output raster maps. Data points are checked for identical
points and points that are closer to each other than the
<br>
given dmin are removed. If sparsely digitized contours or
isolines are used as input, additional points are computed
between each 2 points on a line if the distance between them
<br>
is greater than specified dmax. Parameter zmult allows user
to rescale the values used for approximation (useful e.g.
for transformation of elevations given in feet to meters, so
<br>
that the proper values of slopes and curvatures can be
computed).</p>

<p style="margin-top: 1em">Regularized spline with tension
is used for the approximation. The tension parameter tunes
the character of the resulting surface from thin plate to
membrane. Smoothing parameter <br>
smooth controls the deviation between the given points and
the resulting surface and it can be very effective in
smoothing noisy data while preserving the geometrical
properties <br>
of the surface. With the smoothing parameter set to zero
(smooth=0) the resulting surface passes exactly through the
data points (spatial interpolation is performed). When <br>
smoothing parameter is used, it is also possible to output a
vector point map deviations containing deviations of the
resulting surface from the given data.</p>

<p style="margin-top: 1em">If the number of given points is
greater than segmax, segmented processing is used. The
region is split into quadtree-based rectangular segments,
each having less than segmax <br>
points and approximation is performed on each segment of the
region. To ensure smooth connection of segments the
approximation function for each segment is computed using
the <br>
points in the given segment and the points in its
neighborhood which are in the rectangular window surrounding
the given segment. The number of points taken for
approximation is <br>
controlled by npmin, the value of which must be larger than
segmax. User can choose to output vector maps treeseg and
overwin which represent the quad tree used for segmentation
<br>
and overlapping neighborhoods from which additional points
for approximation on each segment were taken.</p>

<p style="margin-top: 1em">Predictive error of surface
approximation for given parameters can be computed using the
-c flag. A crossvalidation procedure is then performed using
the data given in the vector <br>
map input and the estimated predictive errors are stored in
the vector point map cvdev. When using this flag, no raster
output maps are computed. Anisotropic surfaces can be <br>
interpolated by setting anisotropy angle theta and scaling
factor scalex. The program writes values of selected input
and internally computed parameters to the history file of
<br>
raster map elevation.</p>

<p style="margin-top: 1em">The user must run g.region
before the program to set the region and resolution for
approximation.</p>

<p style="margin-top: 1em">NOTES <br>
v.surf.rst uses regularized spline with tension for
approximation from vector data. The module does not require
input data with topology, therefore both level1 (no
topology) and <br>
level2 (with topology) vector point data are supported.
Additional points are used for approximation between each 2
points on a line if the distance between them is greater
than <br>
specified dmax. If dmax is small (less than cell size) the
number of added data points can be vary large and slow down
approximation significantly. The implementation has a
seg&acirc; <br>
mentation procedure based on quadtrees which enhances the
efficiency for large data sets. Special color tables are
created by the program for output raster maps.</p>

<p style="margin-top: 1em">Topographic parameters are
computed directly from the approximation function so that
the important relationships between these parameters are
preserved. The equations for compu&acirc; <br>
tation of these parameters and their interpretation is
described in Mitasova and Hofierka, 1993 or Neteler and
Mitasova, 2004). Slopes and aspect are computed in degrees
(0-90 <br>
and 1-360 respectively). The aspect raster map has value 0
assigned to flat areas (with slope less than 0.1%) and to
singular points with undefined aspect. Aspect points
downs&acirc; <br>
lope and is 90 to the North, 180 to the West, 270 to the
South and 360 to the East, the values increase
counterclockwise. Curvatures are positive for convex and
negative for con&acirc; <br>
cave areas. Singular points with undefined curvatures have
assigned zero values.</p>

<p style="margin-top: 1em">Tension and smoothing allow user
to tune the surface character. For most landscape scale
applications the default values should provide adequate
results. The program gives <br>
warning when significant overshoots appear in the resulting
surface and higher tension or smoothing should be used.</p>

<p style="margin-top: 1em">To select parameters that will
produce a surface with desired properties, it is useful to
know that the method is scale dependent and the tension
works as a rescaling parameter <br>
(high tension &quot;increases the distances between the
points&quot; and reduces the range of impact of each point,
low tension &quot;decreases the distance&quot; and the
points influence each other <br>
over longer range). Surface with tension set too high
behaves like a membrane (rubber sheet stretched over the
data points) with peak or pit (&quot;crater&quot;) in each
given point and <br>
everywhere else the surface goes rapidly to trend. If
digitized contours are used as input data, high tension can
cause artificial waves along contours. Lower tension and
higher <br>
smoothing is suggested for such a case.</p>

<p style="margin-top: 1em">Surface with tension set too low
behaves like a stiff steel plate and overshoots can appear
in areas with rapid change of gradient and segmentation can
be visible. Increase in <br>
tension should solve the problems.</p>

<p style="margin-top: 1em">There are two options how
tension can be applied in relation to dnorm (dnorm rescales
the coordinates depending on the average data density so
that the size of segments with seg&acirc; <br>
max=40 points is around 1 - this ensures the numerical
stability of the computation):</p>

<p style="margin-top: 1em">1 Default: the given tension is
applied to normalized data (x/dnorm), that means that the
distances are multiplied (rescaled) by tension/dnorm. If
density of points is <br>
changed, e.g., by using higher dmin, the dnorm changes and
tension needs to be changed too to get the same result.
Because the tension is applied to normalized data its <br>
suitable value is usually within the 10-100 range and does
not depend on the actual scale (distances) of the original
data (which can be km for regional applications or cm <br>
for field experiments).</p>

<p style="margin-top: 1em">2 Flag-t: The given tension is
applied to un-normalized data (rescaled tension =
tension*dnorm/1000 is applied to normalized data (x/dnorm)
and therefore dnorm cancels out) <br>
so here tension truly works as a rescaling parameter. For
regional applications with distances between points in km.
the suitable tension can be 500 or higher, for <br>
detailed field scale analysis it can be 0.1. To help select
how much the data need to be rescaled the program writes
dnorm and rescaled tension fi=tension*dnorm/1000 at <br>
the beginning of the program run. This rescaled tension
should be around 20-30. If it is lower or higher, the given
tension parameter should be changed accordingly.</p>

<p style="margin-top: 1em">The default is a recommended
choice, however for the applications where the user needs to
change density of data and preserve the approximation
character the -t flag can be help&acirc; <br>
ful.</p>

<p style="margin-top: 1em">Anisotropic data (e.g. geologic
phenomena) can be interpolated using theta and scalex
defining orientation and ratio of the perpendicular axes put
on the longest/shortest side of <br>
the feature, respectively. Theta is measured in degrees from
East, counterclockwise. Scalex is a ratio of axes sizes.
Setting scalex in the range 0-1, results in a pattern
pro&acirc; <br>
longed in the direction defined by theta. Scalex value 0.5
means that modeled feature is approximately 2 times longer
in the direction of theta than in the perpendicular
direc&acirc; <br>
tion. Scalex value 2 means that axes ratio is reverse
resulting in a pattern perpendicular to the previous
example. Please note that anisotropy option has not been
extensively <br>
tested and may include bugs (for example, topographic
parameters may not be computed correctly) - if there are
problems, please report to GRASS bugtracker (accessible from
<br>
http://grass.osgeo.org/).</p>

<p style="margin-top: 1em">For data with values changing
over several magnitudes (sometimes the concentration or
density data) it is suggested to interpolate the log of the
values rather than the original <br>
ones.</p>

<p style="margin-top: 1em">v.surf.rst checks the numerical
stability of the algorithm by computing the values in given
points, and prints the root mean square deviation (rms)
found into the history file of <br>
raster map elevation. For computation with smoothing set to
0, rms should be 0. Significant increase in tension is
suggested if the rms is unexpectedly high for this case.
With <br>
smoothing parameter greater than zero the surface will not
pass exactly through the data points and the higher the
parameter the closer the surface will be to the trend. The
rms <br>
then represents a measure of smoothing effect on data. More
detailed analysis of smoothing effects can be performed
using the output deviations option.</p>

<p style="margin-top: 1em">v.surf.rst also writes the
values of parameters used in computation into the comment
part of history file elevation as well as the following
values which help to evaluate the <br>
results and choose the suitable parameters: minimum and
maximum z values in the data file (zmin_data, zmax_data) and
in the interpolated raster map (zmin_int, zmax_int),
rescal&acirc; <br>
ing parameter used for normalization (dnorm), which
influences the tension.</p>

<p style="margin-top: 1em">If visible connection of
segments appears, the program should be rerun with higher
npmin to get more points from the neighborhood of given
segment and/or with higher tension.</p>

<p style="margin-top: 1em">When the number of points in a
vector map is not too large (less than 800), the user can
skip segmentation by setting segmax to the number of data
points or segmax=700.</p>

<p style="margin-top: 1em">v.surf.rst gives warning when
user wants to interpolate outside the rectangle given by
minimum and maximum coordinates in the vector map, zoom into
the area where the given data <br>
are is suggested in this case.</p>

<p style="margin-top: 1em">When a mask is used, the program
takes all points in the given region for approximation,
including those in the area which is masked out, to ensure
proper approximation along the <br>
border of the mask. It therefore does not mask out the data
points, if this is desirable, it must be done outside
v.surf.rst.</p>

<p style="margin-top: 1em">Cross validation procedure <br>
The &quot;optimal&quot; approximation parameters for given
data can be found using a cross-validation (CV) procedure
(-cflag). The CV procedure is based on removing one input
data point <br>
at a time, performing the approximation for the location of
the removed point using the remaining data points and
calculating the difference between the actual and
approximated <br>
value for the removed data point. The procedure is repeated
until every data point has been, in turn, removed. This form
of CV is also known as the &quot;leave-one-out&quot; or <br>
&quot;jack-knife&quot; method (Hofierka et al., 2002;
Hofierka, 2005). The differences (residuals) are then stored
in the cvdev output vector map. Please note that during the
CV procedure <br>
no other output maps can be set, the approximation is
performed only for locations defined by input data. To find
&quot;optimal parameters&quot;, the CV procedure must be
iteratively per&acirc; <br>
formed for all reasonable combinations of the approximation
parameters with small incremental steps (e.g. tension,
smoothing) in order to find a combination with minimal
statis&acirc; <br>
tical error (also called predictive error) defined by root
mean squared error (RMSE), mean absolute error (MAE) or
other error characteristics. A script with loops for tested
<br>
RST parameters can do the job, necessary statistics can be
calculated using e.g. v.univar. It should be noted that
crossvalidation is a time-consuming procedure, usually
reason&acirc; <br>
able for up to several thousands of points. For larger data
sets, CV should be applied to a representative subset of the
data. The cross-validation procedure works well only for
<br>
well-sampled phenomena and when minimizing the predictive
error is the goal. The parameters found by minimizing the
predictive (CV) error may not not be the best for for poorly
<br>
sampled phenomena (result could be strongly smoothed with
lost details and fluctuations) or when significant noise is
present that needs to be smoothed out.</p>

<p style="margin-top: 1em">EXAMPLE <br>
Using the where parameter, the interpolation can be limited
to use only a subset of the input vectors.</p>

<p style="margin-top: 1em">Spearfish example (we simulate
randomly distributed elevation measures): <br>
g.region raster=elevation.10m -p <br>
# random elevation extraction <br>
r.random elevation.10m vector_output=elevrand n=200 <br>
v.info -c elevrand <br>
v.db.select elevrand <br>
# interpolation based on all points <br>
v.surf.rst elevrand zcol=value elevation=elev_full <br>
r.colors elev_full rast=elevation.10m <br>
d.rast elev_full <br>
d.vect elevrand <br>
# interpolation based on subset of points (only those over
1300m/asl) <br>
v.surf.rst elevrand zcol=value elevation=elev_partial
where=&quot;value &gt; 1300&quot; <br>
r.colors elev_partial rast=elevation.10m <br>
d.rast elev_partial <br>
d.vect elevrand where=&quot;value &gt; 1300&quot;</p>

<p style="margin-top: 1em">REFERENCES <br>
&Acirc;&middot; Mitasova, H., Mitas, L. and Harmon, R.S.,
2005, Simultaneous spline approximation and topographic
analysis for lidar elevation data in open source GIS, IEEE
GRSL 2 (4), <br>
375- 379.</p>

<p style="margin-top: 1em">&Acirc;&middot; Hofierka, J.,
2005, Interpolation of Radioactivity Data Using Regularized
Spline with Tension. Applied GIS, Vol. 1, No. 2, pp. 16-01
to 16-13. DOI: 10.2104/ag050016</p>

<p style="margin-top: 1em">&Acirc;&middot; Hofierka J.,
Parajka J., Mitasova H., Mitas L., 2002, Multivariate
Interpolation of Precipitation Using Regularized Spline with
Tension. Transactions in GIS 6(2), pp. <br>
135-150.</p>

<p style="margin-top: 1em">&Acirc;&middot; H. Mitasova, L.
Mitas, B.M. Brown, D.P. Gerdes, I. Kosinovsky, 1995,
Modeling spatially and temporally distributed phenomena: New
methods and tools for GRASS GIS. Inter&acirc; <br>
national Journal of GIS, 9 (4), special issue on Integrating
GIS and Environmental modeling, 433-446.</p>

<p style="margin-top: 1em">&Acirc;&middot; Mitasova, H. and
Mitas, L., 1993: Interpolation by Regularized Spline with
Tension: I. Theory and Implementation, Mathematical Geology
,25, 641-655.</p>

<p style="margin-top: 1em">&Acirc;&middot; Mitasova, H. and
Hofierka, J., 1993: Interpolation by Regularized Spline with
Tension: II. Application to Terrain Modeling and Surface
Geometry Analysis, Mathematical <br>
Geology 25, 657-667.</p>

<p style="margin-top: 1em">&Acirc;&middot; Mitas, L., and
Mitasova H., 1988, General variational approach to the
approximation problem, Computers and Mathematics with
Applications, v.16, p. 983-992.</p>

<p style="margin-top: 1em">&Acirc;&middot; Neteler, M. and
Mitasova, H., 2008, Open Source GIS: A GRASS GIS Approach,
3rd Edition, Springer, New York, 406 pages.</p>

<p style="margin-top: 1em">&Acirc;&middot; Talmi, A. and
Gilat, G., 1977 : Method for Smooth Approximation of Data,
Journal of Computational Physics, 23, p.93-123.</p>

<p style="margin-top: 1em">&Acirc;&middot; Wahba, G., 1990,
: Spline Models for Observational Data, CNMS-NSF Regional
Conference series in applied mathematics, 59, SIAM,
Philadelphia, Pennsylvania.</p>

<p style="margin-top: 1em">SEE ALSO <br>
v.vol.rst, v.surf.idw, v.surf.bspline, g.region</p>

<p style="margin-top: 1em">Overview: Interpolation and
Resampling in GRASS GIS</p>

<p style="margin-top: 1em">For examples of applications see
GRASS4 implementation and GRASS5 and GRASS6
implementation.</p>

<p style="margin-top: 1em">AUTHORS <br>
Original version of program (in FORTRAN) and GRASS
enhancements: <br>
Lubos Mitas, NCSA, University of Illinois at Urbana
Champaign, Illinois, USA (1990-2000); Department of Physics,
North Carolina State University, Raleigh <br>
Helena Mitasova, USA CERL, Department of Geography,
University of Illinois at Urbana-Champaign, USA (1990-2001);
MEAS, North Carolina State University, Raleigh</p>

<p style="margin-top: 1em">Modified program (translated to
C, adapted for GRASS, new segmentation procedure): <br>
Irina Kosinovsky, US Army CERL, Dave Gerdes, US Army
CERL</p>

<p style="margin-top: 1em">Modifications for new sites
format and timestamping: <br>
Darrel McCauley, Purdue University, Bill Brown, US Army
CERL</p>

<p style="margin-top: 1em">Update for GRASS5.7, GRASS6 and
addition of crossvalidation: <br>
Jaroslav Hofierka, University of Presov; Radim Blazek,
ITC-irst</p>

<p style="margin-top: 1em">Last changed: $Date: 2016-11-14
00:09:36 +0100 (Mon, 14 Nov 2016) $</p>

<p style="margin-top: 1em">SOURCE CODE <br>
Available at: v.surf.rst source code (history)</p>

<p style="margin-top: 1em">Main index | Vector index |
Topics index | Keywords index | Graphical index | Full
index</p>

<p style="margin-top: 1em">&Acirc;&copy; 2003-2016 GRASS
Development Team, GRASS GIS 7.2.0 Reference Manual</p>

<p style="margin-top: 1em">GRASS 7.2.0
v.surf.rst(1grass)</p>
<hr>
</body>
</html>
