<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>r.stream.extract(1grass)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">r.stream.extract(1grass)</td>
    <td class="head-vol">Grass User's Manual</td>
    <td class="head-rtitle">r.stream.extract(1grass)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
<i></i><b>r.stream.extract</b> - Performs stream network extraction.
<h1 class="Sh" title="Sh" id="KEYWORDS"><a class="selflink" href="#KEYWORDS">KEYWORDS</a></h1>
raster, hydrology, stream network
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>r.stream.extract</b>
<div>&#x00A0;</div>
<b>r.stream.extract --help</b>
<div>&#x00A0;</div>
<b>r.stream.extract</b> <b>elevation</b>=<i>name</i>
  [<b>accumulation</b>=<i>name</i>] [ <b>depression</b>=<i>name</i>]
  <b>threshold</b>= <i>float</i> [<b>d8cut</b>=<i>float</i>]
  [<b>mexp</b>=<i>float</i>] [ <b>stream_length</b>=<i>integer</i>]
  [<b>memory</b>= <i>integer</i>] [<b>stream_raster</b>=<i>name</i>]
  [<b>stream_vector</b>= <i>name</i>] [<b>direction</b>=<i>name</i>]
  [--<b>overwrite</b>] [-- <b>help</b>] [--<b>verbose</b>] [--<b>quiet</b>]
  [--<b>ui</b>]
<h2 class="Ss" title="Ss" id="Flags:"><a class="selflink" href="#Flags:">Flags:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--overwrite</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Allow output files to overwrite existing files</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--help</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Print usage summary</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--verbose</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Verbose module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--quiet</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Quiet module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ui</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Force launching GUI dialog</dd>
</dl>
<h2 class="Ss" title="Ss" id="Parameters:"><a class="selflink" href="#Parameters:">Parameters:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>elevation</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of input elevation raster map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>accumulation</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of input accumulation raster map
    <div>&#x00A0;</div>
    Stream extraction will use provided accumulation instead of calculating it
      anew</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>depression</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of input raster map with real depressions
    <div>&#x00A0;</div>
    Streams will not be routed out of real depressions</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>threshold</b>=<i>float</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Minimum flow accumulation for streams
    <div>&#x00A0;</div>
    Must be &gt; 0</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>d8cut</b>=<i>float</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Use SFD above this threshold
    <div>&#x00A0;</div>
    If accumulation is larger than d8cut, SFD is used instead of MFD. Applies
      only if no accumulation map is given.
    <div>&#x00A0;</div>
    Default: <i>infinity</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>mexp</b>=<i>float</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Montgomery exponent for slope, disabled with 0
    <div>&#x00A0;</div>
    Montgomery: accumulation is multiplied with pow(slope,mexp) and then
      compared with threshold
    <div>&#x00A0;</div>
    Default: <i>0</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>stream_length</b>=<i>integer</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Delete stream segments shorter than stream_length cells
    <div>&#x00A0;</div>
    Applies only to first-order stream segments (springs/stream heads)
    <div>&#x00A0;</div>
    Default: <i>0</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>memory</b>=<i>integer</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Maximum memory to be used (in MB)
    <div>&#x00A0;</div>
    Cache size for raster rows
    <div>&#x00A0;</div>
    Default: <i>300</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>stream_raster</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output raster map with unique stream ids</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>stream_vector</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output vector map with unique stream ids</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>direction</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output raster map with flow direction</dd>
</dl>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<i>r.stream.extract</i> extracts streams in both raster and vector format from a
  required input <b>elevation</b> map and optional input <b>accumulation</b>
  map.
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
NULL (nodata) cells in the input <b>elevation</b> map are ignored, zero and
  negative values are valid elevation data. Gaps in the elevation map that are
  located within the area of interest must be filled beforehand, e.g. with
  <i>r.fillnulls</i>, to avoid distortions.
<div class="Pp"></div>
All non-NULL and non-zero cells of <b>depression</b> map will be regarded as
  real depressions. Streams will not be routed out of depressions. If an area is
  marked as depression but the elevation model has no depression at this
  location, streams will not stop there. If a flow accumulation map and a map
  with real depressions are provided, the flow accumulation map must match the
  depression map such that flow is not distributed out of the indicated
  depressions. It is recommended to use internally computed flow accumulation if
  a depression map is provided.
<div class="Pp"></div>
Option <b>threshold</b> defines the minimum (optionally modified) flow
  accumulation value that will initiate a new stream. If Montgomery&#x2019;s
  method for channel initiation is used, the cell value of the accumulation
  input map is multiplied by (tan(local slope))mexp and then compared to
  <b>threshold</b>. If <b>mexp</b> is given than the method of Montgomery and
  Foufoula-Georgiou (1993) to initiate a stream with this value. The cell value
  of the accumulation input map is multiplied by (tan(local slope))mexp and then
  compared to <b>threshold</b>. If threshold is reached or exceeded, a new
  stream is initiated. The default value 0 disables Montgomery. Montgomery and
  Foufoula-Georgiou (1993) generally recommend to use 2.0 as exponent.
  <b>mexp</b> values closer to 0 will produce streams more similar to streams
  extracted with Montgomery disabled. Larger <b>mexp</b> values decrease the
  number of streams in flat areas and increase the number of streams in steep
  areas. If <b>weight</b> is given, the weight is applied first.
<div class="Pp"></div>
Option <b>d8cut</b> defines minimum amount of overland flow (accumulation) when
  SFD (D8) will be used instead of MFD (FD8) to calculate flow accumulation.
  Only applies if no accumulation map is provided. Setting to 0 disables MFD
  completely.
<div class="Pp"></div>
Option <b>stream_length</b> defines minimum stream length in number of cells for
  first-order (head/spring) stream segments. All first-order stream segments
  shorter than <b>stream_length</b> will be deleted.
<div class="Pp"></div>
Output <b>direction</b> raster map contains flow direction for all non-NULL
  cells in input elevation. Flow direction is of D8 type with a range of 1 to 8.
  Multiplying values with 45 gives degrees CCW from East. Flow direction was
  adjusted during thinning, taking shortcuts and skipping cells that were
  eliminated by the thinning procedure.
<h2 class="Ss" title="Ss" id="Stream_extraction"><a class="selflink" href="#Stream_extraction">Stream
  extraction</a></h2>
If no <b>accumulation</b> input map is provided, flow accumulation is determined
  with a hydrological analysis similar to <i>r.watershed</i>. The algorithm is
  MFD (FD8) after Holmgren 1994, as for <i>r.watershed</i>. The <b>threshold</b>
  option determines the number of streams and detail of stream networks.
  Whenever flow accumulation reaches <b>threshold</b>, a new stream is started
  and traced downstream to its outlet point. As for <i>r.watershed</i>, flow
  accumulation is calculated as the number of cells draining through a cell.
<div class="Pp"></div>
If <b>accumulation</b> is given than the accumulation values of the provided
  <b>accumulation</b> map are used and not calculated from the input
  <b>elevation</b> map. In this case the <b>elevation</b> map must be exactly
  the same map used to calculate <b>accumulation</b>. If <b>accumulation</b> was
  calculated with <i>r.terraflow</i>, the filled elevation output of
  <i>r.terraflow</i> must be used. Further on, the current region should be
  aligned to the <b>accumulation</b> map. Flow direction is first calculated
  from <b>elevation</b> and then adjusted to <b>accumulation</b>. It is not
  necessary to provide <b>accumulation</b> as the number of cells, it can also
  be the optionally adjusted or weighed total contributing area in square meters
  or any other unit. When an original flow accumulation map is adjusted or
  weighed, the adjustment or weighing should not convert valid accumulation
  values to NULL (nodata) values.
<div class="Pp"></div>
In case of getting the error message ERROR: Accumulation raster map is NULL but
  elevation map is not NULL the computational region must be carefully adjusted
  to exclude NULL pixels in the accumulation raster map prior to stream
  extraction.
<h2 class="Ss" title="Ss" id="Weighed_flow_accumulation"><a class="selflink" href="#Weighed_flow_accumulation">Weighed
  flow accumulation</a></h2>
Flow accumulation can be calculated first, e.g. with <i>r.watershed</i>, and
  then modified before using it as input for <i>r.stream.extract</i>. In its
  general form, a weighed accumulation map is generated by first creating a
  weighing map and then multiplying the accumulation map with the weighing map
  using <i>r.mapcalc</i>. It is highly recommended to evaluate the weighed flow
  accumulation map first, before using it as input for <i>r.stream.extract</i>.
<div class="Pp"></div>
This allows e.g. to decrease the number of streams in dry areas and increase the
  number of streams in wet areas by setting <b>weight</b> to smaller than 1 in
  dry areas and larger than 1 in wet areas.
<div class="Pp"></div>
Another possibility is to restrict channel initiation to valleys determined from
  terrain morphology. Valleys can be determined with <i>r.param.scale</i>
  method=crosc (cross-sectional or tangential curvature). Curvature values &lt;
  0 indicate concave features, i.e. valleys. The size of the processing window
  determines whether narrow or broad valleys will be identified (See example
  below).
<h2 class="Ss" title="Ss" id="Defining_a_region_of_interest"><a class="selflink" href="#Defining_a_region_of_interest">Defining
  a region of interest</a></h2>
The stream extraction procedure can be restricted to a certain region of
  interest, e.g. a subbasin, by setting the computational region with
  <i>g.region</i> and/or creating a MASK. Such region of interest should be a
  complete catchment area, complete in the sense that the complete area upstream
  of an outlet point is included and buffered with at least one cell.
<h2 class="Ss" title="Ss" id="Stream_output"><a class="selflink" href="#Stream_output">Stream
  output</a></h2>
The output raster and vector contains stream segments with unique IDs. Note that
  these IDs are different from the IDs assigned by <i>r.watershed</i>. The
  vector output also contains points at the location of the start of a stream
  segment, at confluences and at stream network outlet locations.
<div class="Pp"></div>
Output <b>stream_raster</b> raster map stores extracted streams. Cell values
  encode a unique ID for each stream segment.
<div class="Pp"></div>
Output <b>stream_vector</b> vector map stores extracted stream segments and
  points. Points are written at the start location of each stream segment and at
  the outlet of a stream network. In layer 1, categories are unique IDs,
  identical to the cell value of the raster output. The attribute table for
  layer 1 holds information about the type of stream segment: start segment, or
  intermediate segment with tributaries. Columns are cat int, stream_type
  varchar(), type_code int. The encoding for type_code is 0 = start, 1 =
  intermediate. In layer 2, categories are identical to type_code in layer 1
  with additional category 2 = outlet for outlet points. Points with category 1
  = intermediate in layer 2 are at the location of confluences.
<h1 class="Sh" title="Sh" id="EXAMPLE"><a class="selflink" href="#EXAMPLE">EXAMPLE</a></h1>
This example is based on the elevation map &quot;elev_ned_30m&quot; in the North
  Carolina sample dataset and uses valleys determined with <i>r.param.scale</i>
  to weigh an accumulation map produced with <i>r.watershed</i>.
<div>&#x00A0;</div>
<pre>
# set region
g.region -p raster=elev_ned_30m@PERMANENT
# calculate flow accumulation
r.watershed ele=elev_ned_30m@PERMANENT acc=elevation.10m.acc
# curvature to get narrow valleys
r.param.scale input=elev_ned_30m@PERMANENT output=tangential_curv_5 size=5 method=crosc
# curvature to get a bit broader valleys
r.param.scale input=elev_ned_30m@PERMANENT output=tangential_curv_7 size=7 method=crosc
# curvature to get broad valleys
r.param.scale input=elev_ned_30m@PERMANENT output=tangential_curv_11 size=11 method=crosc
# create weight map
r.mapcalc &quot;weight = if(tangential_curv_5 &lt; 0, -100 * tangential_curv_5, \
                    if(tangential_curv_7 &lt; 0, -100 * tangential_curv_7, \
		    if(tangential_curv_11 &lt; 0, -100 * tangential_curv_11, 0.000001)))&quot;
# weigh accumulation map
r.mapcalc expr=&quot;elev_ned_30m.acc.weighed = elev_ned_30m.acc * weight&quot;
# copy color table from original accumulation map
r.colors map=elev_ned_30m.acc.weighed raster=elev_ned_30m.acc
</pre>
<div class="Pp"></div>
Weight map (spatial subset with lake in the southern half)
<div class="Pp"></div>
Original flow accumulation map (spatial subset with lake in the southern half)
<div class="Pp"></div>
Weighed flow accumulation map (spatial subset with lake in the southern half)
<div class="Pp"></div>
Display both the original and the weighed accumulation map. Compare them and
  proceed if the weighed accumulation map makes sense.
<div>&#x00A0;</div>
<pre>
# extract streams using the original accumulation map
r.stream.extract elevation=elev_ned_30m@PERMANENT \
                 accumulation=elev_ned_30m.acc \
		 threshold=1000 \
		 stream_rast=elev_ned_30m.streams.noweight
# extract streams from weighed map
r.stream.extract elevation=elev_ned_30m@PERMANENT \
                 accumulation=elev_ned_30m.acc.weighed \
		 threshold=1000 \
		 stream_rast=elev_ned_30m.streams
</pre>
<div class="Pp"></div>
Now display both stream maps and decide which one is more realistic.
<div class="Pp"></div>
Extracted streams from original flow accumulation map
<div class="Pp"></div>
Extracted streams from weighed flow accumulation map
<h1 class="Sh" title="Sh" id="REFERENCES"><a class="selflink" href="#REFERENCES">REFERENCES</a></h1>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Ehlschlaeger, C. (1989). <i>Using the AT Search</i>
      <i>Algorithm to Develop Hydrologic Models from Digital Elevation</i>
      <i>Data</i>, <b>Proceedings of International Geographic Information
      Systems (IGIS)</b> <b>Symposium &#x2019;89</b>, pp 275-281 (Baltimore, MD,
      18-19 March 1989). URL:
      http://faculty.wiu.edu/CR-Ehlschlaeger2/older/IGIS/paper.html</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Holmgren, P. (1994). <i>Multiple flow direction algorithms
      for</i> <i>runoff modelling in grid based elevation models: An
      empirical</i> <i>evaluation.</i> <b>Hydrological Processes</b> Vol 8(4),
      pp 327-334. DOI: 10.1002/hyp.3360080405</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Montgomery, D.R., Foufoula-Georgiou, E. (1993). <i>Channel
      network source</i> <i>representation using digital elevation models.</i>
      <b>Water Resources Research</b> Vol 29(12), pp 3925-3934.</dd>
</dl>
</div>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<i></i> <i>r.mapcalc,</i> <i>r.param.scale,</i> <i>r.stream.channel (Addon),</i>
  <i>r.stream.distance (Addon),</i> <i>r.stream.order (Addon),</i>
  <i>r.stream.segment (Addon),</i> <i>r.stream.slope (Addon),</i>
  <i>r.stream.snap (Addon),</i> <i>r.stream.stats (Addon),</i>
  <i>r.terraflow,</i> <i>r.thin,</i> <i>r.to.vect,</i> <i>r.watershed</i>
  <i></i>
<div class="Pp"></div>
See also r.streams.* modules wiki page.
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Markus Metz
<div class="Pp"></div>
<i>Last changed: $Date: 2016-10-03 23:59:37 +0200 (Mon, 03 Oct 2016) $</i>
<h1 class="Sh" title="Sh" id="SOURCE_CODE"><a class="selflink" href="#SOURCE_CODE">SOURCE
  CODE</a></h1>
Available at: r.stream.extract source code (history)
<div class="Pp"></div>
Main index | Raster index | Topics index | Keywords index | Graphical index |
  Full index
<div class="Pp"></div>
&#x00A9; 2003-2016 GRASS Development Team, GRASS GIS 7.2.0 Reference
  Manual</div>
<table class="foot">
  <tr>
    <td class="foot-date"></td>
    <td class="foot-os">GRASS 7.2.0</td>
  </tr>
</table>
</body>
</html>
