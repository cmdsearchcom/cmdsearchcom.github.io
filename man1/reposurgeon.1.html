<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>REPOSURGEON(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">REPOSURGEON(1)</td>
    <td class="head-vol">Development Tools</td>
    <td class="head-rtitle">REPOSURGEON(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
reposurgeon - surgical operations on repositories
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<div class="Pp" style="margin-left: 12.00ex; text-indent: -12.00ex;"><b>reposurgeon</b>
  [ <i>command</i>...]</div>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
The purpose of <b>reposurgeon</b> is to enable risky operations that VCSes
  (version-control systems) don't want to let you do, such as (a) editing past
  comments and metadata, (b) excising commits, (c) coalescing and splitting
  commits, (d) removing files and subtrees from repo history, (e) merging or
  grafting two or more repos, and (f) cutting a repo in two by cutting a
  parent-child link, preserving the branch structure of both child repos.
<div class="Pp"></div>
A major use of reposurgeon is to assist a human operator to perform
  higher-quality conversions among version control systems than can be achieved
  with fully automated converters.
<div class="Pp"></div>
The original motivation for <b>reposurgeon</b> was to clean up artifacts created
  by repository conversions. It was foreseen that the tool would also have
  applications when code needs to be removed from repositories for legal or
  policy reasons.
<div class="Pp"></div>
To keep <b>reposurgeon</b> simple and flexible, it normally does not do its own
  repository reading and writing. Instead, it relies on being able to parse and
  emit the command streams created by git-fast-export and read by
  git-fast-import. This means that it can be used on any version-control system
  that has both fast-export and fast-import utilities. The git-import stream
  format also implicitly defines a common language of primitive operations for
  <b>reposurgeon</b> to speak.
<div class="Pp"></div>
Fully supported systems (those for which <b>reposurgeon</b> can both read and
  write repositories) include git, hg, bzr, svn, darcs, bk, RCS, and SRC. For a
  complete list, with dependencies and technical notes, type <b>prefer</b> to
  the <b>reposurgeon</b> prompt.
<div class="Pp"></div>
Writing to the file-oriented systems RCS and SRC is done via
  <b>rcs-fast-import</b>(1) and has some serious limitations because those
  systems cannot represent all the metadata in a git-fast-export stream. Consult
  that tool's documentation for details and partial workarounds.
<div class="Pp"></div>
Writing Subversion repositories also has some significant limitations, discussed
  in the section on Working With Subversion.
<div class="Pp"></div>
Fossil repository files can be read in using the <b>--format=fossil</b> option
  of the <b>read</b> command and written out with the <b>--format=fossil</b>
  option of the <b>write</b>. Ignore patterns are not translated in either
  direction.
<div class="Pp"></div>
CVS is supported for read only, not write. For CVS, <b>reposurgeon</b> must be
  run from within a repository directory (one with a CVSROOT subdirectory). Each
  module becomes a subdirectory in the the <b>reposurgeon</b> representation of
  the change history.
<div class="Pp"></div>
In order to deal with version-control systems that do not have fast-export
  equivalents, <b>reposurgeon</b> can also host extractor code that reads
  repositories directly. For each version-control system supported through an
  extractor, <b>reposurgeon</b> uses a small amount of knowledge about the
  system's command-line tools to (in effect) replay repository history into an
  input stream internally. Repositories under systems supported through
  extractors can be read by <b>reposurgeon</b>, but not modified by it. In
  particular, <b>reposurgeon</b> can be used to move a repository history from
  any VCS supported by an extractor to any VCS supported by a normal
  importer/exporter pair.
<div class="Pp"></div>
Mercurial repository reading is implemented with an extractor class; writing is
  handled with the stock &quot;hg fastimport&quot; command. A test extractor
  exists for git, but is normally disabled in favor of the regular exporter.
<div class="Pp"></div>
For guidance on the pragmatics of repository conversion, see the <b>DVCS
  Migration HOWTO</b>[1].
<h1 class="Sh" title="Sh" id="SAFETY_WARNINGS"><a class="selflink" href="#SAFETY_WARNINGS">SAFETY
  WARNINGS</a></h1>
<b>reposurgeon</b> is a sharp enough tool to cut you. It takes care not to ever
  write a repository in an actually inconsistent state, and will terminate with
  an error message rather than proceed when its internal data structures are
  confused. However, there are lots of things you can do with it - like altering
  stored commit timestamps so they no longer match the commit sequence - that
  are likely to cause havoc after you're done. Proceed with caution and check
  your work.
<div class="Pp"></div>
Also note that, if your DVCS does the usual thing of making commit IDs a
  cryptographic hash of content and parent links, editing a publicly-accessible
  repository with this tool would be a bad idea. All of the surgical operations
  in <b>reposurgeon</b> will modify the hash chains.
<div class="Pp"></div>
Please also see the notes on system-specific issues under the section called
  &#x201C;LIMITATIONS AND GUARANTEES&#x201D;.
<h1 class="Sh" title="Sh" id="OPERATION"><a class="selflink" href="#OPERATION">OPERATION</a></h1>
The program can be run in one of two modes, either as an interactive command
  interpreter or in batch mode to execute commands given as arguments on the
  <b>reposurgeon</b> invocation line. The only differences between these modes
  are (1) the interactive one begins by turning on the 'verbose 1' option, (2)
  in batch mode all errors (including normally recoverable errors in
  selection-set syntax) are fatal, and (3) each command-line argument beginning
  with &#x201C;--&#x201D; has that stripped off (which, in particular means that
  --help and --version will work as expected). Also, in interactive mode, Ctrl-P
  and Ctrl-N will be available to scroll through your command history and tab
  completion of both command keywords and name arguments (wherever that makes
  semantic sense) is available.
<div class="Pp"></div>
A git-fast-import stream consists of a sequence of commands which must be
  executed in the specified sequence to build the repo; to avoid confusion with
  <b>reposurgeon</b> commands we will refer to the stream commands as
  <i>events</i> in this documentation. These events are implicitly numbered from
  1 upwards. Most commands require specifying a selection of event sequence
  numbers so <b>reposurgeon</b> will know which events to modify or delete.
<div class="Pp"></div>
For all the details of event types and semantics, see the
  <b>git-fast-import</b>(1) manual page; the rest of this paragraph is a quick
  start for the impatient. Most events in a stream are <b>commits</b> describing
  revision states of the repository; these group together under a single change
  comment one or more <b>fileops</b> (file operations), which usually point to
  <b>blobs</b> that are revision states of individual files. A fileop may also
  be a delete operation indicating that a specified previously-existing file was
  deleted as part of the version commit; there are a couple of other special
  fileop types of lesser importance.
<div class="Pp"></div>
Commands to <b>reposurgeon</b> consist of a command keyword, sometimes preceded
  by a selection set, sometimes followed by whitespace-separated arguments. It
  is often possible to omit the selection-set argument and have it default to
  something reasonable.
<div class="Pp"></div>
Here are some motivating examples. The commands will be explained in more detail
  after the description of selection syntax.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
:15 edit               ;; edit the object associated with mark :15
<div class="Pp"></div>
edit                   ;; edit all editable objects
<div class="Pp"></div>
29..71 list            ;; list summary index of events 29..71
<div class="Pp"></div>
236..$ list            ;; List events from 236 to the last
<div class="Pp"></div>
&lt;#523&gt; inspect         ;; Look for commit #523; they are numbered 
                       ;; 1-origin from the beginning of the repository.
<div class="Pp"></div>
&lt;2317&gt; inspect         ;; Look for a tag with the name 2317, a tip commit
                       ;; of a branch named 2317, or a commit with legacy ID
                       ;; 2317. Inspect what is found. A plain number is
                       ;; probably a legacy ID inherited from a Subversion
                       ;; revision number.
<div class="Pp"></div>
/regression/ list      ;; list all commits and tags with comments or
                       ;; committer headers or author headers containing
                       ;; the string &quot;regression&quot;
<div class="Pp"></div>
1..:97 &amp; =T delete     ;; delete tags from event 1 to mark 97
<div class="Pp"></div>
[Makefile] inspect     ;; Inspect all commits with a file op touching Makefile
                       ;; and all blobs referred to in a fileop
                       ;; touching Makefile.
<div class="Pp"></div>
:46 tip                ;; Display the branch tip that owns commit :46.
<div class="Pp"></div>
@dsc(:55) list         ;; Display all commits with ancestry tracing to :55 
<div class="Pp"></div>
@min([.gitignore]) remove .gitignore delete
                       ;; Remove the first .gitignore fileop in the repo.
</pre>
</div>
<h2 class="Ss" title="Ss" id="SELECTION_SYNTAX"><a class="selflink" href="#SELECTION_SYNTAX">SELECTION
  SYNTAX</a></h2>
The selection-set specification syntax is an expression-oriented minilanguage.
  The most basic term in this language is a location. The following sorts of
  primitive locations are supported:
<div class="Pp"></div>
event numbers
<div style="margin-left: 4.00ex;">A plain numeric literal is interpreted as a
  1-origin event-sequence number.</div>
<div class="Pp"></div>
marks
<div style="margin-left: 4.00ex;">A numeric literal preceded by a colon is
  interpreted as a mark; see the import stream format documentation for
  explanation of the semantics of marks.</div>
<div class="Pp"></div>
tag and branch names
<div style="margin-left: 4.00ex;">The basename of a branch (including branches
  in the refs/tags namespace) refers to its tip commit. The name of a tag is
  equivalent to its mark (that of the tag itself, not the commit it refers to).
  Tag and branch locations are bracketed with &lt; &gt; (angle brackets) to
  distinguish them from command keywords.</div>
<div class="Pp"></div>
legacy IDs
<div style="margin-left: 4.00ex;">If the contents of name brackets (&lt; &gt;)
  does not match a tag or branch name, the interpreter next searches legacy IDs
  of commits. This is especially useful when you have imported a Subversion
  dump; it means that commits made from it can be referred to by their
  corresponding Subversion revision numbers.</div>
<div class="Pp"></div>
commit numbers
<div style="margin-left: 4.00ex;">A numeric literal within name brackets (&lt;
  &gt;) preceded by # is interpreted as a 1-origin commit-sequence number.</div>
<div class="Pp"></div>
$
<div style="margin-left: 4.00ex;">Refers to the last event.</div>
<div class="Pp"></div>
These may be grouped into sets in the following ways:
<div class="Pp"></div>
ranges
<div style="margin-left: 4.00ex;">A range is two locations separated by
  &quot;..&quot;, and is the set of events beginning at the left-hand location
  and ending at the right-hand location (inclusive).</div>
<div class="Pp"></div>
lists
<div style="margin-left: 4.00ex;">Comma-separated lists of locations and ranges
  are accepted, with the obvious meaning.</div>
<div class="Pp"></div>
There are some other ways to construct event sets:
<div class="Pp"></div>
visibility sets
<div style="margin-left: 4.00ex;">A visibility set is an expression specifying a
  set of event types. It will consist of a leading equal sign, followed by type
  letters. These are the type letters:
<table class="tbl">
  <colgroup>
    <col style="width: 1.00ex;"/>
    <col style="width: 91.00ex;"/>
    <col style="width: 116.00ex;"/>
  </colgroup>
  <tr>
    <td>B</td>
    <td>blobs</td>
    <td>Most default selection sets exclude blobs; they have to be manipulated
      through the commits they are attached to.</td>
  </tr>
  <tr>
    <td>C</td>
    <td>commits</td>
    <td>&#x00A0;</td>
  </tr>
  <tr>
    <td>D</td>
    <td>all-delete commits</td>
    <td>These are artifacts produced by some older repository-conversion
      tools.</td>
  </tr>
  <tr>
    <td>H</td>
    <td>head (branch tip) commits</td>
    <td>&#x00A0;</td>
  </tr>
  <tr>
    <td>O</td>
    <td>orphaned (parentless) commits</td>
    <td>&#x00A0;</td>
  </tr>
  <tr>
    <td>U</td>
    <td>commits with callouts as parents</td>
    <td>&#x00A0;</td>
  </tr>
  <tr>
    <td>Z</td>
    <td>commits with no fileops</td>
    <td>&#x00A0;</td>
  </tr>
  <tr>
    <td>M</td>
    <td>merge (multi-parent) commits</td>
    <td>&#x00A0;</td>
  </tr>
  <tr>
    <td>F</td>
    <td>fork (multi-child) commits</td>
    <td>&#x00A0;</td>
  </tr>
  <tr>
    <td>L</td>
    <td>commits with unclean multi-line comments (without a separating empty
      line after the first)</td>
    <td>&#x00A0;</td>
  </tr>
  <tr>
    <td>I</td>
    <td>commits for which metadata cannot be decoded to UTF-8</td>
    <td>&#x00A0;</td>
  </tr>
  <tr>
    <td>T</td>
    <td>tags</td>
    <td>&#x00A0;</td>
  </tr>
  <tr>
    <td>R</td>
    <td>resets</td>
    <td>&#x00A0;</td>
  </tr>
  <tr>
    <td>P</td>
    <td>Passthrough</td>
    <td>All event types simply passed through, including comments,
      <b>progress</b> commands, and <b>checkpoint</b> commands.</td>
  </tr>
  <tr>
    <td>N</td>
    <td>Legacy IDs</td>
    <td>Any string matching a cookie (legacy-ID) format.</td>
  </tr>
</table>
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div class="Pp"></div>
references
<div style="margin-left: 4.00ex;">A reference name (bracketed by angle brackets)
  resolves to a single object, either a commit or tag.
<table class="tbl">
  <colgroup>
    <col style="width: 13.00ex;"/>
    <col style="width: 37.00ex;"/>
  </colgroup>
  <tr>
    <td>type</td>
    <td>interpretation</td>
  </tr>
  <tr>
    <td>tag name</td>
    <td>annotated tag with that name</td>
  </tr>
  <tr>
    <td>branch name</td>
    <td>the branch tip commit</td>
  </tr>
  <tr>
    <td>legacy ID</td>
    <td>commit with that legacy ID</td>
  </tr>
  <tr>
    <td>assigned name</td>
    <td>name equated to a selection by assign</td>
  </tr>
</table>
<div style="height: 1.00em;">&#x00A0;</div>
Note that if an annotated tag and a branch have the same name foo, &lt;foo&gt;
  will resolve to the tag rather than the branch tip commit.</div>
<div class="Pp"></div>
dates and action stamps
<div style="margin-left: 4.00ex;">A date or action stamp in angle brackets
  resolves to a selection set of all matching commits.
<table class="tbl">
  <colgroup>
    <col style="width: 38.00ex;"/>
    <col style="width: 77.00ex;"/>
  </colgroup>
  <tr>
    <td>type</td>
    <td>interpretation</td>
  </tr>
  <tr>
    <td>RFC3339 timestamp</td>
    <td>commit or tag with that time/date</td>
  </tr>
  <tr>
    <td>action stamp (timestamp!email)</td>
    <td>commits or tags with that timestamp and author (or committer if no
      author).</td>
  </tr>
  <tr>
    <td>yyyy-mm-dd part of RFC3339 timestamp</td>
    <td>all commits and tags with that date</td>
  </tr>
</table>
<div style="height: 1.00em;">&#x00A0;</div>
To refine the match to a single commit, use a 1-origin index suffix separated by
  '#'. Thus &quot;&lt;2000-02-06T09:35:10Z&gt;&quot; can match multiple commits,
  but &quot;&lt;2000-02-06T09:35:10Z#2&gt;&quot; matches only the second in the
  set.</div>
<div class="Pp"></div>
text search
<div style="margin-left: 4.00ex;">A text search expression is a Python regular
  expression surrounded by forward slashes (to embed a forward slash in it, use
  a Python string escape such as \x2f).
<div style="height: 1.00em;">&#x00A0;</div>
A text search normally matches against the comment fields of commits and
  annotated tags, or against their author/committer names, or against the names
  of tags; also the text of passthrough objects.
<div style="height: 1.00em;">&#x00A0;</div>
The scope of a text search can be changed with qualifier letters after the
  trailing slash. These are as follows:
<table class="tbl">
  <colgroup>
    <col style="width: 6.00ex;"/>
    <col style="width: 142.00ex;"/>
  </colgroup>
  <tr>
    <td>letter</td>
    <td>interpretation</td>
  </tr>
  <tr>
    <td>a</td>
    <td>author name in commit</td>
  </tr>
  <tr>
    <td>b</td>
    <td>branch name in commit; also matches blobs referenced by commits on
      matching branches, and tags which point to commmits on patching
      branches.</td>
  </tr>
  <tr>
    <td>c</td>
    <td>comment text of commit or tag</td>
  </tr>
  <tr>
    <td>r</td>
    <td>committish reference in tag or reset</td>
  </tr>
  <tr>
    <td>p</td>
    <td>text in passthrough</td>
  </tr>
  <tr>
    <td>t</td>
    <td>tagger in tag</td>
  </tr>
  <tr>
    <td>n</td>
    <td>name of tag</td>
  </tr>
  <tr>
    <td>B</td>
    <td>blob content</td>
  </tr>
</table>
<div style="height: 1.00em;">&#x00A0;</div>
Multiple qualifier letters can add more search scopes.
<div style="height: 1.00em;">&#x00A0;</div>
(The &#x201C;b&#x201D; qualifier replaces the branchset syntax in earlier
  versions of <b>reposurgeon</b>.)</div>
<div class="Pp"></div>
paths
<div style="margin-left: 4.00ex;">A &quot;path expression&quot; enclosed in
  square brackets resolves to the set of all commits and blobs related to a path
  matching the given expression. The path expression itself is either a path
  literal or a regular expression surrounded by slashes. Immediately after the
  trailing / of a path regexp you can put any number of the following characters
  which act as flags: 'a', 'c', 'D', &quot;M', 'R', 'C', 'N'.
<div style="height: 1.00em;">&#x00A0;</div>
By default, a path is related to a commit if the latter has a fileop that
  touches that file path - modifies that change it, deletes that remove it,
  renames and copies that have it as a source or target. When the 'c' flag is in
  use the meaning changes: the paths related to a commit become all paths that
  would be present in a checkout for that commit.
<div style="height: 1.00em;">&#x00A0;</div>
A path literal matches a commit if and only if the path literal is exactly one
  of the paths related to the commit (no prefix or suffix operation is done). In
  particular a path literal won't match if it corresponds to a directory in the
  chosen repository.
<div style="height: 1.00em;">&#x00A0;</div>
A regular expression matches a commit if it matches any path related to the
  commit anywhere in the path. You can use '^' or '$' if you want the expression
  to only match at the beginning or end of paths. When the 'a' flag is in use,
  the path expression selects commits whose every path matches the regular
  expression. This is not always a subset of commits selected without the 'a'
  flag because it also selects commits with no related paths (e.g. empty
  commits, deletealls and commits with empty trees). If you want to avoid those,
  you can use e.g. '[/regex/] &amp; [/regex/a]'.
<div style="height: 1.00em;">&#x00A0;</div>
The flags 'D', &quot;M', 'R', 'C', 'N' restrict match checking to the
  corresponding fileop types. Note that this means an 'a' match is easier (not
  harder) to achieve. These are no-iops when used with 'c'.
<div style="height: 1.00em;">&#x00A0;</div>
A path or literal matches a blob if it matches any path that appeared in a
  modification fileop that referred to that blob. To select purely matching
  blobs or matching commits, compose a path expression with =B or =C.
<div style="height: 1.00em;">&#x00A0;</div>
If you need to embed '[^/]' into your regular expression (e.g. to express
  &quot;all characters but a slash&quot;) you can use a Python string escape
  such as \x2f.</div>
<div class="Pp"></div>
function calls
<div style="margin-left: 4.00ex;">The expression language has named special
  functions. The sequence for a named function is &#x201C;@&#x201D; followed by
  a function name, followed by an argument in parentheses. Presently the
  following functions are defined:
<table class="tbl">
  <colgroup>
    <col style="width: 4.00ex;"/>
    <col style="width: 85.00ex;"/>
  </colgroup>
  <tr>
    <td>name</td>
    <td>interpretation</td>
  </tr>
  <tr>
    <td>min</td>
    <td>minimum member of a selection set</td>
  </tr>
  <tr>
    <td>max</td>
    <td>maximum member of a selection set</td>
  </tr>
  <tr>
    <td>amp</td>
    <td>nonempty selection set becomes all objects, empty set is returned
      empty</td>
  </tr>
  <tr>
    <td>par</td>
    <td>all parents of commits in the argument set</td>
  </tr>
  <tr>
    <td>chn</td>
    <td>all children of commits in the argument set</td>
  </tr>
  <tr>
    <td>dsc</td>
    <td>all commits descended from the argument set (argument set included)</td>
  </tr>
  <tr>
    <td>anc</td>
    <td>all commits whom the argument set is descended from (argument set
      included)</td>
  </tr>
  <tr>
    <td>pre</td>
    <td>events before the argument set; empty if the argument set includes the
      first event.</td>
  </tr>
  <tr>
    <td>suc</td>
    <td>events after the argument set; empty if the argument set includes the
      last event.</td>
  </tr>
  <tr>
    <td>srt</td>
    <td>sort the argument set by event number.</td>
  </tr>
</table>
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div class="Pp"></div>
Set expressions may be combined with the operators | and &amp;; these are,
  respectively, set union and intersection. The | has lower precedence than
  intersection, but you may use parentheses '(' and ')' to group expressions in
  case there is ambiguity (this replaces the curly brackets used in older
  versions of the syntax).
<div class="Pp"></div>
Any set operation may be followed by '?' to add the set members' neighbors and
  referents. This extends the set to include the parents and children of all
  commits in the set, and the referents of any tags and resets in the set. Each
  blob reference in the set is replaced by all commit events that refer to it.
  The '?' can be repeated to extend the neighborhood depth.
<div class="Pp"></div>
Do set negation with prefix ~; it has higher precedence than &amp; and | but
  lower than ?
<h2 class="Ss" title="Ss" id="IMPORT_AND_EXPORT"><a class="selflink" href="#IMPORT_AND_EXPORT">IMPORT
  AND EXPORT</a></h2>
<b>reposurgeon</b> can hold multiple repository states in core. Each has a name.
  At any given time, one may be selected for editing. Commands in this group
  import repositories, export them, and manipulate the in-core list and the
  selection.
<div class="Pp"></div>
<b>read</b> [--format=fossil] [<i>directory</i>|<i>-</i>|<i>&lt;infile</i>]
<div style="margin-left: 4.00ex;">With a directory-name argument, this command
  attempts to read in the contents of a repository in any supported
  version-control system under that directory; read with no arguments does this
  in the current directory. If output is redirected to a plain file, it will be
  read in as a fast-import stream or Subversion dumpfile. With an argument of
  &#x201C;-&#x201D;, this command reads a fast-import stream or Subversion
  dumpfile from standard input (this will be useful in filters constructed with
  command-line arguments).
<div style="height: 1.00em;">&#x00A0;</div>
If the contents is a fast-import stream, any &quot;cvs-revision&quot; property
  on a commit is taken to be a newline-separated list of CVS revision cookies
  pointing to the commit, and used for reference lifting.
<div style="height: 1.00em;">&#x00A0;</div>
If the contents is a fast-import stream, any &quot;legacy-id&quot; property on a
  commit is taken to be a legacy ID token pointing to the commit, and used for
  reference-lifting.
<div style="height: 1.00em;">&#x00A0;</div>
If the read location is a git repository and contains a .git/cvsauthors file
  (such as is left in place by <b>git cvsimport -A</b>) that file will be read
  in as if it had been given to the <b>authors read</b> command.
<div style="height: 1.00em;">&#x00A0;</div>
If the read location is a directory, and its repository subdirectory has a file
  named legacy-map, that file will be read as though passed to a legacy read
  command.
<div style="height: 1.00em;">&#x00A0;</div>
If the read location is a file and the <b>--format=fossil</b> is used, the file
  is interpreted as a Fossil repository.
<div style="height: 1.00em;">&#x00A0;</div>
The just-read-in repo is added to the list of loaded repositories and becomes
  the current one, selected for surgery. If it was read from a plain file and
  the file name ends with one of the extensions .fi or .svn, that extension is
  removed from the load list name.
<div style="height: 1.00em;">&#x00A0;</div>
Note: this command does not take a selection set.</div>
<div class="Pp"></div>
<b>write</b> [--legacy] [--format=fossil] [--noincremental] [--callout]
  [<i>&gt;outfile</i>| <i>-</i>]
<div style="margin-left: 4.00ex;">Dump selected events as a fast-import stream
  representing the edited repository; the default selection set is all events.
  Where to dump to is standard output if there is no argument or the argument is
  '-', or the target of an output redirect.
<div style="height: 1.00em;">&#x00A0;</div>
Alternatively, if there is no redirect and the argument names a directory, the
  repository is rebuilt into that directory, with any selection set being
  ignored; if that target directory is nonempty its contents are backed up to a
  save directory.
<div style="height: 1.00em;">&#x00A0;</div>
If the write location is a file and the <b>--format=fossil</b> is used, the file
  is written in Fossil repository format.
<div style="height: 1.00em;">&#x00A0;</div>
With the <b>--legacy</b> option, the Legacy-ID of each commit is appended to its
  commit comment at write time. This option is mainly useful for debugging
  conversion edge cases.
<div style="height: 1.00em;">&#x00A0;</div>
If you specify a partial selection set such that some commits are included but
  their parents are not, the output will include incremental dump cookies for
  each branch with an origin outside the selection set, just before the first
  reference to that branch in a commit. An incremental dump cookie looks like
  &quot;refs/heads/foo^0&quot; and is a clue to export-stream loaders that the
  branch should be glued to the tip of a pre-existing branch of the same name.
  The <b>--noincremental</b> option suppresses this behavior.
<div style="height: 1.00em;">&#x00A0;</div>
When you specify a partial selection set, including a commit object forces the
  inclusion of every blob to which it refers and every tag that refers to it.
<div style="height: 1.00em;">&#x00A0;</div>
Specifying a partial selection may cause a situation in which some parent marks
  in merges don't correspond to commits present in the dump. When this happens
  and <b>--callout</b> option was specified, the write code replaces the merge
  mark with a callout, the action stamp of the parent commit; otherwise the
  parent mark is omitted. Importers will fail when reading a stream dump with
  callouts; it is intended to be used by the <b>graft</b> command.
<div style="height: 1.00em;">&#x00A0;</div>
Specifying a write selection set with gaps in it is allowed but unlikely to lead
  to good results if it is loaded by an importer.
<div style="height: 1.00em;">&#x00A0;</div>
Property extensions will be be omitted from the output if the importer for the
  preferred repository type cannot digest them.
<div style="height: 1.00em;">&#x00A0;</div>
Note: to examine small groups of commits without the progress meter, use
  <b>inspect</b>.</div>
<div class="Pp"></div>
<b>choose</b> [<i>reponame</i>]
<div style="margin-left: 4.00ex;">Choose a named repo on which to operate. The
  name of a repo is normally the basename of the directory or file it was loaded
  from, but repos loaded from standard input are &quot;unnamed&quot;.
  <b>reposurgeon</b> will add a disambiguating suffix if there have been
  multiple reads from the same source.
<div style="height: 1.00em;">&#x00A0;</div>
With no argument, lists the names of the currently stored repositories and their
  load times. The second column is '*' for the currently selected repository,
  '-' for others.</div>
<div class="Pp"></div>
<b>drop</b> [<i>reponame</i>]
<div style="margin-left: 4.00ex;">Drop a repo named by the argument from
  reposurgeon's list, freeing the memory used for its metadata and deleting
  on-disk blobs. With no argument, drops the currently chosen repo.</div>
<div class="Pp"></div>
<b>rename</b> <i>reponame</i>
<div style="margin-left: 4.00ex;">Rename the currently chosen repo; requires an
  argument. Won't do it if there is already one by the new name.</div>
<h2 class="Ss" title="Ss" id="REBUILDS_IN_PLACE"><a class="selflink" href="#REBUILDS_IN_PLACE">REBUILDS
  IN PLACE</a></h2>
<b>reposurgeon</b> can rebuild an altered repository in place. Untracked files
  are normally saved and restored when the contents of the new repository is
  checked out (but see the documentation of the &#x201C;preserve&#x201D; command
  for a caveat).
<div class="Pp"></div>
<b>rebuild</b> [<i>directory</i>]
<div style="margin-left: 4.00ex;">Rebuild a repository from the state held by
  <b>reposurgeon</b>. This command does not take a selection set.
<div style="height: 1.00em;">&#x00A0;</div>
The single argument, if present, specifies the target directory in which to do
  the rebuild; if the repository read was from a repo directory (and not a
  git-import stream), it defaults to that directory. If the target directory is
  nonempty its contents are backed up to a save directory. Files and directories
  on the repository's preserve list are copied back from the backup directory
  after repo rebuild. The default preserve list depends on the repository type,
  and can be displayed with the <b>stats</b> command.
<div style="height: 1.00em;">&#x00A0;</div>
If <b>reposurgeon</b> has a nonempty legacy map, it will be written to a file
  named legacy-map in the repository subdirectory as though by a legacy write
  command. (This will normally be the case for Subversion and CVS
  conversions.)</div>
<div class="Pp"></div>
<b>preserve</b> [<i>file...</i>]
<div style="margin-left: 4.00ex;">Add (presumably untracked) files or
  directories to the repo's list of paths to be restored from the backup
  directory after a <b>rebuild</b>. Each argument, if any, is interpreted as a
  pathname. The current preserve list is displayed afterwards.
<div style="height: 1.00em;">&#x00A0;</div>
It is only necessary to use this feature if your version-control system lacks a
  command to list files under version control. Under systems with such a command
  (which include git and hg), all files that are neither beneath the repository
  dot directory nor under reposurgeon temporary directories are preserved
  automatically.</div>
<div class="Pp"></div>
<b>unpreserve</b> [<i>file...</i>]
<div style="margin-left: 4.00ex;">Remove (presumably untracked) files or
  directories to the repo's list of paths to be restored from the backup
  directory after a <b>rebuild</b>. Each argument, if any, is interpreted as a
  pathname. The current preserve list is displayed afterwards.</div>
<h2 class="Ss" title="Ss" id="INFORMATION_AND_REPORTS"><a class="selflink" href="#INFORMATION_AND_REPORTS">INFORMATION
  AND REPORTS</a></h2>
Commands in this group report information about the selected repository.
<div class="Pp"></div>
The output of these commands can individually be redirected to a named output
  file. Where indicated in the syntax, you can prefix the output filename with
  &#x201C;&gt;&#x201D; and give it as a following argument. If you use
  &#x201C;&gt;&gt;&#x201D; the file is opened for append rather than write.
<div class="Pp"></div>
<b>list</b> [&gt;<i>outfile</i>]
<div style="margin-left: 4.00ex;">This is the main command for identifying the
  events you want to modify. It lists commits in the selection set by event
  sequence number with summary information. The first column is raw event
  numbers, the second a timestamp in local time. If the repository has legacy
  IDs, they will be displayed in the third column. The leading portion of the
  comment follows.</div>
<div class="Pp"></div>
<b>stamp</b> [&gt;<i>outfile</i>]
<div style="margin-left: 4.00ex;">Alternative form of listing that displays full
  action stamps, usable as references in selections. Supports &gt;
  redirection.</div>
<div class="Pp"></div>
<b>tip</b> [&gt;<i>outfile</i>]
<div style="margin-left: 4.00ex;">Display the branch tip names associated with
  commits in the selection set. These will not necessarily be the same as their
  branch fields (which will often be tag names if the repo contains either
  annotated or lightweight tags).
<div style="height: 1.00em;">&#x00A0;</div>
If a commit is at a branch tip, its tip is its branch name. If it has only one
  child, its tip is the child's tip. If it has multiple children, then if there
  is a child with a matching branch name its tip is the child's tip. Otherwise
  this function throws a recoverable error.</div>
<div class="Pp"></div>
<b>tags</b> [&gt;<i>outfile</i>]
<div style="margin-left: 4.00ex;">Display tags and resets: three fields, an
  event number and a type and a name. Branch tip commits associated with tags
  are also displayed with the type field 'commit'. Supports &gt;
  redirection.</div>
<div class="Pp"></div>
<b>stats</b> [<i>repo-name</i>...] [&gt;<i>outfile</i>]
<div style="margin-left: 4.00ex;">Report size statistics and import/export
  method information about named repositories, or with no argument the currently
  chosen repository.</div>
<div class="Pp"></div>
<b>count</b> [&gt;<i>outfile</i>]
<div style="margin-left: 4.00ex;">Report a count of items in the selection set.
  Default set is everything in the currently-selected repo. Supports &gt;
  redirection.</div>
<div class="Pp"></div>
<b>inspect</b> [&gt;<i>outfile</i>]
<div style="margin-left: 4.00ex;">Dump a fast-import stream representing
  selected events to standard output. Just like a write, except (1) the progress
  meter is disabled, and (2) there is an identifying header before each event
  dump.</div>
<div class="Pp"></div>
<b>graph</b> [&gt;<i>outfile</i>]
<div style="margin-left: 4.00ex;">Emit a visualization of the commit graph in
  the DOT markup language used by the graphviz tool suite. This can be fed as
  input to the main graphviz rendering program <b>dot</b>(1), which will yield a
  viewable image. Supports &gt; redirection.
<div style="height: 1.00em;">&#x00A0;</div>
You may find a script like this useful:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
graph $1 &gt;/tmp/foo$$
shell dot &lt;/tmp/foo$$ -Tpng | display -; rm /tmp/foo$$
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
You can substitute in your own preferred image viewer, of course.</div>
<div class="Pp"></div>
<b>sizes</b> [&gt;<i>outfile</i>]
<div style="margin-left: 4.00ex;">Print a report on data volume per branch;
  takes a selection set, defaulting to all events. The numbers tally the size of
  uncompressed blobs, commit and tag comments, and other metadata strings (a
  blob is counted each time a commit points at it).
<div style="height: 1.00em;">&#x00A0;</div>
The numbers are not an exact measure of storage size: they are intended mainly
  as a way to get information on how to efficiently partition a repository that
  has become large enough to be unwieldy.
<div style="height: 1.00em;">&#x00A0;</div>
Supports &gt; redirection.</div>
<div class="Pp"></div>
<b>lint</b> [&gt;<i>outfile</i>]
<div style="margin-left: 4.00ex;">Look for DAG and metadata configurations that
  may indicate a problem. Presently checks for: (1) Mid-branch deletes, (2)
  disconnected commits, (3) parentless commits, (4) the existence of multiple
  roots, (5) committer and author IDs that don't look well-formed as DVCS IDs,
  (6) multiple child links with identical branch labels descending from the same
  commit, (7) time and action-stamp collisions.
<div style="height: 1.00em;">&#x00A0;</div>
Options to issue only partial reports are supported; &quot;lint --options&quot;
  or &quot;lint -?&quot; lists them.
<div style="height: 1.00em;">&#x00A0;</div>
The options and output format of this command are unstable; they may change
  without notice as more sanity checks are added.</div>
<div class="Pp"></div>
<b>when</b> &gt;<i>timespec</i>
<div style="margin-left: 4.00ex;">Interconvert between git timestamps (integer
  Unix time plus TZ) and RFC3339 format. Takes one argument, autodetects the
  format. Useful when eyeballing export streams. Also accepts any other
  supported date format and converts to RFC3339.</div>
<h2 class="Ss" title="Ss" id="SURGICAL_OPERATIONS"><a class="selflink" href="#SURGICAL_OPERATIONS">SURGICAL
  OPERATIONS</a></h2>
These are the operations the rest of reposurgeon is designed to support.
<div class="Pp"></div>
<b>squash</b> [<i>policy...</i>]
<div style="margin-left: 4.00ex;">Combine or delete commits in a selection set
  of events. The default selection set for this command is empty. Has no effect
  on events other than commits unless the --delete policy is selected; see the
  'delete' command for discussion.
<div style="height: 1.00em;">&#x00A0;</div>
Normally, when a commit is squashed, its file operation list (and any associated
  blob references) gets either prepended to the beginning of the operation list
  of each of the commit's children or appended to the operation list of each of
  the commit's parents. Then children of a deleted commit get it removed from
  their parent set and its parents added to their parent set.
<div style="height: 1.00em;">&#x00A0;</div>
The default is to squash forward, modifying children; but see the list of policy
  modifiers below for how to change this.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>Warning</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
It is easy to get the bounds of a squash command wrong, with confusing and
  destructive results. Beware thinking you can squash on a selection set to
  merge all commits except the last one into the last one; what you will
  actually do is to merge all of them to the first commit <i>after</i> the
  selected set.
<div style="height: 0.50em;">&#x00A0;</div>
</div>
Normally, any tag pointing to a combined commit will also be pushed forward. But
  see the list of policy modifiers below for how to change this.
<div style="height: 1.00em;">&#x00A0;</div>
Following all operation moves, every one of the altered file operation lists is
  reduced to a shortest normalized form. The normalized form detects various
  combinations of modification, deletion, and renaming and simplifies the
  operation sequence as much as it can without losing any information.
<div style="height: 1.00em;">&#x00A0;</div>
After canonicalization, a file op list may still end up containing multiple M
  operations on the same file. Normally the tool utters a warning when this
  occurs but does not try to resolve it.
<div style="height: 1.00em;">&#x00A0;</div>
The following modifiers change these policies:
<div class="Pp"></div>
<b>--delete</b>
<div style="margin-left: 4.00ex;">Simply discards all file ops and tags
  associated with deleted commit(s).</div>
<div class="Pp"></div>
<b>--coalesce</b>
<div style="margin-left: 4.00ex;">Discard all M operations (and associated
  blobs) except the last.</div>
<div class="Pp"></div>
<b>--pushback</b>
<div style="margin-left: 4.00ex;">Append fileops to parents, rather than
  prepending to children.</div>
<div class="Pp"></div>
<b>--pushforward</b>
<div style="margin-left: 4.00ex;">Prepend fileops to children. This is the
  default; it can be specified in a lift script for explicitness about
  intentions.</div>
<div class="Pp"></div>
<b>--tagforward</b>
<div style="margin-left: 4.00ex;">With the &quot;tagforward&quot; modifier, any
  tag on the deleted commit is pushed forward to the first child rather than
  being deleted. This is the default; it can be specified for
  explicitness.</div>
<div class="Pp"></div>
<b>--tagback</b>
<div style="margin-left: 4.00ex;">With the &quot;--tagback&quot; modifier, any
  tag on the deleted commit is pushed backward to the first parent rather than
  being deleted.</div>
<div class="Pp"></div>
<b>--quiet</b>
<div style="margin-left: 4.00ex;">Suppresses warning messages about deletion of
  commits with non-delete fileops.</div>
<div class="Pp"></div>
<b>--complain</b>
<div style="margin-left: 4.00ex;">The opposite of quiet. Can be specified for
  explicitness.</div>
<div style="height: 1.00em;">&#x00A0;</div>
Under any of these policies except &#x201C;--delete&#x201D;, deleting a commit
  that has children does not back out the changes made by that commit, as they
  will still be present in the blobs attached to versions past the end of the
  deletion set. All a delete does when the commit has children is lose the
  metadata information about when and by who those changes were actually made;
  after the delete any such changes will be attributed to the first undeleted
  children of the deleted commits. It is expected that this command will be
  useful mainly for removing commits mechanically generated by repository
  converters such as <b>cvs2svn</b>.</div>
<div class="Pp"></div>
<b>delete</b> [<i>policy...</i>]
<div style="margin-left: 4.00ex;">Delete a selection set of events. The default
  selection set for this command is empty. On a set of commits, this is
  equivalent to a squash with the --delete flag. It unconditionally deletes
  tags, resets, and passthroughs; blobs can be removed only as a side effect of
  deleting every commit that points at them.</div>
<div class="Pp"></div>
<b>divide</b> <i>parent</i> [<i>child</i>]
<div style="margin-left: 4.00ex;">Attempt to partition a repo by cutting the
  parent-child link between two specified commits (they must be adjacent). Does
  not take a general selection set. It is only necessary to specify the parent
  commit, unless it has multiple children in which case the child commit must
  follow (separate it with a comma).
<div style="height: 1.00em;">&#x00A0;</div>
If the repo was named 'foo', you will normally end up with two repos named
  'foo-early' and 'foo-late' (option and feature events at the beginning of the
  early segment will be duplicated onto the beginning of the late one.). But if
  the commit graph would remain connected through another path after the cut,
  the behavior changes. In this case, if the parent and child were on the same
  branch 'qux', the branch segments are renamed 'qux-early' and 'qux-late' but
  the repo is not divided.</div>
<div class="Pp"></div>
<b>expunge</b> <i>[--notagify] [path | /regexp/]...</i>
<div style="margin-left: 4.00ex;">Expunge files from the selected portion of the
  repo history; the default is the entire history. The arguments to this command
  may be paths or Python regular expressions matching paths (regexps must be
  marked by being surrounded with //).
<div style="height: 1.00em;">&#x00A0;</div>
All filemodify (M) operations and delete (D) operations involving a matched file
  in the selected set of events are disconnected from the repo and put in a
  removal set. Renames are followed as the tool walks forward in the selection
  set; each triggers a warning message. If a selected file is a copy (C) target,
  the copy will be deleted and a warning message issued. If a selected file is a
  copy source, the copy target will be added to the list of paths to be deleted
  and a warning issued.
<div style="height: 1.00em;">&#x00A0;</div>
After file expunges have been performed, any commits with no remaining file
  operations will be removed, and any tags pointing to them. By default each
  deleted commit is replaced with a tag of the form 'emptycommit- <i>ident</i>'
  on the preceding commit unless --notagify is specified as an argument. Commits
  with deleted fileops pointing both in and outside the path set are not
  deleted, but are cloned into the removal set.
<div style="height: 1.00em;">&#x00A0;</div>
The removal set is not discarded. It is assembled into a new repository named
  after the old one with the suffix &quot;-expunges&quot; added. Thus, this
  command can be used to carve a repository into sections by file path
  matches.</div>
<div class="Pp"></div>
<b>tagify</b> [<b>--canonicalize</b>] [<b>--tipdeletes</b>]
  [<b>--tagify-merges</b>]
<div style="margin-left: 4.00ex;">Search for empty commits and turn them into
  tags. Takes an optional selection set argument defaulting to all commits. For
  each commit in the selection set, turn it into a tag with the same message and
  author information if it has no fileops. By default merge commits are not
  considered, even if they have no fileops (thus no tree differences with their
  first parent). To change that, use the <b>--tagify-merges</b> option.
<div style="height: 1.00em;">&#x00A0;</div>
The name of the generated tag will be 'emptycommit- <i>ident</i>', where
  <i>ident</i> is generated from the legacy ID of the deleted commit, or from
  its mark, or from its index in the repository, with a disambiguation suffix if
  needed.
<div style="height: 1.00em;">&#x00A0;</div>
With the <b>--canonicalize</b>, tagify tries harder to detect trivial commits by
  first ensuring that all fileops of selected commits will have an actual effect
  when processed by fast-import.
<div style="height: 1.00em;">&#x00A0;</div>
With the <b>--tipdeletes</b>, tagify also considers branch tips with only
  deleteall fileops to be candidates for tagification. The corresponding tags
  get names of the form 'tipdelete- <i>branchname</i>' rather than the default
  'emptycommit- <i>ident</i>'.
<div style="height: 1.00em;">&#x00A0;</div>
With the <b>--tagify-merges</b>, tagify also tagifies merge commits that have no
  fileops. When this is done the merge link is move to the yagified commit's
  parent.</div>
<div class="Pp"></div>
<b>coalesce</b> [<b>--debug</b>|<b>--changelog</b>] [<i>timefuzz</i>]
<div style="margin-left: 4.00ex;">Scan the selection set for runs of commits
  with identical comments close to each other in time (this is a common form of
  scar tissues in repository up-conversions from older file-oriented
  version-control systems). Merge these cliques by deleting all but the last
  commit, in order; fileops from the deleted commits are pushed forward to that
  last one
<div style="height: 1.00em;">&#x00A0;</div>
The optional second argument, if present, is a maximum time separation in
  seconds; the default is 90 seconds.
<div style="height: 1.00em;">&#x00A0;</div>
The default selection set for this command is =C, all commits. Occasionally you
  may want to restrict it, for example to avoid coalescing unrelated cliques of
  &quot;*** empty log message ***&quot; commits from CVS lifts.
<div style="height: 1.00em;">&#x00A0;</div>
With the --debug option, show messages about mismatches.
<div style="height: 1.00em;">&#x00A0;</div>
With the --changelog option, any commit with a comment containing the string
  'empty log message' (such as is generated by CVS) and containing exactly one
  file operation modifying a path ending in ChangeLog is treated specially. Such
  ChangeLog commits are considered to match any commit before them by content,
  and will coalesce with it if the committer matches and the commit separation
  is small enough. This option handles a convention used by Free Software
  Foundation projects.</div>
<div class="Pp"></div>
<b>split</b> <b>{at|by}</b> <i>item</i>
<div style="margin-left: 4.00ex;">The first argument is required to be a commit
  location; the second is a preposition which indicates which splitting method
  to use. If the preposition is 'at', then the third argument must be an integer
  1-origin index of a file operation within the commit. If it is 'by', then the
  third argument must be a pathname to be prefix-matched, pathname match is done
  first).
<div style="height: 1.00em;">&#x00A0;</div>
The commit is copied and inserted into a new position in the event sequence,
  immediately following itself; the duplicate becomes the child of the original,
  and replaces it as parent of the original's children. Commit metadata is
  duplicated; the new commit then gets a new mark. If the new commit has a
  legacy ID, the suffix '.split' is appended to it.
<div style="height: 1.00em;">&#x00A0;</div>
Finally, some file operations - starting at the one matched or indexed by the
  split argument - are moved forward from the original commit into the new one.
  Legal indices are 2-n, where n is the number of file operations in the
  original commit.</div>
<div class="Pp"></div>
<b>add</b> {<i>D</i> <i>path</i> | <i>M</i> <i>perm</i> <i>mark</i> <i>path</i>
  | <i>R</i> <i>source</i> <i>target</i> | <i>C</i> <i>source</i> <i>target</i>}
<div style="margin-left: 4.00ex;">To a specified commit, add a specified fileop.
<div style="height: 1.00em;">&#x00A0;</div>
For a D operation to be valid there must be an M operation for the path in the
  commit's ancestry. For an M operation to be valid, the 'perm' part must be a
  token ending with 755 or 644 and the 'mark' must refer to a blob that precedes
  the commit location. For an R or C operation to be valid, there must be an M
  operation for the source in the commit's ancestry.</div>
<div class="Pp"></div>
<b>remove</b> [<i>index</i> | <i>path</i> | <b>deletes</b>] [<b>to</b>
  <i>commit</i>]
<div style="margin-left: 4.00ex;">From a specified commit, remove a specified
  fileop. The op must be one of (a) the keyword &#x201C;deletes&#x201D;, (b) a
  file path, (c) a file path preceded by an op type set (some subset of the
  letters DMRCN), or (d) a 1-origin numeric index. The &#x201C;deletes&#x201D;
  keyword selects all D fileops in the commit; the others select one each.
<div style="height: 1.00em;">&#x00A0;</div>
If the &#x201C;to&#x201D; clause is present, the removed op is appended to the
  commit specified by the following singleton selection set. This option cannot
  be combined with &#x201C;deletes&#x201D;.
<div style="height: 1.00em;">&#x00A0;</div>
Note that this command does not attempt to scavenge blobs even if the deleted
  fileop might be the only reference to them. This behavior may change in a
  future release.</div>
<div class="Pp"></div>
<b>blob</b>
<div style="margin-left: 4.00ex;">Create a blob at mark :1 after renumbering
  other marks starting from :2. Data is taken from stdin, which may be a
  here-doc. This can be used with the add command to patch synthetic data into a
  repository.</div>
<div class="Pp"></div>
<b>renumber</b>
<div style="margin-left: 4.00ex;">Renumber the marks in a repository, from :1 up
  to :&lt;n&gt; where &lt;n&gt; is the count of the last mark. Just in case an
  importer ever cares about mark ordering or gaps in the sequence.
<div style="height: 1.00em;">&#x00A0;</div>
A side effect of this comment is to clean up stray &quot;done&quot; passthroughs
  that may have entered the repository via graft operations. After a renumber,
  the repository will have at most one &quot;done&quot; and it will be at the
  end of the events.</div>
<div class="Pp"></div>
<b>mailbox_out</b> [&gt;<i>outfile</i>]
<div style="margin-left: 4.00ex;">Emit a mailbox file of messages in RFC822
  format representing the contents of repository metadata. Takes a selection
  set; members of the set other than commits, annotated tags, and passthroughs
  are ignored (that is, presently, blobs and resets).
<div style="height: 1.00em;">&#x00A0;</div>
The output from this command can optionally be redirected to a named output
  file. Prefix the filename with &#x201C;&gt;&#x201D; and give it as a following
  argument.
<div style="height: 1.00em;">&#x00A0;</div>
May have an option --filter, followed by = and a /-enclosed regular expression.
  If this is given, only headers with names matching it are emitted. In this
  context the name of the header includes its trailing colon.</div>
<div class="Pp"></div>
<b>mailbox_in</b> [&lt;<i>infile</i>] [<i>--changed</i> &gt;<i>outfile</i>]
<div style="margin-left: 4.00ex;">Accept a mailbox file of messages in RFC822
  format representing the contents of the metadata in selected commits and
  annotated tags. Takes no selection set. If there is an argument it will be
  taken as the name of a mailbox file to read from; no argument, or one of '-';
  reads from standard input.
<div style="height: 1.00em;">&#x00A0;</div>
Users should be aware that modifying an Event-Number or Event-Mark field will
  change which event the update from that message is applied to. This is
  unlikely to have good results.
<div style="height: 1.00em;">&#x00A0;</div>
If the Event-Number and Event-Mark fields are absent, the mailbox_in logic will
  attempt to match the commit or tag first by Legacy-ID, then by a unique
  committer ID and timestamp pair.
<div style="height: 1.00em;">&#x00A0;</div>
If output is redirected and the modifier &#x201C;--changed&#x201D; appears, a
  minimal set of modifications actually made is written to the output file in a
  form that can be fed back in.</div>
<div class="Pp"></div>
<b>setfield</b> <i>attribute</i> <i>value</i>
<div style="margin-left: 4.00ex;">In the selected objects (defaulting to none)
  set every instance of a named field to a string value. The string may be
  quoted to include whitespace, and use backslash escapes interpreted by the
  Python string-escape codec, such as \n and \t.
<div style="height: 1.00em;">&#x00A0;</div>
Attempts to set nonexistent attributes are ignored. Valid values for the
  attribute are internal Python field names; in particular, for commits,
  &#x201C;comment&#x201D; and &#x201C;branch&#x201D; are legal. Consult the
  source code for other interesting values.</div>
<div class="Pp"></div>
<b>append</b> [<b>--rstrip</b>] [&gt;<i>text</i>]
<div style="margin-left: 4.00ex;">Append text to the comments of commits and
  tags in the specified selection set. The text is the first token of the
  command and may be a quoted string. C-style escape sequences in the string are
  interpreted using Python's string_decode codec.
<div style="height: 1.00em;">&#x00A0;</div>
If the option --rstrip is given, the comment is right-stripped before the new
  text is appended.</div>
<div class="Pp"></div>
<b>filter</b> [<i>--shell</i>|<i>--regex</i>|<i>--replace</i>|<i>--dedos</i>]
<div style="margin-left: 4.00ex;">Run blobs, commit comments, or tag comments in
  the selection set through the filter specified on the command line.
<div style="height: 1.00em;">&#x00A0;</div>
In any mode other than --dedos, attempting to specify a selection set including
  both blobs and non-blobs (that is, commits or tags) throws an error. Inline
  content in commits is filtered when the selection set contains (only) blobs
  and the commit is within the range bounded by the earliest and latest blob in
  the specification.
<div style="height: 1.00em;">&#x00A0;</div>
When filtering blobs, if the command line contains the magic cookie '%PATHS%' it
  is replaced with a space-separated list of all paths that reference the blob.
<div style="height: 1.00em;">&#x00A0;</div>
With --shell, the remainder of the line specifies a filter as a shell command.
  Each blob or comment is presented to the filter on standard input; the content
  is replaced with whatever the filter emits to standard output.
<div style="height: 1.00em;">&#x00A0;</div>
With --regex, the remainder of the line is expected to be a Python regular
  expression substitution written as /from/to/ with from and to being passed as
  arguments to the standard re.sub() function and it applied to modify the
  content. Actually, any non-space character will work as a delimiter in place
  of the /; this makes it easier to use / in patterns. Ordinarily only the first
  such substitution is performed; putting 'g' after the slash replaces globally,
  and a numeric literal gives the maximum number of substitutions to perform.
  Other flags available restrict substitution scope - 'c' for comment text only,
  'C' for committer name only, 'a' for author names only. Note that parsing of a
  --regex argument will be confused by ant substring consisting of whitespace
  followed by #; use &quot;\s&quot; rather than whitespace to avoid this.
<div style="height: 1.00em;">&#x00A0;</div>
With --replace, the behavior is like --regexp but the expressions are not
  interpreted as regular expressions. (This is slightly faster).
<div style="height: 1.00em;">&#x00A0;</div>
With --dedos, DOS/Windows-style \r\n line terminators are replaced with
  \n.</div>
<div class="Pp"></div>
<b>transcode</b> <i>codec</i>
<div style="margin-left: 4.00ex;">Transcode blobs, commit comments and
  committer/author names, or tag comments and tag committer names in the
  selection set to UTF-8 from the character encoding specified on the command
  line.
<div style="height: 1.00em;">&#x00A0;</div>
Attempting to specify a selection set including both blobs and non-blobs (that
  is, commits or tags) throws an error. Inline content in commits is filtered
  when the selection set contains (only) blobs and the commit is within the
  range bounded by the earliest and latest blob in the specification.
<div style="height: 1.00em;">&#x00A0;</div>
The encoding argument must name one of the codecs known to the Python standard
  codecs library. In particular, 'latin-1' is a valid codec name.
<div style="height: 1.00em;">&#x00A0;</div>
Errors in this command are fatal, because an error may leave repository objects
  in a damaged state.
<div style="height: 1.00em;">&#x00A0;</div>
The theory behind the design of this command is that the repository might
  contain a mixture of encodings used to enter commit metadata by different
  people at different times. After using =I to identify metadata containing
  non-Unicode high bytes in text, a human must use context to identify which
  particular encodings were used in particular event spans and compose
  appropriate transcode commands to fix them up.</div>
<div class="Pp"></div>
<b>edit</b>
<div style="margin-left: 4.00ex;">Report the selection set of events to a
  tempfile as mailbox_out does, call an editor on it, and update from the result
  as mailbox_in does. If you do not specify an editor name as second argument,
  it will be taken from the $EDITOR variable in your environment.
<div style="height: 1.00em;">&#x00A0;</div>
Normally this command ignores blobs because <b>mailbox_out</b> does. However, if
  you specify a selection set consisting of a single blob, your editor will be
  called directly on the blob file.</div>
<div class="Pp"></div>
<b>timeoffset</b> offset [<i>timezone</i>]
<div style="margin-left: 4.00ex;">Apply a time offset to all time/date stamps in
  the selected set. An offset argument is required; it may be in the form
  [+-]ss, [+-]mm:ss or [+-]hh:mm:ss. The leading sign is required to distinguish
  it from a selection expression.
<div style="height: 1.00em;">&#x00A0;</div>
Optionally you may also specify another argument in the form [+-]hhmm, a
  timezone literal to apply. To apply a timezone without an offset, use an
  offset literal of +0 or -0.</div>
<div class="Pp"></div>
<b>unite</b> [--prune] <i>reponame</i>...
<div style="margin-left: 4.00ex;">Unite repositories. Name any number of loaded
  repositories; they will be united into one union repo and removed from the
  load list. The union repo will be selected.
<div style="height: 1.00em;">&#x00A0;</div>
The root of each repo (other than the oldest repo) will be grafted as a child to
  the last commit in the dump with a preceding commit date. This will produce a
  union repository with one branch for each part. Running last to first,
  duplicate tag and branch names will be disambiguated using the source
  repository name (thus, recent duplicates will get priority over older ones).
  After all grafts, marks will be renumbered.
<div style="height: 1.00em;">&#x00A0;</div>
The name of the new repo will be the names of all parts concatenated, separated
  by '+'. It will have no source directory or preferred system type.
<div style="height: 1.00em;">&#x00A0;</div>
With the option --prune, at each join D operations for every ancestral file
  existing will be prepended to the root commit, then it will be canonicalized
  using the rules for squashing the effect will be that only files with properly
  matching M, R, and C operations in the root survive.</div>
<div class="Pp"></div>
<b>graft</b> [--prune] <i>reponame</i>
<div style="margin-left: 4.00ex;">For when unite doesn't give you enough
  control. This command may have either of two forms, selected by the size of
  the selection set. The first argument is always required to be the name of a
  loaded repo.
<div style="height: 1.00em;">&#x00A0;</div>
If the selection set is of size 1, it must identify a single commit in the
  currently chosen repo; in this case the name repo's root will become a child
  of the specified commit. If the selection set is empty, the named repo must
  contain one or more callouts matching a commits in the currently chosen repo.
<div style="height: 1.00em;">&#x00A0;</div>
Labels and branches in the named repo are prefixed with its name; then it is
  grafted to the selected one. Any other callouts in the named repo are also
  resolved in the context of the currently chosen one. Finally, the named repo
  is removed from the load list.
<div style="height: 1.00em;">&#x00A0;</div>
With the option --prune, prepend a deleteall operation into the root of the
  grafted repository.</div>
<div class="Pp"></div>
<b>path</b> [<i>source</i>] <b>rename</b> [<b>--force</b>] [<i>target</i>]
<div style="margin-left: 4.00ex;">Rename a path in every fileop of every
  selected commit. The default selection set is all commits. The first argument
  is interpreted as a Python regular expression to match against paths; the
  second may contain back-reference syntax.
<div style="height: 1.00em;">&#x00A0;</div>
Ordinarily, if the target path already exists in the fileops, or is visible in
  the ancestry of the commit, this command throws an error. With the
  <b>--force</b> option, these checks are skipped.</div>
<div class="Pp"></div>
<b>paths</b> [<b>{sub|sup}</b>] [<b>dirname</b>] [&gt;<i>outfile</i>]
<div style="margin-left: 4.00ex;">Takes a selection set. Without a modifier,
  list all paths touched by fileops in the selection set (which defaults to the
  entire repo). This reporting variant does &gt;-redirection.
<div style="height: 1.00em;">&#x00A0;</div>
With the 'sub' modifier, take a second argument that is a directory name and
  prepend it to every path. With the 'sup' modifier, strip any directory
  argument from the start of the path if it appears there; with no argument,
  strip the first directory component from every path.</div>
<div class="Pp"></div>
<b>merge</b>
<div style="margin-left: 4.00ex;">Create a merge link. Takes a selection set
  argument, ignoring all but the lowest (source) and highest (target) members.
  Creates a merge link from the highest member (child) to the lowest
  (parent).</div>
<div class="Pp"></div>
<b>unmerge</b>
<div style="margin-left: 4.00ex;">Linearize a commit. Takes a selection set
  argument, which must resolve to a single commit, and removes all its parents
  except for the first.
<div style="height: 1.00em;">&#x00A0;</div>
It is equivalent to <b>reparent</b> <i>first_parent</i>,<i>commit</i>
  <b>rebase</b>, where <i>commit</i> is the same selection set as used with
  unmerge and <i>first_parent</i> is a set resolving <i>commit</i>'s first
  parent (see the <b>reparent</b> command below
<div style="height: 1.00em;">&#x00A0;</div>
The main interest of the <b>unmerge</b> is that you don't have to find and
  specify the first parent yourself, saving time and avoiding errors when nearby
  surgery would make a manual first parent argument stale.</div>
<div class="Pp"></div>
<b>reparent</b> [<i>options</i>...] [<i>policy</i>]
<div style="margin-left: 4.00ex;">Changes the parent list of a commit. Takes a
  selection set, zero or more option arguments, and an optional policy argument.
<div class="Pp"></div>
Selection set:
<div style="margin-left: 4.00ex;">The selection set must resolve to one or more
  commits. The selected commit with the highest event number (not necessarily
  the last one selected) is the commit to modify. The remainder of the selected
  commits, if any, become its parents: the selected commit with the lowest event
  number (which is not necessarily the first one selected) becomes the first
  parent, the selected commit with second lowest event number becomes the second
  parent, and so on. All original parent links are removed. Examples:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
# this makes 17 the parent of 33
17,33 reparent
<div class="Pp"></div>
# this also makes 17 the parent of 33
33,17 reparent
<div class="Pp"></div>
# this makes 33 a root (parentless) commit
33 reparent
<div class="Pp"></div>
# this makes 33 an octopus merge commit.  its first parent
# is commit 15, second parent is 17, and third parent is 22
22,33,15,17 reparent
</pre>
</div>
</div>
<div class="Pp"></div>
Options:
<div style="margin-left: 4.00ex;">
<div class="Pp"></div>
<b>--use-order</b>
<div style="margin-left: 4.00ex;">Use the selection order to determine which
  selected commit is the commit to modify and which are the parents (and if
  there are multiple parents, their order). The last selected commit (not
  necessarily the one with the highest event number) is the commit to modify,
  the first selected commit (not necessarily the one with the lowest event
  number) becomes the first parent, the second selected commit becomes the
  second parent, and so on. Examples:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
# this makes 33 the parent of 17
33|17 reparent --use-order
<div class="Pp"></div>
# this makes 17 an octopus merge commit.  its first parent
# is commit 22, second parent is 33, and third parent is 15
22,33,15|17 reparent --use-order
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
Because ancestor commit events must appear before their descendants, giving a
  commit with a low event number a parent with a high event number triggers a
  re-sort of the events. A re-sort assigns different event numbers to some or
  all of the events. Re-sorting only works if the reparenting does not introduce
  any cycles. To swap the order of two commits that have an
  ancestor&#x2013;descendant relationship without introducing a cycle during the
  process, you must reparent the descendant commit first.</div>
</div>
<div class="Pp"></div>
Policy:
<div style="margin-left: 4.00ex;">By default, the manifest of the reparented
  commit is computed before modifying it; a deleteall and some fileops are
  prepended so that the manifest stays unchanged even when the first parent has
  been changed. This behavior can be changed by specifying a policy:
<div class="Pp"></div>
<b>rebase</b>
<div style="margin-left: 4.00ex;">Inhibits the default behavior&#x2014;no
  deleteall is issued and the tree contents of all descendents can be modified
  as a result.</div>
</div>
</div>
<div class="Pp"></div>
<b>branch</b> <i>branchname</i>... {<b>rename</b>|<b>delete</b>} [<i>arg</i>]
<div style="margin-left: 4.00ex;">Rename or delete a branch (and any associated
  resets). First argument must be an existing branch name; second argument must
  one of the verbs 'rename' or 'delete'.
<div style="height: 1.00em;">&#x00A0;</div>
For a 'rename', the third argument may be any token that is a syntactically
  valid branch name (but not the name of an existing branch). For a 'delete', no
  third argument is required.
<div style="height: 1.00em;">&#x00A0;</div>
For either name, if it does not contain a '/' the prefix 'refs/heads' is
  prepended.</div>
<div class="Pp"></div>
<b>tag</b> <i>tagname</i>... <b>{move|rename|delete}</b> <b>[arg]</b>.
<div style="margin-left: 4.00ex;">Create, move, rename, or delete a tag.
<div style="height: 1.00em;">&#x00A0;</div>
Creation is a special case. First argument is a nane, which must not be an
  existing tag. Takes a singleton event second argument which must point to a
  commit. A tag object pointing to the commit is created and inserted just after
  the last tag in the repo (or just after the last commit if there are no tags).
  The tagger, committish, and comment fields are copied from the commit's
  committer, mark, and comment fields.
<div style="height: 1.00em;">&#x00A0;</div>
Otherwise, first argument must be an existing tag name; second argument must be
  one of the verbs &#x201C;move&#x201D;, &#x201C;rename&#x201D;, or
  &#x201C;delete&#x201D;.
<div style="height: 1.00em;">&#x00A0;</div>
For a &#x201C;move&#x201D;, a third argument must be a singleton selection set.
  For a &#x201C;rename&#x201D;, the third argument may be any token that is a
  syntactically valid tag name (but not the name of an existing tag). For a
  &#x201C;delete&#x201D;, no third argument is required.
<div style="height: 1.00em;">&#x00A0;</div>
The behavior of this command is complex because features which present as tags
  may be any of three things: (1) True tag objects, (2) lightweight tags,
  actually sequences of commits with a common branchname beginning with
  &#x201C;refs/tags&#x201D; - in this case the tag is considered to point to the
  last commit in the sequence, (3) Reset objects. These may occur in
  combination; in fact, stream exporters from systems with annotation tags
  commonly express each of these as a true tag object (1) pointing at the tip
  commit of a sequence (2) in which the basename of the common branch field is
  identical to the tag name. An exporter that generates lightweight-tagged
  commit sequences (2) may or may not generate resets pointing at their tip
  commits.
<div style="height: 1.00em;">&#x00A0;</div>
This command tries to handle all combinations in a natural way by doing up to
  three operations on any true tag, commit sequence, and reset matching the
  source name. In a rename, all are renamed together. In a delete, any matching
  tag or reset is deleted; then matching branch fields are changed to match the
  branch of the unique descendent of the tagged commit, if there is one. When a
  tag is moved, no branch fields are changed and a warning is issued.
<div style="height: 1.00em;">&#x00A0;</div>
Attempts to delete a lightweight tag may fail with the message &#x201C;couldn't
  determine a unique successor&#x201D;. When this happens, the tag is on a
  commit with multiple children that have different branch labels. There is a
  hole in the specification of git fast-import streams that leaves it uncertain
  how branch labels can be safely reassigned in this case; rather than do
  something risky, <b>reposurgeon</b> throws a recoverable error.</div>
<div class="Pp"></div>
<b>reset</b> <i>resetname</i>... <b>{move|rename|delete}</b> <b>[arg]</b>.
<div style="margin-left: 4.00ex;">Move, rename, or delete a reset. First
  argument must match an existing reset name; second argument must be one of the
  verbs &#x201C;move&#x201D;, &#x201C;rename&#x201D;, or &#x201C;delete&#x201D;.
<div style="height: 1.00em;">&#x00A0;</div>
For a &#x201C;move&#x201D;, a third argument must be a singleton selection set.
  For a &#x201C;rename&#x201D;, the third argument may be any token token that
  matches a syntactically valid reset name (but not the name of an existing
  reset). For a &#x201C;delete&#x201D;, no third argument is required.
<div style="height: 1.00em;">&#x00A0;</div>
For either name, if it does not contain a &#x201C;/&#x201D; the prefix
  &#x201C;heads/&#x201D; is prepended. If it does not begin with
  &#x201C;refs/&#x201D;, &#x201C;refs/&#x201D; is prepended.
<div style="height: 1.00em;">&#x00A0;</div>
An argument matches a reset's name if it is either the entire reference
  (refs/heads/FOO or refs/tags/FOO for some some value of FOO) or the basename
  (e.g. FOO), or a suffix of the form heads/FOO or tags/FOO. An unqualified
  basename is assumed to refer to a head.
<div style="height: 1.00em;">&#x00A0;</div>
When a reset is renamed, commit branch fields matching the tag are renamed with
  it to match. When a reset is deleted, matching branch fields are changed to
  match the branch of the unique descendent of the tip commit of the associated
  branch, if there is one. When a reset is moved, no branch fields are
  changed.</div>
<div class="Pp"></div>
<b>debranch</b> <i>source-branch</i>... <b>[target-branch]</b>.
<div style="margin-left: 4.00ex;">Takes one or two arguments which must be the
  names of source and target branches; if the second (target) argument is
  omitted it defaults to refs/heads/master. Any trailing segment of a branch
  name is accepted as a synonym for it; thus master is the same as
  refs/heads/master. Does not take a selection set.
<div style="height: 1.00em;">&#x00A0;</div>
The history of the source branch is merged into the history of the target
  branch, becoming the history of a subdirectory with the name of the source
  branch. Any resets of the source branch are removed.</div>
<div class="Pp"></div>
<b>strip</b> <b>[blobs|reduce]</b>.
<div style="margin-left: 4.00ex;">Reduce the selected repository to make it a
  more tractable test case. Use this when reporting bugs.
<div style="height: 1.00em;">&#x00A0;</div>
With the modifier 'blobs', replace each blob in the repository with a small,
  self-identifying stub, leaving all metadata and DAG topology intact. This is
  useful when you are reporting a bug, for reducing large repositories to test
  cases of manageable size.
<div style="height: 1.00em;">&#x00A0;</div>
A selection set is effective only with the 'blobs' option, defaulting to all
  blobs. The 'reduce' mode always acts on the entire repository.
<div style="height: 1.00em;">&#x00A0;</div>
With the modifier 'reduce', perform a topological reduction that throws out
  uninteresting commits. If a commit has all file modifications (no deletions or
  copies or renames) and has exactly one ancestor and one descendant, then it
  may be boring. To be fully boring, it must also not be referred to by any tag
  or reset. Interesting commits are not boring, or have a non-boring parent or
  non-boring child.
<div style="height: 1.00em;">&#x00A0;</div>
With no modifiers, this command strips blobs.</div>
<div class="Pp"></div>
<b>ignores</b> <b>[rename]</b>. <b>[translate]</b>. <b>[defaults]</b>.
<div style="margin-left: 4.00ex;">Intelligent handling of ignore-pattern files.
  This command fails if no repository has been selected or no preferred write
  type has been set for the repository. It does not take a selection set.
<div style="height: 1.00em;">&#x00A0;</div>
If the rename modifier is present, this command attempts to rename all
  ignore-pattern files to whatever is appropriate for the preferred type - e.g.
  .gitignore for git, .hgignore for hg, etc. This option does not cause any
  translation of the ignore files it renames.
<div style="height: 1.00em;">&#x00A0;</div>
If the translate modifier is present, syntax translation of each ignore file is
  attempted. At present, the only transformation the code knows is to prepend a
  'syntax: glob' header if the preferred type is hg.
<div style="height: 1.00em;">&#x00A0;</div>
If the defaults modifier is present, the command attempts to prepend these
  default patterns to all ignore files. If no ignore file is created by the
  first commit, it will be modified to create one containing the defaults. This
  command will error out on prefer types that have no default ignore patterns
  (git and hg, in particular). It will also error out when it knows the import
  tool has already set default patterns.</div>
<h2 class="Ss" title="Ss" id="REFERENCE_LIFTING"><a class="selflink" href="#REFERENCE_LIFTING">REFERENCE
  LIFTING</a></h2>
This group of commands is meant for fixing up references in commits that are in
  the format of older version control systems. The general workflow is this:
  first, go over the comment history and change all old-fashioned commit
  references into machine-parseable cookies. Then, automatically turn the
  machine-parseable cookie into action stamps. The point of dividing the process
  this way is that the first part is hard for a machine to get right, while the
  second part is prone to errors when a human does it.
<div class="Pp"></div>
A Subversion cookie is a comment substring of the form [[SVN:ddddd]] (example:
  [[SVN:2355]] with the revision read directly via the Subversion exporter,
  deduced from git-svn metadata, or matching a $Revision$ header embedded in
  blob data for the filename.
<div class="Pp"></div>
A CVS cookie is a comment substring of the form [[CVS:filename:revision]]
  (example: [[CVS:src/README:1.23]] with the revision matching a CVS $Id$ or
  $Revision$ header embedded in blob data for the filename.
<div class="Pp"></div>
A mark cookie is of the form [[:dddd]] and is simply a reference to the
  specified mark. You may want to hand-patch this in when one of previous forms
  is inconvenient.
<div class="Pp"></div>
An action stamp is an RFC3339 timestamp, followed by a '!', followed by an
  author email address (author rather than committer because that timestamp is
  not changed when a patch is replayed on to a branch). It attempts to refer to
  a commit without being VCS-specific. Thus, instead of &quot;commit
  304a53c2&quot; or &quot;r2355&quot;,
  &quot;2011-10-25T15:11:09Z!fred@foonly.com&quot;.
<div class="Pp"></div>
The following git aliases allow git to work directly with action stamps. Append
  it to your ~/.gitconfig; if you already have an [alias] section, leave off the
  first line.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
<div class="Pp"></div>
[alias]
	# git stamp &lt;commit-ish&gt; - print a reposurgeon-style action stamp
	stamp = show -s --format='%cI!%ce'
<div class="Pp"></div>
	# git scommit &lt;stamp&gt; &lt;rev-list-args&gt; - list most recent commit that matches &lt;stamp&gt;.
	# Must also specify a branch to search or --all, after these arguments.
	scommit = &quot;!f(){ d=${1%%!*}; a=${1##*!}; arg=\&quot;--until=$d -1\&quot;; if [ $a != $1 ]; then arg=\&quot;$arg --committer=$a\&quot;; fi; shift; git rev-list $arg ${1:+\&quot;$@\&quot;}; }; f&quot;
<div class="Pp"></div>
	# git scommits &lt;stamp&gt; &lt;rev-list-args&gt; - as above, but list all matching commits.
	scommits = &quot;!f(){ d=${1%%!*}; a=${1##*!}; arg=\&quot;--until=$d --after $d\&quot;; if [ $a != $1 ]; then arg=\&quot;$arg --committer=$a\&quot;; fi; shift; git rev-list $arg ${1:+\&quot;$@\&quot;}; }; f&quot;
<div class="Pp"></div>
	# git smaster &lt;stamp&gt; - list most recent commit on master that matches &lt;stamp&gt;.
	smaster = &quot;!f(){ git scommit \&quot;$1\&quot; master --first-parent; }; f&quot;
	smasters = &quot;!f(){ git scommits \&quot;$1\&quot; master --first-parent; }; f&quot;
<div class="Pp"></div>
	# git shs &lt;stamp&gt; - show the commits on master that match &lt;stamp&gt;.
	shs = &quot;!f(){ stamp=$(git smasters $1); shift; git show ${stamp:?not found} $*; }; f&quot;
<div class="Pp"></div>
	# git slog &lt;stamp&gt; &lt;log-args&gt; - start git log at &lt;stamp&gt; on master
	slog = &quot;!f(){ stamp=$(git smaster $1); shift; git log ${stamp:?not found} $*; }; f&quot;
<div class="Pp"></div>
	# git sco &lt;stamp&gt; - check out most recent commit on master that matches &lt;stamp&gt;.
	sco = &quot;!f(){ stamp=$(git smaster $1); shift; git checkout ${stamp:?not found} $*; }; f&quot;
<div class="Pp"></div>
</pre>
</div>
<div class="Pp"></div>
There is a rare case in which an action stamp will not refer uniquely to one
  commit. It is theoretically possible that the same author might check in
  revisions on different branches within the one-second resolution of the
  timestamps in a fast-import stream. There is nothing to be done about this;
  tools using action stamps need to be aware of the possibility and throw a
  warning when it occurs.
<div class="Pp"></div>
In order to support reference lifting, <b>reposurgeon</b> internally builds a
  legacy-reference map that associates revision identifiers in older
  version-control systems with commits. The contents of this map comes from
  three places: (1) cvs2svn:rev properties if the repository was read from a
  Subversion dump stream, (2) $Id$ and $Revision$ headers in repository files,
  and (3) the .git/cvs-revisions created by <b>git cvsimport</b>.
<div class="Pp"></div>
The detailed sequence for lifting possible references is this: first, find
  possible CVS and Subversion references with the <b>references</b> or =N
  visibility set; then replace them with equivalent cookies; then run
  <b>references lift</b> to turn the cookies into action stamps (using the
  information in the legacy-reference map) without having to do the lookup by
  hand.
<div class="Pp"></div>
<b>references</b> [<b>list</b>|<b>edit</b>|<b>lift</b>] [&gt;<i>outfile</i>]
<div style="margin-left: 4.00ex;">With the modifier 'list', list commit and tag
  comments for strings that might be CVS- or Subversion-style revision
  identifiers. This will be useful when you want to replace them with equivalent
  cookies that can automatically be translated into VCS-independent action
  stamps. This reporting command supports &gt;-redirection. It is equivalent to
  '=N list'.
<div style="height: 1.00em;">&#x00A0;</div>
With the modifier 'edit', edit the set where revision IDs are found. This is
  equivalent to '=N edit'.
<div style="height: 1.00em;">&#x00A0;</div>
With the modifier &quot;lift&quot;, attempt to resolve Subversion and CVS
  cookies in comments into action stamps using the legacy map. An action stamp
  is a timestamp/email/sequence-number combination uniquely identifying the
  commit associated with that blob, as described in the section called
  &#x201C;TRANSLATION STYLE&#x201D;.
<div style="height: 1.00em;">&#x00A0;</div>
It is not guaranteed that every such reference will be resolved, or even that
  any at all will be. Normally all references in history from a Subversion
  repository will resolve, but CVS references are less likely to be
  resolvable.</div>
<h2 class="Ss" title="Ss" id="VARIABLES,_MACROS_AND_EXTENSIONS"><a class="selflink" href="#VARIABLES,_MACROS_AND_EXTENSIONS">VARIABLES,
  MACROS AND EXTENSIONS</a></h2>
Occasionally you will need to issue a large number of complex surgical commands
  of very similar form, and it's convenient to be able to package that form so
  you don't need to do a lot of error-prone typing. For those occasions,
  <b>reposurgeon</b> supports simple forms of named variables and macro
  expansion.
<div class="Pp"></div>
<b>assign</b> [<i>name</i>]
<div style="margin-left: 4.00ex;">Compute a leading selection set and assign it
  to a symbolic name. It is an error to assign to a name that is already
  assigned, or to any existing branch name. Assignments may be cleared by
  sequence mutations (though not ordinary deletions); you will see a warning
  when this occurs.
<div style="height: 1.00em;">&#x00A0;</div>
With no selection set and no name, list all assignments.&gt;
<div style="height: 1.00em;">&#x00A0;</div>
Use this to optimize out location and selection computations that would
  otherwise be performed repeatedly, e.g. in macro calls.</div>
<div class="Pp"></div>
<b>unassign</b> [<i>name</i>]
<div style="margin-left: 4.00ex;">Unassign a symbolic name. Throws an error if
  the name is not assigned.</div>
<div class="Pp"></div>
<b>names</b> [&gt;<i>outfile</i>]
<div style="margin-left: 4.00ex;">List the names of all known branches and tags.
  Tells you what things are legal within angle brackets and parentheses.</div>
<div class="Pp"></div>
<b>define</b> <i>name</i> <i>body</i>
<div style="margin-left: 4.00ex;">Define a macro. The first whitespace-separated
  token is the name; the remainder of the line is the body, unless it is
  &#x201C;{&#x201D;, which begins a multi-line macro terminated by a line
  beginning with &#x201C;}&#x201D;.
<div style="height: 1.00em;">&#x00A0;</div>
A later &#x201C;do&#x201D; call can invoke this macro.
<div style="height: 1.00em;">&#x00A0;</div>
The command &#x201C;define&#x201D; by itself without a name or body produces a
  macro list.</div>
<div class="Pp"></div>
<b>do</b> <i>name</i> <i>arguments</i>...
<div style="margin-left: 4.00ex;">Expand and perform a macro. The first
  whitespace-separated token is the name of the macro to be called; remaining
  tokens replace {0}, {1}... in the macro definition (the conventions used are
  those of the Python format method). Tokens may contain whitespace if they are
  string-quoted; string quotes are stripped. Macros can call macros.
<div style="height: 1.00em;">&#x00A0;</div>
If the macro expansion does not itself begin with a selection set, whatever set
  was specified before the &quot;do&quot; keyword is available to the command
  generated by the expansion.</div>
<div class="Pp"></div>
<b>undefine</b> <i>name</i>]
<div style="margin-left: 4.00ex;">Undefine the named macro.</div>
<div class="Pp"></div>
Here's an example to illustrate how you might use this. In CVS repositories of
  projects that use the GNU ChangeLog convention, a very common pre-conversion
  artifact is a commit with the comment &quot;***empty log message***&quot; that
  modifies only a ChangeLog entry explaining the commit immediately previous to
  it. The following
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
define changelog &lt;{0}&gt; &amp; /empty log message/ squash --pushback
do changelog 2012-08-14T21:51:35Z
do changelog 2012-08-08T22:52:14Z
do changelog 2012-08-07T04:48:26Z
do changelog 2012-08-08T07:19:09Z
do changelog 2012-07-28T18:40:10Z
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
is equivalent to the more verbose
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
&lt;2012-08-14T21:51:35Z&gt; &amp; /empty log message/ squash --pushback
&lt;2012-08-08T22:52:14Z&gt; &amp; /empty log message/ squash --pushback
&lt;2012-08-07T04:48:26Z&gt; &amp; /empty log message/ squash --pushback
&lt;2012-08-08T07:19:09Z&gt; &amp; /empty log message/ squash --pushback
&lt;2012-07-28T18:40:10Z&gt; &amp; /empty log message/ squash --pushback
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
but you are less likely to make difficult-to-notice errors typing the first
  version.
<div class="Pp"></div>
(Also note how the text regexp acts as a failsafe against the possibility of
  typing a wrong date that doesn't refer to a commit with an empty comment. This
  was a real-world example from the CVS-to-git conversion of groff.)
<div class="Pp"></div>
When even a macro is not enough, you can write and call custom Python
  extensions.
<div class="Pp"></div>
<b>exec</b> <i>name</i>
<div style="margin-left: 4.00ex;">Execute custom code from standard input
  (normally a file via &lt; redirection). Use this to set up custom extension
  functions for later eval calls. The code has full access to all internal data
  structures. Functions defined are accessible to later <b>eval</b> calls.
<div style="height: 1.00em;">&#x00A0;</div>
This can be called in a script with the extension code in a here-doc.</div>
<div class="Pp"></div>
<b>eval</b> <i>function-name</i>
<div style="margin-left: 4.00ex;">Evaluate a line of code in the current
  interpreter context. Typically this will be a call to a function defined by a
  previous exec. The variables <i>_repository</i> and <i>_selection</i> will
  have the obvious values. Note that <i>_selection</i> will be a list of
  integers, not objects.</div>
<div class="Pp"></div>
<b>script</b> <i>filename</i> [<i>arg</i>...]
<div style="margin-left: 4.00ex;">Takes a filename and optional following
  arguments. Reads each line from the file and executes it as a command.
<div style="height: 1.00em;">&#x00A0;</div>
During execution of the script, the script name replaces the string $0 and the
  optional following arguments (if any) replace the strings $1, $2 ... $n in the
  script text. This is done before tokenization, so the $1 in a string like
  &#x201C;foo$1bar&#x201D; will be expanded. Additionally, $$ is expanded to the
  current process ID (which may be useful for scripts that use tempfiles).
<div style="height: 1.00em;">&#x00A0;</div>
Within scripts (and only within scripts) <b>reposurgeon</b> accepts a slightly
  extended syntax: First, a backslash ending a line signals that the command
  continues on the next line. Any number of consecutive lines thus escaped are
  concatenated, without the ending backslashes, prior to evaluation. Second, a
  command that takes an input filename argument can instead take literal
  following data in the syntax of a shell here-document. That is: if the
  filename is replaced by &quot;&lt;&lt;EOF&quot;, all following lines in the
  script up to a terminating line consisting only of &quot;EOF&quot; will be
  read, placed in a temporary file, and that file fed to the command and
  afterwards deleted. EOF may be replaced by any string. Backslashes have no
  special meaning while reading a here-document.
<div style="height: 1.00em;">&#x00A0;</div>
Scripts may have comments. Any line beginning with a '#' is ignored. If a line
  has a trailing position that begins with one or more whitespace characters
  followed by '#', that trailing portion is ignored.</div>
<h2 class="Ss" title="Ss" id="ARTIFACT_REMOVAL"><a class="selflink" href="#ARTIFACT_REMOVAL">ARTIFACT
  REMOVAL</a></h2>
Some commands automate fixing various kinds of artifacts associated with
  repository conversions from older systems.
<div class="Pp"></div>
<b>authors</b> [<b>read</b>|<b>write</b>] [&lt;<b>filename</b>]
  [&gt;<b>filename</b>]
<div style="margin-left: 4.00ex;">Apply or dump author-map information for the
  specified selection set, defaulting to all events.
<div style="height: 1.00em;">&#x00A0;</div>
Lifts from CVS and Subversion may have only usernames local to the repository
  host in committer and author IDs. DVCSes want email addresses (net-wide
  identifiers) and complete names. To supply the map from one to the other, an
  authors file is expected to consist of lines each beginning with a local user
  ID, followed by a '=' (possibly surrounded by whitespace) followed by a full
  name and email address, optionally followed by a timezone offset field. Thus:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
ferd = Ferd J. Foonly &lt;foonly@foo.com&gt; -0500
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
An authors file may have comment lines beginning with '#'; these are ignored.
<div style="height: 1.00em;">&#x00A0;</div>
When an authors file is applied, email addresses in committer and author
  metadata for which the local ID matches between &lt; and @ are replaced
  according to the mapping (this handles git-svn lifts). Alternatively, if the
  local ID is the entire address, this is also considered a match (this handles
  what git-cvsimport and cvs2git do)
<div style="height: 1.00em;">&#x00A0;</div>
With the 'read' modifier, or no modifier, apply author mapping data (from
  standard input or a &lt;-redirected file). May be useful if you are editing a
  repo or dump created by <b>cvs2git</b> or by <b>git-svn</b> invoked without
  -A.
<div style="height: 1.00em;">&#x00A0;</div>
With the 'write' modifier, write a mapping file that could be interpreted by
  <b>authors read</b>, with entries for each unique committer, author, and
  tagger (to standard output or a &lt;-redirected mapping file). This may be
  helpful as a start on building an authors file, though each part to the right
  of an equals sign will need editing.</div>
<div class="Pp"></div>
<b>branchify</b> [<i>path-set</i>]
<div style="margin-left: 4.00ex;">Specify the list of directories to be treated
  as potential branches (to become tags if there are no modifications after the
  creation copies) when analyzing a Subversion repo. This list is ignored when
  the <b>--nobranch</b> read option is used. It defaults to the 'standard
  layout' set of directories, plus any unrecognized directories in the
  repository root.
<div style="height: 1.00em;">&#x00A0;</div>
With no arguments, displays the current branchification set.
<div style="height: 1.00em;">&#x00A0;</div>
An asterisk at the end of a path in the set means 'all immediate subdirectories
  of this path, unless they are part of another (longer) path in the branchify
  set'.
<div style="height: 1.00em;">&#x00A0;</div>
Note that the branchify set is a property of the reposurgeon interpreter, not of
  any individual repository, and will persist across Subversion dumpfile reads.
  This may lead to unexpected results if you forget to re-set it.</div>
<div class="Pp"></div>
<b>branchify_map</b> [<i>/regex/branch/</i>...]
<div style="margin-left: 4.00ex;">Specify the list of regular expressions used
  for mapping the svn branches that are detected by branchify. If none of the
  expressions match the default behaviour applies. This maps a branch to the
  name of the last directory, except for trunk and &#x201C;*&#x201D; which are
  mapped to master and root.
<div style="height: 1.00em;">&#x00A0;</div>
With no arguments the current regex replacement pairs are shown. Passing 'reset'
  will clear the mapping.
<div style="height: 1.00em;">&#x00A0;</div>
The branchify command will match each branch name against regex1 and if it
  matches rewrite its branch name to branch1. If not it will try regex2 and so
  forth until it either found a matching regex or there are no regexs left. The
  regular expressions should be in <b>Python's</b>[2]. format. The branch name
  can use backreferences (see the re.sub function in the Python documentation).
<div style="height: 1.00em;">&#x00A0;</div>
Note that the regular expressions are appended to 'refs/' without either the
  needed 'heads/' or 'tags/'. This allows for choosing the right kind of branch
  type.
<div style="height: 1.00em;">&#x00A0;</div>
While the syntax template above uses slashes, any first character will be used
  as a delimeter (and you will need to use a different one in the common case
  that the paths contain slashes).
<div style="height: 1.00em;">&#x00A0;</div>
Note that the branchify_map set is a property of the reposurgeon interpreter,
  not of any individual repository, and will persist across Subversion dumpfile
  reads. This may lead to unexpected results if you forget to re-set it.</div>
<h2 class="Ss" title="Ss" id="EXAMINING_TREE_STATES"><a class="selflink" href="#EXAMINING_TREE_STATES">EXAMINING
  TREE STATES</a></h2>
<b>manifest</b> [<i>regular expression</i>] [&gt;<i>outfile</i>]
<div style="margin-left: 4.00ex;">Takes an optional selection set argument
  defaulting to all commits, and an optional Python regular expression. For each
  commit in the selection set, print the mapping of all paths in that commit
  tree to the corresponding blob marks, mirroring what files would be created in
  a checkout of the commit. If a regular expression is given, only print
  &quot;path -&gt; mark&quot; lines for paths matching it. This command supports
  &gt; redirection.</div>
<div class="Pp"></div>
<b>checkout</b> <i>directory</i>
<div style="margin-left: 4.00ex;">Takes a selection set which must resolve to a
  single commit, and a second argument. The second argument is interpreted as a
  directory name. The state of the code tree at that commit is materialized
  beneath the directory.</div>
<div class="Pp"></div>
<b>diff</b> [&gt;<i>outfile</i>]
<div style="margin-left: 4.00ex;">Display the difference between commits. Takes
  a selection-set argument which must resolve to exactly two commits. Supports
  output redirection.</div>
<h2 class="Ss" title="Ss" id="HOUSEKEEPING"><a class="selflink" href="#HOUSEKEEPING">HOUSEKEEPING</a></h2>
These are backed up by the following housekeeping commands, none of which take a
  selection set:
<div class="Pp"></div>
<b>help</b>
<div style="margin-left: 4.00ex;">Get help on the interpreter commands.
  Optionally follow with whitespace and a command name; with no argument, lists
  all commands. '?' also invokes this.</div>
<div class="Pp"></div>
<b>shell</b>
<div style="margin-left: 4.00ex;">Execute the shell command given in the
  remainder of the line. '!' also invokes this.</div>
<div class="Pp"></div>
<b>prefer</b> [<i>repotype</i>]
<div style="margin-left: 4.00ex;">With no arguments, describe capabilities of
  all supported systems. With an argument (which must be the name of a supported
  system) this has two effects:
<div style="height: 1.00em;">&#x00A0;</div>
First, if there are multiple repositories in a directory you do a read on,
  reposurgeon will read the preferred one (otherwise it will complain that it
  can't choose among them).
<div style="height: 1.00em;">&#x00A0;</div>
Secondly, this will change reposurgeon's preferred type for output. This means
  that you do a write to a directory, it will build a repo of the preferred type
  rather than its original type (if it had one).
<div style="height: 1.00em;">&#x00A0;</div>
If no preferred type has been explicitly selected, reading in a repository (but
  not a fast-import stream) will implicitly set the preferred type to the type
  of that repository.
<div style="height: 1.00em;">&#x00A0;</div>
In older versions of reposurgeon this command changed the type of the selected
  repository, if there is one. That behavior interacted badly with attempts to
  interpret legacy IDs and has been removed.</div>
<div class="Pp"></div>
<b>sourcetype</b> [<i>repotype</i>]
<div style="margin-left: 4.00ex;">Report (with no arguments) or select (with one
  argument) the current repository's source type. This type is normally set at
  repository-read time, but may remain unset if the source was a stream file.
<div style="height: 1.00em;">&#x00A0;</div>
The source type affects the interpretation of legacy IDs (for purposes of the =N
  visibility set and the 'references' command) by controlling the regular
  expressions used to recognize them. If no preferred output type has been set,
  it may also change the output format of stream files made from the repository.
<div style="height: 1.00em;">&#x00A0;</div>
The source type is reliably set whenever a live repository is read, or when a
  Subversion stream or Fossil dump is interpreted but not necessarily by other
  stream files. Streams generated by <b>cvs-fast-export</b>(1) using the
  <b>--reposurgeon</b> are detected as CVS. In some other cases, the source
  system is detected from the presence of magic $-headers in contents
  blobs.</div>
<h2 class="Ss" title="Ss" id="INSTRUMENTATION"><a class="selflink" href="#INSTRUMENTATION">INSTRUMENTATION</a></h2>
A few commands have been implemented primarily for debugging and
  regression-testing purposes, but may be useful in unusual circumstances.
<div class="Pp"></div>
The output of most of these commands can individually be redirected to a named
  output file. Where indicated in the syntax, you can prefix the output filename
  with &#x201C;&gt;&#x201D; and give it as a following argument.
<div class="Pp"></div>
<b>index</b> [&gt;<i>outfile</i>]
<div style="margin-left: 4.00ex;">Display four columns of info on objects in the
  selection set: their number, their type, the associate mark (or '-' if no
  mark) and a summary field varying by type. For a branch or tag it's the
  reference; for a commit it's the commit branch; for a blob it's the repository
  path of the file in the blob.
<div style="height: 1.00em;">&#x00A0;</div>
The default selection set for this command is =CTRU, all objects except
  blobs.</div>
<div class="Pp"></div>
<b>resolve</b> [<i>label-text...</i>]
<div style="margin-left: 4.00ex;">Does nothing but resolve a selection-set
  expression and echo the resulting event-number set to standard output. The
  remainder of the line after the command is used as a label for the output.
<div style="height: 1.00em;">&#x00A0;</div>
Implemented mainly for regression testing, but may be useful for exploring the
  selection-set language.</div>
<div class="Pp"></div>
<b>verbose</b> [<i>n</i>]
<div style="margin-left: 4.00ex;">'verbose 1' enables the progress meter and
  messages, 'verbose 0' disables them. Higher levels of verbosity are available
  but intended for developers only.</div>
<div class="Pp"></div>
<b>quiet</b> [<i>on | off</i>]
<div style="margin-left: 4.00ex;">Without an argument, this command requests a
  report of the quiet boolean; with the argument 'on' or 'off' it is changed.
  When quiet is on, time-varying report fields which would otherwise cause
  spurious failures in regression testing are suppressed.</div>
<div class="Pp"></div>
<b>print</b> <i>output-text...</i>
<div style="margin-left: 4.00ex;">Does nothing but ship its argument line to
  standard output. Useful in regression tests.</div>
<div class="Pp"></div>
<b>echo</b> [<i>number</i>]
<div style="margin-left: 4.00ex;">'echo 1' causes each <b>reposurgeon</b>
  command to be echoed to standard output just before its output. This can be
  useful in constructing regression tests that are easily checked by
  eyeball.</div>
<div class="Pp"></div>
<b>version</b> [<i>version</i>...]
<div style="margin-left: 4.00ex;">With no argument, display the program version
  and the list of VCSes directly supported. With argument, declare the major
  version (single digit) or full version (major.minor) under which the enclosing
  script was developed. The program will error out if the major version has
  changed (which means the surgical language is not backwards compatible).
<div style="height: 1.00em;">&#x00A0;</div>
It is good practice to start your lift script with a version requirement,
  especially if you are going to archive it for later reference.</div>
<div class="Pp"></div>
<b>prompt</b> [<i>format</i>...]
<div style="margin-left: 4.00ex;">Set the command prompt format to the value of
  the command line; with an empty command line, display it. The prompt format is
  evaluated in Python after each command with the following dictionary
  substitutions:
<div class="Pp"></div>
chosen
<div style="margin-left: 4.00ex;">The name of the selected repository, or None
  if none is currently selected.</div>
<div style="height: 1.00em;">&#x00A0;</div>
Thus, one useful format might be 'rs[%(chosen)s]%% '.
<div style="height: 1.00em;">&#x00A0;</div>
More format items may be added in the future. The default prompt corresponds to
  the format 'reposurgeon%% '. The format line is evaluated with shell quotng of
  tokens, so that spaces can be included.</div>
<div class="Pp"></div>
<b>history</b>
<div style="margin-left: 4.00ex;">List the commands you have entered this
  session.</div>
<div class="Pp"></div>
<b>legacy</b> [<b>read</b>|<b>write</b>] [<b>&lt;filename</b>]
  [<b>&gt;filename</b>]
<div style="margin-left: 4.00ex;">Apply or list legacy-reference information.
  Does not take a selection set. The 'read' variant reads from standard input or
  a &lt;-redirected filename; the 'write' variant writes to standard output or a
  &gt;-redirected filename.
<div style="height: 1.00em;">&#x00A0;</div>
A legacy-reference file maps reference cookies to (committer, commit-date,
  sequence-number) pairs; these in turn (should) uniquely identify a commit. The
  format is two whitespace-separated fields: the cookie followed by an action
  stamp identifying the commit.
<div style="height: 1.00em;">&#x00A0;</div>
It should not normally be necessary to use this command. The legacy map is
  automatically preserved through repository reads and rebuilds, being stored in
  the file legacy-map under the repository subdirectory..</div>
<div class="Pp"></div>
<b>set</b> [<b>option</b>]
<div style="margin-left: 4.00ex;">Turn on an option flag. With no arguments,
  list all options
<div style="height: 1.00em;">&#x00A0;</div>
Most options are described in conjunction with the specific operations that the
  modify. One of general interest is &#x201C;compressblobs&#x201D;; this enables
  compression on the blob files in the internal representation reposurgeon uses
  for editing repositories. With this option, reading and writing of
  repositories is slower, but editing a repository requires less (sometimes much
  less) disk space.</div>
<div class="Pp"></div>
<b>clear</b> [<b>option</b>]
<div style="margin-left: 4.00ex;">Turn off an option flag. With no arguments,
  list all options</div>
<div class="Pp"></div>
<b>profile</b>
<div style="margin-left: 4.00ex;">Enable profiling. Profile statistics are
  dumped to the path given as argument. Must be one of the initial command-line
  arguments, and gathers statistics only on code executed via '-'.</div>
<div class="Pp"></div>
<b>timing</b>
<div style="margin-left: 4.00ex;">Display statistics on phase timing in
  repository analysis. Mainly of interest to developers trying to speed up the
  program.</div>
<div class="Pp"></div>
<b>exit</b>
<div style="margin-left: 4.00ex;">Exit, reporting the time. Included here
  because, while EOT will also cleanly exit the interpreter, this command
  reports elapsed time since start.</div>
<h1 class="Sh" title="Sh" id="WORKING_WITH_MERCURIAL"><a class="selflink" href="#WORKING_WITH_MERCURIAL">WORKING
  WITH MERCURIAL</a></h1>
reposurgeon uses a built-in extractor class to perform extractions from
  Mercurial repositories.
<div class="Pp"></div>
Mercurial branches are exported as branches in the exported repository and tags
  are exported as tags. By default, bookmarks are ignored. You can specify
  explicit handling for bookmarks by setting <i>reposurgeon.bookmarks</i> in
  your .hg/hgrc. Set the value to the prefix that reposurgeon should use for
  bookmarks.
<div class="Pp"></div>
For example, if your bookmarks represent branches, put this at the bottom of
  your .hg/hgrc:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
[reposurgeon]
bookmarks=heads/
</pre>
</div>
<div class="Pp"></div>
If you do that, it's your responsibility to ensure that branch names do not
  conflict with bookmark names. You can add a prefix like
  bookmarks=heads/feature- to disambiguate as necessary.
<h1 class="Sh" title="Sh" id="WORKING_WITH_SUBVERSION"><a class="selflink" href="#WORKING_WITH_SUBVERSION">WORKING
  WITH SUBVERSION</a></h1>
reposurgeon can read Subversion dumpfiles or edit a Subversion repository (and
  you must point it at a repository, not a checkout directory). The reposurgeon
  distribution includes a script named &#x201C;repotool&#x201D; that you can use
  to make and then incrementally update a local mirror of a remote repository
  for editing or conversion purposes.
<h2 class="Ss" title="Ss" id="READING_SUBVERSION_REPOSITORIES"><a class="selflink" href="#READING_SUBVERSION_REPOSITORIES">READING
  SUBVERSION REPOSITORIES</a></h2>
Certain optional modifiers on the read command change its behavior when reading
  Subversion repositories:
<div class="Pp"></div>
--nobranch
<div style="margin-left: 4.00ex;">Suppress branch analysis.</div>
<div class="Pp"></div>
--ignore-properties
<div style="margin-left: 4.00ex;">Suppress read-time warnings about discarded
  property settings.</div>
<div class="Pp"></div>
--user-ignores
<div style="margin-left: 4.00ex;">Don't generate .gitignore files from
  svn:ignore properties. Instead, just pass through .gitignore files found in
  the history.</div>
<div class="Pp"></div>
--use-uuid
<div style="margin-left: 4.00ex;">If the --use-uuid read option is set, the
  repository's UUID will be used as the hostname when faking up email addresses,
  a la git-svn. Otherwise, addresses will be generated the way git cvs-import
  does it, simply ciopying the username into the address field.</div>
<div class="Pp"></div>
These modifiers can go anywhere in any order on the read command line after the
  read verb. They must be whitespace-separated.
<div class="Pp"></div>
Here are the rules used for mapping subdirectories in a Subversion repository to
  branches:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 1.At any given time there is a set of
  eligible paths and path wildcards which declare potential branches. See the
  documentation of the <b>branchify</b> for how to alter this set, which
  initially consists of {trunk, tags/*, branches/*, and '*'}.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 2.A repository is considered &quot;flat&quot;
  if it has no directory that matches a path or path wildcard in the branchify
  set. All commits in a flat repository are assigned to branch master, and what
  would have been branch structure becomes directory structure. In this case,
  we're done; all the other rules apply to non-flat repos.
<div style="height: 1.00em;">&#x00A0;</div>
If you give the option <b>--nobranch</b> when reading a Subversion repository,
  branch analysis is skipped and the repository is treated as though flat (left
  as a linear sequence of commits on refs/heads/master). This may be useful if
  your repository configuration is highly unusual and you need to do your own
  branch surgery. Note that this option will disable partitioning of mixed
  commits.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 3.If &quot;trunk&quot; is eligible, it always
  becomes the master branch.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 4.If an element of the branchify set ends
  with *, each immediate subdirectory of it is considered a potential branch. If
  '*' is in the branchify set (which is true by default) all top-level
  directories other than /trunk, /tags, and /branches are also considered
  potential branches.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 5.Each potential branch is checked to see if
  it has commits on it after the initial creation or copy. If there are such
  commits, it becomes a branch. If not, it becomes a tag in order to preserve
  the commit metadata. (In all cases, the name of the tag or branch is the
  basename of the directory.)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 6.Files in the top-level directory are
  assigned to a synthetic branch named 'root'.</div>
<div class="Pp"></div>
Each commit that only creates or deletes directories (in particular, copy
  commits for tags and branches, and commits that only change properties) will
  be transformed into a tag named after the branch, containing the
  date/author/comment metadata from the commit. While this produces a desirable
  result for tags, non-tag branches (including trunk) will also get root tags
  this way. This apparent misfeature has been accepted so that reposurgeon will
  never destroy human-generated metadata that might have value; it is left up to
  the user to manually remove unwanted tags.
<div class="Pp"></div>
Subversion branch deletions are turned into deletealls, clearing the fileset of
  the import-stream branch. When a branch finishes with a deleteall at its tip,
  the deleteall is transformed into a tag. This rule cleans up after aborted
  branch renames.
<div class="Pp"></div>
Occasionally (and usually by mistake) a branchy Subversion repository will
  contain revisions that touch multiple branches. These are handled by
  partitioning them into multiple import-stream commits, one on each affected
  branch. The Legacy-ID of such a split commit will have a pseudo-decimal part -
  for example, if Subversion revision 2317 touches three branches, the three
  generated commits will have IDs 2317.1, 2317.2, and 2317.3.
<div class="Pp"></div>
The svn:executable and svn:special properties are translated into permission
  settings in the input stream; svn:executable becomes 100755 and svn:special
  becomes 120000 (indicating a symlink; the blob contents will be the path to
  which the symlink should resolve).
<div class="Pp"></div>
Any cvs2svn:rev properties generated by cvs2svn are incorporated into the
  internal map used for reference-lifting, then discarded.
<div class="Pp"></div>
Normally, per-directory svn:ignore properties become .gitignore files. Actual
  .gitignore files in a Subversion directory are presumed to have been created
  by git-svn users separately from native Subversion ignore properties and
  discarded with a warning. It is up to the user to merge the content of such
  files into the target repository by hand. But this behavior is inverted by the
  --user-ignores option; if that is on, .gitignore files are passed through and
  Subversion svn:ignore properties are discarded.
<div class="Pp"></div>
(Regardless of the setting of the --user-ignores option, .cvsignore files found
  in Subversion repositories always become .gitignores in the translation. The
  assumption is that these date from before a CVS-to-SVN lift and should be
  preserved to affect behavior when browsing that section of the repository.)
<div class="Pp"></div>
svn:mergeinfo properties are interpreted. Any svn:mergeinfo property on a
  revision A with a merge source range ending in revision B produces a merge
  link such that B becomes a parent of A.
<div class="Pp"></div>
All other Subversion properties are discarded. (This may change in a future
  release.) The property for which this is most likely to cause semantic
  problems is svn:eol-style. However, since property-change-only commits get
  turned into annotated tags, the translated tags will retain information about
  setting changes.
<div class="Pp"></div>
The sub-second resolution on Subversion commit dates is discarded; Git wants
  integer timestamps only.
<div class="Pp"></div>
Because fast-import format cannot represent an empty directory, empty
  directories in Subversion repositories will be lost in translation.
<div class="Pp"></div>
Normally, Subversion local usernames are mapped in the style of git cvs-import;
  thus user &quot;foo&quot; becomes &quot;foo &lt;foo&gt;&quot;, which is
  sufficient to pacify git and other systems that require email addresses. With
  the option &quot;svn_use_uuid&quot;, usernames are mapped in the git-svn
  style, with the repository's UUID used as a fake domain in the email address.
  Both forms can be remapped to real address using the <b>authors read</b>
  command.
<div class="Pp"></div>
Reading a Subversion stream enables writing of the legacy map as 'legacy'
  passthroughs when the repo is written to a stream file.
<div class="Pp"></div>
<b>reposurgeon</b> tries hard to silently do the right thing, but there are
  Subversion edge cases in which it emits warnings because a human may need to
  intervene and perform fixups by hand. Here are the less obvious messages it
  may emit:
<div class="Pp"></div>
user-generated .gitignore
<div style="margin-left: 4.00ex;">This message means means <b>reposurgeon</b>
  has found a .gitignore file in the Subversion repository it is analyzing. This
  probably happened because somebody was using <b>git-svn</b> as a live gateway,
  and created ignores which may or may not be congruent with those in the
  generated .gitignore files that the Subversion ignore properties will be
  translated into. You'll need to make a policy decision about which set of
  ignores to use in the conversion, and possibly set the --user-ignores option
  on read to pass through user-created .gitignore files; in that case this
  warning will not be emitted.</div>
<div class="Pp"></div>
can't connect nonempty branch XXXX to origin
<div style="margin-left: 4.00ex;">This is a serious error. <b>reposurgeon</b>
  has been unable to find a link from a specified branch to the trunk (master)
  branch. The commit graph will not be fully connected and will need manual
  repair.</div>
<div class="Pp"></div>
permission information may be lost
<div style="margin-left: 4.00ex;">A Subversion node change on a file sets or
  clears properties, but no ancestor can be found for this file. Executable or
  symlink position may be set wrongly on later revisions of this file.
  Subversion user-defined properties may also be scrambled or lost. Usually this
  error can be ignored.</div>
<div class="Pp"></div>
properties set
<div style="margin-left: 4.00ex;"><b>reposurgeon</b> has detected a setting of a
  user-defined property, or the Subversion properties svn:externals. These
  properties cannot be expressed in an import stream; the user is notified in
  case this is a showstopper for the conversion or some corrective action is
  required, but normally this error can be ignored. This warning is suppressed
  by the --ignore-properties option.</div>
<div class="Pp"></div>
branch links detected by file ops only
<div style="margin-left: 4.00ex;">Branch links are normally deduced by examining
  Subversion directory copy operations. A common user error (making a branch
  with a non-Subversion directory copy and then doing an svn add on the
  contends) can defeat this. While <b>reposurgeon</b> should detect and cope
  with most such copies correctly, you should examine the commit graph to check
  that the branch is rooted at the correct place.</div>
<div class="Pp"></div>
could not tagify root commit
<div style="margin-left: 4.00ex;">The earliest commit in your Subversion
  repository has file operations, rather than being a pure directory creation.
  This probably means your Subversion dump file is malformed, or you may have
  attempted to lift from an incremental dump. Proceed with caution.</div>
<div class="Pp"></div>
deleting parentless tip delete
<div style="margin-left: 4.00ex;">This message may be triggered by a Subversion
  branch move followed by a re-creation under the source name. Check near the
  indicated revision to make sure the renamed branch is connected to
  master.</div>
<div class="Pp"></div>
mid-branch deleteall
<div style="margin-left: 4.00ex;">A deleteall operation has been found in the
  middle of a branch history. This usually indicates that a Subversion tag or
  branch was created by mistake, and someone later tried to undo the error by
  deleting the tag/branch directory before recreating it with a copy operation.
  Examine the topology near the deleteall closely, it may need hand-hacking. It
  is fairly likely that both (a) the <b>reposurgeon</b> translation will be
  different from what other translators (such as <b>git-svn</b>) produce, and
  (b) it will not be immediately obvious which is right.</div>
<div class="Pp"></div>
lookback for XXX failed, not making branch link
<div style="margin-left: 4.00ex;">Branch analysis failed, probably due to a set
  of file copies that <b>reposurgeon</b> thought it should interpret as a
  botched branch creation but couldn't deduce a history for. This is a warning;
  check how the directory XXX is converted, it may need post-editing into a
  branch.</div>
<h2 class="Ss" title="Ss" id="WRITING_SUBVERSION_REPOSITORIES"><a class="selflink" href="#WRITING_SUBVERSION_REPOSITORIES">WRITING
  SUBVERSION REPOSITORIES</a></h2>
reposurgeon has support for writing Subversion repositories. Due to mismatches
  between the ontology of Subversion and that of git import streams, this
  support has some significant limitations and bugs.
<div class="Pp"></div>
In summary, Subversion repository histories do not round-trip through
  reposurgeon editing. File content changes are preserved but some metadata is
  unavoidably lost. Furthermore, writing out a DVCS history in Subversion also
  loses significant portions of its metadata. Details follow.
<div class="Pp"></div>
Writing a Subversion repository or dump stream discards author information, the
  committer's name, and the hostname part of the commit address; only the commit
  timestamp and the local part of the committer's email address are preserved,
  the latter becoming the Subversion author field. However, reading a Subversion
  repository and writing it out again will preserve the author fields.
<div class="Pp"></div>
Import-stream timestamps have 1-second granularity. The sub-second parts of
  Subversion commit timestamps will be lost on their way through reposurgeon.
<div class="Pp"></div>
Empty directories aren't represented in import streams. Consequently, reading
  and writing Subversion repositories preserves file content, but not empty
  directories. It is also not guaranteed that after editing a Subversion
  repository that the sequence of directory creations and deletions relative to
  other operations will be identical; the only guarantee is that enclosing
  directories will be created before any files in them are.
<div class="Pp"></div>
When reading a Subversion repository, reposurgeon discards the special
  directory-copy nodes associated with branch creations. These can't be
  recreated if and when the repository is written back out to Subversion;
  rather, each branch copy node from the original translates into a branch
  creation plus the first set of file modifications on the branch.
<div class="Pp"></div>
When reading a Subversion repository, reposurgeon also automatically breaks
  apart mixed-branch commits. These are not re-united if the repository is
  written back out.
<div class="Pp"></div>
When writing to a Subversion repository, all lightweight tags become Subversion
  tag copies with empty log comments, named for the tag basename. The committer
  name and timestamp are copied from the commit the tag points to. The
  distinction between heads and tags is lost.
<div class="Pp"></div>
Because of the preceding two points, it is not guaranteed that even revision
  numbers will be stable when a Subversion repository is read in and then
  written out!
<div class="Pp"></div>
Subversion repositories are always written with a standard (trunk/tags/branches)
  layout. Thus, a repository with a nonstandard shape that has been analyzed by
  reposurgeon won't be written out with the same shape.
<div class="Pp"></div>
When writing a Subversion repository, branch merges are translated into
  svn:mergeinfo properties in the simplest possible way - as an svn:mergeinfo
  property of the translated merge commit listing the merge source revisions.
<div class="Pp"></div>
Subversion has a concept of &quot;flows&quot;; that is, named segments of
  history corresponding to files or directories that are created when the path
  is added, cloned when the path is copied, and deleted when the path is
  deleted. This information is not preserved in import streams or the internal
  representation that reposurgeon uses. Thus, after editing, the flow boundaries
  of a Subversion history may be arbitrarily changed.
<h1 class="Sh" title="Sh" id="IGNORE_PATTERNS"><a class="selflink" href="#IGNORE_PATTERNS">IGNORE
  PATTERNS</a></h1>
<b>reposurgeon</b> recognizes how supported VCSes represent file ignores (CVS
  .cvsignore files lurking untranslated in older Subversion repositories,
  Subversion ignore properties, .gitignore/.hgignore/.bzrignore file in other
  systems) and moves ignore declarations among these containers on repo input
  and output. This will be sufficient if the ignore patterns are exact
  filenames.
<div class="Pp"></div>
Translation may not, however, be perfect when the ignore patterns are Unix glob
  patterns or regular expressions. This compatibility table describes which
  patterns will translate; &#x201C;plain&#x201D; indicates a plain filename with
  no glob or regexp syntax or negation.
<div class="Pp"></div>
RCS has no ignore files or patterns and is therefore not included in the table.
<table class="tbl">
  <colgroup>
    <col style="width: 15.00ex;"/>
    <col style="width: 15.00ex;"/>
    <col style="width: 8.00ex;"/>
    <col style="width: 36.00ex;"/>
    <col style="width: 23.00ex;"/>
    <col style="width: 33.00ex;"/>
    <col style="width: 10.00ex;"/>
    <col style="width: 8.00ex;"/>
    <col style="width: 7.00ex;"/>
  </colgroup>
  <tr>
    <td>&#x00A0;</td>
    <td>from CVS</td>
    <td>from svn</td>
    <td>from git</td>
    <td>from hg</td>
    <td>from bzr</td>
    <td>from darcs</td>
    <td>from SRC</td>
    <td>from bk</td>
  </tr>
  <tr>
    <td> <b>to CVS</b></td>
    <td> all</td>
    <td> all</td>
    <td> all except !-prefixed but nonempty</td>
    <td> all</td>
    <td> all except RE:- and !-prefixed</td>
    <td> plain</td>
    <td> all</td>
    <td> all</td>
  </tr>
  <tr>
    <td> <b>to svn</b></td>
    <td>all except !.PP</td>
    <td> all</td>
    <td> all except !-prefixed</td>
    <td> all</td>
    <td> all except RE:- and !-prefixed</td>
    <td> plain</td>
    <td> all</td>
    <td> all</td>
  </tr>
  <tr>
    <td> <b>to git</b></td>
    <td> all</td>
    <td> all</td>
    <td> all</td>
    <td> all except !-prefixed</td>
    <td> all except RE:-prefixed</td>
    <td> plain</td>
    <td> all</td>
    <td> all</td>
  </tr>
  <tr>
    <td> <b>to hg</b></td>
    <td> all except !</td>
    <td> all</td>
    <td> all except !-prefixed</td>
    <td> all</td>
    <td> all except RE:- and !-prefixed</td>
    <td> plain</td>
    <td> all</td>
    <td> all</td>
  </tr>
  <tr>
    <td> <b>to bzr</b></td>
    <td> all</td>
    <td> all</td>
    <td> all</td>
    <td> all</td>
    <td> all</td>
    <td> plain</td>
    <td> all</td>
    <td> all</td>
  </tr>
  <tr>
    <td> <b>to darcs</b></td>
    <td> plain</td>
    <td> plain</td>
    <td> plain</td>
    <td> plain</td>
    <td> plain</td>
    <td> all</td>
    <td> all</td>
    <td> all</td>
  </tr>
  <tr>
    <td> <b>to SRC</b></td>
    <td> all except !</td>
    <td> all</td>
    <td> all except !-prefixed</td>
    <td> all</td>
    <td> all except RE:- and !-prefixed</td>
    <td> plain</td>
    <td> all</td>
    <td> all</td>
  </tr>
</table>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
The hg rows and columns of the table describes compatibility to hg's glob syntax
  rather than its default regular-expression syntax. When writing to an hg
  repository from any other kind, <b>reposurgeon</b> prepends to the output
  .hgignore a &quot;syntax: glob&quot; line.
<h1 class="Sh" title="Sh" id="TRANSLATION_STYLE"><a class="selflink" href="#TRANSLATION_STYLE">TRANSLATION
  STYLE</a></h1>
After converting a CVS, SVN, or BitKeeper repository, check for and remove
  $-cookies in the head revision(s) of the files. The full Subversion set is
  $Date:, $Revision:, $Author:, $HeadURL and $Id:. CVS uses $Author:, $Date:,
  $Header:, $Id:, $Log:, $Revision:, also (rarely) $Locker:, $Name:, $RCSfile:,
  $Source:, and $State:.
<div class="Pp"></div>
When you need to specify a commit, use the action-stamp format that
  <b>references lift</b> generates when it can resolve an SVN or CVS reference
  in a comment. It is best that you <i>not vary from this format</i>, even in
  trivial ways like omitting the 'Z' or changing the 'T' or '!' or ':'. Making
  action stamps uniform and machine-parseable will have good consequences for
  future repository-browsing tools.
<div class="Pp"></div>
Sometimes, in converting a repository, you may need to insert an explanatory
  comment - for example, if metadata has been garbled or missing and you need to
  point to that fact. It's helpful for repository-browsing tools if there is a
  uniform syntax for this that is highly unlikely to show up in repository
  comments. We recommend enclosing translation notes in [[ ]]. This has the
  advantage of being visually similar to the [ ] traditionally used for
  editorial comments in text.
<div class="Pp"></div>
It is good practice to include, in the comment for the root commit of the
  repository, a note dating and attributing the conversion work and explaining
  these conventions. Example:
<div class="Pp"></div>
[[This repository was converted from Subversion to git on 2011-10-24 by Eric S.
  Raymond &lt;esr@thyrsus.com&gt;. Here and elsewhere, conversion notes are
  enclosed in double square brackets. Junk commits generated by cvs2svn have
  been removed, commit references have been mapped into a uniform
  VCS-independent syntax, and some comments edited into
  summary-plus-continuation form.]]
<div class="Pp"></div>
It is also good practice to include a generated tag at the point of conversion.
  E.g
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
mailbox_in --create &lt;&lt;EOF
Tag-Name: git-conversion
<div class="Pp"></div>
Marks the spot at which this repository was converted from Subversion to git.
EOF
</pre>
</div>
<h1 class="Sh" title="Sh" id="ADVANCED_EXAMPLES"><a class="selflink" href="#ADVANCED_EXAMPLES">ADVANCED
  EXAMPLES</a></h1>
<div style="margin-left: 4.00ex;">
<pre>
define lastchange {
@max(=B &amp; [/ChangeLog/] &amp; /{0}/B)? list
}
</pre>
</div>
<div class="Pp"></div>
List the last commit that refers to a ChangeLog file containing a specified
  string. (The trick here is that ? extends the singleton set consisting of the
  last eligible ChangeLog blob to its set of referring commits, and
  <b>list</b>only notices the commits.)
<h1 class="Sh" title="Sh" id="STREAM_SYNTAX_EXTENSIONS"><a class="selflink" href="#STREAM_SYNTAX_EXTENSIONS">STREAM
  SYNTAX EXTENSIONS</a></h1>
The event-stream parser in &#x201C;reposurgeon&#x201D; supports some extended
  syntax. Exporters designed to work with &#x201C;reposurgeon&#x201D; may have a
  --reposurgeon option that enables emission of extended syntax; notably, this
  is true of <b>cvs-fast-export</b>(1). The remainder of this section describes
  these syntax extensions. The properties they set are (usually) preserved and
  re-output when the stream file is written.
<div class="Pp"></div>
The token &#x201C;#reposurgeon&#x201D; at the start of a comment line in a
  fast-import stream signals reposurgeon that the remainder is an extension
  command to be interpreted by &#x201C;reposurgeon&#x201D;.
<div class="Pp"></div>
One such extension command is implemented: <b>#sourcetype</b>, which behaves
  identically to the reposurgeon <b>sourcetype</b> command. An exporter for a
  version-control system named &#x201C;frobozz&#x201D; could, for example, say
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
#reposurgeon sourcetype frobozz
</pre>
</div>
<div class="Pp"></div>
Within a commit, a magic comment of the form &#x201C;#legacy-id&#x201D; declares
  a legacy ID from the stream file's source version-control system.
<div class="Pp"></div>
Also accepted is the bzr syntax for setting per-commit properties. While parsing
  commit syntax, a line beginning with the token &#x201C;property&#x201D; must
  contibue with a whitespace-separated property-name token. If it is then
  followed by a newline it is taken to set that boolean-valued property to true.
  Otherwise it must be followed by a numeric token specifying a data length, a
  space, following data (which may contain newlines) and a terminating newline.
  For example:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
commit refs/heads/master
mark :1
committer Eric S. Raymond &lt;esr@thyrsus.com&gt; 1289147634 -0500
data 16
Example commit.
<div class="Pp"></div>
property legacy-id 2 r1
M 644 inline README
</pre>
</div>
<div class="Pp"></div>
Unlike other extensions, bzr properties are only preserved on stream output if
  the preferred type is bzr, because any importer other than bzr's will choke on
  them.
<h1 class="Sh" title="Sh" id="INCOMPATIBLE_LANGUAGE_CHANGES"><a class="selflink" href="#INCOMPATIBLE_LANGUAGE_CHANGES">INCOMPATIBLE
  LANGUAGE CHANGES</a></h1>
In versions before 3.23, &#x201C;prefer&#x201D; changed the repository type as
  well as the preferred output format.
<div class="Pp"></div>
In versions before 3.0, the general command syntax put the command verb first,
  then the selection set (if any) then modifiers (VSO). It has changed to
  optional selection set first, then command verb, then modifiers (SVO). The
  change made parsing simpler, allowed abolishing some noise keywords, and
  recapitulates a successful design pattern in some other Unix tools - notably
  <b>sed</b>(1).
<div class="Pp"></div>
In versions before 3.0, path expressions only matched commits, not commits and
  the associated blobs as well. The names of the &#x201C;a&#x201D; and
  &#x201C;c&#x201D; flags were different.
<div class="Pp"></div>
In <b>reposurgeon</b> versions before 3.0, the delete command had the semantics
  of squash; also, the policy flags did not require a &#x201C;--&#x201D; prefix.
  The &#x201C;--delete&#x201D; flag was named &#x201C;obliterate&#x201D;.
<div class="Pp"></div>
In <b>reposurgeon</b> versions before 3.0, read and write optionally took file
  arguments rather than requiring redirects (and the write command never wrote
  into directories). This was changed in order to allow these commands to have
  modifiers. These modifiers replaced several global options that no longer
  exist.
<div class="Pp"></div>
In <b>reposurgeon</b> versions before 3.0, the earliest factor in a unite
  command always kept its tag and branch names unaltered. The new rule for
  resolving name conflicts, giving priority to the latest factor, produces more
  natural behavior when uniting two repositories end to end; the master branch
  of the second (later) one keeps its name.
<div class="Pp"></div>
In <b>reposurgeon</b> versions before 3.0, the tagify command expected policies
  as trailing arguments to alter its behaviour. The new syntax uses similarly
  named options with leading dashes, that can appear anywhere after the tagify
  command
<div class="Pp"></div>
In versions before 2.9. the syntax of &quot;authors&quot;, &quot;legacy&quot;,
  &quot;list&quot;, and &quot;mailbox_{in|out}&quot; was different (and
  &quot;legacy&quot; was &quot;fossils&quot;). They took plain filename
  arguments rather that using redirect &lt; and &gt;.
<h1 class="Sh" title="Sh" id="LIMITATIONS_AND_GUARANTEES"><a class="selflink" href="#LIMITATIONS_AND_GUARANTEES">LIMITATIONS
  AND GUARANTEES</a></h1>
Guarantee: In DVCses that use commit hashes, editing with <b>reposurgeon</b>
  never changes the hash of a commit object unless (a) you edit the commit, or
  (b) it is a descendant of an edited commit in a VCS that includes parent
  hashes in the input of a child object's hash (git and hg both do this).
<div class="Pp"></div>
Guarantee: <b>reposurgeon</b> only requires main memory proportional to the size
  of a repository's metadata history, not its entire content history.
  (Exception: the data from inline content is held in memory.)
<div class="Pp"></div>
Guarantee: In the worst case, <b>reposurgeon</b> makes its own copy of every
  content blob in the repository's history and thus uses intermediate disk space
  approximately equal to the size of a repository's content history. However,
  when the repository to be edited is presented as a stream file,
  <b>reposurgeon</b> requires no or only very little extra disk space to
  represent it; the internal representation of content blobs is a (seek-offset,
  length) pair pointing into the stream file.
<div class="Pp"></div>
Guarantee: <b>reposurgeon</b> never modifies the contents of a repository it
  reads, nor deletes any repository. The results of surgery are always expressed
  in a new repository.
<div class="Pp"></div>
Guarantee: Any line in a fast-import stream that is not a part of a command
  <b>reposurgeon</b> parses and understands will be passed through unaltered. At
  present the set of potential passthroughs is known to include the
  <b>progress</b>, the <b>options</b>, and <b>checkpoint</b> commands as well as
  comments led by #.
<div class="Pp"></div>
Guarantee: All <b>reposurgeon</b> operations either preserve all repository
  state they are not explicitly told to modify or warn you when they cannot do
  so.
<div class="Pp"></div>
Guarantee: <b>reposurgeon</b> handles the bzr commit-properties extension,
  correctly passing through property items including those with embedded
  newlines. (Such properties are also editable in the mailbox format.)
<div class="Pp"></div>
Limitation: Because <b>reposurgeon</b> relies on other programs to generate and
  interpret the fast-import command stream, it is subject to bugs in those
  programs.
<div class="Pp"></div>
Limitation: bzr suffers from deep confusion over whether its unit of work is a
  repository or a floating branch that might have been cloned from a repo or
  created from scratch, and might or might not be destined to be merged to a
  repo one day. Its exporter only works on branches, but its importer creates
  repos. Thus, a rebuild operation will produce a subdirectory structure that
  differs from what you expect. Look for your content under the subdirectory
  'trunk'.
<div class="Pp"></div>
Limitation: under git, signed tags are imported verbatim. However, any operation
  that modifies any commit upstream of the target of the tag will invalidate it.
<div class="Pp"></div>
Limitation: Stock git (at least as of version 1.7.3.2) will choke on property
  extension commands. Accordingly, <b>reposurgeon</b> omits them when rebuilding
  a repo with git type.
<div class="Pp"></div>
Limitation: Converting an hg repo that uses bookmarks (not branches) to git can
  lose information; the branch ref that git assigns to each commit may not be
  the same as the hg bookmark that was active when the commit was originally
  made under hg. Unfortunately, this is a real ontological mismatch, not a
  problem that can be fixed by cleverness in <b>reposurgeon</b>.
<div class="Pp"></div>
Limitation: Converting an hg repo that uses branches to git can lose information
  because git does not store an explicit branch as part of commit metadata, but
  colors commits with branch or tag names on the fly using a specific coloring
  algorithm, which might not match the explicit branch assignments to commits in
  the original hg repo. Reposurgeon preserves the hg branch information when
  reading an hg repo, so it is available from within reposurgeon itself, but
  there is no way to preserve it if the repo is written to git.
<div class="Pp"></div>
Limitation: While the Subversion read-side support is in good shape, the
  write-side support is more of a sketch or proof-of-concept than a robust
  implementation; it only works on very simple cases and does not round-trip. It
  may improve in future releases.
<div class="Pp"></div>
Limitation: Not all BitKeeper versions have the fast-import and fast-export
  commands that <b>reposurgeon</b> requires. They are present back to the 7.3
  opensource version.
<div class="Pp"></div>
Limitation: <b>reposurgeon</b> may misbehave under a filesystem which smashes
  case in filenames, or which nominally preserves case but maps names differing
  only by case to the same filesystem node (Mac OS X behaves like this by
  default). Problems will arise if any two paths in a repo differ by case only.
  To avoid the problem on a Mac, do all your surgery on an HFS+ file system
  formatted with case sensitivity specifically enabled.
<div class="Pp"></div>
Limitation: If whitespace followed by # appears in a string or regexp command
  argument, it will be misinterpreted as the beginning of a line-ending comment
  and screw up parsing.
<div class="Pp"></div>
Guarantee: As version-control systems add support for the fast-import format,
  their repositories will become editable by <b>reposurgeon</b>.
<h1 class="Sh" title="Sh" id="REQUIREMENTS"><a class="selflink" href="#REQUIREMENTS">REQUIREMENTS</a></h1>
<b>reposurgeon</b> relies on importers and exporters associated with the VCSes
  it supports.
<div class="Pp"></div>
git
<div style="margin-left: 4.00ex;">Core git supports both export and
  import.</div>
<div class="Pp"></div>
bzr
<div style="margin-left: 4.00ex;">Requires bzr plus the bzr-fast-import
  plugin.</div>
<div class="Pp"></div>
hg
<div style="margin-left: 4.00ex;">Requires core hg, the hg-fastimport plugin,
  and the third-party hg-fast-export.py script.</div>
<div class="Pp"></div>
svn
<div style="margin-left: 4.00ex;">Stock Subversion commands support export and
  import.</div>
<div class="Pp"></div>
darcs
<div style="margin-left: 4.00ex;">Stock darcs commands support export and
  import.</div>
<div class="Pp"></div>
CVS
<div style="margin-left: 4.00ex;">Requires cvs-fast-export. Note that the
  quality of CVS lifts may be poor, with individual lifts requiring serious
  hand-hacking. This is due to inherent problems with CVS's file-oriented
  model.</div>
<div class="Pp"></div>
RCS
<div style="margin-left: 4.00ex;">Requires cvs-fast-export (yes, that's not a
  typo; cvs-fast-export handles RCS collections as well). The caveat for CVS
  applies.</div>
<h1 class="Sh" title="Sh" id="CANONICALIZATION_RULES"><a class="selflink" href="#CANONICALIZATION_RULES">CANONICALIZATION
  RULES</a></h1>
It is expected that <b>reposurgeon</b> will be extended with more deletion
  policies. Policy authors may need to know more about how a commit's file
  operation sequence is reduced to normal form after operations from deleted
  commits are prepended to it.
<div class="Pp"></div>
Recall that each commit has a list of file operations, each a M (modify), D
  (delete), R (rename), C (copy), or 'deleteall' (delete all files). Only M
  operations have associated blobs. Normally there is only one M operation per
  individual file in a commit's operation list.
<div class="Pp"></div>
To understand how the reduction process works, it's enough to understand the
  case where all the operation in the list are working on the same file.
  Sublists of operations referring to different files don't affect each other
  and reducing them can be thought of as separate operations. Also, a
  &quot;deleteall&quot; acts as a D for everything and cancels all operations
  before it in the list.
<div class="Pp"></div>
The reduction process walks through the list from the beginning looking for
  adjacent pairs of operations it can compose. The following table describes all
  possible cases and all but one of the reductions.
<table class="tbl">
  <colgroup>
    <col style="width: 28.00ex;"/>
    <col style="width: 244.00ex;"/>
  </colgroup>
  <tr>
    <td>M + D &#x2192; D</td>
    <td> If a file is modified then deleted, the result is as though it had been
      deleted. If the M was the only modify for the file, it's removed too.</td>
  </tr>
  <tr>
    <td>M a + R a b &#x2192; R a b + M b</td>
    <td> The purpose of this transformation is to push renames toward the
      beginning of the list, where they may become adjacent to another R or C
      they can be composed with. If the M is the only modify operation for this
      file, the rename is dropped.</td>
  </tr>
  <tr>
    <td>M a + C a b</td>
    <td> No reduction.</td>
  </tr>
  <tr>
    <td>M b + R a b &#x2192; nothing</td>
    <td> Should be impossible, and may indicate repository corruption.</td>
  </tr>
  <tr>
    <td>M b + C a b &#x2192; nothing</td>
    <td> The copy undoes the modification.</td>
  </tr>
  <tr>
    <td>D + M &#x2192; M</td>
    <td> If a file is deleted and modified, the result is as though the deletion
      had not taken place (because M operations store entire files, not
      deltas).</td>
  </tr>
  <tr>
    <td>D + {D|R|C}</td>
    <td> These cases should be impossible and would suggest the repository has
      been corrupted.</td>
  </tr>
  <tr>
    <td>R a b + D a</td>
    <td> Should never happen, and is another case that would suggest repository
      corruption.</td>
  </tr>
  <tr>
    <td>R a b + D b &#x2192; D a</td>
    <td> The delete removes the just-renamed file.</td>
  </tr>
  <tr>
    <td>{R|C} + M</td>
    <td> No reduction.</td>
  </tr>
  <tr>
    <td>R a b + R b c &#x2192; R a c</td>
    <td> The b terms have to match for these operations to have made sense when
      they lived in separate commits; if they don't, it indicates repository
      corruption.</td>
  </tr>
  <tr>
    <td>R a b + C b c</td>
    <td> No reduction.</td>
  </tr>
  <tr>
    <td>C a b + D a &#x2192; R a b</td>
    <td> Copy followed by delete of the source is a rename.</td>
  </tr>
  <tr>
    <td>C a b + D b &#x2192; nothing</td>
    <td> This delete undoes the copy.</td>
  </tr>
  <tr>
    <td>C a b + R a c</td>
    <td> No reduction.</td>
  </tr>
  <tr>
    <td>C a b + R b c &#x2192; C a c</td>
    <td> Copy followed by a rename of the target reduces to single copy</td>
  </tr>
  <tr>
    <td>C + C</td>
    <td> No reduction.</td>
  </tr>
</table>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="CRASH_RECOVERY"><a class="selflink" href="#CRASH_RECOVERY">CRASH
  RECOVERY</a></h1>
This section will become relevant only if <b>reposurgeon</b> or something
  underneath it in the software and hardware stack crashes while in the middle
  of writing out a repository, in particular if the target directory of the
  rebuild is your current directory.
<div class="Pp"></div>
The tool has two conflicting objectives. On the one hand, we never want to risk
  clobbering a pre-existing repo. On the other hand, we want to be able to run
  this tool in a directory with a repo and modify it in place.
<div class="Pp"></div>
We resolve this dilemma by playing a game of three-directory monte.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 1.First, we build the repo in a
  freshly-created staging directory. If your target directory is named
  /path/to/foo, the staging directory will be a peer named
  /path/to/foo-stageNNNN, where NNNN is a cookie derived from
  <b>reposurgeon</b>'s process ID.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 2.We then make an empty backup directory.
  This directory will be named /path/to/foo.~N~, where N is incremented so as
  not to conflict with any existing backup directories. <b>reposurgeon</b>
  never, under any circumstances, ever deletes a backup directory.
<div style="height: 1.00em;">&#x00A0;</div>
So far, all operations are safe; the worst that can happen up to this point if
  the process gets interrupted is that the staging and backup directories get
  left behind.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 3.The critical region begins. We first move
  everything in the target directory to the backup directory.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 4.Then we move everything in the staging
  directory to the target.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 5.We finish off by restoring untracked files
  in the target directory from the backup directory. That ends the critical
  region.</div>
<div class="Pp"></div>
During the critical region, all signals that can be ignored are ignored.
<h1 class="Sh" title="Sh" id="ERROR_RETURNS"><a class="selflink" href="#ERROR_RETURNS">ERROR
  RETURNS</a></h1>
Returns 1 on fatal error, 0 otherwise. In batch mode all errors are fatal.
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>bzr</b>(1), <b>cvs</b>(1), <b>darcs</b>(1), <b>git</b>(1), <b>hg</b>(1),
  <b>rcs</b>(1), <b>svn</b>(1). <b>bk</b>(1).
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Eric S. Raymond &lt;esr@thyrsus.com&gt;; project page at
  <b>http://www.catb.org/~esr/reposurgeon</b>.
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"> 1.</dt>
  <dd class="It-tag">DVCS Migration HOWTO</dd>
</dl>
<div style="margin-left: 4.00ex;">http://www.catb.org/esr/dvcs-migration-guide.html</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 2.</dt>
  <dd class="It-tag">Python's</dd>
</dl>
<div style="margin-left: 4.00ex;">http://docs.python.org/2/library/re.html</div>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">03/18/2017</td>
    <td class="foot-os">reposurgeon</td>
  </tr>
</table>
</body>
</html>
