<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:32:03 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>PMGENMAP(1) General Commands Manual PMGENMAP(1)</p>

<p style="margin-top: 1em">NAME <br>
pmgenmap - generate C code to simplify handling of
performance metrics</p>

<p style="margin-top: 1em">SYNOPSIS <br>
pmgenmap [infile]</p>

<p style="margin-top: 1em">DESCRIPTION <br>
Given one or more lists of metric names in infile or on
standard input, pmgenmap generates C declarations and cpp(1)
macros suitable for use across the Performance Metrics
Pro&acirc; <br>
gramming Interface (PMAPI) on standard output.</p>

<p style="margin-top: 1em">The declarations produced by
pmgenmap simplify the coding for client applications using
the PMAPI.</p>

<p style="margin-top: 1em">The input should consist of one
or more lists of metric names of the form</p>

<p style="margin-top: 1em">listname { <br>
metricname1 symbolname1 <br>
metricname2 symbolname2 <br>
... <br>
}</p>

<p style="margin-top: 1em">which will generate C and cpp(1)
declarations of the form</p>

<p style="margin-top: 1em">char *listname[] = { <br>
#define symbolname1 0 <br>
&quot;metricname1&quot;, <br>
#define symbolname2 1 <br>
&quot;metricname2&quot;, <br>
... <br>
};</p>

<p style="margin-top: 1em">The array declarations produced
are suitable as parameters to pmLookupName(3) and the
#defined constants may be used to index the vsets in the
pmResult structure returned by a <br>
pmFetch(3) call.</p>

<p style="margin-top: 1em">Obviously, listname must conform
to the C identifier naming rules, each symbolname must
conform to the cpp(1) macro naming rules, and each
metricname is expected to be a valid <br>
performance metrics name (see pmns(5) for more details).</p>

<p style="margin-top: 1em">The input may include sh-style
comment lines, i.e. with a &lsquo;#&rsquo; as the first
non-blank character of a line, and these are translated on
output to either single line or multi-line C <br>
comments in the K&amp;R style. For example, the input:</p>

<p style="margin-top: 1em"># leading block of multi-line
comments <br>
# initialization group <br>
foo { <br>
a.b.c ONE <br>
d.e.f.g TWO <br>
# embedded block of multi-lines <br>
# comments and boring pad text <br>
xx.yy.zz THREE <br>
}</p>

<p style="margin-top: 1em"># trailing single line
comment</p>

<p style="margin-top: 1em">Produces the output:</p>

<p style="margin-top: 1em">/* <br>
* leading block of multi-line comments <br>
* initialization group <br>
*/ <br>
char *foo[] = { <br>
#define ONE 0 <br>
&quot;a.b.c&quot;, <br>
#define TWO 1 <br>
&quot;d.e.f.g&quot;, <br>
/* <br>
* embedded block of multi-lines <br>
* comments and boring pad text <br>
*/ <br>
#define THREE 2 <br>
&quot;xx.yy.zz&quot;,</p>

<p style="margin-top: 1em">};</p>

<p style="margin-top: 1em">/* trailing single line comment
*/</p>

<p style="margin-top: 1em">EXAMPLE <br>
For brevity we have removed the error handling code, and
assumed the chosen metrics do not have multiple values.</p>

<p style="margin-top: 1em">The input file</p>

<p style="margin-top: 1em">mystats { <br>
kernel.percpu.cpu.idle IDLE <br>
kernel.percpu.cpu.sys SYS <br>
kernel.percpu.cpu.user USER <br>
hinv.ncpu NCPU <br>
}</p>

<p style="margin-top: 1em">produces the following C code,
suitable for #include-ing</p>

<p style="margin-top: 1em">/* <br>
* Performance Metrics Name Space Map <br>
* Built by pmgenmap from the file <br>
* mystats.metrics <br>
* on Wed Dec 28 19:44:17 EST 1994 <br>
* <br>
* Do not edit this file! <br>
*/</p>

<p style="margin-top: 1em">char *mystats[] = { <br>
#define IDLE 0 <br>
&quot;kernel.percpu.cpu.idle&quot;, <br>
#define SYS 1 <br>
&quot;kernel.percpu.cpu.sys&quot;, <br>
#define USER 2 <br>
&quot;kernel.percpu.cpu.user&quot;, <br>
#define NCPU 3 <br>
&quot;hinv.ncpu&quot;,</p>

<p style="margin-top: 1em">};</p>

<p style="margin-top: 1em">Using the code generated by
pmgenmap, we are now able to easily obtain metrics from the
Performance Metrics Collection Subsystem (PMCS) as
follows:</p>

<p style="margin-top: 1em">#define MAX_PMID 4</p>

<p style="margin-top: 1em">int trip = 0; <br>
int numpmid = sizeof(mystats)/sizeof(mystats[0]); <br>
double duration; <br>
pmResult *resp; <br>
pmResult *prev; <br>
pmID pmidlist[MAX_PMID];</p>

<p style="margin-top: 1em">pmNewContext(PM_CONTEXT_HOST,
&quot;localhost&quot;); <br>
pmLookupName(numpmid, mystats, pmidlist); <br>
pmFetch(numpmid, pmidlist, &amp;resp);</p>

<p style="margin-top: 1em">printf(&quot;%d CPUs: %d usr %d
sys %d idle0, <br>
resp-&gt;vset[NCPU]-&gt;vlist[0].value.lval, <br>
resp-&gt;vset[USER]-&gt;vlist[0].value.lval, <br>
resp-&gt;vset[SYS]-&gt;vlist[0].value.lval, <br>
resp-&gt;vset[IDLE]-&gt;vlist[0].value.lval);</p>

<p style="margin-top: 1em">Some calls to ensure portability
have been removed from the code above for the sake of
clarity - the example above should not be used as a template
for programming. In particu&acirc; <br>
lar, the raw values of the metrics were used when
pmLookupDesc(3) should have been called to determine the
semantics of each metric.</p>

<p style="margin-top: 1em">More complete examples that
demonstrate the use of pmgenmap which may be used as a basis
for program development are included in the PCP demos, e.g.
$PCP_DEMOS_DIR/pmclient.</p>

<p style="margin-top: 1em">FILES <br>
$PCP_VAR_DIR/pmns/* <br>
default PMNS specification files</p>

<p style="margin-top: 1em">PCP ENVIRONMENT <br>
Environment variables with the prefix PCP_ are used to
parameterize the file and directory names used by PCP. On
each installation, the file /etc/pcp.conf contains the local
<br>
values for these variables. The $PCP_CONF variable may be
used to specify an alternative configuration file, as
described in pcp.conf(5).</p>

<p style="margin-top: 1em">SEE ALSO <br>
cpp(1), PMAPI(3), pmFetch(3), pmLookupName(3),
pmNewContext(3), pcp.conf(5), pcp.env(5) and pmns(5).</p>

<p style="margin-top: 1em">Performance Co-Pilot PCP
PMGENMAP(1)</p>
<hr>
</body>
</html>
