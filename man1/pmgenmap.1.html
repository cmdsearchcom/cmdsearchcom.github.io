<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>PMGENMAP(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">PMGENMAP(1)</td>
    <td class="head-vol">General Commands Manual</td>
    <td class="head-rtitle">PMGENMAP(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
<b>pmgenmap</b> - generate C code to simplify handling of performance metrics
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>pmgenmap</b> [ <i>infile</i>]
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
Given one or more lists of metric names in <i>infile</i> or on standard input,
  <b>pmgenmap</b> generates C declarations and <b>cpp</b>(1) macros suitable for
  use across the Performance Metrics Programming Interface (PMAPI) on standard
  output.
<div class="Pp"></div>
The declarations produced by <b>pmgenmap</b> simplify the coding for client
  applications using the PMAPI.
<div class="Pp"></div>
The input should consist of one or more lists of metric names of the form
<div class="Pp"></div>
<pre>
<br/>
listname {
    metricname1 symbolname1
    metricname2 symbolname2
    ...
}
<br/>
</pre>
<div class="Pp"></div>
which will generate C and <b>cpp</b>(1) declarations of the form
<div class="Pp"></div>
<pre>
<br/>
char *listname[] = {
#define symbolname1 0
    &quot;metricname1&quot;,
#define symbolname2 1
    &quot;metricname2&quot;,
    ...
};
<br/>
</pre>
<div class="Pp"></div>
The array declarations produced are suitable as parameters to
  <b>pmLookupName</b>(3) and the <b>#define</b>d constants may be used to index
  the <i>vset</i>s in the <i>pmResult</i> structure returned by a
  <b>pmFetch</b>(3) call.
<div class="Pp"></div>
Obviously, <i>listname</i> must conform to the C identifier naming rules, each
  <i>symbolname</i> must conform to the <b>cpp</b>(1) macro naming rules, and
  each <i>metricname</i> is expected to be a valid performance metrics name (see
  <b>pmns</b>(5) for more details).
<div class="Pp"></div>
The input may include <b>sh</b>-style comment lines, i.e. with a ` <b>#</b>' as
  the first non-blank character of a line, and these are translated on output to
  either single line or multi-line C comments in the K&amp;R style. For example,
  the input:
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<pre>
<br/>
# leading block of multi-line comments
# initialization group
foo {
        a.b.c   ONE
        d.e.f.g TWO
        # embedded block of multi-lines
        # comments and boring pad text
        xx.yy.zz        THREE
}
<div class="Pp"></div>
# trailing single line comment
<br/>
</pre>
<div class="Pp"></div>
Produces the output:
<div class="Pp"></div>
<pre>
<br/>
/*
 * leading block of multi-line comments
 * initialization group
 */
char *foo[] = {
#define ONE 0
        &quot;a.b.c&quot;,
#define TWO 1
        &quot;d.e.f.g&quot;,
/*
 * embedded block of multi-lines
 * comments and boring pad text
 */
#define THREE 2
        &quot;xx.yy.zz&quot;,
<div class="Pp"></div>
};
<div class="Pp"></div>
<div class="Pp"></div>
/* trailing single line comment */
<br/>
</pre>
<h1 class="Sh" title="Sh" id="EXAMPLE"><a class="selflink" href="#EXAMPLE">EXAMPLE</a></h1>
For brevity we have removed the error handling code, and assumed the chosen
  metrics do not have multiple values.
<div class="Pp"></div>
The input file
<div class="Pp"></div>
<pre>
<br/>
mystats {
    kernel.percpu.cpu.idle     IDLE
    kernel.percpu.cpu.sys      SYS
    kernel.percpu.cpu.user     USER
    hinv.ncpu                       NCPU
}
<br/>
</pre>
<div class="Pp"></div>
produces the following C code, suitable for <b>#include</b>-ing
<div class="Pp"></div>
<pre>
<br/>
/*
 * Performance Metrics Name Space Map
 * Built by pmgenmap from the file
 * mystats.metrics
 * on Wed Dec 28 19:44:17 EST 1994
 *
 * Do not edit this file!
 */
<div class="Pp"></div>
char *mystats[] = {
#define IDLE    0
        &quot;kernel.percpu.cpu.idle&quot;,
#define SYS     1
        &quot;kernel.percpu.cpu.sys&quot;,
#define USER    2
        &quot;kernel.percpu.cpu.user&quot;,
#define NCPU    3
        &quot;hinv.ncpu&quot;,
<div class="Pp"></div>
};
<br/>
</pre>
<div class="Pp"></div>
Using the code generated by <b>pmgenmap</b>, we are now able to easily obtain
  metrics from the Performance Metrics Collection Subsystem (PMCS) as follows:
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<pre>
<br/>
#define MAX_PMID 4
<div class="Pp"></div>
    int         trip = 0;
    int         numpmid = sizeof(mystats)/sizeof(mystats[0]);
    double      duration;
    pmResult    *resp;
    pmResult    *prev;
    pmID        pmidlist[MAX_PMID];
<div class="Pp"></div>
    pmNewContext(PM_CONTEXT_HOST, &quot;localhost&quot;);
    pmLookupName(numpmid, mystats, pmidlist);
    pmFetch(numpmid, pmidlist, &amp;resp);
<div class="Pp"></div>
    printf(&quot;%d CPUs: %d usr   %d sys   %d   idle0, 
           resp-&gt;vset[NCPU]-&gt;vlist[0].value.lval,
           resp-&gt;vset[USER]-&gt;vlist[0].value.lval,
           resp-&gt;vset[SYS]-&gt;vlist[0].value.lval,
           resp-&gt;vset[IDLE]-&gt;vlist[0].value.lval);
<br/>
</pre>
<div class="Pp"></div>
Some calls to ensure portability have been removed from the code above for the
  sake of clarity - the example above should not be used as a template for
  programming. In particular, the raw values of the metrics were used when
  <b>pmLookupDesc</b>(3) should have been called to determine the semantics of
  each metric.
<div class="Pp"></div>
More complete examples that demonstrate the use of <b>pmgenmap</b> which may be
  used as a basis for program development are included in the PCP demos, e.g.
  <i>$PCP_DEMOS_DIR/pmclient</i>.
<h1 class="Sh" title="Sh" id="FILES"><a class="selflink" href="#FILES">FILES</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>$PCP_VAR_DIR/pmns/</b><i>*</i></dt>
  <dd class="It-tag">default PMNS specification files</dd>
</dl>
<h1 class="Sh" title="Sh" id="PCP_ENVIRONMENT"><a class="selflink" href="#PCP_ENVIRONMENT">PCP
  ENVIRONMENT</a></h1>
Environment variables with the prefix <b>PCP_</b> are used to parameterize the
  file and directory names used by PCP. On each installation, the file
  <i>/etc/pcp.conf</i> contains the local values for these variables. The
  <b>$PCP_CONF</b> variable may be used to specify an alternative configuration
  file, as described in <b>pcp.conf</b>(5).
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>cpp</b>(1), <b>PMAPI</b>(3), <b>pmFetch</b>(3), <b>pmLookupName</b>(3),
  <b>pmNewContext</b>(3), <b>pcp.conf</b>(5), <b>pcp.env</b>(5) and
  <b>pmns</b>(5).</div>
<table class="foot">
  <tr>
    <td class="foot-date">PCP</td>
    <td class="foot-os">Performance Co-Pilot</td>
  </tr>
</table>
</body>
</html>
