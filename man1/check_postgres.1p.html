<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 15:58:16 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>CHECK_POSTGRES(1p) User Contributed Perl Documentation
CHECK_POSTGRES(1p)</p>

<p style="margin-top: 1em">NAME <br>
check_postgres - a Postgres monitoring script for Nagios,
MRTG, Cacti, and others</p>

<p style="margin-top: 1em">This documents describes
check_postgres version 2.22.0</p>

<p style="margin-top: 1em">SYNOPSIS <br>
## Create all symlinks <br>
check_postgres --symlinks</p>

<p style="margin-top: 1em">## Check connection to Postgres
database &rsquo;pluto&rsquo;: <br>
check_postgres --action=connection --db=pluto</p>

<p style="margin-top: 1em">## Same things, but using the
symlink <br>
check_postgres_connection --db=pluto</p>

<p style="margin-top: 1em">## Warn if &gt; 100 locks,
critical if &gt; 200, or &gt; 20 exclusive <br>
check_postgres_locks --warning=100
--critical=&quot;total=200:exclusive=20&quot;</p>

<p style="margin-top: 1em">## Show the current number of
idle connections on port 6543: <br>
check_postgres_txn_idle --port=6543 --output=simple</p>

<p style="margin-top: 1em">## There are many other actions
and options, please keep reading.</p>

<p style="margin-top: 1em">The latest news and
documentation can always be found at: <br>
http://bucardo.org/check_postgres/</p>

<p style="margin-top: 1em">DESCRIPTION <br>
check_postgres is a Perl script that runs many different
tests against one or more Postgres databases. It uses the
psql program to gather the information, and outputs the
results <br>
in one of three formats: Nagios, MRTG, or simple.</p>

<p style="margin-top: 1em">Output Modes <br>
The output can be changed by use of the &quot;--output&quot;
option. The default output is nagios, although this can be
changed at the top of the script if you wish. The current
option <br>
choices are nagios, mrtg, and simple. To avoid having to
enter the output argument each time, the type of output is
automatically set if no --output argument is given, and if
the <br>
current directory has one of the output options in its name.
For example, creating a directory named mrtg and populating
it with symlinks via the --symlinks argument would ensure
<br>
that any actions run from that directory will always default
to an output of &quot;mrtg&quot; As a shortcut for
--output=simple, you can enter --simple, which also
overrides the directory <br>
naming trick.</p>

<p style="margin-top: 1em">Nagios output</p>

<p style="margin-top: 1em">The default output format is for
Nagios, which is a single line of information, along with
four specific exit codes:</p>

<p style="margin-top: 1em">0 (OK) <br>
1 (WARNING) <br>
2 (CRITICAL) <br>
3 (UNKNOWN)</p>

<p style="margin-top: 1em">The output line is one of the
words above, a colon, and then a short description of what
was measured. Additional statistics information, as well as
the total time the command <br>
took, can be output as well: see the documentation on the
arguments --showperf, --perflimit, and --showtime.</p>

<p style="margin-top: 1em">MRTG output</p>

<p style="margin-top: 1em">The MRTG output is four lines,
with the first line always giving a single number of
importance. When possible, this number represents an actual
value such as a number of bytes, <br>
but it may also be a 1 or a 0 for actions that only return
&quot;true&quot; or &quot;false&quot;, such as
check_postgres_version. The second line is an additional
stat and is only used for some <br>
actions. The third line indicates an &quot;uptime&quot; and
is not used. The fourth line is a description and usually
indicates the name of the database the stat from the first
line was <br>
pulled from, but may be different depending on the
action.</p>

<p style="margin-top: 1em">Some actions accept an optional
--mrtg argument to further control the output.</p>

<p style="margin-top: 1em">See the documentation on each
action for details on the exact MRTG output for each
one.</p>

<p style="margin-top: 1em">Simple output</p>

<p style="margin-top: 1em">The simple output is simply a
truncated version of the MRTG one, and simply returns the
first number and nothing else. This is very useful when you
just want to check the state <br>
of something, regardless of any threshold. You can transform
the numeric output by appending KB, MB, GB, TB, or EB to the
output argument, for example:</p>

<p style="margin-top: 1em">--output=simple,MB</p>

<p style="margin-top: 1em">Cacti output</p>

<p style="margin-top: 1em">The Cacti output consists of one
or more items on the same line, with a simple name, a colon,
and then a number. At the moment, the only action with
explicit Cacti output is <br>
&rsquo;dbstats&rsquo;, and using the --output option is not
needed in this case, as Cacti is the only output for this
action. For many other actions, using --simple is enough to
make Cacti <br>
happy.</p>

<p style="margin-top: 1em">DATABASE CONNECTION OPTIONS <br>
All actions accept a common set of database options.</p>

<p style="margin-top: 1em">-H NAME or --host=NAME <br>
Connect to the host indicated by NAME. Can be a
comma-separated list of names. Multiple host arguments are
allowed. If no host is given, defaults to the
&quot;PGHOST&quot; environment <br>
variable or no host at all (which indicates using a local
Unix socket). You may also use &quot;--dbhost&quot;.</p>

<p style="margin-top: 1em">-p PORT or --port=PORT <br>
Connects using the specified PORT number. Can be a
comma-separated list of port numbers, and multiple port
arguments are allowed. If no port number is given, defaults
to the <br>
&quot;PGPORT&quot; environment variable. If that is not set,
it defaults to 5432. You may also use
&quot;--dbport&quot;</p>

<p style="margin-top: 1em">-db NAME or --dbname=NAME <br>
Specifies which database to connect to. Can be a
comma-separated list of names, and multiple dbname arguments
are allowed. If no dbname option is provided, defaults to
the <br>
&quot;PGDATABASE&quot; environment variable. If that is not
set, it defaults to &rsquo;postgres&rsquo; if psql is
version 8 or greater, and &rsquo;template1&rsquo;
otherwise.</p>

<p style="margin-top: 1em">-u USERNAME or --dbuser=USERNAME
<br>
The name of the database user to connect as. Can be a
comma-separated list of usernames, and multiple dbuser
arguments are allowed. If this is not provided, it defaults
to <br>
the &quot;PGUSER&quot; environment variable, otherwise it
defaults to &rsquo;postgres&rsquo;.</p>

<p style="margin-top: 1em">--dbpass=PASSWORD <br>
Provides the password to connect to the database with. Use
of this option is highly discouraged. Instead, one should
use a .pgpass or pg_service.conf file.</p>

<p style="margin-top: 1em">--dbservice=NAME <br>
The name of a service inside of the pg_service.conf file.
Before version 9.0 of Postgres, this is a global file,
usually found in /etc/pg_service.conf. If you are using <br>
version 9.0 or higher of Postgres, you can use the file
&quot;.pg_service.conf&quot; in the home directory of the
user running the script, e.g. nagios.</p>

<p style="margin-top: 1em">This file contains a simple list
of connection options. You can also pass additional
information when using this option such as
--dbservice=&quot;maindatabase sslmode=require&quot;</p>

<p style="margin-top: 1em">The documentation for this file
can be found at
http://www.postgresql.org/docs/current/static/libpq-pgservice.html</p>

<p style="margin-top: 1em">The database connection options
can be grouped: --host=a,b --host=c --port=1234 --port=3344
would connect to a-1234, b-1234, and c-3344. Note that once
set, an option carries <br>
over until it is changed again.</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">--host=a,b --port=5433 --db=c
<br>
Connects twice to port 5433, using database c, to hosts a
and b: a-5433-c b-5433-c</p>

<p style="margin-top: 1em">--host=a,b --port=5433 --db=c,d
<br>
Connects four times: a-5433-c a-5433-d b-5433-c b-5433-d</p>

<p style="margin-top: 1em">--host=a,b --host=foo
--port=1234 --port=5433 --db=e,f <br>
Connects six times: a-1234-e a-1234-f b-1234-e b-1234-f
foo-5433-e foo-5433-f</p>

<p style="margin-top: 1em">--host=a,b --host=x
--port=5432,5433 --dbuser=alice --dbuser=bob -db=baz <br>
Connects three times: a-5432-alice-baz b-5433-alice-baz
x-5433-bob-baz</p>

<p style="margin-top: 1em">--dbservice=&quot;foo&quot;
--port=5433 <br>
Connects using the named service &rsquo;foo&rsquo; in the
pg_service.conf file, but overrides the port</p>

<p style="margin-top: 1em">OTHER OPTIONS <br>
Other options include:</p>

<p style="margin-top: 1em">--action=NAME <br>
States what action we are running. Required unless using a
symlinked file, in which case the name of the file is used
to figure out the action.</p>

<p style="margin-top: 1em">--warning=VAL or -w VAL <br>
Sets the threshold at which a warning alert is fired. The
valid options for this option depends on the action
used.</p>

<p style="margin-top: 1em">--critical=VAL or -c VAL <br>
Sets the threshold at which a critical alert is fired. The
valid options for this option depends on the action
used.</p>

<p style="margin-top: 1em">-t VAL or --timeout=VAL <br>
Sets the timeout in seconds after which the script will
abort whatever it is doing and return an UNKNOWN status. The
timeout is per Postgres cluster, not for the entire <br>
script. The default value is 10; the units are always in
seconds.</p>

<p style="margin-top: 1em">--assume-standby-mode <br>
If specified, first the check if server in standby mode will
be performed (--datadir is required), if so, all checks that
require SQL queries will be ignored and &quot;Server in <br>
standby mode&quot; with OK status will be returned
instead.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">postgres@db$./check_postgres
--action=version --warning=8.1 --datadir
/var/lib/postgresql/8.3/main/ --assume-standby-mode <br>
POSTGRES_VERSION OK: Server in standby mode | time=0.00</p>

<p style="margin-top: 1em">--assume-prod <br>
If specified, check if server in production mode is
performed (--datadir is required). The option is only
relevant for (&quot;symlink:
check_postgres_checkpoint&quot;).</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">postgres@db$./check_postgres
--action=checkpoint --datadir /var/lib/postgresql/8.3/main/
--assume-prod <br>
POSTGRES_CHECKPOINT OK: Last checkpoint was 72 seconds ago |
age=72;;300 mode=MASTER</p>

<p style="margin-top: 1em">-h or --help <br>
Displays a help screen with a summary of all actions and
options.</p>

<p style="margin-top: 1em">--man <br>
Displays the entire manual.</p>

<p style="margin-top: 1em">-V or --version <br>
Shows the current version.</p>

<p style="margin-top: 1em">-v or --verbose <br>
Set the verbosity level. Can call more than once to boost
the level. Setting it to three or higher (in other words,
issuing &quot;-v -v -v&quot;) turns on debugging information
for <br>
this program which is sent to stderr.</p>

<p style="margin-top: 1em">--showperf=VAL <br>
Determines if we output additional performance data in
standard Nagios format (at end of string, after a pipe
symbol, using name=value). VAL should be 0 or 1. The default
is <br>
1. Only takes effect if using Nagios output mode.</p>

<p style="margin-top: 1em">--perflimit=i <br>
Sets a limit as to how many items of interest are reported
back when using the showperf option. This only has an effect
for actions that return a large number of items, such <br>
as table_size. The default is 0, or no limit. Be careful
when using this with the --include or --exclude options, as
those restrictions are done after the query has been run,
<br>
and thus your limit may not include the items you want. Only
takes effect if using Nagios output mode.</p>

<p style="margin-top: 1em">--showtime=VAL <br>
Determines if the time taken to run each query is shown in
the output. VAL should be 0 or 1. The default is 1. No
effect unless showperf is on. Only takes effect if using
<br>
Nagios output mode.</p>

<p style="margin-top: 1em">--test <br>
Enables test mode. See the &quot;TEST MODE&quot; section
below.</p>

<p style="margin-top: 1em">--PGBINDIR=PATH <br>
Tells the script where to find the psql binaries. Useful if
you have more than one version of the PostgreSQL executables
on your system, or if there are not in your path. <br>
Note that this option is in all uppercase. By default, this
option is not allowed. To enable it, you must change the
$NO_PSQL_OPTION near the top of the script to 0. Avoid <br>
using this option if you can, and instead use environment
variable c&lt;PGBINDIR&gt; or hard-coded $PGBINDIR variable,
also near the top of the script, to set the path to the <br>
PostgreSQL to use.</p>

<p style="margin-top: 1em">--PSQL=PATH <br>
(deprecated, this option may be removed in a future
release!) Tells the script where to find the psql program.
Useful if you have more than one version of the psql <br>
executable on your system, or if there is no psql program in
your path. Note that this option is in all uppercase. By
default, this option is not allowed. To enable it, you <br>
must change the $NO_PSQL_OPTION near the top of the script
to 0. Avoid using this option if you can, and instead
hard-code your psql location into the $PSQL variable, also
<br>
near the top of the script.</p>

<p style="margin-top: 1em">--symlinks <br>
Creates symlinks to the main program for each action.</p>

<p style="margin-top: 1em">--output=VAL <br>
Determines the format of the output, for use in various
programs. The default is &rsquo;nagios&rsquo;. Available
options are &rsquo;nagios&rsquo;, &rsquo;mrtg&rsquo;,
&rsquo;simple&rsquo; and &rsquo;cacti&rsquo;.</p>

<p style="margin-top: 1em">--mrtg=VAL <br>
Used only for the MRTG or simple output, for a few specific
actions.</p>

<p style="margin-top: 1em">--debugoutput=VAL <br>
Outputs the exact string returned by psql, for use in
debugging. The value is one or more letters, which determine
if the output is displayed or not, where &rsquo;a&rsquo; =
all, &rsquo;c&rsquo; = <br>
critical, &rsquo;w&rsquo; = warning, &rsquo;o&rsquo; = ok,
and &rsquo;u&rsquo; = unknown. Letters can be combined.</p>

<p style="margin-top: 1em">--get_method=VAL <br>
Allows specification of the method used to fetch information
for the &quot;new_version_cp&quot;,
&quot;new_version_pg&quot;, &quot;new_version_bc&quot;,
&quot;new_version_box&quot;, and &quot;new_version_tnm&quot;
checks. <br>
The following programs are tried, in order, to grab the
information from the web: GET, wget, fetch, curl, lynx,
links. To force the use of just one (and thus remove the
<br>
overhead of trying all the others until one of those works),
enter one of the names as the argument to get_method. For
example, a BSD box might enter the following line in <br>
their &quot;.check_postgresrc&quot; file:</p>

<p style="margin-top: 1em">get_method=fetch</p>

<p style="margin-top: 1em">--language=VAL <br>
Set the language to use for all output messages. Normally,
this is detected by examining the environment variables
LC_ALL, LC_MESSAGES, and LANG, but setting this option will
<br>
override any such detection.</p>

<p style="margin-top: 1em">ACTIONS <br>
The script runs one or more actions. This can either be done
with the --action flag, or by using a symlink to the main
file that contains the name of the action inside of it. For
<br>
example, to run the action &quot;timesync&quot;, you may
either issue:</p>

<p style="margin-top: 1em">check_postgres
--action=timesync</p>

<p style="margin-top: 1em">or use a program named:</p>

<p style="margin-top: 1em">check_postgres_timesync</p>

<p style="margin-top: 1em">All the symlinks are created for
you in the current directory if use the option
--symlinks</p>

<p style="margin-top: 1em">perl check_postgres
--symlinks</p>

<p style="margin-top: 1em">If the file name already exists,
it will not be overwritten. If the file exists and is a
symlink, you can force it to overwrite by using
&quot;--action=build_symlinks_force&quot;</p>

<p style="margin-top: 1em">Most actions take a --warning
and a --critical option, indicating at what point we change
from OK to WARNING, and what point we go to CRITICAL. Note
that because criticals are <br>
always checked first, setting the warning equal to the
critical is an effective way to turn warnings off and always
give a critical.</p>

<p style="margin-top: 1em">The current supported actions
are:</p>

<p style="margin-top: 1em">archive_ready <br>
(&quot;symlink: check_postgres_archive_ready&quot;) Checks
how many WAL files with extension .ready exist in the
pg_xlog/archive_status directory, which is found off of your
<br>
data_directory. This action must be run as a superuser, in
order to access the contents of the pg_xlog/archive_status
directory. The minimum version to use this action is <br>
Postgres 8.1. The --warning and --critical options are
simply the number of .ready files in the
pg_xlog/archive_status directory. Usually, these values
should be low, turning on <br>
the archive mechanism, we usually want it to archive WAL
files as fast as possible.</p>

<p style="margin-top: 1em">If the archive command fail,
number of WAL in your pg_xlog directory will grow until
exhausting all the disk space and force PostgreSQL to stop
immediately.</p>

<p style="margin-top: 1em">Example 1: Check that the number
of ready WAL files is 10 or less on host
&quot;pluto&quot;</p>

<p style="margin-top: 1em">check_postgres_archive_ready
--host=pluto --critical=10</p>

<p style="margin-top: 1em">For MRTG output, reports the
number of ready WAL files on line 1.</p>

<p style="margin-top: 1em">autovac_freeze <br>
(&quot;symlink: check_postgres_autovac_freeze&quot;) Checks
how close each database is to the Postgres
autovacuum_freeze_max_age setting. This action will only
work for databases version <br>
8.2 or higher. The --warning and --critical options should
be expressed as percentages. The &rsquo;age&rsquo; of the
transactions in each database is compared to the <br>
autovacuum_freeze_max_age setting (200 million by default)
to generate a rounded percentage. The default values are 90%
for the warning and 95% for the critical. Databases can be
<br>
filtered by use of the --include and --exclude options. See
the &quot;BASIC FILTERING&quot; section for more
details.</p>

<p style="margin-top: 1em">Example 1: Give a warning when
any databases on port 5432 are above 97%</p>

<p style="margin-top: 1em">check_postgres_autovac_freeze
--port=5432 --warning=&quot;97%&quot;</p>

<p style="margin-top: 1em">For MRTG output, the highest
overall percentage is reported on the first line, and the
highest age is reported on the second line. All databases
which have the percentage from <br>
the first line are reported on the fourth line, separated by
a pipe symbol.</p>

<p style="margin-top: 1em">backends <br>
(&quot;symlink: check_postgres_backends&quot;) Checks the
current number of connections for one or more databases, and
optionally compares it to the maximum allowed, which is
determined by <br>
the Postgres configuration variable max_connections. The
--warning and --critical options can take one of three
forms. First, a simple number can be given, which represents
the <br>
number of connections at which the alert will be given. This
choice does not use the max_connections setting. Second, the
percentage of available connections can be given. Third,
<br>
a negative number can be given which represents the number
of connections left until max_connections is reached. The
default values for --warning and --critical are
&rsquo;90%&rsquo; and <br>
&rsquo;95%&rsquo;. You can also filter the databases by use
of the --include and --exclude options. See the &quot;BASIC
FILTERING&quot; section for more details.</p>

<p style="margin-top: 1em">To view only non-idle processes,
you can use the --noidle argument. Note that the user you
are connecting as must be a superuser for this to work
properly.</p>

<p style="margin-top: 1em">Example 1: Give a warning when
the number of connections on host quirm reaches 120, and a
critical if it reaches 150.</p>

<p style="margin-top: 1em">check_postgres_backends
--host=quirm --warning=120 --critical=150</p>

<p style="margin-top: 1em">Example 2: Give a critical when
we reach 75% of our max_connections setting on hosts lancre
or lancre2.</p>

<p style="margin-top: 1em">check_postgres_backends
--warning=&rsquo;75%&rsquo; --critical=&rsquo;75%&rsquo;
--host=lancre,lancre2</p>

<p style="margin-top: 1em">Example 3: Give a warning when
there are only 10 more connection slots left on host
plasmid, and a critical when we have only 5 left.</p>

<p style="margin-top: 1em">check_postgres_backends
--warning=-10 --critical=-5 --host=plasmid</p>

<p style="margin-top: 1em">Example 4: Check all databases
except those with &quot;test&quot; in their name, but allow
ones that are named &quot;pg_greatest&quot;. Connect as port
5432 on the first two hosts, and as port 5433 <br>
on the third one. We want to always throw a critical when we
reach 30 or more connections.</p>

<p style="margin-top: 1em">check_postgres_backends
--dbhost=hong,kong --dbhost=fooey --dbport=5432
--dbport=5433 --warning=30 --critical=30
--exclude=&quot;~test&quot;
--include=&quot;pg_greatest,~prod&quot;</p>

<p style="margin-top: 1em">For MRTG output, the number of
connections is reported on the first line, and the fourth
line gives the name of the database, plus the current
maximum_connections. If more than <br>
one database has been queried, the one with the highest
number of connections is output.</p>

<p style="margin-top: 1em">bloat <br>
(&quot;symlink: check_postgres_bloat&quot;) Checks the
amount of bloat in tables and indexes. (Bloat is generally
the amount of dead unused space taken up in a table or
index. This space <br>
is usually reclaimed by use of the VACUUM command.) This
action requires that stats collection be enabled on the
target databases, and requires that ANALYZE is run
frequently. <br>
The --include and --exclude options can be used to filter
out which tables to look at. See the &quot;BASIC
FILTERING&quot; section for more details.</p>

<p style="margin-top: 1em">The --warning and --critical
options can be specified as sizes, percents, or both. Valid
size units are bytes, kilobytes, megabytes, gigabytes,
terabytes, exabytes, petabytes, <br>
and zettabytes. You can abbreviate all of those with the
first letter. Items without units are assumed to be
&rsquo;bytes&rsquo;. The default values are &rsquo;1
GB&rsquo; and &rsquo;5 GB&rsquo;. The value <br>
represents the number of &quot;wasted bytes&quot;, or the
difference between what is actually used by the table and
index, and what we compute that it should be.</p>

<p style="margin-top: 1em">Note that this action has two
hard-coded values to avoid false alarms on smaller
relations. Tables must have at least 10 pages, and indexes
at least 15, before they can be <br>
considered by this test. If you really want to adjust these
values, you can look for the variables $MINPAGES and
$MINIPAGES at the top of the &quot;check_bloat&quot;
subroutine. These <br>
values are ignored if either --exclude or --include is
used.</p>

<p style="margin-top: 1em">Only the top 10 most bloated
relations are shown. You can change this number by using the
--perflimit option to set your own limit.</p>

<p style="margin-top: 1em">The schema named
&rsquo;information_schema&rsquo; is excluded from this test,
as the only tables it contains are small and do not
change.</p>

<p style="margin-top: 1em">Please note that the values
computed by this action are not precise, and should be used
as a guideline only. Great effort was made to estimate the
correct size of a table, but in <br>
the end it is only an estimate. The correct index size is
even more of a guess than the correct table size, but both
should give a rough idea of how bloated things are.</p>

<p style="margin-top: 1em">Example 1: Warn if any table on
port 5432 is over 100 MB bloated, and critical if over 200
MB</p>

<p style="margin-top: 1em">check_postgres_bloat --port=5432
--warning=&rsquo;100 M&rsquo; --critical=&rsquo;200
M&rsquo;</p>

<p style="margin-top: 1em">Example 2: Give a critical if
table &rsquo;orders&rsquo; on host &rsquo;sami&rsquo; has
more than 10 megs of bloat</p>

<p style="margin-top: 1em">check_postgres_bloat --host=sami
--include=orders --critical=&rsquo;10 MB&rsquo;</p>

<p style="margin-top: 1em">Example 3: Give a critical if
table &rsquo;q4&rsquo; on database &rsquo;sales&rsquo; is
over 50% bloated</p>

<p style="margin-top: 1em">check_postgres_bloat --db=sales
--include=q4 --critical=&rsquo;50%&rsquo;</p>

<p style="margin-top: 1em">Example 4: Give a critical any
table is over 20% bloated and has over 150 MB of bloat:</p>

<p style="margin-top: 1em">check_postgres_bloat --port=5432
--critical=&rsquo;20% and 150 M&rsquo;</p>

<p style="margin-top: 1em">Example 5: Give a critical any
table is over 40% bloated or has over 500 MB of bloat:</p>

<p style="margin-top: 1em">check_postgres_bloat --port=5432
--warning=&rsquo;500 M or 40%&rsquo;</p>

<p style="margin-top: 1em">For MRTG output, the first line
gives the highest number of wasted bytes for the tables, and
the second line gives the highest number of wasted bytes for
the indexes. The fourth <br>
line gives the database name, table name, and index name
information. If you want to output the bloat ratio instead
(how many times larger the relation is compared to how large
<br>
it should be), just pass in &quot;--mrtg=ratio&quot;.</p>

<p style="margin-top: 1em">checkpoint <br>
(&quot;symlink: check_postgres_checkpoint&quot;) Determines
how long since the last checkpoint has been run. This must
run on the same server as the database that is being checked
(e.g. <br>
the -h flag will not work). This check is meant to run on a
&quot;warm standby&quot; server that is actively processing
shipped WAL files, and is meant to check that your warm
standby is <br>
truly &rsquo;warm&rsquo;. The data directory must be set,
either by the environment variable &quot;PGDATA&quot;, or
passing the &quot;--datadir&quot; argument. It returns the
number of seconds since the last <br>
checkpoint was run, as determined by parsing the call to
&quot;pg_controldata&quot;. Because of this, the
pg_controldata executable must be available in the current
path. Alternatively, <br>
you can specify &quot;PGBINDIR&quot; as the directory that
it lives in. It is also possible to use the special options
--assume-prod or --assume-standby-mode, if the mode found is
not the <br>
one expected, a CRITICAL is emitted.</p>

<p style="margin-top: 1em">At least one warning or critical
argument must be set.</p>

<p style="margin-top: 1em">This action requires the
Date::Parse module.</p>

<p style="margin-top: 1em">For MRTG or simple output,
returns the number of seconds.</p>

<p style="margin-top: 1em">cluster_id <br>
(&quot;symlink: check_postgres_cluster-id&quot;) Checks that
the Database System Identifier provided by pg_controldata is
the same as last time you checked. This must run on the same
<br>
server as the database that is being checked (e.g. the -h
flag will not work). Either the --warning or the --critical
option should be given, but not both. The value of each one
<br>
is the cluster identifier, an integer value. You can run
with the special &quot;--critical=0&quot; option to find out
an existing cluster identifier.</p>

<p style="margin-top: 1em">Example 1: Find the initial
identifier</p>

<p style="margin-top: 1em">check_postgres_cluster_id
--critical=0 --datadir=/var//lib/postgresql/9.0/main</p>

<p style="margin-top: 1em">Example 2: Make sure the cluster
is the same and warn if not, using the result from
above.</p>

<p style="margin-top: 1em">check_postgres_cluster_id
--critical=5633695740047915135</p>

<p style="margin-top: 1em">For MRTG output, returns a 1 or
0 indicating success of failure of the identifier to match.
A identifier must be provided as the &quot;--mrtg&quot;
argument. The fourth line always gives <br>
the current identifier.</p>

<p style="margin-top: 1em">commitratio <br>
(&quot;symlink: check_postgres_commitratio&quot;) Checks the
commit ratio of all databases and complains when they are
too low. There is no need to run this command more than once
per <br>
database cluster. Databases can be filtered with the
--include and --exclude options. See the &quot;BASIC
FILTERING&quot; section for more details. They can also be
filtered by the owner <br>
of the database with the --includeuser and --excludeuser
options. See the &quot;USER NAME FILTERING&quot; section for
more details.</p>

<p style="margin-top: 1em">The warning and critical options
should be specified as percentages. There are not defaults
for this action: the warning and critical must be specified.
The warning value cannot <br>
be greater than the critical value. The output returns all
databases sorted by commitratio, smallest first.</p>

<p style="margin-top: 1em">Example: Warn if any database on
host flagg is less than 90% in commitratio, and critical if
less then 80%.</p>


<p style="margin-top: 1em">check_postgres_database_commitratio
--host=flagg --warning=&rsquo;90%&rsquo;
--critical=&rsquo;80%&rsquo;</p>

<p style="margin-top: 1em">For MRTG output, returns the
percentage of the database with the smallest commitratio on
the first line, and the name of the database on the fourth
line.</p>

<p style="margin-top: 1em">connection <br>
(&quot;symlink: check_postgres_connection&quot;) Simply
connects, issues a &rsquo;SELECT version()&rsquo;, and
leaves. Takes no --warning or --critical options.</p>

<p style="margin-top: 1em">For MRTG output, simply outputs
a 1 (good connection) or a 0 (bad connection) on the first
line.</p>

<p style="margin-top: 1em">custom_query <br>
(&quot;symlink: check_postgres_custom_query&quot;) Runs a
custom query of your choosing, and parses the results. The
query itself is passed in through the &quot;query&quot;
argument, and should be <br>
kept as simple as possible. If at all possible, wrap it in a
view or a function to keep things easier to manage. The
query should return one or two columns. It is required that
<br>
one of the columns be named &quot;result&quot; and is the
item that will be checked against your warning and critical
values. The second column is for the performance data and
any name can <br>
be used: this will be the &rsquo;value&rsquo; inside the
performance data section.</p>

<p style="margin-top: 1em">At least one warning or critical
argument must be specified. What these are set to depends on
the type of query you are running. There are four types of
custom_queries that can <br>
be run, specified by the &quot;valtype&quot; argument. If
none is specified, this action defaults to
&rsquo;integer&rsquo;. The four types are:</p>

<p style="margin-top: 1em">integer: Does a simple integer
comparison. The first column should be a simple integer, and
the warning and critical values should be the same.</p>

<p style="margin-top: 1em">string: The warning and critical
are strings, and are triggered only if the value in the
first column matches it exactly. This is case-sensitive.</p>

<p style="margin-top: 1em">time: The warning and the
critical are times, and can have units of seconds, minutes,
hours, or days. Each may be written singular or abbreviated
to just the first letter. If no <br>
units are given, seconds are assumed. The first column
should be an integer representing the number of seconds to
check.</p>

<p style="margin-top: 1em">size: The warning and the
critical are sizes, and can have units of bytes, kilobytes,
megabytes, gigabytes, terabytes, or exabytes. Each may be
abbreviated to the first letter. <br>
If no units are given, bytes are assumed. The first column
should be an integer representing the number of bytes to
check.</p>

<p style="margin-top: 1em">Normally, an alert is triggered
if the values returned are greater than or equal to the
critical or warning value. However, an option of --reverse
will trigger the alert if the <br>
returned value is lower than or equal to the critical or
warning value.</p>

<p style="margin-top: 1em">Example 1: Warn if any relation
over 100 pages is named &quot;rad&quot;, put the number of
pages inside the performance data section.</p>

<p style="margin-top: 1em">check_postgres_custom_query
--valtype=string -w &quot;rad&quot; --query= <br>
&quot;SELECT relname AS result, relpages AS pages FROM
pg_class WHERE relpages &gt; 100&quot;</p>

<p style="margin-top: 1em">Example 2: Give a critical if
the &quot;foobar&quot; function returns a number over
5MB:</p>

<p style="margin-top: 1em">check_postgres_custom_query
--critical=&rsquo;5MB&rsquo;--valtype=size
--query=&quot;SELECT foobar() AS result&quot;</p>

<p style="margin-top: 1em">Example 2: Warn if the function
&quot;snazzo&quot; returns less than 42:</p>

<p style="margin-top: 1em">check_postgres_custom_query
--critical=42 --query=&quot;SELECT snazzo() AS result&quot;
--reverse</p>

<p style="margin-top: 1em">If you come up with a useful
custom_query, consider sending in a patch to this program to
make it into a standard action that other people can
use.</p>

<p style="margin-top: 1em">This action does not support
MRTG or simple output yet.</p>

<p style="margin-top: 1em">database_size <br>
(&quot;symlink: check_postgres_database_size&quot;) Checks
the size of all databases and complains when they are too
big. There is no need to run this command more than once per
database <br>
cluster. Databases can be filtered with the --include and
--exclude options. See the &quot;BASIC FILTERING&quot;
section for more details. They can also be filtered by the
owner of the <br>
database with the --includeuser and --excludeuser options.
See the &quot;USER NAME FILTERING&quot; section for more
details.</p>

<p style="margin-top: 1em">The warning and critical options
can be specified as bytes, kilobytes, megabytes, gigabytes,
terabytes, or exabytes. Each may be abbreviated to the first
letter as well. If no <br>
unit is given, the units are assumed to be bytes. There are
not defaults for this action: the warning and critical must
be specified. The warning value cannot be greater than the
<br>
critical value. The output returns all databases sorted by
size largest first, showing both raw bytes and a
&quot;pretty&quot; version of the size.</p>

<p style="margin-top: 1em">Example 1: Warn if any database
on host flagg is over 1 TB in size, and critical if over 1.1
TB.</p>

<p style="margin-top: 1em">check_postgres_database_size
--host=flagg --warning=&rsquo;1 TB&rsquo;
--critical=&rsquo;1.1 t&rsquo;</p>

<p style="margin-top: 1em">Example 2: Give a critical if
the database template1 on port 5432 is over 10 MB.</p>

<p style="margin-top: 1em">check_postgres_database_size
--port=5432 --include=template1 --warning=&rsquo;10MB&rsquo;
--critical=&rsquo;10MB&rsquo;</p>

<p style="margin-top: 1em">Example 3: Give a warning if any
database on host &rsquo;tardis&rsquo; owned by the user
&rsquo;tom&rsquo; is over 5 GB</p>

<p style="margin-top: 1em">check_postgres_database_size
--host=tardis --includeuser=tom --warning=&rsquo;5 GB&rsquo;
--critical=&rsquo;10 GB&rsquo;</p>

<p style="margin-top: 1em">For MRTG output, returns the
size in bytes of the largest database on the first line, and
the name of the database on the fourth line.</p>

<p style="margin-top: 1em">dbstats <br>
(&quot;symlink: check_postgres_dbstats&quot;) Reports
information from the pg_stat_database view, and outputs it
in a Cacti-friendly manner. No other output is supported, as
the output is <br>
informational and does not lend itself to alerts, such as
used with Nagios. If no options are given, all databases are
returned, one per line. You can include a specific database
<br>
by use of the &quot;--include&quot; option, or you can use
the &quot;--dbname&quot; option.</p>

<p style="margin-top: 1em">Eleven items are returned on
each line, in the format name:value, separated by a single
space. The items are:</p>

<p style="margin-top: 1em">backends <br>
The number of currently running backends for this
database.</p>

<p style="margin-top: 1em">commits <br>
The total number of commits for this database since it was
created or reset.</p>

<p style="margin-top: 1em">rollbacks <br>
The total number of rollbacks for this database since it was
created or reset.</p>

<p style="margin-top: 1em">read <br>
The total number of disk blocks read.</p>

<p style="margin-top: 1em">hit The total number of buffer
hits.</p>

<p style="margin-top: 1em">ret The total number of rows
returned.</p>

<p style="margin-top: 1em">fetch <br>
The total number of rows fetched.</p>

<p style="margin-top: 1em">ins The total number of rows
inserted.</p>

<p style="margin-top: 1em">upd The total number of rows
updated.</p>

<p style="margin-top: 1em">del The total number of rows
deleted.</p>

<p style="margin-top: 1em">dbname <br>
The name of the database.</p>

<p style="margin-top: 1em">Note that ret, fetch, ins, upd,
and del items will always be 0 if Postgres is version 8.2 or
lower, as those stats were not available in those
versions.</p>

<p style="margin-top: 1em">If the dbname argument is given,
seven additional items are returned:</p>

<p style="margin-top: 1em">idxscan <br>
Total number of user index scans.</p>

<p style="margin-top: 1em">idxtupread <br>
Total number of user index entries returned.</p>

<p style="margin-top: 1em">idxtupfetch <br>
Total number of rows fetched by simple user index scans.</p>

<p style="margin-top: 1em">idxblksread <br>
Total number of disk blocks read for all user indexes.</p>

<p style="margin-top: 1em">idxblkshit <br>
Total number of buffer hits for all user indexes.</p>

<p style="margin-top: 1em">seqscan <br>
Total number of sequential scans against all user
tables.</p>

<p style="margin-top: 1em">seqtupread <br>
Total number of tuples returned from all user tables.</p>

<p style="margin-top: 1em">Example 1: Grab the stats for a
database named &quot;products&quot; on host
&quot;willow&quot;:</p>

<p style="margin-top: 1em">check_postgres_dbstats --dbhost
willow --dbname products</p>

<p style="margin-top: 1em">The output returned will be like
this (all on one line, not wrapped):</p>

<p style="margin-top: 1em">backends:82 commits:58374408
rollbacks:1651 read:268435543 hit:2920381758
idxscan:310931294 idxtupread:2777040927 <br>
idxtupfetch:1840241349 idxblksread:62860110
idxblkshit:1107812216 seqscan:5085305 seqtupread:5370500520
<br>
ret:0 fetch:0 ins:0 upd:0 del:0 dbname:willow</p>

<p style="margin-top: 1em">disabled_triggers <br>
(&quot;symlink: check_postgres_disabled_triggers&quot;)
Checks on the number of disabled triggers inside the
database. The --warning and --critical options are the
number of such triggers <br>
found, and both default to &quot;1&quot;, as in normal usage
having disabled triggers is a dangerous event. If the
database being checked is 8.3 or higher, the check is for
the number of <br>
triggers that are in a &rsquo;disabled&rsquo; status (as
opposed to being &rsquo;always&rsquo; or
&rsquo;replica&rsquo;). The output will show the name of the
table and the name of the trigger for each disabled <br>
trigger.</p>

<p style="margin-top: 1em">Example 1: Make sure that there
are no disabled triggers</p>


<p style="margin-top: 1em">check_postgres_disabled_triggers</p>

<p style="margin-top: 1em">For MRTG output, returns the
number of disabled triggers on the first line.</p>

<p style="margin-top: 1em">disk_space <br>
(&quot;symlink: check_postgres_disk_space&quot;) Checks on
the available physical disk space used by Postgres. This
action requires that you have the executable
&quot;/bin/df&quot; available to <br>
report on disk sizes, and it also needs to be run as a
superuser, so it can examine the data_directory setting
inside of Postgres. The --warning and --critical options are
given <br>
in either sizes or percentages or both. If using sizes, the
standard unit types are allowed: bytes, kilobytes,
gigabytes, megabytes, gigabytes, terabytes, or exabytes.
Each may <br>
be abbreviated to the first letter only; no units at all
indicates &rsquo;bytes&rsquo;. The default values are
&rsquo;90%&rsquo; and &rsquo;95%&rsquo;.</p>

<p style="margin-top: 1em">This command checks the
following things to determine all of the different physical
disks being used by Postgres.</p>

<p style="margin-top: 1em">data_directory - The disk that
the main data directory is on.</p>

<p style="margin-top: 1em">log directory - The disk that
the log files are on.</p>

<p style="margin-top: 1em">WAL file directory - The disk
that the write-ahead logs are on (e.g. symlinked
pg_xlog)</p>

<p style="margin-top: 1em">tablespaces - Each tablespace
that is on a separate disk.</p>

<p style="margin-top: 1em">The output shows the total size
used and available on each disk, as well as the percentage,
ordered by highest to lowest percentage used. Each item
above maps to a file system: <br>
these can be included or excluded. See the &quot;BASIC
FILTERING&quot; section for more details.</p>

<p style="margin-top: 1em">Example 1: Make sure that no
file system is over 90% for the database on port 5432.</p>

<p style="margin-top: 1em">check_postgres_disk_space
--port=5432 --warning=&rsquo;90%&rsquo;
--critical=&rsquo;90%&rsquo;</p>

<p style="margin-top: 1em">Example 2: Check that all file
systems starting with /dev/sda are smaller than 10 GB and 11
GB (warning and critical)</p>

<p style="margin-top: 1em">check_postgres_disk_space
--port=5432 --warning=&rsquo;10 GB&rsquo;
--critical=&rsquo;11 GB&rsquo;
--include=&quot;~^/dev/sda&quot;</p>

<p style="margin-top: 1em">Example 4: Make sure that no
file system is both over 50% and has over 15 GB</p>

<p style="margin-top: 1em">check_postgres_disk_space
--critical=&rsquo;50% and 15 GB&rsquo;</p>

<p style="margin-top: 1em">Example 5: Issue a warning if
any file system is either over 70% full or has more than
1T</p>

<p style="margin-top: 1em">check_postgres_disk_space
--warning=&rsquo;1T or 75&rsquo;</p>

<p style="margin-top: 1em">For MRTG output, returns the
size in bytes of the file system on the first line, and the
name of the file system on the fourth line.</p>

<p style="margin-top: 1em">fsm_pages <br>
(&quot;symlink: check_postgres_fsm_pages&quot;) Checks how
close a cluster is to the Postgres max_fsm_pages setting.
This action will only work for databases of 8.2 or higher,
and it <br>
requires the contrib module pg_freespacemap be installed.
The --warning and --critical options should be expressed as
percentages. The number of used pages in the free-space-map
<br>
is determined by looking in the pg_freespacemap_relations
view, and running a formula based on the formula used for
outputting free-space-map pageslots in the vacuum verbose
<br>
command. The default values are 85% for the warning and 95%
for the critical.</p>

<p style="margin-top: 1em">Example 1: Give a warning when
our cluster has used up 76% of the free-space pageslots,
with pg_freespacemap installed in database robert</p>

<p style="margin-top: 1em">check_postgres_fsm_pages
--dbname=robert --warning=&quot;76%&quot;</p>

<p style="margin-top: 1em">While you need to pass in the
name of the database where pg_freespacemap is installed, you
only need to run this check once per cluster. Also, checking
this information does <br>
require obtaining special locks on the free-space-map, so it
is recommend you do not run this check with short
intervals.</p>

<p style="margin-top: 1em">For MRTG output, returns the
percent of free-space-map on the first line, and the number
of pages currently used on the second line.</p>

<p style="margin-top: 1em">fsm_relations <br>
(&quot;symlink: check_postgres_fsm_relations&quot;) Checks
how close a cluster is to the Postgres max_fsm_relations
setting. This action will only work for databases of 8.2 or
higher, and <br>
it requires the contrib module pg_freespacemap be installed.
The --warning and --critical options should be expressed as
percentages. The number of used relations in the free- <br>
space-map is determined by looking in the
pg_freespacemap_relations view. The default values are 85%
for the warning and 95% for the critical.</p>

<p style="margin-top: 1em">Example 1: Give a warning when
our cluster has used up 80% of the free-space relations,
with pg_freespacemap installed in database dylan</p>

<p style="margin-top: 1em">check_postgres_fsm_relations
--dbname=dylan --warning=&quot;75%&quot;</p>

<p style="margin-top: 1em">While you need to pass in the
name of the database where pg_freespacemap is installed, you
only need to run this check once per cluster. Also, checking
this information does <br>
require obtaining special locks on the free-space-map, so it
is recommend you do not run this check with short
intervals.</p>

<p style="margin-top: 1em">For MRTG output, returns the
percent of free-space-map on the first line, the number of
relations currently used on the second line.</p>

<p style="margin-top: 1em">hitratio <br>
(&quot;symlink: check_postgres_hitratio&quot;) Checks the
hit ratio of all databases and complains when they are too
low. There is no need to run this command more than once per
database <br>
cluster. Databases can be filtered with the --include and
--exclude options. See the &quot;BASIC FILTERING&quot;
section for more details. They can also be filtered by the
owner of the <br>
database with the --includeuser and --excludeuser options.
See the &quot;USER NAME FILTERING&quot; section for more
details.</p>

<p style="margin-top: 1em">The warning and critical options
should be specified as percentages. There are not defaults
for this action: the warning and critical must be specified.
The warning value cannot <br>
be greater than the critical value. The output returns all
databases sorted by hitratio, smallest first.</p>

<p style="margin-top: 1em">Example: Warn if any database on
host flagg is less than 90% in hitratio, and critical if
less then 80%.</p>

<p style="margin-top: 1em">check_postgres_hitratio
--host=flagg --warning=&rsquo;90%&rsquo;
--critical=&rsquo;80%&rsquo;</p>

<p style="margin-top: 1em">For MRTG output, returns the
percentage of the database with the smallest hitratio on the
first line, and the name of the database on the fourth
line.</p>

<p style="margin-top: 1em">hot_standby_delay <br>
(&quot;symlink: check_hot_standby_delay&quot;) Checks the
streaming replication lag by computing the delta between the
current xlog position of a master server and the replay
location of a <br>
slave connected to it. The slave server must be in
hot_standby (e.g. read only) mode, therefore the minimum
version to use this action is Postgres 9.0. The --warning
and <br>
--critical options are the delta between the xlog locations.
Since these values are byte offsets in the WAL they should
match the expected transaction volume of your application
<br>
to prevent false positives or negatives.</p>

<p style="margin-top: 1em">The first &quot;--dbname&quot;,
&quot;--host&quot;, and &quot;--port&quot;, etc. options are
considered the master; the second belongs to the slave.</p>

<p style="margin-top: 1em">Byte values should be based on
the volume of transactions needed to have the streaming
replication disconnect from the master because of too much
lag, determined by the Postgres <br>
configuration variable wal_keep_segments. For units of time,
valid units are &rsquo;seconds&rsquo;,
&rsquo;minutes&rsquo;, &rsquo;hours&rsquo;, or
&rsquo;days&rsquo;. Each may be written singular or
abbreviated to just the <br>
first letter. When specifying both, in the form &rsquo;bytes
and time&rsquo;, both conditions must be true for the
threshold to be met.</p>

<p style="margin-top: 1em">You must provide information on
how to reach the databases by providing a comma separated
list to the --dbhost and --dbport parameters, such as
&quot;--dbport=5432,5543&quot;. If not <br>
given, the action fails.</p>

<p style="margin-top: 1em">Example 1: Warn a database with
a local replica on port 5433 is behind on any xlog replay at
all</p>

<p style="margin-top: 1em">check_hot_standby_delay
--dbport=5432,5433 --warning=&rsquo;1&rsquo;</p>

<p style="margin-top: 1em">Example 2: Give a critical if
the last transaction replica1 receives is more than 10
minutes ago</p>

<p style="margin-top: 1em">check_hot_standby_delay
--dbhost=master,replica1 --critical=&rsquo;10 min&rsquo;</p>

<p style="margin-top: 1em">Example 3: Allow replica1 to be
1 WAL segment behind, if the master is momentarily seeing
more activity than the streaming replication connection can
handle, or 10 minutes <br>
behind, if the master is seeing very little activity and not
processing any transactions, but not both, which would
indicate a lasting problem with the replication
connection.</p>

<p style="margin-top: 1em">check_hot_standby_delay
--dbhost=master,replica1 --warning=&rsquo;1048576 and 2
min&rsquo; --critical=&rsquo;16777216 and 10 min&rsquo;</p>

<p style="margin-top: 1em">index_size <br>
table_size <br>
relation_size <br>
(symlinks: &quot;check_postgres_index_size&quot;,
&quot;check_postgres_table_size&quot;, and
&quot;check_postgres_relation_size&quot;) The actions
table_size and index_size are simply variations of the <br>
relation_size action, which checks for a relation that has
grown too big. Relations (in other words, tables and
indexes) can be filtered with the --include and --exclude
<br>
options. See the &quot;BASIC FILTERING&quot; section for
more details. Relations can also be filtered by the user
that owns them, by using the --includeuser and --excludeuser
options. See <br>
the &quot;USER NAME FILTERING&quot; section for more
details.</p>

<p style="margin-top: 1em">The values for the --warning and
--critical options are file sizes, and may have units of
bytes, kilobytes, megabytes, gigabytes, terabytes, or
exabytes. Each can be abbreviated <br>
to the first letter. If no units are given, bytes are
assumed. There are no default values: both the warning and
the critical option must be given. The return text shows the
size <br>
of the largest relation found.</p>

<p style="margin-top: 1em">If the --showperf option is
enabled, all of the relations with their sizes will be
given. To prevent this, it is recommended that you set the
--perflimit option, which will cause <br>
the query to do a &quot;ORDER BY size DESC LIMIT
(perflimit)&quot;.</p>

<p style="margin-top: 1em">Example 1: Give a critical if
any table is larger than 600MB on host burrick.</p>

<p style="margin-top: 1em">check_postgres_table_size
--critical=&rsquo;600 MB&rsquo; --warning=&rsquo;600
MB&rsquo; --host=burrick</p>

<p style="margin-top: 1em">Example 2: Warn if the table
products is over 4 GB in size, and give a critical at 4.5
GB.</p>

<p style="margin-top: 1em">check_postgres_table_size
--host=burrick --warning=&rsquo;4 GB&rsquo;
--critical=&rsquo;4.5 GB&rsquo; --include=products</p>

<p style="margin-top: 1em">Example 3: Warn if any index not
owned by postgres goes over 500 MB.</p>

<p style="margin-top: 1em">check_postgres_index_size
--port=5432 --excludeuser=postgres -w 500MB -c 600MB</p>

<p style="margin-top: 1em">For MRTG output, returns the
size in bytes of the largest relation, and the name of the
database and relation as the fourth line.</p>

<p style="margin-top: 1em">last_analyze <br>
last_vacuum <br>
last_autoanalyze <br>
last_autovacuum <br>
(symlinks: &quot;check_postgres_last_analyze&quot;,
&quot;check_postgres_last_vacuum&quot;,
&quot;check_postgres_last_autoanalyze&quot;, and
&quot;check_postgres_last_autovacuum&quot;) Checks how long
it has been since <br>
vacuum (or analyze) was last run on each table in one or
more databases. Use of these actions requires that the
target database is version 8.3 or greater, or that the
version is <br>
8.2 and the configuration variable stats_row_level has been
enabled. Tables can be filtered with the --include and
--exclude options. See the &quot;BASIC FILTERING&quot;
section for more <br>
details. Tables can also be filtered by their owner by use
of the --includeuser and --excludeuser options. See the
&quot;USER NAME FILTERING&quot; section for more
details.</p>

<p style="margin-top: 1em">The units for --warning and
--critical are specified as times. Valid units are seconds,
minutes, hours, and days; all can be abbreviated to the
first letter. If no units are <br>
given, &rsquo;seconds&rsquo; are assumed. The default values
are &rsquo;1 day&rsquo; and &rsquo;2 days&rsquo;. Please
note that there are cases in which this field does not get
automatically populated. If certain <br>
tables are giving you problems, make sure that they have
dead rows to vacuum, or just exclude them from the test.</p>

<p style="margin-top: 1em">The schema named
&rsquo;information_schema&rsquo; is excluded from this test,
as the only tables it contains are small and do not
change.</p>

<p style="margin-top: 1em">Note that the
non-&rsquo;auto&rsquo; versions will also check on the auto
versions as well. In other words, using last_vacuum will
report on the last vacuum, whether it was a normal vacuum,
<br>
or one run by the autovacuum daemon.</p>

<p style="margin-top: 1em">Example 1: Warn if any table has
not been vacuumed in 3 days, and give a critical at a week,
for host wormwood</p>

<p style="margin-top: 1em">check_postgres_last_vacuum
--host=wormwood --warning=&rsquo;3d&rsquo;
--critical=&rsquo;7d&rsquo;</p>

<p style="margin-top: 1em">Example 2: Same as above, but
skip tables belonging to the users &rsquo;eve&rsquo; or
&rsquo;mallory&rsquo;</p>

<p style="margin-top: 1em">check_postgres_last_vacuum
--host=wormwood --warning=&rsquo;3d&rsquo;
--critical=&rsquo;7d&rsquo; --excludeusers=eve,mallory</p>

<p style="margin-top: 1em">For MRTG output, returns (on the
first line) the LEAST amount of time in seconds since a
table was last vacuumed or analyzed. The fourth line returns
the name of the database and <br>
name of the table.</p>

<p style="margin-top: 1em">listener <br>
(&quot;symlink: check_postgres_listener&quot;) Confirm that
someone is listening for one or more specific strings (using
the LISTEN/NOTIFY system), by looking at the pg_listener
table. <br>
Only one of warning or critical is needed. The format is a
simple string representing the LISTEN target, or a tilde
character followed by a string for a regular expression
check. <br>
Note that this check will not work on versions of Postgres
9.0 or higher.</p>

<p style="margin-top: 1em">Example 1: Give a warning if
nobody is listening for the string bucardo_mcp_ping on ports
5555 and 5556</p>

<p style="margin-top: 1em">check_postgres_listener
--port=5555,5556 --warning=bucardo_mcp_ping</p>

<p style="margin-top: 1em">Example 2: Give a critical if
there are no active LISTEN requests matching
&rsquo;grimm&rsquo; on database oskar</p>

<p style="margin-top: 1em">check_postgres_listener --db
oskar --critical=~grimm</p>

<p style="margin-top: 1em">For MRTG output, returns a 1 or
a 0 on the first, indicating success or failure. The name of
the notice must be provided via the --mrtg option.</p>

<p style="margin-top: 1em">locks <br>
(&quot;symlink: check_postgres_locks&quot;) Check the total
number of locks on one or more databases. There is no need
to run this more than once per database cluster. Databases
can be <br>
filtered with the --include and --exclude options. See the
&quot;BASIC FILTERING&quot; section for more details.</p>

<p style="margin-top: 1em">The --warning and --critical
options can be specified as simple numbers, which represent
the total number of locks, or they can be broken down by
type of lock. Valid lock names <br>
are &rsquo;total&rsquo;, &rsquo;waiting&rsquo;, or the name
of a lock type used by Postgres. These names are
case-insensitive and do not need the &quot;lock&quot; part
on the end, so exclusive will match <br>
&rsquo;ExclusiveLock&rsquo;. The format is name=number, with
different items separated by colons or semicolons (or any
other symbol).</p>

<p style="margin-top: 1em">Example 1: Warn if the number of
locks is 100 or more, and critical if 200 or more, on host
garrett</p>

<p style="margin-top: 1em">check_postgres_locks
--host=garrett --warning=100 --critical=200</p>

<p style="margin-top: 1em">Example 2: On the host artemus,
warn if 200 or more locks exist, and give a critical if over
250 total locks exist, or if over 20 exclusive locks exist,
or if over 5 connections <br>
are waiting for a lock.</p>

<p style="margin-top: 1em">check_postgres_locks
--host=artemus --warning=200
--critical=&quot;total=250:waiting=5:exclusive=20&quot;</p>

<p style="margin-top: 1em">For MRTG output, returns the
number of locks on the first line, and the name of the
database on the fourth line.</p>

<p style="margin-top: 1em">logfile <br>
(&quot;symlink: check_postgres_logfile&quot;) Ensures that
the logfile is in the expected location and is being logged
to. This action issues a command that throws an error on
each <br>
database it is checking, and ensures that the message shows
up in the logs. It scans the various log_* settings inside
of Postgres to figure out where the logs should be. If you
<br>
are using syslog, it does a rough (but not foolproof) scan
of /etc/syslog.conf. Alternatively, you can provide the name
of the logfile with the --logfile option. This is <br>
especially useful if the logs have a custom rotation scheme
driven be an external program. The --logfile option supports
the following escape characters: &quot;%Y %m %d %H&quot;,
which <br>
represent the current year, month, date, and hour
respectively. An error is always reported as critical unless
the warning option has been passed in as a non-zero value.
Other <br>
than that specific usage, the &quot;--warning&quot; and
&quot;--critical&quot; options should not be used.</p>

<p style="margin-top: 1em">Example 1: On port 5432, ensure
the logfile is being written to the file
/home/greg/pg8.2.log</p>

<p style="margin-top: 1em">check_postgres_logfile
--port=5432 --logfile=/home/greg/pg8.2.log</p>

<p style="margin-top: 1em">Example 2: Same as above, but
raise a warning, not a critical</p>

<p style="margin-top: 1em">check_postgres_logfile
--port=5432 --logfile=/home/greg/pg8.2.log -w 1</p>

<p style="margin-top: 1em">For MRTG output, returns a 1 or
0 on the first line, indicating success or failure. In case
of a failure, the fourth line will provide more detail on
the failure encountered.</p>

<p style="margin-top: 1em">new_version_bc <br>
(&quot;symlink: check_postgres_new_version_bc&quot;) Checks
if a newer version of the Bucardo program is available. The
current version is obtained by running &quot;bucardo_ctl
--version&quot;. If <br>
a major upgrade is available, a warning is returned. If a
revision upgrade is available, a critical is returned.
(Bucardo is a master to slave, and master to master
replication <br>
system for Postgres: see http://bucardo.org for more
information). See also the information on the
&quot;--get_method&quot; option.</p>

<p style="margin-top: 1em">new_version_box <br>
(&quot;symlink: check_postgres_new_version_box&quot;) Checks
if a newer version of the boxinfo program is available. The
current version is obtained by running &quot;boxinfo.pl
--version&quot;. If <br>
a major upgrade is available, a warning is returned. If a
revision upgrade is available, a critical is returned.
(boxinfo is a program for grabbing important information
from a <br>
server and putting it into a HTML format: see
http://bucardo.org/wiki/boxinfo for more information). See
also the information on the &quot;--get_method&quot;
option.</p>

<p style="margin-top: 1em">new_version_cp <br>
(&quot;symlink: check_postgres_new_version_cp&quot;) Checks
if a newer version of this program (check_postgres) is
available, by grabbing the version from a small text file on
the main <br>
page of the home page for the project. Returns a warning if
the returned version does not match the one you are running.
Recommended interval to check is once a day. See also the
<br>
information on the &quot;--get_method&quot; option.</p>

<p style="margin-top: 1em">new_version_pg <br>
(&quot;symlink: check_postgres_new_version_pg&quot;) Checks
if a newer revision of Postgres exists for each database
connected to. Note that this only checks for revision, e.g.
going from <br>
8.3.6 to 8.3.7. Revisions are always 100% binary compatible
and involve no dump and restore to upgrade. Revisions are
made to address bugs, so upgrading as soon as possible is
<br>
always recommended. Returns a warning if you do not have the
latest revision. It is recommended this check is run at
least once a day. See also the information on the <br>
&quot;--get_method&quot; option.</p>

<p style="margin-top: 1em">new_version_tnm <br>
(&quot;symlink: check_postgres_new_version_tnm&quot;) Checks
if a newer version of the tail_n_mail program is available.
The current version is obtained by running &quot;tail_n_mail
--version&quot;. <br>
If a major upgrade is available, a warning is returned. If a
revision upgrade is available, a critical is returned.
(tail_n_mail is a log monitoring tool that can send mail
when <br>
interesting events appear in your Postgres logs. See:
http://bucardo.org/wiki/Tail_n_mail for more information).
See also the information on the &quot;--get_method&quot;
option.</p>

<p style="margin-top: 1em">pgb_pool_cl_active <br>
pgb_pool_cl_waiting <br>
pgb_pool_sv_active <br>
pgb_pool_sv_idle <br>
pgb_pool_sv_used <br>
pgb_pool_sv_tested <br>
pgb_pool_sv_login <br>
pgb_pool_maxwait <br>
(symlinks: &quot;check_postgres_pgb_pool_cl_active&quot;,
&quot;check_postgres_pgb_pool_cl_waiting&quot;,
&quot;check_postgres_pgb_pool_sv_active&quot;,
&quot;check_postgres_pgb_pool_sv_idle&quot;, <br>
&quot;check_postgres_pgb_pool_sv_used&quot;,
&quot;check_postgres_pgb_pool_sv_tested&quot;,
&quot;check_postgres_pgb_pool_sv_login&quot;, and
&quot;check_postgres_pgb_pool_maxwait&quot;)</p>

<p style="margin-top: 1em">Examines pgbouncer&rsquo;s pool
statistics. Each pool has a set of &quot;client&quot;
connections, referring to connections from external clients,
and &quot;server&quot; connections, referring to <br>
connections to PostgreSQL itself. The related check_postgres
actions are prefixed by &quot;cl_&quot; and &quot;sv_&quot;,
respectively. Active client connections are those
connections currently <br>
linked with an active server connection. Client connections
may also be &quot;waiting&quot;, meaning they have not yet
been allocated a server connection. Server connections are
&quot;active&quot; <br>
(linked to a client), &quot;idle&quot; (standing by for a
client connection to link with), &quot;used&quot; (just
unlinked from a client, and not yet returned to the idle
pool), &quot;tested&quot; (currently <br>
being tested) and &quot;login&quot; (in the process of
logging in). The maxwait value shows how long in seconds the
oldest waiting client connection has been waiting.</p>

<p style="margin-top: 1em">pgbouncer_backends <br>
(&quot;symlink: check_postgres_pgbouncer_backends&quot;)
Checks the current number of connections for one or more
databases through pgbouncer, and optionally compares it to
the maximum <br>
allowed, which is determined by the pgbouncer configuration
variable max_client_conn. The --warning and --critical
options can take one of three forms. First, a simple number
can <br>
be given, which represents the number of connections at
which the alert will be given. This choice does not use the
max_connections setting. Second, the percentage of available
<br>
connections can be given. Third, a negative number can be
given which represents the number of connections left until
max_connections is reached. The default values for --warning
<br>
and --critical are &rsquo;90%&rsquo; and &rsquo;95%&rsquo;.
You can also filter the databases by use of the --include
and --exclude options. See the &quot;BASIC FILTERING&quot;
section for more details.</p>

<p style="margin-top: 1em">To view only non-idle processes,
you can use the --noidle argument. Note that the user you
are connecting as must be a superuser for this to work
properly.</p>

<p style="margin-top: 1em">Example 1: Give a warning when
the number of connections on host quirm reaches 120, and a
critical if it reaches 150.</p>


<p style="margin-top: 1em">check_postgres_pgbouncer_backends
--host=quirm --warning=120 --critical=150 -p 6432 -u
pgbouncer</p>

<p style="margin-top: 1em">Example 2: Give a critical when
we reach 75% of our max_connections setting on hosts lancre
or lancre2.</p>


<p style="margin-top: 1em">check_postgres_pgbouncer_backends
--warning=&rsquo;75%&rsquo; --critical=&rsquo;75%&rsquo;
--host=lancre,lancre2 -p 6432 -u pgbouncer</p>

<p style="margin-top: 1em">Example 3: Give a warning when
there are only 10 more connection slots left on host
plasmid, and a critical when we have only 5 left.</p>


<p style="margin-top: 1em">check_postgres_pgbouncer_backends
--warning=-10 --critical=-5 --host=plasmid -p 6432 -u
pgbouncer</p>

<p style="margin-top: 1em">For MRTG output, the number of
connections is reported on the first line, and the fourth
line gives the name of the database, plus the current
max_client_conn. If more than one <br>
database has been queried, the one with the highest number
of connections is output.</p>

<p style="margin-top: 1em">pgbouncer_checksum <br>
(&quot;symlink: check_postgres_pgbouncer_checksum&quot;)
Checks that all the pgBouncer settings are the same as last
time you checked. This is done by generating a checksum of a
sorted <br>
list of setting names and their values. Note that you
shouldn&rsquo;t specify the database name, it will
automatically default to pgbouncer. Either the --warning or
the --critical <br>
option should be given, but not both. The value of each one
is the checksum, a 32-character hexadecimal value. You can
run with the special &quot;--critical=0&quot; option to find
out an <br>
existing checksum.</p>

<p style="margin-top: 1em">This action requires the
Digest::MD5 module.</p>

<p style="margin-top: 1em">Example 1: Find the initial
checksum for pgbouncer configuration on port 6432 using the
default user (usually postgres)</p>


<p style="margin-top: 1em">check_postgres_pgbouncer_checksum
--port=6432 --critical=0</p>

<p style="margin-top: 1em">Example 2: Make sure no settings
have changed and warn if so, using the checksum from
above.</p>


<p style="margin-top: 1em">check_postgres_pgbouncer_checksum
--port=6432 --warning=cd2f3b5e129dc2b4f5c0f6d8d2e64231</p>

<p style="margin-top: 1em">For MRTG output, returns a 1 or
0 indicating success of failure of the checksum to match. A
checksum must be provided as the &quot;--mrtg&quot;
argument. The fourth line always gives the <br>
current checksum.</p>

<p style="margin-top: 1em">pgagent_jobs <br>
(&quot;symlink: check_postgres_pgagent_jobs&quot;) Checks
that all the pgAgent jobs that have executed in the
preceding interval of time have succeeded. This is done by
checking for any <br>
steps that have a non-zero result.</p>

<p style="margin-top: 1em">Either &quot;--warning&quot; or
&quot;--critical&quot;, or both, may be specified as times,
and jobs will be checked for failures withing the specified
periods of time before the current time. Valid <br>
units are seconds, minutes, hours, and days; all can be
abbreviated to the first letter. If no units are given,
&rsquo;seconds&rsquo; are assumed.</p>

<p style="margin-top: 1em">Example 1: Give a critical when
any jobs executed in the last day have failed.</p>

<p style="margin-top: 1em">check_postgres_pgagent_jobs
--critical=1d</p>

<p style="margin-top: 1em">Example 2: Give a warning when
any jobs executed in the last week have failed.</p>

<p style="margin-top: 1em">check_postgres_pgagent_jobs
--warning=7d</p>

<p style="margin-top: 1em">Example 3: Give a critical for
jobs that have failed in the last 2 hours and a warning for
jobs that have failed in the last 4 hours:</p>

<p style="margin-top: 1em">check_postgres_pgagent_jobs
--critical=2h --warning=4h</p>

<p style="margin-top: 1em">prepared_txns <br>
(&quot;symlink: check_postgres_prepared_txns&quot;) Check on
the age of any existing prepared transactions. Note that
most people will NOT use prepared transactions, as they are
part of <br>
two-part commit and complicated to maintain. They should
also not be confused with prepared STATEMENTS, which is what
most people think of when they hear prepare. The default
<br>
value for a warning is 1 second, to detect any use of
prepared transactions, which is probably a mistake on most
systems. Warning and critical are the number of seconds a
<br>
prepared transaction has been open before an alert is
given.</p>

<p style="margin-top: 1em">Example 1: Give a warning on
detecting any prepared transactions:</p>

<p style="margin-top: 1em">check_postgres_prepared_txns -w
0</p>

<p style="margin-top: 1em">Example 2: Give a critical if
any prepared transaction has been open longer than 10
seconds, but allow up to 360 seconds for the database
&rsquo;shrike&rsquo;:</p>

<p style="margin-top: 1em">check_postgres_prepared_txns
--critical=10 --exclude=shrike <br>
check_postgres_prepared_txns --critical=360
--include=shrike</p>

<p style="margin-top: 1em">For MRTG output, returns the
number of seconds the oldest transaction has been open as
the first line, and which database is came from as the final
line.</p>

<p style="margin-top: 1em">query_runtime <br>
(&quot;symlink: check_postgres_query_runtime&quot;) Checks
how long a specific query takes to run, by executing a
&quot;EXPLAIN ANALYZE&quot; against it. The --warning and
--critical options are the <br>
maximum amount of time the query should take. Valid units
are seconds, minutes, and hours; any can be abbreviated to
the first letter. If no units are given,
&rsquo;seconds&rsquo; are <br>
assumed. Both the warning and the critical option must be
given. The name of the view or function to be run must be
passed in to the --queryname option. It must consist of a
<br>
single word (or schema.word), with optional parens at the
end.</p>

<p style="margin-top: 1em">Example 1: Give a critical if
the function named &quot;speedtest&quot; fails to run in 10
seconds or less.</p>

<p style="margin-top: 1em">check_postgres_query_runtime
--queryname=&rsquo;speedtest()&rsquo; --critical=10
--warning=10</p>

<p style="margin-top: 1em">For MRTG output, reports the
time in seconds for the query to complete on the first line.
The fourth line lists the database.</p>

<p style="margin-top: 1em">query_time <br>
(&quot;symlink: check_postgres_query_time&quot;) Checks the
length of running queries on one or more databases. There is
no need to run this more than once on the same database
cluster. <br>
Note that this already excludes queries that are &quot;idle
in transaction&quot;. Databases can be filtered by using the
--include and --exclude options. See the &quot;BASIC
FILTERING&quot; section <br>
for more details. You can also filter on the user running
the query with the --includeuser and --excludeuser options.
See the &quot;USER NAME FILTERING&quot; section for more
details.</p>

<p style="margin-top: 1em">The values for the --warning and
--critical options are amounts of time, and default to
&rsquo;2 minutes&rsquo; and &rsquo;5 minutes&rsquo;
respectively. Valid units are &rsquo;seconds&rsquo;,
&rsquo;minutes&rsquo;, &rsquo;hours&rsquo;, <br>
or &rsquo;days&rsquo;. Each may be written singular or
abbreviated to just the first letter. If no units are given,
the unit is assumed to be seconds.</p>

<p style="margin-top: 1em">This action requires Postgres
8.1 or better.</p>

<p style="margin-top: 1em">Example 1: Give a warning if any
query has been running longer than 3 minutes, and a critical
if longer than 5 minutes.</p>

<p style="margin-top: 1em">check_postgres_query_time
--port=5432 --warning=&rsquo;3 minutes&rsquo;
--critical=&rsquo;5 minutes&rsquo;</p>

<p style="margin-top: 1em">Example 2: Using default values
(2 and 5 minutes), check all databases except those starting
with &rsquo;template&rsquo;.</p>

<p style="margin-top: 1em">check_postgres_query_time
--port=5432 --exclude=~^template</p>

<p style="margin-top: 1em">Example 3: Warn if user
&rsquo;don&rsquo; has a query running over 20 seconds</p>

<p style="margin-top: 1em">check_postgres_query_time
--port=5432 --includeuser=don --warning=20s</p>

<p style="margin-top: 1em">For MRTG output, returns the
length in seconds of the longest running query on the first
line. The fourth line gives the name of the database.</p>

<p style="margin-top: 1em">replicate_row <br>
(&quot;symlink: check_postgres_replicate_row&quot;) Checks
that master-slave replication is working to one or more
slaves.</p>

<p style="margin-top: 1em">The first &quot;--dbname&quot;,
&quot;--host&quot;, and &quot;--port&quot;, etc. options are
considered the master; subsequent uses are the slaves. The
values or the --warning and --critical options are <br>
units of time, and at least one must be provided (no
defaults). Valid units are &rsquo;seconds&rsquo;,
&rsquo;minutes&rsquo;, &rsquo;hours&rsquo;, or
&rsquo;days&rsquo;. Each may be written singular or
abbreviated to just the <br>
first letter. If no units are given, the units are assumed
to be seconds.</p>

<p style="margin-top: 1em">This check updates a single row
on the master, and then measures how long it takes to be
applied to the slaves. To do this, you need to pick a table
that is being replicated, <br>
then find a row that can be changed, and is not going to be
changed by any other process. A specific column of this row
will be changed from one value to another. All of this is
<br>
fed to the &quot;repinfo&quot; option, and should contain
the following options, separated by commas: table name,
primary key, key id, column, first value, second value.</p>

<p style="margin-top: 1em">Example 1: Slony is replicating
a table named &rsquo;orders&rsquo; from host
&rsquo;alpha&rsquo; to host &rsquo;beta&rsquo;, in the
database &rsquo;sales&rsquo;. The primary key of the table
is named id, and we are going to <br>
test the row with an id of 3 (which is historical and never
changed). There is a column named &rsquo;salesrep&rsquo;
that we are going to toggle from a value of
&rsquo;slon&rsquo; to &rsquo;nols&rsquo; to check on <br>
the replication. We want to throw a warning if the
replication does not happen within 10 seconds.</p>

<p style="margin-top: 1em">check_postgres_replicate_row
--host=alpha --dbname=sales --host=beta <br>
--dbname=sales --warning=10
--repinfo=orders,id,3,salesrep,slon,nols</p>

<p style="margin-top: 1em">Example 2: Bucardo is
replicating a table named &rsquo;receipt&rsquo; from host
&rsquo;green&rsquo; to hosts &rsquo;red&rsquo;,
&rsquo;blue&rsquo;, and &rsquo;yellow&rsquo;. The database
for both sides is &rsquo;public&rsquo;. The slave databases
<br>
are running on port 5455. The primary key is named
&rsquo;receipt_id&rsquo;, the row we want to use has a value
of 9, and the column we want to change for the test is
called &rsquo;zone&rsquo;. We&rsquo;ll <br>
toggle between &rsquo;north&rsquo; and &rsquo;south&rsquo;
for the value of this column, and throw a critical if the
change is not on all three slaves within 5 seconds.</p>

<p style="margin-top: 1em">check_postgres_replicate_row
--host=green --port=5455 --host=red,blue,yellow <br>
--critical=5
--repinfo=receipt,receipt_id,9,zone,north,south</p>

<p style="margin-top: 1em">For MRTG output, returns on the
first line the time in seconds the replication takes to
finish. The maximum time is set to 4 minutes 30 seconds: if
no replication has taken <br>
place in that long a time, an error is thrown.</p>

<p style="margin-top: 1em">same_schema <br>
(&quot;symlink: check_postgres_same_schema&quot;) Verifies
that two or more databases are identical as far as their
schema (but not the data within). This is particularly handy
for making <br>
sure your slaves have not been modified or corrupted in any
way when using master to slave replication. Unlike most
other actions, this has no warning or critical criteria -
the <br>
databases are either in sync, or are not. If they are
different, a detailed list of the differences is
presented.</p>

<p style="margin-top: 1em">You may want to exclude or
filter out certain differences. The way to do this is to add
strings to the &quot;--filter&quot; option. To exclude a
type of object, use &quot;noname&quot;, where
&rsquo;name&rsquo; <br>
is the type of object, for example, &quot;noschema&quot;. To
exclude objects of a certain type by a regular expression
against their name, use &quot;noname=regex&quot;. See the
examples below for a <br>
better understanding.</p>

<p style="margin-top: 1em">The types of objects that can be
filtered include:</p>

<p style="margin-top: 1em">user <br>
schema <br>
table <br>
view <br>
index <br>
sequence <br>
constraint <br>
trigger <br>
function</p>

<p style="margin-top: 1em">The filter option
&quot;noposition&quot; prevents verification of the position
of columns within a table.</p>

<p style="margin-top: 1em">The filter option
&quot;nofuncbody&quot; prevents comparison of the bodies of
all functions.</p>

<p style="margin-top: 1em">The filter option
&quot;noperm&quot; prevents comparison of object
permissions.</p>

<p style="margin-top: 1em">To provide the second database,
just append the differences to the first one by a call to
the appropriate connection argument. For example, to compare
databases on hosts alpha <br>
and bravo, use &quot;--dbhost=alpha,bravo&quot;. Also see
the examples below.</p>

<p style="margin-top: 1em">If only a single host is given,
it is assumed we are doing a &quot;time-based&quot; report.
The first time this is run a snapshot of all the items in
the database is saved to a local <br>
file. When you run it again, that snapshot is read in and
becomes &quot;database #2&quot; and is compared to the
current database.</p>

<p style="margin-top: 1em">To replace the old stored file
with the new version, use the --replace argument.</p>

<p style="margin-top: 1em">To enable snapshots at various
points in time, you can use the &quot;--suffix&quot;
argument to make the filenames unique to each run. See the
examples below.</p>

<p style="margin-top: 1em">Example 1: Verify that two
databases on hosts star and line are the same:</p>

<p style="margin-top: 1em">check_postgres_same_schema
--dbhost=star,line</p>

<p style="margin-top: 1em">Example 2: Same as before, but
exclude any triggers with &quot;slony&quot; in their
name</p>

<p style="margin-top: 1em">check_postgres_same_schema
--dbhost=star,line --filter=&quot;notrigger=slony&quot;</p>

<p style="margin-top: 1em">Example 3: Same as before, but
also exclude all indexes</p>

<p style="margin-top: 1em">check_postgres_same_schema
--dbhost=star,line --filter=&quot;notrigger=slony
noindexes&quot;</p>

<p style="margin-top: 1em">Example 4: Check differences for
the database &quot;battlestar&quot; on different ports</p>

<p style="margin-top: 1em">check_postgres_same_schema
--dbname=battlestar --dbport=5432,5544</p>

<p style="margin-top: 1em">Example 5: Create a daily and
weekly snapshot file</p>

<p style="margin-top: 1em">check_postgres_same_schema
--dbname=cylon --suffix=daily <br>
check_postgres_same_schema --dbname=cylon
--suffix=weekly</p>

<p style="margin-top: 1em">Example 6: Run a historical
comparison, then replace the file</p>

<p style="margin-top: 1em">check_postgres_same_schema
--dbname=cylon --suffix=daily --replace</p>

<p style="margin-top: 1em">sequence <br>
(&quot;symlink: check_postgres_sequence&quot;) Checks how
much room is left on all sequences in the database. This is
measured as the percent of total possible values that have
been used <br>
for each sequence. The --warning and --critical options
should be expressed as percentages. The default values are
85% for the warning and 95% for the critical. You may use
<br>
--include and --exclude to control which sequences are to be
checked. Note that this check does account for unusual
minvalue and increment by values, but does not care if the
<br>
sequence is set to cycle or not.</p>

<p style="margin-top: 1em">The output for Nagios gives the
name of the sequence, the percentage used, and the number of
&rsquo;calls&rsquo; left, indicating how many more times
nextval can be called on that sequence <br>
before running into the maximum value.</p>

<p style="margin-top: 1em">The output for MRTG returns the
highest percentage across all sequences on the first line,
and the name of each sequence with that percentage on the
fourth line, separated by a <br>
&quot;|&quot; (pipe) if there are more than one sequence at
that percentage.</p>

<p style="margin-top: 1em">Example 1: Give a warning if any
sequences are approaching 95% full.</p>

<p style="margin-top: 1em">check_postgres_sequence
--dbport=5432 --warning=95%</p>

<p style="margin-top: 1em">Example 2: Check that the
sequence named &quot;orders_id_seq&quot; is not more than
half full.</p>

<p style="margin-top: 1em">check_postgres_sequence
--dbport=5432 --critical=50% --include=orders_id_seq</p>

<p style="margin-top: 1em">settings_checksum <br>
(&quot;symlink: check_postgres_settings_checksum&quot;)
Checks that all the Postgres settings are the same as last
time you checked. This is done by generating a checksum of a
sorted list <br>
of setting names and their values. Note that different users
in the same database may have different checksums, due to
ALTER USER usage, and due to the fact that superusers see
<br>
more settings than ordinary users. Either the --warning or
the --critical option should be given, but not both. The
value of each one is the checksum, a 32-character
hexadecimal <br>
value. You can run with the special &quot;--critical=0&quot;
option to find out an existing checksum.</p>

<p style="margin-top: 1em">This action requires the
Digest::MD5 module.</p>

<p style="margin-top: 1em">Example 1: Find the initial
checksum for the database on port 5555 using the default
user (usually postgres)</p>


<p style="margin-top: 1em">check_postgres_settings_checksum
--port=5555 --critical=0</p>

<p style="margin-top: 1em">Example 2: Make sure no settings
have changed and warn if so, using the checksum from
above.</p>


<p style="margin-top: 1em">check_postgres_settings_checksum
--port=5555 --warning=cd2f3b5e129dc2b4f5c0f6d8d2e64231</p>

<p style="margin-top: 1em">For MRTG output, returns a 1 or
0 indicating success of failure of the checksum to match. A
checksum must be provided as the &quot;--mrtg&quot;
argument. The fourth line always gives the <br>
current checksum.</p>

<p style="margin-top: 1em">slony_status <br>
(&quot;symlink: check_postgres_slony_status&quot;) Checks in
the status of a Slony cluster by looking at the results of
Slony&rsquo;s sl_status view. This is returned as the number
of seconds of <br>
&quot;lag time&quot;. The --warning and --critical options
should be expressed as times. The default values are 60
seconds for the warning and 300 seconds for the
critical.</p>

<p style="margin-top: 1em">The optional argument --schema
indicated the schema that Slony is installed under. If it is
not given, the schema will be determined automatically each
time this check is run.</p>

<p style="margin-top: 1em">Example 1: Give a warning if any
Slony is lagged by more than 20 seconds</p>

<p style="margin-top: 1em">check_postgres_slony_status
--warning 20</p>

<p style="margin-top: 1em">Example 2: Give a critical if
Slony, installed under the schema &quot;_slony&quot;, is
over 10 minutes lagged</p>

<p style="margin-top: 1em">check_postgres_slony_status
--schema=_slony --critical=600</p>

<p style="margin-top: 1em">timesync <br>
(&quot;symlink: check_postgres_timesync&quot;) Compares the
local system time with the time reported by one or more
databases. The --warning and --critical options represent
the number of <br>
seconds between the two systems before an alert is given. If
neither is specified, the default values are used, which are
&rsquo;2&rsquo; and &rsquo;5&rsquo;. The warning value
cannot be greater than <br>
the critical value. Due to the non-exact nature of this
test, values of &rsquo;0&rsquo; or &rsquo;1&rsquo; are not
recommended.</p>

<p style="margin-top: 1em">The string returned shows the
time difference as well as the time on each side written
out.</p>

<p style="margin-top: 1em">Example 1: Check that databases
on hosts ankh, morpork, and klatch are no more than 3
seconds off from the local time:</p>

<p style="margin-top: 1em">check_postgres_timesync
--host=ankh,morpork,klatch --critical=3</p>

<p style="margin-top: 1em">For MRTG output, returns one the
first line the number of seconds difference between the
local time and the database time. The fourth line returns
the name of the database.</p>

<p style="margin-top: 1em">txn_idle <br>
(&quot;symlink: check_postgres_txn_idle&quot;) Checks the
number and duration of &quot;idle in transaction&quot;
queries on one or more databases. There is no need to run
this more than once on the <br>
same database cluster. Databases can be filtered by using
the --include and --exclude options. See the &quot;BASIC
FILTERING&quot; section below for more details.</p>

<p style="margin-top: 1em">The --warning and --critical
options are given as units of time, signed integers, or
integers for units of time, and both must be provided (there
are no defaults). Valid units <br>
are &rsquo;seconds&rsquo;, &rsquo;minutes&rsquo;,
&rsquo;hours&rsquo;, or &rsquo;days&rsquo;. Each may be
written singular or abbreviated to just the first letter. If
no units are given and the numbers are unsigned, the units
<br>
are assumed to be seconds.</p>

<p style="margin-top: 1em">This action requires Postgres
8.3 or better.</p>

<p style="margin-top: 1em">Example 1: Give a warning if any
connection has been idle in transaction for more than 15
seconds:</p>

<p style="margin-top: 1em">check_postgres_txn_idle
--port=5432 --warning=&rsquo;15 seconds&rsquo;</p>

<p style="margin-top: 1em">Example 2: Give a warning if
there are 50 or more transactions</p>

<p style="margin-top: 1em">check_postgres_txn_idle
--port=5432 --warning=&rsquo;+50&rsquo;</p>

<p style="margin-top: 1em">Example 3: Give a critical if 5
or more connections have been idle in transaction for more
than 10 seconds:</p>

<p style="margin-top: 1em">check_postgres_txn_idle
--port=5432 --critical=&rsquo;5 for 10 seconds&rsquo;</p>

<p style="margin-top: 1em">For MRTG output, returns the
time in seconds the longest idle transaction has been
running. The fourth line returns the name of the database
and other information about the <br>
longest transaction.</p>

<p style="margin-top: 1em">txn_time <br>
(&quot;symlink: check_postgres_txn_time&quot;) Checks the
length of open transactions on one or more databases. There
is no need to run this command more than once per database
cluster. <br>
Databases can be filtered by use of the --include and
--exclude options. See the &quot;BASIC FILTERING&quot;
section for more details. The owner of the transaction can
also be filtered, by <br>
use of the --includeuser and --excludeuser options. See the
&quot;USER NAME FILTERING&quot; section for more
details.</p>

<p style="margin-top: 1em">The values or the --warning and
--critical options are units of time, and must be provided
(no default). Valid units are &rsquo;seconds&rsquo;,
&rsquo;minutes&rsquo;, &rsquo;hours&rsquo;, or
&rsquo;days&rsquo;. Each may be <br>
written singular or abbreviated to just the first letter. If
no units are given, the units are assumed to be seconds.</p>

<p style="margin-top: 1em">This action requires Postgres
8.3 or better.</p>

<p style="margin-top: 1em">Example 1: Give a critical if
any transaction has been open for more than 10 minutes:</p>

<p style="margin-top: 1em">check_postgres_txn_time
--port=5432 --critical=&rsquo;10 minutes&rsquo;</p>

<p style="margin-top: 1em">Example 1: Warn if user
&rsquo;warehouse&rsquo; has a transaction open over 30
seconds</p>

<p style="margin-top: 1em">check_postgres_txn_time
--port-5432 --warning=30s --includeuser=warehouse</p>

<p style="margin-top: 1em">For MRTG output, returns the
maximum time in seconds a transaction has been open on the
first line. The fourth line gives the name of the
database.</p>

<p style="margin-top: 1em">txn_wraparound <br>
(&quot;symlink: check_postgres_txn_wraparound&quot;) Checks
how close to transaction wraparound one or more databases
are getting. The --warning and --critical options indicate
the number <br>
of transactions done, and must be a positive integer. If
either option is not given, the default values of 1.3 and
1.4 billion are used. There is no need to run this command
<br>
more than once per database cluster. For a more detailed
discussion of what this number represents and what to do
about it, please visit the page <br>

&lt;http://www.postgresql.org/docs/current/static/routine-vacuuming.html#VACUUM-FOR-WRAPAROUND&gt;</p>

<p style="margin-top: 1em">The warning and critical values
can have underscores in the number for legibility, as Perl
does.</p>

<p style="margin-top: 1em">Example 1: Check the default
values for the localhost database</p>

<p style="margin-top: 1em">check_postgres_txn_wraparound
--host=localhost</p>

<p style="margin-top: 1em">Example 2: Check port 6000 and
give a critical when 1.7 billion transactions are hit:</p>

<p style="margin-top: 1em">check_postgres_txn_wraparound
--port=6000 --critical=1_700_000_000</p>

<p style="margin-top: 1em">For MRTG output, returns the
highest number of transactions for all databases on line
one, while line 4 indicates which database it is.</p>

<p style="margin-top: 1em">version <br>
(&quot;symlink: check_postgres_version&quot;) Checks that
the required version of Postgres is running. The --warning
and --critical options (only one is required) must be of the
format X.Y <br>
or X.Y.Z where X is the major version number, Y is the minor
version number, and Z is the revision.</p>

<p style="margin-top: 1em">Example 1: Give a warning if the
database on port 5678 is not version 8.4.10:</p>

<p style="margin-top: 1em">check_postgres_version
--port=5678 -w=8.4.10</p>

<p style="margin-top: 1em">Example 2: Give a warning if any
databases on hosts valley,grain, or sunshine is not 8.3:</p>

<p style="margin-top: 1em">check_postgres_version -H
valley,grain,sunshine --critical=8.3</p>

<p style="margin-top: 1em">For MRTG output, reports a 1 or
a 0 indicating success or failure on the first line. The
fourth line indicates the current version. The version must
be provided via the &quot;--mrtg&quot; <br>
option.</p>

<p style="margin-top: 1em">wal_files <br>
(&quot;symlink: check_postgres_wal_files&quot;) Checks how
many WAL files exist in the pg_xlog directory, which is
found off of your data_directory, sometimes as a symlink to
another <br>
physical disk for performance reasons. This action must be
run as a superuser, in order to access the contents of the
pg_xlog directory. The minimum version to use this action is
<br>
Postgres 8.1. The --warning and --critical options are
simply the number of files in the pg_xlog directory. What
number to set this to will vary, but a general guideline is
to <br>
put a number slightly higher than what is normally there, to
catch problems early.</p>

<p style="margin-top: 1em">Normally, WAL files are closed
and then re-used, but a long-running open transaction, or a
faulty archive_command script, may cause Postgres to create
too many files. Ultimately, <br>
this will cause the disk they are on to run out of space, at
which point Postgres will shut down.</p>

<p style="margin-top: 1em">Example 1: Check that the number
of WAL files is 20 or less on host &quot;pluto&quot;</p>

<p style="margin-top: 1em">check_postgres_wal_files
--host=pluto --critical=20</p>

<p style="margin-top: 1em">For MRTG output, reports the
number of WAL files on line 1.</p>

<p style="margin-top: 1em">rebuild_symlinks <br>
rebuild_symlinks_force <br>
This action requires no other arguments, and does not
connect to any databases, but simply creates symlinks in the
current directory for each action, in the form <br>
check_postgres_&lt;action_name&gt;. If the file already
exists, it will not be overwritten. If the action is
rebuild_symlinks_force, then symlinks will be overwritten.
The option <br>
--symlinks is a shorter way of saying
--action=rebuild_symlinks</p>

<p style="margin-top: 1em">BASIC FILTERING <br>
The options --include and --exclude can be combined to limit
which things are checked, depending on the action. The name
of the database can be filtered when using the following
<br>
actions: backends, database_size, locks, query_time,
txn_idle, and txn_time. The name of a relation can be
filtered when using the following actions: bloat,
index_size, <br>
table_size, relation_size, last_vacuum, last_autovacuum,
last_analyze, and last_autoanalyze. The name of a setting
can be filtered when using the settings_checksum action. The
<br>
name of a file system can be filtered when using the
disk_space action.</p>

<p style="margin-top: 1em">If only an include option is
given, then ONLY those entries that match will be checked.
However, if given both exclude and include, the exclusion is
done first, and the inclusion <br>
after, to reinstate things that may have been excluded. Both
--include and --exclude can be given multiple times, and/or
as comma-separated lists. A leading tilde will match the
<br>
following word as a regular expression.</p>

<p style="margin-top: 1em">To match a schema, end the
search term with a single period. Leading tildes can be used
for schemas as well.</p>

<p style="margin-top: 1em">Be careful when using filtering:
an inclusion rule on the backends, for example, may report
no problems not only because the matching database had no
backends, but because you <br>
misspelled the name of the database!</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">Only checks items named
pg_class:</p>

<p style="margin-top: 1em">--include=pg_class</p>

<p style="margin-top: 1em">Only checks items containing the
letters &rsquo;pg_&rsquo;:</p>

<p style="margin-top: 1em">--include=~pg_</p>

<p style="margin-top: 1em">Only check items beginning with
&rsquo;pg_&rsquo;:</p>

<p style="margin-top: 1em">--include=~^pg_</p>

<p style="margin-top: 1em">Exclude the item named
&rsquo;test&rsquo;:</p>

<p style="margin-top: 1em">--exclude=test</p>

<p style="margin-top: 1em">Exclude all items containing the
letters &rsquo;test:</p>

<p style="margin-top: 1em">--exclude=~test</p>

<p style="margin-top: 1em">Exclude all items in the schema
&rsquo;pg_catalog&rsquo;:</p>


<p style="margin-top: 1em">--exclude=&rsquo;pg_catalog.&rsquo;</p>

<p style="margin-top: 1em">Exclude all items containing the
letters &rsquo;ace&rsquo;, but allow the item
&rsquo;faceoff&rsquo;:</p>

<p style="margin-top: 1em">--exclude=~ace
--include=faceoff</p>

<p style="margin-top: 1em">Exclude all items which start
with the letters &rsquo;pg_&rsquo;, which contain the
letters &rsquo;slon&rsquo;, or which are named
&rsquo;sql_settings&rsquo; or &rsquo;green&rsquo;.
Specifically check items with the letters <br>
&rsquo;prod&rsquo; in their names, and always check the item
named &rsquo;pg_relname&rsquo;:</p>


<p style="margin-top: 1em">--exclude=~^pg_,~slon,sql_settings
--exclude=green --include=~prod,pg_relname</p>

<p style="margin-top: 1em">USER NAME FILTERING <br>
The options --includeuser and --excludeuser can be used on
some actions to only examine database objects owned by (or
not owned by) one or more users. An --includeuser option
<br>
always trumps an --excludeuser option. You can give each
option more than once for multiple users, or you can give a
comma-separated list. The actions that currently use these
<br>
options are:</p>

<p style="margin-top: 1em">database_size <br>
last_analyze <br>
last_autoanalyze <br>
last_vacuum <br>
last_autovacuum <br>
query_time <br>
relation_size <br>
txn_time</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">Only check items owned by the
user named greg:</p>

<p style="margin-top: 1em">--includeuser=greg</p>

<p style="margin-top: 1em">Only check items owned by either
watson or crick:</p>

<p style="margin-top: 1em">--includeuser=watson,crick</p>

<p style="margin-top: 1em">Only check items owned by
crick,franklin, watson, or wilkins:</p>

<p style="margin-top: 1em">--includeuser=watson
--includeuser=franklin --includeuser=crick,wilkins</p>

<p style="margin-top: 1em">Check all items except for those
belonging to the user scott:</p>

<p style="margin-top: 1em">--excludeuser=scott</p>

<p style="margin-top: 1em">TEST MODE <br>
To help in setting things up, this program can be run in a
&quot;test mode&quot; by specifying the --test option. This
will perform some basic tests to make sure that the
databases can be <br>
contacted, and that certain per-action prerequisites are
met, such as whether the user is a superuser, if the version
of Postgres is new enough, and if stats_row_level is <br>
enabled.</p>

<p style="margin-top: 1em">FILES <br>
In addition to command-line configurations, you can put any
options inside of a file. The file .check_postgresrc in the
current directory will be used if found. If not found, <br>
then the file ~/.check_postgresrc will be used. Finally, the
file /etc/check_postgresrc will be used if available. The
format of the file is option = value, one per line. Any <br>
line starting with a &rsquo;#&rsquo; will be skipped. Any
values loaded from a check_postgresrc file will be
overwritten by command-line options. All check_postgresrc
files can be ignored <br>
by supplying a &quot;--no-checkpostgresrc&quot;
argument.</p>

<p style="margin-top: 1em">ENVIRONMENT VARIABLES <br>
The environment variable $ENV{HOME} is used to look for a
.check_postgresrc file. The environment variable
$ENV{PGBINDIR} is used to look for PostgreSQL binaries.</p>

<p style="margin-top: 1em">TIPS AND TRICKS <br>
Since this program uses the psql program, make sure it is
accessible to the user running the script. If run as a
cronjob, this often means modifying the PATH environment
<br>
variable.</p>

<p style="margin-top: 1em">If you are using Nagios in
embedded Perl mode, use the &quot;--action&quot; argument
instead of symlinks, so that the plugin only gets compiled
one time.</p>

<p style="margin-top: 1em">DEPENDENCIES <br>
Access to a working version of psql, and the following very
standard Perl modules:</p>

<p style="margin-top: 1em">Cwd <br>
Getopt::Long <br>
File::Basename <br>
File::Temp <br>
Time::HiRes (if $opt{showtime} is set to true, which is the
default)</p>

<p style="margin-top: 1em">The
&quot;settings_checksum&quot; action requires the
Digest::MD5 module.</p>

<p style="margin-top: 1em">The &quot;checkpoint&quot;
action requires the Date::Parse module.</p>

<p style="margin-top: 1em">Some actions require access to
external programs. If psql is not explicitly specified, the
command &quot;which&quot; is used to find it. The program
&quot;/bin/df&quot; is needed by the &quot;disk_space&quot;
<br>
action.</p>

<p style="margin-top: 1em">DEVELOPMENT <br>
Development happens using the git system. You can clone the
latest version by doing:</p>

<p style="margin-top: 1em">git clone
git://bucardo.org/check_postgres.git</p>

<p style="margin-top: 1em">MAILING LIST <br>
Three mailing lists are available. For discussions about the
program, bug reports, feature requests, and commit notices,
send email to check_postgres@bucardo.org</p>


<p style="margin-top: 1em">https://mail.endcrypt.com/mailman/listinfo/check_postgres</p>

<p style="margin-top: 1em">A low-volume list for
announcement of new versions and important notices is the
&rsquo;check_postgres-announce&rsquo; list:</p>


<p style="margin-top: 1em">https://mail.endcrypt.com/mailman/listinfo/check_postgres-announce</p>

<p style="margin-top: 1em">Source code changes (via
git-commit) are sent to the
&rsquo;check_postgres-commit&rsquo; list:</p>


<p style="margin-top: 1em">https://mail.endcrypt.com/mailman/listinfo/check_postgres-commit</p>

<p style="margin-top: 1em">HISTORY <br>
Items not specifically attributed are by GSM (Greg Sabino
Mullane).</p>

<p style="margin-top: 1em">Version 2.22.0 June 30, 2015
<br>
Add xact timestamp support to hot_standby_delay. <br>
Allow the hot_standby_delay check to accept xlog byte
position or <br>
timestamp lag intervals as thresholds, or even both at the
same time. <br>
(Josh Williams)</p>

<p style="margin-top: 1em">Query all sequences per DB in
parallel for action=sequence. <br>
(Christoph Berg)</p>

<p style="margin-top: 1em">Fix bloat check to use correct
SQL depending on the server version. <br>
(Adrian Vondendriesch)</p>

<p style="margin-top: 1em">Show actual long-running query
in query_time output <br>
(Peter Eisentraut)</p>

<p style="margin-top: 1em">Add explicit ORDER BY to the
slony_status check to get the most lagged server. <br>
(Jeff Frost)</p>

<p style="margin-top: 1em">Improved multi-slave support in
replicate_row. <br>
(Andrew Yochum)</p>

<p style="margin-top: 1em">Change the way tables are quoted
in replicate_row. <br>
(Glyn Astill)</p>

<p style="margin-top: 1em">Don&rsquo;t swallow space before
the -c flag when reporting errors <br>
(Jeff Janes)</p>

<p style="margin-top: 1em">Fix and extend hot_standby_delay
documentation <br>
(Michael Renner)</p>

<p style="margin-top: 1em">Declare POD encoding to be utf8.
<br>
(Christoph Berg)</p>

<p style="margin-top: 1em">Version 2.21.0 September 24,
2013 <br>
Fix issue with SQL steps in check_pgagent_jobs for sql steps
which perform deletes <br>
(Rob Emery via github pull)</p>

<p style="margin-top: 1em">Install man page in section 1.
<br>
(Peter Eisentraut, bug 53, github issue 26)</p>

<p style="margin-top: 1em">Order lock types in check_locks
output to make the ordering predictable; <br>
setting SKIP_NETWORK_TESTS will skip the new_version tests;
other minor test <br>
suite fixes. <br>
(Christoph Berg)</p>

<p style="margin-top: 1em">Fix same_schema check on 9.3 by
ignoring relminmxid differences in pg_class <br>
(Christoph Berg)</p>

<p style="margin-top: 1em">Version 2.20.1 June 24, 2013
<br>
Make connection check failures return CRITICAL not UNKNOWN
<br>
(Dominic Hargreaves)</p>

<p style="margin-top: 1em">Fix --reverse option when using
string comparisons in custom queries <br>
(Nathaniel Waisbrot)</p>

<p style="margin-top: 1em">Compute correct
&rsquo;totalwastedbytes&rsquo; in the bloat query <br>
(Michael Renner)</p>

<p style="margin-top: 1em">Do not use pg_stats
&quot;inherited&quot; column in bloat query, if the <br>
database is 8.4 or older. (Greg Sabino Mullane, per bug
121)</p>

<p style="margin-top: 1em">Remove host reordering in
hot_standby_delay check <br>
(Josh Williams, with help from Jacobo Blasco)</p>

<p style="margin-top: 1em">Better output for the
&quot;simple&quot; flag <br>
(Greg Sabino Mullane)</p>

<p style="margin-top: 1em">Force same_schema to ignore the
&rsquo;relallvisible&rsquo; column <br>
(Greg Sabino Mullane)</p>

<p style="margin-top: 1em">Version 2.20.0 March 13, 2013
<br>
Add check for pgagent jobs (David E. Wheeler)</p>

<p style="margin-top: 1em">Force STDOUT to use utf8 for
proper output <br>
(Greg Sabino Mullane; reported by Emmanuel Lesouef)</p>

<p style="margin-top: 1em">Fixes for Postgres 9.2: new
pg_stat_activity view, <br>
and use pg_tablespace_location, (Josh Williams)</p>

<p style="margin-top: 1em">Allow for spaces in item lists
when doing same_schema.</p>

<p style="margin-top: 1em">Allow txn_idle to work again for
&lt; 8.3 servers by switching to query_time.</p>

<p style="margin-top: 1em">Fix the check_bloat SQL to take
inherited tables into account, <br>
and assume 2k for non-analyzed columns. (Geert Pante)</p>

<p style="margin-top: 1em">Cache sequence information to
speed up same_schema runs.</p>

<p style="margin-top: 1em">Fix --excludeuser in
check_txn_idle (Mika Eloranta)</p>

<p style="margin-top: 1em">Fix user clause handling in
check_txn_idle (Michael van Bracht)</p>

<p style="margin-top: 1em">Adjust docs to show colon as a
better separator inside args for locks <br>
(Charles Sprickman)</p>

<p style="margin-top: 1em">Fix undefined $SQL2 error in
check_txn_idle [github issue 16] (Patric Bechtel)</p>

<p style="margin-top: 1em">Prevent &quot;uninitialized
value&quot; warnings when showing the port (Henrik
Ahlgren)</p>

<p style="margin-top: 1em">Do not assume everyone has a
HOME [github issue 23]</p>

<p style="margin-top: 1em">Version 2.19.0 January 17, 2012
<br>
Add the --assume-prod option (C&Atilde;&copy;dric
Villemain)</p>

<p style="margin-top: 1em">Add the cluster_id check
(C&Atilde;&copy;dric Villemain)</p>

<p style="margin-top: 1em">Improve settings_checksum and
checkpoint tests (C&Atilde;&copy;dric Villemain)</p>

<p style="margin-top: 1em">Do not do an inner join to
pg_user when checking database size <br>
(Greg Sabino Mullane; reported by Emmanuel Lesouef)</p>

<p style="margin-top: 1em">Use the full path when getting
sequence information for same_schema. <br>
(Greg Sabino Mullane; reported by Cindy Wise)</p>

<p style="margin-top: 1em">Fix the formula for calculating
xlog positions (Euler Taveira de Oliveira)</p>

<p style="margin-top: 1em">Better ordering of output for
bloat check - make indexes as important <br>
as tables (Greg Sabino Mullane; reported by Jens Wilke)</p>

<p style="margin-top: 1em">Show the dbservice if it was
used at top of same_schema output <br>
(Mike Blackwell)</p>

<p style="margin-top: 1em">Better installation paths (Greg
Sabino Mullane, per bug 53)</p>

<p style="margin-top: 1em">Version 2.18.0 October 2, 2011
<br>
Redo the same_schema action. Use new --filter argument for
all filtering. <br>
Allow comparisons between any number of databases. <br>
Remove the dbname2, dbport2, etc. arguments. <br>
Allow comparison of the same db over time.</p>

<p style="margin-top: 1em">Swap db1 and db2 if the slave is
1 for the hot standby check (David E. Wheeler)</p>

<p style="margin-top: 1em">Allow multiple --schema
arguments for the slony_status action (GSM and
Jehan-Guillaume de Rorthais)</p>

<p style="margin-top: 1em">Fix ORDER BY in the last
vacuum/analyze action (Nicolas Thauvin)</p>

<p style="margin-top: 1em">Fix check_hot_standby_delay
perfdata output (Nicolas Thauvin)</p>

<p style="margin-top: 1em">Look in the correct place for
the .ready files with the archive_ready action (Nicolas
Thauvin)</p>

<p style="margin-top: 1em">New action: commitratio
(Guillaume Lelarge)</p>

<p style="margin-top: 1em">New action: hitratio (Guillaume
Lelarge)</p>

<p style="margin-top: 1em">Make sure --action overrides the
symlink naming trick.</p>

<p style="margin-top: 1em">Set defaults for archive_ready
and wal_files (Thomas Guettler, GSM)</p>

<p style="margin-top: 1em">Better output for wal_files and
archive_ready (GSM)</p>

<p style="margin-top: 1em">Fix warning when client_port set
to empty string (bug #79)</p>

<p style="margin-top: 1em">Account for &quot;empty
row&quot; in -x output (i.e. source of functions).</p>

<p style="margin-top: 1em">Fix some incorrectly named data
fields (Andy Lester)</p>

<p style="margin-top: 1em">Expand the number of pgbouncer
actions (Ruslan Kabalin)</p>

<p style="margin-top: 1em">Give detailed information and
refactor txn_idle, txn_time, and query_time <br>
(Per request from bug #61)</p>

<p style="margin-top: 1em">Set maxalign to 8 in the bloat
check if box identified as &rsquo;64-bit&rsquo; <br>
(Michel Sijmons, bug #66)</p>

<p style="margin-top: 1em">Support non-standard version
strings in the bloat check. <br>
(Michel Sijmons and Gurjeet Singh, bug #66)</p>

<p style="margin-top: 1em">Do not show excluded databases
in some output (Ruslan Kabalin)</p>

<p style="margin-top: 1em">Allow &quot;and&quot;,
&quot;or&quot; inside arguments (David E. Wheeler)</p>

<p style="margin-top: 1em">Add the
&quot;new_version_box&quot; action.</p>

<p style="margin-top: 1em">Fix psql version regex (Peter
Eisentraut, bug #69)</p>

<p style="margin-top: 1em">Add the --assume-standby-mode
option (Ruslan Kabalin)</p>

<p style="margin-top: 1em">Note that txn_idle and
query_time require 8.3 (Thomas Guettler)</p>

<p style="margin-top: 1em">Standardize and clean up all
perfdata output (bug #52)</p>

<p style="margin-top: 1em">Exclude &quot;idle in
transaction&quot; from the query_time check (bug #43)</p>

<p style="margin-top: 1em">Fix the perflimit for the bloat
action (bug #50)</p>

<p style="margin-top: 1em">Clean up the custom_query action
a bit.</p>

<p style="margin-top: 1em">Fix space in perfdata for
hot_standby_delay action (Nicolas Thauvin)</p>

<p style="margin-top: 1em">Handle undef percents in
check_fsm_relations (Andy Lester)</p>

<p style="margin-top: 1em">Fix typo in dbstats action (Stas
Vitkovsky)</p>

<p style="margin-top: 1em">Fix MRTG for last vacuum and
last_analyze actions.</p>

<p style="margin-top: 1em">Version 2.17.0 no public release
<br>
Version 2.16.0 January 20, 2011 <br>
Add new action &rsquo;hot_standby_delay&rsquo; (Nicolas
Thauvin) <br>
Add cache-busting for the version-grabbing utilities. <br>
Fix problem with going to next method for new_version_pg
<br>
(Greg Sabino Mullane, reported by Hywel Mallett in bug #65)
<br>
Allow /usr/local/etc as an alternative location for the <br>
check_postgresrc file (Hywel Mallett) <br>
Do not use tgisconstraint in same_schema if Postgres &gt;= 9
<br>
(Guillaume Lelarge)</p>

<p style="margin-top: 1em">Version 2.15.4 January 3, 2011
<br>
Fix warning when using symlinks <br>
(Greg Sabino Mullane, reported by Peter Eisentraut in bug
#63)</p>

<p style="margin-top: 1em">Version 2.15.3 December 30, 2010
<br>
Show OK for no matching txn_idle entries.</p>

<p style="margin-top: 1em">Version 2.15.2 December 28, 2010
<br>
Better formatting of sizes in the bloat action output.</p>

<p style="margin-top: 1em">Remove duplicate perfs in bloat
action output.</p>

<p style="margin-top: 1em">Version 2.15.1 December 27, 2010
<br>
Fix problem when examining items in pg_settings (Greg Sabino
Mullane)</p>

<p style="margin-top: 1em">For connection test, return
critical, not unknown, on FATAL errors <br>
(Greg Sabino Mullane, reported by Peter Eisentraut in bug
#62)</p>

<p style="margin-top: 1em">Version 2.15.0 November 8, 2010
<br>
Add --quiet argument to suppress output on OK Nagios results
<br>
Add index comparison for same_schema (Norman Yamada and Greg
Sabino Mullane) <br>
Use $ENV{PGSERVICE} instead of &quot;service=&quot; to
prevent problems (Guillaume Lelarge) <br>
Add --man option to show the entire manual. (Andy Lester)
<br>
Redo the internal run_command() sub to use -x and hashes
instead of regexes. <br>
Fix error in custom logic (Andreas Mager) <br>
Add the &quot;pgbouncer_checksum&quot; action (Guillaume
Lelarge) <br>
Fix regex to work on WIN32 for check_fsm_relations and
check_fsm_pages (Luke Koops) <br>
Don&rsquo;t apply a LIMIT when using --exclude on the bloat
action (Marti Raudsepp) <br>
Change the output of query_time to show pid,user,port, and
address (Giles Westwood) <br>
Fix to show database properly when using slony_status
(Guillaume Lelarge) <br>
Allow warning items for same_schema to be comma-separated
(Guillaume Lelarge) <br>
Constraint definitions across Postgres versions match better
in same_schema. <br>
Work against &quot;EnterpriseDB&quot; databases (Sivakumar
Krishnamurthy and Greg Sabino Mullane) <br>
Separate perfdata with spaces (Jehan-Guillaume (ioguix) de
Rorthais) <br>
Add new action &quot;archive_ready&quot; (Jehan-Guillaume
(ioguix) de Rorthais)</p>

<p style="margin-top: 1em">Version 2.14.3 (March 1, 2010)
<br>
Allow slony_status action to handle more than one slave.
<br>
Use commas to separate function args in same_schema output
(Robert Treat)</p>

<p style="margin-top: 1em">Version 2.14.2 (February 18,
2010) <br>
Change autovac_freeze default warn/critical back to 90%/95%
(Robert Treat) <br>
Put all items one-per-line for relation size actions if
--verbose=1</p>

<p style="margin-top: 1em">Version 2.14.1 (February 17,
2010) <br>
Don&rsquo;t use $^T in logfile check, as script may be
long-running <br>
Change the error string for the logfile action for easier
exclusion <br>
by programs like tail_n_mail</p>

<p style="margin-top: 1em">Version 2.14.0 (February 11,
2010) <br>
Added the &rsquo;slony_status&rsquo; action. <br>
Changed the logfile sleep from 0.5 to 1, as 0.5 gets rounded
to 0 on some boxes!</p>

<p style="margin-top: 1em">Version 2.13.2 (February 4,
2010) <br>
Allow timeout option to be used for logtime
&rsquo;sleep&rsquo; time.</p>

<p style="margin-top: 1em">Version 2.13.2 (February 4,
2010) <br>
Show offending database for query_time action. <br>
Apply perflimit to main output for sequence action. <br>
Add &rsquo;noowner&rsquo; option to same_schema action. <br>
Raise sleep timeout for logfile check to 15 seconds.</p>

<p style="margin-top: 1em">Version 2.13.1 (February 2,
2010) <br>
Fix bug preventing column constraint differences from 2 &gt;
1 for same_schema from being shown. <br>
Allow aliases &rsquo;dbname1&rsquo;, &rsquo;dbhost1&rsquo;,
&rsquo;dbport1&rsquo;,etc. <br>
Added &quot;nolanguage&quot; as a filter for the same_schema
option. <br>
Don&rsquo;t track &quot;generic&quot; table constraints (e..
$1, $2) using same_schema</p>

<p style="margin-top: 1em">Version 2.13.0 (January 29,
2010) <br>
Allow &quot;nofunctions&quot; as a filter for the
same_schema option. <br>
Added &quot;noperm&quot; as a filter for the same_schema
option. <br>
Ignore dropped columns when considered positions for
same_schema (Guillaume Lelarge)</p>

<p style="margin-top: 1em">Version 2.12.1 (December 3,
2009) <br>
Change autovac_freeze default warn/critical from 90%/95% to
105%/120% (Marti Raudsepp)</p>

<p style="margin-top: 1em">Version 2.12.0 (December 3,
2009) <br>
Allow the temporary directory to be specified via the
&quot;tempdir&quot; argument, <br>
for systems that need it (e.g. /tmp is not owned by root).
<br>
Fix so old versions of Postgres (&lt; 8.0) use the correct
default database (Giles Westwood) <br>
For &quot;same_schema&quot; trigger mismatches, show the
attached table. <br>
Add the new_version_bc check for Bucardo version checking.
<br>
Add database name to perf output for last_vacuum|analyze
(Guillaume Lelarge) <br>
Fix for bloat action against old versions of Postgres
without the &rsquo;block_size&rsquo; param.</p>

<p style="margin-top: 1em">Version 2.11.1 (August 27, 2009)
<br>
Proper Nagios output for last_vacuum|analyze actions.
(C&Atilde;&copy;dric Villemain) <br>
Proper Nagios output for locks action. (C&Atilde;&copy;dric
Villemain) <br>
Proper Nagios output for txn_wraparound action.
(C&Atilde;&copy;dric Villemain) <br>
Fix for constraints with embedded newlines for same_schema.
<br>
Allow --exclude for all items when using same_schema.</p>

<p style="margin-top: 1em">Version 2.11.0 (August 23, 2009)
<br>
Add Nagios perf output to the wal_files check
(C&Atilde;&copy;dric Villemain) <br>
Add support for .check_postgresrc, per request from Albe
Laurenz. <br>
Allow list of web fetch methods to be changed with the
--get_method option. <br>
Add support for the --language argument, which overrides any
ENV. <br>
Add the --no-check_postgresrc flag. <br>
Ensure check_postgresrc options are completely overridden by
command-line options. <br>
Fix incorrect warning &gt; critical logic in replicate_rows
(Glyn Astill)</p>

<p style="margin-top: 1em">Version 2.10.0 (August 3, 2009)
<br>
For same_schema, compare view definitions, and compare
languages. <br>
Make script into a global executable via the Makefile.PL
file. <br>
Better output when comparing two databases. <br>
Proper Nagios output syntax for autovac_freeze and backends
checks (C&Atilde;&copy;dric Villemain)</p>

<p style="margin-top: 1em">Version 2.9.5 (July 24, 2009)
<br>
Don&rsquo;t use a LIMIT in check_bloat if --include is used.
Per complaint from Jeff Frost.</p>

<p style="margin-top: 1em">Version 2.9.4 (July 21, 2009)
<br>
More French translations (Guillaume Lelarge)</p>

<p style="margin-top: 1em">Version 2.9.3 (July 14, 2009)
<br>
Quote dbname in perf output for the backends check. (Davide
Abrigo) <br>
Add &rsquo;fetch&rsquo; as an alternative method for
new_version checks, as this <br>
comes by default with FreeBSD. (Hywel Mallett)</p>

<p style="margin-top: 1em">Version 2.9.2 (July 12, 2009)
<br>
Allow dots and dashes in database name for the backends
check (Davide Abrigo) <br>
Check and display the database for each match in the bloat
check (C&Atilde;&copy;dric Villemain) <br>
Handle &rsquo;too many connections&rsquo; FATAL error in the
backends check with a critical, <br>
rather than a generic error (Greg, idea by
J&Atilde;&frac14;rgen Schulz-Br&Atilde;&frac14;ssel) <br>
Do not allow perflimit to interfere with exclusion rules in
the vacuum and <br>
analyze tests. (Greg, bug reported by Jeff Frost)</p>

<p style="margin-top: 1em">Version 2.9.1 (June 12, 2009)
<br>
Fix for multiple databases with the check_bloat action (Mark
Kirkwood) <br>
Fixes and improvements to the same_schema action (Jeff Boes)
<br>
Write tests for same_schema, other minor test fixes (Jeff
Boes)</p>

<p style="margin-top: 1em">Version 2.9.0 (May 28, 2009)
<br>
Added the same_schema action (Greg)</p>

<p style="margin-top: 1em">Version 2.8.1 (May 15, 2009)
<br>
Added timeout via statement_timeout in addition to perl
alarm (Greg)</p>

<p style="margin-top: 1em">Version 2.8.0 (May 4, 2009) <br>
Added internationalization support (Greg) <br>
Added the &rsquo;disabled_triggers&rsquo; check (Greg) <br>
Added the &rsquo;prepared_txns&rsquo; check (Greg) <br>
Added the &rsquo;new_version_cp&rsquo; and
&rsquo;new_version_pg&rsquo; checks (Greg) <br>
French translations (Guillaume Lelarge) <br>
Make the backends search return ok if no matches due to
inclusion rules, <br>
per report by Guillaume Lelarge (Greg) <br>
Added comprehensive unit tests (Greg, Jeff Boes, Selena
Deckelmann) <br>
Make fsm_pages and fsm_relations handle 8.4 servers
smoothly. (Greg) <br>
Fix missing &rsquo;upd&rsquo; field in show_dbstats (Andras
Fabian) <br>
Allow ENV{PGCONTROLDATA} and ENV{PGBINDIR}. (Greg) <br>
Add various Perl module infrastructure (e.g. Makefile.PL)
(Greg) <br>
Fix incorrect regex in txn_wraparound (Greg) <br>
For txn_wraparound: consistent ordering and fix duplicates
in perf output (Andras Fabian) <br>
Add in missing exabyte regex check (Selena Deckelmann) <br>
Set stats to zero if we bail early due to USERWHERECLAUSE
(Andras Fabian) <br>
Add additional items to dbstats output (Andras Fabian) <br>
Remove --schema option from the fsm_ checks. (Greg Mullane
and Robert Treat) <br>
Handle case when ENV{PGUSER} is set. (Andy Lester) <br>
Many various fixes. (Jeff Boes) <br>
Fix --dbservice: check version and use ENV{PGSERVICE} for
old versions (C&Atilde;&copy;dric Villemain)</p>

<p style="margin-top: 1em">Version 2.7.3 (February 10,
2009) <br>
Make the sequence action check if sequence being used for a
int4 column and <br>
react appropriately. (Michael Glaesemann)</p>

<p style="margin-top: 1em">Version 2.7.2 (February 9, 2009)
<br>
Fix to prevent multiple groupings if db arguments given.</p>

<p style="margin-top: 1em">Version 2.7.1 (February 6, 2009)
<br>
Allow the -p argument for port to work again.</p>

<p style="margin-top: 1em">Version 2.7.0 (February 4, 2009)
<br>
Do not require a connection argument, but use defaults and
ENV variables when <br>
possible: PGHOST, PGPORT, PGUSER, PGDATABASE.</p>

<p style="margin-top: 1em">Version 2.6.1 (February 4, 2009)
<br>
Only require Date::Parse to be loaded if using the
checkpoint action.</p>

<p style="margin-top: 1em">Version 2.6.0 (January 26, 2009)
<br>
Add the &rsquo;checkpoint&rsquo; action.</p>

<p style="margin-top: 1em">Version 2.5.4 (January 7, 2009)
<br>
Better checking of $opt{dbservice} structure
(C&Atilde;&copy;dric Villemain) <br>
Fix time display in timesync action output (Selena
Deckelmann) <br>
Fix documentation typos (Josh Tolley)</p>

<p style="margin-top: 1em">Version 2.5.3 (December 17,
2008) <br>
Minor fix to regex in verify_version (Lee Jensen)</p>

<p style="margin-top: 1em">Version 2.5.2 (December 16,
2008) <br>
Minor documentation tweak.</p>

<p style="margin-top: 1em">Version 2.5.1 (December 11,
2008) <br>
Add support for --noidle flag to prevent backends action
from counting idle processes. <br>
Patch by Selena Deckelmann.</p>

<p style="margin-top: 1em">Fix small undefined warning when
not using --dbservice.</p>

<p style="margin-top: 1em">Version 2.5.0 (December 4, 2008)
<br>
Add support for the pg_Service.conf file with the
--dbservice option.</p>

<p style="margin-top: 1em">Version 2.4.3 (November 7, 2008)
<br>
Fix options for replicate_row action, per report from Jason
Gordon.</p>

<p style="margin-top: 1em">Version 2.4.2 (November 6, 2008)
<br>
Wrap File::Temp::cleanup() calls in eval, in case File::Temp
is an older version. <br>
Patch by Chris Butler.</p>

<p style="margin-top: 1em">Version 2.4.1 (November 5, 2008)
<br>
Cast numbers to numeric to support sequences ranges &gt;
bigint in check_sequence action. <br>
Thanks to Scott Marlowe for reporting this.</p>

<p style="margin-top: 1em">Version 2.4.0 (October 26, 2008)
<br>
Add Cacti support with the dbstats action. <br>
Pretty up the time output for last vacuum and analyze
actions. <br>
Show the percentage of backends on the check_backends
action.</p>

<p style="margin-top: 1em">Version 2.3.10 (October 23,
2008) <br>
Fix minor warning in action check_bloat with multiple
databases. <br>
Allow warning to be greater than critical when using the
--reverse option. <br>
Support the --perflimit option for the check_sequence
action.</p>

<p style="margin-top: 1em">Version 2.3.9 (October 23, 2008)
<br>
Minor tweak to way we store the default port.</p>

<p style="margin-top: 1em">Version 2.3.8 (October 21, 2008)
<br>
Allow the default port to be changed easily. <br>
Allow transform of simple output by MB, GB, etc.</p>

<p style="margin-top: 1em">Version 2.3.7 (October 14, 2008)
<br>
Allow multiple databases in &rsquo;sequence&rsquo; action.
Reported by Christoph Zwerschke.</p>

<p style="margin-top: 1em">Version 2.3.6 (October 13, 2008)
<br>
Add missing $schema to check_fsm_pages. (Robert Treat)</p>

<p style="margin-top: 1em">Version 2.3.5 (October 9, 2008)
<br>
Change option &rsquo;checktype&rsquo; to
&rsquo;valtype&rsquo; to prevent collisions with -c[ritical]
<br>
Better handling of errors.</p>

<p style="margin-top: 1em">Version 2.3.4 (October 9, 2008)
<br>
Do explicit cleanups of the temp directory, per problems
reported by sb@nnx.com.</p>

<p style="margin-top: 1em">Version 2.3.3 (October 8, 2008)
<br>
Account for cases where some rounding queries give -0
instead of 0. <br>
Thanks to Glyn Astill for helping to track this down.</p>

<p style="margin-top: 1em">Version 2.3.2 (October 8, 2008)
<br>
Always quote identifiers in check_replicate_row action.</p>

<p style="margin-top: 1em">Version 2.3.1 (October 7, 2008)
<br>
Give a better error if one of the databases cannot be
reached.</p>

<p style="margin-top: 1em">Version 2.3.0 (October 4, 2008)
<br>
Add the &quot;sequence&quot; action, thanks to Gavin M. Roy
for the idea. <br>
Fix minor problem with autovac_freeze action when using MRTG
output. <br>
Allow output argument to be case-insensitive. <br>
Documentation fixes.</p>

<p style="margin-top: 1em">Version 2.2.4 (October 3, 2008)
<br>
Fix some minor typos</p>

<p style="margin-top: 1em">Version 2.2.3 (October 1, 2008)
<br>
Expand range of allowed names for --repinfo argument (Glyn
Astill) <br>
Documentation tweaks.</p>

<p style="margin-top: 1em">Version 2.2.2 (September 30,
2008) <br>
Fixes for minor output and scoping problems.</p>

<p style="margin-top: 1em">Version 2.2.1 (September 28,
2008) <br>
Add MRTG output to fsm_pages and fsm_relations. <br>
Force error messages to one-line for proper Nagios output.
<br>
Check for invalid prereqs on failed command. From
conversations with Euler Taveira de Oliveira. <br>
Tweak the fsm_pages formula a little.</p>

<p style="margin-top: 1em">Version 2.2.0 (September 25,
2008) <br>
Add fsm_pages and fsm_relations actions. (Robert Treat)</p>

<p style="margin-top: 1em">Version 2.1.4 (September 22,
2008) <br>
Fix for race condition in txn_time action. <br>
Add --debugoutput option.</p>

<p style="margin-top: 1em">Version 2.1.3 (September 22,
2008) <br>
Allow alternate arguments &quot;dbhost&quot; for
&quot;host&quot; and &quot;dbport&quot; for
&quot;port&quot;. <br>
Output a zero as default value for second line of MRTG
output.</p>

<p style="margin-top: 1em">Version 2.1.2 (July 28, 2008)
<br>
Fix sorting error in the &quot;disk_space&quot; action for
non-Nagios output. <br>
Allow --simple as a shortcut for --output=simple.</p>

<p style="margin-top: 1em">Version 2.1.1 (July 22, 2008)
<br>
Don&rsquo;t check databases with datallowconn false for the
&quot;autovac_freeze&quot; action.</p>

<p style="margin-top: 1em">Version 2.1.0 (July 18, 2008)
<br>
Add the &quot;autovac_freeze&quot; action, thanks to Robert
Treat for the idea and design. <br>
Put an ORDER BY on the &quot;txn_wraparound&quot;
action.</p>

<p style="margin-top: 1em">Version 2.0.1 (July 16, 2008)
<br>
Optimizations to speed up the &quot;bloat&quot; action quite
a bit. <br>
Fix &quot;version&quot; action to not always output in mrtg
mode.</p>

<p style="margin-top: 1em">Version 2.0.0 (July 15, 2008)
<br>
Add support for MRTG and &quot;simple&quot; output options.
<br>
Many small improvements to nearly all actions.</p>

<p style="margin-top: 1em">Version 1.9.1 (June 24, 2008)
<br>
Fix an error in the bloat SQL in 1.9.0 <br>
Allow percentage arguments to be over 99% <br>
Allow percentages in the bloat --warning and --critical
(thanks to Robert Treat for the idea)</p>

<p style="margin-top: 1em">Version 1.9.0 (June 22, 2008)
<br>
Don&rsquo;t include information_schema in certain checks.
(Jeff Frost) <br>
Allow --include and --exclude to use schemas by using a
trailing period.</p>

<p style="margin-top: 1em">Version 1.8.5 (June 22, 2008)
<br>
Output schema name before table name where appropriate. <br>
Thanks to Jeff Frost.</p>

<p style="margin-top: 1em">Version 1.8.4 (June 19, 2008)
<br>
Better detection of problems in --replicate_row.</p>

<p style="margin-top: 1em">Version 1.8.3 (June 18, 2008)
<br>
Fix &rsquo;backends&rsquo; action: there may be no rows in
pg_stat_activity, so run a second <br>
query if needed to find the max_connections setting. <br>
Thanks to Jeff Frost for the bug report.</p>

<p style="margin-top: 1em">Version 1.8.2 (June 10, 2008)
<br>
Changes to allow working under Nagios&rsquo; embedded Perl
mode. (Ioannis Tambouras)</p>

<p style="margin-top: 1em">Version 1.8.1 (June 9, 2008)
<br>
Allow &rsquo;bloat&rsquo; action to work on Postgres version
8.0. <br>
Allow for different commands to be run for each action
depending on the server version. <br>
Give better warnings when running actions not available on
older Postgres servers.</p>

<p style="margin-top: 1em">Version 1.8.0 (June 3, 2008)
<br>
Add the --reverse option to the custom_query action.</p>

<p style="margin-top: 1em">Version 1.7.1 (June 2, 2008)
<br>
Fix &rsquo;query_time&rsquo; action: account for race
condition in which zero rows appear in pg_stat_activity.
<br>
Thanks to Dustin Black for the bug report.</p>

<p style="margin-top: 1em">Version 1.7.0 (May 11, 2008)
<br>
Add --replicate_row action</p>

<p style="margin-top: 1em">Version 1.6.1 (May 11, 2008)
<br>
Add --symlinks option as a shortcut to
--action=rebuild_symlinks</p>

<p style="margin-top: 1em">Version 1.6.0 (May 11, 2008)
<br>
Add the custom_query action.</p>

<p style="margin-top: 1em">Version 1.5.2 (May 2, 2008) <br>
Fix problem with too eager creation of custom pgpass
file.</p>

<p style="margin-top: 1em">Version 1.5.1 (April 17, 2008)
<br>
Add example Nagios configuration settings (Brian A.
Seklecki)</p>

<p style="margin-top: 1em">Version 1.5.0 (April 16, 2008)
<br>
Add the --includeuser and --excludeuser options.
Documentation cleanup.</p>

<p style="margin-top: 1em">Version 1.4.3 (April 16, 2008)
<br>
Add in the &rsquo;output&rsquo; concept for future support
of non-Nagios programs.</p>

<p style="margin-top: 1em">Version 1.4.2 (April 8, 2008)
<br>
Fix bug preventing --dbpass argument from working (Robert
Treat).</p>

<p style="margin-top: 1em">Version 1.4.1 (April 4, 2008)
<br>
Minor documentation fixes.</p>

<p style="margin-top: 1em">Version 1.4.0 (April 2, 2008)
<br>
Have &rsquo;wal_files&rsquo; action use pg_ls_dir (idea by
Robert Treat). <br>
For last_vacuum and last_analyze, respect autovacuum
effects, add separate <br>
autovacuum checks (ideas by Robert Treat).</p>

<p style="margin-top: 1em">Version 1.3.1 (April 2, 2008)
<br>
Have txn_idle use query_start, not xact_start.</p>

<p style="margin-top: 1em">Version 1.3.0 (March 23, 2008)
<br>
Add in txn_idle and txn_time actions.</p>

<p style="margin-top: 1em">Version 1.2.0 (February 21,
2008) <br>
Add the &rsquo;wal_files&rsquo; action, which counts the
number of WAL files <br>
in your pg_xlog directory. <br>
Fix some typos in the docs. <br>
Explicitly allow -v as an argument. <br>
Allow for a null syslog_facility in the
&rsquo;logfile&rsquo; action.</p>

<p style="margin-top: 1em">Version 1.1.2 (February 5, 2008)
<br>
Fix error preventing --action=rebuild_symlinks from
working.</p>

<p style="margin-top: 1em">Version 1.1.1 (February 3, 2008)
<br>
Switch vacuum and analyze date output to use
&rsquo;DD&rsquo;, not &rsquo;D&rsquo;. (Glyn Astill)</p>

<p style="margin-top: 1em">Version 1.1.0 (December 16,
2008) <br>
Fixes, enhancements, and performance tracking. <br>
Add performance data tracking via --showperf and --perflimit
<br>
Lots of refactoring and cleanup of how actions handle
arguments. <br>
Do basic checks to figure out syslog file for
&rsquo;logfile&rsquo; action. <br>
Allow for exact matching of beta versions with
&rsquo;version&rsquo; action. <br>
Redo the default arguments to only populate when neither
&rsquo;warning&rsquo; nor &rsquo;critical&rsquo; is
provided. <br>
Allow just warning OR critical to be given for the
&rsquo;timesync&rsquo; action. <br>
Remove &rsquo;redirect_stderr&rsquo; requirement from
&rsquo;logfile&rsquo; due to 8.3 changes. <br>
Actions &rsquo;last_vacuum&rsquo; and
&rsquo;last_analyze&rsquo; are 8.2 only (Robert Treat)</p>

<p style="margin-top: 1em">Version 1.0.16 (December 7,
2007) <br>
First public release, December 2007</p>

<p style="margin-top: 1em">BUGS AND LIMITATIONS <br>
The index bloat size optimization is rough.</p>

<p style="margin-top: 1em">Some actions may not work on
older versions of Postgres (before 8.0).</p>

<p style="margin-top: 1em">Please report any problems to
check_postgres@bucardo.org</p>

<p style="margin-top: 1em">AUTHOR <br>
Greg Sabino Mullane &lt;greg@endpoint.com&gt;</p>

<p style="margin-top: 1em">NAGIOS EXAMPLES <br>
Some example Nagios configuration settings using this
script:</p>

<p style="margin-top: 1em">define command { <br>
command_name check_postgres_size <br>
command_line $USER2$/check_postgres -H $HOSTADDRESS$ -u
pgsql -db postgres --action database_size -w $ARG1$ -c
$ARG2$ <br>
}</p>

<p style="margin-top: 1em">define command { <br>
command_name check_postgres_locks <br>
command_line $USER2$/check_postgres -H $HOSTADDRESS$ -u
pgsql -db postgres --action locks -w $ARG1$ -c $ARG2$ <br>
}</p>

<p style="margin-top: 1em">define service { <br>
use generic-other <br>
host_name dbhost.gtld <br>
service_description dbhost PostgreSQL Service Database Usage
Size <br>
check_command check_postgres_size!256000000!512000000 <br>
}</p>

<p style="margin-top: 1em">define service { <br>
use generic-other <br>
host_name dbhost.gtld <br>
service_description dbhost PostgreSQL Service Database Locks
<br>
check_command check_postgres_locks!2!3 <br>
}</p>

<p style="margin-top: 1em">LICENSE AND COPYRIGHT <br>
Copyright (c) 2007-2015 Greg Sabino Mullane
&lt;greg@endpoint.com&gt;.</p>

<p style="margin-top: 1em">Redistribution and use in source
and binary forms, with or without modification, are
permitted provided that the following conditions are
met:</p>

<p style="margin-top: 1em">1. Redistributions of source
code must retain the above copyright notice, <br>
this list of conditions and the following disclaimer. <br>
2. Redistributions in binary form must reproduce the above
copyright notice, <br>
this list of conditions and the following disclaimer in the
documentation <br>
and/or other materials provided with the distribution.</p>

<p style="margin-top: 1em">THIS SOFTWARE IS PROVIDED BY THE
AUTHOR &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED
WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A <br>
PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
NOT <br>
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
<br>
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.</p>

<p style="margin-top: 1em">perl v5.22.2 2016-09-22
CHECK_POSTGRES(1p)</p>
<hr>
</body>
</html>
