<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>VARNISHTOP(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">VARNISHTOP(1)</td>
    <td class="head-vol"></td>
    <td class="head-rtitle">VARNISHTOP(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
varnishtop - Varnish log entry ranking
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
varnishtop [-1] [-b] [-c] [-C] [-d] [-f] [-g &lt;session|request|vxid|raw&gt;]
  [-h] [-i &lt;taglist&gt;] [-I &lt;[taglist:]regex&gt;] [-L &lt;limit&gt;] [-n
  &lt;dir&gt;] [-N &lt;filename&gt;] [-p &lt;period&gt;] [-q &lt;query&gt;] [-r
  &lt;filename&gt;] [-t &lt;seconds|off&gt;] [-T &lt;seconds&gt;] [-x
  &lt;taglist&gt;] [-X &lt;[taglist:]regex&gt;] [-V]
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
The varnishtop utility reads <i>varnishd(1)</i> shared memory logs and presents
  a continuously updated list of the most commonly occurring log entries. With
  suitable filtering using the <b>-I</b>, <b>-i</b>, <b>-X</b> and <b>-x</b>
  options, it can be used to display a ranking of requested documents, clients,
  user agents, or any other information which is recorded in the log.
<div style="height: 1.00em;">&#x00A0;</div>
The following options are available:
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>-1</b></dt>
  <dd class="It-tag">Instead of a continuously updated display, print the
      statistics once and exit. Implies <b>-d</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-b</b></dt>
  <dd class="It-tag">Only display transactions and log records coming from
      backend communication.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-c</b></dt>
  <dd class="It-tag">Only display transactions and log records coming from
      client communication.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-C</b></dt>
  <dd class="It-tag">Do all regular expression and string matching
    caseless.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-d</b></dt>
  <dd class="It-tag">Process log records at the head of the log and exit.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-f</b></dt>
  <dd class="It-tag">Sort and group only on the first field of each log entry.
      This is useful when displaying e.g. stataddr entries, where the first
      field is the client IP address.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-g</b><i>&#x00A0;&lt;session|request|vxid|raw&gt;</i></dt>
  <dd class="It-tag">The grouping of the log records. The default is to group by
      vxid.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-h</b></dt>
  <dd class="It-tag">Print program usage and exit</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-i</b><i>&#x00A0;&lt;taglist&gt;</i></dt>
  <dd class="It-tag">Include log records of these tags in output. Taglist is a
      comma-separated list of tag globs. Multiple -i options may be given.
    <div style="height: 1.00em;">&#x00A0;</div>
    If a tag include option is the first of any tag selection options, all tags
      are first marked excluded.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-I</b><i>&#x00A0;&lt;[taglist:]regex&gt;</i></dt>
  <dd class="It-tag">Include by regex matching. Output only records matching
      taglist and regular expression. Applies to any tag if taglist is absent.
    <div style="height: 1.00em;">&#x00A0;</div>
    If a tag include option is the first of any tag selection options, all tags
      are first marked excluded.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-L</b><i>&#x00A0;&lt;limit&gt;</i></dt>
  <dd class="It-tag">Sets the upper limit of incomplete transactions kept before
      the oldest transaction is force completed. A warning record is synthesized
      when this happens. This setting keeps an upper bound on the memory usage
      of running queries. Defaults to 1000 transactions.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-n</b><i>&#x00A0;&lt;dir&gt;</i></dt>
  <dd class="It-tag">Specify the varnishd working directory (also known as
      instance name) to get logs from. If -n is not specified, the host name is
      used.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-N</b><i>&#x00A0;&lt;filename&gt;</i></dt>
  <dd class="It-tag">Specify the filename of a stale VSM instance. When using
      this option the abandonment checking is disabled.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-p</b><i>&#x00A0;&lt;period&gt;</i></dt>
  <dd class="It-tag">Specified the number of seconds to measure over, the
      default is 60 seconds. The first number in the list is the average number
      of requests seen over this time period. This option has no effect if -1
      option is also used.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-q</b><i>&#x00A0;&lt;query&gt;</i></dt>
  <dd class="It-tag">Specifies the VSL query to use.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-r</b><i>&#x00A0;&lt;filename&gt;</i></dt>
  <dd class="It-tag">Read log in binary file format from this file. The file can
      be created with <b>varnishlog -w filename</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-t</b><i>&#x00A0;&lt;seconds|off&gt;</i></dt>
  <dd class="It-tag">Timeout before returning error on initial VSM connection.
      If set the VSM connection is retried every 0.5 seconds for this many
      seconds. If zero the connection is attempted only once and will fail
      immediately if unsuccessful. If set to &quot;off&quot;, the connection
      will not fail, allowing the utility to start and wait indefinetely for the
      Varnish instance to appear. Defaults to 5 seconds.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-T</b><i>&#x00A0;&lt;seconds&gt;</i></dt>
  <dd class="It-tag">Sets the transaction timeout in seconds. This defines the
      maximum number of seconds elapsed between a Begin tag and the End tag. If
      the timeout expires, a warning record is synthesized and the transaction
      is force completed. Defaults to 120 seconds.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-x</b><i>&#x00A0;&lt;taglist&gt;</i></dt>
  <dd class="It-tag">Exclude log records of these tags in output. Taglist is a
      comma-separated list of tag globs. Multiple -x options may be given.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-X</b><i>&#x00A0;&lt;[taglist:]regex&gt;</i></dt>
  <dd class="It-tag">Exclude by regex matching. Do not output records matching
      taglist and regular expression. Applies to any tag if taglist is
    absent.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-V</b></dt>
  <dd class="It-tag">Print version information and exit.</dd>
</dl>
</div>
<br/>
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
The following example displays a continuously updated list of the most
  frequently requested URLs:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
varnishtop -i ReqURL
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The following example displays a continuously updated list of the most commonly
  used user agents:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
varnishtop -C -I ReqHeader:User-Agent
</pre>
</div>
<br/>
</div>
<br/>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>varnishd(1)</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>varnishhist(1)</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>varnishlog(1)</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>varnishncsa(1)</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>varnishstat(1)</i></dd>
</dl>
</div>
<br/>
<h1 class="Sh" title="Sh" id="HISTORY"><a class="selflink" href="#HISTORY">HISTORY</a></h1>
The varnishtop utility was originally developed by Poul-Henning Kamp in
  cooperation with Verdens Gang AS and Varnish Software AS, and later
  substantially rewritten by Dag-Erling Sm&#x00F8;rgrav. This manual page was
  written by Dag-Erling Sm&#x00F8;rgrav, and later updated by Martin Blix
  Grydeland.
<h1 class="Sh" title="Sh" id="COPYRIGHT"><a class="selflink" href="#COPYRIGHT">COPYRIGHT</a></h1>
This document is licensed under the same licence as Varnish itself. See LICENCE
  for details.
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Copyright (c) 2006 Verdens Gang AS</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Copyright (c) 2006-2015 Varnish Software AS</dd>
</dl>
</div>
<br/>
</div>
<table class="foot">
  <tr>
    <td class="foot-date"></td>
    <td class="foot-os"></td>
  </tr>
</table>
</body>
</html>
