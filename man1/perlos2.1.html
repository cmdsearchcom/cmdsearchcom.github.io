<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>PERLOS2(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">PERLOS2(1)</td>
    <td class="head-vol">Perl Programmers Reference Guide</td>
    <td class="head-rtitle">PERLOS2(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
perlos2 - Perl under OS/2, DOS, Win0.3*, Win0.95 and WinNT.
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
One can read this document in the following formats:
<div class="Pp"></div>
<pre>
        man perlos2
        view perl perlos2
        explorer perlos2.html
        info perlos2
</pre>
<div class="Pp"></div>
to list some (not all may be available simultaneously), or it may be read <i>as
  is</i>: either as <i>README.os2</i>, or <i>pod/perlos2.pod</i>.
<div class="Pp"></div>
To read the <i>.INF</i> version of documentation (<b>very</b> recommended)
  outside of OS/2, one needs an IBM's reader (may be available on IBM ftp sites
  (?) (URL anyone?)) or shipped with PC DOS 7.0 and IBM's Visual Age C++ 3.5.
<div class="Pp"></div>
A copy of a Win* viewer is contained in the &quot;Just add OS/2 Warp&quot;
  package
<div class="Pp"></div>
<pre>
  ftp://ftp.software.ibm.com/ps/products/os2/tools/jaow/jaow.zip
</pre>
<div class="Pp"></div>
in <i>?:\JUST_ADD\view.exe</i>. This gives one an access to EMX's <i>.INF</i>
  docs as well (text form is available in <i>/emx/doc</i> in EMX's
  distribution). There is also a different viewer named xview.
<div class="Pp"></div>
Note that if you have <i>lynx.exe</i> or <i>netscape.exe</i> installed, you can
  follow WWW links from this document in <i>.INF</i> format. If you have EMX
  docs installed correctly, you can follow library links (you need to have
  &quot;view emxbook&quot; working by setting &quot;EMXBOOK&quot; environment
  variable as it is described in EMX docs).
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<h2 class="Ss" title="Ss" id="Target"><a class="selflink" href="#Target">Target</a></h2>
The target is to make OS/2 one of the best supported platform for
  using/building/developing Perl and <i>Perl applications</i>, as well as make
  Perl the best language to use under OS/2. The secondary target is to try to
  make this work under DOS and Win* as well (but not <b>too</b> hard).
<div class="Pp"></div>
The current state is quite close to this target. Known limitations:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Some *nix programs use <i>fork()</i> a lot; with the mostly
      useful flavors of perl for OS/2 (there are several built simultaneously)
      this is supported; but some flavors do not support this (e.g., when Perl
      is called from inside REXX). Using <i>fork()</i> after <i>use</i>ing
      dynamically loading extensions would not work with <i>very</i> old
      versions of EMX.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">You need a separate perl executable <i>perl__.exe</i> (see
      &quot;perl__.exe&quot;) if you want to use PM code in your application (as
      Perl/Tk or OpenGL Perl modules do) without having a text-mode window
      present.
    <div style="height: 1.00em;">&#x00A0;</div>
    While using the standard <i>perl.exe</i> from a text-mode window is possible
      too, I have seen cases when this causes degradation of the system
      stability. Using <i>perl__.exe</i> avoids such a degradation.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">There is no simple way to access WPS objects. The only way
      I know is via &quot;OS2::REXX&quot; and &quot;SOM&quot; extensions (see
      OS2::REXX, SOM). However, we do not have access to convenience methods of
      Object-REXX. (Is it possible at all? I know of no Object-REXX API.) The
      &quot;SOM&quot; extension (currently in alpha-text) may eventually remove
      this shortcoming; however, due to the fact that DII is not supported by
      the &quot;SOM&quot; module, using &quot;SOM&quot; is not as convenient as
      one would like it.</dd>
</dl>
<div class="Pp"></div>
Please keep this list up-to-date by informing me about other items.
<h2 class="Ss" title="Ss" id="Other_OSes"><a class="selflink" href="#Other_OSes">Other
  OSes</a></h2>
Since OS/2 port of perl uses a remarkable EMX environment, it can run (and build
  extensions, and - possibly - be built itself) under any environment which can
  run EMX. The current list is DOS, DOS-inside-OS/2, Win0.3*, Win0.95 and WinNT.
  Out of many perl flavors, only one works, see &quot;perl_.exe&quot;.
<div class="Pp"></div>
Note that not all features of Perl are available under these environments. This
  depends on the features the <i>extender</i> - most probably RSX - decided to
  implement.
<div class="Pp"></div>
Cf. &quot;Prerequisites&quot;.
<h2 class="Ss" title="Ss" id="Prerequisites"><a class="selflink" href="#Prerequisites">Prerequisites</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">EMX</dt>
  <dd class="It-tag">EMX runtime is required (may be substituted by RSX). Note
      that it is possible to make <i>perl_.exe</i> to run under DOS without any
      external support by binding <i>emx.exe</i>/<i>rsx.exe</i> to it, see
      &quot;emxbind&quot;. Note that under DOS for best results one should use
      RSX runtime, which has much more functions working (like &quot;fork&quot;,
      &quot;popen&quot; and so on). In fact RSX is required if there is no VCPI
      present. Note the RSX requires DPMI. Many implementations of DPMI are
      known to be very buggy, beware!
    <div style="height: 1.00em;">&#x00A0;</div>
    Only the latest runtime is supported, currently &quot;0.9d fix 03&quot;.
      Perl may run under earlier versions of EMX, but this is not tested.
    <div style="height: 1.00em;">&#x00A0;</div>
    One can get different parts of EMX from, say
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  ftp://crydee.sai.msu.ru/pub/comp/os/os2/leo/gnu/emx+gcc/
  http://hobbes.nmsu.edu/h-browse.php?dir=/pub/os2/dev/emx/v0.9d/
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    The runtime component should have the name <i>emxrt.zip</i>.
    <div style="height: 1.00em;">&#x00A0;</div>
     <b>NOTE</b>. When using <i>emx.exe</i>/<i>rsx.exe</i>, it is enough to have
      them on your path. One does not need to specify them explicitly (though
      this
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  emx perl_.exe -de 0
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    will work as well.)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">RSX</dt>
  <dd class="It-tag">To run Perl on DPMI platforms one needs RSX runtime. This
      is needed under DOS-inside-OS/2, Win0.3*, Win0.95 and WinNT (see
      &quot;Other OSes&quot;). RSX would not work with VCPI only, as EMX would,
      it requires DMPI.
    <div style="height: 1.00em;">&#x00A0;</div>
    Having RSX and the latest <i>sh.exe</i> one gets a fully functional
      <b>*nix</b>-ish environment under DOS, say, &quot;fork&quot;,
      &quot;``&quot; and pipe-&quot;open&quot; work. In fact, MakeMaker works
      (for static build), so one can have Perl development environment under
      DOS.
    <div style="height: 1.00em;">&#x00A0;</div>
    One can get RSX from, say
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  http://cd.textfiles.com/hobbesos29804/disk1/EMX09C/
  ftp://crydee.sai.msu.ru/pub/comp/os/os2/leo/gnu/emx+gcc/contrib/
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Contact the author on &quot;rainer@mathematik.uni-bielefeld.de&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    The latest <i>sh.exe</i> with DOS hooks is available in
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  http://www.ilyaz.org/software/os2/
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    as <i>sh_dos.zip</i> or under similar names starting with &quot;sh&quot;,
      &quot;pdksh&quot; etc.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">HPFS</dt>
  <dd class="It-tag">Perl does not care about file systems, but the perl library
      contains many files with long names, so to install it intact one needs a
      file system which supports long file names.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note that if you do not plan to build the perl itself, it may be possible to
      fool EMX to truncate file names. This is not supported, read EMX docs to
      see how to do it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">pdksh</dt>
  <dd class="It-tag">To start external programs with complicated command lines
      (like with pipes in between, and/or quoting of arguments), Perl uses an
      external shell. With EMX port such shell should be named <i>sh.exe</i>,
      and located either in the wired-in-during-compile locations (usually
      <i>F:/bin</i>), or in configurable location (see &quot;PERL_SH_DIR&quot;).
    <div style="height: 1.00em;">&#x00A0;</div>
    For best results use EMX pdksh. The standard binary (5.2.14 or later) runs
      under DOS (with &quot;RSX&quot;) as well, see
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  http://www.ilyaz.org/software/os2/
    </pre>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="Starting_Perl_programs_under_OS/2_(and_DOS_and...)"><a class="selflink" href="#Starting_Perl_programs_under_OS/2_(and_DOS_and...)">Starting
  Perl programs under OS/2 (and DOS and...)</a></h2>
Start your Perl program <i>foo.pl</i> with arguments &quot;arg1 arg2 arg3&quot;
  the same way as on any other platform, by
<div class="Pp"></div>
<pre>
        perl foo.pl arg1 arg2 arg3
</pre>
<div class="Pp"></div>
If you want to specify perl options &quot;-my_opts&quot; to the perl itself (as
  opposed to your program), use
<div class="Pp"></div>
<pre>
        perl -my_opts foo.pl arg1 arg2 arg3
</pre>
<div class="Pp"></div>
Alternately, if you use OS/2-ish shell, like CMD or 4os2, put the following at
  the start of your perl script:
<div class="Pp"></div>
<pre>
        extproc perl -S -my_opts
</pre>
<div class="Pp"></div>
rename your program to <i>foo.cmd</i>, and start it by typing
<div class="Pp"></div>
<pre>
        foo arg1 arg2 arg3
</pre>
<div class="Pp"></div>
Note that because of stupid OS/2 limitations the full path of the perl script is
  not available when you use &quot;extproc&quot;, thus you are forced to use
  &quot;-S&quot; perl switch, and your script should be on the &quot;PATH&quot;.
  As a plus side, if you know a full path to your script, you may still start it
  with
<div class="Pp"></div>
<pre>
        perl ../../blah/foo.cmd arg1 arg2 arg3
</pre>
<div class="Pp"></div>
(note that the argument &quot;-my_opts&quot; is taken care of by the
  &quot;extproc&quot; line in your script, see &quot;&quot;extproc&quot; on the
  first line&quot;).
<div class="Pp"></div>
To understand what the above <i>magic</i> does, read perl docs about
  &quot;-S&quot; switch - see perlrun, and cmdref about &quot;extproc&quot;:
<div class="Pp"></div>
<pre>
        view perl perlrun
        man perlrun
        view cmdref extproc
        help extproc
</pre>
<div class="Pp"></div>
or whatever method you prefer.
<div class="Pp"></div>
There are also endless possibilities to use <i>executable extensions</i> of
  4os2, <i>associations</i> of WPS and so on... However, if you use *nixish
  shell (like <i>sh.exe</i> supplied in the binary distribution), you need to
  follow the syntax specified in &quot;Command Switches&quot; in perlrun.
<div class="Pp"></div>
Note that <b>-S</b> switch supports scripts with additional extensions
  <i>.cmd</i>, <i>.btm</i>, <i>.bat</i>, <i>.pl</i> as well.
<h2 class="Ss" title="Ss" id="Starting_OS/2_(and_DOS)_programs_under_Perl"><a class="selflink" href="#Starting_OS/2_(and_DOS)_programs_under_Perl">Starting
  OS/2 (and DOS) programs under Perl</a></h2>
This is what <i>system()</i> (see &quot;system&quot; in perlfunc),
  &quot;``&quot; (see &quot;I/O Operators&quot; in perlop), and <i>open pipe</i>
  (see &quot;open&quot; in perlfunc) are for. (Avoid <i>exec()</i> (see
  &quot;exec&quot; in perlfunc) unless you know what you do).
<div class="Pp"></div>
Note however that to use some of these operators you need to have a sh-syntax
  shell installed (see &quot;Pdksh&quot;, &quot;Frequently asked
  questions&quot;), and perl should be able to find it (see
  &quot;PERL_SH_DIR&quot;).
<div class="Pp"></div>
The cases when the shell is used are:
<dl class="Bl-tag">
  <dt class="It-tag">1.</dt>
  <dd class="It-tag">One-argument <i>system()</i> (see &quot;system&quot; in
      perlfunc), <i>exec()</i> (see &quot;exec&quot; in perlfunc) with
      redirection or shell meta-characters;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">2.</dt>
  <dd class="It-tag">Pipe-open (see &quot;open&quot; in perlfunc) with the
      command which contains redirection or shell meta-characters;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">3.</dt>
  <dd class="It-tag">Backticks &quot;``&quot; (see &quot;I/O Operators&quot; in
      perlop) with the command which contains redirection or shell
      meta-characters;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">4.</dt>
  <dd class="It-tag">If the executable called by
      <i>system()</i>/<i>exec()</i>/pipe- <i>open()</i>/&quot;``&quot; is a
      script with the &quot;magic&quot; &quot;#!&quot; line or
      &quot;extproc&quot; line which specifies shell;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">5.</dt>
  <dd class="It-tag">If the executable called by
      <i>system()</i>/<i>exec()</i>/pipe- <i>open()</i>/&quot;``&quot; is a
      script without &quot;magic&quot; line, and $ENV{EXECSHELL} is set to
      shell;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">6.</dt>
  <dd class="It-tag">If the executable called by
      <i>system()</i>/<i>exec()</i>/pipe- <i>open()</i>/&quot;``&quot; is not
      found (is not this remark obsolete?);</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">7.</dt>
  <dd class="It-tag">For globbing (see &quot;glob&quot; in perlfunc, &quot;I/O
      Operators&quot; in perlop) (obsolete? Perl uses builtin globbing
      nowadays...).</dd>
</dl>
<div class="Pp"></div>
For the sake of speed for a common case, in the above algorithms backslashes in
  the command name are not considered as shell metacharacters.
<div class="Pp"></div>
Perl starts scripts which begin with cookies &quot;extproc&quot; or
  &quot;#!&quot; directly, without an intervention of shell. Perl uses the same
  algorithm to find the executable as <i>pdksh</i>: if the path on
  &quot;#!&quot; line does not work, and contains &quot;/&quot;, then the
  directory part of the executable is ignored, and the executable is searched in
  <i>.</i> and on &quot;PATH&quot;. To find arguments for these scripts Perl
  uses a different algorithm than <i>pdksh</i>: up to 3 arguments are
  recognized, and trailing whitespace is stripped.
<div class="Pp"></div>
If a script does not contain such a cooky, then to avoid calling <i>sh.exe</i>,
  Perl uses the same algorithm as <i>pdksh</i>: if $ENV{EXECSHELL} is set, the
  script is given as the first argument to this command, if not set, then
  &quot;$ENV{COMSPEC} /c&quot; is used (or a hardwired guess if $ENV{COMSPEC} is
  not set).
<div class="Pp"></div>
When starting scripts directly, Perl uses exactly the same algorithm as for the
  search of script given by <b>-S</b> command-line option: it will look in the
  current directory, then on components of $ENV{PATH} using the following order
  of appended extensions: no extension, <i>.cmd</i>, <i>.btm</i>, <i>.bat</i>,
  <i>.pl</i>.
<div class="Pp"></div>
Note that Perl will start to look for scripts only if OS/2 cannot start the
  specified application, thus &quot;system 'blah'&quot; will not look for a
  script if there is an executable file <i>blah.exe</i> <i>anywhere</i> on
  &quot;PATH&quot;. In other words, &quot;PATH&quot; is essentially searched
  twice: once by the OS for an executable, then by Perl for scripts.
<div class="Pp"></div>
Note also that executable files on OS/2 can have an arbitrary extension, but
  <i>.exe</i> will be automatically appended if no dot is present in the name.
  The workaround is as simple as that: since <i>blah.</i> and <i>blah</i> denote
  the same file (at list on FAT and HPFS file systems), to start an executable
  residing in file <i>n:/bin/blah</i> (no extension) give an argument
  &quot;n:/bin/blah.&quot; (dot appended) to <i>system()</i>.
<div class="Pp"></div>
Perl will start PM programs from VIO (=text-mode) Perl process in a separate PM
  session; the opposite is not true: when you start a non-PM program from a PM
  Perl process, Perl would not run it in a separate session. If a separate
  session is desired, either ensure that shell will be used, as in &quot;system
  'cmd /c myprog'&quot;, or start it using optional arguments to <i>system()</i>
  documented in &quot;OS2::Process&quot; module. This is considered to be a
  feature.
<h1 class="Sh" title="Sh" id="Frequently_asked_questions"><a class="selflink" href="#Frequently_asked_questions">Frequently
  asked questions</a></h1>
<h2 class="Ss" title="Ss" id="&quot;It_does_not_work&quot;"><a class="selflink" href="#&quot;It_does_not_work&quot;">&quot;It
  does not work&quot;</a></h2>
Perl binary distributions come with a <i>testperl.cmd</i> script which tries to
  detect common problems with misconfigured installations. There is a pretty
  large chance it will discover which step of the installation you managed to
  goof. &quot;;-)&quot;
<h2 class="Ss" title="Ss" id="I_cannot_run_external_programs"><a class="selflink" href="#I_cannot_run_external_programs">I
  cannot run external programs</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Did you run your programs with &quot;-w&quot; switch? See
      &quot;Starting OS/2 (and DOS) programs under Perl&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Do you try to run <i>internal</i> shell commands, like
      &quot;`copy a b`&quot; (internal for <i>cmd.exe</i>), or &quot;`glob
      a*b`&quot; (internal for ksh)? You need to specify your shell explicitly,
      like &quot;`cmd /c copy a b`&quot;, since Perl cannot deduce which
      commands are internal to your shell.</dd>
</dl>
<h2 class="Ss" title="Ss" id="I_cannot_embed_perl_into_my_program,_or_use_perl.dll_from_my_program."><a class="selflink" href="#I_cannot_embed_perl_into_my_program,_or_use_perl.dll_from_my_program.">I
  cannot embed perl into my program, or use <i>perl.dll</i> from my
  program.</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">Is your program EMX-compiled with &quot;-Zmt
    -Zcrtdll&quot;?</dt>
  <dd class="It-tag">Well, nowadays Perl DLL should be usable from a differently
      compiled program too... If you can run Perl code from REXX scripts (see
      OS2::REXX), then there are some other aspect of interaction which are
      overlooked by the current hackish code to support differently-compiled
      principal programs.
    <div style="height: 1.00em;">&#x00A0;</div>
    If everything else fails, you need to build a stand-alone DLL for perl.
      Contact me, I did it once. Sockets would not work, as a lot of other
      stuff.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Did you use ExtUtils::Embed?</dt>
  <dd class="It-tag">Some time ago I had reports it does not work. Nowadays it
      is checked in the Perl test suite, so grep <i>./t</i> subdirectory of the
      build tree (as well as <i>*.t</i> files in the <i>./lib</i> subdirectory)
      to find how it should be done &quot;correctly&quot;.</dd>
</dl>
<h2 class="Ss" title="Ss" id="&quot;``&quot;_and_pipe-&quot;open&quot;_do_not_work_under_DOS."><a class="selflink" href="#&quot;``&quot;_and_pipe-&quot;open&quot;_do_not_work_under_DOS.">&quot;``&quot;
  and pipe-&quot;open&quot; do not work under DOS.</a></h2>
This may a variant of just &quot;I cannot run external programs&quot;, or a
  deeper problem. Basically: you <i>need</i> RSX (see &quot;Prerequisites&quot;)
  for these commands to work, and you may need a port of <i>sh.exe</i> which
  understands command arguments. One of such ports is listed in
  &quot;Prerequisites&quot; under RSX. Do not forget to set variable
  &quot;PERL_SH_DIR&quot; as well.
<div class="Pp"></div>
DPMI is required for RSX.
<h2 class="Ss" title="Ss" id="Cannot_start_&quot;find.exe_&quot;pattern&quot;_file&quot;"><a class="selflink" href="#Cannot_start_&quot;find.exe_&quot;pattern&quot;_file&quot;">Cannot
  start &quot;find.exe &quot;pattern&quot; file&quot;</a></h2>
The whole idea of the &quot;standard C API to start applications&quot; is that
  the forms &quot;foo&quot; and &quot;foo&quot; of program arguments are
  completely interchangeable. <i>find</i> breaks this paradigm;
<div class="Pp"></div>
<pre>
  find &quot;pattern&quot; file
  find pattern file
</pre>
<div class="Pp"></div>
are not equivalent; <i>find</i> cannot be started directly using the above API.
  One needs a way to surround the doublequotes in some other quoting
  construction, necessarily having an extra non-Unixish shell in between.
<div class="Pp"></div>
Use one of
<div class="Pp"></div>
<pre>
  system 'cmd', '/c', 'find &quot;pattern&quot; file';
  `cmd /c 'find &quot;pattern&quot; file'`
</pre>
<div class="Pp"></div>
This would start <i>find.exe</i> via <i>cmd.exe</i> via &quot;sh.exe&quot; via
  &quot;perl.exe&quot;, but this is a price to pay if you want to use
  non-conforming program.
<h1 class="Sh" title="Sh" id="INSTALLATION"><a class="selflink" href="#INSTALLATION">INSTALLATION</a></h1>
<h2 class="Ss" title="Ss" id="Automatic_binary_installation"><a class="selflink" href="#Automatic_binary_installation">Automatic
  binary installation</a></h2>
The most convenient way of installing a binary distribution of perl is via perl
  installer <i>install.exe</i>. Just follow the instructions, and 99% of the
  installation blues would go away.
<div class="Pp"></div>
Note however, that you need to have <i>unzip.exe</i> on your path, and EMX
  environment <i>running</i>. The latter means that if you just installed EMX,
  and made all the needed changes to <i>Config.sys</i>, you may need to reboot
  in between. Check EMX runtime by running
<div class="Pp"></div>
<pre>
        emxrev
</pre>
<div class="Pp"></div>
Binary installer also creates a folder on your desktop with some useful objects.
  If you need to change some aspects of the work of the binary installer, feel
  free to edit the file <i>Perl.pkg</i>. This may be useful e.g., if you need to
  run the installer many times and do not want to make many interactive changes
  in the GUI.
<div class="Pp"></div>
<b>Things not taken care of by automatic binary installation:</b>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;PERL_BADLANG&quot;</dt>
  <dd class="It-tag">may be needed if you change your codepage <i>after</i> perl
      installation, and the new value is not supported by EMX. See
      &quot;PERL_BADLANG&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;PERL_BADFREE&quot;</dt>
  <dd class="It-tag">see &quot;PERL_BADFREE&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>Config.pm</i></dt>
  <dd class="It-tag">This file resides somewhere deep in the location you
      installed your perl library, find it out by
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  perl -MConfig -le &quot;print $INC{'Config.pm'}&quot;
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    While most important values in this file <i>are</i> updated by the binary
      installer, some of them may need to be hand-edited. I know no such data,
      please keep me informed if you find one. Moreover, manual changes to the
      installed version may need to be accompanied by an edit of this file.</dd>
</dl>
<div class="Pp"></div>
<b>NOTE</b>. Because of a typo the binary installer of 5.00305 would install a
  variable &quot;PERL_SHPATH&quot; into <i>Config.sys</i>. Please remove this
  variable and put &quot;PERL_SH_DIR&quot; instead.
<h2 class="Ss" title="Ss" id="Manual_binary_installation"><a class="selflink" href="#Manual_binary_installation">Manual
  binary installation</a></h2>
As of version 5.00305, OS/2 perl binary distribution comes split into 11
  components. Unfortunately, to enable configurable binary installation, the
  file paths in the zip files are not absolute, but relative to some directory.
<div class="Pp"></div>
Note that the extraction with the stored paths is still necessary (default with
  unzip, specify &quot;-d&quot; to pkunzip). However, you need to know where to
  extract the files. You need also to manually change entries in
  <i>Config.sys</i> to reflect where did you put the files. Note that if you
  have some primitive unzipper (like &quot;pkunzip&quot;), you may get a lot of
  warnings/errors during unzipping. Upgrade to &quot;(w)unzip&quot;.
<div class="Pp"></div>
Below is the sample of what to do to reproduce the configuration on my machine.
  In <i>VIEW.EXE</i> you can press &quot;Ctrl-Insert&quot; now, and
  cut-and-paste from the resulting file - created in the directory you started
  <i>VIEW.EXE</i> from.
<div class="Pp"></div>
For each component, we mention environment variables related to each
  installation directory. Either choose directories to match your values of the
  variables, or create/append-to variables to take into account the directories.
<dl class="Bl-tag">
  <dt class="It-tag">Perl VIO and PM executables (dynamically linked)</dt>
  <dd class="It-tag">
    <pre>
  unzip perl_exc.zip *.exe *.ico -d f:/emx.add/bin
  unzip perl_exc.zip *.dll -d f:/emx.add/dll
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    (have the directories with &quot;*.exe&quot; on PATH, and &quot;*.dll&quot;
      on LIBPATH);</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Perl_ VIO executable (statically linked)</dt>
  <dd class="It-tag">
    <pre>
  unzip perl_aou.zip -d f:/emx.add/bin
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    (have the directory on PATH);</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Executables for Perl utilities</dt>
  <dd class="It-tag">
    <pre>
  unzip perl_utl.zip -d f:/emx.add/bin
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    (have the directory on PATH);</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Main Perl library</dt>
  <dd class="It-tag">
    <pre>
  unzip perl_mlb.zip -d f:/perllib/lib
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    If this directory is exactly the same as the prefix which was compiled into
      <i>perl.exe</i>, you do not need to change anything. However, for perl to
      find the library if you use a different path, you need to &quot;set
      PERLLIB_PREFIX&quot; in <i>Config.sys</i>, see
    &quot;PERLLIB_PREFIX&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Additional Perl modules</dt>
  <dd class="It-tag">
    <pre>
  unzip perl_ste.zip -d f:/perllib/lib/site_perl/5.16.3/
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Same remark as above applies. Additionally, if this directory is not one of
      directories on @INC (and @INC is influenced by
      &quot;PERLLIB_PREFIX&quot;), you need to put this directory and
      subdirectory <i>./os2</i> in &quot;PERLLIB&quot; or &quot;PERL5LIB&quot;
      variable. Do not use &quot;PERL5LIB&quot; unless you have it set already.
      See &quot;ENVIRONMENT&quot; in perl.
    <div style="height: 1.00em;">&#x00A0;</div>
     <b>[Check whether this extraction directory is still applicable with</b>
      <b>the new directory structure layout!]</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Tools to compile Perl modules</dt>
  <dd class="It-tag">
    <pre>
  unzip perl_blb.zip -d f:/perllib/lib
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Same remark as for <i>perl_ste.zip</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Manpages for Perl and utilities</dt>
  <dd class="It-tag">
    <pre>
  unzip perl_man.zip -d f:/perllib/man
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This directory should better be on &quot;MANPATH&quot;. You need to have a
      working <i>man</i> to access these files.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Manpages for Perl modules</dt>
  <dd class="It-tag">
    <pre>
  unzip perl_mam.zip -d f:/perllib/man
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This directory should better be on &quot;MANPATH&quot;. You need to have a
      working man to access these files.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Source for Perl documentation</dt>
  <dd class="It-tag">
    <pre>
  unzip perl_pod.zip -d f:/perllib/lib
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This is used by the &quot;perldoc&quot; program (see perldoc), and may be
      used to generate HTML documentation usable by WWW browsers, and
      documentation in zillions of other formats: &quot;info&quot;,
      &quot;LaTeX&quot;, &quot;Acrobat&quot;, &quot;FrameMaker&quot; and so on.
      [Use programs such as <i>pod2latex</i> etc.]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Perl manual in <i>.INF</i> format</dt>
  <dd class="It-tag">
    <pre>
  unzip perl_inf.zip -d d:/os2/book
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This directory should better be on &quot;BOOKSHELF&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Pdksh</dt>
  <dd class="It-tag">
    <pre>
  unzip perl_sh.zip -d f:/bin
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This is used by perl to run external commands which explicitly require
      shell, like the commands using <i>redirection</i> and <i>shell</i>
      <i>metacharacters</i>. It is also used instead of explicit <i>/bin/sh</i>.
    <div style="height: 1.00em;">&#x00A0;</div>
    Set &quot;PERL_SH_DIR&quot; (see &quot;PERL_SH_DIR&quot;) if you move
      <i>sh.exe</i> from the above location.
    <div style="height: 1.00em;">&#x00A0;</div>
     <b>Note.</b> It may be possible to use some other sh-compatible shell
      (untested).</dd>
</dl>
<div class="Pp"></div>
After you installed the components you needed and updated the <i>Config.sys</i>
  correspondingly, you need to hand-edit <i>Config.pm</i>. This file resides
  somewhere deep in the location you installed your perl library, find it out by
<div class="Pp"></div>
<pre>
  perl -MConfig -le &quot;print $INC{'Config.pm'}&quot;
</pre>
<div class="Pp"></div>
You need to correct all the entries which look like file paths (they currently
  start with &quot;f:/&quot;).
<h2 class="Ss" title="Ss" id="Warning"><a class="selflink" href="#Warning"><b>Warning</b></a></h2>
The automatic and manual perl installation leave precompiled paths inside perl
  executables. While these paths are overwriteable (see
  &quot;PERLLIB_PREFIX&quot;, &quot;PERL_SH_DIR&quot;), some people may prefer
  binary editing of paths inside the executables/DLLs.
<h1 class="Sh" title="Sh" id="Accessing_documentation"><a class="selflink" href="#Accessing_documentation">Accessing
  documentation</a></h1>
Depending on how you built/installed perl you may have (otherwise identical)
  Perl documentation in the following formats:
<h2 class="Ss" title="Ss" id="OS/2_.INF_file"><a class="selflink" href="#OS/2_.INF_file">OS/2
  <i>.INF</i> file</a></h2>
Most probably the most convenient form. Under OS/2 view it as
<div class="Pp"></div>
<pre>
  view perl
  view perl perlfunc
  view perl less
  view perl ExtUtils::MakeMaker
</pre>
<div class="Pp"></div>
(currently the last two may hit a wrong location, but this may improve soon).
  Under Win* see &quot;SYNOPSIS&quot;.
<div class="Pp"></div>
If you want to build the docs yourself, and have <i>OS/2 toolkit</i>, run
<div class="Pp"></div>
<pre>
        pod2ipf &gt; perl.ipf
</pre>
<div class="Pp"></div>
in <i>/perllib/lib/pod</i> directory, then
<div class="Pp"></div>
<pre>
        ipfc /inf perl.ipf
</pre>
<div class="Pp"></div>
(Expect a lot of errors during the both steps.) Now move it on your BOOKSHELF
  path.
<h2 class="Ss" title="Ss" id="Plain_text"><a class="selflink" href="#Plain_text">Plain
  text</a></h2>
If you have perl documentation in the source form, perl utilities installed, and
  GNU groff installed, you may use
<div class="Pp"></div>
<pre>
        perldoc perlfunc
        perldoc less
        perldoc ExtUtils::MakeMaker
</pre>
<div class="Pp"></div>
to access the perl documentation in the text form (note that you may get better
  results using perl manpages).
<div class="Pp"></div>
Alternately, try running pod2text on <i>.pod</i> files.
<h2 class="Ss" title="Ss" id="Manpages"><a class="selflink" href="#Manpages">Manpages</a></h2>
If you have <i>man</i> installed on your system, and you installed perl
  manpages, use something like this:
<div class="Pp"></div>
<pre>
        man perlfunc
        man 3 less
        man ExtUtils.MakeMaker
</pre>
<div class="Pp"></div>
to access documentation for different components of Perl. Start with
<div class="Pp"></div>
<pre>
        man perl
</pre>
<div class="Pp"></div>
Note that dot ( <i>.</i>) is used as a package separator for documentation for
  packages, and as usual, sometimes you need to give the section - 3 above - to
  avoid shadowing by the <i></i><i>less</i><i>(1) manpage</i>.
<div class="Pp"></div>
Make sure that the directory <b>above</b> the directory with manpages is on our
  &quot;MANPATH&quot;, like this
<div class="Pp"></div>
<pre>
  set MANPATH=c:/man;f:/perllib/man
</pre>
<div class="Pp"></div>
for Perl manpages in &quot;f:/perllib/man/man1/&quot; etc.
<h2 class="Ss" title="Ss" id="HTML"><a class="selflink" href="#HTML">HTML</a></h2>
If you have some WWW browser available, installed the Perl documentation in the
  source form, and Perl utilities, you can build HTML docs. Cd to directory with
  <i>.pod</i> files, and do like this
<div class="Pp"></div>
<pre>
        cd f:/perllib/lib/pod
        pod2html
</pre>
<div class="Pp"></div>
After this you can direct your browser the file <i>perl.html</i> in this
  directory, and go ahead with reading docs, like this:
<div class="Pp"></div>
<pre>
        explore file:///f:/perllib/lib/pod/perl.html
</pre>
<div class="Pp"></div>
Alternatively you may be able to get these docs prebuilt from CPAN.
<h2 class="Ss" title="Ss" id="GNU_&quot;info&quot;_files"><a class="selflink" href="#GNU_&quot;info&quot;_files">GNU
  &quot;info&quot; files</a></h2>
Users of Emacs would appreciate it very much, especially with &quot;CPerl&quot;
  mode loaded. You need to get latest &quot;pod2texi&quot; from
  &quot;CPAN&quot;, or, alternately, the prebuilt info pages.
<h2 class="Ss" title="Ss" id="PDF_files"><a class="selflink" href="#PDF_files"><i>PDF</i>
  files</a></h2>
for &quot;Acrobat&quot; are available on CPAN (may be for slightly older version
  of perl).
<h2 class="Ss" title="Ss" id="&quot;LaTeX&quot;_docs"><a class="selflink" href="#&quot;LaTeX&quot;_docs">&quot;LaTeX&quot;
  docs</a></h2>
can be constructed using &quot;pod2latex&quot;.
<h1 class="Sh" title="Sh" id="BUILD"><a class="selflink" href="#BUILD">BUILD</a></h1>
Here we discuss how to build Perl under OS/2.
<h2 class="Ss" title="Ss" id="The_short_story"><a class="selflink" href="#The_short_story">The
  short story</a></h2>
Assume that you are a seasoned porter, so are sure that all the necessary tools
  are already present on your system, and you know how to get the Perl source
  distribution. Untar it, change to the extract directory, and
<div class="Pp"></div>
<pre>
  gnupatch -p0 &lt; os2\diff.configure
  sh Configure -des -D prefix=f:/perllib
  make
  make test
  make install
  make aout_test
  make aout_install
</pre>
<div class="Pp"></div>
This puts the executables in f:/perllib/bin. Manually move them to the
  &quot;PATH&quot;, manually move the built <i>perl*.dll</i> to
  &quot;LIBPATH&quot; (here for Perl DLL <i>*</i> is a not-very-meaningful hex
  checksum), and run
<div class="Pp"></div>
<pre>
  make installcmd INSTALLCMDDIR=d:/ir/on/path
</pre>
<div class="Pp"></div>
Assuming that the &quot;man&quot;-files were put on an appropriate location,
  this completes the installation of minimal Perl system. (The binary
  distribution contains also a lot of additional modules, and the documentation
  in INF format.)
<div class="Pp"></div>
What follows is a detailed guide through these steps.
<h2 class="Ss" title="Ss" id="Prerequisites"><a class="selflink" href="#Prerequisites">Prerequisites</a></h2>
You need to have the latest EMX development environment, the full GNU tool suite
  (gawk renamed to awk, and GNU <i>find.exe</i> earlier on path than the OS/2
  <i>find.exe</i>, same with <i>sort.exe</i>, to check use
<div class="Pp"></div>
<pre>
  find --version
  sort --version
</pre>
<div class="Pp"></div>
). You need the latest version of <i>pdksh</i> installed as <i>sh.exe</i>.
<div class="Pp"></div>
Check that you have <b>BSD</b> libraries and headers installed, and - optionally
  - Berkeley DB headers and libraries, and crypt.
<div class="Pp"></div>
Possible locations to get the files:
<div class="Pp"></div>
<pre>
  ftp://ftp.uni-heidelberg.de/pub/os2/unix/
  http://hobbes.nmsu.edu/h-browse.php?dir=/pub/os2
  http://cd.textfiles.com/hobbesos29804/disk1/DEV32/
  http://cd.textfiles.com/hobbesos29804/disk1/EMX09C/
</pre>
<div class="Pp"></div>
It is reported that the following archives contain enough utils to build perl:
  <i>gnufutil.zip</i>, <i>gnusutil.zip</i>, <i>gnututil.zip</i>,
  <i>gnused.zip</i>, <i>gnupatch.zip</i>, <i>gnuawk.zip</i>, <i>gnumake.zip</i>,
  <i>gnugrep.zip</i>, <i>bsddev.zip</i> and <i>ksh527rt.zip</i> (or a later
  version). Note that all these utilities are known to be available from LEO:
<div class="Pp"></div>
<pre>
  ftp://crydee.sai.msu.ru/pub/comp/os/os2/leo/gnu/
</pre>
<div class="Pp"></div>
Note also that the <i>db.lib</i> and <i>db.a</i> from the EMX distribution are
  not suitable for multi-threaded compile (even single-threaded flavor of Perl
  uses multi-threaded C RTL, for compatibility with XFree86-OS/2). Get a
  corrected one from
<div class="Pp"></div>
<pre>
  http://www.ilyaz.org/software/os2/db_mt.zip
</pre>
<div class="Pp"></div>
If you have <i>exactly the same version of Perl</i> installed already, make sure
  that no copies or perl are currently running. Later steps of the build may
  fail since an older version of <i>perl.dll</i> loaded into memory may be
  found. Running &quot;make test&quot; becomes meaningless, since the test are
  checking a previous build of perl (this situation is detected and reported by
  <i>lib/os2_base.t</i> test). Do not forget to unset
  &quot;PERL_EMXLOAD_SEC&quot; in environment.
<div class="Pp"></div>
Also make sure that you have <i>/tmp</i> directory on the current drive, and
  <i>.</i> directory in your &quot;LIBPATH&quot;. One may try to correct the
  latter condition by
<div class="Pp"></div>
<pre>
  set BEGINLIBPATH .\.
</pre>
<div class="Pp"></div>
if you use something like <i>CMD.EXE</i> or latest versions of <i>4os2.exe</i>.
  (Setting BEGINLIBPATH to just &quot;.&quot; is ignored by the OS/2 kernel.)
<div class="Pp"></div>
Make sure your gcc is good for &quot;-Zomf&quot; linking: run
  &quot;omflibs&quot; script in <i>/emx/lib</i> directory.
<div class="Pp"></div>
Check that you have link386 installed. It comes standard with OS/2, but may be
  not installed due to customization. If typing
<div class="Pp"></div>
<pre>
  link386
</pre>
<div class="Pp"></div>
shows you do not have it, do <i>Selective install</i>, and choose &quot;Link
  object modules&quot; in <i>Optional system utilities/More</i>. If you get into
  link386 prompts, press &quot;Ctrl-C&quot; to exit.
<h2 class="Ss" title="Ss" id="Getting_perl_source"><a class="selflink" href="#Getting_perl_source">Getting
  perl source</a></h2>
You need to fetch the latest perl source (including developers releases). With
  some probability it is located in
<div class="Pp"></div>
<pre>
  http://www.cpan.org/src/
  http://www.cpan.org/src/unsupported
</pre>
<div class="Pp"></div>
If not, you may need to dig in the indices to find it in the directory of the
  current maintainer.
<div class="Pp"></div>
Quick cycle of developers release may break the OS/2 build time to time, looking
  into
<div class="Pp"></div>
<pre>
  http://www.cpan.org/ports/os2/
</pre>
<div class="Pp"></div>
may indicate the latest release which was publicly released by the maintainer.
  Note that the release may include some additional patches to apply to the
  current source of perl.
<div class="Pp"></div>
Extract it like this
<div class="Pp"></div>
<pre>
  tar vzxf perl5.00409.tar.gz
</pre>
<div class="Pp"></div>
You may see a message about errors while extracting <i>Configure</i>. This is
  because there is a conflict with a similarly-named file <i>configure</i>.
<div class="Pp"></div>
Change to the directory of extraction.
<h2 class="Ss" title="Ss" id="Application_of_the_patches"><a class="selflink" href="#Application_of_the_patches">Application
  of the patches</a></h2>
You need to apply the patches in <i>./os2/diff.*</i> like this:
<div class="Pp"></div>
<pre>
  gnupatch -p0 &lt; os2\diff.configure
</pre>
<div class="Pp"></div>
You may also need to apply the patches supplied with the binary distribution of
  perl. It also makes sense to look on the perl5-porters mailing list for the
  latest OS/2-related patches (see
  http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/
  &lt;http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/&gt;). Such patches
  usually contain strings &quot;/os2/&quot; and &quot;patch&quot;, so it makes
  sense looking for these strings.
<h2 class="Ss" title="Ss" id="Hand-editing"><a class="selflink" href="#Hand-editing">Hand-editing</a></h2>
You may look into the file <i>./hints/os2.sh</i> and correct anything wrong you
  find there. I do not expect it is needed anywhere.
<h2 class="Ss" title="Ss" id="Making"><a class="selflink" href="#Making">Making</a></h2>
<pre>
  sh Configure -des -D prefix=f:/perllib
</pre>
<div class="Pp"></div>
&quot;prefix&quot; means: where to install the resulting perl library. Giving
  correct prefix you may avoid the need to specify &quot;PERLLIB_PREFIX&quot;,
  see &quot;PERLLIB_PREFIX&quot;.
<div class="Pp"></div>
<i>Ignore the message about missing </i><i>&quot;ln&quot;</i><i>, and about
  </i><i>&quot;-c&quot;</i><i> option to</i> <i>tr</i>. The latter is most
  probably already fixed, if you see it and can trace where the latter spurious
  warning comes from, please inform me.
<div class="Pp"></div>
Now
<div class="Pp"></div>
<pre>
  make
</pre>
<div class="Pp"></div>
At some moment the built may die, reporting a <i>version mismatch</i> or
  <i>unable to run </i> <i>perl</i><i></i>. This means that you do not have
  <i>.</i> in your LIBPATH, so <i>perl.exe</i> cannot find the needed
  <i>perl67B2.dll</i> (treat these hex digits as line noise). After this is
  fixed the build should finish without a lot of fuss.
<h2 class="Ss" title="Ss" id="Testing"><a class="selflink" href="#Testing">Testing</a></h2>
Now run
<div class="Pp"></div>
<pre>
  make test
</pre>
<div class="Pp"></div>
All tests should succeed (with some of them skipped). If you have the same
  version of Perl installed, it is crucial that you have &quot;.&quot; early in
  your LIBPATH (or in BEGINLIBPATH), otherwise your tests will most probably
  test the wrong version of Perl.
<div class="Pp"></div>
Some tests may generate extra messages similar to
<dl class="Bl-tag">
  <dt class="It-tag">A lot of &quot;bad free&quot;</dt>
  <dd class="It-tag">in database tests related to Berkeley DB. <i>This should be
      fixed already.</i> If it persists, you may disable this warnings, see
      &quot;PERL_BADFREE&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Process terminated by SIGTERM/SIGINT</dt>
  <dd class="It-tag">This is a standard message issued by OS/2 applications.
      *nix applications die in silence. It is considered to be a feature. One
      can easily disable this by appropriate sighandlers.
    <div style="height: 1.00em;">&#x00A0;</div>
    However the test engine bleeds these message to screen in unexpected
      moments. Two messages of this kind <i>should</i> be present during
      testing.</dd>
</dl>
<div class="Pp"></div>
To get finer test reports, call
<div class="Pp"></div>
<pre>
  perl t/harness
</pre>
<div class="Pp"></div>
The report with <i>io/pipe.t</i> failing may look like this:
<div class="Pp"></div>
<pre>
  Failed Test  Status Wstat Total Fail  Failed  List of failed
  ------------------------------------------------------------
  io/pipe.t                    12    1   8.33%  9
  7 tests skipped, plus 56 subtests skipped.
  Failed 1/195 test scripts, 99.49% okay. 1/6542 subtests failed, 99.98% okay.
</pre>
<div class="Pp"></div>
The reasons for most important skipped tests are:
<dl class="Bl-tag">
  <dt class="It-tag"><i>op/fs.t</i></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 8.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">18</dt>
  <dd class="It-tag">Checks &quot;atime&quot; and &quot;mtime&quot; of
      &quot;stat()&quot; - unfortunately, HPFS provides only 2sec time
      granularity (for compatibility with FAT?).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">25</dt>
  <dd class="It-tag">Checks &quot;truncate()&quot; on a filehandle just opened
      for write - I do not know why this should or should not work.</dd>
</dl>
</div>
<div style="margin-left: 8.00ex;"></div>
<dl class="Bl-tag">
  <dt class="It-tag"><i>op/stat.t</i></dt>
  <dd class="It-tag">Checks &quot;stat()&quot;. Tests:</dd>
</dl>
<div style="margin-left: 8.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">4</dt>
  <dd class="It-tag">Checks &quot;atime&quot; and &quot;mtime&quot; of
      &quot;stat()&quot; - unfortunately, HPFS provides only 2sec time
      granularity (for compatibility with FAT?).</dd>
</dl>
</div>
<div style="margin-left: 8.00ex;"></div>
<h2 class="Ss" title="Ss" id="Installing_the_built_perl"><a class="selflink" href="#Installing_the_built_perl">Installing
  the built perl</a></h2>
If you haven't yet moved &quot;perl*.dll&quot; onto LIBPATH, do it now.
<div class="Pp"></div>
Run
<div class="Pp"></div>
<pre>
  make install
</pre>
<div class="Pp"></div>
It would put the generated files into needed locations. Manually put
  <i>perl.exe</i>, <i>perl__.exe</i> and <i>perl___.exe</i> to a location on
  your PATH, <i>perl.dll</i> to a location on your LIBPATH.
<div class="Pp"></div>
Run
<div class="Pp"></div>
<pre>
  make installcmd INSTALLCMDDIR=d:/ir/on/path
</pre>
<div class="Pp"></div>
to convert perl utilities to <i>.cmd</i> files and put them on PATH. You need to
  put <i>.EXE</i>-utilities on path manually. They are installed in
  &quot;$prefix/bin&quot;, here $prefix is what you gave to <i>Configure</i>,
  see &quot;Making&quot;.
<div class="Pp"></div>
If you use &quot;man&quot;, either move the installed <i>*/man/</i> directories
  to your &quot;MANPATH&quot;, or modify &quot;MANPATH&quot; to match the
  location. (One could have avoided this by providing a correct
  &quot;manpath&quot; option to <i>./Configure</i>, or editing
  <i>./config.sh</i> between configuring and making steps.)
<h2 class="Ss" title="Ss" id="&quot;a.out&quot;-style_build"><a class="selflink" href="#&quot;a.out&quot;-style_build">&quot;a.out&quot;-style
  build</a></h2>
Proceed as above, but make <i>perl_.exe</i> (see &quot;perl_.exe&quot;) by
<div class="Pp"></div>
<pre>
  make perl_
</pre>
<div class="Pp"></div>
test and install by
<div class="Pp"></div>
<pre>
  make aout_test
  make aout_install
</pre>
<div class="Pp"></div>
Manually put <i>perl_.exe</i> to a location on your PATH.
<div class="Pp"></div>
<b>Note.</b> The build process for &quot;perl_&quot; <i>does not know</i> about
  all the dependencies, so you should make sure that anything is up-to-date,
  say, by doing
<div class="Pp"></div>
<pre>
  make perl_dll
</pre>
<div class="Pp"></div>
first.
<h1 class="Sh" title="Sh" id="Building_a_binary_distribution"><a class="selflink" href="#Building_a_binary_distribution">Building
  a binary distribution</a></h1>
[This section provides a short overview only...]
<div class="Pp"></div>
Building should proceed differently depending on whether the version of perl you
  install is already present and used on your system, or is a new version not
  yet used. The description below assumes that the version is new, so installing
  its DLLs and <i>.pm</i> files will not disrupt the operation of your system
  even if some intermediate steps are not yet fully working.
<div class="Pp"></div>
The other cases require a little bit more convoluted procedures. Below I suppose
  that the current version of Perl is 5.8.2, so the executables are named
  accordingly.
<dl class="Bl-tag">
  <dt class="It-tag">1.</dt>
  <dd class="It-tag">Fully build and test the Perl distribution. Make sure that
      no tests are failing with &quot;test&quot; and &quot;aout_test&quot;
      targets; fix the bugs in Perl and the Perl test suite detected by these
      tests. Make sure that &quot;all_test&quot; make target runs as clean as
      possible. Check that <i>os2/perlrexx.cmd</i> runs fine.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">2.</dt>
  <dd class="It-tag">Fully install Perl, including &quot;installcmd&quot;
      target. Copy the generated DLLs to &quot;LIBPATH&quot;; copy the numbered
      Perl executables (as in <i>perl5.8.2.exe</i>) to &quot;PATH&quot;; copy
      &quot;perl_.exe&quot; to &quot;PATH&quot; as &quot;perl_5.8.2.exe&quot;.
      Think whether you need backward-compatibility DLLs. In most cases you do
      not need to install them yet; but sometime this may simplify the following
      steps.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">3.</dt>
  <dd class="It-tag">Make sure that &quot;CPAN.pm&quot; can download files from
      CPAN. If not, you may need to manually install &quot;Net::FTP&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">4.</dt>
  <dd class="It-tag">Install the bundle &quot;Bundle::OS2_default&quot;
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  perl5.8.2 -MCPAN -e &quot;install Bundle::OS2_default&quot; &lt; nul |&amp; tee 00cpan_i_1
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This may take a couple of hours on 1GHz processor (when run the first time).
      And this should not be necessarily a smooth procedure. Some modules may
      not specify required dependencies, so one may need to repeat this
      procedure several times until the results stabilize.
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  perl5.8.2 -MCPAN -e &quot;install Bundle::OS2_default&quot; &lt; nul |&amp; tee 00cpan_i_2
  perl5.8.2 -MCPAN -e &quot;install Bundle::OS2_default&quot; &lt; nul |&amp; tee 00cpan_i_3
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Even after they stabilize, some tests may fail.
    <div style="height: 1.00em;">&#x00A0;</div>
    Fix as many discovered bugs as possible. Document all the bugs which are not
      fixed, and all the failures with unknown reasons. Inspect the produced
      logs <i>00cpan_i_1</i> to find suspiciously skipped tests, and other fishy
      events.
    <div style="height: 1.00em;">&#x00A0;</div>
    Keep in mind that <i>installation</i> of some modules may fail too: for
      example, the DLLs to update may be already loaded by <i>CPAN.pm</i>.
      Inspect the &quot;install&quot; logs (in the example above
      <i>00cpan_i_1</i> etc) for errors, and install things manually, as in
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  cd $CPANHOME/.cpan/build/Digest-MD5-2.31
  make install
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Some distributions may fail some tests, but you may want to install them
      anyway (as above, or via &quot;force install&quot; command of
      &quot;CPAN.pm&quot; shell-mode).
    <div style="height: 1.00em;">&#x00A0;</div>
    Since this procedure may take quite a long time to complete, it makes sense
      to &quot;freeze&quot; your CPAN configuration by disabling periodic
      updates of the local copy of CPAN index: set &quot;index_expire&quot; to
      some big value (I use 365), then save the settings
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  CPAN&gt; o conf index_expire 365
  CPAN&gt; o conf commit
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Reset back to the default value 1 when you are finished.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">5.</dt>
  <dd class="It-tag">When satisfied with the results, rerun the
      &quot;installcmd&quot; target. Now you can copy &quot;perl5.8.2.exe&quot;
      to &quot;perl.exe&quot;, and install the other OMF-build executables:
      &quot;perl__.exe&quot; etc. They are ready to be used.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">6.</dt>
  <dd class="It-tag">Change to the &quot;./pod&quot; directory of the build
      tree, download the Perl logo <i>CamelGrayBig.BMP</i>, and run
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  ( perl2ipf &gt; perl.ipf ) |&amp; tee 00ipf
  ipfc /INF perl.ipf |&amp; tee 00inf
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This produces the Perl docs online book &quot;perl.INF&quot;. Install in on
      &quot;BOOKSHELF&quot; path.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">7.</dt>
  <dd class="It-tag">Now is the time to build statically linked executable
      <i>perl_.exe</i> which includes newly-installed via
      &quot;Bundle::OS2_default&quot; modules. Doing testing via
      &quot;CPAN.pm&quot; is going to be painfully slow, since it statically
      links a new executable per XS extension.
    <div style="height: 1.00em;">&#x00A0;</div>
    Here is a possible workaround: create a toplevel <i>Makefile.PL</i> in
      <i></i> <i>$CPANHOME</i><i>/.cpan/build/</i> with contents being (compare
      with &quot;Making executables with a custom collection of statically
      loaded extensions&quot;)
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  use ExtUtils::MakeMaker;
  WriteMakefile NAME =&gt; 'dummy';
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    execute this as
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  perl_5.8.2.exe Makefile.PL &lt;nul |&amp; tee 00aout_c1
  make -k all test &lt;nul |&amp; 00aout_t1
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Again, this procedure should not be absolutely smooth. Some
      &quot;Makefile.PL&quot;'s in subdirectories may be buggy, and would not
      run as &quot;child&quot; scripts. The interdependency of modules can
      strike you; however, since non-XS modules are already installed, the
      prerequisites of most modules have a very good chance to be present.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you discover some glitches, move directories of problematic modules to a
      different location; if these modules are non-XS modules, you may just
      ignore them - they are already installed; the remaining, XS, modules you
      need to install manually one by one.
    <div style="height: 1.00em;">&#x00A0;</div>
    After each such removal you need to rerun the
      &quot;Makefile.PL&quot;/&quot;make&quot; process; usually this procedure
      converges soon. (But be sure to convert all the necessary external C
      libraries from <i>.lib</i> format to <i>.a</i> format: run one of
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  emxaout foo.lib
  emximp -o foo.a foo.lib
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    whichever is appropriate.) Also, make sure that the DLLs for external
      libraries are usable with with executables compiled without
      &quot;-Zmtd&quot; options.
    <div style="height: 1.00em;">&#x00A0;</div>
    When you are sure that only a few subdirectories lead to failures, you may
      want to add &quot;-j4&quot; option to &quot;make&quot; to speed up
      skipping subdirectories with already finished build.
    <div style="height: 1.00em;">&#x00A0;</div>
    When you are satisfied with the results of tests, install the build C
      libraries for extensions:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  make install |&amp; tee 00aout_i
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Now you can rename the file <i>./perl.exe</i> generated during the last
      phase to <i>perl_5.8.2.exe</i>; place it on &quot;PATH&quot;; if there is
      an inter-dependency between some XS modules, you may need to repeat the
      &quot;test&quot;/&quot;install&quot; loop with this new executable and
      some excluded modules - until the procedure converges.
    <div style="height: 1.00em;">&#x00A0;</div>
    Now you have all the necessary <i>.a</i> libraries for these Perl modules in
      the places where Perl builder can find it. Use the perl builder: change to
      an empty directory, create a &quot;dummy&quot; <i>Makefile.PL</i> again,
      and run
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  perl_5.8.2.exe Makefile.PL |&amp; tee 00c
  make perl                  |&amp; tee 00p
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This should create an executable <i>./perl.exe</i> with all the statically
      loaded extensions built in. Compare the generated <i>perlmain.c</i> files
      to make sure that during the iterations the number of loaded extensions
      only increases. Rename <i>./perl.exe</i> to <i>perl_5.8.2.exe</i> on
      &quot;PATH&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    When it converges, you got a functional variant of <i>perl_5.8.2.exe</i>;
      copy it to &quot;perl_.exe&quot;. You are done with generation of the
      local Perl installation.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">8.</dt>
  <dd class="It-tag">Make sure that the installed modules are actually installed
      in the location of the new Perl, and are not inherited from entries of
      @INC given for inheritance from the older versions of Perl: set
      &quot;PERLLIB_582_PREFIX&quot; to redirect the new version of Perl to a
      new location, and copy the installed files to this new location. Redo the
      tests to make sure that the versions of modules inherited from older
      versions of Perl are not needed.
    <div style="height: 1.00em;">&#x00A0;</div>
    Actually, the log output of <i>pod2ipf</i>(1) during the step 6 gives a very
      detailed info about which modules are loaded from which place; so you may
      use it as an additional verification tool.
    <div style="height: 1.00em;">&#x00A0;</div>
    Check that some temporary files did not make into the perl install tree. Run
      something like this
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  pfind . -f &quot;!(/\.(pm|pl|ix|al|h|a|lib|txt|pod|imp|bs|dll|ld|bs|inc|xbm|yml|cgi|uu|e2x|skip|packlist|eg|cfg|html|pub|enc|all|ini|po|pot)$/i or /^\w+$/&quot;) | less
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    in the install tree (both top one and <i>sitelib</i> one).
    <div style="height: 1.00em;">&#x00A0;</div>
    Compress all the DLLs with <i>lxlite</i>. The tiny <i>.exe</i> can be
      compressed with &quot;/c:max&quot; (the bug only appears when there is a
      fixup in the last 6 bytes of a page (?); since the tiny executables are
      much smaller than a page, the bug will not hit). Do not compress
      &quot;perl_.exe&quot; - it would not work under DOS.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">9.</dt>
  <dd class="It-tag">Now you can generate the binary distribution. This is done
      by running the test of the CPAN distribution
      &quot;OS2::SoftInstaller&quot;. Tune up the file <i>test.pl</i> to suit
      the layout of current version of Perl first. Do not forget to pack the
      necessary external DLLs accordingly. Include the description of the bugs
      and test suite failures you could not fix. Include the small-stack
      versions of Perl executables from Perl build directory.
    <div style="height: 1.00em;">&#x00A0;</div>
    Include <i>perl5.def</i> so that people can relink the perl DLL preserving
      the binary compatibility, or can create compatibility DLLs. Include the
      diff files (&quot;diff -pu old new&quot;) of fixes you did so that people
      can rebuild your version. Include <i>perl5.map</i> so that one can use
      remote debugging.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">10.</dt>
  <dd class="It-tag">Share what you did with the other people. Relax. Enjoy
      fruits of your work.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">11.</dt>
  <dd class="It-tag">Brace yourself for thanks, bug reports, hate mail and spam
      coming as result of the previous step. No good deed should remain
      unpunished!</dd>
</dl>
<h1 class="Sh" title="Sh" id="Building_custom_.EXE_files"><a class="selflink" href="#Building_custom_.EXE_files">Building
  custom <i>.EXE</i> files</a></h1>
The Perl executables can be easily rebuilt at any moment. Moreover, one can use
  the <i>embedding</i> interface (see perlembed) to make very customized
  executables.
<h2 class="Ss" title="Ss" id="Making_executables_with_a_custom_collection_of_statically_loaded_extensions"><a class="selflink" href="#Making_executables_with_a_custom_collection_of_statically_loaded_extensions">Making
  executables with a custom collection of statically loaded extensions</a></h2>
It is a little bit easier to do so while <i>decreasing</i> the list of
  statically loaded extensions. We discuss this case only here.
<dl class="Bl-tag">
  <dt class="It-tag">1.</dt>
  <dd class="It-tag">Change to an empty directory, and create a placeholder
      &lt;Makefile.PL&gt;:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  use ExtUtils::MakeMaker;
  WriteMakefile NAME =&gt; 'dummy';
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">2.</dt>
  <dd class="It-tag">Run it with the flavor of Perl (<i>perl.exe</i> or
      <i>perl_.exe</i>) you want to rebuild.
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  perl_ Makefile.PL
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">3.</dt>
  <dd class="It-tag">Ask it to create new Perl executable:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  make perl
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    (you may need to manually add &quot;PERLTYPE=-DPERL_CORE&quot; to this
      commandline on some versions of Perl; the symptom is that the command-line
      globbing does not work from OS/2 shells with the newly-compiled
      executable; check with
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  .\perl.exe -wle &quot;print for @ARGV&quot; *
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    ).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">4.</dt>
  <dd class="It-tag">The previous step created <i>perlmain.c</i> which contains
      a list of <i>newXS()</i> calls near the end. Removing unnecessary calls,
      and rerunning
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  make perl
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    will produce a customized executable.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Making_executables_with_a_custom_search-paths"><a class="selflink" href="#Making_executables_with_a_custom_search-paths">Making
  executables with a custom search-paths</a></h2>
The default perl executable is flexible enough to support most usages. However,
  one may want something yet more flexible; for example, one may want to find
  Perl DLL relatively to the location of the EXE file; or one may want to ignore
  the environment when setting the Perl-library search patch, etc.
<div class="Pp"></div>
If you fill comfortable with <i>embedding</i> interface (see perlembed), such
  things are easy to do repeating the steps outlined in &quot;Making executables
  with a custom collection of statically loaded extensions&quot;, and doing more
  comprehensive edits to <i>main()</i> of <i>perlmain.c</i>. The people with
  little desire to understand Perl can just rename <i>main()</i>, and do
  necessary modification in a custom <i>main()</i> which calls the renamed
  function in appropriate time.
<div class="Pp"></div>
However, there is a third way: perl DLL exports the <i>main()</i> function and
  several callbacks to customize the search path. Below is a complete example of
  a &quot;Perl loader&quot; which
<dl class="Bl-tag">
  <dt class="It-tag">1.</dt>
  <dd class="It-tag">Looks for Perl DLL in the directory
      &quot;$exedir/../dll&quot;;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">2.</dt>
  <dd class="It-tag">Prepends the above directory to
    &quot;BEGINLIBPATH&quot;;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">3.</dt>
  <dd class="It-tag">Fails if the Perl DLL found via &quot;BEGINLIBPATH&quot; is
      different from what was loaded on step 1; e.g., another process could have
      loaded it from &quot;LIBPATH&quot; or from a different value of
      &quot;BEGINLIBPATH&quot;. In these cases one needs to modify the setting
      of the system so that this other process either does not run, or loads the
      DLL from &quot;BEGINLIBPATH&quot; with &quot;LIBPATHSTRICT=T&quot;
      (available with kernels after September 2000).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">4.</dt>
  <dd class="It-tag">Loads Perl library from
    &quot;$exedir/../dll/lib/&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">5.</dt>
  <dd class="It-tag">Uses Bourne shell from
      &quot;$exedir/../dll/sh/ksh.exe&quot;.</dd>
</dl>
<div class="Pp"></div>
For best results compile the C file below with the same options as the Perl DLL.
  However, a lot of functionality will work even if the executable is not an EMX
  applications, e.g., if compiled with
<div class="Pp"></div>
<pre>
  gcc -Wall -DDOSISH -DOS2=1 -O2 -s -Zomf -Zsys perl-starter.c -DPERL_DLL_BASENAME=\&quot;perl312F\&quot; -Zstack 8192 -Zlinker /PM:VIO
</pre>
<div class="Pp"></div>
Here is the sample C file:
<div class="Pp"></div>
<pre>
  #define INCL_DOS
  #define INCL_NOPM
  /* These are needed for compile if os2.h includes os2tk.h, not os2emx.h */
  #define INCL_DOSPROCESS
  #include &lt;os2.h&gt;
  #include &quot;EXTERN.h&quot;
  #define PERL_IN_MINIPERLMAIN_C
  #include &quot;perl.h&quot;
  static char *me;
  HMODULE handle;
  static void
  die_with(char *msg1, char *msg2, char *msg3, char *msg4)
  {
     ULONG c;
     char *s = &quot; error: &quot;;
     DosWrite(2, me, strlen(me), &amp;c);
     DosWrite(2, s, strlen(s), &amp;c);
     DosWrite(2, msg1, strlen(msg1), &amp;c);
     DosWrite(2, msg2, strlen(msg2), &amp;c);
     DosWrite(2, msg3, strlen(msg3), &amp;c);
     DosWrite(2, msg4, strlen(msg4), &amp;c);
     DosWrite(2, &quot;\r\n&quot;, 2, &amp;c);
     exit(255);
  }
  typedef ULONG (*fill_extLibpath_t)(int type, char *pre, char *post, int replace, char *msg);
  typedef int (*main_t)(int type, char *argv[], char *env[]);
  typedef int (*handler_t)(void* data, int which);
  #ifndef PERL_DLL_BASENAME
  #  define PERL_DLL_BASENAME &quot;perl&quot;
  #endif
  static HMODULE
  load_perl_dll(char *basename)
  {
      char buf[300], fail[260];
      STRLEN l, dirl;
      fill_extLibpath_t f;
      ULONG rc_fullname;
      HMODULE handle, handle1;
      if (_execname(buf, sizeof(buf) - 13) != 0)
          die_with(&quot;Can't find full path: &quot;, strerror(errno), &quot;&quot;, &quot;&quot;);
      /* XXXX Fill 'me' with new value */
      l = strlen(buf);
      while (l &amp;&amp; buf[l-1] != '/' &amp;&amp; buf[l-1] != '\\')
          l--;
      dirl = l - 1;
      strcpy(buf + l, basename);
      l += strlen(basename);
      strcpy(buf + l, &quot;.dll&quot;);
      if ( (rc_fullname = DosLoadModule(fail, sizeof fail, buf, &amp;handle)) != 0
           &amp;&amp; DosLoadModule(fail, sizeof fail, basename, &amp;handle) != 0 )
          die_with(&quot;Can't load DLL &quot;, buf, &quot;&quot;, &quot;&quot;);
      if (rc_fullname)
          return handle;                /* was loaded with short name; all is fine */
      if (DosQueryProcAddr(handle, 0, &quot;fill_extLibpath&quot;, (PFN*)&amp;f))
          die_with(buf, &quot;: DLL exports no symbol &quot;, &quot;fill_extLibpath&quot;, &quot;&quot;);
      buf[dirl] = 0;
      if (f(0 /*BEGINLIBPATH*/, buf /* prepend */, NULL /* append */,
            0 /* keep old value */, me))
          die_with(me, &quot;: prepending BEGINLIBPATH&quot;, &quot;&quot;, &quot;&quot;);
      if (DosLoadModule(fail, sizeof fail, basename, &amp;handle1) != 0)
          die_with(me, &quot;: finding perl DLL again via BEGINLIBPATH&quot;, &quot;&quot;, &quot;&quot;);
      buf[dirl] = '\\';     
      if (handle1 != handle) {
          if (DosQueryModuleName(handle1, sizeof(fail), fail))
              strcpy(fail, &quot;???&quot;);
          die_with(buf, &quot;:\n\tperl DLL via BEGINLIBPATH is different: \n\t&quot;,
                   fail,
                   &quot;\n\tYou may need to manipulate global BEGINLIBPATH and LIBPATHSTRICT&quot;
                   &quot;\n\tso that the other copy is loaded via BEGINLIBPATH.&quot;);
      }
      return handle;
  }
  int
  main(int argc, char **argv, char **env)
  {
      main_t f;
      handler_t h;
      me = argv[0];
      /**/
      handle = load_perl_dll(PERL_DLL_BASENAME);
      if (DosQueryProcAddr(handle, 0, &quot;Perl_OS2_handler_install&quot;, (PFN*)&amp;h))
          die_with(PERL_DLL_BASENAME, &quot;: DLL exports no symbol &quot;, &quot;Perl_OS2_handler_install&quot;, &quot;&quot;);
      if ( !h((void *)&quot;~installprefix&quot;, Perlos2_handler_perllib_from)
           || !h((void *)&quot;~dll&quot;, Perlos2_handler_perllib_to)
           || !h((void *)&quot;~dll/sh/ksh.exe&quot;, Perlos2_handler_perl_sh) )
          die_with(PERL_DLL_BASENAME, &quot;: Can't install @INC manglers&quot;, &quot;&quot;, &quot;&quot;);
      if (DosQueryProcAddr(handle, 0, &quot;dll_perlmain&quot;, (PFN*)&amp;f))
          die_with(PERL_DLL_BASENAME, &quot;: DLL exports no symbol &quot;, &quot;dll_perlmain&quot;, &quot;&quot;);
      return f(argc, argv, env);
  }
</pre>
<h1 class="Sh" title="Sh" id="Build_FAQ"><a class="selflink" href="#Build_FAQ">Build
  FAQ</a></h1>
<h2 class="Ss" title="Ss" id="Some_&quot;/&quot;_became_&quot;\&quot;_in_pdksh."><a class="selflink" href="#Some_&quot;/&quot;_became_&quot;\&quot;_in_pdksh.">Some
  &quot;/&quot; became &quot;\&quot; in pdksh.</a></h2>
You have a very old pdksh. See &quot;Prerequisites&quot;.
<h2 class="Ss" title="Ss" id="'errno'_-_unresolved_external"><a class="selflink" href="#'errno'_-_unresolved_external">'errno'
  - unresolved external</a></h2>
You do not have MT-safe <i>db.lib</i>. See &quot;Prerequisites&quot;.
<h2 class="Ss" title="Ss" id="Problems_with_tr_or_sed"><a class="selflink" href="#Problems_with_tr_or_sed">Problems
  with tr or sed</a></h2>
reported with very old version of tr and sed.
<h2 class="Ss" title="Ss" id="Some_problem_(forget_which_;-)"><a class="selflink" href="#Some_problem_(forget_which_;-)">Some
  problem (forget which ;-)</a></h2>
You have an older version of <i>perl.dll</i> on your LIBPATH, which broke the
  build of extensions.
<h2 class="Ss" title="Ss" id="Library_..._not_found"><a class="selflink" href="#Library_..._not_found">Library
  ... not found</a></h2>
You did not run &quot;omflibs&quot;. See &quot;Prerequisites&quot;.
<h2 class="Ss" title="Ss" id="Segfault_in_make"><a class="selflink" href="#Segfault_in_make">Segfault
  in make</a></h2>
You use an old version of GNU make. See &quot;Prerequisites&quot;.
<h2 class="Ss" title="Ss" id="op/sprintf_test_failure"><a class="selflink" href="#op/sprintf_test_failure">op/sprintf
  test failure</a></h2>
This can result from a bug in emx sprintf which was fixed in 0.9d fix 03.
<h1 class="Sh" title="Sh" id="Specific_(mis)features_of_OS/2_port"><a class="selflink" href="#Specific_(mis)features_of_OS/2_port">Specific
  (mis)features of OS/2 port</a></h1>
<h2 class="Ss" title="Ss" id="&quot;setpriority&quot;,_&quot;getpriority&quot;"><a class="selflink" href="#&quot;setpriority&quot;,_&quot;getpriority&quot;">&quot;setpriority&quot;,
  &quot;getpriority&quot;</a></h2>
Note that these functions are compatible with *nix, not with the older ports of
  '94 - 95. The priorities are absolute, go from 32 to -95, lower is quicker. 0
  is the default priority.
<div class="Pp"></div>
<b>WARNING</b>. Calling &quot;getpriority&quot; on a non-existing process could
  lock the system before Warp3 fixpak22. Starting with Warp3, Perl will use a
  workaround: it aborts <i>getpriority()</i> if the process is not present. This
  is not possible on older versions &quot;2.*&quot;, and has a race condition
  anyway.
<h2 class="Ss" title="Ss" id="&quot;system()&quot;"><a class="selflink" href="#&quot;system()&quot;">&quot;system()&quot;</a></h2>
Multi-argument form of &quot;system()&quot; allows an additional numeric
  argument. The meaning of this argument is described in OS2::Process.
<div class="Pp"></div>
When finding a program to run, Perl first asks the OS to look for executables on
  &quot;PATH&quot; (OS/2 adds extension <i>.exe</i> if no extension is present).
  If not found, it looks for a script with possible extensions added in this
  order: no extension, <i>.cmd</i>, <i>.btm</i>, <i>.bat</i>, <i>.pl</i>. If
  found, Perl checks the start of the file for magic strings &quot;#!&quot; and
  &quot;extproc &quot;. If found, Perl uses the rest of the first line as the
  beginning of the command line to run this script. The only mangling done to
  the first line is extraction of arguments (currently up to 3), and ignoring of
  the path-part of the &quot;interpreter&quot; name if it can't be found using
  the full path.
<div class="Pp"></div>
E.g., &quot;system 'foo', 'bar', 'baz'&quot; may lead Perl to finding
  <i>C:/emx/bin/foo.cmd</i> with the first line being
<div class="Pp"></div>
<pre>
 extproc /bin/bash    -x   -c
</pre>
<div class="Pp"></div>
If <i>/bin/bash.exe</i> is not found, then Perl looks for an executable
  <i>bash.exe</i> on &quot;PATH&quot;. If found in
  <i>C:/emx.add/bin/bash.exe</i>, then the above <i>system()</i> is translated
  to
<div class="Pp"></div>
<pre>
  system qw(C:/emx.add/bin/bash.exe -x -c C:/emx/bin/foo.cmd bar baz)
</pre>
<div class="Pp"></div>
One additional translation is performed: instead of <i>/bin/sh</i> Perl uses the
  hardwired-or-customized shell (see &quot;PERL_SH_DIR&quot;).
<div class="Pp"></div>
The above search for &quot;interpreter&quot; is recursive: if <i>bash</i>
  executable is not found, but <i>bash.btm</i> is found, Perl will investigate
  its first line etc. The only hardwired limit on the recursion depth is
  implicit: there is a limit 4 on the number of additional arguments inserted
  before the actual arguments given to <i>system()</i>. In particular, if no
  additional arguments are specified on the &quot;magic&quot; first lines, then
  the limit on the depth is 4.
<div class="Pp"></div>
If Perl finds that the found executable is of PM type when the current session
  is not, it will start the new process in a separate session of necessary type.
  Call via &quot;OS2::Process&quot; to disable this magic.
<div class="Pp"></div>
<b>WARNING</b>. Due to the described logic, you need to explicitly specify
  <i>.com</i> extension if needed. Moreover, if the executable <i>perl5.6.1</i>
  is requested, Perl will not look for <i>perl5.6.1.exe</i>. [This may change in
  the future.]
<h2 class="Ss" title="Ss" id="&quot;extproc&quot;_on_the_first_line"><a class="selflink" href="#&quot;extproc&quot;_on_the_first_line">&quot;extproc&quot;
  on the first line</a></h2>
If the first chars of a Perl script are &quot;extproc &quot;, this line is
  treated as &quot;#!&quot;-line, thus all the switches on this line are
  processed (twice if script was started via cmd.exe). See
  &quot;DESCRIPTION&quot; in perlrun.
<h2 class="Ss" title="Ss" id="Additional_modules:"><a class="selflink" href="#Additional_modules:">Additional
  modules:</a></h2>
OS2::Process, OS2::DLL, OS2::REXX, OS2::PrfDB, OS2::ExtAttr. These modules
  provide access to additional numeric argument for &quot;system&quot; and to
  the information about the running process, to DLLs having functions with REXX
  signature and to the REXX runtime, to OS/2 databases in the <i>.INI</i>
  format, and to Extended Attributes.
<div class="Pp"></div>
Two additional extensions by Andreas Kaiser, &quot;OS2::UPM&quot;, and
  &quot;OS2::FTP&quot;, are included into &quot;ILYAZ&quot; directory, mirrored
  on CPAN. Other OS/2-related extensions are available too.
<h2 class="Ss" title="Ss" id="Prebuilt_methods:"><a class="selflink" href="#Prebuilt_methods:">Prebuilt
  methods:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;File::Copy::syscopy&quot;</dt>
  <dd class="It-tag">used by &quot;File::Copy::copy&quot;, see File::Copy.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;DynaLoader::mod2fname&quot;</dt>
  <dd class="It-tag">used by &quot;DynaLoader&quot; for DLL name mangling.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;Cwd::current_drive()&quot;</dt>
  <dd class="It-tag">Self explanatory.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;Cwd::sys_chdir(name)&quot;</dt>
  <dd class="It-tag">leaves drive as it is.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;Cwd::change_drive(name)&quot;</dt>
  <dd class="It-tag">changes the &quot;current&quot; drive.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;Cwd::sys_is_absolute(name)&quot;</dt>
  <dd class="It-tag">means has drive letter and is_rooted.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;Cwd::sys_is_rooted(name)&quot;</dt>
  <dd class="It-tag">means has leading &quot;[/\\]&quot; (maybe after a
      drive-letter:).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;Cwd::sys_is_relative(name)&quot;</dt>
  <dd class="It-tag">means changes with current dir.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;Cwd::sys_cwd(name)&quot;</dt>
  <dd class="It-tag">Interface to cwd from EMX. Used by
    &quot;Cwd::cwd&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;Cwd::sys_abspath(name, dir)&quot;</dt>
  <dd class="It-tag">Really really odious function to implement. Returns
      absolute name of file which would have &quot;name&quot; if CWD were
      &quot;dir&quot;. &quot;Dir&quot; defaults to the current dir.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;Cwd::extLibpath([type])&quot;</dt>
  <dd class="It-tag">Get current value of extended library search path. If
      &quot;type&quot; is present and positive, works with
      &quot;END_LIBPATH&quot;, if negative, works with
      &quot;LIBPATHSTRICT&quot;, otherwise with &quot;BEGIN_LIBPATH&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;Cwd::extLibpath_set( path [, type ] )&quot;</dt>
  <dd class="It-tag">Set current value of extended library search path. If
      &quot;type&quot; is present and positive, works with &lt;END_LIBPATH&gt;,
      if negative, works with &quot;LIBPATHSTRICT&quot;, otherwise with
      &quot;BEGIN_LIBPATH&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;OS2::Error(do_harderror,do_exception)&quot;</dt>
  <dd class="It-tag">Returns	&quot;undef&quot; if it was not called yet,
      otherwise bit 1 is set if on the previous call do_harderror was enabled,
      bit 2 is set if on previous call do_exception was enabled.
    <div style="height: 1.00em;">&#x00A0;</div>
    This function enables/disables error popups associated with hardware errors
      (Disk not ready etc.) and software exceptions.
    <div style="height: 1.00em;">&#x00A0;</div>
    I know of no way to find out the state of popups <i>before</i> the first
      call to this function.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;OS2::Errors2Drive(drive)&quot;</dt>
  <dd class="It-tag">Returns &quot;undef&quot; if it was not called yet,
      otherwise return false if errors were not requested to be written to a
      hard drive, or the drive letter if this was requested.
    <div style="height: 1.00em;">&#x00A0;</div>
    This function may redirect error popups associated with hardware errors
      (Disk not ready etc.) and software exceptions to the file POPUPLOG.OS2 at
      the root directory of the specified drive. Overrides <i>OS2::Error()</i>
      specified by individual programs. Given argument undef will disable
      redirection.
    <div style="height: 1.00em;">&#x00A0;</div>
    Has global effect, persists after the application exits.
    <div style="height: 1.00em;">&#x00A0;</div>
    I know of no way to find out the state of redirection of popups to the disk
      <i>before</i> the first call to this function.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>OS2::SysInfo()</i></dt>
  <dd class="It-tag">Returns a hash with system information. The keys of the
      hash are
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
        MAX_PATH_LENGTH, MAX_TEXT_SESSIONS, MAX_PM_SESSIONS,
        MAX_VDM_SESSIONS, BOOT_DRIVE, DYN_PRI_VARIATION,
        MAX_WAIT, MIN_SLICE, MAX_SLICE, PAGE_SIZE,
        VERSION_MAJOR, VERSION_MINOR, VERSION_REVISION,
        MS_COUNT, TIME_LOW, TIME_HIGH, TOTPHYSMEM, TOTRESMEM,
        TOTAVAILMEM, MAXPRMEM, MAXSHMEM, TIMER_INTERVAL,
        MAX_COMP_LENGTH, FOREGROUND_FS_SESSION,
        FOREGROUND_PROCESS
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>OS2::BootDrive()</i></dt>
  <dd class="It-tag">Returns a letter without colon.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;OS2::MorphPM(serve)&quot;,
    &quot;OS2::UnMorphPM(serve)&quot;</dt>
  <dd class="It-tag">Transforms the current application into a PM application
      and back. The argument true means that a real message loop is going to be
      served. <i>OS2::MorphPM()</i> returns the PM message queue handle as an
      integer.
    <div style="height: 1.00em;">&#x00A0;</div>
    See &quot;Centralized management of resources&quot; for additional
    details.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;OS2::Serve_Messages(force)&quot;</dt>
  <dd class="It-tag">Fake on-demand retrieval of outstanding PM messages. If
      &quot;force&quot; is false, will not dispatch messages if a real message
      loop is known to be present. Returns number of messages retrieved.
    <div style="height: 1.00em;">&#x00A0;</div>
    Dies with &quot;QUITing...&quot; if WM_QUIT message is obtained.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;OS2::Process_Messages(force [, cnt])&quot;</dt>
  <dd class="It-tag">Retrieval of PM messages until window creation/destruction.
      If &quot;force&quot; is false, will not dispatch messages if a real
      message loop is known to be present.
    <div style="height: 1.00em;">&#x00A0;</div>
    Returns change in number of windows. If &quot;cnt&quot; is given, it is
      incremented by the number of messages retrieved.
    <div style="height: 1.00em;">&#x00A0;</div>
    Dies with &quot;QUITing...&quot; if WM_QUIT message is obtained.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;OS2::_control87(new,mask)&quot;</dt>
  <dd class="It-tag">the same as <i>_control87</i>(3) of EMX. Takes integers as
      arguments, returns the previous coprocessor control word as an integer.
      Only bits in &quot;new&quot; which are present in &quot;mask&quot; are
      changed in the control word.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>OS2::get_control87()</i></dt>
  <dd class="It-tag">gets the coprocessor control word as an integer.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;OS2::set_control87_em(new=MCW_EM,mask=MCW_EM)&quot;</dt>
  <dd class="It-tag">The variant of <i>OS2::_control87()</i> with default values
      good for handling exception mask: if no &quot;mask&quot;, uses exception
      mask part of &quot;new&quot; only. If no &quot;new&quot;, disables all the
      floating point exceptions.
    <div style="height: 1.00em;">&#x00A0;</div>
    See &quot;Misfeatures&quot; for details.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;OS2::DLLname([how [, \&amp;xsub]])&quot;</dt>
  <dd class="It-tag">Gives the information about the Perl DLL or the DLL
      containing the C function bound to by &amp;xsub. The meaning of
      &quot;how&quot; is: default (2): full name; 0: handle; 1: module
    name.</dd>
</dl>
<div class="Pp"></div>
(Note that some of these may be moved to different libraries - eventually).
<h2 class="Ss" title="Ss" id="Prebuilt_variables:"><a class="selflink" href="#Prebuilt_variables:">Prebuilt
  variables:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">$OS2::emx_rev</dt>
  <dd class="It-tag">numeric value is the same as _emx_rev of EMX, a string
      value the same as _emx_vprt (similar to &quot;0.9c&quot;).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$OS2::emx_env</dt>
  <dd class="It-tag">same as _emx_env of EMX, a number similar to 0x8001.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$OS2::os_ver</dt>
  <dd class="It-tag">a number &quot;OS_MAJOR + 0.001 * OS_MINOR&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$OS2::is_aout</dt>
  <dd class="It-tag">true if the Perl library was compiled in AOUT format.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$OS2::can_fork</dt>
  <dd class="It-tag">true if the current executable is an AOUT EMX executable,
      so Perl can fork. Do not use this, use the portable check for
      $Config::Config{dfork}.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">$OS2::nsyserror</dt>
  <dd class="It-tag">This variable (default is 1) controls whether to enforce
      the contents of $^E to start with &quot;SYS0003&quot;-like id. If set to
      0, then the string value of $^E is what is available from the OS/2 message
      file. (Some messages in this file have an &quot;SYS0003&quot;-like id
      prepended, some not.)</dd>
</dl>
<h2 class="Ss" title="Ss" id="Misfeatures"><a class="selflink" href="#Misfeatures">Misfeatures</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Since <i>flock</i>(3) is present in EMX, but is not
      functional, it is emulated by perl. To disable the emulations, set
      environment variable &quot;USE_PERL_FLOCK=0&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Here is the list of things which may be &quot;broken&quot;
      on EMX (from EMX docs):</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The functions <i>recvmsg</i>(3), <i>sendmsg</i>(3), and
      <i>socketpair</i>(3) are not implemented.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>sock_init</i>(3) is not required and not
    implemented.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>flock</i>(3) is not yet implemented (dummy function).
      (Perl has a workaround.)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>kill</i>(3): Special treatment of PID=0, PID=1 and
      PID=-1 is not implemented.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>waitpid</i>(3):
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
      WUNTRACED
              Not implemented.
      waitpid() is not implemented for negative values of PID.
    </pre>
  </dd>
</dl>
</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
Note that &quot;kill -9&quot; does not work with the current version of
  EMX.</div>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">See &quot;Text-mode filehandles&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Unix-domain sockets on OS/2 live in a pseudo-file-system
      &quot;/sockets/...&quot;. To avoid a failure to create a socket with a
      name of a different form, &quot;/socket/&quot; is prepended to the socket
      name (unless it starts with this already).
    <div style="height: 1.00em;">&#x00A0;</div>
    This may lead to problems later in case the socket is accessed via the
      &quot;usual&quot; file-system calls using the &quot;initial&quot;
    name.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Apparently, IBM used a compiler (for some period of time
      around '95?) which changes FP mask right and left. This is not <i>that</i>
      bad for IBM's programs, but the same compiler was used for DLLs which are
      used with general-purpose applications. When these DLLs are used, the
      state of floating-point flags in the application is not predictable.
    <div style="height: 1.00em;">&#x00A0;</div>
    What is much worse, some DLLs change the floating point flags when in
      <i>_DLLInitTerm()</i> (e.g., <i>TCP32IP</i>). This means that even if you
      do not <i>call</i> any function in the DLL, just the act of loading this
      DLL will reset your flags. What is worse, the same compiler was used to
      compile some HOOK DLLs. Given that HOOK dlls are executed in the context
      of <i>all</i> the applications in the system, this means a complete
      unpredictability of floating point flags on systems using such HOOK DLLs.
      E.g., <i>GAMESRVR.DLL</i> of <b>DIVE</b> origin changes the floating point
      flags on each write to the TTY of a VIO (windowed text-mode) applications.
    <div style="height: 1.00em;">&#x00A0;</div>
    Some other (not completely debugged) situations when FP flags change include
      some video drivers (?), and some operations related to creation of the
      windows. People who code <b>OpenGL</b> may have more experience on this.
    <div style="height: 1.00em;">&#x00A0;</div>
    Perl is generally used in the situation when all the floating-point
      exceptions are ignored, as is the default under EMX. If they are not
      ignored, some benign Perl programs would get a &quot;SIGFPE&quot; and
      would die a horrible death.
    <div style="height: 1.00em;">&#x00A0;</div>
    To circumvent this, Perl uses two hacks. They help against <i>one</i> type
      of damage only: FP flags changed when loading a DLL.
    <div style="height: 1.00em;">&#x00A0;</div>
    One of the hacks is to disable floating point exceptions on Perl startup (as
      is the default with EMX). This helps only with compile-time-linked DLLs
      changing the flags before <i>main()</i> had a chance to be called.
    <div style="height: 1.00em;">&#x00A0;</div>
    The other hack is to restore FP flags after a call to <i>dlopen()</i>. This
      helps against similar damage done by DLLs <i>_DLLInitTerm()</i> at
      runtime. Currently no way to switch these hacks off is provided.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Modifications"><a class="selflink" href="#Modifications">Modifications</a></h2>
Perl modifies some standard C library calls in the following ways:
<dl class="Bl-tag">
  <dt class="It-tag">&quot;popen&quot;</dt>
  <dd class="It-tag">&quot;my_popen&quot; uses <i>sh.exe</i> if shell is
      required, cf. &quot;PERL_SH_DIR&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;tmpnam&quot;</dt>
  <dd class="It-tag">is created using &quot;TMP&quot; or &quot;TEMP&quot;
      environment variable, via &quot;tempnam&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;tmpfile&quot;</dt>
  <dd class="It-tag">If the current directory is not writable, file is created
      using modified &quot;tmpnam&quot;, so there may be a race condition.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;ctermid&quot;</dt>
  <dd class="It-tag">a dummy implementation.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;stat&quot;</dt>
  <dd class="It-tag">&quot;os2_stat&quot; special-cases <i>/dev/tty</i> and
      <i>/dev/con</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;mkdir&quot;, &quot;rmdir&quot;</dt>
  <dd class="It-tag">these EMX functions do not work if the path contains a
      trailing &quot;/&quot;. Perl contains a workaround for this.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;flock&quot;</dt>
  <dd class="It-tag">Since <i>flock</i>(3) is present in EMX, but is not
      functional, it is emulated by perl. To disable the emulations, set
      environment variable &quot;USE_PERL_FLOCK=0&quot;.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Identifying_DLLs"><a class="selflink" href="#Identifying_DLLs">Identifying
  DLLs</a></h2>
All the DLLs built with the current versions of Perl have ID strings identifying
  the name of the extension, its version, and the version of Perl required for
  this DLL. Run &quot;bldlevel DLL-name&quot; to find this info.
<h2 class="Ss" title="Ss" id="Centralized_management_of_resources"><a class="selflink" href="#Centralized_management_of_resources">Centralized
  management of resources</a></h2>
Since to call certain OS/2 API one needs to have a correctly initialized
  &quot;Win&quot; subsystem, OS/2-specific extensions may require getting
  &quot;HAB&quot;s and &quot;HMQ&quot;s. If an extension would do it on its own,
  another extension could fail to initialize.
<div class="Pp"></div>
Perl provides a centralized management of these resources:
<dl class="Bl-tag">
  <dt class="It-tag">&quot;HAB&quot;</dt>
  <dd class="It-tag">To get the HAB, the extension should call &quot;hab =
      perl_hab_GET()&quot; in C. After this call is performed, &quot;hab&quot;
      may be accessed as &quot;Perl_hab&quot;. There is no need to release the
      HAB after it is used.
    <div style="height: 1.00em;">&#x00A0;</div>
    If by some reasons <i>perl.h</i> cannot be included, use
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  extern int Perl_hab_GET(void);
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    instead.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;HMQ&quot;</dt>
  <dd class="It-tag">There are two cases:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">the extension needs an &quot;HMQ&quot; only because some
      API will not work otherwise. Use &quot;serve = 0&quot; below.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">the extension needs an &quot;HMQ&quot; since it wants to
      engage in a PM event loop. Use &quot;serve = 1&quot; below.</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
To get an &quot;HMQ&quot;, the extension should call &quot;hmq =
  perl_hmq_GET(serve)&quot; in C. After this call is performed, &quot;hmq&quot;
  may be accessed as &quot;Perl_hmq&quot;.
<div style="height: 1.00em;">&#x00A0;</div>
To signal to Perl that HMQ is not needed any more, call
  &quot;perl_hmq_UNSET(serve)&quot;. Perl process will automatically
  morph/unmorph itself into/from a PM process if HMQ is needed/not-needed. Perl
  will automatically enable/disable &quot;WM_QUIT&quot; message during shutdown
  if the message queue is served/not-served.
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE</b>. If during a shutdown there is a message queue which did not disable
  WM_QUIT, and which did not process the received WM_QUIT message, the shutdown
  will be automatically cancelled. Do not call perl_hmq_GET(1) unless you are
  going to process messages on an orderly basis.</div>
<dl class="Bl-tag">
  <dt class="It-tag">Treating errors reported by OS/2 API</dt>
  <dd class="It-tag">There are two principal conventions (it is useful to call
      them &quot;Dos*&quot; and &quot;Win*&quot; - though this part of the
      function signature is not always determined by the name of the API) of
      reporting the error conditions of OS/2 API. Most of &quot;Dos*&quot; APIs
      report the error code as the result of the call (so 0 means success, and
      there are many types of errors). Most of &quot;Win*&quot; API report
      success/fail via the result being &quot;TRUE&quot;/&quot;FALSE&quot;; to
      find the reason for the failure one should call <i>WinGetLastError()</i>
      API.
    <div style="height: 1.00em;">&#x00A0;</div>
    Some &quot;Win*&quot; entry points also overload a &quot;meaningful&quot;
      return value with the error indicator; having a 0 return value indicates
      an error. Yet some other &quot;Win*&quot; entry points overload things
      even more, and 0 return value may mean a successful call returning a valid
      value 0, as well as an error condition; in the case of a 0 return value
      one should call <i>WinGetLastError()</i> API to distinguish a successful
      call from a failing one.
    <div style="height: 1.00em;">&#x00A0;</div>
    By convention, all the calls to OS/2 API should indicate their failures by
      resetting $^E. All the Perl-accessible functions which call OS/2 API may
      be broken into two classes: some <i>die()</i>s when an API error is
      encountered, the other report the error via a false return value (of
      course, this does not concern Perl-accessible functions which
      <i>expect</i> a failure of the OS/2 API call, having some workarounds
      coded).
    <div style="height: 1.00em;">&#x00A0;</div>
    Obviously, in the situation of the last type of the signature of an OS/2
      API, it is must more convenient for the users if the failure is indicated
      by <i>die()</i>ing: one does not need to check $^E to know that something
      went wrong. If, however, this solution is not desirable by some reason,
      the code in question should reset $^E to 0 before making this OS/2 API
      call, so that the caller of this Perl-accessible function has a chance to
      distinguish a success-but-0-return value from a failure. (One may return
      undef as an alternative way of reporting an error.)
    <div style="height: 1.00em;">&#x00A0;</div>
    The macros to simplify this type of error propagation are</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&quot;CheckOSError(expr)&quot;</dt>
  <dd class="It-tag">Returns true on error, sets $^E. Expects <i>expr()</i> be a
      call of &quot;Dos*&quot;-style API.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;CheckWinError(expr)&quot;</dt>
  <dd class="It-tag">Returns true on error, sets $^E. Expects <i>expr()</i> be a
      call of &quot;Win*&quot;-style API.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;SaveWinError(expr)&quot;</dt>
  <dd class="It-tag">Returns &quot;expr&quot;, sets $^E from
      <i>WinGetLastError()</i> if &quot;expr&quot; is false.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;SaveCroakWinError(expr,die,name1,name2)&quot;</dt>
  <dd class="It-tag">Returns &quot;expr&quot;, sets $^E from
      <i>WinGetLastError()</i> if &quot;expr&quot; is false, and <i>die()</i>s
      if &quot;die&quot; and $^E are true. The message to die is the
      concatenated strings &quot;name1&quot; and &quot;name2&quot;, separated by
      &quot;: &quot; from the contents of $^E.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;WinError_2_Perl_rc&quot;</dt>
  <dd class="It-tag">Sets &quot;Perl_rc&quot; to the return value of
      <i>WinGetLastError()</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;FillWinError&quot;</dt>
  <dd class="It-tag">Sets &quot;Perl_rc&quot; to the return value of
      <i>WinGetLastError()</i>, and sets $^E to the corresponding value.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;FillOSError(rc)&quot;</dt>
  <dd class="It-tag">Sets &quot;Perl_rc&quot; to &quot;rc&quot;, and sets $^E to
      the corresponding value.</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;"></div>
<dl class="Bl-tag">
  <dt class="It-tag">Loading DLLs and ordinals in DLLs</dt>
  <dd class="It-tag">Some DLLs are only present in some versions of OS/2, or in
      some configurations of OS/2. Some exported entry points are present only
      in DLLs shipped with some versions of OS/2. If these DLLs and entry points
      were linked directly for a Perl executable/DLL or from a Perl extensions,
      this binary would work only with the specified versions/setups. Even if
      these entry points were not needed, the <i>load</i> of the executable (or
      DLL) would fail.
    <div style="height: 1.00em;">&#x00A0;</div>
    For example, many newer useful APIs are not present in OS/2 v2; many
      PM-related APIs require DLLs not available on floppy-boot setup.
    <div style="height: 1.00em;">&#x00A0;</div>
    To make these calls fail <i>only when the calls are executed</i>, one should
      call these API via a dynamic linking API. There is a subsystem in Perl to
      simplify such type of calls. A large number of entry points available for
      such linking is provided (see &quot;entries_ordinals&quot; - and also
      &quot;PMWIN_entries&quot; - in <i>os2ish.h</i>). These ordinals can be
      accessed via the APIs:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  CallORD(), DeclFuncByORD(), DeclVoidFuncByORD(),
  DeclOSFuncByORD(), DeclWinFuncByORD(), AssignFuncPByORD(),
  DeclWinFuncByORD_CACHE(), DeclWinFuncByORD_CACHE_survive(),
  DeclWinFuncByORD_CACHE_resetError_survive(),
  DeclWinFunc_CACHE(), DeclWinFunc_CACHE_resetError(),
  DeclWinFunc_CACHE_survive(), DeclWinFunc_CACHE_resetError_survive()
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    See the header files and the C code in the supplied OS/2-related modules for
      the details on usage of these functions.
    <div style="height: 1.00em;">&#x00A0;</div>
    Some of these functions also combine dynaloading semantic with the
      error-propagation semantic discussed above.</dd>
</dl>
<h1 class="Sh" title="Sh" id="Perl_flavors"><a class="selflink" href="#Perl_flavors">Perl
  flavors</a></h1>
Because of idiosyncrasies of OS/2 one cannot have all the eggs in the same
  basket (though EMX environment tries hard to overcome this limitations, so the
  situation may somehow improve). There are 4 executables for Perl provided by
  the distribution:
<h2 class="Ss" title="Ss" id="perl.exe"><a class="selflink" href="#perl.exe"><i>perl.exe</i></a></h2>
The main workhorse. This is a chimera executable: it is compiled as an
  &quot;a.out&quot;-style executable, but is linked with &quot;omf&quot;-style
  dynamic library <i>perl.dll</i>, and with dynamic CRT DLL. This executable is
  a VIO application.
<div class="Pp"></div>
It can load perl dynamic extensions, and it can <i>fork()</i>.
<div class="Pp"></div>
<b>Note.</b> Keep in mind that <i>fork()</i> is needed to open a pipe to
  yourself.
<h2 class="Ss" title="Ss" id="perl_.exe"><a class="selflink" href="#perl_.exe"><i>perl_.exe</i></a></h2>
This is a statically linked &quot;a.out&quot;-style executable. It cannot load
  dynamic Perl extensions. The executable supplied in binary distributions has a
  lot of extensions prebuilt, thus the above restriction is important only if
  you use custom-built extensions. This executable is a VIO application.
<div class="Pp"></div>
<i>This is the only executable with does not require OS/2.</i> The friends
  locked into &quot;M$&quot; world would appreciate the fact that this
  executable runs under DOS, Win0.3*, Win0.95 and WinNT with an appropriate
  extender. See &quot;Other OSes&quot;.
<h2 class="Ss" title="Ss" id="perl__.exe"><a class="selflink" href="#perl__.exe"><i>perl__.exe</i></a></h2>
This is the same executable as <i>perl___.exe</i>, but it is a PM application.
<div class="Pp"></div>
<b>Note.</b> Usually (unless explicitly redirected during the startup) STDIN,
  STDERR, and STDOUT of a PM application are redirected to <i>nul</i>. However,
  it is possible to <i>see</i> them if you start &quot;perl__.exe&quot; from a
  PM program which emulates a console window, like <i>Shell mode</i> of Emacs or
  EPM. Thus it <i>is</i> <i>possible</i> to use Perl debugger (see perldebug) to
  debug your PM application (but beware of the message loop lockups - this will
  not work if you have a message queue to serve, unless you hook the serving
  into the <i>getc()</i> function of the debugger).
<div class="Pp"></div>
Another way to see the output of a PM program is to run it as
<div class="Pp"></div>
<pre>
  pm_prog args 2&gt;&amp;1 | cat -
</pre>
<div class="Pp"></div>
with a shell <i>different</i> from <i>cmd.exe</i>, so that it does not create a
  link between a VIO session and the session of &quot;pm_porg&quot;. (Such a
  link closes the VIO window.) E.g., this works with <i>sh.exe</i> - or with
  Perl!
<div class="Pp"></div>
<pre>
  open P, 'pm_prog args 2&gt;&amp;1 |' or die;
  print while &lt;P&gt;;
</pre>
<div class="Pp"></div>
The flavor <i>perl__.exe</i> is required if you want to start your program
  without a VIO window present, but not &quot;detach&quot;ed (run &quot;help
  detach&quot; for more info). Very useful for extensions which use PM, like
  &quot;Perl/Tk&quot; or &quot;OpenGL&quot;.
<div class="Pp"></div>
Note also that the differences between PM and VIO executables are only in the
  <i>default</i> behaviour. One can start <i>any</i> executable in <i>any</i>
  kind of session by using the arguments &quot;/fs&quot;, &quot;/pm&quot; or
  &quot;/win&quot; switches of the command &quot;start&quot; (of <i>CMD.EXE</i>
  or a similar shell). Alternatively, one can use the numeric first argument of
  the &quot;system&quot; Perl function (see OS2::Process).
<h2 class="Ss" title="Ss" id="perl___.exe"><a class="selflink" href="#perl___.exe"><i>perl___.exe</i></a></h2>
This is an &quot;omf&quot;-style executable which is dynamically linked to
  <i>perl.dll</i> and CRT DLL. I know no advantages of this executable over
  &quot;perl.exe&quot;, but it cannot <i>fork()</i> at all. Well, one advantage
  is that the build process is not so convoluted as with &quot;perl.exe&quot;.
<div class="Pp"></div>
It is a VIO application.
<h2 class="Ss" title="Ss" id="Why_strange_names?"><a class="selflink" href="#Why_strange_names?">Why
  strange names?</a></h2>
Since Perl processes the &quot;#!&quot;-line (cf. &quot;DESCRIPTION&quot; in
  perlrun, &quot;Command Switches&quot; in perlrun, &quot;No Perl script found
  in input&quot; in perldiag), it should know when a program <i>is a Perl</i>.
  There is some naming convention which allows Perl to distinguish correct lines
  from wrong ones. The above names are almost the only names allowed by this
  convention which do not contain digits (which have absolutely different
  semantics).
<h2 class="Ss" title="Ss" id="Why_dynamic_linking?"><a class="selflink" href="#Why_dynamic_linking?">Why
  dynamic linking?</a></h2>
Well, having several executables dynamically linked to the same huge library has
  its advantages, but this would not substantiate the additional work to make it
  compile. The reason is the complicated-to-developers but very quick and
  convenient-to-users &quot;hard&quot; dynamic linking used by OS/2.
<div class="Pp"></div>
There are two distinctive features of the dyna-linking model of OS/2: first, all
  the references to external functions are resolved at the compile time; second,
  there is no runtime fixup of the DLLs after they are loaded into memory. The
  first feature is an enormous advantage over other models: it avoids conflicts
  when several DLLs used by an application export entries with the same name. In
  such cases &quot;other&quot; models of dyna-linking just choose between these
  two entry points using some random criterion - with predictable disasters as
  results. But it is the second feature which requires the build of
  <i>perl.dll</i>.
<div class="Pp"></div>
The address tables of DLLs are patched only once, when they are loaded. The
  addresses of the entry points into DLLs are guaranteed to be the same for all
  the programs which use the same DLL. This removes the runtime fixup - once DLL
  is loaded, its code is read-only.
<div class="Pp"></div>
While this allows some (significant?) performance advantages, this makes life
  much harder for developers, since the above scheme makes it impossible for a
  DLL to be &quot;linked&quot; to a symbol in the <i>.EXE</i> file. Indeed, this
  would need a DLL to have different relocations tables for the (different)
  executables which use this DLL.
<div class="Pp"></div>
However, a dynamically loaded Perl extension is forced to use some symbols from
  the perl executable, e.g., to know how to find the arguments to the functions:
  the arguments live on the perl internal evaluation stack. The solution is to
  put the main code of the interpreter into a DLL, and make the <i>.EXE</i> file
  which just loads this DLL into memory and supplies command-arguments. The
  extension DLL cannot link to symbols in <i>.EXE</i>, but it has no problem
  linking to symbols in the <i>.DLL</i>.
<div class="Pp"></div>
This <i>greatly</i> increases the load time for the application (as well as
  complexity of the compilation). Since interpreter is in a DLL, the C RTL is
  basically forced to reside in a DLL as well (otherwise extensions would not be
  able to use CRT). There are some advantages if you use different flavors of
  perl, such as running <i>perl.exe</i> and <i>perl__.exe</i> simultaneously:
  they share the memory of <i>perl.dll</i>.
<div class="Pp"></div>
<b>NOTE</b>. There is one additional effect which makes DLLs more wasteful: DLLs
  are loaded in the shared memory region, which is a scarse resource given the
  512M barrier of the &quot;standard&quot; OS/2 virtual memory. The code of
  <i>.EXE</i> files is also shared by all the processes which use the particular
  <i>.EXE</i>, but they are &quot;shared in the private address space of the
  process&quot;; this is possible because the address at which different
  sections of the <i>.EXE</i> file are loaded is decided at compile-time, thus
  all the processes have these sections loaded at same addresses, and no fixup
  of internal links inside the <i>.EXE</i> is needed.
<div class="Pp"></div>
Since DLLs may be loaded at run time, to have the same mechanism for DLLs one
  needs to have the address range of <i>any of the loaded</i> DLLs in the system
  to be available <i>in all the processes</i> which did not load a particular
  DLL yet. This is why the DLLs are mapped to the shared memory region.
<h2 class="Ss" title="Ss" id="Why_chimera_build?"><a class="selflink" href="#Why_chimera_build?">Why
  chimera build?</a></h2>
Current EMX environment does not allow DLLs compiled using Unixish
  &quot;a.out&quot; format to export symbols for data (or at least some types of
  data). This forces &quot;omf&quot;-style compile of <i>perl.dll</i>.
<div class="Pp"></div>
Current EMX environment does not allow <i>.EXE</i> files compiled in
  &quot;omf&quot; format to <i>fork()</i>. <i>fork()</i> is needed for exactly
  three Perl operations:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">explicit <i>fork()</i> in the script,</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">&quot;open FH, &quot;|-&quot;&quot;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">&quot;open FH, &quot;-|&quot;&quot;, in other words,
      opening pipes to itself.</dd>
</dl>
<div class="Pp"></div>
While these operations are not questions of life and death, they are needed for
  a lot of useful scripts. This forces &quot;a.out&quot;-style compile of
  <i>perl.exe</i>.
<h1 class="Sh" title="Sh" id="ENVIRONMENT"><a class="selflink" href="#ENVIRONMENT">ENVIRONMENT</a></h1>
Here we list environment variables with are either OS/2- and DOS- and
  Win*-specific, or are more important under OS/2 than under other OSes.
<h2 class="Ss" title="Ss" id="&quot;PERLLIB_PREFIX&quot;"><a class="selflink" href="#&quot;PERLLIB_PREFIX&quot;">&quot;PERLLIB_PREFIX&quot;</a></h2>
Specific for EMX port. Should have the form
<div class="Pp"></div>
<pre>
  path1;path2
</pre>
<div class="Pp"></div>
or
<div class="Pp"></div>
<pre>
  path1 path2
</pre>
<div class="Pp"></div>
If the beginning of some prebuilt path matches <i>path1</i>, it is substituted
  with <i>path2</i>.
<div class="Pp"></div>
Should be used if the perl library is moved from the default location in
  preference to &quot;PERL(5)LIB&quot;, since this would not leave wrong entries
  in @INC. For example, if the compiled version of perl looks for @INC in
  <i>f:/perllib/lib</i>, and you want to install the library in
  <i>h:/opt/gnu</i>, do
<div class="Pp"></div>
<pre>
  set PERLLIB_PREFIX=f:/perllib/lib;h:/opt/gnu
</pre>
<div class="Pp"></div>
This will cause Perl with the prebuilt @INC of
<div class="Pp"></div>
<pre>
  f:/perllib/lib/5.00553/os2
  f:/perllib/lib/5.00553
  f:/perllib/lib/site_perl/5.00553/os2
  f:/perllib/lib/site_perl/5.00553
  .
</pre>
<div class="Pp"></div>
to use the following @INC:
<div class="Pp"></div>
<pre>
  h:/opt/gnu/5.00553/os2
  h:/opt/gnu/5.00553
  h:/opt/gnu/site_perl/5.00553/os2
  h:/opt/gnu/site_perl/5.00553
  .
</pre>
<h2 class="Ss" title="Ss" id="&quot;PERL_BADLANG&quot;"><a class="selflink" href="#&quot;PERL_BADLANG&quot;">&quot;PERL_BADLANG&quot;</a></h2>
If 0, perl ignores <i>setlocale()</i> failing. May be useful with some strange
  <i>locale</i>s.
<h2 class="Ss" title="Ss" id="&quot;PERL_BADFREE&quot;"><a class="selflink" href="#&quot;PERL_BADFREE&quot;">&quot;PERL_BADFREE&quot;</a></h2>
If 0, perl would not warn of in case of unwarranted <i>free()</i>. With older
  perls this might be useful in conjunction with the module DB_File, which was
  buggy when dynamically linked and OMF-built.
<div class="Pp"></div>
Should not be set with newer Perls, since this may hide some <i>real</i>
  problems.
<h2 class="Ss" title="Ss" id="&quot;PERL_SH_DIR&quot;"><a class="selflink" href="#&quot;PERL_SH_DIR&quot;">&quot;PERL_SH_DIR&quot;</a></h2>
Specific for EMX port. Gives the directory part of the location for
  <i>sh.exe</i>.
<h2 class="Ss" title="Ss" id="&quot;USE_PERL_FLOCK&quot;"><a class="selflink" href="#&quot;USE_PERL_FLOCK&quot;">&quot;USE_PERL_FLOCK&quot;</a></h2>
Specific for EMX port. Since <i>flock</i>(3) is present in EMX, but is not
  functional, it is emulated by perl. To disable the emulations, set environment
  variable &quot;USE_PERL_FLOCK=0&quot;.
<h2 class="Ss" title="Ss" id="&quot;TMP&quot;_or_&quot;TEMP&quot;"><a class="selflink" href="#&quot;TMP&quot;_or_&quot;TEMP&quot;">&quot;TMP&quot;
  or &quot;TEMP&quot;</a></h2>
Specific for EMX port. Used as storage place for temporary files.
<h1 class="Sh" title="Sh" id="Evolution"><a class="selflink" href="#Evolution">Evolution</a></h1>
Here we list major changes which could make you by surprise.
<h2 class="Ss" title="Ss" id="Text-mode_filehandles"><a class="selflink" href="#Text-mode_filehandles">Text-mode
  filehandles</a></h2>
Starting from version 5.8, Perl uses a builtin translation layer for text-mode
  files. This replaces the efficient well-tested EMX layer by some code which
  should be best characterized as a &quot;quick hack&quot;.
<div class="Pp"></div>
In addition to possible bugs and an inability to follow changes to the
  translation policy with off/on switches of TERMIO translation, this introduces
  a serious incompatible change: before <i>sysread()</i> on text-mode
  filehandles would go through the translation layer, now it would not.
<h2 class="Ss" title="Ss" id="Priorities"><a class="selflink" href="#Priorities">Priorities</a></h2>
&quot;setpriority&quot; and &quot;getpriority&quot; are not compatible with
  earlier ports by Andreas Kaiser. See &quot;setpriority, getpriority&quot;.
<h2 class="Ss" title="Ss" id="DLL_name_mangling:_pre_5.6.2"><a class="selflink" href="#DLL_name_mangling:_pre_5.6.2">DLL
  name mangling: pre 5.6.2</a></h2>
With the release 5.003_01 the dynamically loadable libraries should be rebuilt
  when a different version of Perl is compiled. In particular, DLLs (including
  <i>perl.dll</i>) are now created with the names which contain a checksum, thus
  allowing workaround for OS/2 scheme of caching DLLs.
<div class="Pp"></div>
It may be possible to code a simple workaround which would
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">find the old DLLs looking through the old @INC;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">mangle the names according to the scheme of new perl and
      copy the DLLs to these names;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">edit the internal &quot;LX&quot; tables of DLL to reflect
      the change of the name (probably not needed for Perl extension DLLs, since
      the internally coded names are not used for &quot;specific&quot; DLLs,
      they used only for &quot;global&quot; DLLs).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">edit the internal &quot;IMPORT&quot; tables and change the
      name of the &quot;old&quot; <i>perl????.dll</i> to the &quot;new&quot;
      <i>perl????.dll</i>.</dd>
</dl>
<h2 class="Ss" title="Ss" id="DLL_name_mangling:_5.6.2_and_beyond"><a class="selflink" href="#DLL_name_mangling:_5.6.2_and_beyond">DLL
  name mangling: 5.6.2 and beyond</a></h2>
In fact mangling of <i>extension</i> DLLs was done due to misunderstanding of
  the OS/2 dynaloading model. OS/2 (effectively) maintains two different tables
  of loaded DLL:
<dl class="Bl-tag">
  <dt class="It-tag">Global DLLs</dt>
  <dd class="It-tag">those loaded by the base name from &quot;LIBPATH&quot;;
      including those associated at link time;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">specific DLLs</dt>
  <dd class="It-tag">loaded by the full name.</dd>
</dl>
<div class="Pp"></div>
When resolving a request for a global DLL, the table of already-loaded specific
  DLLs is (effectively) ignored; moreover, specific DLLs are <i>always</i>
  loaded from the prescribed path.
<div class="Pp"></div>
There is/was a minor twist which makes this scheme fragile: what to do with DLLs
  loaded from
<dl class="Bl-tag">
  <dt class="It-tag">&quot;BEGINLIBPATH&quot; and &quot;ENDLIBPATH&quot;</dt>
  <dd class="It-tag">(which depend on the process)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>.</i> from &quot;LIBPATH&quot;</dt>
  <dd class="It-tag">which <i>effectively</i> depends on the process (although
      &quot;LIBPATH&quot; is the same for all the processes).</dd>
</dl>
<div class="Pp"></div>
Unless &quot;LIBPATHSTRICT&quot; is set to &quot;T&quot; (and the kernel is
  after 2000/09/01), such DLLs are considered to be global. When loading a
  global DLL it is first looked in the table of already-loaded global DLLs.
  Because of this the fact that one executable loaded a DLL from
  &quot;BEGINLIBPATH&quot; and &quot;ENDLIBPATH&quot;, or <i>.</i> from
  &quot;LIBPATH&quot; may affect <i>which</i> DLL is loaded when <i>another</i>
  executable requests a DLL with the same name. <i>This</i> is the reason for
  version-specific mangling of the DLL name for perl DLL.
<div class="Pp"></div>
Since the Perl extension DLLs are always loaded with the full path, there is no
  need to mangle their names in a version-specific ways: their directory already
  reflects the corresponding version of perl, and @INC takes into account binary
  compatibility with older version. Starting from 5.6.2 the name mangling scheme
  is fixed to be the same as for Perl 5.005_53 (same as in a popular binary
  release). Thus new Perls will be able to <i>resolve the names</i> of old
  extension DLLs if @INC allows finding their directories.
<div class="Pp"></div>
However, this still does not guarantee that these DLL may be loaded. The reason
  is the mangling of the name of the <i>Perl DLL</i>. And since the extension
  DLLs link with the Perl DLL, extension DLLs for older versions would load an
  older Perl DLL, and would most probably segfault (since the data in this DLL
  is not properly initialized).
<div class="Pp"></div>
There is a partial workaround (which can be made complete with newer OS/2
  kernels): create a forwarder DLL with the same name as the DLL of the older
  version of Perl, which forwards the entry points to the newer Perl's DLL. Make
  this DLL accessible on (say) the &quot;BEGINLIBPATH&quot; of the new Perl
  executable. When the new executable accesses old Perl's extension DLLs, they
  would request the old Perl's DLL by name, get the forwarder instead, so
  effectively will link with the currently running (new) Perl DLL.
<div class="Pp"></div>
This may break in two ways:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Old perl executable is started when a new executable is
      running has loaded an extension compiled for the old executable (ouph!).
      In this case the old executable will get a forwarder DLL instead of the
      old perl DLL, so would link with the new perl DLL. While not directly
      fatal, it will behave the same as new executable. This beats the whole
      purpose of explicitly starting an old executable.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">A new executable loads an extension compiled for the old
      executable when an old perl executable is running. In this case the
      extension will not pick up the forwarder - with fatal results.</dd>
</dl>
<div class="Pp"></div>
With support for &quot;LIBPATHSTRICT&quot; this may be circumvented - unless one
  of DLLs is started from <i>.</i> from &quot;LIBPATH&quot; (I do not know
  whether &quot;LIBPATHSTRICT&quot; affects this case).
<div class="Pp"></div>
<b>REMARK</b>. Unless newer kernels allow <i>.</i> in &quot;BEGINLIBPATH&quot;
  (older do not), this mess cannot be completely cleaned. (It turns out that as
  of the beginning of 2002, <i>.</i> is not allowed, but <i>.\.</i> is - and it
  has the same effect.)
<div class="Pp"></div>
<b>REMARK</b>. &quot;LIBPATHSTRICT&quot;, &quot;BEGINLIBPATH&quot; and
  &quot;ENDLIBPATH&quot; are not environment variables, although <i>cmd.exe</i>
  emulates them on &quot;SET ...&quot; lines. From Perl they may be accessed by
  Cwd::extLibpath and Cwd::extLibpath_set.
<h2 class="Ss" title="Ss" id="DLL_forwarder_generation"><a class="selflink" href="#DLL_forwarder_generation">DLL
  forwarder generation</a></h2>
Assume that the old DLL is named <i>perlE0AC.dll</i> (as is one for 5.005_53),
  and the new version is 5.6.1. Create a file <i>perl5shim.def-leader</i> with
<div class="Pp"></div>
<pre>
  LIBRARY 'perlE0AC' INITINSTANCE TERMINSTANCE
  DESCRIPTION '@#perl5-porters@perl.org:5.006001#@ Perl module for 5.00553 -&gt; Perl 5.6.1 forwarder'
  CODE LOADONCALL
  DATA LOADONCALL NONSHARED MULTIPLE
  EXPORTS
</pre>
<div class="Pp"></div>
modifying the versions/names as needed. Run
<div class="Pp"></div>
<pre>
 perl -wnle &quot;next if 0../EXPORTS/; print qq(  \&quot;$1\&quot;) if /\&quot;(\w+)\&quot;/&quot; perl5.def &gt;lst
</pre>
<div class="Pp"></div>
in the Perl build directory (to make the DLL smaller replace perl5.def with the
  definition file for the older version of Perl if present).
<div class="Pp"></div>
<pre>
 cat perl5shim.def-leader lst &gt;perl5shim.def
 gcc -Zomf -Zdll -o perlE0AC.dll perl5shim.def -s -llibperl
</pre>
<div class="Pp"></div>
(ignore multiple &quot;warning L4085&quot;).
<h2 class="Ss" title="Ss" id="Threading"><a class="selflink" href="#Threading">Threading</a></h2>
As of release 5.003_01 perl is linked to multithreaded C RTL DLL. If perl itself
  is not compiled multithread-enabled, so will not be perl's <i>malloc()</i>.
  However, extensions may use multiple thread on their own risk.
<div class="Pp"></div>
This was needed to compile &quot;Perl/Tk&quot; for XFree86-OS/2 out-of-the-box,
  and link with DLLs for other useful libraries, which typically are compiled
  with &quot;-Zmt -Zcrtdll&quot;.
<h2 class="Ss" title="Ss" id="Calls_to_external_programs"><a class="selflink" href="#Calls_to_external_programs">Calls
  to external programs</a></h2>
Due to a popular demand the perl external program calling has been changed wrt
  Andreas Kaiser's port. <i>If</i> perl needs to call an external program <i>via
  shell</i>, the <i>f:/bin/sh.exe</i> will be called, or whatever is the
  override, see &quot;PERL_SH_DIR&quot;.
<div class="Pp"></div>
Thus means that you need to get some copy of a <i>sh.exe</i> as well (I use one
  from pdksh). The path <i>F:/bin</i> above is set up automatically during the
  build to a correct value on the builder machine, but is overridable at
  runtime,
<div class="Pp"></div>
<b>Reasons:</b> a consensus on &quot;perl5-porters&quot; was that perl should
  use one non-overridable shell per platform. The obvious choices for OS/2 are
  <i>cmd.exe</i> and <i>sh.exe</i>. Having perl build itself would be impossible
  with <i>cmd.exe</i> as a shell, thus I picked up &quot;sh.exe&quot;. This
  assures almost 100% compatibility with the scripts coming from *nix. As an
  added benefit this works as well under DOS if you use DOS-enabled port of
  pdksh (see &quot;Prerequisites&quot;).
<div class="Pp"></div>
<b>Disadvantages:</b> currently <i>sh.exe</i> of pdksh calls external programs
  via <i>fork()</i>/<i>exec()</i>, and there is <i>no</i> functioning
  <i>exec()</i> on OS/2. <i>exec()</i> is emulated by EMX by an asynchronous
  call while the caller waits for child completion (to pretend that the
  &quot;pid&quot; did not change). This means that 1 <i>extra</i> copy of
  <i>sh.exe</i> is made active via <i>fork()</i>/<i>exec()</i>, which may lead
  to some resources taken from the system (even if we do not count extra work
  needed for <i>fork()</i>ing).
<div class="Pp"></div>
Note that this a lesser issue now when we do not spawn <i>sh.exe</i> unless
  needed (metachars found).
<div class="Pp"></div>
One can always start <i>cmd.exe</i> explicitly via
<div class="Pp"></div>
<pre>
  system 'cmd', '/c', 'mycmd', 'arg1', 'arg2', ...
</pre>
<div class="Pp"></div>
If you need to use <i>cmd.exe</i>, and do not want to hand-edit thousands of
  your scripts, the long-term solution proposed on p5-p is to have a directive
<div class="Pp"></div>
<pre>
  use OS2::Cmd;
</pre>
<div class="Pp"></div>
which will override <i>system()</i>, <i>exec()</i>, &quot;``&quot;, and
  &quot;open(,'...|')&quot;. With current perl you may override only
  <i>system()</i>, <i>readpipe()</i> - the explicit version of &quot;``&quot;,
  and maybe <i>exec()</i>. The code will substitute the one-argument call to
  <i>system()</i> by &quot;CORE::system('cmd.exe', '/c', shift)&quot;.
<div class="Pp"></div>
If you have some working code for &quot;OS2::Cmd&quot;, please send it to me, I
  will include it into distribution. I have no need for such a module, so cannot
  test it.
<div class="Pp"></div>
For the details of the current situation with calling external programs, see
  &quot;Starting OS/2 (and DOS) programs under Perl&quot;. Set us mention a
  couple of features:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">External scripts may be called by their basename. Perl will
      try the same extensions as when processing <b>-S</b> command-line
    switch.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">External scripts starting with &quot;#!&quot; or
      &quot;extproc &quot; will be executed directly, without calling the shell,
      by calling the program specified on the rest of the first line.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Memory_allocation"><a class="selflink" href="#Memory_allocation">Memory
  allocation</a></h2>
Perl uses its own <i>malloc()</i> under OS/2 - interpreters are usually
  malloc-bound for speed, but perl is not, since its malloc is lightning-fast.
  Perl-memory-usage-tuned benchmarks show that Perl's malloc is 5 times quicker
  than EMX one. I do not have convincing data about memory footprint, but a
  (pretty random) benchmark showed that Perl's one is 5% better.
<div class="Pp"></div>
Combination of perl's <i>malloc()</i> and rigid DLL name resolution creates a
  special problem with library functions which expect their return value to be
  <i>free()</i>d by system's <i>free()</i>. To facilitate extensions which need
  to call such functions, system memory-allocation functions are still available
  with the prefix &quot;emx_&quot; added. (Currently only DLL perl has this, it
  should propagate to <i>perl_.exe</i> shortly.)
<h2 class="Ss" title="Ss" id="Threads"><a class="selflink" href="#Threads">Threads</a></h2>
One can build perl with thread support enabled by providing &quot;-D
  usethreads&quot; option to <i>Configure</i>. Currently OS/2 support of threads
  is very preliminary.
<div class="Pp"></div>
Most notable problems:
<dl class="Bl-tag">
  <dt class="It-tag">&quot;COND_WAIT&quot;</dt>
  <dd class="It-tag">may have a race condition (but probably does not due to
      edge-triggered nature of OS/2 Event semaphores). (Needs a reimplementation
      (in terms of chaining waiting threads, with the linked list stored in
      per-thread structure?)?)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>os2.c</i></dt>
  <dd class="It-tag">has a couple of static variables used in OS/2-specific
      functions. (Need to be moved to per-thread structure, or serialized?)</dd>
</dl>
<div class="Pp"></div>
Note that these problems should not discourage experimenting, since they have a
  low probability of affecting small programs.
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
This description is not updated often (since 5.6.1?), see <i>./os2/Changes</i>
  for more info.
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Ilya Zakharevich, cpan@ilyaz.org
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<i>perl</i>(1).</div>
<table class="foot">
  <tr>
    <td class="foot-date">2013-03-06</td>
    <td class="foot-os">perl v5.16.3</td>
  </tr>
</table>
</body>
</html>
