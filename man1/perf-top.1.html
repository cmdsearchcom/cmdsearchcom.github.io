<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>PERF-TOP(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">PERF-TOP(1)</td>
    <td class="head-vol">perf Manual</td>
    <td class="head-rtitle">PERF-TOP(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
perf-top - System profiling tool.
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>
<i>perf top</i> [-e &lt;EVENT&gt; | --event=EVENT] [&lt;options&gt;]
</pre>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
This command generates and displays a performance counter profile in real time.
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
-a, --all-cpus
<div style="margin-left: 4.00ex;">System-wide collection. (default)</div>
<div class="Pp"></div>
-c &lt;count&gt;, --count=&lt;count&gt;
<div style="margin-left: 4.00ex;">Event period to sample.</div>
<div class="Pp"></div>
-C &lt;cpu-list&gt;, --cpu=&lt;cpu&gt;
<div style="margin-left: 4.00ex;">Monitor only on the list of CPUs provided.
  Multiple CPUs can be provided as a comma-separated list with no space: 0,1.
  Ranges of CPUs are specified with -: 0-2. Default is to monitor all
  CPUS.</div>
<div class="Pp"></div>
-d &lt;seconds&gt;, --delay=&lt;seconds&gt;
<div style="margin-left: 4.00ex;">Number of seconds to delay between
  refreshes.</div>
<div class="Pp"></div>
-e &lt;event&gt;, --event=&lt;event&gt;
<div style="margin-left: 4.00ex;">Select the PMU event. Selection can be a
  symbolic event name (use <i>perf list</i> to list all events) or a raw PMU
  event (eventsel+umask) in the form of rNNN where NNN is a hexadecimal event
  descriptor.</div>
<div class="Pp"></div>
-E &lt;entries&gt;, --entries=&lt;entries&gt;
<div style="margin-left: 4.00ex;">Display this many functions.</div>
<div class="Pp"></div>
-f &lt;count&gt;, --count-filter=&lt;count&gt;
<div style="margin-left: 4.00ex;">Only display functions with more events than
  this.</div>
<div class="Pp"></div>
--group
<div style="margin-left: 4.00ex;">Put the counters into a counter group.</div>
<div class="Pp"></div>
-F &lt;freq&gt;, --freq=&lt;freq&gt;
<div style="margin-left: 4.00ex;">Profile at this frequency.</div>
<div class="Pp"></div>
-i, --inherit
<div style="margin-left: 4.00ex;">Child tasks do not inherit counters.</div>
<div class="Pp"></div>
-k &lt;path&gt;, --vmlinux=&lt;path&gt;
<div style="margin-left: 4.00ex;">Path to vmlinux. Required for annotation
  functionality.</div>
<div class="Pp"></div>
-m &lt;pages&gt;, --mmap-pages=&lt;pages&gt;
<div style="margin-left: 4.00ex;">Number of mmap data pages (must be a power of
  two) or size specification with appended unit character - B/K/M/G. The size is
  rounded up to have nearest pages power of two value.</div>
<div class="Pp"></div>
-p &lt;pid&gt;, --pid=&lt;pid&gt;
<div style="margin-left: 4.00ex;">Profile events on existing Process ID (comma
  separated list).</div>
<div class="Pp"></div>
-t &lt;tid&gt;, --tid=&lt;tid&gt;
<div style="margin-left: 4.00ex;">Profile events on existing thread ID (comma
  separated list).</div>
<div class="Pp"></div>
-u, --uid=
<div style="margin-left: 4.00ex;">Record events in threads owned by uid. Name or
  number.</div>
<div class="Pp"></div>
-r &lt;priority&gt;, --realtime=&lt;priority&gt;
<div style="margin-left: 4.00ex;">Collect data with this RT SCHED_FIFO
  priority.</div>
<div class="Pp"></div>
--sym-annotate=&lt;symbol&gt;
<div style="margin-left: 4.00ex;">Annotate this symbol.</div>
<div class="Pp"></div>
-K, --hide_kernel_symbols
<div style="margin-left: 4.00ex;">Hide kernel symbols.</div>
<div class="Pp"></div>
-U, --hide_user_symbols
<div style="margin-left: 4.00ex;">Hide user symbols.</div>
<div class="Pp"></div>
--demangle-kernel
<div style="margin-left: 4.00ex;">Demangle kernel symbols.</div>
<div class="Pp"></div>
-D, --dump-symtab
<div style="margin-left: 4.00ex;">Dump the symbol table used for
  profiling.</div>
<div class="Pp"></div>
-v, --verbose
<div style="margin-left: 4.00ex;">Be more verbose (show counter open errors,
  etc).</div>
<div class="Pp"></div>
-z, --zero
<div style="margin-left: 4.00ex;">Zero history across display updates.</div>
<div class="Pp"></div>
-s, --sort
<div style="margin-left: 4.00ex;">Sort by key(s): pid, comm, dso, symbol,
  parent, srcline, weight, local_weight, abort, in_tx, transaction, overhead,
  sample, period. Please see description of --sort in the perf-report man
  page.</div>
<div class="Pp"></div>
--fields=
<div style="margin-left: 4.00ex;">Specify output field - multiple keys can be
  specified in CSV format. Following fields are available: overhead,
  overhead_sys, overhead_us, overhead_children, sample and period. Also it can
  contain any sort key(s).
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
By default, every sort keys not specified in --field will be appended
automatically.
</pre>
</div>
</div>
<div class="Pp"></div>
-n, --show-nr-samples
<div style="margin-left: 4.00ex;">Show a column with the number of
  samples.</div>
<div class="Pp"></div>
--show-total-period
<div style="margin-left: 4.00ex;">Show a column with the sum of periods.</div>
<div class="Pp"></div>
--dsos
<div style="margin-left: 4.00ex;">Only consider symbols in these dsos. This
  option will affect the percentage of the overhead column. See --percentage for
  more info.</div>
<div class="Pp"></div>
--comms
<div style="margin-left: 4.00ex;">Only consider symbols in these comms. This
  option will affect the percentage of the overhead column. See --percentage for
  more info.</div>
<div class="Pp"></div>
--symbols
<div style="margin-left: 4.00ex;">Only consider these symbols. This option will
  affect the percentage of the overhead column. See --percentage for more
  info.</div>
<div class="Pp"></div>
-M, --disassembler-style=
<div style="margin-left: 4.00ex;">Set disassembler style for objdump.</div>
<div class="Pp"></div>
--source
<div style="margin-left: 4.00ex;">Interleave source code with assembly code.
  Enabled by default, disable with --no-source.</div>
<div class="Pp"></div>
--asm-raw
<div style="margin-left: 4.00ex;">Show raw instruction encoding of assembly
  instructions.</div>
<div class="Pp"></div>
-g
<div style="margin-left: 4.00ex;">Enables call-graph (stack chain/backtrace)
  recording.</div>
<div class="Pp"></div>
--call-graph [mode,type,min[,limit],order[,key][,branch]]
<div style="margin-left: 4.00ex;">Setup and enable call-graph (stack
  chain/backtrace) recording, implies -g. See --call-graph section in
  perf-record and perf-report man pages for details.</div>
<div class="Pp"></div>
--children
<div style="margin-left: 4.00ex;">Accumulate callchain of children to parent
  entry so that then can show up in the output. The output will have a new
  &quot;Children&quot; column and will be sorted on the data. It requires
  -g/--call-graph option enabled. See the &#x2018;overhead calculation&#x2019;
  section for more details.</div>
<div class="Pp"></div>
--max-stack
<div style="margin-left: 4.00ex;">Set the stack depth limit when parsing the
  callchain, anything beyond the specified depth will be ignored. This is a
  trade-off between information loss and faster processing especially for
  workloads that can have a very long callchain stack.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
Default: 127
</pre>
</div>
</div>
<div class="Pp"></div>
--ignore-callees=&lt;regex&gt;
<div style="margin-left: 4.00ex;">Ignore callees of the function(s) matching the
  given regex. This has the effect of collecting the callers of each such
  function into one place in the call-graph tree.</div>
<div class="Pp"></div>
--percent-limit
<div style="margin-left: 4.00ex;">Do not show entries which have an overhead
  under that percent. (Default: 0).</div>
<div class="Pp"></div>
--percentage
<div style="margin-left: 4.00ex;">Determine how to display the overhead
  percentage of filtered entries. Filters can be applied by --comms, --dsos
  and/or --symbols options and Zoom operations on the TUI (thread, dso, etc).
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
&quot;relative&quot; means it's relative to filtered entries only so that the
sum of shown entries will be always 100%. &quot;absolute&quot; means it retains
the original value before and after the filter is applied.
</pre>
</div>
</div>
<div class="Pp"></div>
-w, --column-widths=&lt;width[,width...]&gt;
<div style="margin-left: 4.00ex;">Force each column width to the provided list,
  for large terminal readability. 0 means no limit (default behavior).</div>
<div class="Pp"></div>
--proc-map-timeout
<div style="margin-left: 4.00ex;">When processing pre-existing threads
  /proc/XXX/mmap, it may take a long time, because the file may be huge. A time
  out is needed in such cases. This option sets the time out limit. The default
  value is 500 ms.</div>
<div class="Pp"></div>
-b, --branch-any
<div style="margin-left: 4.00ex;">Enable taken branch stack sampling. Any type
  of taken branch may be sampled. This is a shortcut for --branch-filter any.
  See --branch-filter for more infos.</div>
<div class="Pp"></div>
-j, --branch-filter
<div style="margin-left: 4.00ex;">Enable taken branch stack sampling. Each
  sample captures a series of consecutive taken branches. The number of branches
  captured with each sample depends on the underlying hardware, the type of
  branches of interest, and the executed code. It is possible to select the
  types of branches captured by enabling filters. For a full list of modifiers
  please see the perf record manpage.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
The option requires at least one branch type among any, any_call, any_ret, ind_call, cond.
The privilege levels may be omitted, in which case, the privilege levels of the associated
event are applied to the branch filter. Both kernel (k) and hypervisor (hv) privilege
levels are subject to permissions.  When sampling on multiple events, branch stack sampling
is enabled for all the sampling events. The sampled branch type is the same for all events.
The various filters must be specified as a comma separated list: --branch-filter any_ret,u,k
Note that this feature may not be available on all processors.
</pre>
</div>
</div>
<div class="Pp"></div>
--raw-trace
<div style="margin-left: 4.00ex;">When displaying traceevent output, do not use
  print fmt or plugins.</div>
<div class="Pp"></div>
--hierarchy
<div style="margin-left: 4.00ex;">Enable hierarchy output.</div>
<h1 class="Sh" title="Sh" id="INTERACTIVE_PROMPTING_KEYS"><a class="selflink" href="#INTERACTIVE_PROMPTING_KEYS">INTERACTIVE
  PROMPTING KEYS</a></h1>
[d]
<div style="margin-left: 4.00ex;">Display refresh delay.</div>
<div class="Pp"></div>
[e]
<div style="margin-left: 4.00ex;">Number of entries to display.</div>
<div class="Pp"></div>
[E]
<div style="margin-left: 4.00ex;">Event to display when multiple counters are
  active.</div>
<div class="Pp"></div>
[f]
<div style="margin-left: 4.00ex;">Profile display filter (&gt;= hit
  count).</div>
<div class="Pp"></div>
[F]
<div style="margin-left: 4.00ex;">Annotation display filter (&gt;= % of
  total).</div>
<div class="Pp"></div>
[s]
<div style="margin-left: 4.00ex;">Annotate symbol.</div>
<div class="Pp"></div>
[S]
<div style="margin-left: 4.00ex;">Stop annotation, return to full profile
  display.</div>
<div class="Pp"></div>
[z]
<div style="margin-left: 4.00ex;">Toggle event count zeroing across display
  updates.</div>
<div class="Pp"></div>
[qQ]
<div style="margin-left: 4.00ex;">Quit.</div>
<div style="height: 1.00em;">&#x00A0;</div>
Pressing any unmapped key displays a menu, and prompts for input.
<h1 class="Sh" title="Sh" id="OVERHEAD_CALCULATION"><a class="selflink" href="#OVERHEAD_CALCULATION">OVERHEAD
  CALCULATION</a></h1>
The overhead can be shown in two columns as <i>Children</i> and <i>Self</i> when
  perf collects callchains. The <i>self</i> overhead is simply calculated by
  adding all period values of the entry - usually a function (symbol). This is
  the value that perf shows traditionally and sum of all the <i>self</i>
  overhead values should be 100%.
<div style="height: 1.00em;">&#x00A0;</div>
The <i>children</i> overhead is calculated by adding all period values of the
  child functions so that it can show the total overhead of the higher level
  functions even if they don&#x2019;t directly execute much. <i>Children</i>
  here means functions that are called from another (parent) function.
<div style="height: 1.00em;">&#x00A0;</div>
It might be confusing that the sum of all the <i>children</i> overhead values
  exceeds 100% since each of them is already an accumulation of <i>self</i>
  overhead of its child functions. But with this enabled, users can find which
  function has the most overhead even if samples are spread over the children.
<div style="height: 1.00em;">&#x00A0;</div>
Consider the following example; there are three functions like below.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
<div class="Pp"></div>
.ft C
void foo(void) {
    /* do something */
}
<div class="Pp"></div>
void bar(void) {
    /* do something */
    foo();
}
<div class="Pp"></div>
int main(void) {
    bar()
    return 0;
}
.ft
<div class="Pp"></div>
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
In this case <i>foo</i> is a child of <i>bar</i>, and <i>bar</i> is an immediate
  child of <i>main</i> so <i>foo</i> also is a child of <i>main</i>. In other
  words, <i>main</i> is a parent of <i>foo</i> and <i>bar</i>, and <i>bar</i> is
  a parent of <i>foo</i>.
<div style="height: 1.00em;">&#x00A0;</div>
Suppose all samples are recorded in <i>foo</i> and <i>bar</i> only. When
  it&#x2019;s recorded with callchains the output will show something like below
  in the usual (self-overhead-only) output of perf report:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
<div class="Pp"></div>
.ft C
Overhead  Symbol
........  .....................
  60.00%  foo
          |
          --- foo
              bar
              main
              __libc_start_main
<div class="Pp"></div>
  40.00%  bar
          |
          --- bar
              main
              __libc_start_main
.ft
<div class="Pp"></div>
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
When the --children option is enabled, the <i>self</i> overhead values of child
  functions (i.e. <i>foo</i> and <i>bar</i>) are added to the parents to
  calculate the <i>children</i> overhead. In this case the report could be
  displayed as:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
<div class="Pp"></div>
.ft C
Children      Self  Symbol
........  ........  ....................
 100.00%     0.00%  __libc_start_main
          |
          --- __libc_start_main
<div class="Pp"></div>
 100.00%     0.00%  main
          |
          --- main
              __libc_start_main
<div class="Pp"></div>
 100.00%    40.00%  bar
          |
          --- bar
              main
              __libc_start_main
<div class="Pp"></div>
  60.00%    60.00%  foo
          |
          --- foo
              bar
              main
              __libc_start_main
.ft
<div class="Pp"></div>
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
In the above output, the <i>self</i> overhead of <i>foo</i> (60%) was add to the
  <i>children</i> overhead of <i>bar</i>, <i>main</i> and
  <i>__libc_start_main</i>. Likewise, the <i>self</i> overhead of <i>bar</i>
  (40%) was added to the <i>children</i> overhead of <i>main</i> and
  <i>\_\_libc_start_main</i>.
<div style="height: 1.00em;">&#x00A0;</div>
So <i>\_\_libc_start_main</i> and <i>main</i> are shown first since they have
  same (100%) <i>children</i> overhead (even though they have zero <i>self</i>
  overhead) and they are the parents of <i>foo</i> and <i>bar</i>.
<div style="height: 1.00em;">&#x00A0;</div>
Since v3.16 the <i>children</i> overhead is shown by default and the output is
  sorted by its values. The <i>children</i> overhead is disabled by specifying
  --no-children option on the command line or by adding <i>report.children =
  false</i> or <i>top.children = false</i> in the perf config file.
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>perf-stat</b>(1), <b>perf-list</b>(1), <b>perf-report</b>(1)</div>
<table class="foot">
  <tr>
    <td class="foot-date">07/04/2017</td>
    <td class="foot-os">perf</td>
  </tr>
</table>
</body>
</html>
