<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>CLSYNC(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">CLSYNC(1)</td>
    <td class="head-vol">User Manuals</td>
    <td class="head-rtitle">CLSYNC(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
clsync - live sync tool, written in GNU C
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>clsync [ ... ] -- [ sync-handler-arguments ]</b>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<b>clsync</b> executes <i>sync-handler</i> with appropriate arguments on FS
  events in directory <i>watch-dir</i> using the <b>inotify</b>(7) or other FS
  monitoring subsystems.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
This options can be passed as arguments or to be used in the configuration file.
<div style="height: 1.00em;">&#x00A0;</div>
To disable numeric option set to zero:
<div style="margin-left: 5.00ex;">	=0</div>
<div style="height: 1.00em;">&#x00A0;</div>
To disable string option (for example path to file) set to empty string:
<div style="margin-left: 5.00ex;">	=</div>
<div style="height: 1.00em;">&#x00A0;</div>
Also you can use previously set values while setting new options. Substring
  <i>%option_name%</i> will be substituted with previously set value of option
  <i>option_name</i>. (see <b>CONFIGURATION FILE</b>)
<div style="height: 1.00em;">&#x00A0;</div>
<i>sync-handler-arguments</i> applies only to modes:
<div style="margin-left: 5.00ex;">simple, direct, shell, rsyncdirect,
  rsyncshell</div>
<div style="height: 1.00em;">&#x00A0;</div>
To set <i>sync-handler-arguments</i> in config file use '--'. An example:
<div style="margin-left: 5.00ex;">-- = -aH --exclude-from %EXCLUDE-LIST%
  --include-from=%INCLUDE-LIST% --exclude '*' %watch-dir%/
  %destination-dir%/</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>-W, --watch-dir</b> <i>watch-dir</i>
<div style="margin-left: 5.00ex;">Root directory to be monitored by
  <b>clsync</b>.
<div style="height: 1.00em;">&#x00A0;</div>
Required.</div>
<div class="Pp"></div>
<b>-S, --sync-handler</b> <i>sync-handler</i>
<div style="margin-left: 5.00ex;">Path to <i>sync-handler</i> to be used for
  syncing by <b>clsync</b>. (see <i>--mode</i>)
<div style="height: 1.00em;">&#x00A0;</div>
Is required for all modes except &quot;direct&quot; and &quot;rsyncdirect&quot;
  [see <b>SYNC HANDLER MODES</b>]</div>
<div class="Pp"></div>
<b>-R, --rules-file</b> <i>rules-file</i>
<div style="margin-left: 5.00ex;">Path to file with filter rules of objects to
  be monitored. (see <b>RULES</b>)
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div class="Pp"></div>
<b>-D, --destination-dir</b> <i>destination-directory</i>
<div style="margin-left: 5.00ex;">Defines directory to sync to for modes
  &quot;rsyncdirect&quot;, &quot;rsyncso&quot; and &quot;so&quot;. (see
  <i>--mode</i>)
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div class="Pp"></div>
<b>-M, --mode</b> <i>mode</i>
<div style="margin-left: 5.00ex;">Sets syncing mode. Possible values:
<div style="margin-left: 5.00ex;"><i>simple</i>
<div style="margin-left: 5.00ex;">calls <i>sync-handler</i> for every
  event</div>
<i>direct</i>
<div style="margin-left: 5.00ex;">calls <i>sync-handler</i> for every sync with
  passing files lists as arguments</div>
<i>shell</i>
<div style="margin-left: 5.00ex;">calls <i>sync-handler</i> for every sync with
  passing files lists in a file</div>
<i>rsyncdirect</i>
<div style="margin-left: 5.00ex;">calls rsync by path <i>sync-handler</i>
  directly</div>
<i>rsyncshell</i>
<div style="margin-left: 5.00ex;">calls <i>sync-handler</i> that supposed to run
  rsync for every sync (recommended mode)&quot;</div>
<i>rsyncso</i>
<div style="margin-left: 5.00ex;">loads shared object by path
  <i>sync-handler</i> with <b>dlopen</b>(3) and calls function
  <b>clsyncapi_rsync</b> function for every sync</div>
<i>so</i>
<div style="margin-left: 5.00ex;">loads shared object by path
  <i>sync-handler</i> with <b>dlopen</b>(3) and calls function
  <b>clsyncapi_sync</b> function for every sync</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
See <b>SYNC HANDLER MODES</b>
<div class="Pp"></div>
Required.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>-b, --background</b>
<div style="margin-left: 5.00ex;">Daemonize, forcing clsync to fork() on start.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div class="Pp"></div>
<b>-H, --config-file</b> <i>config-file-path</i>
<div style="margin-left: 5.00ex;">Use configuration from file
  <i>config-file-path</i> (see <b>CONFIGURATION FILE</b>).
<div style="height: 1.00em;">&#x00A0;</div>
Set to &quot;/NULL/&quot; if no config files should be read.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div class="Pp"></div>
<b>-K, --config-block</b> <i>config-block-name</i>
<div style="margin-left: 5.00ex;">Use configuration block with name
  <i>config-block-name</i> (see <b>CONFIGURATION FILE</b>).
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;default&quot;.</div>
<div class="Pp"></div>
<b>--config-block-inherits</b> <i>config-parent-block-name</i>
<div style="margin-left: 5.00ex;">Use configuration block with name
  <i>config-parent-block-name</i> as parent for <i>config-block-name</i> (see
  <b>CONFIGURATION FILE</b>). Options from <i>config-parent-block-name</i> will
  be inherited to <i>config-block-name</i>.
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;default&quot;.</div>
<div class="Pp"></div>
<b>--custom-signals</b> <i>custom-signals</i>
<div style="margin-left: 5.00ex;">Set a list of signals and corresponding config
  block names. The config block will be use on catching the corresponding
  signal.
<div style="height: 1.00em;">&#x00A0;</div>
Format is
<div style="margin-left: 5.00ex;"><i>signal:config-block-name[,signal:config-block-name[,...]]</i></div>
<div style="height: 1.00em;">&#x00A0;</div>
For example:
<div style="margin-left: 5.00ex;">--custom-signals=29:debug,28:normal</div>
In this line signals &quot;28&quot; and &quot;29&quot; will be added to the
  sighandler. And clsync will use options from config block &quot;debug&quot; on
  signal 29 and &quot;normal&quot; on signal 28.
<div style="height: 1.00em;">&#x00A0;</div>
To reset all custom signals use the 0-th signal (e.g.
  &quot;--custom-signals=0&quot;).
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;&quot;.</div>
<div class="Pp"></div>
<b>-z, --pid-file</b> <i>path-to-pidfile</i>
<div style="margin-left: 5.00ex;">Writes pid to file by path
  <i>path-to-pidfile</i>.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div class="Pp"></div>
<b>--status-file</b> <i>status-file-path</i>
<div style="margin-left: 5.00ex;">Write status description into file with path
  <i>status-file-path</i>.
<div style="height: 1.00em;">&#x00A0;</div>
Possible statuses:
<div style="margin-left: 5.00ex;"><i>starting</i>
<div style="margin-left: 5.00ex;">initializing subsystems and marking file tree
  with FS monitor subsystem</div>
<i>initsync</i>
<div style="margin-left: 5.00ex;">processing initial syncing</div>
<i>running</i>
<div style="margin-left: 5.00ex;">waiting for events or syncing</div>
<i>synchandler error</i>
<div style="margin-left: 5.00ex;">waiting between synchandler execution tries
  (after a failure) [is used only while <b>--threading</b>=off]</div>
<i>rehashing</i>
<div style="margin-left: 5.00ex;">reloading configuration files</div>
<i>thread gc</i>
<div style="margin-left: 5.00ex;">running threads' garbage collector</div>
<i>preexit</i>
<div style="margin-left: 5.00ex;">executing the <i>--pre-exit-hook</i></div>
<i>terminating</i>
<div style="margin-left: 5.00ex;">running the last iteration (if required) and
  preparing to die</div>
<i>exiting</i>
<div style="margin-left: 5.00ex;">executing the <i>--exit-hook</i> and cleaning
  up [for <b>valgrind</b>(1)]</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div class="Pp"></div>
<b>-r, --retries</b> <i>number-of-tries</i>
<div style="margin-left: 5.00ex;">Tries limit to sync with <i>sync-handler</i>.
<div style="height: 1.00em;">&#x00A0;</div>
<b>clsync</b> will die after <i>number-of-tries</i> tries.
<div style="height: 1.00em;">&#x00A0;</div>
To try infinite set &quot;0&quot;.
<div style="height: 1.00em;">&#x00A0;</div>
Delay between tries is equal to <i>--delay-sync</i> value.
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;1&quot;.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--ignore-failures</b>
<div style="margin-left: 5.00ex;">Don't die on sync failures.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--exit-on-sync-skip</b>
<div style="margin-left: 5.00ex;">Exit if some event could be skipped due to any
  reason.
<div style="height: 1.00em;">&#x00A0;</div>
For example FreeBSD has a very short BSM event queue (1024). So it may be
  overflowed and some events can not climb to the queue. This option forces
  <b>clsync</b> to exit if the queue had been overflowed.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>-p, --threading</b> <i>threading-mode</i>
<div style="margin-left: 5.00ex;">Use <b>pthreads</b>(7) to parallelize syncing
  processes. For example if <b>clsync</b> (with <b>--threading=off</b>) is
  already syncing a huge file then all other syncs will be suspended until the
  huge file syncing finish. To prevent this suspends you can use
  &quot;safe&quot; or &quot;full&quot; threading mode.
<div style="height: 1.00em;">&#x00A0;</div>
Possbile values:
<div style="margin-left: 5.00ex;"><i>off</i>
<div style="margin-left: 5.00ex;">disable threading for syncing processes.</div>
<i>safe</i>
<div style="margin-left: 5.00ex;">parallelize syncs but suspend syncings of
  object that are already syncing in another process (until the process
  finish).</div>
<i>full</i>
<div style="margin-left: 5.00ex;">parallelize syncs without suspendings.</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
Characteristics:
<div style="margin-left: 5.00ex;"><i>off</i>
<div style="margin-left: 5.00ex;">New modifications won't be synced until old
  ones finish.</div>
<i>safe</i>
<div style="margin-left: 5.00ex;">Theoretically is the best way. But may utilize
  of lot of CPU if there's a lot of simultaneous parallel syncs. (also this way
  is not well tested)</div>
<i>full</i>
<div style="margin-left: 5.00ex;">May cause multiple simultaneous syncing of the
  same file, which in turn can cause bug inside <i>sync-handler</i> (see
  below).</div>
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
If you're running <b>clsync</b> with option <b>--threading=full</b> in
  conjunction with <b>rsync</b> with option <b>--backup</b>, you may catch a bug
  due to nonatomicity of rsync's file replace operation. (see
  <b>DIAGNOSTICS</b>)
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;off&quot;.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>-Y, --output</b> <i>log-destination</i>
<div style="margin-left: 5.00ex;">Sets destination for log writing (errors,
  warnings, infos and debugging).
<div style="height: 1.00em;">&#x00A0;</div>
Possible values:
<div style="margin-left: 5.00ex;"><i>stderr</i>
<div>&#x00A0;</div>
<i>stdout</i>
<div>&#x00A0;</div>
<i>syslog</i></div>
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;stderr&quot;.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--one-file-system</b>
<div style="margin-left: 5.00ex;">Don't follow to different devices' mount
  points. This option just adds option &quot;FTS_XDEV&quot; for
  <b>fts_open</b>(3) function.
<div style="height: 1.00em;">&#x00A0;</div>
<b>Warning!</b> If you're using this option (but no --exclude-mount-points)
  <b>clsync</b> will write neither includes nor excludes of content of mount
  points.
<div>&#x00A0;</div>
This may cause problems e.g. you're using rsync for sync-handler without similar
  option &quot;--one-file-system&quot;.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>-X, --exclude-mount-points</b>
<div style="margin-left: 5.00ex;">Forces <i>--one-file-system</i> but also add
  excludes to do not sync mount points.
<div style="height: 1.00em;">&#x00A0;</div>
This requires to do <b>stat</b>(2) syscalls on every dir and can reduce
  performance.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--socket</b> <i>socket-path</i>
<div style="margin-left: 5.00ex;">Create a control socket by path
  <i>socket-path</i>.
<div style="height: 1.00em;">&#x00A0;</div>
This's very experimental feature.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--socket-own</b> <i>socket-owner-user[:socket-owner-group]</i>
<div style="margin-left: 5.00ex;">Sets the control socket owner user (and
  group).
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--socket-mod</b> <i>socket-mode</i>
<div style="margin-left: 5.00ex;">Sets the control socket mode [see
  <b>chmod</b>(2)].
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--standby-file</b> <i>standby-file-path</i>
<div style="margin-left: 5.00ex;">Sets file to path that should be checked
  before every sync. If file exists the sync will be suspended until the file is
  deleted. It may be useful if you need freeze destination directory while
  running some scripts.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--max-iterations</b> <i>iterations-count</i>
<div style="margin-left: 5.00ex;">Sets synchronization iterations limit. One
  iteration means one sync-handler execution.
<div style="height: 1.00em;">&#x00A0;</div>
<i>iterations-count</i>
<div style="margin-left: 5.00ex;">set to 0 means no limit (infinite loop).
<div style="height: 1.00em;">&#x00A0;</div>
set to 1 means that only initial sync will be done
<div style="height: 1.00em;">&#x00A0;</div>
set to n means that only initial sync and (n-1) sync-ups after that will be
  done</div>
<div style="height: 1.00em;">&#x00A0;</div>
Hint: This option may be useful in conjunction with --exit-on-no-events to
  prevent infinite sync-up processes.
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;0&quot;.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--modification-signature</b> <i>signature-mask</i>
<div style="margin-left: 5.00ex;">Sets file/dir modification recheck signature.
  If file is not modified (according to the signature) then don't sync it.
<div style="height: 1.00em;">&#x00A0;</div>
See <i>struct stat</i> in <b>lstat</b>(2) for possible fields.
<div style="height: 1.00em;">&#x00A0;</div>
For example reasonable <i>signature-mask</i>-s can be
  &quot;dev,ino,mode,uid,gid,rdev,size,atime,mtime,ctime&quot; (there's an alias
  for that &#x2014; &quot;*&quot;) or &quot;uid,gid&quot;.
<div style="height: 1.00em;">&#x00A0;</div>
Examples of use cases:
<div style="margin-left: 5.00ex;"><b>chown/chmod</b>
<div style="margin-left: 5.00ex;">If you're using clsync for fixing file/dir
  privileges [using <b>chown</b>(1) and/or <b>chmod</b>(1)] than reasonable
  signature will be &quot;uid,gid&quot;.
<div style="height: 1.00em;">&#x00A0;</div>
Full example: clsync -w5 -t5 -T5 -x1 -W /var/www/site.example.org/root -Mdirect
  -Schown --uid 0 --gid 0 -Ysyslog -b1 --modification-signature uid,gid --
  --from=root www-data:www-data %INCLUDE-LIST%</div>
<b>bi-directional syncing</b>
<div style="margin-left: 5.00ex;">If you're going to setup bi-directional
  syncing then you may use --modification-signature &quot;*&quot; to prevent
  sync loop between servers.</div>
<b>Not enough CPU</b>
<div style="margin-left: 5.00ex;">If rsync eats too many CPU with rechecking
  hashsums of files on their dry open()/close() due to some hacky script (for
  example &quot;chown -R www-data:www-data&quot; in cron) then you can use
  --modification-signature
  &quot;dev,ino,mode,uid,gid,rdev,size,atime,mtime&quot; (without
  &quot;blksize&quot;, &quot;blocks&quot;, &quot;nlink&quot; and
  &quot;ctime&quot;).</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>Warning! This option may eat a lot of memory on huge file trees.</b>
<div style="height: 1.00em;">&#x00A0;</div>
This option cannot be used together with &quot;--cancel-syscalls=mon_stat&quot;
<div style="height: 1.00em;">&#x00A0;</div>
To disable file/dir modification rechecking use empty value &#x2014;
  &quot;&quot;.
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;&quot;.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>-k, --timeout-sync</b> <i>sync-timeout</i>
<div style="margin-left: 5.00ex;">Sets timeout for syncing processes.
  <b>clsync</b> will die if syncing process alive more than <i>sync-timeout</i>
  seconds.
<div style="height: 1.00em;">&#x00A0;</div>
Set &quot;0&quot; to disable the timeout.
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;86400&quot; [&quot;24 hours&quot;].</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>-w, --delay-sync</b> <i>additional-delay</i>
<div style="margin-left: 5.00ex;">Sets the minimal delay (in seconds) between
  syncs.
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;30&quot;.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>-t, --delay-collect</b> <i>ordinary-delay</i>
<div style="margin-left: 5.00ex;">Sets the delay (in seconds) to collect events
  about ordinary files and directories.
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;30&quot;.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>-T, --delay-collect-bigfile</b> <i>bigfiles-delay</i>
<div style="margin-left: 5.00ex;">Sets the delay (in seconds) to collect events
  about &quot;big files&quot; (see <i>--threshold-bigfile</i>).
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;1800&quot;.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>-B, --threshold-bigfile</b> <i>filesize-threshold</i>
<div style="margin-left: 5.00ex;">Sets file size threshold (in bytes) that
  separates ordinary files from &quot;big files&quot;. Events about &quot;big
  files&quot; are processed in another queue with a separate collecting delay.
  This is supposed to be used as a means of unloading IO resources.
<div style="height: 1.00em;">&#x00A0;</div>
To disable detection of &quot;big files&quot; set &quot;0&quot; (zero). This can
  improve perfomance by removing necessity in extra lstat() syscall.
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;134217728&quot; [&quot;128 MiB&quot;].</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--cancel-syscalls</b> <i>syscalls-mask</i>
<div style="margin-left: 5.00ex;">Sets syscalls to be bypassed. This may be used
  for to squeeze more performance.
<div style="height: 1.00em;">&#x00A0;</div>
Possible values:
<div style="margin-left: 5.00ex;"><b>mon_stat</b>
<div style="margin-left: 5.00ex;">Skip lstat() calls while handling files/dirs
  events. This makes unpossible to determine files sizes (that is used by
  <b>--threshold-bigfile</b> option) and to use option
  <b>--modification-signature</b>.</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
You can combine this values using commas.
<div style="height: 1.00em;">&#x00A0;</div>
To disable this option just use empty value &#x2014; &quot;&quot;.
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;&quot;.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>-L, --lists-dir</b> <i>tmpdir-path</i>
<div style="margin-left: 5.00ex;">Sets directory path to output temporary
  events-lists files.
<div style="height: 1.00em;">&#x00A0;</div>
See <b>SYNC HANDLER MODES</b>.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--have-recursive-sync</b>
<div style="margin-left: 5.00ex;">Use action &quot;recursivesync&quot; instead
  of &quot;synclist&quot; for directories that were just marked (see <b>SYNC
  HANDLER MODES</b> case <b>shell</b>).
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--synclist-simplify</b>
<div style="margin-left: 5.00ex;">Removes the first 3 parameters in list files
  of action &quot;synclist&quot; (see <b>SYNC HANDLER MODES</b> case
  <b>shell</b>).
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--rsync-inclimit</b> <i>rsync-includes-line-limit</i>
<div style="margin-left: 5.00ex;">Sets soft limit for lines count in files by
  path <i>rsync-listpath</i>. Unfortunately, rsync works very slowly with huge
  &quot;--include-from&quot; files. So, <b>clsync</b> splits that list with
  approximately <i>rsync-includes-line-limit</i> lines per list if it's too big,
  and executes by one rsync instance per list part. Use value &quot;0&quot; to
  disable the limit.
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;20000&quot;.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--rsync-prefer-include</b>
<div style="margin-left: 5.00ex;">Forces <b>clsync</b> to prefer a &quot;lot of
  includes&quot; method instead of a &quot;excludes+includes&quot; for rsync on
  recursive syncing.
<div style="height: 1.00em;">&#x00A0;</div>
See cases <b>rsyncshell</b>, <b>rsyncdirect</b> and <b>rsyncso</b> of <b>SYNC
  HANDLER MODES</b>.
<div style="height: 1.00em;">&#x00A0;</div>
This option is not recommended.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>-x, --ignore-exitcode</b> <i>exitcode</i>
<div style="margin-left: 5.00ex;">Forces <b>clsync</b> to do not process
  exitcode <i>exitcode</i> of <i>sync-handler</i> as an error. You can set
  multiple ignores by passing this option multiple times.
<div style="height: 1.00em;">&#x00A0;</div>
Recommended values for rsync case is &quot;24&quot;. You can set multiple values
  with listing a lot of &quot;-x&quot; options (e.g. &quot;-x 23 -x 24&quot;) or
  via commas (e.g. &quot;-x 23,24&quot;). To drop the list use zero exitcode
  (e.g. &quot;-x 0&quot;). For example you can use &quot;-x 0,23&quot; to drop
  the list and set &quot;23&quot;-th exitcode to be ignored.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default (or equally is set to &quot;0&quot;).</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>-U, --dont-unlink-lists</b>
<div style="margin-left: 5.00ex;">Do not delete list-files after
  <i>sync-handler</i> has finished.
<div style="height: 1.00em;">&#x00A0;</div>
This may be used for debugging purposes.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--fts-experimental-optimization</b>
<div style="margin-left: 5.00ex;">Enable experimental features to optimize file
  tree scanning while using <b>fts</b>(3). The features will be enabled by
  default after appropriate testing.
<div style="height: 1.00em;">&#x00A0;</div>
At the moment the option doesn't do anything but can be used in future.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>-F, --full-initialsync</b>
<div style="margin-left: 5.00ex;">Ignore filter rules from <i>rules-file</i> on
  initial sync.
<div style="height: 1.00em;">&#x00A0;</div>
This may be useful for quick start or e.g. if it's required to sync
  &quot;/var/log/&quot; tree but not sync every change from there.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--only-initialsync</b>
<div style="margin-left: 5.00ex;">Exit after initial syncing on clsync start.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--exit-on-no-events</b>
<div style="margin-left: 5.00ex;">Exit if there's no events. Works like
  <i>--only-initialsync</i>, but also syncs events collected while the initial
  syncing.
<div style="height: 1.00em;">&#x00A0;</div>
Unlike <i>--only-initialsync</i> this option uses FS monitor subsystem to
  monitor for new events while the initial syncing. This may reduce performance.
  On the other hand this way may be used to be sure, that everything is synced
  at the moment before clsync will exit.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--skip-initialsync</b>
<div style="margin-left: 5.00ex;">Skip initial syncing on clsync start.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--exit-hook</b> <i>path-of-exit-hook-program</i>
<div style="margin-left: 5.00ex;">Sets path of program to be executed on clsync
  exit.
<div style="height: 1.00em;">&#x00A0;</div>
If this parameter is set then clsync will exec on exit:
<div style="margin-left: 5.00ex;"><i>path-of-exit-hook-program label</i></div>
<div style="height: 1.00em;">&#x00A0;</div>
The execution will be skipped if initial sync wasn't complete.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--pre-exit-hook</b> <i>path-of-pre-exit-hook-program</i>
<div style="margin-left: 5.00ex;">Sets path of program to be executed before the
  last sync iteration (see <i>--max-iterations</i>, <i>--exit-on-no-events</i>
  and <b>SIGNALS</b>).
<div style="height: 1.00em;">&#x00A0;</div>
If this parameter is set then clsync will exec on exit:
<div style="margin-left: 5.00ex;"><i>path-of-pre-exit-hook-program
  label</i></div>
<div style="height: 1.00em;">&#x00A0;</div>
The execution will be skipped if initial sync wasn't complete.
<div style="height: 1.00em;">&#x00A0;</div>
If <b>clsync</b> finishes due to <i>--exit-on-no-events</i> and
  <i>--pre-exit-hook</i> is set then the pre-exit hook will be executed and
  additional sync iteration will be triggered.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>-v, --verbose</b>
<div style="margin-left: 5.00ex;">This option is supposed to increase verbosity.
  But at the moment there's no &quot;verbose output&quot; in the code, so the
  option does nothing. :)
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>-d, --debug</b>
<div style="margin-left: 5.00ex;">Increases debugging output. This may be
  supplied multiple times for more debugging information, up to a maximum of
  five &quot;d&quot; flags (more will do nothing), for example &quot;-d -d -d -d
  -d&quot; or &quot;-d5&quot; (equivalent cases)
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--dump-dir</b>
<div style="margin-left: 5.00ex;">Directory to write clsync's instance
  information by signal 29 (see <b>SIGNALS</b>). The directory shouldn't exists
  before dumping.
<div style="height: 1.00em;">&#x00A0;</div>
Is set to &quot;/tmp/clsync-dump-%label%&quot; by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>-q, --quiet</b>
<div style="margin-left: 5.00ex;">Suppresses error messages.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--monitor</b> <i>monitor-subsystem</i>
<div style="margin-left: 5.00ex;">Switches FS monitor subsystem.
<div style="height: 1.00em;">&#x00A0;</div>
Possible values:
<div style="margin-left: 5.00ex;"><i>inotify</i>
<div style="margin-left: 5.00ex;"><b>inotify</b>(7) [Linux, (FreeBSD via
  libinotify)]
<div style="height: 1.00em;">&#x00A0;</div>
Native, fast, reliable and well tested Linux FS monitor subsystem.
<div style="height: 1.00em;">&#x00A0;</div>
There's no essential performance profit to use &quot;inotify&quot; instead of
  &quot;kevent&quot; on FreeBSD using &quot;libinotify&quot;. It backends to
  &quot;kevent&quot; anyway.
<div style="height: 1.00em;">&#x00A0;</div>
FreeBSD users: The libinotify on FreeBSD is still not ready and unusable for
  <b>clsync</b> to sync a lot of files and directories.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<i>gio</i>
<div style="margin-left: 5.00ex;">Use <b>gio</b> library.
<div style="height: 1.00em;">&#x00A0;</div>
Crossplatform and tested library that backends to kqueue on FreeBSD and inotify
  on Linux. See <b>inotify</b> and <b>kqueue</b> sections here for details.
<div style="height: 1.00em;">&#x00A0;</div>
<b>Not well tested. Use with caution!</b>
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<i>kqueue</i>
<div style="margin-left: 5.00ex;"><b>kqueue</b>(2) [FreeBSD, (Linux via
  libkqueue)]
<div style="height: 1.00em;">&#x00A0;</div>
A *BSD kernel event notification mechanism (inc. timer, sockets, files etc).
<div style="height: 1.00em;">&#x00A0;</div>
This monitor subsystem cannot determine file creation event, but it can
  determine a directory where something happened. So <b>clsync</b> is have to
  rescan whole dir every time on any content change. Moreover, kqueue requires
  an open() on every watched file/dir. But FreeBSD doesn't allow to open()
  symlink itself (without following) and it's highly invasively to open() pipes
  and devices. So <b>clsync</b> just won't call open() on everything except
  regular files and directories. Consequently, <b>clsync</b> cannot determine if
  something changed in symlink/pipe/socket and so on. However it still can
  determine if it will be created or deleted by watching the parent directory
  and rescaning it on every appropriate event.
<div style="height: 1.00em;">&#x00A0;</div>
Also this API requires to open every monitored file and directory. So it may
  produce a huge amount of file descriptors. Be sure that <i>kern.maxfiles</i>
  is big enough (in FreeBSD).
<div style="height: 1.00em;">&#x00A0;</div>
CPU/HDD expensive way.
<div style="height: 1.00em;">&#x00A0;</div>
<b>Not well tested. Use with caution!</b>
<div style="height: 1.00em;">&#x00A0;</div>
Linux users: The libkqueue on Linux is not working. He-he :)
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<i>bsm</i>
<div style="margin-left: 5.00ex;"><b>bsm</b>(3) [FreeBSD]
<div style="height: 1.00em;">&#x00A0;</div>
Basic Security Module (BSM) Audit API.
<div style="height: 1.00em;">&#x00A0;</div>
This is not a FS monitor subsystem, actually. It's just an API to access to
  audit information (inc. logs). <b>clsync</b> can setup audit to watch FS
  events and report it into log. After that <b>clsync</b> will just parse the
  log via <b>auditpipe</b>(4) [FreeBSD].
<div style="height: 1.00em;">&#x00A0;</div>
Reliable, but hacky way. It requires global audit reconfiguration that may
  hopple audit analysis.
<div style="height: 1.00em;">&#x00A0;</div>
<b>Warning!</b> FreeBSD has a limit for queued events. In default FreeBSD kernel
  it's only 1024 events. So choose <b>one</b> of:
<div style="margin-left: 5.00ex;">- To patch the kernel to increase the limit.
<div>&#x00A0;</div>
- Don't use <b>clsync</b> on systems with too many file events.
<div>&#x00A0;</div>
- Use <i>bsm_prefetch</i> mode (but there's no guarantee in this case
  anyway).</div>
See also option <i>--exit-on-sync-skip</i>.
<div style="height: 1.00em;">&#x00A0;</div>
<b>Not well tested. Use with caution!</b> Also file /etc/security/audit_control
  will be overwritten with:
<div style="margin-left: 5.00ex;">#clsync
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
dir:/var/audit
<div>&#x00A0;</div>
flags:fc,fd,fw,fm,cl
<div>&#x00A0;</div>
minfree:0
<div>&#x00A0;</div>
naflags:fc,fd,fw,fm,cl
<div>&#x00A0;</div>
policy:cnt
<div>&#x00A0;</div>
filesz:1M</div>
unless it's already starts with &quot;#clsync\n&quot; (&quot;\n&quot; is a new
  line character).
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<i>bsm_prefetch</i>
<div style="margin-left: 5.00ex;">The same as <i>bsm</i> but all BSM events will
  be prefetched by an additional thread to prevent BSM queue overflow. This may
  utilize a lot of memory on systems with a high FS events frequency.
<div style="height: 1.00em;">&#x00A0;</div>
However the thread may be not fast enough to unload the kernel BSM queue. So it
  may overflow anyway.</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
The default value on Linux is &quot;inotify&quot;. The default value on FreeBSD
  is &quot;kqueue&quot;.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>-l, --label</b> <i>label</i>
<div style="margin-left: 5.00ex;">Sets a label for this instance of clsync. The
  <i>label</i> will be passed to <i>sync-handler</i> every execution.
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;nolabel&quot;.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>-h, --help</b>
<div style="margin-left: 5.00ex;">Outputs options list and exits with exitcode
  &quot;0&quot;.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>-V, --version</b>
<div style="margin-left: 5.00ex;">Outputs clsync version and exits with exitcode
  &quot;0&quot;.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--cgroup-group-name</b> <i>cg-group-name</i>
<div style="margin-left: 5.00ex;">Set cgroup group name [see
  <b>cgroup_new_cgroup</b>()].
<div style="height: 1.00em;">&#x00A0;</div>
Is set to &quot;clsync/%PID%&quot; by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="SECURITY_OPTIONS"><a class="selflink" href="#SECURITY_OPTIONS">SECURITY
  OPTIONS</a></h1>
<b>--secure-splitting</b>
<div style="margin-left: 5.00ex;">Implies &quot;--splitting=process
  --check-execvp-arguments --seccomp-filter --forbid-devices&quot;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>-u, --uid</b> <i>uid</i>
<div style="margin-left: 5.00ex;">Drop user privileges to uid <i>uid</i> with
  <b>setuid</b>(2)
<div style="height: 1.00em;">&#x00A0;</div>
If there's a <b>capabilities</b>(7) support then the default value is
  &quot;nobody&quot; (or &quot;65534&quot; if &quot;nobody&quot; not found),
  otherwise the option is not set by default;</div>
<div class="Pp"></div>
<b>-g, --gid</b> <i>gid</i>
<div style="margin-left: 5.00ex;">Drop group privileges to gid <i>gid</i> with
  <b>setgid</b>(2)
<div style="height: 1.00em;">&#x00A0;</div>
If there's a <b>capabilities</b>(7) support then the default value is
  &quot;nogroup&quot; (or &quot;65534&quot; if &quot;nogroup&quot; not found),
  otherwise the option is not set by default;</div>
<div class="Pp"></div>
<b>--privileged-uid</b> <i>sync-handler-uid</i>
<div style="margin-left: 5.00ex;">An user ID to be used for the privileged
  process <b></b>(see <b>--splitting=process</b>)<b>.</b>
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;$UID&quot;.</div>
<div class="Pp"></div>
<b>--privileged-gid</b> <i>sync-handler-gid</i>
<div style="margin-left: 5.00ex;">A group ID to be used for the privileged
  process <b></b>(see <b>--splitting=process</b>)<b>.</b>
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;$GID&quot;.</div>
<div class="Pp"></div>
<b>--sync-handler-uid</b> <i>sync-handler-uid</i>
<div style="margin-left: 5.00ex;">An user ID to be used for <i>sync-handler</i>.
<div style="height: 1.00em;">&#x00A0;</div>
See <b>--preserve-capabilities</b>.
<div style="height: 1.00em;">&#x00A0;</div>
The default value is same as for <b>--privileged-uid</b>.</div>
<div class="Pp"></div>
<b>--sync-handler-gid</b> <i>sync-handler-gid</i>
<div style="margin-left: 5.00ex;">A group ID to be used for <i>sync-handler</i>.
<div style="height: 1.00em;">&#x00A0;</div>
See <b>--preserve-capabilities</b>.
<div style="height: 1.00em;">&#x00A0;</div>
The default value is same as for <b>--privileged-gid</b>.</div>
<div class="Pp"></div>
<b>-C, --preserve-capabilities</b> <i>capabilities-list</i>
<div style="margin-left: 5.00ex;"><b>[Linux only, requires capabilities]</b>
<div style="height: 1.00em;">&#x00A0;</div>
Use <b>capset</b>(2) and <b>prctl</b>(2) to preserve
  &quot;CAP_DAC_READ_SEARCH&quot;, &quot;CAP_SETUID&quot; or/and
  &quot;CAP_SETGID&quot; [see <b>capabilities</b>(7)] Linux capability for
  process using <b>fts</b>(3), <b>inotify</b>(7) and <b>execve</b>(2). This
  allows the preservation of enough FS privileges to watch a file tree and
  execute the <i>sync-handler</i> with required uid and gid [see
  <b>--sync-handler-uid</b> and <b>--sync-handler-gid</b>] after dropping
  privileges via <b>setuid</b>(2) and <b>setgid</b>(2) [see <b>--uid</b> and
  <b>--gid</b>]
<div style="height: 1.00em;">&#x00A0;</div>
Possible values:
<div style="margin-left: 5.00ex;"><b>CAP_DAC_READ_SEARCH</b>
<div style="margin-left: 5.00ex;">To bypass FS read checks (for <b>fts</b> and
  <b>inotify</b>).</div>
<b>CAP_SETUID</b>
<div style="margin-left: 5.00ex;">To be able to use <b>setuid</b>(2) before
  <b>execve</b>(2) on the <b>sync-handler</b>.</div>
<b>CAP_SETGID</b>
<div style="margin-left: 5.00ex;">To be able to use <b>setgid</b>(2) before
  <b>execve</b>(2) on the <b>sync-handler</b>.</div>
<b>CAP_KILL</b>
<div style="margin-left: 5.00ex;">To be able to kill setuid()-ed processes</div>
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
Any combinations of this values are also supported. The list may be presented as
  a comma separated values, like:
<div style="margin-left: 5.00ex;">CAP_DAC_READ_SEARCH,CAP_SETUID,CAP_SETGID</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
The default value is
  &quot;CAP_DAC_READ_SEARCH,CAP_SETUID,CAP_SETGID,CAP_KILL&quot; if the
  <b>clsync</b> runner have such privileges.</div>
<div class="Pp"></div>
<b>--inherit-capabilities</b>
<div style="margin-left: 5.00ex;"><b>[Linux only, requires capabilities]</b>
<div style="height: 1.00em;">&#x00A0;</div>
Sets a mode for capabilities inheriting.
<div style="height: 1.00em;">&#x00A0;</div>
Possible values:
<div style="margin-left: 5.00ex;"><b>permitted</b>
<div style="margin-left: 5.00ex;">Inherits all permitted capabilities</div>
<b>dont-touch</b>
<div style="margin-left: 5.00ex;">Don't change inheritable capabilities
  set</div>
<b>clsync</b>
<div style="margin-left: 5.00ex;">Use <b>clsync</b>'s effective capabilities
  set</div>
<b>empty</b>
<div style="margin-left: 5.00ex;">Reset all capabilities</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;empty&quot;.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--splitting</b> <i>splitting-type</i>
<div style="margin-left: 5.00ex;">Split the process/thread to privileged and
  non-privileged. This's an additional way to secure your system from any bug in
  <b>clsync</b> while running it with capabilities or root privileges. But
  <b>clsync</b> may utilize in few times more CPU resources. So it's a
  performance vs security trade off.
<div style="height: 1.00em;">&#x00A0;</div>
You can essentialy reduce the overhead with using &quot;high load locks&quot;
  (&quot;--enable-highload-locks&quot; of &quot;./configure&quot; file).
<div style="height: 1.00em;">&#x00A0;</div>
If you're using this option and running the <i>sync-handler</i> with the root
  user then it's highly recommended to enable <b>--check-execvp-arguments</b>,
  too. Otherwise in case of <b>clsync</b> security bug a hacker will be able to
  use execvp() with any arguments with root privileges.
<div style="height: 1.00em;">&#x00A0;</div>
Possible values:
<div style="margin-left: 5.00ex;"><b>off</b>
<div style="margin-left: 5.00ex;">Disable this feature</div>
<b>thread</b>
<div style="margin-left: 5.00ex;"><b>[Linux only, requires capabilities]</b>
<div style="height: 1.00em;">&#x00A0;</div>
Creates a separate thread for privileged operations.
<div style="height: 1.00em;">&#x00A0;</div>
It's highly recommended to enable <b>--seccomp-filter</b> in this case. But that
  will forbid <b>--threading</b>.</div>
<b>process</b>
<div style="margin-left: 5.00ex;">More secure and portable way, but uses
  separate process and:
<div style="margin-left: 5.00ex;">- forbids fanotify (that is not implemented
  yet anyway);
<div>&#x00A0;</div>
- more complex code (and higher probability of error).
<div>&#x00A0;</div>
- slower due to copying data between private and shared memory pages.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>Recommended.</b></div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
Is set to &quot;off&quot; by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--check-execvp-arguments</b>
<div style="margin-left: 5.00ex;"><b>[Requires --splitting=[thread|process]]</b>
<div>&#x00A0;</div>
<b>[Blocks --mode=direct]</b>
<div style="height: 1.00em;">&#x00A0;</div>
Enables execvp() arguments recheck in the privileged process (in case of their
  substitution to any exploit-given arguments).
<div style="height: 1.00em;">&#x00A0;</div>
This option doesn't utilize a lot of CPU resources but forbids run-time changing
  of <i>sync-handler-arguments</i> and hook file paths.
<div style="height: 1.00em;">&#x00A0;</div>
This option cannot be used in conjunction with <b>--mode</b>=direct due to an
  arbitrary number of arguments in this mode.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--add-permitted-hook-files</b> <i>[hook-path0,[hook-path1[,...]]]</i>
<div style="margin-left: 5.00ex;"><b>[Requires --check-execvp-arguments]</b>
<div style="height: 1.00em;">&#x00A0;</div>
Adds paths to the list of permitted hook paths to bypass
  <b>--check-execvp-arguments</b> checks. It may be required if you're going to
  change the hooks in run-time using <b>--custom-signals</b> or <b>--socket</b>.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--seccomp-filter</b>
<div style="margin-left: 5.00ex;"><b>[Linux only]</b>
<div style="height: 1.00em;">&#x00A0;</div>
Use <b>seccomp</b> filter to forbid syscalls that shouldn't be used by clsync.
<div style="height: 1.00em;">&#x00A0;</div>
Forbid all syscalls for non-privileged process/thread, but
<div style="margin-left: 5.00ex;">futex inotify_init1 alert stat fstat lstat
  open write close wait4 unlink tgkill clock_gettime rt_sigreturn brk mmap
  munmap wait4 rmdir exit_group select read rt_sigprocmask rt_sigaction
  nanosleep</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--permit-mprotect</b>
<div style="margin-left: 5.00ex;"><b>[Requires --seccomp-filter]</b>
<div style="height: 1.00em;">&#x00A0;</div>
Permits <b>mprotect</b>(2) syscall.
<div style="height: 1.00em;">&#x00A0;</div>
This syscall is required by <b>pthread_create</b>(3), so it's required for
  <b>--threading</b>.
<div style="height: 1.00em;">&#x00A0;</div>
Makes --shm-mprotect to be useless.
<div style="height: 1.00em;">&#x00A0;</div>
Also it enables ability to change memory of privileged thread from
  non-privileged, so using of <b>--splitting=thread</b> with this option is
  useless, too.
<div style="height: 1.00em;">&#x00A0;</div>
Is set to &quot;0&quot; by default if --splitting is set. Otherwise
  &quot;1&quot;.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--shm-mprotect</b>
<div style="margin-left: 5.00ex;"><b>[Requires --splitting=process]</b>
<div style="height: 1.00em;">&#x00A0;</div>
Forbid writing or reading to/from shared memory when it shouldn't be.
  <b>mprotect</b>(2) is used for the protection.
<div style="height: 1.00em;">&#x00A0;</div>
This option is useless while <b>--permit-mprotect</b> is enabled.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--chroot</b> <i>chroot-directory</i>
<div style="margin-left: 5.00ex;">clsync chroot()-s [see <b>chroot</b>(2)] to
  directory <i>chroot-directory</i> before any syncing processes.
<div style="height: 1.00em;">&#x00A0;</div>
This option may be used in conjunction with <b>--uid</b>, <b>--gid</b> or/and
  <b>--pivot-root</b> for security reasons.
<div style="height: 1.00em;">&#x00A0;</div>
Remember! If you're chroot()-ing somewhere, the <i>sync-handler</i> will be
  limited by the chroot-environment, too. If you're using rsync then you may
  want to &quot;mount --bind&quot; some directories to the
  <i>chroot-directory</i>.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div class="Pp"></div>
<b>--pivot-root</b> <i>pivot-root-way</i>
<div style="margin-left: 5.00ex;"><b>[Linux only, requires --chroot]</b>
<div style="height: 1.00em;">&#x00A0;</div>
Sets a way of using <b>pivot_root</b>(2) syscall to the <i>chroot-directory</i>
  (to <b>umount</b>(2) old rootfs).
<div style="height: 1.00em;">&#x00A0;</div>
Possible values:
<div style="margin-left: 5.00ex;"><b>auto</b>
<div style="margin-left: 5.00ex;">Creates a directory
  &quot;/dev/shm/clsync-rootfs&quot;, <b>unshare</b>(2)-ing the mount namespace,
  <b>mount</b>(2)-s the <i>chroot-directory</i> to the directory and then
  <b>pivot_root</b>(2)-ing, <b>chroot</b>(2)-ing and <b>umount</b>(2)-ing old
  rootfs. Directory &quot;/dev/shm/clsync-rootfs&quot; won't be deleted after
  <b>clsync</b> finish.</div>
<b>auto-ro</b>
<div style="margin-left: 5.00ex;">The same as <b>auto</b> but mounts the
  directory with read-only option (MS_RDONLY).</div>
<b>direct</b>
<div style="margin-left: 5.00ex;"><b>unshare</b>(2)-ing the mount namespace,
  <b>pivot_root</b>(2)-ing, <b>chroot</b>(2)-ing and <b>umount</b>(2)-ing old
  rootfs. Directory &quot;old_root&quot; should be created in
  <i>chroot-directory</i> before running <b>clsync</b> in this mode.</div>
<b>off</b>
<div style="margin-left: 5.00ex;">Don't <b>pivot_root</b>(2).</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;off&quot;. If <b>--chroot</b> is used then
  recommended value is &quot;auto-ro&quot;.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--mountpoints</b> <i>[mountpoint[,mountpoint[,mountpoint]]]</i>
<div style="margin-left: 5.00ex;"><b>[Linux only]</b>
<div style="height: 1.00em;">&#x00A0;</div>
Umount (with MNT_DETACH) everything except listed mountpoints.
<div style="height: 1.00em;">&#x00A0;</div>
Supposed to be used for security reasons as an alternative to
  <b>--pivot-root</b> option.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--detach-network</b> <i>detach-network-mode</i>
<div style="margin-left: 5.00ex;"><b>[Linux only]</b>
<div style="height: 1.00em;">&#x00A0;</div>
Removes network in <b>clsync</b> instance.
<div style="height: 1.00em;">&#x00A0;</div>
Possible values:
<div style="margin-left: 5.00ex;"><b>everywhere</b>
<div style="margin-left: 5.00ex;">Removes network for all processes.</div>
<b>non-privileged</b>
<div style="margin-left: 5.00ex;">Removes network from non-privileged process if
  option <b>--process-splitting</b> is enabled, otherwise doesn't do
  anything.</div>
<b>off</b>
<div style="margin-left: 5.00ex;">Don't do anything.</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
The default value is &quot;non-privileged&quot;.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--detach-ipc</b>
<div style="margin-left: 5.00ex;"><b>[Linux only]</b>
<div style="height: 1.00em;">&#x00A0;</div>
Make an own IPC namespace.
<div style="height: 1.00em;">&#x00A0;</div>
Is set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--detach-miscellanea</b>
<div style="margin-left: 5.00ex;"><b>[Linux only]</b>
<div style="height: 1.00em;">&#x00A0;</div>
<b>unshare</b>(2) on everything not listed above.
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>--forbid-devices</b>
<div style="margin-left: 5.00ex;"><b>[Linux only]</b>
<div style="height: 1.00em;">&#x00A0;</div>
Forbid any access to all devices except listed ones:
<div style="margin-left: 5.00ex;">read access to:
<div style="margin-left: 5.00ex;">/dev/console
<div>&#x00A0;</div>
/dev/zero
<div>&#x00A0;</div>
/dev/urandom
<div>&#x00A0;</div>
/dev/random</div>
write access to:
<div style="margin-left: 5.00ex;">/dev/console
<div>&#x00A0;</div>
/dev/null</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
Is not set by default.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="PERFORMANCE"><a class="selflink" href="#PERFORMANCE">PERFORMANCE</a></h1>
Recommendations to improve the perfomance:
<div style="margin-left: 5.00ex;">- Disable thread/process splitting.
<div>&#x00A0;</div>
- Don't use clsync rules (use rules on sync-handler side) or/and use option
  &quot;--full-initialsync&quot;
<div>&#x00A0;</div>
- Use option &quot;-B0&quot;.
<div>&#x00A0;</div>
- Use option &quot;--cancel-syscalls=mon_stat&quot;.
<div>&#x00A0;</div>
- Use option &quot;-p safe&quot; or &quot;-p full&quot;.
<div>&#x00A0;</div>
- Disable debugging with &quot;-d0&quot; or better disable debugging support at
  all with &quot;./configure&quot; option &quot;--enable-debug=no&quot;
<div>&#x00A0;</div>
- Don't use option &quot;--exclude-mount-points&quot;
<div>&#x00A0;</div>
- Free memory for disk cache
<div>&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
You shouldn't follow all this recommendation blindfold. You should use only the
  ideas that fixes performance problems in your specific use case. And only if
  it's necessary.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="SYNC_HANDLER_MODES"><a class="selflink" href="#SYNC_HANDLER_MODES">SYNC
  HANDLER MODES</a></h1>
<b>clsync</b> executes <i>sync-handler</i> that supposed to take care of the
  actual syncing process. Therefore <b>clsync</b> is only a convenient way to
  run a syncing script.
<div style="height: 1.00em;">&#x00A0;</div>
<b>clsync</b> can run <i>sync-handler</i> in seven ways. Which way will be used
  depends on specified mode (see <i>--mode</i>)
<div style="height: 1.00em;">&#x00A0;</div>
<i>sync-handler-arguments</i> are used only in modes:
<div style="margin-left: 5.00ex;">simple
<div>&#x00A0;</div>
direct
<div>&#x00A0;</div>
shell
<div>&#x00A0;</div>
rsyncdirect
<div>&#x00A0;</div>
rsyncshell</div>
<div style="height: 1.00em;">&#x00A0;</div>
If <i>sync-handler-arguments</i> are not set then the default setting is used
  (see below).
<div style="height: 1.00em;">&#x00A0;</div>
case <b>simple</b>
<div style="margin-left: 5.00ex;">Executes for every syncing file/dir:
<div style="margin-left: 5.00ex;"><i>sync-handler
  sync-handler-arguments</i></div>
<div style="height: 1.00em;">&#x00A0;</div>
Default <i>sync-handler-arguments</i> are:
<div style="margin-left: 5.00ex;">sync <i>%label% %EVENT-MASK%
  %INCLUDE-LIST%</i></div>
<div style="height: 1.00em;">&#x00A0;</div>
In this case, <i>sync-handler</i> is supposed to non-recursively sync file or
  directory by path <i>%INCLUDE-LIST%</i>. With <i>%EVENT-MASK%</i> it's passed
  bitmask of events with the file or directory (see
  &quot;/usr/include/linux/inotify.h&quot;).
<div style="height: 1.00em;">&#x00A0;</div>
Additional substitutions:
<div style="margin-left: 5.00ex;"><b>%EVENT-MASK%</b>
<div style="margin-left: 5.00ex;">Is replaced by integer of events IDs.</div>
<b>%INCLUDE-LIST%</b>
<div style="margin-left: 5.00ex;">Is replaced by absolute path of a file/dir to
  be synced.</div>
</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
case <b>direct</b>
<div style="margin-left: 5.00ex;">Executes for every sync:
<div style="margin-left: 5.00ex;"><i>sync-handler
  sync-handler-arguments</i></div>
<div style="height: 1.00em;">&#x00A0;</div>
Default <i>sync-handler-arguments</i> are:
<div style="margin-left: 5.00ex;">%INCLUDE-LIST% %destination-dir%/</div>
<div style="height: 1.00em;">&#x00A0;</div>
Additional substitutions:
<div style="margin-left: 5.00ex;"><b>%INCLUDE-LIST%</b>
<div style="margin-left: 5.00ex;">Is replaced by a list of relative paths of
  files/dirs to be synced.</div>
</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
case <b>shell</b>
<div style="margin-left: 5.00ex;">Executes for every sync (if
  <b>recursivesync</b> is not used instead):
<div style="margin-left: 5.00ex;"><i>sync-handler
  sync-handler-arguments</i></div>
<div style="height: 1.00em;">&#x00A0;</div>
Default <i>sync-handler-arguments</i> are:
<div style="margin-left: 5.00ex;">synclist %label% %INCLUDE-LIST-PATH%</div>
<div style="height: 1.00em;">&#x00A0;</div>
Default <i>sync-handler-arguments</i> for initial sync if
  <i>--have-recursive-sync</i> is set are:
<div style="margin-left: 5.00ex;">initialsync %label% %INCLUDE-LIST%</div>
<div style="height: 1.00em;">&#x00A0;</div>
In this case, <i>sync-handler</i> is supposed to non-recursively sync files and
  directories from list in a file by path %INCLUDE-LIST-PATH% on
  &quot;synclist&quot;.
<div style="height: 1.00em;">&#x00A0;</div>
Also <i>sync-handler</i> is supposed to recursively sync data from directory by
  path %INCLUDE-LIST-PATH% with manual excluding extra files on
  &quot;initialsync&quot;.
<div style="height: 1.00em;">&#x00A0;</div>
Additional substitutions:
<div style="margin-left: 5.00ex;"><b>%TYPE%</b>
<div style="margin-left: 5.00ex;">Is replaced by
  &quot;sync&quot;/&quot;initialsync&quot;.</div>
<b>%INCLUDE-LIST-PATH%</b>
<div style="margin-left: 5.00ex;">Is replaced by the path of the include list
  file.</div>
<b>%INCLUDE-LIST%</b>
<div style="margin-left: 5.00ex;">Is replaced by a list of relative paths of
  files/dirs to be synced.</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
Not recommended. Not well tested.</div>
<div style="height: 1.00em;">&#x00A0;</div>
case <b>rsyncdirect</b>
<div style="margin-left: 5.00ex;">Executes for every sync:
<div style="margin-left: 5.00ex;"><i>sync-handler
  sync-handler-arguments</i></div>
<div style="height: 1.00em;">&#x00A0;</div>
<i>sync-handler</i> is supposed to be a path to <b>rsync</b> binary.
<div style="height: 1.00em;">&#x00A0;</div>
Default <i>sync-handler-arguments</i> are:
<div style="margin-left: 5.00ex;">-aH --delete --exclude-from
  %EXCLUDE-LIST-PATH% --include-from %INCLUDE-LIST-PATH% --exclude='*'
  %watch-dir%/ %destination-dir%/</div>
if option <i>--rsync--prefer-include</i> is not set and
<div style="margin-left: 5.00ex;">-aH --delete --include-from
  %INCLUDE-LIST-PATH% --exclude='*' %watch-dir%/ %destination-dir%/</div>
if the option is set
<div style="height: 1.00em;">&#x00A0;</div>
Error code &quot;24&quot; from <i>sync-handler</i> will be ignored in this case.
  We also recommend to ignore exitcode &quot;23&quot;.
<div style="height: 1.00em;">&#x00A0;</div>
Additional substitutions:
<div style="margin-left: 5.00ex;"><b>%INCLUDE-LIST-PATH%</b>
<div style="margin-left: 5.00ex;">Is replaced by the path of the include list
  file</div>
<b>%EXCLUDE-LIST-PATH%</b>
<div style="margin-left: 5.00ex;">Is replaced by the path of the exclude list
  file</div>
<b>%RSYNC-ARGS%</b>
<div style="margin-left: 5.00ex;">Is replaced by default
  <i>sync-handler-arguments</i>, but without &quot;%watch-dir%/
  %destination-dir%/&quot;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
Recommended case.</div>
<div style="height: 1.00em;">&#x00A0;</div>
case <b>rsyncshell</b>
<div style="margin-left: 5.00ex;">Executes for every sync:
<div style="margin-left: 5.00ex;"><i>sync-handler
  sync-handler-arguments</i></div>
<div style="height: 1.00em;">&#x00A0;</div>
Default <i>sync-handler-arguments</i> are:
<div style="margin-left: 5.00ex;">rsynclist %label% %INCLUDE-LIST-PATH%
  [%EXCLUDE-LIST-PATH%]</div>
<div style="height: 1.00em;">&#x00A0;</div>
In this case, <i>sync-handler</i> is supposed to run &quot;rsync&quot;
  application with parameters:
<div style="height: 1.00em;">&#x00A0;</div>
-aH --delete-before --include-from <i>%INCLUDE-LIST-PATH%</i> --exclude '*'
<div style="height: 1.00em;">&#x00A0;</div>
if option <i>--rsync-prefer-include</i> is enabled.
<div style="height: 1.00em;">&#x00A0;</div>
And with parameters:
<div style="height: 1.00em;">&#x00A0;</div>
-aH --delete-before --exclude-from <i>%EXCLUDE-LIST-PATH%</i> --include-from
  <i>%INCLUDE-LIST-PATH%</i> --exclude '*'
<div style="height: 1.00em;">&#x00A0;</div>
if option <i>--rsync-prefer-include</i> is disabled.
<div style="height: 1.00em;">&#x00A0;</div>
Additional substitutions:
<div style="margin-left: 5.00ex;"><b>%INCLUDE-LIST-PATH%</b>
<div style="margin-left: 5.00ex;">Is replaced by the path of the rsync include
  list file</div>
<b>%EXCLUDE-LIST-PATH%</b>
<div style="margin-left: 5.00ex;">Is replaced by the path of the rsync exclude
  list file</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
Recommended case.</div>
<div style="height: 1.00em;">&#x00A0;</div>
case <b>rsyncso</b>
<div style="margin-left: 5.00ex;">In this case there's no direct exec*()
  calling. In this case <b>clsync</b> loads <i>sync-handler</i> as a shared
  library with <b>dlopen</b>(3) and calls function &quot;int
  clsyncapi_rsync(const char *inclist, const char *exclist)&quot; from it for
  every sync.
<div>&#x00A0;</div>
<b>inclist</b> is a path to file with rules for &quot;--include-from&quot;
  option of rsync. This argument is always not NULL.
<div>&#x00A0;</div>
<b>exclist</b> is a path to file with rules for &quot;--exclude-from&quot;
  option of rsync. This argument is NULL if <b>--rsync-prefer-include</b> is
  set.
<div>&#x00A0;</div>
<i>Excludes takes precedence over includes.</i>
<div style="height: 1.00em;">&#x00A0;</div>
Also may be defined functions &quot;int clsyncapi_init(ctx_t *, indexes_t
  *)&quot; and &quot;int clsyncapi_deinit()&quot; to initialize and deinitialize
  the syncing process by this shared object.
<div style="height: 1.00em;">&#x00A0;</div>
To fork the process should be used function &quot;pid_t clsyncapi_fork(ctx_t
  *)&quot; instead of &quot;pid_t fork()&quot; to make clsync be able to kill
  the child.
<div style="height: 1.00em;">&#x00A0;</div>
See example file &quot;clsync-synchandler-rsyncso.c&quot;.
<div style="height: 1.00em;">&#x00A0;</div>
Recommended case.</div>
<div style="height: 1.00em;">&#x00A0;</div>
case <b>so</b>
<div style="margin-left: 5.00ex;">In this case there's no direct exec*()
  calling. In this case <b>clsync</b> loads <i>sync-handler</i> as a shared
  library with <b>dlopen</b>(3) and calls function &quot;int clsyncapi_sync(int
  n, api_eventinfo_t *ei)&quot; from it for every sync. <b>n</b> is number of
  elements of <b>ei</b>. <b>ei</b> is an array of structures with information
  about what and how to sync (see below).
<div style="height: 1.00em;">&#x00A0;</div>
api_eventinfo_t is a structure:
<div style="margin-left: 5.00ex;">struct api_eventinfo {
<div>&#x00A0;</div>
<br/>
 uint32_t evmask;		// event bitmask for file/dir by path <b>path</b>.
<div>&#x00A0;</div>
<br/>
 uint32_t flags;		// flags of &quot;how to sync&quot; the file/dir
<div>&#x00A0;</div>
<br/>
 size_t path_len;		// strlen(path)
<div>&#x00A0;</div>
<br/>
 const char *path;		// the <b>path</b> to file/dir need to be synced
<div>&#x00A0;</div>
<br/>
 eventobjtype_t objtype_old;	// type of object by path <b>path</b> before the
  event.
<div>&#x00A0;</div>
<br/>
 eventobjtype_t objtype_new;	// type of object by path <b>path</b> after the
  event.
<div>&#x00A0;</div>
};
<div>&#x00A0;</div>
typedef struct api_eventinfo api_eventinfo_t;</div>
<div style="height: 1.00em;">&#x00A0;</div>
The event bitmask (evmask) values can be learned from
  &quot;/usr/include/linux/inotify.h&quot;.
<div style="height: 1.00em;">&#x00A0;</div>
There may be next flags' values (flags):
<div style="margin-left: 5.00ex;">enum eventinfo_flags {
<div>&#x00A0;</div>
<br/>
 EVIF_NONE = 0x00000000,	// No modifier
<div>&#x00A0;</div>
<br/>
 EVIF_RECURSIVELY = 0x00000001	// sync the file/dir recursively
<div>&#x00A0;</div>
};</div>
<div>&#x00A0;</div>
Flag &quot;EVIF_RECURSIVELY&quot; may be used if option
  <i>--have-recursive-sync</i> is set.
<div style="height: 1.00em;">&#x00A0;</div>
Is that a file or directory by path <b>path</b> can be determined with
  <b>objtype_old</b> and <b>objtype_new</b>.
<div>&#x00A0;</div>
<b>objtype_old</b> reports about which type was the object by the path before
  the event.
<div>&#x00A0;</div>
<b>objtype_new</b> reports about which type became the object by the path after
  the event.
<div style="height: 1.00em;">&#x00A0;</div>
<b>objtype_old</b> and <b>objtype_new</b> have type <b>eventobjtype_t</b>.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">enum eventobjtype {
<div>&#x00A0;</div>
<br/>
 EOT_UNKNOWN = 0,	// Unknown
<div>&#x00A0;</div>
<br/>
 EOT_DOESNTEXIST = 1,	// Doesn't exist (not created yet or already deleted)
<div>&#x00A0;</div>
<br/>
 EOT_FILE = 2,	// File
<div>&#x00A0;</div>
<br/>
 EOT_DIR = 3,	// Directory
<div>&#x00A0;</div>
} typedef enum eventobjtype eventobjtype_t;</div>
<div style="height: 1.00em;">&#x00A0;</div>
Also may be defined functions &quot;int clsyncapi_init(options_t *, indexes_t
  *)&quot; and &quot;int clsyncapi_deinit()&quot; to initialize and deinitialize
  the syncing process by this shared object.
<div style="height: 1.00em;">&#x00A0;</div>
To fork the process should be used function &quot;pid_t clsyncapi_fork(options_t
  *)&quot; instead of &quot;pid_t fork()&quot; to make clsync be able to kill
  the child.
<div style="height: 1.00em;">&#x00A0;</div>
See example file &quot;clsync-synchandler-so.c&quot;.
<div style="height: 1.00em;">&#x00A0;</div>
Recommended case.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="ENVIRONMENT_VARIABLES"><a class="selflink" href="#ENVIRONMENT_VARIABLES">ENVIRONMENT
  VARIABLES</a></h1>
Output variables - variables that are set by clsync before calling
  <i>sync-handler</i>.
<div style="height: 1.00em;">&#x00A0;</div>
<b>Output variables</b>
<div style="margin-left: 5.00ex;">CLSYNC_STATUS - <b>clsync</b>'s status (see
  possible statuses in description of <i>--status-file</i>)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">CLSYNC_ITERATION - count of done
  synchronizaton iterations after initial sync see --max-iterations option</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="RULES"><a class="selflink" href="#RULES">RULES</a></h1>
Filter rules can be used to set which events clsync should monitor and which
  events it should ignore.
<div style="height: 1.00em;">&#x00A0;</div>
<b>Caution!</b> This rules doesn't guarantee that filtered file/dir won't be
  synced. This can occur because file or directory can appear in the moment of
  <b>sync-handler</b> running (or after it but before the <b>sync-handler</b>
  will reach the directory), so it'll be too late to add an exclusion. If you
  need a guarantee of file syncing preventing you can use internal filter rules
  of the <b>sync-handler</b> program (for example, rsync has options
  &quot;--exclude&quot;, &quot;--exclude-from&quot; and &quot;--filter&quot;) or
  use disable any &quot;recursive&quot; syncs in <b>clsync</b> (and remove
  &quot;-av&quot; option of rsync if it's used). To disable recursive syncs you
  can use:
<div style="margin-left: 5.00ex;"><b>simple</b>
<div style="margin-left: 5.00ex;">Already non-recursive</div>
<b>direct</b>
<div style="margin-left: 5.00ex;">Already non-recursive</div>
<b>shell</b>
<div style="margin-left: 5.00ex;">Don't enable option
  --have-recursive-sync.</div>
<b>rsyncdirect</b>
<div style="margin-left: 5.00ex;">Use option --rsync-prefer-include and set
  <i>sync-handler-arguments</i> to -lptgoD --delete --include-from
  %INCLUDE-LIST-PATH% --exclude='*' %watch-dir%/ %destination-dir%/</div>
<b>rsyncshell</b>
<div style="margin-left: 5.00ex;">Use option --rsync-prefer-include.</div>
<b>rsyncso</b>
<div style="margin-left: 5.00ex;">Use option --rsync-prefer-include.</div>
<b>so</b>
<div style="margin-left: 5.00ex;">Don't enable option
  --have-recursive-sync.</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
Filter rules can be placed into <i>rules-file</i> with one rule per line.
<div style="height: 1.00em;">&#x00A0;</div>
Rule format: <i>[+-][fdw*]regexp</i>
<div style="height: 1.00em;">&#x00A0;</div>
<i>+</i> - means include; <i>-</i> - means exclude; <i>f</i> - means file;
  <i>d</i> - means directory; <i>w</i> - means walking to directory; <i>*</i> -
  means all.
<div style="height: 1.00em;">&#x00A0;</div>
For example: -*^/[Tt]est
<div style="height: 1.00em;">&#x00A0;</div>
It's not recommended to use <i>w</i> rules in modes &quot;rsyncdirect&quot;,
  &quot;rsyncshell&quot; and &quot;rsyncso&quot;. <b>rsync</b>(1) allows one to
  set syncing and walking only together in &quot;--include&quot; rules
  (&quot;--files-from&quot; is not appropriate due to problem with syncing files
  deletions). So there may be problems with clsync's <i>w</i> rules in this
  cases.
<div style="height: 1.00em;">&#x00A0;</div>
More examples:
<div style="height: 1.00em;">&#x00A0;</div>
Syncing pwdb files and sshd_config (non-rsync case):
<div style="margin-left: 5.00ex;">	+f^/passwd$
<div>&#x00A0;</div>
	+f^/group$
<div>&#x00A0;</div>
	+f^/shadow$
<div>&#x00A0;</div>
	+f^/ssh/sshd_config$
<div>&#x00A0;</div>
	+w^$
<div>&#x00A0;</div>
	+w^/ssh$
<div>&#x00A0;</div>
	-*</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
Syncing pwdb files and sshd_config (rsync case):
<div style="margin-left: 5.00ex;">	+f^/passwd$
<div>&#x00A0;</div>
	+f^/group$
<div>&#x00A0;</div>
	+f^/shadow$
<div>&#x00A0;</div>
	+f^/ssh/sshd_config$
<div>&#x00A0;</div>
	+d^$
<div>&#x00A0;</div>
	+d^/ssh$
<div>&#x00A0;</div>
	-*</div>
<div style="height: 1.00em;">&#x00A0;</div>
Syncing /srv/lxc tree (rsync case):
<div style="margin-left: 5.00ex;">	-d/sess(ion)?s?$
<div>&#x00A0;</div>
	-f/tmp/
<div>&#x00A0;</div>
	+*</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="SIGNALS"><a class="selflink" href="#SIGNALS">SIGNALS</a></h1>
1 - (HUP) rereads filter rules
<div style="height: 1.00em;">&#x00A0;</div>
2 - (INT) exits without waiting of syncing processes (&quot;hard kill&quot;,
  kills children)
<div style="height: 1.00em;">&#x00A0;</div>
3 - (QUIT) waits for current syncing processes and exit (&quot;soft kill&quot;,
  waits for children)
<div style="height: 1.00em;">&#x00A0;</div>
10 - runs threads' GC function
<div style="height: 1.00em;">&#x00A0;</div>
12 - runs full resync
<div style="height: 1.00em;">&#x00A0;</div>
15 - (TERM) exits without waiting of syncing processes (&quot;hard kill&quot;,
  kills children)
<div style="height: 1.00em;">&#x00A0;</div>
16 - interrupts sleep()/select() and wait() [for debugging and internal uses]
<div style="height: 1.00em;">&#x00A0;</div>
29 - dump information to <i>dump-dir</i> [for debugging]
<div style="height: 1.00em;">&#x00A0;</div>
If you need to kill clsync but leave children then you can use 9-th (KILL)
  signal.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="DIAGNOSTICS"><a class="selflink" href="#DIAGNOSTICS">DIAGNOSTICS</a></h1>
Initial rsync process works very slow on clsync start
<div style="margin-left: 5.00ex;">Probably there's too huge exclude list is
  passed to rsync. This can happened if you're excluding with regex in clsync's
  rules a lot of thousands files. They will be passed to rsync's exclude list
  one by one.
<div style="height: 1.00em;">&#x00A0;</div>
To diagnose it, you can use &quot;-U&quot; option and look into
  <i>rsync-exclude-listpath</i> file (see <b>SYNC HANDLER</b> case <b>d</b>)
<div style="height: 1.00em;">&#x00A0;</div>
To prevent this, it's recommended to write such rules for rsync directly (not
  via clsync).
<div style="height: 1.00em;">&#x00A0;</div>
For example, often problem is with PHP's session files. You shouldn't exclude
  them in clsync's rules with &quot;-f/sess_.*&quot;, but you should exclude it
  in rsync directly (e.g with &#x00AB;--exclude
  &quot;sess_*&quot;&#x00BB;).</div>
<div style="height: 1.00em;">&#x00A0;</div>
The following diagnostics may be issued on stderr:
<div style="height: 1.00em;">&#x00A0;</div>
Error: Cannot inotify_add_watch() on [...]: No space left on device (errno: 28)
<div style="margin-left: 5.00ex;">Not enough inotify watching descriptors is
  allowed. It can be fixed by increasing value of &quot;sysctl
  fs.inotify.max_user_watches&quot;</div>
<div style="height: 1.00em;">&#x00A0;</div>
Error: Got non-zero exitcode <i>exitcode</i> [...]
<div style="margin-left: 5.00ex;"><i>sync-handler</i> returned non-zero
  exitcode. Probably, you should process exitcodes in it or your syncer process
  didn't worked well. I case of using rsync, you can find the exitcodes meanings
  in <b>man 1 rsync</b>.
<div style="height: 1.00em;">&#x00A0;</div>
If <i>exitcode</i> equals to 23 and you're using <b>clsync</b> in conjunction
  with <b>rsync</b>, this may happend, for example in next cases:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
- Not enough space on destination.
<div style="height: 1.00em;">&#x00A0;</div>
- You're running clsync with <b>--threading=full</b> and rsync with
  <b>--backup</b>. See a bugreport &#x27E8;URL:
  https://bugzilla.samba.org/show_bug.cgi?id=10081 &#x27E9;.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
To confirm the problem, you can try to add &quot;return 0&quot; or &quot;exit
  0&quot; into your <i>sync-handler</i>.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>Bad system call</b>
<div style="margin-left: 5.00ex;">If --use-seccomp option is enabled then the
  error is probably caused by using of forbidden syscall. It's a <b>clsync</b>
  bug or hack attack attempt.</div>
<div style="height: 1.00em;">&#x00A0;</div>
To get support see <b>SUPPORT</b>.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="CONFIGURATION_FILE"><a class="selflink" href="#CONFIGURATION_FILE">CONFIGURATION
  FILE</a></h1>
<b>clsync</b> supports configuration file.
<div style="height: 1.00em;">&#x00A0;</div>
By default <b>clsync</b> tries to read next files (in specified order):
<div style="margin-left: 5.00ex;">~/.clsync.conf
<div>&#x00A0;</div>
/etc/clsync/clsync.conf</div>
<div style="height: 1.00em;">&#x00A0;</div>
This may be overrided with option <i>--config-file</i>.
<div style="height: 1.00em;">&#x00A0;</div>
<b>clsync</b> reads only one configuration file. In other words, if option
  <i>--config-file</i> is not set and file <b>~/.clsync.conf</b> is accessible
  and parsable, <b>clsync</b> will not try to open
  <b>/etc/clsync/clsync.conf</b>. Command line options have precedence over
  config file options.
<div style="height: 1.00em;">&#x00A0;</div>
Configuration file is parsed with glib's g_key_file_* API. That means, that
  config should consits from groups (blocks) of key-value lines as in the
  example:
<div style="margin-left: 5.00ex;">[default]
<div>&#x00A0;</div>
background = 1
<div>&#x00A0;</div>
mode = rsyncshell
<div>&#x00A0;</div>
debug = 0
<div>&#x00A0;</div>
output = syslog
<div>&#x00A0;</div>
label = default
<div>&#x00A0;</div>
pid-file = /var/run/clsync-%label%.pid
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
[debug]
<div>&#x00A0;</div>
config-block-inherits = default
<div>&#x00A0;</div>
debug = 5
<div>&#x00A0;</div>
background = 0
<div>&#x00A0;</div>
output = stderr
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
[test]
<div>&#x00A0;</div>
mode=rsyncdirect
<div>&#x00A0;</div>
debug=3</div>
<div style="height: 1.00em;">&#x00A0;</div>
Also glib's <b>gkf</b> API doesn't support multiple assignments. If you need to
  list some values (e.g. exitcodes) just list them with commas in single
  assignment (e.g. &quot;ignore-exitcode=23,24&quot;).
<div style="height: 1.00em;">&#x00A0;</div>
In this example there're 3 blocks are set - &quot;default&quot;,
  &quot;debug&quot; and &quot;test&quot;. And block &quot;debug&quot; inherited
  setup of block &quot;default&quot; except options &quot;debug&quot;,
  &quot;background&quot; and &quot;output&quot;.
<div style="height: 1.00em;">&#x00A0;</div>
By default <b>clsync</b> uses block with name &quot;default&quot;. Block name
  can be set by option <i>--config-block</i>.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="CLUSTERING"><a class="selflink" href="#CLUSTERING">CLUSTERING</a></h1>
Not implemented yet. <b>Don't try to use cluster functionality.</b>
<div style="height: 1.00em;">&#x00A0;</div>
Not described yet.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
<b>Mirroring a directory:</b>
<div style="margin-left: 5.00ex;">clsync -Mrsyncdirect -W/path/to/source_dir
  -D/path/to/destination_dir</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>Syncing 'authorized_keys' files:</b>
<div style="margin-left: 5.00ex;">mkdir -p /etc/clsync/rules
<div>&#x00A0;</div>
printf &quot;+w^$0w^[^/]+$0w^[^/]+/.ssh$0f^[^/]+/.ssh/authorized_keys$0*&quot;
  &gt; /etc/clsync/rules/authorized_files_only
<div>&#x00A0;</div>
clsync -Mdirect -Scp -W/mnt/master/home/ -D/home
  -R/etc/clsync/rules/authorized_files_only -- -Pfp --parents %INCLUDE-LIST%
  %destination-dir%</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>Mirroring a directory, but faster:</b>
<div style="margin-left: 5.00ex;">clsync -w5 -t5 -T5 -Mrsyncdirect
  -W/path/to/source_dir -D/path/to/destination_dir</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>Instant mirroring of a directory:</b>
<div style="margin-left: 5.00ex;">clsync -w0 -t0 -T0 -Mrsyncdirect
  -W/path/to/source_dir -D/path/to/destination_dir</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>Making two directories synchronous:</b>
<div style="margin-left: 5.00ex;">clsync -Mrsyncdirect --background -z
  /var/run/clsync0.pid --output syslog -Mrsyncdirect -W/path/to/dir1
  -D/path/to/dir2 --modification-signature '*'
<div>&#x00A0;</div>
clsync -Mrsyncdirect --background -z /var/run/clsync1.pid --output syslog
  -Mrsyncdirect -W/path/to/dir2 -D/path/to/dir1 --modification-signature
  '*'</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>Fixing privileges of a web-site:</b>
<div style="margin-left: 5.00ex;">clsync -w3 -t3 -T3 -x1
  -W/var/www/site.example.org/root -Mdirect -Schown --uid 0 --gid 0 -Ysyslog -b1
  --modification-signature uid,gid -- --from=root www-data:www-data
  %INCLUDE-LIST%</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>'Atomic' sync:</b>
<div style="margin-left: 5.00ex;">clsync --exit-on-no-events --max-iterations=20
  --mode=rsyncdirect -W/var/www_new -Srsync -- %RSYNC-ARGS% /var/www_new/
  /var/www/</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>Moving a web-server:</b>
<div style="margin-left: 5.00ex;">clsync --exit-on-no-events --max-iterations=20
  --pre-exit-hook=/root/stop-here.sh --exit-hook=/root/start-there.sh
  --mode=rsyncdirect --ignore-exitcode=23,24 --retries=3 -W /var/www -S rsync --
  %RSYNC-ARGS% /var/www/ rsync://clsync@another-host/var/www/</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>Copying files to slave-nodes using</b> <b>pdcp</b>(1):
<div style="margin-left: 5.00ex;">clsync -Msimple -S pdcp -W /opt/global -b -Y
  syslog -- -a %INCLUDE-LIST% %INCLUDE-LIST%</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>Copying files to slave-nodes using</b> <b>uftp</b>(1):
<div style="margin-left: 5.00ex;">clsync -Mdirect -S uftp -W/opt/global
  --background=1 --output=syslog -- -M 248.225.233.1 %INCLUDE-LIST%</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>A dry running to see</b> <b>rsync</b>(1) <b>arguments that clsync will
  use:</b>
<div style="margin-left: 5.00ex;">clsync -Mrsyncdirect -S echo
  -W/path/to/source_dir -D/path/to/destination_dir</div>
<div style="height: 1.00em;">&#x00A0;</div>
<b>An another dry running to look how clsync will call</b> <b>pdcp</b>(1):
<div style="margin-left: 5.00ex;">clsync -Msimple -S echo -W /opt/global -b0 --
  pdcp -a %INCLUDE-LIST% %INCLUDE-LIST%</div>
<div style="height: 1.00em;">&#x00A0;</div>
More working examples you can try out in
  &quot;/usr/share/doc/clsync/examples/&quot; directory. Copy this directory
  somewhere (e.g. into &quot;/tmp&quot;). And try to run
  &quot;clsync-start-rsync.sh&quot; in there. Any files/directories
  modifications in &quot;testdir/from&quot; will be synced to
  &quot;testdir/to&quot; in a few seconds.
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Dmitry Yu Okunev &lt;dyokunev@ut.mephi.ru&gt; 0x8E30679C
<h1 class="Sh" title="Sh" id="SUPPORT"><a class="selflink" href="#SUPPORT">SUPPORT</a></h1>
You can get support on official IRC-channel in Freenode &quot;#clsync&quot; or
  on github's issue tracking system of the clsync repository &#x27E8;URL:
  https://github.com/xaionaro/clsync &#x27E9;.
<div style="height: 1.00em;">&#x00A0;</div>
Don't be afraid to ask about clsync configuration, ;).
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>rsync</b>(1), <b>pthreads</b>(7), <b>inotify</b>(7) <b>kqueue</b>(2)
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">JULY 2013</td>
    <td class="foot-os">Linux</td>
  </tr>
</table>
</body>
</html>
