<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>STAP(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">STAP(1)</td>
    <td class="head-vol">General Commands Manual</td>
    <td class="head-rtitle">STAP(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
stap - systemtap script translator/driver
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>stap</b> [ <i>OPTIONS</i> ] <i>FILENAME</i> [ <i>ARGUMENTS</i> ]
<div>&#x00A0;</div>
<b>stap</b> [ <i>OPTIONS</i> ] <b>-</b> [ <i>ARGUMENTS</i> ]
<div>&#x00A0;</div>
<b>stap</b> [ <i>OPTIONS</i> ] <b>-e</b><i> SCRIPT</i> [ <i>ARGUMENTS</i> ]
<div>&#x00A0;</div>
<b>stap</b> [ <i>OPTIONS</i> ] <b>-l</b><i> PROBE</i> [ <i>ARGUMENTS</i> ]
<div>&#x00A0;</div>
<b>stap</b> [ <i>OPTIONS</i> ] <b>-L</b><i> PROBE</i> [ <i>ARGUMENTS</i> ]
<div>&#x00A0;</div>
<b>stap</b> [ <i>OPTIONS</i> ] <b>--dump-probe-types</b>
<div>&#x00A0;</div>
<b>stap</b> [ <i>OPTIONS</i> ] <b>--dump-probe-aliases</b>
<div>&#x00A0;</div>
<b>stap</b> [ <i>OPTIONS</i> ] <b>--dump-functions</b>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
The <i>stap</i> program is the front-end to the Systemtap tool. It accepts
  probing instructions written in a simple domain-specific language, translates
  those instructions into C code, compiles this C code, and loads the resulting
  module into a running Linux kernel or a DynInst user-space mutator, to perform
  the requested system trace/probe functions. You can supply the script in a
  named file (FILENAME), from standard input (use - instead of FILENAME), or
  from the command line (using -e SCRIPT). The program runs until it is
  interrupted by the user, or if the script voluntarily invokes the
  <i>exit()</i> function, or by sufficient number of soft errors.
<div class="Pp"></div>
The language, which is described the <i>SCRIPT LANGUAGE</i> section below, is
  strictly typed, expressive, declaration free, procedural,
  prototyping-friendly, and inspired by <i>awk</i> and <i>C</i>. It allows
  source code points or events in the system to be associated with handlers,
  which are subroutines that are executed synchronously. It is somewhat similar
  conceptually to &quot;breakpoint command lists&quot; in the <i>gdb</i>
  debugger.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="DOCUMENTATION_OVERVIEW"><a class="selflink" href="#DOCUMENTATION_OVERVIEW">DOCUMENTATION
  OVERVIEW</a></h1>
systemtap comes with a variety of educational, documentation and reference
  resources. They come online and/or packaged for offline use. For online
  documentation, see the project web site, https://sourceware.org/systemtap/
<div style="height: 1.00em;">&#x00A0;</div>
<table class="tbl">
  <colgroup>
    <col style="width: 18.00ex;"/>
    <col style="width: 72.00ex;"/>
  </colgroup>
  <tr>
    <td><b>man pages</b></td>
    <td></td>
  </tr>
  <tr>
    <td>stap (this page)</td>
    <td>language syntax, concepts, operation, options</td>
  </tr>
  <tr>
    <td>stapprobes</td>
    <td>probe points and their $context variables</td>
  </tr>
  <tr>
    <td>stapref</td>
    <td>quick reference to language syntax</td>
  </tr>
  <tr>
    <td>stappaths</td>
    <td>list of directories, including books &amp; references</td>
  </tr>
  <tr>
    <td>stap-prep</td>
    <td>program to install auxiliary dependencies like kernel debuginfo</td>
  </tr>
  <tr>
    <td>tapset::*</td>
    <td>generated list of tapsets</td>
  </tr>
  <tr>
    <td>probe::*</td>
    <td>generated list of tapset probe aliases</td>
  </tr>
  <tr>
    <td>function::*</td>
    <td>generated list of tapset functions</td>
  </tr>
  <tr>
    <td>macro::*</td>
    <td>generated list of tapset macros</td>
  </tr>
  <tr>
    <td>stapvars</td>
    <td>some of the tapset global variables</td>
  </tr>
  <tr>
    <td>staprun, stapdyn</td>
    <td>programs for executing compiled systemtap scripts</td>
  </tr>
  <tr>
    <td>systemtap</td>
    <td>initscript, boot-time probing</td>
  </tr>
  <tr>
    <td>stap-server</td>
    <td>compilation server</td>
  </tr>
  <tr>
    <td>stapex</td>
    <td>a few very basic script examples</td>
  </tr>
  <tr>
    <td><b>books</b></td>
    <td></td>
  </tr>
  <tr>
    <td>Beginner's Guide</td>
    <td>tutorial book, language essentials, examples</td>
  </tr>
  <tr>
    <td>Tutorial</td>
    <td>shorter tutorial, exercises</td>
  </tr>
  <tr>
    <td>Language Reference</td>
    <td>detailed language manual, covers statistics/analysis</td>
  </tr>
  <tr>
    <td>Tapset Reference</td>
    <td>the tapset man pages, reformatted into a book</td>
  </tr>
  <tr>
    <td><b>references</b></td>
    <td></td>
  </tr>
  <tr>
    <td>example scripts</td>
    <td>over a hundred directly usable sysadmin tools, toys, hacks to learn
      from</td>
  </tr>
</table>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
The systemtap translator supports the following options. Any other option prints
  a list of supported options. Options may be given on the command line, as
  usual. If the file $SYSTEMTAP_DIR/rc exist, options are also loaded from there
  and interpreted first. ($SYSTEMTAP_DIR defaults to $HOME/.systemtap if unset.)
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
In some cases, the default value of an option depends on particular system
  configuration and thus can't be mentioned here directly. In some of those
  cases running &quot;stap --help&quot; might display the default.
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-</b></dt>
  <dd class="It-tag">Use standard input instead of a given FILENAME as probe
      language input, unless -e SCRIPT is given.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-h --help</b></dt>
  <dd class="It-tag">Show help message.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-V --version</b></dt>
  <dd class="It-tag">Show version message.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-p</b><i> NUM</i></dt>
  <dd class="It-tag">Stop after pass NUM. The passes are numbered 1-5: parse,
      elaborate, translate, compile, run. See the <b>PROCESSING</b> section for
      details.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-v</b></dt>
  <dd class="It-tag">Increase verbosity for all passes. Produce a larger volume
      of informative (?) output each time option repeated.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--vp ABCDE</b></dt>
  <dd class="It-tag">Increase verbosity on a per-pass basis. For example,
      &quot;--vp&#x00A0;002&quot; adds 2 units of verbosity to pass 3 only. The
      combination &quot;-v&#x00A0;--vp&#x00A0;00004&quot; adds 1 unit of
      verbosity for all passes, and 4 more for pass 5.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-k</b></dt>
  <dd class="It-tag">Keep the temporary directory after all processing. This may
      be useful in order to examine the generated C code, or to reuse the
      compiled kernel object.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-g</b></dt>
  <dd class="It-tag">Guru mode. Enable parsing of unsafe expert-level constructs
      like embedded C.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-P</b></dt>
  <dd class="It-tag">Prologue-searching mode. This is equivalent to
      --prologue-searching=always. Activate heuristics to work around incorrect
      debugging information for function parameter $context variables.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-u</b></dt>
  <dd class="It-tag">Unoptimized mode. Disable unused code elision and many
      other optimizations during elaboration / translation.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-w</b></dt>
  <dd class="It-tag">Suppressed warnings mode. Disables all warning
    messages.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-W</b></dt>
  <dd class="It-tag">Treat all warnings as errors.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-b</b></dt>
  <dd class="It-tag">Use bulk mode (percpu files) for kernel-to-user data
      transfer. Use the <i>stap-merge</i> program to multiplex them back
      together later.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-t</b></dt>
  <dd class="It-tag">Collect timing information on the number of times probe
      executes and average amount of time spent in each probe-point. Also shows
      the derivation for each probe-point.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-s</b><i> NUM</i></dt>
  <dd class="It-tag">Use NUM megabyte buffers for kernel-to-user data transfer.
      On a multiprocessor in bulk mode, this is a per-processor amount.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-I</b><i> DIR</i></dt>
  <dd class="It-tag">Add the given directory to the tapset search directory. See
      the description of pass 2 for details.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-D</b><i> NAME=VALUE</i></dt>
  <dd class="It-tag">Add the given C preprocessor directive to the module
      Makefile. These can be used to override limit parameters described
    below.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-B</b><i> NAME=VALUE</i></dt>
  <dd class="It-tag">In kernel-runtime mode, add the given make directive to the
      kernel module build's make invocation. These can be used to add or
      override kconfig options. For example, use
    <div>&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div style="margin-left: 5.00ex;">
<pre>
<b>-B CONFIG_DEBUG_INFO=y</b>
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
to add debugging information.
<dl class="Bl-tag">
  <dt class="It-tag"><b>-B</b><i> FLAG</i></dt>
  <dd class="It-tag">In dyninst-runtime mode, add the given parameter to the
      compiler CFLAGS used for building the dyninst shared library. For example,
      use
    <div>&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div style="margin-left: 5.00ex;">
<pre>
<b>-B -g</b>
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
to add debugging information.
<dl class="Bl-tag">
  <dt class="It-tag"><b>-a</b><i> ARCH</i></dt>
  <dd class="It-tag">Use a cross-compilation mode for the given target
      architecture. This requires access to the cross-compiler and the kernel
      build tree, and goes along with the
    <div>&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div style="margin-left: 5.00ex;">
<pre>
<b>-B CROSS_COMPILE=arch-tool-prefix-</b>
and
<b>-r /build/tree</b>
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
options.
<dl class="Bl-tag">
  <dt class="It-tag"><b>--modinfo</b><i> NAME=VALUE</i></dt>
  <dd class="It-tag">Add the name/value pair as a MODULE_INFO macro call to the
      generated module. This may be useful to inform or override various
      module-related checks in the kernel.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-G</b><i> NAME=VALUE</i></dt>
  <dd class="It-tag">Sets the value of global variable NAME to VALUE when
      staprun is invoked. This applies to scalar variables declared global in
      the script/tapset.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-R</b><i> DIR</i></dt>
  <dd class="It-tag">Look for the systemtap runtime sources in the given
      directory. Your DIR default can be seen using &quot;stap
    --help&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-r</b><i> /DIR</i></dt>
  <dd class="It-tag">Build for kernel in given build tree. Can also be set with
      the <i>SYSTEMTAP_RELEASE</i> environment variable.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-r</b><i> RELEASE</i></dt>
  <dd class="It-tag">Build for kernel in build tree
      <b>/lib/modules/RELEASE/build</b>. Can also be set with the
      <i>SYSTEMTAP_RELEASE</i> environment variable.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-m</b><i> MODULE</i></dt>
  <dd class="It-tag">Use the given name for the generated kernel object module,
      instead of a unique randomized name. The generated kernel object module is
      copied to the current directory.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-d</b><i> MODULE</i></dt>
  <dd class="It-tag">Add symbol/unwind information for the given module into the
      kernel object module. This may enable symbolic tracebacks from those
      modules/programs, even if they do not have an explicit probe placed into
      them.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ldd</b></dt>
  <dd class="It-tag">Add symbol/unwind information for all user-space shared
      libraries suspected by ldd to be necessary for user-space binaries being
      probed or listed with the -d option. Caution: this can make the probe
      modules considerably larger. Note that this option does not deal with
      kernel-space modules: see instead --all-modules below.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--all-modules</b></dt>
  <dd class="It-tag">Equivalent to specifying &quot;-dkernel&quot; and a
      &quot;-d&quot; for each kernel module that is currently loaded. Caution:
      this can make the probe modules considerably larger.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-o</b><i> FILE</i></dt>
  <dd class="It-tag">Send standard output to named file. In bulk mode, percpu
      files will start with FILE_ (FILE_cpu with -F) followed by the cpu number.
      This supports strftime(3) formats for FILE.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-c</b><i> CMD</i></dt>
  <dd class="It-tag">Start the probes, run CMD, and exit when CMD finishes. This
      also has the effect of setting target() to the pid of the command
    ran.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-x</b><i> PID</i></dt>
  <dd class="It-tag">Sets target() to PID. This allows scripts to be written
      that filter on a specific process. Scripts run independent of the PID's
      lifespan.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-e</b><i> SCRIPT</i></dt>
  <dd class="It-tag">Run the given SCRIPT specified on the command line.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-E</b><i> SCRIPT</i></dt>
  <dd class="It-tag">Run the given SCRIPT specified. This SCRIPT is run in
      addition to the main script specified, through -e, or as a script file.
      This option can be repeated to run multiple scripts, and can be used in
      listing mode (-l/-L).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-l</b><i> PROBE</i></dt>
  <dd class="It-tag">Instead of running a probe script, just list all available
      probe points matching the given single probe point. The pattern may
      include wildcards and aliases, but not comma-separated multiple probe
      points. The process result code will indicate failure if there are no
      matches.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-L</b><i> PROBE</i></dt>
  <dd class="It-tag">Similar to &quot;-l&quot;, but list probe points and
      script-level local variables.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-F</b></dt>
  <dd class="It-tag">Without -o option, load module and start probes, then
      detach from the module leaving the probes running. With -o option, run
      staprun in background as a daemon and show its pid.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-S</b><i> size[,N]</i></dt>
  <dd class="It-tag">Sets the maximum size of output file and the maximum number
      of output files. If the size of output file will exceed <b>size</b> ,
      systemtap switches output file to the next file. And if the number of
      output files exceed <b>N</b> , systemtap removes the oldest output file.
      You can omit the second argument.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--skip-badvars</b></dt>
  <dd class="It-tag">Ignore unresolvable or run-time-inaccessible context
      variables and substitute with 0, without errors.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--prologue-searching</b>[=<i>WHEN</i>]</dt>
  <dd class="It-tag">Prologue-searching mode. Activate heuristics to work around
      incorrect debugging information for function parameter $context variables.
      WHEN can be either &quot;never&quot;, &quot;always&quot;, or
      &quot;auto&quot; (i.e. enabled by heuristic). If WHEN is missing, then
      &quot;always&quot; is assumed. If the option is missing, then
      &quot;auto&quot; is assumed.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--suppress-handler-errors</b></dt>
  <dd class="It-tag">Wrap all probe handlers into something like this
    <div>&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div style="margin-left: 5.00ex;">
<pre>
try { ... } catch { next }
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
block, which causes any runtime errors to be quietly suppressed. Suppressed
  errors do not count against <b>MAXERRORS</b> limits. In this mode, the
  <b>MAXSKIPPED</b> limits are also suppressed, so that many errors and skipped
  probes may be accumulated during a script's runtime. Any overall counts will
  still be reported at shutdown.
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--compatible</b><i> VERSION</i></dt>
  <dd class="It-tag">Suppress recent script language or tapset changes which are
      incompatible with given older version of systemtap. This may be useful if
      a much older systemtap script fails to run. See the DEPRECATION section
      for more details.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--check-version</b></dt>
  <dd class="It-tag">This option is used to check if the active script has any
      constructs that may be systemtap version specific. See the DEPRECATION
      section for more details.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--clean-cache</b></dt>
  <dd class="It-tag">This option prunes stale entries from the cache directory.
      This is normally done automatically after successful runs, but this option
      will trigger the cleanup manually and then exit. See the CACHING section
      for more details about cache limits.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--color</b>[=<i>WHEN</i>],
    <b>--colour</b>[=<i>WHEN</i>]</dt>
  <dd class="It-tag">This option controls coloring of error messages. WHEN can
      be either &quot;never&quot;, &quot;always&quot;, or &quot;auto&quot; (i.e.
      enable only if at a terminal). If WHEN is missing, then &quot;always&quot;
      is assumed. If the option is missing, then &quot;auto&quot; is assumed.
    <div style="height: 1.00em;">&#x00A0;</div>
    Colors can be modified using the SYSTEMTAP_COLORS environment variable. The
      format must be of the form <b>key1=val1:key2=val2:key3=val3</b> ...etc.
      Valid keys are &quot;error&quot;, &quot;warning&quot;, &quot;source&quot;,
      &quot;caret&quot;, and &quot;token&quot;. Values constitute Select Graphic
      Rendition (SGR) parameter(s). Consult the documentation of your terminal
      for the SGRs it supports. As an example, the default colors would be
      expressed as
      <b>error=01;31:warning=00;33:source=00;34:caret=01:token=01</b>. If
      SYSTEMTAP_COLORS is absent, the default colors will be used. If it is
      empty or invalid, coloring is turned off.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--disable-cache</b></dt>
  <dd class="It-tag">This option disables all use of the cache directory. No
      files will be either read from or written to the cache.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--poison-cache</b></dt>
  <dd class="It-tag">This option treats files in the cache directory as invalid.
      No files will be read from the cache, but resulting files from this run
      will still be written to the cache. This is meant as a troubleshooting aid
      when stap's cached behavior seems to be misbehaving.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--privilege</b>[=<i>stapusr</i> | =<i>stapsys</i> |
    =<i>stapdev</i>]</dt>
  <dd class="It-tag">This option instructs <i>stap</i> to examine the script
      looking for constructs which are not allowed for the specified privilege
      level (see <i>UNPRIVILEGED USERS</i>). Compilation fails if any such
      constructs are used. If <i>stapusr</i> or <i>stapsys</i> are specified
      when using a compile server (see <i>--use-server</i>), the server will
      examine the script and, if compilation succeeds, the server will
      cryptographically sign the resulting kernel module, certifying that is it
      safe for use by users at the specified privilege level.
    <div style="height: 1.00em;">&#x00A0;</div>
    If <i>--privilege</i> has not been specified, <i>-pN</i> has not been
      specified with N &lt; 5, and the invoking user is not <i>root</i>, and is
      not a member of the group <i>stapdev</i>, then <i>stap</i> will
      automatically add the appropriate <i>--privilege</i> option to the options
      already specified.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--unprivileged</b></dt>
  <dd class="It-tag">This option is equivalent to <i>--privilege=stapusr</i>.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--use-server</b>[=<i>HOSTNAME</i>[<i>:PORT</i>] |
    =<i>IP_ADDRESS</i>[ <i>:PORT</i>] | =<i>CERT_SERIAL</i>]</dt>
  <dd class="It-tag">Specify compile-server(s) to be used for compilation and/or
      in conjunction with <i>--list-servers</i> and <i>--trust-servers</i> (see
      below) for listing. If no argument is supplied, then the default in
      unprivileged mode (see <i>--privilege</i>) is to select compatible servers
      which are trusted as SSL peers and as module signers and currently online.
      Otherwise the default is to select compatible servers which are trusted as
      SSL peers and currently online. <i>--use-server</i> may be specified more
      than once, in which case a list of servers is accumulated in the order
      specified. Servers may be specified by host name, ip address, or by
      certificate serial number (obtained using <i>--list-servers</i>). The
      latter is most commonly used when adding or revoking trust in a server
      (see <i>--trust-servers</i> below). If a server is specified by host name
      or ip address, then an optional port number may be specified. This is
      useful for accessing servers which are not on the local network or to
      specify a particular server.
    <div style="height: 1.00em;">&#x00A0;</div>
    IP addresses may be IPv4 or IPv6 addresses.
    <div style="height: 1.00em;">&#x00A0;</div>
    If a particular IPv6 address is link local and exists on more than one
      interface, the intended interface may be specified by appending the
      address with a percent sign (%) followed by the intended interface name.
      For example, &quot;fe80::5eff:35ff:fe07:55ca%eth0&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    In order to specify a port number with an IPv6 address, it is necessary to
      enclose the IPv6 address in square brackets ([]) in order to separate the
      port number from the rest of the address. For example,
      &quot;[fe80::5eff:35ff:fe07:55ca]:5000&quot; or
      &quot;[fe80::5eff:35ff:fe07:55ca%eth0]:5000&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    If <i>--use-server</i> has not been specified, <i>-pN</i> has not been
      specified with N &lt; 5, and the invoking user not <i>root</i>, is not a
      member of the group <i>stapdev</i>, but is a member of the group
      <i>stapusr</i>, then <i>stap</i> will automatically add
      <i>--use-server</i> to the options already specified.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--use-server-on-error</b>[=<b>yes</b>|=<b>no</b>]</dt>
  <dd class="It-tag">Instructs stap to retry compilation of a script using a
      compile server if compilation on the local host fails in a manner which
      suggests that it might succeed using a server. If this option is not
      specified, the default is <i>no</i>. If no argument is provided, then the
      default is <i>yes</i>. Compilation will be retried for certain types of
      errors (e.g. insufficient data or resources) which may not occur during
      re-compilation by a compile server. Compile servers will be selected
      automatically for the re-compilation attempt as if <i>--use-server</i> was
      specified with no arguments.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--list-servers</b><i>[=SERVERS]</i></dt>
  <dd class="It-tag">Display the status of the requested <i>SERVERS</i>, where
      <i>SERVERS</i> is a comma-separated list of server attributes. The list of
      attributes is combined to filter the list of servers displayed. Supported
      attributes are:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>all</b></dt>
  <dd class="It-tag">specifies all known servers (trusted SSL peers, trusted
      module signers, online servers).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>specified</b></dt>
  <dd class="It-tag">specifies servers specified using <i>--use-server</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>online</b></dt>
  <dd class="It-tag">filters the output by retaining information about servers
      which are currently online.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>trusted</b></dt>
  <dd class="It-tag">filters the output by retaining information about servers
      which are trusted as SSL peers.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>signer</b></dt>
  <dd class="It-tag">filters the output by retaining information about servers
      which are trusted as module signers (see <i>--privilege</i>).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>compatible</b></dt>
  <dd class="It-tag">filters the output by retaining information about servers
      which are compatible with the current kernel release and
    architecture.</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">If no argument is provided, then the default is
      <b>specified</b>. If no servers were specified using <i>--use-server</i>,
      then the default servers for <i>--use-server</i> are listed.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note that <i>--list-servers</i> uses the <i>avahi-daemon</i> service to
      detect online servers. If this service is not available, then
      <i>--list-servers</i> will fail to detect any <i>online</i> servers. In
      order for <i>--list-servers</i> to detect servers listening on IPv6
      addresses, the <i>avahi-daemon</i> configuration file
      <i>/etc/avahi/avahi-daemon.conf</i> must contain an active
      &quot;use-ipv6=yes&quot; line. The service must be restarted after adding
      this line in order for IPv6 to be enabled.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--trust-servers</b><i>[=TRUST_SPEC]</i></dt>
  <dd class="It-tag">Grant or revoke trust in compile-servers, specified using
      <i>--use-server</i> as specified by TRUST_SPEC, where TRUST_SPEC is a
      comma-separated list specifying the trust which is to be granted or
      revoked. Supported elements are:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>ssl</b></dt>
  <dd class="It-tag">trust the specified servers as SSL peers.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>signer</b></dt>
  <dd class="It-tag">trust the specified servers as module signers (see
      <i>--privilege</i>). Only root can specify <b>signer.</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>all-users</b></dt>
  <dd class="It-tag">grant trust as an ssl peer for all users on the local host.
      The default is to grant trust as an ssl peer for the current user only.
      Trust as a module signer is always granted for all users. Only root can
      specify <b>all-users</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>revoke</b></dt>
  <dd class="It-tag">revoke the specified trust. The default is to grant
    it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>no-prompt</b></dt>
  <dd class="It-tag">do not prompt the user for confirmation before carrying out
      the requested action. The default is to prompt the user for
    confirmation.</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">If no argument is provided, then the default is <b>ssl</b>.
      If no servers were specified using <i>--use-server</i>, then no trust will
      be granted or revoked.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">Unless <b>no-prompt</b> has been specified, the user will
      be prompted to confirm the trust to be granted or revoked before the
      operation is performed.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--dump-probe-types</b></dt>
  <dd class="It-tag">Dumps a list of supported probe types and exits. If
      <i>--privilege=stapusr</i> is also specified, the list will be limited to
      probe types available to unprivileged users.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--dump-probe-aliases</b></dt>
  <dd class="It-tag">Dumps a list of all probe aliases found in library files
      and exits.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--dump-functions</b></dt>
  <dd class="It-tag">Dumps a list of all the public functions found in library
      files and exits. Also includes their parameters and types. A function of
      type 'unknown' indicates a function that does not return a value. Note
      that not all function/parameter types may be resolved (these are also
      shown by 'unknown'). This features is very memory-intensive and thus may
      not work properly with <i>--use-server</i> if the target server imposes an
      rlimit on process memory (i.e. through the
      <i>~stap-server/.systemtap/rc</i> configuration file, see
      <i>stap-server</i>(8)).
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--remote</b><i> URL</i></dt>
  <dd class="It-tag">Set the execution target to the given host. This option may
      be repeated to target multiple execution targets. Passes 1-4 are completed
      locally as normal to build the script, and then pass 5 will copy the
      module to the target and run it. Acceptable URL forms include:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>[USER@]HOSTNAME</b>, <b>ssh://[USER@]HOSTNAME</b></dt>
  <dd class="It-tag">This mode uses ssh, optionally using a username not
      matching your own. If a custom ssh_config file is in use, add <b>SendEnv
      LANG</b> to retain internationalization functionality.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>libvirt://DOMAIN</b>,
    <b>libvirt://DOMAIN/LIBVIRT_URI</b></dt>
  <dd class="It-tag">This mode uses <i>stapvirt</i> to execute the script on a
      domain managed by libvirt. Optionally, LIBVIRT_URI may be specified to
      connect to a specific driver and/or a remote host. For example, to connect
      to the local privileged QEMU driver, use:
    <div>&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div style="margin-left: 5.00ex;">
<pre>
--remote libvirt://MyDomain/qemu:///system
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
See the page at &lt;http://libvirt.org/uri.html&gt; for supported URIs. Also see
  <i>stapvirt</i>(1) for more information on how to prepare the domain for stap
  probing.
<dl class="Bl-tag">
  <dt class="It-tag"><b>unix:PATH</b></dt>
  <dd class="It-tag">This mode connects to a UNIX socket. This can be used with
      a QEMU virtio-serial port for executing scripts inside a running virtual
      machine.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>direct://</b></dt>
  <dd class="It-tag">Special loopback mode to run on the local host.</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--remote-prefix</b></dt>
  <dd class="It-tag">Prefix each line of remote output with &quot;N: &quot;,
      where N is the index of the remote execution target from which the given
      line originated.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--download-debuginfo</b><i>[=OPTION]</i></dt>
  <dd class="It-tag">Enable, disable or set a timeout for the automatic
      debuginfo downloading feature offered by abrt as specified by OPTION,
      where OPTION is one of the following:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>yes</b></dt>
  <dd class="It-tag">enable automatic downloading of debuginfo with no timeout.
      This is the same as not providing an OPTION value to
      <i>--download-debuginfo</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>no</b></dt>
  <dd class="It-tag">explicitly disable automatic downloading of debuginfo. This
      is the same as not using the option at all.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>ask</b></dt>
  <dd class="It-tag">show abrt output, and ask before continuing download. No
      timeout will be set.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>&lt;timeout&gt;</b></dt>
  <dd class="It-tag">specify a timeout as a positive number to stop the download
      if it is taking longer than &lt;timeout&gt; seconds.</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--rlimit-as</b><i>=NUM</i></dt>
  <dd class="It-tag">Specify the maximum size of the process's virtual memory
      (address space), in bytes. If nothing is specified, no limits are imposed.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--rlimit-cpu</b><i>=NUM</i></dt>
  <dd class="It-tag">Specify the CPU time limit, in seconds. If nothing is
      specified, no limits are imposed.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--rlimit-nproc</b><i>=NUM</i></dt>
  <dd class="It-tag">Specify the maximum number of processes that can be
      created. If nothing is specified, no limits are imposed.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--rlimit-stack</b><i>=NUM</i></dt>
  <dd class="It-tag">Specify the maximum size of the process stack, in bytes. If
      nothing is specified, no limits are imposed.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--rlimit-fsize</b><i>=NUM</i></dt>
  <dd class="It-tag">Specify the maximum size of files that the process may
      create, in bytes. If nothing is specified, no limits are imposed.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sysroot</b><i>=DIR</i></dt>
  <dd class="It-tag">Specify sysroot directory where target files (executables,
      libraries, etc.) are located. With <i>-r RELEASE</i>, the sysroot will be
      searched for the appropriate kernel build directory. With <i>-r /DIR</i>,
      however, the sysroot will not be used to find the kernel build.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sysenv</b><i>=VAR=VALUE</i></dt>
  <dd class="It-tag">Provide an alternate value for an environment variable
      where the value on a remote system differs. Path variables (e.g. PATH,
      LD_LIBRARY_PATH) are assumed to be relative to the directory provided by
      <i>--sysroot</i>, if provided.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--suppress-time-limits</b></dt>
  <dd class="It-tag">Disable -DSTP_OVERLOAD related options as well as
      -DMAXACTION and -DMAXTRYLOCK. This option requires guru mode.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--runtime</b><i>=MODE</i></dt>
  <dd class="It-tag">Set the pass-5 runtime mode. Valid options are
      <i>kernel</i> (default) and <i>dyninst</i>. See
      <b>ALTERNATE&#x00A0;RUNTIMES</b> below for more information.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--dyninst</b></dt>
  <dd class="It-tag">Shorthand for <i>--runtime=dyninst</i>.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--save-uprobes</b></dt>
  <dd class="It-tag">On machines that require SystemTap to build its own uprobes
      module (kernels prior to version 3.5), this option instructs SystemTap to
      also save a copy of the module in the current directory (creating a new
      &quot;uprobes&quot; directory first).
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--target-namespaces</b><i>=PID</i></dt>
  <dd class="It-tag">Allow for a set of target namespaces to be set based on the
      namespaces the given PID is in. This is for namespace-aware tapset
      functions. If the target namespaces was not set, the target defaults to
      the stap process' namespaces.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--monitor</b><i>=INTERVAL</i></dt>
  <dd class="It-tag">Enables an interface to display status information about
      the module(uptime, module name, invoker uid, memory sizes, global
      variables, list of probes with their statistics). An optional argument
      INTERVAL can be supplied to set the refresh rate in seconds of the status
      window. The module can also be controlled by a list of commands using the
      following keys:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>c</b></dt>
  <dd class="It-tag">Resets all global variables to their initial values or
      zeroes them if they did not have an initial value.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>s</b></dt>
  <dd class="It-tag">Rotates the attribute used to sort the list of probes.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>t</b></dt>
  <dd class="It-tag">Brings up a prompt to allow toggling(on/off) of probes by
      index. Probe points are still affected by their conditions.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>r</b></dt>
  <dd class="It-tag">Resumes the script by toggling on all probes.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>p</b></dt>
  <dd class="It-tag">Pauses the script by toggling off all probes.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>x</b></dt>
  <dd class="It-tag">Hides/shows the status window. This allows for more output
      to be seen.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>navigation-keys</b></dt>
  <dd class="It-tag">The j/k/ArrowDown/ArrowUp keys can be used to scroll
      through the probe list and the d,D/u,U/PageDown,End/PageUp,Home keys can
      be used to scroll through the module output.</dd>
</dl>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="ARGUMENTS"><a class="selflink" href="#ARGUMENTS">ARGUMENTS</a></h1>
Any additional arguments on the command line are passed to the script parser for
  substitution. See below.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="SCRIPT_LANGUAGE"><a class="selflink" href="#SCRIPT_LANGUAGE">SCRIPT
  LANGUAGE</a></h1>
The systemtap script language resembles <i>awk</i> and <i>C</i>. There are two
  main outermost constructs: probes and functions. Within these, statements and
  expressions use C-like operator syntax and precedence.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="GENERAL_SYNTAX"><a class="selflink" href="#GENERAL_SYNTAX">GENERAL
  SYNTAX</a></h2>
Whitespace is ignored. Three forms of comments are supported:
<div style="margin-left: 5.00ex;">
<div>&#x00A0;</div>
<b>#</b> ... shell style, to the end of line, except for $# and @#
<div>&#x00A0;</div>
<b>//</b> ... C++ style, to the end of line
<div>&#x00A0;</div>
<b>/*</b> ... C style ... <b>*/</b></div>
Literals are either strings enclosed in double-quotes (passing through the usual
  C escape codes with backslashes, and with adjacent string literals glued
  together, also as in C), or integers (in decimal, hexadecimal, or octal, using
  the same notation as in C). All strings are limited in length to some
  reasonable value (a few hundred bytes). Integers are 64-bit signed quantities,
  although the parser also accepts (and wraps around) values above positive
  2**63.
<div class="Pp"></div>
In addition, script arguments given at the end of the command line may be
  inserted. Use <b>$1 ... $&lt;NN&gt;</b> for insertion unquoted, <b>@1 ...
  @&lt;NN&gt;</b> for insertion as a string literal. The number of arguments may
  be accessed through <b>$#</b> (as an unquoted number) or through <b>@#</b> (as
  a quoted number). These may be used at any place a token may begin, including
  within the preprocessing stage. Reference to an argument number beyond what
  was actually given is an error.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="PREPROCESSING"><a class="selflink" href="#PREPROCESSING">PREPROCESSING</a></h2>
A simple conditional preprocessing stage is run as a part of parsing. The
  general form is similar to the cond<b> ? </b>exp1<b> : </b>exp2 ternary
  operator:
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
<b>%(</b> CONDITION <b>%?</b> TRUE-TOKENS <b>%)</b>
<b>%(</b> CONDITION <b>%?</b> TRUE-TOKENS <b>%:</b> FALSE-TOKENS <b>%)</b>
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The CONDITION is either an expression whose format is determined by its first
  keyword, or a string literals comparison or a numeric literals comparison. It
  can be also composed of many alternatives and conjunctions of CONDITIONs
  (meant as in previous sentence) using || and &amp;&amp; respectively. However,
  parentheses are not supported yet, so remembering that conjunction takes
  precedence over alternative is important.
<div class="Pp"></div>
If the first part is the identifier <b>kernel_vr</b> or <b>kernel_v</b> to refer
  to the kernel version number, with (&quot;2.6.13-1.322FC3smp&quot;) or without
  (&quot;2.6.13&quot;) the release code suffix, then the second part is one of
  the six standard numeric comparison operators <b>&lt;</b>, <b>&lt;=</b>,
  <b>==</b>, <b>!=</b>, <b>&gt;</b>, and <b>&gt;=</b>, and the third part is a
  string literal that contains an RPM-style version-release value. The condition
  is deemed satisfied if the version of the target kernel (as optionally
  overridden by the <b>-r</b> option) compares to the given version string. The
  comparison is performed by the glibc function <b>strverscmp</b>. As a special
  case, if the operator is for simple equality (<b>==</b>), or inequality
  (<b>!=</b>), and the third part contains any wildcard characters (<b>*</b> or
  <b>?</b> or <b>[</b>), then the expression is treated as a wildcard (mis)match
  as evaluated by <b>fnmatch</b>.
<div class="Pp"></div>
If, on the other hand, the first part is the identifier <b>arch</b> to refer to
  the processor architecture (as named by the kernel build system ARCH/SUBARCH),
  then the second part is one of the two string comparison operators <b>==</b>
  or <b>!=</b>, and the third part is a string literal for matching it. This
  comparison is a wildcard (mis)match.
<div class="Pp"></div>
Similarly, if the first part is an identifier like <b>CONFIG_something</b> to
  refer to a kernel configuration option, then the second part is <b>==</b> or
  <b>!=</b>, and the third part is a string literal for matching the value
  (commonly &quot;y&quot; or &quot;m&quot;). Nonexistent or unset kernel
  configuration options are represented by the empty string. This comparison is
  also a wildcard (mis)match.
<div class="Pp"></div>
If the first part is the identifier <b>systemtap_v</b>, the test refers to the
  systemtap compatibility version, which may be overridden for old scripts with
  the <b>--compatible</b> flag. The comparison operator is as is for
  <b>kernel_v</b> and the right operand is a version string. See also the
  DEPRECATION section below.
<div class="Pp"></div>
If the first part is the identifier <b>systemtap_privilege</b>, the test refers
  to the privilege level that the systemtap script is compiled with. Here the
  second part is <b>==</b> or <b>!=</b>, and the third part is a string literal,
  either &quot;stapusr&quot; or &quot;stapsys&quot; or &quot;stapdev&quot;.
<div class="Pp"></div>
If the first part is the identifier <b>guru_mode</b>, the test refers to if the
  systemtap script is compiled with guru_mode. Here the second part is <b>==</b>
  or <b>!=</b>, and the third part is a number, either 1 or 0.
<div class="Pp"></div>
If the first part is the identifier <b>runtime</b>, the test refers to the
  systemtap runtime mode. See <b>ALTERNATE&#x00A0;RUNTIMES</b> below for more
  information on runtimes. The second part is one of the two string comparison
  operators <b>==</b> or <b>!=</b>, and the third part is a string literal for
  matching it. This comparison is a wildcard (mis)match.
<div class="Pp"></div>
Otherwise, the CONDITION is expected to be a comparison between two string
  literals or two numeric literals. In this case, the arguments are the only
  variables usable.
<div class="Pp"></div>
The TRUE-TOKENS and FALSE-TOKENS are zero or more general parser tokens
  (possibly including nested preprocessor conditionals), and are passed into the
  input stream if the condition is true or false. For example, the following
  code induces a parse error unless the target kernel version is newer than
  2.6.5:
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
%( kernel_v &lt;= &quot;2.6.5&quot; %? **ERROR** %) # invalid token sequence
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The following code might adapt to hypothetical kernel version drift:
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
probe kernel.function (
  %( kernel_v &lt;= &quot;2.6.12&quot; %? &quot;__mm_do_fault&quot; %:
     %( kernel_vr == &quot;2.6.13*smp&quot; %? &quot;do_page_fault&quot; %:
        UNSUPPORTED %) %)
) { /* ... */ }
<div class="Pp"></div>
%( arch == &quot;ia64&quot; %?
   probe syscall.vliw = kernel.function(&quot;vliw_widget&quot;) {}
%)
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="PREPROCESSOR_MACROS"><a class="selflink" href="#PREPROCESSOR_MACROS">PREPROCESSOR
  MACROS</a></h2>
The preprocessor also supports a simple macro facility, run as a separate pass
  before conditional preprocessing.
<div class="Pp"></div>
Macros are defined using the following construct:
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
@define NAME %( BODY %)
@define NAME(PARAM_1, PARAM_2, ...) %( BODY %)
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Macros, and parameters inside a macro body, are both invoked by prefixing the
  macro name with an @ symbol:
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
@define foo %( x %)
@define add(a,b) %( ((@a)+(@b)) %)
<div class="Pp"></div>
   @foo = @add(2,2)
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
Macro expansion is currently performed in a separate pass before conditional
  compilation. Therefore, both TRUE- and FALSE-tokens in conditional expressions
  will be macroexpanded regardless of how the condition is evaluated. This can
  sometimes lead to errors:
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
// The following results in a conflict:
%( CONFIG_UTRACE == &quot;y&quot; %?
    @define foo %( process.syscall %)
%:
    @define foo %( **ERROR** %)
%)
<div class="Pp"></div>
// The following works properly as expected:
@define foo %(
  %( CONFIG_UTRACE == &quot;y&quot; %? process.syscall %: **ERROR** %)
%)
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The first example is incorrect because both @defines are evaluated in a pass
  prior to the conditional being evaluated.
<div style="height: 1.00em;">&#x00A0;</div>
Normally, a macro definition is local to the file it occurs in. Thus, defining a
  macro in a tapset does not make it available to the user of the tapset.
  Publically available library macros can be defined by including .stpm files on
  the tapset search path. These files may only contain @define constructs, which
  become visible across all tapsets and user scripts. Optionally, within the
  .stpm files, a public macro definition can be surrounded by a preprocessor
  conditional as described above.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="VARIABLES"><a class="selflink" href="#VARIABLES">VARIABLES</a></h2>
Identifiers for variables and functions are an alphanumeric sequence, and may
  include <b>_</b> and <b>$</b> characters. They may not start with a plain
  digit, as in C. Each variable is by default local to the probe or function
  statement block within which it is mentioned, and therefore its scope and
  lifetime is limited to a particular probe or function invocation.
<div class="Pp"></div>
Scalar variables are implicitly typed as either string or integer. Associative
  arrays also have a string or integer value, and a tuple of strings and/or
  integers serving as a key. Here are a few basic expressions.
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
var1 = 5
var2 = &quot;bar&quot;
array1 [pid()] = &quot;name&quot;     # single numeric key
array2 [&quot;foo&quot;,4,i++] += 5   # vector of string/num/num keys
if ([&quot;hello&quot;,5,4] in array2) println (&quot;yes&quot;)  # membership test
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
The translator performs <i>type inference</i> on all identifiers, including
  array indexes and function parameters. Inconsistent type-related use of
  identifiers signals an error.
<div class="Pp"></div>
Variables may be declared global, so that they are shared amongst all probes and
  functions and live as long as the entire systemtap session. There is one
  namespace for all global variables, regardless of which script file they are
  found within. Concurrent access to global variables is automatically protected
  with locks, see the <b>SAFETY AND SECURITY</b> section for more details. A
  global declaration may be written at the outermost level anywhere, not within
  a block of code. Global variables which are written but never read will be
  displayed automatically at session shutdown. The translator will infer for
  each its value type, and if it is used as an array, its key types. Optionally,
  scalar globals may be initialized with a string or number literal. The
  following declaration marks variables as global.
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
<b>global</b> var1<b>,</b> var2<b>,</b> var3=4
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
Global variables can also be set as module options. One can do this by either
  using the -G option, or the module must first be compiled using stap -p4.
  Global variables can then be set on the command line when calling staprun on
  the module generated by stap -p4. See <i>staprun</i>(8) for more information.
<div class="Pp"></div>
The scope of a global variable may be limited to a tapset or user script file
  using private keyword. The global keyword is optional when defining a private
  global variable. Following declaration marks var1 and var2 private globals.
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
<b>private</b> global<b> var1=2</b>
<b>private</b> var2
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
Arrays are limited in size by the MAXMAPENTRIES variable -- see the <b>SAFETY
  AND SECURITY</b> section for details. Optionally, global arrays may be
  declared with a maximum size in brackets, overriding MAXMAPENTRIES for that
  array only. Note that this doesn't indicate the type of keys for the array,
  just the size.
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
<b>global</b> tiny_array[10]<b>,</b> normal_array<b>,</b> big_array[50000]
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
Arrays may be configured for wrapping using the '%' suffix. This causes older
  elements to be overwritten if more elements are inserted than the array can
  hold. This works for both associative and statistics typed arrays.
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
<b>global</b> wrapped_array1%[10]<b>,</b> wrapped_array2%
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
Many types of probe points provide context variables, which are run-time values,
  safely extracted from the kernel or userspace program being probed. These are
  prefixed with the <b>$</b> character. The CONTEXT VARIABLES section in
  <i>stapprobes</i>(3stap) lists what is available for each type of probe point.
  These context variables become normal string or numeric scalars once they are
  stored in normal script variables. See the TYPECASTING section below on how to
  to turn them back into typed pointers for further processing as context
  variables.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="STATEMENTS"><a class="selflink" href="#STATEMENTS">STATEMENTS</a></h2>
Statements enable procedural control flow. They may occur within functions and
  probe handlers. The total number of statements executed in response to any
  single probe event is limited to some number defined by the MAXACTION macro in
  the translated C code, and is in the neighbourhood of 1000.
<dl class="Bl-tag">
  <dt class="It-tag">EXP</dt>
  <dd class="It-tag">Execute the string- or integer-valued expression and throw
      away the value.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>{</b> STMT1 STMT2 ... <b>}</b></dt>
  <dd class="It-tag">Execute each statement in sequence in this block. Note that
      separators or terminators are generally not necessary between
    statements.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>;</b></dt>
  <dd class="It-tag">Null statement, do nothing. It is useful as an optional
      separator between statements to improve syntax-error detection and to
      handle certain grammar ambiguities.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>if</b> (EXP) STMT1 [ <b>else</b> STMT2 ]</dt>
  <dd class="It-tag">Compare integer-valued EXP to zero. Execute the first
      (non-zero) or second STMT (zero).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>while</b> (EXP) STMT</dt>
  <dd class="It-tag">While integer-valued EXP evaluates to non-zero, execute
      STMT.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>for</b> (EXP1; EXP2; EXP3) STMT</dt>
  <dd class="It-tag">Execute EXP1 as initialization. While EXP2 is non-zero,
      execute STMT, then the iteration expression EXP3.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>foreach</b> (VAR <b>in</b> ARRAY [ <b>limit</b> EXP ])
    STMT</dt>
  <dd class="It-tag">Loop over each element of the named global array, assigning
      current key to VAR. The array may not be modified within the statement. By
      adding a single <b>+</b> or <b>-</b> operator after the VAR or the ARRAY
      identifier, the iteration will proceed in a sorted order, by ascending or
      descending index or value. If the array contains statistics aggregates,
      adding the desired <b>@operator</b> between the ARRAY identifier and the
      <b>+</b> or <b>-</b> will specify the sorting aggregate function. See the
      STATISTICS section below for the ones available. Default is <b>@count</b>.
      Using the optional <b>limit</b> keyword limits the number of loop
      iterations to EXP times. EXP is evaluated once at the beginning of the
      loop.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>foreach</b> ([VAR1, VAR2, ...] <b>in</b> ARRAY [
    <b>limit</b> EXP ]) STMT</dt>
  <dd class="It-tag">Same as above, used when the array is indexed with a tuple
      of keys. A sorting suffix may be used on at most one VAR or ARRAY
      identifier.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>foreach</b> ([VAR1, VAR2, ...] <b>in</b> ARRAY [INDEX1,
    INDEX2, ...] [ <b>limit</b> EXP ]) STMT</dt>
  <dd class="It-tag">Same as above, where iterations are limited to elements in
      the array where the keys match the index values specified. The symbol *
      can be used to specify an index and will be treated as a wildcard.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>foreach</b> (VAR0 = VAR <b>in</b> ARRAY [ <b>limit</b>
    EXP ]) STMT</dt>
  <dd class="It-tag">This variant of foreach saves current value into VAR0 on
      each iteration, so it is the same as ARRAY[VAR]. This also works with a
      tuple of keys. Sorting suffixes on VAR0 have the same effect as on
    ARRAY.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>foreach</b> (VAR0 = VAR <b>in</b> ARRAY [INDEX1, INDEX2,
    ...] [ <b>limit</b> EXP ]) STMT</dt>
  <dd class="It-tag">Same as above, where iterations are limited to elements in
      the array where the keys match the index values specified. The symbol *
      can be used to specify an index and will be treated as a wildcard.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>break</b>, <b>continue</b></dt>
  <dd class="It-tag">Exit or iterate the innermost nesting loop (<b>while</b> or
      <b>for</b> or <b>foreach</b>) statement.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>return</b> EXP</dt>
  <dd class="It-tag">Return EXP value from enclosing function. If the function's
      value is not taken anywhere, then a return statement is not needed, and
      the function will have a special &quot;unknown&quot; type with no return
      value.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>next</b></dt>
  <dd class="It-tag">Return now from enclosing probe handler. This is especially
      useful in probe aliases that apply event filtering predicates. When used
      in functions, the execution will be immediately transferred to the next
      overloaded function.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>try</b> { STMT1 } <b>catch</b> { STMT2 }</dt>
  <dd class="It-tag">Run the statements in the first block. Upon any run-time
      errors, abort STMT1 and start executing STMT2. Any errors in STMT2 will
      propagate to outer try/catch blocks, if any.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>try</b> { STMT1 } <b>catch</b>(VAR) { STMT2 }</dt>
  <dd class="It-tag">Same as above, plus assign the error message to the string
      scalar variable VAR.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>delete</b> ARRAY[INDEX1, INDEX2, ...]</dt>
  <dd class="It-tag">Remove from ARRAY the element specified by the index tuple.
      If the index tuple contains a * in place of an index, the * is treated as
      a wildcard and all elements with keys that match the index tuple will be
      removed from ARRAY. The value will no longer be available, and subsequent
      iterations will not report the element. It is not an error to delete an
      element that does not exist.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>delete</b> ARRAY</dt>
  <dd class="It-tag">Remove all elements from ARRAY.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>delete</b> SCALAR</dt>
  <dd class="It-tag">Removes the value of SCALAR. Integers and strings are
      cleared to 0 and &quot;&quot; respectively, while statistics are reset to
      the initial empty state.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="EXPRESSIONS"><a class="selflink" href="#EXPRESSIONS">EXPRESSIONS</a></h2>
Systemtap supports a number of operators that have the same general syntax,
  semantics, and precedence as in C and awk. Arithmetic is performed as per
  typical C rules for signed integers. Division by zero or overflow is detected
  and results in an error.
<dl class="Bl-tag">
  <dt class="It-tag">binary numeric operators</dt>
  <dd class="It-tag"><b>* / % + - &gt;&gt; &lt;&lt; &amp; ^ | &amp;&amp;
    ||</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">binary string operators</dt>
  <dd class="It-tag"><b>.</b> (string concatenation)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">numeric assignment operators</dt>
  <dd class="It-tag"><b>= *= /= %= += -= &gt;&gt;= &lt;&lt;= &amp;= ^=
    |=</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">string assignment operators</dt>
  <dd class="It-tag"><b>= .=</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">unary numeric operators</dt>
  <dd class="It-tag"><b>+ - ! ~ ++ --</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">binary numeric, string comparison or regex matching
    operators</dt>
  <dd class="It-tag"><b>&lt; &gt; &lt;= &gt;= == != =~ !~</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">ternary operator</dt>
  <dd class="It-tag">cond<b> ? </b>exp1<b> : </b>exp2</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">grouping operator</dt>
  <dd class="It-tag"><b>(</b> exp <b>)</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">function call</dt>
  <dd class="It-tag">fn <b>(</b>[ arg1, arg2, ... ]<b>)</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">array membership check</dt>
  <dd class="It-tag">exp<b> in </b>array
    <div>&#x00A0;</div>
    <b>[</b>exp1<b>, </b>exp2<b>, </b>...<b>] in </b>array
    <div>&#x00A0;</div>
    <b>[</b>*<b>, </b>*<b>, ... </b>]<b>in</b> array
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="REGULAR_EXPRESSION_MATCHING"><a class="selflink" href="#REGULAR_EXPRESSION_MATCHING">REGULAR
  EXPRESSION MATCHING</a></h2>
The scripting language supports regular expression matching. The basic syntax is
  as follows:
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
<b>exp</b> =~ <b>regex</b>
<b>exp</b> !~ <b>regex</b>
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
(The first operand must be an expression evaluating to a string; the second
  operand must be a string literal containing a syntactically valid regular
  expression.)
<div class="Pp"></div>
The regular expression syntax supports most of the features of POSIX Extended
  Regular Expressions, except for subexpression reuse (&quot;\1&quot;)
  functionality. The ability to capture and extract the contents of the matched
  string and subexpressions has not yet been implemented.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="PROBES"><a class="selflink" href="#PROBES">PROBES</a></h2>
The main construct in the scripting language identifies probes. Probes associate
  abstract events with a statement block (&quot;probe handler&quot;) that is to
  be executed when any of those events occur. The general syntax is as follows:
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
<b>probe</b> PROBEPOINT [<b>,</b> PROBEPOINT] <b>{</b> [STMT ...] <b>}</b>
<b>probe</b> PROBEPOINT [<b>,</b> PROBEPOINT] <b>if (</b>CONDITION<b>) { </b>[STMT ...]<b> }</b>
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
Events are specified in a special syntax called &quot;probe points&quot;. There
  are several varieties of probe points defined by the translator, and tapset
  scripts may define further ones using aliases. Probe points may be wildcarded,
  grouped, or listed in preference sequences, or declared optional. More details
  on probe point syntax and semantics are listed on the <i>stapprobes</i>(3stap)
  manual page.
<div class="Pp"></div>
The probe handler is interpreted relative to the context of each event. For
  events associated with kernel code, this context may include <i>variables</i>
  defined in the <i>source code</i> at that spot. These &quot;context
  variables&quot; are presented to the script as variables whose names are
  prefixed with &quot;$&quot;. They may be accessed only if the kernel's
  compiler preserved them despite optimization. This is the same constraint that
  a debugger user faces when working with optimized code. In addition, the
  objects must exist in paged-in memory at the moment of the systemtap probe
  handler's execution, because systemtap must not cause (suppresses) any
  additional paging. Some probe types have very little context. See the
  <i>stapprobes</i>(3stap) man pages to see the kinds of context variables
  available at each kind of probe point.
<div class="Pp"></div>
Probes may be decorated with an <i>arming condition</i>, consisting of a simple
  boolean expression on read-only global script variables. While disarmed
  (inactive, condition evaluates to false), some probe types reduce or eliminate
  their run-time overheads. When an arming condition evaluates to true, probes
  will be <i>soon</i> re-armed, and their probe handlers will start getting
  called as the events fire. (Some events may be lost during the arming
  interval. If this is unacceptable, do not use arming conditions for those
  probes.) Example of the syntax:
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
probe timer.us(TIMER) if (enabled) {
}
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
New probe points may be defined using &quot;aliases&quot;. Probe point aliases
  look similar to probe definitions, but instead of activating a probe at the
  given point, it just defines a new probe point name as an alias to an existing
  one. There are two types of alias, i.e. the prologue style and the epilogue
  style which are identified by &quot;=&quot; and &quot;+=&quot; respectively.
<div class="Pp"></div>
For prologue style alias, the statement block that follows an alias definition
  is implicitly added as a prologue to any probe that refers to the alias. While
  for the epilogue style alias, the statement block that follows an alias
  definition is implicitly added as an epilogue to any probe that refers to the
  alias. For example:
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
probe syscall.read = kernel.function(&quot;sys_read&quot;) {
  fildes = $fd
  if (execname() == &quot;init&quot;) next  # skip rest of probe
}
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
defines a new probe point <i>syscall.read</i>, which expands to
  <i>kernel.function(&quot;sys_read&quot;)</i>, with the given statement as a
  prologue, which is useful to predefine some variables for the alias user
  and/or to skip probe processing entirely based on some conditions. And
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
probe syscall.read += kernel.function(&quot;sys_read&quot;) {
  if (tracethis) println ($fd)
}
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
defines a new probe point with the given statement as an epilogue, which is
  useful to take actions based upon variables set or left over by the the alias
  user. Please note that in each case, the statements in the alias handler block
  are treated ordinarily, so that variables assigned there constitute mere
  initialization, not a macro substitution.
<div style="height: 1.00em;">&#x00A0;</div>
An alias is used just like a built-in probe type.
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
probe syscall.read {
  printf(&quot;reading fd=%d\n&quot;, fildes)
  if (fildes &gt; 10) tracethis = 1
}
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="FUNCTIONS"><a class="selflink" href="#FUNCTIONS">FUNCTIONS</a></h2>
Systemtap scripts may define subroutines to factor out common work. Functions
  take any number of scalar (integer or string) arguments, and must return a
  single scalar (integer or string). An example function declaration looks like
  this:
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
function thisfn (arg1, arg2) {
   return arg1 + arg2
}
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Note the general absence of type declarations, which are instead inferred by the
  translator. However, if desired, a function definition may include explicit
  type declarations for its return value and/or its arguments. This is
  especially helpful for embedded-C functions. In the following example, the
  type inference engine need only infer type type of arg2 (a string).
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
function thatfn:string (arg1:long, arg2) {
   return sprint(arg1) . arg2
}
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Functions may call others or themselves recursively, up to a fixed nesting
  limit. This limit is defined by the MAXNESTING macro in the translated C code
  and is in the neighbourhood of 10.
<div style="height: 1.00em;">&#x00A0;</div>
Functions may be marked private using the private keyword to limit their scope
  to the tapset or user script file they are defined in. An example definition
  of a private function follows:
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
private function three:long () { return 3 }
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
Functions terminating without reaching an explicit return statement will return
  an implicit 0 or &quot;&quot;, determined by type inference.
<div style="height: 1.00em;">&#x00A0;</div>
Functions may be overloaded during both runtime and compile time.
<div style="height: 1.00em;">&#x00A0;</div>
Runtime overloading allows the executed function to be selected while the module
  is running based on runtime conditions and is achieved using the
  &quot;next&quot; statement in script functions and STAP_NEXT macro for
  embedded-C functions. For example,
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
function f() { if (condition) next; print(&quot;first function&quot;) }
function f() %{ STAP_NEXT; print(&quot;second function&quot;) %}
function f() { print(&quot;third function&quot;) }
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
During a functioncall f(), the execution will transfer to the third function if
  condition evaluates to true and print &quot;third function&quot;. Note that
  the second function is unconditionally nexted.
<div style="height: 1.00em;">&#x00A0;</div>
Parameter overloading allows the function to be executed to be selected at
  compile time based on the number of arguments provided to the functioncall.
  For example,
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
function g() { print(&quot;first function&quot;) }
function g(x) { print(&quot;second function&quot;) }
g() -&gt; &quot;first function&quot;
g(1) -&gt; &quot;second function&quot;
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
Note that runtime overloading does not occur in the above example, as exactly
  one function will be resolved for the functioncall. The use of a next
  statement inside a function while no more overloads remain will trigger a
  runtime exception Runtime overloading will only occur if the functions have
  the same arity, functions with the same name but different number of
  parameters are completely unrelated.
<div style="height: 1.00em;">&#x00A0;</div>
Execution order is determined by a priority value which may be specified. If no
  explicit priority is specified, user script functions are given a higher
  priority than library functions. User script functions and library functions
  are assigned a default priority value of 0 and 1 respectively. Functions with
  the same priority are executed in declaration order. For example,
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
function f():3 { if (condition) next; print(&quot;first function&quot;) }
function f():1 { if (condition) next; print(&quot;second function&quot;) }
function f():2 { print(&quot;third function&quot;) }
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
Since the second function has highest priority, it is executed first. The first
  function is never executed as there no &quot;next&quot; statements in the
  third function to transfer execution.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="PRINTING"><a class="selflink" href="#PRINTING">PRINTING</a></h2>
There are a set of function names that are specially treated by the translator.
  They format values for printing to the standard systemtap output stream in a
  more convenient way (note that data generated in the kernel module need to get
  transferred to user-space in order to get printed).
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 The <i>sprint*</i> variants return the formatted string instead of printing it.
<dl class="Bl-tag">
  <dt class="It-tag"><b>print</b>, <b>sprint</b></dt>
  <dd class="It-tag">Print one or more values of any type, concatenated directly
      together.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>println</b>, <b>sprintln</b></dt>
  <dd class="It-tag">Print values like <i>print</i> and <i>sprint</i>, but also
      append a newline.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>printd</b>, <b>sprintd</b></dt>
  <dd class="It-tag">Take a string delimiter and two or more values of any type,
      and print the values with the delimiter interposed. The delimiter must be
      a literal string constant.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>printdln</b>, <b>sprintdln</b></dt>
  <dd class="It-tag">Print values with a delimiter like <i>printd</i> and
      <i>sprintd</i>, but also append a newline.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>printf</b>, <b>sprintf</b></dt>
  <dd class="It-tag">Take a formatting string and a number of values of
      corresponding types, and print them all. The format must be a literal
      string constant.</dd>
</dl>
<div class="Pp"></div>
The <i>printf</i> formatting directives similar to those of C, except that they
  are fully type-checked by the translator:
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">%b</dt>
  <dd class="It-tag">Writes a binary blob of the value given, instead of ASCII
      text. The width specifier determines the number of bytes to write; valid
      specifiers are %b %1b %2b %4b %8b. Default (%b) is 8 bytes.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">%c</dt>
  <dd class="It-tag">Character.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">%d,%i</dt>
  <dd class="It-tag">Signed decimal.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">%m</dt>
  <dd class="It-tag">Safely reads kernel memory at the given address, outputs
      its content. The optional precision specifier (not field width) determines
      the number of bytes to read - default is 1 byte. %10.4m prints 4 bytes of
      the memory in a 10-character-wide field.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">%M</dt>
  <dd class="It-tag">Same as %m, but outputs in hexadecimal. The minimal size of
      output is double the optional precision specifier - default is 1 byte (2
      hex chars). %10.4M prints 4 bytes of the memory as 8 hexadecimal
      characters in a 10-character-wide field. %.*M hex-dumps a given number of
      bytes from a given buffer.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">%o</dt>
  <dd class="It-tag">Unsigned octal.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">%p</dt>
  <dd class="It-tag">Unsigned pointer address.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">%s</dt>
  <dd class="It-tag">String.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">%u</dt>
  <dd class="It-tag">Unsigned decimal.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">%x</dt>
  <dd class="It-tag">Unsigned hex value, in all lower-case.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">%X</dt>
  <dd class="It-tag">Unsigned hex value, in all upper-case.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">%%</dt>
  <dd class="It-tag">Writes a %.</dd>
</dl>
</div>
<div class="Pp"></div>
The <i>#</i> flag selects the alternate forms. For octal, this prefixes a 0. For
  hex, this prefixes 0x or 0X, depending on case. For characters, this escapes
  non-printing values with either C-like escapes or raw octal.
<div class="Pp"></div>
Examples:
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
a = &quot;alice&quot;, b = &quot;bob&quot;, p = 0x1234abcd, i = 123, j = -1, id[a] = 1234, id[b] = 4567
print(&quot;hello&quot;)
	Prints: hello
println(b)
	Prints: bob\n
println(a . &quot; is &quot; . sprint(16))
	Prints: alice is 16
foreach (name in id)  printdln(&quot;|&quot;, strlen(name), name, id[name])
	Prints: 5|alice|1234\n3|bob|4567
printf(&quot;%c is %s; %x or %X or %p; %d or %u\n&quot;,97,a,p,p,p,j,j)
	Prints: a is alice; 1234abcd or 1234ABCD or 0x1234abcd; -1 or 18446744073709551615\n
printf(&quot;2 bytes of kernel buffer at address %p: %2m&quot;, p, p)
	Prints: 2 byte of kernel buffer at address 0x1234abcd: &lt;binary data&gt;
printf(&quot;%4b&quot;, p)
	Prints (these values as binary data): 0x1234abcd
printf(&quot;%#o %#x %#X\n&quot;, 1, 2, 3)
	Prints: 01 0x2 0X3
printf(&quot;%#c %#c %#c\n&quot;, 0, 9, 42)
	Prints: \000 \t *
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="STATISTICS"><a class="selflink" href="#STATISTICS">STATISTICS</a></h2>
It is often desirable to collect statistics in a way that avoids the penalties
  of repeatedly exclusive locking the global variables those numbers are being
  put into. Systemtap provides a solution using a special operator to accumulate
  values, and several pseudo-functions to extract the statistical aggregates.
<div class="Pp"></div>
The aggregation operator is <i>&lt;&lt;&lt;</i>, and resembles an assignment, or
  a C++ output-streaming operation. The left operand specifies a scalar or
  array-index lvalue, which must be declared global. The right operand is a
  numeric expression. The meaning is intuitive: add the given number to the pile
  of numbers to compute statistics of. (The specific list of statistics to
  gather is given separately, by the extraction functions.)
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
foo &lt;&lt;&lt; 1
stats[pid()] &lt;&lt;&lt; memsize
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
The extraction functions are also special. For each appearance of a distinct
  extraction function operating on a given identifier, the translator arranges
  to compute a set of statistics that satisfy it. The statistics system is
  thereby &quot;on-demand&quot;. Each execution of an extraction function causes
  the aggregation to be computed for that moment across all processors.
<div class="Pp"></div>
Here is the set of extractor functions. The first argument of each is the same
  style of lvalue used on the left hand side of the accumulate operation. The
  <i>@count(v)</i>, <i>@sum(v)</i>, <i>@min(v)</i>, <i>@max(v)</i>,
  <i>@avg(v)</i> extractor functions compute the
  number/total/minimum/maximum/average of all accumulated values. The resulting
  values are all simple integers. Arrays containing aggregates may be sorted and
  iterated. See the <b>foreach</b> construct above.
<div class="Pp"></div>
Histograms are also available, but are more complicated because they have a
  vector rather than scalar value. <i>@hist_linear(v,start,stop,interval)</i>
  represents a linear histogram from &quot;start&quot; to &quot;stop&quot; by
  increments of &quot;interval&quot;. The interval must be positive. Similarly,
  <i>@hist_log(v)</i> represents a base-2 logarithmic histogram. Printing a
  histogram with the <i>print</i> family of functions renders a histogram object
  as a tabular &quot;ASCII art&quot; bar chart.
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
probe timer.profile {
  x[1] &lt;&lt;&lt; pid()
  x[2] &lt;&lt;&lt; uid()
  y &lt;&lt;&lt; tid()
}
global x // an array containing aggregates
global y // a scalar
probe end {
  foreach ([i] in x @count+) {
     printf (&quot;x[%d]: avg %d = sum %d / count %d\n&quot;,
             i, @avg(x[i]), @sum(x[i]), @count(x[i]))
     println (@hist_log(x[i]))
  }
  println (&quot;y:&quot;)        
  println (@hist_log(y))  
}
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="TYPECASTING"><a class="selflink" href="#TYPECASTING">TYPECASTING</a></h2>
Once a pointer (see the CONTEXT VARIABLES section of <i>stapprobes</i>(3stap))
  has been saved into a script integer variable, the translator loses the type
  information necessary to access members from that pointer. Using the
  <i>@cast()</i> operator tells the translator how to interpret the number as a
  typed pointer.
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
@cast(p, &quot;type_name&quot;[, &quot;module&quot;])-&gt;member
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
This will interpret <i>p</i> as a pointer to a struct/union named
  <i>type_name</i> and dereference the <i>member</i> value. Further
  <i>-&gt;subfield</i> expressions may be appended to dereference more levels.
  NOTE: the same dereferencing operator <i>-&gt;</i> is used to refer to both
  direct containment or pointer indirection. Systemtap automatically determines
  which. The optional <i>module</i> tells the translator where to look for
  information about that type. Multiple modules may be specified as a list with
  <i>:</i> separators. If the module is not specified, it will default either to
  the probe module for dwarf probes, or to &quot;kernel&quot; for functions and
  all other probes types.
<div class="Pp"></div>
The translator can create its own module with type information from a header
  surrounded by angle brackets, in case normal debuginfo is not available. For
  kernel headers, prefix it with &quot;kernel&quot; to use the appropriate build
  system. All other headers are built with default GCC parameters into a user
  module. Multiple headers may be specified in sequence to resolve a
  codependency.
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
@cast(tv, &quot;timeval&quot;, &quot;&lt;sys/time.h&gt;&quot;)-&gt;tv_sec
@cast(task, &quot;task_struct&quot;, &quot;kernel&lt;linux/sched.h&gt;&quot;)-&gt;tgid
@cast(task, &quot;task_struct&quot;,
      &quot;kernel&lt;linux/sched.h&gt;&lt;linux/fs_struct.h&gt;&quot;)-&gt;fs-&gt;umask
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Values acquired by <b>@cast</b> may be pretty-printed by the <b>$</b> and
  <b>$$</b> suffix operators, the same way as described in the CONTEXT VARIABLES
  section of the <i>stapprobes</i>(3stap) manual page.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
When in guru mode, the translator will also allow scripts to assign new values
  to members of typecasted pointers.
<div class="Pp"></div>
Typecasting is also useful in the case of <i>void*</i> members whose type may be
  determinable at runtime.
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
probe foo {
  if ($var-&gt;type == 1) {
    value = @cast($var-&gt;data, &quot;type1&quot;)-&gt;bar
  } else {
    value = @cast($var-&gt;data, &quot;type2&quot;)-&gt;baz
  }
  print(value)
}
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="EMBEDDED_C"><a class="selflink" href="#EMBEDDED_C">EMBEDDED
  C</a></h2>
When in guru mode, the translator accepts embedded C code in the top level of
  the script. Such code is enclosed between <i>%{</i> and <i>%}</i> markers, and
  is transcribed verbatim, without analysis, in some sequence, into the top
  level of the generated C code. At the outermost level, this may be useful to
  add <i>#include</i> instructions, and any auxiliary definitions for use by
  other embedded code.
<div class="Pp"></div>
Another place where embedded code is permitted is as a function body. In this
  case, the script language body is replaced entirely by a piece of C code
  enclosed again between <i>%{</i> and <i>%}</i> markers. This C code may do
  anything reasonable and safe. There are a number of undocumented but complex
  safety constraints on atomicity, concurrency, resource consumption, and run
  time limits, so this is an advanced technique.
<div class="Pp"></div>
The memory locations set aside for input and output values are made available to
  it using macros <i>STAP_ARG_*</i> and <i>STAP_RETVALUE</i>. Errors may be
  signalled with STAP_ERROR. Output may be written with STAP_PRINTF. The
  function may return early with STAP_RETURN. Here are some examples:
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
function integer_ops (val) %{
  STAP_PRINTF(&quot;%d\n&quot;, STAP_ARG_val);
  STAP_RETVALUE = STAP_ARG_val + 1;
  if (STAP_RETVALUE == 4)
      STAP_ERROR(&quot;wrong guess: %d&quot;, (int) STAP_RETVALUE);
  if (STAP_RETVALUE == 3)
      STAP_RETURN(0);
  STAP_RETVALUE ++;
%}
function string_ops (val) %{
  strlcpy (STAP_RETVALUE, STAP_ARG_val, MAXSTRINGLEN);
  strlcat (STAP_RETVALUE, &quot;one&quot;, MAXSTRINGLEN);
  if (strcmp (STAP_RETVALUE, &quot;three-two-one&quot;))
      STAP_RETURN(&quot;parameter should be three-two-&quot;);
%}
function no_ops () %{
    STAP_RETURN(); /* function inferred with no return value */
%}
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The function argument and return value types have to be inferred by the
  translator from the call sites in order for this to work. The user should
  examine C code generated for ordinary script-language functions in order to
  write compatible embedded-C ones.
<div class="Pp"></div>
The last place where embedded code is permitted is as an expression rvalue. In
  this case, the C code enclosed between <i>%{</i> and <i>%}</i> markers is
  interpreted as an ordinary expression value. It is assumed to be a normal
  64-bit signed number, unless the marker <i>/* string */</i> is included, in
  which case it's treated as a string.
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
function add_one (val) {
  return val + %{ 1 %}
}
function add_string_two (val) {
  return val . %{ /* string */ &quot;two&quot; %}
}
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
The embedded-C code may contain markers to assert optimization and safety
  properties.
<dl class="Bl-tag">
  <dt class="It-tag"><i>/* pure */</i></dt>
  <dd class="It-tag">means that the C code has no side effects and may be elided
      entirely if its value is not used by script code.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>/* stable */</i></dt>
  <dd class="It-tag">means that the C code always has the same value (in any
      given probe handler invocation), so repeated calls may be automatically
      replaced by memoized values. Such functions must take no parameters, and
      also be <i>pure</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>/* unprivileged */</i></dt>
  <dd class="It-tag">means that the C code is so safe that even unprivileged
      users are permitted to use it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>/* myproc-unprivileged */</i></dt>
  <dd class="It-tag">means that the C code is so safe that even unprivileged
      users are permitted to use it, provided that the target of the current
      probe is within the user's own process.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>/* guru */</i></dt>
  <dd class="It-tag">means that the C code is so unsafe that a systemtap user
      must specify <i>-g</i> (guru mode) to use this.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>/* unmangled */</i></dt>
  <dd class="It-tag">in an embedded-C function, means that the legacy (pre-1.8)
      argument access syntax should be made available inside the function.
      Hence, in addition to <i>STAP_ARG_foo</i> and <i>STAP_RETVALUE</i> one can
      use <i>THIS-&gt;foo</i> and <i>THIS-&gt;__retvalue</i> respectively inside
      the function. This is useful for quickly migrating code written for
      SystemTap version 1.7 and earlier.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>/* unmodified-fnargs */</i></dt>
  <dd class="It-tag">in an embedded-C function, means that the function
      arguments are not modified inside the function body.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>/* string */</i></dt>
  <dd class="It-tag">in embedded-C expressions only, means that the expression
      has <i>const char *</i> type and should be treated as a string value,
      instead of the default long numeric.</dd>
</dl>
<div class="Pp"></div>
Script level global variables may be accessed in embedded-C functions and
  blocks. To read or write the global variable <i>var</i> , the <i>/*
  pragma:read:var */</i> or <i>/* pragma:write:var */</i> marker must be first
  placed in the embedded-C function or block. This provides the macros
  <i>STAP_GLOBAL_GET_*</i> and <i>STAP_GLOBAL_SET_*</i> macros to allow reading
  and writing, respectively. For example:
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
global var
global var2[100]
function increment() %{
    /* pragma:read:var */ /* pragma:write:var */
    /* pragma:read:var2 */ /* pragma:write:var2 */
    STAP_GLOBAL_SET_var(STAP_GLOBAL_GET_var()+1); //var++
    STAP_GLOBAL_SET_var2(1, 1, STAP_GLOBAL_GET_var2(1, 1)+1); //var2[1,1]++
%}
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Variables may be read and set in both embedded-C functions and expressions.
  Strings returned from embedded-C code are decayed to pointers. Variables must
  also be assigned at script level to allow for type inference. Map assignment
  does not return the value written, so chaining does not work.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="BUILT-INS"><a class="selflink" href="#BUILT-INS">BUILT-INS</a></h2>
A set of builtin probe point aliases are provided by the scripts installed in
  the directory specified in the <i>stappaths</i>(7) manual page. The functions
  are described in the <i>stapprobes</i>(3stap) manual page.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="PROCESSING"><a class="selflink" href="#PROCESSING">PROCESSING</a></h1>
The translator begins pass 1 by parsing the given input script, and all scripts
  (files named <i>*.stp</i>) found in a tapset directory. The directories listed
  with <b>-I</b> are processed in sequence, each processed in &quot;guru
  mode&quot;. For each directory, a number of subdirectories are also searched.
  These subdirectories are derived from the selected kernel version (the
  <b>-R</b> option), in order to allow more kernel-version-specific scripts to
  override less specific ones. For example, for a kernel version
  <i>2.6.12-23.FC3</i> the following patterns would be searched, in sequence:
  <i>2.6.12-23.FC3/*.stp</i>, <i>2.6.12/*.stp</i>, <i>2.6/*.stp</i>, and finally
  <i>*.stp</i>. Stopping the translator after pass 1 causes it to print the
  parse trees.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
In pass 2, the translator analyzes the input script to resolve symbols and
  types. References to variables, functions, and probe aliases that are
  unresolved internally are satisfied by searching through the parsed tapset
  script files. If any tapset script file is selected because it defines an
  unresolved symbol, then the entirety of that file is added to the translator's
  resolution queue. This process iterates until all symbols are resolved and a
  subset of tapset script files is selected.
<div class="Pp"></div>
Next, all probe point descriptions are validated against the wide variety
  supported by the translator. Probe points that refer to code locations
  (&quot;synchronous probe points&quot;) require the appropriate kernel
  debugging information to be installed. In the associated probe handlers,
  target-side variables (whose names begin with &quot;$&quot;) are found and
  have their run-time locations decoded.
<div class="Pp"></div>
Next, all probes and functions are analyzed for optimization opportunities, in
  order to remove variables, expressions, and functions that have no useful
  value and no side-effect. Embedded-C functions are assumed to have
  side-effects unless they include the magic string
  <b>/*&#x00A0;pure&#x00A0;*/</b>. Since this optimization can hide latent code
  errors such as type mismatches or invalid $context variables, it sometimes may
  be useful to disable the optimizations with the <b>-u</b> option.
<div class="Pp"></div>
Finally, all variable, function, parameter, array, and index types are inferred
  from context (literals and operators). Stopping the translator after pass 2
  causes it to list all the probes, functions, and variables, along with all
  inferred types. Any inconsistent or unresolved types cause an error.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
In pass 3, the translator writes C code that represents the actions of all
  selected script files, and creates a <i>Makefile</i> to build that into a
  kernel object. These files are placed into a temporary directory. Stopping the
  translator at this point causes it to print the contents of the C file.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
In pass 4, the translator invokes the Linux kernel build system to create the
  actual kernel object file. This involves running <i>make</i> in the temporary
  directory, and requires a kernel module build system (headers, config and
  Makefiles) to be installed in the usual spot
  <i>/lib/modules/VERSION/build</i>. Stopping the translator after pass 4 is the
  last chance before running the kernel object. This may be useful if you want
  to archive the file.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
In pass 5, the translator invokes the systemtap auxiliary program <i>staprun</i>
  program for the given kernel object. This program arranges to load the module
  then communicates with it, copying trace data from the kernel into temporary
  files, until the user sends an interrupt signal. Any run-time error
  encountered by the probe handlers, such as running out of memory, division by
  zero, exceeding nesting or runtime limits, results in a soft error indication.
  Soft errors in excess of MAXERRORS block of all subsequent probes (except
  error-handling probes), and terminate the session. Finally, <i>staprun</i>
  unloads the module, and cleans up.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="ABNORMAL_TERMINATION"><a class="selflink" href="#ABNORMAL_TERMINATION">ABNORMAL
  TERMINATION</a></h2>
One should avoid killing the stap process forcibly, for example with SIGKILL,
  because the stapio process (a child process of the stap process) and the
  loaded module may be left running on the system. If this happens, send SIGTERM
  or SIGINT to any remaining stapio processes, then use rmmod to unload the
  systemtap module.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
See the <i>stapex</i>(3stap) manual page for a brief collection of samples, or a
  large set of installed samples under the systemtap documentation/testsuite
  directories. See <i>stappaths</i>(7stap) for the likely location of these on
  the system.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="CACHING"><a class="selflink" href="#CACHING">CACHING</a></h1>
The systemtap translator caches the pass 3 output (the generated C code) and the
  pass 4 output (the compiled kernel module) if pass 4 completes successfully.
  This cached output is reused if the same script is translated again assuming
  the same conditions exist (same kernel version, same systemtap version, etc.).
  Cached files are stored in the <i>$SYSTEMTAP_DIR/cache</i> directory. The
  cache can be limited by having the file <i>cache_mb_limit</i> placed in the
  cache directory (shown above) containing only an ASCII integer representing
  how many MiB the cache should not exceed. In the absence of this file, a
  default will be created with the limit set to 256MiB. This is a 'soft' limit
  in that the cache will be cleaned after a new entry is added if the cache
  clean interval is exceeded, so the total cache size may temporarily exceed
  this limit. This interval can be specified by having the file
  <i>cache_clean_interval_s</i> placed in the cache directory (shown above)
  containing only an ASCII integer representing the interval in seconds. In the
  absence of this file, a default will be created with the interval set to 300
  s.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="SAFETY_AND_SECURITY"><a class="selflink" href="#SAFETY_AND_SECURITY">SAFETY
  AND SECURITY</a></h1>
Systemtap may be used as a powerful administrative tool. It can expose kernel
  internal data structures and potentially private user information. (In
  <b>dyninst</b> runtime mode, this is not the case, see the <i>ALTERNATE
  RUNTIMES</i> section below.)
<div style="height: 1.00em;">&#x00A0;</div>
The translator asserts many safety constraints during compilation and more
  during run-time. It aims to ensure that no handler routine can run for very
  long, allocate boundless memory, perform unsafe operations, or in
  unintentionally interfere with the system. Uses of script global variables are
  automatically read/write locked as appropriate, to protect against
  manipulation by concurrent probe handlers. (Deadlocks are detected with
  timeouts. Use the <b>-t</b> flag to receive reports of excessive lock
  contention.) Experimenting with scripts is therefore generally <b>safe</b>.
  The guru-mode <b>-g</b> option allows administrators to bypass most safety
  measures, which permits invasive or state-changing operations, embedded-C
  code, and increases the risk of upset. By default, overload prevention is
  turned on for all modules. If you would like to disable overload processing,
  use the <b>--suppress-time-limits</b> option.
<div style="height: 1.00em;">&#x00A0;</div>
Errors that are caught at run time normally result in a clean script shutdown
  and a pass-5 error message. The <b>--suppress-handler-errors</b> option lets
  scripts tolerate soft errors without shutting down.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="PERMISSIONS"><a class="selflink" href="#PERMISSIONS">PERMISSIONS</a></h2>
For the normal linux-kernel-module runtime, to run the kernel objects systemtap
  builds, a user must be one of the following:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">the root user;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">a member of the <i>stapdev</i> and <i>stapusr</i>
    groups;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">a member of the <i>stapsys</i> and <i>stapusr</i> groups;
      or</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">a member of the <i>stapusr</i> group.</dd>
</dl>
<div class="Pp"></div>
The root user or a user who is a member of both the <i>stapdev</i> and
  <i>stapusr</i> groups can build and run any systemtap script.
<div class="Pp"></div>
A user who is a member of both the <i>stapsys</i> and <i>stapusr</i> groups can
  only use pre-built modules under the following conditions:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The module has been signed by a trusted signer. Trusted
      signers are normally systemtap compile-servers which sign modules when the
      <i>--privilege</i> option is specified by the client. See the
      <i>stap-server</i>(8) manual page for more information.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The module was built using the <i>--privilege=stapsys</i>
      or the <i>--privilege=stapusr</i> options.</dd>
</dl>
<div class="Pp"></div>
Members of only the <i>stapusr</i> group can only use pre-built modules under
  the following conditions:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The module is located in the /lib/modules/VERSION/systemtap
      directory. This directory must be owned by root and not be world
    writable.</dd>
</dl>
<div class="Pp"></div>
or
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The module has been signed by a trusted signer. Trusted
      signers are normally systemtap compile-servers which sign modules when the
      <i>--privilege</i> option is specified by the client. See the
      <i>stap-server</i>(8) manual page for more information.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The module was built using the --privilege=stapusr
    option.</dd>
</dl>
<div class="Pp"></div>
The kernel modules generated by <i>stap</i> program are run by the
  <i>staprun</i> program. The latter is a part of the Systemtap package,
  dedicated to module loading and unloading (but only in the white zone), and
  kernel-to-user data transfer. Since <i>staprun</i> does not perform any
  additional security checks on the kernel objects it is given, it would be
  unwise for a system administrator to add untrusted users to the <i>stapdev</i>
  or <i>stapusr</i> groups.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="SECUREBOOT"><a class="selflink" href="#SECUREBOOT">SECUREBOOT</a></h2>
If the current system has SecureBoot turned on in the UEFI firmware, all kernel
  modules must be signed. (Some kernels may allow disabling SecureBoot long
  after booting with a key sequence such as SysRq-X, making it unnecessary to
  sign modules.) The systemtap compile server can sign modules with a MOK
  (Machine Owner Key) that it has in common with a client system. See the
  following wiki page for more details:
<div class="Pp"></div>
<div style="margin-left: 5.00ex;"><b>https://sourceware.org/systemtap/wiki/SecureBoot</b></div>
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="RESOURCE_LIMITS"><a class="selflink" href="#RESOURCE_LIMITS">RESOURCE
  LIMITS</a></h2>
Many resource use limits are set by macros in the generated C code. These may be
  overridden with <b>-D</b> flags. A selection of these is as follows:
<dl class="Bl-tag">
  <dt class="It-tag">MAXNESTING</dt>
  <dd class="It-tag">Maximum number of nested function calls. Default determined
      by script analysis, with a bonus 10 slots added for recursive
    scripts.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">MAXSTRINGLEN</dt>
  <dd class="It-tag">Maximum length of strings, default 128.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">MAXTRYLOCK</dt>
  <dd class="It-tag">Maximum number of iterations to wait for locks on global
      variables before declaring possible deadlock and skipping the probe,
      default 1000.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">MAXACTION</dt>
  <dd class="It-tag">Maximum number of statements to execute during any single
      probe hit (with interrupts disabled), default 1000. Note that for
      straight-through probe handlers lacking loops or recursion, due to
      optimization, this parameter may be interpreted too conservatively.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">MAXACTION_INTERRUPTIBLE</dt>
  <dd class="It-tag">Maximum number of statements to execute during any single
      probe hit which is executed with interrupts enabled (such as begin/end
      probes), default (MAXACTION * 10).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">MAXBACKTRACE</dt>
  <dd class="It-tag">Maximum number of stack frames that will be be processed by
      the stap runtime unwinder as produced by the backtrace functions in the
      [u]context-unwind.stp tapsets, default 20.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">MAXMAPENTRIES</dt>
  <dd class="It-tag">Maximum number of rows in any single global array, default
      2048. Individual arrays may be declared with a larger or smaller limit
      instead:
    <div>&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div style="margin-left: 5.00ex;">
<pre>
global big[10000],little[5]
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
or denoted with <i>%</i> to make them wrap-around automatically.
<dl class="Bl-tag">
  <dt class="It-tag">MAPHASHBIAS</dt>
  <dd class="It-tag">The number of powers-of-two to add or subtract from the
      natural size of the hash table backing each global associative array.
      Default is 0. Try small positive numbers to get extra performance at the
      cost of more memory consumption, because that should reduce hash table
      collisions. Try small negative numbers for the opposite tradeoff.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">MAXERRORS</dt>
  <dd class="It-tag">Maximum number of soft errors before an exit is triggered,
      default 0, which means that the first error will exit the script. Note
      that with the <b>--suppress-handler-errors</b> option, this limit is not
      enforced.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">MAXSKIPPED</dt>
  <dd class="It-tag">Maximum number of skipped probes before an exit is
      triggered, default 100. Running systemtap with -t (timing) mode gives more
      details about skipped probes. With the default -DINTERRUPTIBLE=1 setting,
      probes skipped due to reentrancy are not accumulated against this limit.
      Note that with the <b>--suppress-handler-errors</b> option, this limit is
      not enforced.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">MINSTACKSPACE</dt>
  <dd class="It-tag">Minimum number of free kernel stack bytes required in order
      to run a probe handler, default 1024. This number should be large enough
      for the probe handler's own needs, plus a safety margin.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">MAXUPROBES</dt>
  <dd class="It-tag">Maximum number of concurrently armed user-space probes
      (uprobes), default somewhat larger than the number of user-space probe
      points named in the script. This pool needs to be potentially large
      because individual uprobe objects (about 64 bytes each) are allocated for
      each process for each matching script-level probe.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">STP_MAXMEMORY</dt>
  <dd class="It-tag">Maximum amount of memory (in kilobytes) that the systemtap
      module should use, default unlimited. The memory size includes the size of
      the module itself, plus any additional allocations. This only tracks
      direct allocations by the systemtap runtime. This does not track indirect
      allocations (as done by kprobes/uprobes/etc. internals).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">STP_OVERLOAD_THRESHOLD, STP_OVERLOAD_INTERVAL</dt>
  <dd class="It-tag">Maximum number of machine cycles spent in probes on any cpu
      per given interval, before an overload condition is declared and the
      script shut down. The defaults are 500 million and 1 billion, so as to
      limit stap script cpu consumption at around 50%.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">STP_PROCFS_BUFSIZE</dt>
  <dd class="It-tag">Size of procfs probe read buffers (in bytes). Defaults to
      <i>MAXSTRINGLEN</i>. This value can be overridden on a per-procfs file
      basis using the procfs read probe <i>.maxsize(MAXSIZE)</i> parameter.</dd>
</dl>
<div class="Pp"></div>
With scripts that contain probes on any interrupt path, it is possible that
  those interrupts may occur in the middle of another probe handler. The probe
  in the interrupt handler would be skipped in this case to avoid reentrance. To
  work around this issue, execute stap with the option <b>-DINTERRUPTIBLE=0</b>
  to mask interrupts throughout the probe handler. This does add some extra
  overhead to the probes, but it may prevent reentrance for common problem
  cases. However, probes in NMI handlers and in the callpath of the stap runtime
  may still be skipped due to reentrance.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
In case something goes wrong with <i>stap</i> or <i>staprun</i> after a probe
  has already started running, one may safely kill both user processes, and
  remove the active probe kernel module with <i>rmmod</i>. Any pending trace
  messages may be lost.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="UNPRIVILEGED_USERS"><a class="selflink" href="#UNPRIVILEGED_USERS">UNPRIVILEGED
  USERS</a></h1>
Systemtap exposes kernel internal data structures and potentially private user
  information. Because of this, use of systemtap's full capabilities are
  restricted to root and to users who are members of the groups stapdev and
  stapusr.
<div style="height: 1.00em;">&#x00A0;</div>
However, a restricted set of systemtap's features can be made available to
  trusted, unprivileged users. These users are members of the group stapusr
  only, or members of the groups stapusr and stapsys. These users can load
  systemtap modules which have been compiled and certified by a trusted
  systemtap compile-server. See the descriptions of the options
  <i>--privilege</i> and <i>--use-server</i>. See <i>README.unprivileged</i> in
  the systemtap source code for information about setting up a trusted compile
  server.
<div style="height: 1.00em;">&#x00A0;</div>
The restrictions enforced when <i>--privilege=stapsys</i> is specified are
  designed to prevent unprivileged users from:
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">harming the system maliciously.</dd>
</dl>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
The restrictions enforced when <i>--privilege=stapusr</i> is specified are
  designed to prevent unprivileged users from:
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">harming the system maliciously.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">gaining access to information which would not normally be
      available to an unprivileged user.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">disrupting the performance of processes owned by other
      users of the system. Some overhead to the system in general is unavoidable
      since the unprivileged user's probes will be triggered at the appropriate
      times. What we would like to avoid is targeted interruption of another
      user's processes which would not normally be possible by an unprivileged
      user.</dd>
</dl>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="PROBE_RESTRICTIONS"><a class="selflink" href="#PROBE_RESTRICTIONS">PROBE
  RESTRICTIONS</a></h2>
A member of the groups stapusr and stapsys may use all probe points.
<div class="Pp"></div>
A member of only the group stapusr may use only the following probes:
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">begin, begin(n)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">end, end(n)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">error(n)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">never</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">process.*, where the target process is owned by the
    user.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">timer.{jiffies,s,sec,ms,msec,us,usec,ns,nsec}(n)*</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">timer.hz(n)</dd>
</dl>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="SCRIPT_LANGUAGE_RESTRICTIONS"><a class="selflink" href="#SCRIPT_LANGUAGE_RESTRICTIONS">SCRIPT
  LANGUAGE RESTRICTIONS</a></h2>
The following scripting language features are unavailable to all unprivileged
  users:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">any feature enabled by the Guru Mode (-g) option.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">embedded C code.</dd>
</dl>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="RUNTIME_RESTRICTIONS"><a class="selflink" href="#RUNTIME_RESTRICTIONS">RUNTIME
  RESTRICTIONS</a></h2>
The following runtime restrictions are placed upon all unprivileged users:
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Only the default runtime code (see <i>-R</i>) may be
    used.</dd>
</dl>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
Additional restrictions are placed on members of only the group stapusr:
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Probing of processes owned by other users is not
    permitted.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Access of kernel memory (read and write) is not
    permitted.</dd>
</dl>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="COMMAND_LINE_OPTION_RESTRICTIONS"><a class="selflink" href="#COMMAND_LINE_OPTION_RESTRICTIONS">COMMAND
  LINE OPTION RESTRICTIONS</a></h2>
Some command line options provide access to features which must not be available
  to all unprivileged users:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">-g may not be specified.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The following options may not be used by the compile-server
      client:
    <div>&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div style="margin-left: 5.00ex;">
<pre>
    -a, -B, -D, -I, -r, -R
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="ENVIRONMENT_RESTRICTIONS"><a class="selflink" href="#ENVIRONMENT_RESTRICTIONS">ENVIRONMENT
  RESTRICTIONS</a></h2>
The following environment variables must not be set for all unprivileged users:
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
SYSTEMTAP_RUNTIME
SYSTEMTAP_TAPSET
SYSTEMTAP_DEBUGINFO_PATH
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="TAPSET_RESTRICTIONS"><a class="selflink" href="#TAPSET_RESTRICTIONS">TAPSET
  RESTRICTIONS</a></h2>
In general, tapset functions are only available for members of the group stapusr
  when they do not gather information that an ordinary program running with that
  user's privileges would be denied access to.
<div style="height: 1.00em;">&#x00A0;</div>
There are two categories of unprivileged tapset functions. The first category
  consists of utility functions that are unconditionally available to all users;
  these include such things as:
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
cpu:long ()
exit ()
str_replace:string (prnt_str:string, srch_str:string, rplc_str:string)
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
The second category consists of so-called <i>myproc-unprivileged</i> functions
  that can only gather information within their own processes. Scripts that wish
  to use these functions must test the result of the tapset function
  <i>is_myproc</i> and only call these functions if the result is 1. The script
  will exit immediately if any of these functions are called by an unprivileged
  user within a probe within a process which is not owned by that user. Examples
  of <i>myproc-unprivileged</i> functions include:
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
print_usyms (stk:string)
user_int:long (addr:long)
usymname:string (addr:long)
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
A compile error is triggered when any function not in either of the above
  categories is used by members of only the group stapusr.
<div style="height: 1.00em;">&#x00A0;</div>
No other built-in tapset functions may be used by members of only the group
  stapusr.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="ALTERNATE_RUNTIMES"><a class="selflink" href="#ALTERNATE_RUNTIMES">ALTERNATE
  RUNTIMES</a></h1>
As described above, systemtap's default runtime mode involves building and
  loading kernel modules, with various security tradeoffs presented. Systemtap
  now includes a new prototype backend, selected with <i>--runtime=dyninst</i>,
  which uses Dyninst to instrument a user's own processes at runtime. This
  backend does not use kernel modules, and does not require root privileges, but
  is restricted with respect to the kinds of probes and other constructs that a
  script may use.
<div style="height: 1.00em;">&#x00A0;</div>
The <i>dyninst</i> runtime operates in target-attach mode, so it does require a
  <i>-c COMMAND</i> or <i>-x PID</i> process. For example:
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
stap --runtime=dyninst -c 'stap -V' \
     -e 'probe process.function(&quot;main&quot;)
         { println(&quot;hi from dyninst!&quot;) }'
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
It may be necessary to disable a conflicting selinux check with
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<pre>
# setsebool allow_execstack 1
</pre>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="EXIT_STATUS"><a class="selflink" href="#EXIT_STATUS">EXIT
  STATUS</a></h1>
The systemtap translator generally returns with a success code of 0 if the
  requested script was processed and executed successfully through the requested
  pass. Otherwise, errors may be printed to stderr and a failure code is
  returned. Use <i>-v</i> or <i>-vp N</i> to increase (global or per-pass)
  verbosity to identify the source of the trouble.
<div style="height: 1.00em;">&#x00A0;</div>
In listings mode (<i>-l</i> and <i>-L</i>), error messages are normally
  suppressed. A success code of 0 is returned if at least one matching probe was
  found.
<div style="height: 1.00em;">&#x00A0;</div>
A script executing in pass 5 that is interrupted with ^C / SIGINT is considered
  to be successful.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="DEPRECATION"><a class="selflink" href="#DEPRECATION">DEPRECATION</a></h1>
Over time, some features of the script language and the tapset library may
  undergo incompatible changes, so that a script written against an old version
  of systemtap may no longer run. In these cases, it may help to run systemtap
  with the <i>--compatible VERSION</i> flag, specifying the last known working
  version. Running systemtap with the <i>--check-version</i> flag will output a
  warning if any possible incompatible elements have been parsed. Deprecation
  historical details may be found in the NEWS file.
<div style="height: 1.00em;">&#x00A0;</div>
The purpose of deprecation facility is to improve the experience of scripts
  written for newer versions of systemtap (by adding better alternatives and
  removing conflicting or messy older alternatives), while at the same time
  permitting scripts written for older versions of systemtap to continue
  running. Deprecation is thus intended a <i>service to users</i> (and an
  inconvenience to systemtap's developers), rather than the other way around.
<div style="height: 1.00em;">&#x00A0;</div>
Please note that underscore-prefixed identifiers in the tapset sometimes undergo
  such changes that are difficult to preserve compatibility for, even with the
  deprecation mechanisms. Avoid relying on these in your scripts; instead
  propose them for promotion to non-underscored status.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="FILES"><a class="selflink" href="#FILES">FILES</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag">Important files and their corresponding paths can be
    located in the</dt>
  <dd class="It-tag">stappaths (7) manual page.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<pre>
<i>stapprobes</i>(3stap),
<i>function::*</i>(3stap),
<i>probe::*</i>(3stap),
<i>tapset::*</i>(3stap),
<i>stappaths</i>(7),
<i>staprun</i>(8),
<i>stapdyn</i>(8),
<i>systemtap</i>(8),
<i>stapvars</i>(3stap),
<i>stapex</i>(3stap),
<i>stap-server</i>(8),
<i>stap-prep</i>(1),
<i>stapref</i>(1),
<i>awk</i>(1),
<i>gdb</i>(1)
<div class="Pp"></div>
</pre>
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
Use the Bugzilla link of the project web page or our mailing list.
  <b>http://sourceware.org/systemtap/</b>,
  <b>&lt;systemtap@sourceware.org&gt;</b>.
<div class="Pp"></div>
<i>error::reporting</i>(7stap),
  <b>https://sourceware.org/systemtap/wiki/HowToReportBugs</b></div>
<table class="foot">
  <tr>
    <td class="foot-date"></td>
    <td class="foot-os"></td>
  </tr>
</table>
</body>
</html>
