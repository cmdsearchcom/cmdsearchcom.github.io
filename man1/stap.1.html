<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:39:08 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>STAP(1) General Commands Manual STAP(1)</p>

<p style="margin-top: 1em">NAME <br>
stap - systemtap script translator/driver</p>

<p style="margin-top: 1em">SYNOPSIS <br>
stap [ OPTIONS ] FILENAME [ ARGUMENTS ] <br>
stap [ OPTIONS ] - [ ARGUMENTS ] <br>
stap [ OPTIONS ] -e SCRIPT [ ARGUMENTS ] <br>
stap [ OPTIONS ] -l PROBE [ ARGUMENTS ] <br>
stap [ OPTIONS ] -L PROBE [ ARGUMENTS ] <br>
stap [ OPTIONS ] --dump-probe-types <br>
stap [ OPTIONS ] --dump-probe-aliases <br>
stap [ OPTIONS ] --dump-functions</p>

<p style="margin-top: 1em">DESCRIPTION <br>
The stap program is the front-end to the Systemtap tool. It
accepts probing instructions written in a simple
domain-specific language, translates those instructions into
C code, <br>
compiles this C code, and loads the resulting module into a
running Linux kernel or a DynInst user-space mutator, to
perform the requested system trace/probe functions. You can
<br>
supply the script in a named file (FILENAME), from standard
input (use - instead of FILENAME), or from the command line
(using -e SCRIPT). The program runs until it is inter&acirc;
<br>
rupted by the user, or if the script voluntarily invokes the
exit() function, or by sufficient number of soft errors.</p>

<p style="margin-top: 1em">The language, which is described
the SCRIPT LANGUAGE section below, is strictly typed,
expressive, declaration free, procedural,
prototyping-friendly, and inspired by awk and C. <br>
It allows source code points or events in the system to be
associated with handlers, which are subroutines that are
executed synchronously. It is somewhat similar conceptually
<br>
to &quot;breakpoint command lists&quot; in the gdb
debugger.</p>

<p style="margin-top: 1em">DOCUMENTATION OVERVIEW <br>
systemtap comes with a variety of educational, documentation
and reference resources. They come online and/or packaged
for offline use. For online documentation, see the <br>
project web site, https://sourceware.org/systemtap/</p>


<p style="margin-top: 1em">&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&not;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;
<br>
&acirc;man pages &acirc; &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;stap (this page) &acirc; language syntax, concepts,
operation, options &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;stapprobes &acirc; probe points and their $context
variables &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;stapref &acirc; quick reference to language syntax
&acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;stappaths &acirc; list of directories, including
books &amp; references &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;stap-prep &acirc; program to install auxiliary
dependencies like kernel debugin&acirc; &acirc; <br>
&acirc; &acirc; fo &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;tapset::* &acirc; generated list of tapsets &acirc;
<br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;probe::* &acirc; generated list of tapset probe
aliases &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;function::* &acirc; generated list of tapset
functions &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;macro::* &acirc; generated list of tapset macros
&acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;stapvars &acirc; some of the tapset global variables
&acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;staprun, stapdyn &acirc; programs for executing
compiled systemtap scripts &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;systemtap &acirc; initscript, boot-time probing
&acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;stap-server &acirc; compilation server &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;stapex &acirc; a few very basic script examples
&acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;books &acirc; &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;Beginner&rsquo;s Guide &acirc; tutorial book,
language essentials, examples &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;Tutorial &acirc; shorter tutorial, exercises &acirc;
<br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;Language Reference &acirc; detailed language manual,
covers statistics/analysis &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;Tapset Reference &acirc; the tapset man pages,
reformatted into a book &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;references &acirc; &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;example scripts &acirc; over a hundred directly
usable sysadmin tools, toys, hacks to &acirc; <br>
&acirc; &acirc; learn from &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acute;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;</p>

<p style="margin-top: 1em">OPTIONS <br>
The systemtap translator supports the following options. Any
other option prints a list of supported options. Options may
be given on the command line, as usual. If the file <br>
$SYSTEMTAP_DIR/rc exist, options are also loaded from there
and interpreted first. ($SYSTEMTAP_DIR defaults to
$HOME/.systemtap if unset.)</p>

<p style="margin-top: 1em">In some cases, the default value
of an option depends on particular system configuration and
thus can&rsquo;t be mentioned here directly. In some of
those cases running &quot;stap --help&quot; <br>
might display the default.</p>

<p style="margin-top: 1em">- Use standard input instead of
a given FILENAME as probe language input, unless -e SCRIPT
is given.</p>

<p style="margin-top: 1em">-h --help <br>
Show help message.</p>

<p style="margin-top: 1em">-V --version <br>
Show version message.</p>

<p style="margin-top: 1em">-p NUM Stop after pass NUM. The
passes are numbered 1-5: parse, elaborate, translate,
compile, run. See the PROCESSING section for details.</p>

<p style="margin-top: 1em">-v Increase verbosity for all
passes. Produce a larger volume of informative (?) output
each time option repeated.</p>

<p style="margin-top: 1em">--vp ABCDE <br>
Increase verbosity on a per-pass basis. For example,
&quot;--vp 002&quot; adds 2 units of verbosity to pass 3
only. The combination &quot;-v --vp 00004&quot; adds 1 unit
of verbosity for <br>
all passes, and 4 more for pass 5.</p>

<p style="margin-top: 1em">-k Keep the temporary directory
after all processing. This may be useful in order to examine
the generated C code, or to reuse the compiled kernel
object.</p>

<p style="margin-top: 1em">-g Guru mode. Enable parsing of
unsafe expert-level constructs like embedded C.</p>

<p style="margin-top: 1em">-P Prologue-searching mode. This
is equivalent to --prologue-searching=always. Activate
heuristics to work around incorrect debugging information
for function parameter <br>
$context variables.</p>

<p style="margin-top: 1em">-u Unoptimized mode. Disable
unused code elision and many other optimizations during
elaboration / translation.</p>

<p style="margin-top: 1em">-w Suppressed warnings mode.
Disables all warning messages.</p>

<p style="margin-top: 1em">-W Treat all warnings as
errors.</p>

<p style="margin-top: 1em">-b Use bulk mode (percpu files)
for kernel-to-user data transfer. Use the stap-merge program
to multiplex them back together later.</p>

<p style="margin-top: 1em">-t Collect timing information on
the number of times probe executes and average amount of
time spent in each probe-point. Also shows the derivation
for each probe-point.</p>

<p style="margin-top: 1em">-s NUM Use NUM megabyte buffers
for kernel-to-user data transfer. On a multiprocessor in
bulk mode, this is a per-processor amount.</p>

<p style="margin-top: 1em">-I DIR Add the given directory
to the tapset search directory. See the description of pass
2 for details.</p>

<p style="margin-top: 1em">-D NAME=VALUE <br>
Add the given C preprocessor directive to the module
Makefile. These can be used to override limit parameters
described below.</p>

<p style="margin-top: 1em">-B NAME=VALUE <br>
In kernel-runtime mode, add the given make directive to the
kernel module build&rsquo;s make invocation. These can be
used to add or override kconfig options. For example,
use</p>

<p style="margin-top: 1em">-B CONFIG_DEBUG_INFO=y</p>

<p style="margin-top: 1em">to add debugging
information.</p>

<p style="margin-top: 1em">-B FLAG <br>
In dyninst-runtime mode, add the given parameter to the
compiler CFLAGS used for building the dyninst shared
library. For example, use</p>

<p style="margin-top: 1em">-B -g</p>

<p style="margin-top: 1em">to add debugging
information.</p>

<p style="margin-top: 1em">-a ARCH <br>
Use a cross-compilation mode for the given target
architecture. This requires access to the cross-compiler and
the kernel build tree, and goes along with the</p>

<p style="margin-top: 1em">-B
CROSS_COMPILE=arch-tool-prefix- <br>
and <br>
-r /build/tree</p>

<p style="margin-top: 1em">options.</p>

<p style="margin-top: 1em">--modinfo NAME=VALUE <br>
Add the name/value pair as a MODULE_INFO macro call to the
generated module. This may be useful to inform or override
various module-related checks in the kernel.</p>

<p style="margin-top: 1em">-G NAME=VALUE <br>
Sets the value of global variable NAME to VALUE when staprun
is invoked. This applies to scalar variables declared global
in the script/tapset.</p>

<p style="margin-top: 1em">-R DIR Look for the systemtap
runtime sources in the given directory. Your DIR default can
be seen using &quot;stap --help&quot;.</p>

<p style="margin-top: 1em">-r /DIR <br>
Build for kernel in given build tree. Can also be set with
the SYSTEMTAP_RELEASE environment variable.</p>

<p style="margin-top: 1em">-r RELEASE <br>
Build for kernel in build tree /lib/modules/RELEASE/build.
Can also be set with the SYSTEMTAP_RELEASE environment
variable.</p>

<p style="margin-top: 1em">-m MODULE <br>
Use the given name for the generated kernel object module,
instead of a unique randomized name. The generated kernel
object module is copied to the current directory.</p>

<p style="margin-top: 1em">-d MODULE <br>
Add symbol/unwind information for the given module into the
kernel object module. This may enable symbolic tracebacks
from those modules/programs, even if they do not <br>
have an explicit probe placed into them.</p>

<p style="margin-top: 1em">--ldd Add symbol/unwind
information for all user-space shared libraries suspected by
ldd to be necessary for user-space binaries being probed or
listed with the -d option. Cau&acirc; <br>
tion: this can make the probe modules considerably larger.
Note that this option does not deal with kernel-space
modules: see instead --all-modules below.</p>

<p style="margin-top: 1em">--all-modules <br>
Equivalent to specifying &quot;-dkernel&quot; and a
&quot;-d&quot; for each kernel module that is currently
loaded. Caution: this can make the probe modules
considerably larger.</p>

<p style="margin-top: 1em">-o FILE <br>
Send standard output to named file. In bulk mode, percpu
files will start with FILE_ (FILE_cpu with -F) followed by
the cpu number. This supports strftime(3) formats for <br>
FILE.</p>

<p style="margin-top: 1em">-c CMD Start the probes, run
CMD, and exit when CMD finishes. This also has the effect of
setting target() to the pid of the command ran.</p>

<p style="margin-top: 1em">-x PID Sets target() to PID.
This allows scripts to be written that filter on a specific
process. Scripts run independent of the PID&rsquo;s
lifespan.</p>

<p style="margin-top: 1em">-e SCRIPT <br>
Run the given SCRIPT specified on the command line.</p>

<p style="margin-top: 1em">-E SCRIPT <br>
Run the given SCRIPT specified. This SCRIPT is run in
addition to the main script specified, through -e, or as a
script file. This option can be repeated to run multiple
<br>
scripts, and can be used in listing mode (-l/-L).</p>

<p style="margin-top: 1em">-l PROBE <br>
Instead of running a probe script, just list all available
probe points matching the given single probe point. The
pattern may include wildcards and aliases, but not
com&acirc; <br>
ma-separated multiple probe points. The process result code
will indicate failure if there are no matches.</p>

<p style="margin-top: 1em">-L PROBE <br>
Similar to &quot;-l&quot;, but list probe points and
script-level local variables.</p>

<p style="margin-top: 1em">-F Without -o option, load
module and start probes, then detach from the module leaving
the probes running. With -o option, run staprun in
background as a daemon and show <br>
its pid.</p>

<p style="margin-top: 1em">-S size[,N] <br>
Sets the maximum size of output file and the maximum number
of output files. If the size of output file will exceed size
, systemtap switches output file to the next <br>
file. And if the number of output files exceed N , systemtap
removes the oldest output file. You can omit the second
argument.</p>

<p style="margin-top: 1em">--skip-badvars <br>
Ignore unresolvable or run-time-inaccessible context
variables and substitute with 0, without errors.</p>

<p style="margin-top: 1em">--prologue-searching[=WHEN] <br>
Prologue-searching mode. Activate heuristics to work around
incorrect debugging information for function parameter
$context variables. WHEN can be either &quot;never&quot;,
&quot;al&acirc; <br>
ways&quot;, or &quot;auto&quot; (i.e. enabled by heuristic).
If WHEN is missing, then &quot;always&quot; is assumed. If
the option is missing, then &quot;auto&quot; is assumed.</p>

<p style="margin-top: 1em">--suppress-handler-errors <br>
Wrap all probe handlers into something like this</p>

<p style="margin-top: 1em">try { ... } catch { next }</p>

<p style="margin-top: 1em">block, which causes any runtime
errors to be quietly suppressed. Suppressed errors do not
count against MAXERRORS limits. In this mode, the MAXSKIPPED
limits are also <br>
suppressed, so that many errors and skipped probes may be
accumulated during a script&rsquo;s runtime. Any overall
counts will still be reported at shutdown.</p>

<p style="margin-top: 1em">--compatible VERSION <br>
Suppress recent script language or tapset changes which are
incompatible with given older version of systemtap. This may
be useful if a much older systemtap script fails <br>
to run. See the DEPRECATION section for more details.</p>

<p style="margin-top: 1em">--check-version <br>
This option is used to check if the active script has any
constructs that may be systemtap version specific. See the
DEPRECATION section for more details.</p>

<p style="margin-top: 1em">--clean-cache <br>
This option prunes stale entries from the cache directory.
This is normally done automatically after successful runs,
but this option will trigger the cleanup manually <br>
and then exit. See the CACHING section for more details
about cache limits.</p>

<p style="margin-top: 1em">--color[=WHEN], --colour[=WHEN]
<br>
This option controls coloring of error messages. WHEN can be
either &quot;never&quot;, &quot;always&quot;, or
&quot;auto&quot; (i.e. enable only if at a terminal). If
WHEN is missing, then &quot;always&quot; is <br>
assumed. If the option is missing, then &quot;auto&quot; is
assumed.</p>

<p style="margin-top: 1em">Colors can be modified using the
SYSTEMTAP_COLORS environment variable. The format must be of
the form key1=val1:key2=val2:key3=val3 ...etc. Valid keys
are &quot;error&quot;, <br>
&quot;warning&quot;, &quot;source&quot;, &quot;caret&quot;,
and &quot;token&quot;. Values constitute Select Graphic
Rendition (SGR) parameter(s). Consult the documentation of
your terminal for the SGRs it sup&acirc; <br>
ports. As an example, the default colors would be expressed
as error=01;31:warning=00;33:source=00;34:caret=01:token=01.
If SYSTEMTAP_COLORS is absent, the default colors <br>
will be used. If it is empty or invalid, coloring is turned
off.</p>

<p style="margin-top: 1em">--disable-cache <br>
This option disables all use of the cache directory. No
files will be either read from or written to the cache.</p>

<p style="margin-top: 1em">--poison-cache <br>
This option treats files in the cache directory as invalid.
No files will be read from the cache, but resulting files
from this run will still be written to the cache. <br>
This is meant as a troubleshooting aid when stap&rsquo;s
cached behavior seems to be misbehaving.</p>

<p style="margin-top: 1em">--privilege[=stapusr | =stapsys
| =stapdev] <br>
This option instructs stap to examine the script looking for
constructs which are not allowed for the specified privilege
level (see UNPRIVILEGED USERS). Compilation <br>
fails if any such constructs are used. If stapusr or stapsys
are specified when using a compile server (see
--use-server), the server will examine the script and, if
com&acirc; <br>
pilation succeeds, the server will cryptographically sign
the resulting kernel module, certifying that is it safe for
use by users at the specified privilege level.</p>

<p style="margin-top: 1em">If --privilege has not been
specified, -pN has not been specified with N &lt; 5, and the
invoking user is not root, and is not a member of the group
stapdev, then stap will <br>
automatically add the appropriate --privilege option to the
options already specified.</p>

<p style="margin-top: 1em">--unprivileged <br>
This option is equivalent to --privilege=stapusr.</p>

<p style="margin-top: 1em">--use-server[=HOSTNAME[:PORT] |
=IP_ADDRESS[:PORT] | =CERT_SERIAL] <br>
Specify compile-server(s) to be used for compilation and/or
in conjunction with --list-servers and --trust-servers (see
below) for listing. If no argument is supplied, <br>
then the default in unprivileged mode (see --privilege) is
to select compatible servers which are trusted as SSL peers
and as module signers and currently online. Other&acirc;
<br>
wise the default is to select compatible servers which are
trusted as SSL peers and currently online. --use-server may
be specified more than once, in which case a list <br>
of servers is accumulated in the order specified. Servers
may be specified by host name, ip address, or by certificate
serial number (obtained using --list-servers). The <br>
latter is most commonly used when adding or revoking trust
in a server (see --trust-servers below). If a server is
specified by host name or ip address, then an optional <br>
port number may be specified. This is useful for accessing
servers which are not on the local network or to specify a
particular server.</p>

<p style="margin-top: 1em">IP addresses may be IPv4 or IPv6
addresses.</p>

<p style="margin-top: 1em">If a particular IPv6 address is
link local and exists on more than one interface, the
intended interface may be specified by appending the address
with a percent sign (%) <br>
followed by the intended interface name. For example,
&quot;fe80::5eff:35ff:fe07:55ca%eth0&quot;.</p>

<p style="margin-top: 1em">In order to specify a port
number with an IPv6 address, it is necessary to enclose the
IPv6 address in square brackets ([]) in order to separate
the port number from the <br>
rest of the address. For example,
&quot;[fe80::5eff:35ff:fe07:55ca]:5000&quot; or
&quot;[fe80::5eff:35ff:fe07:55ca%eth0]:5000&quot;.</p>

<p style="margin-top: 1em">If --use-server has not been
specified, -pN has not been specified with N &lt; 5, and the
invoking user not root, is not a member of the group
stapdev, but is a member of the <br>
group stapusr, then stap will automatically add --use-server
to the options already specified.</p>

<p style="margin-top: 1em">--use-server-on-error[=yes|=no]
<br>
Instructs stap to retry compilation of a script using a
compile server if compilation on the local host fails in a
manner which suggests that it might succeed using a <br>
server. If this option is not specified, the default is no.
If no argument is provided, then the default is yes.
Compilation will be retried for certain types of errors <br>
(e.g. insufficient data or resources) which may not occur
during re-compilation by a compile server. Compile servers
will be selected automatically for the re-compilation <br>
attempt as if --use-server was specified with no
arguments.</p>

<p style="margin-top: 1em">--list-servers[=SERVERS] <br>
Display the status of the requested SERVERS, where SERVERS
is a comma-separated list of server attributes. The list of
attributes is combined to filter the list of servers <br>
displayed. Supported attributes are:</p>

<p style="margin-top: 1em">all specifies all known servers
(trusted SSL peers, trusted module signers, online
servers).</p>

<p style="margin-top: 1em">specified <br>
specifies servers specified using --use-server.</p>

<p style="margin-top: 1em">online filters the output by
retaining information about servers which are currently
online.</p>

<p style="margin-top: 1em">trusted <br>
filters the output by retaining information about servers
which are trusted as SSL peers.</p>

<p style="margin-top: 1em">signer filters the output by
retaining information about servers which are trusted as
module signers (see --privilege).</p>

<p style="margin-top: 1em">compatible <br>
filters the output by retaining information about servers
which are compatible with the current kernel release and
architecture.</p>

<p style="margin-top: 1em">If no argument is provided, then
the default is specified. If no servers were specified using
--use-server, then the default servers for --use-server are
listed.</p>

<p style="margin-top: 1em">Note that --list-servers uses
the avahi-daemon service to detect online servers. If this
service is not available, then --list-servers will fail to
detect any online <br>
servers. In order for --list-servers to detect servers
listening on IPv6 addresses, the avahi-daemon configuration
file /etc/avahi/avahi-daemon.conf must contain an active
<br>
&quot;use-ipv6=yes&quot; line. The service must be restarted
after adding this line in order for IPv6 to be enabled.</p>

<p style="margin-top: 1em">--trust-servers[=TRUST_SPEC]
<br>
Grant or revoke trust in compile-servers, specified using
--use-server as specified by TRUST_SPEC, where TRUST_SPEC is
a comma-separated list specifying the trust which is <br>
to be granted or revoked. Supported elements are:</p>

<p style="margin-top: 1em">ssl trust the specified servers
as SSL peers.</p>

<p style="margin-top: 1em">signer trust the specified
servers as module signers (see --privilege). Only root can
specify signer.</p>

<p style="margin-top: 1em">all-users <br>
grant trust as an ssl peer for all users on the local host.
The default is to grant trust as an ssl peer for the current
user only. Trust as a module signer is al&acirc; <br>
ways granted for all users. Only root can specify
all-users.</p>

<p style="margin-top: 1em">revoke revoke the specified
trust. The default is to grant it.</p>

<p style="margin-top: 1em">no-prompt <br>
do not prompt the user for confirmation before carrying out
the requested action. The default is to prompt the user for
confirmation.</p>

<p style="margin-top: 1em">If no argument is provided, then
the default is ssl. If no servers were specified using
--use-server, then no trust will be granted or revoked.</p>

<p style="margin-top: 1em">Unless no-prompt has been
specified, the user will be prompted to confirm the trust to
be granted or revoked before the operation is performed.</p>

<p style="margin-top: 1em">--dump-probe-types <br>
Dumps a list of supported probe types and exits. If
--privilege=stapusr is also specified, the list will be
limited to probe types available to unprivileged users.</p>

<p style="margin-top: 1em">--dump-probe-aliases <br>
Dumps a list of all probe aliases found in library files and
exits.</p>

<p style="margin-top: 1em">--dump-functions <br>
Dumps a list of all the public functions found in library
files and exits. Also includes their parameters and types. A
function of type &rsquo;unknown&rsquo; indicates a function
that <br>
does not return a value. Note that not all
function/parameter types may be resolved (these are also
shown by &rsquo;unknown&rsquo;). This features is very
memory-intensive and thus <br>
may not work properly with --use-server if the target server
imposes an rlimit on process memory (i.e. through the
~stap-server/.systemtap/rc configuration file, see stap-
<br>
server(8)).</p>

<p style="margin-top: 1em">--remote URL <br>
Set the execution target to the given host. This option may
be repeated to target multiple execution targets. Passes 1-4
are completed locally as normal to build the <br>
script, and then pass 5 will copy the module to the target
and run it. Acceptable URL forms include:</p>

<p style="margin-top: 1em">[USER@]HOSTNAME,
ssh://[USER@]HOSTNAME <br>
This mode uses ssh, optionally using a username not matching
your own. If a custom ssh_config file is in use, add SendEnv
LANG to retain internationalization func&acirc; <br>
tionality.</p>

<p style="margin-top: 1em">libvirt://DOMAIN,
libvirt://DOMAIN/LIBVIRT_URI <br>
This mode uses stapvirt to execute the script on a domain
managed by libvirt. Optionally, LIBVIRT_URI may be specified
to connect to a specific driver and/or a re&acirc; <br>
mote host. For example, to connect to the local privileged
QEMU driver, use:</p>

<p style="margin-top: 1em">--remote
libvirt://MyDomain/qemu:///system</p>

<p style="margin-top: 1em">See the page at
&lt;http://libvirt.org/uri.html&gt; for supported URIs. Also
see stapvirt(1) for more information on how to prepare the
domain for stap probing.</p>

<p style="margin-top: 1em">unix:PATH <br>
This mode connects to a UNIX socket. This can be used with a
QEMU virtio-serial port for executing scripts inside a
running virtual machine.</p>

<p style="margin-top: 1em">direct:// <br>
Special loopback mode to run on the local host.</p>

<p style="margin-top: 1em">--remote-prefix <br>
Prefix each line of remote output with &quot;N: &quot;,
where N is the index of the remote execution target from
which the given line originated.</p>

<p style="margin-top: 1em">--download-debuginfo[=OPTION]
<br>
Enable, disable or set a timeout for the automatic debuginfo
downloading feature offered by abrt as specified by OPTION,
where OPTION is one of the following:</p>

<p style="margin-top: 1em">yes enable automatic downloading
of debuginfo with no timeout. This is the same as not
providing an OPTION value to --download-debuginfo</p>

<p style="margin-top: 1em">no explicitly disable automatic
downloading of debuginfo. This is the same as not using the
option at all.</p>

<p style="margin-top: 1em">ask show abrt output, and ask
before continuing download. No timeout will be set.</p>

<p style="margin-top: 1em">&lt;timeout&gt; <br>
specify a timeout as a positive number to stop the download
if it is taking longer than &lt;timeout&gt; seconds.</p>

<p style="margin-top: 1em">--rlimit-as=NUM <br>
Specify the maximum size of the process&rsquo;s virtual
memory (address space), in bytes. If nothing is specified,
no limits are imposed.</p>

<p style="margin-top: 1em">--rlimit-cpu=NUM <br>
Specify the CPU time limit, in seconds. If nothing is
specified, no limits are imposed.</p>

<p style="margin-top: 1em">--rlimit-nproc=NUM <br>
Specify the maximum number of processes that can be created.
If nothing is specified, no limits are imposed.</p>

<p style="margin-top: 1em">--rlimit-stack=NUM <br>
Specify the maximum size of the process stack, in bytes. If
nothing is specified, no limits are imposed.</p>

<p style="margin-top: 1em">--rlimit-fsize=NUM <br>
Specify the maximum size of files that the process may
create, in bytes. If nothing is specified, no limits are
imposed.</p>

<p style="margin-top: 1em">--sysroot=DIR <br>
Specify sysroot directory where target files (executables,
libraries, etc.) are located. With -r RELEASE, the sysroot
will be searched for the appropriate kernel build <br>
directory. With -r /DIR, however, the sysroot will not be
used to find the kernel build.</p>

<p style="margin-top: 1em">--sysenv=VAR=VALUE <br>
Provide an alternate value for an environment variable where
the value on a remote system differs. Path variables (e.g.
PATH, LD_LIBRARY_PATH) are assumed to be relative <br>
to the directory provided by --sysroot, if provided.</p>

<p style="margin-top: 1em">--suppress-time-limits <br>
Disable -DSTP_OVERLOAD related options as well as
-DMAXACTION and -DMAXTRYLOCK. This option requires guru
mode.</p>

<p style="margin-top: 1em">--runtime=MODE <br>
Set the pass-5 runtime mode. Valid options are kernel
(default) and dyninst. See ALTERNATE RUNTIMES below for more
information.</p>

<p style="margin-top: 1em">--dyninst <br>
Shorthand for --runtime=dyninst.</p>

<p style="margin-top: 1em">--save-uprobes <br>
On machines that require SystemTap to build its own uprobes
module (kernels prior to version 3.5), this option instructs
SystemTap to also save a copy of the module in the <br>
current directory (creating a new &quot;uprobes&quot;
directory first).</p>

<p style="margin-top: 1em">--target-namespaces=PID <br>
Allow for a set of target namespaces to be set based on the
namespaces the given PID is in. This is for namespace-aware
tapset functions. If the target namespaces was not <br>
set, the target defaults to the stap process&rsquo;
namespaces.</p>

<p style="margin-top: 1em">--monitor=INTERVAL <br>
Enables an interface to display status information about the
module(uptime, module name, invoker uid, memory sizes,
global variables, list of probes with their statis&acirc;
<br>
tics). An optional argument INTERVAL can be supplied to set
the refresh rate in seconds of the status window. The module
can also be controlled by a list of commands using <br>
the following keys:</p>

<p style="margin-top: 1em">c Resets all global variables to
their initial values or zeroes them if they did not have an
initial value.</p>

<p style="margin-top: 1em">s Rotates the attribute used to
sort the list of probes.</p>

<p style="margin-top: 1em">t Brings up a prompt to allow
toggling(on/off) of probes by index. Probe points are still
affected by their conditions.</p>

<p style="margin-top: 1em">r Resumes the script by toggling
on all probes.</p>

<p style="margin-top: 1em">p Pauses the script by toggling
off all probes.</p>

<p style="margin-top: 1em">x Hides/shows the status window.
This allows for more output to be seen.</p>

<p style="margin-top: 1em">navigation-keys <br>
The j/k/ArrowDown/ArrowUp keys can be used to scroll through
the probe list and the d,D/u,U/PageDown,End/PageUp,Home keys
can be used to scroll through the module <br>
output.</p>

<p style="margin-top: 1em">ARGUMENTS <br>
Any additional arguments on the command line are passed to
the script parser for substitution. See below.</p>

<p style="margin-top: 1em">SCRIPT LANGUAGE <br>
The systemtap script language resembles awk and C. There are
two main outermost constructs: probes and functions. Within
these, statements and expressions use C-like operator <br>
syntax and precedence.</p>

<p style="margin-top: 1em">GENERAL SYNTAX <br>
Whitespace is ignored. Three forms of comments are
supported: <br>
# ... shell style, to the end of line, except for $# and @#
<br>
// ... C++ style, to the end of line <br>
/* ... C style ... */ <br>
Literals are either strings enclosed in double-quotes
(passing through the usual C escape codes with backslashes,
and with adjacent string literals glued together, also as in
C), <br>
or integers (in decimal, hexadecimal, or octal, using the
same notation as in C). All strings are limited in length to
some reasonable value (a few hundred bytes). Integers are
<br>
64-bit signed quantities, although the parser also accepts
(and wraps around) values above positive 2**63.</p>

<p style="margin-top: 1em">In addition, script arguments
given at the end of the command line may be inserted. Use $1
... $&lt;NN&gt; for insertion unquoted, @1 ... @&lt;NN&gt;
for insertion as a string literal. The <br>
number of arguments may be accessed through $# (as an
unquoted number) or through @# (as a quoted number). These
may be used at any place a token may begin, including within
the <br>
preprocessing stage. Reference to an argument number beyond
what was actually given is an error.</p>

<p style="margin-top: 1em">PREPROCESSING <br>
A simple conditional preprocessing stage is run as a part of
parsing. The general form is similar to the cond ? exp1 :
exp2 ternary operator:</p>

<p style="margin-top: 1em">%( CONDITION %? TRUE-TOKENS %)
<br>
%( CONDITION %? TRUE-TOKENS %: FALSE-TOKENS %)</p>

<p style="margin-top: 1em">The CONDITION is either an
expression whose format is determined by its first keyword,
or a string literals comparison or a numeric literals
comparison. It can be also composed <br>
of many alternatives and conjunctions of CONDITIONs (meant
as in previous sentence) using || and &amp;&amp;
respectively. However, parentheses are not supported yet, so
remembering that <br>
conjunction takes precedence over alternative is
important.</p>

<p style="margin-top: 1em">If the first part is the
identifier kernel_vr or kernel_v to refer to the kernel
version number, with (&quot;2.6.13-1.322FC3smp&quot;) or
without (&quot;2.6.13&quot;) the release code suffix, then
<br>
the second part is one of the six standard numeric
comparison operators &lt;, &lt;=, ==, !=, &gt;, and &gt;=,
and the third part is a string literal that contains an
RPM-style version-re&acirc; <br>
lease value. The condition is deemed satisfied if the
version of the target kernel (as optionally overridden by
the -r option) compares to the given version string. The
compar&acirc; <br>
ison is performed by the glibc function strverscmp. As a
special case, if the operator is for simple equality (==),
or inequality (!=), and the third part contains any wildcard
<br>
characters (* or ? or [), then the expression is treated as
a wildcard (mis)match as evaluated by fnmatch.</p>

<p style="margin-top: 1em">If, on the other hand, the first
part is the identifier arch to refer to the processor
architecture (as named by the kernel build system
ARCH/SUBARCH), then the second part is <br>
one of the two string comparison operators == or !=, and the
third part is a string literal for matching it. This
comparison is a wildcard (mis)match.</p>

<p style="margin-top: 1em">Similarly, if the first part is
an identifier like CONFIG_something to refer to a kernel
configuration option, then the second part is == or !=, and
the third part is a string <br>
literal for matching the value (commonly &quot;y&quot; or
&quot;m&quot;). Nonexistent or unset kernel configuration
options are represented by the empty string. This comparison
is also a wildcard <br>
(mis)match.</p>

<p style="margin-top: 1em">If the first part is the
identifier systemtap_v, the test refers to the systemtap
compatibility version, which may be overridden for old
scripts with the --compatible flag. The <br>
comparison operator is as is for kernel_v and the right
operand is a version string. See also the DEPRECATION
section below.</p>

<p style="margin-top: 1em">If the first part is the
identifier systemtap_privilege, the test refers to the
privilege level that the systemtap script is compiled with.
Here the second part is == or !=, and <br>
the third part is a string literal, either
&quot;stapusr&quot; or &quot;stapsys&quot; or
&quot;stapdev&quot;.</p>

<p style="margin-top: 1em">If the first part is the
identifier guru_mode, the test refers to if the systemtap
script is compiled with guru_mode. Here the second part is
== or !=, and the third part is a <br>
number, either 1 or 0.</p>

<p style="margin-top: 1em">If the first part is the
identifier runtime, the test refers to the systemtap runtime
mode. See ALTERNATE RUNTIMES below for more information on
runtimes. The second part is one <br>
of the two string comparison operators == or !=, and the
third part is a string literal for matching it. This
comparison is a wildcard (mis)match.</p>

<p style="margin-top: 1em">Otherwise, the CONDITION is
expected to be a comparison between two string literals or
two numeric literals. In this case, the arguments are the
only variables usable.</p>

<p style="margin-top: 1em">The TRUE-TOKENS and FALSE-TOKENS
are zero or more general parser tokens (possibly including
nested preprocessor conditionals), and are passed into the
input stream if the condi&acirc; <br>
tion is true or false. For example, the following code
induces a parse error unless the target kernel version is
newer than 2.6.5:</p>

<p style="margin-top: 1em">%( kernel_v &lt;=
&quot;2.6.5&quot; %? **ERROR** %) # invalid token
sequence</p>

<p style="margin-top: 1em">The following code might adapt
to hypothetical kernel version drift:</p>

<p style="margin-top: 1em">probe kernel.function ( <br>
%( kernel_v &lt;= &quot;2.6.12&quot; %?
&quot;__mm_do_fault&quot; %: <br>
%( kernel_vr == &quot;2.6.13*smp&quot; %?
&quot;do_page_fault&quot; %: <br>
UNSUPPORTED %) %) <br>
) { /* ... */ }</p>

<p style="margin-top: 1em">%( arch == &quot;ia64&quot; %?
<br>
probe syscall.vliw =
kernel.function(&quot;vliw_widget&quot;) {} <br>
%)</p>

<p style="margin-top: 1em">PREPROCESSOR MACROS <br>
The preprocessor also supports a simple macro facility, run
as a separate pass before conditional preprocessing.</p>

<p style="margin-top: 1em">Macros are defined using the
following construct:</p>

<p style="margin-top: 1em">@define NAME %( BODY %) <br>
@define NAME(PARAM_1, PARAM_2, ...) %( BODY %)</p>

<p style="margin-top: 1em">Macros, and parameters inside a
macro body, are both invoked by prefixing the macro name
with an @ symbol:</p>

<p style="margin-top: 1em">@define foo %( x %) <br>
@define add(a,b) %( ((@a)+(@b)) %)</p>

<p style="margin-top: 1em">@foo = @add(2,2)</p>

<p style="margin-top: 1em">Macro expansion is currently
performed in a separate pass before conditional compilation.
Therefore, both TRUE- and FALSE-tokens in conditional
expressions will be macroexpanded <br>
regardless of how the condition is evaluated. This can
sometimes lead to errors:</p>

<p style="margin-top: 1em">// The following results in a
conflict: <br>
%( CONFIG_UTRACE == &quot;y&quot; %? <br>
@define foo %( process.syscall %) <br>
%: <br>
@define foo %( **ERROR** %) <br>
%)</p>

<p style="margin-top: 1em">// The following works properly
as expected: <br>
@define foo %( <br>
%( CONFIG_UTRACE == &quot;y&quot; %? process.syscall %:
**ERROR** %) <br>
%)</p>

<p style="margin-top: 1em">The first example is incorrect
because both @defines are evaluated in a pass prior to the
conditional being evaluated.</p>

<p style="margin-top: 1em">Normally, a macro definition is
local to the file it occurs in. Thus, defining a macro in a
tapset does not make it available to the user of the tapset.
Publically available li&acirc; <br>
brary macros can be defined by including .stpm files on the
tapset search path. These files may only contain @define
constructs, which become visible across all tapsets and user
<br>
scripts. Optionally, within the .stpm files, a public macro
definition can be surrounded by a preprocessor conditional
as described above.</p>

<p style="margin-top: 1em">VARIABLES <br>
Identifiers for variables and functions are an alphanumeric
sequence, and may include _ and $ characters. They may not
start with a plain digit, as in C. Each variable is by <br>
default local to the probe or function statement block
within which it is mentioned, and therefore its scope and
lifetime is limited to a particular probe or function
invocation.</p>

<p style="margin-top: 1em">Scalar variables are implicitly
typed as either string or integer. Associative arrays also
have a string or integer value, and a tuple of strings
and/or integers serving as a <br>
key. Here are a few basic expressions.</p>

<p style="margin-top: 1em">var1 = 5 <br>
var2 = &quot;bar&quot; <br>
array1 [pid()] = &quot;name&quot; # single numeric key <br>
array2 [&quot;foo&quot;,4,i++] += 5 # vector of
string/num/num keys <br>
if ([&quot;hello&quot;,5,4] in array2) println
(&quot;yes&quot;) # membership test</p>

<p style="margin-top: 1em">The translator performs type
inference on all identifiers, including array indexes and
function parameters. Inconsistent type-related use of
identifiers signals an error.</p>

<p style="margin-top: 1em">Variables may be declared
global, so that they are shared amongst all probes and
functions and live as long as the entire systemtap session.
There is one namespace for all glob&acirc; <br>
al variables, regardless of which script file they are found
within. Concurrent access to global variables is
automatically protected with locks, see the SAFETY AND
SECURITY <br>
section for more details. A global declaration may be
written at the outermost level anywhere, not within a block
of code. Global variables which are written but never read
<br>
will be displayed automatically at session shutdown. The
translator will infer for each its value type, and if it is
used as an array, its key types. Optionally, scalar globals
<br>
may be initialized with a string or number literal. The
following declaration marks variables as global.</p>

<p style="margin-top: 1em">global var1, var2, var3=4</p>

<p style="margin-top: 1em">Global variables can also be set
as module options. One can do this by either using the -G
option, or the module must first be compiled using stap -p4.
Global variables can then <br>
be set on the command line when calling staprun on the
module generated by stap -p4. See staprun(8) for more
information.</p>

<p style="margin-top: 1em">The scope of a global variable
may be limited to a tapset or user script file using private
keyword. The global keyword is optional when defining a
private global variable. Fol&acirc; <br>
lowing declaration marks var1 and var2 private globals.</p>

<p style="margin-top: 1em">private global var1=2 <br>
private var2</p>

<p style="margin-top: 1em">Arrays are limited in size by
the MAXMAPENTRIES variable -- see the SAFETY AND SECURITY
section for details. Optionally, global arrays may be
declared with a maximum size in <br>
brackets, overriding MAXMAPENTRIES for that array only. Note
that this doesn&rsquo;t indicate the type of keys for the
array, just the size.</p>

<p style="margin-top: 1em">global tiny_array[10],
normal_array, big_array[50000]</p>

<p style="margin-top: 1em">Arrays may be configured for
wrapping using the &rsquo;%&rsquo; suffix. This causes older
elements to be overwritten if more elements are inserted
than the array can hold. This works for <br>
both associative and statistics typed arrays.</p>

<p style="margin-top: 1em">global wrapped_array1%[10],
wrapped_array2%</p>

<p style="margin-top: 1em">Many types of probe points
provide context variables, which are run-time values, safely
extracted from the kernel or userspace program being probed.
These are prefixed with the <br>
$ character. The CONTEXT VARIABLES section in
stapprobes(3stap) lists what is available for each type of
probe point. These context variables become normal string or
numeric <br>
scalars once they are stored in normal script variables. See
the TYPECASTING section below on how to to turn them back
into typed pointers for further processing as context <br>
variables.</p>

<p style="margin-top: 1em">STATEMENTS <br>
Statements enable procedural control flow. They may occur
within functions and probe handlers. The total number of
statements executed in response to any single probe event is
<br>
limited to some number defined by the MAXACTION macro in the
translated C code, and is in the neighbourhood of 1000.</p>

<p style="margin-top: 1em">EXP Execute the string- or
integer-valued expression and throw away the value.</p>

<p style="margin-top: 1em">{ STMT1 STMT2 ... } <br>
Execute each statement in sequence in this block. Note that
separators or terminators are generally not necessary
between statements.</p>

<p style="margin-top: 1em">; Null statement, do nothing. It
is useful as an optional separator between statements to
improve syntax-error detection and to handle certain grammar
ambiguities.</p>

<p style="margin-top: 1em">if (EXP) STMT1 [ else STMT2 ]
<br>
Compare integer-valued EXP to zero. Execute the first
(non-zero) or second STMT (zero).</p>

<p style="margin-top: 1em">while (EXP) STMT <br>
While integer-valued EXP evaluates to non-zero, execute
STMT.</p>

<p style="margin-top: 1em">for (EXP1; EXP2; EXP3) STMT <br>
Execute EXP1 as initialization. While EXP2 is non-zero,
execute STMT, then the iteration expression EXP3.</p>

<p style="margin-top: 1em">foreach (VAR in ARRAY [ limit
EXP ]) STMT <br>
Loop over each element of the named global array, assigning
current key to VAR. The array may not be modified within the
statement. By adding a single + or - operator <br>
after the VAR or the ARRAY identifier, the iteration will
proceed in a sorted order, by ascending or descending index
or value. If the array contains statistics aggre&acirc; <br>
gates, adding the desired @operator between the ARRAY
identifier and the + or - will specify the sorting aggregate
function. See the STATISTICS section below for the ones <br>
available. Default is @count. Using the optional limit
keyword limits the number of loop iterations to EXP times.
EXP is evaluated once at the beginning of the loop.</p>

<p style="margin-top: 1em">foreach ([VAR1, VAR2, ...] in
ARRAY [ limit EXP ]) STMT <br>
Same as above, used when the array is indexed with a tuple
of keys. A sorting suffix may be used on at most one VAR or
ARRAY identifier.</p>

<p style="margin-top: 1em">foreach ([VAR1, VAR2, ...] in
ARRAY [INDEX1, INDEX2, ...] [ limit EXP ]) STMT <br>
Same as above, where iterations are limited to elements in
the array where the keys match the index values specified.
The symbol * can be used to specify an index and will <br>
be treated as a wildcard.</p>

<p style="margin-top: 1em">foreach (VAR0 = VAR in ARRAY [
limit EXP ]) STMT <br>
This variant of foreach saves current value into VAR0 on
each iteration, so it is the same as ARRAY[VAR]. This also
works with a tuple of keys. Sorting suffixes on VAR0 <br>
have the same effect as on ARRAY.</p>

<p style="margin-top: 1em">foreach (VAR0 = VAR in ARRAY
[INDEX1, INDEX2, ...] [ limit EXP ]) STMT <br>
Same as above, where iterations are limited to elements in
the array where the keys match the index values specified.
The symbol * can be used to specify an index and will <br>
be treated as a wildcard.</p>

<p style="margin-top: 1em">break, continue <br>
Exit or iterate the innermost nesting loop (while or for or
foreach) statement.</p>

<p style="margin-top: 1em">return EXP <br>
Return EXP value from enclosing function. If the
function&rsquo;s value is not taken anywhere, then a return
statement is not needed, and the function will have a
special &quot;un&acirc; <br>
known&quot; type with no return value.</p>

<p style="margin-top: 1em">next Return now from enclosing
probe handler. This is especially useful in probe aliases
that apply event filtering predicates. When used in
functions, the execution will be <br>
immediately transferred to the next overloaded function.</p>

<p style="margin-top: 1em">try { STMT1 } catch { STMT2 }
<br>
Run the statements in the first block. Upon any run-time
errors, abort STMT1 and start executing STMT2. Any errors in
STMT2 will propagate to outer try/catch blocks, if <br>
any.</p>

<p style="margin-top: 1em">try { STMT1 } catch(VAR) { STMT2
} <br>
Same as above, plus assign the error message to the string
scalar variable VAR.</p>

<p style="margin-top: 1em">delete ARRAY[INDEX1, INDEX2,
...] <br>
Remove from ARRAY the element specified by the index tuple.
If the index tuple contains a * in place of an index, the *
is treated as a wildcard and all elements with <br>
keys that match the index tuple will be removed from ARRAY.
The value will no longer be available, and subsequent
iterations will not report the element. It is not an <br>
error to delete an element that does not exist.</p>

<p style="margin-top: 1em">delete ARRAY <br>
Remove all elements from ARRAY.</p>

<p style="margin-top: 1em">delete SCALAR <br>
Removes the value of SCALAR. Integers and strings are
cleared to 0 and &quot;&quot; respectively, while statistics
are reset to the initial empty state.</p>

<p style="margin-top: 1em">EXPRESSIONS <br>
Systemtap supports a number of operators that have the same
general syntax, semantics, and precedence as in C and awk.
Arithmetic is performed as per typical C rules for signed
<br>
integers. Division by zero or overflow is detected and
results in an error.</p>

<p style="margin-top: 1em">binary numeric operators <br>
* / % + - &gt;&gt; &lt;&lt; &amp; ^ | &amp;&amp; ||</p>

<p style="margin-top: 1em">binary string operators <br>
. (string concatenation)</p>

<p style="margin-top: 1em">numeric assignment operators
<br>
= *= /= %= += -= &gt;&gt;= &lt;&lt;= &amp;= ^= |=</p>

<p style="margin-top: 1em">string assignment operators <br>
= .=</p>

<p style="margin-top: 1em">unary numeric operators <br>
+ - ! ~ ++ --</p>

<p style="margin-top: 1em">binary numeric, string
comparison or regex matching operators <br>
&lt; &gt; &lt;= &gt;= == != =~ !~</p>

<p style="margin-top: 1em">ternary operator <br>
cond ? exp1 : exp2</p>

<p style="margin-top: 1em">grouping operator <br>
( exp )</p>

<p style="margin-top: 1em">function call <br>
fn ([ arg1, arg2, ... ])</p>

<p style="margin-top: 1em">array membership check <br>
exp in array <br>
[exp1, exp2, ...] in array <br>
[*, *, ... ]in array</p>

<p style="margin-top: 1em">REGULAR EXPRESSION MATCHING <br>
The scripting language supports regular expression matching.
The basic syntax is as follows:</p>

<p style="margin-top: 1em">exp =~ regex <br>
exp !~ regex</p>

<p style="margin-top: 1em">(The first operand must be an
expression evaluating to a string; the second operand must
be a string literal containing a syntactically valid regular
expression.)</p>

<p style="margin-top: 1em">The regular expression syntax
supports most of the features of POSIX Extended Regular
Expressions, except for subexpression reuse (&quot;1&quot;)
functionality. The ability to capture and <br>
extract the contents of the matched string and
subexpressions has not yet been implemented.</p>

<p style="margin-top: 1em">PROBES <br>
The main construct in the scripting language identifies
probes. Probes associate abstract events with a statement
block (&quot;probe handler&quot;) that is to be executed
when any of <br>
those events occur. The general syntax is as follows:</p>

<p style="margin-top: 1em">probe PROBEPOINT [, PROBEPOINT]
{ [STMT ...] } <br>
probe PROBEPOINT [, PROBEPOINT] if (CONDITION) { [STMT ...]
}</p>

<p style="margin-top: 1em">Events are specified in a
special syntax called &quot;probe points&quot;. There are
several varieties of probe points defined by the translator,
and tapset scripts may define further ones <br>
using aliases. Probe points may be wildcarded, grouped, or
listed in preference sequences, or declared optional. More
details on probe point syntax and semantics are listed on
<br>
the stapprobes(3stap) manual page.</p>

<p style="margin-top: 1em">The probe handler is interpreted
relative to the context of each event. For events associated
with kernel code, this context may include variables defined
in the source code at <br>
that spot. These &quot;context variables&quot; are presented
to the script as variables whose names are prefixed with
&quot;$&quot;. They may be accessed only if the
kernel&rsquo;s compiler preserved <br>
them despite optimization. This is the same constraint that
a debugger user faces when working with optimized code. In
addition, the objects must exist in paged-in memory at <br>
the moment of the systemtap probe handler&rsquo;s execution,
because systemtap must not cause (suppresses) any additional
paging. Some probe types have very little context. See the
<br>
stapprobes(3stap) man pages to see the kinds of context
variables available at each kind of probe point.</p>

<p style="margin-top: 1em">Probes may be decorated with an
arming condition, consisting of a simple boolean expression
on read-only global script variables. While disarmed
(inactive, condition evaluates <br>
to false), some probe types reduce or eliminate their
run-time overheads. When an arming condition evaluates to
true, probes will be soon re-armed, and their probe handlers
will <br>
start getting called as the events fire. (Some events may be
lost during the arming interval. If this is unacceptable, do
not use arming conditions for those probes.) Example <br>
of the syntax:</p>

<p style="margin-top: 1em">probe timer.us(TIMER) if
(enabled) { <br>
}</p>

<p style="margin-top: 1em">New probe points may be defined
using &quot;aliases&quot;. Probe point aliases look similar
to probe definitions, but instead of activating a probe at
the given point, it just defines a <br>
new probe point name as an alias to an existing one. There
are two types of alias, i.e. the prologue style and the
epilogue style which are identified by &quot;=&quot; and
&quot;+=&quot; respective&acirc; <br>
ly.</p>

<p style="margin-top: 1em">For prologue style alias, the
statement block that follows an alias definition is
implicitly added as a prologue to any probe that refers to
the alias. While for the epilogue <br>
style alias, the statement block that follows an alias
definition is implicitly added as an epilogue to any probe
that refers to the alias. For example:</p>

<p style="margin-top: 1em">probe syscall.read =
kernel.function(&quot;sys_read&quot;) { <br>
fildes = $fd <br>
if (execname() == &quot;init&quot;) next # skip rest of
probe <br>
}</p>

<p style="margin-top: 1em">defines a new probe point
syscall.read, which expands to
kernel.function(&quot;sys_read&quot;), with the given
statement as a prologue, which is useful to predefine some
variables for the <br>
alias user and/or to skip probe processing entirely based on
some conditions. And</p>

<p style="margin-top: 1em">probe syscall.read +=
kernel.function(&quot;sys_read&quot;) { <br>
if (tracethis) println ($fd) <br>
}</p>

<p style="margin-top: 1em">defines a new probe point with
the given statement as an epilogue, which is useful to take
actions based upon variables set or left over by the the
alias user. Please note that <br>
in each case, the statements in the alias handler block are
treated ordinarily, so that variables assigned there
constitute mere initialization, not a macro
substitution.</p>

<p style="margin-top: 1em">An alias is used just like a
built-in probe type.</p>

<p style="margin-top: 1em">probe syscall.read { <br>
printf(&quot;reading fd=%d0, fildes) <br>
if (fildes &gt; 10) tracethis = 1 <br>
}</p>

<p style="margin-top: 1em">FUNCTIONS <br>
Systemtap scripts may define subroutines to factor out
common work. Functions take any number of scalar (integer or
string) arguments, and must return a single scalar (integer
<br>
or string). An example function declaration looks like
this:</p>

<p style="margin-top: 1em">function thisfn (arg1, arg2) {
<br>
return arg1 + arg2 <br>
}</p>

<p style="margin-top: 1em">Note the general absence of type
declarations, which are instead inferred by the translator.
However, if desired, a function definition may include
explicit type declarations <br>
for its return value and/or its arguments. This is
especially helpful for embedded-C functions. In the
following example, the type inference engine need only infer
type type of <br>
arg2 (a string).</p>

<p style="margin-top: 1em">function thatfn:string
(arg1:long, arg2) { <br>
return sprint(arg1) . arg2 <br>
}</p>

<p style="margin-top: 1em">Functions may call others or
themselves recursively, up to a fixed nesting limit. This
limit is defined by the MAXNESTING macro in the translated C
code and is in the neighbour&acirc; <br>
hood of 10.</p>

<p style="margin-top: 1em">Functions may be marked private
using the private keyword to limit their scope to the tapset
or user script file they are defined in. An example
definition of a private function <br>
follows:</p>

<p style="margin-top: 1em">private function three:long () {
return 3 }</p>

<p style="margin-top: 1em">Functions terminating without
reaching an explicit return statement will return an
implicit 0 or &quot;&quot;, determined by type
inference.</p>

<p style="margin-top: 1em">Functions may be overloaded
during both runtime and compile time.</p>

<p style="margin-top: 1em">Runtime overloading allows the
executed function to be selected while the module is running
based on runtime conditions and is achieved using the
&quot;next&quot; statement in script func&acirc; <br>
tions and STAP_NEXT macro for embedded-C functions. For
example,</p>

<p style="margin-top: 1em">function f() { if (condition)
next; print(&quot;first function&quot;) } <br>
function f() %{ STAP_NEXT; print(&quot;second
function&quot;) %} <br>
function f() { print(&quot;third function&quot;) }</p>

<p style="margin-top: 1em">During a functioncall f(), the
execution will transfer to the third function if condition
evaluates to true and print &quot;third function&quot;. Note
that the second function is uncondi&acirc; <br>
tionally nexted.</p>

<p style="margin-top: 1em">Parameter overloading allows the
function to be executed to be selected at compile time based
on the number of arguments provided to the functioncall. For
example,</p>

<p style="margin-top: 1em">function g() { print(&quot;first
function&quot;) } <br>
function g(x) { print(&quot;second function&quot;) } <br>
g() -&gt; &quot;first function&quot; <br>
g(1) -&gt; &quot;second function&quot;</p>

<p style="margin-top: 1em">Note that runtime overloading
does not occur in the above example, as exactly one function
will be resolved for the functioncall. The use of a next
statement inside a function <br>
while no more overloads remain will trigger a runtime
exception Runtime overloading will only occur if the
functions have the same arity, functions with the same name
but differ&acirc; <br>
ent number of parameters are completely unrelated.</p>

<p style="margin-top: 1em">Execution order is determined by
a priority value which may be specified. If no explicit
priority is specified, user script functions are given a
higher priority than library <br>
functions. User script functions and library functions are
assigned a default priority value of 0 and 1 respectively.
Functions with the same priority are executed in
declara&acirc; <br>
tion order. For example,</p>

<p style="margin-top: 1em">function f():3 { if (condition)
next; print(&quot;first function&quot;) } <br>
function f():1 { if (condition) next; print(&quot;second
function&quot;) } <br>
function f():2 { print(&quot;third function&quot;) }</p>

<p style="margin-top: 1em">Since the second function has
highest priority, it is executed first. The first function
is never executed as there no &quot;next&quot; statements in
the third function to transfer execu&acirc; <br>
tion.</p>

<p style="margin-top: 1em">PRINTING <br>
There are a set of function names that are specially treated
by the translator. They format values for printing to the
standard systemtap output stream in a more convenient way
<br>
(note that data generated in the kernel module need to get
transferred to user-space in order to get printed).</p>

<p style="margin-top: 1em">The sprint* variants return the
formatted string instead of printing it.</p>

<p style="margin-top: 1em">print, sprint <br>
Print one or more values of any type, concatenated directly
together.</p>

<p style="margin-top: 1em">println, sprintln <br>
Print values like print and sprint, but also append a
newline.</p>

<p style="margin-top: 1em">printd, sprintd <br>
Take a string delimiter and two or more values of any type,
and print the values with the delimiter interposed. The
delimiter must be a literal string constant.</p>

<p style="margin-top: 1em">printdln, sprintdln <br>
Print values with a delimiter like printd and sprintd, but
also append a newline.</p>

<p style="margin-top: 1em">printf, sprintf <br>
Take a formatting string and a number of values of
corresponding types, and print them all. The format must be
a literal string constant.</p>

<p style="margin-top: 1em">The printf formatting directives
similar to those of C, except that they are fully
type-checked by the translator:</p>

<p style="margin-top: 1em">%b Writes a binary blob of the
value given, instead of ASCII text. The width specifier
determines the number of bytes to write; valid specifiers
are %b %1b %2b %4b <br>
%8b. Default (%b) is 8 bytes.</p>

<p style="margin-top: 1em">%c Character.</p>

<p style="margin-top: 1em">%d,%i Signed decimal.</p>

<p style="margin-top: 1em">%m Safely reads kernel memory at
the given address, outputs its content. The optional
precision specifier (not field width) determines the number
of bytes to read - <br>
default is 1 byte. %10.4m prints 4 bytes of the memory in a
10-character-wide field.</p>

<p style="margin-top: 1em">%M Same as %m, but outputs in
hexadecimal. The minimal size of output is double the
optional precision specifier - default is 1 byte (2 hex
chars). %10.4M prints 4 <br>
bytes of the memory as 8 hexadecimal characters in a
10-character-wide field. %.*M hex-dumps a given number of
bytes from a given buffer.</p>

<p style="margin-top: 1em">%o Unsigned octal.</p>

<p style="margin-top: 1em">%p Unsigned pointer address.</p>

<p style="margin-top: 1em">%s String.</p>

<p style="margin-top: 1em">%u Unsigned decimal.</p>

<p style="margin-top: 1em">%x Unsigned hex value, in all
lower-case.</p>

<p style="margin-top: 1em">%X Unsigned hex value, in all
upper-case.</p>

<p style="margin-top: 1em">%% Writes a %.</p>

<p style="margin-top: 1em">The # flag selects the alternate
forms. For octal, this prefixes a 0. For hex, this prefixes
0x or 0X, depending on case. For characters, this escapes
non-printing values with <br>
either C-like escapes or raw octal.</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">a = &quot;alice&quot;, b =
&quot;bob&quot;, p = 0x1234abcd, i = 123, j = -1, id[a] =
1234, id[b] = 4567 <br>
print(&quot;hello&quot;) <br>
Prints: hello <br>
println(b) <br>
Prints: bob <br>
println(a . &quot; is &quot; . sprint(16)) <br>
Prints: alice is 16 <br>
foreach (name in id) printdln(&quot;|&quot;, strlen(name),
name, id[name]) <br>
Prints: 5|alice|12340|bob|4567 <br>
printf(&quot;%c is %s; %x or %X or %p; %d or
%u0,97,a,p,p,p,j,j) <br>
Prints: a is alice; 1234abcd or 1234ABCD or 0x1234abcd; -1
or 18446744073709551615 <br>
printf(&quot;2 bytes of kernel buffer at address %p:
%2m&quot;, p, p) <br>
Prints: 2 byte of kernel buffer at address 0x1234abcd:
&lt;binary data&gt; <br>
printf(&quot;%4b&quot;, p) <br>
Prints (these values as binary data): 0x1234abcd <br>
printf(&quot;%#o %#x %#X0, 1, 2, 3) <br>
Prints: 01 0x2 0X3 <br>
printf(&quot;%#c %#c %#c0, 0, 9, 42) <br>
Prints: 00 *</p>

<p style="margin-top: 1em">STATISTICS <br>
It is often desirable to collect statistics in a way that
avoids the penalties of repeatedly exclusive locking the
global variables those numbers are being put into. Systemtap
<br>
provides a solution using a special operator to accumulate
values, and several pseudo-functions to extract the
statistical aggregates.</p>

<p style="margin-top: 1em">The aggregation operator is
&lt;&lt;&lt;, and resembles an assignment, or a C++
output-streaming operation. The left operand specifies a
scalar or array-index lvalue, which must be de&acirc; <br>
clared global. The right operand is a numeric expression.
The meaning is intuitive: add the given number to the pile
of numbers to compute statistics of. (The specific list of
<br>
statistics to gather is given separately, by the extraction
functions.)</p>

<p style="margin-top: 1em">foo &lt;&lt;&lt; 1 <br>
stats[pid()] &lt;&lt;&lt; memsize</p>

<p style="margin-top: 1em">The extraction functions are
also special. For each appearance of a distinct extraction
function operating on a given identifier, the translator
arranges to compute a set of <br>
statistics that satisfy it. The statistics system is thereby
&quot;on-demand&quot;. Each execution of an extraction
function causes the aggregation to be computed for that
moment across <br>
all processors.</p>

<p style="margin-top: 1em">Here is the set of extractor
functions. The first argument of each is the same style of
lvalue used on the left hand side of the accumulate
operation. The @count(v), @sum(v), <br>
@min(v), @max(v), @avg(v) extractor functions compute the
number/total/minimum/maximum/average of all accumulated
values. The resulting values are all simple integers. Arrays
<br>
containing aggregates may be sorted and iterated. See the
foreach construct above.</p>

<p style="margin-top: 1em">Histograms are also available,
but are more complicated because they have a vector rather
than scalar value. @hist_linear(v,start,stop,interval)
represents a linear histogram <br>
from &quot;start&quot; to &quot;stop&quot; by increments of
&quot;interval&quot;. The interval must be positive.
Similarly, @hist_log(v) represents a base-2 logarithmic
histogram. Printing a histogram with <br>
the print family of functions renders a histogram object as
a tabular &quot;ASCII art&quot; bar chart.</p>

<p style="margin-top: 1em">probe timer.profile { <br>
x[1] &lt;&lt;&lt; pid() <br>
x[2] &lt;&lt;&lt; uid() <br>
y &lt;&lt;&lt; tid() <br>
} <br>
global x // an array containing aggregates <br>
global y // a scalar <br>
probe end { <br>
foreach ([i] in x @count+) { <br>
printf (&quot;x[%d]: avg %d = sum %d / count %d0, <br>
i, @avg(x[i]), @sum(x[i]), @count(x[i])) <br>
println (@hist_log(x[i])) <br>
} <br>
println (&quot;y:&quot;) <br>
println (@hist_log(y)) <br>
}</p>

<p style="margin-top: 1em">TYPECASTING <br>
Once a pointer (see the CONTEXT VARIABLES section of
stapprobes(3stap)) has been saved into a script integer
variable, the translator loses the type information
necessary to ac&acirc; <br>
cess members from that pointer. Using the @cast() operator
tells the translator how to interpret the number as a typed
pointer.</p>

<p style="margin-top: 1em">@cast(p, &quot;type_name&quot;[,
&quot;module&quot;])-&gt;member</p>

<p style="margin-top: 1em">This will interpret p as a
pointer to a struct/union named type_name and dereference
the member value. Further -&gt;subfield expressions may be
appended to dereference more levels. <br>
NOTE: the same dereferencing operator -&gt; is used to refer
to both direct containment or pointer indirection. Systemtap
automatically determines which. The optional module <br>
tells the translator where to look for information about
that type. Multiple modules may be specified as a list with
: separators. If the module is not specified, it will
de&acirc; <br>
fault either to the probe module for dwarf probes, or to
&quot;kernel&quot; for functions and all other probes
types.</p>

<p style="margin-top: 1em">The translator can create its
own module with type information from a header surrounded by
angle brackets, in case normal debuginfo is not available.
For kernel headers, prefix <br>
it with &quot;kernel&quot; to use the appropriate build
system. All other headers are built with default GCC
parameters into a user module. Multiple headers may be
specified in sequence <br>
to resolve a codependency.</p>

<p style="margin-top: 1em">@cast(tv, &quot;timeval&quot;,
&quot;&lt;sys/time.h&gt;&quot;)-&gt;tv_sec <br>
@cast(task, &quot;task_struct&quot;,
&quot;kernel&lt;linux/sched.h&gt;&quot;)-&gt;tgid <br>
@cast(task, &quot;task_struct&quot;, <br>

&quot;kernel&lt;linux/sched.h&gt;&lt;linux/fs_struct.h&gt;&quot;)-&gt;fs-&gt;umask</p>

<p style="margin-top: 1em">Values acquired by @cast may be
pretty-printed by the $ and $$ suffix operators, the same
way as described in the CONTEXT VARIABLES section of the
stapprobes(3stap) manual page.</p>

<p style="margin-top: 1em">When in guru mode, the
translator will also allow scripts to assign new values to
members of typecasted pointers.</p>

<p style="margin-top: 1em">Typecasting is also useful in
the case of void* members whose type may be determinable at
runtime.</p>

<p style="margin-top: 1em">probe foo { <br>
if ($var-&gt;type == 1) { <br>
value = @cast($var-&gt;data, &quot;type1&quot;)-&gt;bar <br>
} else { <br>
value = @cast($var-&gt;data, &quot;type2&quot;)-&gt;baz <br>
} <br>
print(value) <br>
}</p>

<p style="margin-top: 1em">EMBEDDED C <br>
When in guru mode, the translator accepts embedded C code in
the top level of the script. Such code is enclosed between
%{ and %} markers, and is transcribed verbatim, without <br>
analysis, in some sequence, into the top level of the
generated C code. At the outermost level, this may be useful
to add #include instructions, and any auxiliary definitions
<br>
for use by other embedded code.</p>

<p style="margin-top: 1em">Another place where embedded
code is permitted is as a function body. In this case, the
script language body is replaced entirely by a piece of C
code enclosed again between %{ <br>
and %} markers. This C code may do anything reasonable and
safe. There are a number of undocumented but complex safety
constraints on atomicity, concurrency, resource
consump&acirc; <br>
tion, and run time limits, so this is an advanced
technique.</p>

<p style="margin-top: 1em">The memory locations set aside
for input and output values are made available to it using
macros STAP_ARG_* and STAP_RETVALUE. Errors may be signalled
with STAP_ERROR. Output <br>
may be written with STAP_PRINTF. The function may return
early with STAP_RETURN. Here are some examples:</p>

<p style="margin-top: 1em">function integer_ops (val) %{
<br>
STAP_PRINTF(&quot;%d0, STAP_ARG_val); <br>
STAP_RETVALUE = STAP_ARG_val + 1; <br>
if (STAP_RETVALUE == 4) <br>
STAP_ERROR(&quot;wrong guess: %d&quot;, (int)
STAP_RETVALUE); <br>
if (STAP_RETVALUE == 3) <br>
STAP_RETURN(0); <br>
STAP_RETVALUE ++; <br>
%} <br>
function string_ops (val) %{ <br>
strlcpy (STAP_RETVALUE, STAP_ARG_val, MAXSTRINGLEN); <br>
strlcat (STAP_RETVALUE, &quot;one&quot;, MAXSTRINGLEN); <br>
if (strcmp (STAP_RETVALUE, &quot;three-two-one&quot;)) <br>
STAP_RETURN(&quot;parameter should be three-two-&quot;);
<br>
%} <br>
function no_ops () %{ <br>
STAP_RETURN(); /* function inferred with no return value */
<br>
%}</p>

<p style="margin-top: 1em">The function argument and return
value types have to be inferred by the translator from the
call sites in order for this to work. The user should
examine C code generated for or&acirc; <br>
dinary script-language functions in order to write
compatible embedded-C ones.</p>

<p style="margin-top: 1em">The last place where embedded
code is permitted is as an expression rvalue. In this case,
the C code enclosed between %{ and %} markers is interpreted
as an ordinary expression <br>
value. It is assumed to be a normal 64-bit signed number,
unless the marker /* string */ is included, in which case
it&rsquo;s treated as a string.</p>

<p style="margin-top: 1em">function add_one (val) { <br>
return val + %{ 1 %} <br>
} <br>
function add_string_two (val) { <br>
return val . %{ /* string */ &quot;two&quot; %} <br>
}</p>

<p style="margin-top: 1em">The embedded-C code may contain
markers to assert optimization and safety properties.</p>

<p style="margin-top: 1em">/* pure */ <br>
means that the C code has no side effects and may be elided
entirely if its value is not used by script code.</p>

<p style="margin-top: 1em">/* stable */ <br>
means that the C code always has the same value (in any
given probe handler invocation), so repeated calls may be
automatically replaced by memoized values. Such func&acirc;
<br>
tions must take no parameters, and also be pure.</p>

<p style="margin-top: 1em">/* unprivileged */ <br>
means that the C code is so safe that even unprivileged
users are permitted to use it.</p>

<p style="margin-top: 1em">/* myproc-unprivileged */ <br>
means that the C code is so safe that even unprivileged
users are permitted to use it, provided that the target of
the current probe is within the user&rsquo;s own
process.</p>

<p style="margin-top: 1em">/* guru */ <br>
means that the C code is so unsafe that a systemtap user
must specify -g (guru mode) to use this.</p>

<p style="margin-top: 1em">/* unmangled */ <br>
in an embedded-C function, means that the legacy (pre-1.8)
argument access syntax should be made available inside the
function. Hence, in addition to STAP_ARG_foo and <br>
STAP_RETVALUE one can use THIS-&gt;foo and
THIS-&gt;__retvalue respectively inside the function. This
is useful for quickly migrating code written for SystemTap
version 1.7 and <br>
earlier.</p>

<p style="margin-top: 1em">/* unmodified-fnargs */ <br>
in an embedded-C function, means that the function arguments
are not modified inside the function body.</p>

<p style="margin-top: 1em">/* string */ <br>
in embedded-C expressions only, means that the expression
has const char * type and should be treated as a string
value, instead of the default long numeric.</p>

<p style="margin-top: 1em">Script level global variables
may be accessed in embedded-C functions and blocks. To read
or write the global variable var , the /* pragma:read:var */
or /* pragma:write:var */ <br>
marker must be first placed in the embedded-C function or
block. This provides the macros STAP_GLOBAL_GET_* and
STAP_GLOBAL_SET_* macros to allow reading and writing,
respective&acirc; <br>
ly. For example:</p>

<p style="margin-top: 1em">global var <br>
global var2[100] <br>
function increment() %{ <br>
/* pragma:read:var */ /* pragma:write:var */ <br>
/* pragma:read:var2 */ /* pragma:write:var2 */ <br>
STAP_GLOBAL_SET_var(STAP_GLOBAL_GET_var()+1); //var++ <br>
STAP_GLOBAL_SET_var2(1, 1, STAP_GLOBAL_GET_var2(1, 1)+1);
//var2[1,1]++ <br>
%}</p>

<p style="margin-top: 1em">Variables may be read and set in
both embedded-C functions and expressions. Strings returned
from embedded-C code are decayed to pointers. Variables must
also be assigned at <br>
script level to allow for type inference. Map assignment
does not return the value written, so chaining does not
work.</p>

<p style="margin-top: 1em">BUILT-INS <br>
A set of builtin probe point aliases are provided by the
scripts installed in the directory specified in the
stappaths(7) manual page. The functions are described in the
stap&acirc; <br>
probes(3stap) manual page.</p>

<p style="margin-top: 1em">PROCESSING <br>
The translator begins pass 1 by parsing the given input
script, and all scripts (files named *.stp) found in a
tapset directory. The directories listed with -I are
processed in <br>
sequence, each processed in &quot;guru mode&quot;. For each
directory, a number of subdirectories are also searched.
These subdirectories are derived from the selected kernel
version <br>
(the -R option), in order to allow more
kernel-version-specific scripts to override less specific
ones. For example, for a kernel version 2.6.12-23.FC3 the
following patterns <br>
would be searched, in sequence: 2.6.12-23.FC3/*.stp,
2.6.12/*.stp, 2.6/*.stp, and finally *.stp. Stopping the
translator after pass 1 causes it to print the parse
trees.</p>

<p style="margin-top: 1em">In pass 2, the translator
analyzes the input script to resolve symbols and types.
References to variables, functions, and probe aliases that
are unresolved internally are satis&acirc; <br>
fied by searching through the parsed tapset script files. If
any tapset script file is selected because it defines an
unresolved symbol, then the entirety of that file is added
<br>
to the translator&rsquo;s resolution queue. This process
iterates until all symbols are resolved and a subset of
tapset script files is selected.</p>

<p style="margin-top: 1em">Next, all probe point
descriptions are validated against the wide variety
supported by the translator. Probe points that refer to code
locations (&quot;synchronous probe points&quot;) re&acirc;
<br>
quire the appropriate kernel debugging information to be
installed. In the associated probe handlers, target-side
variables (whose names begin with &quot;$&quot;) are found
and have their <br>
run-time locations decoded.</p>

<p style="margin-top: 1em">Next, all probes and functions
are analyzed for optimization opportunities, in order to
remove variables, expressions, and functions that have no
useful value and no side-effect. <br>
Embedded-C functions are assumed to have side-effects unless
they include the magic string /* pure */. Since this
optimization can hide latent code errors such as type
mismatch&acirc; <br>
es or invalid $context variables, it sometimes may be useful
to disable the optimizations with the -u option.</p>

<p style="margin-top: 1em">Finally, all variable, function,
parameter, array, and index types are inferred from context
(literals and operators). Stopping the translator after pass
2 causes it to list all <br>
the probes, functions, and variables, along with all
inferred types. Any inconsistent or unresolved types cause
an error.</p>

<p style="margin-top: 1em">In pass 3, the translator writes
C code that represents the actions of all selected script
files, and creates a Makefile to build that into a kernel
object. These files are <br>
placed into a temporary directory. Stopping the translator
at this point causes it to print the contents of the C
file.</p>

<p style="margin-top: 1em">In pass 4, the translator
invokes the Linux kernel build system to create the actual
kernel object file. This involves running make in the
temporary directory, and requires a <br>
kernel module build system (headers, config and Makefiles)
to be installed in the usual spot
/lib/modules/VERSION/build. Stopping the translator after
pass 4 is the last chance <br>
before running the kernel object. This may be useful if you
want to archive the file.</p>

<p style="margin-top: 1em">In pass 5, the translator
invokes the systemtap auxiliary program staprun program for
the given kernel object. This program arranges to load the
module then communicates with <br>
it, copying trace data from the kernel into temporary files,
until the user sends an interrupt signal. Any run-time error
encountered by the probe handlers, such as running out <br>
of memory, division by zero, exceeding nesting or runtime
limits, results in a soft error indication. Soft errors in
excess of MAXERRORS block of all subsequent probes (except
<br>
error-handling probes), and terminate the session. Finally,
staprun unloads the module, and cleans up.</p>

<p style="margin-top: 1em">ABNORMAL TERMINATION <br>
One should avoid killing the stap process forcibly, for
example with SIGKILL, because the stapio process (a child
process of the stap process) and the loaded module may be
left <br>
running on the system. If this happens, send SIGTERM or
SIGINT to any remaining stapio processes, then use rmmod to
unload the systemtap module.</p>

<p style="margin-top: 1em">EXAMPLES <br>
See the stapex(3stap) manual page for a brief collection of
samples, or a large set of installed samples under the
systemtap documentation/testsuite directories. See
stap&acirc; <br>
paths(7stap) for the likely location of these on the
system.</p>

<p style="margin-top: 1em">CACHING <br>
The systemtap translator caches the pass 3 output (the
generated C code) and the pass 4 output (the compiled kernel
module) if pass 4 completes successfully. This cached output
<br>
is reused if the same script is translated again assuming
the same conditions exist (same kernel version, same
systemtap version, etc.). Cached files are stored in the
$SYSTEM&acirc; <br>
TAP_DIR/cache directory. The cache can be limited by having
the file cache_mb_limit placed in the cache directory (shown
above) containing only an ASCII integer representing how
<br>
many MiB the cache should not exceed. In the absence of this
file, a default will be created with the limit set to
256MiB. This is a &rsquo;soft&rsquo; limit in that the cache
will be <br>
cleaned after a new entry is added if the cache clean
interval is exceeded, so the total cache size may
temporarily exceed this limit. This interval can be
specified by having <br>
the file cache_clean_interval_s placed in the cache
directory (shown above) containing only an ASCII integer
representing the interval in seconds. In the absence of this
file, a <br>
default will be created with the interval set to 300 s.</p>

<p style="margin-top: 1em">SAFETY AND SECURITY <br>
Systemtap may be used as a powerful administrative tool. It
can expose kernel internal data structures and potentially
private user information. (In dyninst runtime mode, this
<br>
is not the case, see the ALTERNATE RUNTIMES section
below.)</p>

<p style="margin-top: 1em">The translator asserts many
safety constraints during compilation and more during
run-time. It aims to ensure that no handler routine can run
for very long, allocate boundless <br>
memory, perform unsafe operations, or in unintentionally
interfere with the system. Uses of script global variables
are automatically read/write locked as appropriate, to
pro&acirc; <br>
tect against manipulation by concurrent probe handlers.
(Deadlocks are detected with timeouts. Use the -t flag to
receive reports of excessive lock contention.) Experimenting
<br>
with scripts is therefore generally safe. The guru-mode -g
option allows administrators to bypass most safety measures,
which permits invasive or state-changing operations,
em&acirc; <br>
bedded-C code, and increases the risk of upset. By default,
overload prevention is turned on for all modules. If you
would like to disable overload processing, use the
--sup&acirc; <br>
press-time-limits option.</p>

<p style="margin-top: 1em">Errors that are caught at run
time normally result in a clean script shutdown and a pass-5
error message. The --suppress-handler-errors option lets
scripts tolerate soft errors <br>
without shutting down.</p>

<p style="margin-top: 1em">PERMISSIONS <br>
For the normal linux-kernel-module runtime, to run the
kernel objects systemtap builds, a user must be one of the
following:</p>

<p style="margin-top: 1em">&Acirc;&middot; the root
user;</p>

<p style="margin-top: 1em">&Acirc;&middot; a member of the
stapdev and stapusr groups;</p>

<p style="margin-top: 1em">&Acirc;&middot; a member of the
stapsys and stapusr groups; or</p>

<p style="margin-top: 1em">&Acirc;&middot; a member of the
stapusr group.</p>

<p style="margin-top: 1em">The root user or a user who is a
member of both the stapdev and stapusr groups can build and
run any systemtap script.</p>

<p style="margin-top: 1em">A user who is a member of both
the stapsys and stapusr groups can only use pre-built
modules under the following conditions:</p>

<p style="margin-top: 1em">&Acirc;&middot; The module has
been signed by a trusted signer. Trusted signers are
normally systemtap compile-servers which sign modules when
the --privilege option is specified by the <br>
client. See the stap-server(8) manual page for more
information.</p>

<p style="margin-top: 1em">&Acirc;&middot; The module was
built using the --privilege=stapsys or the
--privilege=stapusr options.</p>

<p style="margin-top: 1em">Members of only the stapusr
group can only use pre-built modules under the following
conditions:</p>

<p style="margin-top: 1em">&Acirc;&middot; The module is
located in the /lib/modules/VERSION/systemtap directory.
This directory must be owned by root and not be world
writable.</p>

<p style="margin-top: 1em">or</p>

<p style="margin-top: 1em">&Acirc;&middot; The module has
been signed by a trusted signer. Trusted signers are
normally systemtap compile-servers which sign modules when
the --privilege option is specified by the <br>
client. See the stap-server(8) manual page for more
information.</p>

<p style="margin-top: 1em">&Acirc;&middot; The module was
built using the --privilege=stapusr option.</p>

<p style="margin-top: 1em">The kernel modules generated by
stap program are run by the staprun program. The latter is a
part of the Systemtap package, dedicated to module loading
and unloading (but only <br>
in the white zone), and kernel-to-user data transfer. Since
staprun does not perform any additional security checks on
the kernel objects it is given, it would be unwise for a
<br>
system administrator to add untrusted users to the stapdev
or stapusr groups.</p>

<p style="margin-top: 1em">SECUREBOOT <br>
If the current system has SecureBoot turned on in the UEFI
firmware, all kernel modules must be signed. (Some kernels
may allow disabling SecureBoot long after booting with a
<br>
key sequence such as SysRq-X, making it unnecessary to sign
modules.) The systemtap compile server can sign modules with
a MOK (Machine Owner Key) that it has in common with a <br>
client system. See the following wiki page for more
details:</p>


<p style="margin-top: 1em">https://sourceware.org/systemtap/wiki/SecureBoot</p>

<p style="margin-top: 1em">RESOURCE LIMITS <br>
Many resource use limits are set by macros in the generated
C code. These may be overridden with -D flags. A selection
of these is as follows:</p>

<p style="margin-top: 1em">MAXNESTING <br>
Maximum number of nested function calls. Default determined
by script analysis, with a bonus 10 slots added for
recursive scripts.</p>

<p style="margin-top: 1em">MAXSTRINGLEN <br>
Maximum length of strings, default 128.</p>

<p style="margin-top: 1em">MAXTRYLOCK <br>
Maximum number of iterations to wait for locks on global
variables before declaring possible deadlock and skipping
the probe, default 1000.</p>

<p style="margin-top: 1em">MAXACTION <br>
Maximum number of statements to execute during any single
probe hit (with interrupts disabled), default 1000. Note
that for straight-through probe handlers lacking loops <br>
or recursion, due to optimization, this parameter may be
interpreted too conservatively.</p>

<p style="margin-top: 1em">MAXACTION_INTERRUPTIBLE <br>
Maximum number of statements to execute during any single
probe hit which is executed with interrupts enabled (such as
begin/end probes), default (MAXACTION * 10).</p>

<p style="margin-top: 1em">MAXBACKTRACE <br>
Maximum number of stack frames that will be be processed by
the stap runtime unwinder as produced by the backtrace
functions in the [u]context-unwind.stp tapsets, default <br>
20.</p>

<p style="margin-top: 1em">MAXMAPENTRIES <br>
Maximum number of rows in any single global array, default
2048. Individual arrays may be declared with a larger or
smaller limit instead:</p>

<p style="margin-top: 1em">global big[10000],little[5]</p>

<p style="margin-top: 1em">or denoted with % to make them
wrap-around automatically.</p>

<p style="margin-top: 1em">MAPHASHBIAS <br>
The number of powers-of-two to add or subtract from the
natural size of the hash table backing each global
associative array. Default is 0. Try small positive numbers
to <br>
get extra performance at the cost of more memory
consumption, because that should reduce hash table
collisions. Try small negative numbers for the opposite
tradeoff.</p>

<p style="margin-top: 1em">MAXERRORS <br>
Maximum number of soft errors before an exit is triggered,
default 0, which means that the first error will exit the
script. Note that with the --suppress-handler-errors <br>
option, this limit is not enforced.</p>

<p style="margin-top: 1em">MAXSKIPPED <br>
Maximum number of skipped probes before an exit is
triggered, default 100. Running systemtap with -t (timing)
mode gives more details about skipped probes. With the
de&acirc; <br>
fault -DINTERRUPTIBLE=1 setting, probes skipped due to
reentrancy are not accumulated against this limit. Note that
with the --suppress-handler-errors option, this limit <br>
is not enforced.</p>

<p style="margin-top: 1em">MINSTACKSPACE <br>
Minimum number of free kernel stack bytes required in order
to run a probe handler, default 1024. This number should be
large enough for the probe handler&rsquo;s own needs, <br>
plus a safety margin.</p>

<p style="margin-top: 1em">MAXUPROBES <br>
Maximum number of concurrently armed user-space probes
(uprobes), default somewhat larger than the number of
user-space probe points named in the script. This pool needs
<br>
to be potentially large because individual uprobe objects
(about 64 bytes each) are allocated for each process for
each matching script-level probe.</p>

<p style="margin-top: 1em">STP_MAXMEMORY <br>
Maximum amount of memory (in kilobytes) that the systemtap
module should use, default unlimited. The memory size
includes the size of the module itself, plus any addi&acirc;
<br>
tional allocations. This only tracks direct allocations by
the systemtap runtime. This does not track indirect
allocations (as done by kprobes/uprobes/etc. internals).</p>

<p style="margin-top: 1em">STP_OVERLOAD_THRESHOLD,
STP_OVERLOAD_INTERVAL <br>
Maximum number of machine cycles spent in probes on any cpu
per given interval, before an overload condition is declared
and the script shut down. The defaults are 500 <br>
million and 1 billion, so as to limit stap script cpu
consumption at around 50%.</p>

<p style="margin-top: 1em">STP_PROCFS_BUFSIZE <br>
Size of procfs probe read buffers (in bytes). Defaults to
MAXSTRINGLEN. This value can be overridden on a per-procfs
file basis using the procfs read probe .maxsize(MAX&acirc;
<br>
SIZE) parameter.</p>

<p style="margin-top: 1em">With scripts that contain probes
on any interrupt path, it is possible that those interrupts
may occur in the middle of another probe handler. The probe
in the interrupt handler <br>
would be skipped in this case to avoid reentrance. To work
around this issue, execute stap with the option
-DINTERRUPTIBLE=0 to mask interrupts throughout the probe
handler. <br>
This does add some extra overhead to the probes, but it may
prevent reentrance for common problem cases. However, probes
in NMI handlers and in the callpath of the stap runtime <br>
may still be skipped due to reentrance.</p>

<p style="margin-top: 1em">In case something goes wrong
with stap or staprun after a probe has already started
running, one may safely kill both user processes, and remove
the active probe kernel module <br>
with rmmod. Any pending trace messages may be lost.</p>

<p style="margin-top: 1em">UNPRIVILEGED USERS <br>
Systemtap exposes kernel internal data structures and
potentially private user information. Because of this, use
of systemtap&rsquo;s full capabilities are restricted to
root and to <br>
users who are members of the groups stapdev and stapusr.</p>

<p style="margin-top: 1em">However, a restricted set of
systemtap&rsquo;s features can be made available to trusted,
unprivileged users. These users are members of the group
stapusr only, or members of the <br>
groups stapusr and stapsys. These users can load systemtap
modules which have been compiled and certified by a trusted
systemtap compile-server. See the descriptions of the
op&acirc; <br>
tions --privilege and --use-server. See README.unprivileged
in the systemtap source code for information about setting
up a trusted compile server.</p>

<p style="margin-top: 1em">The restrictions enforced when
--privilege=stapsys is specified are designed to prevent
unprivileged users from:</p>

<p style="margin-top: 1em">&Acirc;&middot; harming the
system maliciously.</p>

<p style="margin-top: 1em">The restrictions enforced when
--privilege=stapusr is specified are designed to prevent
unprivileged users from:</p>

<p style="margin-top: 1em">&Acirc;&middot; harming the
system maliciously.</p>

<p style="margin-top: 1em">&Acirc;&middot; gaining access
to information which would not normally be available to an
unprivileged user.</p>

<p style="margin-top: 1em">&Acirc;&middot; disrupting the
performance of processes owned by other users of the system.
Some overhead to the system in general is unavoidable since
the unprivileged user&rsquo;s <br>
probes will be triggered at the appropriate times. What we
would like to avoid is targeted interruption of another
user&rsquo;s processes which would not normally be
possi&acirc; <br>
ble by an unprivileged user.</p>

<p style="margin-top: 1em">PROBE RESTRICTIONS <br>
A member of the groups stapusr and stapsys may use all probe
points.</p>

<p style="margin-top: 1em">A member of only the group
stapusr may use only the following probes:</p>

<p style="margin-top: 1em">&Acirc;&middot; begin,
begin(n)</p>

<p style="margin-top: 1em">&Acirc;&middot; end, end(n)</p>

<p style="margin-top: 1em">&Acirc;&middot; error(n)</p>

<p style="margin-top: 1em">&Acirc;&middot; never</p>

<p style="margin-top: 1em">&Acirc;&middot; process.*, where
the target process is owned by the user.</p>

<p style="margin-top: 1em">&Acirc;&middot;
timer.{jiffies,s,sec,ms,msec,us,usec,ns,nsec}(n)*</p>

<p style="margin-top: 1em">&Acirc;&middot; timer.hz(n)</p>

<p style="margin-top: 1em">SCRIPT LANGUAGE RESTRICTIONS
<br>
The following scripting language features are unavailable to
all unprivileged users:</p>

<p style="margin-top: 1em">&Acirc;&middot; any feature
enabled by the Guru Mode (-g) option.</p>

<p style="margin-top: 1em">&Acirc;&middot; embedded C
code.</p>

<p style="margin-top: 1em">RUNTIME RESTRICTIONS <br>
The following runtime restrictions are placed upon all
unprivileged users:</p>

<p style="margin-top: 1em">&Acirc;&middot; Only the default
runtime code (see -R) may be used.</p>

<p style="margin-top: 1em">Additional restrictions are
placed on members of only the group stapusr:</p>

<p style="margin-top: 1em">&Acirc;&middot; Probing of
processes owned by other users is not permitted.</p>

<p style="margin-top: 1em">&Acirc;&middot; Access of kernel
memory (read and write) is not permitted.</p>

<p style="margin-top: 1em">COMMAND LINE OPTION RESTRICTIONS
<br>
Some command line options provide access to features which
must not be available to all unprivileged users:</p>

<p style="margin-top: 1em">&Acirc;&middot; -g may not be
specified.</p>

<p style="margin-top: 1em">&Acirc;&middot; The following
options may not be used by the compile-server client:</p>

<p style="margin-top: 1em">-a, -B, -D, -I, -r, -R</p>

<p style="margin-top: 1em">ENVIRONMENT RESTRICTIONS <br>
The following environment variables must not be set for all
unprivileged users:</p>

<p style="margin-top: 1em">SYSTEMTAP_RUNTIME <br>
SYSTEMTAP_TAPSET <br>
SYSTEMTAP_DEBUGINFO_PATH</p>

<p style="margin-top: 1em">TAPSET RESTRICTIONS <br>
In general, tapset functions are only available for members
of the group stapusr when they do not gather information
that an ordinary program running with that user&rsquo;s
privileges <br>
would be denied access to.</p>

<p style="margin-top: 1em">There are two categories of
unprivileged tapset functions. The first category consists
of utility functions that are unconditionally available to
all users; these include such <br>
things as:</p>

<p style="margin-top: 1em">cpu:long () <br>
exit () <br>
str_replace:string (prnt_str:string, srch_str:string,
rplc_str:string)</p>

<p style="margin-top: 1em">The second category consists of
so-called myproc-unprivileged functions that can only gather
information within their own processes. Scripts that wish to
use these functions must <br>
test the result of the tapset function is_myproc and only
call these functions if the result is 1. The script will
exit immediately if any of these functions are called by an
un&acirc; <br>
privileged user within a probe within a process which is not
owned by that user. Examples of myproc-unprivileged
functions include:</p>

<p style="margin-top: 1em">print_usyms (stk:string) <br>
user_int:long (addr:long) <br>
usymname:string (addr:long)</p>

<p style="margin-top: 1em">A compile error is triggered
when any function not in either of the above categories is
used by members of only the group stapusr.</p>

<p style="margin-top: 1em">No other built-in tapset
functions may be used by members of only the group
stapusr.</p>

<p style="margin-top: 1em">ALTERNATE RUNTIMES <br>
As described above, systemtap&rsquo;s default runtime mode
involves building and loading kernel modules, with various
security tradeoffs presented. Systemtap now includes a new
proto&acirc; <br>
type backend, selected with --runtime=dyninst, which uses
Dyninst to instrument a user&rsquo;s own processes at
runtime. This backend does not use kernel modules, and does
not require <br>
root privileges, but is restricted with respect to the kinds
of probes and other constructs that a script may use.</p>

<p style="margin-top: 1em">The dyninst runtime operates in
target-attach mode, so it does require a -c COMMAND or -x
PID process. For example:</p>

<p style="margin-top: 1em">stap --runtime=dyninst -c
&rsquo;stap -V&rsquo; -e &rsquo;probe
process.function(&quot;main&quot;) <br>
{ println(&quot;hi from dyninst!&quot;) }&rsquo;</p>

<p style="margin-top: 1em">It may be necessary to disable a
conflicting selinux check with</p>

<p style="margin-top: 1em"># setsebool allow_execstack
1</p>

<p style="margin-top: 1em">EXIT STATUS <br>
The systemtap translator generally returns with a success
code of 0 if the requested script was processed and executed
successfully through the requested pass. Otherwise, errors
<br>
may be printed to stderr and a failure code is returned. Use
-v or -vp N to increase (global or per-pass) verbosity to
identify the source of the trouble.</p>

<p style="margin-top: 1em">In listings mode (-l and -L),
error messages are normally suppressed. A success code of 0
is returned if at least one matching probe was found.</p>

<p style="margin-top: 1em">A script executing in pass 5
that is interrupted with ^C / SIGINT is considered to be
successful.</p>

<p style="margin-top: 1em">DEPRECATION <br>
Over time, some features of the script language and the
tapset library may undergo incompatible changes, so that a
script written against an old version of systemtap may no
<br>
longer run. In these cases, it may help to run systemtap
with the --compatible VERSION flag, specifying the last
known working version. Running systemtap with the
--check-ver&acirc; <br>
sion flag will output a warning if any possible incompatible
elements have been parsed. Deprecation historical details
may be found in the NEWS file.</p>

<p style="margin-top: 1em">The purpose of deprecation
facility is to improve the experience of scripts written for
newer versions of systemtap (by adding better alternatives
and removing conflicting or <br>
messy older alternatives), while at the same time permitting
scripts written for older versions of systemtap to continue
running. Deprecation is thus intended a service to users
<br>
(and an inconvenience to systemtap&rsquo;s developers),
rather than the other way around.</p>

<p style="margin-top: 1em">Please note that
underscore-prefixed identifiers in the tapset sometimes
undergo such changes that are difficult to preserve
compatibility for, even with the deprecation mecha&acirc;
<br>
nisms. Avoid relying on these in your scripts; instead
propose them for promotion to non-underscored status.</p>

<p style="margin-top: 1em">FILES <br>
Important files and their corresponding paths can be located
in the <br>
stappaths (7) manual page.</p>

<p style="margin-top: 1em">SEE ALSO <br>
stapprobes(3stap), <br>
function::*(3stap), <br>
probe::*(3stap), <br>
tapset::*(3stap), <br>
stappaths(7), <br>
staprun(8), <br>
stapdyn(8), <br>
systemtap(8), <br>
stapvars(3stap), <br>
stapex(3stap), <br>
stap-server(8), <br>
stap-prep(1), <br>
stapref(1), <br>
awk(1), <br>
gdb(1)</p>

<p style="margin-top: 1em">BUGS <br>
Use the Bugzilla link of the project web page or our mailing
list. http://sourceware.org/systemtap/,
&lt;systemtap@sourceware.org&gt;.</p>

<p style="margin-top: 1em">error::reporting(7stap),
https://sourceware.org/systemtap/wiki/HowToReportBugs</p>
 
<p style="margin-top: 1em">STAP(1)</p>
<hr>
</body>
</html>
