<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 15:47:50 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>AFIO(1) General Commands Manual AFIO(1)</p>

<p style="margin-top: 1em">NAME <br>
afio - manipulate archives and files</p>

<p style="margin-top: 1em">SYNOPSIS <br>
... | afio -o [ options ] archive : write (create) archive
<br>
afio -i [ options ] archive : install (unpack) archive <br>
afio -t [ options ] archive : list table-of-contents of
archive <br>
afio -r [ options ] archive : verify archive against
filesystem <br>
afio -p [ options ] directory [ ... ] : copy files</p>

<p style="margin-top: 1em">DESCRIPTION <br>
Afio manipulates groups of files, copying them within the
(collective) filesystem or between the filesystem and an
afio archive.</p>

<p style="margin-top: 1em">With -o, reads pathnames from
the standard input and writes an archive.</p>

<p style="margin-top: 1em">With -t, reads an archive and
writes a table-of-contents to the standard output.</p>

<p style="margin-top: 1em">With -i, installs the contents
of an archive relative to the working directory.</p>

<p style="margin-top: 1em">With -p, reads pathnames from
the standard input and copies the files to each directory.
Cannot be combined with the -Z option.</p>

<p style="margin-top: 1em">With -r, reads archive and
verifies it against the filesystem. This is useful for
verifying tape archives, to ensure they have no bit errors.
The verification compares file <br>
contents, but not permission bits and non-file filesystem
entities, so it cannot be used as a reliable tool to detect
every possible change made to a filesystem.</p>

<p style="margin-top: 1em">Creates missing directories as
necessary, with permissions to match their parents.</p>

<p style="margin-top: 1em">Removes leading slashes from
pathnames, making all paths relative to the current
directory. This is a safety feature to prevent inadvertent
overwriting of system files when <br>
doing restores. To suppress this safety feature, the -A
option must be used while writing an archive, but also when
reading (installing), verifying, and cataloging an existing
<br>
archive.</p>

<p style="margin-top: 1em">Supports compression while
archiving, with the -Z option. Will compress individual
files in the archive, not the entire archive datastream,
which makes afio compressed archives <br>
much more robust than &lsquo;tar zc&rsquo; type
archives.</p>

<p style="margin-top: 1em">Supports multi-volume archives
during interactive operation (i.e., when /dev/tty is
accessible and SIGINT is not being ignored).</p>

<p style="margin-top: 1em">OPTIONS <br>
-@ address Send email to address when a volume change (tape
change, floppy change) is needed, and also when the entire
operation is complete. Uses sendmail(1) to send the <br>
mail.</p>

<p style="margin-top: 1em">-a Preserve the last access
times (atimes) of the files read when making or verifying an
archive. Warning: if this option is used, afio will change
the last inode <br>
changed times (ctimes) of these files. Thus, this option
cannot be used together with an incremental backup scheme
that relies on the ctimes being preserved.</p>

<p style="margin-top: 1em">-b size Read or write
size-character archive blocks. Suffices of b, k, m and g
denote multiples of 512, kilobytes, megabytes and gigabytes,
respectively. Defaults to 5120 <br>
for compatibility with cpio(1). In some cases, notably when
using ftape with some tape drives, -b 10k is needed for
compatibility. Note that -b 10k is the default <br>
block size used by tar(1), so it is usually a good choice if
the tape setup is known to work with tar(1).</p>

<p style="margin-top: 1em">-c count Buffer count archive
blocks between I/O operations. A large count is recommended
for efficient use with streaming magnetic tape drives, in
order to reduce the number <br>
of tape stops and restarts.</p>

<p style="margin-top: 1em">-d Don&rsquo;t create missing
directories.</p>

<p style="margin-top: 1em">-e bound Pad the archive to a
multiple of bound characters. Recognizes the same suffices
as -s. Defaults to 1x (the -b block size) for compatibility
with cpio(1).</p>

<p style="margin-top: 1em">-f Spawn a child process to
actually write to the archive; provides a clumsy form of
double-buffering. Requires -s for multi-volume archive
support.</p>

<p style="margin-top: 1em">-g Change to input file
directories. Avoids quadratic filesystem behavior with long
similar pathnames. Requires all absolute pathnames,
including those for the -o ar&acirc; <br>
chive and the -p directories.</p>

<p style="margin-top: 1em">-h Follow symbolic links,
treating them as ordinary files and directories.</p>

<p style="margin-top: 1em">-j Don&rsquo;t generate sparse
filesystem blocks on restoring files. By default, afio
creates sparse filesystem blocks (with lseek(2)) when
possible when restoring files <br>
from an archive, but not if these files were stored in a
compressed form. Unless stored in a compressed form, sparse
files are not archived efficiently: they will <br>
take space equal to the full file length. (The sparse file
handling in afio does not make much sense except in a
historical way.)</p>

<p style="margin-top: 1em">-k Rather than complaining about
unrecognizable input, skip unreadable data (or partial file
contents) at the beginning of the archive file being read,
and search for <br>
the next valid archive header. This option is needed to deal
with certain types of backup media damage. It is also useful
to support quick selective restores from <br>
multi-volume archives, or from searchable block devices, if
the volume or location of the file to be restored is known
in advance (see the -B option). If, for exam&acirc; <br>
ple, a selective restore is done with the fourth volume of a
multi-volume afio archive, then the -k option needs to be
used, else afio will complain about the input <br>
not being a well-formed archive.</p>

<p style="margin-top: 1em">-l With -o, write file contents
with each hard link.</p>

<p style="margin-top: 1em">With -t, report hard links.</p>

<p style="margin-top: 1em">With -p, attempt to link files
rather than copying them.</p>

<p style="margin-top: 1em">-m Mark output files with a
common current timestamp (rather than with input file
modification times).</p>

<p style="margin-top: 1em">-n Protect newer existing files
(comparing file modification times).</p>

<p style="margin-top: 1em">-s size Restrict each portion of
a multi-volume archive to size characters. This option
recognizes the same size suffices as -b. Also, the suffix x
denotes a multiple of <br>
the -b block size (and must follow any -b specification).
size can be a single size or a comma-seperated list of
sizes, for example &rsquo;2m,5m,8m&rsquo;, to specify
differ&acirc; <br>
ent sizes for the subsequent volumes. If there are more
volumes than sizes, the last specified size is used for all
remaining volumes. If this option is used, the <br>
special character sequences %V and %S in the input/output
filename or command string are replaced by the current
volume number and volume size. Use %% to produce a <br>
single % character. The -s option is useful with
finite-length devices which do not return short counts at
end of media (sigh); output to magnetic tape typically <br>
falls into this category. When an archive is being read or
written, using -s causes afio to prompt for the next volume
if the specified volume length is reached. <br>
The -s option will also cause afio to prompt if there is a
premature EOF while reading the input. The special case -s 0
will activate this prompting for the next <br>
volume on premature EOF without setting a volume length.
When writing an archive, afio will prompt for the next
volume on end-of-media, even without -s 0 being sup&acirc;
<br>
plied, if the device is capable of reporting end-of-media.
If the volume size specified is not a multiple of the block
size set with the -b option, then afio(1) <br>
will silently round down the volume size to the nearest
multiple of the block size. This rounding down can be
suppressed using the -9 option: if -9 is used, afio(1) <br>
will write a small block of data, smaller than the -b size,
at the end of the volume to completely fill it to the
specified size. Some devices are not able to <br>
handle such small block writes.</p>

<p style="margin-top: 1em">-u Report files with unseen
links.</p>

<p style="margin-top: 1em">-v Verbose. Report pathnames (to
stderr) as they are processed. When used with -t, gives an
ls -l style report (including link information) to stdout
instead. When <br>
used twice (-vv) with -o, gives an ls -l style report to
stdout while writing the archive. (But this use of -vv will
not work if the archive is also being written to <br>
stdout.)</p>

<p style="margin-top: 1em">-w filename Treats each line in
filename as an -y pattern, see -y.</p>

<p style="margin-top: 1em">-x Retain file ownership and
setuid/setgid permissions. This is the default for the
super-user; he may use -X to override it.</p>

<p style="margin-top: 1em">-y pattern Restrict processing
of files to names matching shell wildcard pattern pattern.
Use this flag once for each pattern to be recognized. With
the possible exception of <br>
the presence of a leading slash, the complete file name as
appearing in the archive table-of-contents must match the
pattern, for example the file name &rsquo;etc/passwd&rsquo;
<br>
is matched by the pattern &rsquo;*passwd&rsquo; but NOT by
the pattern &rsquo;passwd&rsquo;. See &lsquo;man 7
glob&rsquo; for more information on shell wildcard pattern
matching. The only difference <br>
with shell wildcard pattern matching is that in afio the
wildcards will also match &rsquo;/&rsquo; characters in file
names. For example the pattern &rsquo;/usr/src/*&rsquo; will
match the <br>
file name &rsquo;/usr/src/linux/Makefile&rsquo;, and any
other file name starting with &rsquo;/usr/src&rsquo;. Unless
the -S option is given, any leading slash in the pattern or
the file&acirc; <br>
name is ignored when matching, e.g. /etc/passwd will match
etc/passwd. Use -Y to supply patterns which are not to be
processed. -Y overrides -y if a filename <br>
matches both. See also -w and -W. See also the -7 option,
which can be used to modify the meaning of -y, -Y, -w, and
-W when literal matching without wildcard pro&acirc; <br>
cessing is needed. Note: if afio was compiled without using
the GNU fnmatch library, then the full shell wildcard
pattern syntax cannot be used, and matching sup&acirc; <br>
port is limited to patterns which are a full literal file
name and patterns which end in &rsquo;*&rsquo;.</p>

<p style="margin-top: 1em">-z Print execution statistics.
This is meant for human consumption; use by other programs
is officially discouraged.</p>

<p style="margin-top: 1em">-A Do not turn absolute paths
into relative paths. That is don&rsquo;t remove the leading
slash. Applies to the path names written in an archive, but
also to the path names <br>
read out of an archive during read (install), verify, and
cataloging operations.</p>

<p style="margin-top: 1em">-B If the -v option is used,
prints the byte offset of the start of each file in the
archive. If your tape drive can start reading at any
position in an archive, the <br>
output of -B can be useful for doing quick selective
restores.</p>

<p style="margin-top: 1em">-D controlscript <br>
Set the control script name to controlscript, see the
section on control files below.</p>

<p style="margin-top: 1em">-E [+]filename | -E CS | -E CI
<br>
While creating an archive with compressed files using the -Z
option, disable (attempts at) compression for files with
particular extensions. This option can be used <br>
to speed up the creation of the archive, by making afio
avoid trying to use gzip on files that contain compressed
data already. By default, if no specific -E option <br>
is given, all files with the extensions .Z .z .gz .bz2 .tgz
.arc .zip .rar .lzh .lha .uc2 .tpz .taz .tgz .rpm .zoo .deb
.gif .jpeg .jpg .tif .tiff .png .pdf .arj <br>
.avi .bgb .cab .cpn .hqx .jar .mp3 .mpg .mpq .pic .pkz .psn
.sit .ogg and .smk will not be compressed. Also by default,
the file extension matching is case-insensi&acirc; <br>
tive (to do the right thing with respect to MS-DOS based
filesystems). The -E filename form of this option will
replace the default list of file extensions by read&acirc;
<br>
ing a new list of file extensions, separated by whitespace,
from filename. filename may contain comments preceded by a
#. The extensions in filename should usually <br>
all start with a dot, but they do not need to start with a
dot, for example the extension &rsquo;tz&rsquo; will match
the file name &rsquo;hertz&rsquo;. The -E +filename form
(with a + <br>
sign in front of filename) can be used to specify extensions
in addition to the built-in default list, instead of
replacing the whole default list. To make exten&acirc; <br>
sion matching case-sensitive, add the special option form -E
CS to the command line. The form -E CI invokes the (default)
case-insensitive comparison. See also the <br>
-6 option, which offers an additional way to suppress
compression.</p>

<p style="margin-top: 1em">-F This is a floppy disk, -s is
required. Causes floppy writing in O_SYNC mode under Linux.
With kernel version 1.1.54 and above, this allows afio to
detect some <br>
floppy errors while writing. Uses shared memory if compiled
in otherwise mallocs as needed (a 3b1 will not be able to
malloc the needed memory w/o shared memory), <br>
afio assumes either way you can malloc/shmalloc a chunck of
memory the size of one disk. Examples: 795k: 3.5&quot; (720k
drive), 316k (360k drive) <br>
At the end of each disk this message occurs: <br>
Ready for disk [#] on [output] <br>
(remove the disk when the light goes out) <br>
Type &quot;go&quot; (or &quot;GO&quot;) when ready to
proceed <br>
(or &quot;quit&quot; to abort):</p>

<p style="margin-top: 1em">-G factor Specifies the gzip(1)
compression speed factor, used when compressing files with
the -Z option. Factor 1 is the fastest with least
compression, 9 is slowest with <br>
best compression. The default value is 6. See also the
gzip(1) manual page. If you have a slow machine or a fast
backup medium, you may want to specify a low <br>
value for factor to speed up the backup. On large (&gt;200k)
files, -G 1 typically zips twice as fast as -G 6, while
still achieving a better result than compress(1). <br>
The zip speed for small files is mainly determined by the
invocation time of gzip (1), see the -T option.</p>

<p style="margin-top: 1em">-H promptscript <br>
Specify a script to run, in stead of using the normal
prompt, before advancing to the next archive volume. The
script will be run with the volume number, archive <br>
specification, and the reason for changing to the next
volume as arguments. The script should exit with 0 for OK
and 1 for abort, other exit codes will be treated <br>
as fatal errors. afio executes the script by taking the
promptscript string, appending the arguments, and then
calling the shell to execute the resulting command <br>
line. This means that a general-purpose prompt script can be
supplied with additional arguments, via the afio command
line, by using a -H option value like -H <br>
&quot;generic_promptscript additional_arg_1
additional_arg_2&quot;. <br>
-J Try to continue after a media write error when doing a
backup (normal behavior is to abort with a fatal error).</p>

<p style="margin-top: 1em">-K Verify the output against
what is in the memory copy of the disk (-F required). If the
writing or verifying fails the following menu pops up <br>
[Writing/Verify] of disk [disk #] has FAILED! <br>
Enter 1 to RETRY this disk <br>
Enter 2 to REFORMAT this disk before a RETRY</p>

<p style="margin-top: 1em">Enter quit to ABORT this backup
<br>
Currently, afio will not process the answers 1 and 2 in the
right way. The menu above is only useful in that it
signifies that something is wrong.</p>

<p style="margin-top: 1em">-L Log_file_path <br>
Specify the name of the file to log errors and the final
totals to.</p>

<p style="margin-top: 1em">-M size Specifies the maximum
amount of memory to use for the temporary storage of
compression results when using the -Z option. The default is
-M 250m (250 megabytes). If <br>
the compressed version of a file is larger than this (or if
afio runs out of virtual memory), gzip(1) is run twice of
the file, the first time to determine the <br>
length of the result, the second time to get the compressed
data itself.</p>

<p style="margin-top: 1em">-P progname Use the program
progname instead of the standard gzip(1) for compression and
decompression with the -Z option. For example, use the
options -Z -P bzip2 to write and <br>
install archives using bzip2(1) compression. If progname
does not have command line options (-c, -d, and
-&lt;number&gt;) in the style of gzip(1) then the -Q option
can <br>
be used to supply the right options. The compression program
used must have the property that, if the output file size
exceeds the value of the -M option, then when <br>
the compression program is run for a second time on the same
input, it must produce an output with exactly the same size.
(See also the -M option description.) The <br>
GnuPG (gpg) encryption program does not satisfy this
lenght-preserving criterion unless its built-in compression
is disabled (see examples in the afio source <br>
script3/ directory). See also the -Q, -U and -3 options.</p>

<p style="margin-top: 1em">-Q opt Pass the option opt to
the compression or decompression program used with the -Z
option. For passing multiple options, use -Q multiple times.
If no -Q flag is <br>
present, the standard options are passed. The standard
options are -c -6 when the program is called for compression
and -c -d when the program is called for decom&acirc; <br>
pression. Use the special case -Q &quot;&quot; if no options
at all are to be passed to the program.</p>

<p style="margin-top: 1em">-R Disk format command string
<br>
This is the command that is run when you enter 2 to reformat
the disk after a failed verify. The default (fdformat
/dev/fd0H1440) can be changed to a given system&rsquo;s <br>
default by editing the Makefile. You are also prompted for
formatting whenever a disk change is requested.</p>

<p style="margin-top: 1em">-S Do not ignore a leading slash
in the pattern or the file name when matching -y and -Y
patterns. See also -A.</p>

<p style="margin-top: 1em">-T threshold Only compress a
file when using the -Z option if its length is at least
threshold. The default is -T 0k. This is useful if you have
a slow machine or a fast backup <br>
medium. Specifying -T 3k typically halves the number of
invocations of gzip(1), saving some 30% computation time,
while creating an archive that is only 5% longer. <br>
The combination -T 8k -G 1 typically saves 70% computation
time and gives a 20% size increase. The latter combination
may be a good alternative to not using -Z at <br>
all. These figures of course depend heavily on the kind of
files in the archive and the processor - i/o speed ratio on
your machine. See also the -2 option.</p>

<p style="margin-top: 1em">-U If used with the -Z option,
forces compressed versions to be stored of all files, even
if the compressed versions are bigger than the original
versions, and disre&acirc; <br>
garding any (default) values of the -T and -2 options. This
is useful when the -P and -Q options are used to replace the
compression program gzip with an encryption <br>
program in order to make an archive with encrypted files.
Due to internal limitations of afio, use of this flag forces
the writing of file content with each hard <br>
linked file, rather than only once for every set of hard
linked files. WARNING: use of the -U option will also cause
compression (or whatever operation the -P <br>
option indicates) on files larger than 2 GB, if these are
present in the input. Not all compression programs might
handle such huge files correctly (recent Linux <br>
versions of gzip, bzip2, and gpg have all been tested and
seem to work OK). If your setup is obscure, some testing
might be warranted.</p>

<p style="margin-top: 1em">-W filename Treats each line in
filename as an -Y pattern, see -Y.</p>

<p style="margin-top: 1em">-Y pattern Do not process files
whose names match shell wildcard pattern pattern. See also
-y and -W.</p>

<p style="margin-top: 1em">-Z Compress the files that go
into the archive when creating an archive, or uncompress
them again when installing an archive. afio -Z will compress
each file in the <br>
archive individually, while keeping the archive headers
uncompressed. Compared to tar zc style archives, afio -Z
archives are therefore much more fault-tolerant <br>
against read errors on the backup medium. When creating an
archive with the -Z option, afio will run gzip on each file
encountered, and, if the result is smaller <br>
than the original, store the compressed version of the file.
Requires gzip(1) to be in your path. Mainly to speed up afio
operation, compression is not attempted <br>
on a file if: 1) the file is very small (see the -T option),
2) the file is very large (see the -2 option), 3) the file
has a certain extension, so it probably con&acirc; <br>
tains compressed data already (see the -E option), 4) the
file pathname matches a certain pattern, as set by the -6
option, 5) the file has hard links (this due to <br>
an internal limitation of afio, but this limitation does not
apply if the -l option is also used). Regardless of the
above, if the -U option is used then the com&acirc; <br>
pression program is always run, and the compressed result is
always stored. When installing an archive with compressed
files, the -Z option needs to be used in <br>
order to make afio automatically uncompress the files that
it compressed earlier. The -P option can be used to do the
(un)compression with programs other than gzip, <br>
see the -P (and -Q and -3) options in this manpage for
details. See also the -G option which provides yet another
way to tune the compression process.</p>

<p style="margin-top: 1em">-0 Use filenames terminated with
&rsquo; &rsquo; instead of &rsquo;0. When used as follows:
find ... -print0 | afio -o -0 ..., it ensures that any input
filename can be handled, even <br>
a file name containing newlines. When used as afio -t -0 ...
| ..., this allows the table of contents output to be parsed
unambiguosly even if the filenames contain <br>
newlines. The -0 option also affects the parsing of the
files supplied by -w file and -W file options: if the option
-0 precedes them in the command line then the <br>
pattern lines contained in the files should be terminated
with &rsquo; &rsquo; in stead of &rsquo;0. A second use of
-0 toggles the option. This can be useful when using
multiple <br>
pattern files or when combining with the -t option.</p>

<p style="margin-top: 1em">-1 warnings-to-ignore <br>
Control if afio(1) should exit with a nonzero code after
printing certain warning messages, and if certain warning
messages should be printed at all. This option is <br>
sometimes useful when calling afio(1) from inside a backup
script or program. afio(1) will exit with a nonzero code on
encountering various &rsquo;hard&rsquo; errors, and also
<br>
(with the default value of the -1 option) when it has
printed certain warning messages during execution.
warnings-to-ignore is a list of letters which determines
<br>
the behavior related to warning messages. The default value
for this option is -1 mc. For afio versions 2.4.3 and
earlier, the default was -1 a. For afio versions <br>
2.4.4 and 2.4.5, the default was -1 &rsquo;&rsquo;. The
defined warnings-to-ignore letters are as follows. a is for
for ignoring all possible warnings on exit: if this letter
<br>
is used, the printing of a warning message will never cause
a nonzero exit code. m is for ignoring in the exit code any
warning about missing files, which will be <br>
printed when, on creating an archive, a file whose name was
read from the standard input is not found. c is for ignoring
in the exit code the warning that the ar&acirc; <br>
chive being created will not be not fully compatible with
cpio or afio versions 2.4.7 or lower. C is the same as c,
but in addition the warning message will not <br>
even be printed. M will suppress the printing of all warning
messages asssociated with Multivolume archive handling,
messages like &quot;Output limit reached&quot; and
&quot;Con&acirc; <br>
tinuing&quot;. d is for ignoring in the exit code any
warnings about changed files, which will be printed when, on
creating an archive, a file that is being archived <br>
changes while it is being written into the archive, where
the changing is detected by examining the file modification
time stamp. r is for ignoring certain warnings <br>
during the verify (-r) operation. If this letter is used,
some verification errors that are very probably due to
changes in the filesystem, during or after the <br>
backup was made, are ignored in determining the exit code.
The two verification errors that are ignored are: 1) a file
in the archive is no longer present on the <br>
filesystem, and 2) the file contents in the archive and on
the filesystem are different, but the file lengths or the
file modification times are also different, so <br>
the difference in contents is probably due to the file on
the file system having been changed. n is for ignoring in
the exit code a particular class of no-such-file <br>
warnings: it ignores these warnings when they happen after
the file has already been successfully opened. This unusual
warning situation can occur when archiving <br>
files on Windows smbfs filesystems -- due to a Windows
problem, smbfs files with non-ASCII characters in their
names can sometimes be opened but not read. When the <br>
-Z option is used, the n letter function is (currently) only
implemented for files with sizes smaller than indicated by
the -T option, so in that case the -T option <br>
is also needed for this letter to have any effect.</p>

<p style="margin-top: 1em">-2 maximum-file-size-to-compress
<br>
Do not compress any files which are larger than this size
when making a compressed archive with the -Z option. The
default value is -2 200m (200 Megabytes). This <br>
maximum size cutoff lowers the risk that a major portion of
a large file will be irrecoverable due to small media
errors. If a media error occurs while reading a <br>
file that afio has stored in a compressed form, then afio
and gzip will not be able to restore the entire remainder of
that file. This is usually an acceptable risk <br>
for small files. However for very large files the risk of
loosing a large amount of data because of this effect will
usually be too big. The special case -2 0 elim&acirc; <br>
inates any maximum size cutoff.</p>

<p style="margin-top: 1em">-3 filedescriptor-nr <br>
Rewind the filedescriptor before invoking the
(un)compression program if using the -Z option. This is
useful when the -P and -Q options are used to replace the
com&acirc; <br>
pression program gzip with some types of encryption programs
in order to make or read an archive with encrypted files.
The rewinding is needed to interface cor&acirc; <br>
rectly with some encryption programs that read their key
from an open filedescriptor. If the -P program name matches
&rsquo;pgp&rsquo; or &rsquo;gpg&rsquo;, then the -3 option
must be used <br>
to avoid afio(1) reporting an error. Use the special case -3
0 to suppress the error message without rewinding any file
descriptor. The -3 0 option may also be <br>
needed to successfully read back encrypted archives made
with afio version 2.4.5 and older.</p>

<p style="margin-top: 1em">-4 (Deprecated, the intended
effect of this option is now archived by default as long as
the -5 option is not used. This option could still be useful
for compatibility <br>
with machines running an older version of afio.) Write
archive with the &lsquo;extended ASCII&rsquo; format headers
which use 4-byte inode numbers. Archives using the extended
<br>
ASCII format headers are not compatible with any other
archiver. This option was useful for reliably creating and
restoring sets of files with many internal hard <br>
links, for example a news spool.</p>

<p style="margin-top: 1em">-5 Refuse to create an archive
that is incompatible with cpio(1). If this option is used,
afio will never write any &lsquo;large ASCII&rsquo; file
headers that are incompatible <br>
with cpio(1), but fail with an error code instead. See the
ARCHIVE PORTABILITY section above for more information on
the use of &lsquo;large ASCII&rsquo; file headers.</p>

<p style="margin-top: 1em">-6 filename While creating an
archive with compressed files using the -Z option, disable
(attempts at) compression for files that match particular
shell patterns. This option <br>
can be used to speed up the creation of the archive, by
making afio avoid trying to use gzip on files that contain
compressed data already. Reads shell wildcard <br>
patterns from filename, treating each line in the file as a
pattern. Files whose names match these patterns are not to
be compressed when using the -Z option. Pat&acirc; <br>
tern matching is done in exactly the same way as described
for the -y option. See also the -E option: the (default)
settings of the -E option will further restrict <br>
compression attempts. The -E option controls compression
attempts based on file extensions; the -6 option is mainly
intended as a method for excluding all files in <br>
certain subdirectory trees from compression..</p>

<p style="margin-top: 1em">-7 Switch between shell wildcard
pattern matching and exact name matching (without
interpreting any wildcard characters) for the patterns
supplied in the -y, -Y, -w, <br>
and -W options. If the -7 option is used in front of any
option -y, -Y, -w, or -W, then the patterns supplied in
these options are not intrerpreted as wildcard pat&acirc;
<br>
terns, but as character strings that must match exactly to
the file name, except possibly in leading slashes. This
option can be useful for handling the exceptional <br>
cases where file names in the archive, or the names of files
to be archived, contain wildcard characters themselves. For
example, find /tmp -print0 | afio -ov -Y <br>
&rsquo;*.jpg&rsquo; -7 -Y &rsquo;/tmp/a[12]*4&rsquo; -0
archive can be used to archive files all files under /tmp,
even files with a &rsquo;0 character in the name, except for
.jpg files and <br>
the file with the exact name /tmp/a[12]*4. A second use of
-7 toggles the matching for subsequently occurring -y, -Y,
-w, and -W back to shell wildcard pattern <br>
matching.</p>

<p style="margin-top: 1em">-9 Do not round down any -s
volume sizes to the nearest -b block size. See the -s
option.</p>

<p style="margin-top: 1em">ARCHIVE PORTABILITY <br>
afio archives are portable between different types of UNIX
systems, as they contain only ASCII-formatted header
information.</p>

<p style="margin-top: 1em">Except in special cases
discussed below, afio will create archives with the same
format as ASCII cpio(1) archives. Therefore cpio(1) can
usually be used to restore an afio ar&acirc; <br>
chive in the case that afio is not available on a system.
(With most cpio versions, to unpack an ASCII format archive,
use cpio -c, and for GNU cpio(1) use cpio -H odc.) When <br>
unpacking with cpio, any compressed files inside an afio -Z
archive are not uncompressed by cpio, but will be created on
the file system as compressed files with a .z extension.</p>

<p style="margin-top: 1em">Unfortunately, the ASCII cpio
archive format cannot represent some files and file
properties that can be present in a modern UNIX filesystem.
If afio creates an archive with <br>
such things, then it uses an afio-specific &rsquo;large
ASCII&rsquo; header for the files concerned. Archives with
large ASCII headers cannot be unpacked completely by cpio or
afio versions <br>
before 2.4.8.</p>

<p style="margin-top: 1em">When creating an archive, the
&lsquo;large ASCII&rsquo; header is used by afio to cover
the following situations:</p>

<p style="margin-top: 1em">o A file has a size larger than
2 GB</p>

<p style="margin-top: 1em">o The archive contains more than
64K files which have hard links</p>

<p style="margin-top: 1em">o A file, directory, or special
file has a UID or GID value larger than 65535.</p>

<p style="margin-top: 1em">The -5 option can be used to
always preserve cpio compatibility, it will cause afio to
fail rather than produce an incompatible archive in the
cases above.</p>

<p style="margin-top: 1em">Archives made using the
(deprecated) -4 option are also not compatible with cpio,
but they are compatible with afio versions 2.4.4 and
later.</p>

<p style="margin-top: 1em">ARCHIVE FILE FORMAT <br>
An afio archive file has a simple format. The archive starts
with a file header for the first file, followed by the
contents of the first file (which will either be the exact
<br>
contents byte-for-byte, or the exact contents in some
compressed format). The data of the first file is
immediately followed by the file header of the second file,
and so on. <br>
At the end, there is a special &lsquo;end of archive&rsquo;
header, usually followed by some padding bytes.</p>

<p style="margin-top: 1em">A multi-volume afio archive is
simply a normal archive split up into multiple parts. There
are no special volume-level data headers. This means that
that volumes can be split <br>
and merged by external programs, as long as the data stays
in the correct order. It also implies that the contents of a
single file can cross volume boundaries. Selective <br>
restores of files at known volume locations can be done by
feeding only the needed volumes to afio, provided that the
-k option is used.</p>

<p style="margin-top: 1em">The contents of hard linked
files are (unless the -l option is used) only stored once in
the archive. The file headers for the second, third, and
later occurrence of a hard <br>
linked file have no data after them. This makes selective
restores of hard-liked files difficult: if later occurrences
are to be restored correctly, the first occurrence always
<br>
needs to be selected too.</p>

<p style="margin-top: 1em">NOTES <br>
Special-case archive names:</p>

<p style="margin-top: 1em">o Specify - to read or write the
standard input or output, respectively. This disables
multi-volume archive handling.</p>

<p style="margin-top: 1em">o Prefix a command string to be
executed with an exclamation mark (!). The command is
executed once for each archive volume, with its standard
input or output piped to afio. <br>
It is expected to produce a zero exit code when all is
well.</p>

<p style="margin-top: 1em">o Use system:file to access an
archive in file on system. This is really just a special
case of pipelining. It requires a 4.2BSD-style remote shell
(rsh(1C)) and a remote <br>
copy of afio.</p>

<p style="margin-top: 1em">o A more elaborate case of the
above is [user@]host[%rsh][=afio]:file where the optional
user@ component specifies the user name on the remote host,
the optional %rsh speci&acirc; <br>
fies the (local) name of the remote shell command to use,
and the optional =afio specifies the name of the remote copy
of the afio command.</p>

<p style="margin-top: 1em">o Anything else specifies a
local file or device. An output file will be created if it
does not already exist.</p>

<p style="margin-top: 1em">o When the -s option is used to
invoke multi-volume archive processing, any %V in the
file/device name or command string is subsisuted by the
current volume number, and any <br>
%S by the current volume size. Use %% to produce a single %
character.</p>

<p style="margin-top: 1em">Recognizes obsolete binary
cpio(1) archives (including those from machines with
reversed byte order), but cannot write them.</p>

<p style="margin-top: 1em">Recovers from archive corruption
by searching for a valid magic number. This is rather
simplistic, but, much like a disassembler, almost always
works.</p>

<p style="margin-top: 1em">Optimizes pathnames with respect
to the current and parent directories. For example,
./src/sh/../misc/afio.c becomes src/misc/afio.c.</p>

<p style="margin-top: 1em">CONTROL FILES <br>
Afio archives can contain so-called control files. Unlike
normal archive entries, a control file in not unpacked to
the filesystem. A control file has a label and some data.
<br>
When afio encounters a control file in the archive it is
reading, it will feed the label and data to a so-called
control script. The control script is supplied by the user.
It <br>
can perform special actions based on the label and data it
receives from afio.</p>

<p style="margin-top: 1em">Control file labels. The control
file mechanism can be used for many things. Examples are
putting archive descriptions at the beginning of the archive
and embedding lists of <br>
files to move before unpacking the rest or the archive.</p>

<p style="margin-top: 1em">To distinguish between different
uses, the label of a control file should indicate the
program that made the control file and the purpose of the
control file data. It should <br>
have the form</p>

<p style="margin-top: 1em">programname.kindofdata</p>

<p style="margin-top: 1em">where programname is the name of
the backup program that generated the control file, and
kindofdata is the meaning of the control file data. Some
examples are</p>

<p style="margin-top: 1em">tbackup.movelist
tbackup.updatescript <br>
blebberfiler.archivecontents <br>
backup_script_of_Joe_User.archivedescription</p>

<p style="margin-top: 1em">The user-supplied control script
should look at the label to decide what to do with the
control data. This way, control files with unknown labels
can be ignored, and afio ar&acirc; <br>
chives maintain some degree of portability between different
programs that restore or index them.</p>

<p style="margin-top: 1em">Control file labels that are
intended to be portable between different backup programs
could be defined in the future.</p>

<p style="margin-top: 1em">Making control files. When
making an archive, afio reads a stream containing the names
of the files (directories, ...) to put in the archive. This
stream may also contain &lsquo;con&acirc; <br>
trol file generators&rsquo;, which are lines with the
following format:</p>

<p style="margin-top: 1em">//--sourcename label</p>

<p style="margin-top: 1em">Here, the //-- sequence signals
that a control file is to be made, sourcename is the path to
a file containing the control file data, and label is the
control file label. The <br>
sourcename must be a regular file or a symlink to a regular
file.</p>

<p style="margin-top: 1em">A control file will show up
as</p>

<p style="margin-top: 1em">//--CONTROL_FILE/label</p>

<p style="margin-top: 1em">in an archive listing, where
label is the control file label.</p>

<p style="margin-top: 1em">Control scripts. A control
script is supplied to afio with the</p>

<p style="margin-top: 1em">-D controlscript</p>

<p style="margin-top: 1em">command line option. The
controlscript must be an executable program. The script is
run whenever afio encounters a control file while doing a -i
-t or -r operation. Afio will <br>
supply the control file label as an argument to the script.
The script should read the control file data from its
standard input. If the script exits with a non-zero exit
sta&acirc; <br>
tus, afio will issue a warning message.</p>

<p style="margin-top: 1em">If a control file is encountered
and no -D option is given, afio will issue a warning
message. To suppress the warning message and ignore all
control scripts, -D &quot;&quot; can be used.</p>

<p style="margin-top: 1em">An example of a control script
is</p>

<p style="margin-top: 1em">#!/bin/sh <br>
if [ $1 = &quot;afio_example.headertext&quot; ]; then <br>
#the headertext control file is supposed to be packed as the
first <br>
#entry of the archive <br>
echo Archive header: <br>
cat - <br>
echo Unpack this archive? y/n <br>
#stdout is still connected to the tty, read the reply from
stdout <br>
read yn &lt;&amp;1 <br>
if [ &quot;$yn&quot; = n ]; then <br>
#abort <br>
kill $PPID <br>
fi <br>
else <br>
echo Ignoring unknown control file. <br>
cat - &gt;/dev/null <br>
fi</p>

<p style="margin-top: 1em">Afio never compresses the
control file data when storing it in an archive, even when
the -Z option is used. When a control file is encountered by
cpio(1) or an afio with a ver&acirc; <br>
sion number below 2.4.1, the data will be unpacked to the
filesystem, and named CONTROL_FILE/label where label is the
control file label.</p>

<p style="margin-top: 1em">BUGS <br>
There are too many options.</p>

<p style="margin-top: 1em">Restricts pathnames to 1023
characters, and 255 meaningful elements (where each element
is a pathname component separated by a /).</p>

<p style="margin-top: 1em">Does not use the same default
block size as tar(1). tar(1) uses 10 KB, afio uses 5 KB by
default. Some tape drives only work with a 10 KB block size,
in that case the afio <br>
option -b 10k is needed to make the tape work.</p>

<p style="margin-top: 1em">There is no sequence information
within multi-volume archives. Input sequence errors
generally masquerade as data corruption. A solution would
probably be mutually exclusive <br>
with cpio(1) compatibility.</p>

<p style="margin-top: 1em">Degenerate uses of symbolic
links are mangled by pathname optimization. For example,
assuming that &quot;usr.src&quot; is a symbolic link to
&quot;/usr/src&quot;, the pathname
&quot;usr.src/../bin/cu&quot; <br>
is mis-optimized into &quot;bin/cu&quot; (rather than
&quot;/usr/bin/cu&quot;).</p>

<p style="margin-top: 1em">The afio code for handling
floppies (-F and -f and -K options) has buggy error
handling. afio does not allow one to retry a failed floppy
write on a different floppy, and it <br>
cannot recover from a verify error. If the floppy handling
code is used and write or verify errors do occur, it is best
to restart afio completely. Making backups to floppies <br>
should really be done with a more specialised backup program
that wraps afio.</p>

<p style="margin-top: 1em">The Linux floppy drivers below
kernel version 1.1.54 do not allow afio to find out about
floppy write errors while writing. If you are running a
kernel below 1.1.54, afio will <br>
happily fail to write to (say) a write protected disk and
not report anything wrong! The only way to find out about
write errors in this case is by watching the kernel
messages, <br>
or by switching on the verify (-K) option.</p>

<p style="margin-top: 1em">The remote archive facilites
(host:/file archive names) have not been exhaustively
tested. These facilities have seen a lot of real-life use
though. However, there may be bugs <br>
in the code for error handling and error reporting with
remote archives.</p>

<p style="margin-top: 1em">An archive created with a
command like &rsquo;find /usr/src/linux -print | afio -o
...&rsquo; will not contain the ownership and permissions of
the /usr and /usr/src directories. If these <br>
directories are missing when restoring the archive, afio
will recreate them with some default ownership and
permissions.</p>

<p style="margin-top: 1em">Afio can not restore time stamps
on symlinks. Also, on operating systems without an lchown(2)
system call, afio can not restore owner/group information on
symlinks. (Linux has <br>
lchown since kernel version 2.1.86.)</p>

<p style="margin-top: 1em">Afio tries to restore
modification time stamps of directories in the archive
correctly. However, if it exits prematurely, then the
modification times will not be restored cor&acirc; <br>
rectly.</p>

<p style="margin-top: 1em">A restore using decompression
will fail if the gzip binary used by afio is overwritten, by
afio or by another program, during the restore. The restore
will also fail if any <br>
shared libraries needed to start gzip are overwritten during
the restore. afio should not normally be used to overwrite
the system files on a running system. If it is used in <br>
this way, a flag like -Y /bin/gzip can often be added to
prevent failure.</p>

<p style="margin-top: 1em">The -r option verifies the file
contents of the files in the archive against the files on
the filesystem, but does not cross-check details like
permission bits on files, nor does <br>
it cross-check that archived directories or other non-file
entities still exist on the filesystem.</p>

<p style="margin-top: 1em">There are several problems with
archiving hard links. 1) Due to internal limitations, files
with hard links cannot be stored in compressed form, unless
the -l or -U options are <br>
used which force each hard linked file to be stored
separately. 2) Archives which contain hard links and which
were made with older (pre-2.4.8) versions of afio or with
cpio can <br>
not always be correctly unpacked. This is really a problem
in the archives and not in the current version of afio. The
risk of incorrect unpacking will be greater if the number
<br>
of files or hard links in the archives is larger. 3) In a
selective restore, if the selection predicates do not select
the first copy of a file with archive-internal hard links,
<br>
then all subsequent copies, if selected, will not be
correctly restored. 4) Unless the -4 option is used, the
inode number fields in the archive headers for files with
hard <br>
links of the archive will sometimes not contain the actual
(least significant 16 bits of) the inode number of the
original file.</p>

<p style="margin-top: 1em">Some Linux kernels no not allow
one to create a hard link to a symbolic link. afio will try
to re-create such hard links when unpacking an archive, but
might fail due to kernel <br>
restrictions.</p>

<p style="margin-top: 1em">Due to internal limitations of
afio, the use of the -U option forces the writing of file
content with each hard linked file, rather than only once
for every set of hard linked <br>
files.</p>

<p style="margin-top: 1em">When it is run without
super-user privileges, afio is not able to unpack a file
into a directory for which it has no write permissions, even
if it just created that directory <br>
itself. This can be a problem when trying to restore
directory structures created by some source code control
tools like RCS.</p>

<p style="margin-top: 1em">When block or character device
files are packed into an archive on one operating system
(e.g. Linux) and unpacked on another operating system, which
uses different sizes for the <br>
major and minor device number data types (e.g. Solaris), the
major and minor numbers of the device files will not be
restored correctly. This can be a problem if the operating
<br>
systems share a cross-mounted filesystem. A workaround is to
use tar(1) for the device files.</p>

<p style="margin-top: 1em">EXAMPLES <br>
Create an archive with compressed files: <br>
find .... | afio -o -v -Z /dev/fd0H1440</p>

<p style="margin-top: 1em">Install (unpack) an archive with
compressed files: <br>
afio -i -v -Z archive</p>

<p style="margin-top: 1em">Install (unpack) an archive with
compressed files, protecting newer existing files: <br>
afio -i -v -Z -n archive</p>

<p style="margin-top: 1em">Create an archive with
compressed files on floppy disks: <br>
find .... | afio -o -v -s 1440k -F -Z /dev/fd0H1440</p>

<p style="margin-top: 1em">Create an archive with all file
contents encrypted by pgp: <br>
export PGPPASSFD=3 <br>
find .... | afio -ovz -Z -U -P pgp -Q -fc -Q +verbose=0 -3 3
archive 3&lt;passphrasefile</p>

<p style="margin-top: 1em">Create an archive on recordable
CDs using the cdrecord utility to write each CD: <br>
find .... | afio -o -b 2048 -s325000x -v &rsquo;!cdrecord
.... -&rsquo;</p>

<p style="margin-top: 1em">Extract a single named file from
an archive on /dev/tape: <br>
afio -i -v -Z -y /home/me/thedir/thefile /dev/tape <br>
(If these do not exist yet, afio will also create the
enclosing directories home/me/myfiledir under current
working directory.)</p>

<p style="margin-top: 1em">Extract files matching a pattern
from an archive on /dev/tape: <br>
afio -i -v -Z -y &rsquo;/home/me/*&rsquo; /dev/tape <br>
(If these do not exist yet, afio will also create the
enclosing directories home/me under current working
directory.)</p>

<p style="margin-top: 1em">If your filesystem cannot handle
files larger than 2GB, but you want to make an archive on
that filesystem that is larger than 2GB, you use the
following trick to split the ar&acirc; <br>
chive into multiple files of each 1 GB: <br>
find /home | afio -o ... - | split -b1024m - archive. <br>
the files will be called archive.aa, archive.ab, etc. You
can restore the whole archive using: <br>
cat archive.* | afio -i ... - <br>
The wildcard expansion by the shell will ensure that cat
will read the parts in the right (alphabetic) order.</p>

<p style="margin-top: 1em">SEE ALSO <br>
cpio(1), find(1), tar(1), compress(1), gzip(1).</p>

<p style="margin-top: 1em">WEB SITE AND INTERNET RESOURCES
<br>
The afio home page is at
http://members.chello.nl/~k.holtman/afio.html <br>
See the home page for information on submitting questions,
bug reports, patches, etc.</p>

<p style="margin-top: 1em">AUTHORS <br>
Mark Brukhartz <br>
Jeff Buhrt <br>
Dave Gymer <br>
Andrew Stevens <br>
Koen Holtman (current maintainer) koen.holtman@ieee.org <br>
Anders Baekgaard <br>
Too many other people to list here have contributed code,
patches, ideas, and bug reports. Many of these are mentioned
in the HISTORY file that is included with the sources.</p>
 
<p style="margin-top: 1em">AFIO(1)</p>
<hr>
</body>
</html>
