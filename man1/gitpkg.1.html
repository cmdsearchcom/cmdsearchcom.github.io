<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>GITPKG(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">GITPKG(1)</td>
    <td class="head-vol">General Commands Manual</td>
    <td class="head-rtitle">GITPKG(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
gitpkg - export a Debian source package from nominated git revisions
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>gitpkg</b> <i>branch</i> [<i>origbranch</i>]
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
If <b>gitpkg</b> is run in a <b>git</b>(1) repo with a single 'branch'
  specified, then it will do a <b>git-archive</b> export of that branch to the
  <b>DEB_DIR</b> directory. If the package is Debian native it will simply
  create a source package from it. If the package has a Debian version, then an
  orig tarball will be expected to already exist for it. If an orig tarball does
  not already exist then what happens next depends on the value of the
  <b>gitpkg.create-fake-orig</b> configuration option (described below).
<div style="height: 1.00em;">&#x00A0;</div>
If <b>gitpkg</b> is invoked with two branches specified, then the first branch
  will be exported as the unpacked complete source, while the second branch will
  be exported for the orig.tar.gz. This allows all local changes to the source
  to be recorded in the resulting diff.gz if a pristine upstream branch exists
  in the repository. If an orig tarball already exists for the version at
  'branch' then what happens next depends on the value of the
  <b>gitpkg.force-overwrite-orig</b> configuration option (described below).
<div style="height: 1.00em;">&#x00A0;</div>
The ' <i>branch</i>' should always have a <i>debian</i>/ dir and may be any
  <i>tree-ish</i> object that is accepted by <b>git-archive</b>(1). The '
  <i>origbranch</i>', if supplied, should usually not have a <i>debian</i>/ dir.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="CONFIGURATION_OPTIONS"><a class="selflink" href="#CONFIGURATION_OPTIONS">CONFIGURATION
  OPTIONS</a></h1>
Almost all <b>gitpkg</b> configuration is handled using <b>git-config</b>(1)
  now. The following configuration options are supported:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg.deb-dir</b></dt>
  <dd class="It-tag">May be set to override the default destination directory
      for exported packages. Default is ' <i>../deb-packages</i>'. Available to
      hook scripts as <b>DEB_DIR</b>. This may be overridden on the command line
      with the <b>--deb-dir=</b><i>path</i> option.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg.build-rootcmd</b></dt>
  <dd class="It-tag">May be set to override the default command used to get root
      for package build operations. Default is ' <i>fakeroot</i>'. Available to
      hook scripts as <b>BUILD_ROOTCMD</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg.prebuild-target</b></dt>
  <dd class="It-tag">May be set to a target or targets from <i>debian/rules</i>
      which will be called after the debian source tree is exported, but before
      the source package is built. Some packages may use this to generate
      autoconf files or the like, which should generally not be in the repo, but
      which should be in the distributed package. The target is invoked using
      the BUILD_ROOTCMD. A common use for this hook would be to call the
      package's ' <i>clean</i>' target. This hook is unset by default since
      gitpkg 0.18. Previous to that it defaulted to the clean target. Available
      to hook scripts as <b>PREBUILD_TARGET</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg.orig-compressor</b></dt>
  <dd class="It-tag">May be set to override the default compression for an
      exported package.orig.tar. Default is ' <i>gzip</i>'. For format 3.0
      packages, valid values also include <i>xz</i> and <i>bzip2</i>. Available
      to hook scripts as <b>ORIG_COMPRESSOR</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg.orig-compress-level</b></dt>
  <dd class="It-tag">An optional compression level to use with
      <b>gitpkg.orig-compressor</b>. 1 is usually the fastest and 9 is usually
      the smallest, with the precise details of everything between being up to
      the chosen compressor. Default is unset (which will use whatever the
      compressor default is). Available to hook scripts as
      <b>ORIG_COMPRESS_LEVEL</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg.deb-compressor</b></dt>
  <dd class="It-tag">May be set to override the default compression used by
      <b>dpkg-source</b>(1) for exported packages. Default (if unset) is to use
      whatever <b>dpkg-source</b> wants to use. For format 3.0 packages, valid
      values also include <i>xz</i> and <i>bzip2</i>. Available to hook scripts
      as <b>DEB_COMPRESSOR</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg.deb-compress-level</b></dt>
  <dd class="It-tag">An optional compression level to use with
      <b>gitpkg.deb-compressor</b>. 1 is usually the fastest and 9 is usually
      the smallest, with the precise details of everything between being up to
      the chosen compressor. Default is unset (which will use whatever the
      <b>dpkg-source</b> default is, currently '9'). Available to hook scripts
      as <b>DEB_COMPRESS_LEVEL</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg.dpkg-source</b></dt>
  <dd class="It-tag">May be set to pass arbitrary options verbatim to
      <b>dpkg-source</b>(1) when building the source package. Use with caution
      and at your own risk. To pass multiple options to <b>dpkg-source</b> you
      must set this option multiple times (ie. using
      <b>git&#x00A0;config&#x00A0;--add</b> for each option) due to the
      otherwise amusing quoting requirements for options such as
      &quot;--format=3.0&#x00A0;(native)&quot;. Default is empty. Available to
      hook scripts as the indexed array <b>DPKG_SOURCE_OPTS</b>. Do not use this
      to set the <b>dpkg-source</b>(1) <b>-Z</b> or <b>-z</b> options, they
      should instead be set using the <b>deb-compressor</b> and
      <b>deb-compress-level</b> options respectively. This may be overridden on
      the command line with the <b>--dpkg-source=</b><i>arg</i> option, which
      likewise must be passed multiple times to set multiple options.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg.create-fake-orig</b></dt>
  <dd class="It-tag">Sometimes both upstream source and debian support really
      are intermingled into a single branch of the repo but you'd still like to
      make a 'non-native' package from it. <b>gitpkg</b> can fake an orig
      tarball from such a tree out of everything but the contents of the debian/
      directory. Setting this option to 'true' makes that behaviour the default
      if a single treeish is passed to <b>gitpkg</b> and no corresponding orig
      tarball is found. Setting this option to 'false' will make <b>gitpkg</b>
      fail, reporting an error, if a single treeish is passed and no orig
      tarball with the correct version already exists for it (and none was
      retrieved by a hook script prior to it being needed). If this option is
      unset then the user will be prompted for the correct thing to do if this
      situation arises. Default is unset. Available to hook scripts as
      <b>CREATE_FAKE_ORIG</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg.force-overwrite-orig</b></dt>
  <dd class="It-tag">This option controls the behaviour of <b>gitpkg</b> if an
      'origbranch' treeish is specified and the corresponding orig.tar for the
      'branch' already exists. If this is set to 'true', then the orig.tar will
      be overwritten with the repo source (to reuse an existing orig.tar simply
      call <b>gitpkg</b> with only the single debian 'branch' treeish you wish
      to export). If this is set to 'false', then it is a hard error to attempt
      to export the upstream source again when the orig.tar already exists, and
      <b>gitpkg</b> will terminate and scold you if you try. If unset you will
      be prompted about whether to overwrite it or not, and the build will
      continue using whichever of the two you selected. Default is unset.
      Available to hook scripts as <b>FORCE_OVERWRITE_ORIG</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg.keep-unpacked-source</b></dt>
  <dd class="It-tag">This option controls whether or not the unpacked source
      directory is kept after the package export and exit hook have successfully
      completed. If this is set to 'true', the unpacked source will be retained.
      If set to 'false' or unset then that directory will be removed as the
      final operation before <b>gitpkg</b> exits if all prior operations
      completed successfully. Default is unset. Available to hook scripts as
      <b>KEEP_UNPACKED_SOURCE</b>. This may be overridden on the command line
      with the <b>--keep-unpacked-source=</b><i>bool</i> option (where 'no' or
      'false' will not keep it, and any other value, including nothing, will).
    <div style="height: 1.00em;">&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="SCRIPT_HOOKS"><a class="selflink" href="#SCRIPT_HOOKS">SCRIPT
  HOOKS</a></h1>
User defined scripts can be invoked from a number of points during the package
  build process. They are sourced into <b>gitpkg</b> as bash shell snippets, in
  most cases in a subshell, so they can read state variables and perform
  external actions, but cannot alter the running configuration once a build is
  in progress. If a hook returns with a non-zero status, then <b>gitpkg</b> will
  be terminated. (Hooks that do terminate gitpkg should take some care not to
  leave too much of a mess, but also should leave enough clues intact for the
  user to diagnose and fix whatever the problem was. Useful and informative
  error messages should be barked to stderr before exiting in this way.)
<div style="height: 1.00em;">&#x00A0;</div>
Hook scripts may be installed on the host system outside of the repo tree, or
  sourced from version controlled files in the repo itself. Both methods have
  advantages and risks for different use cases. Hook scripts are activated by
  the local admin, by setting each relevant <b>git-config</b>(1) option with the
  path to the script to be executed. Paths may be absolute or relative to the
  directory which that hook is called from. If a hook is set, the script
  <b>must</b> exist when it is called. Care should be taken to only enable them
  for use by trusted source trees when hooking into files in the repo itself.
  Usually you should enable them on a per-repo basis with <b>git-config</b>(1)
  rather than at a <b>--global</b> or <b>--system</b> level.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="A_brief_admonition_against_getting_hooked:"><a class="selflink" href="#A_brief_admonition_against_getting_hooked:">A
  brief admonition against getting hooked:</a></h2>
You should avoid complicated in-package hook arrangements becoming essential for
  exporting your package source. If you need them to create a particular package
  correctly, and need strict version binding with the source being released, and
  they aren't useful to any other package at all ... then you're quite probably
  doing something, or several things, quite wrong. Else you're in such deep shit
  working around some broken build system that you don't need me to tell you
  about it. Either way, local admin has to enable your hooks before they can
  run, so if you want to be friendly to others (and yourself), then keep the
  'normal' packaging work strictly inside the usual package building tools, and
  leave the gitpkg hooks free for other local admins to wrap whatever automation
  it is <i>they</i> need around things. If a particular version of the package
  source needs some particular actions performed on it prior to the first source
  package build, then the <b>PREBUILD_TARGET</b> option from above is most
  probably what you want rather than one of these hooks. Other people can use
  that again later without needing to have gitpkg around. The aim is for this to
  Help You. For some values of All Of You. So do be careful to avoid letting it
  screw other people over if the hook isn't called, and/or let them know what
  they need to do instead if it isn't. Ok then, there's the barb to watch out
  for, so back to the point again:
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Hook_points"><a class="selflink" href="#Hook_points">Hook
  points</a></h2>
The available hook points are listed below in roughly the order that they would
  usually be invoked:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg.package-config-hook</b></dt>
  <dd class="It-tag">This hook runs in the top level directory of the repo
      <b>gitpkg</b> was invoked in, prior to any operations taking place, with
      all <b>git-config</b>(1) sourced options available to it. No detailed
      information about the package itself is available in the hook environment
      yet, not even its name or version, only the tree-ish(es) that
      <b>gitpkg</b> was passed by the user, but the hook may run its own
      self-checks based on the current (possibly 'dirty') contents of the
      working tree that <b>gitpkg</b> was invoked in.
    <div style="height: 1.00em;">&#x00A0;</div>
    This hook is able to modify the <b>gitpkg</b> configuration variables for
      subsequent operations. It can perform operations on the repo if needed,
      but since it needs to be committed to the repo before it will ever be
      called, that may not be so useful here in practice. Basically, it can do
      anything it pleases, it's just a shell script, nothing else has really
      begun yet, and it has been sourced into the topmost shell level of
      <b>gitpkg</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
    Its operation is different from the <b>admin-config-hook</b> in only one
      respect, the path to this hook <b>must</b> be relative to the TLD of the
      repo, and the revision of the file that will be sourced is checked out
      from the 'branch' tree-ish that <b>gitpkg</b> was requested to export. The
      file must exist in that version at the path given.
    <div style="height: 1.00em;">&#x00A0;</div>
    Available to hook scripts as <b>PACKAGE_CONFIG_HOOK</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg.admin-config-hook</b></dt>
  <dd class="It-tag">This hook is run after the <b>package-config-hook</b>
      returns, and differs from it in operation only by reading a static file
      from the current filesystem rather than extracting a version controlled
      one from the repo being exported.
    <div style="height: 1.00em;">&#x00A0;</div>
    This can be used by the local admin to override any package specific
      options, that may have been set by the <b>package-config-hook</b>, with
      site specific configuration. This is a policy control, not a security one.
      Security was all over when you let the <b>package-config-hook</b> run,
      this just lets you override it without having to fake up a new commit
      changing the package hook.
    <div style="height: 1.00em;">&#x00A0;</div>
    This is the last hook to run that is able to modify the <b>gitpkg</b>
      configuration and set environment options that will be visible to later
      hooks. Available to hook scripts as <b>ADMIN_CONFIG_HOOK</b>. This may be
      overridden on the command line with the
      <b>--admin-config-hook=</b><i>path</i> option.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg.pre-export-hook</b></dt>
  <dd class="It-tag">This hook runs in the top level directory of the repo,
      after the package name and version have been determined, and with the
      final package configuration including any tweaking by the previous hooks.
      It cannot alter any configuration options, only act upon them or terminate
      <b>gitpkg</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
    This can be used to do things like invoke pristine-tar or prefetch an
      existing orig tarball from some foreign source. It may perform operations
      on the repo if any such are desired, or any other last minute check that
      needs to be done before we actually get about the task of exporting the
      source we want packaged.
    <div style="height: 1.00em;">&#x00A0;</div>
    Available to hook scripts as <b>PRE_EXPORT_HOOK</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg.deb-export-hook</b></dt>
  <dd class="It-tag">This hook runs in the top level directory of the exported
      debian source, immediately after the source has been exported from the
      requested <i>tree-ish</i>, and immediately prior to the
      <b>PREBUILD_TARGET</b> being invoked (if provided). It cannot alter any
      configuration options, only act upon them or terminate <b>gitpkg</b>. If
      this hook terminates <b>gitpkg</b>, the exported source directory will be
      left on the system for the user to inspect. Subsequent invocations of
      <b>gitpkg</b> for the same release version will overwrite it though.
      Available to hook scripts as <b>DEB_EXPORT_HOOK</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg.orig-export-hook</b></dt>
  <dd class="It-tag">This hook runs in the top level directory of the exported
      'upstream' source, immediately after the source has been exported from the
      provided <i>tree-ish</i>, and prior to it being compressed into a tarball.
      It cannot alter any configuration options, only act upon them or terminate
      <b>gitpkg</b>. If this hook terminates <b>gitpkg</b>, the exported source
      directory will be left on the system for the user to inspect. Subsequent
      invocations of <b>gitpkg</b> for the same release version will overwrite
      it though.
    <div style="height: 1.00em;">&#x00A0;</div>
    This hook is <b>only</b> invoked if the upstream 'origbranch' actually is
      exported from the repository. If an existing orig.tar is found or has been
      created by some earlier hook (and it is not being overwritten, see
      <b>force-overwrite-orig</b> above), then the operations this hook would
      perform are presumed to have already happened for this tarball and it is
      skipped.
    <div style="height: 1.00em;">&#x00A0;</div>
    It is not safe to assume that this hook will be executed before or after
      <b>deb-export-hook</b>, and it may in fact be run in parallel with it at
      some point in the future. They both will be entered after
      <b>pre-export-hook</b> returns, and <b>exit-hook</b> will not begin until
      (at least) after both have returned. What else happens in the middle of
      all that we make no firm promises about at this stage.
    <div style="height: 1.00em;">&#x00A0;</div>
    Available to hook scripts as <b>ORIG_EXPORT_HOOK</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg.exit-hook</b></dt>
  <dd class="It-tag">This hook runs in the directory where the package
      <i>.dsc</i> was deposited by <b>dpkg-source</b>(1), after all internal
      <b>gitpkg</b> operations have successfully completed. It's too late to
      alter any configuration options, or even to terminate <b>gitpkg</b>
      really. You can pretty much do what you like from this one, anything that
      goes wrong from here on is your own doing. Available to hook scripts as
      <b>EXIT_HOOK</b>. This may be overridden on the command line with the
      <b>--exit-hook=</b><i>path</i> option.
    <div style="height: 1.00em;">&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="Hook_Environment"><a class="selflink" href="#Hook_Environment">Hook
  Environment</a></h2>
The following variables are made available for hook scripts, in addition to
  those already listed as shadowing a <b>git-config</b> option from above. Not
  all of them are valid/useful at all hook points, see the hook documentation
  above for the exceptions applying to specific hooks.
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>GITPKG_HOOK_API</b></dt>
  <dd class="It-tag">Permits hook scripts to query what interfaces are available
      to them. Has only two numeric components separated by a '.' of which the
      number to the right of point will get incremented every time we add some
      new variable a hook might access, or add some new knob it might tweak
      where existing interfaces have not have changed. If we do screw up and
      need to change some current interface, the number to the left will get
      bumped. The current API version is 0.2
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="Available_in_API_version_0.1"><a class="selflink" href="#Available_in_API_version_0.1">Available
  in API version 0.1</a></h2>
These variables have been available to hooks since gitpkg version 0.13
<dl class="Bl-tag">
  <dt class="It-tag"><b>GITPKG_TREEISH</b></dt>
  <dd class="It-tag">The user-passed debian 'branch' tree-ish that gitpkg was
      invoked to export.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>GITPKG_ORIG_TREEISH</b></dt>
  <dd class="It-tag">The 'origbranch' tree-ish that gitpkg was invoked with.
      This will be empty if only a single 'branch' tree-ish was specified.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>DEB_SOURCE</b></dt>
  <dd class="It-tag">The name of the source package to create, without any
      versioning. As seen in the Source: field of <b>dpkg-parsechangelog</b>(1).
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>DEB_VERSION</b></dt>
  <dd class="It-tag">The version of the source package to create, without any
      epoch. As seen in the name of the .diff.gz and .dsc files.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>UPSTREAM_VERSION</b></dt>
  <dd class="It-tag">The version of the source package to create, without any
      debian version. As seen in the name of the orig tarball. For native
      packages this will be the same as <b>DEB_VERSION</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>DEB_ORIG</b></dt>
  <dd class="It-tag">The full versioned filename of the orig tarball to use or
      create. This variable is empty for native packages without a Debian
      version part.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>DEB_DSC</b></dt>
  <dd class="It-tag">The full filename of the package <i>.dsc</i> that will be
      or has been created.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>DEB_PACKAGE</b></dt>
  <dd class="It-tag">The directory name of the debianised source tree to pass to
      <b>dpkg-source</b>(1).
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>REPO_DIR</b></dt>
  <dd class="It-tag">An absolute path to the top level directory of the git repo
      we are exporting from. Usually, if you need to look out of the tree that
      you were dropped in, you're probably doing something (at the) wrong
      (time), but there are exceptions, and being able to query
      <b>git-config</b> options is one of them. That's mostly what this one is
      for right now. See the <b>repo-config-helper</b> documented below. Be
      careful if you do use it for much else.
    <div style="height: 1.00em;">&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="Available_in_API_version_0.2"><a class="selflink" href="#Available_in_API_version_0.2">Available
  in API version 0.2</a></h2>
These variables have been available to hooks since gitpkg version 0.24
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>GITPKG_AOPTS</b></dt>
  <dd class="It-tag">An associative array containing the command line options
      not parsed by <b>gitpkg</b> itself which can be used to override the
      behaviour of a hook. The array is keyed on the names of the options with
      the '--' removed. If an option was passed multiple times, only the last
      value passed will be stored in this array. For example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 $ gitpkg --my-option=foo --option2 --opt=oops --opt='bar baz'
<div class="Pp"></div>
Will give:
<div class="Pp"></div>
 ${GITPKG_AOPTS[my-option]} = &quot;foo&quot;
 ${GITPKG_AOPTS[option2]}   = &quot;&quot;
 ${GITPKG_AOPTS[opt]}       = &quot;bar baz&quot;
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>GITPKG_IOPTS</b></dt>
  <dd class="It-tag">An indexed array containing the command line options not
      parsed by <b>gitpkg</b> itself which can be used to override the behaviour
      of a hook. The array contains the literal option strings passed and so can
      be used to access options which are intended to be passed multiple times.
      For example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 $ gitpkg --my-option=foo --option2 --opt=oops --opt='bar baz'
<div class="Pp"></div>
Will give:
<div class="Pp"></div>
 ${GITPKG_IOPTS[0]} = &quot;--my-option=foo&quot;
 ${GITPKG_IOPTS[1]} = &quot;--option2&quot;
 ${GITPKG_IOPTS[2]} = &quot;--opt=oops&quot;
 ${GITPKG_IOPTS[3]} = &quot;--opt=bar baz&quot;
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    The <b>extract_values_for_option</b> function in <b>repo-config-helper</b>
      (see below for details of it) can be used to further parse this array to
      obtain all the value(s) for a specific option.
    <div style="height: 1.00em;">&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="Hook_Library"><a class="selflink" href="#Hook_Library">Hook
  Library</a></h2>
There are some canned hook scripts for various tasks available in
  <i>/usr/share/gitpkg/hooks</i> which currently include:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>cowpoke-exit-hook</b></dt>
  <dd class="It-tag">A simple exit hook which sends the exported package off for
      building using <b>cowpoke</b>(1). To enable it:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 $ git config gitpkg.exit-hook /usr/share/gitpkg/hooks/cowpoke-exit-hook
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Additional <b>git-config</b>(1) configuration options:
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg-cowpoke-exit-hook.ask-first</b></dt>
  <dd class="It-tag">If 'true' prompt for confirmation before calling
      <b>cowpoke</b>. Default is to just go ahead and do it.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg-cowpoke-exit-hook.options</b></dt>
  <dd class="It-tag">May include any other options to pass verbatim to
      <b>cowpoke</b>. To pass multiple options, set this multiple times, once
      for each option. This may be overridden on the command line with the
      <b>--cowpoke=</b><i>arg</i> option, which likewise must be passed multiple
      times to set multiple options.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>dpkg-buildpackage-exit-hook</b></dt>
  <dd class="It-tag">A simple exit hook to build binary packages locally with
      <b>dpkg-buildpackage</b>(1). To enable it:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 $ git config gitpkg.exit-hook /usr/share/gitpkg/hooks/dpkg-buildpackage-exit-hook
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Additional <b>git-config</b>(1) configuration options:
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg-dpkg-buildpackage-exit-hook.ask-first</b></dt>
  <dd class="It-tag">If 'true' prompt for confirmation before calling
      <b>dpkg-buildpackage</b>. Default is to just do it.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg-dpkg-buildpackage-exit-hook.options</b></dt>
  <dd class="It-tag">May include any other options to pass verbatim to
      <b>dpkg-buildpackage</b>. To pass multiple options, set this multiple
      times, once for each option. This may be overridden on the command line
      with the <b>--dpkg-bp=</b><i>arg</i> option, which likewise must be passed
      multiple times to set multiple options.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gitpkg-dpkg-buildpackage-exit-hook.build-log</b></dt>
  <dd class="It-tag">If set 'false' don't save a log of the build process, the
      default is to record one.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>pristine-tar-pre-export-hook</b></dt>
  <dd class="It-tag">A hook to extract an orig tarball using pristine-tar. Which
      orig to extract is determined by the package version of the 'branch'
      tree-ish. To enable it:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 $ git config gitpkg.pre-export-hook /usr/share/gitpkg/hooks/pristine-tar-pre-export-hook
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    If a pristine-tar branch is not found in the repo, then gitpkg will be
      terminated.
    <div style="height: 1.00em;">&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>quilt-patches-deb-export-hook</b></dt>
  <dd class="It-tag">This hook reads a list of revision ranges suitable for
      <b>git-format-patch</b>(1) from the file <i>debian/source/git-patches</i>,
      one per line, and exports them to the <i>debian/patches</i> directory in a
      form suitable for (format 3.0) quilt packages. It is not required for
      creating such packages, but permits you to separate out individual patches
      however you please from the default single patch that is otherwise created
      by <b>dpkg-source</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
    To enable it:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 $ git config gitpkg.deb-export-hook /usr/share/gitpkg/hooks/quilt-patches-deb-export-hook
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    The contents of <i>debian/source/git-patches</i> may include comments (on
      any line beginning with a #), empty lines, and expressions of a range of
      commits. The revision ranges may include <b>$DEB_VERSION</b>,
      <b>$UPSTREAM_VERSION</b>, <b>$DEB_REF</b> or <b>$UPSTREAM_REF</b>. The
      first pair will be substituted with the version of the package being
      exported, the second pair with those version strings after mangling by
      <b>sanitise_git_ref</b> to remap them to a legal git <i>refname</i>. Using
      the sanitised versions is to be preferred in most cases. For example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 # Export all commits between these two treeishes,
 # based on the version of the package being exported.
<div class="Pp"></div>
 upstream/$UPSTREAM_REF..patches/$DEB_REF
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>debcherry-deb-export-hook</b></dt>
  <dd class="It-tag">This hook invokes <b>git-debcherry</b>(1) to find and
      export patches to the upstream source in a form suitable for use with
      (format 3.0) quilt packages. It allows for a more natural (and automatic)
      workflow than the quilt-patches hook above by searching for patches made
      to the packaging branch that have not yet been applied upstream.
    <div style="height: 1.00em;">&#x00A0;</div>
    To enable it:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 $ git config gitpkg.deb-export-hook /usr/share/gitpkg/hooks/debcherry-deb-export-hook
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    In order to use this hook, a <b>${DEB_ORIG}.commit</b> file must be created
      which contains the treeish of the exported upstream source in the
      repository. This will be created automatically (if this hook is enabled)
      when you export an upstream tarball by passing both <i>branch</i> and
      <i>origbranch</i> to <b>gitpkg</b>, or if you use the
      <b>pristine-tar-pre-export-hook</b>, which determines an appropriate
      commit corresponding to the tarball. If your upstream tarball is created
      using some other mechanism you will need to ensure that file is created
      yourself.
    <div style="height: 1.00em;">&#x00A0;</div>
    If using this hook, you may wish to document that in your repository with
      something similar to the text in
      <i>/usr/share/doc/gitpkg/examples/README.debcherry-export</i> as a
      convenience to other users. Your package will still be exportable without
      this hook enabled, it just won't have the upstream patches individually
      separated out into a quilt series.
    <div style="height: 1.00em;">&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="Hook_Library_Helpers"><a class="selflink" href="#Hook_Library_Helpers">Hook
  Library Helpers</a></h2>
These are even more trivial snippets, for operations which may be shared by
  several scripts. Also found in <i>/usr/share/gitpkg/hooks</i>. Usually these
  would be sourced by other scripts rather than being hooked to directly.
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>repo-config-helper</b></dt>
  <dd class="It-tag">Provides a simple wrapper around `<b>git config</b>`, which
      ensures it is called from the repo tree where any repo-specific config
      options may be stored. Useful to scripts which aren't called from inside
      the repo tree, but which do have <b>git-config</b> options of their own to
      query.
    <div style="height: 1.00em;">&#x00A0;</div>
    Provides the <b>sanitise_git_ref</b> shell function which remaps character
      strings that are illegal to use in a git refname.
    <div style="height: 1.00em;">&#x00A0;</div>
    Provides the <b>extract_values_for_option</b> shell function which can be
      used to extract an array of the values for a particular option from
      <b>GITPKG_IOPTS</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
    See the content of that file itself for more detailed documentation on the
      functions that it provides.
    <div style="height: 1.00em;">&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="INTERACTIVIY"><a class="selflink" href="#INTERACTIVIY">INTERACTIVIY</a></h1>
If you intend to call <b>gitpkg</b> from your own scripts, then you should note
  that there are two situations when it may prompt interactively by default.
  There is no One True Sane Default for these cases, so it's better to just ask
  the user and continue than to make them start the whole process again in the
  likely case where they have called <b>gitpkg</b> directly. For details, see
  the <b>gitpkg.force-overwrite-orig</b> and <b>gitpkg.create-fake-orig</b>
  config options above. You should set both explicitly to the behaviour that you
  desire from them if <b>gitpkg</b> should never become interactive.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="WORKFLOW"><a class="selflink" href="#WORKFLOW">WORKFLOW</a></h1>
Though <b>gitpkg</b> explicitly does not try to force any particular workflow
  procedure upon you in order to make full use of it, it probably is worth
  making quick mention of at least one simple way to manage Debian packages in
  git.
<div style="height: 1.00em;">&#x00A0;</div>
One common repo structure is to keep pristine upstream source on one branch,
  which is updated either directly from an upstream repo or by importing tar
  archives to it periodically, with the Debian patched source on another branch.
  In this situation the task of preparing a new upstream release from a tarball
  might look a bit like this:
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 Check out the upstream branch
<br/>
 $ cd myrepo
<br/>
 $ git checkout upstream
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 Remove all old upstream files from the repo
<br/>
 $ rm -rf $(all_files_except .git)
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 Unpack the new tarball in their place
<br/>
 $ tar zxf $new_upstream.tar.gz
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 Let git figure out what is renamed/new/gone by itself.
<br/>
 Make sure you don't have things like vim .swp files lurking
<br/>
 in the tree still at this point.
<br/>
 $ git add .
<br/>
 $ git commit -a
<br/>
 $ git tag v$upstream_version
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 Prepare the Debian branch
<br/>
 $ git checkout debian
<br/>
 $ git merge upstream
<br/>
 $ $(update changelog and other debian patches etc.)
<br/>
 $ git commit -a
<br/>
 $ git tag v${upstream_version}-$debian_version
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 Make a release
<br/>
 $ gitpkg v${upstream_version}-$debian_version v$upstream_version
<br/>
 $ cd ../deb-packages/mypackage &amp;&amp; dpkg-buildpackage ...
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>git-debimport</b>(1), <b>git-debcherry</b>(1), <b>git</b>(1),
  <b>git-archive</b>(1), <b>git-config</b>(1), <b>git-format-patch</b>(1),
  <b>gitattributes</b>(5), <b>dpkg-source</b>(1), <b>cowpoke</b>(1).
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
<b>gitpkg</b> was written by Ron &lt;ron@debian.org&gt;.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">September 28, 2014</td>
    <td class="foot-os"></td>
  </tr>
</table>
</body>
</html>
