<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>t.rast.aggregate.ds(1grass)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">t.rast.aggregate.ds(1grass)</td>
    <td class="head-vol">Grass User's Manual</td>
    <td class="head-rtitle">t.rast.aggregate.ds(1grass)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
<i></i><b>t.rast.aggregate.ds</b> - Aggregates data of an existing space time
  raster dataset using the time intervals of a second space time dataset.
<h1 class="Sh" title="Sh" id="KEYWORDS"><a class="selflink" href="#KEYWORDS">KEYWORDS</a></h1>
temporal, aggregation, raster, time
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>t.rast.aggregate.ds</b>
<div>&#x00A0;</div>
<b>t.rast.aggregate.ds --help</b>
<div>&#x00A0;</div>
<b>t.rast.aggregate.ds</b> [-<b>n</b>] <b>input</b>=<i>name</i>
  <b>sample</b>=<i>name</i> [<b>type</b>=<i>name</i>] <b>output</b>=<i>name</i>
  <b>basename</b>=<i>string</i> [<b>suffix</b>=<i>string</i>]
  <b>method</b>=<i>string</i> [ <b>offset</b>=<i>integer</i>]
  [<b>nprocs</b>=<i>integer</i>] [
  <b>sampling</b>=<i>name</i>[,<i>name</i>,...]] [
  <b>where</b>=<i>sql_query</i>] [-- <b>overwrite</b>] [--<b>help</b>]
  [--<b>verbose</b>] [-- <b>quiet</b>] [--<b>ui</b>]
<h2 class="Ss" title="Ss" id="Flags:"><a class="selflink" href="#Flags:">Flags:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-n</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Register Null maps</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--overwrite</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Allow output files to overwrite existing files</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--help</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Print usage summary</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--verbose</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Verbose module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--quiet</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Quiet module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ui</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Force launching GUI dialog</dd>
</dl>
<h2 class="Ss" title="Ss" id="Parameters:"><a class="selflink" href="#Parameters:">Parameters:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>input</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of the input space time raster dataset</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>sample</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Time intervals from this space time dataset (raster, vector or raster3d) are
      used for aggregation computation</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>type</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Type of the space time dataset from which aggregation will be copied
    <div>&#x00A0;</div>
    Options: <i>strds, stvds, str3ds</i>
    <div>&#x00A0;</div>
    Default: <i>strds</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>output</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of the output space time raster dataset</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>basename</b>=<i>string</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Basename of the new generated output maps
    <div>&#x00A0;</div>
    A numerical suffix separated by an underscore will be attached to create a
      unique identifier</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>suffix</b>=<i>string</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Suffix to add at basename: set &#x2019;gran&#x2019; for granularity,
      &#x2019;time&#x2019; for the full time format, &#x2019;num&#x2019; for
      numerical suffix with a specific number of digits (default %05)
    <div>&#x00A0;</div>
    Default: <i>gran</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>method</b>=<i>string</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Aggregate operation to be performed on the raster maps
    <div>&#x00A0;</div>
    Options: <i>average, count, median, mode, minimum, min_raster, maximum,
      max_raster, stddev, range, sum, variance, diversity, slope, offset,
      detcoeff, quart1, quart3, perc90, quantile, skewness, kurtosis</i>
    <div>&#x00A0;</div>
    Default: <i>average</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>offset</b>=<i>integer</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Offset that is used to create the output map ids, output map id is generated
      as: basename_ (count + offset)
    <div>&#x00A0;</div>
    Default: <i>0</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>nprocs</b>=<i>integer</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Number of r.mapcalc processes to run in parallel
    <div>&#x00A0;</div>
    Default: <i>1</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>sampling</b>=<i>name[,</i><i>name</i>,...]</dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    The method to be used for sampling the input dataset
    <div>&#x00A0;</div>
    Options: <i>equal, overlaps, overlapped, starts, started, finishes,
      finished, during, contains</i>
    <div>&#x00A0;</div>
    Default: <i>contains</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>where</b>=<i>sql_query</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    WHERE conditions of SQL statement without &#x2019;where&#x2019; keyword used
      in the temporal GIS framework
    <div>&#x00A0;</div>
    Example: start_time &gt; &#x2019;2001-01-01 12:30:00&#x2019;</dd>
</dl>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<i>t.rast.aggregate.ds</i> works like t.rast.aggregate but instead of defining a
  fixed granularity for temporal aggregation the time intervals of all maps
  registered in a second space time dataset (can be STRDS, STR3DS or STVDS) are
  used to aggregate the maps of the input space time raster dataset.
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
The sampling method must be specified from the sampler dataset point of view. It
  defines the temporal relationships between intervals of the sampling dataset
  and the input space time raster dataset.
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
<h2 class="Ss" title="Ss" id="Precipitation_aggregation"><a class="selflink" href="#Precipitation_aggregation">Precipitation
  aggregation</a></h2>
In this example we create 7 raster maps that will be registered in a single
  space time raster dataset named <i>precipitation_daily</i> using a daily
  temporal granularity. The names of the raster maps are stored in a text file
  that is used for raster map registration.
<div class="Pp"></div>
A space time vector dataset is created out of two vector maps with different
  temporal resolution. The maps are created using v.random. The first map has a
  granule of 3 days the second a granule of 4 days.
<div class="Pp"></div>
The space time raster dataset <i>precipitation_daily</i> with daily temporal
  granularity will be aggregated using the space time vector dataset resulting
  in the output space time raster dataset <i>precipitation_agg</i>. The
  aggregation method is set to <i>sum</i> to accumulate the precipitation values
  of all intervals in the space time vector dataset. The sampling option assures
  that only raster maps that are temporally during the time intervals of the
  space time vector dataset are considered for computation. Hence the option is
  set to contains (time stamped vector map layers temporally <b>contain</b> the
  raster map layers):
<div>&#x00A0;</div>
<pre>
MAPS=&quot;map_1 map_2 map_3 map_4 map_5 map_6 map_7&quot;
for map in ${MAPS} ; do
    r.mapcalc expression=&quot;${map} = 1&quot;
    echo ${map} &gt;&gt; map_list.txt
done
t.create type=strds temporaltype=absolute \
         output=precipitation_daily \
         title=&quot;Daily precipitation&quot; \
         description=&quot;Test dataset with daily precipitation&quot;
t.register -i type=raster input=precipitation_daily \
           file=map_list.txt start=&quot;2012-08-20&quot; increment=&quot;1 days&quot;
t.info type=strds input=precipitation_daily
 +-------------------- Space Time Raster Dataset -----------------------------+
 |                                                                            |
 +-------------------- Basic information -------------------------------------+
 | Id: ........................ precipitation_daily@PERMANENT
 | Name: ...................... precipitation_daily
 | Mapset: .................... PERMANENT
 | Creator: ................... soeren
 | Temporal type: ............. absolute
 | Creation time: ............. 2014-11-23 16:48:17.686979
 | Modification time:.......... 2014-11-23 16:48:18.302978
 | Semantic type:.............. mean
 +-------------------- Absolute time -----------------------------------------+
 | Start time:................. 2012-09-10 00:00:00
 | End time:................... 2012-09-17 00:00:00
 | Granularity:................ 1 day
 | Temporal type of maps:...... interval
 +-------------------- Spatial extent ----------------------------------------+
 | North:...................... 80.0
 | South:...................... 0.0
 | East:.. .................... 120.0
 | West:....................... 0.0
 | Top:........................ 0.0
 | Bottom:..................... 0.0
 +-------------------- Metadata information ----------------------------------+
 | Raster register table:...... raster_map_register_3225725979b14b5db343a00835b882c7
 | North-South resolution min:. 10.0
 | North-South resolution max:. 10.0
 | East-west resolution min:... 10.0
 | East-west resolution max:... 10.0
 | Minimum value min:.......... 1.0
 | Minimum value max:.......... 1.0
 | Maximum value min:.......... 1.0
 | Maximum value max:.......... 1.0
 | Aggregation type:........... None
 | Number of registered maps:.. 7
 |
 | Title:
 | Daily precipitation
 | Description:
 | Test dataset with daily precipitation
 | Command history:
 | # 2014-11-23 16:48:17
 | t.create type=&quot;strds&quot; temporaltype=&quot;absolute&quot;
 |     output=&quot;precipitation_daily&quot; title=&quot;Daily precipitation&quot;
 |     description=&quot;Test dataset with daily precipitation&quot;
 | # 2014-11-23 16:48:18
 | t.register -i type=&quot;rast&quot; input=&quot;precipitation_daily&quot;
 |     file=&quot;map_list.txt&quot; start=&quot;2012-08-20&quot; increment=&quot;1 days&quot;
 |
 +----------------------------------------------------------------------------+
v.random output=points_1 n=20
v.random output=points_2 n=20
t.create type=stvds temporaltype=absolute \
         output=points \
         title=&quot;Points&quot; \
         description=&quot;Points for aggregation&quot;
t.register -i type=vector input=points \
           map=points_1 start=&quot;2012-08-20&quot; increment=&quot;3 days&quot;
t.register -i type=vector input=points \
           map=points_2 start=&quot;2012-08-23&quot; increment=&quot;4 days&quot;
t.info type=stvds input=points
 +-------------------- Space Time Vector Dataset -----------------------------+
 |                                                                            |
 +-------------------- Basic information -------------------------------------+
 | Id: ........................ points@PERMANENT
 | Name: ...................... points
 | Mapset: .................... PERMANENT
 | Creator: ................... soeren
 | Temporal type: ............. absolute
 | Creation time: ............. 2014-11-23 16:48:49.193903
 | Modification time:.......... 2014-11-23 16:48:50.185671
 | Semantic type:.............. mean
 +-------------------- Absolute time -----------------------------------------+
 | Start time:................. 2012-08-20 00:00:00
 | End time:................... 2012-08-27 00:00:00
 | Granularity:................ 1 day
 | Temporal type of maps:...... interval
 +-------------------- Spatial extent ----------------------------------------+
 | North:...................... 79.283411
 | South:...................... 5.724954
 | East:.. .................... 118.881168
 | West:....................... 0.016755
 | Top:........................ 0.0
 | Bottom:..................... 0.0
 +-------------------- Metadata information ----------------------------------+
 | Vector register table:...... vector_map_register_6f02d33e0ee243d1a521aaaca39ecb31
 | Number of points ........... 40
 | Number of lines ............ 0
 | Number of boundaries ....... 0
 | Number of centroids ........ 0
 | Number of faces ............ 0
 | Number of kernels .......... 0
 | Number of primitives ....... 40
 | Number of nodes ............ 0
 | Number of areas ............ 0
 | Number of islands .......... 0
 | Number of holes ............ 0
 | Number of volumes .......... 0
 | Number of registered maps:.. 2
 |
 | Title:
 | Points
 | Description:
 | Points for aggregation
 | Command history:
 | # 2014-11-23 16:48:49
 | t.create type=&quot;stvds&quot; temporaltype=&quot;absolute&quot;
 |     output=&quot;points&quot; title=&quot;Points&quot; description=&quot;Points for aggregation&quot;
 | # 2014-11-23 16:48:49
 | t.register -i type=&quot;vect&quot; input=&quot;points&quot;
 |     map=&quot;points_1&quot; start=&quot;2012-08-20&quot; increment=&quot;3 days&quot;
 | # 2014-11-23 16:48:50
 | t.register -i type=&quot;vect&quot; input=&quot;points&quot;
 |     map=&quot;points_2&quot; start=&quot;2012-08-23&quot; increment=&quot;4 days&quot;
 |
 +----------------------------------------------------------------------------+
t.rast.aggregate.ds input=precipitation_daily \
                    output=precipitation_agg \
                    sample=points type=stvds \
                    basename=prec_agg \
                    method=sum sampling=contains
t.support input=precipitation_agg \
          title=&quot;Aggregated precipitation&quot; \
          description=&quot;Aggregated precipitation dataset&quot;
t.info type=strds input=precipitation_agg
 +-------------------- Space Time Raster Dataset -----------------------------+
 |                                                                            |
 +-------------------- Basic information -------------------------------------+
 | Id: ........................ precipitation_agg@PERMANENT
 | Name: ...................... precipitation_agg
 | Mapset: .................... PERMANENT
 | Creator: ................... soeren
 | Temporal type: ............. absolute
 | Creation time: ............. 2014-11-23 16:53:23.488799
 | Modification time:.......... 2014-11-23 16:53:28.714886
 | Semantic type:.............. mean
 +-------------------- Absolute time -----------------------------------------+
 | Start time:................. 2012-08-20 00:00:00
 | End time:................... 2012-08-27 00:00:00
 | Granularity:................ 1 day
 | Temporal type of maps:...... interval
 +-------------------- Spatial extent ----------------------------------------+
 | North:...................... 80.0
 | South:...................... 0.0
 | East:.. .................... 120.0
 | West:....................... 0.0
 | Top:........................ 0.0
 | Bottom:..................... 0.0
 +-------------------- Metadata information ----------------------------------+
 | Raster register table:...... raster_map_register_7b025eb7431747c98c5c1ad971e8c282
 | North-South resolution min:. 10.0
 | North-South resolution max:. 10.0
 | East-west resolution min:... 10.0
 | East-west resolution max:... 10.0
 | Minimum value min:.......... 3.0
 | Minimum value max:.......... 4.0
 | Maximum value min:.......... 3.0
 | Maximum value max:.......... 4.0
 | Aggregation type:........... sum
 | Number of registered maps:.. 2
 |
 | Title:
 | Aggregated precipitation
 | Description:
 | Aggregated precipitation dataset
 | Command history:
 | # 2014-11-23 16:53:23
 | t.rast.aggregate.ds input=&quot;precipitation_daily&quot;
 |     output=&quot;precipitation_agg&quot; sample=&quot;points&quot; type=&quot;stvds&quot; basename=&quot;prec_agg&quot;
 |     method=&quot;sum&quot; sampling=&quot;contains&quot;
 | # 2014-11-23 16:53:28
 | t.support input=&quot;precipitation_agg&quot;
 |     title=&quot;Aggregated precipitation&quot;
 |     description=&quot;Aggregated precipitation dataset&quot;
 |
 +----------------------------------------------------------------------------+
</pre>
<h2 class="Ss" title="Ss" id="MODIS_satellite_sensor_daily_data_aggregation_to_8_days"><a class="selflink" href="#MODIS_satellite_sensor_daily_data_aggregation_to_8_days">MODIS
  satellite sensor daily data aggregation to 8 days</a></h2>
In this example the aggregation from daily data to eight days is shown. This
  &quot;eight-day week&quot; is used in some MODIS satellite sensor products.
<div>&#x00A0;</div>
<pre>
# NOTE: the example is written in shell language
# create maps every 8 days as seed maps
for year in `seq 2000 2001` ; do
   for doy in `seq -w 1 8 365` ; do
      r.mapcalc -s expression=&quot;8day_${year}_${doy} = rand(0.0,40.0)&quot;
   done
done
# From de name of each map, we take year and doy, and convert it
# to a YYYY-MM-DD date for start and end, and create a file with
# mapnames, start date and end date
g.list type=raster pattern=8day_20??_* &gt; names_list
for NAME in `cat names_list` ; do
   # Parse
   YEAR=`echo $NAME | cut -d&#x2019;_&#x2019; -f2`
   DOY=`echo $NAME | cut -d&#x2019;_&#x2019; -f3`
   # convert YYYY_DOY to YYYY-MM-DD
   DOY=`echo &quot;$DOY&quot; | sed &#x2019;s/^0*//&#x2019;`
   doy_end=0
   if [ $DOY -le &quot;353&quot; ] ; then
      doy_end=$(( $DOY + 8 ))
   elif [ $DOY -eq &quot;361&quot; ] ; then
      if [ $[$YEAR % 4] -eq 0 ] &amp;&amp; [ $[$YEAR % 100] -ne 0 ] || [ $[$YEAR % 400] -eq 0 ] ; then
         doy_end=$(( $DOY + 6 ))
      else
	     doy_end=$(( $DOY + 5 ))
      fi
   fi
   DATE_START=`date -d &quot;${YEAR}-01-01 +$(( ${DOY} - 1 ))days&quot; +%Y-%m-%d`
   DATE_END=`date -d &quot;${YEAR}-01-01 +$(( ${doy_end} -1 ))days&quot; +%Y-%m-%d`
   # text file with mapnames, start date and end date
   echo &quot;$NAME|$DATE_START|$DATE_END&quot; &gt;&gt; list_map_start_end_time.txt
done
# check the list created.
cat list_map_start_end_time.txt
8day_2000_001|2000-01-01|2000-01-09
8day_2000_009|2000-01-09|2000-01-17
...
8day_2000_353|2000-12-18|2000-12-26
8day_2000_361|2000-12-26|2001-01-01
8day_2001_001|2001-01-01|2001-01-09
8day_2001_009|2001-01-09|2001-01-17
...
8day_2001_345|2001-12-11|2001-12-19
8day_2001_353|2001-12-19|2001-12-27
8day_2001_361|2001-12-27|2002-01-01
# all maps except for the last map in each year represent 8-days
# intervals. But the aggregation starts all over again every
# January 1st.
# create 8-day MODIS-like strds
t.create type=strds temporaltype=absolute \
   output=8day_ts title=&quot;8 day time series&quot; \
   description=&quot;STRDS with MODIS like 8 day aggregation&quot;
# register maps
t.register type=raster input=8day_ts \
   file=list_map_start_end_time.txt
# check
t.info input=8day_ts
t.rast.list input=8day_ts
# finally, copy the aggregation to a daily time series
t.rast.aggregate.ds input=daily_ts sample=8day_ts \
   output=8day_agg basename=8day_agg method=average \
   sampling=contains suffix=gran
# add metadata
t.support input=8day_agg \
   title=&quot;8 day aggregated ts&quot; \
   description=&quot;8 day MODIS-like aggregated dataset&quot;
# check map list in newly created aggregated strds
t.rast.list input=8day_agg
name|mapset|start_time|end_time
8day_agg_2000_01_01|modis|2000-01-01 00:00:00|2000-01-09 00:00:00
8day_agg_2000_01_09|modis|2000-01-09 00:00:00|2000-01-17 00:00:00
8day_agg_2000_01_17|modis|2000-01-17 00:00:00|2000-01-25 00:00:00
...
8day_agg_2000_12_18|modis|2000-12-18 00:00:00|2000-12-26 00:00:00
8day_agg_2000_12_26|modis|2000-12-26 00:00:00|2001-01-01 00:00:00
8day_agg_2001_01_01|modis|2001-01-01 00:00:00|2001-01-09 00:00:00
...
8day_agg_2001_12_11|modis|2001-12-11 00:00:00|2001-12-19 00:00:00
8day_agg_2001_12_19|modis|2001-12-19 00:00:00|2001-12-27 00:00:00
8day_agg_2001_12_27|modis|2001-12-27 00:00:00|2002-01-01 00:00:00
</pre>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<i></i> <i>t.rast.aggregate,</i> <i>t.create,</i> <i>t.info</i> <i></i>
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
S&#x00F6;ren Gebbert, Th&#x00FC;nen Institute of Climate-Smart Agriculture
<div class="Pp"></div>
<i>Last changed: $Date: 2016-09-19 12:30:10 +0200 (Mon, 19 Sep 2016) $</i>
<h1 class="Sh" title="Sh" id="SOURCE_CODE"><a class="selflink" href="#SOURCE_CODE">SOURCE
  CODE</a></h1>
Available at: t.rast.aggregate.ds source code (history)
<div class="Pp"></div>
Main index | Temporal index | Topics index | Keywords index | Graphical index |
  Full index
<div class="Pp"></div>
&#x00A9; 2003-2016 GRASS Development Team, GRASS GIS 7.2.0 Reference
  Manual</div>
<table class="foot">
  <tr>
    <td class="foot-date"></td>
    <td class="foot-os">GRASS 7.2.0</td>
  </tr>
</table>
</body>
</html>
