<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>i.segment(1grass)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">i.segment(1grass)</td>
    <td class="head-vol">Grass User's Manual</td>
    <td class="head-rtitle">i.segment(1grass)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
<i></i><b>i.segment</b> - Identifies segments (objects) from imagery data.
<h1 class="Sh" title="Sh" id="KEYWORDS"><a class="selflink" href="#KEYWORDS">KEYWORDS</a></h1>
imagery, segmentation, classification, object recognition
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>i.segment</b>
<div>&#x00A0;</div>
<b>i.segment --help</b>
<div>&#x00A0;</div>
<b>i.segment</b> [-<b>dw</b>] <b>group</b>=<i>name</i> <b>output</b>=<i>name</i>
  <b>threshold</b>=<i>float</i> [<b>method</b>=<i>string</i>]
  [<b>similarity</b>= <i>string</i>] [<b>minsize</b>=<i>integer</i>]
  [<b>memory</b>= <i>integer</i>] [<b>iterations</b>=<i>integer</i>]
  [<b>seeds</b>= <i>name</i>] [<b>bounds</b>=<i>name</i>]
  [<b>goodness</b>=<i>name</i>] [-- <b>overwrite</b>] [--<b>help</b>]
  [--<b>verbose</b>] [-- <b>quiet</b>] [--<b>ui</b>]
<h2 class="Ss" title="Ss" id="Flags:"><a class="selflink" href="#Flags:">Flags:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-d</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Use 8 neighbors (3x3 neighborhood) instead of the default 4 neighbors for
      each pixel</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-w</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Weighted input, do not perform the default scaling of input raster maps</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--overwrite</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Allow output files to overwrite existing files</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--help</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Print usage summary</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--verbose</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Verbose module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--quiet</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Quiet module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ui</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Force launching GUI dialog</dd>
</dl>
<h2 class="Ss" title="Ss" id="Parameters:"><a class="selflink" href="#Parameters:">Parameters:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>group</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of input imagery group</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>output</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output raster map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>threshold</b>=<i>float</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Difference threshold between 0 and 1
    <div>&#x00A0;</div>
    Threshold = 0 merges only identical segments; threshold = 1 merges all</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>method</b>=<i>string</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Segmentation method
    <div>&#x00A0;</div>
    Options: <i>region_growing</i>
    <div>&#x00A0;</div>
    Default: <i>region_growing</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>similarity</b>=<i>string</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Similarity calculation method
    <div>&#x00A0;</div>
    Options: <i>euclidean, manhattan</i>
    <div>&#x00A0;</div>
    Default: <i>euclidean</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>minsize</b>=<i>integer</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Minimum number of cells in a segment
    <div>&#x00A0;</div>
    The final step will merge small segments with their best neighbor
    <div>&#x00A0;</div>
    Options: <i>1-100000</i>
    <div>&#x00A0;</div>
    Default: <i>1</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>memory</b>=<i>integer</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Memory in MB
    <div>&#x00A0;</div>
    Default: <i>300</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>iterations</b>=<i>integer</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Maximum number of iterations
    <div>&#x00A0;</div>
    Default: <i>20</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>seeds</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for input raster map with starting seeds</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>bounds</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of input bounding/constraining raster map
    <div>&#x00A0;</div>
    Must be integer values, each area will be segmented independent of the
      others</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>goodness</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output goodness of fit estimate map</dd>
</dl>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
Image segmentation or object recognition is the process of grouping similar
  pixels into unique segments, also referred to as objects. Boundary and region
  based algorithms are described in the literature, currently a region growing
  and merging algorithm is implemented. Each object found during the
  segmentation process is given a unique ID and is a collection of contiguous
  pixels meeting some criteria. Note the contrast with image classification
  where all pixels similar to each other are assigned to the same class and do
  not need to be contiguous. The image segmentation results can be useful on
  their own, or used as a preprocessing step for image classification. The
  segmentation preprocessing step can reduce noise and speed up the
  classification.
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
<h2 class="Ss" title="Ss" id="Region_Growing_and_Merging"><a class="selflink" href="#Region_Growing_and_Merging">Region
  Growing and Merging</a></h2>
This segmentation algorithm sequentially examines all current segments in the
  raster map. The similarity between the current segment and each of its
  neighbors is calculated according to the given distance formula. Segments will
  be merged if they meet a number of criteria, including:
<dl class="Bl-tag">
  <dt class="It-tag"><b>1</b></dt>
  <dd class="It-tag">The pair is mutually most similar to each other (the
      similarity distance will be smaller than to any other neighbor), and</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>2</b></dt>
  <dd class="It-tag">The similarity must be lower than the input threshold. The
      process is repeated until no merges are made during a complete pass.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Similarity_and_Threshold"><a class="selflink" href="#Similarity_and_Threshold">Similarity
  and Threshold</a></h2>
The similarity between segments and unmerged objects is used to determine which
  objects are merged. Smaller distance values indicate a closer match, with a
  similarity score of zero for identical pixels.
<div class="Pp"></div>
During normal processing, merges are only allowed when the similarity between
  two segments is lower than the given threshold value. During the final pass,
  however, if a minimum segment size of 2 or larger is given with the
  <b>minsize</b> parameter, segments with a smaller pixel count will be merged
  with their most similar neighbor even if the similarity is greater than the
  threshold.
<div class="Pp"></div>
The <b>threshold</b> must be larger than 0.0 and smaller than 1.0. A threshold
  of 0 would allow only identical valued pixels to be merged, while a threshold
  of 1 would allow everything to be merged. Initial empirical tests indicate
  threshold values of 0.01 to 0.05 are reasonable values to start. It is
  recommended to start with a low value, e.g. 0.01, and then perform
  hierarchical segmentation by using the output of the last run as <b>seeds</b>
  for the next run.
<h2 class="Ss" title="Ss" id="Calculation_Formulas"><a class="selflink" href="#Calculation_Formulas">Calculation
  Formulas</a></h2>
Both Euclidean and Manhattan distances use the normal definition, considering
  each raster in the image group as a dimension. In future, the distance
  calculation will also take into account the shape characteristics of the
  segments. The normal distances are then multiplied by the input radiometric
  weight. Next an additional contribution is added: (1-radioweight) *
  {smoothness * smoothness weight + compactness * (1-smoothness weight)}, where
  compactness = Perimeter Length / sqrt( Area ) and smoothness = Perimeter
  Length / Bounding Box. The perimeter length is estimated as the number of
  pixel sides the segment has.
<h2 class="Ss" title="Ss" id="Seeds"><a class="selflink" href="#Seeds">Seeds</a></h2>
The seeds map can be used to provide either seed pixels (random or selected
  points from which to start the segmentation process) or seed segments. If the
  seeds are the results of a previous segmentation with lower threshold,
  hierarchical segmentation can be performed. The different approaches are
  automatically detected by the program: any pixels that have identical seed
  values and are contiguous will be assigned a unique segment ID.
<div class="Pp"></div>
It is expected that the <b>minsize</b> will be set to 1 if a seed map is used,
  but the program will allow other values to be used. If both options are used,
  the final iteration that ignores the threshold will also ignore the seed map
  and force merges for all pixels (not just segments that have grown/merged from
  the seeds).
<h2 class="Ss" title="Ss" id="Maximum_number_of_starting_segments"><a class="selflink" href="#Maximum_number_of_starting_segments">Maximum
  number of starting segments</a></h2>
For the region growing algorithm without starting seeds, each pixel is
  sequentially numbered. The current limit with CELL storage is 2 billion
  starting segment IDs. If the initial map has a larger number of non-null
  pixels, there are two workarounds:
<dl class="Bl-tag">
  <dt class="It-tag"><b>1</b></dt>
  <dd class="It-tag">Use starting seed pixels. (Maximum 2 billion pixels can be
      labeled with positive integers.)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>2</b></dt>
  <dd class="It-tag">Use starting seed segments. (By initial classification or
      other methods.)</dd>
</dl>
<h2 class="Ss" title="Ss" id="Boundary_Constraints"><a class="selflink" href="#Boundary_Constraints">Boundary
  Constraints</a></h2>
Boundary constraints limit the adjacency of pixels and segments. Each unique
  value present in the <b>bounds</b> raster are considered as a MASK. Thus no
  segments in the final segmentated map will cross a boundary, even if their
  spectral data is very similar.
<h2 class="Ss" title="Ss" id="Minimum_Segment_Size"><a class="selflink" href="#Minimum_Segment_Size">Minimum
  Segment Size</a></h2>
To reduce the salt and pepper affect, a <b>minsize</b> greater than 1 will add
  one additional pass to the processing. During the final pass, the threshold is
  ignored for any segments smaller then the set size, thus forcing very small
  segments to merge with their most similar neighbor.
<h2 class="Ss" title="Ss" id="Goodness_of_Fit"><a class="selflink" href="#Goodness_of_Fit">Goodness
  of Fit</a></h2>
The <b>goodness</b> of fit for each pixel is calculated as 1 - distance of the
  pixel to the object it belongs to. The distance is calculated with the
  selected <b>similarity</b> method. A value of 1 means identical values,
  perfect fit, and a value of 0 means maximum possible distance, worst possible
  fit.
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
<h2 class="Ss" title="Ss" id="Segmentation_of_RGB_orthophoto"><a class="selflink" href="#Segmentation_of_RGB_orthophoto">Segmentation
  of RGB orthophoto</a></h2>
This example uses the ortho photograph included in the NC Sample Dataset. Set up
  an imagery group:
<div>&#x00A0;</div>
<pre>
i.group group=ortho_group input=ortho_2001_t792_1m@PERMANENT
</pre>
<div class="Pp"></div>
Set the region to a smaller test region (resolution taken from input ortho
  photograph).
<div>&#x00A0;</div>
<pre>
g.region -p raster=ortho_2001_t792_1m n=220446 s=220075 e=639151 w=638592
</pre>
Try out a low threshold and check the results.
<div>&#x00A0;</div>
<pre>
i.segment group=ortho_group output=ortho_segs_l1 threshold=0.02
</pre>
<div class="Pp"></div>
From a visual inspection, it seems this results in too many segments. Increasing
  the threshold, using the previous results as seeds, and setting a minimum size
  of 2:
<div>&#x00A0;</div>
<pre>
i.segment group=ortho_group output=ortho_segs_l2 threshold=0.05 seeds=ortho_segs_l1 min=2
i.segment group=ortho_group output=ortho_segs_l3 threshold=0.1 seeds=ortho_segs_l2
i.segment group=ortho_group output=ortho_segs_l4 threshold=0.2 seeds=ortho_segs_l3
i.segment group=ortho_group output=ortho_segs_l5 threshold=0.3 seeds=ortho_segs_l4
</pre>
<div class="Pp"></div>
The output ortho_segs_l4 with <b>threshold</b>=0.2 still has too many segments,
  but the output with <b>threshold</b>=0.3 has too few segments. A threshold
  value of 0.25 seems to be a good choice. There is also some noise in the
  image, lets next force all segments smaller than 10 pixels to be merged into
  their most similar neighbor (even if they are less similar than required by
  our threshold):
<div class="Pp"></div>
Set the region to match the entire map(s) in the group.
<div>&#x00A0;</div>
<pre>
g.region -p raster=ortho_2001_t792_1m@PERMANENT
</pre>
<div class="Pp"></div>
Run <i>i.segment</i> on the full map:
<div>&#x00A0;</div>
<pre>
i.segment group=ortho_group output=ortho_segs_final threshold=0.25 min=10
</pre>
<div class="Pp"></div>
Processing the entire ortho image with nearly 10 million pixels took about 450
  times more then for the final run.
<h2 class="Ss" title="Ss" id="Segmentation_of_panchromatic_channel"><a class="selflink" href="#Segmentation_of_panchromatic_channel">Segmentation
  of panchromatic channel</a></h2>
This example uses the panchromatic channel of the Landsat7 scene included in the
  North Carolina sample dataset:
<div>&#x00A0;</div>
<pre>
# create group with single channel
i.group group=singleband input=lsat7_2002_80
# set computational region to Landsat7 PAN band
g.region raster=lsat7_2002_80 -p
# perform segmentation with minsize=5
i.segment group=singleband threshold=0.05 minsize=5 \
  output=lsat7_2002_80_segmented_min5 goodness=lsat7_2002_80_goodness_min5
# perform segmentation with minsize=100
i.segment group=singleband threshold=0.05 minsize=100
  output=lsat7_2002_80_segmented_min100 goodness=lsat7_2002_80_goodness_min100
</pre>
<div class="Pp"></div>
Original panchromatic channel of the Landsat7 scene
<div class="Pp"></div>
Segmented panchromatic channel, minsize=5
<div class="Pp"></div>
Segmented panchromatic channel, minsize=100
<h1 class="Sh" title="Sh" id="TODO"><a class="selflink" href="#TODO">TODO</a></h1>
<h2 class="Ss" title="Ss" id="Functionality"><a class="selflink" href="#Functionality">Functionality</a></h2>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Further testing of the shape characteristics (smoothness,
      compactness), if it looks good it should be added. ( <b>in
    progress</b>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Malahanobis distance for the similarity calculation.</dd>
</dl>
</div>
<h2 class="Ss" title="Ss" id="Use_of_Segmentation_Results"><a class="selflink" href="#Use_of_Segmentation_Results">Use
  of Segmentation Results</a></h2>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Improve the optional output from this module, or better
      yet, add a module for <i>i.segment.metrics</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Providing updates to <i>i.maxlik</i> to ensure the
      segmentation output can be used as input for the existing classification
      functionality.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Integration/workflow for <i>r.fuzzy</i> (Addon).</dd>
</dl>
</div>
<h2 class="Ss" title="Ss" id="Speed"><a class="selflink" href="#Speed">Speed</a></h2>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">See create_isegs.c</dd>
</dl>
</div>
<h1 class="Sh" title="Sh" id="REFERENCES"><a class="selflink" href="#REFERENCES">REFERENCES</a></h1>
This project was first developed during GSoC 2012. Project documentation, Image
  Segmentation references, and other information is at the project wiki.
<div class="Pp"></div>
Information about classification in GRASS is at available on the wiki.
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<i></i> <i>g.gui.iclass,</i> <i>i.group,</i> <i>i.maxlik,</i> <i>i.smap,</i>
  <i>r.kappa</i> <i></i>
<h1 class="Sh" title="Sh" id="AUTHORS"><a class="selflink" href="#AUTHORS">AUTHORS</a></h1>
Eric Momsen - North Dakota State University
<div>&#x00A0;</div>
Markus Metz (GSoC Mentor)
<div class="Pp"></div>
<i>Last changed: $Date: 2016-07-01 00:17:58 +0200 (Fri, 01 Jul 2016) $</i>
<h1 class="Sh" title="Sh" id="SOURCE_CODE"><a class="selflink" href="#SOURCE_CODE">SOURCE
  CODE</a></h1>
Available at: i.segment source code (history)
<div class="Pp"></div>
Main index | Imagery index | Topics index | Keywords index | Graphical index |
  Full index
<div class="Pp"></div>
&#x00A9; 2003-2016 GRASS Development Team, GRASS GIS 7.2.0 Reference
  Manual</div>
<table class="foot">
  <tr>
    <td class="foot-date"></td>
    <td class="foot-os">GRASS 7.2.0</td>
  </tr>
</table>
</body>
</html>
