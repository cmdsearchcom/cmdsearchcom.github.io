<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>t.rast.mapcalc(1grass)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">t.rast.mapcalc(1grass)</td>
    <td class="head-vol">Grass User's Manual</td>
    <td class="head-rtitle">t.rast.mapcalc(1grass)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
<i></i><b>t.rast.mapcalc</b> - Performs spatio-temporal mapcalc expressions on
  temporally sampled maps of space time raster datasets.
<h1 class="Sh" title="Sh" id="KEYWORDS"><a class="selflink" href="#KEYWORDS">KEYWORDS</a></h1>
temporal, algebra, raster, time
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>t.rast.mapcalc</b>
<div>&#x00A0;</div>
<b>t.rast.mapcalc --help</b>
<div>&#x00A0;</div>
<b>t.rast.mapcalc</b> [-<b>ns</b>] <b>inputs</b>=<i>name</i>[,<i>name</i>,...]
  <b>expression</b>=<i>string</i> [<b>method</b>=<i>name</i>[,<i>name</i>,...]]
  <b>output</b>=<i>name</i> <b>basename</b>=<i>basename</i>
  [<b>nprocs</b>=<i>integer</i>] [-- <b>overwrite</b>] [--<b>help</b>]
  [--<b>verbose</b>] [-- <b>quiet</b>] [--<b>ui</b>]
<h2 class="Ss" title="Ss" id="Flags:"><a class="selflink" href="#Flags:">Flags:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-n</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Register Null maps</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-s</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Check the spatial topology of temporally related maps and process only
      spatially related maps</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--overwrite</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Allow output files to overwrite existing files</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--help</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Print usage summary</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--verbose</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Verbose module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--quiet</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Quiet module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ui</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Force launching GUI dialog</dd>
</dl>
<h2 class="Ss" title="Ss" id="Parameters:"><a class="selflink" href="#Parameters:">Parameters:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>inputs</b>=<i>name[,</i><i>name</i>,...]
    <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of the input space time raster datasets</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>expression</b>=<i>string</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Spatio-temporal mapcalc expression</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>method</b>=<i>name[,</i><i>name</i>,...]</dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    The method to be used for sampling the input dataset
    <div>&#x00A0;</div>
    Options: <i>start, during, overlap, contain, equal, follows, precedes</i>
    <div>&#x00A0;</div>
    Default: <i>equal</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>output</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of the output space time raster dataset</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>basename</b>=<i>basename</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Basename for output raster maps
    <div>&#x00A0;</div>
    A numerical suffix separated by an underscore will be attached to create a
      unique identifier</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>nprocs</b>=<i>integer</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Number of r.mapcalc processes to run in parallel
    <div>&#x00A0;</div>
    Default: <i>1</i></dd>
</dl>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<i>t.rast.mapcalc</i> performs spatio-temporal <i>mapcalc</i> expressions on
  maps of temporally sampled space time raster datasets (STRDS). Spatial and
  temporal operators and internal variables are available in the expression
  string. The description of the spatial operators, functions and internal
  variables is available in the r.mapcalc manual page. The temporal functions
  are described in detail below.
<div class="Pp"></div>
This module expects several parameter. All space time raster datasets that are
  referenced in the <i>mapcalc expression</i> must be listed in the <i>input</i>
  option. The <i>first</i> space time raster dataset that is listed as input
  will be used to temporally sample all other space time raster datasets. The
  temporal sampling method can be chosen using the <i>method</i> option. The
  order of the STRDS&#x2019;s in the mapcalc expression can be different to the
  order of the STRDS&#x2019;s in the input option. The resulting space time
  raster dataset must be specified in the <i>output</i> option together with the
  <i>base</i> name of generated raster maps that are registered in the resulting
  STRDS. Empty maps resulting from map-calculation are not registered by
  default. This behavior can be changed with the <i>-n</i> flag. The flag
  <i>-s</i> can be used to assure that only spatial related maps in the
  STRDS&#x2019;s are processed. Spatial related means that temporally related
  maps overlap in their spatial extent.
<div class="Pp"></div>
The module <i>t.rast.mapcalc</i> supports parallel processing. The option
  <i>nprocs</i> specifies the number of processes that can be started in
  parallel.
<div class="Pp"></div>
A mapcalc expression must be provided to process the temporal sampled maps.
  Temporal internal variables are available in addition to the <i>r.mapcalc</i>
  spatial operators and functions:
<div class="Pp"></div>
Supported internal variables for relative and absolute time:
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>td()</i> - This internal variable represents the size of
      the current sample time interval in days and fraction of days for absolute
      time, and in relative units in case of relative time.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>start_time()</i> - This internal variable represent the
      time difference between the start time of the sample space time raster
      dataset and the start time of the current sample interval or instance. The
      time is measured in days and fraction of days for absolute time, and in
      relative units in case of relative time.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>end_time()</i> - This internal variable represent the
      time difference between the start time of the sample space time raster
      dataset and the end time of the current sample interval. The time is
      measured in days and fraction of days for absolute time, and in relative
      units in case of relative time. The end_time() will be represented by
      null() in case of a time instance.</dd>
</dl>
</div>
<div class="Pp"></div>
Supported internal variables for absolute time of the current sample interval or
  instance:
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>start_doy()</i> - Day of year (doy) from the start time
      [1 - 366]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>start_dow()</i> - Day of week (dow) from the start time
      [1 - 7], the start of the week is monday == 1</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>start_year()</i> - The year of the start time [0 -
    9999]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>start_month()</i> - The month of the start time [1 -
    12]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>start_week()</i> - Week of year of the start time [1 -
      54]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>start_day()</i> - Day of month from the start time [1 -
      31]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>start_hour()</i> - The hour of the start time [0 -
    23]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>start_minute()</i> - The minute of the start time [0 -
      59]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>start_second()</i> - The second of the start time [0 -
      59]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>end_doy()</i> - Day of year (doy) from the end time [1 -
      366]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>end_dow()</i> - Day of week (dow) from the end time [1 -
      7], the start of the week is monday == 1</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>end_year()</i> - The year of the end time [0 -
    9999]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>end_month()</i> - The month of the end time [1 -
    12]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>end_woy()</i> - Week of year (woy) of the end time [1 -
      54]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>end_day()</i> - Day of month from the start time [1 -
      31]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>end_hour()</i> - The hour of the end time [0 - 23]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>end_minute()</i> - The minute of the end time [0 -
    59]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>end_second()</i> - The second of the end time [0 -
    59]</dd>
</dl>
</div>
The <i>end_*</i> functions are represented by the null() internal variables in
  case of time instances.
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
We will discuss the internal work of <i>t.rast.mapcalc</i> with an example.
  Imagine we have two STRDS as input, each with monthly granularity. The first
  one <i>A</i> has 6 raster maps (a3 ... a8) with a temporal range from March to
  August. The second STRDS <i>B</i> has 12 raster maps (b1 ... b12) ranging from
  January to December. The value of the raster maps is the number of the month
  from their interval start time. Dataset <i>A</i> will be used to sample
  dataset <i>B</i> to create a dataset <i>C</i>. We want to add all maps with
  equal time stamps if the month of the start time is May or June, otherwise we
  multiply the maps. The command will look as follows:
<div class="Pp"></div>
<pre>
t.rast.mapcalc input=A,B output=C basename=c method=equal \
    expression=&quot;if(start_month() == 5 || start_month() == 6, (A + B), (A * B))&quot;
</pre>
<div class="Pp"></div>
The resulting raster maps in dataset C can be listed with <i>t.rast.list</i>:
<div class="Pp"></div>
<pre>
name    start_time              min     max
c_1     2001-03-01 00:00:00     9.0     9.0
c_2     2001-04-01 00:00:00     16.0    16.0
c_3     2001-05-01 00:00:00     10.0    10.0
c_4     2001-06-01 00:00:00     12.0    12.0
c_5     2001-07-01 00:00:00     49.0    49.0
c_6     2001-08-01 00:00:00     64.0    64.0
</pre>
<div class="Pp"></div>
Internally the spatio-temporal expression will be analyzed for each time
  interval of the sample dataset A, the temporal functions will be replaced by
  numerical values, the names of the space time raster datasets will be replaced
  by the corresponding raster maps. The final expression will be passed to
  <i>r.mapcalc</i>, resulting in 6 runs:
<div class="Pp"></div>
<pre>
r.mapcalc expression=&quot;c_1 = if(3 == 5 || 3 == 6, (a3 + b3), (a3 * b3))&quot;
r.mapcalc expression=&quot;c_2 = if(4 == 5 || 4 == 6, (a4 + b4), (a4 * b4))&quot;
r.mapcalc expression=&quot;c_3 = if(5 == 5 || 5 == 6, (a5 + b5), (a5 * b5))&quot;
r.mapcalc expression=&quot;c_4 = if(6 == 5 || 6 == 6, (a6 + b6), (a6 * b6))&quot;
r.mapcalc expression=&quot;c_5 = if(7 == 5 || 7 == 6, (a7 + b7), (a7 * b7))&quot;
r.mapcalc expression=&quot;c_6 = if(8 == 5 || 8 == 6, (a8 + b8), (a8 * b8))&quot;
</pre>
<h1 class="Sh" title="Sh" id="EXAMPLE"><a class="selflink" href="#EXAMPLE">EXAMPLE</a></h1>
The following command it is creating a new raster space time dataset where in
  the January maps are if the temperature is more than 0 it is setting null
  otherwise it set the original value. The other months are copied as the
  original one.
<div>&#x00A0;</div>
<pre>
t.rast.mapcalc input=tempmean_monthly output=january_under_0 basename=january_under_0 \
    expression=&quot;if(start_month() == 1 &amp;&amp; tempmean_monthly &gt; 0, null(), tempmean_monthly)&quot;
# printing the minimum or maximum values only for January
t.rast.list january_under_0 columns=name,start_time,min,max | grep 01-01
name|start_time|min|max
january_under_0_01|2009-01-01 00:00:00|-3.380823|-7e-06
january_under_0_13|2010-01-01 00:00:00|-5.266929|-0.000154
january_under_0_25|2011-01-01 00:00:00|-4.968747|-6.1e-05
january_under_0_37|2012-01-01 00:00:00|-0.534994|-0.014581
# these are the original data, you can see that the maximum is different
t.rast.list tempmean_monthly columns=name,start_time,min,max | grep 01-01
2009_01_tempmean|2009-01-01 00:00:00|-3.380823|7.426054
2010_01_tempmean|2010-01-01 00:00:00|-5.266929|5.71131
2011_01_tempmean|2011-01-01 00:00:00|-4.968747|4.967295
2012_01_tempmean|2012-01-01 00:00:00|-0.534994|9.69511
</pre>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<i></i> <i>r.mapcalc,</i> <i>t.register,</i> <i>t.rast.list,</i> <i>t.info</i>
  <i></i>
<div class="Pp"></div>
Temporal data processing Wiki
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
S&#x00F6;ren Gebbert, Th&#x00FC;nen Institute of Climate-Smart Agriculture
<div class="Pp"></div>
<i>Last changed: $Date: 2015-09-22 10:10:38 +0200 (Tue, 22 Sep 2015) $</i>
<h1 class="Sh" title="Sh" id="SOURCE_CODE"><a class="selflink" href="#SOURCE_CODE">SOURCE
  CODE</a></h1>
Available at: t.rast.mapcalc source code (history)
<div class="Pp"></div>
Main index | Temporal index | Topics index | Keywords index | Graphical index |
  Full index
<div class="Pp"></div>
&#x00A9; 2003-2016 GRASS Development Team, GRASS GIS 7.2.0 Reference
  Manual</div>
<table class="foot">
  <tr>
    <td class="foot-date"></td>
    <td class="foot-os">GRASS 7.2.0</td>
  </tr>
</table>
</body>
</html>
