<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:39:01 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>ssh_filter_btrbk(1) ssh_filter_btrbk(1)</p>

<p style="margin-top: 1em">NAME <br>
ssh_filter_btrbk.sh - ssh command filter script for
btrbk</p>

<p style="margin-top: 1em">SYNOPSIS <br>
ssh_filter_btrbk.sh [-s|--source] [-t|--target]
[-d|--delete] [-i|--info] <br>
[-p|--restrict-path &lt;path&gt;] [-l|--log] [--sudo]</p>

<p style="margin-top: 1em">DESCRIPTION <br>
ssh_filter_btrbk.sh restricts SSH commands to btrfs commands
used by btrbk. It examines the SSH_ORIGINAL_COMMAND
environment variable (set by sshd) and executes it only if
it <br>
matches commands used by btrbk. The accepted commands are
specified by the &quot;--source&quot;, &quot;--target&quot;,
&quot;--delete&quot; and &quot;--info&quot; options.</p>

<p style="margin-top: 1em">Note that the following btrfs
commands are always allowed: &quot;btrfs subvolume
show&quot;, &quot;btrfs subvolume list&quot;.</p>

<p style="margin-top: 1em">Example line in
/root/.ssh/authorized_keys on a backup target host:</p>


<p style="margin-top: 1em">command=&quot;ssh_filter_btrbk.sh
--target --delete --compress --restrict-path
/mnt/btr_backup&quot; ssh-rsa AAAAB3NzaC1...hwumXFRQBL
btrbk@mydomain.com</p>

<p style="margin-top: 1em">OPTIONS <br>
-s, --source <br>
Allow commands for backup source: &quot;btrfs subvolume
snapshot&quot;, &quot;btrfs send&quot;. Equivalent to
&quot;--snapshot --send&quot;.</p>

<p style="margin-top: 1em">-t, --target <br>
Allow commands for backup target: &quot;btrfs receive&quot;,
&quot;realpath&quot; and &quot;cat
/proc/self/mounts&quot;.</p>

<p style="margin-top: 1em">-d, --delete <br>
Allow commands for subvolume deletion: &quot;btrfs subvolume
delete&quot;. This is used for backup source if
snapshot_preserve_daily is not set to &acirc;all&acirc;, and
for backup targets if <br>
target_preserve_daily is not set to &acirc;all&acirc;.</p>

<p style="margin-top: 1em">-c, --compress <br>
Allow commands for stream compression (pipes through gzip,
pigz, bzip2, pbzip2, xz, lzo, lz4). Needed if
stream_compress is set.</p>

<p style="margin-top: 1em">-i, --info <br>
Allow informative commands: &quot;btrfs subvolume
find-new&quot;, &quot;btrfs filesystem usage&quot;. This is
used by btrbk info and diff commands.</p>

<p style="margin-top: 1em">--snapshot <br>
Allow btrfs snapshot command: &quot;btrfs subvolume
snapshot&quot;.</p>

<p style="margin-top: 1em">--send <br>
Allow btrfs send command: &quot;btrfs send&quot;.</p>

<p style="margin-top: 1em">--receive <br>
Allow btrfs receive command: &quot;btrfs receive&quot;.</p>

<p style="margin-top: 1em">-p, --restrict-path &lt;path&gt;
<br>
Restrict btrfs commands to &lt;path&gt;.</p>

<p style="margin-top: 1em">-l, --log <br>
Log ACCEPT and REJECT messages to the system log.</p>

<p style="margin-top: 1em">--sudo <br>
Call SSH_ORIGINAL_COMMAND using sudo.</p>

<p style="margin-top: 1em">AVAILABILITY <br>
Please refer to the btrbk project page
http://digint.ch/btrbk/ for further details.</p>

<p style="margin-top: 1em">SEE ALSO <br>
btrbk(1), btrbk.conf(5), btrfs(1)</p>

<p style="margin-top: 1em">AUTHOR <br>
Axel Burri &lt;axel@tty0.ch&gt;</p>

<p style="margin-top: 1em">btrbk v0.24.0 2016-11-16
ssh_filter_btrbk(1)</p>
<hr>
</body>
</html>
