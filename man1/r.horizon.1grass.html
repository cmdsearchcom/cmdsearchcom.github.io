<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>r.horizon(1grass)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">r.horizon(1grass)</td>
    <td class="head-vol">Grass User's Manual</td>
    <td class="head-rtitle">r.horizon(1grass)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
<i></i><b>r.horizon</b> - Computes horizon angle height from a digital elevation
  model.
<div>&#x00A0;</div>
The module has two different modes of operation: 1. Computes the entire horizon
  around a single point whose coordinates are given with the
  &#x2019;coord&#x2019; option. The horizon height (in radians). 2. Computes one
  or more raster maps of the horizon height in a single direction. The input for
  this is the angle (in degrees), which is measured counterclockwise with
  east=0, north=90 etc. The output is the horizon height in radians.
<h1 class="Sh" title="Sh" id="KEYWORDS"><a class="selflink" href="#KEYWORDS">KEYWORDS</a></h1>
raster, solar, sun position
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>r.horizon</b>
<div>&#x00A0;</div>
<b>r.horizon --help</b>
<div>&#x00A0;</div>
<b>r.horizon</b> [-<b>dc</b>] <b>elevation</b>=<i>name</i>
  [<b>direction</b>=<i>float</i>] [ <b>step</b>=<i>float</i>]
  [<b>start</b>=<i>float</i>] [ <b>end</b>=<i>float</i>]
  [<b>bufferzone</b>=<i>float</i>] [ <b>e_buff</b>=<i>float</i>]
  [<b>w_buff</b>=<i>float</i>] [<b>n_buff</b>=<i>float</i>]
  [<b>s_buff</b>=<i>float</i>] [ <b>maxdistance</b>=<i>float</i>]
  [<b>output</b>= <i>basename</i>] [<b>coordinates</b>=<i>east,north</i>]
  [<b>distance</b>= <i>float</i>] [<b>file</b>=<i>name</i>] [--<b>overwrite</b>]
  [-- <b>help</b>] [--<b>verbose</b>] [--<b>quiet</b>] [--<b>ui</b>]
<h2 class="Ss" title="Ss" id="Flags:"><a class="selflink" href="#Flags:">Flags:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-d</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Write output in degrees (default is radians)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-c</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Write output in compass orientation (default is CCW, East=0)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--overwrite</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Allow output files to overwrite existing files</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--help</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Print usage summary</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--verbose</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Verbose module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--quiet</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Quiet module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ui</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Force launching GUI dialog</dd>
</dl>
<h2 class="Ss" title="Ss" id="Parameters:"><a class="selflink" href="#Parameters:">Parameters:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>elevation</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of input elevation raster map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>direction</b>=<i>float</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Direction in which you want to know the horizon height</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>step</b>=<i>float</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Angle step size for multidirectional horizon [degrees]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>start</b>=<i>float</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Start angle for multidirectional horizon [degrees]
    <div>&#x00A0;</div>
    Default: <i>0.0</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>end</b>=<i>float</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    End angle for multidirectional horizon [degrees]
    <div>&#x00A0;</div>
    Default: <i>360.0</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>bufferzone</b>=<i>float</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    For horizon rasters, read from the DEM an extra buffer around the present
      region</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>e_buff</b>=<i>float</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    For horizon rasters, read from the DEM an extra buffer eastward the present
      region</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>w_buff</b>=<i>float</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    For horizon rasters, read from the DEM an extra buffer westward the present
      region</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>n_buff</b>=<i>float</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    For horizon rasters, read from the DEM an extra buffer northward the present
      region</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>s_buff</b>=<i>float</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    For horizon rasters, read from the DEM an extra buffer southward the present
      region</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>maxdistance</b>=<i>float</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    The maximum distance to consider when finding the horizon height</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>output</b>=<i>basename</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output basename raster map(s)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>coordinates</b>=<i>east,north</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Coordinate for which you want to calculate the horizon</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>distance</b>=<i>float</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Sampling distance step coefficient (0.5-1.5)
    <div>&#x00A0;</div>
    Default: <i>1.0</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>file</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of file for output (use output=- for stdout)
    <div>&#x00A0;</div>
    Default: <i>-</i></dd>
</dl>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<b>r.horizon</b> computes the angular height of terrain horizon in radians. It
  reads a raster of elevation data and outputs the horizon outline in one of two
  modes:
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">single point: as a series of horizon heights in the
      specified directions from the given point. The results are written to the
      stdout.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">raster: in this case the output is one or more raster maps,
      with each point in a raster giving the horizon height in a specific
      direction. One raster is created for each direction.</dd>
</dl>
</div>
<div class="Pp"></div>
The directions are given as azimuthal angles (in degrees), with the angle
  starting with 0 towards East and moving counterclockwise (North is 90, etc.).
  The calculation takes into account the actual projection, so the angles are
  corrected for direction distortions imposed by it. The directions are thus
  aligned to those of the geographic projection and not the coordinate system
  given by the rows and columns of the raster map. This correction implies that
  the resulting cardinal directions represent true orientation towards the East,
  North, West and South. The only exception of this feature is LOCATION with x,y
  coordinate system, where this correction is not applied.
<div class="Pp"></div>
Using the <b>-c</b> flag, the azimuthal angles will be printed in compass
  orientation (North=0, clockwise).
<h2 class="Ss" title="Ss" id="Input_parameters:"><a class="selflink" href="#Input_parameters:">Input
  parameters:</a></h2>
The <i>elevation</i> parameter is an input elevation raster map. If the buffer
  options are used (see below), this raster should extend over the area that
  accommodate the presently defined region plus defined buffer zones.
<div class="Pp"></div>
The <i>step</i> parameter gives the angle step (in degrees) between successive
  azimuthal directions for the calculation of the horizon. Thus, a value of 5
  for the <i>step</i> will give a total of 360/5=72 directions (72 raster maps
  if used in the raster map mode).
<div class="Pp"></div>
The <i>start</i> parameter gives the angle start (in degrees) for the
  calculation of the horizon. The default value is 0 (East with North being 90
  etc.).
<div class="Pp"></div>
The <i>end</i> parameter gives the angle end (in degrees) for the calculation of
  the horizon. The end point is omitted! So for example if we run r.horizon with
  step=10, start=30 and end=70 the raster maps generated by r.horizon will be
  only for angles: 30, 40, 50, 60. The default value is 360.
<div class="Pp"></div>
The <i>direction</i> parameter gives the initial direction of the first output.
  This parameter acts as an direction angle offset. For example, if you want to
  get horizon angles for directions 45 and 225 degrees, the <i>direction</i>
  should be set to 45 and <i>step</i> to 180. If you only want one single
  direction, use this parameter to specify desired direction of horizon angle,
  and set the <i>step</i> size to 0 degrees. Otherwise all angles for a given
  starting <i>direction</i> with step of <i>step</i> are calculated.
<div class="Pp"></div>
The <i>distance</i> controls the sampling distance step size for the search for
  horizon along the line of sight. The default value is 1.0 meaning that the
  step size will be taken from the raster resolution. Setting the value below
  1.0 might slightly improve results for directions apart from the cardinal
  ones, but increasing the processing load of the search algorithm.
<div class="Pp"></div>
The <i>maxdistance</i> value gives a maximum distance to move away from the
  origin along the line of sight in order to search for the horizon height. The
  default <i>maxdistance</i> is the full map extent. The smaller this value the
  faster the calculation but the higher the risk that you may miss a terrain
  feature that can contribute significantly to the horizon outline. Note that a
  viewshed can be calculated with <i>r.viewshed</i>.
<div class="Pp"></div>
The <i>coordinate</i> parameter takes a pair of easting-northing values in the
  current coordinate system and calculates the values of angular height of the
  horizon around this point. To achieve the consistency of the results, the
  point coordinate is aligned to the midpoint of the closest elevation raster
  cell.
<div class="Pp"></div>
If an analyzed point (or raster cell) lies close to the edge of the defined
  region, the horizon calculation may not be realistic, since it may not see
  some significant terrain features which could have contributed to the horizon,
  because these features are outside the region. There are to options how to set
  the size of the buffer that is used to increase the area of the horizon
  analysis. The <i>bufferzone</i> parameter allows you to specify the same size
  of buffer for all cardinal directions and the parameters <i>e_buff</i>,
  <i>n_buff</i>, <i>s_buff</i>, and <i>w_buff</i> allow you to specify a buffer
  size individually for each of the four directions. The buffer parameters
  influence only size of the read elevation map, while the analysis in the
  raster mode will be done only for the area specified by the current region
  definition.
<div class="Pp"></div>
The <i>basename</i> parameter gives the basename of the output horizon raster
  maps. The raster name of each horizon direction raster will be constructed as
  <i>basename_</i>ANGLE, where ANGLE is the angle in degrees with the direction.
  If you use <b>r.horizon</b> in the single point mode this option will be
  ignored.
<div class="Pp"></div>
The <i>output</i> parameter allows saving the resulting horizon angles in a
  comma separated ASCII file (single point mode only). If you use
  <b>r.horizon</b> in the raster map mode this option will be ignored.
<div class="Pp"></div>
At the moment the elevation and maximum distance must be measured in meters,
  even if you use geographical coordinates (longitude/latitude). If your
  projection is based on distance (easting and northing), these too must be in
  meters. The buffer parameters must be in the same units as the raster
  coordinates (e.g., for latitude-longitude locations buffers are measured in
  degree unit).
<h1 class="Sh" title="Sh" id="METHOD"><a class="selflink" href="#METHOD">METHOD</a></h1>
The calculation method is based on the method used in <b>r.sun</b> to calculate
  shadows. It starts at a very shallow angle and walks along the line of sight
  and asks at each step whether the line of sight &quot;hits&quot; the terrain.
  If so, the angle is increased to allow the line of sight to pass just above
  the terrain at that point. This is continued until the line of sight reaches a
  height that is higher than any point in the region or until it reaches the
  border of the region (see also the <i>bufferzone,e_buff</i>, <i>n_buff</i>,
  <i>s_buff</i>, and <i>w_buff</i>). The the number of lines of sight (azimuth
  directions) is determined from the <i>direction</i> and <i>step</i>
  parameters. The method takes into account the curvature of the Earth whereby
  remote features will seem to be lower than they actually are. It also accounts
  for the changes of angles towards cardinal directions caused by the projection
  (see above).
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
The examples are intended for the North Carolina sample dataset.
<h2 class="Ss" title="Ss" id="Single_point_mode"><a class="selflink" href="#Single_point_mode">Single
  point mode</a></h2>
<b>Example 1</b>: determine horizon angle in 225 degree direction (output of
  horizon angles CCW from East):
<div>&#x00A0;</div>
<pre>
g.region raster=elevation -p
r.horizon elevation=elevation direction=215 step=0 bufferzone=200 \
    coordinates=638871.6,223384.4 maxdistance=5000
</pre>
<div class="Pp"></div>
<b>Example 2</b>: determine horizon values starting at 90 deg (North), step size
  of 5 deg, saving result as CSV file:
<div>&#x00A0;</div>
<pre>
r.horizon elevation=elevation direction=90 step=5 bufferzone=200 \
    coordinates=638871.6,223384.4 maxdistance=5000 file=horizon.csv
</pre>
<div class="Pp"></div>
<b>Example 3</b>: test point near highway intersection, saving result as CSV
  file for plotting the horizon around the highway intersection:
<div>&#x00A0;</div>
<pre>
g.region n=223540 s=220820 w=634650 e=638780 res=10 -p
r.horizon elevation=elevation direction=0 step=5 bufferzone=200 \
    coordinates=636483.54,222176.25 maxdistance=5000 -d file=horizon.csv
</pre>
<div>&#x00A0;</div>
Test point near high way intersection (North Carolina sample dataset)
<div class="Pp"></div>
Horizon angles for test point (CCW from East)
<div class="Pp"></div>
We can plot horizon in polar coordinates using Matplotlib in Python:
<div>&#x00A0;</div>
<pre>
import numpy as np
import matplotlib.pyplot as plt
horizon = np.genfromtxt(&#x2019;horizon.csv&#x2019;, delimiter=&#x2019;,&#x2019;)
horizon = horizon[1:, :]
ax = plt.subplot(111, polar=True)
bars = ax.plot(horizon[:, 0] / 180 * np.pi,
               (90 - horizon[:, 1]) / 180 * np.pi)
# uncomment the 2 following lines when using -c flag
# ax.set_theta_direction(-1)
# ax.set_theta_zero_location(&#x2019;N&#x2019;)
plt.show()
</pre>
<div>&#x00A0;</div>
Horizon plot in polar coordinates.
<h2 class="Ss" title="Ss" id="Raster_map_mode"><a class="selflink" href="#Raster_map_mode">Raster
  map mode</a></h2>
Raster map mode (output maps &quot;horangle*&quot; become input for
  <i>r.sun</i>):
<div>&#x00A0;</div>
<pre>
# we put a bufferzone of 10% of maxdistance around the study area
# compute only direction between 90 and 270 degrees
r.horizon elevation=elevation step=30 start=90 end=300 \
    bufferzone=200 output=horangle maxdistance=5000
</pre>
<h1 class="Sh" title="Sh" id="REFERENCES"><a class="selflink" href="#REFERENCES">REFERENCES</a></h1>
Hofierka J., 1997. Direct solar radiation modelling within an open GIS
  environment. Proceedings of JEC-GI&#x2019;97 conference in Vienna, Austria,
  IOS Press Amsterdam, 575-584
<div class="Pp"></div>
Hofierka J., Huld T., Cebecauer T., Suri M., 2007. Open Source Solar Radiation
  Tools for Environmental and Renewable Energy Applications, International
  Symposium on Environmental Software Systems, Prague, 2007
<div class="Pp"></div>
Neteler M., Mitasova H., 2004. Open Source GIS: A GRASS GIS Approach, Springer,
  New York. ISBN: 1-4020-8064-6, 2nd Edition 2004 (reprinted 2005), 424 pages
<div class="Pp"></div>
Project PVGIS, European Commission, DG Joint Research Centre 2001-2007
<div class="Pp"></div>
Suri M., Hofierka J., 2004. A New GIS-based Solar Radiation Model and Its
  Application for Photovoltaic Assessments. Transactions in GIS, 8(2), 175-190
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<i></i> <i>r.sun,</i> <i>r.sunmask,</i> <i>r.viewshed</i> <i></i>
<h1 class="Sh" title="Sh" id="AUTHORS"><a class="selflink" href="#AUTHORS">AUTHORS</a></h1>
Thomas Huld, Joint Research Centre of the European Commission, Ispra, Italy
<div>&#x00A0;</div>
<div class="Pp"></div>
Tomas Cebecauer, Joint Research Centre of the European Commission, Ispra, Italy
<div>&#x00A0;</div>
<div class="Pp"></div>
Jaroslav Hofierka, GeoModel s.r.o., Bratislava, Slovakia
<div>&#x00A0;</div>
Marcel Suri, Joint Research Centre of the European Commission, Ispra, Italy
<div class="Pp"></div>
&#x00A9; 2007, Thomas Huld, Tomas Cebecauer, Jaroslav Hofierka, Marcel Suri
  Thomas.Huld@jrc.it Tomas.Cebecauer@jrc.it hofierka@geomodel.sk
  Marcel.Suri@jrc.it
<div class="Pp"></div>
<i>Last changed: $Date: 2016-01-19 23:08:21 +0100 (Tue, 19 Jan 2016) $</i>
<h1 class="Sh" title="Sh" id="SOURCE_CODE"><a class="selflink" href="#SOURCE_CODE">SOURCE
  CODE</a></h1>
Available at: r.horizon source code (history)
<div class="Pp"></div>
Main index | Raster index | Topics index | Keywords index | Graphical index |
  Full index
<div class="Pp"></div>
&#x00A9; 2003-2016 GRASS Development Team, GRASS GIS 7.2.0 Reference
  Manual</div>
<table class="foot">
  <tr>
    <td class="foot-date"></td>
    <td class="foot-os">GRASS 7.2.0</td>
  </tr>
</table>
</body>
</html>
