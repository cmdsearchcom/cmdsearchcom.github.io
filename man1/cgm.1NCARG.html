<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>CGM_TOOLS(1NCARG)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">CGM_TOOLS(1NCARG)</td>
    <td class="head-vol">NCAR GRAPHICS</td>
    <td class="head-rtitle">CGM_TOOLS(1NCARG)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
CGM_open, CGM_close, CGM_lseek, CGM_read, CGM_write, CGM_directory,
  CGM_freeDirectory, CGM_printDirectory, CGM_getInstr, CGM_flushGetInstr,
  CGM_putInstr, CGM_flushOutputInstr, CGM_initMetaEdit, CGM_termMetaEdit,
  CGM_copyFrames, CGM_deleteFrames, CGM_mergeFrames CGM_moveFrames,
  CGM_readFrames, CGM_valid, CGM_writeFile, CGM_writeFrames, CGM_appendFrames -
  Computer Graphics Metafile operations
<h1 class="Sh" title="Sh" id="SYNTAX"><a class="selflink" href="#SYNTAX">SYNTAX</a></h1>
<pre>
<b>#include &lt;cgm_tools.h&gt;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>Cgm_fd CGM_open(metafile, size, flags, mode)</b>
<b>char *metafile;</b>
<b>unsigned size;</b>
<b>int flags;</b>
<b>int mode;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>int CGM_close(cgm_fd)</b>
<b>Cgm_fd cgm_fd;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>int CGM_lseek(cgm_fd, offset)</b>
<b>Cgm_fd cgm_fd;</b>
<b>int offset;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>int CGM_read(cgm_fd, buf)</b>
<b>Cgm_fd cgm_fd;</b>
<b>unsigned char *buf;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>int CGM_write(cgm_fd, buf)</b>
<b>Cgm_fd cgm_fd;</b>
<b>unsigned char *buf;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>Directory *CGM_directory(cgm_fd)</b>
<b>Cgm_fd cgm_fd;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>void CGM_freeDirectory(dir)</b>
<b>Directory *dir;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>void CGM_printDirectory(dir)</b>
<b>Directory *dir;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>int CGM_getInstr(cgm_fd, instr)</b>
<b>Cgm_fd cgm_fd;</b>
<b>Instr *instr;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>void CGM_flushGetInstr(cgm_fd)</b>
<b>Cgm_fd cgm_fd;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>int CGM_putInstr(cgm_fd, instr)</b>
<b>Cgm_fd cgm_fd;</b>
<b>Instr *instr;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>int CGM_flushOutputInstr(cgm_fd)</b>
<b>Cgm_fd cgm_fd;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>Directory *CGM_initMetaEdit (metafile, size)</b>
<b>char *metafile;</b>
<b>unsigned int size;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>int CGM_termMetaEdit()</b>
</pre>
<div class="Pp"></div>
<pre>
<b>Directory *CGM_copyFrames(start, num, target )</b>
<b>unsigned int start;</b>
<b>int num;</b>
<b>unsigned int target;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>Directory *CGM_deleteFrames(start, num)</b>
<b>unsigned int start,</b>
<b>num;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>Directory *CGM_mergeFrames(bottom, top)</b>
<b>unsigned bottom, top;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>Directory *CGM_moveFrames (start, num, target)</b>
<b>unsigned int start, num, target;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>Directory *CGM_readFrames(metafile, start, num, target, size)</b>
<b>char *metafile;</b>
<b>unsigned int start;</b>
<b>int num;</b>
<b>unsigned int target, size;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>int *CGM_validCGM(metafile)</b>
<b>char *metafile;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>int CGM_writeFile(metafile)</b>
<b>char *metafile;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>int CGM_writeFrames(metafile, start, num)</b>
<b>char *metafile;</b>
<b>unsigned start, num;</b>
</pre>
<div class="Pp"></div>
<pre>
<b>int CGM_appendFrames(metafile, start, num)</b>
<b>char *metafile;</b>
<b>unsigned start, num;</b>
</pre>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
The argument <i>cgm_fd</i> refers to a valid file descriptor created for reading
  or writing, as appropriate by <b>CGM_open</b>. <b>CGM_read</b>,
  <b>CGM_directory</b>, <b>CGM_getInstr</b> and <b>CGM_flushGetInstr</b> require
  a file descriptor open for reading. <b>CGM_write</b>,
  <b>CGM_getInstr</b>,<b>CGM_flushGetInstr</b> and <b>CGM_flushOutputInstr</b>
  require a <i>Cgm_fd</i> open for writing. <b>CGM_close</b> and
  <b>CGM_lseek</b> will accept any valid <i>Cgm_fd</i>.
<div class="Pp"></div>
The <i>size</i> argument refers to the CGM record size in bytes. For an NCAR CGM
  this value is 1440.
<div class="Pp"></div>
<i>buf</i> is a pointer to user allocated memory of size <i>size</i>. This
  storage will be used for buffering input and output of <b>CGM_read</b> and
  <b>CGM_write</b> respectively.
<div class="Pp"></div>
The <i>dir</i> argument is a pointer to a <i>Directory</i> structure created
  with <b>CGM_directory</b> or <b>CGM_initMetaEdit</b>. <i>dir</i> is a private
  resource that should <i>NOT</i> be directly modified by the user. A set of
  convenience macros is provided for this purpose in <i>cgm_tools.h</i>.
<div class="Pp"></div>
The <i>start</i>, <i>num</i> and <i>target</i> arguments are used to address
  frame numbers in a metafile being edited with one of the commands:
  <b>CGM_copyFrames</b>, <b>CGM_deleteFrames</b>, <b>CGM_readFrames</b>,
  <b>CGM_moveFrames</b>, <b>CGM_writeFrames</b> and <b>CGM_mergeFrames</b>. The
  <i>start</i> argument is the first frame in a sequence of <i>num</i> frame(s)
  to perform the editing operation on. <i>target</i> is similar to <i>start</i>
  and is used by commands that require two frame addresses such as <i>copy</i>.
  Addressing begins at zero.
<dl class="Bl-tag">
  <dt class="It-tag">CGM_open</dt>
  <dd class="It-tag">This command is modeled after the unix <i>open</i> command.
      It will open a CGM for reading or writing as specified by the <i>flags</i>
      argument and return a <i>Cgm_fd</i> file descriptor. The <i>flags</i> and
      <i>open</i> parameters are passed directly on to the system <i>open</i>
      command. For a detailed explanation of these two arguments see
    open(2).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_close</dt>
  <dd class="It-tag">Delete a file descriptor. The inverse of <b>CGM_open</b>.
      See close(2).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_read</dt>
  <dd class="It-tag"><b>CGM_read</b> attempts to read <i>size</i> bytes from the
      object referenced through the descriptor <i>cgm_fd</i>. <i>size</i> is set
      at the creation of <i>cgm_fd</i> by <b>CGM_open</b>. <b>CGM_read</b>
      returns the number of bytes successfully read. A zero is returned on EOF
      and a negative number implies an error occurred. The unix system call
      <i>read</i> is called by <b>CGM_read</b>. See read(2).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_write</dt>
  <dd class="It-tag">Attempts to write a single record of <i>size</i> bytes from
      <i>buf</i> from the object referenced by <i>cgm_edit</i> where <i>size</i>
      is the record size parameter provided at the creation of <i>cgm_fd</i>.
      <i>write</i> returns the number of bytes successfully written. A negative
      return number implies an error occurred. The unix system call <i>write</i>
      is called by <b>CGM_write</b>. See write(2).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_lseek</dt>
  <dd class="It-tag">Advance the file pointer of <i>cgm_fd</i> to <i>offset</i>
      bytes. Upon successful completion the current file pointer offset is
      returned. A negative return value is an error. The unix system call
      <i>lseek</i> is called by <b>CGM_lseek</b>. See lseek(2).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_directory</dt>
  <dd class="It-tag">Create a table of contents for the metafile referenced by
      <i>cgm_fd</i>. Return a pointer to this table of type <i>Directory</i>.
      The contents of the directory include number of metafiles, number of
      frames, record offset for each frame, frame length in records, optional
      frame description and metafile status. These fields are meant to be read
      only and should only be referenced by the convenience macros provided in
      cgm_tools.h. A NULL pointer is returned on failure.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_freeDirectory</dt>
  <dd class="It-tag">Free memory allocated to a directory created by
      <b>CGM_directory</b> or <b>CGM_initMetaEdit</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_printDirectory</dt>
  <dd class="It-tag">Print the contents of a directory pointed to by <i>dir</i>
      to the standard output.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_getInstr,</dt>
  <dd class="It-tag">Fetch the next instruction in file referenced by
      <i>cgm_edit</i> and convert it into a usable format pointed to by
      <i>instr</i>. <b>CGM_getInstr</b> provides an interface to the metafile
      for extracting CGM elements. The user need not be concerned with the
      binary format of the metafile. The fields of the <i>Instr</i> are as
      described in <i>cgm_tools.h</i>. The user should note that the maximum
      allowable data length returned in a single invocation is 32760 bytes. The
      CGM standard allows upto 32767 bytes to be stored in a single instruction.
      But 32767 is not a nice number to work with. Should the data length of a
      CGM instruction exceed 32760 bytes, indicated by the boolean <i>more</i>
      flag, the next invocation of <b>CGM_getInstr</b> will return the remaining
      data up to the same limit, etc. <b>CGMgetInstr</b> requires a valid
      <i>Cgm_fd</i> open for reading. For a description on CGM see the ANSI
      standard.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_flushGetInstr</dt>
  <dd class="It-tag">Flush the input buffer used by <b>CGM_getInstr</b>.
      <b>CGM_getInstr</b> buffers the contents of the CGM and only performs
      actual reads as necessary. If the user desires other then sequential read
      access to a CGM it becomes necessary to flush the input buffer before
      reading from a new location.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_putInstr</dt>
  <dd class="It-tag">The analog to <b>CGM_getInstr</b>. This function buffers
      CGM instructions to be written to a CGM referenced by <i>cgm_fd</i>. Again
      the user need not be concerned with the binary format of the file. Writes
      are performed sequentially in record size <i>size</i> as specified during
      the creation of <i>cgm_fd</i>. The same data length constraints that are
      placed on <b>CGM_getInstr</b> hold for <b>CGM_putInstr</b>. If the user
      wants to output instructions with a data length greater than 32760 bytes
      then the data must be broken up into blocks no greater than this size. The
      user must also set the boolean <i>more</i> flag in the <i>Instr</i>.
      <i>cgm_fd</i> must be a valid file descriptor open for writing. For a
      description of the fields of the <i>Instr</i> see the file
      <i>cgm_tools.h</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_flushOutputInstr</dt>
  <dd class="It-tag">Flush the output buffer used by <b>CGM_putInstr</b> for the
      file referenced by <i>cgm_fd</i>. It is necessary to explicitly flush the
      output buffer used by <b>CGM_putInstr</b> before the file is closed or any
      random access is performed. Otherwise not all CGM elements will actually
      get written.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_initMetaEdit</dt>
  <dd class="It-tag">Initialize a metafile for editing. This is the
      initialization routine for the higher level editing routines contained in
      this package: <b>CGM_copyFrames,</b> <b></b><b>CGM_deleteFrames</b>,
      <b>CGM_readFrames</b>, <b>CGM_moveFrames</b>, <b>CGM_writeFile</b>,
      <b>CGM_writeFrames</b>, and <b>CGM_mergeFrames</b>. These routines only
      work on one metafile at a time (the one named in <b>CGM_initMetaEdit</b>.
      Invoking this routine for a second time without explicitly saving any
      changes will have the effect of loading a new file and discarding all
      changes made in the previous file. <b>CGM_initMetaEdit</b> and all
      proceeding editing functions that <b>make</b> changes to the file return a
      pointer to a <i>Directory</i> as a convenience that allows the user to
      examine the state of the file. The contents of the directory are private
      and should NOT be changed by the user. A set of macros is provided in
      <i>cgm_tools.h</i> to be used for retrieving the directory's contents.
      <b>Note</b>: no changes are actually made to the edit file unless it is
      explicitly overwritten with either <b>CGM_writeFile</b> or
      <b>CGM_writeFrames</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_termMetaEdit</dt>
  <dd class="It-tag">Terminate the editing session started with
      <b>CGM_initMetaEdit</b>. This routine should be called after any editing
      changes have been saved, if desired to save them, and before exiting the
      editing session. <b>CGM_termMetaEdit</b> frees valuable resources.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_copyFrames</dt>
  <dd class="It-tag">Copy <i>num</i> frames beginning with <i>start</i> to the
      frame addressed by <i>target</i>. If <i>target</i> is already occupied
      then the source frames are inserted in its place while the target frame,
      and all proceeding frames, are advanced. <b>CGM_copy</b> operates on the
      file initialized by <b>CGM_initMetaEdit</b> (the edit file). On successful
      completion a pointer to the current directory is returned. On error a NULL
      pointer is returned.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_deleteFrames</dt>
  <dd class="It-tag">Delete <i>num</i> frames from the edit file starting with
      frame <i>start</i>. On successful completion a pointer to the current
      directory is returned. On error a NULL pointer is returned.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_mergeFrames</dt>
  <dd class="It-tag">Overwrite the contents of frame addressed <i>bottom</i>
      with the union of the frame at location <i>bottom</i> and the frame at
      location <i>top</i>. The effect of this command is equivalent to drawing
      the <i>top</i> frame on top of the <i>bottom</i> frame. It is not a union
      in the true sense of the word. On successful completion a pointer to the
      current directory is returned. On error a NULL pointer is returned.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_moveFrames</dt>
  <dd class="It-tag">Move a block of <i>num</i> frames from the edit file
      starting with with frame <i>start</i> to the position occupied by frame
      <i>target</i> On successful completion a pointer to the current directory
      is returned. On error a NULL pointer is returned.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_readFrames</dt>
  <dd class="It-tag">Read <i>num</i> frames from metafile <i>file</i> starting
      with frame <i>start</i>. Insert the frames at address <i>target</i> in the
      edit file. On successful completion a pointer to the current directory is
      returned. On error a NULL pointer is returned.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_validCGM</dt>
  <dd class="It-tag">Determine whether a file is a valid NCAR CGM or not. This
      function performs a few simple diagnostics in an effort to determine
      whether a given file is in the NCAR CGM format. The tests performed are
      not rigorous and it is conceivable that the information retrieved is
      incorrect. A return of 1 indicates a valid NCAR CGM. A return of 0
      indicates the file is not a NCAR CGM. A return of -1 indicates an error
      occurred and the global variable `errno' is set accordingly.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_writeFile</dt>
  <dd class="It-tag">Write the entire contents of the current edit file to
      <i>file</i>. <b>CGM_writeFile</b> returns the integer one on success and a
      negative number on failure.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_writeFrames</dt>
  <dd class="It-tag">Write a block of <i>num</i> frames starting with frame
      <i>start</i> to <i>file</i>. The source frames come from the edit file.
      Note: CGM frames are contained in a wrapper made up of CGM
      <i>delimiter</i> elements. The file created by <b>CGM_writeFrames</b> will
      use the <i>wrapper</i> provided by the current edit file. Thus if a file
      <i>foo</i> contains <i>n</i> frames that are <i>read</i> into an editing
      session with a file <i>goo</i> and then these same frames are written out
      to a file <i>zoid</i>, <i>zoid</i> may or may not be the same as the
      original <i>foo</i>. <b>CGM_writeFrames</b> returns the integer one on
      success and a negative number on failure.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">CGM_appendFrames</dt>
  <dd class="It-tag">Append a block of <i>num</i> frames starting with frame
      <i>start</i> to <i>file</i>. <i>file</i> must already exist and be a valid
      NCAR CGM. <b>CGM_appendFrames</b> returns the integer one on success and a
      negative number on failure.</dd>
</dl>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
ANSI X3.122 <i>Computer Graphics Metafile for the Storage and Transfer of</i>
  <i>Picture Description Information.</i>
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
CGMs with more the one metafile stored in the are not guaranteed to work.
<div class="Pp"></div>
Should not have to explicitly flush the output buffer for <b>CGM_getInstr</b>.
  This should be handled automatically when the file is closed.
<h1 class="Sh" title="Sh" id="COPYRIGHT"><a class="selflink" href="#COPYRIGHT">COPYRIGHT</a></h1>
Copyright (C) 1987-2009
<div>&#x00A0;</div>
University Corporation for Atmospheric Research
<div>&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
The use of this Software is governed by a License Agreement.</div>
<table class="foot">
  <tr>
    <td class="foot-date">January 1993</td>
    <td class="foot-os">NCARG</td>
  </tr>
</table>
</body>
</html>
