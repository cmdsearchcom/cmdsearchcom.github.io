<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>r.flow(1grass)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">r.flow(1grass)</td>
    <td class="head-vol">Grass User's Manual</td>
    <td class="head-rtitle">r.flow(1grass)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
<i></i><b>r.flow</b> - Constructs flowlines.
<div>&#x00A0;</div>
Computes flowlines, flowpath lengths, and flowaccumulation (contributing areas)
  from a elevation raster map.
<h1 class="Sh" title="Sh" id="KEYWORDS"><a class="selflink" href="#KEYWORDS">KEYWORDS</a></h1>
raster, hydrology
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>r.flow</b>
<div>&#x00A0;</div>
<b>r.flow --help</b>
<div>&#x00A0;</div>
<b>r.flow</b> [-<b>u3m</b>] <b>elevation</b>=<i>name</i>
  [<b>aspect</b>=<i>name</i>] [ <b>barrier</b>=<i>name</i>]
  [<b>skip</b>=<i>integer</i>] [ <b>bound</b>=<i>integer</i>]
  [<b>flowline</b>=<i>name</i>] [<b>flowlength</b>=<i>name</i>]
  [<b>flowaccumulation</b>= <i>name</i>] [--<b>overwrite</b>] [--<b>help</b>]
  [-- <b>verbose</b>] [--<b>quiet</b>] [--<b>ui</b>]
<h2 class="Ss" title="Ss" id="Flags:"><a class="selflink" href="#Flags:">Flags:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-u</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Compute upslope flowlines instead of default downhill flowlines</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-3</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    3D lengths instead of 2D</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-m</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Use less memory, at a performance penalty</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--overwrite</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Allow output files to overwrite existing files</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--help</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Print usage summary</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--verbose</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Verbose module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--quiet</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Quiet module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ui</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Force launching GUI dialog</dd>
</dl>
<h2 class="Ss" title="Ss" id="Parameters:"><a class="selflink" href="#Parameters:">Parameters:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>elevation</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of input elevation raster map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>aspect</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of input aspect raster map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>barrier</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of input barrier raster map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>skip</b>=<i>integer</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Number of cells between flowlines</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>bound</b>=<i>integer</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Maximum number of segments per flowline</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>flowline</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output flow line vector map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>flowlength</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output flow path length raster map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>flowaccumulation</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output flow accumulation raster map</dd>
</dl>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<i>r.flow</i> generates flowlines using a combined raster-vector approach (see
  Mitasova and Hofierka 1993 and Mitasova et al. 1995) from an input
  <b>elevation</b> raster map (integer or floating point), and optionally an
  input <b>aspect</b> raster map and/or an input <b>barrier</b> raster map.
<div class="Pp"></div>
There are three possible output raster maps which can be produced in any
  combination simultaneously: a vector map <b>flowline</b> of flowlines, a
  raster map <b>flowlength</b> of flowpath lengths, and a raster map
  <b>flowaccumulation</b> of flowline densities (which are equal upslope
  contributed areas per unit width, when multiplied by resolution).
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
Aspect used for input must follow the same rules as aspect computed in other
  modules (see <i>v.surf.rst</i> or <i>r.slope.aspect</i>).
<div class="Pp"></div>
Output <b>flowline</b> is generated downhill. The line segments of flowline
  vectors have endpoints on edges of a grid formed by drawing imaginary lines
  through the centers of the cells in the elevation map. Flowlines are generated
  from each cell downhill by default; they can be generated uphill using the
  flag <b>-u</b>. A flowline stops if its next segment would reverse the
  direction of flow (from up to down or vice-versa), cross a barrier, or arrive
  at a cell with undefined elevation or aspect. Another option, <b>skip</b>,
  indicates that only the flowlines from every val-th cell are to be included in
  <b>flowline</b>. The default <b>skip</b> is max(1, &lt;rows in
  elevation&gt;/50, &lt;cols in elevation&gt;/50). A high <b>skip</b> usually
  speeds up processing time and often improves the readability of a
  visualization of <b>flowline</b>.
<div class="Pp"></div>
Flowpath length output is given in a raster map <b>flowlength</b>. The value in
  each grid cell is the sum of the planar lengths of all segments of the
  flowline generated from that cell. If the flag <b>-3</b> is given, elevation
  is taken into account in calculating the length of each segment.
<div class="Pp"></div>
Flowline density downhill or uphill output is given in a raster map
  <b>flowaccumulation.</b> The value in each grid cell is the number of
  flowlines which pass through that grid cell, that means the number of
  flowlines from thec entire map which have segment endpoints within that cell.
  With the <b>-m</b> flag less memory is used as aspect at each cell is computed
  on the fly. This option incurs a severe performance penalty. If this flag is
  given, the <b>aspect</b> input map (if any) will be ignored. The
  <b>barrier</b> parameter is a raster map name with non-zero values
  representing barriers as input.
<div class="Pp"></div>
For best results, use input elevation maps with high precision units (e.g.,
  centimeters) so that flowlines do not terminate prematurely in flat areas. To
  prevent the creation of tiny flowline segments with imperceivable changes in
  elevation, an endpoint which would land very close to the center of a grid
  cell is quantized to the exact center of that cell. The maximum distance
  between the intercepts along each axis of a single diagonal segment and
  another segment of 1/2 degree different aspect is taken to be &quot;very
  close&quot; for that axis. Note that this distance (the so-called
  &quot;quantization error&quot;) is about 1-2% of the resolution on maps with
  square cells.
<div class="Pp"></div>
The values in length maps computed using the <b>-u</b> flag represent the
  distances from each cell to an upland flat or singular point. Such distances
  are useful in water erosion modeling for computation of the LS factor in the
  standard form of USLE. Uphill flowlines merge on ridge lines; by redirecting
  the order of the flowline points in the output vector map, dispersed waterflow
  can be simulated. The density map can be used for the extraction of ridge
  lines.
<div class="Pp"></div>
Computing the flowlines downhill simulates the actual flow (also known as the
  raindrop method). These flowlines tend to merge in valleys; they can be used
  for localization of areas with waterflow accumulation and for the extraction
  of channels. The downslope flowline density multiplied by the resolution can
  be used as an approximation of the upslope contributing area per unit contour
  width. This area is a measure of potential water flux for the steady state
  conditions and can be used in the modeling of water erosion for the
  computation of the unit stream power based LS factor or sediment transport
  capacity.
<div class="Pp"></div>
<i>r.flow</i> has been designed for modeling erosion on hillslopes and has
  rather strict conditions for ending flowlines. It is therefore not very
  suitable for the extraction of stream networks or delineation of watersheds
  unless a DEM without pits or flat areas is available ( <i>r.fill.dir</i> can
  be used to fill pits).
<div class="Pp"></div>
To label the vector flowlines automatically, the user can use <i>v.category</i>
  (add categories).
<h2 class="Ss" title="Ss" id="Algorithm_background"><a class="selflink" href="#Algorithm_background">Algorithm
  background</a></h2>
<i>r.flow</i> uses an original vector-grid algorithm which uses an infinite
  number of directions between 0.0000... and 360.0000... and traces the flow as
  a line (vector) in the direction of gradient (rather than from cell to cell in
  one of the 8 directions = D-infinity algorithm). They are traced in any
  direction using aspect (so there is no limitation to 8 directions here). The
  D8 algorithm produces zig-zag lines. The value in the outlet is very similar
  for <i>r.flow</i> algorithm (because it is essentially the watershed area),
  however the spatial distribution of flow, especially on hillslopes is quite
  different. It is still a 1D flow routing so the dispersal flow is not
  accurately described, but still better than D8.
<div class="Pp"></div>
<i>r.flow</i> uses a single flow algorithm, i.e. all flow is transported to a
  single cell downslope.
<h2 class="Ss" title="Ss" id="Diagnostics"><a class="selflink" href="#Diagnostics">Diagnostics</a></h2>
<pre>
Elevation raster map resolution differs from current region resolution
</pre>
The resolutions of all input raster maps and the current region must match (see
  <i>g.region</i>).
<div>&#x00A0;</div>
<pre>
Resolution too unbalanced
</pre>
The difference in length between the two axes of a grid cell is so great that
  quantization error is larger than one of the dimensions. Resample the map and
  try again.
<h1 class="Sh" title="Sh" id="EXAMPLE"><a class="selflink" href="#EXAMPLE">EXAMPLE</a></h1>
In this example a flow line vector map, a flow path length raster map and a flow
  accumulation raster map are computed from an elevation raster map (North
  Carolina sample dataset):
<div>&#x00A0;</div>
<pre>
g.region raster=elevation -p
r.flow elevation=elevation skip=3 flowline=flowline flowlength=flowlength \
       flowaccumulation=flowaccumulation
</pre>
<div class="Pp"></div>
Figure: Flow lines with underlying elevation map; flow lines with underlying
  flow path lengths (in map units: meters); flow accumulation map (zoomed view)
<h1 class="Sh" title="Sh" id="REFERENCES"><a class="selflink" href="#REFERENCES">REFERENCES</a></h1>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Mitasova, H., L. Mitas, 1993, Interpolation by regularized
      spline with tension : I. Theory and implementation. Mathematical Geology
      25, p. 641-655. (online)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Mitasova and Hofierka 1993 : Interpolation by Regularized
      Spline with Tension: II. Application to Terrain Modeling and Surface
      Geometry Analysis. Mathematical Geology 25(6), 657-669 (online).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Mitasova, H., Mitas, L., Brown, W.M., Gerdes, D.P.,
      Kosinovsky, I., Baker, T., 1995: Modeling spatially and temporally
      distributed phenomena: New methods and tools for GRASS GIS. International
      Journal of Geographical Information Systems 9(4), 433-446.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Mitasova, H., J. Hofierka, M. Zlocha, L.R. Iverson, 1996,
      Modeling topographic potential for erosion and deposition using GIS. Int.
      Journal of Geographical Information Science, 10(5), 629-641. (reply to a
      comment to this paper appears in 1997 in Int. Journal of Geographical
      Information Science, Vol. 11, No. 6)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Mitasova, H.(1993): Surfaces and modeling. Grassclippings
      (winter and spring) p.18-19.</dd>
</dl>
</div>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<i></i> <i>r.basins.fill,</i> <i>r.drain,</i> <i>r.fill.dir,</i>
  <i>r.water.outlet,</i> <i>r.watershed,</i> <i>v.category,</i> <i>v.to.rast</i>
  <i></i>
<h1 class="Sh" title="Sh" id="AUTHORS"><a class="selflink" href="#AUTHORS">AUTHORS</a></h1>
<i>Original version of program:</i> Maros Zlocha and Jaroslav Hofierka, Comenius
  University, Bratislava, Slovakia
<div class="Pp"></div>
<i>The current version of the program (adapted for GRASS 5.0)</i>: Joshua
  Caplan, Mark Ruesink, Helena Mitasova, University of Illinois at
  Urbana-Champaign with support from USA CERL. GMSL/University of Illinois at
  Urbana-Champaign
<div class="Pp"></div>
<i>Last changed: $Date: 2015-07-20 12:04:18 +0200 (Mon, 20 Jul 2015) $</i>
<h1 class="Sh" title="Sh" id="SOURCE_CODE"><a class="selflink" href="#SOURCE_CODE">SOURCE
  CODE</a></h1>
Available at: r.flow source code (history)
<div class="Pp"></div>
Main index | Raster index | Topics index | Keywords index | Graphical index |
  Full index
<div class="Pp"></div>
&#x00A9; 2003-2016 GRASS Development Team, GRASS GIS 7.2.0 Reference
  Manual</div>
<table class="foot">
  <tr>
    <td class="foot-date"></td>
    <td class="foot-os">GRASS 7.2.0</td>
  </tr>
</table>
</body>
</html>
