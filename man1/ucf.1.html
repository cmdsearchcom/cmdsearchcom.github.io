<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:41:16 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>UCF(1) Debian GNU/Linux manual UCF(1)</p>

<p style="margin-top: 1em">NAME <br>
ucf - Update Configuration File: preserve user changes in
configuration files</p>

<p style="margin-top: 1em">SYNOPSIS <br>
ucf [options] &lt;New File&gt; &lt;Destination&gt;</p>

<p style="margin-top: 1em">ucf [options] --purge
&lt;Destination&gt;</p>

<p style="margin-top: 1em">DESCRIPTION <br>
This utility provides a means of asking the user whether or
not to accept new versions of configuration files provided
by the package maintainer, with various heuristics designed
<br>
to minimize interaction time. It uses debconf to interact
with the user, as per Debian policy. In the SYNOPSIS above,
New file is the configuration file as provided by the
pack&acirc; <br>
age (either shipped with the package, or generated by the
maintainer scripts on the fly), and Destination is the
location (usually under /etc) where the real configuration
file <br>
lives, and is potentially modified by the end user. Since
the files edited would be real files, and not symbolic
links, ucf follows and resolves symbolic links before
acting. As <br>
far as possible, ucf attempts to preserve the ownership and
permission of the New file as it is copied to the new
location.</p>

<p style="margin-top: 1em">This script attempts to provide
conffile like handling for files installed under /etc not
shipped in a Debian package, but handled by the postinst
instead. Debian policy states <br>
that files under /etc which are configuration files must
preserve user changes, and this applies to files handled by
maintainer scripts as well. Using ucf, one may ship a bunch
<br>
of default configuration files somewhere in /usr (
/usr/share/&lt;pkg&gt; is a good location), and maintain
files in /etc, preserving user changes and in general
offering the same <br>
facilities while upgrading that dpkg normally provides for
&acirc;conffiles&acirc;</p>

<p style="margin-top: 1em">Additionally, this script
provides facilities for transitioning a file that had not
been provided conffile like protection to come under this
schema, and attempts to minimize <br>
questions asked at install time. Indeed, the transitioning
facility is better than the one offered by dpkg while
transitioning a file from a non-conffile to conffile status.
The <br>
second form in the SYNOPSIS above is for purging information
about the configuration file when the package is purged; and
is critical for allowing smooth reinstallations.</p>

<p style="margin-top: 1em">During the course of operations,
when working with configuration files, ucf optionally
creates copies of versions of the configuration file in
question. For example, a file with <br>
the suffix ucf-old holds the old version of a configuration
file replaced by ucf. Also, copies of the configuration file
with the suffixes ucf-new and ucf-dist may be created; <br>
and the maintainer scripts should consider purging copies of
the configuration file with these extensions during
purge.</p>

<p style="margin-top: 1em">OPTIONS <br>
-h, --help <br>
Print a short usage message</p>

<p style="margin-top: 1em">-n, --no-action <br>
Dry run. Print the actions that would be taken if the script
is invoked, but take no action.</p>

<p style="margin-top: 1em">-d[n], --debug=[n] <br>
Set the debug level to the (optional) level n (n defaults to
1). Please note there must be no spaces before the optional
digit n. This turns on copious debugging informa&acirc; <br>
tion.</p>

<p style="margin-top: 1em">-p, --purge <br>
Removes all vestiges of the file from the state hashfile.
This is required to allow a package to be reinstalled after
it is purged; since otherwise, the real configuration <br>
file is removed, but it remains in the hash file; and on
reinstall no action is taken, since the md5sum of the new
file matches that in the hashfile. In short, remember <br>
to use this option in the postrm for every configuration
file managed by ucf when the package is being purged
(assuming ucf itself exists). Note: ucf does not actually
<br>
touch the file on disk in this operation, so any file
removals are still the responsibility of the calling
package.</p>

<p style="margin-top: 1em">-v, --verbose <br>
Make the script be very verbose about setting internal
variables.</p>

<p style="margin-top: 1em">-s foo, --src-dir foo <br>
Set the source directory (historical md5sums are expected to
live in files and sub directories of this directory) to foo.
By default, the directory the new_file lives in <br>
is assumed to be the source directory. Setting this option
overrides settings in the environment variable
UCF_SOURCE_DIR, and in the configuration file variable <br>
conf_source_dir.</p>

<p style="margin-top: 1em">--sum-file foo <br>
Force the historical md5sums to be read from this file,
rather than defaulting to living in the source directory.
Setting this option overrides settings in the environ&acirc;
<br>
ment variable UCF_OLD_MDSUM_FILE, and in the configuration
file variable conf_old_mdsum_file.</p>

<p style="margin-top: 1em">--three-way <br>
This turns on the option, during installation, for the user
to be offered a chance to see a merge of the changes between
old maintainer version and the new maintainer ver&acirc;
<br>
sion into the local copy of the configuration file. If the
user likes what they see, they can ask to have these changes
merged in. This allows one to get new upstream <br>
changes merged in even while retaining local modifications
to the configuration file. This is accomplished by taking
the configuration file and stashing it in a cache area <br>
during registration, and using diff3 during the install (the
stashed file name is a munged version of the full path of
the configuration file to avoid name space clashes). <br>
Note This option appeared in Version 0.8 of ucf, which was
the first version released into unstable and ultimately
Sarge. The version of ucf in woody does not contain <br>
this option.</p>

<p style="margin-top: 1em">--debconf-ok <br>
Indicate that it is ok for ucf to use an already running
debconf instance for prompting (it has always been ok to use
ucf when debconf is not running -- it shall invoke <br>
debconf as needed). Since historically maintainer scripts
that used debconf and also ucf had to disable/cripple
debconf before running ucf (since ucf did not prompt with
<br>
debconf, and needed stdio available), ucf must be cautious
when called from a maintainer script that uses debconf. This
option lets it know that the maintainer script has <br>
not told debconf to stop, or redirected its stdio from
debconf, or anything of the sort -- and thus it is safe to
use debconf even when the script discovers that debconf <br>
is running. Packages that call ucf with this option should
take care to depend on version 0.28 or higher of ucf (the
first to support use this option).</p>

<p style="margin-top: 1em">--debconf-template foo <br>
Instruct ucf to use the named multiselect debconf template
instead of the normal ucf-provided debconf template. The
caller is responsible for ensuring that the named tem&acirc;
<br>
plate exists and has a list of choices matching those for
the default ucf template, and should set Choices-C:
${CHOICES} to ensure the returned values match those from
the <br>
default template. Note that the choices must be different
according to whether the --three-way option is also set.</p>

<p style="margin-top: 1em">--state-dir /path/to/dir <br>
Set the state directory to /path/to/dir instead of the
default /var/lib/ucf. Used mostly for testing.</p>

<p style="margin-top: 1em">USAGE <br>
The most common case usage is pretty simple: a single line
invocation in the postinst on configure, and another single
line in the postrm to tell ucf to forget about the
configu&acirc; <br>
ration file on purge (using the --purge option) is all that
is needed (assuming ucf is still on the system).</p>

<p style="margin-top: 1em">It is recommended that you also
register any file being managed by ucf with the ucf
registry; this associates the configuration file with the
package it belongs to. This is done <br>
with a simple call to ucfr. Users may then query the
association between a configuration file and the package
using the tool ucfq. Please see the appropriate manual pages
for <br>
details.</p>

<p style="margin-top: 1em">If a file maintained by
maintainer scripts is being transitioned from an unprotected
status to the protection afforded by the script, the
maintainer can help ease the transition <br>
by reducing the questions that may be asked at installation
time. Specifically, questions should not be asked if the
file in question is an unmodified version that was one <br>
shipped in a previous version of this package; and the
maintainer can help by telling the script about the
historical md5sums that published versions of this file
contained.</p>

<p style="margin-top: 1em">The way to do this is to either
create a file called &lt;New file&gt;.md5sum, with one
md5sum on each line, (the file names you use are ignored,
except for the entry named default), or <br>
create a directory, called &lt;New file&gt;.md5sum.d, which
should contain any number of files, each containing a single
line, namely, the md5sum of a previous version of &lt;New
file&gt;. <br>
The names of these files are not important, with one
exception: The file called default is treated specially. For
example, the author personally uses either package version
num&acirc; <br>
bers or release code names, like 7.6.3, or potato. If none
of the historical md5sums match, we are almost certain that
either the historical record of md5sums is not complete,
<br>
or the user has changed the configuration file.</p>

<p style="margin-top: 1em">The default historical md5sum
<br>
The exception to the rule about names mentioned earlier is
that if no md5sums match, and if the file &lt;New
file&gt;.md5sum.d/default exists, or if there is a line
corresponding to a <br>
default file in &lt;New file&gt;.md5sum, it shall be used as
the default md5sum of the previous version of the package
assumed to have been installed on this machine. As you can
see, <br>
unless there are limited number of previously released
packages (like just one), the maintainer is also making an
informed guess, but the option is provided to the
maintainer.</p>

<p style="margin-top: 1em">If the file &lt;New
file&gt;.md5sum, or the directory &lt;New file&gt;.md5sum.d
does not exist, or none of the md5sums match, we test the
installed &lt;Destination&gt; file to see whether it is <br>
the same as the &lt;New file&gt;. If not, we ask the user
whether they want us to replace the file.</p>

<p style="margin-top: 1em">An additional facility is also
offered: optionally, ucf can store one old version of the
maintainers copy of the configuration file, and, on upgrade,
calculate the changes made <br>
in the maintainers version of the configuration file, and
apply that patch to the local version of the file (on user
request, of course). There is also a preview facility where
<br>
the user can inspect the results of such a merge, before
asking the action to be taken.</p>

<p style="margin-top: 1em">ENVIRONMENT VARIABLES <br>
The variable UCF_FORCE_CONFFNEW, if set, forces the new file
to always overwrite the installed destination file, while
the variable UCF_FORCE_CONFFOLD, if set silently retains
<br>
the installed file. UCF_FORCE_CONFFMISS is only applicable
when the installed destination file does not exist (perhaps
due to user removal),and forces ucf to recreate the
miss&acirc; <br>
ing file (the default behaviour is to honor the users wishes
and not recreate the locally deleted file).</p>

<p style="margin-top: 1em">FILES <br>
This script creates the file new_file.md5sum, and it may
copy the file (presumably shipped with the package) &lt;New
file&gt; to its destination, &lt;Destination&gt;.</p>

<p style="margin-top: 1em">/var/lib/ucf/hashfile, and
/var/lib/ucf/hashfile.X, where X is a small integer, where
previous versions of the hashfile are stored.</p>

<p style="margin-top: 1em">/etc/ucf.conf</p>

<p style="margin-top: 1em">EXAMPLES <br>
If the package foo wants to use ucf to handle user
interaction for configuration file foo.conf, a version of
which is provided in the package as
/usr/share/foo/configuration, a <br>
simple invocation of ucf in the post inst file is all that
is needed:</p>

<p style="margin-top: 1em">ucf /usr/share/foo/configuration
/etc/foo.conf</p>

<p style="margin-top: 1em">On purge, one should tell ucf to
forget about the file (see detailed examples in
/usr/share/doc/ucf/examples):</p>

<p style="margin-top: 1em">ucf --purge /etc/foo.conf Please
note that purge can also be used to make ucf forget the
previous state of the files, and when the package is next
installed or updated, ucf will <br>
ask the user to replace the current cofiguration file. Do
this if you want to change your decision to not update to a
maintainer provided version of the configuration file.</p>

<p style="margin-top: 1em">The motivation for this script
was to provide conffile like handling for start files for
emacs lisp packages (for example,
/etc/emacs21/site-start.d/50psgml-init.el ) These start <br>
files are not shipped with the package, instead, they are
installed during the post installation configuration phase
by the script /usr/lib/emacsen-common/emacs-package-install
<br>
$package_name.</p>

<p style="margin-top: 1em">This script is meant to be
invoked by the packages install script at
/usr/lib/emacsen-common/packages/install/$package_name for
each flavour of installed emacsen by calling it <br>
with the proper values of new file (
/usr/share/emacs/site-lisp/&lt;pkg&gt;/&lt;pkg-init.el ),
and dest file ( /etc/emacs21/site-start.d/50&lt;pkg-init.el
), and it should do the rest.</p>

<p style="margin-top: 1em">SEE ALSO <br>
ucf.conf(5), ucfr(1), ucfq(1), and diff3(1). The Debian
Emacs policy, shipped with the package emacsen-common.</p>

<p style="margin-top: 1em">AUTHOR <br>
This manual page was written Manoj Srivastava
&lt;srivasta@debian.org&gt;, for the Debian GNU/Linux
system.</p>

<p style="margin-top: 1em">Debian May 30 2008 UCF(1)</p>
<hr>
</body>
</html>
