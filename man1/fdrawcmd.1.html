<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>fdrawcmd(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">fdrawcmd(1)</td>
    <td class="head-vol">General Commands Manual</td>
    <td class="head-rtitle">fdrawcmd(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="Name"><a class="selflink" href="#Name">Name</a></h1>
fdrawcmd - send raw commands to the floppy disk controller
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="Note"><a class="selflink" href="#Note">Note</a></h1>
This manpage has been automatically generated from fdutils's texinfo
  documentation. However, this process is only approximative, and some items,
  such as cross-references, footnotes and indices are lost in this translation
  process. Indeed, these items have no appropriate representation in the manpage
  format. Moreover, only the items specific to each command have been
  translated, and the general information about fdutils has been dropped in the
  manpage version. Thus I strongly advise you to use the original texinfo doc.
<dl class="Bl-tag">
  <dt class="It-tag">* &#x00A0;&#x00A0;</dt>
  <dd class="It-tag">To generate a printable copy from the texinfo doc, run the
      following commands:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
<br/>
    ./configure; make dvi; dvips fdutils.dvi
    </pre>
    <br/>
    <div style="height: 1.00em;">&#x00A0;</div>
    </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">* &#x00A0;&#x00A0;</dt>
  <dd class="It-tag">To generate a HTML copy, run:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
<br/>
    ./configure; make html
    </pre>
    <br/>
    <div style="height: 1.00em;">&#x00A0;</div>
    A pre-made HTML can be found at: `http://www.tux.org/pub/knaff/fdutils'</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">* &#x00A0;&#x00A0;</dt>
  <dd class="It-tag">To generate an info copy (browsable using emacs' info
      mode), run:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
<br/>
    ./configure; make info
    </pre>
    <br/>
    <div style="height: 1.00em;">&#x00A0;</div>
    </dd>
</dl>
<div class="Pp"></div>
The texinfo doc looks most pretty when printed or as HTML. Indeed, in the info
  version certain examples are difficult to read due to the quoting conventions
  used in info.
<h1 class="Sh" title="Sh" id="Description"><a class="selflink" href="#Description">Description</a></h1>
<pre>
<br/>
fdrawcmd [drive= <i>drive</i>] [rate=<i>rate</i>]
[length= <i>length</i>] [repeat=<i>repeat</i>]
[cylinder= <i>physical-cyl</i>] <i>command</i> [<i>parameters</i> ...] [<i>mode</i>]
</pre>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
fdrawcmd is used to send raw commands to the floppy disk controller, after
  having selected a given drive. You must have write permission to the selected
  drive.
<div class="Pp"></div>
When writing to a disk, data is read from stdin; when reading, data is printed
  to stdout. Diagnostic messages, return values from the controller, and the
  value of the disk change line after the command are printed to stderr.
<h1 class="Sh" title="Sh" id="Options"><a class="selflink" href="#Options">Options</a></h1>
All numbers may be given in octal (0211), decimal (137), or hexadecimal (0x89).
<dl class="Bl-tag">
  <dt class="It-tag">drive=<i>drive</i>&#x00A0;</dt>
  <dd class="It-tag">Selects the drive. The default is drive 0
    (`/dev/fd0').</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">rate=<i>rate</i>&#x00A0;</dt>
  <dd class="It-tag">Selects the data transfer rate. Use 0 for high density
      disks, 1 for double density 5 1/4 disks (or 2 Mbps tapes, if the
      appropriate rate table is selected), and 2 for double density 3 1/2
    disks.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">length=<i>length</i>&#x00A0;</dt>
  <dd class="It-tag">Describes the length of the transferred data for commands
      reading from and writing to the disk. The default is to continue until end
      of file.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">repeat=<i>count</i>&#x00A0;</dt>
  <dd class="It-tag">Repeat the command <i>count</i> times. This only works
      correctly for commands which don't do any data transfer.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">cylinder=<i>count</i>&#x00A0;</dt>
  <dd class="It-tag">Seek to the given cylinder before executing the
    command</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>command</i>&#x00A0;</dt>
  <dd class="It-tag">The name of the command to send. <i>command</i> may be a
      spelled out name (like read or write), or a number representing the
      commands floppy disk controller opcode. A named command has already a mode
      associated with it, whereas for a number the mode parameter should be
      described using the mode option.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>parameters</i>&#x00A0;</dt>
  <dd class="It-tag">The parameters for the command (optional, not all commands
      need parameters).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>mode</i>&#x00A0;</dt>
  <dd class="It-tag">Various flags or'ed together describing the properties of
      the command.</dd>
</dl>
<h1 class="Sh" title="Sh" id="Commands"><a class="selflink" href="#Commands">Commands</a></h1>
The description of the various floppy commands given in this manpage is very
  sketchy. For more details get the 82078 spec sheet which can be found at:
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
<br/>
http://www-techdoc.intel.com/docs/periph/fd_contr/datasheets/
</pre>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
Look for the chapter COMMAND SET/DESCRIPTIONS. Older FDCs only support a subset
  of the commands described therein, but the syntax for the commands that do
  exist is the same.
<h2 class="Ss" title="Ss" id="Commands_available_on_all_FDCs"><a class="selflink" href="#Commands_available_on_all_FDCs">Commands&#x00A0;available&#x00A0;on&#x00A0;all&#x00A0;FDCs</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">read&#x00A0;<i>drvsel&#x00A0;cyl&#x00A0;head&#x00A0;sect&#x00A0;szcod&#x00A0;spt&#x00A0;rw-gap&#x00A0;szcod2</i>&#x00A0;</dt>
  <dd class="It-tag">Reads <i>length</i> bytes of data from the disk.
      <i>drvsel</i> is the drive selector. Bit 0 and 1 describe the drive, and
      bit 2 describes the head. The remaining parameters give the cylinder, head
      (yes, again), sector, size of the sector (128 * 2 ^ <i>szcod</i>), sectors
      per track (spt, this is used to switch to the second head when the first
      side has been read), and size of the read-write gap. <i>szcod2</i> should
      be 0xff. read returns <i>ST0 ST1 ST2</i> and <i>cyl head sect</i>
      <i>szcod</i> of the next sector to be read; see
      `/usr/include/linux/fdreg.h' .</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">N.B. Certain newer floppy disk controllers are buggy, and
      do not correctly recognize the end of transfer when operating in virtual
      DMA mode. For these, you need to set spt to the id of the last sector to
      be read (for example, if you intend to read sectors 2, 3, 4, set spt to 4,
      even if the disk has more sectors), and set the no-mt flag.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">write&#x00A0;<i>drvsel&#x00A0;cyl&#x00A0;head&#x00A0;sect&#x00A0;szcod&#x00A0;spt&#x00A0;rw-gap&#x00A0;szcod2</i>&#x00A0;</dt>
  <dd class="It-tag">Analogous to read.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">sense&#x00A0;<i>drvsel</i>&#x00A0;</dt>
  <dd class="It-tag">Returns the third status byte (<i>ST3</i>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">recalibrate&#x00A0;<i>drvsel</i>&#x00A0;</dt>
  <dd class="It-tag">Recalibrates the drive and returns <i>ST0 ST1</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">seek&#x00A0;<i>drvsel&#x00A0;cyl</i>&#x00A0;</dt>
  <dd class="It-tag">Moves the head to <i>cyl</i> and returns <i>ST0
    ST1</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">specify&#x00A0;<i>drvsel&#x00A0;spec1&#x00A0;spec2</i>&#x00A0;</dt>
  <dd class="It-tag">Specify various parameters to the drive.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">format&#x00A0;<i>drvsel&#x00A0;szcod&#x00A0;sect-per-track&#x00A0;fmt-gap&#x00A0;fmt-fill</i>&#x00A0;</dt>
  <dd class="It-tag">Formats the cylinder. The new sectors are filled with
      <i>fmt-fill</i>. The header information comes from the input, which is
      made up of <i>cyl head sect szcod</i> quadruples. The <i>szcod</i>
      parameter from the command line is used to describe the actual size of the
      sectors, and the <i>szcod</i> from the input is used to write into the
      header. However, the first write to these sectors will use the header
      information, and might overwrite the following sectors if the <i>szcod</i>
      parameter from the command line was too small.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">readid&#x00A0;<i>drvsel</i>&#x00A0;</dt>
  <dd class="It-tag">reads the first sector header that comes and returns <i>ST0
      ST1 ST2 </i> and <i>cyl head sect szcod </i> of the encountered
    header.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Commands_available_on_82072_and_later"><a class="selflink" href="#Commands_available_on_82072_and_later">Commands&#x00A0;available&#x00A0;on&#x00A0;82072&#x00A0;and&#x00A0;later</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">dumpregs&#x00A0;</dt>
  <dd class="It-tag">Prints the contents of the FDCs registers, if
    supported.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Commands_available_on_82072A_and_later"><a class="selflink" href="#Commands_available_on_82072A_and_later">Commands&#x00A0;available&#x00A0;on&#x00A0;82072A&#x00A0;and&#x00A0;later</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">configure&#x00A0;<i>conf1&#x00A0;conf2&#x00A0;conf3</i>&#x00A0;</dt>
  <dd class="It-tag">Configures FIFO operation.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Commands_available_on_82077_and_later"><a class="selflink" href="#Commands_available_on_82077_and_later">Commands&#x00A0;available&#x00A0;on&#x00A0;82077&#x00A0;and&#x00A0;later</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">version&#x00A0;</dt>
  <dd class="It-tag">Echoes 0x90 if the FDC is more recent than 82072A, and 0x80
      otherwise</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">perpendicular&#x00A0;<i>rate</i>&#x00A0;</dt>
  <dd class="It-tag">Sets the perpendicular mode. Use 0 for normal, 2 for
      500kb/s perpendicular, and 3 for 1 Mb/s perpendicular.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">seek_out&#x00A0;<i>drvsel&#x00A0;n</i>&#x00A0;</dt>
  <dd class="It-tag">does a relative seek of <i>n</i> cylinders towards cylinder
      0.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">seek_in&#x00A0;&#x00A0;<i>drvsel&#x00A0;n</i>&#x00A0;</dt>
  <dd class="It-tag">does a relative seek of <i>n</i> cylinders away from
      cylinder 0.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Commands_available_on_82077AA_and_later"><a class="selflink" href="#Commands_available_on_82077AA_and_later">Commands&#x00A0;available&#x00A0;on&#x00A0;82077AA&#x00A0;and&#x00A0;later</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">lock&#x00A0;</dt>
  <dd class="It-tag">Locks the FIFO configuration, so that it survives a FDC
      software reset.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">unlock&#x00A0;</dt>
  <dd class="It-tag">Unlock the FIFO configuration</dd>
</dl>
<h2 class="Ss" title="Ss" id="Commands_available_on_82078"><a class="selflink" href="#Commands_available_on_82078">Commands&#x00A0;available&#x00A0;on&#x00A0;82078</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">partid&#x00A0;</dt>
  <dd class="It-tag">echoes a byte describing the type of the FDC in the 3 high
      bits, and the stepping in the three low bits.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">powerdown&#x00A0;<i>powerconf</i>&#x00A0;</dt>
  <dd class="It-tag">configures automatic power down of the FDC. The old
      configuration is echoed</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">option&#x00A0;<i>iso</i>&#x00A0;</dt>
  <dd class="It-tag">enables/disables ISO formats. Odd values of <i>iso</i>
      enable these formats, whereas even values disable them. ISO formats don't
      have index headers, and thus allow to fit slightly more data on a
    disk.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">save&#x00A0;</dt>
  <dd class="It-tag">prints out 16 internal registers of the FDC.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">restore&#x00A0;<i>r1&#x00A0;r2&#x00A0;r3&#x00A0;...&#x00A0;r16</i>&#x00A0;</dt>
  <dd class="It-tag">restores the 16 internal registers of the FDC.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">format_n_write&#x00A0;<i>drvsel&#x00A0;szcod&#x00A0;sect-per-track&#x00A0;fmt-gap&#x00A0;fmt-fill</i>&#x00A0;</dt>
  <dd class="It-tag">formats the cylinder and writes initial data to it. The
      input data is made up of a sequence of headers (4 bytes) and data:
      <i>header1 data1 header2 data2 ... headern datan</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">drivespec&#x00A0;<i>dspec1&#x00A0;dspec2&#x00A0;...&#x00A0;specn&#x00A0;terminator</i>&#x00A0;</dt>
  <dd class="It-tag">chooses rate tables for various drives. Each dspec byte
      describes one drive. Bits 0 and 1 say which drive is described. Bits 2 and
      3 describe the rate table. Only tables 0 and 2 are interesting. Both
      tables only differ in the meaning of rate 1. For table 0 (the default)
      rate 0 is 300 kb/s (used for 5 1/4 DD disks), whereas for table 1 it is 2
      Mbps (used for fast floppy tape drives). Bit 4 is the precompensation
      table select bit. It should be set to 0. Bit 5-7 should be zero as well.
      The <i>terminator</i> byte ends the drivespec command. It is either 0xc0
      or 0x80. If it is 0xc0, no result phase follows; if it is 0x80, the
      current data rate table configuration for the four drives is echoed.</dd>
</dl>
<h1 class="Sh" title="Sh" id="Modes"><a class="selflink" href="#Modes">Modes</a></h1>
The mode option is only needed when you describe the command as a numerical
  value. Some mode names are also valid command names. They are considered as
  command name if the command name has not yet been given, and as mode name
  otherwise.
<div class="Pp"></div>
<br/>
 If you give a command name followed by explicit modes, both the implicit flags
  of the command name, and the explicit modes are or'ed together.
<div class="Pp"></div>
<br/>
 If on the other hand you give a command name preceded by explicit modes, only
  the explicit modes are or'ed together.
<dl class="Bl-tag">
  <dt class="It-tag">read&#x00A0;</dt>
  <dd class="It-tag">Read data from disk using DMA.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">write&#x00A0;</dt>
  <dd class="It-tag">Write data to the disk.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">intr&#x00A0;</dt>
  <dd class="It-tag">Wait for an interrupt.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">spin&#x00A0;</dt>
  <dd class="It-tag">wait for the disk to spin up</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">disk&#x00A0;</dt>
  <dd class="It-tag">Aborts the operation if no disk is in the drive. This only
      works if you also chose a physical cylinder to seek to.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">no-motor&#x00A0;</dt>
  <dd class="It-tag">Don't switch on the drive motor while issuing the
    command</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">no-motor-after&#x00A0;</dt>
  <dd class="It-tag">Switch off the motor immediately after the command
    returns.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">fm&#x00A0;</dt>
  <dd class="It-tag">Uses the FM version of the read, readid, write and format
      commands.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">no-mt&#x00A0;</dt>
  <dd class="It-tag">Do not use MT (multitrack) mode for the read, readid and
      write commands. This is needed on certain broken FDC's which don't
      recognize end of transfer when running in nodma mode. In order to use
      these safely, set no-mt, and chose the id of the last sector to be read as
      sect-per-track.</dd>
</dl>
<div class="Pp"></div>
fdrawcmd opens the device node with the NDELAY flag. This means that the driver
  should not try to autodetect the disk type (it might not be formatted), and
  that it should not reset the FDC. If a reset was needed, the command simply
  fails. If that happens, execute floppycontrol --resetnow 0 , and try again.
<h1 class="Sh" title="Sh" id="See_Also"><a class="selflink" href="#See_Also">See
  Also</a></h1>
Fdutils' texinfo doc</div>
<table class="foot">
  <tr>
    <td class="foot-date">03Mar05</td>
    <td class="foot-os">fdutils-5.5</td>
  </tr>
</table>
</body>
</html>
