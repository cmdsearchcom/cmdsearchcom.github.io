<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>r.resamp.bspline(1grass)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">r.resamp.bspline(1grass)</td>
    <td class="head-vol">Grass User's Manual</td>
    <td class="head-rtitle">r.resamp.bspline(1grass)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
<i></i><b>r.resamp.bspline</b> - Performs bilinear or bicubic spline
  interpolation with Tykhonov regularization.
<h1 class="Sh" title="Sh" id="KEYWORDS"><a class="selflink" href="#KEYWORDS">KEYWORDS</a></h1>
raster, surface, resample, interpolation
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>r.resamp.bspline</b>
<div>&#x00A0;</div>
<b>r.resamp.bspline --help</b>
<div>&#x00A0;</div>
<b>r.resamp.bspline</b> [-<b>nc</b>] <b>input</b>=<i>name</i>
  <b>output</b>=<i>name</i> [ <b>grid</b>=<i>name</i>] [<b>mask</b>=<i>name</i>]
  [ <b>ew_step</b>=<i>float</i>] [<b>ns_step</b>=<i>float</i>]
  [<b>method</b>=<i>string</i>] [<b>lambda</b>=<i>float</i>]
  [<b>memory</b>=<i>integer</i>] [-- <b>overwrite</b>] [--<b>help</b>]
  [--<b>verbose</b>] [-- <b>quiet</b>] [--<b>ui</b>]
<h2 class="Ss" title="Ss" id="Flags:"><a class="selflink" href="#Flags:">Flags:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-n</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Only interpolate null cells in input raster map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-c</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Find the best Tykhonov regularizing parameter using a
      &quot;leave-one-out&quot; cross validation method</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--overwrite</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Allow output files to overwrite existing files</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--help</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Print usage summary</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--verbose</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Verbose module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--quiet</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Quiet module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ui</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Force launching GUI dialog</dd>
</dl>
<h2 class="Ss" title="Ss" id="Parameters:"><a class="selflink" href="#Parameters:">Parameters:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>input</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of input raster map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>output</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output raster map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>grid</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output vector map with interpolation grid</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>mask</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of raster map to use for masking
    <div>&#x00A0;</div>
    Only cells that are not NULL and not zero are interpolated</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>ew_step</b>=<i>float</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Length of each spline step in the east-west direction. Default: 1.5 *
    ewres.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>ns_step</b>=<i>float</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Length of each spline step in the north-south direction. Default: 1.5 *
      nsres.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>method</b>=<i>string</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Spline interpolation algorithm
    <div>&#x00A0;</div>
    Options: <i>bilinear, bicubic</i>
    <div>&#x00A0;</div>
    Default: <i>bicubic</i>
    <div>&#x00A0;</div>
     <b>bilinear</b>: Bilinear interpolation
    <div>&#x00A0;</div>
     <b>bicubic</b>: Bicubic interpolation</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>lambda</b>=<i>float</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Tykhonov regularization parameter (affects smoothing)
    <div>&#x00A0;</div>
    Default: <i>0.01</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>memory</b>=<i>integer</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Maximum memory to be used (in MB)
    <div>&#x00A0;</div>
    Cache size for raster rows
    <div>&#x00A0;</div>
    Default: <i>300</i></dd>
</dl>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<i>r.resamp.bspline</i> performs a bilinear/bicubic spline interpolation with
  Tykhonov regularization. The input is a raster surface map, e.g. elevation,
  temperature, precipitation etc. Output is a raster map. Optionally, only input
  NULL cells are interpolated, useful to fill NULL cells, an alternative to
  <i>r.fillnulls</i>. Using the <b>-n</b> flag to only interpolate NULL cells
  will considerably speed up the module.
<div class="Pp"></div>
The input raster map is read at its native resolution, the output raster map
  will be produced for the current computational region set with
  <i>g.region</i>. Any MASK will be respected, masked values will be treated as
  NULL cells in both the input and the output map.
<div class="Pp"></div>
Spline step values <b>ew_step</b> for the east-west direction and <b>ns_step</b>
  for the north-south direction should not be smaller than the east-west and
  north-south resolutions of the input map. For a raster map without NULL cells,
  1 * resolution can be used, but check for undershoots and overshoots. For very
  large areas with missing values (NULL cells), larger spline step values may be
  required, but most of the time the defaults (1.5 x resolution) should be fine.
<div class="Pp"></div>
The Tykhonov regularization parameter ( <b>lambda</b>) acts to smooth the
  interpolation. With a small <b>lambda</b>, the interpolated surface closely
  follows observation points; a larger value will produce a smoother
  interpolation. Reasonable values are 0.0001, 0.001, 0.005, 0.01, 0.02, 0.05,
  0.1 (needs more testing). For seamless NULL cell interpolation, a small value
  is required and default is set to 0.005.
<div class="Pp"></div>
From a theoretical perspective, the interpolating procedure takes place in two
  parts: the first is an estimate of the linear coefficients of a spline
  function; these are derived from the observation points using a least squares
  regression; the second is the computation of the interpolated surface (or
  interpolated vector points). As used here, the splines are 2D piece-wise
  non-zero polynomial functions calculated within a limited 2D area. The length
  of each spline step is defined by <b>ew_step</b> for the east-west direction
  and <b>ns_step</b> for the north-south direction. For optimal performance, the
  spline step values should be no less than the east-west and north-south
  resolutions of the input map. Each non-NULL cell observation is modeled as a
  linear function of the non-zero splines in the area around the observation.
  The least squares regression predicts the the coefficients of these linear
  functions. Regularization avoids the need to have one one observation and one
  coefficient for each spline (in order to avoid instability).
<div class="Pp"></div>
A cross validation &quot;leave-one-out&quot; analysis is available to help to
  determine the optimal <b>lambda</b> value that produces an interpolation that
  best fits the original observation data. The more points used for
  cross-validation, the longer the time needed for computation. Empirical
  testing indicates a threshold of a maximum of 100 points is recommended. Note
  that cross validation can run very slowly if more than 100 observations are
  used. The cross-validation output reports <i>mean</i> and <i>rms</i> of the
  residuals from the true point value and the estimated from the interpolation
  for a fixed series of <b>lambda</b> values. No vector nor raster output will
  be created when cross-validation is selected.
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
<h2 class="Ss" title="Ss" id="Basic_interpolation"><a class="selflink" href="#Basic_interpolation">Basic
  interpolation</a></h2>
<pre>
r.resamp.bspline input=raster_surface output=interpolated_surface method=bicubic
</pre>
A bicubic spline interpolation will be done and a raster map with estimated
  (i.e., interpolated) values will be created.
<h2 class="Ss" title="Ss" id="Interpolation_of_NULL_cells_and_patching"><a class="selflink" href="#Interpolation_of_NULL_cells_and_patching">Interpolation
  of NULL cells and patching</a></h2>
General procedure:
<div>&#x00A0;</div>
<pre>
# set region to area with NULL cells, align region to input map
g.region n=north s=south e=east w=west align=input -p
# interpolate NULL cells
r.resamp.bspline -n input=input_raster output=interpolated_nulls method=bicubic
# set region to area with NULL cells, align region to input map
g.region raster=input -p
# patch original map and interpolated NULLs
r.patch input=input_raster,interpolated_nulls output=input_raster_gapfilled
</pre>
<h2 class="Ss" title="Ss" id="Interpolation_of_NULL_cells_and_patching_(NC_data)"><a class="selflink" href="#Interpolation_of_NULL_cells_and_patching_(NC_data)">Interpolation
  of NULL cells and patching (NC data)</a></h2>
In this example, the SRTM elevation map in the North Carolina sample dataset
  location is filtered for outlier elevation values; missing pixels are then
  re-interpolated to obtain a complete elevation map:
<div>&#x00A0;</div>
<pre>
g.region raster=elev_srtm_30m -p
d.mon wx0
d.histogram elev_srtm_30m
r.univar -e elev_srtm_30m
# remove too low elevations (esp. lakes)
# Threshold: thresh = Q1 - 1.5 * (Q3 - Q1)
r.mapcalc &quot;elev_srtm_30m_filt = if(elev_srtm_30m &lt; 50.0, null(), elev_srtm_30m)&quot;
# verify
d.histogram elev_srtm_30m_filt
d.erase
d.rast elev_srtm_30m_filt
r.resamp.bspline -n input=elev_srtm_30m_filt output=elev_srtm_30m_complete \
  method=bicubic
d.histogram elev_srtm_30m_complete
d.rast elev_srtm_30m_complete
</pre>
<h2 class="Ss" title="Ss" id="Estimation_of_lambda_parameter_with_a_cross_validation_process"><a class="selflink" href="#Estimation_of_lambda_parameter_with_a_cross_validation_process">Estimation
  of <b>lambda</b> parameter with a cross validation process</a></h2>
A random sample of points should be generated first with <i>r.random</i>, and
  the current region should not include more than 100 non-NULL random cells.
<div>&#x00A0;</div>
<pre>
r.resamp.bspline -c input=input_raster
</pre>
<h1 class="Sh" title="Sh" id="REFERENCES"><a class="selflink" href="#REFERENCES">REFERENCES</a></h1>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Brovelli M. A., Cannata M., and Longoni U.M., 2004, LIDAR
      Data Filtering and DTM Interpolation Within GRASS, Transactions in GIS,
      April 2004, vol. 8, iss. 2, pp. 155-174(20), Blackwell Publishing Ltd</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Brovelli M. A. and Cannata M., 2004, Digital Terrain model
      reconstruction in urban areas from airborne laser scanning data: the
      method and an example for Pavia (Northern Italy). Computers and
      Geosciences 30, pp.325-331</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Brovelli M. A e Longoni U.M., 2003, Software per il
      filtraggio di dati LIDAR, Rivista dell&#x2019;Agenzia del Territorio, n.
      3-2003, pp. 11-22 (ISSN 1593-2192)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Antolin R. and Brovelli M.A., 2007, LiDAR data Filtering
      with GRASS GIS for the Determination of Digital Terrain Models.
      Proceedings of Jornadas de SIG Libre, Girona, Espa&#x00F1;a. CD ISBN:
      978-84-690-3886-9</dd>
</dl>
</div>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<i></i> <i>r.fillnulls,</i> <i>r.resamp.rst,</i> <i>r.resamp.interp,</i>
  <i>v.surf.bspline</i> <i></i>
<div class="Pp"></div>
Overview: Interpolation and Resampling in GRASS GIS
<h1 class="Sh" title="Sh" id="AUTHORS"><a class="selflink" href="#AUTHORS">AUTHORS</a></h1>
Markus Metz
<div>&#x00A0;</div>
<div>&#x00A0;</div>
based on <i>v.surf.bspline</i> by
<div>&#x00A0;</div>
Maria Antonia Brovelli, Massimiliano Cannata, Ulisse Longoni, Mirko Reguzzoni,
  Roberto Antolin
<div class="Pp"></div>
<i>Last changed: $Date: 2016-08-03 13:53:17 +0200 (Wed, 03 Aug 2016) $</i>
<h1 class="Sh" title="Sh" id="SOURCE_CODE"><a class="selflink" href="#SOURCE_CODE">SOURCE
  CODE</a></h1>
Available at: r.resamp.bspline source code (history)
<div class="Pp"></div>
Main index | Raster index | Topics index | Keywords index | Graphical index |
  Full index
<div class="Pp"></div>
&#x00A9; 2003-2016 GRASS Development Team, GRASS GIS 7.2.0 Reference
  Manual</div>
<table class="foot">
  <tr>
    <td class="foot-date"></td>
    <td class="foot-os">GRASS 7.2.0</td>
  </tr>
</table>
</body>
</html>
