<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>r3.gwflow(1grass)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">r3.gwflow(1grass)</td>
    <td class="head-vol">Grass User's Manual</td>
    <td class="head-rtitle">r3.gwflow(1grass)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
<i></i><b>r3.gwflow</b> - Numerical calculation program for transient, confined
  groundwater flow in three dimensions.
<h1 class="Sh" title="Sh" id="KEYWORDS"><a class="selflink" href="#KEYWORDS">KEYWORDS</a></h1>
raster3d, groundwater flow, voxel, hydrology
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>r3.gwflow</b>
<div>&#x00A0;</div>
<b>r3.gwflow --help</b>
<div>&#x00A0;</div>
<b>r3.gwflow</b> [-<b>mf</b>] <b>phead</b>=<i>name</i> <b>status</b>=<i>name</i>
  <b>hc_x</b>=<i>name</i> <b>hc_y</b>=<i>name</i> <b>hc_z</b>=<i>name</i>
  [<b>sink</b>= <i>name</i>] <b>yield</b>=<i>name</i>
  [<b>recharge</b>=<i>name</i>] <b>output</b>=<i>name</i>
  [<b>velocity_x</b>=<i>name</i>] [ <b>velocity_y</b>=<i>name</i>]
  [<b>velocity_z</b>= <i>name</i>] [<b>budget</b>=<i>name</i>]
  <b>dtime</b>=<i>float</i> [ <b>maxit</b>=<i>integer</i>]
  [<b>error</b>=<i>float</i>] [ <b>solver</b>=<i>name</i>] [--<b>overwrite</b>]
  [-- <b>help</b>] [--<b>verbose</b>] [--<b>quiet</b>] [--<b>ui</b>]
<h2 class="Ss" title="Ss" id="Flags:"><a class="selflink" href="#Flags:">Flags:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-m</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Use 3D raster mask (if exists)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-f</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Use a full filled quadratic linear equation system, default is a sparse
      linear equation system.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--overwrite</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Allow output files to overwrite existing files</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--help</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Print usage summary</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--verbose</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Verbose module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--quiet</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Quiet module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ui</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Force launching GUI dialog</dd>
</dl>
<h2 class="Ss" title="Ss" id="Parameters:"><a class="selflink" href="#Parameters:">Parameters:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>phead</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Input 3D raster map with initial piezometric heads in [m]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>status</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Input 3D raster map providing the status for each cell, = 0 - inactive, 1 -
      active, 2 - dirichlet</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>hc_x</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Input 3D raster map with the x-part of the hydraulic conductivity tensor in
      [m/s]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>hc_y</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Input 3D raster map with the y-part of the hydraulic conductivity tensor in
      [m/s]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>hc_z</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Input 3D raster map with the z-part of the hydraulic conductivity tensor in
      [m/s]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>sink</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Input 3D raster map with sources and sinks in [m^3/s]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>yield</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Specific yield [1/m] input 3D raster map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>recharge</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Recharge input 3D raster map in m^3/s</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>output</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Output 3D raster map storing the piezometric head result of the numerical
      calculation</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>velocity_x</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Output 3D raster map storing the groundwater filter velocity vector part in
      x direction [m/s]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>velocity_y</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Output 3D raster map storing the groundwater filter velocity vector part in
      y direction [m/s]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>velocity_z</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Output 3D raster map storing the groundwater filter velocity vector part in
      z direction [m/s]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>budget</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Output 3D raster map storing the groundwater budget for each cell
    [m^3/s]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>dtime</b>=<i>float</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    The calculation time in seconds
    <div>&#x00A0;</div>
    Default: <i>86400</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>maxit</b>=<i>integer</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Maximum number of iteration used to solve the linear equation system
    <div>&#x00A0;</div>
    Default: <i>10000</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>error</b>=<i>float</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Error break criteria for iterative solver
    <div>&#x00A0;</div>
    Default: <i>0.000001</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>solver</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    The type of solver which should solve the symmetric linear equation system
    <div>&#x00A0;</div>
    Options: <i>cg, pcg, cholesky</i>
    <div>&#x00A0;</div>
    Default: <i>cg</i></dd>
</dl>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
This numerical module calculates implicit transient and steady state, confined
  groundwater flow in three dimensions based on volume maps and the current 3D
  region settings. All initial- and boundary-conditions must be provided as
  volume maps. The unit in the location must be meters.
<div class="Pp"></div>
This module is sensitive to mask settings. All cells which are outside the mask
  are ignored and handled as no flow boundaries.
<div class="Pp"></div>
The module calculates the piezometric head and optionally the water balance for
  each cell and the groundwater velocity field in 3 dimensions. The vector
  components can be visualized with ParaView if they are exported with
  <i>r3.out.vtk</i>.
<div class="Pp"></div>
The groundwater flow will always be calculated transient. For steady state
  computation the user should set the timestep to a large number (billions of
  seconds) or set the specific yield raster map to zero.
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
The groundwater flow calculation is based on Darcy&#x2019;s law and a numerical
  implicit finite volume discretization. The discretization results in a
  symmetric and positive definit linear equation system in form of <i>Ax =
  b</i>, which must be solved. The groundwater flow partial differential
  equation is of the following form:
<div class="Pp"></div>
(dh/dt)*S = div (K grad h) + q
<div class="Pp"></div>
In detail for 3 dimensions:
<div class="Pp"></div>
(dh/dt)*S = Kxx * (d^2h/dx^2) + Kyy * (d^2h/dy^2) + Kzz * (d^2h/dz^2) + q
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">h -- the piezometric head im meters [m]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">dt -- the time step for transient calculation in seconds
      [s]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">S -- the specific yield [1/m]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">b -- the bottom surface of the aquifer meters [m]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Kxx -- the hydraulic conductivity tensor part in x
      direction in meter per second [m/s]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Kyy -- the hydraulic conductivity tensor part in y
      direction in meter per seconds [m/s]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Kzz -- the hydraulic conductivity tensor part in z
      direction in meter per seconds [m/s]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">q - inner source/sinc in [1/s]</dd>
</dl>
</div>
<div class="Pp"></div>
Two different boundary conditions are implemented, the Dirichlet and Neumann
  conditions. By default the calculation area is surrounded by homogeneous
  Neumann boundary conditions. The calculation and boundary status of single
  cells can be set with the status map, the following cell states are supported:
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">0 == inactive - the cell with status 0 will not be
      calculated, active cells will have a no flow boundary to an inactive
    cell</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">1 == active - this cell is used for groundwater
      calculation, inner sources can be defined for those cells</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">2 == Dirichlet - cells of this type will have a fixed
      piezometric head value which do not change over time</dd>
</dl>
</div>
<div class="Pp"></div>
Note that all required raster maps are read into main memory. Additionally the
  linear equation system will be allocated, so the memory consumption of this
  module rapidely grow with the size of the input maps.
<div class="Pp"></div>
The resulting linear equation system <i>Ax = b</i> can be solved with several
  solvers. An iterative solvers with sparse and quadratic matrices support is
  implemented. The conjugate gradients method with (pcg) and without (cg)
  precondition. Additionally a direct Cholesky solver is available. This direct
  solver only work with normal quadratic matrices, so be careful using them with
  large maps (maps of size 10.000 cells will need more than one Gigabyte of
  RAM). The user should always prefer to use a sparse matrix solver.
<h1 class="Sh" title="Sh" id="EXAMPLE_1"><a class="selflink" href="#EXAMPLE_1">EXAMPLE
  1</a></h1>
This small script creates a working groundwater flow area and data. It cannot be
  run in a lat/lon location.
<div>&#x00A0;</div>
<pre>
# set the region accordingly
g.region res=25 res3=25 t=100 b=0 n=1000 s=0 w=0 e=1000 -p3
#now create the input raster maps for a confined aquifer
r3.mapcalc expression=&quot;phead = if(row() == 1 &amp;&amp; depth() == 4, 50, 40)&quot;
r3.mapcalc expression=&quot;status = if(row() == 1 &amp;&amp; depth() == 4, 2, 1)&quot;
r3.mapcalc expression=&quot;well = if(row() == 20 &amp;&amp; col() == 20 &amp;&amp; depth() == 2, -0.25, 0)&quot;
r3.mapcalc expression=&quot;hydcond = 0.00025&quot;
r3.mapcalc expression=&quot;syield = 0.0001&quot;
r.mapcalc  expression=&quot;recharge = 0.0&quot;
r3.gwflow solver=cg phead=phead statuyield=status hc_x=hydcond hc_y=hydcond  \
   hc_z=hydcond sink=well yield=syield r=recharge output=gwresult dt=8640000 vx=vx vy=vy vz=vz budget=budget
# The data can be visualized with ParaView when exported with r3.out.vtk
r3.out.vtk -p in=gwresult,status,budget vector=vx,vy,vz out=/tmp/gwdata3d.vtk
#now load the data into ParaView
paraview --data=/tmp/gwdata3d.vtk
</pre>
<h1 class="Sh" title="Sh" id="EXAMPLE_2"><a class="selflink" href="#EXAMPLE_2">EXAMPLE
  2</a></h1>
This will create a nice 3D model with geological layer with different hydraulic
  conductivities. Make sure you are not in a lat/lon projection.
<div>&#x00A0;</div>
<pre>
# set the region accordingly
g.region res=15 res3=15 t=500 b=0 n=1000 s=0 w=0 e=1000
#now create the input raster maps for a confined aquifer
r3.mapcalc expression=&quot;phead = if(col() == 1 &amp;&amp; depth() == 33, 50, 40)&quot;
r3.mapcalc expression=&quot;status = if(col() == 1 &amp;&amp; depth() == 33, 2, 1)&quot;
r3.mapcalc expression=&quot;well = if(row() == 20 &amp;&amp; col() == 20 &amp;&amp; depth() == 3, -0.25, 0)&quot;
r3.mapcalc expression=&quot;well = if(row() == 50 &amp;&amp; col() == 50 &amp;&amp; depth() == 3, -0.25, well)&quot;
r3.mapcalc expression=&quot;hydcond = 0.0025&quot;
r3.mapcalc expression=&quot;hydcond = if(depth() &lt; 30 &amp;&amp; depth() &gt; 23 &amp;&amp; col() &lt; 60, 0.000025, hydcond)&quot;
r3.mapcalc expression=&quot;hydcond = if(depth() &lt; 20 &amp;&amp; depth() &gt; 13 &amp;&amp; col() &gt;  7, 0.000025, hydcond)&quot;
r3.mapcalc expression=&quot;hydcond = if(depth() &lt; 10 &amp;&amp; depth() &gt;  7 &amp;&amp; col() &lt; 60, 0.000025, hydcond)&quot;
r3.mapcalc expression=&quot;syield = 0.0001&quot;
r3.gwflow solver=cg phead=phead statuyield=status hc_x=hydcond hc_y=hydcond  \
   hc_z=hydcond sink=well yield=syield output=gwresult dt=8640000 vx=vx vy=vy vz=vz budget=budget
# The data can be visualized with paraview when exported with r3.out.vtk
r3.out.vtk -p in=gwresult,status,budget,hydcond,well vector=vx,vy,vz out=/tmp/gwdata3d.vtk
#now load the data into paraview
paraview --data=/tmp/gwdata3d.vtk
</pre>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<i></i> <i>r.gwflow,</i> <i>r.solute.transport,</i> <i>r3.out.vtk</i> <i></i>
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
S&#x00F6;ren Gebbert
<div class="Pp"></div>
This work is based on the Diploma Thesis of S&#x00F6;ren Gebbert available here
  at Technical University Berlin, Germany.
<div class="Pp"></div>
<i>Last changed: $Date: 2016-04-09 18:43:25 +0200 (Sat, 09 Apr 2016) $</i>
<h1 class="Sh" title="Sh" id="SOURCE_CODE"><a class="selflink" href="#SOURCE_CODE">SOURCE
  CODE</a></h1>
Available at: r3.gwflow source code (history)
<div class="Pp"></div>
Main index | 3D raster index | Topics index | Keywords index | Graphical index |
  Full index
<div class="Pp"></div>
&#x00A9; 2003-2016 GRASS Development Team, GRASS GIS 7.2.0 Reference
  Manual</div>
<table class="foot">
  <tr>
    <td class="foot-date"></td>
    <td class="foot-os">GRASS 7.2.0</td>
  </tr>
</table>
</body>
</html>
