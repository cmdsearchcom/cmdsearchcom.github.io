<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>dpkg-shlibdeps(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">dpkg-shlibdeps(1)</td>
    <td class="head-vol">dpkg utilities</td>
    <td class="head-rtitle">dpkg-shlibdeps(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
dpkg-shlibdeps - generate shared library substvar dependencies
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>dpkg-shlibdeps</b> [<i>option</i>...] [<i><b>-e</b></i>]<i>executable</i>
  [<i>option</i>...]
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<b>dpkg-shlibdeps</b> calculates shared library dependencies for executables
  named in its arguments. The dependencies are added to the substitution
  variables file <b>debian/substvars</b> as variable names
  <b>shlibs:</b><i>dependency-field</i> where <i>dependency-field</i> is a
  dependency field name. Any other variables starting with <b>shlibs:</b> are
  removed from the file.
<div class="Pp"></div>
<b>dpkg-shlibdeps</b> has two possible sources of information to generate
  dependency information. Either <i>symbols</i> files or <i>shlibs</i> files.
  For each binary that <b>dpkg-shlibdeps</b> analyzes, it finds out the list of
  libraries that it's linked with. Then, for each library, it looks up either
  the <i>symbols</i> file, or the <i>shlibs</i> file (if the former doesn't
  exist or if debian/shlibs.local contains the relevant dependency). Both files
  are supposed to be provided by the library package and should thus be
  available as /var/lib/dpkg/info/ <i>package</i>.<i>symbols</i> or
  /var/lib/dpkg/info/ <i>package</i>.<i>shlibs</i>. The package name is
  identified in two steps: find the library file on the system (looking in the
  same directories that <b>ld.so</b> would use), then use <b>dpkg -S
  </b><i>library-file</i> to lookup the package providing the library.
<h2 class="Ss" title="Ss" id="Symbols_files"><a class="selflink" href="#Symbols_files">Symbols
  files</a></h2>
Symbols files contain finer-grained dependency information by providing the
  minimum dependency for each symbol that the library exports. The script tries
  to find a symbols file associated to a library package in the following places
  (first match is used):
<dl class="Bl-tag">
  <dt class="It-tag">debian/*/DEBIAN/symbols</dt>
  <dd class="It-tag">Shared library information generated by the current build
      process that also invoked <b>dpkg-shlibdeps</b>. They are generated by
      <b>dpkg-gensymbols</b>(1). They are only used if the library is found in a
      package's build tree. The symbols file in that build tree takes precedence
      over symbols files from other binary packages.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">/etc/dpkg/symbols/<i>package</i>.symbols.<i>arch</i></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">/etc/dpkg/symbols/<i>package</i>.symbols</dt>
  <dd class="It-tag">Per-system overriding shared library dependency
      information. <i>arch</i> is the architecture of the current system
      (obtained by <b>dpkg-architecture -qDEB_HOST_ARCH</b>).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Output from &#x201C;<b>dpkg-query --control-path</b>
    <i>package</i> symbols&#x201D;</dt>
  <dd class="It-tag">Package-provided shared library dependency information.
      Unless overridden by <b>--admindir</b>, those files are located in
      /var/lib/dpkg.</dd>
</dl>
<div class="Pp"></div>
While scanning the symbols used by all binaries, <b>dpkg-shlibdeps</b> remembers
  the (biggest) minimal version needed for each library. At the end of the
  process, it is able to write out the minimal dependency for every library used
  (provided that the information of the <i>symbols</i> files are accurate).
<div class="Pp"></div>
As a safe-guard measure, a symbols file can provide a
  <b>Build-Depends-Package</b> meta-information field and <b>dpkg-shlibdeps</b>
  will extract the minimal version required by the corresponding package in the
  <b>Build-Depends</b> field and use this version if it's higher than the
  minimal version computed by scanning symbols.
<h2 class="Ss" title="Ss" id="Shlibs_files"><a class="selflink" href="#Shlibs_files">Shlibs
  files</a></h2>
Shlibs files associate directly a library to a dependency (without looking at
  the symbols). It's thus often stronger than really needed but very safe and
  easy to handle.
<div class="Pp"></div>
The dependencies for a library are looked up in several places. The first file
  providing information for the library of interest is used:
<dl class="Bl-tag">
  <dt class="It-tag">debian/shlibs.local</dt>
  <dd class="It-tag">Package-local overriding shared library dependency
      information.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">/etc/dpkg/shlibs.override</dt>
  <dd class="It-tag">Per-system overriding shared library dependency
      information.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">debian/*/DEBIAN/shlibs</dt>
  <dd class="It-tag">Shared library information generated by the current build
      process that also invoked <b>dpkg-shlibdeps</b>. They are only used if the
      library is found in a package's build tree. The shlibs file in that build
      tree takes precedence over shlibs files from other binary packages.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Output from &#x201C;<b>dpkg-query --control-path</b>
    <i>package</i> shlibs&#x201D;</dt>
  <dd class="It-tag">Package-provided shared library dependency information.
      Unless overridden by <b>--admindir</b>, those files are located in
      /var/lib/dpkg.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">/etc/dpkg/shlibs.default</dt>
  <dd class="It-tag">Per-system default shared library dependency
    information.</dd>
</dl>
<div class="Pp"></div>
The extracted dependencies are then directly used (except if they are filtered
  out because they have been identified as duplicate, or as weaker than another
  dependency).
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
<b>dpkg-shlibdeps</b> interprets non-option arguments as executable names, just
  as if they'd been supplied as <b>-e</b><i>executable.</i>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-e</b><i>executable</i></dt>
  <dd class="It-tag">Include dependencies appropriate for the shared libraries
      required by <i>executable</i>. This option can be used multiple
    times.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-l</b><i>directory</i></dt>
  <dd class="It-tag">Prepend <i>directory</i> to the list of directories to
      search for private shared libraries (since dpkg 1.17.0). This option can
      be used multiple times.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: Use this option instead of setting <b>LD_LIBRARY_PATH</b>, as that
      environment variable is used to control the run-time linker and abusing it
      to set the shared library paths at build-time can be problematic when
      cross-compiling for example.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-d</b><i>dependency-field</i></dt>
  <dd class="It-tag">Add dependencies to be added to the control file dependency
      field <i>dependency-field</i>. (The dependencies for this field are placed
      in the variable <b>shlibs:</b><i>dependency-field.)</i>
    <div style="height: 1.00em;">&#x00A0;</div>
    The <b>-d</b><i>dependency-field</i> option takes effect for all executables
      after the option, until the next <b>-d</b><i>dependency-field.</i> The
      default <i>dependency-field</i> is <b>Depends</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
    If the same dependency entry (or set of alternatives) appears in more than
      one of the recognized dependency field names <b>Pre-Depends</b>,
      <b>Depends</b>, <b>Recommends</b>, <b>Enhances</b> or <b>Suggests</b> then
      <b>dpkg-shlibdeps</b> will automatically remove the dependency from all
      fields except the one representing the most important dependencies.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-p</b><i>varname-prefix</i></dt>
  <dd class="It-tag">Start substitution variables with
      <i>varname-prefix</i><b>:</b> instead of <b>shlibs:</b>. Likewise, any
      existing substitution variables starting with
      <i>varname-prefix</i><b>:</b> (rather than <b>shlibs:</b>) are removed
      from the substitution variables file.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-O</b>[<i>filename</i>]</dt>
  <dd class="It-tag">Print substitution variable settings to standard output (or
      <i>filename</i> if specified, since dpkg 1.17.2), rather than being added
      to the substitution variables file (<b>debian/substvars</b> by
    default).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-t</b><i>type</i></dt>
  <dd class="It-tag">Prefer shared library dependency information tagged for the
      given package type. If no tagged information is available, falls back to
      untagged information. The default package type is <b>deb</b>. Shared
      library dependency information is tagged for a given type by prefixing it
      with the name of the type, a colon, and whitespace.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-L</b><i>local-shlibs-file</i></dt>
  <dd class="It-tag">Read overriding shared library dependency information from
      <i>local-shlibs-file</i> instead of <b>debian/shlibs.local</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-T</b><i>substvars-file</i></dt>
  <dd class="It-tag">Write substitution variables in <i>substvars-file</i>; the
      default is <b>debian/substvars</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-v</b></dt>
  <dd class="It-tag">Enable verbose mode (since dpkg 1.14.8). Numerous messages
      are displayed to explain what <b>dpkg-shlibdeps</b> does.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-x</b><i>package</i></dt>
  <dd class="It-tag">Exclude the package from the generated dependencies (since
      dpkg 1.14.8). This is useful to avoid self-dependencies for packages which
      provide ELF binaries (executables or library plugins) using a library
      contained in the same package. This option can be used multiple times to
      exclude several packages.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-S</b><i>package-build-dir</i></dt>
  <dd class="It-tag">Look into <i>package-build-dir</i> first when trying to
      find a library (since dpkg 1.14.15). This is useful when the source
      package builds multiple flavors of the same library and you want to ensure
      that you get the dependency from a given binary package. You can use this
      option multiple times: directories will be tried in the same order before
      directories of other binary packages.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-I</b><i>package-build-dir</i></dt>
  <dd class="It-tag">Ignore <i>package-build-dir</i> when looking for shlibs,
      symbols, and shared library files (since dpkg 1.18.5). You can use this
      option multiple times.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ignore-missing-info</b></dt>
  <dd class="It-tag">Do not fail if dependency information can't be found for a
      shared library (since dpkg 1.14.8). Usage of this option is discouraged,
      all libraries should provide dependency information (either with shlibs
      files, or with symbols files) even if they are not yet used by other
      packages.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--warnings=</b><i>value</i></dt>
  <dd class="It-tag"><i>value</i> is a bit field defining the set of warnings
      that can be emitted by <b>dpkg-shlibdeps</b> (since dpkg 1.14.17). Bit 0
      (value=1) enables the warning &#x201C;symbol <i>sym</i> used by
      <i>binary</i> found in none of the libraries&#x201D;, bit 1 (value=2)
      enables the warning &#x201C;package could avoid a useless
      dependency&#x201D; and bit 2 (value=4) enables the warning &#x201C;
      <i>binary</i> should not be linked against <i>library</i>&#x201D;. The
      default <i>value</i> is 3: the first two warnings are active by default,
      the last one is not. Set <i>value</i> to 7 if you want all warnings to be
      active.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--admindir=</b><i>dir</i></dt>
  <dd class="It-tag">Change the location of the <b>dpkg</b> database (since dpkg
      1.14.0). The default location is <i>/var/lib/dpkg</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-?</b>, <b>--help</b></dt>
  <dd class="It-tag">Show the usage message and exit.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--version</b></dt>
  <dd class="It-tag">Show the version and exit.</dd>
</dl>
<h1 class="Sh" title="Sh" id="DIAGNOSTICS"><a class="selflink" href="#DIAGNOSTICS">DIAGNOSTICS</a></h1>
<h2 class="Ss" title="Ss" id="Warnings"><a class="selflink" href="#Warnings">Warnings</a></h2>
Since <b>dpkg-shlibdeps</b> analyzes the set of symbols used by each binary of
  the generated package, it is able to emit warnings in several cases. They
  inform you of things that can be improved in the package. In most cases, those
  improvements concern the upstream sources directly. By order of decreasing
  importance, here are the various warnings that you can encounter:
<dl class="Bl-tag">
  <dt class="It-tag"><b>symbol</b><i> sym</i><b> used by </b><i>binary</i><b>
    found in none of the libraries.</b></dt>
  <dd class="It-tag">The indicated symbol has not been found in the libraries
      linked with the binary. The <i>binary</i> is most likely a library and it
      needs to be linked with an additional library during the build process
      (option <b>-l</b><i>library</i> of the linker).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>binary</i><b> contains an unresolvable reference to
    symbol </b><i>sym</i><b>: it's probably a plugin</b></dt>
  <dd class="It-tag">The indicated symbol has not been found in the libraries
      linked with the binary. The <i>binary</i> is most likely a plugin and the
      symbol is probably provided by the program that loads this plugin. In
      theory a plugin doesn't have any SONAME but this binary does have one and
      as such it could not be clearly identified as such. However the fact that
      the binary is stored in a non-public directory is a strong indication
      that's it's not a normal shared library. If the binary is really a plugin,
      then disregard this warning. But there's always the possibility that it's
      a real library and that programs linking to it are using an RPATH so that
      the dynamic loader finds it. In that case, the library is broken and needs
      to be fixed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>package could avoid a useless dependency if
    </b><i>binary</i><b> was not linked against </b><i>library</i><b> (it uses
    none of the library's symbols)</b></dt>
  <dd class="It-tag">None of the <i>binaries</i> that are linked with
      <i>library</i> use any of the symbols provided by the library. By fixing
      all the binaries, you would avoid the dependency associated to this
      library (unless the same dependency is also generated by another library
      that is really used).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>package could avoid a useless dependency if
    </b><i>binaries</i><b> were not linked against </b><i>library</i><b> (they
    use none of the library's symbols)</b></dt>
  <dd class="It-tag">Exactly the same as the above warning, but for multiple
      binaries.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>binary</i><b> should not be linked against
    </b><i>library</i><b> (it uses none of the library's symbols)</b></dt>
  <dd class="It-tag">The <i>binary</i> is linked to a library that it doesn't
      need. It's not a problem but some small performance improvements in binary
      load time can be obtained by not linking this library to this binary. This
      warning checks the same information as the previous one but does it for
      each binary instead of doing the check globally on all binaries
    analyzed.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Errors"><a class="selflink" href="#Errors">Errors</a></h2>
<b>dpkg-shlibdeps</b> will fail if it can't find a public library used by a
  binary or if this library has no associated dependency information (either
  shlibs file or symbols file). A public library has a SONAME and is versioned
  (libsomething.so. <i>X</i>). A private library (like a plugin) should not have
  a SONAME and doesn't need to be versioned.
<dl class="Bl-tag">
  <dt class="It-tag"><b>couldn't find library </b><i>library-soname</i><b>
    needed by </b><i>binary</i><b> (its RPATH is '</b><i>rpath</i><b>')</b></dt>
  <dd class="It-tag">The <i>binary</i> uses a library called
      <i>library-soname</i> but <b>dpkg-shlibdeps</b> has been unable to find
      the library. <b>dpkg-shlibdeps</b> creates a list of directories to check
      as following: directories listed in the RPATH of the binary, directories
      added by the <b>-l</b> option, directories listed in the
      <b>LD_LIBRARY_PATH</b> environment variable, cross multiarch directories
      (ex. /lib/arm64-linux-gnu, /usr/lib/arm64-linux-gnu), standard public
      directories (/lib, /usr/lib), directories listed in /etc/ld.so.conf, and
      obsolete multilib directories (/lib32, /usr/lib32, /lib64, /usr/lib64).
      Then it checks those directories in the package's build tree of the binary
      being analyzed, in the packages' build trees indicated with the <b>-S</b>
      command-line option, in other packages' build trees that contains a
      DEBIAN/shlibs or DEBIAN/symbols file and finally in the root directory. If
      the library is not found in any of those directories, then you get this
      error.
    <div style="height: 1.00em;">&#x00A0;</div>
    If the library not found is in a private directory of the same package, then
      you want to add the directory with <b>-l</b>. If it's in another binary
      package being built, you want to make sure that the shlibs/symbols file of
      this package is already created and that <b>-l</b> contains the
      appropriate directory if it also is in a private directory.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>no dependency information found for
    </b><i>library-file</i><b> (used by </b><i>binary</i><b>).</b></dt>
  <dd class="It-tag">The library needed by <i>binary</i> has been found by
      <b>dpkg-shlibdeps</b> in <i>library-file</i> but <b>dpkg-shlibdeps</b> has
      been unable to find any dependency information for that library. To find
      out the dependency, it has tried to map the library to a Debian package
      with the help of <b>dpkg -S </b><i>library-file.</i> Then it checked the
      corresponding shlibs and symbols files in /var/lib/dpkg/info/, and in the
      various package's build trees (debian/*/DEBIAN/).
    <div style="height: 1.00em;">&#x00A0;</div>
    This failure can be caused by a bad or missing shlibs or symbols file in the
      package of the library. It might also happen if the library is built
      within the same source package and if the shlibs files has not yet been
      created (in which case you must fix debian/rules to create the shlibs
      before calling <b>dpkg-shlibdeps</b>). Bad RPATH can also lead to the
      library being found under a non-canonical name (example:
      /usr/lib/openoffice.org/../lib/libssl.so.0.9.8 instead of
      /usr/lib/libssl.so.0.9.8) that's not associated to any package,
      <b>dpkg-shlibdeps</b> tries to work around this by trying to fallback on a
      canonical name (using <b>realpath</b>(3)) but it might not always work.
      It's always best to clean up the RPATH of the binary to avoid problems.
    <div style="height: 1.00em;">&#x00A0;</div>
    Calling <b>dpkg-shlibdeps</b> in verbose mode ( <b>-v</b>) will provide much
      more information about where it tried to find the dependency information.
      This might be useful if you don't understand why it's giving you this
      error.</dd>
</dl>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>deb-shlibs</b>(5), <b>deb-symbols</b>(5), <b>dpkg-gensymbols</b>(1).</div>
<table class="foot">
  <tr>
    <td class="foot-date">2013-09-06</td>
    <td class="foot-os">Debian Project</td>
  </tr>
</table>
</body>
</html>
