<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>LARCH(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">LARCH(1)</td>
    <td class="head-vol">General Commands Manual</td>
    <td class="head-rtitle">LARCH(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
larch - copy messages from one IMAP server to another
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>larch</b> [ <i>options</i>]
<div class="Pp"></div>
<b>larch</b> [ <b>--from</b> <i>URI</i>] [ <b>--to</b> <i>URI</i>]
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<b>Larch</b> is a tool to copy messages from one IMAP server to another quickly
  and safely. It's smart enough not to copy messages that already exist on the
  destination and robust enough to deal with interruptions caused by flaky
  connections or misbehaving servers.
<div class="Pp"></div>
<b>Larch</b> is particularly well-suited for copying email to, from, or between
  Gmail accounts.
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
<h2 class="Ss" title="Ss" id="Server_options"><a class="selflink" href="#Server_options">Server
  options</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--from</b>, <b>-f</b> <b><i>URI</i></b></dt>
  <dd class="It-tag">URI of the source IMAP server.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--from-folder</b>, <b>-F</b> <b><i>FOLDER</i></b></dt>
  <dd class="It-tag">Source folder to copy from. Default is INBOX.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--from-pass</b>, <b>-p</b> <b><i>PASSWD</i></b></dt>
  <dd class="It-tag">Source server password. Default is to prompt the user.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--from-user</b>, <b>-u</b> <b><i>USER</i></b></dt>
  <dd class="It-tag">Source server username. Default is to prompt the user.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--to</b>, <b>-t</b> <b><i>URI</i></b></dt>
  <dd class="It-tag">URI of the destination IMAP server.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--to-folder</b>, <b>-T</b> <b><i>FOLDER</i></b></dt>
  <dd class="It-tag">Destination folder to copy to. Default is INBOX.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--to-pass</b>, <b>-P</b> <b><i>PASSWD</i></b></dt>
  <dd class="It-tag">Destination server password. Default is to prompt the
    user.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--to-user</b>, <b>-U</b> <b><i>USER</i></b></dt>
  <dd class="It-tag">Destination server username. Default is to prompt the
    user.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Copy_options"><a class="selflink" href="#Copy_options">Copy
  options</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--all</b>, <b>-a</b></dt>
  <dd class="It-tag">Copy all folders recursively.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--all-subscribed</b>, <b>-s</b></dt>
  <dd class="It-tag">Copy all subscribed folders recursively.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--delete</b>, <b>-d</b></dt>
  <dd class="It-tag">Delete messages from the source after copying them, or if
      they already exist at the destination.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--exclude</b> <b><i>PATTERN</i></b> [
    <b><i>PATTERN</i></b>... ]</dt>
  <dd class="It-tag">List of mailbox names/patterns that shouldn't be
    copied.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--exclude-file</b> <b><i>FILE</i></b></dt>
  <dd class="It-tag">Filename containing mailbox names/patterns that shouldn't
      be copied.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--expunge</b>, <b>-x</b></dt>
  <dd class="It-tag">Expunge deleted messages from the source.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sync-flags</b>, <b>-S</b></dt>
  <dd class="It-tag">Sync message flags from the source to the destination for
      messages that already exist at the destination.</dd>
</dl>
<h2 class="Ss" title="Ss" id="General_options"><a class="selflink" href="#General_options">General
  options</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--config</b>, <b>-c</b> <b><i>FILE</i></b></dt>
  <dd class="It-tag">Specify a non-default config file to use. Default is
      ~/.larch/config.yaml.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--database</b> <b><i>FILE</i></b></dt>
  <dd class="It-tag">Specify a non-default message database to use. Default is
      ~/.larch/larch.db.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--dry-run</b>, <b>-n</b></dt>
  <dd class="It-tag">Don't actually make any changes.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--max-retries</b> <b><i>NUM</i></b></dt>
  <dd class="It-tag">Maximum number of times to retry after a recoverable error.
      Default is 3.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--no-create-folder</b></dt>
  <dd class="It-tag">Don't create destination folders that don't already
    exist.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ssl-certs</b> <b><i>FILE</i></b></dt>
  <dd class="It-tag">Path to a trusted certificate bundle to use to verify
      server SSL certificates.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ssl-verify</b></dt>
  <dd class="It-tag">Verify server SSL certificates.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--verbosity</b>, <b>-V</b> <b><i>STR</i></b></dt>
  <dd class="It-tag">Output verbosity: debug, info, warn, error, or fatal.
      Default is info.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--version</b>, <b>-v</b></dt>
  <dd class="It-tag">Print version and exit.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--help</b>, <b>-h</b></dt>
  <dd class="It-tag">Show a help message.</dd>
</dl>
<h1 class="Sh" title="Sh" id="CONFIGURATION"><a class="selflink" href="#CONFIGURATION">CONFIGURATION</a></h1>
While it's possible to control <b>Larch</b> entirely from the command line, this
  can be inconvenient if you need to specify a lot of options or if you run
  <b>Larch</b> frequently and can't always remember which options to use. Using
  a configuration file can simplify things.
<div class="Pp"></div>
By default, <b>Larch</b> looks for a config file at <b>~/.larch/config.yaml</b>
  and uses it if found. You may specify a custom config file using the
  <b>--config</b> command line option.
<div class="Pp"></div>
The <b>Larch</b> configuration file is a simple YAML &#x27E8;URL:
  http://yaml.org/ &#x27E9; file that may contain multiple sections, each with a
  different set of options, as well as a special <i>default</i> section. The
  options in the <i>default</i> section will be used unless they're overridden
  either in another config section or on the command line.
<div class="Pp"></div>
Here's a sample Larch config file:
<div class="Pp"></div>
<div style="margin-left: 5.00ex;">
<pre>
# Copy all subscribed folders by default
default:
  all-subscribed: true
<div class="Pp"></div>
# Copy mail from Gmail to my server, excluding stuff I don't want.
gmail to my server:
  from: imaps://imap.gmail.com
  from-user: example
  from-pass: secret
<div class="Pp"></div>
  to: imaps://mail.example.com
  to-user: example
  to-pass: secret
<div class="Pp"></div>
  exclude:
    - &quot;[Gmail]/Sent Mail&quot;
    - &quot;[Gmail]/Spam&quot;
    - &quot;[Gmail]/Trash&quot;
<div class="Pp"></div>
# Copy mail from my INBOX to Gmail's INBOX
my inbox to gmail inbox:
  all-subscribed: false
<div class="Pp"></div>
  from: imaps://mail.example.com
  from-folder: INBOX
  from-user: example
  from-pass: secret
<div class="Pp"></div>
  to: imaps://imap.gmail.com
  to-folder: INBOX
  to-user: example
  to-pass: secret
</pre>
</div>
<br/>
<div class="Pp"></div>
This file contains three sections. The options from <i>default</i> will be used
  in all other sections as well unless they're overridden.
<div class="Pp"></div>
To specify which config section you want Larch to use, just pass its name on the
  command line (use quotes if the name contains spaces):
<div class="Pp"></div>
<div style="margin-left: 5.00ex;">
<pre>
larch 'gmail to my server'
</pre>
</div>
<br/>
<div class="Pp"></div>
If you specify additional command line options, they'll override options in the
  config file:
<div class="Pp"></div>
<div style="margin-left: 5.00ex;">
<pre>
larch 'gmail to my server' --from-user anotheruser
</pre>
</div>
<br/>
<div class="Pp"></div>
Running Larch with no command line arguments will cause the <i>default</i>
  section to be used. With the example above, this will result in an error since
  the <i>default</i> section doesn't contain the required <i>from</i> and
  <i>to</i> options, but if you only need to use Larch with a single
  configuration, you could use the <i>default</i> section for everything and
  save yourself some typing on the command line.
<h1 class="Sh" title="Sh" id="FILES"><a class="selflink" href="#FILES">FILES</a></h1>
<i>~/.larch/config.yaml</i>
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
<h2 class="Ss" title="Ss" id="Server_compatibility"><a class="selflink" href="#Server_compatibility">Server
  compatibility</a></h2>
Larch should work well with any server that properly supports IMAP4rev1
  &#x27E8;URL: http://tools.ietf.org/html/rfc3501 &#x27E9; , and does its best
  to get along with servers that have buggy, unreliable, or incomplete IMAP
  implementations.
<div class="Pp"></div>
Larch has been tested on and is known to work well with the following IMAP
  servers:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>Dovecot</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>Gmail</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>Microsoft Exchange 2003</b></dd>
</dl>
<div class="Pp"></div>
The following servers are known to work, but with caveats:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>Yahoo! Mail</b></dd>
</dl>
<div class="Pp"></div>
The following servers do not work well with Larch:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>BlitzMail</b> Buggy server implementation; fails to
      properly quote or escape some IMAP responses, which can cause Net::IMAP to
      hang waiting for a terminating character that will never arrive.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Gmail_quirks"><a class="selflink" href="#Gmail_quirks">Gmail
  quirks</a></h2>
Gmail's IMAP implementation is quirky. Larch does its best to work around these
  quirks whenever possible, but here are a few things to watch out for:
<div class="Pp"></div>
<b>Some messages could not be FETCHed </b>error
<div class="Pp"></div>
This error indicates that a message on Gmail is corrupt, and Gmail itself is
  unable to read it. The message will continue to show up in the mailbox, but
  all attempts to access it via IMAP, POP, or the Gmail web interface will
  result in errors. Larch will try to skip these messages and continue
  processing others if possible.
<div class="Pp"></div>
It's not clear how this corruption occurs or exactly what kind of corruption
  causes these errors, although in every case I'm aware of, the corrupt message
  has originated outside of Gmail (Gmail itself does not corrupt the message).
  There is currently no known solution for this problem apart from deleting the
  corrupted messages.
<div class="Pp"></div>
<b>Folder names cannot contain leading or trailing whitespace</b>
<div class="Pp"></div>
Most IMAP servers allow folder names to contain leading and trailing whitespace,
  such as &quot; folder &quot;. Gmail does not. When copying folders to Gmail,
  Larch will automatically remove leading and trailing whitespace in folder
  names to prevent errors.
<h2 class="Ss" title="Ss" id="Yahoo!_mail_quirks"><a class="selflink" href="#Yahoo!_mail_quirks">Yahoo!
  mail quirks</a></h2>
Yahoo! doesn't officially support IMAP access for general usage, but Larch is
  able to connect to imap.mail.yahoo.com and imap-ssl.mail.yahoo.com by using a
  fairly well-known trick. That said, as with anything tricky, there are
  caveats.
<div class="Pp"></div>
<b>No hierarchical folders</b>
<div class="Pp"></div>
Similar to Gmail, Yahoo! Mail doesn't allow hierarchical (nested) folders. If
  you try to copy a folder hierarchy to Yahoo!, it will work, but you'll end up
  with a set of folders named &quot;folder&quot; and
  &quot;folder.subfolder&quot; rather than seeing &quot;subfolder&quot; as an
  actual subfolder of &quot;folder&quot;.
<div class="Pp"></div>
<b>No custom flags</b>
<div class="Pp"></div>
Yahoo! Mail IMAP doesn't support custom message flags, such as the tags and
  junk/not junk flags used by Thunderbird. When transferring messages with
  custom flags to a Yahoo! Mail IMAP account, the custom flags will be lost.
<div class="Pp"></div>
<b>Here there be dragons</b>
<div class="Pp"></div>
Larch's support for Yahoo! Mail is very new and very lightly tested. Given its
  newness and the fact that Yahoo!'s IMAP gateway isn't official, there are
  likely to be other quirks we're not yet aware of. There's also no guarantee
  that Yahoo! won't shut down its IMAP gateway, deprecate the trick Larch uses
  to connect, or just outright block Larch. Use at your own risk.
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
Larch uses Ruby's Net::IMAP standard library for all IMAP operations. While
  Net::IMAP is generally a very solid library, it contains a bug that can cause
  a deadlock to occur if a connection drops unexpectedly (either due to network
  issues or because the server closed the connection without warning) when the
  server has already begun sending a response and Net::IMAP is waiting to
  receive more data. If this happens, Net::IMAP will continue waiting forever
  without passing control back to Larch, and you will need to manually kill and
  restart Larch.
<div class="Pp"></div>
Net::IMAP in Ruby 1.8 has also been known to hang when it can't parse a server
  response, either because the response itself is malformed or because of a bug
  in Net::IMAP's parser. This is rare, but it happens. Unfortunately there's
  nothing Larch can do about this.
<h1 class="Sh" title="Sh" id="EXAMPLE"><a class="selflink" href="#EXAMPLE">EXAMPLE</a></h1>
<b>Larch</b> is run from the command line. The following examples demonstrate
  how to run <b>Larch</b> using only command line arguments, but you may also
  place these options in a config file and run <b>Larch</b> without any
  arguments if you prefer.
<div class="Pp"></div>
At a minimum, you must <i>specify a source server and a destination server</i>
  in the form of IMAP URIs:
<div class="Pp"></div>
<div style="margin-left: 5.00ex;">
<pre>
larch --from imap://mail.example.com \
      --to imap://imap.gmail.com
</pre>
</div>
<br/>
<div class="Pp"></div>
<b>Larch</b> will prompt you for the necessary usernames and passwords, then
  sync the contents of the source's INBOX folder to the destination's INBOX
  folder.
<div class="Pp"></div>
To <i>connect using SSL</i>, specify a URI beginning with <b>imaps://</b>:
<div class="Pp"></div>
<div style="margin-left: 5.00ex;">
<pre>
larch --from imaps://mail.example.com \
      --to imaps://imap.gmail.com
</pre>
</div>
<br/>
<div class="Pp"></div>
If you'd like to <i>sync a specific folder</i> other than INBOX, specify the
  source and destination folders using <b>--from-folder</b> and
  <b>--to-folder</b>. Folder names containing spaces must be enclosed in quotes:
<div class="Pp"></div>
<div style="margin-left: 5.00ex;">
<pre>
larch --from imaps://mail.example.com \
      --to imaps://imap.gmail.com \
      --from-folder 'Sent Mail' --to-folder 'Sent Mail'
</pre>
</div>
<br/>
<div class="Pp"></div>
To <i>sync all folders</i>, use the <b>--all</b> option (or
  <b>--all-subscribed</b> if you only want to <i>sync subscribed folders</i>):
<div class="Pp"></div>
<div style="margin-left: 5.00ex;">
<pre>
larch --from imaps://mail.example.com \
      --to imaps://imap.gmail.com --all
</pre>
</div>
<br/>
<div class="Pp"></div>
By default <b>Larch</b> will create folders on the destination server if they
  don't already exist. To prevent this, add the <b>--no-create-folder</b>
  option:
<div class="Pp"></div>
<div style="margin-left: 5.00ex;">
<pre>
larch --from imaps://mail.example.com \
      --to imaps://imap.gmail.com --all \
      --no-create-folder
</pre>
</div>
<br/>
<div class="Pp"></div>
You can <i>prevent Larch from syncing one or more folders</i> by using the
  <b>--exclude</b> option, which accepts multiple arguments:
<div class="Pp"></div>
<div style="margin-left: 5.00ex;">
<pre>
larch --from imaps://mail.example.com \
      --to imaps://imap.gmail.com --all \
      --exclude Spam Trash Drafts &quot;[Gmail]/*&quot;
</pre>
</div>
<br/>
<div class="Pp"></div>
If your exclusion list is long or complex, create a text file with one exclusion
  pattern per line and tell <b>Larch</b> to load it with the
  <b>--exclude-file</b> option:
<div class="Pp"></div>
<div style="margin-left: 5.00ex;">
<pre>
larch --from imaps://mail.example.com \
      --to imaps://imap.gmail.com --all \
      --exclude-file exclude.txt
</pre>
</div>
<br/>
<div class="Pp"></div>
The wildcard characters <b>*</b> and <b>?</b> are supported in exclusion lists.
  You may also use a regular expression by enclosing a pattern in forward
  slashes, so the previous example could be achieved with the pattern
  <b>/(Spam|Trash|Drafts|\[Gmail]\/.*)/</b>
<h1 class="Sh" title="Sh" id="AUTHORS"><a class="selflink" href="#AUTHORS">AUTHORS</a></h1>
Adapted from the program's documentation for Debian by Mart&#x00ED;n Ferrari
  &lt;tincho@tincho.org&gt;.</div>
<table class="foot">
  <tr>
    <td class="foot-date"></td>
    <td class="foot-os"></td>
  </tr>
</table>
</body>
</html>
