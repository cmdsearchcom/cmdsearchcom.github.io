<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:10:16 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>FLENT(1) Flent: The FLExible Network Tester FLENT(1)</p>

<p style="margin-top: 1em">NAME <br>
flent - Flent: The FLExible Network Tester</p>

<p style="margin-top: 1em">INTRODUCTION <br>
Flent is a wrapper around netperf and similar tools to run
predefined tests and aggregate and plot the results. It
defines several tests that can be run against one or more
<br>
hosts, primarily targeted at testing for the presence of
bufferbloat under various conditions.</p>

<p style="margin-top: 1em">The aggregated data is saved in
(gzipped) JSON format for later processing and/or import
into other tools. The JSON format is documented below.</p>

<p style="margin-top: 1em">Apart from the JSON format, the
data can be output as csv values, emacs org mode tables or
plots. Each test can specify several different plots,
including time-series plots of <br>
the values against each other, as well as CDF plots of
(e.g.) ping times.</p>

<p style="margin-top: 1em">Plots can be output to the
formats supported by matplotlib by specifying the output
filename with -o output.{png,ps,pdf,svg}. If no output file
is specified, the plot is dis&acirc; <br>
played using matplotlib&acirc;s interactive plot browser,
which also allows saving of the output (in .png format).</p>

<p style="margin-top: 1em">Requirements <br>
Flent runs on Python, versions 2.7+ and 3.3+. Plotting
requires a functional matplotlib installation (but
everything else can run without matplotlib). For the
interactive plot <br>
viewer, a graphical display (and suitably configured
matplotlib) is required.</p>

<p style="margin-top: 1em">Most tests employ the netperf
benchmarking tool to run the tests. Version 2.6 or higher is
required, and netperf must be compiled with the
--enable-demo option passed to ./con&acirc; <br>
figure. Some tests use iperf in addition to, or instead of
netperf. Both tools must be available in the PATH.</p>

<p style="margin-top: 1em">For ICMP ping measurements, the
version of ping employed must support output timestamping
(the -D parameter to GNU ping). This is not supported by the
BSD and OSX versions of <br>
ping. As an alternative to the regular ping command, the
fping utility (see http://fping.org) can be employed. In
that case fping must be version 3.5 or greater. Flent will
<br>
attempt to detect the presence of fping in the PATH and
check for support for the -D parameter. If this check is
successful, fping will be employed for ping data, otherwise
the <br>
system ping will be used.</p>

<p style="margin-top: 1em">RUNNING FLENT <br>
When run, flent must be supplied either (a) a test name and
one or more host names to connect to, or (b) one or more
input files containing data from previous runs to <br>
post-process.</p>

<p style="margin-top: 1em">Test names, hostnames and input
file names can all be specified as unqualified arguments,
and flent will do its best to guess which is which. For each
argument, if it is an <br>
existing file, it is assumed to be an input file, if it is
the name of an existing test configuration it&acirc;s
assumed to be a test name, and if neither of those are true,
it is <br>
assumed to be a host name. The -i and -H switches can be
used to explicitly specify the interpretation of an
argument.</p>

<p style="margin-top: 1em">Invocation <br>
flent [options] &lt;host|test|input file ...&gt;</p>

<p style="margin-top: 1em">General options <br>
-o OUTPUT, --output=OUTPUT <br>
File to write processed output to (default standard
out).</p>

<p style="margin-top: 1em">-D DATA_DIR, --data-dir=DATA_DIR
<br>
Directory to store data files in. Defaults to the current
directory.</p>

<p style="margin-top: 1em">-i INPUT, --input=INPUT <br>
File to read input from (instead of running tests). Input
files can also be specified as unqualified arguments without
using the -i switch.</p>

<p style="margin-top: 1em">-f FORMAT, --format=FORMAT <br>
Select output format (plot, csv, org_table, stats). Default
is no processed output (just writes the JSON data file).</p>

<p style="margin-top: 1em">-p PLOT, --plot=PLOT <br>
Select which plot to output for the given test (implies -f
plot). Use the --list-plots option to see available
plots.</p>

<p style="margin-top: 1em">-t TITLE, --title-extra=TITLE
<br>
Text to add to plot title and data file name.</p>

<p style="margin-top: 1em">-n NOTE, --note=NOTE <br>
Add arbitrary text as a note to be stored in the JSON data
file (under the NOTE key in the metadata object).</p>

<p style="margin-top: 1em">-r RCFILE, --rcfile=RCFILE <br>
Load configuration data from RCFILE (default ~/.flentrc).
See section below for information on the rc file format.</p>

<p style="margin-top: 1em">-x, --extended-metadata <br>
Collect extended metadata and store it with the data file.
May include details of your machine you don&acirc;t want to
distribute; see the section on the data format below.</p>

<p style="margin-top: 1em">--remote-metadata=HOSTNAME <br>
Collect extended metadata from a remote host. HOSTNAME is
passed verbatim to ssh, so can include hosts specified in
~/.ssh/config. Note that gathering the data can take <br>
some time, since it involves executing several remote
commands. This option can be specified multiple times and
implies --extended-metadata.</p>

<p style="margin-top: 1em">--gui Run the flent GUI. All
other options are used as defaults in the GUI, but can be
changed once it is running. The GUI can also be started by
running the flent-gui binary. <br>
For more information on the GUI, see the gui section.</p>

<p style="margin-top: 1em">--new-gui-instance <br>
Start a new GUI instance. Otherwise, flent will try to
connect to an already running GUI instance and have that
load any new data files specified as arguments. Implies <br>
--gui when passed on the command line, but not when set in
the rc file. Note that when multiple GUI instances are
running, there is no guarantee as to which instance will
<br>
get a subsequent open request (if run again without
--new-gui-instance).</p>

<p style="margin-top: 1em">--gui-no-defer <br>
Normally, the GUI defers redrawing plots until they are
needed to avoid redrawing all open plots every time an
option changes. This switch turns off that optimisation in
<br>
favour of always redrawing everything straight away. This is
useful when loading a bunch of plots from the command line
and then wanting to flip through them without <br>
drawing delay.</p>

<p style="margin-top: 1em">-b BATCH_NAME,
--batch-name=BATCH_NAME <br>
Run test batch BATCH_NAME (must be specified in a batch file
loaded by the --batch-file option). Can be supplied multiple
times.</p>

<p style="margin-top: 1em">-B BATCH_FILE,
--batch-file=BATCH_FILE <br>
Load batch file BATCH_FILE. Can be specified multiple times,
in which case the files will be combined (with
identically-named sections being overridden by later files).
<br>
See appropriate section below for an explanation of the
batch file format.</p>

<p style="margin-top: 1em">--batch-override=key=value <br>
Override parameter &acirc;key&acirc; in the batch config and
set it to &acirc;value&acirc;. The key name will be case
folded to lower case. Can be specified multiple times.</p>

<p style="margin-top: 1em">--batch-dry-run <br>
Dry batch run. Prints what would be done, but doesn&acirc;t
actually run any tests.</p>

<p style="margin-top: 1em">--batch-verbose <br>
Be verbose during batch run: Print all commands
executed.</p>

<p style="margin-top: 1em">--batch-repetitions=REPETITIONS
<br>
Shorthand for --batch-override
&rsquo;repetitions=REPETITIONS&acirc;.</p>

<p style="margin-top: 1em">--batch-title=TITLE <br>
Shorthand for --batch-override
&rsquo;batch_title=TITLE&acirc;.</p>

<p style="margin-top: 1em">--batch-resume=DIR <br>
Try to resume a previously interrupted batch run. The
argument is the top-level output directory from the previous
run.</p>

<p style="margin-top: 1em">This will attempt to find a data
file in the resume directory and load the BATCH_TIME from
the previous run from that and continue. The assumption is
that the output <br>
directory and filenames are generated from the batch time,
so that they will match with the previous run when the same
time is used. Then, tests for which data files <br>
already exist will be skipped on this run. If the rest of
the batch invocation is different from the one being
resumed, results may not be what you want.</p>

<p style="margin-top: 1em">There&rsquo;s a check to ensure
that the generated output path is a subdirectory of the
resume directory, and the whole run will be aborted if it
isn&rsquo;t.</p>

<p style="margin-top: 1em">Test configuration options <br>
These options affect the behaviour of the test being run and
have no effect when parsing input files.</p>

<p style="margin-top: 1em">-H HOST, --host=HOST <br>
Host to connect to for tests. For tests that support it,
multiple hosts can be specified by supplying this option
multiple times. Hosts can also be specified as
unquali&acirc; <br>
fied arguments; this parameter guarantees that the argument
be interpreted as a host name (rather than being subject to
auto-detection between input files, hostnames and <br>
test names).</p>

<p style="margin-top: 1em">--local-bind=IP <br>
Local hostname or IP address to bind to (for test tools that
support this). Can be specified multiple times for tests
that connect to more than one host; if it is, it <br>
must be specified as many times as there are hosts.</p>

<p style="margin-top: 1em">--remote-host=idx=HOSTNAME <br>
A remote hostname to connect to when starting a test. The
idx is the runner index, which is assigned sequentially to
each runner (and so it is not the same as the sequence <br>
of hostnames). Look for the &rsquo;IDX&rsquo; key in
SERIES_META for a test get the idx used here, but note that
the idx assignment depends on the exact arguments to the
test.</p>

<p style="margin-top: 1em">This works by simply prepending
&rsquo;ssh HOSTNAME&rsquo; to the runner command, so it
relies on the same binaries being in the same places on both
machines, and won&rsquo;t work for all <br>
runners.</p>

<p style="margin-top: 1em">This option can be specified
multiple times to have multiple runners run on remote
hosts.</p>

<p style="margin-top: 1em">-l LENGTH, --length=LENGTH <br>
Base test length (some tests may add some time to this).</p>

<p style="margin-top: 1em">-s STEP_SIZE,
--step-size=STEP_SIZE <br>
Measurement data point step size.</p>

<p style="margin-top: 1em">-d DELAY, --delay=DELAY <br>
Number of seconds to delay parts of test (such as bandwidth
loaders).</p>

<p style="margin-top: 1em">-4, --ipv4 <br>
Use IPv4 for tests (some tests may ignore this).</p>

<p style="margin-top: 1em">-6, --ipv6 <br>
Use IPv6 for tests (some tests may ignore this).</p>

<p style="margin-top: 1em">--socket-timeout=SOCKET_TIMEOUT
<br>
Socket timeout (in seconds) used for UDP delay measurement,
to prevent stalls on packet loss. Only enabled if the
installed netperf version is detected to support this <br>
(requires SVN version of netperf).</p>

<p style="margin-top: 1em">For the default value, see the
output of flent -h. The value of this parameter is an
implicit upper bound on how long a round-trip time that can
be measured. As such you <br>
may need to adjust it if you are experiencing latency above
the default value. Set to 0 to disable.</p>

<p style="margin-top: 1em">--test-parameter=key=value <br>
Arbitrary test parameter in key=value format. Key will be
case folded to lower case. The values are stored with the
results metadata, and so can be used for storing arbi&acirc;
<br>
trary information relevant for a particular test run.</p>

<p style="margin-top: 1em">In addition to serving as simple
metadata, the test parameters can also affect the behaviour
of some test configurations. See the tests section for
information on these.</p>

<p style="margin-top: 1em">This option can be specified
multiple times to set multiple test parameters.</p>

<p style="margin-top: 1em">--swap-up-down <br>
Switch upstream and downstream directions for data transfer.
This means that &acirc;upload&acirc; will become
&acirc;download&acirc; and vice versa. Works by exchanging
netperf TCP_MAERTS and <br>
TCP_STREAM parameters, so only works for tests that employ
these as their data transfer, and only for the TCP
streams.</p>

<p style="margin-top: 1em">Plot configuration options <br>
These options are used to configure the appearance of plot
output and only make sense combined with -f plot.</p>

<p style="margin-top: 1em">-z, --zero-y <br>
Always start y axis of plot at zero, instead of autoscaling
the axis (also disables log scales). Autoscaling is still
enabled for the upper bound.</p>

<p style="margin-top: 1em">--bounds-x=BOUNDS</p>

<p style="margin-top: 1em">--bounds-y=BOUNDS <br>
Specify bounds of the plot axes. If specifying one number,
that will become the upper bound. Specify two numbers
separated by a comma to specify both upper and lower <br>
bounds. To specify just the lower bound, add a comma
afterwards. Can be specified twice, corresponding to figures
with multiple axes.</p>

<p style="margin-top: 1em">--label-x=LABEL</p>

<p style="margin-top: 1em">--label-y=LABEL <br>
Override the figure axis labels. Can be specified twice,
corresponding to figures with multiple axes.</p>

<p style="margin-top: 1em">--colours=COLOURS <br>
Comma-separated list of colours to be used for the plot
colour cycle. Can be specified in any format understood by
matplotlib (including HTML hex values prefixed with a <br>
#).</p>

<p style="margin-top: 1em">Yes, this option uses British
spelling. No, American spelling is not supported. Deal with
it.</p>

<p style="margin-top: 1em">-I, --invert-latency-y <br>
Invert the y-axis for latency data series (making plots show
&acirc;better values upwards&acirc;).</p>

<p style="margin-top: 1em">--log-scale <br>
Use logarithmic scale on plots.</p>

<p style="margin-top: 1em">--norm-factor=FACTOR <br>
Factor to normalise data by. I.e. divide all data points by
this value. Can be specified multiple times, in which case
each value corresponds to a data series.</p>

<p style="margin-top: 1em">--scale-data=SCALE_DATA <br>
Additional data files to consider when scaling the plot axes
(for plotting several plots with identical axes). Note, this
displays only the first data set, but with axis <br>
scaling taking into account the additional data sets. Can be
supplied multiple times; see also --scale-mode.</p>

<p style="margin-top: 1em">-S, --scale-mode <br>
Treat file names (except for the first one) passed as
unqualified arguments as if passed as --scale-data (default
as if passed as --input).</p>

<p style="margin-top: 1em">--concatenate <br>
Concatenate multiple result sets into one data series. This
means that each data file will have its time axis shifted by
the preceding series duration and appended to the <br>
first data set specified. Only works for data sets from the
same test, obviously.</p>

<p style="margin-top: 1em">--absolute-time <br>
Plot data points with absolute UNIX time on the x-axis. This
requires the absolute starting time for the test run to be
stored in the data file, and so it won&acirc;t work with
<br>
data files that predates this feature.</p>

<p style="margin-top: 1em">--subplot-combine <br>
When plotting multiple data series, plot each one on a
separate subplot instead of combining them into one plot.
This mode is not supported for all plot types, and only <br>
works when --scale-mode is disabled.</p>

<p style="margin-top: 1em">--no-print-n <br>
Do not print the number of data points on combined plots.
When using plot types that combines results from several
test runs, the number of data series in each combined <br>
data point is normally added after the series name, (n=X)
for X data series. This option turns that off.</p>

<p style="margin-top: 1em">--no-annotation <br>
Exclude annotation with hostnames, time and test length from
plots.</p>

<p style="margin-top: 1em">--no-title <br>
Exclude title from plots.</p>

<p style="margin-top: 1em">--override-title=TITLE <br>
Override plot title with this string. Completely discards
the configured title (from the test configuration), as well
as the title stored in the data set, and replaces it <br>
with the value supplied here. This is useful to override the
plot title at the time of plotting, for instance to add a
title to an aggregate plot from several data series. <br>
When this parameter is specified, --no-title has no
effect.</p>

<p style="margin-top: 1em">--override-label=LABEL <br>
Override dataset label. Can be specified multiple times when
multiple datasets are being plotted, in which case the order
of labels corresponds to the order of datasets.</p>

<p style="margin-top: 1em">Like --override-title, this is
applied at the time of plotting.</p>

<p style="margin-top: 1em">--override-group-by=GROUP <br>
Override the group_by setting for combination plots. This is
useful to, for instance, switch to splitting up combined
data sets by batch run instead of by file name.</p>

<p style="margin-top: 1em">--combine-save-dir=DIRNAME <br>
When doing a combination plot save the intermediate data to
DIRNAME. This can then be used for subsequent plotting to
avoid having to load all the source data files again <br>
on each plot.</p>

<p style="margin-top: 1em">--split-group=LABEL <br>
Split data sets into groups when creating box plots. Specify
this option multiple times to define the new groups; the
value of each option is the group name.</p>

<p style="margin-top: 1em">Say you&rsquo;re plotting nine
datasets which are really testing two variables with three
values each. In this case, it can be useful to have the box
plot of the results be <br>
split into three parts (corresponding to the values of one
variable) with each three boxes in each of them
(corresponding to the values of the second variable). This
<br>
option makes this possible; simply specify it three times
with the labels to be used for the three groups.</p>

<p style="margin-top: 1em">A constraint on this option is
that the number of datasets being plotted must be divisible
by the number of groups.</p>

<p style="margin-top: 1em">--no-markers <br>
Don&acirc;t use line markers to differentiate data series on
plots.</p>

<p style="margin-top: 1em">--no-legend <br>
Exclude legend from plots.</p>

<p style="margin-top: 1em">--horizontal-legend <br>
Place a horizontal legend below the plot instead of a
vertical one next to it. Doesn&rsquo;t work well if there
are too many items in the legend, obviously.</p>

<p style="margin-top: 1em">--legend-title=LEGEND_TITLE <br>
Override legend title on plot.</p>


<p style="margin-top: 1em">--legend-placement=LEGEND_PLACEMENT
<br>
Control legend placement. Enabling this option will place
the legend inside the plot at the specified location. Use
&rsquo;best&rsquo; to let matplotlib decide.</p>


<p style="margin-top: 1em">--legend-columns=LEGEND_COLUMNS</p>

<p style="margin-top: 1em">Set the number of columns in the
legend.</p>

<p style="margin-top: 1em">--filter-legend <br>
Filter legend labels by removing the longest common
substring from all entries. This is not particularly smart,
so should be used with care.</p>

<p style="margin-top: 1em">--filter-regexp=REGEXP <br>
Filter the plot legend by the supplied regular expression.
Note that for combining several plot results, the regular
expression is also applied before the grouping logic, <br>
meaning that a too wide filter can mess up the grouping.</p>

<p style="margin-top: 1em">--filter-series=SERIES <br>
Filter out specified series from plot. Can be specified
multiple times.</p>

<p style="margin-top: 1em">--skip-missing-series <br>
Skip missing series entirely from plots. Only works for bar
plots.</p>

<p style="margin-top: 1em">--replace-legend=src=dest <br>
Replace &rsquo;src&rsquo; with &rsquo;dst&rsquo; in legends.
Can be specified multiple times.</p>

<p style="margin-top: 1em">--figure-width=FIG_WIDTH <br>
Figure width in inches. Used when saving plots to file and
for default size of the interactive plot window.</p>

<p style="margin-top: 1em">--figure-height=FIG_HEIGHT <br>
Figure height in inches. Used when saving plots to file and
for default size of the interactive plot window.</p>

<p style="margin-top: 1em">--figure-dpi=FIG_DPI <br>
Figure DPI. Used when saving plots to raster format
files.</p>

<p style="margin-top: 1em">--no-matplotlibrc <br>
Don&acirc;t load included matplotlibrc values. Use this if
autodetection of custom matplotlibrc fails and flent is
inadvertently overriding rc values.</p>

<p style="margin-top: 1em">--no-hover-highlight <br>
Don&rsquo;t highlight data series on hover in interactive
plot views. Use this if redrawing is too slow, or the
highlighting is undesired for other reasons.</p>

<p style="margin-top: 1em">Test tool-related options <br>
--control-host=HOST <br>
Hostname for the test control connection (for test tools
that support this). Default: First hostname of test
target.</p>

<p style="margin-top: 1em">When running tests that uses
D-ITG as a test tool (such as the voip-* tests), this switch
controls where flent will look for the D-ITG control server
(see section below on <br>
running tests with D-ITG). For Netperf-based tests, this
option is passed to Netperf to control where to point the
control connection. This is useful to, for instance, to <br>
run the control server communication over a separate control
network so as to not interfere with test traffic.</p>

<p style="margin-top: 1em">--control-local-bind=IP <br>
Local hostname or IP to bind control connection to (for test
tools that support it; currently netperf). If not supplied,
the value for --local-bind will be used. Note that <br>
if this value is passed but --local-bind is not, netperf
will use the value specified here to bind the data
connections to as well.</p>

<p style="margin-top: 1em">--netperf-control-port=PORT <br>
Port for Netperf control server. Default: 12865.</p>

<p style="margin-top: 1em">--ditg-control-port=PORT <br>
Port for D-ITG control server. Default: 8000.</p>

<p style="margin-top: 1em">--ditg-control-secret=SECRET
<br>
Secret for D-ITG control server authentication. Default:
&acirc;&acirc;.</p>

<p style="margin-top: 1em">--http-getter-urllist=FILENAME
<br>
When running HTTP tests, the http-getter tool is used to
fetch URLs (see https://github.com/tohojo/http-getter). This
option specifies the filename containing the list of <br>
HTTP URLs to get. Can also be a URL, which will then be
downloaded as part of each test iteration. If not specified,
this is set to http://&lt;hostname&gt;/filelist.txt where
<br>
&lt;hostname&gt; is the first test hostname.</p>


<p style="margin-top: 1em">--http-getter-dns-servers=DNS_SERVERS
<br>
DNS servers to use for http-getter lookups. Format is
host[:port][,host[:port]]... This option will only work if
libcurl supports it (needs to be built with the ares <br>
resolver). Default is none (use the system resolver).</p>


<p style="margin-top: 1em">--http-getter-timeout=MILLISECONDS
<br>
Timeout for HTTP connections. Default is to use the test
length.</p>

<p style="margin-top: 1em">--http-getter-workers=NUMBER
<br>
Number of workers to use for getting HTTP urls. Default is
4.</p>

<p style="margin-top: 1em">Misc and debugging options: <br>
-L LOG_FILE, --log-file=LOG_FILE <br>
Write debug log (test program output) to log file.</p>

<p style="margin-top: 1em">--list-tests <br>
List available tests and exit.</p>

<p style="margin-top: 1em">--list-plots <br>
List available plots for selected test and exit.</p>

<p style="margin-top: 1em">-V, --version <br>
Show Flent version information and exit.</p>

<p style="margin-top: 1em">-v, --verbose <br>
Enable verbose logging to console.</p>

<p style="margin-top: 1em">-q, --quiet <br>
Disable normal logging to console (and only log warnings and
errors).</p>

<p style="margin-top: 1em">--debug-error <br>
Print full exception backtraces to console.</p>

<p style="margin-top: 1em">-h, --help <br>
Show usage help message and exit.</p>

<p style="margin-top: 1em">Signals <br>
Flent will abort what it is currently doing on receiving a
SIGINT -- this includes killing all runners, cleaning up
temporary files and shutting down as gracefully as possible.
<br>
Runners are killed with SIGTERM in this mode, and their
output is discarded. If a batch run is in progress, the
current test will be interrupted in this way, and the rest
of the <br>
batch run is aborted. Previously completed tests and their
results are not aborted. Post-commands marked as
&acirc;essential&acirc; will be run after the test is
interrupted. Additionally, <br>
flent converts SIGTERM into SIGINT internally and reacts
accordingly.</p>

<p style="margin-top: 1em">Upon receiving a SIGUSR1, flent
will try to gracefully abort the test it is currently
running, and parse the output of the runners to the extent
that any such output exists. That <br>
is, each runner will be killed by a SIGINT, which will cause
a graceful shutdown for at least ping and netperf (although
netperf running in TCP_MAERTS mode will bug out when <br>
interrupted like this, so end-of-tests statistics will be
missing). Flent will only react once to a SIGUSR1, sending
exactly one SIGINT to the active runners, then wait for them
<br>
to exit. This may take several seconds in the case of
netperf. If the runners for some reason fail to exit, flent
will be stuck and will need to be killed with SIGINT. If
running <br>
in batch mode, SIGUSR1 will only affect the currently
running test; subsequent tests will still be run.</p>

<p style="margin-top: 1em">SUPPLIED TESTS <br>
Test are supplied as Python files and can specify commands
to run etc. For a full list of the tests supported by flent,
see the --list-tests option.</p>

<p style="margin-top: 1em">The Realtime Response Under Load
(RRUL) test <br>
This test exists in a couple of variants and is a partial
implementation of the RRUL specification as written by Dave
Taht (see <br>

https://github.com/dtaht/deBloat/blob/master/spec/rrule.doc?raw=true).
It works by running RTT measurement using ICMP ping and UDP
roundtrip time measurement, while loading up <br>
the link with eight TCP streams (four downloads, four
uploads). This quite reliably saturates the measured link
(wherever the bottleneck might be), and thus exposes
bufferbloat <br>
when it is present.</p>

<p style="margin-top: 1em">Simple TCP flow tests <br>
These tests combine a TCP flow (either in one direction, or
both) with an ICMP ping measurement. It&acirc;s a simpler
test than RRUL, but in some cases the single TCP flow can be
suf&acirc; <br>
ficient to saturate the link.</p>

<p style="margin-top: 1em">UDP flood test <br>
This test runs iperf configured to emit 100Mbps of UDP
packets targeted at the test host, while measuring RTT using
ICMP ping. It is useful for observing latency in the face of
a <br>
completely unresponsive packet stream.</p>

<p style="margin-top: 1em">Test parameters <br>
Some test parameters (set with --test-parameter) affect the
way tests behave. These are:</p>

<p style="margin-top: 1em">upload_streams</p>

<p style="margin-top: 1em">download_streams <br>
These set the number of upload or download streams for the
tcp_nup, tcp_ndown and rrul_be_nflows tests.</p>

<p style="margin-top: 1em">udp_bandwidth <br>
This sets the bandwidth of each UDP stream in the udp_*
tests. The option is passed to iperf so can be in any syntax
the iperf understands (e.g. 20M for 20 Mbps).</p>

<p style="margin-top: 1em">burst_length</p>

<p style="margin-top: 1em">burst_ports</p>

<p style="margin-top: 1em">burst_psize</p>

<p style="margin-top: 1em">burst_tos <br>
These set the length, number of ports to use, packet size
and TOS value for the packet bursts generated in the burst*
tests.</p>

<p style="margin-top: 1em">cpu_stats_hosts</p>

<p style="margin-top: 1em">netstat_hosts</p>

<p style="margin-top: 1em">qdisc_stats_hosts</p>

<p style="margin-top: 1em">wifi_stats_hosts <br>
These set hostnames to gather statistics from from during
the test. The hostnames are passed to SSH, so can be
anything understood by SSH (including using username@host
<br>
syntax, or using hosts defined in ~/.ssh/config). This will
attempt to run remote commands on these hosts to gather the
required statistics, so passwordless login has to <br>
be enabled for. Multiple hostnames can be specified,
separated by commas.</p>

<p style="margin-top: 1em">CPU stats and netstat output is
global to the machine being connected to. The qdisc and WiFi
stats need extra parameters to work. These are
qdisc_stats_interfaces, <br>
wifi_stats_interfaces and wifi_stats_stations. The two
former specify which interfaces to gather statistics from.
These are paired with the hostnames, and so must contain
<br>
the same number of elements (also comma-separated) as the
_hosts variables. To specify multiple interfaces on the same
host, duplicate the hostname. The wifi_stats_sta&acirc; <br>
tions parameter specifies MAC addresses of stations to
gather statistics for. This list is the same for all hosts,
but only stations present in debugfs on each host are <br>
actually captured.</p>

<p style="margin-top: 1em">The qdisc stats gather
statistics output from tc -s, while the WiFi stats gather
statistics from debugfs. These are gathered by looping in a
shell script; however, for <br>
better performance, the tc_iterate and wifistats_iterate
programmes available in the misc/ directory of the source
code tarball can be installed. On low-powered systems <br>
this can be critical to get correct statistics. The helper
programmes are packaged for LEDE/OpenWrt in the flent-tools
package.</p>

<p style="margin-top: 1em">ping_hosts</p>

<p style="margin-top: 1em">ping_local_binds <br>
These are used to define one or more extra host names that
will receive a ping flow while a test is run. The ping_hosts
variable simply specifies hostnames to ping (sev&acirc; <br>
eral can be specified by separating them with commas). The
ping_local_binds variable sets local IP address(es) to bind
to for the extra ping flows. If specified, it must <br>
contain the same number of local addresses as the number of
ping hosts. The same local address can be specified multiple
times, however.</p>

<p style="margin-top: 1em">voip_host</p>

<p style="margin-top: 1em">voip_local_bind</p>

<p style="margin-top: 1em">voip_control_host <br>
Similar to the ping variants above, these parameters specify
a hostname that will receive a VoIP test. However, unlike
the ping parameters, only one hostname can be speci&acirc;
<br>
fied for VoIP tests, and that end-host needs to have D-ITG
(and the control server) running.</p>

<p style="margin-top: 1em">control_hosts <br>
Hostnames to use for the control connections for the
rtt_fair_var* tests. Comma-separated. If specified, it must
contain as many hostnames as the number of target
host&acirc; <br>
names specified for the test.</p>

<p style="margin-top: 1em">THE FLENT GUI <br>
Flent comes equipped with a GUI to browse and plot
previously captured datasets. The GUI requires PyQt4; if
this is installed, it can be launched with the --gui
parameter, or by <br>
launching the flent-gui binary. Additionally, if Flent is
launched without parameters and without a controlling
terminal, the GUI will be launched automatically.</p>

<p style="margin-top: 1em">The GUI can be used for
interactively plotting previously captured datasets, and
makes it easy to compare results from several test runs. It
presents a tabbed interface to graphs <br>
of data files, allows dynamic configuration of plots, and
includes a metadata browser. For each loaded data file,
additional data files can be loaded and added to the plot,
simi&acirc; <br>
lar to what happens when specifying multiple input files for
plotting on the command line. A checkbox controls whether
the added data files are added as separate entries to the
<br>
plot, or whether they are used for scaling the output
(mirroring the --scale-mode) command line switch.</p>

<p style="margin-top: 1em">The GUI also incorporates
matplotlib&acirc;s interactive browsing toolbar, enabling
panning and zooming of the plot area, dynamic configuration
of plot and axis parameters and labels <br>
and saving the plots to file. The exact dynamic features
supported depends on the installed version of
matplotlib.</p>

<p style="margin-top: 1em">CONFIGURATION FILES <br>
The RC file <br>
Some of the command line options can be specified in an rc
file. By default, flent looks for this in ~/.flentrc, but an
alternative location can be specified with the --rcfile <br>
command line option.</p>

<p style="margin-top: 1em">The rc file allows options to be
specified globally, an optionally overridden for specific
tests. For an explanation of the options, refer to the
annotated example rc file, by <br>
default installed to
/usr/share/doc/flent/flentrc.example.</p>

<p style="margin-top: 1em">Batch Files <br>
Flent supports reading batch files to automate running
several tests and do setup/teardown of test environment etc.
This greatly aids reproducibility of tests.</p>

<p style="margin-top: 1em">The batch file is parsed as an
ini file, and can have three types of sections: batches,
commands and args. Each section also has a name; type and
name are separated with two <br>
colons. &rsquo;Batches&rsquo; are named tests that can be
selected from the command line, &rsquo;commands&rsquo; are
system commands to be run before or after each test run, and
&rsquo;args&rsquo; are used in the <br>
looping mechanism (which allows repeating tests multiple
times with different parameters).</p>

<p style="margin-top: 1em">Variables in sections control
the operation of Flent and can be modified in several ways:
Sections of the same type can inherit from each other and
the variables in an &rsquo;arg&rsquo; sec&acirc; <br>
tion will be interpolated into the batch definition on each
iteration of a loop. In addition, variable contents can be
substituted into other variables by using the ${varname}
<br>
syntax. These three operations are resolved in this order
(inheritance, arg interpolation and variable
substitution).</p>

<p style="margin-top: 1em">An annotated example batchfile
is distributed with the source code, and is by default
installed to /usr/share/doc/flent/batchfile.example.</p>

<p style="margin-top: 1em">THE DATA FILE FORMAT <br>
The aggregated test data is saved in a file called
&lt;test_name&gt;-&lt;date&gt;.&lt;title&gt;.flent.gz (the
title part is omitted if no title is specified by the -t
parameter). This file con&acirc; <br>
tains the data points generated during the test, as well as
some metadata.</p>

<p style="margin-top: 1em">The top-level object keys <br>
version <br>
The file format version as an integer.</p>

<p style="margin-top: 1em">x_values <br>
An array of the x values for the test data (typically the
time values for timeseries data).</p>

<p style="margin-top: 1em">results <br>
A JSON object containing the result data series. The keys
are the data series names; the value for each key is an
array of y values for that data series. The data array <br>
has the same length as the x_values array, but there may be
missing data points (signified by null values).</p>

<p style="margin-top: 1em">metadata <br>
An object containing various data points about the test run.
The metadata values are read in as configuration parameters
when the data set is loaded in for further pro&acirc; <br>
cessing. Not all tests use all the parameters, but they are
saved anyway.</p>

<p style="margin-top: 1em">raw_values <br>
An array of objects for each data series. Each element of
the array contains the raw values as parsed from the test
tool corresponding to that data series.</p>

<p style="margin-top: 1em">Metadata keys <br>
NAME The test name.</p>

<p style="margin-top: 1em">TITLE Any extra title specified
by the --title-extra parameter when the test was run.</p>

<p style="margin-top: 1em">HOSTS List of the server
hostnames connected to during the test.</p>

<p style="margin-top: 1em">LOCAL_HOST <br>
The hostname of the machine that ran the test.</p>

<p style="margin-top: 1em">LENGTH Test length in seconds,
as specified by the --length parameter.</p>

<p style="margin-top: 1em">TOTAL_LENGTH <br>
Actual data series length, after the test has added time to
the LENGTH.</p>

<p style="margin-top: 1em">STEP_SIZE <br>
Time step size granularity.</p>

<p style="margin-top: 1em">TIME ISO timestamp of the time
the test was initiated.</p>

<p style="margin-top: 1em">NOTE Arbitrary text as entered
with the --note switch when the test was run.</p>

<p style="margin-top: 1em">FLENT_VERSION <br>
Version of Flent that generated the data file.</p>

<p style="margin-top: 1em">IP_VERSION <br>
IP version used to run test (as specified by command line
parameters, or auto-detected from getaddrinfo() if
unspecified).</p>

<p style="margin-top: 1em">KERNEL_NAME <br>
The kernel name as reported by uname -s.</p>

<p style="margin-top: 1em">KERNEL_RELEASE <br>
The kernel release as reported by uname -r.</p>

<p style="margin-top: 1em">MODULE_VERSIONS <br>
The sha1sum of certain interesting Linux kernel modules, if
available. Can be used to match test data to specific code
versions, if the kernel build is instrumented to, <br>
e.g., set the build ID to a git revision.</p>

<p style="margin-top: 1em">SYSCTLS <br>
The values of several networking-related sysctls on the host
(if available; Linux only).</p>

<p style="margin-top: 1em">EGRESS_INFO <br>
Interface name, qdisc, offload, driver and BQL configuration
of the interface used to reach the test target. This
requires that the ip binary is present on Linux, but can
<br>
be extracted from route on BSD. Qdisc information requires
the tc binary to be present, and offload information
requires ethtool.</p>

<p style="margin-top: 1em">If the --remote-metadata is
used, the extended metadata info is gathered for each of the
hostnames specified. This is gathered under the
REMOTE_METADATA key in the meta&acirc; <br>
data object, keyed by the hostname values passed to
--remote-metadata. Additionally, the REMOTE_METADATA object
will contain an object called INGRESS_INFO which is a <br>
duplicate of EGRESS_INFO, but with the destination IP
exchanged for the source address of the host running flent.
The assumption here is that --remote-metadata is used to
<br>
capture metadata of a router known to be in the test path,
in which case INGRESS_INFO will contain information about
the reverse path from the router (which is ingress <br>
from the point of view of the host running flent). If the
host being queried for remote metadata is off the path, the
contents of INGRESS_INFO will probably be the same as <br>
that of EGRESS_INFO .</p>

<p style="margin-top: 1em">Extended metadata <br>
If the --extended-metadata switch is turned on, the
following additional values are collected and stored (to the
extent they are available from the platform):</p>

<p style="margin-top: 1em">IP_ADDRS <br>
IP addresses assigned to the machine running flent.</p>

<p style="margin-top: 1em">GATEWAYS <br>
IP addresses of all detected default gateways on the system,
and the interfaces they are reachable through. Only
available if the netstat binary is present on the
system.</p>

<p style="margin-top: 1em">EGRESS_INFO <br>
In the EGRESS_INFO key, the IP address of the next-hop
router and the interface MAC address are added if extended
metadata is enabled.</p>

<p style="margin-top: 1em">OUTPUT FORMATS <br>
The following output formats are currently supported by
Flent:</p>

<p style="margin-top: 1em">Plot output (-f plot) <br>
Output test data as one of a series of graphical plots of
timeseries data or summarised as a CDF plot. Each test
supplies a number of different plots; the list of plots for
a <br>
given test is output by the --list-plots switch (which must
be supplied along with a test name).</p>

<p style="margin-top: 1em">The plots are drawn by
matplotlib, and can be displayed on the screen interactively
(requires a graphical display), or output to a file in svg,
pdf, ps and png formats. Using the <br>
-o switch turns out file output (the file format is inferred
from the file name), while not supplying the switch turns on
the interactive plot viewer.</p>

<p style="margin-top: 1em">Tabulated output (-f csv and -f
org_table) <br>
These formats output the numeric data in a tabulated format
to be consumed by other applications. The csv output format
is a comma-separated output that can be imported into e.g.
<br>
spreadsheets, while org_table outputs a tabulated output in
the table format supported by Emacs org mode. The data is
output in text format to standard output, or written to a
<br>
file if invoked with the -o parameter.</p>

<p style="margin-top: 1em">Statistics output (-f stats)
<br>
This output format outputs various statistics about the test
data, such as total bandwidth consumed, and various
statistical measures (min/max/mean/median/std dev/variance)
for <br>
each data source specified in the relevant test (this can
include some data sources not includes on plots). The data
is output in text format to standard output, or written to a
<br>
file if invoked with the -o parameter.</p>

<p style="margin-top: 1em">Metadata output (-f metadata)
<br>
This output format outputs the test metadata as
pretty-printed JSON (also suitable for human consumption).
It is output as a list of objects, where each object
corresponds to the <br>
metadata of one test. Mostly useful for inspecting metadata
of stored data files.</p>

<p style="margin-top: 1em">MISC INFO <br>
Running Tests With The D-ITG Tool <br>
This version of flent has experimental support for running
and parsing the output of the D-ITG test tool (see
http://traffic.comics.unina.it/software/ITG/). Flent
supports pars&acirc; <br>
ing the one-way delay as measured by D-ITG. However, in
order to do so, the data needs to be collected at the
receiver end, statistics extracted, and the result passed
back to <br>
flent on the sending side.</p>

<p style="margin-top: 1em">To perform this function, flent
supports a control server which will listen to XML-RPC
requests, spawn an appropriate ITGRecv instance and, after
the test is done, parse its out&acirc; <br>
put and make it available for flent to retrieve. This
control server is available as a Python file that by default
is installed in /usr/share/doc/flent/misc. It currently <br>
requires a patched version of D-ITG v2.8.1. The patch is
also included in the same directory.</p>

<p style="margin-top: 1em">Note that the D-ITG server is
finicky and not designed with security in mind. For this
reason, the control server includes HMAC authentication to
only allow authenticated <br>
clients to run a test against the server; however there is
currently no support for enforcement of this in e.g.
firewall rules. Please bear this in mind when running a
publicly <br>
reachable ITGRecv instance (with or without the control
server). Another security issue with the control server is
that the Python XML-RPC library by default is vulnerable to
XML <br>
entity expansion attacks. For this reason, it is highly
recommended to install the defusedxml library (available at
https://pypi.python.org/pypi/defusedxml/) on the host
running <br>
the control server. The server will try to find the library
on startup and refuse to run if it is not available, unless
explicitly told otherwise.</p>

<p style="margin-top: 1em">Bugs <br>
Under some conditions (such as severe bufferbloat), the UDP
RTT measurements done by netperf can experience packet loss
to the extent that the test aborts completely, which can
<br>
cause missing data points for some measurement series. The
--socket-timeout feature can alleviate this, but requires a
recent SVN version of netperf to work. Flent tries to <br>
detect if netperf supports this option and enables it for
the UDP measurements if it does.</p>

<p style="margin-top: 1em">Probably many other bugs. Please
report any found to https://github.com/tohojo/flent/issues
and include the output of flent --version in the report.</p>

<p style="margin-top: 1em">AUTHOR <br>
Toke H&Atilde;&cedil;iland-J&Atilde;&cedil;rgensen</p>

<p style="margin-top: 1em">COPYRIGHT <br>
2012-2016, Toke
H&Atilde;&cedil;iland-J&Atilde;&cedil;rgensen and
contributors. Source code is GPLv3. Documentation is
CC-BY-SA</p>

<p style="margin-top: 1em">1.0.1 January 16, 2017
FLENT(1)</p>
<hr>
</body>
</html>
