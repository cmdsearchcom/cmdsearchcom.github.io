<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:36:08 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>rsnapshot(1) rsnapshot-tools rsnapshot(1)</p>

<p style="margin-top: 1em">NAME <br>
rsnapshot - remote filesystem snapshot utility</p>

<p style="margin-top: 1em">SYNOPSIS <br>
rsnapshot [-vtxqVD] [-c cfgfile] [command] [args]</p>

<p style="margin-top: 1em">DESCRIPTION <br>
rsnapshot is a filesystem snapshot utility. It can take
incremental snapshots of local and remote filesystems for
any number of machines.</p>

<p style="margin-top: 1em">Local filesystem snapshots are
handled with rsync(1). Secure remote connections are handled
with rsync over ssh(1), while anonymous rsync connections
simply use an rsync server. <br>
Both remote and local transfers depend on rsync.</p>

<p style="margin-top: 1em">rsnapshot saves much more disk
space than you might imagine. The amount of space required
is roughly the size of one full backup, plus a copy of each
additional file that is <br>
changed. rsnapshot makes extensive use of hard links, so if
the file doesn&rsquo;t change, the next snapshot is simply a
hard link to the exact same file.</p>

<p style="margin-top: 1em">rsnapshot will typically be
invoked as root by a cron job, or series of cron jobs. It is
possible, however, to run as any arbitrary user with an
alternate configuration file.</p>

<p style="margin-top: 1em">All important options are
specified in a configuration file, which is located by
default at /etc/rsnapshot.conf. An alternate file can be
specified on the command line. There are <br>
also additional options which can be passed on the command
line.</p>

<p style="margin-top: 1em">The command line options are as
follows:</p>

<p style="margin-top: 1em">-v verbose, show shell commands
being executed</p>

<p style="margin-top: 1em">-t test, show shell commands
that would be executed</p>

<p style="margin-top: 1em">-c path to alternate config
file</p>

<p style="margin-top: 1em">-x one filesystem, don&rsquo;t
cross partitions within each backup point</p>

<p style="margin-top: 1em">-q quiet, suppress non-fatal
warnings</p>

<p style="margin-top: 1em">-V same as -v, but with more
detail</p>

<p style="margin-top: 1em">-D a firehose of diagnostic
information</p>

<p style="margin-top: 1em">CONFIGURATION <br>
/etc/rsnapshot.conf is the default configuration file. All
parameters in this file must be separated by tabs.
/etc/rsnapshot.conf.default can be used as a reference.</p>

<p style="margin-top: 1em">It is recommended that you copy
/etc/rsnapshot.conf.default to /etc/rsnapshot.conf, and then
modify /etc/rsnapshot.conf to suit your needs.</p>

<p style="margin-top: 1em">Long lines may be split over
several lines. &quot;Continuation&quot; lines must begin
with a space or a tab character. Continuation lines will
have all leading and trailing whitespace <br>
stripped off, and then be appended with an intervening tab
character to the previous line when the configuation file is
parsed.</p>

<p style="margin-top: 1em">Here is a list of allowed
parameters:</p>

<p style="margin-top: 1em">config_version Config file
version (required). Default is 1.2</p>

<p style="margin-top: 1em">snapshot_root Local filesystem
path to save all snapshots</p>

<p style="margin-top: 1em">include_conf Include another
file in the configuration at this point.</p>

<p style="margin-top: 1em">This is recursive, but you may
need to be careful about paths when specifying which file to
include. We check to see if the file you have specified is
readable, and will <br>
yell an error if it isn&rsquo;t. We recommend using a full
path. As a special case, include_conf&rsquo;s value may be
enclosed in &lsquo;backticks&lsquo; in which case it will be
executed and <br>
whatever it spits to STDOUT will be included in the
configuration. Note that shell meta-characters may be
interpreted.</p>

<p style="margin-top: 1em">no_create_root If set to 1,
rsnapshot won&rsquo;t create snapshot_root directory</p>

<p style="margin-top: 1em">cmd_rsync Full path to rsync
(required)</p>

<p style="margin-top: 1em">cmd_ssh Full path to ssh
(optional)</p>

<p style="margin-top: 1em">cmd_cp Full path to cp
(optional, but must be GNU version)</p>

<p style="margin-top: 1em">If you are using Linux, you
should uncomment cmd_cp. If you are using a platform which
does not have GNU cp, you should leave cmd_cp commented
out.</p>

<p style="margin-top: 1em">With GNU cp, rsnapshot can take
care of both normal files and special files (such as FIFOs,
sockets, and block/character devices) in one pass.</p>

<p style="margin-top: 1em">If cmd_cp is disabled, rsnapshot
will use its own built-in function, native_cp_al() to backup
up regular files and directories. This will then be followed
up by a <br>
separate call to rsync, to move the special files over
(assuming there are any).</p>

<p style="margin-top: 1em">cmd_rm Full path to rm
(optional)</p>

<p style="margin-top: 1em">cmd_logger Full path to logger
(optional, for syslog support)</p>

<p style="margin-top: 1em">cmd_du Full path to du
(optional, for disk usage reports)</p>

<p style="margin-top: 1em">cmd_rsnapshot_diff Full path to
rsnapshot-diff (optional)</p>

<p style="margin-top: 1em">cmd_preexec</p>

<p style="margin-top: 1em">Full path (plus any arguments)
to preexec script (optional). This script will run
immediately before each backup operation (but not any
rotations). If the execution <br>
fails, rsnapshot will stop immediately.</p>

<p style="margin-top: 1em">cmd_postexec</p>

<p style="margin-top: 1em">Full path (plus any arguments)
to postexec script (optional). This script will run
immediately after each backup operation (but not any
rotations). If the execution <br>
fails, rsnapshot will stop immediately.</p>

<p style="margin-top: 1em">linux_lvm_cmd_lvcreate</p>

<p style="margin-top: 1em">linux_lvm_cmd_lvremove</p>

<p style="margin-top: 1em">linux_lvm_cmd_mount</p>

<p style="margin-top: 1em">linux_lvm_cmd_umount</p>

<p style="margin-top: 1em">Paths to lvcreate, lvremove,
mount and umount commands, for use with Linux LVMs. You may
include options to the commands also. The lvcreate,
lvremove, mount and umount <br>
commands are required for managing snapshots of LVM volumes
and are otherwise optional.</p>

<p style="margin-top: 1em">retain [name] [number]</p>

<p style="margin-top: 1em">&quot;name&quot; refers to the
name of this backup level (e.g., alpha, beta, so also called
the &rsquo;interval&rsquo;). &quot;number&quot; is the
number of snapshots for this type of interval that will <br>
be retained. The value of &quot;name&quot; will be the
command passed to rsnapshot to perform this type of
backup.</p>

<p style="margin-top: 1em">A deprecated alias for
&rsquo;retain&rsquo; is &rsquo;interval&rsquo;.</p>

<p style="margin-top: 1em">Example: retain alpha 6</p>

<p style="margin-top: 1em">[root@localhost]# rsnapshot
alpha</p>

<p style="margin-top: 1em">For this example, every time
this is run, the following will happen:</p>

<p style="margin-top: 1em">&lt;snapshot_root&gt;/alpha.5/
will be deleted, if it exists.</p>


<p style="margin-top: 1em">&lt;snapshot_root&gt;/alpha.{1,2,3,4}
will all be rotated +1, if they exist.</p>

<p style="margin-top: 1em">&lt;snapshot_root&gt;/alpha.0/
will be copied to &lt;snapshot_root&gt;/alpha.1/ using hard
links.</p>

<p style="margin-top: 1em">Each backup point (explained
below) will then be rsynced to the corresponding directories
in &lt;snapshot_root&gt;/alpha.0/</p>

<p style="margin-top: 1em">Backup levels must be specified
in the config file in order, from most frequent to least
frequent. The first entry is the one which will be synced
with the backup points. <br>
The subsequent backup levels (e.g., beta, gamma, etc) simply
rotate, with each higher backup level pulling from the one
below it for its .0 directory.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">retain alpha 6</p>

<p style="margin-top: 1em">retain beta 7</p>

<p style="margin-top: 1em">retain gamma 4</p>

<p style="margin-top: 1em">beta.0/ will be moved from
alpha.5/, and gamma.0/ will be moved from beta.6/</p>

<p style="margin-top: 1em">alpha.0/ will be rsynced
directly from the filesystem.</p>

<p style="margin-top: 1em">link_dest 1</p>

<p style="margin-top: 1em">If your version of rsync
supports --link-dest (2.5.7 or newer), you can enable this
to let rsync handle some things that GNU cp or the built-in
subroutines would <br>
otherwise do. Enabling this makes rsnapshot take a slightly
more complicated code branch, but it&rsquo;s the best way to
support special files on non-Linux systems.</p>

<p style="margin-top: 1em">sync_first 1</p>

<p style="margin-top: 1em">sync_first changes the behaviour
of rsnapshot. When this is enabled, all calls to rsnapshot
with various backup levels simply rotate files. All backups
are handled by <br>
calling rsnapshot with the &quot;sync&quot; argument. The
synced files are stored in a &quot;.sync&quot; directory
under the snapshot_root.</p>

<p style="margin-top: 1em">This allows better recovery in
the event that rsnapshot is interrupted in the middle of a
sync operation, since the sync step and rotation steps are
separated. This also <br>
means that you can easily run &quot;rsnapshot sync&quot; on
the command line without fear of forcing all the other
directories to rotate up. This benefit comes at the cost of
one <br>
more snapshot worth of disk space. The default is 0
(off).</p>

<p style="margin-top: 1em">verbose 2</p>

<p style="margin-top: 1em">The amount of information to
print out when the program is run. Allowed values are 1
through 5. The default is 2.</p>

<p style="margin-top: 1em">1 Quiet Show fatal errors only
<br>
2 Default Show warnings and errors <br>
3 Verbose Show equivalent shell commands being executed <br>
4 Extra Verbose Same as verbose, but with more detail <br>
5 Debug All kinds of information</p>

<p style="margin-top: 1em">loglevel 3</p>

<p style="margin-top: 1em">This number means the same thing
as verbose above, but it determines how much data is written
to the logfile, if one is being written.</p>

<p style="margin-top: 1em">logfile /var/log/rsnapshot</p>

<p style="margin-top: 1em">Full filesystem path to the
rsnapshot log file. If this is defined, a log file will be
written, with the amount of data being controlled by
loglevel. If this is commented <br>
out, no log file will be written.</p>

<p style="margin-top: 1em">include [file-name-pattern]</p>

<p style="margin-top: 1em">This gets passed directly to
rsync using the --include directive. This parameter can be
specified as many times as needed, with one pattern defined
per line. See the <br>
rsync(1) man page for the syntax.</p>

<p style="margin-top: 1em">exclude [file-name-pattern]</p>

<p style="margin-top: 1em">This gets passed directly to
rsync using the --exclude directive. This parameter can be
specified as many times as needed, with one pattern defined
per line. See the <br>
rsync(1) man page for the syntax.</p>

<p style="margin-top: 1em">include_file
/path/to/include/file</p>

<p style="margin-top: 1em">This gets passed directly to
rsync using the --include-from directive. See the rsync(1)
man page for the syntax.</p>

<p style="margin-top: 1em">exclude_file
/path/to/exclude/file</p>

<p style="margin-top: 1em">This gets passed directly to
rsync using the --exclude-from directive. See the rsync(1)
man page for the syntax.</p>

<p style="margin-top: 1em">rsync_short_args -a</p>

<p style="margin-top: 1em">List of short arguments to pass
to rsync. If not specified, &quot;-a&quot; is the default.
Please note that these must be all next to each other. For
example, &quot;-az&quot; is valid, <br>
while &quot;-a -z&quot; is not.</p>

<p style="margin-top: 1em">&quot;-a&quot; is rsync&rsquo;s
&quot;archive mode&quot; which tells it to copy as much of
the filesystem metadata as it can for each file. This
specifically does *not* include information about <br>
hard links, as that would greatly increase rsync&rsquo;s
memory usage and slow it down. If you need to preserve hard
links in your backups, then add &quot;H&quot; to this.</p>

<p style="margin-top: 1em">rsync_long_args --delete
--numeric-ids --relative --delete-excluded</p>

<p style="margin-top: 1em">List of long arguments to pass
to rsync. The default values are <br>
--delete --numeric-ids --relative --delete-excluded This
means that the directory structure in each backup point
destination will match that in the backup point <br>
source.</p>

<p style="margin-top: 1em">Quotes are permitted in
rsync_long_args, eg --rsync-path=&quot;sudo
/usr/bin/rsync&quot;. You may use either single (&rsquo;) or
double (&quot;) quotes, but nested quotes (including mixed
<br>
nested quotes) are not permitted. Similar quoting is also
allowed in per-backup-point rsync_long_args.</p>

<p style="margin-top: 1em">ssh_args -p 22</p>

<p style="margin-top: 1em">Arguments to be passed to ssh.
If not specified, the default is none.</p>

<p style="margin-top: 1em">du_args -csh</p>

<p style="margin-top: 1em">Arguments to be passed to du. If
not specified, the default is -csh. GNU du supports -csh,
BSD du supports -csk, Solaris du doesn&rsquo;t support -c at
all. The GNU version is <br>
recommended, since it offers the most features.</p>

<p style="margin-top: 1em">lockfile
/var/run/rsnapshot.pid</p>

<p style="margin-top: 1em">stop_on_stale_lockfile 0</p>

<p style="margin-top: 1em">Lockfile to use when rsnapshot
is run. This prevents a second invocation from clobbering
the first one. If not specified, no lock file is used. Make
sure to use a <br>
directory that is not world writeable for security reasons.
Use of a lock file is strongly recommended.</p>

<p style="margin-top: 1em">If a lockfile exists when
rsnapshot starts, it will try to read the file and stop with
an error if it can&rsquo;t. If it *can* read the file, it
sees if a process exists with <br>
the PID noted in the file. If it does, rsnapshot stops with
an error message. If there is no process with that PID, then
we assume that the lockfile is stale and ignore <br>
it *unless* stop_on_stale_lockfile is set to 1 in which case
we stop.</p>

<p style="margin-top: 1em">stop_on_stale_lockfile defaults
to 0.</p>

<p style="margin-top: 1em">one_fs 1</p>

<p style="margin-top: 1em">Prevents rsync from crossing
filesystem partitions. Setting this to a value of 1 enables
this feature. 0 turns it off. This parameter is optional.
The default is 0 <br>
(off).</p>

<p style="margin-top: 1em">use_lazy_deletes 1</p>

<p style="margin-top: 1em">Changes default behavior of
rsnapshot and does not initially remove the oldest snapshot.
Instead it moves that directory to _delete.[processid] and
continues as normal. <br>
Once the backup has been completed, the lockfile will be
removed before rsnapshot starts deleting the directory.</p>

<p style="margin-top: 1em">Enabling this means that
snapshots get taken sooner (since the delete doesn&rsquo;t
come first), and any other rsnapshot processes are allowed
to start while the final delete <br>
is happening. This benefit comes at the cost of using more
disk space. The default is 0 (off).</p>

<p style="margin-top: 1em">The details of how this works
have changed in rsnapshot version 1.3.1. Originally you
could only ever have one .delete directory per backup level.
Now you can have <br>
many, so if your next (eg) alpha backup kicks off while the
previous one is still doing a lazy delete you may
temporarily have extra _delete directories hanging
around.</p>

<p style="margin-top: 1em">linux_lvm_snapshotsize 2G</p>

<p style="margin-top: 1em">LVM snapshot(s) size (lvcreate
--size option).</p>

<p style="margin-top: 1em">linux_lvm_snapshotname
rsnapshot</p>

<p style="margin-top: 1em">Name to be used when creating
the LVM logical volume snapshot(s) (lvcreate --name
option).</p>

<p style="margin-top: 1em">linux_lvm_vgpath /dev</p>

<p style="margin-top: 1em">Path to the LVM Volume
Groups.</p>

<p style="margin-top: 1em">linux_lvm_mountpath
/mnt/lvm-snapshot</p>

<p style="margin-top: 1em">Mount point to use to
temporarily mount the snapshot(s).</p>

<p style="margin-top: 1em">backup /etc/ localhost/</p>

<p style="margin-top: 1em">backup root@example.com:/etc/
example.com/</p>

<p style="margin-top: 1em">backup
rsync://example.com/path2/ example.com/</p>

<p style="margin-top: 1em">backup /var/ localhost/
one_fs=1</p>

<p style="margin-top: 1em">backup lvm://vg0/home/path2/
lvm-vg0/</p>

<p style="margin-top: 1em">backup_script
/usr/local/bin/backup_pgsql.sh pgsql_backup/</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">backup /etc/ localhost/</p>

<p style="margin-top: 1em">Backs up /etc/ to
&lt;snapshot_root&gt;/&lt;retain&gt;.0/localhost/etc/ using
rsync on the local filesystem</p>

<p style="margin-top: 1em">backup /usr/local/
localhost/</p>

<p style="margin-top: 1em">Backs up /usr/local/ to
&lt;snapshot_root&gt;/&lt;retain&gt;.0/localhost/usr/local/
using rsync on the local filesystem</p>

<p style="margin-top: 1em">backup root@example.com:/etc/
example.com/</p>

<p style="margin-top: 1em">Backs up root@example.com:/etc/
to &lt;snapshot_root&gt;/&lt;retain&gt;.0/example.com/etc/
using rsync over ssh</p>

<p style="margin-top: 1em">backup example.com:/etc/
example.com/</p>

<p style="margin-top: 1em">Same thing but let ssh choose
the remote username (as specified in ~/.ssh/config,
otherwise the same as the local username)</p>

<p style="margin-top: 1em">backup
root@example.com:/usr/local/ example.com/</p>

<p style="margin-top: 1em">Backs up
root@example.com:/usr/local/ to
&lt;snapshot_root&gt;/&lt;retain&gt;.0/example.com/usr/local/
using rsync over ssh</p>

<p style="margin-top: 1em">backup rsync://example.com/pub/
example.com/pub/</p>

<p style="margin-top: 1em">Backs up
rsync://example.com/pub/ to
&lt;snapshot_root&gt;/&lt;retain&gt;.0/example.com/pub/
using an anonymous rsync server. Please note that unlike
backing up local paths and <br>
using rsync over ssh, rsync servers have
&quot;modules&quot;, which are top level directories that
are exported. Therefore, the module should also be specified
in the <br>
destination path, as shown in the example above (the pub/
directory at the end).</p>

<p style="margin-top: 1em">backup /var/ localhost/
one_fs=1</p>

<p style="margin-top: 1em">This is the same as the other
examples, but notice the fourth column. This is how you
specify per-backup-point options to over-ride global
settings. This extra <br>
parameter can take several options, separated by commas.</p>

<p style="margin-top: 1em">It is most useful when
specifying per-backup rsync excludes thus:</p>

<p style="margin-top: 1em">backup root@somehost:/ somehost
+rsync_long_args=--exclude=/var/spool/</p>

<p style="margin-top: 1em">Note the + sign. That tells
rsnapshot to add to the list of arguments to pass to rsync
instead of replacing the list.</p>

<p style="margin-top: 1em">backup lvm://vg0/home/path2/
lvm-vg0/</p>

<p style="margin-top: 1em">Backs up the LVM logical volume
called home, of volume group vg0, to
&lt;snapshot_root&gt;/&lt;interval&gt;.0/lvm-vg0/. Will
create, mount, backup, unmount and remove an LVM <br>
snapshot for each lvm:// entry.</p>

<p style="margin-top: 1em">backup_script
/usr/local/bin/backup_database.sh db_backup/</p>

<p style="margin-top: 1em">In this example, we specify a
script or program to run. This script should simply create
files and/or directories in its current working directory.
rsnapshot will <br>
then take that output and move it into the directory
specified in the third column.</p>

<p style="margin-top: 1em">Please note that whatever is in
the destination directory will be completely deleted and
recreated. For this reason, rsnapshot prevents you from
specifying a <br>
destination directory for a backup_script that will clobber
other backups.</p>

<p style="margin-top: 1em">So in this example, say the
backup_database.sh script simply runs a command like:</p>

<p style="margin-top: 1em">#!/bin/sh</p>

<p style="margin-top: 1em">mysqldump -uusername mydatabase
&gt; mydatabase.sql</p>

<p style="margin-top: 1em">chmod u=r,go= mydatabase.sql #
r-------- (0400)</p>

<p style="margin-top: 1em">rsnapshot will take the
generated &quot;mydatabase.sql&quot; file and move it into
the &lt;snapshot_root&gt;/&lt;retain&gt;.0/db_backup/
directory. On subsequent runs, rsnapshot checks the <br>
differences between the files created against the previous
files. If the backup script generates the same output on the
next run, the files will be hard linked <br>
against the previous ones, and no additional disk space will
be taken up.</p>

<p style="margin-top: 1em">backup_exec ssh root@1.2.3.4
&quot;du -sh /.offsite_backup&quot; optional/ backup_exec
rsync -az /.snapshots/daily.0 root@1.2.3.4:/.offsite_backup/
<br>
required/ backup_exec /bin/true/</p>

<p style="margin-top: 1em">backup_exec simply runs the
command listed. The second argument is not required and
defaults to a value of &rsquo;optional&rsquo;. It specifies
the importance that the command <br>
return 0. Valid values are &rsquo;optional&rsquo; and
&rsquo;required&rsquo;. If the command is specified as
optional, a non-zero exit status from the command will
result in a warning <br>
message being output. If the command is specified as
&rsquo;required&rsquo;, a non-zero exit status from the
command will result in an error message being output and
rsnapshot <br>
itself will exit with a non-zero exit status.</p>

<p style="margin-top: 1em">Remember that tabs must separate
all elements, and that there must be a trailing slash on the
end of every directory.</p>

<p style="margin-top: 1em">A hash mark (#) on the beginning
of a line is treated as a comment.</p>

<p style="margin-top: 1em">Putting it all together (an
example file):</p>

<p style="margin-top: 1em"># THIS IS A COMMENT, REMEMBER
TABS MUST SEPARATE ALL ELEMENTS</p>

<p style="margin-top: 1em">config_version 1.2</p>

<p style="margin-top: 1em">snapshot_root /.snapshots/</p>

<p style="margin-top: 1em">cmd_rsync /usr/bin/rsync <br>
cmd_ssh /usr/bin/ssh <br>
#cmd_cp /bin/cp <br>
cmd_rm /bin/rm <br>
cmd_logger /usr/bin/logger <br>
cmd_du /usr/bin/du</p>

<p style="margin-top: 1em">linux_lvm_cmd_lvcreate
/sbin/lvcreate <br>
linux_lvm_cmd_lvremove /sbin/lvremove <br>
linux_lvm_cmd_mount /bin/mount <br>
linux_lvm_cmd_umount /bin/umount</p>

<p style="margin-top: 1em">linux_lvm_snapshotsize 2G <br>
linux_lvm_snapshotname rsnapshot <br>
linux_lvm_vgpath /dev <br>
linux_lvm_mountpath /mnt/lvm-snapshot</p>

<p style="margin-top: 1em">retain alpha 6 <br>
retain beta 7 <br>
retain gamma 7 <br>
retain delta 3</p>

<p style="margin-top: 1em">backup /etc/ localhost/ <br>
backup /home/ localhost/ <br>
backup_script /usr/local/bin/backup_mysql.sh
mysql_backup/</p>

<p style="margin-top: 1em">backup root@foo.com:/etc/
foo.com/ <br>
backup root@foo.com:/home/ foo.com/ <br>
backup root@mail.foo.com:/home/ mail.foo.com/ <br>
backup rsync://example.com/pub/ example.com/pub/ <br>
backup lvm://vg0/xen-home/ lvm-vg0/xen-home/ <br>
backup_exec echo &quot;backup finished!&quot;</p>

<p style="margin-top: 1em">USAGE <br>
rsnapshot can be used by any user, but for system-wide
backups you will probably want to run it as root.</p>

<p style="margin-top: 1em">Since backups usually get
neglected if human intervention is required, the preferred
way is to run it from cron.</p>

<p style="margin-top: 1em">When you are first setting up
your backups, you will probably also want to run it from the
command line once or twice to get a feel for what it&rsquo;s
doing.</p>

<p style="margin-top: 1em">Here is an example crontab
entry, assuming that backup levels alpha, beta, gamma and
delta have been defined in /etc/rsnapshot.conf</p>

<p style="margin-top: 1em">0 */4 * * *
/usr/local/bin/rsnapshot alpha</p>

<p style="margin-top: 1em">50 23 * * *
/usr/local/bin/rsnapshot beta</p>

<p style="margin-top: 1em">40 23 * * 6
/usr/local/bin/rsnapshot gamma</p>

<p style="margin-top: 1em">30 23 1 * *
/usr/local/bin/rsnapshot delta</p>

<p style="margin-top: 1em">This example will do the
following:</p>

<p style="margin-top: 1em">6 alpha backups a day (once
every 4 hours, at 0,4,8,12,16,20)</p>

<p style="margin-top: 1em">1 beta backup every day, at
11:50PM</p>

<p style="margin-top: 1em">1 gamma backup every week, at
11:40PM, on Saturdays (6th day of week)</p>

<p style="margin-top: 1em">1 delta backup every month, at
11:30PM on the 1st day of the month</p>

<p style="margin-top: 1em">It is usually a good idea to
schedule the larger backup levels to run a bit before the
lower ones. For example, in the crontab above, notice that
&quot;beta&quot; runs 10 minutes before <br>
&quot;alpha&quot;. The main reason for this is that the beta
rotate will pull out the oldest alpha and make that the
youngest beta (which means that the next alpha rotate will
not need to <br>
delete the oldest alpha), which is more efficient. A
secondary reason is that it is harder to predict how long
the lowest backup level will take, since it needs to
actually do <br>
an rsync of the source as well as the rotate that all
backups do.</p>

<p style="margin-top: 1em">If rsnapshot takes longer than
10 minutes to do the &quot;beta&quot; rotate (which usually
includes deleting the oldest beta snapshot), then you should
increase the time between the backup <br>
levels. Otherwise (assuming you have set the lockfile
parameter, as is recommended) your alpha snapshot will fail
sometimes because the beta still has the lock.</p>

<p style="margin-top: 1em">Remember that these are just the
times that the program runs. To set the number of backups
stored, set the retain numbers in /etc/rsnapshot.conf</p>

<p style="margin-top: 1em">To check the disk space used by
rsnapshot, you can call it with the &quot;du&quot;
argument.</p>

<p style="margin-top: 1em">For example:</p>

<p style="margin-top: 1em">rsnapshot du</p>

<p style="margin-top: 1em">This will show you exactly how
much disk space is taken up in the snapshot root. This
feature requires the UNIX du command to be installed on your
system, for it to support the <br>
&quot;-csh&quot; command line arguments, and to be in your
path. You can also override your path settings and the flags
passed to du using the cmd_du and du_args parameters.</p>

<p style="margin-top: 1em">It is also possible to pass a
relative file path as a second argument, to get a report on
a particular file or subdirectory.</p>

<p style="margin-top: 1em">rsnapshot du localhost/home/</p>

<p style="margin-top: 1em">The GNU version of
&quot;du&quot; is preferred. The BSD version works well
also, but does not support the -h flag (use -k instead, to
see the totals in kilobytes). Other versions of
&quot;du&quot;, <br>
such as Solaris, may not work at all.</p>

<p style="margin-top: 1em">To check the differences between
two directories, call rsnapshot with the &quot;diff&quot;
argument, followed by two backup levels or directory
paths.</p>

<p style="margin-top: 1em">For example:</p>

<p style="margin-top: 1em">rsnapshot diff beta.0 beta.1</p>

<p style="margin-top: 1em">rsnapshot diff
beta.0/localhost/etc beta.1/localhost/etc</p>

<p style="margin-top: 1em">rsnapshot diff
/.snapshots/beta.0 /.snapshots/beta.1</p>

<p style="margin-top: 1em">This will call the
rsnapshot-diff program, which will scan both directories
looking for differences (based on hard links).</p>

<p style="margin-top: 1em">rsnapshot sync</p>

<p style="margin-top: 1em">When sync_first is enabled,
rsnapshot must first be called with the sync argument,
followed by the other usual cron entries. The sync should
happen as the lowest, most <br>
frequent backup level, and right before. For example:</p>

<p style="margin-top: 1em">0 */4 * * *
/usr/local/bin/rsnapshot sync &amp;&amp;
/usr/local/bin/rsnapshot alpha</p>

<p style="margin-top: 1em">50 23 * * *
/usr/local/bin/rsnapshot beta</p>

<p style="margin-top: 1em">40 23 1,8,15,22 * *
/usr/local/bin/rsnapshot gamma</p>

<p style="margin-top: 1em">30 23 1 * *
/usr/local/bin/rsnapshot delta</p>

<p style="margin-top: 1em">The sync operation simply runs
rsync and all backup scripts. In this scenario, all calls
simply rotate directories, even the lowest backup level.</p>

<p style="margin-top: 1em">rsnapshot sync [dest]</p>

<p style="margin-top: 1em">When sync_first is enabled, all
sync behaviour happens during an additional sync step (see
above). When using the sync argument, it is also possible to
specify a backup point <br>
destination as an optional parameter. If this is done, only
backup points sharing that destination path will be
synced.</p>

<p style="margin-top: 1em">For example, let&rsquo;s say
that example.com is a destination path shared by one or more
of your backup points.</p>

<p style="margin-top: 1em">rsnapshot sync example.com</p>

<p style="margin-top: 1em">This command will only sync the
files that normally get backed up into example.com. It will
NOT get any other backup points with slightly different
values (like <br>
example.com/etc/, for example). In order to sync
example.com/etc, you would need to run rsnapshot again,
using example.com/etc as the optional parameter.</p>

<p style="margin-top: 1em">rsnapshot configtest</p>

<p style="margin-top: 1em">Do a quick sanity check to make
sure everything is ready to go.</p>

<p style="margin-top: 1em">EXIT VALUES <br>
0 All operations completed successfully</p>

<p style="margin-top: 1em">1 A fatal error occurred</p>

<p style="margin-top: 1em">2 Some warnings occurred, but
the backup still finished</p>

<p style="margin-top: 1em">FILES <br>
/etc/rsnapshot.conf</p>

<p style="margin-top: 1em">SEE ALSO <br>
rsync(1), ssh(1), logger(1), sshd(1), ssh-keygen(1),
perl(1), cp(1), du(1), crontab(1)</p>

<p style="margin-top: 1em">DIAGNOSTICS <br>
Use the -t flag to see what commands would have been
executed. This will show you the commands rsnapshot would
try to run. There are a few minor differences (for example,
not <br>
showing an attempt to remove the lockfile because it
wasn&rsquo;t really created in the test), but should give
you a very good idea what will happen.</p>

<p style="margin-top: 1em">Using the -v, -V, and -D flags
will print increasingly more information to STDOUT.</p>

<p style="margin-top: 1em">Make sure you don&rsquo;t have
spaces in the config file that you think are actually
tabs.</p>

<p style="margin-top: 1em">Much other weird behavior can
probably be attributed to plain old file system permissions
and ssh authentication issues.</p>

<p style="margin-top: 1em">BUGS <br>
Please report bugs (and other comments) to the
rsnapshot-discuss mailing list:</p>


<p style="margin-top: 1em">http://lists.sourceforge.net/lists/listinfo/rsnapshot-discuss</p>

<p style="margin-top: 1em">NOTES <br>
Make sure your /etc/rsnapshot.conf file has all elements
separated by tabs. See /etc/rsnapshot.conf.default for a
working example file.</p>

<p style="margin-top: 1em">Make sure you put a trailing
slash on the end of all directory references. If you
don&rsquo;t, you may have extra directories created in your
snapshots. For more information on how <br>
the trailing slash is handled, see the rsync(1) manpage.</p>

<p style="margin-top: 1em">Make sure to make the snapshot
directory chmod 700 and owned by root (assuming backups are
made by the root user). If the snapshot directory is
readable by other users, they will <br>
be able to modify the snapshots containing their files, thus
destroying the integrity of the snapshots.</p>

<p style="margin-top: 1em">If you would like regular users
to be able to restore their own backups, there are a number
of ways this can be accomplished. One such scenario would
be:</p>

<p style="margin-top: 1em">Set snapshot_root to
/.private/.snapshots in /etc/rsnapshot.conf</p>

<p style="margin-top: 1em">Set the file permissions on
these directories as follows:</p>

<p style="margin-top: 1em">drwx------ /.private</p>

<p style="margin-top: 1em">drwxr-xr-x
/.private/.snapshots</p>

<p style="margin-top: 1em">Export the /.private/.snapshots
directory over read-only NFS, a read-only Samba share,
etc.</p>

<p style="margin-top: 1em">See the rsnapshot HOWTO for more
information on making backups accessible to non-privileged
users.</p>

<p style="margin-top: 1em">For ssh to work unattended
through cron, you will probably want to use public key
logins. Create an ssh key with no passphrase for root, and
install the public key on each <br>
machine you want to backup. If you are backing up system
files from remote machines, this probably means unattended
root logins. Another possibility is to create a second user
on <br>
the machine just for backups. Give the user a different name
such as &quot;rsnapshot&quot;, but keep the UID and GID set
to 0, to give root privileges. However, make logins more
<br>
restrictive, either through ssh configuration, or using an
alternate shell.</p>

<p style="margin-top: 1em">BE CAREFUL! If the private key
is obtained by an attacker, they will have free run of all
the systems involved. If you are unclear on how to do this,
see ssh(1), sshd(1), and <br>
ssh-keygen(1).</p>

<p style="margin-top: 1em">Backup scripts are run as the
same user that rsnapshot is running as. Typically this is
root. Make sure that all of your backup scripts are only
writable by root, and that they <br>
don&rsquo;t call any other programs that aren&rsquo;t owned
by root. If you fail to do this, anyone who can write to the
backup script or any program it calls can fully take over
the <br>
machine. Of course, this is not a situation unique to
rsnapshot.</p>

<p style="margin-top: 1em">By default, rsync transfers are
done using the --numeric-ids option. This means that user
names and group names are ignored during transfers, but the
UID/GID information is kept <br>
intact. The assumption is that the backups will be restored
in the same environment they came from. Without this option,
restoring backups for multiple heterogeneous servers <br>
would be unmanageable. If you are archiving snapshots with
GNU tar, you may want to use the --numeric-owner parameter.
Also, keep a copy of the archived system&rsquo;s /etc/passwd
and <br>
/etc/group files handy for the UID/GID to name mapping.</p>

<p style="margin-top: 1em">If you remove backup points in
the config file, the previously archived files under those
points will permanently stay in the snapshots directory
unless you remove the files <br>
yourself. If you want to conserve disk space, you will need
to go into the &lt;snapshot_root&gt; directory and manually
remove the files from the smallest backup level&rsquo;s
&quot;.0&quot; <br>
directory.</p>

<p style="margin-top: 1em">For example, if you were
previously backing up /home/ with a destination of
localhost/, and alpha is your smallest backup level, you
would need to do the following to reclaim <br>
that disk space:</p>

<p style="margin-top: 1em">rm -rf
&lt;snapshot_root&gt;/alpha.0/localhost/home/</p>

<p style="margin-top: 1em">Please note that the other
snapshots previously made of /home/ will still be using that
disk space, but since the files are flushed out of alpha.0/,
they will no longer be copied <br>
to the subsequent directories, and will thus be removed in
due time as the rotations happen.</p>

<p style="margin-top: 1em">AUTHORS <br>
Mike Rubel -
http://www.mikerubel.org/computers/rsync_snapshots/</p>

<p style="margin-top: 1em">- Created the original shell
scripts on which this project is based</p>

<p style="margin-top: 1em">Nathan Rosenquist
(nathan@rsnapshot.org)</p>

<p style="margin-top: 1em">- Primary author and original
maintainer of rsnapshot.</p>

<p style="margin-top: 1em">David Cantrell
(david@cantrell.org.uk)</p>

<p style="margin-top: 1em">- Previous maintainer of
rsnapshot <br>
- Wrote the rsnapshot-diff utility <br>
- Improved how use_lazy_deletes work so slow deletes
don&rsquo;t screw up the next backup at that backup
level.</p>

<p style="margin-top: 1em">David Keegel
&lt;djk@cybersource.com.au&gt;</p>

<p style="margin-top: 1em">- Previous rsnapshot maintainer
<br>
- Fixed race condition in lock file creation, improved error
reporting <br>
- Allowed remote ssh directory paths starting with
&quot;~/&quot; as well as &quot;/&quot; <br>
- Fixed a number of other bugs and buglets</p>

<p style="margin-top: 1em">Benedikt Heine
&lt;benedikt@heine.rocks&gt;</p>

<p style="margin-top: 1em">- Current rsnapshot
maintainer</p>

<p style="margin-top: 1em">Carl Wilhelm Soderstrom
(chrome@real-time.com)</p>

<p style="margin-top: 1em">- Created the RPM .spec file
which allowed the RPM package to be built, among other
things.</p>

<p style="margin-top: 1em">Ted Zlatanov
(tzz@lifelogs.com)</p>

<p style="margin-top: 1em">- Added the one_fs feature,
autoconf support, good advice, and much more.</p>

<p style="margin-top: 1em">Ralf van Dooren
(r.vdooren@snow.nl)</p>

<p style="margin-top: 1em">- Added and maintains the
rsnapshot entry in the FreeBSD ports tree.</p>

<p style="margin-top: 1em">SlapAyoda</p>

<p style="margin-top: 1em">- Provided access to his
computer museum for software testing.</p>

<p style="margin-top: 1em">Carl Boe
(boe@demog.berkeley.edu)</p>

<p style="margin-top: 1em">- Found several subtle bugs and
provided fixes for them.</p>

<p style="margin-top: 1em">Shane Leibling
(shane@cryptio.net)</p>

<p style="margin-top: 1em">- Fixed a compatibility bug in
utils/backup_smb_share.sh</p>

<p style="margin-top: 1em">Christoph Wegscheider
(christoph.wegscheider@wegi.net)</p>

<p style="margin-top: 1em">- Added (and previously
maintained) the Debian rsnapshot package.</p>

<p style="margin-top: 1em">Bharat Mediratta
(bharat@menalto.com)</p>

<p style="margin-top: 1em">- Improved the exclusion rules
to avoid backing up the snapshot root (among other
things).</p>

<p style="margin-top: 1em">Peter Palfrader
(weasel@debian.org)</p>

<p style="margin-top: 1em">- Enhanced error reporting to
include command line options.</p>

<p style="margin-top: 1em">Nicolas Kaiser
(nikai@nikai.net)</p>

<p style="margin-top: 1em">- Fixed typos in program and man
page</p>

<p style="margin-top: 1em">Chris Petersen -
(http://www.forevermore.net/)</p>

<p style="margin-top: 1em">Added cwrsync permanent-share
support</p>

<p style="margin-top: 1em">Robert Jackson
(RobertJ@promedicalinc.com)</p>

<p style="margin-top: 1em">Added use_lazy_deletes
feature</p>

<p style="margin-top: 1em">Justin Grote
(justin@grote.name)</p>

<p style="margin-top: 1em">Improved rsync error reporting
code</p>

<p style="margin-top: 1em">Anthony Ettinger
(apwebdesign@yahoo.com)</p>

<p style="margin-top: 1em">Wrote the utils/mysqlbackup.pl
script</p>

<p style="margin-top: 1em">Sherman Boyd</p>

<p style="margin-top: 1em">Wrote
utils/random_file_verify.sh script</p>

<p style="margin-top: 1em">William Bear (bear@umn.edu)</p>

<p style="margin-top: 1em">Wrote the utils/rsnapreport.pl
script (pretty summary of rsync stats)</p>

<p style="margin-top: 1em">Eric Anderson
(anderson@centtech.com)</p>

<p style="margin-top: 1em">Improvements to
utils/rsnapreport.pl.</p>

<p style="margin-top: 1em">Alan Batie (alan@batie.org)</p>

<p style="margin-top: 1em">Bug fixes for include_conf</p>

<p style="margin-top: 1em">Dieter Bloms
(dieter@bloms.de)</p>

<p style="margin-top: 1em">Multi-line configuration
options</p>

<p style="margin-top: 1em">Henning Moll
(newsScott@gmx.de)</p>

<p style="margin-top: 1em">stop_on_stale_lockfile</p>

<p style="margin-top: 1em">Ben Low (ben@bdlow.net)</p>

<p style="margin-top: 1em">Linux LVM snapshot support</p>

<p style="margin-top: 1em">COPYRIGHT <br>
Copyright (C) 2003-2005 Nathan Rosenquist</p>

<p style="margin-top: 1em">Portions Copyright (C) 2002-2007
Mike Rubel, Carl Wilhelm Soderstrom, Ted Zlatanov, Carl Boe,
Shane Liebling, Bharat Mediratta, Peter Palfrader, Nicolas
Kaiser, David Cantrell, <br>
Chris Petersen, Robert Jackson, Justin Grote, David Keegel,
Alan Batie, Dieter Bloms, Henning Moll, Ben Low, Anthony
Ettinger</p>

<p style="margin-top: 1em">This man page is distributed
under the same license as rsnapshot: the GPL (see
below).</p>

<p style="margin-top: 1em">This program is free software;
you can redistribute it and/or modify it under the terms of
the GNU General Public License as published by the Free
Software Foundation; either <br>
version 2 of the License, or (at your option) any later
version.</p>

<p style="margin-top: 1em">This program is distributed in
the hope that it will be useful, but WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or
FITNESS FOR A PARTICULAR <br>
PURPOSE. See the GNU General Public License for more
details.</p>

<p style="margin-top: 1em">You should have received a copy
of the GNU General Public License along with this program;
if not, write to the Free Software Foundation, Inc., 51
Franklin Street, Fifth Floor, <br>
Boston, MA 02110-1301 USA</p>

<p style="margin-top: 1em">rsnapshot-tools 2017-02-11
rsnapshot(1)</p>
<hr>
</body>
</html>
