<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>QSF(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">QSF(1)</td>
    <td class="head-vol">User Manuals</td>
    <td class="head-rtitle">QSF(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
qsf - quick spam filter
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
Filtering: <b>qsf</b> [ <i>-snrAtav</i>] [<i>-d DB</i>] [<i>-g DB</i>]
<div>&#x00A0;</div>
<br/>
 [ <i>-L LVL</i>] [<i>-S SUBJ</i>] [<i>-H MARK</i>] [<i>-Q NUM</i>]
<div>&#x00A0;</div>
<br/>
 [ <i>-X NUM</i>]
<div>&#x00A0;</div>
Training: <b>qsf</b> <i>-T SPAM NONSPAM</i> [<i>MAXROUNDS</i>] [<i>-d DB</i>]
<div>&#x00A0;</div>
Retraining: <b>qsf</b> <i>-</i>[<i>m|M</i>] [<i>-d DB</i>] [<i>-w WEIGHT</i>]
  [<i>-ayN</i>]
<div>&#x00A0;</div>
Database: <b>qsf</b> <i>-</i>[<i>p|D|R|O</i>] [<i>-d DB</i>]
<div>&#x00A0;</div>
Database merge: <b>qsf</b> <i>-E OTHERDB</i> [<i>-d DB</i>]
<div>&#x00A0;</div>
Allowlist query: <b>qsf</b> <i>-e EMAIL</i> [<i>-m|-M|-t</i>] [<i>-d DB</i>]
  [<i>-g DB</i>]
<div>&#x00A0;</div>
Denylist query: <b>qsf</b> <i>-y</i> <i>-e EMAIL</i> [<i>-m -m|-M -M|-t</i>]
  [<i>-d DB</i>] [<i>-g DB</i>]
<div>&#x00A0;</div>
Help: <b>qsf</b> <i>-</i>[<i>h|V</i>]
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<b>qsf</b> reads a single email on standard input, and by default outputs it on
  standard output. If the email is determined to be spam, an additional header
  (&quot;X-Spam: YES&quot;) will be added, and optionally the subject line can
  have &quot;[SPAM]&quot; prepended to it.
<div style="height: 1.00em;">&#x00A0;</div>
<b>qsf</b> is intended to be used in a <b>procmail</b>(1) recipe, in a ruleset
  such as this:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<br/>
 :0 wf
<br/>
 | qsf -ra
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 :0 H:
<br/>
 * X-Spam: YES
<br/>
 $HOME/mail/spam</div>
<div style="height: 1.00em;">&#x00A0;</div>
For more examples, including sample <b>procmail</b>(1) recipes, see the
  <b>EXAMPLES</b> section below.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="TRAINING"><a class="selflink" href="#TRAINING">TRAINING</a></h1>
Before <b>qsf</b> can be used properly, it needs to be trained. A good way to
  train <b>qsf</b> is to collect a copy of all your email into two folders - one
  for spam, and one for non-spam. Once you have done this, you can use the
  training function, like this:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<br/>
 qsf -aT spam-folder non-spam-folder</div>
<div style="height: 1.00em;">&#x00A0;</div>
This will generate a database that can be used by <b>qsf</b> to guess whether
  email received in the future is spam or not. Note that this initial training
  run may take a long time, but you should only need to do it once.
<div style="height: 1.00em;">&#x00A0;</div>
To mark a <b>single message</b> as <b>spam</b>, pipe it to <b>qsf</b> with the
  <b>--mark-spam</b> or <b>-m</b> (&quot;mark as spam&quot;) option. This will
  update the database accordingly and discard the email.
<div style="height: 1.00em;">&#x00A0;</div>
To mark a <b>single message</b> as <b>non-spam</b>, pipe it to <b>qsf</b> with
  the <b>--mark-nonspam</b> or <b>-M</b> (&quot;mark as non-spam&quot;) option.
  Again, this will discard the email.
<div style="height: 1.00em;">&#x00A0;</div>
If a message has been mis-tagged, simply send it to <b>qsf</b> as the opposite
  type, i.e. if it has been mistakenly tagged as spam, pipe it into <b>qsf
  --mark-nonspam --weight=2</b> to add it to the non-spam side of the database
  with double the usual weighting.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
The <b>qsf</b> options are listed below.
<dl class="Bl-tag">
  <dt class="It-tag"><b>-d, --database </b><i>[TYPE:]FILE</i></dt>
  <dd class="It-tag">Use <i>FILE</i> as the spam/non-spam database. The default
      is to use <b>/var/lib/qsfdb</b> and, if that is not available or is
      read-only, <b>$HOME/.qsfdb</b>. This option can also be useful if there is
      a system-wide database but you do not want to use it - specifying your own
      here will override the default.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you prefix the filename with a <b>TYPE</b>, of the form
      <b>btree:$HOME/.qsfdb</b>, then this will specify what kind of database
      <b>FILE</b> is, such as <b>list</b>, <b>btree</b>, <b>gdbm</b>,
      <b>sqlite</b> and so on. Check the output of <b>qsf -V</b> to see which
      database backends are available. The default is to auto-detect the type,
      or, if the file does not already exist, use <b>list</b>. Note that
      <b>TYPE</b> is not case-sensitive.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-g, --global </b><i>[TYPE:]FILE</i></dt>
  <dd class="It-tag">Use <i>FILE</i> as the default global database, instead of
      <b>/var/lib/qsfdb</b>. If you also specify a database with <b>-d</b>, then
      this &quot;global&quot; database will be used in read-only mode in
      conjunction with the read-write database specified with <b>-d</b>. The
      <b>-g</b> option can be used a second time to specify a third database,
      which will also be used in read-only mode. Again, the filename can
      optionally be prefixed with a <b>TYPE</b> which specifies the database
      type.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-P, --plain-map </b>FILE</dt>
  <dd class="It-tag">Maintain a mapping of all database tokens to their
      non-hashed counterparts in <i>FILE</i>, one token per line. This can be
      useful if you want to be able to list the contents of your database at a
      later date, for instance to get a list of email addresses in your
      allow-list. Note that using this option may slow <b>qsf</b> down, and only
      entries written to the database while this option is active will be stored
      in <i>FILE</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-s, --subject</b></dt>
  <dd class="It-tag">Rewrite the Subject line of any email that turns out to be
      spam, adding &quot;[SPAM]&quot; to the start of the line.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-S, --subject-marker </b><i>SUBJECT</i></dt>
  <dd class="It-tag">Instead of adding &quot;[SPAM]&quot;, add <b>SUBJECT</b> to
      the Subject line of any email that turns out to be spam. Implies
      <b>-s</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-H, --header-marker </b><i>MARK</i></dt>
  <dd class="It-tag">Instead of setting the X-Spam header to &quot;YES&quot;,
      set it to <b>MARK</b> if email turns out to be spam. This can be useful if
      your email client can only search all headers for a string, rather than
      one particular header (so searching for &quot;YES&quot; might match more
      than just the output of <b>qsf</b>).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-n, --no-header</b></dt>
  <dd class="It-tag">Do not add an X-Spam header to messages.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-r, --add-rating</b></dt>
  <dd class="It-tag">Insert an additional header X-Spam-Rating which is a rating
      of the &quot;spamminess&quot; of a message from 0 to 100; 90 and above are
      counted as spam, anything under 90 is not considered spam. If combined
      with <b>-t</b>, then the rating (0-100) will be output, on its own, on
      standard output.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-A, --asterisk</b></dt>
  <dd class="It-tag">Insert an additional header X-Spam-Level which will contain
      between 0 and 20 asterisks (*), depending on the spam rating.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-t, --test</b></dt>
  <dd class="It-tag">Instead of passing the message out on standard output,
      output nothing, and exit 0 if the message is not spam, or exit 1 if the
      message is spam. If combined with <b>-r</b>, then the spam rating will be
      output on standard output.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-a, --allowlist</b></dt>
  <dd class="It-tag">Enable the allow-list. This causes the email addresses
      given in the message's &quot;From:&quot; and &quot;Return-Path:&quot;
      headers to be checked against a list; if either one matches, then the
      message is always treated as non-spam, regardless of what the token
      database says. When specified with a retraining flag, <b>-a -m</b> (mark
      as spam) will remove that address from the allow-list as well as marking
      the message as spam, and <b>-a -M</b> (mark as non-spam) will add that
      address to the allow-list as well as marking the message as non-spam. The
      idea is that you add all of your friends to the allow-list, and then none
      of their messages ever get marked as spam.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-y, --denylist</b></dt>
  <dd class="It-tag">Enable the deny-list. This causes the email addresses given
      in the message's &quot;From:&quot; and &quot;Return-Path:&quot; headers to
      be checked against a second list; if either one matches, then theh message
      is always treated as spam. Training works in the same way as with
      <b>-a</b>, except that you must specify <b>-m</b> or <b>-M</b> twice to
      modify the deny-list instead of the allow-list, and with the reverse
      syntax: <b>-y -m -m</b> (mark as spam) will add that address to the
      deny-list, whereas <b>-y -M -M</b> (mark as non-spam) will remove that
      address from the deny-list. This double specification is so that the usual
      retraining process never touches the deny-list; the deny-list should be
      carefully maintained rather than automatically generated.
    <div style="height: 1.00em;">&#x00A0;</div>
    Normally you would not need to use the deny-list.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-L, --level, --threshold </b><i>LEVEL</i></dt>
  <dd class="It-tag">Change the spam scoring threshold level which must be
      reached before an email is classified as spam. The default is 90.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-Q, --min-tokens </b><i>NUM</i></dt>
  <dd class="It-tag">Only give a score if more than <b>NUM</b> tokens are found
      in the message - otherwise the message is assumed to be non-spam, and it
      is not modified in any way. The default is 0. This option might be useful
      if you find that very short messages are being frequently
    miscategorised.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-e, --email, --email-only </b><i>EMAIL</i></dt>
  <dd class="It-tag">Query or update the allow-list entry for the email address
      <b>EMAIL</b>. With no other options, this will simply output
      &quot;YES&quot; if <b>EMAIL</b> is in the allow-list, or &quot;NO&quot; if
      it is not. With <b>-t</b>, it will not output anything, but will exit 0
      (success) if <b>EMAIL</b> is in the allow-list, or 1 (failure) if it is
      not. With the <b>-m</b> (mark-spam) option, any previous allow-list entry
      for <b>EMAIL</b> will be removed. Finally, with the <b>-M</b>
      (mark-nonspam) option, <b>EMAIL</b> will be added to the allow-list if it
      is not already on it.
    <div style="height: 1.00em;">&#x00A0;</div>
    If <b>EMAIL</b> is just the word <b>MSG</b> on its own, then an email will
      be read from standard input, and the email addresses given in the
      &quot;From:&quot; and &quot;Return-Path:&quot; headers will be used.
    <div style="height: 1.00em;">&#x00A0;</div>
    Using <b>-e</b> automatically switches on <b>-a</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you also specify <b>-y</b>, then the deny-list will be operated on.
      Remember that <b>-m</b> and <b>-M</b> are reversed with the deny-list.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you specify an email address of the form <b>@domain</b> (nothing before
      the @), then the whole <i>domain</i> will be allow or deny listed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-v, --verbose</b></dt>
  <dd class="It-tag">Add extra <b>X-QSF-Info</b> headers to any filtered email,
      containing error messages and so on if applicable. Specify <b>-v</b> more
      than once to increase verbosity.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-T, --train </b><i>SPAM NONSPAM [MAXROUNDS]</i></dt>
  <dd class="It-tag">Train the database using the two mbox folders <b>SPAM</b>
      and <b>NONSPAM</b>, by testing each message in each folder and updating
      the database each time a message is miscategorised. This is done several
      times, and may take a while to run. Specify the <b>-a</b> (allow-list)
      flag to add every sender in the <b>NONSPAM</b> folder to your allow-list
      as a side-effect of the training process. If <b>MAXROUNDS</b> is
      specified, training will end after this number of rounds if the results
      are still not good enough. The default is a maximum of 200 rounds.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-m, --mark-spam</b></dt>
  <dd class="It-tag">Instead of passing the message out on standard output, mark
      its contents as spam and update the database accordingly. If the
      allow-list <b></b>(<b>-a</b>) is enabled, the message's &quot;From:&quot;
      and &quot;Return-Path:&quot; addresses are removed from the allow-list. If
      the deny-list <b></b>(<b>-y</b>) is enabled and you specify <b>-m</b>
      twice, the message's addresses are added to the deny-list instead.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-M, --mark-nonspam</b></dt>
  <dd class="It-tag">Instead of passing the message out on standard output, mark
      its contents as non-spam and update the database accordingly. If the
      allow-list <b></b>(<b>-a</b>) is enabled, the message's &quot;From:&quot;
      and &quot;Return-Path:&quot; addresses are added to the allow-list (see
      the <b>-a</b> option above). If the deny-list <b></b>(<b>-y</b>) is
      enabled and you specify <b>-M</b> twice, the message's addresses are
      removed from the deny-list instead.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-w, --weight </b><i>WEIGHT</i></dt>
  <dd class="It-tag">When marking as spam or non-spam, update the database with
      a weighting of <b>WEIGHT</b> per token instead of the default of 1. Useful
      when correcting mistakes, eg a message that has been mistakenly detected
      as spam should be marked as non-spam using a weighting of 2, i.e. double
      the usual weighting, to counteract the error.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-D, --dump </b><i>[FILE]</i></dt>
  <dd class="It-tag">Dump the contents of the database as a platform-independent
      text file, suitable for archival, transfer to another machine, and so on.
      The data is output on stdout or into the given <b>FILE</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-R, --restore </b><i>[FILE]</i></dt>
  <dd class="It-tag">Rebuild the database from scratch from the text file on
      stdin. If a <b>FILE</b> is given, data is read from there instead of from
      stdin.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-O, --tokens</b></dt>
  <dd class="It-tag">Instead of filtering, output a list of the tokens found in
      the message read from standard input, along with the number of times each
      token was found. This is only useful if you want to use <b>qsf</b> as a
      general tokeniser for use with another filtering package.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-E, --merge </b><i>OTHERDB</i></dt>
  <dd class="It-tag">Merge the <b>OTHERDB</b> database into the current
      database. This can be useful if you want to take one user's mailbox and
      merge it into the system-wide one, for instance (this would be done by, as
      root, doing <b>qsf -d /var/lib/qsfdb -E /home/user/.qsfdb</b> and then
      removing <b>/home/user/.qsfdb</b>).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-B, --benchmark </b><i>SPAM NONSPAM [MAXROUNDS]</i></dt>
  <dd class="It-tag">Benchmark the training process using the two mbox folders
      <b>SPAM</b> and <b>NONSPAM</b>. A temporary database is created and
      trained using the first 75% of the messages in each folder, and then the
      entire contents of each folder is tested to see how many false positives
      and false negatives occur. Some timing information is also displayed.
    <div style="height: 1.00em;">&#x00A0;</div>
    This can be used to decide which backend is best on your system. Use
      <b>-d</b> to select a backend, eg <b>qsf -B spam nonspam -d GDBM</b> -
      this will create a temporary database which is removed afterwards.
    <div style="height: 1.00em;">&#x00A0;</div>
    The exception to this is the MySQL backend, where a full database
      specification must be given <b></b>(<b>-d
      MySQL:database=db;host=localhost;...</b>) and the database table given
      will not be wiped beforehand or dropped afterwards.
    <div style="height: 1.00em;">&#x00A0;</div>
    As with <b>-T</b>, if <b>MAXROUNDS</b> is specified, training will never be
      done for more than this number of rounds; the default is 200.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-h, --help</b></dt>
  <dd class="It-tag">Print a usage message on standard output and exit
      successfully.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-V, --version</b></dt>
  <dd class="It-tag">Print version information, including a list of available
      database backends, on standard output and exit successfully.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="DEPRECATED_OPTIONS"><a class="selflink" href="#DEPRECATED_OPTIONS">DEPRECATED
  OPTIONS</a></h1>
The following options are only for use with the old binary tree database backend
  or old databases that haven't been upgraded to the new format that came in
  with version 1.1.0.
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-N, --no-autoprune</b></dt>
  <dd class="It-tag">When marking as spam or nonspam, never automatically prune
      the database. Usually the database is pruned after every 500 marks; if you
      would rather <b>--prune</b> manually, use <b>-N</b> to disable automatic
      pruning.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-p, --prune</b></dt>
  <dd class="It-tag">Remove redundant entries from the database and clean it up
      a little. This is automatically done after several calls to
      <b>--mark-spam</b> or <b>--mark-nonspam</b>, and during training with
      <b>--train</b> if the training takes a large number of rounds, so it
      should rarely be necessary to use <b>--prune</b> manually unless you are
      using <b>-N</b> / <b>--no-autoprune</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-X, --prune-max </b><i>NUM</i></dt>
  <dd class="It-tag">When the database is being pruned, no more than <b>NUM</b>
      entries will be considered for removal. This is to prevent CPU and memory
      resources being taken over. The default is 100,000 but in some
      circumstances (if you find that pruning takes too long) this option may be
      used to reduce it to a more manageable number.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="FILES"><a class="selflink" href="#FILES">FILES</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>/var/lib/qsfdb</b></dt>
  <dd class="It-tag">The default (system-wide) spam database. If you wish to
      install <b>qsf</b> system-wide, this should be read-only to everyone;
      there should be one user with write access who can update the spam
      database with <b>qsf --mark-spam</b> and <b>qsf --mark-non-spam</b> when
      necessary.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>/var/lib/qsfdb2</b></dt>
  <dd class="It-tag">A second, read-only, system-wide database. This can be
      useful when installing <b>qsf</b> system-wide and using third-party spam
      databases; the first global database can be updated with system-specific
      changes, and this second database can be periodically updated when the
      third-party spam database is updated.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>$HOME/.qsfdb</b></dt>
  <dd class="It-tag">The default spam database for per-user data. Users without
      write access to the system-wide database will have their data written
      here, and the two databases will be read together. The per-user database
      will be given a weighting equivalent to 10 times the weighting of the
      global database.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
Currently, you cannot use <b>qsf</b> to check for spam while the database is
  being updated. This means that while an update is in progress, all email is
  passed through as non-spam.
<div style="height: 1.00em;">&#x00A0;</div>
There is an upper size limit of 512Kb on incoming email; anything larger than
  this is just passed through as non-spam, to avoid tying up machine resources.
<div style="height: 1.00em;">&#x00A0;</div>
The plaintext token mapping maintained by <b>--plain-map</b> will never shrink,
  only grow. It is intended for use by housekeeping and user interface scripts
  that, for instance, the user can use to list all email addresses on their
  allow-list. These scripts should take care of weeding out entries for tokens
  that are no longer in the database. If you have no such scripts, there is
  probably no point in using <b>--plain-map</b> anyway.
<div style="height: 1.00em;">&#x00A0;</div>
Avoid using the deny-list <b></b>(<b>-y</b>) in any automated retraining, as it
  can be cause the filter to reject mail unnecessarily. In general the deny-list
  is probably best left unused unless explicitly required by your particular
  setup.
<div style="height: 1.00em;">&#x00A0;</div>
If both the allow-list and the deny-list are enabled, then email addresses will
  first be checked against the deny-list, then the allow-list, then the domain
  of the email address will be checked for matching &quot;@domain&quot; entries
  in the deny-list and then in the allow-list.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
To filter all of your mail through <b>qsf</b>, with the allow-list enabled and
  the &quot;spam rating&quot; header being added, add this to your
  <b>.procmailrc</b> file:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<br/>
 :0 wf
<br/>
 | qsf -ra</div>
<div style="height: 1.00em;">&#x00A0;</div>
If you want <b>qsf</b> to add &quot;[SPAM]&quot; to the subject line of any
  messages it thinks are spam, do this instead:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<br/>
 :0 wf
<br/>
 | qsf -sra</div>
<div style="height: 1.00em;">&#x00A0;</div>
To automatically mark any email sent to <b>spambox@yourdomain.com</b> as spam
  (this is the &quot;naive&quot; version):
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<br/>
 :0 H
<br/>
 * ^To:.*spambox@yourdomain.com
<br/>
 | qsf -am</div>
<div style="height: 1.00em;">&#x00A0;</div>
To do the same, but cleverly, so that only email to
  <b>spambox@yourdomain.com</b> which <b>qsf</b> does NOT already classify as
  spam gets marked as spam in the database (this stops the database getting too
  heavily weighted):
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<br/>
 # If sent to spambox@yourdomain.com:
<br/>
 :0
<br/>
 * ^To:.*spambox@yourdomain.com
<br/>
 {
<br/>
 :0 wf
<br/>
 | qsf -a
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 # The above two lines can be skipped if you've
<br/>
 # already piped the message through qsf.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 # If the qsf database says it's not spam,
<br/>
 # mark it as spam!
<br/>
 :0 H
<br/>
 * ^X-Spam: NO
<br/>
 | qsf -am
<br/>
 }</div>
<div style="height: 1.00em;">&#x00A0;</div>
Remove the <b>-a</b> option in the above examples if you don't want to use the
  allow-list.
<div style="height: 1.00em;">&#x00A0;</div>
A more complicated filtering example - this will only run <b>qsf</b> on messages
  which don't have a subject line saying &quot;your &lt;something&gt; is on
  fire&quot; and which don't have a sender address ending in
  &quot;@foobar.com&quot;, meaning that messages with that subject line OR that
  sender address will NEVER be marked as spam, no matter what:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<br/>
 :0 wf
<br/>
 * ! ^Subject: Your .* is on fire
<br/>
 * ! ^From: .*@foobar.com
<br/>
 | qsf -ra</div>
<div style="height: 1.00em;">&#x00A0;</div>
For more on <b>procmail</b>(1) recipes, see the <b>procmailrc</b>(5) and
  <b>procmailex</b>(5) manual pages.
<div style="height: 1.00em;">&#x00A0;</div>
A couple of macros to add to your <b>.muttrc</b> file, if you use <b>mutt</b>(1)
  as a mail user agent:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<br/>
 # Press F5 to mark a message as spam and delete it
<br/>
 macro index &lt;f5&gt; &quot;&lt;pipe-message&gt;qsf
  -am\n&lt;delete-message&gt;&quot;
<br/>
 macro pager &lt;f5&gt; &quot;&lt;pipe-message&gt;qsf
  -am\n&lt;delete-message&gt;&quot;
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 # Press F9 to mark a message as non-spam
<br/>
 macro index &lt;f9&gt; &quot;&lt;pipe-message&gt;qsf -aM\n&quot;
<br/>
 macro pager &lt;f9&gt; &quot;&lt;pipe-message&gt;qsf -aM\n&quot;</div>
<div style="height: 1.00em;">&#x00A0;</div>
Again, remove the <b>-a</b> option in the above examples if you don't want to
  use the allow-list.
<div style="height: 1.00em;">&#x00A0;</div>
Note, however, that the above macros won't work when operating on multiple
  tagged messages. For that, you'd need something like this:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<br/>
 macro index &lt;f5&gt; &quot;:set
  pipe_split\n&lt;tag-prefix&gt;&lt;pipe-message&gt;qsf
  -am\n&lt;tag-prefix&gt;&lt;delete-message&gt;\n:unset pipe_split\n&quot;</div>
<div style="height: 1.00em;">&#x00A0;</div>
If you use <b>qmail</b>(7), then to get <b>procmail</b> working with it you will
  need to put a line containing just <b>DEFAULT=./Maildir/</b> at the top of
  your <b>~/.procmailrc</b> file, so that <b>procmail</b> delivers to your
  Maildir folder instead of trying to deliver to /var/spool/mail/$USER, and you
  will need to put this in your <b>~/.qmail</b> file:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<br/>
 | preline procmail</div>
<div style="height: 1.00em;">&#x00A0;</div>
This will cause all your mail to be delivered via <b>procmail</b> instead of
  being delivered directly into your mail directory.
<div style="height: 1.00em;">&#x00A0;</div>
See the <b>qmail</b>(7) documentation for more about mail delivery with qmail.
<div style="height: 1.00em;">&#x00A0;</div>
If you use <b>postfix</b>(1), you can set up a system-wide mail filter by
  creating a user account for the purpose of filtering mail, populating that
  account's <b>.qsfdb</b>, and then creating a shell script, to run as that
  user, which runs <b>qsf</b> on stdin and passes stdout to <b>sendmail</b>(8).
<div style="height: 1.00em;">&#x00A0;</div>
Doing this requires some knowledge of <b>postfix</b> configuration and care
  needs to be taken to avoid mail loops. One <b>qsf</b> user's full HOWTO is
  included in the <b>doc/</b> directory with this package.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="THE_ALLOW-LIST"><a class="selflink" href="#THE_ALLOW-LIST">THE
  ALLOW-LIST</a></h1>
A feature called the &quot;allow-list&quot; can be switched on by specifying the
  <b>--allowlist</b> or <b>-a</b> option. This causes messages'
  &quot;From:&quot; and &quot;Return-Path:&quot; addresses to be checked against
  a list of people you have said to allow all messages from, and if a message's
  &quot;From:&quot; or &quot;Return-Path:&quot; address is in the list, it is
  never marked as spam. This means you can add all your friends to an
  &quot;allow-list&quot; and <b>qsf</b> will then never mis-file their messages
  - a quick way to do this is to use <b>-a</b> with <b>-T</b> (train); everyone
  in your non-spam folder who has sent you an email will be added to the
  allow-list automatically during training.
<div style="height: 1.00em;">&#x00A0;</div>
You can manually add and remove addresses to and from the allow-list using the
  <b>-e</b> (email) option. For instance, to add <b>foo@bar.com</b> to the
  allow-list, do this:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<br/>
 qsf -e foo@bar.com -M</div>
<div style="height: 1.00em;">&#x00A0;</div>
To remove <b>bad@nasty.com</b> from the allow-list, do this:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<br/>
 qsf -e bad@nasty.com -m</div>
<div style="height: 1.00em;">&#x00A0;</div>
And to see whether <b>someone@somewhere.com</b> is in the allow-list or not,
  just do this:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<br/>
 qsf -e someone@somewhere.com</div>
<div style="height: 1.00em;">&#x00A0;</div>
In general, you probably always want to enable the allow-list, so always specify
  the <b>-a</b> option when using <b>qsf</b>. This will automatically maintain
  the allow-list based on what you classify as spam or non-spam.
<div style="height: 1.00em;">&#x00A0;</div>
The only times you might want to turn it off are when people on your allow-list
  are prone to getting viruses or if a virus is causing email to be sent to you
  that is pretending to be from someone on your allow-list.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="BACKUP_AND_RESTORE"><a class="selflink" href="#BACKUP_AND_RESTORE">BACKUP
  AND RESTORE</a></h1>
Because the database format is platform-specific, it is a good idea to
  periodically dump the database to a text file using <b>qsf -D</b> so that, if
  necessary, it can be transferred to another machine and restored with <b>qsf
  -R</b> later on.
<div style="height: 1.00em;">&#x00A0;</div>
Also note that since the actual contents of email messages are never stored in
  the database (see <b>TECHNICAL DETAILS</b>), you can safely share your
  <b>qsf</b> database with friends - simply dump your database to a file, like
  this:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<br/>
 qsf -D &gt; your-database-dump.txt</div>
<div style="height: 1.00em;">&#x00A0;</div>
Once you have sent <b>your-database-dump.txt</b> to another person, they can do
  this:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<br/>
 qsf -R &lt; your-database-dump.txt</div>
<div style="height: 1.00em;">&#x00A0;</div>
They will then have an identical database to yours.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="TECHNICAL_DETAILS"><a class="selflink" href="#TECHNICAL_DETAILS">TECHNICAL
  DETAILS</a></h1>
When a message is passed to <b>qsf</b>, any attachments are decoded, all HTML
  elements are removed, and the message text is then broken up into
  &quot;tokens&quot;, where a &quot;token&quot; is a single word or URL. Each
  token is hashed using the MD5 algorithm (see below for why), and that hash is
  then used to look up each token in the <b>qsf</b> database.
<div style="height: 1.00em;">&#x00A0;</div>
For full details of which parts of an email (headers, body, attachments, etc)
  are used to calculate the spam rating, see the <b>TOKENISATION</b> section
  below.
<div style="height: 1.00em;">&#x00A0;</div>
Within the database, each token has two numbers associated with it: the number
  of times that token has been seen in spam, and the number of times it has been
  seen in non-spam. These two numbers, along with the total number of spam and
  non-spam messages seen, are then used to give a &quot;spamminess&quot; value
  for that particular token. This &quot;spamminess&quot; value ranges from
  &quot;definitely not spammy&quot; at one end of the scale, through
  &quot;neutral&quot; in the middle, up to &quot;definitely spammy&quot; at the
  other end.
<div style="height: 1.00em;">&#x00A0;</div>
Once a &quot;spamminess&quot; value has been calculated for all of the tokens in
  the message, a summary calculation is made to give an overall &quot;is this
  spam?&quot; probability rating for the message. If the overall probability is
  0.9 or above, the message is flagged as spam.
<div style="height: 1.00em;">&#x00A0;</div>
In addition to the probability test is the &quot;allow-list&quot;. If enabled
  (with the <b>-a</b> option), the whole probability check is skipped if the
  sender of the message is listed in the allow-list, and the message is not
  marked as spam.
<div style="height: 1.00em;">&#x00A0;</div>
When training the database, a message is split up into tokens as described
  above, and then the numbers in the database for each token are simply added
  to: if you tell <b>qsf</b> that a message is spam, it adds one to the
  &quot;number of times seen in spam&quot; counter for each token, and if you
  tell it a message is not spam, it adds one to the &quot;number of times seen
  in non-spam&quot; counter for each token. If you specify a weight, with
  <b>-w</b>, then the number you specify is added instead of one.
<div style="height: 1.00em;">&#x00A0;</div>
To stop the database growing uncontrollably, the database keeps track of when a
  token was last used. Underused tokens are automatically removed from the
  database. (The old method was to &quot;prune&quot; every 500 updates).
<div style="height: 1.00em;">&#x00A0;</div>
Finally, the reason MD5 hashes were used is privacy. If the actual tokens from
  the messages, and the actual email addresses in the allow-list, were stored,
  you could not share a single <b>qsf</b> database between multiple users
  because bits of everyone's messages would be in the database - things like
  emailed passwords, keywords relating to personal gossip, and so on. So a hash
  is stored instead. A hash is a &quot;one-way&quot; function; it is easy to
  turn a token into a hash but very hard (some might say impossible) to turn a
  hash back into the token that created it. This means that you end up with a
  database with no personal information in it.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="TOKENISATION"><a class="selflink" href="#TOKENISATION">TOKENISATION</a></h1>
When a message is broken up into tokens, various parts of the message are
  treated in different ways.
<div style="height: 1.00em;">&#x00A0;</div>
First, all header fields are discarded, except for the important ones:
  <b>From</b>, <b>Return-Path</b>, <b>Sender</b>, <b>To</b>, <b>Reply-To</b>,
  and <b>Subject</b>.
<div style="height: 1.00em;">&#x00A0;</div>
Next, any MIME-encoded attachments are decoded. Any attachments whose MIME type
  starts with &quot;text/&quot; (i.e. HTML and text) are tokenised, after having
  any HTML tags stripped. Any non-textual attachments are replaced with their
  MD5 hash (such that two identical attachments will have the same hash), and
  that hash is then used as a token.
<div style="height: 1.00em;">&#x00A0;</div>
In addition to single-word tokens from textual message parts, <b>qsf</b> adds
  doubled-up tokens so that word pairs get added to the database. This makes the
  database a bit bigger (although the automatic pruning tends to take care of
  that) but makes matching more exact.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="SPECIAL_FILTERS"><a class="selflink" href="#SPECIAL_FILTERS">SPECIAL
  FILTERS</a></h1>
As well as using the textual content of email to detect spam, <b>qsf</b> also
  uses special filters which create &quot;pseudo-tokens&quot; based on various
  rules. This means that specific patterns, not just individual words, can be
  used to determine whether a message is spam or not.
<div style="height: 1.00em;">&#x00A0;</div>
For example, if a message contains lots of words with multiple consonants, like
  &quot;ashjkbnxcsdjh&quot;, then each time a word like that is seen the special
  token &quot;.GIBBERISH-CONSONANTS.&quot; is added to the list of tokens found
  in the message. If it turns out that most messages with words that trigger
  this filter rule are spam, then other messages with gibberish consonant
  strings will be more likely to be flagged as spam.
<div style="height: 1.00em;">&#x00A0;</div>
Currently the special filters are:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>GTUBE</b></dt>
  <dd class="It-tag">Flags any message containing the string
      <b>XJS*C4JDBQADN1.NSBN3*2IDNEN*GTUBE-STANDARD-ANTI-UBE-TEST-EMAIL*C.34X</b>
      as spam - useful for testing that your <b>qsf</b> installation is
    working.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>ATTACH-SCR</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>ATTACH-PIF</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>ATTACH-EXE</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>ATTACH-VBS</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>ATTACH-VBA</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>ATTACH-LNK</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>ATTACH-COM</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>ATTACH-BAT</b></dt>
  <dd class="It-tag">Adds a token for every attachment whose filename ends in
      &quot;.scr&quot;, &quot;.pif&quot;, &quot;.exe&quot;, &quot;.vbs&quot;,
      &quot;.vba&quot;, &quot;.lnk&quot;, &quot;.com&quot;, and &quot;.bat&quot;
      respectively (these are often viruses).
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>ATTACH-GIF</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>ATTACH-JPG</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>ATTACH-PNG</b></dt>
  <dd class="It-tag">Adds a token for every attachment whose filename ends in
      &quot;.gif&quot;, &quot;.jpg&quot; or &quot;.jpeg&quot;, and
      &quot;.png&quot; respectively.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>ATTACH-DOC</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>ATTACH-XLS</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>ATTACH-PDF</b></dt>
  <dd class="It-tag">Adds a token for every attachment whose filename ends in
      &quot;.doc&quot;, &quot;.xls&quot;, or &quot;.pdf&quot; respectively
      (these tend to indicate a non-spam email).
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>SINGLE-IMAGE</b></dt>
  <dd class="It-tag">Adds a token if the message contains exactly one attached
      image.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>MULTIPLE-IMAGES</b></dt>
  <dd class="It-tag">Adds a token if the message contains more than one attached
      image.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>GIBBERISH-CONSONANTS</b></dt>
  <dd class="It-tag">Adds a token for every word found that has multiple
      consonants in a row, as described above. Spam often contains strings of
      gibberish.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>GIBBERISH-VOWELS</b></dt>
  <dd class="It-tag">Adds a token for every word found that has multiple vowels
      in a row, eg &quot;aeaiaiaeeio&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>GIBBERISH-FROMCONS</b></dt>
  <dd class="It-tag">Like <b>GIBBERISH-CONSONANTS</b>, but only for the
      &quot;From:&quot; and &quot;Return-Path:&quot; addresses on their
    own.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>GIBBERISH-FROMVOWL</b></dt>
  <dd class="It-tag">Like <b>GIBBERISH-VOWELS</b>, but only for the
      &quot;From:&quot; and &quot;Return-Path:&quot; addresses on their
    own.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>GIBBERISH-BADSTART</b></dt>
  <dd class="It-tag">Adds a token for every word that starts with a bad
      character such as %.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>GIBBERISH-HYPHENS</b></dt>
  <dd class="It-tag">Adds a token for every word with more than three hyphens or
      underscores in it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>GIBBERISH-LONGWORDS</b></dt>
  <dd class="It-tag">Adds a token for every word with over 30 characters in it
      (but less than 60).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTML-COMMENTS-IN-WORDS</b></dt>
  <dd class="It-tag">Adds a token for every HTML comment found in the middle of
      a word. Spam often contains HTML inside words, like this:
      w&lt;!--dsgfhsdgjgh--&gt;ord</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTML-EXTERNAL-IMG</b></dt>
  <dd class="It-tag">Adds a token for every HTML &lt;img&gt; (image) tag found
      that contains :// (i.e. it refers to an external image).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTML-FONT</b></dt>
  <dd class="It-tag">Adds a token for every HTML &lt;font&gt; tag found.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTML-IP-IN-URLS</b></dt>
  <dd class="It-tag">Adds a token for every URL found containing an IP
    address.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTML-INT-IN-URL</b></dt>
  <dd class="It-tag">Adds a token for every URL found containing an integer in
      its hostname.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTML-URLENCODED-URL</b></dt>
  <dd class="It-tag">Adds a token for every URL found containing a % sign in its
      hostname.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
Normally, filters will just cause a token to be added, and these tokens are
  processed by the normal weighting algorithm. However the <b>GTUBE</b> filter
  will immediately flag any matching message as spam, bypassing the token
  matching.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="DATABASE_BACKENDS"><a class="selflink" href="#DATABASE_BACKENDS">DATABASE
  BACKENDS</a></h1>
The inbuilt &quot;list&quot; database backend will not necessarily provide the
  best performance, but is provided because using it requires no external
  libraries.
<div style="height: 1.00em;">&#x00A0;</div>
If, when <b>qsf</b> was compiled, the correct libraries were available, then it
  will be possible to use <b>qsf</b> with alternative database backends. To find
  out which backends you have available, run <b>qsf -V</b> (capital V) and read
  the second line of output. To see how well a backend performs, collect some
  spam and non-spam and use <b>qsf -d BACKEND -B SPAM NONSPAM</b> (see the entry
  for <b>-B</b> above).
<div style="height: 1.00em;">&#x00A0;</div>
Some people find that they get the best performance out of the <b>gdbm</b>
  backend; this is a library that is widely available on many systems.
<div style="height: 1.00em;">&#x00A0;</div>
To efficiently share a <b>qsf</b> database across multiple machines, you may
  find the MySQL backend useful. However, using it is a little more complicated.
<div style="height: 1.00em;">&#x00A0;</div>
To use the MySQL backend you will need to create a table with the fields
  <i>key1</i>, <i>key2</i>, <i>token</i>, <i>value1</i>, <i>value2</i> and
  <i>value3</i>. The <i>token</i>, <i>value1</i>, <i>value2</i>, and
  <i>value3</i> fields must be <b>VARCHAR(64)</b>, <b>BIGINT</b> or <b>INT</b>,
  and <b>BIGINT</b> or <b>INT</b> respectively, and indexing on the <i>token</i>
  field is a good idea. The <i>key1</i> and <i>key2</i> fields can be anything,
  but they must be present.
<div style="height: 1.00em;">&#x00A0;</div>
For example:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<br/>
 USE mydatabase;
<br/>
 CREATE TABLE qsfdb (
<br/>
 key1 BIGINT UNSIGNED NOT NULL,
<br/>
 key2 BIGINT UNSIGNED NOT NULL,
<br/>
 token VARCHAR(64) DEFAULT '' NOT NULL,
<br/>
 value1 INT UNSIGNED NOT NULL,
<br/>
 value2 INT UNSIGNED NOT NULL,
<br/>
 value3 INT UNSIGNED NOT NULL,
<br/>
 PRIMARY KEY (key1,key2,token),
<br/>
 KEY (key1),
<br/>
 KEY (key2),
<br/>
 KEY (token)
<br/>
 );</div>
<div style="height: 1.00em;">&#x00A0;</div>
The <i>key1</i> and <i>key2</i> fields allow you to have multiple <b>qsf</b>
  databases in one table, by specifying different <i>key1</i> and <i>key2</i>
  values on invocation.
<div style="height: 1.00em;">&#x00A0;</div>
Instead of specifying a database file with the <b>--database</b> / <b>-d</b>
  option, you must specify either a specification string as described below, or
  the name of a file containing such a string on its first line.
<div style="height: 1.00em;">&#x00A0;</div>
The specification string is as follows:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">
<br/>
 database=DATABASE;host=HOST;port=PORT;
<br/>
 user=USER;pass=PASS;table=TABLE;
<br/>
 key1=KEY1;key2=KEY2</div>
<div style="height: 1.00em;">&#x00A0;</div>
This string must be all on one line, with no spaces.
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>DATABASE</b></dt>
  <dd class="It-tag">is the name of the MySQL database.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>HOST</b></dt>
  <dd class="It-tag">is the hostname of the database server (eg
      &quot;localhost&quot;).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>PORT</b></dt>
  <dd class="It-tag">is the TCP port to connect on (eg 3306).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>USER</b></dt>
  <dd class="It-tag">is the username to connect with.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>PASS</b></dt>
  <dd class="It-tag">is the password to connect with.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>TABLE</b></dt>
  <dd class="It-tag">is the database table to use. If a table with this name
      does not exist when <b>qsf</b> is called in update or training mode, then
      it will be created if permissions allow this to be done.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>KEY1</b></dt>
  <dd class="It-tag">is the value to use for the <i>key1</i> field.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>KEY2</b></dt>
  <dd class="It-tag">is the value to use for the <i>key2</i> field.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
Since command lines can be seen in the process list, it is probably best to
  specify a filename (eg <b>qsf -d mysql:qsfdb.spec</b>) and put the
  specification string inside that file.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="TROUBLESHOOTING"><a class="selflink" href="#TROUBLESHOOTING">TROUBLESHOOTING</a></h1>
If you have problems with <b>qsf</b>, please check the list below; if this does
  not help, go to the <b>qsf</b> home page and investigate the mailing lists, or
  email the author.
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Nothing is being marked as spam.</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    First, use the <b>-r</b> option to switch on the <b>X-Spam-Rating</b>
      header, and check that this header appears in email passed through
      <b>qsf</b>. If it does not, then it is likely that <b>qsf</b> is not being
      run at all - check your configuration of <b>procmail</b>(1) or its
      equivalent.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b> </b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    If you are seeing <b>X-Spam-Rating</b> headers, and different emails have
      different scores, then you may simply need to retrain your database a
      little more. Take more spam email and pass it to <b>qsf -m</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b> </b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    If you are seeing <b>X-Spam-Rating</b> headers but they all give the same
      spam rating, then the most likely reason is that <b>qsf</b> is not reading
      any database. Make sure that whatever is processing the email has read
      permissions on <b>/var/lib/qsfdb</b> and/or <b>~/.qsfdb</b> - and make
      sure that, if you are using <b>~/.qsfdb</b>, what your database creator
      thought was <b>~</b> (<b>$HOME</b>) is the same as it is for whatever is
      processing the email.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Retraining sometimes takes a very long time.</b></dt>
  <dd class="It-tag">With the <b>obtree</b> backend or 2-column MySQL or SQLite
      tables, every 500th retrain <b></b>(<b>-m</b> or <b>-M</b>), the database
      is pruned. On some systems this may take some time, and during this time
      the database is locked (except when using the MySQL or SQLite backends).
      If you constantly do a lot of retraining and want to avoid this, then use
      the <b>-N</b> option to suppress auto-pruning, and then have a
      <b>cron</b>(8) job or something run a manual prune <b></b>(<b>qsf -p</b>)
      every now and again.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Running qsf from procmail fails with an error.</b></dt>
  <dd class="It-tag">If you can run <b>qsf</b> from the command line, but in
      your <b>procmail</b> log file you get errors about &quot;qsf: cannot
      execute binary file&quot;, then contact your system administrator for
      help. It may be that incoming email is handled by a different server to
      the one you normally shell into, and either they are of a different
      architecture or operating system, or the mail server is not permitted to
      execute user-owned binaries.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="ACKNOWLEDGEMENTS"><a class="selflink" href="#ACKNOWLEDGEMENTS">ACKNOWLEDGEMENTS</a></h1>
The following people have contributed suggestions, comments, patches, and
  testing:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">Tom Parker
  <i></i>&lt;<i>http://www.bits.bris.ac.uk/palfrey/</i>&gt;
<div>&#x00A0;</div>
Dr Kelly A. Parker
<div>&#x00A0;</div>
Vesselin Mladenov <i></i>&lt;<i>http://www.antipodes.bg/</i>&gt;
<div>&#x00A0;</div>
Glyn Faulkner
<div>&#x00A0;</div>
Mark Reynolds
<div>&#x00A0;</div>
Sam Roberts
<div>&#x00A0;</div>
Scott Allen
<div>&#x00A0;</div>
Karsten Kankowski
<div>&#x00A0;</div>
M. Kolbl
<div>&#x00A0;</div>
Micha Holzmann
<div>&#x00A0;</div>
Jef Poskanzer <i></i>&lt;<i>http://www.acme.com/jef/</i>&gt;
<div>&#x00A0;</div>
Clemens Fischer <i></i>&lt;<i>http://ino-waiting.gmxhome.de/</i>&gt;
<div>&#x00A0;</div>
Nelson A. de Oliveira
<div>&#x00A0;</div>
Michal Vitecek
<div>&#x00A0;</div>
Tommy Pettersson <i></i>&lt;<i>http://www.lysator.liu.se/~ptp/</i>&gt;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
The author:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;">Andrew Wood &lt;andrew.wood@ivarch.com&gt;
<div>&#x00A0;</div>
<i>http://www.ivarch.com/</i></div>
<div style="height: 1.00em;">&#x00A0;</div>
Project home page:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 5.00ex;"><i>http://www.ivarch.com/programs/qsf/</i></div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
If you find any bugs, please contact the author, either by email or by using the
  contact form on the web site.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>procmail</b>(1), <b>procmailrc</b>(5), <b>procmailex</b>(5)
<div style="height: 1.00em;">&#x00A0;</div>
Someone has written a guide to using <b>qsf</b> with KMail that can be found at:
<div>&#x00A0;</div>
http://www.softwaredesign.co.uk/Information.SpamFilters.html
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="LICENSE"><a class="selflink" href="#LICENSE">LICENSE</a></h1>
This is free software, distributed under the ARTISTIC 2.0 license.</div>
<table class="foot">
  <tr>
    <td class="foot-date">August 2007</td>
    <td class="foot-os">Linux</td>
  </tr>
</table>
</body>
</html>
