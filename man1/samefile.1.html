<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>SAMEFILE(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">SAMEFILE(1)</td>
    <td class="head-vol">JS</td>
    <td class="head-rtitle">SAMEFILE(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
samefile - find identical files
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>samefile [-g size] [-l | -r] [-s sep] [-0aiqVvx]</b>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<b>samefile</b> reads a list of filenames (one filename per line) from stdin.
  For each filename pair with identical contents, a line consisting of six
  fields is output: The size in bytes, two filenames, the character ``='' if the
  two files are on the same device, ``X'' otherwise, and the link counts of the
  two files. The output is sorted in reverse order by size as the primary key
  and the filenames as the secondary key.
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-0</b></dt>
  <dd class="It-tag">Indicates that the input list of file names is NUL
      terminated, for example as generated by implementations of <b>find</b>(1)
      that support the <b>-print0</b> option. Without this option, the file
      names are assumed to be newline terminated.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-a</b></dt>
  <dd class="It-tag">Do not sort files with same size alphabetically.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-g size</b></dt>
  <dd class="It-tag">Compare only files with size greater than <i>size</i>
      bytes. Default is 0.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-i</b></dt>
  <dd class="It-tag">Allow files with the same device/i-node pair to be added to
      the binary tree. This might be useful if output will be fed into some
      other program. If this option is used, the statistics displayed when using
      <b>-v</b> will not contain the ``You have a total of x bytes in identical
      files'' line because <b>-i</b> prohibits proper calculation of this
    value.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-l</b></dt>
  <dd class="It-tag">Do not check if files with identical contents are hard
      links created by <b>ln</b>(1). By default, <b>samefile</b> checks if files
      with identical contents are hard linked and, if they are, does not write a
      name pair to stdout. A slight speedup is gained when using this option.
      This option is incompatible with the <b>-r</b> option.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-q</b></dt>
  <dd class="It-tag">Do not issue warning messages when <b>open</b>(2) fails.
      When you encounter such a warning, <b>open</b> probably failed due to a
      'permission denied' error on files or directories for which you have no
      read permission. Useful if you are not root and want to compare your files
      against files in a system directory like <i>/etc</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-r</b></dt>
  <dd class="It-tag">Report whether identical files are hard linked. The
      separator string followed by the [bracketed] link count is appended to
      each name pair if they are hard links created with <b>ln</b>. This option
      is incompatible with the <b>-l</b> option. Note that this kind of output
      has only four fields and will appear unsorted before the actual output of
      <b>samefile</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-s&#x00A0;sep</b></dt>
  <dd class="It-tag">Use string <b>sep</b> as the output field separator,
      defaults to a tab character. Useful if filenames contain tab characters
      and output must be processed by another program, say <b>awk</b>(1).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-V</b></dt>
  <dd class="It-tag">Print the version information and exit.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-v</b></dt>
  <dd class="It-tag">verbose mode. Write some statistical messages about memory
      usage and work reduction as well as the sum of the sizes of all identical
      files to stderr.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-x</b></dt>
  <dd class="It-tag">Switch off intelligence. This option prevents
      <b>samefile</b> from being smart. If files <i>file1, file2</i> and
      <i>file3</i> are identical, it will do 3 comparisons instead of just the
      two needed and write more output. See the discussion under INTERNALS why
      this could be useful. If this option is used, the statistics displayed
      when using <b>-v</b> will not contain the ``You have a total of x bytes in
      identical files'' line because <b>-x</b> prohibits proper calculation of
      this value.</dd>
</dl>
<h1 class="Sh" title="Sh" id="INTERNALS"><a class="selflink" href="#INTERNALS">INTERNALS</a></h1>
<b>samefile</b> uses two stages to give optimum performance.
<div style="height: 1.00em;">&#x00A0;</div>
In the first stage, all non-plain files are skipped (directories, devices,
  FIFOs, sockets, symbolic links) as well as files for which <b>stat</b>(2)
  fails and files that have a size less than or equal to <i>size.</i> Output of
  the first stage (the filenames) is written into a binary tree with one node
  for every file size. It is also at this early stage where checks for hard
  links are done. If hard links are found, and <b>-r</b> is requested, the name
  pairs are output immediately. The whole list of hard linked name pairs will
  therefore appear before any output of the second stage.
<div style="height: 1.00em;">&#x00A0;</div>
For any i-node only one filename will be added to the binary tree (unless
  <b>-i</b> was requested.)
<div style="height: 1.00em;">&#x00A0;</div>
In the second stage all files having the same size are compared against each
  other. The rules of mathematical logic are applied to reduce work and output
  noise (unless <b>-x</b> is requested): if files a, b, and c have the same size
  and <b>samefile</b> finds that a = b and a = c then it will not compare b
  against c (and will not output a line for b and c) but only for a = b and a =
  c. Note however, that because only the first filename per i-node gets into the
  second stage, the output for a group of identical files with different i-node
  numbers is also minimized. Suppose you have six identical files of size 100 in
  an i-node group consisting of the three i-nodes with numbers 10, 20 and 30
  (the term 'i-node group' has nothing to do with the i-node group notion of
  some file systems - it merely refers to a set of i-nodes addressing files with
  identical contents):
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ ls -i
   10 file1     20 file4     30 file6
   10 file2     20 file5
   10 file3
$ ls | samefile
100     file1   file4   =       3       2
100     file1   file6   =       3       1
</pre>
<div style="height: 1.00em;">&#x00A0;</div>
The sum of the sizes in the first column is the amount of disk space you could
  gain by making all 6 files links to only one file or remove all but one of the
  files. To be precise, disk space is allocated in blocks - you will probably
  gain two blocks here, rather than 200 bytes. Note that it is not enough to
  just remove file4 and file6 (you would gain only 100 bytes because file5 still
  exists.) The proper way is to use the -i option. The output will look like
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
100     file1   file2   =       3       3
100     file1   file3   =       3       3
100     file1   file4   =       3       2
100     file1   file5   =       3       2
100     file1   file6   =       3       1
</pre>
<div style="height: 1.00em;">&#x00A0;</div>
Removing all files listed in the third field will leave only file1. Making all
  files hard links to file1 is easy. If the fourth field is a ``='' do a forced
  hard link. If you need to know about <i>all</i> combinations of identical
  files, then you use both the <b>-i</b> and <b>-x</b> option. This produces
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ ls | samefile -ix
100     file1   file2   =       3       3
100     file1   file3   =       3       3
100     file1   file4   =       3       2
100     file1   file5   =       3       2
100     file1   file6   =       3       1
100     file2   file3   =       3       3
100     file2   file4   =       3       2
100     file2   file5   =       3       2
100     file2   file6   =       3       1
100     file3   file4   =       3       2
100     file3   file5   =       3       2
100     file3   file6   =       3       1
100     file4   file5   =       2       2
100     file4   file6   =       2       1
100     file5   file6   =       2       1
</pre>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
Find all identical files in the current working directory:
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ ls | samefile
</pre>
<div style="height: 1.00em;">&#x00A0;</div>
Find all identical files in my HOME directory and subdirectories and also tell
  me if there are hard links:
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ find $HOME -type f | samefile -r
</pre>
<div style="height: 1.00em;">&#x00A0;</div>
Find all identical files in the <i>/usr</i> directory tree that are bigger than
  10000 bytes and write the result to <i>usr.dups</i> (that one is for the
  sysadmin folks, you may want to 'amp' - put it in the background with the
  ampersand &amp; - this command because it takes a few minutes.)
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ find /usr -type f | samefile -g 10000 &gt;usr.dups
</pre>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="DIAGNOSTICS"><a class="selflink" href="#DIAGNOSTICS">DIAGNOSTICS</a></h1>
You will see a short usage message if you use an invalid option.
<dl class="Bl-tag">
  <dt class="It-tag">malloc - free = xxxx</dt>
  <dd class="It-tag">I didn't free the memory I've <b>malloc</b>(3)ed. You found
      a bug. Please report it to the author.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Allocation failed for 'expr' ...</dt>
  <dd class="It-tag">Oops! You ran out of virtual memory. You must have a real
      big filename list. Try to use a smaller one or increase resources
      available to your processes. For more information see <b>ulimit</b>(1) or
      your similar shell builtin.</dd>
</dl>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>ln</b>(1), <b>find</b>(1), <b>rm</b>(1), <b>df</b>(1)
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
There are no known bugs. The source has been <b>lint</b>(1)ed and all possible
  care has been taken while coding. If you find a bug (or miss a feature) please
  contact the author.
<h1 class="Sh" title="Sh" id="HOME"><a class="selflink" href="#HOME">HOME</a></h1>
The official <b>samefile</b> home page www.schweikhardt.net/samefile/ is
  maintained by the author Jens Schweikhardt - schweikh at schweikhardt dot
  net</div>
<table class="foot">
  <tr>
    <td class="foot-date">7 AUGUST 2005</td>
    <td class="foot-os"></td>
  </tr>
</table>
</body>
</html>
