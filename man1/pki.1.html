<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:31:44 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>pki(1) PKI Command-Line Interface (CLI) pki(1)</p>

<p style="margin-top: 1em">NAME <br>
pki - Command-Line Interface for accessing Certificate
System services.</p>

<p style="margin-top: 1em">SYNOPSIS <br>
pki [CLI options] &lt;command&gt; [command arguments]</p>

<p style="margin-top: 1em">DESCRIPTION <br>
The pki command provides a command-line interface allowing
clients to access various services on the Certificate System
server. These services include certificates, groups, <br>
keys, security domains, and users.</p>

<p style="margin-top: 1em">CLI OPTIONS <br>
-c &lt;client security database password&gt; <br>
Specifies the client security database password (mutually
exclusive to the &rsquo;-C&rsquo; option).</p>

<p style="margin-top: 1em">-C &lt;client-side password
file&gt; <br>
Specifies the file which contains the client security
database password (mutually exclusive to the
&rsquo;-c&rsquo; option).</p>

<p style="margin-top: 1em">-d &lt;client security database
location&gt; <br>
Specifies the client security database location (default:
~/.dogtag/nssdb).</p>

<p style="margin-top: 1em">-h &lt;hostname&gt; <br>
Specifies the hostname (default: hostname of the local
machine).</p>

<p style="margin-top: 1em">--help Prints additional help
information.</p>

<p style="margin-top: 1em">--ignore-cert-status
&lt;list&gt; <br>
Comma-separated list of ignored certificate validity
statuses.</p>

<p style="margin-top: 1em">--message-format &lt;format&gt;
<br>
Message format: xml (default), json.</p>

<p style="margin-top: 1em">-n &lt;client certificate
nickname&gt; <br>
Specifies the nickname for client certificate authentication
(mutually exclusive to the &rsquo;-u&rsquo; option). This
authentication requires a security database password.</p>

<p style="margin-top: 1em">--output &lt;folder&gt; <br>
Folder to store HTTP messages.</p>

<p style="margin-top: 1em">-P &lt;protocol&gt; <br>
Specifies the protocol (default: http).</p>

<p style="margin-top: 1em">-p &lt;port&gt; <br>
Specifies the port (default: 8080).</p>

<p style="margin-top: 1em">--reject-cert-status
&lt;list&gt; <br>
Comma-separated list of rejected certificate validity
statuses. PKI subsystem type - [CA, KRA, OCSP, TKS, or TPS]
(non-case-sensitive).</p>

<p style="margin-top: 1em">-U &lt;URI&gt; <br>
Specifies the server URI.</p>

<p style="margin-top: 1em">-u &lt;username&gt; <br>
Specifies the username for basic authentication (mutually
exclusive to the &rsquo;-n&rsquo; option). This
authentication requires a user password.</p>

<p style="margin-top: 1em">-v Displays verbose
information.</p>

<p style="margin-top: 1em">--version <br>
Displays CLI version information.</p>

<p style="margin-top: 1em">-w &lt;password&gt; <br>
Specifies the user password (mutually exclusive to the
&rsquo;-W&rsquo; option).</p>

<p style="margin-top: 1em">-W &lt;client-side password
file&gt; <br>
Specifies the file which contains the user password
(mutually exclusive to the &rsquo;-w&rsquo; option).</p>

<p style="margin-top: 1em">OPERATIONS <br>
To view available commands and options, simply type pki.
Some commands have sub-commands. To view the sub-commands,
type pki &lt;command&gt;. To view each command&rsquo;s
usage, type pki <br>
&lt;command&gt; --help.</p>

<p style="margin-top: 1em">A client security database is
needed to execute commands that require SSL connection or
client certificate for authentication. See pki-client(1) for
more information.</p>

<p style="margin-top: 1em">Connection <br>
By default, the CLI connects to a server running on the
local machine via the non-secure HTTP port 8080. To specify
a different server location, use the appropriate arguments
to <br>
give a different host (-h), port (-p), or connection
protocol (-P).</p>

<p style="margin-top: 1em">pki -P &lt;protocol&gt; -h
&lt;hostname&gt; -p &lt;port&gt; &lt;command&gt;</p>

<p style="margin-top: 1em">Alternatively, the connection
parameters can be specified as a URI:</p>

<p style="margin-top: 1em">pki -U &lt;URI&gt;
&lt;command&gt;</p>

<p style="margin-top: 1em">where the URI is of the format
&lt;protocol&gt;://&lt;hostname&gt;:&lt;port&gt;.</p>

<p style="margin-top: 1em">Authentication <br>
Some commands require authentication. These are commands
that are restricted to particular sets of users (such as
agents or admins) or those operations involving certificate
pro&acirc; <br>
files that require authentication.</p>

<p style="margin-top: 1em">To execute a command without
authentication:</p>

<p style="margin-top: 1em">pki &lt;command&gt;</p>

<p style="margin-top: 1em">To execute a command using basic
authentication (i. e. - username/password), see the Basic
Authentication section of this man page.</p>

<p style="margin-top: 1em">To execute a command using
client authentication (i. e. - client certificate), see the
Client Authentication section of this man page.</p>

<p style="margin-top: 1em">Basic Authentication <br>
To authenticate with a username and password:</p>

<p style="margin-top: 1em">pki -u &lt;username&gt; -w
&lt;password&gt; &lt;command&gt;</p>

<p style="margin-top: 1em">Rather than being exposed in
plaintext on the command-line, user passwords may be stored
in a file instead. See Client-side Password Files for
detailed information.</p>

<p style="margin-top: 1em">To authenticate with a username
by obtaining the user password from a client-side password
file:</p>

<p style="margin-top: 1em">pki -u &lt;username&gt; -W
&lt;client-side password file&gt; &lt;command&gt;</p>

<p style="margin-top: 1em">Finally, if a username has been
specified on the command-line, and neither the &rsquo;-W
&lt;client-side password file&gt;&rsquo; nor the &rsquo;-w
&lt;password&gt;&rsquo; options have been utilized, the
password <br>
will be prompted for.</p>

<p style="margin-top: 1em">To authenticate with a username
by interactively prompting for a password:</p>

<p style="margin-top: 1em">pki -u &lt;username&gt;
&lt;command&gt;</p>

<p style="margin-top: 1em">Note: Prompting for a user
password is not suitable for automated batch processing.</p>

<p style="margin-top: 1em">Client Authentication Setup <br>
A client certificate associated with the desired PKI server
must be used for client authentication. This can be done by
importing the client certificate into an NSS security <br>
database and passing the values to the relevant options
provided by the pki CLI framework.</p>

<p style="margin-top: 1em">To achieve this, execute the
following commands to set up an NSS security database for
use by the pki client, import the client certificate into
the NSS database, and list infor&acirc; <br>
mation (including the nickname of the client certificate)
stored in the NSS database:</p>

<p style="margin-top: 1em">- certutil -N -d
&lt;CERT_DB_DIR_PATH&gt;</p>

<p style="margin-top: 1em">- pk12util -i
&lt;Agent_Cert_P12_FILE_PATH&gt; -d
&lt;CERT_DB_DIR_PATH&gt;</p>

<p style="margin-top: 1em">- certutil -L -d
&lt;CERT_DB_DIR_PATH&gt;</p>

<p style="margin-top: 1em">The first command creates a
client security database, and asks the client user to enter
a password for this NSS database.</p>

<p style="margin-top: 1em">The second command imports a
client certificate stored in a PKCS12 format into this NSS
database; it prompts for the passwords of the PKCS12 file
and the client security data&acirc; <br>
base. The simplist example of such a client certificate is
to obtain the administrator certificate created during the
configuration portion of the basic PKI installation of the
<br>
associated PKI server (e. g. - located at
/root/.dogtag/pki-tomcat/ca_admin_cert.p12 on the PKI server
machine).</p>

<p style="margin-top: 1em">The third command shows the
information about the imported client certificate (including
its nickname).</p>

<p style="margin-top: 1em">Note: When issuing the first pki
command using the authentication parameters (after
completion of the setup of the client security database), a
user may be greeted with a warning <br>
message which indicates that an untrusted issuer was
encountered. Simply reply &rsquo;Y&rsquo; to import the CA
certificate, and, presuming that the displayed CA server URL
is valid, press <br>
the carriage return.</p>

<p style="margin-top: 1em">Client Authentication <br>
To authenticate with a client certificate:</p>

<p style="margin-top: 1em">pki -d &lt;client security
database location&gt; -c &lt;client security database
password&gt; -n &lt;client certificate nickname&gt;
&lt;command&gt;</p>

<p style="margin-top: 1em">Alternatively, to prevent
exposure via the command-line, a client security database
may store their password in a file instead. See Client-side
Password Files for detailed infor&acirc; <br>
mation.</p>

<p style="margin-top: 1em">To authenticate with a client
certificate by obtaining the client security database
password from a client-side password file:</p>

<p style="margin-top: 1em">pki -d &lt;client security
database location&gt; -C &lt;client-side password file&gt;
-n &lt;client certificate nickname&gt; &lt;command&gt;</p>

<p style="margin-top: 1em">Finally, if a client certificate
has been specified on the command-line, and neither the
&rsquo;-C &lt;client-side password file&gt;&rsquo; nor the
&rsquo;-c &lt;client security database password&gt;&rsquo;
options <br>
have been utilized, the client security database password
will be prompted for.</p>

<p style="margin-top: 1em">To authenticate with a client
certificate by interactively prompting for a client security
database password:</p>

<p style="margin-top: 1em">pki -d &lt;client security
database location&gt; -n &lt;client certificate nickname&gt;
&lt;command&gt;</p>

<p style="margin-top: 1em">Note: Prompting for a client
security database password is not suitable for automated
batch processing.</p>

<p style="margin-top: 1em">Client-side Password Files <br>
Both the &rsquo;-C&rsquo; (client authentication) and the
&rsquo;-W&rsquo; (basic authentication) options require the
use of a client-side password file.</p>

<p style="margin-top: 1em">For security purposes,
client-side password files should be, at a minimum,
operating system protected non-world readable files.</p>

<p style="margin-top: 1em">Client-side password files
generally store a password in an equals-sign-delimited
plaintext format &rsquo;token=password&rsquo; (e. g. -
&rsquo;internal=foobar&rsquo; where &rsquo;internal&rsquo;
is the token, &rsquo;=&rsquo; <br>
is the delimiter, and &rsquo;foobar&rsquo; is the actual
password). The token keyword &rsquo;internal&rsquo; is the
default specification for a token, and refers to the
&quot;Internal Key Storage Token&quot;. <br>
If a client-side password file is being used for the sole
purposes of the pki command-line tool, a client-side
password file also supports the format that merely consists
of the <br>
plaintext password on a single line (read the Caveats which
follow).</p>

<p style="margin-top: 1em">Caveats:</p>

<p style="margin-top: 1em">&Acirc;&middot; Since
client-side password files are allowed to use the
&rsquo;token=password&rsquo; format, the first
&rsquo;=&rsquo; character can only be used as a delimiter
(i. e. - it cannot be used as a <br>
valid character within the &rsquo;token&rsquo; name) as
escaping the &rsquo;=&rsquo; character within a token is not
supported.</p>

<p style="margin-top: 1em">&Acirc;&middot; When specifying
a password which contains an &rsquo;=&rsquo; character,
always specify an initial &rsquo;=&rsquo; prior to
specifying the actual password (mandatory when no token has
been spec&acirc; <br>
ified) as escaping the &rsquo;=&rsquo; character within a
password is not supported.</p>

<p style="margin-top: 1em">&Acirc;&middot; Tokens do not
support leading or trailing whitespace since these
characters are stripped prior to their use; however, all
whitespace inside tokens will be preserved.</p>

<p style="margin-top: 1em">&Acirc;&middot; Passwords
preserve all leading, trailing, and internal whitespace
since passwords are not trimmed prior to their use.</p>

<p style="margin-top: 1em">&Acirc;&middot; TBD: Supply code
to handle the case of a non-internal token (e. g. -
&rsquo;hardware-nethsm&rsquo; utilized in the following
examples) since the current code ignores the specified <br>
token (i. e. - it always utilizes the default
&rsquo;internal&rsquo; token no matter what is currently
specified).</p>

<p style="margin-top: 1em">&Acirc;&middot; TBD: Allow
numerous &rsquo;token=password&rsquo; lines in a single
client-side password file to support the ability to
authenticate against specified tokens as well as multiple
<br>
tokens.</p>

<p style="margin-top: 1em">Valid examples include:</p>

<p style="margin-top: 1em">internal=foobar <br>
where: token=&quot;internal&quot;,
password=&quot;foobar&quot;</p>

<p style="margin-top: 1em">hardware-nethsm=foobar <br>
where: token=&quot;hardware-nethsm&quot; (ignored - TBD),
password=&quot;foobar&quot;</p>

<p style="margin-top: 1em">internal=ack=bar <br>
where: token=&quot;internal&quot;,
password=&quot;ack=bar&quot;</p>

<p style="margin-top: 1em">hardware-nethsm=ack=bar <br>
where: token=&quot;hardware-nethsm&quot; (ignored - TBD),
password=&quot;ack=bar&quot;</p>

<p style="margin-top: 1em">=foobar <br>
where: token=&quot;internal&quot; (default),
password=&quot;foobar&quot;</p>

<p style="margin-top: 1em">=foo=bar <br>
where: token=&quot;internal&quot; (default),
password=&quot;foo=bar&quot; <br>
(Since the password contains an &rsquo;=&rsquo; character,
<br>
an initial &rsquo;=&rsquo; character must be specified!)</p>

<p style="margin-top: 1em">foobar <br>
where: token=&quot;internal&quot; (default),
password=&quot;foobar&quot;</p>

<p style="margin-top: 1em">Results Paging <br>
Some commands (e.g. cert-find) may return multiple results.
Since the number of results may be large, the results are
split into multiple pages. By default the command will <br>
return only the first page (e.g. the first 20 results). To
retrieve results from another page, additional paging
parameters can be specified:</p>

<p style="margin-top: 1em">* start: index of the first
result to return (default: 0) <br>
* size: number of results to return (default: 20)</p>

<p style="margin-top: 1em">For example, to retrieve the
first page (index #0-#19):</p>

<p style="margin-top: 1em">pki cert-find --start 0 --size
20</p>

<p style="margin-top: 1em">To retrieve the second page
(index #20-#39):</p>

<p style="margin-top: 1em">pki cert-find --start 20 --size
20</p>

<p style="margin-top: 1em">To retrieve the third page
(index #40-#59):</p>

<p style="margin-top: 1em">pki cert-find --start 40 --size
20</p>

<p style="margin-top: 1em">FILES <br>
/usr/bin/pki</p>

<p style="margin-top: 1em">SEE ALSO <br>
pki-cert(1) <br>
Certificate management commands</p>

<p style="margin-top: 1em">pki-client(1) <br>
Client security database management commands</p>

<p style="margin-top: 1em">pki-group(1) <br>
Group management commands</p>

<p style="margin-top: 1em">pki-group-member(1) <br>
Group member management commands</p>

<p style="margin-top: 1em">pki-key(1) <br>
Key management commands</p>

<p style="margin-top: 1em">pki-securitydomain(1) <br>
Security domain management commands</p>

<p style="margin-top: 1em">pki-user(1) <br>
User management commands</p>

<p style="margin-top: 1em">pki-user-cert(1) <br>
User certificate management commands</p>

<p style="margin-top: 1em">pki-user-membership(1) <br>
User membership management commands</p>

<p style="margin-top: 1em">pki-ca-profile(1) <br>
Profile management commands</p>

<p style="margin-top: 1em">AUTHORS <br>
Ade Lee &lt;alee@redhat.com&gt;, Endi Dewata
&lt;edewata@redhat.com&gt;, and Matthew Harmsen
&lt;mharmsen@redhat.com&gt;.</p>

<p style="margin-top: 1em">COPYRIGHT <br>
Copyright (c) 2012 Red Hat, Inc. This is licensed under the
GNU General Public License, version 2 (GPLv2). A copy of
this license is available at
http://www.gnu.org/licenses/old- <br>
licenses/gpl-2.0.txt.</p>

<p style="margin-top: 1em">version 10.2 May 5, 2014
pki(1)</p>
<hr>
</body>
</html>
