<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>pki(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">pki(1)</td>
    <td class="head-vol">PKI Command-Line Interface (CLI)</td>
    <td class="head-rtitle">pki(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
pki - Command-Line Interface for accessing Certificate System services.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>pki</b> [CLI options] &lt;command&gt; [command arguments]
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
The <b>pki</b> command provides a command-line interface allowing clients to
  access various services on the Certificate System server. These services
  include certificates, groups, keys, security domains, and users.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="CLI_OPTIONS"><a class="selflink" href="#CLI_OPTIONS">CLI
  OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-c &lt;client security database password&gt;</b></dt>
  <dd class="It-tag">Specifies the client security database password (mutually
      exclusive to the '-C' option).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-C &lt;client-side password file&gt;</b></dt>
  <dd class="It-tag">Specifies the file which contains the client security
      database password (mutually exclusive to the '-c' option).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-d &lt;client security database location&gt;</b></dt>
  <dd class="It-tag">Specifies the client security database location (default:
      <i>~/.dogtag/nssdb</i>).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-h &lt;hostname&gt;</b></dt>
  <dd class="It-tag">Specifies the hostname (default: hostname of the local
      machine).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--help</b></dt>
  <dd class="It-tag">Prints additional help information.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ignore-cert-status &lt;list&gt;</b></dt>
  <dd class="It-tag">Comma-separated list of ignored certificate validity
      statuses.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--message-format &lt;format&gt;</b></dt>
  <dd class="It-tag">Message format: xml (default), json.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-n &lt;client certificate nickname&gt;</b></dt>
  <dd class="It-tag">Specifies the nickname for client certificate
      authentication (mutually exclusive to the '-u' option). This
      authentication requires a security database password.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--output &lt;folder&gt;</b></dt>
  <dd class="It-tag">Folder to store HTTP messages.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-P &lt;protocol&gt;</b></dt>
  <dd class="It-tag">Specifies the protocol (default: http).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-p &lt;port&gt;</b></dt>
  <dd class="It-tag">Specifies the port (default: 8080).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--reject-cert-status &lt;list&gt;</b></dt>
  <dd class="It-tag">Comma-separated list of rejected certificate validity
      statuses. PKI subsystem type - [CA, KRA, OCSP, TKS, or TPS]
      (non-case-sensitive).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-U &lt;URI&gt;</b></dt>
  <dd class="It-tag">Specifies the server URI.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-u &lt;username&gt;</b></dt>
  <dd class="It-tag">Specifies the username for basic authentication (mutually
      exclusive to the '-n' option). This authentication requires a user
      password.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-v</b></dt>
  <dd class="It-tag">Displays verbose information.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--version</b></dt>
  <dd class="It-tag">Displays CLI version information.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-w &lt;password&gt;</b></dt>
  <dd class="It-tag">Specifies the user password (mutually exclusive to the '-W'
      option).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-W &lt;client-side password file&gt;</b></dt>
  <dd class="It-tag">Specifies the file which contains the user password
      (mutually exclusive to the '-w' option).
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="OPERATIONS"><a class="selflink" href="#OPERATIONS">OPERATIONS</a></h1>
To view available commands and options, simply type <b>pki</b>. Some commands
  have sub-commands. To view the sub-commands, type <b>pki &lt;command&gt;</b>.
  To view each command's usage, type <b> pki &lt;command&gt; --help</b>.
<div style="height: 1.00em;">&#x00A0;</div>
A client security database is needed to execute commands that require SSL
  connection or client certificate for authentication. See <b>pki-client</b>(1)
  for more information.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Connection"><a class="selflink" href="#Connection">Connection</a></h2>
By default, the CLI connects to a server running on the local machine via the
  non-secure HTTP port 8080. To specify a different server location, use the
  appropriate arguments to give a different host ( <b>-h</b>), port (<b>-p</b>),
  or connection protocol ( <b>-P</b>).
<div style="height: 1.00em;">&#x00A0;</div>
<b>pki -P &lt;protocol&gt; -h &lt;hostname&gt; -p &lt;port&gt;
  &lt;command&gt;</b>
<div style="height: 1.00em;">&#x00A0;</div>
Alternatively, the connection parameters can be specified as a URI:
<div style="height: 1.00em;">&#x00A0;</div>
<b>pki -U &lt;URI&gt; &lt;command&gt;</b>
<div style="height: 1.00em;">&#x00A0;</div>
where the URI is of the format
  <i>&lt;protocol&gt;://&lt;hostname&gt;:&lt;port&gt;</i>.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Authentication"><a class="selflink" href="#Authentication">Authentication</a></h2>
Some commands require authentication. These are commands that are restricted to
  particular sets of users (such as agents or admins) or those operations
  involving certificate profiles that require authentication.
<div style="height: 1.00em;">&#x00A0;</div>
To execute a command without authentication:
<div style="height: 1.00em;">&#x00A0;</div>
<b>pki &lt;command&gt;</b>
<div style="height: 1.00em;">&#x00A0;</div>
To execute a command using basic authentication (i. e. - username/password), see
  the <b>Basic Authentication</b> section of this man page.
<div style="height: 1.00em;">&#x00A0;</div>
To execute a command using client authentication (i. e. - client certificate),
  see the <b>Client Authentication</b> section of this man page.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Basic_Authentication"><a class="selflink" href="#Basic_Authentication">Basic
  Authentication</a></h2>
To authenticate with a username and password:
<div style="height: 1.00em;">&#x00A0;</div>
<b>pki -u &lt;username&gt; -w &lt;password&gt; &lt;command&gt;</b>
<div style="height: 1.00em;">&#x00A0;</div>
Rather than being exposed in plaintext on the command-line, user passwords may
  be stored in a file instead. See <b>Client-side Password Files</b> for
  detailed information.
<div style="height: 1.00em;">&#x00A0;</div>
To authenticate with a username by obtaining the user password from a
  client-side password file:
<div style="height: 1.00em;">&#x00A0;</div>
<b>pki -u &lt;username&gt; -W &lt;client-side password file&gt;
  &lt;command&gt;</b>
<div style="height: 1.00em;">&#x00A0;</div>
Finally, if a username has been specified on the command-line, and neither the
  '-W &lt;client-side password file&gt;' nor the '-w &lt;password&gt;' options
  have been utilized, the password will be prompted for.
<div style="height: 1.00em;">&#x00A0;</div>
To authenticate with a username by interactively prompting for a password:
<div style="height: 1.00em;">&#x00A0;</div>
<b>pki -u &lt;username&gt; &lt;command&gt;</b>
<div style="height: 1.00em;">&#x00A0;</div>
<b>Note:</b> Prompting for a user password is not suitable for automated batch
  processing.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Client_Authentication_Setup"><a class="selflink" href="#Client_Authentication_Setup">Client
  Authentication Setup</a></h2>
A client certificate associated with the desired PKI server must be used for
  client authentication. This can be done by importing the client certificate
  into an NSS security database and passing the values to the relevant options
  provided by the <b>pki</b> CLI framework.
<div style="height: 1.00em;">&#x00A0;</div>
To achieve this, execute the following commands to set up an NSS security
  database for use by the <b>pki</b> client, import the client certificate into
  the NSS database, and list information (including the nickname of the client
  certificate) stored in the NSS database:
<div style="height: 1.00em;">&#x00A0;</div>
<b>- certutil -N -d &lt;CERT_DB_DIR_PATH&gt;</b>
<div style="height: 1.00em;">&#x00A0;</div>
<b>- pk12util -i &lt;Agent_Cert_P12_FILE_PATH&gt; -d
  &lt;CERT_DB_DIR_PATH&gt;</b>
<div style="height: 1.00em;">&#x00A0;</div>
<b>- certutil -L -d &lt;CERT_DB_DIR_PATH&gt;</b>
<div style="height: 1.00em;">&#x00A0;</div>
The first command creates a client security database, and asks the client user
  to enter a password for this NSS database.
<div style="height: 1.00em;">&#x00A0;</div>
The second command imports a client certificate stored in a PKCS12 format into
  this NSS database; it prompts for the passwords of the PKCS12 file and the
  client security database. The simplist example of such a client certificate is
  to obtain the administrator certificate created during the configuration
  portion of the basic PKI installation of the associated PKI server (e. g. -
  located at <i>/root/.dogtag/pki-tomcat/ca_admin_cert.p12</i> on the PKI server
  machine).
<div style="height: 1.00em;">&#x00A0;</div>
The third command shows the information about the imported client certificate
  (including its nickname).
<div style="height: 1.00em;">&#x00A0;</div>
<b>Note:</b> When issuing the first <b>pki</b> command using the authentication
  parameters (after completion of the setup of the client security database), a
  user may be greeted with a warning message which indicates that an untrusted
  issuer was encountered. Simply reply 'Y' to import the CA certificate, and,
  presuming that the displayed CA server URL is valid, press the carriage
  return.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Client_Authentication"><a class="selflink" href="#Client_Authentication">Client
  Authentication</a></h2>
To authenticate with a client certificate:
<div style="height: 1.00em;">&#x00A0;</div>
<b>pki -d &lt;client security database location&gt; -c &lt;client security
  database password&gt; -n &lt;client certificate nickname&gt;
  &lt;command&gt;</b>
<div style="height: 1.00em;">&#x00A0;</div>
Alternatively, to prevent exposure via the command-line, a client security
  database may store their password in a file instead. See <b>Client-side
  Password Files</b> for detailed information.
<div style="height: 1.00em;">&#x00A0;</div>
To authenticate with a client certificate by obtaining the client security
  database password from a client-side password file:
<div style="height: 1.00em;">&#x00A0;</div>
<b>pki -d &lt;client security database location&gt; -C &lt;client-side password
  file&gt; -n &lt;client certificate nickname&gt; &lt;command&gt;</b>
<div style="height: 1.00em;">&#x00A0;</div>
Finally, if a client certificate has been specified on the command-line, and
  neither the '-C &lt;client-side password file&gt;' nor the '-c &lt;client
  security database password&gt;' options have been utilized, the client
  security database password will be prompted for.
<div style="height: 1.00em;">&#x00A0;</div>
To authenticate with a client certificate by interactively prompting for a
  client security database password:
<div style="height: 1.00em;">&#x00A0;</div>
<b>pki -d &lt;client security database location&gt; -n &lt;client certificate
  nickname&gt; &lt;command&gt;</b>
<div style="height: 1.00em;">&#x00A0;</div>
<b>Note:</b> Prompting for a client security database password is not suitable
  for automated batch processing.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Client-side_Password_Files"><a class="selflink" href="#Client-side_Password_Files">Client-side
  Password Files</a></h2>
Both the '-C' (client authentication) and the '-W' (basic authentication)
  options require the use of a client-side password file.
<div style="height: 1.00em;">&#x00A0;</div>
For security purposes, client-side password files should be, at a minimum,
  operating system protected non-world readable files.
<div style="height: 1.00em;">&#x00A0;</div>
Client-side password files generally store a password in an
  equals-sign-delimited plaintext format 'token=password' (e. g. -
  'internal=foobar' where 'internal' is the token, '=' is the delimiter, and
  'foobar' is the actual password). The token keyword 'internal' is the default
  specification for a token, and refers to the &quot;Internal Key Storage
  Token&quot;. If a client-side password file is being used for the sole
  purposes of the <b>pki</b> command-line tool, a client-side password file also
  supports the format that merely consists of the plaintext password on a single
  line (read the <b>Caveats</b> which follow).
<div style="height: 1.00em;">&#x00A0;</div>
<b>Caveats:</b>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">&#x2022; Since client-side password files are allowed to
      use the 'token=password' format, the first '=' character can only be used
      as a delimiter (i. e. - it cannot be used as a valid character within the
      'token' name) as escaping the '=' character within a token is not
      supported.
    <div style="height: 1.00em;">&#x00A0;</div>
    &#x2022; When specifying a password which contains an '=' character, always
      specify an initial '=' prior to specifying the actual password (mandatory
      when no token has been specified) as escaping the '=' character within a
      password is not supported.
    <div style="height: 1.00em;">&#x00A0;</div>
    &#x2022; Tokens do not support leading or trailing whitespace since these
      characters are stripped prior to their use; however, all whitespace inside
      tokens will be preserved.
    <div style="height: 1.00em;">&#x00A0;</div>
    &#x2022; Passwords preserve all leading, trailing, and internal whitespace
      since passwords are not trimmed prior to their use.
    <div style="height: 1.00em;">&#x00A0;</div>
    &#x2022; TBD: Supply code to handle the case of a non-internal token (e. g.
      - 'hardware-nethsm' utilized in the following examples) since the current
      code ignores the specified token (i. e. - it always utilizes the default
      'internal' token no matter what is currently specified).
    <div style="height: 1.00em;">&#x00A0;</div>
    &#x2022; TBD: Allow numerous 'token=password' lines in a single client-side
      password file to support the ability to authenticate against specified
      tokens as well as multiple tokens.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<div class="Pp"></div>
<b>Valid examples include:</b>
<div style="height: 1.00em;">&#x00A0;</div>
<b>internal=foobar</b>
<br/>
 where: token=&quot;internal&quot;, password=&quot;foobar&quot;
<div style="height: 1.00em;">&#x00A0;</div>
<b>hardware-nethsm=foobar</b>
<br/>
 where: token=&quot;hardware-nethsm&quot; (ignored - TBD),
  password=&quot;foobar&quot;
<div style="height: 1.00em;">&#x00A0;</div>
<b>internal=ack=bar</b>
<br/>
 where: token=&quot;internal&quot;, password=&quot;ack=bar&quot;
<div style="height: 1.00em;">&#x00A0;</div>
<b>hardware-nethsm=ack=bar</b>
<br/>
 where: token=&quot;hardware-nethsm&quot; (ignored - TBD),
  password=&quot;ack=bar&quot;
<div style="height: 1.00em;">&#x00A0;</div>
<b>=foobar</b>
<br/>
 where: token=&quot;internal&quot; (default), password=&quot;foobar&quot;
<div style="height: 1.00em;">&#x00A0;</div>
<b>=foo=bar</b>
<br/>
 where: token=&quot;internal&quot; (default), password=&quot;foo=bar&quot;
<br/>
 (Since the password contains an '=' character,
<br/>
 an initial '=' character must be specified!)
<div style="height: 1.00em;">&#x00A0;</div>
<b>foobar</b>
<br/>
 where: token=&quot;internal&quot; (default), password=&quot;foobar&quot;
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Results_Paging"><a class="selflink" href="#Results_Paging">Results
  Paging</a></h2>
Some commands (e.g. cert-find) may return multiple results. Since the number of
  results may be large, the results are split into multiple pages. By default
  the command will return only the first page (e.g. the first 20 results). To
  retrieve results from another page, additional paging parameters can be
  specified:
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
* start: index of the first result to return (default: 0)
* size: number of results to return (default: 20)
</pre>
<div style="height: 1.00em;">&#x00A0;</div>
For example, to retrieve the first page (index #0-#19):
<div style="height: 1.00em;">&#x00A0;</div>
<b>pki cert-find --start 0 --size 20</b>
<div style="height: 1.00em;">&#x00A0;</div>
To retrieve the second page (index #20-#39):
<div style="height: 1.00em;">&#x00A0;</div>
<b>pki cert-find --start 20 --size 20</b>
<div style="height: 1.00em;">&#x00A0;</div>
To retrieve the third page (index #40-#59):
<div style="height: 1.00em;">&#x00A0;</div>
<b>pki cert-find --start 40 --size 20</b>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="FILES"><a class="selflink" href="#FILES">FILES</a></h1>
<i>/usr/bin/pki</i>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>pki-cert</b>(1)
<div style="margin-left: 4.00ex;">Certificate management commands</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>pki-client</b>(1)
<div style="margin-left: 4.00ex;">Client security database management
  commands</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>pki-group</b>(1)
<div style="margin-left: 4.00ex;">Group management commands</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>pki-group-member</b>(1)
<div style="margin-left: 4.00ex;">Group member management commands</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>pki-key</b>(1)
<div style="margin-left: 4.00ex;">Key management commands</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>pki-securitydomain</b>(1)
<div style="margin-left: 4.00ex;">Security domain management commands</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>pki-user</b>(1)
<div style="margin-left: 4.00ex;">User management commands</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>pki-user-cert</b>(1)
<div style="margin-left: 4.00ex;">User certificate management commands</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>pki-user-membership</b>(1)
<div style="margin-left: 4.00ex;">User membership management commands</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>pki-ca-profile</b>(1)
<div style="margin-left: 4.00ex;">Profile management commands</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="AUTHORS"><a class="selflink" href="#AUTHORS">AUTHORS</a></h1>
Ade Lee &lt;alee@redhat.com&gt;, Endi Dewata &lt;edewata@redhat.com&gt;, and
  Matthew Harmsen &lt;mharmsen@redhat.com&gt;.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="COPYRIGHT"><a class="selflink" href="#COPYRIGHT">COPYRIGHT</a></h1>
Copyright (c) 2012 Red Hat, Inc. This is licensed under the GNU General Public
  License, version 2 (GPLv2). A copy of this license is available at
  http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.</div>
<table class="foot">
  <tr>
    <td class="foot-date">May 5, 2014</td>
    <td class="foot-os">version 10.2</td>
  </tr>
</table>
</body>
</html>
