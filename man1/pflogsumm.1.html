<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:31:18 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>PFLOGSUMM(1) User Contributed Perl Documentation
PFLOGSUMM(1)</p>

<p style="margin-top: 1em">NAME <br>
pflogsumm.pl - Produce Postfix MTA logfile summary</p>

<p style="margin-top: 1em">Copyright (C) 1998-2010 by James
S. Seymour, Release 1.1.3.</p>

<p style="margin-top: 1em">SYNOPSIS <br>
pflogsumm.pl -[eq] [-d &lt;today|yesterday&gt;] [--detail
&lt;cnt&gt;] <br>
[--bounce_detail &lt;cnt&gt;] [--deferral_detail
&lt;cnt&gt;] <br>
[-h &lt;cnt&gt;] [-i|--ignore_case] [--iso_date_time]
[--mailq] <br>
[-m|--uucp_mung] [--no_bounce_detail] [--no_deferral_detail]
<br>
[--no_no_msg_size] [--no_reject_detail]
[--no_smtpd_warnings] <br>
[--problems_first] [--rej_add_from] [--reject_detail
&lt;cnt&gt;] <br>
[--smtp_detail &lt;cnt&gt;] [--smtpd_stats] <br>
[--smtpd_warning_detail &lt;cnt&gt;] [--syslog_name=string]
<br>
[-u &lt;cnt&gt;] [--verbose_msg_detail]
[--verp_mung[=&lt;n&gt;]] <br>
[--zero_fill] [file1 [filen]]</p>

<p style="margin-top: 1em">pflogsumm.pl -[help|version]</p>

<p style="margin-top: 1em">If no file(s) specified, reads
from stdin. Output is to stdout.</p>

<p style="margin-top: 1em">DESCRIPTION <br>
Pflogsumm is a log analyzer/summarizer for the Postfix MTA.
It is <br>
designed to provide an over-view of Postfix activity, with
just enough <br>
detail to give the administrator a &quot;heads up&quot; for
potential trouble <br>
spots.</p>

<p style="margin-top: 1em">Pflogsumm generates summaries
and, in some cases, detailed reports of <br>
mail server traffic volumes, rejected and bounced email, and
server <br>
warnings, errors and panics.</p>

<p style="margin-top: 1em">OPTIONS <br>
--bounce_detail &lt;cnt&gt;</p>

<p style="margin-top: 1em">Limit detailed bounce reports to
the top &lt;cnt&gt;. 0 <br>
to suppress entirely.</p>

<p style="margin-top: 1em">-d today generate report for
just today <br>
-d yesterday generate report for just
&quot;yesterday&quot;</p>

<p style="margin-top: 1em">--deferral_detail
&lt;cnt&gt;</p>

<p style="margin-top: 1em">Limit detailed deferral reports
to the top &lt;cnt&gt;. 0 <br>
to suppress entirely.</p>

<p style="margin-top: 1em">--detail &lt;cnt&gt;</p>

<p style="margin-top: 1em">Sets all --*_detail, -h and -u
to &lt;cnt&gt;. Is <br>
over-ridden by individual settings. --detail 0 <br>
suppresses *all* detail.</p>

<p style="margin-top: 1em">-e extended (extreme?
excessive?) detail</p>

<p style="margin-top: 1em">Emit detailed reports. At
present, this includes <br>
only a per-message report, sorted by sender domain, <br>
then user-in-domain, then by queue i.d.</p>

<p style="margin-top: 1em">WARNING: the data built to
generate this report can <br>
quickly consume very large amounts of memory if a <br>
lot of log entries are processed!</p>

<p style="margin-top: 1em">-h &lt;cnt&gt; top &lt;cnt&gt;
to display in host/domain reports.</p>

<p style="margin-top: 1em">0 = none.</p>

<p style="margin-top: 1em">See also: &quot;-u&quot; and
&quot;--*_detail&quot; options for further <br>
report-limiting options.</p>

<p style="margin-top: 1em">--help Emit short usage message
and bail out.</p>

<p style="margin-top: 1em">(By happy coincidence,
&quot;-h&quot; alone does much the same, <br>
being as it requires a numeric argument :-). Yeah, I <br>
know: lame.)</p>

<p style="margin-top: 1em">-i <br>
--ignore_case Handle complete email address in a
case-insensitive <br>
manner.</p>

<p style="margin-top: 1em">Normally pflogsumm lower-cases
only the host and <br>
domain parts, leaving the user part alone. This <br>
option causes the entire email address to be lower- <br>
cased.</p>

<p style="margin-top: 1em">--iso_date_time</p>

<p style="margin-top: 1em">For summaries that contain date
or time information, <br>
use ISO 8601 standard formats (CCYY-MM-DD and HH:MM), <br>
rather than &quot;Mon DD CCYY&quot; and
&quot;HHMM&quot;.</p>

<p style="margin-top: 1em">-m modify (mung?) UUCP-style
bang-paths <br>
--uucp_mung</p>

<p style="margin-top: 1em">This is for use when you have a
mix of Internet-style <br>
domain addresses and UUCP-style bang-paths in the log. <br>
Upstream UUCP feeds sometimes mung Internet domain <br>
style address into bang-paths. This option can <br>
sometimes undo the &quot;damage&quot;. For example: <br>
&quot;somehost.dom!username@foo&quot; (where &quot;foo&quot;
is the next <br>
host upstream and &quot;somehost.dom&quot; was whence the
email <br>
originated) will get converted to <br>
&quot;foo!username@somehost.dom&quot;. This also affects the
<br>
extended detail report (-e), to help ensure that by- <br>
domain-by-name sorting is more accurate.</p>

<p style="margin-top: 1em">--mailq Run &quot;mailq&quot;
command at end of report.</p>

<p style="margin-top: 1em">Merely a convenience feature.
(Assumes that &quot;mailq&quot; <br>
is in $PATH. See &quot;$mailqCmd&quot; variable to path
thisi <br>
if desired.)</p>

<p style="margin-top: 1em">--no_bounce_detail <br>
--no_deferral_detail <br>
--no_reject_detail</p>

<p style="margin-top: 1em">These switches are depreciated
in favour of <br>
--bounce_detail, --deferral_detail and <br>
--reject_detail, respectively.</p>

<p style="margin-top: 1em">Suppresses the printing of the
following detailed <br>
reports, respectively:</p>

<p style="margin-top: 1em">message bounce detail (by relay)
<br>
message deferral detail <br>
message reject detail</p>

<p style="margin-top: 1em">See also: &quot;-u&quot; and
&quot;-h&quot; for further report-limiting <br>
options.</p>

<p style="margin-top: 1em">--no_no_msg_size</p>

<p style="margin-top: 1em">Do not emit report on
&quot;Messages with no size data&quot;.</p>

<p style="margin-top: 1em">Message size is reported only by
the queue manager. <br>
The message may be delivered long-enough after the <br>
(last) qmgr log entry that the information is not in <br>
the log(s) processed by a particular run of <br>
pflogsumm.pl. This throws off &quot;Recipients by message
<br>
size&quot; and the total for &quot;bytes delivered.&quot;
These are <br>
normally reported by pflogsumm as &quot;Messages with no
<br>
size data.&quot;</p>

<p style="margin-top: 1em">--no_smtpd_warnings</p>

<p style="margin-top: 1em">This switch is depreciated in
favour of <br>
smtpd_warning_detail</p>

<p style="margin-top: 1em">On a busy mail server, say at an
ISP, SMTPD warnings <br>
can result in a rather sizeable report. This option <br>
turns reporting them off.</p>

<p style="margin-top: 1em">--problems_first</p>

<p style="margin-top: 1em">Emit &quot;problems&quot;
reports (bounces, defers, warnings, <br>
etc.) before &quot;normal&quot; stats.</p>

<p style="margin-top: 1em">--rej_add_from <br>
For those reject reports that list IP addresses or <br>
host/domain names: append the email from address to <br>
each listing. (Does not apply to &quot;Improper use of <br>
SMTP command pipelining&quot; report.)</p>

<p style="margin-top: 1em">-q quiet - don&rsquo;t print
headings for empty reports</p>

<p style="margin-top: 1em">note: headings for warning,
fatal, and &quot;master&quot; <br>
messages will always be printed.</p>

<p style="margin-top: 1em">--reject_detail &lt;cnt&gt;</p>

<p style="margin-top: 1em">Limit detailed smtpd reject,
warn, hold and discard <br>
reports to the top &lt;cnt&gt;. 0 to suppress entirely.</p>

<p style="margin-top: 1em">--smtp_detail &lt;cnt&gt;</p>

<p style="margin-top: 1em">Limit detailed smtp delivery
reports to the top &lt;cnt&gt;. <br>
0 to suppress entirely.</p>

<p style="margin-top: 1em">--smtpd_stats</p>

<p style="margin-top: 1em">Generate smtpd connection
statistics.</p>

<p style="margin-top: 1em">The &quot;per-day&quot; report
is not generated for single-day <br>
reports. For multiple-day reports: &quot;per-hour&quot;
numbers <br>
are daily averages (reflected in the report heading).</p>

<p style="margin-top: 1em">--smtpd_warning_detail
&lt;cnt&gt;</p>

<p style="margin-top: 1em">Limit detailed smtpd warnings
reports to the top &lt;cnt&gt;. <br>
0 to suppress entirely.</p>

<p style="margin-top: 1em">--syslog_name=name</p>

<p style="margin-top: 1em">Set syslog_name to look for for
Postfix log entries.</p>

<p style="margin-top: 1em">By default, pflogsumm looks for
entries in logfiles <br>
with a syslog name of &quot;postfix,&quot; the default. <br>
If you&rsquo;ve set a non-default &quot;syslog_name&quot;
parameter <br>
in your Postfix configuration, use this option to <br>
tell pflogsumm what that is.</p>

<p style="margin-top: 1em">See the discussion about the use
of this option under <br>
&quot;NOTES,&quot; below.</p>

<p style="margin-top: 1em">-u &lt;cnt&gt; top &lt;cnt&gt;
to display in user reports. 0 == none.</p>

<p style="margin-top: 1em">See also: &quot;-h&quot; and
&quot;--*_detail&quot; options for further <br>
report-limiting options.</p>

<p style="margin-top: 1em">--verbose_msg_detail</p>

<p style="margin-top: 1em">For the message deferral, bounce
and reject summaries: <br>
display the full &quot;reason&quot;, rather than a truncated
one.</p>

<p style="margin-top: 1em">Note: this can result in quite
long lines in the report.</p>

<p style="margin-top: 1em">--verp_mung do &quot;VERP&quot;
generated address (?) munging. Convert <br>
--verp_mung=2 sender addresses of the form <br>

&quot;list-return-NN-someuser=some.dom@host.sender.dom&quot;
<br>
to <br>

&quot;list-return-ID-someuser=some.dom@host.sender.dom&quot;</p>

<p style="margin-top: 1em">In other words: replace the
numeric value with &quot;ID&quot;.</p>

<p style="margin-top: 1em">By specifying the optional
&quot;=2&quot; (second form), the <br>
munging is more &quot;aggressive&quot;, converting the
address <br>
to something like:</p>


<p style="margin-top: 1em">&quot;list-return@host.sender.dom&quot;</p>

<p style="margin-top: 1em">Actually: specifying anything
less than 2 does the <br>
&quot;simple&quot; munging and anything greater than 1
results <br>
in the more &quot;aggressive&quot; hack being applied.</p>

<p style="margin-top: 1em">See &quot;NOTES&quot; regarding
this option.</p>

<p style="margin-top: 1em">--version Print program name and
version and bail out.</p>

<p style="margin-top: 1em">--zero_fill
&quot;Zero-fill&quot; certain arrays so reports come out
with <br>
data in columns that that might otherwise be blank.</p>

<p style="margin-top: 1em">RETURN VALUE <br>
Pflogsumm doesn&rsquo;t return anything of interest to the
shell.</p>

<p style="margin-top: 1em">ERRORS <br>
Error messages are emitted to stderr.</p>

<p style="margin-top: 1em">EXAMPLES <br>
Produce a report of previous day&rsquo;s activities:</p>

<p style="margin-top: 1em">pflogsumm.pl -d yesterday
/var/log/maillog</p>

<p style="margin-top: 1em">A report of prior week&rsquo;s
activities (after logs rotated):</p>

<p style="margin-top: 1em">pflogsumm.pl
/var/log/maillog.0</p>

<p style="margin-top: 1em">What&rsquo;s happened so far
today:</p>

<p style="margin-top: 1em">pflogsumm.pl -d today
/var/log/maillog</p>

<p style="margin-top: 1em">Crontab entry to generate a
report of the previous day&rsquo;s activity <br>
at 10 minutes after midnight.</p>

<p style="margin-top: 1em">10 0 * * *
/usr/local/sbin/pflogsumm -d yesterday /var/log/maillog <br>
2&gt;&amp;1 |/usr/bin/mailx -s &quot;&lsquo;uname -n&lsquo;
daily mail stats&quot; postmaster</p>

<p style="margin-top: 1em">Crontab entry to generate a
report for the prior week&rsquo;s activity. <br>
(This example assumes one rotates ones mail logs weekly,
some time <br>
before 4:10 a.m. on Sunday.)</p>

<p style="margin-top: 1em">10 4 * * 0
/usr/local/sbin/pflogsumm /var/log/maillog.0 <br>
2&gt;&amp;1 |/usr/bin/mailx -s &quot;&lsquo;uname -n&lsquo;
weekly mail stats&quot; postmaster</p>

<p style="margin-top: 1em">The two crontab examples, above,
must actually be a single line <br>
each. They&rsquo;re broken-up into two-or-more lines due to
page <br>
formatting issues.</p>

<p style="margin-top: 1em">SEE ALSO <br>
The pflogsumm FAQ: pflogsumm-faq.txt.</p>

<p style="margin-top: 1em">NOTES <br>
Pflogsumm makes no attempt to catch/parse non-Postfix log
<br>
entries. Unless it has &quot;postfix/&quot; in the log
entry, it will be <br>
ignored.</p>

<p style="margin-top: 1em">It&rsquo;s important that the
logs are presented to pflogsumm in <br>
chronological order so that message sizes are available when
<br>
needed.</p>

<p style="margin-top: 1em">For display purposes: integer
values are munged into &quot;kilo&quot; and <br>
&quot;mega&quot; notation as they exceed certain values. I
chose the <br>
admittedly arbitrary boundaries of 512k and 512m as the
points at <br>
which to do this--my thinking being 512x was the largest
number <br>
(of digits) that most folks can comfortably grok
at-a-glance. <br>
These are &quot;computer&quot; &quot;k&quot; and
&quot;m&quot;, not 1000 and 1,000,000. You <br>
can easily change all of this with some constants near the
<br>
beginning of the program.</p>

<p style="margin-top: 1em">&quot;Items-per-day&quot;
reports are not generated for single-day <br>
reports. For multiple-day reports:
&quot;Items-per-hour&quot; numbers are <br>
daily averages (reflected in the report headings).</p>

<p style="margin-top: 1em">Message rejects, reject
warnings, holds and discards are all <br>
reported under the &quot;rejects&quot; column for the
Per-Hour and Per-Day <br>
traffic summaries.</p>

<p style="margin-top: 1em">Verp munging may not always
result in correct address and <br>
address-count reduction.</p>

<p style="margin-top: 1em">Verp munging is always in a
state of experimentation. The use <br>
of this option may result in inaccurate statistics with
regards <br>
to the &quot;senders&quot; count.</p>

<p style="margin-top: 1em">UUCP-style bang-path handling
needs more work. Particularly if <br>
Postfix is not being run with &quot;swap_bangpath =
yes&quot; and/or *is* being <br>
run with &quot;append_dot_mydomain = yes&quot;, the detailed
by-message report <br>
may not be sorted correctly by-domain-by-user. (Also depends
on <br>
upstream MTA, I suspect.)</p>

<p style="margin-top: 1em">The &quot;percent rejected&quot;
and &quot;percent discarded&quot; figures are only <br>
approximations. They are calculated as follows (example is
for <br>
&quot;percent rejected&quot;):</p>

<p style="margin-top: 1em">percent rejected =</p>

<p style="margin-top: 1em">(rejected / (delivered +
rejected + discarded)) * 100</p>

<p style="margin-top: 1em">There are some issues with the
use of --syslog_name. The problem is <br>
that, even with $syslog_name set, Postfix will sometimes
still log <br>
things with &quot;postfix&quot; as the syslog_name. This is
noted in <br>
/etc/postfix/sample-misc.cf:</p>

<p style="margin-top: 1em"># Beware: a non-default
syslog_name setting takes effect only <br>
# after process initialization. Some initialization errors
will be <br>
# logged with the default name, especially errors while
parsing <br>
# the command line and errors while accessing the Postfix
main.cf <br>
# configuration file.</p>

<p style="margin-top: 1em">As a consequence, pflogsumm must
always look for &quot;postfix,&quot; in logs, <br>
as well as whatever is supplied for syslog_name.</p>

<p style="margin-top: 1em">Where this becomes an issue is
where people are running two or more <br>
instances of Postfix, logging to the same file. In such a
case:</p>

<p style="margin-top: 1em">. Neither instance may use the
default &quot;postfix&quot; syslog name <br>
and...</p>

<p style="margin-top: 1em">. Log entries that fall victim
to what&rsquo;s described in <br>
sample-misc.cf will be reported under &quot;postfix&quot;,
so that if <br>
you&rsquo;re running pflogsumm twice, once for each
syslog_name, such <br>
log entries will show up in each report.</p>

<p style="margin-top: 1em">The Pflogsumm Home Page is
at:</p>


<p style="margin-top: 1em">http://jimsun.LinxNet.com/postfix_contrib.html</p>

<p style="margin-top: 1em">REQUIREMENTS <br>
For certain options (e.g.: --smtpd_stats), Pflogsumm
requires the <br>
Date::Calc module, which can be obtained from CPAN at <br>
http://www.perl.com.</p>

<p style="margin-top: 1em">Pflogsumm is currently written
and tested under Perl 5.8.3. <br>
As of version 19990413-02, pflogsumm worked with Perl 5.003,
but <br>
future compatibility is not guaranteed.</p>

<p style="margin-top: 1em">LICENSE <br>
This program is free software; you can redistribute it
and/or <br>
modify it under the terms of the GNU General Public License
<br>
as published by the Free Software Foundation; either version
2 <br>
of the License, or (at your option) any later version.</p>

<p style="margin-top: 1em">This program is distributed in
the hope that it will be useful, <br>
but WITHOUT ANY WARRANTY; without even the implied warranty
of <br>
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
<br>
GNU General Public License for more details.</p>

<p style="margin-top: 1em">You may have received a copy of
the GNU General Public License <br>
along with this program; if not, write to the Free Software
<br>
Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
02111-1307, <br>
USA.</p>

<p style="margin-top: 1em">An on-line copy of the GNU
General Public License can be found <br>
http://www.fsf.org/copyleft/gpl.html.</p>

<p style="margin-top: 1em">1.1.3 2010-03-20
PFLOGSUMM(1)</p>
<hr>
</body>
</html>
