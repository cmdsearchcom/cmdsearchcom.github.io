<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:20:44 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>KNIFE-EXEC(1) knife exec KNIFE-EXEC(1)</p>

<p style="margin-top: 1em">NAME <br>
knife-exec - The man page for the knife exec subcommand.</p>

<p style="margin-top: 1em">The knife exec subcommand uses
the knife configuration file to execute Ruby scripts in the
context of a fully configured chef-client. This subcommand
is most often used to run <br>
scripts that will only access Chef server one time (or
otherwise very infrequently). Use this subcommand any time
that an operation does not warrant full usage of the knife
sub&acirc; <br>
command library.</p>

<p style="margin-top: 1em">Authenticated API Requests</p>

<p style="margin-top: 1em">The knife exec subcommand can be
used to make authenticated API requests to the Chef server
using the following methods:</p>


<p style="margin-top: 1em">&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&not;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;
<br>
&acirc;Method &acirc; Description &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;api.delete &acirc; Use to delete an object from the
Chef server. &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;api.get &acirc; Use to get the details of an object
on the Chef server. &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;api.post &acirc; Use to add an object to the Chef
server. &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&frac14;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&curren;
<br>
&acirc;api.put &acirc; Use to update an object on the Chef
server. &acirc; <br>

&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acute;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;&acirc;</p>

<p style="margin-top: 1em">These methods are used with the
-E option, which executes that string locally on the
workstation using chef-shell. These methods have the
following syntax:</p>

<p style="margin-top: 1em">$ knife exec -E
&rsquo;api.method(/endpoint)&rsquo;</p>

<p style="margin-top: 1em">where:</p>

<p style="margin-top: 1em">&Acirc;&middot; api.method is
the corresponding authentication method --- api.delete,
api.get, api.post, or api.put</p>

<p style="margin-top: 1em">&Acirc;&middot; /endpoint is an
endpoint in the Chef server API</p>

<p style="margin-top: 1em">For example, to get the data for
a node named &quot;Example_Node&quot;:</p>

<p style="margin-top: 1em">$ knife exec -E &rsquo;puts
api.get(&quot;/nodes/Example_Node&quot;)&rsquo;</p>

<p style="margin-top: 1em">and to ensure that the output is
visible in the console, add the puts in front of the API
authorization request:</p>

<p style="margin-top: 1em">$ knife exec -E &rsquo;puts
api.get(&quot;/nodes/Example_Node&quot;)&rsquo;</p>

<p style="margin-top: 1em">where puts is the shorter
version of the $stdout.puts predefined variable in Ruby.</p>

<p style="margin-top: 1em">The following example shows how
to add a client named &quot;IBM305RAMAC&quot; and the
/clients endpoint, and then return the private key for that
user in the console:</p>

<p style="margin-top: 1em">$ client_desc = { <br>
&quot;name&quot; =&gt; &quot;IBM305RAMAC&quot;, <br>
&quot;admin&quot; =&gt; false <br>
}</p>

<p style="margin-top: 1em">new_client =
api.post(&quot;/clients&quot;, client_desc) <br>
puts new_client[&quot;private_key&quot;]</p>

<p style="margin-top: 1em">Syntax</p>

<p style="margin-top: 1em">This subcommand has the
following syntax:</p>

<p style="margin-top: 1em">$ knife exec SCRIPT
(options)</p>

<p style="margin-top: 1em">Options</p>

<p style="margin-top: 1em">This subcommand has the
following options:</p>

<p style="margin-top: 1em">-c CONFIG_FILE, --config
CONFIG_FILE <br>
The configuration file to use.</p>

<p style="margin-top: 1em">--chef-zero-port PORT <br>
The port on which chef-zero will listen.</p>

<p style="margin-top: 1em">--[no-]color <br>
Use to view colored output.</p>

<p style="margin-top: 1em">-d, --disable-editing <br>
Use to prevent the $EDITOR from being opened and to accept
data as-is.</p>

<p style="margin-top: 1em">--defaults <br>
Use to have knife use the default value instead of asking a
user to provide one.</p>

<p style="margin-top: 1em">-E CODE, --exec CODE <br>
A string of code that will be executed.</p>

<p style="margin-top: 1em">-e EDITOR, --editor EDITOR <br>
The $EDITOR that is used for all interactive commands.</p>

<p style="margin-top: 1em">--environment ENVIRONMENT <br>
The name of the environment. When this option is added to a
command, the command will run only against the named
environment.</p>

<p style="margin-top: 1em">-F FORMAT, --format FORMAT <br>
The output format: summary (default), text, json, yaml, and
pp.</p>

<p style="margin-top: 1em">-h, --help <br>
Shows help for the command.</p>

<p style="margin-top: 1em">-k KEY, --key KEY <br>
The private key that knife will use to sign requests made by
the API client to the Chef server.</p>

<p style="margin-top: 1em">-p PATH:PATH, --script-path
PATH:PATH <br>
A colon-separated path at which Ruby scripts are
located.</p>

<p style="margin-top: 1em">--print-after <br>
Use to show data after a destructive operation.</p>

<p style="margin-top: 1em">-s URL, --server-url URL <br>
The URL for the Chef server.</p>

<p style="margin-top: 1em">-u USER, --user USER <br>
The user name used by knife to sign requests made by the API
client to the Chef server. Authentication will fail if the
user name does not match the private key.</p>

<p style="margin-top: 1em">-v, --version <br>
The version of the chef-client.</p>

<p style="margin-top: 1em">-V, --verbose <br>
Set for more verbose outputs. Use -VV for maximum
verbosity.</p>

<p style="margin-top: 1em">-y, --yes <br>
Use to respond to all confirmation prompts with
&quot;Yes&quot;. knife will not ask for confirmation.</p>

<p style="margin-top: 1em">-z, --local-mode <br>
Use to run the chef-client in local mode. This allows all
commands that work against the Chef server to also work
against the local chef-repo.</p>

<p style="margin-top: 1em">Examples</p>

<p style="margin-top: 1em">There are three ways to use
knife exec to run Ruby script files. For example:</p>

<p style="margin-top: 1em">$ knife exec
/path/to/script_file</p>

<p style="margin-top: 1em">or:</p>

<p style="margin-top: 1em">$ knife exec -E &rsquo;RUBY
CODE&rsquo;</p>

<p style="margin-top: 1em">or:</p>

<p style="margin-top: 1em">$ knife exec <br>
RUBY CODE <br>
^D</p>

<p style="margin-top: 1em">To check the status of knife
using a Ruby script named status.rb (which looks like):</p>

<p style="margin-top: 1em">printf &quot;%-5s %-12s %-8s
%s0, &quot;Check In&quot;, &quot;Name&quot;,
&quot;Ruby&quot;, &quot;Recipes&quot; <br>
nodes.all do |n| <br>
checkin =
Time.at(n[&rsquo;ohai_time&rsquo;]).strftime(&quot;%F
%R&quot;) <br>
rubyver =
n[&rsquo;languages&rsquo;][&rsquo;ruby&rsquo;][&rsquo;version&rsquo;]
<br>
recipes = n.run_list.expand(_default).recipes.join(&quot;,
&quot;) <br>
printf &quot;%-20s %-12s %-8s %s0, checkin, n.name, rubyver,
recipes <br>
end</p>

<p style="margin-top: 1em">and is located in a directory
named scripts/, enter:</p>

<p style="margin-top: 1em">$ knife exec
scripts/status.rb</p>

<p style="margin-top: 1em">To show the available free
memory for all nodes, enter:</p>

<p style="margin-top: 1em">$ knife exec -E &rsquo;nodes.all
{|n| puts &quot;#{n.name} has #{n.memory.total} free
memory&quot;}&rsquo;</p>

<p style="margin-top: 1em">To list all of the available
search indexes, enter:</p>

<p style="margin-top: 1em">$ knife exec -E &rsquo;puts
api.get(&quot;search&quot;).keys&rsquo;</p>

<p style="margin-top: 1em">To query a node for multiple
attributes using a Ruby script named search_attributes.rb
(which looks like):</p>

<p style="margin-top: 1em">% cat
scripts/search_attributes.rb <br>
query = ARGV[2] <br>
attributes = ARGV[3].split(&quot;,&quot;) <br>
puts &quot;Your query: #{query}&quot; <br>
puts &quot;Your attributes: #{attributes.join(&quot;
&quot;)}&quot; <br>
results = {} <br>
search(:node, query) do |n| <br>
results[n.name] = {} <br>
attributes.each {|a| results[n.name][a] = n[a]} <br>
end</p>

<p style="margin-top: 1em">puts results <br>
exit 0</p>

<p style="margin-top: 1em">enter:</p>

<p style="margin-top: 1em">% knife exec
scripts/search_attributes.rb
&quot;hostname:test_system&quot; ipaddress,fqdn</p>

<p style="margin-top: 1em">to return something like:</p>

<p style="margin-top: 1em">Your query: hostname:test_system
<br>
Your attributes: ipaddress fqdn <br>

{&quot;test_system.example.com&quot;=&gt;{&quot;ipaddress&quot;=&gt;&quot;10.1.1.200&quot;,
&quot;fqdn&quot;=&gt;&quot;test_system.example.com&quot;}}</p>

<p style="margin-top: 1em">AUTHOR <br>
Chef</p>

<p style="margin-top: 1em">Chef 12.0 KNIFE-EXEC(1)</p>
<hr>
</body>
</html>
