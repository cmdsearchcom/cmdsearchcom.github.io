<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>INNOBACKUPEX(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">INNOBACKUPEX(1)</td>
    <td class="head-vol">Percona XtraBackup</td>
    <td class="head-rtitle">INNOBACKUPEX(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
innobackupex - innobackupex Documentation
<div style="height: 1.00em;">&#x00A0;</div>
The <b>innobackupex</b> tool is a <i>Perl</i> script that acts as a wrapper for
  the xtrabackup <i>C</i> program. It is a patched version of the
  <b>innobackup</b> <i>Perl</i> script that <i>Oracle</i> distributes with the
  <i>InnoDB Hot Backup</i> tool. It enables more functionality by integrating
  <b>xtrabackup</b> and other functions such as file copying and streaming, and
  adds some convenience. It lets you perform point-in-time backups of
  <i>InnoDB</i> / <i>XtraDB</i> tables together with the schema definitions,
  <i>MyISAM</i> tables, and other portions of the server.
<div style="height: 1.00em;">&#x00A0;</div>
This manual section explains how to use <b>innobackupex</b> in detail.
<h1 class="Sh" title="Sh" id="THE_BACKUP_CYCLE_-_FULL_BACKUPS"><a class="selflink" href="#THE_BACKUP_CYCLE_-_FULL_BACKUPS">THE
  BACKUP CYCLE - FULL BACKUPS</a></h1>
<h2 class="Ss" title="Ss" id="Creating_a_Backup_with_innobackupex"><a class="selflink" href="#Creating_a_Backup_with_innobackupex">Creating
  a Backup with <b>innobackupex</b></a></h2>
<b>innobackupex</b> is the tool which provides functionality to backup a whole
  MySQL database instance using the <b>xtrabackup</b> in combination with tools
  like xbstream and xbcrypt.
<div style="height: 1.00em;">&#x00A0;</div>
To create a full backup, invoke the script with the options needed to connect to
  the server and only one argument: the path to the directory where the backup
  will be stored
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --user=DBUSER --password=DBUSERPASS /path/to/BACKUP-DIR/
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
and check the last line of the output for a confirmation message:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
innobackupex: Backup created in directory '/path/to/BACKUP-DIR/2013-03-25_00-00-09'
innobackupex: MySQL binlog position: filename 'mysql-bin.000003', position 1946
111225 00:00:53  innobackupex: completed OK!
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The backup will be stored within a time stamped directory created in the
  provided path, <b>/path/to/BACKUP-DIR/2013-03-25_00-00-09</b> in this
  particular example.
<h2 class="Ss" title="Ss" id="Under_the_hood"><a class="selflink" href="#Under_the_hood">Under
  the hood</a></h2>
<b>innobackupex</b> called <b>xtrabackup</b> binary to backup all the data of
  <i>InnoDB</i> tables (see ../xtrabackup_bin/creating_a_backup for details on
  this process) and copied all the table definitions in the database (.frm
  files), data and files related to <i>MyISAM</i>, MERGE (reference to other
  tables), CSV and ARCHIVE tables, along with triggers and database
  configuration information to a time stamped directory created in the provided
  path.
<div style="height: 1.00em;">&#x00A0;</div>
It will also create the following files for convenience on the created
  directory.
<h2 class="Ss" title="Ss" id="Other_options_to_consider"><a class="selflink" href="#Other_options_to_consider">Other
  options to consider</a></h2>
<h2 class="Ss" title="Ss" id="The_--no-timestamp_option"><a class="selflink" href="#The_--no-timestamp_option">The
  <b>--no-timestamp</b> option</a></h2>
This option tells <b>innobackupex</b> not to create a time stamped directory to
  store the backup:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --user=DBUSER --password=DBUSERPASS /path/to/BACKUP-DIR/ --no-timestamp
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>innobackupex</b> will create the <b>BACKUP-DIR</b> subdirectory (or fail if
  exists) and store the backup inside of it.
<h2 class="Ss" title="Ss" id="The_--defaults-file_option"><a class="selflink" href="#The_--defaults-file_option">The
  <b>--defaults-file</b> option</a></h2>
You can provide other configuration file to <b>innobackupex</b> with this
  option. The only limitation is that <b>it has to be the first option
  passed</b>:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --defaults-file=/tmp/other-my.cnf --user=DBUSER --password=DBUSERPASS /path/to/BACKUP-DIR/
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Preparing_a_Full_Backup_with_innobackupex"><a class="selflink" href="#Preparing_a_Full_Backup_with_innobackupex">Preparing
  a Full Backup with <b>innobackupex</b></a></h2>
After creating a backup, the data is not ready to be restored. There might be
  uncommitted transactions to be undone or transactions in the logs to be
  replayed. Doing those pending operations will make the data files consistent
  and it is the purpose of the <b>prepare stage</b>. Once this has been done,
  the data is ready to be used.
<div style="height: 1.00em;">&#x00A0;</div>
To prepare a backup with <b>innobackupex</b> you have to use the
  <b>--apply-log</b> and the path to the backup directory as an argument:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --apply-log /path/to/BACKUP-DIR
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
and check the last line of the output for a confirmation on the process:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
150806 01:01:57  InnoDB: Shutdown completed; log sequence number 1609228
150806 01:01:57  innobackupex: completed OK!
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
If it succeeded, <b>innobackupex</b> performed all operations needed, leaving
  the data ready to use immediately.
<h2 class="Ss" title="Ss" id="Under_the_hood"><a class="selflink" href="#Under_the_hood">Under
  the hood</a></h2>
<b>innobackupex</b> started the prepare process by reading the configuration
  from the <b>backup-my.cnf</b> file in the backup directory.
<div style="height: 1.00em;">&#x00A0;</div>
After that, <b>innobackupex</b> replayed the committed transactions in the log
  files (some transactions could have been done while the backup was being done)
  and rolled back the uncommitted ones. Once this is done, all the information
  lay in the tablespace (the InnoDB files), and the log files are re-created.
<div style="height: 1.00em;">&#x00A0;</div>
This implies calling <b>xtrabackup --prepare</b> twice. More details of this
  process are shown in the xtrabackup section.
<div style="height: 1.00em;">&#x00A0;</div>
Note that this preparation is not suited for incremental backups. If you perform
  it on the base of an incremental backup, you will not be able to
  &quot;add&quot; the increments. See incremental_backups_innobackupex.
<h2 class="Ss" title="Ss" id="Other_options_to_consider"><a class="selflink" href="#Other_options_to_consider">Other
  options to consider</a></h2>
<h2 class="Ss" title="Ss" id="The_--use-memory_option"><a class="selflink" href="#The_--use-memory_option">The
  <b>--use-memory</b> option</a></h2>
The preparing process can be speed up by using more memory in it. It depends on
  the free or available <b>RAM</b> on your system, it defaults to <b>100MB</b>.
  In general, the more memory available to the process, the better. The amount
  of memory used in the process can be specified by multiples of bytes:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --apply-log --use-memory=4G /path/to/BACKUP-DIR
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Restoring_a_Full_Backup_with_innobackupex"><a class="selflink" href="#Restoring_a_Full_Backup_with_innobackupex">Restoring
  a Full Backup with <b>innobackupex</b></a></h2>
For convenience, <b>innobackupex</b> has a <b>--copy-back</b> option, which
  performs the restoration of a backup to the server's datadir
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --copy-back /path/to/BACKUP-DIR
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
It will copy all the data-related files back to the server's datadir, determined
  by the server's <b>my.cnf</b> configuration file. You should check the last
  line of the output for a success message:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
innobackupex: Finished copying back files.
<div class="Pp"></div>
111225 01:08:13  innobackupex: completed OK!
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">The datadir must be empty; <i>Percona
  XtraBackup</i> <b>innobackupex --copy-back</b> option will not copy over
  existing files unless <b>innobackupex --force-non-empty-directories</b> option
  is specified. Also it's important to note that <i>MySQL</i> server needs to be
  shut down before restore is performed. You can't restore to a datadir of a
  running mysqld instance (except when importing a partial backup).</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
As files' attributes will be preserved, in most cases you will need to change
  the files' ownership to <b>mysql</b> before starting the database server, as
  they will be owned by the user who created the backup:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ chown -R mysql:mysql /var/lib/mysql
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Also note that all of these operations will be done as the user calling
  <b>innobackupex</b>, you will need write permissions on the server's datadir.
<h1 class="Sh" title="Sh" id="OTHER_TYPES_OF_BACKUPS"><a class="selflink" href="#OTHER_TYPES_OF_BACKUPS">OTHER
  TYPES OF BACKUPS</a></h1>
<h2 class="Ss" title="Ss" id="Incremental_Backups_with_innobackupex"><a class="selflink" href="#Incremental_Backups_with_innobackupex">Incremental
  Backups with <b>innobackupex</b></a></h2>
As not all information changes between each backup, the incremental backup
  strategy uses this to reduce the storage needs and the duration of making a
  backup.
<div style="height: 1.00em;">&#x00A0;</div>
This can be done because each <i>InnoDB</i> page has a log sequence number, LSN,
  which acts as a version number of the entire database. Every time the database
  is modified, this number gets incremented.
<div style="height: 1.00em;">&#x00A0;</div>
An incremental backup copies all pages since a specific LSN.
<div style="height: 1.00em;">&#x00A0;</div>
Once the pages have been put together in their respective order, applying the
  logs will recreate the process that affected the database, yielding the data
  at the moment of the most recently created backup.
<h2 class="Ss" title="Ss" id="Creating_an_Incremental_Backups_with_innobackupex"><a class="selflink" href="#Creating_an_Incremental_Backups_with_innobackupex">Creating
  an Incremental Backups with <b>innobackupex</b></a></h2>
First, you need to make a full backup as the BASE for subsequent incremental
  backups:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex /data/backups
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This will create a timestamped directory in <b>/data/backups</b>. Assuming that
  the backup is done last day of the month, <b>BASEDIR</b> would be
  <b>/data/backups/2013-03-31_23-01-18</b>, for example.
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">You can use the <b>innobackupex
  --no-timestamp</b> option to override this behavior and the backup will be
  created in the given directory.</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
If you check at the <b>xtrabackup-checkpoints</b> file in <b>BASE-DIR</b>, you
  should see something like:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
backup_type = full-backuped
from_lsn = 0
to_lsn = 1291135
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
To create an incremental backup the next day, use the <b>--incremental</b>
  option and provide the BASEDIR:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --incremental /data/backups --incremental-basedir=BASEDIR
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
and another timestamped directory will be created in <b>/data/backups</b>, in
  this example, <b>/data/backups/2013-04-01_23-01-18</b> containing the
  incremental backup. We will call this <b>INCREMENTAL-DIR-1</b>.
<div style="height: 1.00em;">&#x00A0;</div>
If you check at the <b>xtrabackup-checkpoints</b> file in
  <b>INCREMENTAL-DIR-1</b>, you should see something like:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
backup_type = incremental
from_lsn = 1291135
to_lsn = 1352113
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Creating another incremental backup the next day will be analogous, but this
  time the previous incremental one will be base:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --incremental /data/backups --incremental-basedir=INCREMENTAL-DIR-1
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
yielding (in this example) <b>/data/backups/2013-04-02_23-01-18</b>. We will use
  <b>INCREMENTAL-DIR-2</b> instead for simplicity.
<div style="height: 1.00em;">&#x00A0;</div>
At this point, the <b>xtrabackup-checkpoints</b> file in
  <b>INCREMENTAL-DIR-2</b> should contain something like:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
backup_type = incremental
from_lsn = 1352113
to_lsn = 1358967
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
As it was said before, an incremental backup only copy pages with a LSN greater
  than a specific value. Providing the LSN would have produced directories with
  the same data inside:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
innobackupex --incremental /data/backups --incremental-lsn=1291135
innobackupex --incremental /data/backups --incremental-lsn=1358967
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This is a very useful way of doing an incremental backup, since not always the
  base or the last incremental will be available in the system.
<div style="height: 1.00em;">&#x00A0;</div>
<b>WARNING:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">This procedure only affects <i>XtraDB</i> or
  <i>InnoDB</i>-based tables. Other tables with a different storage engine, e.g.
  <i>MyISAM</i>, will be copied entirely each time an incremental backup is
  performed.</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Preparing_an_Incremental_Backup_with_innobackupex"><a class="selflink" href="#Preparing_an_Incremental_Backup_with_innobackupex">Preparing
  an Incremental Backup with <b>innobackupex</b></a></h2>
Preparing incremental backups is a bit different than full ones. This is,
  perhaps, the stage where more attention is needed:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">First, <b>only the committed transactions must be replayed
      on each backup</b>. This will merge the base full backup with the
      incremental ones.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Then, the uncommitted transaction must be rolled back in
      order to have a ready-to-use backup.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
If you replay the committed transactions <b>and</b> rollback the uncommitted
  ones on the base backup, you will not be able to add the incremental ones. If
  you do this on an incremental one, you won't be able to add data from that
  moment and the remaining increments.
<div style="height: 1.00em;">&#x00A0;</div>
Having this in mind, the procedure is very straight-forward using the
  <b>--redo-only</b> option, starting with the base backup:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
innobackupex --apply-log --redo-only BASE-DIR
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
You should see an output similar to:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
120103 22:00:12 InnoDB: Shutdown completed; log sequence number 1291135
120103 22:00:12 innobackupex: completed OK!
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Then, the first incremental backup can be applied to the base backup, by
  issuing:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
innobackupex --apply-log --redo-only BASE-DIR --incremental-dir=INCREMENTAL-DIR-1
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
You should see an output similar to the previous one but with corresponding LSN:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
120103 22:08:43 InnoDB: Shutdown completed; log sequence number 1358967
120103 22:08:43 innobackupex: completed OK!
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
If no <b>--incremental-dir</b> is set, <b>innobackupex</b> will use the most
  recent subdirectory created in the basedir.
<div style="height: 1.00em;">&#x00A0;</div>
At this moment, <b>BASE-DIR</b> contains the data up to the moment of the first
  incremental backup. Note that the full data will always be in the directory of
  the base backup, as we are appending the increments to it.
<div style="height: 1.00em;">&#x00A0;</div>
Repeat the procedure with the second one:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
innobackupex --apply-log BASE-DIR --incremental-dir=INCREMENTAL-DIR-2
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
If the &quot;completed OK!&quot; message was shown, the final data will be in
  the base backup directory, <b>BASE-DIR</b>.
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;"><b>--redo-only</b> should be used when merging
  all incrementals except the last one. That's why the previous line doesn't
  contain the <b>--redo-only</b> option. Even if the <b>--redo-only</b> was used
  on the last step, backup would still be consistent but in that case server
  would perform the rollback phase.</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
You can use this procedure to add more increments to the base, as long as you do
  it in the chronological order that the backups were done. If you merge the
  incrementals in the wrong order, the backup will be useless. If you have
  doubts about the order that they must be applied, you can check the file
  <b>xtrabackup_checkpoints</b> at the directory of each one, as shown in the
  beginning of this section.
<div style="height: 1.00em;">&#x00A0;</div>
Once you merge the base with all the increments, you can prepare it to roll back
  the uncommitted transactions:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
innobackupex --apply-log BASE-DIR
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Now your backup is ready to be used immediately after restoring it. This
  preparation step is optional. However, if you restore without doing the
  prepare, the database server will begin to rollback uncommitted transactions,
  the same work it would do if a crash had occurred. This results in delay as
  the database server starts, and you can avoid the delay if you do the prepare.
<div style="height: 1.00em;">&#x00A0;</div>
Note that the <b>iblog*</b> files will not be created by <b>innobackupex</b>, if
  you want them to be created, use <b>xtrabackup --prepare</b> on the directory.
  Otherwise, the files will be created by the server once started.
<h2 class="Ss" title="Ss" id="Restoring_Incremental_Backups_with_innobackupex"><a class="selflink" href="#Restoring_Incremental_Backups_with_innobackupex">Restoring
  Incremental Backups with <b>innobackupex</b></a></h2>
After preparing the incremental backups, the base directory contains the same as
  a full one. For restoring it you can use:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
innobackupex --copy-back BASE-DIR
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
and you may have to change the ownership as detailed on restoring_a_backup_ibk.
<h2 class="Ss" title="Ss" id="Incremental_Streaming_Backups_using_xbstream_and_tar"><a class="selflink" href="#Incremental_Streaming_Backups_using_xbstream_and_tar">Incremental
  Streaming Backups using xbstream and tar</a></h2>
Incremental streaming backups can be performed with the xbstream streaming
  option. Currently backups are packed in custom <b>xbstream</b> format. With
  this feature taking a BASE backup is needed as well.
<div style="height: 1.00em;">&#x00A0;</div>
Taking a base backup:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
innobackupex /data/backups
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Taking a local backup:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
innobackupex --incremental --incremental-lsn=LSN-number --stream=xbstream ./ &gt; incremental.xbstream
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Unpacking the backup:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
xbstream -x &lt; incremental.xbstream
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Taking a local backup and streaming it to the remote server and unpacking it:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
innobackupex  --incremental --incremental-lsn=LSN-number --stream=xbstream ./ | /
ssh user@hostname &quot; cat - | xbstream -x -C &gt; /backup-dir/&quot;
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Partial_Backups"><a class="selflink" href="#Partial_Backups">Partial
  Backups</a></h2>
<i>Percona XtraBackup</i> features partial backups, which means that you may
  backup only some specific tables or databases. The tables you back up must be
  in separate tablespaces, as a result of being created or altered after you
  enabled the innodb_file_per_table option on the server.
<div style="height: 1.00em;">&#x00A0;</div>
There is only one caveat about partial backups: do not copy back the prepared
  backup. Restoring partial backups should be done by importing the tables, not
  by using the traditional <b>--copy-back</b> option. Although there are some
  scenarios where restoring can be done by copying back the files, this may be
  lead to database inconsistencies in many cases and it is not the recommended
  way to do it.
<h2 class="Ss" title="Ss" id="Creating_Partial_Backups"><a class="selflink" href="#Creating_Partial_Backups">Creating
  Partial Backups</a></h2>
There are three ways of specifying which part of the whole data will be backed
  up: regular expressions ( <b>--include</b>), enumerating the tables in a file
  ( <b>--tables-file</b>) or providing a list of databases (<b>--databases</b>).
<h2 class="Ss" title="Ss" id="Using_the_--include_option"><a class="selflink" href="#Using_the_--include_option">Using
  the <b>--include</b> option</a></h2>
The regular expression provided to this will be matched against the fully
  qualified table name, including the database name, in the form
  <b>databasename.tablename</b>.
<div style="height: 1.00em;">&#x00A0;</div>
For example,
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --include='^mydatabase[.]mytable' /path/to/backup
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The command above will create a timestamped directory with the usual files that
  <b>innobackupex</b> creates, but only the data files related to the tables
  matched.
<div style="height: 1.00em;">&#x00A0;</div>
Note that this option is passed to <b>xtrabackup --tables</b> and is matched
  against each table of each database, the directories of each database will be
  created even if they are empty.
<h2 class="Ss" title="Ss" id="Using_the_--tables-file_option"><a class="selflink" href="#Using_the_--tables-file_option">Using
  the <b>--tables-file</b> option</a></h2>
The text file provided (the path) to this option can contain multiple table
  names, one per line, in the <b>databasename.tablename</b> format.
<div style="height: 1.00em;">&#x00A0;</div>
For example,
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ echo &quot;mydatabase.mytable&quot; &gt; /tmp/tables.txt
$ innobackupex --tables-file=/tmp/tables.txt /path/to/backup
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The command above will create a timestamped directory with the usual files that
  <b>innobackupex</b> creates, but only containing the data-files related to the
  tables specified in the file.
<div style="height: 1.00em;">&#x00A0;</div>
This option is passed to <b>xtrabackup --tables-file</b> and, unlike the
  <b>--tables</b> option, only directories of databases of the selected tables
  will be created.
<h2 class="Ss" title="Ss" id="Using_the_--databases_option"><a class="selflink" href="#Using_the_--databases_option">Using
  the <b>--databases</b> option</a></h2>
This option accepts either a space-separated list of the databases and tables to
  backup - in the <b>databasename[.tablename]</b> form - or a file containing
  the list at one element per line.
<div style="height: 1.00em;">&#x00A0;</div>
For example,
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --databases=&quot;mydatabase.mytable mysql&quot; /path/to/backup
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The command above will create a timestamped directory with the usual files that
  <b>innobackupex</b> creates, but only containing the data-files related to
  <b>mytable</b> in the <b>mydatabase</b> directory and the <b>mysql</b>
  directory with the entire <b>mysql</b> database.
<h2 class="Ss" title="Ss" id="Preparing_Partial_Backups"><a class="selflink" href="#Preparing_Partial_Backups">Preparing
  Partial Backups</a></h2>
For preparing partial backups, the procedure is analogous to restoring
  individual tables : apply the logs and use the <b>--export</b> option:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --apply-log --export /path/to/partial/backup
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
You may see warnings in the output about tables that don't exist. This is
  because <i>InnoDB</i> -based engines stores its data dictionary inside the
  tablespace files besides the .frm files. <b>innobackupex</b> will use
  <b>xtrabackup</b> to remove the missing tables (those who weren't selected in
  the partial backup) from the data dictionary in order to avoid future warnings
  or errors:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
111225  0:54:06  InnoDB: Error: table 'mydatabase/mytablenotincludedinpartialb'
InnoDB: in InnoDB data dictionary has tablespace id 6,
InnoDB: but tablespace with that id or name does not exist. It will be removed from data dictionary.
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
You should also see the notification of the creation of a file needed for
  importing (.exp file) for each table included in the partial backup:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
xtrabackup: export option is specified.
xtrabackup: export metadata of table 'employees/departments' to file `.//departments.exp` (2 indexes)
xtrabackup:     name=PRIMARY, id.low=80, page=3
xtrabackup:     name=dept_name, id.low=81, page=4
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Note that you can use the <b>--export</b> option with <b>--apply-log</b> to an
  already-prepared backup in order to create the .exp files.
<div style="height: 1.00em;">&#x00A0;</div>
Finally, check the for the confirmation message in the output:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
111225 00:54:18  innobackupex: completed OK!
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Restoring_Partial_Backups"><a class="selflink" href="#Restoring_Partial_Backups">Restoring
  Partial Backups</a></h2>
Restoring should be done by restoring individual tables in the partial backup to
  the server.
<div style="height: 1.00em;">&#x00A0;</div>
It can also be done by copying back the prepared backup to a &quot;clean&quot;
  datadir (in that case, make sure to include the <b>mysql</b> database). System
  database can be created with:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ sudo mysql_install_db --user=mysql
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Compact_Backups"><a class="selflink" href="#Compact_Backups">Compact
  Backups</a></h2>
When doing the backup of <i>InnoDB</i> tables it's possible to omit the
  secondary index pages. This will make the backups more compact and this way
  they will take less space on disk. The downside of this is that the backup
  prepare process takes longer as those secondary indexes need to be recreated.
  Difference in backup size depends on the size of the secondary indexes.
<div style="height: 1.00em;">&#x00A0;</div>
For example full backup taken without and with the <b>--compact</b> option:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
#backup size without --compact
2.0G  2013-02-01_10-18-38
<div class="Pp"></div>
#backup size taken with --compact option
1.4G  2013-02-01_10-29-48
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">Compact backups are not supported for system
  table space, so in order to work correctly <b>innodb-file-per-table</b> option
  should be enabled.</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This feature was introduced in <i>Percona XtraBackup</i> 2.1.
<h2 class="Ss" title="Ss" id="Creating_Compact_Backups"><a class="selflink" href="#Creating_Compact_Backups">Creating
  Compact Backups</a></h2>
To make a compact backup innobackupex needs to be started with the
  <b>--compact</b> option:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --compact /data/backups
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This will create a timestamped directory in <b>/data/backups</b>.
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">You can use the <b>innobackupex
  --no-timestamp</b> option to override this behavior and the backup will be
  created in the given directory.</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
If you check at the <b>xtrabackup_checkpoints</b> file in <b>BASE-DIR</b>, you
  should see something like:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
backup_type = full-backuped
from_lsn = 0
to_lsn = 2888984349
last_lsn = 2888984349
compact = 1
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
When <b>--compact</b> wasn't used <b>compact</b> value will be <b>0</b>. This
  way it's easy to check if the backup contains the secondary index pages or
  not.
<h2 class="Ss" title="Ss" id="Preparing_Compact_Backups"><a class="selflink" href="#Preparing_Compact_Backups">Preparing
  Compact Backups</a></h2>
Preparing the compact require rebuilding the indexes as well. In order to
  prepare the backup a new option <b>--rebuild-indexes</b> should be used with
  <b>--apply-logs</b>:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --apply-log --rebuild-indexes /data/backups/2013-02-01_10-29-48
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Output, beside the standard <b>innobackupex</b> output, should contain the
  information about indexes being rebuilt, like:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
130201 10:40:20  InnoDB: Waiting for the background threads to start
Rebuilding indexes for table sbtest/sbtest1 (space id: 10)
  Found index k_1
  Dropping 1 index(es).
  Rebuilding 1 index(es).
Rebuilding indexes for table sbtest/sbtest2 (space id: 11)
  Found index k_1
  Found index c
  Found index k
  Found index c_2
  Dropping 4 index(es).
  Rebuilding 4 index(es).
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Since <i>Percona XtraBackup</i> has no information when applying an incremental
  backup to a compact full one, on whether there will be more incremental
  backups applied to it later or not, rebuilding indexes needs to be explicitly
  requested by a user whenever a full backup with some incremental backups
  merged is ready to be restored. Rebuilding indexes unconditionally on every
  incremental backup merge is not an option, since it is an expensive operation.
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">To process individual tables in parallel when
  rebuilding indexes, <b>innobackupex --rebuild-threads</b> option can be used
  to specify the number of threads started by <i>Percona XtraBackup</i> when
  rebuilding secondary indexes on --apply-log --rebuild-indexes. Each thread
  rebuilds indexes for a single <b>.ibd</b> tablespace at a time.</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Restoring_Compact_Backups"><a class="selflink" href="#Restoring_Compact_Backups">Restoring
  Compact Backups</a></h2>
<b>innobackupex</b> has a <b>--copy-back</b> option, which performs the
  restoration of a backup to the server's datadir
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --copy-back /path/to/BACKUP-DIR
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
It will copy all the data-related files back to the server's datadir, determined
  by the server's <b>my.cnf</b> configuration file. You should check the last
  line of the output for a success message:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
innobackupex: Finished copying back files.
130201 11:08:13  innobackupex: completed OK!
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Other_Reading"><a class="selflink" href="#Other_Reading">Other
  Reading</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>Feature preview: Compact backups in Percona
      XtraBackup</i></dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Encrypted_Backups"><a class="selflink" href="#Encrypted_Backups">Encrypted
  Backups</a></h2>
<i>Percona XtraBackup</i> has implemented support for encrypted backups. It can
  be used to encrypt/decrypt local or streaming backup with xbstream option
  (streaming tar backups are not supported) in order to add another layer of
  protection to the backups. Encryption is done with the <b>libgcrypt</b>
  library.
<h2 class="Ss" title="Ss" id="Creating_Encrypted_Backups"><a class="selflink" href="#Creating_Encrypted_Backups">Creating
  Encrypted Backups</a></h2>
To make an encrypted backup following options need to be specified (options
  <b>--encrypt-key</b> and <b>--encrypt-key-file</b> are mutually exclusive,
  i.e. just one of them needs to be provided):
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>--encryption=ALGORITHM</b> - currently supported
      algorithms are: <b>AES128</b>, <b>AES192</b> and <b>AES256</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>--encrypt-key=ENCRYPTION_KEY</b> - proper length
      encryption key to use. It is not recommended to use this option where
      there is uncontrolled access to the machine as the command line and thus
      the key can be viewed as part of the process info.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>--encrypt-key-file=KEYFILE</b> - the name of a file
      where the raw key of the appropriate length can be read from. The file
      must be a simple binary (or text) file that contains exactly the key to be
      used.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Both <b>--encrypt-key</b> option and <b>--encrypt-key-file</b> option can be
  used to specify the encryption key. Encryption key can be generated with
  command like:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ openssl rand -base64 24
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Example output of that command should look like this:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
GCHFLrDFVx6UAsRb88uLVbAVWbK+Yzfs
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This value then can be used as the encryption key
<h2 class="Ss" title="Ss" id="Using_the_--encrypt-key_option"><a class="selflink" href="#Using_the_--encrypt-key_option">Using
  the <b>--encrypt-key</b> option</a></h2>
Example of the innobackupex command using the <b>--encrypt-key</b> should look
  like this
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --encrypt=AES256 --encrypt-key=&quot;GCHFLrDFVx6UAsRb88uLVbAVWbK+Yzfs&quot; /data/backups
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Using_the_--encrypt-key-file_option"><a class="selflink" href="#Using_the_--encrypt-key-file_option">Using
  the <b>--encrypt-key-file</b> option</a></h2>
Example of the innobackupex command using the <b>--encrypt-key-file</b> should
  look like this
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --encrypt=AES256 --encrypt-key-file=/data/backups/keyfile /data/backups
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">Depending on the text editor used for making
  the <b>KEYFILE</b>, text file in some cases can contain the CRLF and this will
  cause the key size to grow and thus making it invalid. Suggested way to do
  this would be to create the file with: <b>echo -n
  &quot;GCHFLrDFVx6UAsRb88uLVbAVWbK+Yzfs&quot; &gt;
  /data/backups/keyfile</b></div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Both of these examples will create a timestamped directory in
  <b>/data/backups</b> containing the encrypted backup.
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">You can use the <b>innobackupex
  --no-timestamp</b> option to override this behavior and the backup will be
  created in the given directory.</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Optimizing_the_encryption_process"><a class="selflink" href="#Optimizing_the_encryption_process">Optimizing
  the encryption process</a></h2>
Two new options have been introduced with the encrypted backups that can be used
  to speed up the encryption process. These are <b>--encrypt-threads</b> and
  <b>--encrypt-chunk-size</b>. By using the <b>--encrypt-threads</b> option
  multiple threads can be specified to be used for encryption in parallel.
  Option <b>--encrypt-chunk-size</b> can be used to specify the size (in bytes)
  of the working encryption buffer for each encryption thread (default is 64K).
<h2 class="Ss" title="Ss" id="Decrypting_Encrypted_Backups"><a class="selflink" href="#Decrypting_Encrypted_Backups">Decrypting
  Encrypted Backups</a></h2>
Backups can be decrypted with xbcrypt. Following one-liner can be used to
  encrypt the whole folder:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ for i in `find . -iname &quot;*\.xbcrypt&quot;`; do xbcrypt -d --encrypt-key-file=/root/secret_key --encrypt-algo=AES256 &lt; $i &gt; $(dirname $i)/$(basename $i .xbcrypt) &amp;&amp; rm $i; done
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<i>Percona XtraBackup</i> <b>innobackupex --decrypt</b> option has been
  implemented that can be used to decrypt the backups:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --decrypt=AES256 --encrypt-key=&quot;GCHFLrDFVx6UAsRb88uLVbAVWbK+Yzfs&quot; /data/backups/2015-03-18_08-31-35/
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<i>Percona XtraBackup</i> doesn't automatically remove the encrypted files. In
  order to clean up the backup directory users should remove the
  <b>*.xbcrypt</b> files.
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;"><b>innobackupex --parallel</b> can be used
  with <b>innobackupex --decrypt</b> option to decrypt multiple files
  simultaneously.</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
When the files have been decrypted backup can be prepared.
<h2 class="Ss" title="Ss" id="Preparing_Encrypted_Backups"><a class="selflink" href="#Preparing_Encrypted_Backups">Preparing
  Encrypted Backups</a></h2>
After the backups have been decrypted, they can be prepared the same way as the
  standard full backups with the <b>--apply-logs</b> option:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --apply-log /data/backups/2015-03-18_08-31-35/
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;"><i>Percona XtraBackup</i> doesn't
  automatically remove the encrypted files. In order to clean up the backup
  directory users should remove the <b>*.xbcrypt</b> files.</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Restoring_Encrypted_Backups"><a class="selflink" href="#Restoring_Encrypted_Backups">Restoring
  Encrypted Backups</a></h2>
<b>innobackupex</b> has a <b>--copy-back</b> option, which performs the
  restoration of a backup to the server's datadir
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --copy-back /path/to/BACKUP-DIR
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
It will copy all the data-related files back to the server's datadir, determined
  by the server's <b>my.cnf</b> configuration file. You should check the last
  line of the output for a success message:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
innobackupex: Finished copying back files.
150318 11:08:13  innobackupex: completed OK!
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Other_Reading"><a class="selflink" href="#Other_Reading">Other
  Reading</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>The Libgcrypt Reference Manual</i></dd>
</dl>
</div>
<br/>
<h1 class="Sh" title="Sh" id="ADVANCED_FEATURES"><a class="selflink" href="#ADVANCED_FEATURES">ADVANCED
  FEATURES</a></h1>
<h2 class="Ss" title="Ss" id="Streaming_and_Compressing_Backups"><a class="selflink" href="#Streaming_and_Compressing_Backups">Streaming
  and Compressing Backups</a></h2>
Streaming mode, supported by <i>Percona XtraBackup</i>, sends backup to
  <b>STDOUT</b> in special <b>tar</b> or xbstream format instead of copying
  files to the backup directory.
<div style="height: 1.00em;">&#x00A0;</div>
This allows you to use other programs to filter the output of the backup,
  providing greater flexibility for storage of the backup. For example,
  compression is achieved by piping the output to a compression utility. One of
  the benefits of streaming backups and using Unix pipes is that the backups can
  be automatically encrypted.
<div style="height: 1.00em;">&#x00A0;</div>
To use the streaming feature, you must use the <b>--stream</b>, providing the
  format of the stream ( <b>tar</b> or <b>xbstream</b> ) and where to store the
  temporary files:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --stream=tar /tmp
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>innobackupex</b> starts <b>xtrabackup</b> in <b>--log-stream</b> mode in a
  child process, and redirects its log to a temporary file. It then uses
  xbstream to stream all of the data files to <b>STDOUT</b>, in a special
  <b>xbstream</b> format. See ../xbstream/xbstream for details. After it
  finishes streaming all of the data files to <b>STDOUT</b>, it stops xtrabackup
  and streams the saved log file too.
<div style="height: 1.00em;">&#x00A0;</div>
When compression is enabled, <b>xtrabackup</b> compresses all output data,
  except the meta and non-InnoDB files which are not compressed, using the
  specified compression algorithm. The only currently supported algorithm is
  <b>quicklz</b>. The resulting files have the qpress archive format, i.e. every
  *.qp file produced by xtrabackup is essentially a one-file qpress archive and
  can be extracted and uncompressed by the <i>qpress file archiver</i> which is
  available from Percona Software repositories.
<div style="height: 1.00em;">&#x00A0;</div>
Using xbstream as a stream option, backups can be copied and compressed in
  parallel which can significantly speed up the backup process. In case backups
  were both compressed and encrypted, they'll need to decrypted first in order
  to be uncompressed.
<h2 class="Ss" title="Ss" id="Examples_using_xbstream"><a class="selflink" href="#Examples_using_xbstream">Examples
  using xbstream</a></h2>
Store the complete backup directly to a single file:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --stream=xbstream /root/backup/ &gt; /root/backup/backup.xbstream
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
To stream and compress the backup:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --stream=xbstream --compress /root/backup/ &gt; /root/backup/backup.xbstream
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
To unpack the backup to the /root/backup/ directory:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ xbstream -x &lt;  backup.xbstream -C /root/backup/
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
To send the compressed backup to another host and unpack it:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --compress --stream=xbstream /root/backup/ | ssh user@otherhost &quot;xbstream -x -C /root/backup/&quot;
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Examples_using_tar"><a class="selflink" href="#Examples_using_tar">Examples
  using tar</a></h2>
Store the complete backup directly to a tar archive:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --stream=tar /root/backup/ &gt; /root/backup/out.tar
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
To send the tar archive to another host:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --stream=tar ./ | ssh user@destination \ &quot;cat - &gt; /data/backups/backup.tar&quot;
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>WARNING:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">To extract <i>Percona XtraBackup</i>'s archive
  you <b>must</b> use <b>tar</b> with <b>-i</b> option:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ tar -xizf backup.tar.gz
</pre>
</div>
<br/>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Compress with your preferred compression tool:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --stream=tar ./ | gzip - &gt; backup.tar.gz
$ innobackupex --stream=tar ./ | bzip2 - &gt; backup.tar.bz2
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Note that the streamed backup will need to be prepared before restoration.
  Streaming mode does not prepare the backup.
<h2 class="Ss" title="Ss" id="Taking_Backups_in_Replication_Environments"><a class="selflink" href="#Taking_Backups_in_Replication_Environments">Taking
  Backups in Replication Environments</a></h2>
There are options specific to back up from a replication slave.
<h2 class="Ss" title="Ss" id="The_--slave-info_option"><a class="selflink" href="#The_--slave-info_option">The
  <b>--slave-info</b> option</a></h2>
This option is useful when backing up a replication slave server. It prints the
  binary log position and name of the master server. It also writes this
  information to the <b>xtrabackup_slave_info</b> file as a <b>CHANGE MASTER</b>
  statement.
<div style="height: 1.00em;">&#x00A0;</div>
This is useful for setting up a new slave for this master can be set up by
  starting a slave server on this backup and issuing the statement saved in the
  <b>xtrabackup_slave_info</b> file. More details of this procedure can be found
  in replication_howto.
<h2 class="Ss" title="Ss" id="The_--safe-slave-backup_option"><a class="selflink" href="#The_--safe-slave-backup_option">The
  <b>--safe-slave-backup</b> option</a></h2>
In order to assure a consistent replication state, this option stops the slave
  SQL thread and wait to start backing up until <b>Slave_open_temp_tables</b> in
  <b>SHOW STATUS</b> is zero. If there are no open temporary tables, the backup
  will take place, otherwise the SQL thread will be started and stopped until
  there are no open temporary tables. The backup will fail if
  <b>Slave_open_temp_tables</b> does not become zero after
  <b>--safe-slave-backup-timeout</b> seconds (defaults to 300 seconds). The
  slave SQL thread will be restarted when the backup finishes.
<div style="height: 1.00em;">&#x00A0;</div>
Using this option is always recommended when taking backups from a slave server.
<div style="height: 1.00em;">&#x00A0;</div>
<b>WARNING:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">Make sure your slave is a true replica of the
  master before using it as a source for backup. A good tool to validate a slave
  is <i>pt-table-checksum</i>.</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Accelerating_the_backup_process"><a class="selflink" href="#Accelerating_the_backup_process">Accelerating
  the backup process</a></h2>
<h2 class="Ss" title="Ss" id="Accelerating_with_--parallel_copy_and_--compress-threads"><a class="selflink" href="#Accelerating_with_--parallel_copy_and_--compress-threads">Accelerating
  with <b>--parallel</b> copy and <i>--compress-threads</i></a></h2>
When performing a local backup or the streaming backup with xbstream option,
  multiple files can be copied concurrently by using the <b>--parallel</b>
  option. This option specifies the number of threads created by
  <b>xtrabackup</b> to copy data files.
<div style="height: 1.00em;">&#x00A0;</div>
To take advantage of this option either the multiple tablespaces option must be
  enabled (innodb_file_per_table) or the shared tablespace must be stored in
  multiple ibdata files with the innodb_data_file_path option. Having multiple
  files for the database (or splitting one into many) doesn't have a measurable
  impact on performance.
<div style="height: 1.00em;">&#x00A0;</div>
As this feature is implemented <b>at a file level</b>, concurrent file transfer
  can sometimes increase I/O throughput when doing a backup on highly fragmented
  data files, due to the overlap of a greater number of random read requests.
  You should consider tuning the filesystem also to obtain the maximum
  performance (e.g. checking fragmentation).
<div style="height: 1.00em;">&#x00A0;</div>
If the data is stored on a single file, this option will have no effect.
<div style="height: 1.00em;">&#x00A0;</div>
To use this feature, simply add the option to a local backup, for example:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --parallel=4 /path/to/backup
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
By using the xbstream in streaming backups you can additionally speed up the
  compression process by using the <b>--compress-threads</b> option. This option
  specifies the number of threads created by <b>xtrabackup</b> for for parallel
  data compression. The default value for this option is 1.
<div style="height: 1.00em;">&#x00A0;</div>
To use this feature, simply add the option to a local backup, for example
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --stream=xbstream --compress --compress-threads=4 ./ &gt; backup.xbstream
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Before applying logs, compressed files will need to be uncompressed.
<h2 class="Ss" title="Ss" id="Accelerating_with_--rsync_option"><a class="selflink" href="#Accelerating_with_--rsync_option">Accelerating
  with <b>--rsync</b> option</a></h2>
In order to speed up the backup process and to minimize the time <b>FLUSH TABLES
  WITH READ LOCK</b> is blocking the writes, option <b>innobackupex --rsync</b>
  should be used. When this option is specified, <b>innobackupex</b> uses
  <b>rsync</b> to copy all non-InnoDB files instead of spawning a separate
  <b>cp</b> for each file, which can be much faster for servers with a large
  number of databases or tables. <b>innobackupex</b> will call the <b>rsync</b>
  twice, once before the <b>FLUSH TABLES WITH READ LOCK</b> and once during to
  minimize the time the read lock is being held. During the second <b>rsync</b>
  call, it will only synchronize the changes to non-transactional data (if any)
  since the first call performed before the <b>FLUSH TABLES WITH READ LOCK</b>.
  Note that <i>Percona XtraBackup</i> will use <i>Backup locks</i> where
  available as a lightweight alternative to <b>FLUSH TABLES WITH READ LOCK</b>.
  This feature is available in <i>Percona Server</i> 5.6+. <i>Percona
  XtraBackup</i> uses this automatically to copy non-InnoDB data to avoid
  blocking DML queries that modify InnoDB tables.
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">This option cannot be used together with
  <b>innobackupex --remote-host</b> or <b>innobackupex --stream</b>
  options.</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Throttling_backups_with_innobackupex"><a class="selflink" href="#Throttling_backups_with_innobackupex">Throttling
  backups with <b>innobackupex</b></a></h2>
Although <b>innobackupex</b> does not block your database's operation, any
  backup can add load to the system being backed up. On systems that do not have
  much spare I/O capacity, it might be helpful to throttle the rate at which
  <b>innobackupex</b> reads and writes <i>InnoDB</i> data. You can do this with
  the <b>--throttle</b> option.
<div style="height: 1.00em;">&#x00A0;</div>
This option is passed directly to <b>xtrabackup</b> binary and only limits the
  operations on the logs and files of <i>InnoDB</i> tables. It doesn't have an
  effect on reading or writing files from tables with other storage engine.
<div style="height: 1.00em;">&#x00A0;</div>
One way of checking the current I/O operations at a system is with <b>iostat</b>
  command. See throttling_backups_xbk for details of how throttling works.
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;"><b>innobackupex --throttle</b> option works
  only during the backup phase, ie. it will not work with <b>innobackupex
  --apply-log</b> and <b>innobackupex --copy-back</b> options.</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The <b>--throttle</b> option is similar to the <b>--sleep</b> option in
  <b>mysqlbackup</b> and should be used instead of it, as <b>--sleep</b> will be
  ignored.
<h2 class="Ss" title="Ss" id="Restoring_Individual_Tables"><a class="selflink" href="#Restoring_Individual_Tables">Restoring
  Individual Tables</a></h2>
In server versions prior to 5.6, it is not possible to copy tables between
  servers by copying the files, even with innodb_file_per_table. However, with
  the <i>Percona XtraBackup</i>, you can export individual tables from any
  <i>InnoDB</i> database, and import them into <i>Percona Server</i> with
  <i>XtraDB</i> or <i>MySQL</i> 5.6 (The source doesn't have to be <i>XtraDB</i>
  or or <i>MySQL</i> 5.6, but the destination does). This only works on
  individual .ibd files, and cannot export a table that is not contained in its
  own .ibd file.
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">If you're running <i>Percona Server</i>
  version older than 5.5.10-20.1, variable <i>innodb_expand_import</i> should be
  used instead of <i>innodb_import_table_from_xtrabackup</i>.</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Exporting_tables"><a class="selflink" href="#Exporting_tables">Exporting
  tables</a></h2>
Exporting is done in the preparation stage, not at the moment of creating the
  backup. Once a full backup is created, prepare it with the <b>--export</b>
  option:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --apply-log --export /path/to/backup
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This will create for each <i>InnoDB</i> with its own tablespace a file with .exp
  extension. An output of this procedure would contain:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
..
xtrabackup: export option is specified.
xtrabackup: export metadata of table 'mydatabase/mytable' to file
`./mydatabase/mytable.exp` (1 indexes)
..
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Now you should see a .exp file in the target directory:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ find /data/backups/mysql/ -name export_test.*
/data/backups/mysql/test/export_test.exp
/data/backups/mysql/test/export_test.ibd
/data/backups/mysql/test/export_test.cfg
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
These three files are all you need to import the table into a server running
  <i>Percona Server</i> with <i>XtraDB</i> or <i>MySQL</i> 5.6.
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;"><i>MySQL</i> uses <b>.cfg</b> file which
  contains <i>InnoDB</i> dictionary dump in special format. This format is
  different from the <b>.exp</b> one which is used in <i>XtraDB</i> for the same
  purpose. Strictly speaking, a <b>.cfg</b> file is <b>not</b> required to
  import a tablespace to <i>MySQL</i> 5.6 or <i>Percona Server</i> 5.6. A
  tablespace will be imported successfully even if it is from another server,
  but <i>InnoDB</i> will do schema validation if the corresponding <b>.cfg</b>
  file is present in the same directory.</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Each .exp (or <b>.cfg</b>) file will be used for importing that table.
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">InnoDB does a slow shutdown (i.e. full purge +
  change buffer merge) on --export, otherwise the tablespaces wouldn't be
  consistent and thus couldn't be imported. All the usual performance
  considerations apply: sufficient buffer pool (i.e. --use-memory, 100MB by
  default) and fast enough storage, otherwise it can take a prohibitive amount
  of time for export to complete.</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Importing_tables"><a class="selflink" href="#Importing_tables">Importing
  tables</a></h2>
To import a table to other server, first create a new table with the same
  structure as the one that will be imported at that server:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
OTHERSERVER|mysql&gt; CREATE TABLE mytable (...) ENGINE=InnoDB;
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
then discard its tablespace:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
OTHERSERVER|mysql&gt; ALTER TABLE mydatabase.mytable DISCARD TABLESPACE;
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
After this, copy <b>mytable.ibd</b> and <b>mytable.exp</b> ( or
  <b>mytable.cfg</b> if importing to <i>MySQL</i> 5.6) files to database's home,
  and import its tablespace:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
OTHERSERVER|mysql&gt; ALTER TABLE mydatabase.mytable IMPORT TABLESPACE;
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Once this is executed, data in the imported table will be available.
<h2 class="Ss" title="Ss" id="Point-In-Time_recovery"><a class="selflink" href="#Point-In-Time_recovery">Point-In-Time
  recovery</a></h2>
Recovering up to particular moment in database's history can be done with
  <b>innobackupex</b> and the binary logs of the server.
<div style="height: 1.00em;">&#x00A0;</div>
Note that the binary log contains the operations that modified the database from
  a point in the past. You need a full datadir as a base, and then you can apply
  a series of operations from the binary log to make the data match what it was
  at the point in time you want.
<div style="height: 1.00em;">&#x00A0;</div>
For taking the snapshot, we will use <b>innobackupex</b> for a full backup:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex /path/to/backup --no-timestamp
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
(the <b>--no-timestamp</b> option is for convenience in this example) and we
  will prepare it to be ready for restoration:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --apply-log /path/to/backup
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
For more details on these procedures, see creating_a_backup_ibk and
  preparing_a_backup_ibk.
<div style="height: 1.00em;">&#x00A0;</div>
Now, suppose that time has passed, and you want to restore the database to a
  certain point in the past, having in mind that there is the constraint of the
  point where the snapshot was taken.
<div style="height: 1.00em;">&#x00A0;</div>
To find out what is the situation of binary logging in the server, execute the
  following queries:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
mysql&gt; SHOW BINARY LOGS;
+------------------+-----------+
| Log_name         | File_size |
+------------------+-----------+
| mysql-bin.000001 |       126 |
| mysql-bin.000002 |      1306 |
| mysql-bin.000003 |       126 |
| mysql-bin.000004 |       497 |
+------------------+-----------+
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
and
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
mysql&gt; SHOW MASTER STATUS;
+------------------+----------+--------------+------------------+
| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |
+------------------+----------+--------------+------------------+
| mysql-bin.000004 |      497 |              |                  |
+------------------+----------+--------------+------------------+
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The first query will tell you which files contain the binary log and the second
  one which file is currently being used to record changes, and the current
  position within it. Those files are stored usually in the datadir (unless
  other location is specified when the server is started with the
  <b>--log-bin=</b> option).
<div style="height: 1.00em;">&#x00A0;</div>
To find out the position of the snapshot taken, see the
  <b>xtrabackup_binlog_info</b> at the backup's directory:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ cat /path/to/backup/xtrabackup_binlog_info
mysql-bin.000003      57
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This will tell you which file was used at moment of the backup for the binary
  log and its position. That position will be the effective one when you restore
  the backup:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --copy-back /path/to/backup
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
As the restoration will not affect the binary log files (you may need to adjust
  file permissions, see restoring_a_backup_ibk), the next step is extracting the
  queries from the binary log with <b>mysqlbinlog</b> starting from the position
  of the snapshot and redirecting it to a file
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ mysqlbinlog /path/to/datadir/mysql-bin.000003 /path/to/datadir/mysql-bin.000004 \
    --start-position=57 &gt; mybinlog.sql
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Note that if you have multiple files for the binary log, as in the example, you
  have to extract the queries with one process, as shown above.
<div style="height: 1.00em;">&#x00A0;</div>
Inspect the file with the queries to determine which position or date
  corresponds to the point-in-time wanted. Once determined, pipe it to the
  server. Assuming the point is <b>11-12-25 01:00:00</b>:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ mysqlbinlog /path/to/datadir/mysql-bin.000003 /path/to/datadir/mysql-bin.000004 \
    --start-position=57 --stop-datetime=&quot;11-12-25 01:00:00&quot; | mysql -u root -p
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
and the database will be rolled forward up to that Point-In-Time.
<h2 class="Ss" title="Ss" id="Improved_FLUSH_TABLES_WITH_READ_LOCK_handling"><a class="selflink" href="#Improved_FLUSH_TABLES_WITH_READ_LOCK_handling">Improved
  <b>FLUSH</b> <b>TABLES</b> <b>WITH</b> <b>READ</b> <b>LOCK</b>
  handling</a></h2>
When taking backups, <b>FLUSH TABLES WITH READ LOCK</b> is being used before the
  non-InnoDB files are being backed up to ensure backup is being consistent.
  <b>FLUSH TABLES WITH READ LOCK</b> can be run even though there may be a
  running query that has been executing for hours. In this case everything will
  be locked up in <b>Waiting for table flush</b> or <b>Waiting for master to
  send event</b> states. Killing the <b>FLUSH TABLES WITH READ LOCK</b> does not
  correct this issue either. In this case the only way to get the server
  operating normally again is to kill off the long running queries that blocked
  it to begin with. This means that if there are long running queries <b>FLUSH
  TABLES WITH READ LOCK</b> can get stuck, leaving server in read-only mode
  until waiting for these queries to complete.
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">All described in this section has no effect
  when backup locks are used. <i>Percona XtraBackup</i> will use <i>Backup
  locks</i> where available as a lightweight alternative to <b>FLUSH TABLES WITH
  READ LOCK</b>. This feature is available in <i>Percona Server</i> 5.6+.
  <i>Percona XtraBackup</i> uses this automatically to copy non-InnoDB data to
  avoid blocking DML queries that modify InnoDB tables.</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
In order to prevent this from happening two things have been implemented:
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>innobackupex</b> can wait for a good moment to issue the
      global lock.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>innobackupex</b> can kill all or only SELECT queries
      which are preventing the global lock from being acquired</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Waiting_for_queries_to_finish"><a class="selflink" href="#Waiting_for_queries_to_finish">Waiting
  for queries to finish</a></h2>
Good moment to issue a global lock is the moment when there are no long queries
  running. But waiting for a good moment to issue the global lock for extended
  period of time isn't always good approach, as it can extend the time needed
  for backup to take place. To prevent <b>innobackupex</b> from waiting to issue
  <b>FLUSH TABLES WITH READ LOCK</b> for too long, new option has been
  implemented: <b>innobackupex --ftwrl-wait-timeout</b> option can be used to
  limit the waiting time. If the good moment to issue the lock did not happen
  during this time, <b>innobackupex</b> will give up and exit with an error
  message and backup will not be taken. Zero value for this option turns off the
  feature (which is default).
<div style="height: 1.00em;">&#x00A0;</div>
Another possibility is to specify the type of query to wait on. In this case
  <b>innobackupex --ftwrl-wait-query-type</b>. Possible values are <b>all</b>
  and <b>update</b>. When <b>all</b> is used <b>innobackupex</b> will wait for
  all long running queries (execution time longer than allowed by
  <b>innobackupex --ftwrl-wait-threshold</b>) to finish before running the
  <b>FLUSH TABLES WITH READ LOCK</b>. When <b>update</b> is used
  <b>innobackupex</b> will wait on <b>UPDATE/ALTER/REPLACE/INSERT</b> queries to
  finish.
<div style="height: 1.00em;">&#x00A0;</div>
Although time needed for specific query to complete is hard to predict, we can
  assume that queries that are running for a long time already will likely not
  be completed soon, and queries which are running for a short time will likely
  be completed shortly. <b>innobackupex</b> can use the value of <b>innobackupex
  --ftwrl-wait-threshold</b> option to specify which query is long running and
  will likely block global lock for a while. In order to use this option
  xtrabackup user should have <b>PROCESS</b> and <b>SUPER</b> privileges.
<h2 class="Ss" title="Ss" id="Killing_the_blocking_queries"><a class="selflink" href="#Killing_the_blocking_queries">Killing
  the blocking queries</a></h2>
Second option is to kill all the queries which prevent global lock from being
  acquired. In this case all the queries which run longer than <b>FLUSH TABLES
  WITH READ LOCK</b> are possible blockers. Although all queries can be killed,
  additional time can be specified for the short running queries to complete.
  This can be specified by <b>innobackupex --kill-long-queries-timeout</b>
  option. This option specifies the time for queries to complete, after the
  value is reached, all the running queries will be killed. Default value is
  zero, which turns this feature off.
<div style="height: 1.00em;">&#x00A0;</div>
<b>innobackupex --kill-long-query-type</b> option can be used to specify all or
  only <b>SELECT</b> queries that are preventing global lock from being
  acquired. In order to use this option xtrabackup user should have
  <b>PROCESS</b> and <b>SUPER</b> privileges.
<h2 class="Ss" title="Ss" id="Options_summary"><a class="selflink" href="#Options_summary">Options
  summary</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>--ftwrl-wait-timeout=N</b> (seconds) - how long to wait
      for a good moment. Default is 0, not to wait.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>--ftwrl-wait-query-type={all|update}</b> - which long
      queries should be finished before <b>FLUSH TABLES WITH READ LOCK</b> is
      run. Default is all.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>--ftwrl-wait-threshold=N</b> (seconds) - how long query
      should be running before we consider it long running and potential blocker
      of global lock.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>--kill-long-queries-timeout=N</b> (seconds) - how many
      time we give for queries to complete after <b>FLUSH TABLES WITH READ
      LOCK</b> is issued before start to kill. Default if <b>0</b>, not to
    kill.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>--kill-long-query-type={all|select}</b> - which queries
      should be killed once <b>kill-long-queries-timeout</b> has expired.</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Example"><a class="selflink" href="#Example">Example</a></h2>
Running the <b>innobackupex</b> with the following options:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ innobackupex --ftwrl-wait-threshold=40 --ftwrl-wait-query-type=all --ftwrl-wait-timeout=180 --kill-long-queries-timeout=20 --kill-long-query-type=all /data/backups/
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
will cause <b>innobackupex</b> to spend no longer than 3 minutes waiting for all
  queries older than 40 seconds to complete. After <b>FLUSH TABLES WITH READ
  LOCK</b> is issued, <b>innobackupex</b> will wait 20 seconds for lock to be
  acquired. If lock is still not acquired after 20 seconds, it will kill all
  queries which are running longer that the <b>FLUSH TABLES WITH READ LOCK</b>.
<h2 class="Ss" title="Ss" id="Store_backup_history_on_the_server"><a class="selflink" href="#Store_backup_history_on_the_server">Store
  backup history on the server</a></h2>
<i>Percona XtraBackup</i> supports storing the backups history on the server.
  This feature was implemented in <i>Percona XtraBackup</i> 2.2. Storing backup
  history on the server was implemented to provide users with additional
  information about backups that are being taken. Backup history information
  will be stored in the <i>PERCONA_SCHEMA.XTRABACKUP_HISTORY</i> table.
<div style="height: 1.00em;">&#x00A0;</div>
To use this feature three new <b>innobackupex</b> options have been implemented:
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>innobackupex --history</b> =&lt;name&gt; : This option
      enables the history feature and allows the user to specify a backup series
      name that will be placed within the history record.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>innobackupex --incremental-history-name</b>
      =&lt;name&gt; : This option allows an incremental backup to be made based
      on a specific history series by name. <b>innobackupex</b> will search the
      history table looking for the most recent (highest <b>to_lsn</b>) backup
      in the series and take the <b>to_lsn</b> value to use as it's starting
      lsn. This is mutually exclusive with <b>innobackupex
      --incremental-history-uuid</b>, <b>innobackupex --incremental-basedir</b>
      and <b>innobackupex --incremental-lsn</b> options. If no valid LSN can be
      found (no series by that name) <b>innobackupex</b> will return with an
      error.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>innobackupex --incremental-history-uuid</b>
      =&lt;uuid&gt; : Allows an incremental backup to be made based on a
      specific history record identified by UUID. <b>innobackupex</b> will
      search the history table looking for the record matching UUID and take the
      <b>to_lsn</b> value to use as it's starting LSN. This options is mutually
      exclusive with <b>innobackupex --incremental-basedir</b>, <b>innobackupex
      --incremental-lsn</b> and <b>innobackupex --incremental-history-name</b>
      options. If no valid LSN can be found (no record by that UUID or missing
      <b>to_lsn</b>), <b>innobackupex</b> will return with an error.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">Backup that's currently being performed will
  <b>NOT</b> exist in the xtrabackup_history table within the resulting backup
  set as the record will not be added to that table until after the backup has
  been taken.</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
If you want access to backup history outside of your backup set in the case of
  some catastrophic event, you will need to either perform a <b>mysqldump</b>,
  partial backup or <b>SELECT</b> * on the history table after
  <b>innobackupex</b> completes and store the results with you backup set.
<h2 class="Ss" title="Ss" id="Privileges"><a class="selflink" href="#Privileges">Privileges</a></h2>
User performing the backup will need following privileges:
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>CREATE</b> privilege in order to create the
      <i>PERCONA_SCHEMA.xtrabackup_history</i> database and table.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>INSERT</b> privilege in order to add history records to
      the <i>PERCONA_SCHEMA.xtrabackup_history</i> table.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>SELECT</b> privilege in order to use <b>innobackupex
      --incremental-history-name</b> or <b>innobackupex
      --incremental-history-uuid</b> in order for the feature to look up the
      <b>innodb_to_lsn</b> values in the
      <i>PERCONA_SCHEMA.xtrabackup_history</i> table.</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="PERCONA_SCHEMA.XTRABACKUP_HISTORY_table"><a class="selflink" href="#PERCONA_SCHEMA.XTRABACKUP_HISTORY_table">PERCONA_SCHEMA.XTRABACKUP_HISTORY
  table</a></h2>
This table contains the information about the previous server backups.
  Information about the backups will only be written if the backup was taken
  with <b>innobackupex --history</b> option.
<table class="tbl">
  <colgroup>
    <col style="width: 16.00ex;"/>
    <col style="width: 131.00ex;"/>
  </colgroup>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>Column Name</td>
    <td>Description</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>uuid</td>
    <td>Unique backup id</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>name</td>
    <td>User provided name of backup series. There may be multiple entries with
      the same name used to identify related backups in a series.</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>tool_name</td>
    <td>Name of tool used to take backup</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>tool_command</td>
    <td>Exact command line given to the tool with --password and
      --encryption_key obfuscated</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>tool_version</td>
    <td>Version of tool used to take backup</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>ibbackup_version</td>
    <td>Version of the xtrabackup binary used to take backup</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>server_version</td>
    <td>Server version on which backup was taken</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>start_time</td>
    <td>Time at the start of the backup</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>end_time</td>
    <td>Time at the end of the backup</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>lock_time</td>
    <td>Amount of time, in seconds, spent calling and holding locks for <b>FLUSH
      TABLES WITH READ LOCK</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>binlog_pos</td>
    <td>Binlog file and position at end of <b>FLUSH TABLES WITH READ
      LOCK</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>innodb_from_lsn</td>
    <td>LSN at beginning of backup which can be used to determine prior
      backups</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>innodb_to_lsn</td>
    <td>LSN at end of backup which can be used as the starting lsn for the next
      incremental</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>partial</td>
    <td>Is this a partial backup, if <b>N</b> that means that it's the full
      backup</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>incremental</td>
    <td>Is this an incremental backup</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>format</td>
    <td>Description of result format (<b>file</b>, <b>tar</b>,
      <b>xbstream</b>)</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>compact</td>
    <td>Is this a compact backup</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>compressed</td>
    <td>Is this a compressed backup</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>encrypted</td>
    <td>Is this an encrypted backup</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
</table>
<h2 class="Ss" title="Ss" id="Limitations"><a class="selflink" href="#Limitations">Limitations</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>innobackupex --history</b> option must be specified only
      on the innobackupex command line and not within a configuration file in
      order to be effective.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>innobackupex --incremental-history-name</b> and
      <b>innobackupex --incremental-history-uuid</b> options must be specified
      only on the innobackupex command line and not within a configuration file
      in order to be effective.</dd>
</dl>
</div>
<br/>
<h1 class="Sh" title="Sh" id="IMPLEMENTATION"><a class="selflink" href="#IMPLEMENTATION">IMPLEMENTATION</a></h1>
<h2 class="Ss" title="Ss" id="How_innobackupex_Works"><a class="selflink" href="#How_innobackupex_Works">How
  <b>innobackupex</b> Works</a></h2>
From <i>Percona XtraBackup</i> version 2.3 <b>innobackupex</b> is has been
  rewritten in <i>C</i> and set up as a symlink to the <b>xtrabackup</b>.
  <b>innobackupex</b> supports all features and syntax as 2.2 version did, but
  it is now deprecated and will be removed in next major release. Syntax for new
  features will not be added to the innobackupex, only to the xtrabackup.
<div style="height: 1.00em;">&#x00A0;</div>
The following describes the rationale behind <b>innobackupex</b> actions.
<h2 class="Ss" title="Ss" id="Making_a_Backup"><a class="selflink" href="#Making_a_Backup">Making
  a Backup</a></h2>
If no mode is specified, <b>innobackupex</b> will assume the backup mode.
<div style="height: 1.00em;">&#x00A0;</div>
By default, it starts <b>xtrabackup</b> with the <b>--suspend-at-end</b> option,
  and lets it copy the InnoDB data files. When <b>xtrabackup</b> finishes that,
  <b>innobackupex</b> sees it create the <b>xtrabackup_suspended_2</b> file and
  executes <b>FLUSH TABLES WITH READ LOCK</b>. <b>xtrabackup</b> will use
  <i>Backup locks</i> where available as a lightweight alternative to <b>FLUSH
  TABLES WITH READ LOCK</b>. This feature is available in <i>Percona Server</i>
  5.6+. <i>Percona XtraBackup</i> uses this automatically to copy non-InnoDB
  data to avoid blocking DML queries that modify InnoDB tables. Then it begins
  copying the rest of the files.
<div style="height: 1.00em;">&#x00A0;</div>
<b>innobackupex</b> will then check <i>MySQL</i> variables to determine which
  features are supported by server. Special interest are backup locks, changed
  page bitmaps, GTID mode, etc. If everything goes well, the binary is started
  as a child process.
<div style="height: 1.00em;">&#x00A0;</div>
<b>innobackupex</b> will wait for slaves in a replication setup if the option
  <b>--safe-slave-backup</b> is set and will flush all tables with <b>READ
  LOCK</b>, preventing all <i>MyISAM</i> tables from writing (unless option
  <b>--no-lock</b> is specified).
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">Locking is done only for MyISAM and other
  non-InnoDB tables, and only <b>after</b> <i>Percona XtraBackup</i> is finished
  backing up all InnoDB/XtraDB data and logs. <i>Percona XtraBackup</i> will use
  <i>Backup locks</i> where available as a lightweight alternative to <b>FLUSH
  TABLES WITH READ LOCK</b>. This feature is available in <i>Percona Server</i>
  5.6+. <i>Percona XtraBackup</i> uses this automatically to copy non-InnoDB
  data to avoid blocking DML queries that modify InnoDB tables.</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Once this is done, the backup of the files will begin. It will backup .frm,
  .MRG, .MYD, .MYI, .TRG, .TRN, .ARM, .ARZ, .CSM, .CSV, <b>.par</b>, and .opt
  files.
<div style="height: 1.00em;">&#x00A0;</div>
When all the files are backed up, it resumes <b>ibbackup</b> and wait until it
  finishes copying the transactions done while the backup was done. Then, the
  tables are unlocked, the slave is started (if the option
  <b>--safe-slave-backup</b> was used) and the connection with the server is
  closed. Then, it removes the <b>xtrabackup_suspended_2</b> file and permits
  <b>xtrabackup</b> to exit.
<div style="height: 1.00em;">&#x00A0;</div>
It will also create the following files in the directory of the backup:
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>xtrabackup_checkpoints</b></b></dt>
  <dd class="It-tag">containing the LSN and the type of backup;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>xtrabackup_binlog_info</b></b></dt>
  <dd class="It-tag">containing the position of the binary log at the moment of
      backing up;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>xtrabackup_binlog_pos_innodb</b></b></dt>
  <dd class="It-tag">containing the position of the binary log at the moment of
      backing up relative to <i>InnoDB</i> transactions;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>xtrabackup_slave_info</b></b></dt>
  <dd class="It-tag">containing the MySQL binlog position of the master server
      in a replication setup via <b>SHOW SLAVE STATUS</b> if the
      <b>--slave-info</b> option is passed;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>backup-my.cnf</b></b></dt>
  <dd class="It-tag">containing only the <b>my.cnf</b> options required for the
      backup. For example, innodb_data_file_path, innodb_log_files_in_group,
      innodb_log_file_size, innodb_fast_checksum, innodb_page_size,
      innodb_log_block_size;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>xtrabackup_binary</b></b></dt>
  <dd class="It-tag">containing the binary used for the backup;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>mysql-stderr</b></b></dt>
  <dd class="It-tag">containing the <b>STDERR</b> of <b>mysqld</b> during the
      process and</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>mysql-stdout</b></b></dt>
  <dd class="It-tag">containing the <b>STDOUT</b> of the server.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Finally, the binary log position will be printed to <b>STDERR</b> and
  <b>innobackupex</b> will exit returning 0 if all went OK.
<div style="height: 1.00em;">&#x00A0;</div>
Note that the <b>STDERR</b> of <b>innobackupex</b> is not written in any file.
  You will have to redirect it to a file, e.g., <b>innobackupex OPTIONS 2&gt;
  backupout.log</b>.
<h2 class="Ss" title="Ss" id="Restoring_a_backup"><a class="selflink" href="#Restoring_a_backup">Restoring
  a backup</a></h2>
To restore a backup with <b>innobackupex</b> the <b>--copy-back</b> option must
  be used.
<div style="height: 1.00em;">&#x00A0;</div>
<b>innobackupex</b> will read from the <b>my.cnf</b> the variables datadir,
  innodb_data_home_dir, innodb_data_file_path, innodb_log_group_home_dir and
  check that the directories exist.
<div style="height: 1.00em;">&#x00A0;</div>
It will copy the <i>MyISAM</i> tables, indexes, etc. (.frm, .MRG, .MYD, .MYI,
  .TRG, .TRN, .ARM, .ARZ, .CSM, .CSV, <b>par</b> and .opt files) first,
  <i>InnoDB</i> tables and indexes next and the log files at last. It will
  preserve file's attributes when copying them, you may have to change the
  files' ownership to <b>mysql</b> before starting the database server, as they
  will be owned by the user who created the backup.
<div style="height: 1.00em;">&#x00A0;</div>
Alternatively, the <b>--move-back</b> option may be used to restore a backup.
  This option is similar to <b>--copy-back</b> with the only difference that
  instead of copying files it moves them to their target locations. As this
  option removes backup files, it must be used with caution. It is useful in
  cases when there is not enough free disk space to hold both data files and
  their backup copies.
<h1 class="Sh" title="Sh" id="REFERENCES"><a class="selflink" href="#REFERENCES">REFERENCES</a></h1>
<h2 class="Ss" title="Ss" id="The_innobackupex_Option_Reference"><a class="selflink" href="#The_innobackupex_Option_Reference">The
  <b>innobackupex</b> Option Reference</a></h2>
This page documents all of the command-line options for the <b>innobackupex</b>.
<h2 class="Ss" title="Ss" id="Options"><a class="selflink" href="#Options">Options</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--apply-log</b></dt>
  <dd class="It-tag">Prepare a backup in <b>BACKUP-DIR</b> by applying the
      transaction log file named <b>xtrabackup_logfile</b> located in the same
      directory. Also, create new transaction logs. The InnoDB configuration is
      read from the file <b>backup-my.cnf</b> created by <b>innobackupex</b>
      when the backup was made. innobackupex --apply-log uses InnoDB
      configuration from <b>backup-my.cnf</b> by default, or from
      --defaults-file, if specified. InnoDB configuration in this context means
      server variables that affect data format, i.e. <b>innodb_page_size</b>,
      <b>innodb_log_block_size</b>, etc. Location-related variables, like
      <b>innodb_log_group_home_dir</b> or <b>innodb_data_file_path</b> are
      always ignored by --apply-log, so preparing a backup always works with
      data files from the backup directory, rather than any external ones.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--backup-locks</b></dt>
  <dd class="It-tag">This option controls if backup locks should be used instead
      of <b>FLUSH TABLES WITH READ LOCK</b> on the backup stage. The option has
      no effect when backup locks are not supported by the server. This option
      is enabled by default, disable with <b>--no-backup-locks</b>.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--close-files</b></dt>
  <dd class="It-tag">Do not keep files opened. This option is passed directly to
      xtrabackup. When xtrabackup opens tablespace it normally doesn't close its
      file handle in order to handle the DDL operations correctly. However, if
      the number of tablespaces is really huge and can not fit into any limit,
      there is an option to close file handles once they are no longer accessed.
      <i>Percona XtraBackup</i> can produce inconsistent backups with this
      option enabled. Use at your own risk.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--compact</b></dt>
  <dd class="It-tag">Create a compact backup with all secondary index pages
      omitted. This option is passed directly to xtrabackup. See the
      <b>xtrabackup</b> documentation for details.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--compress</b></dt>
  <dd class="It-tag">This option instructs xtrabackup to compress backup copies
      of InnoDB data files. It is passed directly to the xtrabackup child
      process. See the <b>xtrabackup</b> documentation for details.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--compress-threads=#</b></dt>
  <dd class="It-tag">This option specifies the number of worker threads that
      will be used for parallel compression. It is passed directly to the
      xtrabackup child process. See the <b>xtrabackup</b> documentation for
      details.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--compress-chunk-size=#</b></dt>
  <dd class="It-tag">This option specifies the size of the internal working
      buffer for each compression thread, measured in bytes. It is passed
      directly to the xtrabackup child process. The default value is 64K. See
      the <b>xtrabackup</b> documentation for details.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--copy-back</b></dt>
  <dd class="It-tag">Copy all the files in a previously made backup from the
      backup directory to their original locations. <i>Percona XtraBackup</i>
      <i>innobackupex --copy-back</i> option will not copy over existing files
      unless <i>innobackupex --force-non-empty-directories</i> option is
      specified.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--databases=LIST</b></dt>
  <dd class="It-tag">This option specifies the list of databases that
      <b>innobackupex</b> should back up. The option accepts a string argument
      or path to file that contains the list of databases to back up. The list
      is of the form &quot;databasename1[.table_name1]
      databasename2[.table_name2] . . .&quot;. If this option is not specified,
      all databases containing <i>MyISAM</i> and <i>InnoDB</i> tables will be
      backed up. Please make sure that --databases contains all of the
      <i>InnoDB</i> databases and tables, so that all of the innodb.frm files
      are also backed up. In case the list is very long, this can be specified
      in a file, and the full path of the file can be specified instead of the
      list. (See option --tables-file.)</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--decompress</b></dt>
  <dd class="It-tag">Decompresses all files with the .qp extension in a backup
      previously made with the --compress option. The <i>innobackupex
      --parallel</i> option will allow multiple files to be decrypted and/or
      decompressed simultaneously. In order to decompress, the qpress utility
      MUST be installed and accessible within the path. <i>Percona
      XtraBackup</i> doesn't automatically remove the compressed files. In order
      to clean up the backup directory users should remove the <b>*.qp</b> files
      manually.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--decrypt=ENCRYPTION-ALGORITHM</b></dt>
  <dd class="It-tag">Decrypts all files with the .xbcrypt extension in a backup
      previously made with --encrypt option. The <i>innobackupex --parallel</i>
      option will allow multiple files to be decrypted and/or decompressed
      simultaneously.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--defaults-file=[MY.CNF]</b></dt>
  <dd class="It-tag">This option accepts a string argument that specifies what
      file to read the default MySQL options from. Must be given as the first
      option on the command-line.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--defaults-extra-file=[MY.CNF]</b></dt>
  <dd class="It-tag">This option specifies what extra file to read the default
      <i>MySQL</i> options from before the standard defaults-file. Must be given
      as the first option on the command-line.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--defaults-group=GROUP-NAME</b></dt>
  <dd class="It-tag">This option accepts a string argument that specifies the
      group which should be read from the configuration file. This is needed if
      you use mysqld_multi. This can also be used to indicate groups other than
      mysqld and xtrabackup.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--encrypt=ENCRYPTION_ALGORITHM</b></dt>
  <dd class="It-tag">This option instructs xtrabackup to encrypt backup copies
      of InnoDB data files using the algorithm specified in the
      ENCRYPTION_ALGORITHM. It is passed directly to the xtrabackup child
      process. See the <b>xtrabackup</b> documentation for more details.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--encrypt-key=ENCRYPTION_KEY</b></dt>
  <dd class="It-tag">This option instructs xtrabackup to use the given
      ENCRYPTION_KEY when using the --encrypt option. It is passed directly to
      the xtrabackup child process. See the <b>xtrabackup</b> documentation for
      more details.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--encrypt-key-file=ENCRYPTION_KEY_FILE</b></dt>
  <dd class="It-tag">This option instructs xtrabackup to use the encryption key
      stored in the given ENCRYPTION_KEY_FILE when using the --encrypt option.
      It is passed directly to the xtrabackup child process. See the
      <b>xtrabackup</b> documentation for more details.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--encrypt-threads=#</b></dt>
  <dd class="It-tag">This option specifies the number of worker threads that
      will be used for parallel encryption. It is passed directly to the
      xtrabackup child process. See the <b>xtrabackup</b> documentation for more
      details.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--encrypt-chunk-size=#</b></dt>
  <dd class="It-tag">This option specifies the size of the internal working
      buffer for each encryption thread, measured in bytes. It is passed
      directly to the xtrabackup child process. See the <b>xtrabackup</b>
      documentation for more details.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--export</b></dt>
  <dd class="It-tag">This option is passed directly to <b>xtrabackup
      --export</b> option. It enables exporting individual tables for import
      into another server. See the <b>xtrabackup</b> documentation for
    details.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--extra-lsndir=DIRECTORY</b></dt>
  <dd class="It-tag">This option accepts a string argument that specifies the
      directory in which to save an extra copy of the
      <b>xtrabackup_checkpoints</b> file. It is passed directly to
      <b>xtrabackup</b>'s <i>--extra-lsndir</i> option. See the
      <b>xtrabackup</b> documentation for details.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--force-non-empty-directories</b></dt>
  <dd class="It-tag">When specified, it makes <i>innobackupex --copy-back</i>
      option or <i>innobackupex --move-back</i> option transfer files to
      non-empty directories. No existing files will be overwritten. If
      --copy-back or --move-back has to copy a file from the backup directory
      which already exists in the destination directory, it will still fail with
      an error.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--galera-info</b></dt>
  <dd class="It-tag">This options creates the <b>xtrabackup_galera_info</b> file
      which contains the local node state at the time of the backup. Option
      should be used when performing the backup of Percona-XtraDB-Cluster. Has
      no effect when backup locks are used to create the backup.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--help</b></dt>
  <dd class="It-tag">This option displays a help screen and exits.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--history=NAME</b></dt>
  <dd class="It-tag">This option enables the tracking of backup history in the
      <b>PERCONA_SCHEMA.xtrabackup_history</b> table. An optional history series
      name may be specified that will be placed with the history record for the
      current backup being taken.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--host=HOST</b></dt>
  <dd class="It-tag">This option accepts a string argument that specifies the
      host to use when connecting to the database server with TCP/IP. It is
      passed to the mysql child process without alteration. See <b>mysql
      --help</b> for details.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ibbackup=IBBACKUP-BINARY</b></dt>
  <dd class="It-tag">This option specifies which <b>xtrabackup</b> binary should
      be used. The option accepts a string argument. IBBACKUP-BINARY should be
      the command used to run <i>Percona XtraBackup</i>. The option can be
      useful if the <b>xtrabackup</b> binary is not in your search path or
      working directory. If this option is not specified, <b>innobackupex</b>
      attempts to determine the binary to use automatically.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--include=REGEXP</b></dt>
  <dd class="It-tag">This option is a regular expression to be matched against
      table names in <b>databasename.tablename</b> format. It is passed directly
      to xtrabackup's <b>xtrabackup --tables</b> option. See the
      <b>xtrabackup</b> documentation for details.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--incremental</b></dt>
  <dd class="It-tag">This option tells <b>xtrabackup</b> to create an
      incremental backup, rather than a full one. It is passed to the
      <b>xtrabackup</b> child process. When this option is specified, either
      <i>--incremental-lsn</i> or <i>--incremental-basedir</i> can also be
      given. If neither option is given, option <i>--incremental-basedir</i> is
      passed to <b>xtrabackup</b> by default, set to the first timestamped
      backup directory in the backup base directory.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--incremental-basedir=DIRECTORY</b></dt>
  <dd class="It-tag">This option accepts a string argument that specifies the
      directory containing the full backup that is the base dataset for the
      incremental backup. It is used with the <i>--incremental</i> option.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--incremental-dir=DIRECTORY</b></dt>
  <dd class="It-tag">This option accepts a string argument that specifies the
      directory where the incremental backup will be combined with the full
      backup to make a new full backup. It is used with the <i>--incremental</i>
      option.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--incremental-history-name=NAME</b></dt>
  <dd class="It-tag">This option specifies the name of the backup series stored
      in the PERCONA_SCHEMA.xtrabackup_history history record to base an
      incremental backup on. Percona Xtrabackup will search the history table
      looking for the most recent (highest innodb_to_lsn), successful backup in
      the series and take the to_lsn value to use as the starting lsn for the
      incremental backup. This will be mutually exclusive with <i>innobackupex
      --incremental-history-uuid</i>,:option: <i>innobackupex
      --incremental-basedir</i> and <i>innobackupex --incremental-lsn</i>. If no
      valid lsn can be found (no series by that name, no successful backups by
      that name) xtrabackup will return with an error. It is used with the
      <i>innobackupex --incremental</i> option.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--incremental-history-uuid=UUID</b></dt>
  <dd class="It-tag">This option specifies the UUID of the specific history
      record stored in the PERCONA_SCHEMA.xtrabackup_history to base an
      incremental backup on. <i>innobackupex
      --incremental-history-name</i>,:optionL`innobackupex
      --incremental-basedir` and <i>innobackupex --incremental-lsn</i>. If no
      valid lsn can be found (no success record with that uuid) xtrabackup will
      return with an error. It is used with the <i>innobackupex
      --incremental</i> option.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--incremental-lsn=LSN</b></dt>
  <dd class="It-tag">This option accepts a string argument that specifies the
      log sequence number (LSN) to use for the incremental backup. It is used
      with the <i>--incremental</i> option. It is used instead of specifying
      <i>--incremental-basedir</i>. For databases created by <i>MySQL</i> and
      <i>Percona Server</i> 5.0-series versions, specify the as two 32-bit
      integers in high:low format. For databases created in 5.1 and later,
      specify the LSN as a single 64-bit integer.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--kill-long-queries-timeout=SECONDS</b></dt>
  <dd class="It-tag">This option specifies the number of seconds innobackupex
      waits between starting <b>FLUSH TABLES WITH READ LOCK</b> and killing
      those queries that block it. Default is 0 seconds, which means
      innobackupex will not attempt to kill any queries. In order to use this
      option xtrabackup user should have <b>PROCESS</b> and <b>SUPER</b>
      privileges. Where supported (Percona Server 5.6+) xtrabackup will
      automatically use <i>Backup Locks</i> as a lightweight alternative to
      <b>FLUSH TABLES WITH READ LOCK</b> to copy non-InnoDB data to avoid
      blocking DML queries that modify InnoDB tables.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--kill-long-query-type=all|select</b></dt>
  <dd class="It-tag">This option specifies which types of queries should be
      killed to unblock the global lock. Default is &quot;all&quot;.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ftwrl-wait-timeout=SECONDS</b></dt>
  <dd class="It-tag">This option specifies time in seconds that innobackupex
      should wait for queries that would block <b>FLUSH TABLES WITH READ
      LOCK</b> before running it. If there are still such queries when the
      timeout expires, innobackupex terminates with an error. Default is 0, in
      which case innobackupex does not wait for queries to complete and starts
      <b>FLUSH TABLES WITH READ LOCK</b> immediately. Where supported (Percona
      Server 5.6+) xtrabackup will automatically use <i>Backup Locks</i> as a
      lightweight alternative to <b>FLUSH TABLES WITH READ LOCK</b> to copy
      non-InnoDB data to avoid blocking DML queries that modify InnoDB
    tables.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ftwrl-wait-threshold=SECONDS</b></dt>
  <dd class="It-tag">This option specifies the query run time threshold which is
      used by innobackupex to detect long-running queries with a non-zero value
      of <i>innobackupex --ftwrl-wait-timeout</i>. <b>FLUSH TABLES WITH READ
      LOCK</b> is not started until such long-running queries exist. This option
      has no effect if --ftwrl-wait-timeout is 0. Default value is 60 seconds.
      Where supported (Percona Server 5.6+) xtrabackup will automatically use
      <i>Backup Locks</i> as a lightweight alternative to <b>FLUSH TABLES WITH
      READ LOCK</b> to copy non-InnoDB data to avoid blocking DML queries that
      modify InnoDB tables.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ftwrl-wait-query-type=all|update</b></dt>
  <dd class="It-tag">This option specifies which types of queries are allowed to
      complete before innobackupex will issue the global lock. Default is
    all.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--log-copy-interval=#</b></dt>
  <dd class="It-tag">This option specifies time interval between checks done by
      log copying thread in milliseconds.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--move-back</b></dt>
  <dd class="It-tag">Move all the files in a previously made backup from the
      backup directory to their original locations. As this option removes
      backup files, it must be used with caution.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--no-lock</b></dt>
  <dd class="It-tag">Use this option to disable table lock with <b>FLUSH TABLES
      WITH READ LOCK</b>. Use it only if ALL your tables are InnoDB and you
      <b>DO NOT CARE</b> about the binary log position of the backup. This
      option shouldn't be used if there are any <b>DDL</b> statements being
      executed or if any updates are happening on non-InnoDB tables (this
      includes the system MyISAM tables in the <i>mysql</i> database), otherwise
      it could lead to an inconsistent backup. Where supported (Percona Server
      5.6+) xtrabackup will automatically use <i>Backup Locks</i> as a
      lightweight alternative to <b>FLUSH TABLES WITH READ LOCK</b> to copy
      non-InnoDB data to avoid blocking DML queries that modify InnoDB tables.
      If you are considering to use <i>--no-lock</i> because your backups are
      failing to acquire the lock, this could be because of incoming replication
      events preventing the lock from succeeding. Please try using
      <i>--safe-slave-backup</i> to momentarily stop the replication slave
      thread, this may help the backup to succeed and you then don't need to
      resort to using this option. <b>xtrabackup_binlog_info</b> is not created
      when --no-lock option is used (because <b>SHOW MASTER STATUS</b> may be
      inconsistent), but under certain conditions
      <b>xtrabackup_binlog_pos_innodb</b> can be used instead to get consistent
      binlog coordinates as described in working_with_binlogs.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--no-timestamp</b></dt>
  <dd class="It-tag">This option prevents creation of a time-stamped
      subdirectory of the <b>BACKUP-ROOT-DIR</b> given on the command line. When
      it is specified, the backup is done in <b>BACKUP-ROOT-DIR</b>
    instead.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--no-version-check</b></dt>
  <dd class="It-tag">This option disables the version check which is enabled by
      the --version-check option.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--parallel=NUMBER-OF-THREADS</b></dt>
  <dd class="It-tag">This option accepts an integer argument that specifies the
      number of threads the <b>xtrabackup</b> child process should use to back
      up files concurrently. Note that this option works on file level, that is,
      if you have several .ibd files, they will be copied in parallel. If your
      tables are stored together in a single tablespace file, it will have no
      effect. This option will allow multiple files to be decrypted and/or
      decompressed simultaneously. In order to decompress, the qpress utility
      MUST be installed and accessable within the path. This process will remove
      the original compressed/encrypted files and leave the results in the same
      location. It is passed directly to xtrabackup's <b>xtrabackup
      --parallel</b> option. See the <b>xtrabackup</b> documentation for
    details</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--password=PASSWORD</b></dt>
  <dd class="It-tag">This option accepts a string argument specifying the
      password to use when connecting to the database. It is passed to the
      <b>mysql</b> child process without alteration. See <b>mysql --help</b> for
      details.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--port=PORT</b></dt>
  <dd class="It-tag">This option accepts a string argument that specifies the
      port to use when connecting to the database server with TCP/IP. It is
      passed to the <b>mysql</b> child process. It is passed to the <b>mysql</b>
      child process without alteration. See <b>mysql --help</b> for
    details.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--rebuild-indexes</b></dt>
  <dd class="It-tag">This option only has effect when used together with the
      --apply-log option and is passed directly to xtrabackup. When used, makes
      xtrabackup rebuild all secondary indexes after applying the log. This
      option is normally used to prepare compact backups. See the
      <b>xtrabackup</b> documentation for more information.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--rebuild-threads=NUMBER-OF-THREADS</b></dt>
  <dd class="It-tag">This option only has effect when used together with the
      --apply-log and --rebuild-indexes option and is passed directly to
      xtrabackup. When used, xtrabackup processes tablespaces in parallel with
      the specified number of threads when rebuilding indexes. See the
      <b>xtrabackup</b> documentation for more information.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--redo-only</b></dt>
  <dd class="It-tag">This option should be used when preparing the base full
      backup and when merging all incrementals except the last one. It is passed
      directly to xtrabackup's <b>xtrabackup --apply-log-only</b> option. This
      forces <b>xtrabackup</b> to skip the &quot;rollback&quot; phase and do a
      &quot;redo&quot; only. This is necessary if the backup will have
      incremental changes applied to it later. See the <b>xtrabackup</b>
      documentation for details.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--rsync</b></dt>
  <dd class="It-tag">Uses the <b>rsync</b> utility to optimize local file
      transfers. When this option is specified, <b>innobackupex</b> uses
      <b>rsync</b> to copy all non-InnoDB files instead of spawning a separate
      <b>cp</b> for each file, which can be much faster for servers with a large
      number of databases or tables. This option cannot be used together with
      <i>--stream</i>.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--safe-slave-backup</b></dt>
  <dd class="It-tag">When specified, innobackupex will stop the slave SQL thread
      just before running <b>FLUSH TABLES WITH READ LOCK</b> and wait to start
      backup until <b>Slave_open_temp_tables</b> in <b>SHOW STATUS</b> is zero.
      If there are no open temporary tables, the backup will take place,
      otherwise the SQL thread will be started and stopped until there are no
      open temporary tables. The backup will fail if
      <b>Slave_open_temp_tables</b> does not become zero after <i>innobackupex
      --safe-slave-backup-timeout</i> seconds. The slave SQL thread will be
      restarted when the backup finishes.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--safe-slave-backup-timeout=SECONDS</b></dt>
  <dd class="It-tag">How many seconds <i>innobackupex --safe-slave-backup</i>
      should wait for <b>Slave_open_temp_tables</b> to become zero. Defaults to
      300 seconds.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--scpopt = SCP-OPTIONS</b></dt>
  <dd class="It-tag">This option accepts a string argument that specifies the
      command line options to pass to <b>scp</b> when the option
      <b>--remost-host</b> is specified. If the option is not specified, the
      default options are <b>-Cp -c arcfour</b>.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--slave-info</b></dt>
  <dd class="It-tag">This option is useful when backing up a replication slave
      server. It prints the binary log position and name of the master server.
      It also writes this information to the <b>xtrabackup_slave_info</b> file
      as a <b>CHANGE MASTER</b> command. A new slave for this master can be set
      up by starting a slave server on this backup and issuing a <b>CHANGE
      MASTER</b> command with the binary log position saved in the
      <b>xtrabackup_slave_info</b> file.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--socket</b></dt>
  <dd class="It-tag">This option accepts a string argument that specifies the
      socket to use when connecting to the local database server with a UNIX
      domain socket. It is passed to the mysql child process without alteration.
      See <b>mysql --help</b> for details.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sshopt=SSH-OPTIONS</b></dt>
  <dd class="It-tag">This option accepts a string argument that specifies the
      command line options to pass to <b>ssh</b> when the option
      <b>--remost-host</b> is specified.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--stream=STREAMNAME</b></dt>
  <dd class="It-tag">This option accepts a string argument that specifies the
      format in which to do the streamed backup. The backup will be done to
      <b>STDOUT</b> in the specified format. Currently, supported formats are
      <i>tar</i> and <i>xbstream</i>. Uses xbstream, which is available in
      <i>Percona XtraBackup</i> distributions. If you specify a path after this
      option, it will be interpreted as the value of <b>tmpdir</b></dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--tables-file=FILE</b></dt>
  <dd class="It-tag">This option accepts a string argument that specifies the
      file in which there are a list of names of the form <b>database.table</b>,
      one per line. The option is passed directly to <b>xtrabackup</b> 's
      <i>--tables-file</i> option.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--throttle=IOS</b></dt>
  <dd class="It-tag">This option accepts an integer argument that specifies the
      number of I/O operations (i.e., pairs of read+write) per second. It is
      passed directly to xtrabackup's <b>xtrabackup --throttle</b> option.
      <b>NOTE:</b> This option works only during the backup phase, ie. it will
      not work with <i>innobackupex --apply-log</i> and <i>innobackupex
      --copy-back</i> options.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--tmpdir=DIRECTORY</b></dt>
  <dd class="It-tag">This option accepts a string argument that specifies the
      location where a temporary file will be stored. It may be used when
      <i>--stream</i> is specified. For these options, the transaction log will
      first be stored to a temporary file, before streaming or copying to a
      remote host. This option specifies the location where that temporary file
      will be stored. If the option is not specified, the default is to use the
      value of <b>tmpdir</b> read from the server configuration. innobackupex is
      passing the tmpdir value specified in my.cnf as the --target-dir option to
      the xtrabackup binary. Both [mysqld] and [xtrabackup] groups are read from
      my.cnf. If there is tmpdir in both, then the value being used depends on
      the order of those group in my.cnf.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--use-memory=#</b></dt>
  <dd class="It-tag">This option accepts a string argument that specifies the
      amount of memory in bytes for <b>xtrabackup</b> to use for crash recovery
      while preparing a backup. Multiples are supported providing the unit (e.g.
      1MB, 1M, 1GB, 1G). It is used only with the option <i>--apply-log</i>. It
      is passed directly to xtrabackup's <b>xtrabackup --use-memory</b> option.
      See the <b>xtrabackup</b> documentation for details.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--user=USER</b></dt>
  <dd class="It-tag">This option accepts a string argument that specifies the
      user (i.e., the <i>MySQL</i> username used when connecting to the server)
      to login as, if that's not the current user. It is passed to the mysql
      child process without alteration. See <b>mysql --help</b> for
    details.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--version</b></dt>
  <dd class="It-tag">This option displays the <b>innobackupex</b> version and
      copyright notice and then exits.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>--version-check</b></dt>
  <dd class="It-tag">When this option is specified, innobackupex will perform a
      version check against the server on the backup stage after creating a
      server connection.</dd>
</dl>
</div>
<br/>
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Percona LLC and/or its affiliates
<h1 class="Sh" title="Sh" id="COPYRIGHT"><a class="selflink" href="#COPYRIGHT">COPYRIGHT</a></h1>
2009-2016, Percona LLC and/or its affiliates</div>
<table class="foot">
  <tr>
    <td class="foot-date">May 16, 2017</td>
    <td class="foot-os">2.3.5</td>
  </tr>
</table>
</body>
</html>
