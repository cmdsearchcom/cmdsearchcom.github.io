<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>virt-sysprep(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">virt-sysprep(1)</td>
    <td class="head-vol">Virtualization Support</td>
    <td class="head-rtitle">virt-sysprep(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
virt-sysprep - Reset, unconfigure or customize a virtual machine so clones can
  be made
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>
 virt-sysprep [--options] -d domname
 virt-sysprep [--options] -a disk.img [-a disk.img ...]
</pre>
<h1 class="Sh" title="Sh" id="WARNING"><a class="selflink" href="#WARNING">WARNING</a></h1>
Using &quot;virt-sysprep&quot; on live virtual machines, or concurrently with
  other disk editing tools, can be dangerous, potentially causing disk
  corruption. The virtual machine must be shut down before you use this command,
  and disk images must not be edited concurrently.
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
Virt-sysprep can reset or unconfigure a virtual machine so that clones can be
  made from it. Steps in this process include removing SSH host keys, removing
  persistent network MAC configuration, and removing user accounts. Virt-sysprep
  can also customize a virtual machine, for instance by adding SSH keys, users
  or logos. Each step can be enabled or disabled as required.
<div class="Pp"></div>
Virt-sysprep modifies the guest or disk image <i>in place</i>. The guest must be
  shut down. If you want to preserve the existing contents of the guest, <i>you
  must snapshot, copy or clone the disk first</i>. See &quot;COPYING AND
  CLONING&quot; below.
<div class="Pp"></div>
You do <i>not</i> need to run virt-sysprep as root. In fact we'd generally
  recommend that you don't. The time you might want to run it as root is when
  you need root in order to access the disk image, but even in this case it
  would be better to change the permissions on the disk image to be writable as
  the non-root user running virt-sysprep.
<div class="Pp"></div>
&quot;Sysprep&quot; stands for &quot;system preparation&quot; tool. The name
  comes from the Microsoft program <i>sysprep.exe</i> which is used to
  unconfigure Windows machines in preparation for cloning them. Having said
  that, virt-sysprep does <i>not</i> currently work on Microsoft Windows guests.
  We plan to support Windows sysprepping in a future version, and we already
  have code to do it.
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--help</b></dt>
  <dd class="It-tag">Display brief help.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-a</b> file</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--add</b> file</dt>
  <dd class="It-tag">Add <i>file</i> which should be a disk image from a virtual
      machine.
    <div style="height: 1.00em;">&#x00A0;</div>
    The format of the disk image is auto-detected. To override this and force a
      particular format use the <i>--format</i> option.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-a</b> URI</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--add</b> URI</dt>
  <dd class="It-tag">Add a remote disk. The URI format is compatible with
      guestfish. See &quot;ADDING REMOTE STORAGE&quot; in
    <i>guestfish</i>(1).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--colors</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--colours</b></dt>
  <dd class="It-tag">Use ANSI colour sequences to colourize messages. This is
      the default when the output is a tty. If the output of the program is
      redirected to a file, ANSI colour sequences are disabled unless you use
      this option.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-c</b> URI</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--connect</b> URI</dt>
  <dd class="It-tag">If using libvirt, connect to the given <i>URI</i>. If
      omitted, then we connect to the default libvirt hypervisor.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you specify guest block devices directly ( <i>-a</i>), then libvirt is
      not used at all.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-d</b> guest</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--domain</b> guest</dt>
  <dd class="It-tag">Add all the disks from the named libvirt guest. Domain
      UUIDs can be used instead of names.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-n</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--dry-run</b></dt>
  <dd class="It-tag">Perform a read-only &quot;dry run&quot; on the guest. This
      runs the sysprep operation, but throws away any changes to the disk at the
      end.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--enable</b> operations</dt>
  <dd class="It-tag">Choose which sysprep operations to perform. Give a
      comma-separated list of operations, for example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 --enable ssh-hostkeys,udev-persistent-net
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    would enable ONLY &quot;ssh-hostkeys&quot; and
      &quot;udev-persistent-net&quot; operations.
    <div style="height: 1.00em;">&#x00A0;</div>
    If the <i>--enable</i> option is not given, then we default to trying most
      sysprep operations (see <i>--list-operations</i> to show which are
      enabled).
    <div style="height: 1.00em;">&#x00A0;</div>
    Regardless of the <i>--enable</i> option, sysprep operations are skipped for
      some guest types.
    <div style="height: 1.00em;">&#x00A0;</div>
    Use <i>--list-operations</i> to list operations supported by a particular
      version of virt-sysprep.
    <div style="height: 1.00em;">&#x00A0;</div>
    See &quot;OPERATIONS&quot; below for a list and an explanation of each
      operation.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--operation</b> operations</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--operations</b> operations</dt>
  <dd class="It-tag">Choose which sysprep operations to perform. Give a
      comma-separated list of operations, for example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 --operations ssh-hostkeys,udev-persistent-net
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    would enable ONLY &quot;ssh-hostkeys&quot; and
      &quot;udev-persistent-net&quot; operations.
    <div style="height: 1.00em;">&#x00A0;</div>
     <i>--operations</i> allows you to enable and disable any operation,
      including the default ones (which would be tried when specifying neither
      <i>--operations</i> nor <i>--enable</i>) and all the available ones;
      prepending a &quot;-&quot; in front of an operation name removes it from
      the list of enabled operations, while the meta-names &quot;defaults&quot;
      and &quot;all&quot; represent respectively the operations enabled by
      default and all the available ones. For example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 --operations firewall-rules,defaults,-tmp-files
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    would enable the &quot;firewall-rules&quot; operation (regardless whether it
      is enabled by default), all the default ones, and disable the
      &quot;tmp-files&quot; operation.
    <div style="height: 1.00em;">&#x00A0;</div>
     <i>--operations</i> can be specified multiple times; the first time the set
      of enabled operations is empty, while any further <i>--operations</i>
      affects the operations enabled so far.
    <div style="height: 1.00em;">&#x00A0;</div>
    If the <i>--operations</i> option is not given, then we default to trying
      most sysprep operations (see <i>--list-operations</i> to show which are
      enabled).
    <div style="height: 1.00em;">&#x00A0;</div>
    Regardless of the <i>--operations</i> option, sysprep operations are skipped
      for some guest types.
    <div style="height: 1.00em;">&#x00A0;</div>
    Use <i>--list-operations</i> to list operations supported by a particular
      version of virt-sysprep.
    <div style="height: 1.00em;">&#x00A0;</div>
    See &quot;OPERATIONS&quot; below for a list and an explanation of each
      operation.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--format</b> raw|qcow2|..</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--format</b> auto</dt>
  <dd class="It-tag">The default for the <i>-a</i> option is to auto-detect the
      format of the disk image. Using this forces the disk format for <i>-a</i>
      options which follow on the command line. Using <i>--format auto</i>
      switches back to auto-detection for subsequent <i>-a</i> options.
    <div style="height: 1.00em;">&#x00A0;</div>
    For example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 virt-sysprep --format raw -a disk.img
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    forces raw format (no auto-detection) for <i>disk.img</i>.
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 virt-sysprep --format raw -a disk.img --format auto -a another.img
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    forces raw format (no auto-detection) for <i>disk.img</i> and reverts to
      auto-detection for <i>another.img</i>.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you have untrusted raw-format guest disk images, you should use this
      option to specify the disk format. This avoids a possible security problem
      with malicious guests (CVE-2010-3851).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--list-operations</b></dt>
  <dd class="It-tag">List the operations supported by the virt-sysprep program.
    <div style="height: 1.00em;">&#x00A0;</div>
    These are listed one per line, with one or more single-space-separated
      fields, eg:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 $ virt-sysprep --list-operations
 bash-history * Remove the bash history in the guest
 cron-spool * Remove user at-jobs and cron-jobs
 dhcp-client-state * Remove DHCP client leases
 dhcp-server-state * Remove DHCP server leases
 [etc]
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    The first field is the operation name, which can be supplied to
      <i>--enable</i>. The second field is a &quot;*&quot; character if the
      operation is enabled by default or blank if not. Subsequent fields on the
      same line are the description of the operation.
    <div style="height: 1.00em;">&#x00A0;</div>
    Before libguestfs 1.17.33 only the first (operation name) field was shown
      and all operations were enabled by default.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--mount-options</b> mp:opts[;mp:opts;...]</dt>
  <dd class="It-tag">Set the mount options used when libguestfs opens the disk
      image. Note this has no effect on the guest. It is used when opening
      certain guests such as ones using the UFS (BSD) filesystem.
    <div style="height: 1.00em;">&#x00A0;</div>
    Use a semicolon-separated list of &quot;mountpoint:options&quot; pairs. You
      may need to quote this list to protect it from the shell.
    <div style="height: 1.00em;">&#x00A0;</div>
    For example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 --mount-options &quot;/:noatime&quot;
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    will mount the root directory with &quot;notime&quot;. This example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 --mount-options &quot;/:noatime;/var:rw,nodiratime&quot;
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    will do the same, plus mount <i>/var</i> with
    &quot;rw,nodiratime&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-q</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--quiet</b></dt>
  <dd class="It-tag">Don't print log messages.
    <div style="height: 1.00em;">&#x00A0;</div>
    To enable detailed logging of individual file operations, use
    <i>-x</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--network</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--no-network</b></dt>
  <dd class="It-tag">Enable or disable network access from the guest during the
      installation.
    <div style="height: 1.00em;">&#x00A0;</div>
    In virt-sysprep, the network is <i>disabled</i> by default. You must use
      <i>--network</i> to enable it, in order that options such as
      <i>--install</i> or <i>--update</i> will work.
    <div style="height: 1.00em;">&#x00A0;</div>
     <i>virt-builder</i>(1) has more information about the security advantages
      of disabling the network.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-v</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--verbose</b></dt>
  <dd class="It-tag">Enable verbose messages for debugging.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-V</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--version</b></dt>
  <dd class="It-tag">Display version number and exit.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-x</b></dt>
  <dd class="It-tag">Enable tracing of libguestfs API calls.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--chmod</b> PERMISSIONS:FILE (see &quot;customize&quot;
    below)</dt>
  <dd class="It-tag">Change the permissions of &quot;FILE&quot; to
      &quot;PERMISSIONS&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
     <i>Note</i>: &quot;PERMISSIONS&quot; by default would be decimal, unless
      you prefix it with 0 to get octal, ie. use 0700 not 700.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--commands-from-file</b> FILENAME (see
    &quot;customize&quot; below)</dt>
  <dd class="It-tag">Read the customize commands from a file, one (and its
      arguments) each line.
    <div style="height: 1.00em;">&#x00A0;</div>
    Each line contains a single customization command and its arguments, for
      example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 delete /some/file
 install some-package
 password some-user:password:its-new-password
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Empty lines are ignored, and lines starting with &quot;#&quot; are comments
      and are ignored as well. Furthermore, arguments can be spread across
      multiple lines, by adding a &quot;\&quot; (continuation character) at the
      of a line, for example
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 edit /some/file:\
   s/^OPT=.*/OPT=ok/
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    The commands are handled in the same order as they are in the file, as if
      they were specified as <i>--delete /some/file</i> on the command
    line.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--copy</b> SOURCE:DEST (see &quot;customize&quot;
    below)</dt>
  <dd class="It-tag">Copy files or directories recursively inside the guest.
    <div style="height: 1.00em;">&#x00A0;</div>
    Wildcards cannot be used.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--copy-in</b> LOCALPATH:REMOTEDIR (see
    &quot;customize&quot; below)</dt>
  <dd class="It-tag">Copy local files or directories recursively into the disk
      image, placing them in the directory &quot;REMOTEDIR&quot; (which must
      exist).
    <div style="height: 1.00em;">&#x00A0;</div>
    Wildcards cannot be used.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--delete</b> PATH (see &quot;customize&quot; below)</dt>
  <dd class="It-tag">Delete a file from the guest. Or delete a directory (and
      all its contents, recursively).
    <div style="height: 1.00em;">&#x00A0;</div>
    You can use shell glob characters in the specified path. Be careful to
      escape glob characters from the host shell, if that is required. For
      example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 virt-customize --delete '/var/log/*.log'.
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    See also: <i>--upload</i>, <i>--scrub</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--edit</b> FILE:EXPR (see &quot;customize&quot;
    below)</dt>
  <dd class="It-tag">Edit &quot;FILE&quot; using the Perl expression
      &quot;EXPR&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    Be careful to properly quote the expression to prevent it from being altered
      by the shell.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note that this option is only available when Perl 5 is installed.
    <div style="height: 1.00em;">&#x00A0;</div>
    See &quot;NON-INTERACTIVE EDITING&quot; in <i>virt-edit</i>(1).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--firstboot</b> SCRIPT (see &quot;customize&quot;
    below)</dt>
  <dd class="It-tag">Install &quot;SCRIPT&quot; inside the guest, so that when
      the guest first boots up, the script runs (as root, late in the boot
      process).
    <div style="height: 1.00em;">&#x00A0;</div>
    The script is automatically chmod +x after installation in the guest.
    <div style="height: 1.00em;">&#x00A0;</div>
    The alternative version <i>--firstboot-command</i> is the same, but it
      conveniently wraps the command up in a single line script for you.
    <div style="height: 1.00em;">&#x00A0;</div>
    You can have multiple <i>--firstboot</i> options. They run in the same order
      that they appear on the command line.
    <div style="height: 1.00em;">&#x00A0;</div>
    Please take a look at &quot;FIRST BOOT SCRIPTS&quot; in
      <i>virt-builder</i>(1) for more information and caveats about the first
      boot scripts.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also <i>--run</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--firstboot-command</b> 'CMD+ARGS' (see
    &quot;customize&quot; below)</dt>
  <dd class="It-tag">Run command (and arguments) inside the guest when the guest
      first boots up (as root, late in the boot process).
    <div style="height: 1.00em;">&#x00A0;</div>
    You can have multiple <i>--firstboot</i> options. They run in the same order
      that they appear on the command line.
    <div style="height: 1.00em;">&#x00A0;</div>
    Please take a look at &quot;FIRST BOOT SCRIPTS&quot; in
      <i>virt-builder</i>(1) for more information and caveats about the first
      boot scripts.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also <i>--run</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--firstboot-install</b> PKG,PKG.. (see
    &quot;customize&quot; below)</dt>
  <dd class="It-tag">Install the named packages (a comma-separated list). These
      are installed when the guest first boots using the guest's package manager
      (eg. apt, yum, etc.) and the guest's network connection.
    <div style="height: 1.00em;">&#x00A0;</div>
    For an overview on the different ways to install packages, see
      &quot;INSTALLING PACKAGES&quot; in <i>virt-builder</i>(1).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--hostname</b> HOSTNAME (see &quot;customize&quot;
    below)</dt>
  <dd class="It-tag">Set the hostname of the guest to &quot;HOSTNAME&quot;. You
      can use a dotted hostname.domainname (FQDN) if you want.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--install</b> PKG,PKG.. (see &quot;customize&quot;
    below)</dt>
  <dd class="It-tag">Install the named packages (a comma-separated list). These
      are installed during the image build using the guest's package manager
      (eg. apt, yum, etc.) and the host's network connection.
    <div style="height: 1.00em;">&#x00A0;</div>
    For an overview on the different ways to install packages, see
      &quot;INSTALLING PACKAGES&quot; in <i>virt-builder</i>(1).
    <div style="height: 1.00em;">&#x00A0;</div>
    See also <i>--update</i>, <i>--uninstall</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--keep-user-accounts</b> USERS (see
    &quot;user-account&quot; below)</dt>
  <dd class="It-tag">The user accounts to be kept in the guest. The value of
      this option is a list of user names separated by comma, where specifying
      an user means it is going to be kept. For example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 --keep-user-accounts mary
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    would keep the user account &quot;mary&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    This option can be specified multiple times.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--link</b> TARGET:LINK[:LINK..] (see
    &quot;customize&quot; below)</dt>
  <dd class="It-tag">Create symbolic link(s) in the guest, starting at
      &quot;LINK&quot; and pointing at &quot;TARGET&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--mkdir</b> DIR (see &quot;customize&quot; below)</dt>
  <dd class="It-tag">Create a directory in the guest.
    <div style="height: 1.00em;">&#x00A0;</div>
    This uses &quot;mkdir&#x00A0;-p&quot; so any intermediate directories are
      created, and it also works if the directory already exists.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--move</b> SOURCE:DEST (see &quot;customize&quot;
    below)</dt>
  <dd class="It-tag">Move files or directories inside the guest.
    <div style="height: 1.00em;">&#x00A0;</div>
    Wildcards cannot be used.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--no-logfile</b> (see &quot;customize&quot; below)</dt>
  <dd class="It-tag">Scrub &quot;builder.log&quot; (log file from build
      commands) from the image after building is complete. If you don't want to
      reveal precisely how the image was built, use this option.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also: &quot;LOG FILE&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--password</b> USER:SELECTOR (see &quot;customize&quot;
    below)</dt>
  <dd class="It-tag">Set the password for &quot;USER&quot;. (Note this option
      does <i>not</i> create the user account).
    <div style="height: 1.00em;">&#x00A0;</div>
    See &quot;USERS AND PASSWORDS&quot; in <i>virt-builder</i>(1) for the format
      of the &quot;SELECTOR&quot; field, and also how to set up user
    accounts.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--password-crypto</b> md5|sha256|sha512 (see
    &quot;customize&quot; below)</dt>
  <dd class="It-tag">When the virt tools change or set a password in the guest,
      this option sets the password encryption of that password to
      &quot;md5&quot;, &quot;sha256&quot; or &quot;sha512&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    &quot;sha256&quot; and &quot;sha512&quot; require glibc &#x2265; 2.7 (check
      <i>crypt</i>(3) inside the guest).
    <div style="height: 1.00em;">&#x00A0;</div>
    &quot;md5&quot; will work with relatively old Linux guests (eg. RHEL 3), but
      is not secure against modern attacks.
    <div style="height: 1.00em;">&#x00A0;</div>
    The default is &quot;sha512&quot; unless libguestfs detects an old guest
      that didn't have support for SHA-512, in which case it will use
      &quot;md5&quot;. You can override libguestfs by specifying this option.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note this does not change the default password encryption used by the guest
      when you create new user accounts inside the guest. If you want to do
      that, then you should use the <i>--edit</i> option to modify
      &quot;/etc/sysconfig/authconfig&quot; (Fedora, RHEL) or
      &quot;/etc/pam.d/common-password&quot; (Debian, Ubuntu).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--remove-user-accounts</b> USERS (see
    &quot;user-account&quot; below)</dt>
  <dd class="It-tag">The user accounts to be removed from the guest. The value
      of this option is a list of user names separated by comma, where
      specifying an user means it is going to be removed. For example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 --remove-user-accounts bob,eve
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    would only remove the user accounts &quot;bob&quot; and &quot;eve&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    This option can be specified multiple times.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--root-password</b> SELECTOR (see &quot;customize&quot;
    below)</dt>
  <dd class="It-tag">Set the root password.
    <div style="height: 1.00em;">&#x00A0;</div>
    See &quot;USERS AND PASSWORDS&quot; in <i>virt-builder</i>(1) for the format
      of the &quot;SELECTOR&quot; field, and also how to set up user accounts.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: In virt-builder, if you <i>don't</i> set <i>--root-password</i> then
      the guest is given a <i>random</i> root password.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--run</b> SCRIPT (see &quot;customize&quot; below)</dt>
  <dd class="It-tag">Run the shell script (or any program) called
      &quot;SCRIPT&quot; on the disk image. The script runs virtualized inside a
      small appliance, chrooted into the guest filesystem.
    <div style="height: 1.00em;">&#x00A0;</div>
    The script is automatically chmod +x.
    <div style="height: 1.00em;">&#x00A0;</div>
    If libguestfs supports it then a limited network connection is available but
      it only allows outgoing network connections. You can also attach data
      disks (eg. ISO files) as another way to provide data (eg. software
      packages) to the script without needing a network connection (
      <i>--attach</i>). You can also upload data files ( <i>--upload</i>).
    <div style="height: 1.00em;">&#x00A0;</div>
    You can have multiple <i>--run</i> options. They run in the same order that
      they appear on the command line.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also: <i>--firstboot</i>, <i>--attach</i>, <i>--upload</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--run-command</b> 'CMD+ARGS' (see &quot;customize&quot;
    below)</dt>
  <dd class="It-tag">Run the command and arguments on the disk image. The
      command runs virtualized inside a small appliance, chrooted into the guest
      filesystem.
    <div style="height: 1.00em;">&#x00A0;</div>
    If libguestfs supports it then a limited network connection is available but
      it only allows outgoing network connections. You can also attach data
      disks (eg. ISO files) as another way to provide data (eg. software
      packages) to the script without needing a network connection (
      <i>--attach</i>). You can also upload data files ( <i>--upload</i>).
    <div style="height: 1.00em;">&#x00A0;</div>
    You can have multiple <i>--run-command</i> options. They run in the same
      order that they appear on the command line.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also: <i>--firstboot</i>, <i>--attach</i>, <i>--upload</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--script</b> SCRIPT (see &quot;script&quot; below)</dt>
  <dd class="It-tag">Run the named &quot;SCRIPT&quot; (a shell script or
      program) against the guest. The script can be any program on the host. The
      script's current directory will be the guest's root directory.
    <div style="height: 1.00em;">&#x00A0;</div>
     <b>Note:</b> If the script is not on the $PATH, then you must give the full
      absolute path to the script.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--scriptdir</b> SCRIPTDIR (see &quot;script&quot;
    below)</dt>
  <dd class="It-tag">The mount point (an empty directory on the host) used when
      the &quot;script&quot; operation is enabled and one or more scripts are
      specified using <i>--script</i> parameter(s).
    <div style="height: 1.00em;">&#x00A0;</div>
     <b>Note:</b> &quot;SCRIPTDIR&quot; <b>must</b> be an absolute path.
    <div style="height: 1.00em;">&#x00A0;</div>
    If <i>--scriptdir</i> is not specified then a temporary mountpoint will be
      created.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--scrub</b> FILE (see &quot;customize&quot; below)</dt>
  <dd class="It-tag">Scrub a file from the guest. This is like <i>--delete</i>
      except that:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">It scrubs the data so a guest could not recover it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">It cannot delete directories, only regular files.</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;"></div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--selinux-relabel</b> (see &quot;customize&quot;
    below)</dt>
  <dd class="It-tag">Relabel files in the guest so that they have the correct
      SELinux label.
    <div style="height: 1.00em;">&#x00A0;</div>
    This will attempt to relabel files immediately, but if the operation fails
      this will instead touch <i>/.autorelabel</i> on the image to schedule a
      relabel operation for the next time the image boots.
    <div style="height: 1.00em;">&#x00A0;</div>
    You should only use this option for guests which support SELinux.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sm-attach</b> SELECTOR (see &quot;customize&quot;
    below)</dt>
  <dd class="It-tag">Attach to a pool using &quot;subscription-manager&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    See &quot;SUBSCRIPTION-MANAGER&quot; in <i>virt-builder</i>(1) for the
      format of the &quot;SELECTOR&quot; field.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sm-credentials</b> SELECTOR (see &quot;customize&quot;
    below)</dt>
  <dd class="It-tag">Set the credentials for &quot;subscription-manager&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    See &quot;SUBSCRIPTION-MANAGER&quot; in <i>virt-builder</i>(1) for the
      format of the &quot;SELECTOR&quot; field.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sm-register</b> (see &quot;customize&quot; below)</dt>
  <dd class="It-tag">Register the guest using &quot;subscription-manager&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    This requires credentials being set using <i>--sm-credentials</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sm-remove</b> (see &quot;customize&quot; below)</dt>
  <dd class="It-tag">Remove all the subscriptions from the guest using
      &quot;subscription-manager&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sm-unregister</b> (see &quot;customize&quot;
    below)</dt>
  <dd class="It-tag">Unregister the guest using
      &quot;subscription-manager&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ssh-inject</b> USER[:SELECTOR] (see
    &quot;customize&quot; below)</dt>
  <dd class="It-tag">Inject an ssh key so the given &quot;USER&quot; will be
      able to log in over ssh without supplying a password. The &quot;USER&quot;
      must exist already in the guest.
    <div style="height: 1.00em;">&#x00A0;</div>
    See &quot;SSH KEYS&quot; in <i>virt-builder</i>(1) for the format of the
      &quot;SELECTOR&quot; field.
    <div style="height: 1.00em;">&#x00A0;</div>
    You can have multiple <i>--ssh-inject</i> options, for different users and
      also for more keys for each user.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--timezone</b> TIMEZONE (see &quot;customize&quot;
    below)</dt>
  <dd class="It-tag">Set the default timezone of the guest to
      &quot;TIMEZONE&quot;. Use a location string like
    &quot;Europe/London&quot;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--touch</b> FILE (see &quot;customize&quot; below)</dt>
  <dd class="It-tag">This command performs a <i>touch</i>(1)-like operation on
      &quot;FILE&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--truncate</b> FILE (see &quot;customize&quot;
    below)</dt>
  <dd class="It-tag">This command truncates &quot;FILE&quot; to a zero-length
      file. The file must exist already.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--truncate-recursive</b> PATH (see &quot;customize&quot;
    below)</dt>
  <dd class="It-tag">This command recursively truncates all files under
      &quot;PATH&quot; to zero-length.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--uninstall</b> PKG,PKG.. (see &quot;customize&quot;
    below)</dt>
  <dd class="It-tag">Uninstall the named packages (a comma-separated list).
      These are removed during the image build using the guest's package manager
      (eg. apt, yum, etc.). Dependent packages may also need to be uninstalled
      to satisfy the request.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also <i>--install</i>, <i>--update</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--update</b> (see &quot;customize&quot; below)</dt>
  <dd class="It-tag">Do the equivalent of &quot;yum update&quot;, &quot;apt-get
      upgrade&quot;, or whatever command is required to update the packages
      already installed in the template to their latest versions.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also <i>--install</i>, <i>--uninstall</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--upload</b> FILE:DEST (see &quot;customize&quot;
    below)</dt>
  <dd class="It-tag">Upload local file &quot;FILE&quot; to destination
      &quot;DEST&quot; in the disk image. File owner and permissions from the
      original are preserved, so you should set them to what you want them to be
      in the disk image.
    <div style="height: 1.00em;">&#x00A0;</div>
    &quot;DEST&quot; could be the final filename. This can be used to rename the
      file on upload.
    <div style="height: 1.00em;">&#x00A0;</div>
    If &quot;DEST&quot; is a directory name (which must already exist in the
      guest) then the file is uploaded into that directory, and it keeps the
      same name as on the local filesystem.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also: <i>--mkdir</i>, <i>--delete</i>, <i>--scrub</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--write</b> FILE:CONTENT (see &quot;customize&quot;
    below)</dt>
  <dd class="It-tag">Write &quot;CONTENT&quot; to &quot;FILE&quot;.</dd>
</dl>
<h1 class="Sh" title="Sh" id="OPERATIONS"><a class="selflink" href="#OPERATIONS">OPERATIONS</a></h1>
If the <i>--enable</i>/<i>--operations</i> option is <i>not</i> given, then most
  sysprep operations are enabled.
<div class="Pp"></div>
Use &quot;virt-sysprep --list-operations&quot; to list all operations for your
  virt-sysprep binary. The ones which are enabled by default are marked with a
  &quot;*&quot; character. Regardless of the <i>--enable</i>/<i>--operations</i>
  options, sysprep operations are skipped for some guest types.
<div class="Pp"></div>
Operations can be individually enabled using the
  <i>--enable</i>/<i>--operations</i> options. Use a comma-separated list, for
  example:
<div class="Pp"></div>
<pre>
 virt-sysprep --operations ssh-hostkeys,udev-persistent-net [etc..]
</pre>
<div class="Pp"></div>
Future versions of virt-sysprep may add more operations. If you are using
  virt-sysprep and want predictable behaviour, specify only the operations that
  you want to have enabled.
<div class="Pp"></div>
&quot;*&quot; = enabled by default when no <i>--enable</i>/<i>--operations</i>
  option is given.
<h2 class="Ss" title="Ss" id="abrt-data_*"><a class="selflink" href="#abrt-data_*"><b>abrt-data</b>
  *</a></h2>
Remove the crash data generated by ABRT.
<div class="Pp"></div>
Remove the automatically generated ABRT crash data in
  &quot;/var/spool/abrt/&quot;.
<h2 class="Ss" title="Ss" id="bash-history_*"><a class="selflink" href="#bash-history_*"><b>bash-history</b>
  *</a></h2>
Remove the bash history in the guest.
<div class="Pp"></div>
Remove the bash history of user &quot;root&quot; and any other users who have a
  &quot;.bash_history&quot; file in their home directory.
<div class="Pp"></div>
<i>Notes on bash-history</i>
<div class="Pp"></div>
Currently this only looks in &quot;/root&quot; and &quot;/home/*&quot; for home
  directories, so users with home directories in other locations won't have the
  bash history removed.
<h2 class="Ss" title="Ss" id="blkid-tab_*"><a class="selflink" href="#blkid-tab_*"><b>blkid-tab</b>
  *</a></h2>
Remove blkid tab in the guest.
<h2 class="Ss" title="Ss" id="ca-certificates"><a class="selflink" href="#ca-certificates"><b>ca-certificates</b></a></h2>
Remove CA certificates in the guest.
<h2 class="Ss" title="Ss" id="crash-data_*"><a class="selflink" href="#crash-data_*"><b>crash-data</b>
  *</a></h2>
Remove the crash data generated by kexec-tools.
<div class="Pp"></div>
Remove the automatically generated kdump kernel crash data.
<h2 class="Ss" title="Ss" id="cron-spool_*"><a class="selflink" href="#cron-spool_*"><b>cron-spool</b>
  *</a></h2>
Remove user at-jobs and cron-jobs.
<h2 class="Ss" title="Ss" id="customize_*"><a class="selflink" href="#customize_*"><b>customize</b>
  *</a></h2>
Customize the guest.
<div class="Pp"></div>
Customize the guest by providing <i>virt-customize</i>(1) options for installing
  packages, editing files and so on.
<h2 class="Ss" title="Ss" id="dhcp-client-state_*"><a class="selflink" href="#dhcp-client-state_*"><b>dhcp-client-state</b>
  *</a></h2>
Remove DHCP client leases.
<h2 class="Ss" title="Ss" id="dhcp-server-state_*"><a class="selflink" href="#dhcp-server-state_*"><b>dhcp-server-state</b>
  *</a></h2>
Remove DHCP server leases.
<h2 class="Ss" title="Ss" id="dovecot-data_*"><a class="selflink" href="#dovecot-data_*"><b>dovecot-data</b>
  *</a></h2>
Remove Dovecot (mail server) data.
<h2 class="Ss" title="Ss" id="firewall-rules"><a class="selflink" href="#firewall-rules"><b>firewall-rules</b></a></h2>
Remove the firewall rules.
<div class="Pp"></div>
This removes custom firewall rules by removing
  &quot;/etc/sysconfig/iptables&quot; or custom firewalld configuration in
  &quot;/etc/firewalld/*/*&quot;.
<div class="Pp"></div>
Note this is <i>not</i> enabled by default since it may expose guests to
  exploits. Use with care.
<h2 class="Ss" title="Ss" id="flag-reconfiguration"><a class="selflink" href="#flag-reconfiguration"><b>flag-reconfiguration</b></a></h2>
Flag the system for reconfiguration.
<div class="Pp"></div>
For Linux guests, this touches &quot;/.unconfigured&quot;, which causes the
  first boot to interactively query the user for settings such as the root
  password and timezone.
<h2 class="Ss" title="Ss" id="fs-uuids"><a class="selflink" href="#fs-uuids"><b>fs-uuids</b></a></h2>
Change filesystem UUIDs.
<div class="Pp"></div>
On guests and filesystem types where this is supported, new random UUIDs are
  generated and assigned to filesystems.
<div class="Pp"></div>
<i>Notes on fs-uuids</i>
<div class="Pp"></div>
The fs-uuids operation is disabled by default because it does not yet find and
  update all the places in the guest that use the UUIDs. For example
  &quot;/etc/fstab&quot; or the bootloader. Enabling this operation is more
  likely than not to make your guest unbootable.
<div class="Pp"></div>
See: https://bugzilla.redhat.com/show_bug.cgi?id=991641
<h2 class="Ss" title="Ss" id="kerberos-data"><a class="selflink" href="#kerberos-data"><b>kerberos-data</b></a></h2>
Remove Kerberos data in the guest.
<h2 class="Ss" title="Ss" id="logfiles_*"><a class="selflink" href="#logfiles_*"><b>logfiles</b>
  *</a></h2>
Remove many log files from the guest.
<div class="Pp"></div>
On Linux the following files are removed:
<div class="Pp"></div>
<pre>
 /etc/Pegasus/*.cnf
 /etc/Pegasus/*.crt
 /etc/Pegasus/*.csr
 /etc/Pegasus/*.pem
 /etc/Pegasus/*.srl
 /root/anaconda-ks.cfg
 /root/anaconda-post.log
 /root/initial-setup-ks.cfg
 /root/install.log
 /root/install.log.syslog
 /var/cache/fontconfig/*
 /var/cache/gdm/*
 /var/cache/man/*
 /var/lib/AccountService/users/*
 /var/lib/fprint/*
 /var/lib/logrotate.status
 /var/log/*.log*
 /var/log/BackupPC/LOG
 /var/log/ConsoleKit/*
 /var/log/anaconda.syslog
 /var/log/anaconda/*
 /var/log/apache2/*_log
 /var/log/apache2/*_log-*
 /var/log/apt/*
 /var/log/aptitude*
 /var/log/audit/*
 /var/log/btmp*
 /var/log/ceph/*.log
 /var/log/chrony/*.log
 /var/log/cron*
 /var/log/cups/*_log*
 /var/log/debug*
 /var/log/dmesg*
 /var/log/exim4/*
 /var/log/faillog*
 /var/log/firewalld*
 /var/log/gdm/*
 /var/log/glusterfs/*glusterd.vol.log
 /var/log/glusterfs/glusterfs.log
 /var/log/grubby*
 /var/log/httpd/*log
 /var/log/installer/*
 /var/log/jetty/jetty-console.log
 /var/log/journal/*
 /var/log/lastlog*
 /var/log/libvirt/libvirtd.log
 /var/log/libvirt/libxl/*.log
 /var/log/libvirt/lxc/*.log
 /var/log/libvirt/qemu/*.log
 /var/log/libvirt/uml/*.log
 /var/log/lightdm/*
 /var/log/mail/*
 /var/log/maillog*
 /var/log/messages*
 /var/log/ntp
 /var/log/ntpstats/*
 /var/log/ppp/connect-errors
 /var/log/rhsm/*
 /var/log/sa/*
 /var/log/secure*
 /var/log/setroubleshoot/*.log
 /var/log/spooler*
 /var/log/squid/*.log
 /var/log/syslog*
 /var/log/tallylog*
 /var/log/tuned/tuned.log
 /var/log/wtmp*
 /var/log/xferlog*
 /var/named/data/named.run
</pre>
<h2 class="Ss" title="Ss" id="lvm-uuids_*"><a class="selflink" href="#lvm-uuids_*"><b>lvm-uuids</b>
  *</a></h2>
Change LVM2 PV and VG UUIDs.
<div class="Pp"></div>
On Linux guests that have LVM2 physical volumes (PVs) or volume groups (VGs),
  new random UUIDs are generated and assigned to those PVs and VGs.
<h2 class="Ss" title="Ss" id="machine-id_*"><a class="selflink" href="#machine-id_*"><b>machine-id</b>
  *</a></h2>
Remove the local machine ID.
<div class="Pp"></div>
The machine ID is usually generated from a random source during system
  installation and stays constant for all subsequent boots. Optionally, for
  stateless systems it is generated during runtime at boot if it is found to be
  empty.
<h2 class="Ss" title="Ss" id="mail-spool_*"><a class="selflink" href="#mail-spool_*"><b>mail-spool</b>
  *</a></h2>
Remove email from the local mail spool directory.
<h2 class="Ss" title="Ss" id="net-hostname_*"><a class="selflink" href="#net-hostname_*"><b>net-hostname</b>
  *</a></h2>
Remove HOSTNAME in network interface configuration.
<div class="Pp"></div>
For Fedora and Red Hat Enterprise Linux, this is removed from
  &quot;ifcfg-*&quot; files.
<h2 class="Ss" title="Ss" id="net-hwaddr_*"><a class="selflink" href="#net-hwaddr_*"><b>net-hwaddr</b>
  *</a></h2>
Remove HWADDR (hard-coded MAC address) configuration.
<div class="Pp"></div>
For Fedora and Red Hat Enterprise Linux, this is removed from
  &quot;ifcfg-*&quot; files.
<h2 class="Ss" title="Ss" id="pacct-log_*"><a class="selflink" href="#pacct-log_*"><b>pacct-log</b>
  *</a></h2>
Remove the process accounting log files.
<div class="Pp"></div>
The system wide process accounting will store to the pacct log files if the
  process accounting is on.
<h2 class="Ss" title="Ss" id="package-manager-cache_*"><a class="selflink" href="#package-manager-cache_*"><b>package-manager-cache</b>
  *</a></h2>
Remove package manager cache.
<h2 class="Ss" title="Ss" id="pam-data_*"><a class="selflink" href="#pam-data_*"><b>pam-data</b>
  *</a></h2>
Remove the PAM data in the guest.
<h2 class="Ss" title="Ss" id="puppet-data-log_*"><a class="selflink" href="#puppet-data-log_*"><b>puppet-data-log</b>
  *</a></h2>
Remove the data and log files of puppet.
<h2 class="Ss" title="Ss" id="rh-subscription-manager_*"><a class="selflink" href="#rh-subscription-manager_*"><b>rh-subscription-manager</b>
  *</a></h2>
Remove the RH subscription manager files.
<h2 class="Ss" title="Ss" id="rhn-systemid_*"><a class="selflink" href="#rhn-systemid_*"><b>rhn-systemid</b>
  *</a></h2>
Remove the RHN system ID.
<h2 class="Ss" title="Ss" id="rpm-db_*"><a class="selflink" href="#rpm-db_*"><b>rpm-db</b>
  *</a></h2>
Remove host-specific RPM database files.
<div class="Pp"></div>
Remove host-specific RPM database files and locks. RPM will recreate these files
  automatically if needed.
<h2 class="Ss" title="Ss" id="samba-db-log_*"><a class="selflink" href="#samba-db-log_*"><b>samba-db-log</b>
  *</a></h2>
Remove the database and log files of Samba.
<h2 class="Ss" title="Ss" id="script_*"><a class="selflink" href="#script_*"><b>script</b>
  *</a></h2>
Run arbitrary scripts against the guest.
<div class="Pp"></div>
The &quot;script&quot; module lets you run arbitrary shell scripts or programs
  against the guest.
<div class="Pp"></div>
Note this feature requires FUSE support. You may have to enable this in your
  host, for example by adding the current user to the &quot;fuse&quot; group, or
  by loading a kernel module.
<div class="Pp"></div>
Use one or more <i>--script</i> parameters to specify scripts or programs that
  will be run against the guest.
<div class="Pp"></div>
The script or program is run with its current directory being the guest's root
  directory, so relative paths should be used. For example: &quot;rm
  etc/resolv.conf&quot; in the script would remove a Linux guest's DNS
  configuration file, but &quot;rm /etc/resolv.conf&quot; would (try to) remove
  the host's file.
<div class="Pp"></div>
Normally a temporary mount point for the guest is used, but you can choose a
  specific one by using the <i>--scriptdir</i> parameter.
<div class="Pp"></div>
<b>Note:</b> This is different from <i>--firstboot</i> scripts (which run in the
  context of the guest when it is booting first time). <i>--script</i> scripts
  run on the host, not in the guest.
<h2 class="Ss" title="Ss" id="smolt-uuid_*"><a class="selflink" href="#smolt-uuid_*"><b>smolt-uuid</b>
  *</a></h2>
Remove the Smolt hardware UUID.
<h2 class="Ss" title="Ss" id="ssh-hostkeys_*"><a class="selflink" href="#ssh-hostkeys_*"><b>ssh-hostkeys</b>
  *</a></h2>
Remove the SSH host keys in the guest.
<div class="Pp"></div>
The SSH host keys are regenerated (differently) next time the guest is booted.
<div class="Pp"></div>
If, after cloning, the guest gets the same IP address, ssh will give you a stark
  warning about the host key changing:
<div class="Pp"></div>
<pre>
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 @    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
</pre>
<h2 class="Ss" title="Ss" id="ssh-userdir_*"><a class="selflink" href="#ssh-userdir_*"><b>ssh-userdir</b>
  *</a></h2>
Remove &quot;.ssh&quot; directories in the guest.
<div class="Pp"></div>
Remove the &quot;.ssh&quot; directory of user &quot;root&quot; and any other
  users who have a &quot;.ssh&quot; directory in their home directory.
<div class="Pp"></div>
<i>Notes on ssh-userdir</i>
<div class="Pp"></div>
Currently this only looks in &quot;/root&quot; and &quot;/home/*&quot; for home
  directories, so users with home directories in other locations won't have the
  ssh files removed.
<h2 class="Ss" title="Ss" id="sssd-db-log_*"><a class="selflink" href="#sssd-db-log_*"><b>sssd-db-log</b>
  *</a></h2>
Remove the database and log files of sssd.
<h2 class="Ss" title="Ss" id="tmp-files_*"><a class="selflink" href="#tmp-files_*"><b>tmp-files</b>
  *</a></h2>
Remove temporary files.
<div class="Pp"></div>
This removes temporary files under &quot;/tmp&quot; and &quot;/var/tmp&quot;.
<h2 class="Ss" title="Ss" id="udev-persistent-net_*"><a class="selflink" href="#udev-persistent-net_*"><b>udev-persistent-net</b>
  *</a></h2>
Remove udev persistent net rules.
<div class="Pp"></div>
Remove udev persistent net rules which map the guest's existing MAC address to a
  fixed ethernet device (eg. eth0).
<div class="Pp"></div>
After a guest is cloned, the MAC address usually changes. Since the old MAC
  address occupies the old name (eg. eth0), this means the fresh MAC address is
  assigned to a new name (eg. eth1) and this is usually undesirable. Erasing the
  udev persistent net rules avoids this.
<h2 class="Ss" title="Ss" id="user-account"><a class="selflink" href="#user-account"><b>user-account</b></a></h2>
Remove the user accounts in the guest.
<div class="Pp"></div>
By default remove all the user accounts and their home directories. The
  &quot;root&quot; account is not removed.
<div class="Pp"></div>
See the <i>--remove-user-accounts</i> parameter for a way to specify how to
  remove only some users, or to not remove some others.
<h2 class="Ss" title="Ss" id="utmp_*"><a class="selflink" href="#utmp_*"><b>utmp</b>
  *</a></h2>
Remove the utmp file.
<div class="Pp"></div>
This file records who is currently logged in on a machine. In modern Linux
  distros it is stored in a ramdisk and hence not part of the virtual machine's
  disk, but it was stored on disk in older distros.
<h2 class="Ss" title="Ss" id="yum-uuid_*"><a class="selflink" href="#yum-uuid_*"><b>yum-uuid</b>
  *</a></h2>
Remove the yum UUID.
<div class="Pp"></div>
Yum creates a fresh UUID the next time it runs when it notices that the original
  UUID has been erased.
<h1 class="Sh" title="Sh" id="COPYING_AND_CLONING"><a class="selflink" href="#COPYING_AND_CLONING">COPYING
  AND CLONING</a></h1>
Virt-sysprep can be used as part of a process of cloning guests, or to prepare a
  template from which guests can be cloned. There are many different ways to
  achieve this using the virt tools, and this section is just an introduction.
<div class="Pp"></div>
A virtual machine (when switched off) consists of two parts:
<dl class="Bl-tag">
  <dt class="It-tag"><i>configuration</i></dt>
  <dd class="It-tag">The configuration or description of the guest. eg. The
      libvirt XML (see &quot;virsh dumpxml&quot;), the running configuration of
      the guest, or another external format like OVF.
    <div style="height: 1.00em;">&#x00A0;</div>
    Some configuration items that might need to be changed:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">name</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">UUID</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">path to block device(s)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">network card MAC address</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;"></div>
<dl class="Bl-tag">
  <dt class="It-tag"><i>block device(s)</i></dt>
  <dd class="It-tag">One or more hard disk images, themselves containing files,
      directories, applications, kernels, configuration, etc.
    <div style="height: 1.00em;">&#x00A0;</div>
    Some things inside the block devices that might need to be changed:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">hostname and other net configuration</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">UUID</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">SSH host keys</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Windows unique security ID (SID)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Puppet registration</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;"></div>
<h2 class="Ss" title="Ss" id="COPYING_THE_BLOCK_DEVICE"><a class="selflink" href="#COPYING_THE_BLOCK_DEVICE">COPYING
  THE BLOCK DEVICE</a></h2>
Starting with an original guest, you probably wish to copy the guest block
  device and its configuration to make a template. Then once you are happy with
  the template, you will want to make many clones from it.
<div class="Pp"></div>
<pre>
                        virt-sysprep
                             |
                             v
 original guest --------&gt; template ----------&gt;
                                      \------&gt; cloned
                                       \-----&gt; guests
                                        \----&gt;
</pre>
<div class="Pp"></div>
You can, of course, just copy the block device on the host using <i>cp</i>(1) or
  <i>dd</i>(1).
<div class="Pp"></div>
<pre>
                   dd                 dd
 original guest --------&gt; template ----------&gt;
                                      \------&gt; cloned
                                       \-----&gt; guests
                                        \----&gt;
</pre>
<div class="Pp"></div>
There are some smarter (and faster) ways too:
<div class="Pp"></div>
<pre>
                          snapshot
                template ----------&gt;
                            \------&gt; cloned
                             \-----&gt; guests
                              \----&gt;
</pre>
<div class="Pp"></div>
You may want to run virt-sysprep twice, once to reset the guest (to make a
  template) and a second time to customize the guest for a specific user:
<div class="Pp"></div>
<pre>
                    virt-sysprep        virt-sysprep
                      (reset)      (add user, keys, logos)
                         |                   |
                 dd      v          dd       v
 original guest ----&gt; template ---------&gt; copied ------&gt; custom
                                          template       guest
</pre>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Create a snapshot using qemu-img:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 qemu-img create -f qcow2 -o backing_file=original snapshot.qcow
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    The advantage is that you don't need to copy the original (very fast) and
      only changes are stored (less storage required).
    <div style="height: 1.00em;">&#x00A0;</div>
    Note that writing to the backing file once you have created guests on top of
      it is not possible: you will corrupt the guests.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Create a snapshot using &quot;lvcreate
    --snapshot&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Other ways to create snapshots include using
      filesystems-level tools (for filesystems such as btrfs).
    <div style="height: 1.00em;">&#x00A0;</div>
    Most Network Attached Storage (NAS) devices can also create cheap snapshots
      from files or LUNs.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Get your NAS to duplicate the LUN. Most NAS devices can
      also duplicate LUNs very cheaply (they copy them on-demand in the
      background).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Prepare your template using <i>virt-sparsify</i>(1). See
      below.</dd>
</dl>
<h2 class="Ss" title="Ss" id="VIRT-CLONE"><a class="selflink" href="#VIRT-CLONE">VIRT-CLONE</a></h2>
A separate tool, <i>virt-clone</i>(1), can be used to duplicate the block device
  and/or modify the external libvirt configuration of a guest. It will reset the
  name, UUID and MAC address of the guest in the libvirt XML.
<div class="Pp"></div>
<i>virt-clone</i>(1) does not use libguestfs and cannot look inside the disk
  image. This was the original motivation to write virt-sysprep.
<h2 class="Ss" title="Ss" id="SPARSIFY"><a class="selflink" href="#SPARSIFY">SPARSIFY</a></h2>
<pre>
              virt-sparsify
 original guest --------&gt; template
</pre>
<div class="Pp"></div>
<i>virt-sparsify</i>(1) can be used to make the cloning template smaller, making
  it easier to compress and/or faster to copy.
<div class="Pp"></div>
Notice that since virt-sparsify also copies the image, you can use it to make
  the initial copy (instead of &quot;dd&quot;).
<h2 class="Ss" title="Ss" id="RESIZE"><a class="selflink" href="#RESIZE">RESIZE</a></h2>
<pre>
                         virt-resize
                template ----------&gt;
                            \------&gt; cloned
                             \-----&gt; guests
                              \----&gt;
</pre>
<div class="Pp"></div>
If you want to give people cloned guests, but let them pick the size of the
  guest themselves (eg. depending on how much they are prepared to pay for disk
  space), then instead of copying the template, you can run
  <i>virt-resize</i>(1). Virt-resize performs a copy and resize, and thus is
  ideal for cloning guests from a template.
<h1 class="Sh" title="Sh" id="FIRSTBOOT_VS_SCRIPT"><a class="selflink" href="#FIRSTBOOT_VS_SCRIPT">FIRSTBOOT
  VS SCRIPT</a></h1>
The two options <i>--firstboot</i> and <i>--script</i> both supply shell scripts
  that are run against the guest. However these two options are significantly
  different.
<div class="Pp"></div>
<i>--firstboot script</i> uploads the file &quot;script&quot; into the guest and
  arranges that it will run, in the guest, when the guest is next booted. (The
  script will only run once, at the &quot;first boot&quot;).
<div class="Pp"></div>
<i>--script script</i> runs the shell &quot;script&quot; <i>on the host</i>,
  with its current directory inside the guest filesystem.
<div class="Pp"></div>
If you needed, for example, to &quot;yum install&quot; new packages, then you
  <i>must not</i> use <i>--script</i> for this, since that would (a) run the
  &quot;yum&quot; command on the host and (b) wouldn't have access to the same
  resources (repositories, keys, etc.) as the guest. Any command that needs to
  run on the guest <i>must</i> be run via <i>--firstboot</i>.
<div class="Pp"></div>
On the other hand if you need to make adjustments to the guest filesystem (eg.
  copying in files), then <i>--script</i> is ideal since (a) it has access to
  the host filesystem and (b) you will get immediate feedback on errors.
<div class="Pp"></div>
Either or both options can be used multiple times on the command line.
<h1 class="Sh" title="Sh" id="SECURITY"><a class="selflink" href="#SECURITY">SECURITY</a></h1>
Although virt-sysprep removes some sensitive information from the guest, it does
  not pretend to remove all of it. You should examine the &quot;OPERATIONS&quot;
  above and the guest afterwards.
<div class="Pp"></div>
Sensitive files are simply removed. The data they contained may still exist on
  the disk, easily recovered with a hex editor or undelete tool. The
  <i>--scrub</i> option can be used to scrub files instead of just deleting
  them. <i>virt-sparsify</i>(1) is another way to remove this content. See also
  the <i>scrub</i>(1) command to get rid of deleted content in directory entries
  and inodes.
<h2 class="Ss" title="Ss" id="RANDOM_SEED"><a class="selflink" href="#RANDOM_SEED">RANDOM
  SEED</a></h2>
<i>(This section applies to Linux guests only)</i>
<div class="Pp"></div>
For supported guests, virt-sysprep writes a few bytes of randomness from the
  host into the guest's random seed file.
<div class="Pp"></div>
If this is just done once and the guest is cloned from the same template, then
  each guest will start with the same entropy, and things like SSH host keys and
  TCP sequence numbers may be predictable.
<div class="Pp"></div>
Therefore you should arrange to add more randomness <i>after</i> cloning from a
  template too, which can be done by enabling just the customize module:
<div class="Pp"></div>
<pre>
 cp template.img newguest.img
 virt-sysprep --enable customize -a newguest.img
</pre>
<h1 class="Sh" title="Sh" id="SELINUX"><a class="selflink" href="#SELINUX">SELINUX</a></h1>
For guests which make use of SELinux, special handling for them might be needed
  when using operations which create new files or alter existing ones.
<div class="Pp"></div>
For further details, see &quot;SELINUX&quot; in <i>virt-builder</i>(1).
<h1 class="Sh" title="Sh" id="WINDOWS_8"><a class="selflink" href="#WINDOWS_8">WINDOWS
  8</a></h1>
Windows 8 &quot;fast startup&quot; can prevent virt-sysprep from working. See
  &quot;WINDOWS HIBERNATION AND WINDOWS 8 FAST STARTUP&quot; in
  <i>guestfs</i>(3).
<h1 class="Sh" title="Sh" id="EXIT_STATUS"><a class="selflink" href="#EXIT_STATUS">EXIT
  STATUS</a></h1>
This program returns 0 on success, or 1 if there was an error.
<h1 class="Sh" title="Sh" id="ENVIRONMENT_VARIABLES"><a class="selflink" href="#ENVIRONMENT_VARIABLES">ENVIRONMENT
  VARIABLES</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;VIRT_TOOLS_DATA_DIR&quot;</dt>
  <dd class="It-tag">This can point to the directory containing data files used
      for Windows firstboot installation.
    <div style="height: 1.00em;">&#x00A0;</div>
    Normally you do not need to set this. If not set, a compiled-in default will
      be used (something like <i>/usr/share/virt-tools</i>).
    <div style="height: 1.00em;">&#x00A0;</div>
    This directory may contain the following files:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><i>rhsrvany.exe</i></dt>
  <dd class="It-tag">This is the RHSrvAny Windows binary, used to install a
      &quot;firstboot&quot; script in Windows guests. It is required if you
      intend to use the <i>--firstboot</i> or <i>--firstboot-command</i> options
      with Windows guests.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also: &quot;https://github.com/rwmjones/rhsrvany&quot;</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;"></div>
<div class="Pp"></div>
For other environment variables, see &quot;ENVIRONMENT VARIABLES&quot; in
  <i>guestfs</i>(3).
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<i>guestfs</i>(3), <i>guestfish</i>(1), <i>virt-builder</i>(1),
  <i>virt-clone</i>(1), <i>virt-customize</i>(1), <i>virt-rescue</i>(1),
  <i>virt-resize</i>(1), <i>virt-sparsify</i>(1), <i>virsh</i>(1),
  <i>lvcreate</i>(8), <i>qemu-img</i>(1), <i>scrub</i>(1),
  http://libguestfs.org/, http://libvirt.org/.
<h1 class="Sh" title="Sh" id="AUTHORS"><a class="selflink" href="#AUTHORS">AUTHORS</a></h1>
Richard W.M. Jones http://people.redhat.com/~rjones/
<div class="Pp"></div>
Wanlong Gao, Fujitsu Ltd.
<h1 class="Sh" title="Sh" id="COPYRIGHT"><a class="selflink" href="#COPYRIGHT">COPYRIGHT</a></h1>
Copyright (C) 2011-2016 Red Hat Inc.
<div class="Pp"></div>
Copyright (C) 2012 Fujitsu Ltd.
<h1 class="Sh" title="Sh" id="LICENSE"><a class="selflink" href="#LICENSE">LICENSE</a></h1>
This program is free software; you can redistribute it and/or modify it under
  the terms of the GNU General Public License as published by the Free Software
  Foundation; either version 2 of the License, or (at your option) any later
  version.
<div class="Pp"></div>
This program is distributed in the hope that it will be useful, but WITHOUT ANY
  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
  A PARTICULAR PURPOSE. See the GNU General Public License for more details.
<div class="Pp"></div>
You should have received a copy of the GNU General Public License along with
  this program; if not, write to the Free Software Foundation, Inc., 51 Franklin
  Street, Fifth Floor, Boston, MA 02110-1301 USA.
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
To get a list of bugs against libguestfs, use this link:
  https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&amp;product=Virtualization+Tools
<div class="Pp"></div>
To report a new bug against libguestfs, use this link:
  https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&amp;product=Virtualization+Tools
<div class="Pp"></div>
When reporting a bug, please supply:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The version of libguestfs.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Where you got libguestfs (eg. which Linux distro, compiled
      from source, etc)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Describe the bug accurately and give a way to reproduce
    it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Run <i>libguestfs-test-tool</i>(1) and paste the
      <b>complete, unedited</b> output into the bug report.</dd>
</dl>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2016-08-08</td>
    <td class="foot-os">libguestfs-1.32.7</td>
  </tr>
</table>
</body>
</html>
