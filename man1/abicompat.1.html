<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>ABICOMPAT(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">ABICOMPAT(1)</td>
    <td class="head-vol">Libabigail</td>
    <td class="head-rtitle">ABICOMPAT(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
abicompat - check ABI compatibility
<div style="height: 1.00em;">&#x00A0;</div>
abicompat checks that an application that links against a given shared library
  is still ABI compatible with a subsequent version of that library. If the new
  version of the library introduces an ABI incompatibility, then abicompat hints
  the user at what exactly that incompatibility is.
<h1 class="Sh" title="Sh" id="INVOCATION"><a class="selflink" href="#INVOCATION">INVOCATION</a></h1>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
abicompat [options] [&lt;application&gt; &lt;shared-library-first-version&gt; &lt;shared-library-second-version&gt;]
</pre>
</div>
<br/>
</div>
<br/>
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>--help</b>
    <div style="height: 1.00em;">&#x00A0;</div>
    Display a short help about the command and exit.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>--version | -v</i>
    <div style="height: 1.00em;">&#x00A0;</div>
    Display the version of the program and exit.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>--list-undefined-symbols | -u</b>
    <div style="height: 1.00em;">&#x00A0;</div>
    Display the list of undefined symbols of the application and exit.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>--show-base-names | -b</b>
    <div style="height: 1.00em;">&#x00A0;</div>
    In the resulting report emitted by the tool, this option makes the
      application and libraries be referred to by their base names only; not by
      a full absolute name. This can be useful for use in scripts that wants to
      compare names of the application and libraries independently of what their
      directory names are.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>--app-debug-info-dir | --appd</b>
      &lt;path-to-app-debug-info-directory&gt;
    <div style="height: 1.00em;">&#x00A0;</div>
    Set the path to the directory under which the debug information of the
      application is supposed to be laid out. This is useful for application
      binaries for which the debug info is in a separate set of files.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>--lib-debug-info-dir1 | --libd1</b>
      &lt;path-to-lib1-debug-info&gt;
    <div style="height: 1.00em;">&#x00A0;</div>
    Set the path to the directory under which the debug information of the first
      version of the shared library is supposed to be laid out. This is useful
      for shared library binaries for which the debug info is in a separate set
      of files.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>--lib-debug-info-dir2 | --libd2</b>
      &lt;path-to-lib1-debug-info&gt;
    <div style="height: 1.00em;">&#x00A0;</div>
    Set the path to the directory under which the debug information of the
      second version of the shared library is supposed to be laid out. This is
      useful for shared library binaries for which the debug info is in a
      separate set of files.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>--suppressions | --suppr</b>
      &lt;<i>path-to-suppressions</i>&gt;
    <div style="height: 1.00em;">&#x00A0;</div>
    Use a suppression specification file located at <i>path-to-suppressions</i>.
      Note that this option can appear multiple times on the command line; all
      the suppression specification files are then taken into account.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>--no-show-locs</b></dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">Do not show information about where in the
  <i>second shared library</i> the respective type was changed.</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>--weak-mode</b>
    <div style="height: 1.00em;">&#x00A0;</div>
    This triggers the weak mode of <b>abicompat</b>. In this mode, only one
      version of the library is required. That is, abicompat is invoked like
      this:</dd>
</dl>
<div style="margin-left: 2.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
abicompat --weak-mode &lt;the-application&gt; &lt;the-library&gt;
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Note that the <b>--weak-mode</b> option can even be omitted if only one version
  of the library is given, along with the application; in that case,
  <b>abicompat</b> automatically switches to operate in weak mode:
<div style="margin-left: 2.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
abicompat &lt;the-application&gt; &lt;the-library&gt;
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
In this weak mode, the types of functions and variables exported by the library
  and consumed by the application (as in, the symbols of the these functions and
  variables are undefined in the application and are defined and exported by the
  library) are compared to the version of these types as expected by the
  application. And if these two versions of types are different,
  <b>abicompat</b> tells the user what the differences are.
<div style="height: 1.00em;">&#x00A0;</div>
In other words, in this mode, <b>abicompat</b> checks that the types of the
  functions and variables exported by the library mean the same thing as what
  the application expects, as far as the ABI is concerned.
<div style="height: 1.00em;">&#x00A0;</div>
Note that in this mode, <i>abicompat</i> doesn't detect exported functions or
  variables (symbols) that are expected by the application but that are removed
  from the library. That is why it is called <b>weak</b> mode.</div>
<br/>
</div>
<br/>
</div>
<br/>
<h1 class="Sh" title="Sh" id="RETURN_VALUES"><a class="selflink" href="#RETURN_VALUES">RETURN
  VALUES</a></h1>
The exit code of the <b>abicompat</b> command is either 0 if the ABI of the
  binaries being compared are equal, or non-zero if they differ or if the tool
  encountered an error.
<div style="height: 1.00em;">&#x00A0;</div>
In the later case, the exit code is a 8-bits-wide bit field in which each bit
  has a specific meaning.
<div style="height: 1.00em;">&#x00A0;</div>
The first bit, of value 1, named <b>ABIDIFF_ERROR</b> means there was an error.
<div style="height: 1.00em;">&#x00A0;</div>
The second bit, of value 2, named <b>ABIDIFF_USAGE_ERROR</b> means there was an
  error in the way the user invoked the tool. It might be set, for instance, if
  the user invoked the tool with an unknown command line switch, with a wrong
  number or argument, etc. If this bit is set, then the <b>ABIDIFF_ERROR</b> bit
  must be set as well.
<div style="height: 1.00em;">&#x00A0;</div>
The third bit, of value 4, named <b>ABIDIFF_ABI_CHANGE</b> means the ABI of the
  binaries being compared are different.
<div style="height: 1.00em;">&#x00A0;</div>
The fourth bit, of value 8, named <b>ABIDIFF_ABI_INCOMPATIBLE_CHANGE</b> means
  the ABI of the binaries compared are different in an incompatible way. If this
  bit is set, then the <b>ABIDIFF_ABI_CHANGE</b> bit must be set as well. If the
  <b>ABIDIFF_ABI_CHANGE</b> is set and the <b>ABIDIFF_INCOMPATIBLE_CHANGE</b> is
  <i>NOT</i> set, then it means that the ABIs being compared might or might not
  be compatible. In that case, a human being needs to review the ABI changes to
  decide if they are compatible or not.
<div style="height: 1.00em;">&#x00A0;</div>
The remaining bits are not used for the moment.
<h1 class="Sh" title="Sh" id="USAGE_EXAMPLES"><a class="selflink" href="#USAGE_EXAMPLES">USAGE
  EXAMPLES</a></h1>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Detecting a possible ABI incompatibility in a new shared
      library version:</dd>
</dl>
<div style="margin-left: 2.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ cat -n test0.h
     1  struct foo
     2  {
     3    int m0;
     4
     5    foo()
     6      : m0()
     7    {}
     8  };
     9
    10  foo*
    11  first_func();
    12
    13  void
    14  second_func(foo&amp;);
    15
    16  void
    17  third_func();
$
<div class="Pp"></div>
$ cat -n test-app.cc
     1  // Compile with:
     2  //  g++ -g -Wall -o test-app -L. -ltest-0 test-app.cc
     3
     4  #include &quot;test0.h&quot;
     5
     6  int
     7  main()
     8  {
     9    foo* f = first_func();
    10    second_func(*f);
    11    return 0;
    12  }
$
<div class="Pp"></div>
$ cat -n test0.cc
     1  // Compile this with:
     2  //  g++ -g -Wall -shared -o libtest-0.so test0.cc
     3
     4  #include &quot;test0.h&quot;
     5
     6  foo*
     7  first_func()
     8  {
     9    foo* f = new foo();
    10    return f;
    11  }
    12
    13  void
    14  second_func(foo&amp;)
    15  {
    16  }
    17
    18  void
    19  third_func()
    20  {
    21  }
$
<div class="Pp"></div>
$ cat -n test1.h
     1  struct foo
     2  {
     3    int  m0;
     4    char m1; /* &lt;-- a new member got added here! */
     5
     6    foo()
     7    : m0(),
     8      m1()
     9    {}
    10  };
    11
    12  foo*
    13  first_func();
    14
    15  void
    16  second_func(foo&amp;);
    17
    18  void
    19  third_func();
$
<div class="Pp"></div>
$ cat -n test1.cc
     1  // Compile this with:
     2  //  g++ -g -Wall -shared -o libtest-1.so test1.cc
     3
     4  #include &quot;test1.h&quot;
     5
     6  foo*
     7  first_func()
     8  {
     9    foo* f = new foo();
    10    return f;
    11  }
    12
    13  void
    14  second_func(foo&amp;)
    15  {
    16  }
    17
    18  /* Let's comment out the definition of third_func()
    19     void
    20     third_func()
    21     {
    22     }
    23  */
$
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 2.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Compile the first and second versions of the libraries:
      <b>libtest-0.so</b> and <b>libtest-1.so</b>:</dd>
</dl>
<div style="margin-left: 2.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ g++ -g -Wall -shared -o libtest-0.so test0.cc
$ g++ -g -Wall -shared -o libtest-1.so test1.cc
</pre>
</div>
<br/>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Compile the application and link it against the first
      version of the library, creating the <b>test-app</b> binary:</dd>
</dl>
<div style="margin-left: 2.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ g++ -g -Wall -o test-app -L. -ltest-0.so test-app.cc
</pre>
</div>
<br/>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Now, use <b>abicompat</b> to see if libtest-1.so is ABI
      compatible with app, with respect to the ABI of libtest-0.so:</dd>
</dl>
<div style="margin-left: 2.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ abicompat test-app libtest-0.so libtest-1.so
ELF file 'test-app' might not be ABI compatible with 'libtest-1.so' due to differences with 'libtest-0.so' below:
Functions changes summary: 0 Removed, 2 Changed, 0 Added functions
Variables changes summary: 0 Removed, 0 Changed, 0 Added variable
<div class="Pp"></div>
2 functions with some indirect sub-type change:
<div class="Pp"></div>
  [C]'function foo* first_func()' has some indirect sub-type changes:
    return type changed:
      in pointed to type 'struct foo':
        size changed from 32 to 64 bits
        1 data member insertion:
          'char foo::m1', at offset 32 (in bits)
  [C]'function void second_func(foo&amp;)' has some indirect sub-type changes:
    parameter 0 of type 'foo&amp;' has sub-type changes:
      referenced type 'struct foo' changed, as reported earlier
<div class="Pp"></div>
$
</pre>
</div>
<br/>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Now use the weak mode of abicompat, that is, providing just
      the application and the new version of the library:</dd>
</dl>
<div style="margin-left: 2.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ abicompat --weak-mode test-app libtest-1.so
functions defined in library
    'libtest-1.so'
have sub-types that are different from what application
    'test-app'
expects:
<div class="Pp"></div>
  function foo* first_func():
    return type changed:
      in pointed to type 'struct foo':
        size changed from 32 to 64 bits
        1 data member insertion:
          'char foo::m1', at offset 32 (in bits)
<div class="Pp"></div>
$
</pre>
</div>
<br/>
</div>
<br/>
</div>
<br/>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Dodji Seketeli
<h1 class="Sh" title="Sh" id="COPYRIGHT"><a class="selflink" href="#COPYRIGHT">COPYRIGHT</a></h1>
2014-2016, Red Hat, Inc.</div>
<table class="foot">
  <tr>
    <td class="foot-date">November 24, 2016</td>
    <td class="foot-os"></td>
  </tr>
</table>
</body>
</html>
