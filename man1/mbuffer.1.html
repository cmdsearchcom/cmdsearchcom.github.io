<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:24:09 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>mbuffer(1) console utility mbuffer(1)</p>

<p style="margin-top: 1em">NAME <br>
mbuffer - measuring buffer</p>

<p style="margin-top: 1em">SYNTAX <br>
mbuffer [options]</p>

<p style="margin-top: 1em">DESCRIPTION <br>
mbuffer buffers I/O operations and displays the throughput
rate. It is multi-threaded, supports network connections,
and offers more options than the standard buffer.</p>

<p style="margin-top: 1em">OPTIONS <br>
-i &lt;filename&gt; <br>
Use filename as input instead of the standard input (needs
to be given for multi volume support). If filename is -,
input is read from standard input.</p>

<p style="margin-top: 1em">-I &lt;port&gt; <br>
Use network port port as input instead of the standard
input. If given a hostname and a port in the form
hostname:port, the first interface with the IP of hostname
will be <br>
used.</p>

<p style="margin-top: 1em">-o &lt;filename&gt; <br>
Use filename as output instead of the standard output (needs
to be given for multi volume support, will enable use of
sendfile if available). If filename is -, output is <br>
written to standard output. The option -o can be passed
multiple times to specify multiple outputs.</p>

<p style="margin-top: 1em">-O &lt;hostname:port&gt; <br>
Write output to hostname:port instead of the standard output
(will enable use of sendfile if available). This option can
be used multiple times to send data to multiple <br>
machines.</p>

<p style="margin-top: 1em">-b &lt;num&gt; <br>
Use num blocks for buffer (default 256).</p>

<p style="margin-top: 1em">-s &lt;size&gt; <br>
Use blocks of size bytes for buffer (default pagesize of
system).</p>

<p style="margin-top: 1em">-m &lt;size&gt; <br>
Use a total of size bytes for buffer (default 2MB) - size
can be set with a trailing character (b and B for Byte, k
for kByte, M for MByte, G for Gigabyte, and with % for <br>
a percentage of total physical memory).</p>

<p style="margin-top: 1em">-L Lock buffer in memory - this
option is not available for file-based buffers and requires
mbuffer to be set-UID root (use with care).</p>

<p style="margin-top: 1em">-n &lt;num&gt; <br>
num volumes in input device (requires use of option -i for
input device specification, pass 0 as argument if mbuffer
should prompt for every new volume)</p>

<p style="margin-top: 1em">-t use a memory-mapped temporary
file as buffer (use with huge buffers)</p>

<p style="margin-top: 1em">-T &lt;file&gt; <br>
as -t but use file instead</p>

<p style="margin-top: 1em">-d use block-size of device for
output (needed for some devices, slows output down)</p>

<p style="margin-top: 1em">-D &lt;size&gt; <br>
assume an output volume of size bytes (default infinite)
after which a volume change will be initiated. Small values
are useful for the timely testing of multi-volume <br>
runs; accurate values if your device doesn&rsquo;t properly
signal end of media. Size can be set with a trailing
character (b and B for Byte, k for kByte, M for MByte, or G
for <br>
Gigabyte)</p>

<p style="margin-top: 1em">-P &lt;num&gt; <br>
start writing after the buffer has been filled to num%
(default 0 - start at once)</p>

<p style="margin-top: 1em">-p &lt;num&gt; <br>
start reading after the buffer has dropped below fill-ratio
of num% (default 100 - start at once)</p>

<p style="margin-top: 1em">-l &lt;file&gt; <br>
log messages to file instead of standard error output</p>

<p style="margin-top: 1em">-u &lt;num&gt; <br>
pause num microseconds after each write - might increase
performance on some drives with very low performance (&lt; 1
MB/sec)</p>

<p style="margin-top: 1em">-r &lt;rate&gt; <br>
Set the maximum read rate to &lt;rate&gt;. &lt;rate&gt; can
be given in either Bytes, kBytes, MBytes, or GBytes per
second. To do so, use an appropriate suffix (i.e. k,M,G).
This <br>
option is useful if you have a tape that is capable of
transferring data faster than the host can handle it. In
this case you can use this option to limit the transfer <br>
rate and keep the tape running. Be aware that this is both
good for your tape drive, and enhances overall performance,
by avoiding tape screwing.</p>

<p style="margin-top: 1em">-R &lt;rate&gt; <br>
Same as above only for setting the transfer limit for the
writer.</p>

<p style="margin-top: 1em">-A &lt;cmd&gt; <br>
the device used is an autoloader which uses cmd to load the
next volume. Pass &lt;/bin/false&gt; as an autoload command
to suppress the warning message that appears when run <br>
without controlling terminal (e.g. via cron). Like this the
autoload will fail and mbuffer will terminate with an error
message when reaching the end of the tape.</p>

<p style="margin-top: 1em">-a &lt;time&gt; <br>
the device used is an autoloader which takes time seconds to
load a new tape</p>

<p style="margin-top: 1em">-f overwrite output file if it
exists already</p>

<p style="margin-top: 1em">-c write with synchronous data
integrity support - This option forces all writes to
complete before continuing. This enables errors to be
reported earlier and more precisely, <br>
but might decrease performance. Especially systems with high
level of data integrity support suffer a huge performance
hit. Others might seem to be unaffected, but just <br>
neglect support for full synchronous data integrity.</p>

<p style="margin-top: 1em">-v &lt;num&gt; <br>
set verbose level to num. Valid values are 0..6 (0 = none, 1
= errors, 2 = warnings, 4 = information messages, 5 =
debugging messages, 6 = I/O debugging). Higher values <br>
include lower values messages.</p>

<p style="margin-top: 1em">-q quiet - do not display the
status on the standard error output</p>

<p style="margin-top: 1em">-Q quiet - do not log the status
in the log file</p>

<p style="margin-top: 1em">--direct <br>
Use O_DIRECT to open file descriptors. This option is not
available on all systems. It tells the OS to bypass the page
cache to improve performance when reading and writ&acirc;
<br>
ing. On Solaris this is an auto-magic option that is enabled
if it is supported for the relevant file. Be aware that this
option might lead to read/write failures, if the <br>
buffer isn&rsquo;t properly aligned for direct I/O.
Additionally, open might fail with EINVAL (i.e. invalid
argument) if the named file does not support O_DIRECT.</p>

<p style="margin-top: 1em">--append <br>
Open next output file given via option -o in append
mode.</p>

<p style="margin-top: 1em">--truncate <br>
Truncate next output file given via option -o when opening
it.</p>

<p style="margin-top: 1em">-6 Force IPv6 mode for the
following network I/O options on command line. -4 Force IPv4
mode for the following network I/O options on command line.
-0 Choose IPv4/IPv6 mode <br>
on demand.</p>

<p style="margin-top: 1em">-h, --help <br>
Output help information and exit.</p>

<p style="margin-top: 1em">-H, --md5 <br>
Generate a MD5 hash of transferred data.</p>

<p style="margin-top: 1em">-H, --pid <br>
Print PID of current process. This option can help you to
figure out which instance of mbuffer to kill, if multiple
are running and one is hanging due to a network issue. <br>
Printing of the PID can also be triggered by adding
&quot;printpid = 1&quot; to your .mbuffer.rc file.</p>

<p style="margin-top: 1em">-V, --version <br>
Output version information and exit.</p>

<p style="margin-top: 1em">-W &lt;timeout&gt; <br>
Activates a watchdog that gets triggered every timeout
seconds and checks whether I/O activity has stalled. If
either channel has stalled for a complete period, the
watch&acirc; <br>
dog writes an error message and terminates mbuffer via
SIGINT. Be aware that the watchdog is unaware of tape-change
activities. So choose the watchdog timeout greater that <br>
the worst-case tape-change time. The watchdog is activated
with parsing option -W or after parsing all options. To
avoid that the watchdog will trigger during network
ini&acirc; <br>
tialization, put the option -W after -I and -O.</p>

<p style="margin-top: 1em">DEFAULT VALUES <br>
The default values for following options can be set as key =
value pairs in the ~/.mbuffer.rc file: <br>
blocksize: block size (option -s) <br>
timeout: watchdog timeout (option -W) <br>
totalmem: total buffer size (option -m) <br>
maxreadspeed: maximum read speed (option -r) <br>
maxwritespeed: maximum write speed (option -R) <br>
startwrite: threshold for start writing (option -P) <br>
startread: threshold for start reading (option -p) <br>
pause: pause after writing a block (option -u) <br>
numblocks: number of blocks in buffer (option -b) <br>
memlock: lock buffer in memory (option -L) <br>
showstatus: print transfer status on console (option -q)
<br>
logstatus: write transfer status to logfile (option -Q) <br>
tcpbuffer: TCP buffer size (option --tcpbuffer)</p>

<p style="margin-top: 1em">ENVIRONMENT VARIABLES <br>
If TMPDIR is set, mbuffer allocates storage for file-based
buffers in this directory. If TMPDIR is unset, /var/tmp will
be used.</p>

<p style="margin-top: 1em">FILES <br>
/usr/bin/mbuffer <br>
/var/tmp/mbuffer-* <br>
~/.mbuffer.rc</p>

<p style="margin-top: 1em">EXAMPLES <br>
To run this program with the default options just type:</p>

<p style="margin-top: 1em">mbuffer</p>

<p style="margin-top: 1em">Using mbuffer to do a backup
with tar to the default tape device. Options for this
example: memory-mapped temporary file with a size of 10
Megabytes, start after 80% of the buf&acirc; <br>
fer have been filled.</p>

<p style="margin-top: 1em">tar cf - mydirectory | gzip |
mbuffer -t -m 10M -P 80 -f -o $TAPE</p>

<p style="margin-top: 1em">Using mbuffer with 3 tapes for
input and extracting the contents in the current work
directory:</p>

<p style="margin-top: 1em">mbuffer -n 3 -i $TAPE | gzip -dc
| tar xf -</p>

<p style="margin-top: 1em">Using mbuffer to write to
multiple tape volumes:</p>

<p style="margin-top: 1em">tar cf - /usr | mbuffer -f -o
$TAPE</p>

<p style="margin-top: 1em">Write to multiple tapes and
erase every tape before writing:</p>

<p style="margin-top: 1em">tar cf - /usr | mbuffer -A
&quot;echo next tape; read a &lt; /dev/tty; mt erase
$TAPE&quot; -f -o $TAPE</p>

<p style="margin-top: 1em">Making a backup via network:</p>

<p style="margin-top: 1em">tape server: mbuffer -I 8000 -f
-o $TAPE</p>

<p style="margin-top: 1em">backup client: tar zcf - /home |
mbuffer -O tapeserver:8000</p>

<p style="margin-top: 1em">Distributing a directory tree to
multiple machines:</p>

<p style="margin-top: 1em">master: tar cf - /tree_to_clone
| mbuffer -O clone0:8000 -O clone1:8000</p>

<p style="margin-top: 1em">clones: mbuffer -I master:8000 |
tar xf -</p>

<p style="margin-top: 1em">EXITCODE <br>
mbuffer return 0 upon success. Any kind of failure will
yield a non-zero exit code.</p>

<p style="margin-top: 1em">AUTHORS <br>
Thomas Maier-Komor &lt;thomas@maier-komor.de&gt;</p>

<p style="margin-top: 1em">DONATIONS <br>
If you like this software, and use it for production
purposes in your company, please consider making a donation
to support this work. You can donate directly via PayPal to
the <br>
author&rsquo;s e-mail address (thomas@maier-komor.de).</p>

<p style="margin-top: 1em">HOMEPAGE <br>
http://www.maier-komor.de/mbuffer.html</p>

<p style="margin-top: 1em">LICENSE <br>
This software is published under GNU General Public License
V3. See file LICENSE for details.</p>

<p style="margin-top: 1em">SEE ALSO <br>
buffer(1)</p>

<p style="margin-top: 1em">Thomas Maier-Komor 20170514
mbuffer(1)</p>
<hr>
</body>
</html>
