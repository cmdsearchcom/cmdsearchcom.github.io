<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:10:21 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>floppycontrol(1) General Commands Manual
floppycontrol(1)</p>

<p style="margin-top: 1em">Name <br>
floppycontrol - floppy driver configuration utility</p>

<p style="margin-top: 1em">Note <br>
This manpage has been automatically generated from
fdutils&rsquo;s texinfo documentation. However, this process
is only approximative, and some items, such as
cross-references, foot&acirc; <br>
notes and indices are lost in this translation process.
Indeed, these items have no appropriate representation in
the manpage format. Moreover, only the items specific to
each <br>
command have been translated, and the general information
about fdutils has been dropped in the manpage version. Thus
I strongly advise you to use the original texinfo doc.</p>

<p style="margin-top: 1em">* To generate a printable copy
from the texinfo doc, run the following commands:</p>

<p style="margin-top: 1em">./configure; make dvi; dvips
fdutils.dvi</p>

<p style="margin-top: 1em">* To generate a HTML copy,
run:</p>

<p style="margin-top: 1em">./configure; make html</p>

<p style="margin-top: 1em">A pre-made HTML can be found at:
&lsquo;http://www.tux.org/pub/knaff/fdutils&rsquo;</p>

<p style="margin-top: 1em">* To generate an info copy
(browsable using emacs&rsquo; info mode), run:</p>

<p style="margin-top: 1em">./configure; make info</p>

<p style="margin-top: 1em">The texinfo doc looks most
pretty when printed or as HTML. Indeed, in the info version
certain examples are difficult to read due to the quoting
conventions used in info.</p>

<p style="margin-top: 1em">Description <br>
floppycontrol [-p] [--pollstate] [--printfdstate] <br>
[-a operation-abort-threshold] [-c read-track-threshold]
<br>
[-r recalibrate-threshold] [-R reset-threshold] <br>
[-e reporting-threshold] [-f] [-x] [-d drive][-F] [-T] <br>
[-reset condition] [--debug] [--nodebug] [--messages] <br>
[--nomessages] [--broken_dcl] [--working_dcl]
[--inverted_dcl] <br>
[--no_inverted_dcl] [--silent_dcl_clear] [--noisy_dcl_clear]
<br>
[-ccmos-type] [-hlt hlt] [-hut hut] [-srt srt] [-o spindown]
<br>
[-u spinup] [-s select-delay] [-rps rotations-per-second]
<br>
[-O spindown-offset] [-track max-tracks] [-timeout seconds]
<br>
[-C check-interval] [-n native-format] <br>
[-autodetect autodetection-sequence] [-P] [--clrwerror] <br>
[--printwerror] [-h]</p>

<p style="margin-top: 1em">The floppycontrol program is
used to configure the floppy driver.</p>

<p style="margin-top: 1em">General Options <br>
-h <br>
--help Print a help screen.</p>

<p style="margin-top: 1em">-d drive <br>
--drive drive <br>
Selects the drive to configure. The default is drive 0
(&lsquo;/dev/fd0&rsquo;).</p>

<p style="margin-top: 1em">One time actions <br>
The following floppycontrol options don&rsquo;t set a
configuration parameter, but perform a one-time action. They
are available to anybody who has write access to the
drive</p>

<p style="margin-top: 1em">-f <br>
--flush <br>
Flushes (throws away) the dirty data buffers associated with
this drive.</p>

<p style="margin-top: 1em">-x <br>
--eject <br>
Ejects the disk out of the drive (Sparc). The dirty buffers
are first committed to disk before ejecting it. Fails if the
disk is mounted.</p>

<p style="margin-top: 1em">--reset condition <br>
Resets the FDC under condition . Condition may be one of the
following:</p>

<p style="margin-top: 1em">0 resets the FDC only if a reset
is needed anyways,</p>

<p style="margin-top: 1em">1 resets the FDC also if a raw
command has been performed since the last reset, and</p>

<p style="margin-top: 1em">2 resets the FDC
unconditionally.</p>

<p style="margin-top: 1em">This command may be needed after
some failed raw commands (see section fdrawcmd).</p>

<p style="margin-top: 1em">-F <br>
--formatend <br>
Issues an end format ioctl. This might be needed after
exiting a fdformat in an unclean way. superformat is not
subject to this.</p>

<p style="margin-top: 1em">Printing current settings <br>
-T <br>
--type Print out the drive name of a floppy device. This is
used by the MAKEFLOPPIES script. The drive name is a letter
(describing the drive type) followed by the capacity of <br>
the format in bytes. The letter is E for 3.5 ED drives, H
for 3.5 HD drives, D for 3.5 DD drives, h for 5.25 HD drives
and d for 5.25 DD drives. The drive type letter cor&acirc;
<br>
responds to the oldest drive type supporting the format of
this device node (not necessarily the type of the drive
referred by this node.) For the generic format nodes <br>
(/dev/fd0 et al.) the name of &quot;native format&quot; of
the drive is printed, and for the default formats, if a
generic format has been redefined, its name becomes
(null).</p>

<p style="margin-top: 1em">-p <br>
--print <br>
Prints out the configuration of the drive. The names of the
various fields are the same as the names of the option to
set them, see below.</p>

<p style="margin-top: 1em">-P <br>
--printstate <br>
Prints out the cached internal state of the driver. The
first line lists various attributes about the disk:</p>

<p style="margin-top: 1em">drive present <br>
disk present <br>
disk writable <br>
These are only updated when the drive is accessed.</p>

<p style="margin-top: 1em">spinup <br>
is the time when the motor became switched on for the last
time.</p>

<p style="margin-top: 1em">select <br>
is the time when the drive became selected for the last
time</p>

<p style="margin-top: 1em">first_read <br>
is the time when the first read request after the last spin
up completed.</p>

<p style="margin-top: 1em">probed_fmt <br>
is the index of the autodetected format in the autodetection
sequence for this drive.</p>

<p style="margin-top: 1em">cylinder <br>
is the cylinder where the drive head currently sits. If this
number is negative, it has the following meaning:</p>

<p style="margin-top: 1em">* -1 means that the driver
doesn&rsquo;t know, but the controller does (a seek command
must be issued).</p>

<p style="margin-top: 1em">* -2 means that the controller
doesn&rsquo;t know either, but is sure that it not beyond
the 80th track. The drive needs a recalibration.</p>

<p style="margin-top: 1em">* -3 means that the head may be
beyond the 80th track. The drive needs two successive
recalibrations, because at each recalibration, the
controller only <br>
issues 80 move head commands per recalibration.</p>

<p style="margin-top: 1em">maxblock <br>
is the highest block number that has been read.</p>

<p style="margin-top: 1em">maxcylinder <br>
is a boolean which is set when a sector that is not on
cylinder 0/head 0 has been read. These are used for smart
invalidation of the buffer cache on geometry <br>
change. The buffer cache of the drive is only invalidated on
geometry change when this change actually implies that a
block that has already been read changes <br>
position. This optimization is useful for mtools which
changes the geometry after reading the boot sector.</p>

<p style="margin-top: 1em">generation <br>
is roughly the number of disk changes noticed since boot.
Disk changes are noticed if the disk is actually changed, or
if a flush command is issued and for both <br>
cases if any I/O to/from the disk occurs. (i.e. if you
insert several disks, but don&rsquo;t do any I/O to them,
the generation number stays the same.)</p>

<p style="margin-top: 1em">refs is number of open file
descriptors for this drive. It is always at least one,
because floppycontrol&rsquo;s file descriptor is counted
too.</p>

<p style="margin-top: 1em">device <br>
is format type (as derived from the minor device number)
which is currently being used.</p>

<p style="margin-top: 1em">last_checked <br>
is date (in jiffies) when the drive was last checked for a
disk change, and a disk was actually in the drive.</p>

<p style="margin-top: 1em">--pollstate <br>
Polls the drive and then prints out the internal state of
the driver.(--Printstate only prints out the cached
information without actually polling the drive for a disk
<br>
change.)</p>

<p style="margin-top: 1em">--printfdcstate <br>
Prints out the state of the controller where the target
drive is attached to.</p>

<p style="margin-top: 1em">spec1 <br>
spec2 are the current values of those registers.</p>

<p style="margin-top: 1em">rate is current data transfer
rate</p>

<p style="margin-top: 1em">rawcmd <br>
is true if a raw command has been executed since the last
reset. If this is the case, a reset will be triggered when a
drive on the same FDC is next opened.</p>

<p style="margin-top: 1em">dor is the value of the digital
output register. The 4 high bits are a bit mask describing
which drives are spinning, the 2 low bits describe the
selected drive, bit 2 <br>
is used to reset the FDC, and bit 3 describes whether this
FDC has hold of the interrupt and the DMA. If you have two
FDCs, bit 3 is only set on one of them.</p>

<p style="margin-top: 1em">version <br>
is the version of the FDC. See
&lsquo;linux/include/linux/fdreg.h&rsquo; for a listing of
the FDC version numbers.</p>

<p style="margin-top: 1em">reset is true if a reset needs
to be issued to the FDC before processing the next
request.</p>

<p style="margin-top: 1em">need_configure <br>
is true if this FDC needs configuration by the FD_CONFIGURE
command.</p>

<p style="margin-top: 1em">has_fifo <br>
is set if the FDC understands the FD_CONFIGURE command.</p>

<p style="margin-top: 1em">perp_mode <br>
describes the perpendicular mode of this FDC. 0 is
non-perpendicular mode, 2 is HD perpendicular mode, 3 is ED
perpendicular mode, and 1 is unknown.</p>

<p style="margin-top: 1em">address <br>
is the address of the first I/O port of the FDC. Normally,
this is 0x3f0 for the first FDC and 0x370 for the
second.</p>

<p style="margin-top: 1em">Drive type configuration and
autodetection <br>
The following options handle the different available drive
types, such as double density vs. high density vs. extra
density drives, and 5 1/4 drives vs 3 1/2 drives. Usually
the <br>
drive type is stored in a non-volatile memory, called CMOS,
under the form of an integer ranging from 1 to 6.</p>

<p style="margin-top: 1em">Different drive types are able
to handle and autodetect different formats (different
autodetection lists). They also have different &quot;native
format name&quot;. The native format is the <br>
&quot;usual&quot; format with the highest capacity supported
by the drive. (For example 720KB on a double density 3 1/2
drive, and 1.2MB on a high density 5 1/4 drive.)</p>

<p style="margin-top: 1em">These settings are only
changeable by the super user.</p>

<p style="margin-top: 1em">-c cmos-type <br>
--cmos cmos-type <br>
Set the virtual CMOS type of the floppy drive. This is
useful if</p>

<p style="margin-top: 1em">* the physical CMOS type is
wrong (this may happen with BIOSes which use a non-standard
mapping),</p>

<p style="margin-top: 1em">* you have more than two drives
(the physical CMOS may only describe up to two drives).</p>

<p style="margin-top: 1em">* you have a BIOS that allows
swapping drives A: and B: for DOS.</p>

<p style="margin-top: 1em">Right now, this CMOS parameter
is not used by the kernel, except for feeding it back to
other applications (for instance superformat, floppymeter or
MAKEFLOPPIES). It is also <br>
possible to supply a virtual CMOS type with the cmos boot
option (see section Boottime configuration). If possible, I
recommend you use the boot option, rather than
floppycon&acirc; <br>
trol, because the boot option also sets any parameters
derived from the CMOS type, such as the autodetection list
and the native format, whereas floppycontrol does not.</p>

<p style="margin-top: 1em">-A autodetect-seq <br>
--autodetect autodetect-seq <br>
Set the autodetection sequence (see section Autodetection)
The autodetection sequence is a comma-separated list of at
most eight format descriptors. Each format descrip&acirc;
<br>
tor is a format number optionally followed by the letter t.
For drive 0, the format number is the minor device number
divided by 4. The autodetection sequence is used by <br>
the driver to find out the format of a newly inserted disk.
The formats are tried one after the other, and the first
matching format is retained. To test the format, the <br>
driver tries to read the first sector on the first track on
the first head when t is not given, or the whole first track
when t is given. Thus, autodetection cannot detect <br>
the number of tracks. However, this information is contained
in the boot sector, which is now accessible. The boot sector
can then be used by mtools to configure the cor&acirc; <br>
rect number of tracks.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">7,4,24t,25</p>

<p style="margin-top: 1em">means to try out the formats
whose minor device numbers are 28 (1.44M), 16 (720KB), 96
(1.76MB), and 100 (1.92MB), in this order. For the 1.76MB
format, try to read the <br>
whole track at once.</p>

<p style="margin-top: 1em">Reading the whole track at once
allows you to distinguish between two formats which differ
only in the number of sectors. (The format with the most
sectors must be tried <br>
first.) If you use mtools, you do not need this feature, as
mtools can figure out the number of sectors without any help
from the floppy driver, by looking at the boot <br>
sector.</p>

<p style="margin-top: 1em">Reading the whole track at once
may also speed up the first read by 200 milliseconds.
However, if, on the other hand, you try to read a disk which
has less sectors than <br>
the format, you lose some time.</p>

<p style="margin-top: 1em">I suggest that you put the most
often used format in the first place (barring other
constraints), as each format that is tried out takes 400
milliseconds.</p>

<p style="margin-top: 1em">-n native-format <br>
--native_format native-format <br>
Set the native format of this drive. The native format of a
drive is the highest standard format available for this
drive. (Example: For a 5 1/4 HD drive it is the usual <br>
1200K format.) This is format is used to make up the format
name for the generic device (which is the name of the native
format). This drive name is read back from the <br>
kernel by the MAKEFLOPPIES script which uses it to decide
which device nodes to create.</p>

<p style="margin-top: 1em">Configuration of the disk change
line <br>
--broken_dcl <br>
Assumes that the disk change line of the drive is broken. If
this is set, disk changes are assumed to happen whenever the
device node is first opened. The physical disk <br>
change line is ignored.</p>

<p style="margin-top: 1em">This option should be used if
disk changes are either not detected at all, or if disk
changes are detected when the disk was actually not changed.
If this option fixes <br>
the problem, I&rsquo;d recommend that you try to trace the
root cause of the problem. Indeed, this options results in
reduced performance due to spurious cache flushes.</p>

<p style="margin-top: 1em">The following hardware problems
may lead to a bad disk change line:</p>

<p style="margin-top: 1em">* If the floppy cable is not
inserted straight, or if it is kinked, the disk change line
is likely to suffer, as it is on the edge of the cable.
Gently press on both <br>
connectors of the cable (drive and controller) to insure
that all wires make contact. Visually inspect the cable, and
if it shows obvious traces of damage, get a <br>
new one.</p>

<p style="margin-top: 1em">* On some drives, the locations
disk change line may be chosen by jumper. Make sure that
your floppy controller and your drive agree on which line is
the disk change <br>
line.</p>

<p style="margin-top: 1em">* Some older drives (mostly
double density 5 1/4 drives) don&rsquo;t have a disk change
line. In this case, you have no choice other than to leave
the broken_dcl option <br>
on.</p>

<p style="margin-top: 1em">--working_dcl <br>
Assumes that the disk change line works all right. Switching
from broken to working may lead to unexpected results after
the first disk change.</p>

<p style="margin-top: 1em">--inverted_dcl <br>
Assumes that this disk drive uses an inverted disk change
line. Apparently this is the case for IBM thinkpads.</p>

<p style="margin-top: 1em">--no_inverted_dcl <br>
Assumes that this drive follows the standard convention for
the disk change line.</p>

<p style="margin-top: 1em">--noisy_dcl_clear <br>
Switches off silent disk change line clearing for this
drive.</p>

<p style="margin-top: 1em">Timing Parameters <br>
This section describes how to configure drive timings. To
set these parameters, you need superuser privileges. All
times are in &quot;jiffy&quot; units (10 milliseconds),
unless otherwise <br>
specified.</p>

<p style="margin-top: 1em">--hlt hlt <br>
Set the head load time (in microseconds) for this floppy
drive. The head load time describes how long the floppy
controller waits after seeking or changing heads before <br>
allowing access to a track.</p>

<p style="margin-top: 1em">--hut hut <br>
Set the head unload time (in microseconds) for this floppy
drive. The head unload time describes how long the floppy
controller waits after an access before directing its <br>
attention to the other head, or before seeking.</p>

<p style="margin-top: 1em">--srt srt <br>
Set the step rate (in microseconds) for this floppy drive.
The step rate describes how long the drive head stays on one
cylinder when seeking. Setting this value to low <br>
(too fast seeks) may make seeks fail, because the motor
doesn&rsquo;t follow fast enough.</p>

<p style="margin-top: 1em">-u spinup-time <br>
--spinup spinup-time <br>
Set the spinup time of the floppy drive. In order to do read
or write to the floppy disk, it must spin. It takes a
certain time for the motor to reach enough speed to read
<br>
or write. This parameter describes this time. The floppy
driver doesn&rsquo;t try to access the drive before the
spinup time has elapsed. With modern controllers, you may
set <br>
this time to zero, as the controller itself enforces the
right delay.</p>

<p style="margin-top: 1em">-o spindown-time <br>
--spindown spindown-time <br>
Set the spindown time of this floppy drive. The motor is not
stopped immediately after the operation completes, because
there might be more operations following. The spin&acirc;
<br>
down time is the time the driver waits before switching off
the motor.</p>

<p style="margin-top: 1em">-O spindown-offset <br>
--spindown_offset spindown-offset <br>
Set the spindown offset of this floppy drive. This parameter
is used to set the position in which the disk stops. This is
useful to minimize the next access time. (If the <br>
first sector is just near the head at the very moment at
which the disk has reached enough speed, you win 200
milliseconds against the most unfavorable situation).</p>

<p style="margin-top: 1em">This is done by clocking the
time where the first I/O request completes, and using this
time to calculate the current position of the disk.</p>

<p style="margin-top: 1em">-s select-delay <br>
--select_delay select-delay <br>
Set the select delay of this floppy drive. This is the delay
that the driver waits after selecting the drive and issuing
the first command to it. For modern con&acirc; <br>
trollers/drives, you may set this to zero.</p>

<p style="margin-top: 1em">-C check-interval <br>
--checkfreq check-interval <br>
Set the maximal disk change check interval. The disk change
line is checked whenever a read or write to the device is
issued, and it has not been checked for more than <br>
interval jiffies.</p>

<p style="margin-top: 1em">Debugging messages <br>
This subsection describes how to switch the available
debugging messages on and off.</p>

<p style="margin-top: 1em">--debug <br>
Switch debugging output on. The debugging information
includes timing information. This option might be useful to
fine-tune the timing options for your local setups. (But
<br>
for most normal purposes, the default values are good
enough.)</p>

<p style="margin-top: 1em">--nodebug <br>
Switch debugging output off.</p>

<p style="margin-top: 1em">--messages <br>
Print informational messages after autodetection, geometry
parameter clearing and dma over/underruns.</p>

<p style="margin-top: 1em">--nomessages <br>
Don&rsquo;t print informational messages after these
events.</p>

<p style="margin-top: 1em">Error Handling Options <br>
The following options configure the behavior of the floppy
driver in case of read/write errors. They may be used by any
user who has write privileges for the drive. Whenever the
<br>
floppy driver encounters an error, a retry counter is
incremented. If the value of this counter gets bigger than
the thresholds described below, the corresponding actions
are <br>
performed at the next retry. The counter is reset when the
read or write finally terminates, whether successfully or
not.</p>

<p style="margin-top: 1em">-a operation-abort-threshold
<br>
--abort operation-abort-threshold <br>
Tell the floppy driver to stop trying to read/write a sector
after operation-abort-threshold retries, and signal the I/O
error to the user.</p>

<p style="margin-top: 1em">-t read-track-threshold <br>
--readtrack read-track-threshold <br>
Tell the floppy driver to switch from track-reading mode to
sector-at-a-time-mode after read-track-threshold
retries.</p>

<p style="margin-top: 1em">-r recalibrate-threshold <br>
--recalibrate recalibrate-threshold <br>
Tell the floppy driver to recalibrate the drive after
recalibrate-threshold retries.</p>

<p style="margin-top: 1em">-R reset-threshold <br>
--reset reset-threshold <br>
Tell the floppy driver to reset the controller after
reset-threshold retries. After a controller reset, the
floppy driver also recalibrates all drives connected to that
<br>
controller.</p>

<p style="margin-top: 1em">-e error-report-threshold <br>
--reporting error-report-threshold <br>
Tell the floppy driver to start printing error messages to
the console after error-report-threshold retries.</p>

<p style="margin-top: 1em">Write error reporting <br>
Due to the buffer cache, write errors cannot always be
reported to the writing user program as soon as the write
system call returns. Indeed, the actual writing may take
place <br>
much later. If a write error is encountered, the floppy
driver stores information about it in its per drive write
error structure. This write error structure stays until
explic&acirc; <br>
itly cleared. It can for example be queried by a backup
program which wants to make sure that the data has been
written successfully.</p>

<p style="margin-top: 1em">--clrwerror <br>
Clears the write error structure.</p>

<p style="margin-top: 1em">--printwerror <br>
Prints the contents of the write error structure:</p>

<p style="margin-top: 1em">write_errors <br>
is a count of how many write errors have occurred since the
structure was last cleared.</p>

<p style="margin-top: 1em">badness <br>
is the maximal number of retries that were needed to
complete an operation (reads, writes and formats).</p>

<p style="margin-top: 1em">first_error_sector <br>
is where the first (chronologically) write error
occurred.</p>

<p style="margin-top: 1em">first_error_generation <br>
is the disk change generation in which did the first write
error occurred. The disk change generation is a number which
is incremented at each disk change.</p>

<p style="margin-top: 1em">last_error_sector <br>
and</p>

<p style="margin-top: 1em">last_error_generation <br>
are similar.</p>

<p style="margin-top: 1em">Other drive configuration
options <br>
This subsection lists per drive configuration options, which
don&rsquo;t fit in any other category. They are available
only to the superuser:</p>

<p style="margin-top: 1em">--tracks max-tracks <br>
Set the maximal numbers of physical tracks that this drive
may handle. If you have a drive which is only able to handle
80 tracks (making strange noises when you try to <br>
format or read a disk with more than 80 tracks), use this
option to prevent unprivileged users of damaging your drive
by repeatedly reading disks with more than 80 tracks.</p>

<p style="margin-top: 1em">If you trust your users and your
disks, you don&rsquo;t need this. With most drives you
don&rsquo;t need to worry anyways. See section More
cylinders, for details.</p>

<p style="margin-top: 1em">-i sector-interleave <br>
--interleave sector-interleave <br>
Set the number of sectors beyond which sector interleaving
will be used. This option will only be used by the FDFMTTRK
ioctl. The fdformat command, which is now consid&acirc; <br>
ered obsolete, uses FDFMTTRK ioctl, but superformat does
not.</p>

<p style="margin-top: 1em">See Also <br>
Fdutils&rsquo; texinfo doc</p>

<p style="margin-top: 1em">fdutils-5.5 03Mar05
floppycontrol(1)</p>
<hr>
</body>
</html>
