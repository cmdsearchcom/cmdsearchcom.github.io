<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>MYSQLFAILOVER(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">MYSQLFAILOVER(1)</td>
    <td class="head-vol">MySQL Utilities</td>
    <td class="head-rtitle">MYSQLFAILOVER(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
mysqlfailover - Automatic replication failover
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<div class="Pp" style="margin-left: 24.00ex; text-indent: -24.00ex;"><b>mysqlfailover
  [</b> <b></b><i>options</i><b>]</b></div>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
This utility permits users to perform replication health monitoring and
  automatic failover on a replication topology consisting of a master and its
  slaves. The utility is designed to run interactively or continuously
  refreshing the health information at periodic intervals. Its primary mission
  is to monitor the master for failure and when a failure occurs, execute
  failover to the best slave available. The utility accepts a list of slaves to
  be considered the candidate slave.
<div class="Pp"></div>
This utility is designed to work exclusively for servers that support global
  transaction identifiers (GTIDs) and have gtid_mode=ON. MySQL server versions
  5.6.5 and higher support GTIDs. See <b>Replication with Global Transaction
  Identifiers</b>[1] for more information.
<div class="Pp"></div>
The user can specify the interval in seconds to use for detecting the master
  status and generating the health report using the <b>--interval</b> option. At
  each interval, the utility will check to see if the server is alive via a ping
  operation followed by a check of the connector to detect if the server is
  still reachable. The ping operation can be controlled with the <b>--ping</b>
  option (see below).
<div class="Pp"></div>
If the master is found to be offline or unreachable, the utility will execute
  one of the following actions based on the <b>--failover-mode</b> option value.
  The available values are:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;<b>auto</b> (default): Execute
  automatic failover to the list of candidates first and if no slaves are
  viable, continue to locate a viable candidate from the list of slaves. If no
  slaves are found to be a viable candidate, the utility will generate and error
  and exit.
<div style="height: 1.00em;">&#x00A0;</div>
Once a candidate is found, the utility will conduct failover to the best slave.
  The command will test each candidate slave listed for the prerequisites. Once
  a candidate slave is elected, it is made a slave of each of the other slaves
  thereby collecting any transactions executed on other slaves but not the
  candidate. In this way, the candidate becomes the most up-to-date slave.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;<b>elect</b>: This mode is the same as
  auto, except if no candidates specified in the list of candidate slaves are
  viable, then it does not check the remaining slaves, and instead generates an
  error and then exits.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;<b>fail</b>: This mode produces an
  error and does not failover when the master is downed. This mode is used to
  provide periodic health monitoring without the failover action taken.</div>
<div class="Pp"></div>
For all options that permit specifying multiple servers, the options require a
  comma-separated list of connection parameters in the following form (where the
  password, port, and socket are optional).:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
&lt;*user*&gt;[:&lt;*passwd*&gt;]@&lt;*host*&gt;[:&lt;*port*&gt;][:&lt;*socket*&gt;] or
&lt;*login-path*&gt;[:&lt;*port*&gt;][:&lt;*socket*&gt;]
</pre>
</div>
<div class="Pp"></div>
The utility permits users to discover slaves connected to the master. In order
  to use the discover slaves feature, all slaves must use the --report-host and
  --report-port startup variables to specify the correct hostname and port of
  the slave. If these are missing or report the incorrect information, the
  slave's health may not be reported correctly or the slave may not be listed at
  all. The discover slaves feature ignores any slaves to which it cannot
  connect.
<div class="Pp"></div>
The discover slaves feature is run automatically on each interval.
<div class="Pp"></div>
The utility permits the user to specify an external script to execute before and
  after the switchover and failover commands. The user can specify these with
  the <b>--exec-before</b> and <b>--exec-after</b> options. The return code of
  the script is used to determine success thus each script must report 0
  (success) to be considered successful. If a script returns a value other than
  0, the result code is presented in an error message.
<div class="Pp"></div>
The utility also permits the user to specify a script to be used for detecting a
  downed master or an application-level event to trigger failover. This can be
  specified using the <b>--exec-fail-check</b> option. The return code for the
  script is used to invoke failover. A return code of 0 indicates failover
  should not take place. A return code other than 0 indicates failover should
  take place. This is checked at the start of each interval if a script is
  supplied. The timeout option is not used in this case and the script is run
  once at the start of each interval.
<div class="Pp"></div>
The utility permits the user to log all actions taken during the commands. The
  <b>--log</b> option requires a valid path and file name of the file to use for
  logging operations. The log is active only when this option is specified. The
  option <b>--log-age</b> specifies the age in days that log entries are kept.
  The default is seven (7) days. Older entries are automatically deleted from
  the log file (but only if the <b>--log</b> option is specified).
<div class="Pp"></div>
The format of the log file includes the date and time of the event, the level of
  the event (informational - INFO, warning - WARN, error - ERROR, critical
  failure - CRITICAL), and the message reported by the utility.
<div class="Pp"></div>
The interface provides a number of options for displaying additional
  information. You can choose to view the replication health report (default),
  or choose to view the list of GTIDs in use, the UUIDs in use, or view the log
  file contents if logging is enabled. Each of these reports is described below.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;<b>health</b> Display the replication
  health of the topology. This report is the default view for the interface. By
  default, this includes the host name, port, role (MASTER or SLAVE) of the
  server, state of the server (UP = is connected, WARN = not connected but can
  ping, DOWN = not connected and cannot ping), the GTID_MODE, and health state.
<div style="height: 1.00em;">&#x00A0;</div>
The master health state is based on the following: if GTID_MODE=ON, the server
  must have the binary log enabled, and a user must exist with the REPLICATE
  SLAVE privilege.
<div style="height: 1.00em;">&#x00A0;</div>
The <b>--seconds-behind</b> option is used to detect when a slave is behind the
  master. It allows users to set a threshold for reporting purposes only. It
  does not apply to slave candidacy or selection during failover.
<div style="height: 1.00em;">&#x00A0;</div>
The slave health state is based on the following: the IO_THREAD and SQL_THREADS
  must be running, it must be connected to the master, there are no errors, the
  slave delay for non-GTID enabled scenarios is not more than the threshold
  provided by the <b>--max-position</b> and the slave is reading the correct
  master log file, and slave delay is not more than the <b>--seconds-behind</b>
  threshold option.
<div style="height: 1.00em;">&#x00A0;</div>
At each interval, if the discover slaves option was specified at startup and new
  slaves are discovered, the health report is refreshed.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;<b>gtid</b>: Display the master's list
  of executed GTIDs, contents of the GTID variables; @@GLOBAL.GTID_EXECUTED,
  @@GLOBAL.GTID_PURGED, and @@GLOBAL.GTID_OWNED. Thus, you can toggle through
  the four screens by pressing the 'G' key.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;<b>UUID</b>: Display universally
  unique identifiers (UUIDs) for all servers.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;<b>Log</b>: This option displays the
  contents of the log file, which only visible if the <b>--log</b> option is
  specified. This can be helpful to see when failover occurred, and which
  actions or messages were recorded at the time.</div>
<div class="Pp"></div>
The user interface is designed to match the size of the terminal window in which
  it is run. A refresh option is provided to permit users to resize their
  terminal windows or refresh the display at any time. However, the interface
  will automatically resize to the terminal window on each interval.
<div class="Pp"></div>
The interface will display the name of the utility, the master's status
  including binary log file, position, and filters as well as the date and time
  of the next interval event.
<div class="Pp"></div>
The interface will also permit the user to scroll up or down through a list
  longer than what the terminal window permits. When a long list is presented,
  the scroll options become enabled. The user can scroll the list up with the up
  arrow key and down with the down arrow key.
<div class="Pp"></div>
Use the <b>--verbose</b> option to see additional information in the health
  report and additional messages during failover.
<div class="Pp"></div>
The utility supports two modes of operation. The default mode, running as a
  console, works as described above. An additional mode that permits you to run
  the utility as a daemon is provided for POSIX platforms.
<div class="Pp"></div>
When run as a daemon, the utility does not have interactivity. However, all
  events are written to the log file. You can control what is written to the log
  by using the <b>--report-values</b> option.
<div class="Pp"></div>
To run the utility as a daemon, use the <b>--daemon</b> option. There are four
  commands that can be used in <b>--daemon</b> option. These include:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;start
<div style="height: 1.00em;">&#x00A0;</div>
Starts the daemon. The <b>--log</b> option is required.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;stop
<div style="height: 1.00em;">&#x00A0;</div>
Stops the daemon. If you used the option <b>--pidfile</b>, the value must be the
  same when starting the daemon.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;restart
<div style="height: 1.00em;">&#x00A0;</div>
Restarts the daemon. If you used the option <b>--pidfile</b>, the value must be
  the same when starting the daemon.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;nodetach
<div style="height: 1.00em;">&#x00A0;</div>
Starts the daemon, but it will not detach the process from the console. The
  <b>--log</b> option is required.</div>
OPTIONS.PP <b>mysqlfailover</b> accepts the following command-line options:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--help
<div style="height: 1.00em;">&#x00A0;</div>
Display a help message and exit.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--license
<div style="height: 1.00em;">&#x00A0;</div>
Display license information and exit.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--candidates=&lt;candidate slave
  connections&gt;
<div style="height: 1.00em;">&#x00A0;</div>
Connection information for candidate slave servers. Valid only with failover
  command. List multiple slaves in comma-separated list.
<div style="height: 1.00em;">&#x00A0;</div>
To connect to a server, it is necessary to specify connection parameters such as
  user name, host name, password, and either a port or socket. MySQL Utilities
  provides a number of ways to provide this information. All of the methods
  require specifying your choice via a command-line option such as --server,
  --master, --slave, etc. The methods include the following in order of most
  secure to least secure.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;Use login-paths from your .mylogin.cnf
  file (encrypted, not visible). Example : &lt;
  <i>login-path</i>&gt;[:&lt;<i>port</i>&gt;][:&lt; <i>socket</i>&gt;]</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;Use a configuration file (unencrypted,
  not visible) Note: available in release-1.5.0. Example : &lt;
  <i>configuration-file-path</i>&gt;[:&lt; <i>section</i>&gt;]</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;Specify the data on the command-line
  (unencrypted, visible). Example : &lt;
  <i>user</i>&gt;[:&lt;<i>passwd</i>&gt;]@&lt;
  <i>host</i>&gt;[:&lt;<i>port</i>&gt;][:&lt; <i>socket</i>&gt;]</div>
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--daemon=&lt;command&gt;
<div style="height: 1.00em;">&#x00A0;</div>
Run as a daemon. The <i>command</i> can be start (start daemon), stop (stop
  daemon), restart (stop then start the daemon) or nodetach (start but do not
  detach the process). This option is only available for POSIX systems.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--discover-slaves-login=&lt;user:password&gt;
<div style="height: 1.00em;">&#x00A0;</div>
At startup, query master for all registered slaves and use the user name and
  password specified to connect. Supply the user and password in the form &lt;
  <i>user</i>&gt;[:&lt;<i>passwd</i>&gt;] or &lt;<i>login-path</i>&gt;. For
  example, --discover=joe:secret will use 'joe' as the user and 'secret' as the
  password for each discovered slave.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--exec-after=&lt;script&gt;
<div style="height: 1.00em;">&#x00A0;</div>
Name of script to execute after failover or switchover. Script name may include
  the path.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--exec-before=&lt;script&gt;
<div style="height: 1.00em;">&#x00A0;</div>
Name of script to execute before failover or switchover. Script name may include
  the path.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--exec-fail-check=&lt;script&gt;
<div style="height: 1.00em;">&#x00A0;</div>
Name of script to execute on each interval to invoke failover.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--exec-post-failover=&lt;script&gt;
<div style="height: 1.00em;">&#x00A0;</div>
Name of script to execute after failover is complete and the utility has
  refreshed the health report.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--failover-mode=&lt;mode&gt;, -f
  &lt;mode&gt;
<div style="height: 1.00em;">&#x00A0;</div>
Action to take when the master fails. 'auto' = automatically fail to best slave,
  'elect' = fail to candidate list or if no candidate meets criteria fail,
  'fail' = take no action and stop when master fails. Default = 'auto'.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--force
<div style="height: 1.00em;">&#x00A0;</div>
Override the registration check on master for multiple instances of the console
  monitoring the same master. See notes.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--interval=&lt;seconds&gt;, -i
  &lt;seconds&gt;
<div style="height: 1.00em;">&#x00A0;</div>
Interval in seconds for polling the master for failure and reporting health.
  Default = 15 seconds. Minimum is 5 seconds.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--log=&lt;log_file&gt;
<div style="height: 1.00em;">&#x00A0;</div>
Specify a log file to use for logging messages</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--log-age=&lt;days&gt;
<div style="height: 1.00em;">&#x00A0;</div>
Specify maximum age of log entries in days. Entries older than this will be
  purged on startup. Default = 7 days.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--master=&lt;connection&gt;
<div style="height: 1.00em;">&#x00A0;</div>
Connection information for the master server.
<div style="height: 1.00em;">&#x00A0;</div>
To connect to a server, it is necessary to specify connection parameters such as
  user name, host name, password, and either a port or socket. MySQL Utilities
  provides a number of ways to provide this information. All of the methods
  require specifying your choice via a command-line option such as --server,
  --master, --slave, etc. The methods include the following in order of most
  secure to least secure.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;Use login-paths from your .mylogin.cnf
  file (encrypted, not visible). Example : &lt;
  <i>login-path</i>&gt;[:&lt;<i>port</i>&gt;][:&lt; <i>socket</i>&gt;]</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;Use a configuration file (unencrypted,
  not visible) Note: available in release-1.5.0. Example : &lt;
  <i>configuration-file-path</i>&gt;[:&lt; <i>section</i>&gt;]</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;Specify the data on the command-line
  (unencrypted, visible). Example : &lt;
  <i>user</i>&gt;[:&lt;<i>passwd</i>&gt;]@&lt;
  <i>host</i>&gt;[:&lt;<i>port</i>&gt;][:&lt; <i>socket</i>&gt;]</div>
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--max-position=&lt;position&gt;
<div style="height: 1.00em;">&#x00A0;</div>
Used to detect slave delay. The maximum difference between the master's log
  position and the slave's reported read position of the master. A value greater
  than this means the slave is too far behind the master. Default = 0.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--pedantic, -p
<div style="height: 1.00em;">&#x00A0;</div>
Used to stop failover if some inconsistencies are found, such as errant
  transactions on slaves or SQL thread errors, during server checks. By default,
  the utility only generates warnings if issues are found when checking a
  slave's status during failover, and it will continue its execution unless this
  option is specified.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--pidfile=&lt;pidfile&gt;
<div style="height: 1.00em;">&#x00A0;</div>
Pidfile for running <b>mysqlfailover</b> as a daemon. This file contains the PID
  (process identifier), that uniquely identifies a process. It is needed to
  identify and control the process forked by <b>mysqlfailover</b>.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--ping=&lt;number&gt;
<div style="height: 1.00em;">&#x00A0;</div>
Number of ping attempts for detecting a downed server. Default is 3 seconds.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>Note</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
On some platforms, this is the same as number of seconds to wait for ping to
  return.
<div style="height: 0.50em;">&#x00A0;</div>
</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--report-values=&lt;report_values&gt;
<div style="height: 1.00em;">&#x00A0;</div>
Report values used in mysqlfailover running as a daemon. It can be health, gtid
  or uuid. Multiple values can be used separated by commas.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;health
<div style="height: 1.00em;">&#x00A0;</div>
Display the replication health of the topology.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;gtid
<div style="height: 1.00em;">&#x00A0;</div>
Display the master's list of executed GTIDs, contents of the GTID variables;
  @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_PURGED and @@GLOBAL.GTID_OWNED.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;uuid
<div style="height: 1.00em;">&#x00A0;</div>
Display universally unique identifiers (UUIDs) for all servers.</div>
<div style="height: 1.00em;">&#x00A0;</div>
Default = health.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--rpl-user=:&lt;replication_user&gt;
<div style="height: 1.00em;">&#x00A0;</div>
The user and password for the replication user requirement, in the form: &lt;
  <i>user</i>&gt;[:&lt;<i>password</i>&gt;] or &lt;<i>login-path</i>&gt;. E.g.
  rpl:passwd
<div style="height: 1.00em;">&#x00A0;</div>
Default = None.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--script-threshold=&lt;return_code&gt;
<div style="height: 1.00em;">&#x00A0;</div>
Value for external scripts to trigger aborting the operation if result is
  greater than or equal to the threshold.
<div style="height: 1.00em;">&#x00A0;</div>
Default = None (no threshold checking).</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--seconds-behind=&lt;seconds&gt;
<div style="height: 1.00em;">&#x00A0;</div>
Used to detect slave delay (only for health reporting purposes). The maximum
  number of seconds behind the master permitted before slave is considered
  behind the master in the health report state. Default = 0.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--slaves=&lt;slave connections&gt;
<div style="height: 1.00em;">&#x00A0;</div>
Connection information for slave servers. List multiple slaves in
  comma-separated list. The list will be evaluated literally whereby each server
  is considered a slave to the master listed regardless if they are a slave of
  the master.
<div style="height: 1.00em;">&#x00A0;</div>
To connect to a server, it is necessary to specify connection parameters such as
  user name, host name, password, and either a port or socket. MySQL Utilities
  provides a number of ways to provide this information. All of the methods
  require specifying your choice via a command-line option such as --server,
  --master, --slave, etc. The methods include the following in order of most
  secure to least secure.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;Use login-paths from your .mylogin.cnf
  file (encrypted, not visible). Example : &lt;
  <i>login-path</i>&gt;[:&lt;<i>port</i>&gt;][:&lt; <i>socket</i>&gt;]</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;Use a configuration file (unencrypted,
  not visible) Note: available in release-1.5.0. Example : &lt;
  <i>configuration-file-path</i>&gt;[:&lt; <i>section</i>&gt;]</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;Specify the data on the command-line
  (unencrypted, visible). Example : &lt;
  <i>user</i>&gt;[:&lt;<i>passwd</i>&gt;]@&lt;
  <i>host</i>&gt;[:&lt;<i>port</i>&gt;][:&lt; <i>socket</i>&gt;]</div>
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--ssl-ca
<div style="height: 1.00em;">&#x00A0;</div>
The path to a file that contains a list of trusted SSL CAs.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--ssl-cert
<div style="height: 1.00em;">&#x00A0;</div>
The name of the SSL certificate file to use for establishing a secure
  connection.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--ssl-key
<div style="height: 1.00em;">&#x00A0;</div>
The name of the SSL key file to use for establishing a secure connection.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--ssl
<div style="height: 1.00em;">&#x00A0;</div>
Specifies if the server connection requires use of SSL. If an encrypted
  connection cannot be established, the connection attempt fails. Default
  setting is 0 (SSL not required).</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--timeout=&lt;seconds&gt;
<div style="height: 1.00em;">&#x00A0;</div>
Maximum timeout in seconds to wait for each replication command to complete. For
  example, timeout for slave waiting to catch up to master.
<div style="height: 1.00em;">&#x00A0;</div>
Default = 3.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--verbose, -v
<div style="height: 1.00em;">&#x00A0;</div>
Specify how much information to display. Use this option multiple times to
  increase the amount of information. For example, <b>-v</b> = verbose,
  <b>-vv</b> = more verbose, <b>-vvv</b> = debug.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;--version
<div style="height: 1.00em;">&#x00A0;</div>
Display version information and exit.</div>
NOTES.PP The login user must have the appropriate permissions for the utility to
  check servers and monitor their status (e.g., SHOW SLAVE STATUS, SHOW MASTER
  STATUS). The user must also have permissions to execute the failover procedure
  (e.g., STOP SLAVE, START SLAVE, WAIT_UNTIL_SQL_THREAD_AFTER_GTIDS, CHANGE
  MASTER TO ...). Lastly, the user must have the REPLICATE SLAVE privilege for
  slaves to connect to their master. The same permissions are required by the
  failover utility for master and slaves in order to run successfully. In
  particular, users connected to slaves, candidates and master require
  <b>SUPER</b>, <b>GRANT OPTION</b>, <b>REPLICATION SLAVE</b>, <b>RELOAD</b>,
  <b>DROP</b>, <b>CREATE</b>, <b>INSERT</b> and <b>SELECT</b> privileges.
<div class="Pp"></div>
The <b>DROP</b>, <b>CREATE</b>, <b>INSERT</b> and <b>SELECT</b> privileges are
  required to register the failover instance on the initial master or the new
  master (after a successful failover). Therefore, since any slave can become
  the new master, slaves and candidates also require those privileges. The
  utility checks permissions for the master, slaves, and candidates at startup.
<div class="Pp"></div>
At startup, the console will attempt to register itself with the master. If
  another console is already registered, and the failover mode is auto or elect,
  the console will be blocked from running failover. When a console quits, it
  unregisters itself from the master. If this process is broken, the user may
  override the registration check by using the <b>--force</b> option.
<div class="Pp"></div>
Mixing IP and hostnames is not recommended. The replication-specific utilities
  will attempt to compare hostnames and IP addresses as aliases for checking
  slave connectivity to the master. However, if your installation does not
  support reverse name lookup, the comparison could fail. Without the ability to
  do a reverse name lookup, the replication utilities could report a false
  negative that the slave is (not) connected to the master.
<div class="Pp"></div>
For example, if you setup replication using MASTER_HOST=ubuntu.net on the slave
  and later connect to the slave with mysqlrplcheck and have the master
  specified as --master=192.168.0.6 using the valid IP address for ubuntu.net,
  you must have the ability to do a reverse name lookup to compare the IP
  (192.168.0.6) and the hostname (ubuntu.net) to determine if they are the same
  machine.
<div class="Pp"></div>
Similarly, in order to avoid issues mixing local IP '127.0.0.1' with
  'localhost', all the addresses '127.0.0.1' will be internally converted to
  'localhost' by the utility. Nevertheless, It is best to use the actual
  hostname of the master when connecting or setting up replication.
<div class="Pp"></div>
The utility will check to see if the slaves are using the option
  --master-info-repository=TABLE. If they are not, the utility will stop with an
  error.
<div class="Pp"></div>
The path to the MySQL client tools should be included in the PATH environment
  variable in order to use the authentication mechanism with login-paths. This
  will allow the utility to use the my_print_defaults tools which is required to
  read the login-path values from the login configuration file (.mylogin.cnf).
<div class="Pp"></div>
The console creates a special table in the mysql database that is used to keep
  track of which instance is communicating with the master. If you use the
  <b>--force</b> option, the console will remove the rows in this table. The
  table is constructed with:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
CREATE TABLE IF NOT EXISTS mysql.failover_console (host char(30), port char(10))
</pre>
</div>
<div class="Pp"></div>
When the console starts, a row is inserted containing the hostname and port of
  the master. On startup, if a row matches these values, the console will not
  start. If you use the <b>--force</b> option, the row is deleted.
<div class="Pp"></div>
When running the utility using the <b>--daemon=nodetach</b> option, the
  <b>--pidfile</b> option can be omitted. It will be ignored if used.
<div class="Pp"></div>
When using the external scripts, the following parameters are passed in the
  order shown.
<div class="Pp"></div>
For example, suppose you have a script named 'run_before.sh' and you specify
  that you want it executing before the failover is performed (using the
  <b>--exec-before</b> option). Further, let us assume the master MySQL Server
  is using port 3306 on the host &#x2018;host1&#x2019; and the MySQL Server that
  will become the new master is using port 3308 on host 'can_host2'. The script
  would therefore be invoked in the following manner.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
% run_before.sh host1 3306 can_host2 3308
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Table&#x00A0;5.2.&#x00A0;External Script Parameters</b>
<table class="tbl">
  <colgroup>
    <col style="width: 72.00ex;"/>
    <col style="width: 66.00ex;"/>
  </colgroup>
  <tr>
    <td>MySQL Failover Option</td>
    <td>Parameters Passed to External Script</td>
  </tr>
  <tr>
    <td><b>--exec-before</b></td>
    <td>master host, master port, candidate host, candidate port</td>
  </tr>
  <tr>
    <td><b>--exec-after</b></td>
    <td>new master host, new master port</td>
  </tr>
  <tr>
    <td><b>--exec-fail-check</b></td>
    <td>master host, master port</td>
  </tr>
  <tr>
    <td><b>--exec-post-failover</b> (no errors during failover)</td>
    <td>old master host, old master port, new master host, new master port</td>
  </tr>
  <tr>
    <td><b>--exec-post-failover</b> (errors during failover)</td>
    <td>old master host, old master port</td>
  </tr>
</table>
<div style="height: 1.00em;">&#x00A0;</div>
EXAMPLES.PP
<div>&#x00A0;</div>
To launch the utility, you must specify at a minimum the <b>--master</b> option
  and either the <b>--discover-slaves-login</b> option or the <b>--slaves</b>
  option. The <b>--discover-slaves-login</b> option can be used in conjunction
  with the <b>--slaves</b> option to specify a list of known slaves (or slaves
  that do not report their host and IP) and to discover any other slaves
  connected to the master.
<div class="Pp"></div>
An example of the user interface and some of the report views are shown in the
  following examples.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>Note</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
<div class="Pp"></div>
The &quot;GTID Executed Set&quot; will display the first GTID listed in the SHOW
  MASTER STATUS view. If there are multiple GTIDs listed, the utility shall
  display [...] to indicate there are additional GTIDs to view. You can view the
  complete list of GTIDs on the GTID display screens.
<div style="height: 0.50em;">&#x00A0;</div>
</div>
<div class="Pp"></div>
The default interface will display the replication health report like the
  following. In this example the log file is enabled. A sample startup command
  is shown below:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
shell&gt;  <b>mysqlfailover --master=root@localhost:3331 --discover-slaves-login=root --log=log.txt</b>
MySQL Replication Monitor and Failover Utility
Failover Mode = auto     Next Interval = Mon Mar 19 15:56:03 2012
Master Information
------------------
Binary Log File   Position  Binlog_Do_DB  Binlog_Ignore_DB
mysql-bin.000001  571
GTID Executed Set
2A67DE00-2DA1-11E2-A711-00764F2BE90F:1-7 [...]
Replication Health Status
+------------+-------+---------+--------+------------+---------+
| host       | port  | role    | state  | gtid_mode  | health  |
+------------+-------+---------+--------+------------+---------+
| localhost  | 3331  | MASTER  | UP     | ON         | OK      |
| localhost  | 3332  | SLAVE   | UP     | ON         | OK      |
| localhost  | 3333  | SLAVE   | UP     | ON         | OK      |
| localhost  | 3334  | SLAVE   | UP     | ON         | OK      |
+------------+-------+---------+--------+------------+---------+
Q-quit R-refresh H-health G-GTID Lists U-UUIDs L-log entries
</pre>
</div>
<div class="Pp"></div>
Press Q to exit the utility, R to refresh the current display, and H returns to
  the replication health report.
<div class="Pp"></div>
Press G key to show a GTID report similar to the following. The first page shown
  is the master's executed GTID set:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
MySQL Replication Monitor and Failover Utility
Failover Mode = auto     Next Interval = Mon Mar 19 15:59:33 2012
Master Information
------------------
Binary Log File   Position  Binlog_Do_DB  Binlog_Ignore_DB
mysql-bin.000001  571
GTID Executed Set
2A67DE00-2DA1-11E2-A711-00764F2BE90F:1-7 [...]
Master GTID Executed Set
+-------------------------------------------+
| gtid                                      |
+-------------------------------------------+
| 2A67DE00-2DA1-11E2-A711-00764F2BE90F:1-7  |
| 5503D37E-2DB2-11E2-A781-8077D4C14B33:1-3  |
+-------------------------------------------+
Q-quit R-refresh H-health G-GTID Lists U-UUIDs L-log entries Up|Down-scroll
</pre>
</div>
<div class="Pp"></div>
Continuing to press G key cycles through the three GTID lists.
<div class="Pp"></div>
If the list is longer than the screen permits as shown in the example above, the
  scroll up and down help is also shown. In this case, press the down arrow key
  to scroll down.
<div class="Pp"></div>
Press U to view the list of UUIDs used in the topology, for example:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
MySQL Replication Monitor and Failover Utility
Failover Mode = auto     Next Interval = Mon Mar 19 16:02:34 2012
Master Information
------------------
Binary Log File   Position  Binlog_Do_DB  Binlog_Ignore_DB
mysql-bin.000001  571
GTID Executed Set
2A67DE00-2DA1-11E2-A711-00764F2BE90F:1-7 [...]
UUIDs
+------------+-------+---------+---------------------------------------+
| host       | port  | role    | uuid                                  |
+------------+-------+---------+---------------------------------------+
| localhost  | 3331  | MASTER  | 55c65a00-71fd-11e1-9f80-ac64ef85c961  |
| localhost  | 3332  | SLAVE   | 5dd30888-71fd-11e1-9f80-dc242138b7ec  |
| localhost  | 3333  | SLAVE   | 65ccbb38-71fd-11e1-9f80-bda8146bdb0a  |
| localhost  | 3334  | SLAVE   | 6dd6abf4-71fd-11e1-9f80-d406a0117519  |
+------------+-------+---------+---------------------------------------+
Q-quit R-refresh H-health G-GTID Lists U-UUIDs L-log entries
</pre>
</div>
<div class="Pp"></div>
If, once the master is detected as down and failover mode is auto or elect and
  there are viable candidate slaves, the failover feature will engage
  automatically and the user will see the failover messages appear. When
  failover is complete, the interface returns to monitoring replication health
  after 5 seconds. The following shows an example of failover occurring.:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
Failover starting...
# Candidate slave localhost:3332 will become the new master.
# Preparing candidate for failover.
# Creating replication user if it does not exist.
# Stopping slaves.
# Performing STOP on all slaves.
# Switching slaves to new master.
# Starting slaves.
# Performing START on all slaves.
# Checking slaves for errors.
# Failover complete.
# Discovering slaves for master at localhost:3332
Failover console will restart in 5 seconds.
</pre>
</div>
<div class="Pp"></div>
After the failover event, the new topology is shown in the replication health
  report.:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
MySQL Replication Monitor and Failover Utility
Failover Mode = auto     Next Interval = Mon Mar 19 16:05:12 2012
Master Information
------------------
Binary Log File   Position  Binlog_Do_DB  Binlog_Ignore_DB
mysql-bin.000001  1117
GTID Executed Set
2A67DE00-2DA1-11E2-A711-00764F2BE90F:1-7 [...]
UUIDs
+------------+-------+---------+--------+------------+---------+
| host       | port  | role    | state  | gtid_mode  | health  |
+------------+-------+---------+--------+------------+---------+
| localhost  | 3332  | MASTER  | UP     | ON         | OK      |
| localhost  | 3333  | SLAVE   | UP     | ON         | OK      |
| localhost  | 3334  | SLAVE   | UP     | ON         | OK      |
+------------+-------+---------+--------+------------+---------+
Q-quit R-refresh H-health G-GTID Lists U-UUIDs L-log entries
</pre>
</div>
<div class="Pp"></div>
Pressing L with the <b>--log</b> option specified causes the interface to show
  the entries in the log file, such as:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
MySQL Replication Monitor and Failover Utility
Failover Mode = auto     Next Interval = Mon Mar 19 16:06:13 2012
Master Information
------------------
Binary Log File   Position  Binlog_Do_DB  Binlog_Ignore_DB
mysql-bin.000001  1117
GTID Executed Set
2A67DE00-2DA1-11E2-A711-00764F2BE90F:1-7 [...]
Log File
+-------------------------+----------------------------------------- ... --+
| Date                    | Entry                                    ...   |
+-------------------------+----------------------------------------- ... --+
| 2012-03-19 15:55:33 PM  | INFO Failover console started.           ...   |
| 2012-03-19 15:55:33 PM  | INFO Failover mode = auto.               ...   |
| 2012-03-19 15:55:33 PM  | INFO Getting health for master: localhos ...   |
| 2012-03-19 15:55:33 PM  | INFO Master status: binlog: mysql-bin.00 ...   |
+-------------------------+----------------------------------------- ... --+
Q-quit R-refresh H-health G-GTID Lists U-UUIDs L-log entries Up|Down-scroll\
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
PERMISSIONS REQUIRED.PP The user must have permissions to monitor the servers on
  the topology and configure replication to successfully perform the failover
  operation. Additional permissions are also required to register and unregister
  the running mysqlfailover instance on the master and slaves. Specifically, the
  login user must have the following privileges: SUPER, GRANT OPTION,
  REPLICATION SLAVE, RELOAD, DROP, CREATE, INSERT, and SELECT.
<div class="Pp"></div>
The referred permissions are required for the login users used for all servers
  (master, slaves and candidates).
<h1 class="Sh" title="Sh" id="COPYRIGHT"><a class="selflink" href="#COPYRIGHT">COPYRIGHT</a></h1>
Copyright &#x00A9; 2006, 2015, Oracle and/or its affiliates. All rights
  reserved.
<div class="Pp"></div>
This documentation is free software; you can redistribute it and/or modify it
  only under the terms of the GNU General Public License as published by the
  Free Software Foundation; version 2 of the License.
<div class="Pp"></div>
This documentation is distributed in the hope that it will be useful, but
  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
  details.
<div class="Pp"></div>
You should have received a copy of the GNU General Public License along with the
  program; if not, write to the Free Software Foundation, Inc., 51 Franklin
  Street, Fifth Floor, Boston, MA 02110-1301 USA or see
  http://www.gnu.org/licenses/.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"> 1.</dt>
  <dd class="It-tag">Replication with Global Transaction Identifiers</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dev.mysql.com/doc/refman/5.6/en/replication-gtids.html</div>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
For more information, please refer to the MySQL Utilities and Fabric
  documentation, which is available online at
  http://dev.mysql.com/doc/index-utils-fabric.html
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Oracle Corporation (http://dev.mysql.com/).</div>
<table class="foot">
  <tr>
    <td class="foot-date">09/15/2015</td>
    <td class="foot-os">MySQL 1.5.6</td>
  </tr>
</table>
</body>
</html>
