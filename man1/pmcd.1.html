<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>PMCD(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">PMCD(1)</td>
    <td class="head-vol">General Commands Manual</td>
    <td class="head-rtitle">PMCD(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
<b>pmcd</b> - performance metrics collector daemon
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>pmcd</b> [ <b>-AfQSv</b>] [ <b>-c</b> <i>config</i>] [ <b>-C</b>
  <i>dirname</i>] [ <b>-H</b> <i>hostname</i>] [ <b>-i</b> <i>ipaddress</i>] [
  <b>-l</b> <i>logfile</i>] [ <b>-L</b> <i>bytes</i>] [ <b>-M</b>
  <i>certname</i>] [ <b>-</b>[<b>n</b>|<b>N</b>] <i>pmnsfile</i>] [ <b>-p</b>
  <i>port</i>[,<i>port</i> ...]] [ <b>-P</b> <i>passfile</i>] [ <b>-q</b>
  <i>timeout</i>] [ <b>-s</b> <i>sockname</i>] [ <b>-T</b> <i>traceflag</i>] [
  <b>-t</b> <i>timeout</i>] [ <b>-U</b> <i>username</i>] [ <b>-x</b>
  <i>file</i>]
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<b>pmcd</b> is the collector used by the Performance Co-Pilot (see
  <b>PCPIntro</b>(1)) to gather performance metrics on a system. As a rule,
  there must be an instance of <b>pmcd</b> running on a system for any
  performance metrics to be available to the PCP.
<div class="Pp"></div>
<b>pmcd</b> accepts connections from client applications running either on the
  same machine or remotely and provides them with metrics and other related
  information from the machine that <b>pmcd</b> is executing on. <b>pmcd</b>
  delegates most of this request servicing to a collection of Performance
  Metrics Domain Agents (or just agents), where each agent is responsible for a
  particular group of metrics, known as the domain of the agent. For example the
  <b>postgresql</b> agent is responsible for reporting information relating to
  the PostgreSQL database, such as the transaction and query counts, indexing
  and replication statistics, and so on.
<div class="Pp"></div>
The agents may be processes started by <b>pmcd</b>, independent processes or
  Dynamic Shared Objects (DSOs, see <b>dlopen</b>(3)) attached to <b>pmcd</b>'s
  address space. The configuration section below describes how connections to
  agents are specified.
<div class="Pp"></div>
The options to <b>pmcd</b> are as follows.
<dl class="Bl-tag">
  <dt class="It-tag"><b>-A</b></dt>
  <dd class="It-tag">Disable service advertisement. By default, <b>pmcd</b> will
      advertise its presence on the network using any available mechanisms (such
      as Avahi/DNS-SD), assisting remote monitoring tools with finding it. These
      mechanisms are disabled with this option.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-c</b> <i>config</i></dt>
  <dd class="It-tag">On startup <b>pmcd</b> uses a configuration file from
      either the <i>$PCP_PMCDCONF_PATH</i>, configuration variable in
      <i>/etc/pcp.conf</i>, or an environment variable of the same name.
      However, these values may be overridden with <i>config</i> using this
      option. The format of this configuration file is described below.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-C</b> <i>dirname</i></dt>
  <dd class="It-tag">Specify the path to the Network Security Services
      certificate database, for (optional) secure connections. The default is
      <b>/etc/pki/nssdb</b>. Refer also to the <b>-P</b> option. If it does not
      already exist, this database can be created using the <b>certutil</b>
      utility. This process and other certificate database maintenance
      information is provided in the <b>PCPIntro</b>(1) manual page and the
      online PCP tutorials.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-f</b></dt>
  <dd class="It-tag">By default <b>pmcd</b> is started as a daemon. The
      <b>-f</b> option indicates that it should run in the foreground. This is
      most useful when trying to diagnose problems with misbehaving agents.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-H</b> <i>hostname</i></dt>
  <dd class="It-tag">This option can be used to set the hostname that
      <b>pmcd</b> will use to represent this instance of itself. This is used by
      client tools like <b>pmlogger</b>(1) when reporting on the (possibly
      remote) host. If this option is not set, the pmcd.hostname metric will
      match that returned by <b>pmhostname</b>(1). Refer to the manual page for
      that tool for full details on how the hostname is evaluated.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-i</b> <i>ipaddress</i></dt>
  <dd class="It-tag">This option is usually only used on hosts with more than
      one network interface. If no <b>-i</b> options are specified <b>pmcd</b>
      accepts connections made to any of its host's IP (Internet Protocol)
      addresses. The <b>-i</b> option is used to specify explicitly an IP
      address that connections should be accepted on. <i>ipaddress</i> should be
      in the standard dotted form (e.g. 100.23.45.6). The <b>-i</b> option may
      be used multiple times to define a list of IP addresses. Connections made
      to any other IP addresses the host has will be refused. This can be used
      to limit connections to one network interface if the host is a network
      gateway. It is also useful if the host takes over the IP address of
      another host that has failed. In such a situation only the standard IP
      addresses of the host should be given (not the ones inherited from the
      failed host). This allows PCP applications to determine that a host has
      failed, rather than connecting to the host that has assumed the identity
      of the failed host.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-l</b> <i>logfile</i></dt>
  <dd class="It-tag">By default a log file named <i>pmcd.log</i> is written in
      the directory <b>$PCP_LOG_DIR/pmcd</b>. The <b>-l</b> option causes the
      log file to be written to <i>logfile</i> instead of the default. If the
      log file cannot be created or is not writable, output is written to the
      standard error instead.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-L</b> <i>bytes</i></dt>
  <dd class="It-tag"><i>PDU</i>s received by <b>pmcd</b> from monitoring clients
      are restricted to a maximum size of 65536 bytes by default to defend
      against Denial of Service attacks. The <b>-L</b> option may be used to
      change the maximum incoming <i>PDU</i> size.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-M</b> <i>certname</i></dt>
  <dd class="It-tag">By default, pmcd will try to use a certificate called
      <b>PCP Collector certificate .</b> The <b>-M</b> option allows this to be
      changed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-n</b> <i>pmnsfile</i></dt>
  <dd class="It-tag">Normally <b>pmcd</b> loads the default Performance Metrics
      Name Space (PMNS) from <b>$PCP_VAR_DIR/pmns/root</b>, however if the
      <b>-n</b> option is specified an alternative namespace is loaded from the
      file <i>pmnsfile</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-N</b> <i>pmnsfile</i></dt>
  <dd class="It-tag">Same function as <b>-n</b>, except for the handling of
      duplicate Performance Metric Identifiers (PMIDs) in <i>pmnsfile</i> -
      duplicate names are allowed with <b>-n</b> they are not allowed with
      <b>-N</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-P</b> <i>passfile</i></dt>
  <dd class="It-tag">Specify the path to a file containing the Network Security
      Services certificate database password for (optional) secure connections,
      and for databases that are password protected. Refer also to the <b>-C</b>
      option. When using this option, great care should be exercised to ensure
      appropriate ownership (&quot;pcp&quot; user, typically) and permissions on
      this file (0400, so as to be unreadable by any user other than the user
      running the <b>pmcd</b> process).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-q</b> <i>timeout</i></dt>
  <dd class="It-tag">The pmcd to agent version exchange protocol (new in PCP 2.0
      - introduced to provide backward compatibility) uses this timeout to
      specify how long pmcd should wait before assuming that no version response
      is coming from an agent. If this timeout is reached, the agent is assumed
      to be an agent which does not understand the PCP 2.0 protocol. The default
      timeout interval is five seconds, but the <b>-q</b> option allows an
      alternative timeout interval (which must be greater than zero) to be
      specified. The unit of time is seconds.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-Q</b></dt>
  <dd class="It-tag">Require that all remote client connections provide a
      certficate.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-S</b></dt>
  <dd class="It-tag">Require that all client connections provide user
      credentials. This means that only unix domain sockets, or authenticated
      connections are permitted (requires secure sockets support). If any user
      or group access control requirements are specified in the pmcd
      configuration file, then this mode of operation is automatically entered,
      whether the <b>-S</b> flag is specified or not.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-s</b> <i>sockname</i></dt>
  <dd class="It-tag">Specify the path to a local unix domain socket (for
      platforms supporting this socket family only). The default value is
      <i>$PCP_RUN_DIR/pmcd.socket</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-t</b> <i>timeout</i></dt>
  <dd class="It-tag">To prevent misbehaving clients or agents from hanging the
      entire Performance Metrics Collection System (PMCS), <b>pmcd</b> uses
      timeouts on PDU exchanges with clients and agents running as processes. By
      default the timeout interval is five seconds. The <b>-t</b> option allows
      an alternative timeout interval in seconds to be specified. If
      <i>timeout</i> is zero, timeouts are turned off. It is almost impossible
      to use the debugger interactively on an agent unless timeouts have been
      turned off for its &quot;parent&quot; <b>pmcd</b>.</dd>
</dl>
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
Once <b>pmcd</b> is running, the timeout may be dynamically modified by storing
  an integer value (the timeout in seconds) into the metric
  <b>pmcd.control.timeout</b> via <b>pmstore</b>(1).</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-T</b> <i>traceflag</i></dt>
  <dd class="It-tag">To assist with error diagnosis for agents and/or clients of
      <b>pmcd</b> that are not behaving correctly, an internal event tracing
      mechanism is supported within <b>pmcd</b>. The value of <i>traceflag</i>
      is interpreted as a bit field with the following control functions:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>1</b></dt>
  <dd class="It-tag">enable client connection tracing</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>2</b></dt>
  <dd class="It-tag">enable PDU tracing</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>256</b></dt>
  <dd class="It-tag">unbuffered event tracing</dd>
</dl>
<div class="Pp"></div>
By default, event tracing is buffered using a circular buffer that is
  over-written as new events are recorded. The default buffer size holds the
  last 20 events, although this number may be over-ridden by using
  <b>pmstore</b>(1) to modify the metric <b>pmcd.control.tracebufs</b>.
<div class="Pp"></div>
Similarly once <b>pmcd</b> is running, the event tracing control may be
  dynamically modified by storing 1 (enable) or 0 (disable) into the metrics
  <b>pmcd.control.traceconn</b>, <b>pmcd.control.tracepdu</b> and
  <b>pmcd.control.tracenobuf</b>. These metrics map to the bit fields associated
  with the <i>traceflag</i> argument for the <b>-T</b> option.
<div class="Pp"></div>
When operating in buffered mode, the event trace buffer will be dumped whenever
  an agent connection is terminated by <b>pmcd</b>, or when any value is stored
  into the metric <b>pmcd.control.dumptrace</b> via <b>pmstore</b>(1).
<div class="Pp"></div>
In unbuffered mode, <b>every</b> event will be reported when it occurs.</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-U</b> <i>username</i></dt>
  <dd class="It-tag">User account under which to run <b>pmcd</b>. The default is
      the unprivileged &quot;pcp&quot; account in current versions of PCP, but
      in older versions the superuser account (&quot;root&quot;) was used by
      default.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-v</b></dt>
  <dd class="It-tag">Verify the <b>pmcd</b> configuration file, reporting on any
      errors then exiting with a status indicating verification success or
      failure.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-x</b> <i>file</i></dt>
  <dd class="It-tag">Before the <b>pmcd</b> <i>logfile</i> can be opened,
      <b>pmcd</b> may encounter a fatal error which prevents it from starting.
      By default, the output describing this error is sent to <b>/dev/tty</b>
      but it may redirected to <i>file</i>.</dd>
</dl>
<div class="Pp"></div>
If a PDU exchange with an agent times out, the agent has violated the
  requirement that it delivers metrics with little or no delay. This is deemed a
  protocol failure and the agent is disconnected from <b>pmcd</b>. Any
  subsequent requests for information from the agent will fail with a status
  indicating that there is no agent to provide it.
<div class="Pp"></div>
It is possible to specify access control to <b>pmcd</b> based on users, groups
  and hosts. This allows one to prevent users, groups of users, and certain
  hosts from accessing the metrics provided by <b>pmcd</b> and is described in
  more detail in the Section on ACCESS CONTROL below.
<h1 class="Sh" title="Sh" id="CONFIGURATION"><a class="selflink" href="#CONFIGURATION">CONFIGURATION</a></h1>
On startup <b>pmcd</b> looks for a configuration file named
  <i>$PCP_PMCDCONF_PATH</i>. This file specifies which agents cover which
  performance metrics domains and how <b>pmcd</b> should make contact with the
  agents. An optional section specifying access controls may follow the agent
  configuration data.
<div class="Pp"></div>
<b>Warning</b>: <b>pmcd</b> is usually started as part of the boot sequence and
  runs initially as root. The configuration file may contain shell commands to
  create agents, which will be executed by root. To prevent security breaches
  the configuration file should be writable only by root. The use of absolute
  path names is also recommended.
<div class="Pp"></div>
The case of the reserved words in the configuration file is unimportant, but
  elsewhere, the case is preserved.
<div class="Pp"></div>
Blank lines and comments are permitted (even encouraged) in the configuration
  file. A comment begins with a ``#'' character and finishes at the end of the
  line. A line may be continued by ensuring that the last character on the line
  is a ``\'' (backslash). A comment on a continued line ends at the end of the
  continued line. Spaces may be included in lexical elements by enclosing the
  entire element in double quotes. A double quote preceded by a backslash is
  always a literal double quote. A ``#'' in double quotes or preceded by a
  backslash is treated literally rather than as a comment delimiter. Lexical
  elements and separators are described further in the following sections.
<h1 class="Sh" title="Sh" id="AGENT_CONFIGURATION"><a class="selflink" href="#AGENT_CONFIGURATION">AGENT
  CONFIGURATION</a></h1>
Each line of the agent configuration section of the configuration file contains
  details of how to connect <b>pmcd</b> to one of its agents and specifies which
  metrics domain the agent deals with. An agent may be attached as a DSO, or via
  a socket, or a pair of pipes.
<div class="Pp"></div>
Each line of the agent configuration section of the configuration file must be
  either an agent specification, a comment, or a blank line. Lexical elements
  are separated by whitespace characters, however a single agent specification
  may not be broken across lines unless a <b>\</b> (backslash) is used to
  continue the line.
<div class="Pp"></div>
Each agent specification must start with a textual label (string) followed by an
  integer in the range 1 to 510. The label is a tag used to refer to the agent
  and the integer specifies the domain for which the agent supplies data. This
  domain identifier corresponds to the domain portion of the PMIDs handled by
  the agent. Each agent must have a unique label and domain identifier.
<div class="Pp"></div>
For DSO agents a line of the form:
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><i>label</i> <i>domain-no</i> <b>dso</b> <i>entry-point</i>
      <i>path</i></dd>
</dl>
<div class="Pp"></div>
should appear. Where,
<dl class="Bl-tag">
  <dt class="It-tag"><i>label</i></dt>
  <dd class="It-tag">is a string identifying the agent</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>domain-no</i></dt>
  <dd class="It-tag">is an unsigned integer specifying the agent's domain in the
      range 1 to 510</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>entry-point</i></dt>
  <dd class="It-tag">is the name of an initialization function which will be
      called when the DSO is loaded</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>path</i></dt>
  <dd class="It-tag">designates the location of the DSO and this is expected to
      be an absolute pathname. <b>pmcd</b> is only able to load DSO agents that
      have the same <i>simabi</i> (Subprogram Interface Model ABI, or calling
      conventions) as it does (i.e. only one of the <i>simabi</i> versions will
      be applicable). The <i>simabi</i> version of a running <b>pmcd</b> may be
      determined by fetching <b>pmcd.simabi</b>. Alternatively, the
      <b>file</b>(1) command may be used to determine the <i>simabi</i> version
      from the <b>pmcd</b> executable.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">For a relative <i>path</i> the environment variable
      <b>PMCD_PATH</b> defines a colon (:) separated list of directories to
      search when trying to locate the agent DSO. The default search path is
      <b>$PCP_SHARE_DIR/lib:/usr/pcp/lib</b>.</dd>
</dl>
<div class="Pp"></div>
For agents providing socket connections, a line of the form
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><i>label</i> <i>domain-no</i> <b>socket</b>
      <i>addr-family</i> <i>address</i> [ <i>command</i> ]</dd>
</dl>
<div class="Pp"></div>
should appear. Where,
<dl class="Bl-tag">
  <dt class="It-tag"><i>label</i></dt>
  <dd class="It-tag">is a string identifying the agent</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>domain-no</i></dt>
  <dd class="It-tag">is an unsigned integer specifying the agent's domain in the
      range 1 to 510</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>addr-family</i></dt>
  <dd class="It-tag">designates whether the socket is in the <b>AF_INET,</b>
      <b>AF_INET6</b> or <b>AF_UNIX</b> domain, and the corresponding values for
      this parameter are <b>inet,</b> <b>ipv6</b> and <b>unix</b>
    respectively.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>address</i></dt>
  <dd class="It-tag">specifies the address of the socket within the previously
      specified <i>addr-family.</i> For <b>unix</b> sockets, the address should
      be the name of an agent's socket on the local host (a valid address for
      the UNIX domain). For <b>inet</b> and <b>ipv6</b> sockets, the address may
      be either a port number or a port name which may be used to connect to an
      agent on the local host. There is no syntax for specifying an agent on a
      remote host as a <b>pmcd</b> deals only with agents on the same
    machine.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>command</i></dt>
  <dd class="It-tag">is an optional parameter used to specify a command line to
      start the agent when <b>pmcd</b> initializes. If <i>command</i> is not
      present, <b>pmcd</b> assumes that the specified agent has already been
      created. The <i>command</i> is considered to start from the first
      non-white character after the socket address and finish at the next
      newline that isn't preceded by a backslash. After a <b>fork</b>(2) the
      <i>command</i> is passed unmodified to <b>execve</b>(2) to instantiate the
      agent.</dd>
</dl>
<div class="Pp"></div>
For agents interacting with the <b>pmcd</b> via stdin/stdout, a line of the
  form:
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><i>label</i> <i>domain-no</i> <b>pipe</b> <i>protocol</i>
      <i>command</i></dd>
</dl>
<div class="Pp"></div>
should appear. Where,
<dl class="Bl-tag">
  <dt class="It-tag"><i>label</i></dt>
  <dd class="It-tag">is a string identifying the agent</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>domain-no</i></dt>
  <dd class="It-tag">is an unsigned integer specifying the agent's domain</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>protocol</i></dt>
  <dd class="It-tag">The value for this parameter should be <b>binary</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">Additionally, the <i>protocol</i> can include the
      <b>notready</b> keyword to indicate that the agent must be marked as not
      being ready to process requests from <b>pmcd</b>. The agent will
      explicitly notify the <b>pmcd</b> when it is ready to process the requests
      by sending <b>PM_ERR_PMDAREADY</b> PDU.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>command</i></dt>
  <dd class="It-tag">specifies a command line to start the agent when
      <b>pmcd</b> initializes. Note that <i>command</i> is mandatory for
      pipe-based agents. The <i>command</i> is considered to start from the
      first non-white character after the <i>protocol</i> parameter and finish
      at the next newline that isn't preceded by a backslash. After a
      <b>fork</b>(2) the <i>command</i> is passed unmodified to <b>execve</b>(2)
      to instantiate the agent.</dd>
</dl>
<h1 class="Sh" title="Sh" id="ACCESS_CONTROL_CONFIGURATION"><a class="selflink" href="#ACCESS_CONTROL_CONFIGURATION">ACCESS
  CONTROL CONFIGURATION</a></h1>
The access control section of the configuration file is optional, but if present
  it must follow the agent configuration data. The case of reserved words is
  ignored, but elsewhere case is preserved. Lexical elements in the access
  control section are separated by whitespace or the special delimiter
  characters: square brackets (``['' and ``]''), braces (``{'' and ``}''), colon
  (``:''), semicolon (``;'') and comma (``,''). The special characters are not
  treated as special in the agent configuration section. Lexical elements may be
  quoted (double quotes) as necessary.
<div class="Pp"></div>
The access control section of the file must start with a line of the form:
<dl class="Bl-tag">
  <dt class="It-tag"><b>[access]</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
Leading and trailing whitespace may appear around and within the brackets and
  the case of the <b>access</b> keyword is ignored. No other text may appear on
  the line except a trailing comment.
<div class="Pp"></div>
Following this line, the remainder of the configuration file should contain
  lines that allow or disallow operations from particular hosts or groups of
  hosts.
<div class="Pp"></div>
There are two kinds of operations that occur via <b>pmcd</b>:
<dl class="Bl-tag">
  <dt class="It-tag"><b>fetch</b></dt>
  <dd class="It-tag">allows retrieval of information from <b>pmcd</b>. This may
      be information about a metric (e.g. its description, instance domain or
      help text) or a value for a metric.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>store</b></dt>
  <dd class="It-tag">allows <b>pmcd</b> to be used to store metric values in
      agents that permit store operations. This may be the actual value of the
      metric (e.g. resetting a counter to zero). Alternatively, it may be a
      value used by the PMDA to introduce a change to some aspect of monitoring
      of that metric (e.g. server side event filtering) - possibly even only for
      the active client tool performing the store operation, and not
    others.</dd>
</dl>
<div class="Pp"></div>
Access to <b>pmcd</b> can be granted in three ways - by user, group of users, or
  at a host level. In the latter, all users on a host are granted the same level
  of access, unless the user or group access control mechanism is also in use.
<div class="Pp"></div>
User names and group names will be verified using the local <b>/etc/passwd</b>
  and <b>/etc/groups</b> files (or an alternative directory service), using the
  <b>getpwent</b>(3) and <b>getgrent</b>(3) routines.
<div class="Pp"></div>
Hosts may be identified by name, IP address, IPv6 address or by the special host
  specifications ``&quot;unix:&quot;'' or ``&quot;local:&quot;''.
  ``&quot;unix:&quot;'' refers to <b>pmcd's</b> unix domain socket, on supported
  platforms. ``&quot;local:&quot;'' is equivalent to specifying
  ``&quot;unix:&quot;'' and ``localhost``.
<div class="Pp"></div>
Wildcards may also be specified by ending the host identifier with the single
  wildcard character ``*'' as the last-given component of an address. The
  wildcard ``&quot;.*&quot;'' refers to all inet (IPv4) addresses. The wildcard
  ``&quot;:*&quot;'' refers to all IPv6 addresses. If an IPv6 wildcard contains
  a ``::'' component, then the final ``*'' refers to the final 16 bits of the
  address only, otherwise it refers to the remaining unspecified bits of the
  address.
<div class="Pp"></div>
The wildcard ``*'' refers to all users, groups or host addresses, including
  ``&quot;unix:&quot;''. Names of users, groups or hosts may not be wildcarded.
<div class="Pp"></div>
The following are all valid host identifiers:
<div class="Pp"></div>
<br/>
<pre>
boing
localhost
giggle.melbourne.sgi.com
129.127.112.2
129.127.114.*
129.*
.*
fe80::223:14ff:feaf:b62c
fe80::223:14ff:feaf:*
fe80:*
:*
&quot;unix:&quot;
&quot;local:&quot;
*
</pre>
<br/>
<div class="Pp"></div>
The following are not valid host identifiers:
<div class="Pp"></div>
<br/>
<pre>
*.melbourne
129.127.*.*
129.*.114.9
129.127*
fe80::223:14ff:*:*
fe80::223:14ff:*:b62c
fe80*
</pre>
<br/>
<div class="Pp"></div>
The first example is not allowed because only (numeric) IP addresses may contain
  a wildcard. The second and fifth examples are not valid because there is more
  than one wildcard character. The third and sixth contain an embedded wildcard,
  the fourth and seventh have a wildcard character that is not the last
  component of the address (the last components are 127* and fe80*
  respectively).
<div class="Pp"></div>
The name <b>localhost</b> is given special treatment to make the behavior of
  host wildcarding consistent. Rather than being 127.0.0.1 and ::1, it is mapped
  to the primary inet and IPv6 addresses associated with the name of the host on
  which <b>pmcd</b> is running. Beware of this when running <b>pmcd</b> on
  multi-homed hosts.
<div class="Pp"></div>
Access for users, groups or hosts are allowed or disallowed by specifying
  statements of the form:
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><b>allow users</b> <i>userlist</i> <b>:</b>
      <i>operations</i> <b>;</b>
    <div>&#x00A0;</div>
     <b>disallow users</b> <i>userlist</i> <b>:</b> <i>operations</i> <b>;</b>
    <div>&#x00A0;</div>
     <b>allow groups</b> <i>grouplist</i> <b>:</b> <i>operations</i> <b>;</b>
    <div>&#x00A0;</div>
     <b>disallow groups</b> <i>grouplist</i> <b>:</b> <i>operations</i> <b>;</b>
    <div>&#x00A0;</div>
     <b>allow hosts</b> <i>hostlist</i> <b>:</b> <i>operations</i> <b>;</b>
    <div>&#x00A0;</div>
     <b>disallow hosts</b> <i>hostlist</i> <b>:</b> <i>operations</i>
    <b>;</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>list</i></dt>
  <dd class="It-tag"><i>userlist</i>, <i>grouplist</i> and <i>hostlist</i> are
      comma separated lists of one or more users, groups or host
    identifiers.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>operations</i></dt>
  <dd class="It-tag">is a comma separated list of the operation types described
      above, <b>all</b> (which allows/disallows all operations), or <b>all
      except</b> <i>operations</i> (which allows/disallows all operations except
      those listed).</dd>
</dl>
<div class="Pp"></div>
Either plural or singular forms of <b>users</b>, <b>groups</b>, and <b>hosts</b>
  keywords are allowed. If this keyword is omitted, a default of <b>hosts</b>
  will be used. This behaviour is for backward-compatibility only, it is
  preferable to be explicit.
<div class="Pp"></div>
Where no specific <b>allow</b> or <b>disallow</b> statement applies to an
  operation, the default is to allow the operation from all users, groups and
  hosts. In the trivial case when there is no access control section in the
  configuration file, all operations from all users, groups, and hosts are
  permitted.
<div class="Pp"></div>
If a new connection to <b>pmcd</b> is attempted by a user, group or host that is
  not permitted to perform any operations, the connection will be closed
  immediately after an error response <b>PM_ERR_PERMISSION</b> has been sent to
  the client attempting the connection.
<div class="Pp"></div>
Statements with the same level of wildcarding specifying identical hosts may not
  contradict each other. For example if a host named <b>clank</b> had an IP
  address of 129.127.112.2, specifying the following two rules would be
  erroneous:
<div class="Pp"></div>
<br/>
<pre>
allow host clank : fetch, store;
disallow host 129.127.112.2 : all except fetch;
</pre>
<br/>
<div class="Pp"></div>
because they both refer to the same host, but disagree as to whether the
  <b>fetch</b> operation is permitted from that host.
<div class="Pp"></div>
Statements containing more specific host specifications override less specific
  ones according to the level of wildcarding. For example a rule of the form
<div class="Pp"></div>
<br/>
<pre>
allow host clank : all;
</pre>
<br/>
<div class="Pp"></div>
overrides
<div class="Pp"></div>
<br/>
<pre>
disallow host 129.127.112.* : all except fetch;
</pre>
<br/>
<div class="Pp"></div>
because the former contains a specific host name (equivalent to a fully
  specified IP address), whereas the latter has a wildcard. In turn, the latter
  would override
<div class="Pp"></div>
<br/>
<pre>
disallow host * : all;
</pre>
<br/>
<div class="Pp"></div>
It is possible to limit the number of connections from a user, group or host to
  <b>pmcd</b>. This may be done by adding a clause of the form
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag"><b>maximum</b> <i>n</i> <b>connections</b></dd>
</dl>
<div class="Pp"></div>
to the <i>operations</i> list of an <b>allow</b> statement. Such a clause may
  not be used in a <b>disallow</b> statement. Here, <i>n</i> is the maximum
  number of connections that will be accepted from the user, group or host
  matching the identifier(s) used in the statement.
<div class="Pp"></div>
An access control statement with a list of user, group or host identifiers is
  equivalent to a set of access control statements, with each specifying one of
  the identifiers in the list and all with the same access controls (both
  permissions and connection limits). A group should be used if you want users
  to contribute to a shared connection limit. A wildcard should be used if you
  want hosts to contribute to a shared connection limit.
<div class="Pp"></div>
When a new client requests a connection, and <b>pmcd</b> has determined that the
  client has permission to connect, it searches the matching list of access
  control statements for the most specific match containing a connection limit.
  For brevity, this will be called the limiting statement. If there is no
  limiting statement, the client is granted a connection. If there is a limiting
  statement and the number of <b>pmcd</b> clients with user ID, group ID, or IP
  addresses that match the identifier in the limiting statement is less than the
  connection limit in the statement, the connection is allowed. Otherwise the
  connection limit has been reached and the client is refused a connection.
<div class="Pp"></div>
Group access controls and the wildcarding in host identifiers means that once
  <b>pmcd</b> actually accepts a connection from a client, the connection may
  contribute to the current connection count of more than one access control
  statement - the client's host may match more than one access control
  statement, and similarly the user ID may be in more than one group. This may
  be significant for subsequent connection requests.
<div class="Pp"></div>
Note that <b>pmcd</b> enters a mode where it runs effectively with a
  higher-level of security as soon as a user or group access control section is
  added to the configuration. In this mode only authenticated connections are
  allowed - either from a SASL authenticated connection, or a Unix domain socket
  (which implicitly passes client credentials). This is the same mode that is
  entered explicitly using the <b>-S</b> option. Assuming permission is allowed,
  one can determine whether <b>pmcd</b> is running in this mode by querying the
  value of the <i>pmcd.feature.creds_required</i> metric.
<div class="Pp"></div>
Note also that because most specific match semantics are used when checking the
  connection limit, for the host-based access control case, priority is given to
  clients with more specific host identifiers. It is also possible to exceed
  connection limits in some situations. Consider the following:
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">allow host clank : all, maximum 5 connections;
    <div>&#x00A0;</div>
    allow host * : all except store, maximum 2 connections;</dd>
</dl>
<div class="Pp"></div>
This says that only 2 client connections at a time are permitted for all hosts
  other than &quot;clank&quot;, which is permitted 5. If a client from host
  &quot;boing&quot; is the first to connect to <b>pmcd</b>, its connection is
  checked against the second statement (that is the most specific match with a
  connection limit). As there are no other clients, the connection is accepted
  and contributes towards the limit for only the second statement above. If the
  next client connects from &quot;clank&quot;, its connection is checked against
  the limit for the first statement. There are no other connections from
  &quot;clank&quot;, so the connection is accepted. Once this connection is
  accepted, it counts towards <b>both</b> statements' limits because
  &quot;clank&quot; matches the host identifier in both statements. Remember
  that the decision to accept a new connection is made using only the most
  specific matching access control statement with a connection limit. Now, the
  connection limit for the second statement has been reached. Any connections
  from hosts other than &quot;clank&quot; will be refused.
<div class="Pp"></div>
If instead, <b>pmcd</b> with no clients saw three successive connections arrived
  from &quot;boing&quot;, the first two would be accepted and the third refused.
  After that, if a connection was requested from &quot;clank&quot; it would be
  accepted. It matches the first statement, which is more specific than the
  second, so the connection limit in the first is used to determine that the
  client has the right to connect. Now there are 3 connections contributing to
  the second statement's connection limit. Even though the connection limit for
  the second statement has been exceeded, the earlier connections from
  &quot;boing&quot; are maintained. The connection limit is only checked at the
  time a client attempts a connection rather than being re-evaluated every time
  a new client connects to <b>pmcd</b>.
<div class="Pp"></div>
This gentle scheme is designed to allow reasonable limits to be imposed on a
  first come first served basis, with specific exceptions.
<div class="Pp"></div>
As illustrated by the example above, a client's connection is honored once it
  has been accepted. However, <b>pmcd</b> reconfiguration (see the next section)
  re-evaluates all the connection counts and will cause client connections to be
  dropped where connection limits have been exceeded.
<h1 class="Sh" title="Sh" id="RECONFIGURING_PMCD"><a class="selflink" href="#RECONFIGURING_PMCD">RECONFIGURING
  PMCD</a></h1>
If the configuration file has been changed or if an agent is not responding
  because it has terminated or the PMNS has been changed, <b>pmcd</b> may be
  reconfigured by sending it a SIGHUP, as in
<div class="Pp"></div>
<br/>
<pre>
# pmsignal -a -s HUP pmcd
</pre>
<br/>
<div class="Pp"></div>
When <b>pmcd</b> receives a SIGHUP, it checks the configuration file for
  changes. If the file has been modified, it is reparsed and the contents become
  the new configuration. If there are errors in the configuration file, the
  existing configuration is retained and the contents of the file are ignored.
  Errors are reported in the <b>pmcd</b> log file.
<div class="Pp"></div>
It also checks the PMNS file for changes. If the PMNS file has been modified,
  then it is reloaded. Use of <b>tail</b>(1) on the log file is recommended
  while reconfiguring <b>pmcd</b>.
<div class="Pp"></div>
If the configuration for an agent has changed (any parameter except the agent's
  label is different), the agent is restarted. Agents whose configurations do
  not change are not restarted. Any existing agents not present in the new
  configuration are terminated. Any deceased agents are that are still listed
  are restarted.
<div class="Pp"></div>
Sometimes it is necessary to restart an agent that is still running, but
  malfunctioning. Simply stop the agent (e.g. using SIGTERM from
  <b>pmsignal</b>(1)), then send <b>pmcd</b> a SIGHUP, which will cause the
  agent to be restarted.
<h1 class="Sh" title="Sh" id="STARTING_AND_STOPPING_PMCD"><a class="selflink" href="#STARTING_AND_STOPPING_PMCD">STARTING
  AND STOPPING PMCD</a></h1>
Normally, <b>pmcd</b> is started automatically at boot time and stopped when the
  system is being brought down. Under certain circumstances it is necessary to
  start or stop <b>pmcd</b> manually. To do this one must become superuser and
  type
<div class="Pp"></div>
<br/>
<pre>
# $PCP_RC_DIR/pmcd start
</pre>
<br/>
<div class="Pp"></div>
to start <b>pmcd</b>, or
<div class="Pp"></div>
<br/>
<pre>
# $PCP_RC_DIR/pmcd stop
</pre>
<br/>
<div class="Pp"></div>
to stop <b>pmcd</b>. Starting <b>pmcd</b> when it is already running is the same
  as stopping it and then starting it again.
<div class="Pp"></div>
Sometimes it may be necessary to restart <b>pmcd</b> during another phase of the
  boot process. Time-consuming parts of the boot process are often put into the
  background to allow the system to become available sooner (e.g. mounting huge
  databases). If an agent run by <b>pmcd</b> requires such a task to complete
  before it can run properly, it is necessary to restart or reconfigure
  <b>pmcd</b> after the task completes. Consider, for example, the case of
  mounting a database in the background while booting. If the PMDA which
  provides the metrics about the database cannot function until the database is
  mounted and available but <b>pmcd</b> is started before the database is ready,
  the PMDA will fail (however <b>pmcd</b> will still service requests for
  metrics from other domains). If the database is initialized by running a shell
  script, adding a line to the end of the script to reconfigure <b>pmcd</b> (by
  sending it a SIGHUP) will restart the PMDA (if it exited because it couldn't
  connect to the database). If the PMDA didn't exit in such a situation it would
  be necessary to restart <b>pmcd</b> because if the PMDA was still running
  <b>pmcd</b> would not restart it.
<div class="Pp"></div>
Normally <b>pmcd</b> listens for client connections on TCP/IP port number 44321
  (registered at <i>http://www.iana.org/</i>). Either the environment variable
  <b>PMCD_PORT</b> or the <b>-p</b> command line option may be used to specify
  alternative port number(s) when <b>pmcd</b> is started; in each case, the
  specification is a comma-separated list of one or more numerical port numbers.
  Should both methods be used or multiple <b>-p</b> options appear on the
  command line, <b>pmcd</b> will listen on the union of the set of ports
  specified via all <b>-p</b> options and the <b>PMCD_PORT</b> environment
  variable. If non-default ports are used with <b>pmcd</b> care should be taken
  to ensure that <b>PMCD_PORT</b> is also set in the environment of any client
  application that will connect to <b>pmcd</b>, or that the extended host
  specification syntax is used (see <b>PCPIntro</b>(1) for details).
<h1 class="Sh" title="Sh" id="FILES"><a class="selflink" href="#FILES">FILES</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><i>$PCP_PMCDCONF_PATH</i></dt>
  <dd class="It-tag">default configuration file</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>$PCP_PMCDOPTIONS_PATH</i></dt>
  <dd class="It-tag">command line options to <b>pmcd</b> when launched from
      <b>$PCP_RC_DIR/pmcd</b> All the command line option lines should start
      with a hyphen as the first character.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>$PCP_SYSCONFIG_DIR/pmcd</b></dt>
  <dd class="It-tag">additional environment variables that will be set when
      <b>pmcd</b> executes. Only settings of the form
      &quot;PMCD_VARIABLE=value&quot; will be honoured.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>./pmcd.log</b></dt>
  <dd class="It-tag">(or <b>$PCP_LOG_DIR/pmcd/pmcd.log</b> when started
      automatically)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>$PCP_RUN_DIR/pmcd.pid</b></dt>
  <dd class="It-tag">contains an ascii decimal representation of the process ID
      of <b>pmcd</b> , when it's running.
    <div>&#x00A0;</div>
    All messages and diagnostics are directed here</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>/etc/pki/nssdb</b></dt>
  <dd class="It-tag">default Network Security Services (NSS) certificate
      database directory, used for optional Secure Socket Layer connections.
      This database can be created and queried using the NSS <b>certutil</b>
      tool, amongst others.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>/etc/passwd</b></dt>
  <dd class="It-tag">user names, user identifiers and primary group identifiers,
      used for access control specifications</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>/etc/groups</b></dt>
  <dd class="It-tag">group names, group identifiers and group members, used for
      access control specifications</dd>
</dl>
<h1 class="Sh" title="Sh" id="ENVIRONMENT"><a class="selflink" href="#ENVIRONMENT">ENVIRONMENT</a></h1>
In addition to the PCP environment variables described in the <b>PCP
  ENVIRONMENT</b> section below, the <b>PMCD_PORT</b> variable is also
  recognised as the TCP/IP port for incoming connections (default <i>44321</i>),
  and the <b>PMCD_SOCKET</b> variable is also recognised as the path to be used
  for the Unix domain socket.
<div class="Pp"></div>
If set to the value 1, the <b>PMCD_LOCAL</b> environment variable will cause
  <b>pmcd</b> to run in a localhost-only mode of operation, where it binds only
  to the loopback interface. The <i>pmcd.feature.local</i> metric can be queried
  to determine if <b>pmcd</b> is running in this mode.
<div class="Pp"></div>
The <b>PMCD_MAXPENDING</b> variable can be set to indicate the maximum length to
  which the queue of pending client connections may grow.
<div class="Pp"></div>
The <b>PMCD_ROOT_AGENT</b> variable controls whether or not <b>pmcd</b> or
  <b>pmdaroot</b> (when available), start subsequent pmdas. When set to a
  non-zero value, <b>pmcd</b> will opt to have <b>pmdaroot</b> start, and stop,
  PMDAs.
<div class="Pp"></div>
The <b>PMCD_RESTART_AGENTS</b> variable determines the behaviour of <b>pmcd</b>
  in the presence of child PMDAs that have been observed to exit (this is a
  typical response in the presence of very large, usually domain-induced, PDU
  latencies). When set to a non-zero value, <b>pmcd</b> will attempt to restart
  such PMDAS once every minute. When set to zero, it uses the original behaviour
  of just logging the failure.
<h1 class="Sh" title="Sh" id="PCP_ENVIRONMENT"><a class="selflink" href="#PCP_ENVIRONMENT">PCP
  ENVIRONMENT</a></h1>
Environment variables with the prefix <b>PCP_</b> are used to parameterize the
  file and directory names used by PCP. On each installation, the file
  <b>/etc/pcp.conf</b> contains the local values for these variables. The
  <b>$PCP_CONF</b> variable may be used to specify an alternative configuration
  file, as described in <b>pcp.conf</b>(5).
<h1 class="Sh" title="Sh" id="DIAGNOSTICS"><a class="selflink" href="#DIAGNOSTICS">DIAGNOSTICS</a></h1>
If <b>pmcd</b> is already running the message &quot;Error: OpenRequestSocket
  bind: Address may already be in use&quot; will appear. This may also appear if
  <b>pmcd</b> was shutdown with an outstanding request from a client. In this
  case, a request socket has been left in the TIME_WAIT state and until the
  system closes it down (after some timeout period) it will not be possible to
  run <b>pmcd</b>.
<div class="Pp"></div>
In addition to the standard <b>PCP</b> debugging flags, see <b>pmdbg</b>(1),
  <b>pmcd</b> currently uses <b>DBG_TRACE_APPL0</b> for tracing I/O and
  termination of agents, <b>DBG_TRACE_APPL1</b> for tracing access control and
  <b>DBG_TRACE_APPL2</b> for tracing the configuration file scanner and parser.
<h1 class="Sh" title="Sh" id="CAVEATS"><a class="selflink" href="#CAVEATS">CAVEATS</a></h1>
<b>pmcd</b> does not explicitly terminate its children (agents), it only closes
  their pipes. If an agent never checks for a closed pipe it may not terminate.
<div class="Pp"></div>
The configuration file parser will only read lines of less than 1200 characters.
  This is intended to prevent accidents with binary files.
<div class="Pp"></div>
The timeouts controlled by the <b>-t</b> option apply to IPC between <b>pmcd</b>
  and the PMDAs it spawns. This is independent of settings of the environment
  variables <b>PMCD_CONNECT_TIMEOUT</b> and <b>PMCD_REQUEST_TIMEOUT</b> (see
  <b>PCPIntro</b>(1)) which may be used respectively to control timeouts for
  client applications trying to connect to <b>pmcd</b> and trying to receive
  information from <b>pmcd</b>.
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>PCPIntro</b>(1), <b>pmdbg</b>(1), <b>pmerr</b>(1), <b>pmgenmap</b>(1),
  <b>pminfo</b>(1), <b>pmrep</b>(1), <b>pmstat</b>(1), <b>pmstore</b>(1),
  <b>pmval</b>(1), <b>getpwent</b>(3), <b>getgrent</b>(3), <b>pcp.conf</b>(5),
  and <b>pcp.env</b>(5).</div>
<table class="foot">
  <tr>
    <td class="foot-date">PCP</td>
    <td class="foot-os">Performance Co-Pilot</td>
  </tr>
</table>
</body>
</html>
