<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:31:53 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>PMCD(1) General Commands Manual PMCD(1)</p>

<p style="margin-top: 1em">NAME <br>
pmcd - performance metrics collector daemon</p>

<p style="margin-top: 1em">SYNOPSIS <br>
pmcd [-AfQSv] [-c config] [-C dirname] [-H hostname] [-i
ipaddress] [-l logfile] [-L bytes] [-M certname] [-[n|N]
pmnsfile] [-p port[,port ...]] [-P passfile] [-q timeout]
[-s <br>
sockname] [-T traceflag] [-t timeout] [-U username] [-x
file]</p>

<p style="margin-top: 1em">DESCRIPTION <br>
pmcd is the collector used by the Performance Co-Pilot (see
PCPIntro(1)) to gather performance metrics on a system. As a
rule, there must be an instance of pmcd running on a <br>
system for any performance metrics to be available to the
PCP.</p>

<p style="margin-top: 1em">pmcd accepts connections from
client applications running either on the same machine or
remotely and provides them with metrics and other related
information from the machine <br>
that pmcd is executing on. pmcd delegates most of this
request servicing to a collection of Performance Metrics
Domain Agents (or just agents), where each agent is
responsible <br>
for a particular group of metrics, known as the domain of
the agent. For example the postgresql agent is responsible
for reporting information relating to the PostgreSQL
data&acirc; <br>
base, such as the transaction and query counts, indexing and
replication statistics, and so on.</p>

<p style="margin-top: 1em">The agents may be processes
started by pmcd, independent processes or Dynamic Shared
Objects (DSOs, see dlopen(3)) attached to pmcd&rsquo;s
address space. The configuration section <br>
below describes how connections to agents are specified.</p>

<p style="margin-top: 1em">The options to pmcd are as
follows.</p>

<p style="margin-top: 1em">-A Disable service
advertisement. By default, pmcd will advertise its presence
on the network using any available mechanisms (such as
Avahi/DNS-SD), assisting remote moni&acirc; <br>
toring tools with finding it. These mechanisms are disabled
with this option.</p>

<p style="margin-top: 1em">-c config <br>
On startup pmcd uses a configuration file from either the
$PCP_PMCDCONF_PATH, configuration variable in /etc/pcp.conf,
or an environment variable of the same name. How&acirc; <br>
ever, these values may be overridden with config using this
option. The format of this configuration file is described
below.</p>

<p style="margin-top: 1em">-C dirname <br>
Specify the path to the Network Security Services
certificate database, for (optional) secure connections. The
default is /etc/pki/nssdb. Refer also to the -P option. <br>
If it does not already exist, this database can be created
using the certutil utility. This process and other
certificate database maintenance information is provided in
<br>
the PCPIntro(1) manual page and the online PCP
tutorials.</p>

<p style="margin-top: 1em">-f By default pmcd is started as
a daemon. The -f option indicates that it should run in the
foreground. This is most useful when trying to diagnose
problems with misbehav&acirc; <br>
ing agents.</p>

<p style="margin-top: 1em">-H hostname <br>
This option can be used to set the hostname that pmcd will
use to represent this instance of itself. This is used by
client tools like pmlogger(1) when reporting on the <br>
(possibly remote) host. If this option is not set, the
pmcd.hostname metric will match that returned by
pmhostname(1). Refer to the manual page for that tool for
full <br>
details on how the hostname is evaluated.</p>

<p style="margin-top: 1em">-i ipaddress <br>
This option is usually only used on hosts with more than one
network interface. If no -i options are specified pmcd
accepts connections made to any of its host&rsquo;s IP <br>
(Internet Protocol) addresses. The -i option is used to
specify explicitly an IP address that connections should be
accepted on. ipaddress should be in the standard dot&acirc;
<br>
ted form (e.g. 100.23.45.6). The -i option may be used
multiple times to define a list of IP addresses. Connections
made to any other IP addresses the host has will be <br>
refused. This can be used to limit connections to one
network interface if the host is a network gateway. It is
also useful if the host takes over the IP address of <br>
another host that has failed. In such a situation only the
standard IP addresses of the host should be given (not the
ones inherited from the failed host). This allows <br>
PCP applications to determine that a host has failed, rather
than connecting to the host that has assumed the identity of
the failed host.</p>

<p style="margin-top: 1em">-l logfile <br>
By default a log file named pmcd.log is written in the
directory $PCP_LOG_DIR/pmcd. The -l option causes the log
file to be written to logfile instead of the default. If
<br>
the log file cannot be created or is not writable, output is
written to the standard error instead.</p>

<p style="margin-top: 1em">-L bytes <br>
PDUs received by pmcd from monitoring clients are restricted
to a maximum size of 65536 bytes by default to defend
against Denial of Service attacks. The -L option may be <br>
used to change the maximum incoming PDU size.</p>

<p style="margin-top: 1em">-M certname <br>
By default, pmcd will try to use a certificate called PCP
Collector certificate . The -M option allows this to be
changed.</p>

<p style="margin-top: 1em">-n pmnsfile <br>
Normally pmcd loads the default Performance Metrics Name
Space (PMNS) from $PCP_VAR_DIR/pmns/root, however if the -n
option is specified an alternative namespace is loaded <br>
from the file pmnsfile.</p>

<p style="margin-top: 1em">-N pmnsfile <br>
Same function as -n, except for the handling of duplicate
Performance Metric Identifiers (PMIDs) in pmnsfile -
duplicate names are allowed with -n they are not allowed
<br>
with -N.</p>

<p style="margin-top: 1em">-P passfile <br>
Specify the path to a file containing the Network Security
Services certificate database password for (optional) secure
connections, and for databases that are password <br>
protected. Refer also to the -C option. When using this
option, great care should be exercised to ensure appropriate
ownership (&quot;pcp&quot; user, typically) and permissions
on <br>
this file (0400, so as to be unreadable by any user other
than the user running the pmcd process).</p>

<p style="margin-top: 1em">-q timeout <br>
The pmcd to agent version exchange protocol (new in PCP 2.0
- introduced to provide backward compatibility) uses this
timeout to specify how long pmcd should wait before <br>
assuming that no version response is coming from an agent.
If this timeout is reached, the agent is assumed to be an
agent which does not understand the PCP 2.0 protocol. <br>
The default timeout interval is five seconds, but the -q
option allows an alternative timeout interval (which must be
greater than zero) to be specified. The unit of time <br>
is seconds.</p>

<p style="margin-top: 1em">-Q Require that all remote
client connections provide a certficate.</p>

<p style="margin-top: 1em">-S Require that all client
connections provide user credentials. This means that only
unix domain sockets, or authenticated connections are
permitted (requires secure sock&acirc; <br>
ets support). If any user or group access control
requirements are specified in the pmcd configuration file,
then this mode of operation is automatically entered,
whether <br>
the -S flag is specified or not.</p>

<p style="margin-top: 1em">-s sockname <br>
Specify the path to a local unix domain socket (for
platforms supporting this socket family only). The default
value is $PCP_RUN_DIR/pmcd.socket.</p>

<p style="margin-top: 1em">-t timeout <br>
To prevent misbehaving clients or agents from hanging the
entire Performance Metrics Collection System (PMCS), pmcd
uses timeouts on PDU exchanges with clients and agents <br>
running as processes. By default the timeout interval is
five seconds. The -t option allows an alternative timeout
interval in seconds to be specified. If timeout is <br>
zero, timeouts are turned off. It is almost impossible to
use the debugger interactively on an agent unless timeouts
have been turned off for its &quot;parent&quot; pmcd.</p>

<p style="margin-top: 1em">Once pmcd is running, the
timeout may be dynamically modified by storing an integer
value (the timeout in seconds) into the metric
pmcd.control.timeout via pmstore(1).</p>

<p style="margin-top: 1em">-T traceflag <br>
To assist with error diagnosis for agents and/or clients of
pmcd that are not behaving correctly, an internal event
tracing mechanism is supported within pmcd. The value <br>
of traceflag is interpreted as a bit field with the
following control functions:</p>

<p style="margin-top: 1em">1 enable client connection
tracing <br>
2 enable PDU tracing <br>
256 unbuffered event tracing</p>

<p style="margin-top: 1em">By default, event tracing is
buffered using a circular buffer that is over-written as new
events are recorded. The default buffer size holds the last
20 events, although <br>
this number may be over-ridden by using pmstore(1) to modify
the metric pmcd.control.tracebufs.</p>

<p style="margin-top: 1em">Similarly once pmcd is running,
the event tracing control may be dynamically modified by
storing 1 (enable) or 0 (disable) into the metrics
pmcd.control.traceconn, <br>
pmcd.control.tracepdu and pmcd.control.tracenobuf. These
metrics map to the bit fields associated with the traceflag
argument for the -T option.</p>

<p style="margin-top: 1em">When operating in buffered mode,
the event trace buffer will be dumped whenever an agent
connection is terminated by pmcd, or when any value is
stored into the metric <br>
pmcd.control.dumptrace via pmstore(1).</p>

<p style="margin-top: 1em">In unbuffered mode, every event
will be reported when it occurs.</p>

<p style="margin-top: 1em">-U username <br>
User account under which to run pmcd. The default is the
unprivileged &quot;pcp&quot; account in current versions of
PCP, but in older versions the superuser account
(&quot;root&quot;) was <br>
used by default.</p>

<p style="margin-top: 1em">-v Verify the pmcd configuration
file, reporting on any errors then exiting with a status
indicating verification success or failure.</p>

<p style="margin-top: 1em">-x file <br>
Before the pmcd logfile can be opened, pmcd may encounter a
fatal error which prevents it from starting. By default, the
output describing this error is sent to /dev/tty <br>
but it may redirected to file.</p>

<p style="margin-top: 1em">If a PDU exchange with an agent
times out, the agent has violated the requirement that it
delivers metrics with little or no delay. This is deemed a
protocol failure and the <br>
agent is disconnected from pmcd. Any subsequent requests for
information from the agent will fail with a status
indicating that there is no agent to provide it.</p>

<p style="margin-top: 1em">It is possible to specify access
control to pmcd based on users, groups and hosts. This
allows one to prevent users, groups of users, and certain
hosts from accessing the met&acirc; <br>
rics provided by pmcd and is described in more detail in the
Section on ACCESS CONTROL below.</p>

<p style="margin-top: 1em">CONFIGURATION <br>
On startup pmcd looks for a configuration file named
$PCP_PMCDCONF_PATH. This file specifies which agents cover
which performance metrics domains and how pmcd should make
con&acirc; <br>
tact with the agents. An optional section specifying access
controls may follow the agent configuration data.</p>

<p style="margin-top: 1em">Warning: pmcd is usually started
as part of the boot sequence and runs initially as root. The
configuration file may contain shell commands to create
agents, which will be exe&acirc; <br>
cuted by root. To prevent security breaches the
configuration file should be writable only by root. The use
of absolute path names is also recommended.</p>

<p style="margin-top: 1em">The case of the reserved words
in the configuration file is unimportant, but elsewhere, the
case is preserved.</p>

<p style="margin-top: 1em">Blank lines and comments are
permitted (even encouraged) in the configuration file. A
comment begins with a &lsquo;&lsquo;#&rsquo;&rsquo;
character and finishes at the end of the line. A line may be
<br>
continued by ensuring that the last character on the line is
a &lsquo;&lsquo;&acute;&rsquo; (backslash). A comment on a
continued line ends at the end of the continued line. Spaces
may be included in <br>
lexical elements by enclosing the entire element in double
quotes. A double quote preceded by a backslash is always a
literal double quote. A &lsquo;&lsquo;#&rsquo;&rsquo; in
double quotes or preceded <br>
by a backslash is treated literally rather than as a comment
delimiter. Lexical elements and separators are described
further in the following sections.</p>

<p style="margin-top: 1em">AGENT CONFIGURATION <br>
Each line of the agent configuration section of the
configuration file contains details of how to connect pmcd
to one of its agents and specifies which metrics domain the
agent <br>
deals with. An agent may be attached as a DSO, or via a
socket, or a pair of pipes.</p>

<p style="margin-top: 1em">Each line of the agent
configuration section of the configuration file must be
either an agent specification, a comment, or a blank line.
Lexical elements are separated by <br>
whitespace characters, however a single agent specification
may not be broken across lines unless a &nbsp;(backslash) is
used to continue the line.</p>

<p style="margin-top: 1em">Each agent specification must
start with a textual label (string) followed by an integer
in the range 1 to 510. The label is a tag used to refer to
the agent and the integer <br>
specifies the domain for which the agent supplies data. This
domain identifier corresponds to the domain portion of the
PMIDs handled by the agent. Each agent must have a <br>
unique label and domain identifier.</p>

<p style="margin-top: 1em">For DSO agents a line of the
form:</p>

<p style="margin-top: 1em">label domain-no dso entry-point
path</p>

<p style="margin-top: 1em">should appear. Where,</p>

<p style="margin-top: 1em">label is a string identifying
the agent <br>
domain-no is an unsigned integer specifying the
agent&rsquo;s domain in the range 1 to 510 <br>
entry-point is the name of an initialization function which
will be called when the DSO is loaded <br>
path designates the location of the DSO and this is expected
to be an absolute pathname. pmcd is only able to load DSO
agents that have the same simabi (Subprogram <br>
Interface Model ABI, or calling conventions) as it does
(i.e. only one of the simabi versions will be applicable).
The simabi version of a running pmcd may be <br>
determined by fetching pmcd.simabi. Alternatively, the
file(1) command may be used to determine the simabi version
from the pmcd executable.</p>

<p style="margin-top: 1em">For a relative path the
environment variable PMCD_PATH defines a colon (:) separated
list of directories to search when trying to locate the
agent DSO. The default <br>
search path is $PCP_SHARE_DIR/lib:/usr/pcp/lib.</p>

<p style="margin-top: 1em">For agents providing socket
connections, a line of the form</p>

<p style="margin-top: 1em">label domain-no socket
addr-family address [ command ]</p>

<p style="margin-top: 1em">should appear. Where,</p>

<p style="margin-top: 1em">label is a string identifying
the agent <br>
domain-no is an unsigned integer specifying the
agent&rsquo;s domain in the range 1 to 510 <br>
addr-family designates whether the socket is in the AF_INET,
AF_INET6 or AF_UNIX domain, and the corresponding values for
this parameter are inet, ipv6 and unix respectively. <br>
address specifies the address of the socket within the
previously specified addr-family. For unix sockets, the
address should be the name of an agent&rsquo;s socket on the
local <br>
host (a valid address for the UNIX domain). For inet and
ipv6 sockets, the address may be either a port number or a
port name which may be used to connect to an <br>
agent on the local host. There is no syntax for specifying
an agent on a remote host as a pmcd deals only with agents
on the same machine. <br>
command is an optional parameter used to specify a command
line to start the agent when pmcd initializes. If command is
not present, pmcd assumes that the specified agent <br>
has already been created. The command is considered to start
from the first non-white character after the socket address
and finish at the next newline that isn&rsquo;t <br>
preceded by a backslash. After a fork(2) the command is
passed unmodified to execve(2) to instantiate the agent.</p>

<p style="margin-top: 1em">For agents interacting with the
pmcd via stdin/stdout, a line of the form:</p>

<p style="margin-top: 1em">label domain-no pipe protocol
command</p>

<p style="margin-top: 1em">should appear. Where,</p>

<p style="margin-top: 1em">label is a string identifying
the agent <br>
domain-no is an unsigned integer specifying the
agent&rsquo;s domain <br>
protocol The value for this parameter should be binary.</p>

<p style="margin-top: 1em">Additionally, the protocol can
include the notready keyword to indicate that the agent must
be marked as not being ready to process requests from pmcd.
The agent <br>
will explicitly notify the pmcd when it is ready to process
the requests by sending PM_ERR_PMDAREADY PDU.</p>

<p style="margin-top: 1em">command specifies a command line
to start the agent when pmcd initializes. Note that command
is mandatory for pipe-based agents. The command is
considered to start from <br>
the first non-white character after the protocol parameter
and finish at the next newline that isn&rsquo;t preceded by
a backslash. After a fork(2) the command is passed <br>
unmodified to execve(2) to instantiate the agent.</p>

<p style="margin-top: 1em">ACCESS CONTROL CONFIGURATION
<br>
The access control section of the configuration file is
optional, but if present it must follow the agent
configuration data. The case of reserved words is ignored,
but else&acirc; <br>
where case is preserved. Lexical elements in the access
control section are separated by whitespace or the special
delimiter characters: square brackets
(&lsquo;&lsquo;[&rsquo;&rsquo; and
&lsquo;&lsquo;]&rsquo;&rsquo;), <br>
braces (&lsquo;&lsquo;{&rsquo;&rsquo; and
&lsquo;&lsquo;}&rsquo;&rsquo;), colon
(&lsquo;&lsquo;:&rsquo;&rsquo;), semicolon
(&lsquo;&lsquo;;&rsquo;&rsquo;) and comma
(&lsquo;&lsquo;,&rsquo;&rsquo;). The special characters are
not treated as special in the agent configuration section.
Lexical ele&acirc; <br>
ments may be quoted (double quotes) as necessary.</p>

<p style="margin-top: 1em">The access control section of
the file must start with a line of the form:</p>

<p style="margin-top: 1em">[access]</p>

<p style="margin-top: 1em">Leading and trailing whitespace
may appear around and within the brackets and the case of
the access keyword is ignored. No other text may appear on
the line except a trailing <br>
comment.</p>

<p style="margin-top: 1em">Following this line, the
remainder of the configuration file should contain lines
that allow or disallow operations from particular hosts or
groups of hosts.</p>

<p style="margin-top: 1em">There are two kinds of
operations that occur via pmcd:</p>

<p style="margin-top: 1em">fetch allows retrieval of
information from pmcd. This may be information about a
metric (e.g. its description, instance domain or help text)
or a value for a metric.</p>

<p style="margin-top: 1em">store allows pmcd to be used to
store metric values in agents that permit store operations.
This may be the actual value of the metric (e.g. resetting a
counter to <br>
zero). Alternatively, it may be a value used by the PMDA to
introduce a change to some aspect of monitoring of that
metric (e.g. server side event filtering) - <br>
possibly even only for the active client tool performing the
store operation, and not others.</p>

<p style="margin-top: 1em">Access to pmcd can be granted in
three ways - by user, group of users, or at a host level. In
the latter, all users on a host are granted the same level
of access, unless the <br>
user or group access control mechanism is also in use.</p>

<p style="margin-top: 1em">User names and group names will
be verified using the local /etc/passwd and /etc/groups
files (or an alternative directory service), using the
getpwent(3) and getgrent(3) rou&acirc; <br>
tines.</p>

<p style="margin-top: 1em">Hosts may be identified by name,
IP address, IPv6 address or by the special host
specifications &lsquo;&lsquo;&quot;unix:&quot;&rsquo;&rsquo;
or &lsquo;&lsquo;&quot;local:&quot;&rsquo;&rsquo;.
&lsquo;&lsquo;&quot;unix:&quot;&rsquo;&rsquo; refers to
pmcd&rsquo;s unix domain socket, on <br>
supported platforms.
&lsquo;&lsquo;&quot;local:&quot;&rsquo;&rsquo; is equivalent
to specifying &lsquo;&lsquo;&quot;unix:&quot;&rsquo;&rsquo;
and &lsquo;&lsquo;localhost&lsquo;&lsquo;.</p>

<p style="margin-top: 1em">Wildcards may also be specified
by ending the host identifier with the single wildcard
character &lsquo;&lsquo;*&rsquo;&rsquo; as the last-given
component of an address. The wildcard
&lsquo;&lsquo;&quot;.*&quot;&rsquo;&rsquo; refers to <br>
all inet (IPv4) addresses. The wildcard
&lsquo;&lsquo;&quot;:*&quot;&rsquo;&rsquo; refers to all
IPv6 addresses. If an IPv6 wildcard contains a
&lsquo;&lsquo;::&rsquo;&rsquo; component, then the final
&lsquo;&lsquo;*&rsquo;&rsquo; refers to the final 16 bits
<br>
of the address only, otherwise it refers to the remaining
unspecified bits of the address.</p>

<p style="margin-top: 1em">The wildcard
&lsquo;&lsquo;*&rsquo;&rsquo; refers to all users, groups or
host addresses, including
&lsquo;&lsquo;&quot;unix:&quot;&rsquo;&rsquo;. Names of
users, groups or hosts may not be wildcarded.</p>

<p style="margin-top: 1em">The following are all valid host
identifiers:</p>

<p style="margin-top: 1em">boing <br>
localhost <br>
giggle.melbourne.sgi.com <br>
129.127.112.2 <br>
129.127.114.* <br>
129.* <br>
.* <br>
fe80::223:14ff:feaf:b62c <br>
fe80::223:14ff:feaf:* <br>
fe80:* <br>
:* <br>
&quot;unix:&quot; <br>
&quot;local:&quot; <br>
*</p>

<p style="margin-top: 1em">The following are not valid host
identifiers:</p>

<p style="margin-top: 1em">*.melbourne <br>
129.127.*.* <br>
129.*.114.9 <br>
129.127* <br>
fe80::223:14ff:*:* <br>
fe80::223:14ff:*:b62c <br>
fe80*</p>

<p style="margin-top: 1em">The first example is not allowed
because only (numeric) IP addresses may contain a wildcard.
The second and fifth examples are not valid because there is
more than one wildcard <br>
character. The third and sixth contain an embedded wildcard,
the fourth and seventh have a wildcard character that is not
the last component of the address (the last components <br>
are 127* and fe80* respectively).</p>

<p style="margin-top: 1em">The name localhost is given
special treatment to make the behavior of host wildcarding
consistent. Rather than being 127.0.0.1 and ::1, it is
mapped to the primary inet and IPv6 <br>
addresses associated with the name of the host on which pmcd
is running. Beware of this when running pmcd on multi-homed
hosts.</p>

<p style="margin-top: 1em">Access for users, groups or
hosts are allowed or disallowed by specifying statements of
the form:</p>

<p style="margin-top: 1em">allow users userlist :
operations ; <br>
disallow users userlist : operations ; <br>
allow groups grouplist : operations ; <br>
disallow groups grouplist : operations ; <br>
allow hosts hostlist : operations ; <br>
disallow hosts hostlist : operations ;</p>

<p style="margin-top: 1em">list userlist, grouplist and
hostlist are comma separated lists of one or more users,
groups or host identifiers.</p>

<p style="margin-top: 1em">operations is a comma separated
list of the operation types described above, all (which
allows/disallows all operations), or all except operations
(which allows/disallows all <br>
operations except those listed).</p>

<p style="margin-top: 1em">Either plural or singular forms
of users, groups, and hosts keywords are allowed. If this
keyword is omitted, a default of hosts will be used. This
behaviour is for backward- <br>
compatibility only, it is preferable to be explicit.</p>

<p style="margin-top: 1em">Where no specific allow or
disallow statement applies to an operation, the default is
to allow the operation from all users, groups and hosts. In
the trivial case when there is <br>
no access control section in the configuration file, all
operations from all users, groups, and hosts are
permitted.</p>

<p style="margin-top: 1em">If a new connection to pmcd is
attempted by a user, group or host that is not permitted to
perform any operations, the connection will be closed
immediately after an error <br>
response PM_ERR_PERMISSION has been sent to the client
attempting the connection.</p>

<p style="margin-top: 1em">Statements with the same level
of wildcarding specifying identical hosts may not contradict
each other. For example if a host named clank had an IP
address of 129.127.112.2, <br>
specifying the following two rules would be erroneous:</p>

<p style="margin-top: 1em">allow host clank : fetch, store;
<br>
disallow host 129.127.112.2 : all except fetch;</p>

<p style="margin-top: 1em">because they both refer to the
same host, but disagree as to whether the fetch operation is
permitted from that host.</p>

<p style="margin-top: 1em">Statements containing more
specific host specifications override less specific ones
according to the level of wildcarding. For example a rule of
the form</p>

<p style="margin-top: 1em">allow host clank : all;</p>

<p style="margin-top: 1em">overrides</p>

<p style="margin-top: 1em">disallow host 129.127.112.* :
all except fetch;</p>

<p style="margin-top: 1em">because the former contains a
specific host name (equivalent to a fully specified IP
address), whereas the latter has a wildcard. In turn, the
latter would override</p>

<p style="margin-top: 1em">disallow host * : all;</p>

<p style="margin-top: 1em">It is possible to limit the
number of connections from a user, group or host to pmcd.
This may be done by adding a clause of the form</p>

<p style="margin-top: 1em">maximum n connections</p>

<p style="margin-top: 1em">to the operations list of an
allow statement. Such a clause may not be used in a disallow
statement. Here, n is the maximum number of connections that
will be accepted from the <br>
user, group or host matching the identifier(s) used in the
statement.</p>

<p style="margin-top: 1em">An access control statement with
a list of user, group or host identifiers is equivalent to a
set of access control statements, with each specifying one
of the identifiers in the <br>
list and all with the same access controls (both permissions
and connection limits). A group should be used if you want
users to contribute to a shared connection limit. A <br>
wildcard should be used if you want hosts to contribute to a
shared connection limit.</p>

<p style="margin-top: 1em">When a new client requests a
connection, and pmcd has determined that the client has
permission to connect, it searches the matching list of
access control statements for the <br>
most specific match containing a connection limit. For
brevity, this will be called the limiting statement. If
there is no limiting statement, the client is granted a
connec&acirc; <br>
tion. If there is a limiting statement and the number of
pmcd clients with user ID, group ID, or IP addresses that
match the identifier in the limiting statement is less than
<br>
the connection limit in the statement, the connection is
allowed. Otherwise the connection limit has been reached and
the client is refused a connection.</p>

<p style="margin-top: 1em">Group access controls and the
wildcarding in host identifiers means that once pmcd
actually accepts a connection from a client, the connection
may contribute to the current con&acirc; <br>
nection count of more than one access control statement -
the client&rsquo;s host may match more than one access
control statement, and similarly the user ID may be in more
than one <br>
group. This may be significant for subsequent connection
requests.</p>

<p style="margin-top: 1em">Note that pmcd enters a mode
where it runs effectively with a higher-level of security as
soon as a user or group access control section is added to
the configuration. In this <br>
mode only authenticated connections are allowed - either
from a SASL authenticated connection, or a Unix domain
socket (which implicitly passes client credentials). This is
the <br>
same mode that is entered explicitly using the -S option.
Assuming permission is allowed, one can determine whether
pmcd is running in this mode by querying the value of the
<br>
pmcd.feature.creds_required metric.</p>

<p style="margin-top: 1em">Note also that because most
specific match semantics are used when checking the
connection limit, for the host-based access control case,
priority is given to clients with more <br>
specific host identifiers. It is also possible to exceed
connection limits in some situations. Consider the
following:</p>

<p style="margin-top: 1em">allow host clank : all, maximum
5 connections; <br>
allow host * : all except store, maximum 2 connections;</p>

<p style="margin-top: 1em">This says that only 2 client
connections at a time are permitted for all hosts other than
&quot;clank&quot;, which is permitted 5. If a client from
host &quot;boing&quot; is the first to connect to <br>
pmcd, its connection is checked against the second statement
(that is the most specific match with a connection limit).
As there are no other clients, the connection is accepted
<br>
and contributes towards the limit for only the second
statement above. If the next client connects from
&quot;clank&quot;, its connection is checked against the
limit for the first state&acirc; <br>
ment. There are no other connections from &quot;clank&quot;,
so the connection is accepted. Once this connection is
accepted, it counts towards both statements&rsquo; limits
because &quot;clank&quot; <br>
matches the host identifier in both statements. Remember
that the decision to accept a new connection is made using
only the most specific matching access control statement
with <br>
a connection limit. Now, the connection limit for the second
statement has been reached. Any connections from hosts other
than &quot;clank&quot; will be refused.</p>

<p style="margin-top: 1em">If instead, pmcd with no clients
saw three successive connections arrived from
&quot;boing&quot;, the first two would be accepted and the
third refused. After that, if a connection was <br>
requested from &quot;clank&quot; it would be accepted. It
matches the first statement, which is more specific than the
second, so the connection limit in the first is used to
determine <br>
that the client has the right to connect. Now there are 3
connections contributing to the second statement&rsquo;s
connection limit. Even though the connection limit for the
second <br>
statement has been exceeded, the earlier connections from
&quot;boing&quot; are maintained. The connection limit is
only checked at the time a client attempts a connection
rather than <br>
being re-evaluated every time a new client connects to
pmcd.</p>

<p style="margin-top: 1em">This gentle scheme is designed
to allow reasonable limits to be imposed on a first come
first served basis, with specific exceptions.</p>

<p style="margin-top: 1em">As illustrated by the example
above, a client&rsquo;s connection is honored once it has
been accepted. However, pmcd reconfiguration (see the next
section) re-evaluates all the con&acirc; <br>
nection counts and will cause client connections to be
dropped where connection limits have been exceeded.</p>

<p style="margin-top: 1em">RECONFIGURING PMCD <br>
If the configuration file has been changed or if an agent is
not responding because it has terminated or the PMNS has
been changed, pmcd may be reconfigured by sending it a <br>
SIGHUP, as in</p>

<p style="margin-top: 1em"># pmsignal -a -s HUP pmcd</p>

<p style="margin-top: 1em">When pmcd receives a SIGHUP, it
checks the configuration file for changes. If the file has
been modified, it is reparsed and the contents become the
new configuration. If there <br>
are errors in the configuration file, the existing
configuration is retained and the contents of the file are
ignored. Errors are reported in the pmcd log file.</p>

<p style="margin-top: 1em">It also checks the PMNS file for
changes. If the PMNS file has been modified, then it is
reloaded. Use of tail(1) on the log file is recommended
while reconfiguring pmcd.</p>

<p style="margin-top: 1em">If the configuration for an
agent has changed (any parameter except the agent&rsquo;s
label is different), the agent is restarted. Agents whose
configurations do not change are not <br>
restarted. Any existing agents not present in the new
configuration are terminated. Any deceased agents are that
are still listed are restarted.</p>

<p style="margin-top: 1em">Sometimes it is necessary to
restart an agent that is still running, but malfunctioning.
Simply stop the agent (e.g. using SIGTERM from pmsignal(1)),
then send pmcd a SIGHUP, <br>
which will cause the agent to be restarted.</p>

<p style="margin-top: 1em">STARTING AND STOPPING PMCD <br>
Normally, pmcd is started automatically at boot time and
stopped when the system is being brought down. Under certain
circumstances it is necessary to start or stop pmcd
manu&acirc; <br>
ally. To do this one must become superuser and type</p>

<p style="margin-top: 1em"># $PCP_RC_DIR/pmcd start</p>

<p style="margin-top: 1em">to start pmcd, or</p>

<p style="margin-top: 1em"># $PCP_RC_DIR/pmcd stop</p>

<p style="margin-top: 1em">to stop pmcd. Starting pmcd when
it is already running is the same as stopping it and then
starting it again.</p>

<p style="margin-top: 1em">Sometimes it may be necessary to
restart pmcd during another phase of the boot process.
Time-consuming parts of the boot process are often put into
the background to allow the <br>
system to become available sooner (e.g. mounting huge
databases). If an agent run by pmcd requires such a task to
complete before it can run properly, it is necessary to
restart <br>
or reconfigure pmcd after the task completes. Consider, for
example, the case of mounting a database in the background
while booting. If the PMDA which provides the metrics <br>
about the database cannot function until the database is
mounted and available but pmcd is started before the
database is ready, the PMDA will fail (however pmcd will
still ser&acirc; <br>
vice requests for metrics from other domains). If the
database is initialized by running a shell script, adding a
line to the end of the script to reconfigure pmcd (by
sending <br>
it a SIGHUP) will restart the PMDA (if it exited because it
couldn&rsquo;t connect to the database). If the PMDA
didn&rsquo;t exit in such a situation it would be necessary
to restart pmcd <br>
because if the PMDA was still running pmcd would not restart
it.</p>

<p style="margin-top: 1em">Normally pmcd listens for client
connections on TCP/IP port number 44321 (registered at
http://www.iana.org/). Either the environment variable
PMCD_PORT or the -p command line <br>
option may be used to specify alternative port number(s)
when pmcd is started; in each case, the specification is a
comma-separated list of one or more numerical port numbers.
<br>
Should both methods be used or multiple -p options appear on
the command line, pmcd will listen on the union of the set
of ports specified via all -p options and the PMCD_PORT <br>
environment variable. If non-default ports are used with
pmcd care should be taken to ensure that PMCD_PORT is also
set in the environment of any client application that will
<br>
connect to pmcd, or that the extended host specification
syntax is used (see PCPIntro(1) for details).</p>

<p style="margin-top: 1em">FILES <br>
$PCP_PMCDCONF_PATH <br>
default configuration file <br>
$PCP_PMCDOPTIONS_PATH <br>
command line options to pmcd when launched from
$PCP_RC_DIR/pmcd All the command line option lines should
start with a hyphen as the first character. <br>
$PCP_SYSCONFIG_DIR/pmcd <br>
additional environment variables that will be set when pmcd
executes. Only settings of the form
&quot;PMCD_VARIABLE=value&quot; will be honoured. <br>
./pmcd.log <br>
(or $PCP_LOG_DIR/pmcd/pmcd.log when started automatically)
<br>
$PCP_RUN_DIR/pmcd.pid <br>
contains an ascii decimal representation of the process ID
of pmcd , when it&rsquo;s running. <br>
All messages and diagnostics are directed here <br>
/etc/pki/nssdb <br>
default Network Security Services (NSS) certificate database
directory, used for optional Secure Socket Layer
connections. This database can be created and queried <br>
using the NSS certutil tool, amongst others. <br>
/etc/passwd <br>
user names, user identifiers and primary group identifiers,
used for access control specifications <br>
/etc/groups <br>
group names, group identifiers and group members, used for
access control specifications</p>

<p style="margin-top: 1em">ENVIRONMENT <br>
In addition to the PCP environment variables described in
the PCP ENVIRONMENT section below, the PMCD_PORT variable is
also recognised as the TCP/IP port for incoming connections
<br>
(default 44321), and the PMCD_SOCKET variable is also
recognised as the path to be used for the Unix domain
socket.</p>

<p style="margin-top: 1em">If set to the value 1, the
PMCD_LOCAL environment variable will cause pmcd to run in a
localhost-only mode of operation, where it binds only to the
loopback interface. The <br>
pmcd.feature.local metric can be queried to determine if
pmcd is running in this mode.</p>

<p style="margin-top: 1em">The PMCD_MAXPENDING variable can
be set to indicate the maximum length to which the queue of
pending client connections may grow.</p>

<p style="margin-top: 1em">The PMCD_ROOT_AGENT variable
controls whether or not pmcd or pmdaroot (when available),
start subsequent pmdas. When set to a non-zero value, pmcd
will opt to have pmdaroot <br>
start, and stop, PMDAs.</p>

<p style="margin-top: 1em">The PMCD_RESTART_AGENTS variable
determines the behaviour of pmcd in the presence of child
PMDAs that have been observed to exit (this is a typical
response in the presence of <br>
very large, usually domain-induced, PDU latencies). When set
to a non-zero value, pmcd will attempt to restart such PMDAS
once every minute. When set to zero, it uses the orig&acirc;
<br>
inal behaviour of just logging the failure.</p>

<p style="margin-top: 1em">PCP ENVIRONMENT <br>
Environment variables with the prefix PCP_ are used to
parameterize the file and directory names used by PCP. On
each installation, the file /etc/pcp.conf contains the local
<br>
values for these variables. The $PCP_CONF variable may be
used to specify an alternative configuration file, as
described in pcp.conf(5).</p>

<p style="margin-top: 1em">DIAGNOSTICS <br>
If pmcd is already running the message &quot;Error:
OpenRequestSocket bind: Address may already be in use&quot;
will appear. This may also appear if pmcd was shutdown with
an outstanding <br>
request from a client. In this case, a request socket has
been left in the TIME_WAIT state and until the system closes
it down (after some timeout period) it will not be
possi&acirc; <br>
ble to run pmcd.</p>

<p style="margin-top: 1em">In addition to the standard PCP
debugging flags, see pmdbg(1), pmcd currently uses
DBG_TRACE_APPL0 for tracing I/O and termination of agents,
DBG_TRACE_APPL1 for tracing access <br>
control and DBG_TRACE_APPL2 for tracing the configuration
file scanner and parser.</p>

<p style="margin-top: 1em">CAVEATS <br>
pmcd does not explicitly terminate its children (agents), it
only closes their pipes. If an agent never checks for a
closed pipe it may not terminate.</p>

<p style="margin-top: 1em">The configuration file parser
will only read lines of less than 1200 characters. This is
intended to prevent accidents with binary files.</p>

<p style="margin-top: 1em">The timeouts controlled by the
-t option apply to IPC between pmcd and the PMDAs it spawns.
This is independent of settings of the environment variables
PMCD_CONNECT_TIMEOUT and <br>
PMCD_REQUEST_TIMEOUT (see PCPIntro(1)) which may be used
respectively to control timeouts for client applications
trying to connect to pmcd and trying to receive information
from <br>
pmcd.</p>

<p style="margin-top: 1em">SEE ALSO <br>
PCPIntro(1), pmdbg(1), pmerr(1), pmgenmap(1), pminfo(1),
pmrep(1), pmstat(1), pmstore(1), pmval(1), getpwent(3),
getgrent(3), pcp.conf(5), and pcp.env(5).</p>

<p style="margin-top: 1em">Performance Co-Pilot PCP
PMCD(1)</p>
<hr>
</body>
</html>
