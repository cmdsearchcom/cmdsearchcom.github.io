<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:07:00 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>EFAX(1) EFAX(1)</p>

<p style="margin-top: 1em">NAME <br>
efax - send/receive faxes with Class 1, 2 or 2.0 fax
modem</p>

<p style="margin-top: 1em">(Please read the fax man page
first.)</p>

<p style="margin-top: 1em">SYNOPSIS <br>
efax [ options ] [ -t num [ file... ] ]</p>

<p style="margin-top: 1em">OPTIONS <br>
Where options are:</p>

<p style="margin-top: 1em">-a cmd use the command ATcmd
when answering the phone. The default is &quot;A&quot;.</p>

<p style="margin-top: 1em">-c caps set the local modem
capabilities. See the section on capabilities below for the
format and meaning of caps. For Class 1 the default is
1,n,0,2,0,0,0,0 where n is the <br>
highest speed supported by the modem. For Class 2 the
default is determined by the modem.</p>

<p style="margin-top: 1em">-d dev use the fax modem
connected to device dev. The default is /dev/modem.</p>

<p style="margin-top: 1em">-e cmd if a CONNECT response
indicates a voice call, the shell /bin/sh is
exec(2)&rsquo;ed with cmd as its command.</p>

<p style="margin-top: 1em">-f fnt use font file fnt for
generating the header. The default is a built-in 8x16 font.
See the efix(1) -f option for the font file format.</p>

<p style="margin-top: 1em">-g cmd if a CONNECT (or DATA)
response indicates a data call, the shell /bin/sh is
exec(2)&rsquo;ed with cmd as its command. cmd is a printf(3)
format that may contain up to 6 %d <br>
escapes which are replaced by the baud rate following the
most recent CONNECT message. cmd typically exec&rsquo;s
getty(8).</p>

<p style="margin-top: 1em">-h hdr put string
&lsquo;hdr&rsquo; at the top of each page. The first %d in
&lsquo;hdr&rsquo; is replaced by the page number and the
second, if any, is replaced by the number of pages being
sent.</p>

<p style="margin-top: 1em">-i str</p>

<p style="margin-top: 1em">-j str</p>

<p style="margin-top: 1em">-k str send the command ATstr to
the modem to initialize it. -i commands are sent before the
modem is put into fax mode, -j commands after the modem is
in fax mode, and -k <br>
commands just before efax exits. The only default is a
hang-up (ATH) command that is sent before exiting only if no
other -k options are given. Multiple options may be <br>
used.</p>

<p style="margin-top: 1em">-l id set the local
identification string to id. id should be the local
telephone number in international format (for example
&quot;+1 800 555 1212&quot;). This is passed to the <br>
remote fax machine. Some fax machines may not accept
characters other than numbers, space, and
&rsquo;+&rsquo;.</p>

<p style="margin-top: 1em">-n force line buffering of
stdout instead of block buffering. This might be necessary
if outputting UTF-8 to a terminal with translated text via
NLS, since otherwise the <br>
terminal may be confronted (when the buffer is flushed when
full) with only a partially formed UTF-8 character.
Don&rsquo;t use this option unless you have to.</p>

<p style="margin-top: 1em">-o opt use option opt to
accommodate a non-standard fax modem protocol. See the MODEM
REQUIREMENTS section below for more details. The options
are:</p>

<p style="margin-top: 1em">0 Force use of Class 2.0 fax
modem commands. The modem must support Class 2.0.</p>

<p style="margin-top: 1em">2 Force use of Class 2 fax modem
commands. The modem must support Class 2.</p>

<p style="margin-top: 1em">1 Force use of Class 1 fax modem
commands. The modem must support Class 1. By default efax
queries the modem and uses the first of the three above
classes which is sup&acirc; <br>
ported by the modem.</p>

<p style="margin-top: 1em">a use software adaptive answer
method. If the first attempt to answer the call does not
result in a data connection within 8 seconds the phone is
hung up temporarily and <br>
answered again in fax mode (see &quot;Accepting both fax and
data calls&quot; below).</p>

<p style="margin-top: 1em">e ignore errors in modem
initialization commands.</p>

<p style="margin-top: 1em">f use &quot;virtual flow
control&quot;. efax tries to estimate the number of bytes in
the modem&rsquo;s transmit buffer and pauses as necessary to
avoid filling it. The modem&rsquo;s buffer <br>
is assumed to hold at least 96 bytes. This feature does not
work properly with Class 2 modems that add redundant padding
to scan lines. Use this option only if you <br>
have problems configuring flow control.</p>

<p style="margin-top: 1em">h use hardware (RTS/CTS) in
addition to software (XON/XOFF) flow control. Many modems
will stop responding if this option is used. See the section
&lsquo;Resolving Problems&rsquo; <br>
before using this option.</p>

<p style="margin-top: 1em">l halve the time between testing
lock files when waiting for other programs to complete. By
default this is 8 seconds. For example -olll sets the
interval to 1 second.</p>

<p style="margin-top: 1em">n ignore requests for pages to
be retransmitted. Use this option if you don&rsquo;t care
about the quality of the received fax or if the receiving
machine is too fussy. Other&acirc; <br>
wise each page may be retransmitted up to 3 times.</p>

<p style="margin-top: 1em">r do not reverse bit order
during data reception for Class 2 modems. Only Multitech
modems require this option. Not normally required since efax
detects these modems.</p>

<p style="margin-top: 1em">x send XON (DC1) instead of DC2
to start data reception. Applies to a very few Class 2
modems only.</p>

<p style="margin-top: 1em">z delay an additional 100
milliseconds before each modem initialization or reset
command. The initial delay is 100 ms. For example, -ozzz
produces a 400 ms delay. Use <br>
with modems that get confused when commands arrive too
quickly.</p>

<p style="margin-top: 1em">-q n ask for retransmission of
pages received with more than n errors. Default is 10.</p>

<p style="margin-top: 1em">-r pat each received fax page is
stored in a separate file. The file name is created using
pat as a strftime(3) format string. A page number of the
form .001, .002, ... is <br>
appended to the file name. If pat is blank (&quot;&quot;) or
no -r option is given a default string of
&quot;%m%d%H%M%S&quot; is used.</p>

<p style="margin-top: 1em">-s remove lock file(s) after
initializing the modem. This allows outgoing calls to
proceed when efax is waiting for an incoming call. If efax
detects modem activity it <br>
will attempt to re-lock the device. If the modem has been
locked by the other program efax will exit and return 1
(&lsquo;&lsquo;busy&rsquo;&rsquo;). Normally a new efax
process is then <br>
started by init(8). The new efax process will then check
periodically until the lock file disappears and then
re-initialize the modem.</p>

<p style="margin-top: 1em">-t num [file...] <br>
dial telephone number num and send the fax image files
file.... If used, this must be the last argument on the
command line. The telephone number num is a string that <br>
may contain any dial modifiers that the modem supports such
as a T prefix for tone dialing or commas for delays. If no
file names are given the remote fax machine will <br>
be polled. If no -t argument is given efax will answer the
phone and attempt to receive a fax.</p>

<p style="margin-top: 1em">-u use UTF-8 and not locale
codeset (if different) for messages to stderr and stdout
(see also the -n option) - this is useful if efax is used
with a front-end which <br>
expects UTF-8 encoding of internationalized strings.</p>

<p style="margin-top: 1em">-v strng select types of
messages to be printed. Each lower-case letter in strng
enables one type of message:</p>

<p style="margin-top: 1em">e - errors <br>
w - warnings <br>
i - session progress information <br>
n - capability negotiation information <br>
c - modem (AT) commands and responses <br>
h - HDLC frame data (Class 1 only) <br>
m - modem output <br>
a - program arguments <br>
r - reception error details <br>
t - transmission details <br>
f - image file details <br>
x - lock file processing</p>

<p style="margin-top: 1em">Up to two -v options may be
used. The first is for messages printed to the standard
error and the second is for messages to the standard output.
The default is &quot;ewin&quot; <br>
to the standard error only.</p>

<p style="margin-top: 1em">-w wait for an OK or CONNECT
prompt instead of issuing an answer (ATA) command to receive
a fax. Use this option when the modem is set to auto-answer
(using S0=n) or if <br>
another program has already answered the call.</p>

<p style="margin-top: 1em">-x lkf use a UUCP-style lock
file lkf to lock the modem device before opening it. If the
device is locked, efax checks every 15 seconds until it is
free. Up to 16 -x options <br>
may be used if there are several names for the same device.
A &lsquo;#&rsquo; prefix on the file name creates an binary
rather than text (HDB-style) lock file. This is the reverse
<br>
of what was used by previous efax versions.</p>

<p style="margin-top: 1em">FAX FILE FORMATS <br>
efax can read the same types of files as efix(1) including
text, T.4 (Group 3), PBM, single- and multi-page TIFF (G3
and uncompressed). efax automatically determines the type of
<br>
file from its contents. TIFF files are recommended as they
contain information about the image size and resolution.</p>

<p style="margin-top: 1em">Each page to be sent should be
converted to a separate TIFF format file with Group 3 (G3)
compression. Received files are also stored in this format.
The EXAMPLES section below <br>
shows how efix and other programs can be used to create,
view and print these files.</p>

<p style="margin-top: 1em">OPERATING SYSTEM REQUIREMENTS
<br>
The operating system must provide short response times to
avoid protocol timeouts. For Class 2 and 2.0 modems the
delay should not exceed 1 or 2 seconds.</p>

<p style="margin-top: 1em">When using Class 1 modems the
program must respond to certain events within 55
milliseconds. Longer delays may cause the fax protocol to
fail in certain places (between DCS and <br>
TCF or between RTC and MPS). Class 1 modems should therefore
not be used on systems that cannot guarantee that the
program will respond to incoming data in less than 55
mil&acirc; <br>
liseconds. In particular, some intelligent serial cards and
terminal servers may introduce enough delay to cause
problems with Class 1 operation.</p>

<p style="margin-top: 1em">The operating system must also
provide sufficient low-level buffering to allow
uninterrupted transfer of data between the modem and a disk
file at the selected baud rate, typi&acirc; <br>
cally 9600 bps. Since the fax protocol does not provide
end-to-end flow control the effectiveness of flow control
while receiving is limited by the size of the modem&rsquo;s
buffer. <br>
This can be less than 100 bytes. Efax does not use flow
control during reception.</p>

<p style="margin-top: 1em">MODEM REQUIREMENTS <br>
The &quot;Group&quot; is the protocol used to send faxes
between fax machines. Efax supports the Group 3 protocol
used over the public telephone network.</p>

<p style="margin-top: 1em">The &quot;Class&quot; is the
protocol used by computers to control fax modems. Efax
supports Class 1, 2 and 2.0 fax modems.</p>

<p style="margin-top: 1em">Most fax modems use XON/XOFF
flow control when in fax mode. This type of flow control
adds very little overhead for fax use. Many modems have
unreliable hardware (RTS/CTS) flow <br>
control in fax mode. By default efax enables only XON/XOFF
flow control and the -oh option must be used to add hardware
flow control.</p>

<p style="margin-top: 1em">While some modems have serial
buffers of about 1k bytes, many inexpensive modems have
buffers of about one hundred bytes and are thus more likely
to suffer overruns when sending <br>
faxes.</p>

<p style="margin-top: 1em">A few older modems may need a
delay between commands of more than the default value used
by efax (100 milliseconds). If the delay is too short,
commands may not echo properly, <br>
may time out, or may give inconsistent responses. Use one or
more -oz options to increase the delay between modem
initialization commands and use the E0 modem initialization
<br>
command to disable echoing of modem commands.</p>

<p style="margin-top: 1em">By default efax sends DC2 to
start the data flow from the modem when receiving faxes from
Class 2 modems. A few older modems require XON instead. Use
of DC2 would cause the <br>
modem to give an error message and/or the program to time
out. The -ox option should be used in this case.</p>

<p style="margin-top: 1em">A few older Class 2 modems (e.g.
some Intel models) don&rsquo;t send DC2 or XON to start the
data flow to the modem when sending faxes. After waiting 2
seconds efax will print a warn&acirc; <br>
ing and start sending anyways.</p>

<p style="margin-top: 1em">A very few Class 2 modems do not
reverse the bit order (MSB to LSB) by default on receive.
This might cause errors when trying to display or print the
received files. The -or <br>
option can be used in this case.</p>

<p style="margin-top: 1em">Some inexpensive &quot;9600
bps&quot; fax modems only transmit at 9600 bps and reception
is limited to 4800 bps.</p>

<p style="margin-top: 1em">The following Class 1 modems
have been reported to work with efax: AT&amp;T DataPort,
Cardinal Digital Fax Modem (14400), Digicom Scout+, Motorola
Lifestyle 28.8, Motorola Power <br>
28.8, QuickComm Spirit II, Smartlink 9614AV-Modem, Supra
Faxmodem 144LC, USR Courier V.32bis Terbo, USR Sportster
(V.32 and V.34), Zoom AFC 2.400, Zoom VFX14.4V.</p>

<p style="margin-top: 1em">The following Class 2 modems
have been reported to work with efax: 14k4 Amigo Communion
fax/modem, Adtech Micro Systems 14.4 Fax/modem, askey modem
type 1414VQE, AT&amp;T DataPort, <br>
ATT/Paradyne, AT&amp;T Paradyne PCMCIA, Boca modem, BOCA
M1440E, Crosslink 9614FH faxmodem, FuryCard DNE 5005, GVC
14.4k internal, Intel 14.4 fax modem, Megahertz 14.4, ,
Microcom <br>
DeskPorte FAST ES 28.8, Motorola UDS FasTalk II, MultiTech
1432MU, Practical Peripherals PM14400FXMT, Supra V32bis,
Telebit Worldblazer, TKR DM-24VF+, Twincom 144/DFi, ViVa
<br>
14.4/Fax modem, Vobis Fax-Modem (BZT-approved), Zoom
VFX14.4V, ZyXEL U-1496E[+], ZyXEL Elite 2864I.</p>

<p style="margin-top: 1em">MODEM INITIALIZATION OPTIONS
<br>
The required modem initialization commands are generated by
efax. Additional commands may be supplied as command-line
arguments. The modem must be set up to issue verbose(text)
<br>
result codes. The following command does this and is sent by
efax before trying to initialize the modem.</p>

<p style="margin-top: 1em">Q0V1 respond to commands with
verbose result codes</p>

<p style="margin-top: 1em">The following commands may be
useful for special purposes:</p>

<p style="margin-top: 1em">X3 don&rsquo;t wait for dial
tone before dialing. This may be used to send a fax when the
call has already been dialed manually. In this case use an
empty string (&quot;&quot;) as the <br>
first argument to the -t command. Use X4 (usual default) to
enable all result codes.</p>

<p style="margin-top: 1em">M2 leave the monitor speaker
turned on for the duration of the call (use M0 to leave it
off).</p>

<p style="margin-top: 1em">L0 turn monitor speaker volume
to minimum (use L3 for maximum).</p>

<p style="margin-top: 1em">E0 disable echoing of modem
commands. See the Resolving Problems section below.</p>

<p style="margin-top: 1em">&amp;D2 returns the modem to
command mode when DTR is dropped. The program drops DTR at
the start and end of the call if it can&rsquo;t get a
response to a modem command. You can <br>
use &amp;D3 to reset the modem when DTR is dropped.</p>

<p style="margin-top: 1em">S7=120 wait up to two minutes
(120 seconds) for carrier. This may be useful if the
answering fax machine takes a long time to start the
handshaking operation (e.g. a combined <br>
fax/answering machine with a long announcement).</p>

<p style="margin-top: 1em">CAPABILITIES <br>
The capabilities of the local hardware and software can be
set using a string of 8 digits separated by commas:</p>

<p style="margin-top: 1em">vr,br,wd,ln,df,ec,bf,st</p>

<p style="margin-top: 1em">where:</p>

<p style="margin-top: 1em">vr (vertical resolution) = <br>
0 for 98 lines per inch <br>
1 for 196 lpi</p>

<p style="margin-top: 1em">br (bit rate) = <br>
0 for 2400 bps <br>
1 for 4800 <br>
2 for 7200 <br>
3 for 9600 <br>
4 for 12000 (V.17) <br>
5 for 14400 (V.17)</p>

<p style="margin-top: 1em">wd (width) = <br>
0 for 8.5&quot; (21.5 cm) page width <br>
1 for 10&quot; (25.5 cm) <br>
2 for 12&quot; (30.3 cm)</p>

<p style="margin-top: 1em">ln (length) = <br>
0 for 11&quot; (A4: 29.7 cm) page length <br>
1 for 14&quot; (B4: 36.4 cm) <br>
2 for unlimited page length</p>

<p style="margin-top: 1em">df (data format) = <br>
0 for 1-D coding <br>
1 for 2-D coding (not supported)</p>

<p style="margin-top: 1em">ec (error correction) = <br>
0 for no error correction</p>

<p style="margin-top: 1em">bf (binary file) = <br>
0 for no binary file transfer</p>

<p style="margin-top: 1em">st (minimum scan time) = <br>
0 for zero delay per line <br>
1 for 5 ms per line <br>
3 for 10 ms per line <br>
5 for 20 ms per line <br>
7 for 40 ms per line</p>

<p style="margin-top: 1em">When receiving a fax the vr, wd,
and ln fields of the capability string should be set to the
maximum values that your display software supports. The
default is 196 lpi, standard <br>
(8.5&quot;/21.5cm) width and unlimited length.</p>

<p style="margin-top: 1em">When sending a fax efax will
determine vr and ln from the image file and set wd to the
default.</p>

<p style="margin-top: 1em">If the receiving fax machine
does not support high resolution (vr=1) mode, efax will
reduce the resolution by combining pairs of scan lines. If
the receiving fax machine does <br>
not support the image&rsquo;s width then efax will truncate
or pad as required. Most fax machines can receive ln up to
2. Few machines support values of wd other than 0.</p>

<p style="margin-top: 1em">HEADERS <br>
efax adds blank scan lines at the top of each image when it
is sent. This allows room for the page header but increases
the length of the image (by default about 0.1&quot; or 2.5mm
<br>
of blank space is added).</p>

<p style="margin-top: 1em">The header placed in this area
typically includes the date and time, identifies the, and
shows the page number and total pages. Headers cannot be
disabled but the header string <br>
can be set to a blank line.</p>

<p style="margin-top: 1em">The default font for generating
the headers is the built-in 8x16 pixel font scaled to 12x24
pixels (about 9 point size).</p>

<p style="margin-top: 1em">Note that both efax and efix
have -f options to specify the font. efIx uses the font to
generate text when doing text-to-fax conversions (during
&quot;fax make&quot;) while efAx uses the <br>
font to generate the header (during &quot;fax
send&quot;).</p>

<p style="margin-top: 1em">SESSION LOG <br>
A session log is written to the standard error stream. This
log gives status and error messages from the program as
selected by the -v option. A time stamp showing the full
time <br>
or just minutes and seconds is printed before each message.
Times printed along with modem responses also show
milliseconds.</p>

<p style="margin-top: 1em">RETURN VALUES <br>
The program returns an error code as follows:</p>

<p style="margin-top: 1em">0 The fax was successfully sent
or received.</p>

<p style="margin-top: 1em">1 The dialed number was busy or
the modem device was in use. Try again later.</p>

<p style="margin-top: 1em">2 Something failed (e.g. file
not found or disk full). Don&rsquo;t retry. Check the
session log for more details.</p>

<p style="margin-top: 1em">3 Modem protocol error. The
program did not receive the expected response from the
modem. The modem may not have been properly initialized, the
correct -o options were <br>
not used, or a bug report may be in order. Check the session
log for more details.</p>

<p style="margin-top: 1em">4 The modem is not responding.
Operator attention is required. Check that the modem is
turned on and connected to the correct port.</p>

<p style="margin-top: 1em">5 The program was terminated by
a signal.</p>

<p style="margin-top: 1em">EXAMPLES <br>
Creating fax (G3) files</p>

<p style="margin-top: 1em">The efix program can be used to
convert text files to TIFF-G3 format. For example, the
following command will convert the text file letter to the
files letter.001, letter.002, <br>
etc,:</p>

<p style="margin-top: 1em">efix -nletter.%03d letter</p>

<p style="margin-top: 1em">Ghostscript&rsquo;s tiffg3
driver can generate fax files in TIFF-G3 format from
postscript files. For example, the command:</p>

<p style="margin-top: 1em">gs -q -sDEVICE=tiffg3 -dNOPAUSE
-sOutputFile=letter.%03d letter.ps &lt;/dev/null</p>

<p style="margin-top: 1em">will convert the Postscript file
letter.ps into high-resolution (vr=1) G3 fax image files
letter.001, letter.002, ...</p>

<p style="margin-top: 1em">The images should have margins
of at least 1/2 inch (1 cm) since the fax standard only
requires that fax machines print a central portion of the
image 196.6mm (7.7 inches) wide <br>
by 281.5mm (11.1 inches) high.</p>

<p style="margin-top: 1em">The efix program can also insert
bitmaps in images to create letterhead, signatures, etc.</p>

<p style="margin-top: 1em">Printing fax files</p>

<p style="margin-top: 1em">You can use the efix program to
print faxes on Postscript or HP-PCL (LaserJet) printers. For
example, to print the received fax file reply.001 on a
Postscript printer use the <br>
command:</p>

<p style="margin-top: 1em">efix -ops reply.001 | lpr</p>

<p style="margin-top: 1em">Sending fax files</p>

<p style="margin-top: 1em">The following command will dial
the number 222-2222 using tone dialing and send a two-page
fax from the TIFF-G3 files letter.001 and letter.002 using
the fax modem connected to <br>
device /dev/cua1.</p>

<p style="margin-top: 1em">efax -d /dev/cua1 -t T222-2222
letter.001 letter.002</p>

<p style="margin-top: 1em">Manual answer</p>

<p style="margin-top: 1em">You can use efax to answer the
phone immediately and start fax reception. Use this mode if
you need to answer calls manually to see if they are fax or
voice.</p>

<p style="margin-top: 1em">For example, the following
command will make the fax modem on device /dev/ttyS1 answer
the phone and attempt to receive a fax. The received fax
will be stored in the files <br>
reply.001, reply.002, and so on. The modem will identify
itself as &quot;555 1212&quot; and receive faxes at high or
low resolution (vr=1), at up to 14.4 kbps (br=5).</p>

<p style="margin-top: 1em">efax -d /dev/ttyS1 -l &quot;555
1212&quot; -c 1,5 -r reply</p>

<p style="margin-top: 1em">Automatic answer</p>

<p style="margin-top: 1em">The -w option makes efax wait
for characters to become available from the modem
(indicating an incoming call) before starting fax reception.
Use the -w option and a -iS0=n <br>
option to answer the phone after n rings. The example below
will make the modem answer incoming calls in fax mode on the
fourth ring and save the received faxes using files <br>
names corresponding to the reception date and time.</p>

<p style="margin-top: 1em">efax -d /dev/ttyb -w -iS0=4
2&gt;&amp;1 &gt;&gt; fax.log</p>

<p style="margin-top: 1em">Sharing the modem with outgoing
calls</p>

<p style="margin-top: 1em">The modem device can be shared
by programs that use the UUCP device locking protocol. This
includes pppd, chat, minicom, kermit, uucico, efax, cu, and
many others others. How&acirc; <br>
ever, locking will only work if all programs use the same
lock file.</p>

<p style="margin-top: 1em">efax will lock the modem device
before opening it if one or more UUCP lock file names are
given with -x options. Most programs place their lock files
in the /usr/spool/uucp or <br>
/var/lock directories and use the name LCK..dev where dev is
the name of the device file in the /dev directory that is to
be locked.</p>

<p style="margin-top: 1em">If the -s (share) option is
used, the lock file is removed while waiting for incoming
calls so other programs can use the same device.</p>

<p style="margin-top: 1em">If efax detects another program
using the modem while it is waiting to receive a fax, efax
exits with a termination code of 1. A subsequent efax
process using this device will <br>
wait until the other program is finished before
re-initializing the modem and starting to wait for incoming
calls again.</p>

<p style="margin-top: 1em">Programs that try to lock the
modem device by using device locking facilities other than
UUCP lock files not be able to use this arbitration
mechanism because the device will <br>
still be open to the efax process. In this case you will
need to kill the efax process (e.g. &quot;fax stop&quot;)
before starting the other program.</p>

<p style="margin-top: 1em">When efax is waiting for a fax
it leaves the modem ready to receive in fax mode but removes
the lock file. When a slip or PPP program takes over the
modem port by setting up its <br>
own lock file efax cannot send any more commands to the
modem -- not even to reset it. Therefore the other program
has to set the modem back to data mode when it starts up. To
<br>
do this add a modem reset command (send ATZ expect OK) to
the beginning of your slip or PPP chat script.</p>

<p style="margin-top: 1em">Accepting both fax and data
calls</p>

<p style="margin-top: 1em">Many modems have an adaptive
data/fax answer mode that can be enabled using the -j+FAE=1
(for Class 1) or -jFAA=1 (for Class 2[.0]) initialization
string. The type of call (data <br>
or fax) can then be deduced from the modem&rsquo;s
responses.</p>

<p style="margin-top: 1em">Some modems have limited
adaptive answer features (e.g. only working properly at
certain baud rates or only in Class 2) or none at all. In
this case use the initialization <br>
string -i+FCLASS=0 to answer in data mode first and the -oa
option to then hang up and try again in fax mode if the
first answer attempt was not successful. This method only
<br>
works if your telephone system waits a few seconds after you
hang up before disconnecting incoming calls.</p>

<p style="margin-top: 1em">If the -g option is used then
the option&rsquo;s argument will be run as a shell command
when an incoming data call is detected. Typically this
command will exec getty(8). This pro&acirc; <br>
gram should expect to find the modem already off-hook and a
lock file present so it should not try to hang up the line
or create a lock file. Note that the modem should be set
<br>
up to report the DCE-DTE (modem-computer, e.g. CONNECT
38400) speed, not the DCE-DCE (modem-modem, e.g. CONNECT
14400) speed. For many modems the initialization option -iW0
will <br>
set this.</p>

<p style="margin-top: 1em">The following command will make
efax answer incoming calls on /dev/cua1 on the second ring.
This device will be locked using two different lock files
but these lock files will <br>
be removed while waiting for incoming calls (-s). If a data
call is detected, the getty program will be run to
initialize the terminal driver and start a login(1) process.
<br>
Received fax files will be stored using names like
Dec02-12.32.33.001, in the /usr/spool/fax/incoming directory
and the log file will be appended to
/usr/spool/fax/faxlog.cua1.</p>

<p style="margin-top: 1em">efax -d /dev/cua1 -j
&rsquo;+FAA=1&rsquo; -x /usr/spool/uucp/LCK..cua1 -x
/usr/spool/uucp/LCK..ttyS1 -g &quot;exec /sbin/getty -h
/dev/cua1 %d&quot; -iS0=2 -w -s -r
&quot;/usr/spool/fax/incoming/%b%d-%H.%I.%S&quot; &gt;&gt;
/usr/spool/fax/faxlog.cua1 2&gt;&amp;1</p>

<p style="margin-top: 1em">Note that adaptive answer of
either type will not work for all callers. For some data
calls the duration of the initial data-mode answer may be
too short for data handshaking to <br>
complete. In other cases this duration may be so long that
incoming fax calls will time out before efax switches to fax
mode. In addition, some calling fax modems mistake data-
<br>
mode answering tones for fax signaling tones and initiate
fax negotiation too soon. If you use software adaptive
answer you can reduce the value of the initial data-mode
answer <br>
(set by TO_DATAF in efax.c) to get more reliable fax
handshaking or increase it for more reliable data
handshaking. However, if you need to provide reliable fax
and data service <br>
to all callers you should use separate phone numbers for the
two types of calls.</p>

<p style="margin-top: 1em">When a call is answered the
modem goes on-line with the computer-to-modem baud rate
fixed at the speed used for the most recent AT command. When
efax is waiting for a fax or <br>
data call it sets the interface speed to 19200 bps since
this is the speed required for fax operation. This prevents
full use of 28.8kbps modem capabilities.</p>

<p style="margin-top: 1em">USING INIT TO RUN EFAX <br>
efax can answer all incoming calls if you place an entry for
efax in /etc/inittab (for SysV-like systems) or /etc/ttytab
(for BSD-like systems). The init(8) process will run a <br>
new copy of efax when the system boots up and whenever the
previous efax process terminates. The inittab or ttytab
entry should invoke efax by running the fax script with an
<br>
answer argument.</p>

<p style="margin-top: 1em">For example, placing the
following line in /etc/inittab (and running &quot;kill -1
1&quot;) will make init run the fax script with the argument
answer every time previous process termi&acirc; <br>
nates and init is in runlevel 4 or 5.</p>

<p style="margin-top: 1em">s1:45:respawn:/bin/sh
/usr/bin/fax answer</p>

<p style="margin-top: 1em">For BSD-like systems (e.g.
SunOS), a line such as the following in /etc/ttytab will
have the same effect:</p>

<p style="margin-top: 1em">ttya &quot;/usr/local/bin/fax
answer&quot; unknown on</p>

<p style="margin-top: 1em">You should protect the fax
script and configuration files against tampering since init
will execute them as a privileged (root) process. If you
will be allowing data calls via <br>
getty and login you should ensure that your system is
reasonably secure (e.g. that all user id&rsquo;s have secure
passwords).</p>

<p style="margin-top: 1em">If efax exec()&rsquo;s getty
properly but you get a garbled login prompt then there is
probably a baud rate mismatch between the modem and the
computer. First, check the efax log file <br>
to make sure the modem&rsquo;s CONNECT response reported the
serial port speed (e.g. 19200), not the modem-modem speed
(e.g. 14400). Next, check the getty options and/or
configuration <br>
files (e.g. /etc/gettydefs) for that particular baud rate.
Then run getty manually with the same arguments and verify
the port settings using &lsquo;&lsquo;stty
&lt;/dev/XXX&rsquo;&rsquo;. Note that <br>
you&rsquo;ll probably want to enable hardware flow control
for data connections (-h for agetty, CRTSCTS for
getty_ps).</p>

<p style="margin-top: 1em">A few programs won&rsquo;t work
properly when efax is set up to answer calls because they
don&rsquo;t create lock files. You can put the shell script
&lsquo;&lsquo;wrapper&rsquo;&rsquo; below around such
programs <br>
to make them work properly. Change BIN and LOCKF to
suit.</p>

<p style="margin-top: 1em">#!/bin/sh <br>
BIN=/bin/badprogram <br>
LOCKF=/var/spool/uucp/LCK..cua1 <br>
if [ -f $LOCKF ] <br>
then <br>
echo lock file $LOCKF exists <br>
exit 1 <br>
else <br>
printf &quot;%10d0 $$ &gt;$LOCKF <br>
$BIN $* <br>
rm $LOCKF <br>
fi</p>

<p style="margin-top: 1em">DELIVERING RECEIVED FAXES BY
E-MAIL <br>
The &quot;fax answer&quot; script described above can be
configured to e-mail the fax files received by the previous
fax answer process to a &quot;fax manager&quot; who can then
forward the fax to <br>
the correct recipient. The received fax files are send as
MIME attachments, one file per page, using the
&lsquo;&lsquo;base64&rsquo;&rsquo; text encoding and the
&lsquo;&lsquo;image/tiff&rsquo;&rsquo; file format.</p>

<p style="margin-top: 1em">To view the fax images directly
from your e-mail reader you will have to configure it with
an application that can display files of type image/tiff.
Typically this is specified <br>
in a &lsquo;&lsquo;mailcap&rsquo;&rsquo; file. For example,
placing the following line in /etc/mailcap will cause the
fax file attachments to be displayed using the
&lsquo;&lsquo;fax view&rsquo;&rsquo; command.</p>

<p style="margin-top: 1em">image/tiff; fax view %s</p>

<p style="margin-top: 1em">SENDING FAXES USING THE PRINT
SPOOLER <br>
You can configure a &quot;fax&quot; printer into the lpr
print spooler that will fax a document out using efax
instead of printing it. This allows a network server running
efax to send <br>
faxes on behalf of other machines, including non-Unix
clients. In the following steps use the directories
specified in the fax script if they are different than
/usr/bin and <br>
/var/spool/fax (FAXDIR). To set up a fax printer do the
following as root:</p>

<p style="margin-top: 1em">(1) Create a link to the fax
script called &lsquo;&lsquo;faxlpr&rsquo;&rsquo; so the fax
script can determine when it is being invoked from the print
spooler:</p>

<p style="margin-top: 1em">ln -s /usr/bin/fax
/usr/bin/faxlpr</p>

<p style="margin-top: 1em">(2) Edit /etc/printcap and add
an entry such as:</p>


<p style="margin-top: 1em">fax:lp=/dev/null:sd=/var/spool/fax:if=/usr/bin/faxlpr:</p>

<p style="margin-top: 1em">to define a printer called
&quot;fax&quot;. Print files will be spooled to the
/var/spool/fax (sd=) directory and then piped to the
/usr/bin/faxlpr filter (if=). Error messages will <br>
appear on /dev/console.</p>

<p style="margin-top: 1em">(3) Create and/or set the
permissions to allow anyone to read and write in the fax
spool directory. For example:</p>

<p style="margin-top: 1em">mkdir /var/spool/fax <br>
chmod 777 /var/spool/fax</p>

<p style="margin-top: 1em">(4) Create a printer daemon lock
file that is readable by anyone:</p>

<p style="margin-top: 1em">touch /var/spool/fax/lock <br>
chmod 644 /var/spool/fax/lock</p>

<p style="margin-top: 1em">You should now be able to send a
fax using the lpr interface by using a command such as:</p>

<p style="margin-top: 1em">lpr -P fax -J &quot;555
1212&quot; file.ps</p>

<p style="margin-top: 1em">where the -J option is used to
specify the phone number or alias to be dialed.</p>

<p style="margin-top: 1em">Note that if more than one file
is given on the command line they will be concatenated
before being passed to &quot;fax send&quot;. TIFF-G3,
Postscript or PBM files must therefore be sent <br>
one file at a time although TIFF and Postscript files may
contain multiple pages. Only multiple text files can be sent
in one command. Page breaks in text files can be marked <br>
with form-feed characters. Files will be converted and sent
at the default (high) resolution.</p>

<p style="margin-top: 1em">You can use lpq(1) to check the
fax queue, lprm(1) to remove fax jobs and lpc(8) to control
the spooler. In each case use the -Pfax option to specify
the fax &lsquo;&lsquo;printer.&rsquo;&rsquo; A log <br>
file will be mailed to the user when the fax is sent.</p>

<p style="margin-top: 1em">You should also be able to send
a fax from any networked computer that has lpr-compatible
remote printing software and that allows you to set the job
name (-J option) to an arbi&acirc; <br>
trary string. Such software is available for most
computers.</p>

<p style="margin-top: 1em">See the lpd(8) and printcap(5)
man pages for information on the print spooler and for
restricting access by host name (/etc/host.lpd) or by user
group (the &lsquo;rg&rsquo; printcap entry).</p>

<p style="margin-top: 1em">RESOLVING PROBLEMS <br>
Double check the configuration setup in the first part of
the fax script, particularly the modem device name and the
lock file names.</p>

<p style="margin-top: 1em">If efax hangs when trying to
open the modem device (typically /dev/ttyX), the device is
either already in use by another process (e.g. pppd) or it
requires the carrier detect <br>
line to be true before it can be opened. Many systems define
an alternate device name for the same physical device
(typically cuaX) that can be opened even if carrier is not
<br>
present or other programs are already using it.</p>

<p style="margin-top: 1em">If responses to modem
initialization commands are being lost or generated at
random, another processes (e.g. getty or an efax auto-answer
process) may be trying to use the modem <br>
at the same time. Try running efax while this other program
is running. If efax does not report &quot;/dev/ttyX locked
or busy. waiting.&quot; then the lock files names are not
speci&acirc; <br>
fied correctly.</p>

<p style="margin-top: 1em">Attempt to send a fax. Check
that the modem starts making the calling signal (CNG, a 0.5
second beep every 3 seconds) as soon as it&rsquo;s finished
dialing. This shows the modem is <br>
in fax mode. You may need to set the SPKR variable to -iM2L3
to monitor the phone line to do this.</p>

<p style="margin-top: 1em">Listen for the answering fax
machine and check that it sends the answer signal (CED, a 3
second beep) followed by &quot;warbling&quot; sounds (DIS
frames) every 3 seconds. If you hear a <br>
continuous sound (tones or noise) instead, then you&rsquo;ve
connected to a data modem instead.</p>

<p style="margin-top: 1em">Your modem should send back its
own warble (DCS frame) in response to DIS immediately
followed by 1.5 seconds of noise (a channel check). If
everything is OK, the receiving end <br>
will send another warble (CFR frame) and your modem will
start to send data. If you have an external modem, check its
LEDs. If flow control is working properly the modem&rsquo;s
send <br>
data (SD) LED will turn off periodically while the fax data
is sent.</p>

<p style="margin-top: 1em">Check the message showing the
line count and the average bit rate when the page
transmission is done. Low line counts (under 1000 for a
letter size image) or the warning &quot;fax <br>
output buffer overflow&quot; while sending indicate that the
image data format is incorrect. Check the file being sent
using the &quot;fax view&quot; command.</p>

<p style="margin-top: 1em">If you get the error message
&lsquo;&lsquo;flow control did not work&rsquo;&rsquo; then
flow control was not active. This usually results in a
garbled transmission and the receiving machine may reject
<br>
the page, abort the call, print a distorted or blank image
and/or hang up.</p>

<p style="margin-top: 1em">The warning &quot;characters
received while sending&quot; or an &lt;XOFF&gt; character
appearing after the transmission means that the operating
system ignored the modem&rsquo;s XOFF flow control <br>
character. Ensure that you are not running other programs
such as getty or pppd at the same time as efax since they
will turn off xon/xoff flow control.</p>

<p style="margin-top: 1em">If you cannot get flow control
to work properly then enable &lsquo;&lsquo;virtual flow
control&rsquo;&rsquo; with the -of option or hardware flow
control with the -oh option.</p>

<p style="margin-top: 1em">Check that the remote machine
confirms reception with a +FPTS:1 response (Class 2) or an
MCF frame (Class 1).</p>

<p style="margin-top: 1em">For Class 2 modems, the error
message &quot;abnormal call termination (code nn)&quot;
indicates that the modem detected an error and hung up.</p>

<p style="margin-top: 1em">Many companies advertise
services that will fax back information on their products.
These can be useful for testing fax reception.</p>

<p style="margin-top: 1em">The message &quot;run length
buffer overflow&quot; when receiving indicates an error with
the image data format. You may need to use the -or option
with certain Class 2 modems.</p>

<p style="margin-top: 1em">If efax displays the message
&quot;can&rsquo;t happen (&lt;details&gt;)&quot; please send
a bug report to the author.</p>

<p style="margin-top: 1em">Finally, don&rsquo;t play
&quot;option bingo,&quot; if you can&rsquo;t resolve the
problem send a verbose log of the failed session (the output
from fax -v ...) to the address below.</p>

<p style="margin-top: 1em">WEB PAGE <br>
A Web Page with pointers to the latest version, known bugs
and patches is available at:</p>


<p style="margin-top: 1em">http://casas.ee.ubc.ca/efax/</p>

<p style="margin-top: 1em">RELATED SOFTWARE <br>
For Linux Systems</p>

<p style="margin-top: 1em">Independent packages provide
more user-friendly interfaces to efax (xfax, tefax) and
provide an e-mail-to-fax (Qfax) gateway using efax. All are
available by anonymous FTP from <br>
metalab.unc.edu in /pub/Linux/apps/serialcomm/fax/.</p>

<p style="margin-top: 1em">For Amiga Systems</p>

<p style="margin-top: 1em">A port of an early version of
efax for the Amiga is available as a component of a
shareware voice mail package, AVM, distributed by Al
Villarica (rvillari@cat.syr.edu).</p>

<p style="margin-top: 1em">Other Ports</p>

<p style="margin-top: 1em">efax is relatively easy to port.
All system-dependent code is in efaxos.c. An early version
of efax was ported to VMS. Version 0.8a was ported to Win32
by Luigi Capriotti. <br>
Contact the author if you would like to integrate the Win32
code into the current version.</p>

<p style="margin-top: 1em">AUTHOR <br>
Efax was written by Ed Casas. Please send comments or bug
reports to edc@cce.com.</p>

<p style="margin-top: 1em">BUG REPORTS <br>
Bug reports should include the operating system, the type of
the modem and a copy of a verbose session log that
demonstrates the problem. It&rsquo;s usually impossible to
help without <br>
a verbose log. Please do not send fax image files.</p>

<p style="margin-top: 1em">COPYRIGHT <br>
efax is copyright 1993 -- 1999 Ed Casas. It may be used,
copied and modified under the terms of the GNU Public
License.</p>

<p style="margin-top: 1em">DISCLAIMER <br>
Although efax has been tested it may have errors that will
prevent it from working correctly on your system. Some of
these errors may cause serious problems including loss of
<br>
data and interruptions to telephone service.</p>

<p style="margin-top: 1em">REFERENCES <br>
CCITT Recommendation T.30, &quot;Procedures for Document
Facsimile Transmission in the General Switched Telephone
Network&quot;. 1988</p>

<p style="margin-top: 1em">CCITT Recommendation T.4,
&quot;Standardization of Group 3 Facsimile Apparatus for
Document Transmission&quot;. 1988.</p>

<p style="margin-top: 1em">For documentation on Class 1 and
Class 2 fax commands as implemented by Connexant (formerly
Rockwell) modems see http://www.conexant.com/techinfo.</p>

<p style="margin-top: 1em">For the TIFF specification see
http://partners.adobe.com/supportservice/devrelations/PDFS/TN/TIFF6.pdf
or RFC 2301 (ftp://ftp.isi.edu/in-notes/rfc2301.txt).</p>

<p style="margin-top: 1em">For information on Ghostscript
see http://www.cs.wisc.edu/~ghost/.</p>

<p style="margin-top: 1em">The pbm utilities can be
obtained by ftp from wuarchive.wustl.edu in
/graphics/graphics/packages/NetPBM/netpbm-1mar1994.tar.gz.</p>

<p style="margin-top: 1em">PCX and many other file formats
are described in: Gunter Born, The File Formats Handbook,
International Thomson Computer Press, 1995.</p>

<p style="margin-top: 1em">The &quot;Fax Modem Source
Book&quot; by Andrew Margolis, published by John Wiley &amp;
Sons in 1994 (ISBN 0471950726), is a book on writing fax
applications which includes source code.</p>

<p style="margin-top: 1em">Dennis Bodson et. al.,
&quot;FAX: Digital Facsimile Technology and
Applications&quot;, Second Edition. Artech House, Boston.
1992.</p>

<p style="margin-top: 1em">SEE ALSO <br>
fax(1), efix(1), gs(1), init(8), inittab(5), ttytab(5),
printcap(5), lpd(8), printf(3), strftime(3).</p>

<p style="margin-top: 1em">BUGS <br>
Can&rsquo;t read TIFF files with more than 1 strip</p>

<p style="margin-top: 1em">Class 1 operation may fail if
the program can&rsquo;t respond to certain data received
from the modem within 55 milliseconds.</p>

<p style="margin-top: 1em">May fail if multitasking delays
cause the received data to overflow the computer&rsquo;s
serial device buffer or if an under-run of transmit data
exceeds 5 seconds.</p>

<p style="margin-top: 1em">Polling does not work.</p>

<p style="margin-top: 1em">Does not support 2-D coding,
ECM, or BFT.</p>

<p style="margin-top: 1em">3rd Berkeley Distribution August
2007 EFAX(1)</p>
<hr>
</body>
</html>
