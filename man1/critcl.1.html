<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:00:58 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>critcl(1) C Runtime In Tcl (CriTcl) critcl(1)</p>


<p style="margin-top: 1em">_________________________________________________________________________________________________________________________________________________________________________________________</p>

<p style="margin-top: 1em">NAME <br>
critcl - CriTcl Application</p>

<p style="margin-top: 1em">SYNOPSIS <br>
critcl ?option...? ?file...?</p>


<p style="margin-top: 1em">_________________________________________________________________________________________________________________________________________________________________________________________</p>

<p style="margin-top: 1em">DESCRIPTION <br>
Welcome to the C Runtime In Tcl, CriTcl for short, a system
to build C extension packages for Tcl on the fly, from C
code embedded within Tcl scripts, for all who wish to make
<br>
their code go faster.</p>

<p style="margin-top: 1em">This document is the reference
manpage for the critcl command. Its intended audience are
people having to build packages using critcl for deployment.
Writers of packages with <br>
embedded C code can ignore this document. If you are in need
of an overview of the whole system instead, please go and
read the Introduction To CriTcl.</p>

<p style="margin-top: 1em">This application resides in the
Application Layer of CriTcl.</p>

<p style="margin-top: 1em">*================* <br>
|Applications | <br>
| critcl | <br>
| critcl::app | <br>
*================*</p>

<p style="margin-top: 1em">+----------------+ <br>
|Core Packages | <br>
| critcl | <br>
| critcl::util | <br>
+----------------+</p>

<p style="margin-top: 1em">+----------------+ <br>
|Support Packages| <br>
| stubs::* | <br>
| md5, platform | <br>
| ... | <br>
+----------------+</p>

<p style="margin-top: 1em">. The application supports the
following general command line:</p>

<p style="margin-top: 1em">critcl ?option...? ?file...?
<br>
The exact set of options supported, their meaning, and
interaction is detailed in section Application Options
below. For a larger set of examples please see section <br>
&quot;Building Critcl Packages&quot; in the document about
Using CriTcl.</p>

<p style="margin-top: 1em">APPLICATION OPTIONS <br>
The following options are understood</p>

<p style="margin-top: 1em">-v</p>

<p style="margin-top: 1em">--version <br>
These options cause critcl to print its version to stdout
and then exit.</p>

<p style="margin-top: 1em">-I path <br>
This option specifies an additional global include path to
use during compilation of &quot;.critcl&quot; files. All
values are used if this is specified multiple times.</p>

<p style="margin-top: 1em">This option is irrelevant when
generating a TEA package (see option -tea below).</p>

<p style="margin-top: 1em">-L path <br>
This option specifies an additional global library searh
path to use during linking of &quot;.critcl&quot; files. All
values are used if this is specified multiple times.</p>

<p style="margin-top: 1em">This option is irrelevant when
generating a TEA package (see option -tea below).</p>

<p style="margin-top: 1em">-cache path <br>
This option specifies the path to the directory to use as
the result cache. If not specified it defaults to
&quot;~/.critcl/&lt;platform&gt;&quot;, or, when generating
a package (see <br>
option -pkg below), to
&quot;~/.critcl/&lt;pid&gt;.&lt;epoch&gt;&quot;, When
specified multiple times the last value is used.</p>

<p style="margin-top: 1em">This option is irrelevant when
generating a TEA package (see option -tea below).</p>

<p style="margin-top: 1em">-clean When specified the result
cache is emptied, i.e. all files and directories found
inside are deleted) before compilation begins.</p>

<p style="margin-top: 1em">This option is irrelevant when
generating a package (see option -pkg below) because this
mode starts out with a unique and empty result cache.</p>

<p style="margin-top: 1em">This option is irrelevant when
generating a TEA package (see option -tea below).</p>

<p style="margin-top: 1em">-config path <br>
This option specifies the path to a custom configuration
file, allowing the user to use their own target
specifications. If not specified a hardwired default
configuration <br>
embedded in the system core is used instead. When specified
multiple times the last value is used.</p>

<p style="margin-top: 1em">This option is irrelevant when
generating a TEA package (see option -tea below).</p>

<p style="margin-top: 1em">-debug mode <br>
This option activates compilation with debugging. It accepts
the modes below. When specified multiple times the
combination of all modes is used.</p>

<p style="margin-top: 1em">This option is irrelevant when
generating a TEA package (see option -tea below).</p>

<p style="margin-top: 1em">memory This mode activates
memory debugging of allocations made through the Tcl
core.</p>

<p style="margin-top: 1em">symbols <br>
This mode activates building of all &quot;.c&quot; files
with debugging symbols.</p>

<p style="margin-top: 1em">all This mode activates both
memory and symbols.</p>

<p style="margin-top: 1em">-disable name <br>
This option sets the value of the custom build configuration
option name to false. It is equivalent to &quot;-with-name
0&quot;.</p>

<p style="margin-top: 1em">The information is validated
only if one of the &quot;.critcl&quot; input files actually
defines and uses a custom build configuration option with
that name.</p>

<p style="margin-top: 1em">This option is irrelevant when
generating a TEA package (see option -tea below).</p>

<p style="margin-top: 1em">-enable name <br>
This option sets the value of the custom build configuration
option name to true. It is equivalent to &quot;-with-name
1&quot;.</p>

<p style="margin-top: 1em">The information is validated
only if one of the &quot;.critcl&quot; input files actually
defines and uses a custom build configuration option with
that name.</p>

<p style="margin-top: 1em">This option is irrelevant when
generating a TEA package (see option -tea below).</p>

<p style="margin-top: 1em">-force When specified
compilation is always done, even if a shared library for the
file exists already. This effect can be had through cleaning
the cache (see above) as well, <br>
except that it is lazy in the destruction of files and will
not destroy files unrelated to the ones we are building.</p>

<p style="margin-top: 1em">This option is irrelevant when
generating a package (see option -pkg below) because this
mode starts out with a unique and empty result cache.</p>

<p style="margin-top: 1em">This option is irrelevant when
generating a TEA package (see option -tea below).</p>

<p style="margin-top: 1em">-help This option will cause the
system to print a short help about command line syntax and
options and then exit the application.</p>

<p style="margin-top: 1em">-keep This option will cause the
system to keep the &quot;.c&quot; files generated by a run
in the result cache. When generating a package (see option
-pkg below) this also prevents the <br>
deletion of the unique result cache used by the run. This
option is intended for the debugging of critcl itself, where
it may be necessary to inspect the generated C <br>
code.</p>

<p style="margin-top: 1em">This option is irrelevant when
generating a TEA package (see option -tea below).</p>

<p style="margin-top: 1em">-libdir path <br>
This option specifies the path under which the packages
generated via option -pkg are saved. It also specifies a
path to search libraries in, like for -L. When specified
<br>
multiple times the last value is used. When not specified at
all the default, &quot;lib&quot;, is used. Note how this is
a relative path, placing the result into the current
work&acirc; <br>
ing directory.</p>

<p style="margin-top: 1em">-includedir path <br>
This option specifies the path under which any generated
package headers are saved. It also specifies a path to
search include files in, like for -I. When specified
mul&acirc; <br>
tiple times the last value is used as destination, however
all previous values are kept on the include search path.
When not specified at all the default, &quot;include&quot;,
is <br>
used. Note how this is a relative path, placing the result
into the current working directory.</p>

<p style="margin-top: 1em">This option is irrelevant when
generating a TEA package (see option -tea below).</p>

<p style="margin-top: 1em">-pkg The default mode of the
application is to build the &quot;.critcl&quot; files listed
on the command line and save the results in the result
cache. Essentially pre-filling the cache <br>
with important packages, cutting down on the time needed to
use these packages.</p>

<p style="margin-top: 1em">This option activates one of the
other modes, package generation. In this mode the input
files are processed first as usual, however after that they
are bundled into a <br>
single library and additional files are generated to make
this library usable as a regular Tcl package.</p>

<p style="margin-top: 1em">The option -tea, see below,
invokes the last mode, TEA generation. If both options, i.e.
-pkg and -tea are specified the last one specified wins.</p>

<p style="margin-top: 1em">In this mode the options -clean
and -force are irrelevant and ignored. In contrast, the
option -libdir is relevant in both this and -tea mode.</p>

<p style="margin-top: 1em">When this option is specified
the basename of the first file argument after the options is
used as the name of the package to generate. If the
extension of that file indi&acirc; <br>
cates a shared library (&quot;.so&quot;, &quot;.sl&quot;,
&quot;.dylib&quot;, and &quot;.dll&quot;) it is also removed
from the set of input files. A &quot;.tcl&quot; file is kept
as part of the input. A single file with&acirc; <br>
out extension is assumed to actually have a &quot;.tcl&quot;
extension. A file without extension, but other input files
following is treated like the name of a shared library <br>
proper, and removed from the set of input files.</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">... -pkg ... foo</p>

<p style="margin-top: 1em">=&gt; Package name is: foo <br>
=&gt; Input file is: foo.tcl</p>

<p style="margin-top: 1em">... -pkg ... foo bar.tcl</p>

<p style="margin-top: 1em">=&gt; Package name is: foo <br>
=&gt; Input file is: bar.tcl</p>

<p style="margin-top: 1em">... -pkg ... foo.tcl</p>

<p style="margin-top: 1em">=&gt; Package name is: foo <br>
=&gt; Input file is: foo.tcl</p>

<p style="margin-top: 1em">... -pkg ... foo.so bar.tcl</p>

<p style="margin-top: 1em">=&gt; Package name is: foo <br>
=&gt; Input file is: bar.tcl</p>

<p style="margin-top: 1em">-show This option, when
specified, will cause the system to print the configuration
of the chosen target to stdout and then exit. The choice of
target can be influenced through <br>
the option -target (see below).</p>

<p style="margin-top: 1em">-showall <br>
This option, when specified, will cause the system to print
the whole chosen configuration file to stdout and then exit.
The choice of configuration file can be influ&acirc; <br>
enced through the option -config (see above).</p>

<p style="margin-top: 1em">-target name <br>
This option overrides the default choice of build target
with the user&rsquo;s choice. When specified multiple times
the last value is used. The named target must exist in the
<br>
chosen configuration file. Use option -targets (see below)
to get a list of the acceptable targets. The choice of
configuration file can be influenced through the option <br>
-config (see above).</p>

<p style="margin-top: 1em">This option is irrelevant when
generating a TEA package (see option -tea below).</p>

<p style="margin-top: 1em">-targets <br>
This option, when specified, will cause the system to print
the list of all known targets from the chosen configuration
file to stdout and then exit. The choice of con&acirc; <br>
figuration file can be influenced through the option -config
(see above).</p>

<p style="margin-top: 1em">-tea Similar to option -pkg,
except that the invoked mode does not generate binaries, but
a directory hierarchy containing the &quot;.critcl&quot;
file, its companion files, and a TEA- <br>
lookalike build system with most of the needed support code
(incliding copies of the critcl packages).</p>

<p style="margin-top: 1em">If both options, i.e. -pkg and
-tea are specified the last one specified wins.</p>

<p style="margin-top: 1em">In this mode the options -I, -L,
-clean, -force, -cache, -includedir, -enable, -disable, and
-with-FOO are irrelevant and ignored. In contrast, the
option -libdir is rele&acirc; <br>
vant in both this and -pkg mode.</p>

<p style="margin-top: 1em">When this option is specified
the basename of the first file argument after the options is
used as the name of the package to generate. If the
extension of that file indi&acirc; <br>
cates a shared library (&quot;.so&quot;, &quot;.sl&quot;,
&quot;.dylib&quot;, and &quot;.dll&quot;) it is also removed
from the set of input files. A &quot;.tcl&quot; file is kept
as part of the input. A single file with&acirc; <br>
out extension is assumed to actually have a &quot;.tcl&quot;
extension. A file without extension, but other input files
following is treated like the name of a shared library <br>
proper, and removed from the set of input files.</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">... -tea ... foo</p>

<p style="margin-top: 1em">=&gt; Package name is: foo <br>
=&gt; Input file is: foo.tcl</p>

<p style="margin-top: 1em">... -tea ... foo bar.tcl</p>

<p style="margin-top: 1em">=&gt; Package name is: foo <br>
=&gt; Input file is: bar.tcl</p>

<p style="margin-top: 1em">... -tea ... foo.tcl</p>

<p style="margin-top: 1em">=&gt; Package name is: foo <br>
=&gt; Input file is: foo.tcl</p>

<p style="margin-top: 1em">... -tea ... foo.so bar.tcl</p>

<p style="margin-top: 1em">=&gt; Package name is: foo <br>
=&gt; Input file is: bar.tcl</p>

<p style="margin-top: 1em">-with-name value <br>
This option sets the value of the custom build configuration
option name to value.</p>

<p style="margin-top: 1em">The information is validated
only if one of the &quot;.critcl&quot; input files actually
defines and uses a custom build configuration option with
that name.</p>

<p style="margin-top: 1em">This option is irrelevant when
generating a TEA package (see option -tea above).</p>

<p style="margin-top: 1em">PACKAGE STRUCTURE <br>
Packages generated by critcl have the following basic
structure:</p>

<p style="margin-top: 1em">&lt;TOP&gt; <br>
+- pkgIndex.tcl <br>
+- critcl-rt.tcl <br>
+- license.terms (optional) <br>
| <br>
+- tcl (optional) <br>
| +- &lt;tsources files&gt; <br>
| <br>
+- &lt;platform&gt; <br>
+- &lt;shared library&gt;</p>

<p style="margin-top: 1em">Notes</p>

<p style="margin-top: 1em">[1] The file
&quot;pkgIndex.tcl&quot; is the standard package index file
expected by Tcl&rsquo;s package management. It is sourced
during a search for packages, and declares the package to
<br>
Tcl with its files, and how to handle them.</p>

<p style="margin-top: 1em">[2] The file
&quot;critcl-rt.tcl&quot; is a helper file containing the
common code used by &quot;pkgIndex.tcl&quot; to perform its
tasks.</p>

<p style="margin-top: 1em">[3] The file
&quot;license.terms&quot; is optional and appears only if
the &quot;.critcl&quot; file the package is generated from
used the command critcl::license to declare package author
and <br>
license.</p>

<p style="margin-top: 1em">[4] All files declared with the
command critcl::tsources are put into the sub-directory
&quot;tcl&quot;.</p>

<p style="margin-top: 1em">[5] The shared library generated
by critcl is put into a platform-specific sub-directory.</p>

<p style="margin-top: 1em">The whole structure, and
especially the last point, enable us to later merge the
results (for the same package, and version) for multiple
target platforms into a single directory <br>
structure without conflict, by simply copying the top
directories over each other. The only files which can
conflict are in the &lt;TOP&gt; and &quot;tcl&quot;
directories, and for these we know <br>
that they are identical across targets. The result of such a
merge would look like:</p>

<p style="margin-top: 1em">&lt;TOP&gt; <br>
+- pkgIndex.tcl <br>
+- critcl-rt.tcl <br>
+- license.terms (optional) <br>
| <br>
+- tcl (optional) <br>
| +- &lt;tsources files&gt; <br>
| <br>
+- &lt;platform1&gt; <br>
| +- &lt;shared library1&gt; <br>
+- &lt;platform2&gt; <br>
| +- &lt;shared library2&gt; <br>
... <br>
+- &lt;platformN&gt; <br>
+- &lt;shared libraryN&gt;</p>

<p style="margin-top: 1em">CHANGES FOR VERSION 2.1 <br>
[1] Fixed bug where critcl::tsources interpreted relative
paths as relative to the current working directory instead
of relative to the &quot;.critcl&quot; file using the
command, as <br>
all other commands of this type do.</p>

<p style="margin-top: 1em">[2] Fixed internals, preventing
information collected for multiple &quot;.critcl&quot; files
to leak between them. Notably, critcl::tk is not a global
configuration option anymore.</p>

<p style="margin-top: 1em">[3] Fixed the command
critcl::license to be a null-operation in mode &quot;compile
&amp; run&quot;, instead of throwing an error.</p>

<p style="margin-top: 1em">[4] Fixed the critcl
application&rsquo;s interference with the &quot;compile
&amp; run&quot; result cache in -pkg mode by having it use a
wholly separate (and by default transient) directory for
<br>
that mode.</p>

<p style="margin-top: 1em">[5] Fixed bug where changes to a
&quot;.critcl&quot; file did not result in a rebuild for
mode &quot;compile &amp; run&quot;. All relevant API
commands now ensure UUID changes.</p>

<p style="margin-top: 1em">[6] Fixed bug in the backend
handling of critcl::debug where the companion c-sources of a
&quot;.critcl&quot; file were not compiled with debug
options, although the &quot;.critcl&quot; file was.</p>

<p style="margin-top: 1em">[7] Fixed bug in critcl::debug
which prevented recognition of mode &quot;all&quot; when it
was not the first argument to the command.</p>

<p style="margin-top: 1em">[8] Fixed bug in
&quot;preload.c&quot; preventing its compilation on
non-windows platforms.</p>

<p style="margin-top: 1em">[9] Fixed long-standing bug in
the handling of namespace qualifiers in the command name
argument of critcl::cproc and critcl::ccommand. It is now
possible to specify a fully <br>
qualified command name without issues.</p>

<p style="margin-top: 1em">[10] Extended/reworked
critcl::tsources to be the canonical way of declaring
&quot;.tcl&quot; companion files even for mode &quot;compile
&amp; run&quot;.</p>

<p style="margin-top: 1em">[11] Extended/reworked
critcl::tsources to allow the use of a &quot;.critcl&quot;
file as its own Tcl companion file.</p>

<p style="margin-top: 1em">[12] Extended critcl::framework
to internally check for OS X build target, and to ignore the
declaration if its not.</p>

<p style="margin-top: 1em">[13] Extended critcl::failed to
be callable more than once in a &quot;.critcl&quot; file.
The first call forces the build, if it was not done already,
to get the result. Further calls <br>
return the cached result of the first call.</p>

<p style="margin-top: 1em">[14] Extended the handling of
environment variable CC in the code determining the compiler
to use to deal with (i.e. remove) paths to the compiler,
compiler file extensions, <br>
and compiler options specified after the compiler itself,
leaving only the bare name of the compiler.</p>

<p style="margin-top: 1em">[15] Extended the code handling
the search for preloaded libraries to print the paths it
searched, making debugging of a search failure easier.</p>

<p style="margin-top: 1em">[16] A new command critcl::tcl
can be used to declare the version of Tcl minimally needed
to build and run the &quot;.critcl&quot; file and package.
Defaults to 8.4 if not declared. <br>
Extended critcl to have the stubs and headers for all of Tcl
8.4, 8.5, and 8.6.</p>

<p style="margin-top: 1em">[17] A new command critcl::load
forces the build and load of a &quot;.critcl&quot; file.
This is the official way for overriding critcl&rsquo;s
default lazy-build-&amp;-load-on-demand scheme for <br>
mode &quot;compile &amp; run&quot;.</p>

<p style="margin-top: 1em">Note that after using
critcl::load / critcl::failed in a &quot;.critcl&quot; file
it is not possible to use critcl commands in that file
anymore. Doing so will throw an error.</p>

<p style="margin-top: 1em">[18] Extended the generation of
&rsquo;#line&rsquo; pragmas to use info frame (if available)
to provide the C compiler with exact line numbers into the
&quot;.critcl&quot; file for the reporting of <br>
warnings and errors.</p>

<p style="margin-top: 1em">[19] Extended critcl::check with
logging to help with debugging build-time checks of the
environment, plus an additional optional argument to provide
labeling.</p>

<p style="margin-top: 1em">[20] Added a new command
critcl::checklink which not only tries to check the
environment via compiling the code, but also its
linkability.</p>

<p style="margin-top: 1em">[21] Added a new command
critcl::msg for messaging, like command critcl::error is for
error reporting. Likewise this is a hook a user of the
package is allowed to override. The <br>
default implementation, used by mode compile &amp; run does
nothing. The implementation for mode generate package prints
the message to stdout.</p>

<p style="margin-top: 1em">Envisioned use is for the
reporting of results determined by critcl::check and
critcl::checklink during building, to help with debugging
when something goes wrong with a <br>
check.</p>

<p style="margin-top: 1em">[22] Exposed the argument
processing internals of critcl::proc for use by advanced
users. The new commands are</p>

<p style="margin-top: 1em">[1] critcl::argnames</p>

<p style="margin-top: 1em">[2] critcl::argcnames</p>

<p style="margin-top: 1em">[3] critcl::argcsignature</p>

<p style="margin-top: 1em">[4] critcl::argvardecls</p>

<p style="margin-top: 1em">[5] critcl::argconversion</p>

<p style="margin-top: 1em">Please see section Advanced
Embedded C Code of the critcl package documentation for
details.</p>

<p style="margin-top: 1em">[23] Extended the critcl package
to intercept package provide and record the file -&gt;
package name mapping. Plus other internal changes now allow
the use of namespaced package <br>
names while still using proper path names and init
function.</p>

<p style="margin-top: 1em">[24] Dropped the unused commands
critcl::optimize and critcl::include.</p>

<p style="margin-top: 1em">[25] Dropped -lib mode from the
critcl application.</p>

<p style="margin-top: 1em">[26] Dropped remnants of support
for Tcl 8.3 and before.</p>

<p style="margin-top: 1em">CHANGES FOR VERSION 3 <br>
[1] The command critcl::platform was deprecated in version
2.1, superceded by critcl::targetplatform, yet kept for
compatibility. Now it has been removed.</p>

<p style="margin-top: 1em">[2] The command critcl::compiled
was kept with in version 2.1 with semantics in contradiction
to its, for compatibility. This contradiction has been
removed, changing the vis&acirc; <br>
ible semantics of the command to be in line with its
name.</p>

<p style="margin-top: 1em">[3] The change to version 3
became necessary because of the two incompatible visible
changes above.</p>

<p style="margin-top: 1em">[4] Extended the application
package with code handling a new option -tea. Specifying
this option invokes a special mode where critcl generates a
TEA package, i.e. wraps the <br>
input into a directory hierarchy and support files which
provide it TEA-lookalike buildsystem.</p>

<p style="margin-top: 1em">This new option, and -pkg,
exclude each other. If both are specified the last used
option takes precedence.</p>

<p style="margin-top: 1em">The generated package directory
hierarchy is mostly self-contained, but not fully. It
requires not only a working installation of Tcl, but also
working installations of <br>
the packages md5 and cmdline. Both of these are provided by
the Tcllib bundle. Not required, but recommended to have
installed are any of the packages which can accelerate <br>
md5&rsquo;s operation, i.e. cryptkit, tcllibc, or Trf.</p>

<p style="margin-top: 1em">[5] Extended the critcl package
with a new command critcl::scan taking the path to a
&quot;.critcl&quot; file, statically scanning it, and
returning license, version, a list of its com&acirc; <br>
panion files, list of imported APIs, and list of
developer-specified custom configuration options. This data
is the foundation for the TEA wrapping described above.</p>

<p style="margin-top: 1em">Note that this is a static scan.
While the other build modes can (must) execute the
&quot;.critcl&quot; file and make platform-specific
decisions regarding the assembled C code, <br>
companion files, etc. the TEA wrap mode is not in a position
to make platform-specific decisions. It has to wrap
everything which might conceivably be needed when actually
<br>
building. Hence the static scan. This has however its own
set of problems, namely the inability to figure out any
dynamic construction of companion file paths, at least <br>
on its own. Thus:</p>

<p style="margin-top: 1em">[6] Extended the API used by
critcl-based packages with the command critcl::owns. While
this command is ignored by the regular build modes the
static scanner described above <br>
takes its arguments as the names of companion files which
have to be wrapped into the TEA package and could not be
figured by the scanner otherwise, like because of <br>
dynamic paths to critcl::tsources, critcl::csources, getting
sourced directly, or simply being adjunct datafiles.</p>

<p style="margin-top: 1em">[7] Extended the API used by
critcl-based packages with the command critcl::api for the
management of stubs tables, be it their use, and/or
declaration and export.</p>

<p style="margin-top: 1em">Please see section Stubs Table
Management of the critcl package documentation for
details.</p>

<p style="margin-top: 1em">[8] Extended the API used by
critcl-based packages with the command critcl::userconfig
for the management of developer-specified custom
configuration options, be it their use <br>
and/or declaration.</p>

<p style="margin-top: 1em">Please see section Custom Build
Configuration of the critcl package documentation for
details.</p>

<p style="margin-top: 1em">[9] Extended the API used by
critcl-based packages with the commands critcl::description,
critcl::summary, critcl::subject, critcl::meta, and
critcl::buildrequirement for the <br>
declaration of TEApot meta data for/about the package.</p>

<p style="margin-top: 1em">Please see section Package Meta
Data of the critcl package documentation for details.</p>

<p style="margin-top: 1em">CHANGES FOR VERSION 3.0.1 <br>
[1] Bugfixes all around. In detail:</p>

<p style="margin-top: 1em">[2] Fixed recording of Tcl
version requirements. Keep package name and version
together, unbreaking generated meta data and generated
package load command.</p>

<p style="margin-top: 1em">[3] Fixed the build scripts:
When installing, or wrapping for TEA, generate any missing
directories</p>

<p style="margin-top: 1em">[4] Modified the build scripts
to properly exit the application when the window of their
GUI is closed through the (X) button.</p>

<p style="margin-top: 1em">[5] Removed an 8.5-ism (open wb)
which had slipped into the main build script.</p>

<p style="margin-top: 1em">[6] Modified the example build
scripts to separate the output for the different examples
(and packages) by adding empty lines.</p>

<p style="margin-top: 1em">[7] stack::c example bugfix:
Include API declarations for use in the companion files.</p>

<p style="margin-top: 1em">[8] Extended the documentation:
Noted the need for a working installation of a C
compiler.</p>

<p style="margin-top: 1em">[9] Extended the Windows target
definitions and code to handle the manifest files used by
modern MS development environments. Note that this code
handles both possibilities, <br>
environment using manifests, and (old(er)) environments
without.</p>

<p style="margin-top: 1em">[10] Extended the Windows 64bit
target definitions and code to auto-detect the need for the
helper library &quot;bufferoverflowU.lib&quot; and
reconfigure the compile and link commands <br>
appropriately. We assume that the library must be linked
when present. This should be no harm if the library is
present, yet not needed. Just superfluous. We search for
<br>
the library in the paths specified by the environment
variable LIB.</p>

<p style="margin-top: 1em">CHANGES FOR VERSION 3.0.2 <br>
[1] Fixed issue in compile-and-run mode where commands put
into the auto_index are not found by Tcl&rsquo;s [unknown]
command.</p>

<p style="margin-top: 1em">[2] Fixed an array key mismatch
breaking usage of client data and delete function for
procedure. Reported by Jos DeCoster, with patch.</p>

<p style="margin-top: 1em">[3] Implemented a command line
option -L, an equivalent of option -I, just for library
search paths.</p>

<p style="margin-top: 1em">[4] Fixed github issues 5 and 8.
Working around a missing variable ::errorInfo. It should
always be present, however there seem to be revisions of Tcl
around which violate <br>
this assumption.</p>

<p style="margin-top: 1em">CHANGES FOR VERSION 3.0.3 <br>
[1] Fixed github issues 5 and 8, for the example build.tcl
scripts. Working around a missing variable ::errorInfo. It
should always be present, however there seem to be
revi&acirc; <br>
sions of Tcl around which violate this assumption.</p>

<p style="margin-top: 1em">CHANGES FOR VERSION 3.0.4 <br>
[1] Fixed generation of the package&rsquo;s initname when
the incoming code is read from stdin and has no proper
path.</p>

<p style="margin-top: 1em">[2] Fixed github issue 11. Now
using /LIBPATH instead of -L on Windows (libinclude
configuration setting).</p>

<p style="margin-top: 1em">[3] Extended critcl to handle
-l:path format of -l options. GNU ld 2.22+ handles this by
searching for the path as is. Good when specifying static
libraries, as plain -l <br>
looks for shared libraries in preference over static. critcl
handles it now, as older GNU ld&rsquo;s do not understand
it, nor the various vendor-specific linkers.</p>

<p style="margin-top: 1em">[4] Fixed github issue #12.
Critcl now determines the version of MSVC in use and uses it
to switch between various link debug options. Simplified the
handling of bufferover&acirc; <br>
flowU.lib also, making use of the same mechanism and
collapsing the two configurations sections we had back into
one.</p>

<p style="margin-top: 1em">[5] Reworked the insertion of
#line pragmas into the generated C code to avoid limitations
on the line number argument imposed by various compilers,
and be more accurate.</p>

<p style="margin-top: 1em">[6] Modified argument
processing. Option -libdir now also implies -L for its
argument.</p>

<p style="margin-top: 1em">[7] Extended handling of option
-show (critcl::showconfig) to list the path of the
configuration file the data is coming from. Good for
debugging configuration processing.</p>

<p style="margin-top: 1em">[8] Extended the build script
with targets to regenerate the embedded documentation, and
diagrams, and to generate a release.</p>

<p style="margin-top: 1em">CHANGES FOR VERSION 3.0.5 <br>
[1] Fixed bug in the new code for #line pragmas triggered
when specifying C code without leading whitespace.</p>

<p style="margin-top: 1em">[2] Extended the documentation
to have manpages for the license, source retrieval,
installer, and developer&rsquo;s guides.</p>

<p style="margin-top: 1em">CHANGES FOR VERSION 3.0.6 <br>
[1] Fixed github issue 10. The critcl application now
delivers a proper exit code (1) on build failure, instead of
always indicating success (status 0).</p>

<p style="margin-top: 1em">[2] Fixed github issue 13.
Handling of bufferoverflowU.lib for release builds was
inconsistent with handling for debug builds. It is now
identically handled (conditional) by <br>
both cases.</p>

<p style="margin-top: 1em">[3] Documentation cleanup,
mainly in the installation guide, and the README.md shown by
github</p>

<p style="margin-top: 1em">CHANGES FOR VERSION 3.0.7 <br>
[1] Fixed the code generated by critcl::c++command. The
emitted code handed a non-static string table to
Tcl_GetIndexFromObj, in violation of the contract, which
requires the <br>
table to have a fixed address. This was a memory smash
waiting to happen. Thanks to Brian Griffin for alrerting us
to the general problem.</p>

<p style="margin-top: 1em">CHANGES FOR VERSION 3.1 <br>
[1] Added a new higher-level package critcl::iassoc.</p>

<p style="margin-top: 1em">This package simplifies the
creation of code associating data with an interpreter via
Tcl&rsquo;s Tcl_(Get|Set)AssocData() APIs. The user can
concentrate on his data while all <br>
the necessary boilerplate C code to support this is
generated by the package.</p>

<p style="margin-top: 1em">This package uses several of the
new features which were added to the core critcl package,
see below.</p>

<p style="margin-top: 1em">[2] Added the higher-level
package critcl::class.</p>

<p style="margin-top: 1em">This package simplifies the
creation of C level objects with class and instance
commands. The user can write a class definition with class-
and instance-variables and <br>
-methods similar to a TclOO class, with all the necessary
boilerplate C code to support this generated by the
package.</p>

<p style="margin-top: 1em">This package uses several of the
new features which were added to the core critcl package,
see below.</p>

<p style="margin-top: 1em">[3] Extended the API for
handling TEApot metadata. Added the command critcl::meta? to
query the stored information. Main use currently envisioned
is retrieval of the current <br>
package&rsquo;s name by utility commands, for use in
constructed names. This particular information is always
available due to the static scan of the package file on
execution <br>
of the first critcl command.</p>

<p style="margin-top: 1em">The new packages critcl::iassoc
and critcl::class (see above) are users of this command.</p>

<p style="margin-top: 1em">[4] Extended the API with a
command, critcl::name2c, exposing the process of converting
a Tcl name into base name, namespace, and C namespace. This
enables higher-level code <br>
generators to generate the same type of C identifiers as
critcl itself.</p>

<p style="margin-top: 1em">The new package critcl::class
(see above) is a user of this command.</p>

<p style="margin-top: 1em">[5] Extended the API with a
command, critcl::source, executing critcl commands found in
a separate file in the context of the current file. This
enables easier management of <br>
larger bodies of code as it allows the user to split such up
into easier to digest smaller chunks without causing the
generation of multiple packages.</p>

<p style="margin-top: 1em">[6] Related to the previous
item, extended the API with commands to divert collection of
generated C code into memory. This makes it easier to use
the commands for embedded C <br>
code in higher-level code generators.</p>

<p style="margin-top: 1em">See the section Advanced:
Diversions for details of the provided commands.</p>

<p style="margin-top: 1em">The new package critcl::class
(see above) is a user of these facilities.</p>

<p style="margin-top: 1em">[7] Extended the API with
commands helping developers with the generation of proper C
#line directives. This allows higher-level code generators
to generate and insert their <br>
own directives, ensuring that compile errors in their code
are properly attributed.</p>

<p style="margin-top: 1em">See the section Advanced:
Location management for details of the provided
commands.</p>

<p style="margin-top: 1em">The new packages critcl::iassoc
and critcl::class (see above) are users of these
facilities.</p>

<p style="margin-top: 1em">[8] Extended the API with
commands giving users the ability to define custom argument
and result types for ::critcl::cproc.</p>

<p style="margin-top: 1em">See the section Advanced:
Extending cproc for details of the provided commands.</p>

<p style="margin-top: 1em">CHANGES FOR VERSION 3.1.1 <br>
[1] Bugfixes all around. In detail:</p>

<p style="margin-top: 1em">[2] Fixed the generation of
wrong#args errors for critcl::cproc and derived code
(critcl::class cproc-based methods). Use NULL if there are
no arguments, and take the offset <br>
into account.</p>

<p style="margin-top: 1em">[3] Fixed the handling of
package names by critcl::class. Forgot that they may contain
namespace separators. Bumped to version 1.0.1.</p>

<p style="margin-top: 1em">[4] Extended a critcl::class
generated error message in instance creation for clarity.
Bumped to version 1.0.2.</p>

<p style="margin-top: 1em">CHANGES FOR VERSION 3.1.2 <br>
[1] Enhancement. In detail:</p>

<p style="margin-top: 1em">[2] Extended critcl::cproc to be
able to handle optional arguments, in a limited way. This is
automatically available to critcl::class cproc-based methods
as well.</p>

<p style="margin-top: 1em">[3] Bugfix in lassign emulation
for Tcl 8.4. Properly set unused variables to the empty
string. Bumped version of emulation package lassign84 to
1.0.1.</p>

<p style="margin-top: 1em">CHANGES FOR VERSION 3.1.3 <br>
[1] Enhancement. In detail:</p>

<p style="margin-top: 1em">[2] Added new argument type
&quot;pstring&quot;, for &quot;Pascal String&quot;, a
counted string, i.e. a combination of string pointer and
string length.</p>

<p style="margin-top: 1em">[3] Added new methods
critcl::argtypesupport and ::critcl::argsupport to define
and use additional supporting code for an argument type,
here used by &quot;pstring&quot; above to define <br>
the necessary structure.</p>

<p style="margin-top: 1em">[4] Semi-bugfixes in the
packages critcl::class and critcl::iassoc. Pragmas for the
AS meta data scanner to ensure that the template files are
made part of the package. Ver&acirc; <br>
sions bumped to 1.0.4 and 1.0.1 respectively.</p>

<p style="margin-top: 1em">CHANGES FOR VERSION 3.1.4 <br>
[1] Bugfix in package critcl::class. Generate a dummy field
in the class structure if the class has no class variables.
Without this change the structure would be empty, and a <br>
number of compilers are not able to handle such a type.</p>

<p style="margin-top: 1em">[2] Fixed a typo which broke the
win64 configuration.</p>

<p style="margin-top: 1em">[3] Fixed issue #16, a typo in
the documentation of command critcl::class.</p>

<p style="margin-top: 1em">CHANGES FOR VERSION 3.1.5 <br>
[1] Fixed issue #19. Made the regular expression extracting
the MSVC version number more general to make it work on
german language systems. This may have to be revisited in
<br>
the future, for other Windows locales.</p>

<p style="margin-top: 1em">[2] Fixed issue #20. Made option
-tea work on windows, at least in a unix emulation
environment like msys/mingw.</p>

<p style="margin-top: 1em">CHANGES FOR VERSION 3.1.6 <br>
[1] Fixed issue #21. While the multi-definition of the
stub-table pointer variables was ok with for all the C
linkers seen so far C++ linkers did not like this at all.
<br>
Reworked the code to ensure that this set of variables is
generated only once, in the wrapper around all the pieces to
assemble.</p>

<p style="margin-top: 1em">[2] Fixed issue #22, the
handling of the command identifier arguments of
critcl::ccommand, critcl::cproc, and critcl::cdata. We now
properly allow any Tcl identifier and gen&acirc; <br>
erate proper internal C identifiers from them.</p>

<p style="margin-top: 1em">As part of this the signature of
command critcl::name2c changed. The command now delivers a
list of four values instead of three. The new value was
added at the end.</p>

<p style="margin-top: 1em">Further adapted the
implementation of package critcl::class, a user of
critcl::name2c. This package is now at version 1.0.6 and
requires critcl 3.1.6</p>

<p style="margin-top: 1em">Lastly fixed the mis-handling of
option -cname in critcl::ccommand, and critcl::cproc.</p>

<p style="margin-top: 1em">[3] Fixed issue #23.</p>

<p style="margin-top: 1em">CHANGES FOR VERSION 3.1.7 <br>
[1] Fixed issue #24. Extract and unconditionally display
compiler warnings found in the build log. Prevents users
from missing warnings which, while not causing the build to
<br>
fail, may still indicate problems.</p>

<p style="margin-top: 1em">[2] New feature. Output hook.
All non-messaging user output is now routed through the
command critcl::print, and users are allowed to override it
when using the critcl appli&acirc; <br>
cation-as-package.</p>

<p style="margin-top: 1em">[3] New feature, by Ashok P.
Nadkarni. Platform configurations can inherit values from
configurations defined before them.</p>

<p style="margin-top: 1em">CHANGES FOR VERSION 3.1.8 <br>
[1] Fixed issue with package indices generated for Tcl 8.4.
Join the list of commands with semi-colon, not newline.</p>

<p style="margin-top: 1em">[2] Fixed issue #26 which
brought up use-cases I had forgotten to consider while
fixing bug #21 (see critcl 3.1.6).</p>

<p style="margin-top: 1em">CHANGES FOR VERSION 3.1.9 <br>
[1] Fixed issue #27. Added missing platform definitions for
various alternate linux and OS X targets.</p>

<p style="margin-top: 1em">[2] Fixed issue #28. Added
missing -mXX flags for linking at the linux-{32,64}-*
targets.</p>

<p style="margin-top: 1em">[3] Fixed issue #29. Replaced
the use of raw &quot;cheaders&quot; information in the
processing of &quot;cdefines&quot; with the proper include
directives derived from it.</p>

<p style="margin-top: 1em">[4] Fixed the issue behind
rejected pull request #30 by Andrew Shadura. Dynamically
extract the stubs variable declarations from the Tcl header
files and generate matching <br>
variable definitions for use in the package code. The
generated code will now be always consistent with the
headers, even when critcl&rsquo;s own copy of them is
replaced by <br>
system headers.</p>

<p style="margin-top: 1em">[5] Fixed issue #31. Accepted
patch by Andrew Shadura, with changes (comments), for easier
integration of critcl with OS package systems, replacing
critcl&rsquo;s copies of Tcl <br>
headers with their own.</p>

<p style="margin-top: 1em">[6] Fixed issue #32. Merged pull
request by Andrew Shadura. Various typos in documentation
and comments.</p>

<p style="margin-top: 1em">[7] Fixed issue #33. Handle
files starting with a dot better.</p>

<p style="margin-top: 1em">AUTHORS <br>
Jean Claude Wippler, Steve Landers, Andreas Kupries</p>

<p style="margin-top: 1em">BUGS, IDEAS, FEEDBACK <br>
This document, and the package it describes, will
undoubtedly contain bugs and other problems. Please report
them at https://github.com/andreas-kupries/critcl/issues.
Ideas for <br>
enhancements you may have for either package, application,
and/or the documentation are also very welcome and should be
reported at https://github.com/andreas- <br>
kupries/critcl/issues as well.</p>

<p style="margin-top: 1em">KEYWORDS <br>
C code, Embedded C Code, code generator, compile &amp; run,
compiler, dynamic code generation, dynamic compilation,
generate package, linker, on demand compilation, on-the-fly
compi&acirc; <br>
lation</p>

<p style="margin-top: 1em">CATEGORY <br>
Glueing/Embedded C code</p>

<p style="margin-top: 1em">COPYRIGHT <br>
Copyright (c) Jean-Claude Wippler <br>
Copyright (c) Steve Landers <br>
Copyright (c) 2011-2013 Andreas Kupries</p>

<p style="margin-top: 1em">doc 3.1.8 critcl(1)</p>
<hr>
</body>
</html>
