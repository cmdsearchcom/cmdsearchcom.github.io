<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>HAPROXY-LUA(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">HAPROXY-LUA(1)</td>
    <td class="head-vol">haproxy-lua</td>
    <td class="head-rtitle">HAPROXY-LUA(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
haproxy-lua - haproxy-lua Documentation
<h1 class="Sh" title="Sh" id="HAPROXY_LUA_RUNNING_CONTEXTS"><a class="selflink" href="#HAPROXY_LUA_RUNNING_CONTEXTS">HAPROXY
  LUA RUNNING CONTEXTS</a></h1>
The Lua code executed in HAProxy can be processed in 2 main modes. The first one
  is the <b>initialisation mode</b>, and the second is the <b>runtime mode</b>.
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">In the <b>initialisation mode</b>, we can perform DNS
      solves, but we cannot perform socket I/O. In this initialisation mode,
      HAProxy still blocked during the execution of the Lua program.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">In the <b>runtime mode</b>, we cannot perform DNS solves,
      but we can use sockets. The execution of the Lua code is multiplexed with
      the requests processing, so the Lua code seems to be run in blocking, but
      it is not the case.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The Lua code is loaded in one or more files. These files contains main code and
  functions. Lua have 6 execution context.
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">1.</dt>
  <dd class="It-tag">The Lua file <b>body context</b>. It is executed during the
      load of the Lua file in the HAProxy <i>[global]</i> section with the
      directive <i>lua-load</i>. It is executed in initialisation mode. This
      section is use for configuring Lua bindings in HAProxy.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">2.</dt>
  <dd class="It-tag">The Lua <b>init context</b>. It is a Lua function executed
      just after the HAProxy configuration parsing. The execution is in
      initialisation mode. In this context the HAProxy environment are already
      initialized. It is useful to check configuration, or initializing socket
      connections or tasks. These functions are declared in the body context
      with the Lua function <i>core.register_init()</i>. The prototype of the
      function is a simple function without return value and without parameters,
      like this: <i>function fcn()</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">3.</dt>
  <dd class="It-tag">The Lua <b>task context</b>. It is a Lua function executed
      after the start of the HAProxy scheduler, and just after the declaration
      of the task with the Lua function <i>core.register_task()</i>. This
      context can be concurrent with the traffic processing. It is executed in
      runtime mode. The prototype of the function is a simple function without
      return value and without parameters, like this: <i>function
    fcn()</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">4.</dt>
  <dd class="It-tag">The <b>action context</b>. It is a Lua function
      conditionally executed. These actions are registered by the Lua directives
      &quot; <i>core.register_action()</i>&quot;. The prototype of the Lua
      called function is a function with doesn't returns anything and that take
      an object of class TXN as entry. <i>function fcn(txn)</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">5.</dt>
  <dd class="It-tag">The <b>sample-fetch context</b>. This function takes a TXN
      object as entry argument and returns a string. These types of function
      cannot execute any blocking function. They are useful to aggregate some of
      original HAProxy sample-fetches and return the result. The prototype of
      the function is <i>function string fcn(txn)</i>. These functions can be
      registered with the Lua function <i>core.register_fetches()</i>. Each
      declared sample-fetch is prefixed by the string &quot;lua.&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
     <b>NOTE</b>: It is possible that this function cannot found the required
      data in the original HAProxy sample-fetches, in this case, it cannot
      return the result. This case is not yet supported</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">6.</dt>
  <dd class="It-tag">The <b>converter context</b>. It is a Lua function that
      takes a string as input and returns another string as output. These types
      of function are stateless, it cannot access to any context. They don't
      execute any blocking function. The call prototype is <i>function string
      fcn(string)</i>. This function can be registered with the Lua function
      <i>core.register_converters()</i>. Each declared converter is prefixed by
      the string &quot;lua.&quot;.</dd>
</dl>
</div>
<br/>
<h1 class="Sh" title="Sh" id="HAPROXY_LUA_HELLO_WORLD"><a class="selflink" href="#HAPROXY_LUA_HELLO_WORLD">HAPROXY
  LUA HELLO WORLD</a></h1>
HAProxy configuration file ( <i>hello_world.conf</i>):
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
global
   lua-load hello_world.lua
<div class="Pp"></div>
listen proxy
   bind 127.0.0.1:10001
   tcp-request inspect-delay 1s
   tcp-request content use-service lua.hello_world
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
HAProxy Lua file ( <i>hello_world.lua</i>):
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
core.register_service(&quot;hello_world&quot;, &quot;tcp&quot;, function(applet)
   applet:send(&quot;hello world\n&quot;)
end)
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
How to start HAProxy for testing this configuration:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
./haproxy -f hello_world.conf
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
On other terminal, you can test with telnet:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
#:~ telnet 127.0.0.1 10001
hello world
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>class core()</b></dt>
  <dd class="It-tag">The &quot;core&quot; class contains all the HAProxy core
      functions. These function are useful for the controlling the execution
      flow, registering hooks, manipulating global maps or ACL, ...
    <div style="height: 1.00em;">&#x00A0;</div>
    &quot;core&quot; class is basically provided with HAProxy. No <i>require</i>
      line is required to uses these function.
    <div style="height: 1.00em;">&#x00A0;</div>
    The &quot;core&quot; class is static, it is not possible to create a new
      object of this type.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.emerg</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">integer</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute is an integer, it contains the value of the loglevel
  &quot;emergency&quot; (0).</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.alert</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">integer</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute is an integer, it contains the value of the loglevel
  &quot;alert&quot; (1).</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.crit</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">integer</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute is an integer, it contains the value of the loglevel
  &quot;critical&quot; (2).</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.err</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">integer</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute is an integer, it contains the value of the loglevel
  &quot;error&quot; (3).</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.warning</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">integer</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute is an integer, it contains the value of the loglevel
  &quot;warning&quot; (4).</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.notice</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">integer</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute is an integer, it contains the value of the loglevel
  &quot;notice&quot; (5).</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.info</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">integer</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute is an integer, it contains the value of the loglevel
  &quot;info&quot; (6).</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.debug</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">integer</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute is an integer, it contains the value of the loglevel
  &quot;debug&quot; (7).</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.log(loglevel, msg)</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action, sample-fetch,
      converter
    <div style="height: 1.00em;">&#x00A0;</div>
    This function sends a log. The log is sent, according with the HAProxy
      configuration file, on the default syslog server if it is configured and
      on the stderr if it is allowed.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>loglevel</b> (<i>integer</i>) -- Is the log level
      asociated with the message. It is a number between 0 and 7.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>msg</b> (<i>string</i>) -- The log content.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">core.emerg, core.alert, core.crit, core.err, core.warning,
      core.notice, core.info, core.debug (log level definitions)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">code.Debug</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">core.Info</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">core.Warning</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">core.Alert</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.Debug(msg)</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action, sample-fetch,
      converter</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>msg</b> (<i>string</i>) -- The log content.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">log</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Does the same job than:</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
function Debug(msg)
  core.log(core.debug, msg)
end
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.Info(msg)</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action, sample-fetch,
      converter</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>msg</b> (<i>string</i>) -- The log content.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">log</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
function Info(msg)
  core.log(core.info, msg)
end
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.Warning(msg)</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action, sample-fetch,
      converter</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>msg</b> (<i>string</i>) -- The log content.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">log</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
function Warning(msg)
  core.log(core.warning, msg)
end
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.Alert(msg)</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action, sample-fetch,
      converter</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>msg</b> (<i>string</i>) -- The log content.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">log</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
function Alert(msg)
  core.log(core.alert, msg)
end
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.add_acl(filename, key)</b></dt>
  <dd class="It-tag"><b>context</b>: init, task, action, sample-fetch, converter
    <div style="height: 1.00em;">&#x00A0;</div>
    Add the ACL <i>key</i> in the ACLs list referenced by the file
      <i>filename</i>.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>filename</b> (<i>string</i>) -- the filename that
      reference the ACL entries.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>key</b> (<i>string</i>) -- the key which will be
    added.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.del_acl(filename, key)</b></dt>
  <dd class="It-tag"><b>context</b>: init, task, action, sample-fetch, converter
    <div style="height: 1.00em;">&#x00A0;</div>
    Delete the ACL entry referenced by the key <i>key</i> in the list of ACLs
      referenced by <i>filename</i>.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>filename</b> (<i>string</i>) -- the filename that
      reference the ACL entries.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>key</b> (<i>string</i>) -- the key which will be
      deleted.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.del_map(filename, key)</b></dt>
  <dd class="It-tag"><b>context</b>: init, task, action, sample-fetch, converter
    <div style="height: 1.00em;">&#x00A0;</div>
    Delete the map entry indexed with the specified key in the list of maps
      referenced by his filename.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>filename</b> (<i>string</i>) -- the filename that
      reference the map entries.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>key</b> (<i>string</i>) -- the key which will be
      deleted.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.get_info()</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action, sample-fetch,
      converter
    <div style="height: 1.00em;">&#x00A0;</div>
    Returns HAProxy core informations. We can found information like the uptime,
      the pid, memory pool usage, tasks number, ...
    <div style="height: 1.00em;">&#x00A0;</div>
    These information are also returned by the management sockat via the command
      &quot;show info&quot;. See the management socket documentation fpor more
      information about the content of these variables.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">an array of values.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.now()</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action
    <div style="height: 1.00em;">&#x00A0;</div>
    This function returns the current time. The time returned is fixed by the
      HAProxy core and assures than the hour will be monotnic and that the
      system call 'gettimeofday' will not be called too. The time is refreshed
      between each Lua execution or resume, so two consecutive call to the
      function &quot;now&quot; will probably returns the same result.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">an array which contains two entries &quot;sec&quot; and
      &quot;usec&quot;. &quot;sec&quot; contains the current at the epoch
      format, and &quot;usec&quot; contains the current microseconds.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.http_date(date)</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action
    <div style="height: 1.00em;">&#x00A0;</div>
    This function take a string repsenting http date, and returns an integer
      containing the corresponding date with a epoch format. A valid http date
      me respect the format IMF, RFC850 or ASCTIME.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>date</b> (<i>string</i>) -- a date http-date
    formatted</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">integer containing epoch date</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag"><i>core.imf_date()</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag"><i>core.rfc850_date()</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag"><i>core.asctime_date()</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag"><i>https://tools.ietf.org/html/rfc7231#section-7.1.1.1</i></dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.imf_date(date)</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action
    <div style="height: 1.00em;">&#x00A0;</div>
    This function take a string repsenting IMF date, and returns an integer
      containing the corresponding date with a epoch format.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>date</b> (<i>string</i>) -- a date IMF formatted</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">integer containing epoch date</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag"><i>https://tools.ietf.org/html/rfc7231#section-7.1.1.1</i></dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The IMF format is like this:</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
Sun, 06 Nov 1994 08:49:37 GMT
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.rfc850_date(date)</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action
    <div style="height: 1.00em;">&#x00A0;</div>
    This function take a string repsenting RFC850 date, and returns an integer
      containing the corresponding date with a epoch format.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>date</b> (<i>string</i>) -- a date RFC859 formatted</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">integer containing epoch date</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag"><i>https://tools.ietf.org/html/rfc7231#section-7.1.1.1</i></dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The RFC850 format is like this:</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
Sunday, 06-Nov-94 08:49:37 GMT
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.asctime_date(date)</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action
    <div style="height: 1.00em;">&#x00A0;</div>
    This function take a string repsenting ASCTIME date, and returns an integer
      containing the corresponding date with a epoch format.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>date</b> (<i>string</i>) -- a date ASCTIME
    formatted</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">integer containing epoch date</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag"><i>https://tools.ietf.org/html/rfc7231#section-7.1.1.1</i></dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The ASCTIME format is like this:</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
Sun Nov  6 08:49:37 1994
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.rfc850_date(date)</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action
    <div style="height: 1.00em;">&#x00A0;</div>
    This function take a string repsenting http date, and returns an integer
      containing the corresponding date with a epoch format.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>date</b> (<i>string</i>) -- a date http-date
    formatted</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.asctime_date(date)</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action
    <div style="height: 1.00em;">&#x00A0;</div>
    This function take a string repsenting http date, and returns an integer
      containing the corresponding date with a epoch format.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>date</b> (<i>string</i>) -- a date http-date
    formatted</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.msleep(milliseconds)</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action
    <div style="height: 1.00em;">&#x00A0;</div>
    The <i>core.msleep()</i> stops the Lua execution between specified
      milliseconds.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>milliseconds</b> (<i>integer</i>) -- the required
      milliseconds.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.proxies</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action, sample-fetch,
      converter
    <div style="height: 1.00em;">&#x00A0;</div>
    proxies is an array containing the list of all proxies declared in the
      configuration file. Each entry of the proxies array is an object of type
      <i>Proxy class</i></dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.register_action(name, actions, func)</b></dt>
  <dd class="It-tag"><b>context</b>: body
    <div style="height: 1.00em;">&#x00A0;</div>
    Register a Lua function executed as action. All the registered action can be
      used in HAProxy with the prefix &quot;lua.&quot;. An action gets a TXN
      object class as input.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>name</b> (<i>string</i>) -- is the name of the
      converter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>actions</b> (<i>table</i>) -- is a table of string
      describing the HAProxy actions who want to register to. The expected
      actions are 'tcp-req', 'tcp-res', 'http-req' or 'http-res'.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>func</b> (<i>function</i>) -- is the Lua function called
      to work as converter.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The prototype of the Lua function used as argument is:</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
function(txn)
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 2.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>txn</b> (<i>TXN class</i>): this is a TXN object used
    for manipulating the</dt>
  <dd class="It-tag">current request or TCP stream.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Here, an exemple of action registration. the action juste send an 'Hello world'
  in the logs.</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
core.register_action(&quot;hello-world&quot;, { &quot;tcp-req&quot;, &quot;http-req&quot; }, function(txn)
   txn:Info(&quot;Hello world&quot;)
end)
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">This example code is used in HAproxy
  configuration like this:</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
frontend tcp_frt
  mode tcp
  tcp-request content lua.hello-world
<div class="Pp"></div>
frontend http_frt
  mode http
  http-request lua.hello-world
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.register_converters(name, func)</b></dt>
  <dd class="It-tag"><b>context</b>: body
    <div style="height: 1.00em;">&#x00A0;</div>
    Register a Lua function executed as converter. All the registered converters
      can be used in HAProxy with the prefix &quot;lua.&quot;. An converter get
      a string as input and return a string as output. The registered function
      can take up to 9 values as parameter. All the value are strings.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>name</b> (<i>string</i>) -- is the name of the
      converter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>func</b> (<i>function</i>) -- is the Lua function called
      to work as converter.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The prototype of the Lua function used as argument is:</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
function(str, [p1 [, p2 [, ... [, p5]]]])
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>str</b> (<i>string</i>): this is the input value
      automatically converted in string.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>p1</b> .. <b>p5</b> (<i>string</i>): this is a list of
      string arguments declared in the haroxy configuration file. The number of
      arguments doesn't exceed 5. The order and the nature of these is
      conventionally choose by the developper.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.register_fetches(name, func)</b></dt>
  <dd class="It-tag"><b>context</b>: body
    <div style="height: 1.00em;">&#x00A0;</div>
    Register a Lua function executed as sample fetch. All the registered sample
      fetchs can be used in HAProxy with the prefix &quot;lua.&quot;. A Lua
      sample fetch return a string as output. The registered function can take
      up to 9 values as parameter. All the value are strings.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>name</b> (<i>string</i>) -- is the name of the
      converter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>func</b> (<i>function</i>) -- is the Lua function called
      to work as sample fetch.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The prototype of the Lua function used as argument is:</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
string function(txn, [p1 [, p2 [, ... [, p5]]]])
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>txn</b> (<i>TXN class</i>): this is the txn object
      associated with the current request.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>p1</b> .. <b>p5</b> (<i>string</i>): this is a list of
      string arguments declared in the haroxy configuration file. The number of
      arguments doesn't exceed 5. The order and the nature of these is
      conventionally choose by the developper.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>Returns</b>: A string containing some data, ot nil if
      the value cannot be returned now.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
lua example code:</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
core.register_fetches(&quot;hello&quot;, function(txn)
    return &quot;hello&quot;
end)
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">HAProxy example configuration:</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
frontend example
   http-request redirect location /%[lua.hello]
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.register_service(name, mode, func)</b></dt>
  <dd class="It-tag"><b>context</b>: body
    <div style="height: 1.00em;">&#x00A0;</div>
    Register a Lua function executed as a service. All the registered service
      can be used in HAProxy with the prefix &quot;lua.&quot;. A service gets an
      object class as input according with the required mode.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>name</b> (<i>string</i>) -- is the name of the
      converter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>mode</b> (<i>string</i>) -- is string describing the
      required mode. Only 'tcp' or 'http' are allowed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>func</b> (<i>function</i>) -- is the Lua function called
      to work as converter.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The prototype of the Lua function used as argument is:</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
function(applet)
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>applet</b> <i>applet</i> will be a <i>AppletTCP
      class</i> or a <i>AppletHTTP class</i>. It depends the type of registered
      applet. An applet registered with the 'http' value for the <i>mode</i>
      parameter will gets a <i>AppletHTTP class</i>. If the <i>mode</i> value is
      'tcp', the applet will gets a <i>AppletTCP class</i>.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>warning</b>: Applets of type 'http' cannot be called from 'tcp-<i>'</i>
  <i>rulesets. Only the 'http-</i>' rulesets are authorized, this means that is
  not possible to call an HTTP applet from a proxy in tcp mode. Applets of type
  'tcp' can be called from anywhre.
<div style="height: 1.00em;">&#x00A0;</div>
Here, an exemple of service registration. the service just send an 'Hello world'
  as an http response.</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
core.register_service(&quot;hello-world&quot;, &quot;http&quot;, function(applet)
   local response = &quot;Hello World !&quot;
   applet:set_status(200)
   applet:add_header(&quot;content-length&quot;, string.len(response))
   applet:add_header(&quot;content-type&quot;, &quot;text/plain&quot;)
   applet:start_response()
   applet:send(response)
end)
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">This example code is used in HAproxy
  configuration like this:</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
frontend example
   http-request use-service lua.hello-world
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.register_init(func)</b></dt>
  <dd class="It-tag"><b>context</b>: body
    <div style="height: 1.00em;">&#x00A0;</div>
    Register a function executed after the configuration parsing. This is useful
      to check any parameters.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>func</b> (<i>function</i>) -- is the Lua function called
      to work as initializer.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The prototype of the Lua function used as argument is:</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
function()
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">It takes no input, and no output is
  expected.</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.register_task(func)</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action, sample-fetch,
      converter
    <div style="height: 1.00em;">&#x00A0;</div>
    Register and start independent task. The task is started when the HAProxy
      main scheduler starts. For example this type of tasks can be executed to
      perform complex health checks.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>func</b> (<i>function</i>) -- is the Lua function called
      to work as initializer.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The prototype of the Lua function used as argument is:</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
function()
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">It takes no input, and no output is
  expected.</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.register_cli([path], usage, func)</b></dt>
  <dd class="It-tag"><b>context</b>: body
    <div style="height: 1.00em;">&#x00A0;</div>
    Register and start independent task. The task is started when the HAProxy
      main scheduler starts. For example this type of tasks can be executed to
      perform complex health checks.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>path</b> (<i>array</i>) -- is the sequence of word for
      which the cli execute the Lua binding.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>usage</b> (<i>string</i>) -- is the usage message
      displayed in the help.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>func</b> (<i>function</i>) -- is the Lua function called
      to handle the CLI commands.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The prototype of the Lua function used as argument is:</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
function(AppletTCP, [arg1, [arg2, [...]]])
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">I/O are managed with the <i>AppletTCP
  class</i> object. Args are given as paramter. The args embbed the registred
  path. If the path is declared like this:</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
core.register_cli({&quot;show&quot;, &quot;ssl&quot;, &quot;stats&quot;}, &quot;Display SSL stats..&quot;, function(applet, arg1, arg2, arg3, arg4, arg5)
     end)
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">And we execute this in the prompt:</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
&gt; prompt
&gt; show ssl stats all
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">Then, arg1, arg2 and arg3 will contains
  respectivey &quot;show&quot;, &quot;ssl&quot; and &quot;stats&quot;. arg4 will
  contain &quot;all&quot;. arg5 contains nil.</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.set_nice(nice)</b></dt>
  <dd class="It-tag"><b>context</b>: task, action, sample-fetch, converter
    <div style="height: 1.00em;">&#x00A0;</div>
    Change the nice of the current task or current session.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>nice</b> (<i>integer</i>) -- the nice value, it must be
      between -1024 and 1024.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.set_map(filename, key, value)</b></dt>
  <dd class="It-tag"><b>context</b>: init, task, action, sample-fetch, converter
    <div style="height: 1.00em;">&#x00A0;</div>
    set the value <i>value</i> associated to the key <i>key</i> in the map
      referenced by <i>filename</i>.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>filename</b> (<i>string</i>) -- the Map reference</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>key</b> (<i>string</i>) -- the key to set or
    replace</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>value</b> (<i>string</i>) -- the associated value</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.sleep(int seconds)</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action
    <div style="height: 1.00em;">&#x00A0;</div>
    The <i>core.sleep()</i> functions stop the Lua execution between specified
      seconds.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>seconds</b> (<i>integer</i>) -- the required
    seconds.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.tcp()</b></dt>
  <dd class="It-tag"><b>context</b>: init, task, action
    <div style="height: 1.00em;">&#x00A0;</div>
    This function returns a new object of a <i>socket</i> class.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">A <i>Socket class</i> object.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.concat()</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action, sample-fetch,
      converter
    <div style="height: 1.00em;">&#x00A0;</div>
    This function retruns a new concat object.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">A <i>Concat class</i> object.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.done(data)</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action, sample-fetch,
      converter</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>data</b> (<i>any</i>) -- Return some data for the
      caller. It is useful with sample-fetches and sample-converters.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Immediately stops the current Lua execution and returns to the caller which may
  be a sample fetch, a converter or an action and returns the specified value
  (ignored for actions). It is used when the LUA process finishes its work and
  wants to give back the control to HAProxy without executing the remaining
  code. It can be seen as a multi-level &quot;return&quot;.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.yield()</b></dt>
  <dd class="It-tag"><b>context</b>: task, action, sample-fetch, converter
    <div style="height: 1.00em;">&#x00A0;</div>
    Give back the hand at the HAProxy scheduler. It is used when the LUA
      processing consumes a lot of processing time.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.parse_addr(address)</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action, sample-fetch,
      converter</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>network</b> -- is a string describing an ipv4 or ipv6
      address and optionally its network length, like this:
      &quot;127.0.0.1/8&quot; or &quot;aaaa::1234/32&quot;.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">a userdata containing network or nil if an error
    occurs.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Parse ipv4 or ipv6 adresses and its facultative associated network.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.match_addr(addr1, addr2)</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action, sample-fetch,
      converter</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>addr1</b> -- is an address created with
      &quot;core.parse_addr&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>addr2</b> -- is an address created with
      &quot;core.parse_addr&quot;.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">boolean, true if the network of the addresses matche, else
      returns false.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Match two networks. For example &quot;127.0.0.1/32&quot; matchs
  &quot;127.0.0.0/8&quot;. The order of network is not important.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>core.tokenize(str, separators[, noblank])</b></dt>
  <dd class="It-tag"><b>context</b>: body, init, task, action, sample-fetch,
      converter
    <div style="height: 1.00em;">&#x00A0;</div>
    This function is useful for tokenizing an entry, or splitting some messages.
      :param string str: The string which will be split. :param string
      separators: A string containing a list of separators. :param boolean
      noblank: Ignore empty entries. :returns: an array of string.
    <div style="height: 1.00em;">&#x00A0;</div>
    For example:</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
local array = core.tokenize(&quot;This function is useful, for tokenizing an entry.&quot;, &quot;., &quot;, true)
print_r(array)
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">Returns this array:</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
(table) table: 0x21c01e0 [
    1: (string) &quot;This&quot;
    2: (string) &quot;function&quot;
    3: (string) &quot;is&quot;
    4: (string) &quot;useful&quot;
    5: (string) &quot;for&quot;
    6: (string) &quot;tokenizing&quot;
    7: (string) &quot;an&quot;
    8: (string) &quot;entry&quot;
]
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>class Proxy()</b></dt>
  <dd class="It-tag">This class provides a way for manipulating proxy and
      retrieving information like statistics.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Proxy.servers</b></dt>
  <dd class="It-tag">Contain an array with the attached servers. Each server
      entry is an object of type <i>Server class</i>.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Proxy.listeners</b></dt>
  <dd class="It-tag">Contain an array with the attached listeners. Each
      listeners entry is an object of type <i>Listener class</i>.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Proxy.pause(px)</b></dt>
  <dd class="It-tag">Pause the proxy. See the management socket documentation
      for more information.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>px</b> (<i>class_proxy</i>) -- A <i>Proxy class</i>
      which indicates the manipulated proxy.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Proxy.resume(px)</b></dt>
  <dd class="It-tag">Resume the proxy. See the management socket documentation
      for more information.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>px</b> (<i>class_proxy</i>) -- A <i>Proxy class</i>
      which indicates the manipulated proxy.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Proxy.stop(px)</b></dt>
  <dd class="It-tag">Stop the proxy. See the management socket documentation for
      more information.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>px</b> (<i>class_proxy</i>) -- A <i>Proxy class</i>
      which indicates the manipulated proxy.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Proxy.shut_bcksess(px)</b></dt>
  <dd class="It-tag">Kill the session attached to a backup server. See the
      management socket documentation for more information.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>px</b> (<i>class_proxy</i>) -- A <i>Proxy class</i>
      which indicates the manipulated proxy.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Proxy.get_cap(px)</b></dt>
  <dd class="It-tag">Returns a string describing the capabilities of the
    proxy.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>px</b> (<i>class_proxy</i>) -- A <i>Proxy class</i>
      which indicates the manipulated proxy.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">a string &quot;frontend&quot;, &quot;backend&quot;,
      &quot;proxy&quot; or &quot;ruleset&quot;.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Proxy.get_mode(px)</b></dt>
  <dd class="It-tag">Returns a string describing the mode of the current
    proxy.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>px</b> (<i>class_proxy</i>) -- A <i>Proxy class</i>
      which indicates the manipulated proxy.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">a string &quot;tcp&quot;, &quot;http&quot;,
      &quot;health&quot; or &quot;unknown&quot;</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Proxy.get_stats(px)</b></dt>
  <dd class="It-tag">Returns an array containg the proxy statistics. The
      statistics returned are not the same if the proxy is frontend or a
      backend.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>px</b> (<i>class_proxy</i>) -- A <i>Proxy class</i>
      which indicates the manipulated proxy.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">a key/value array containing stats</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Server.is_draining(sv)</b></dt>
  <dd class="It-tag">Return true if the server is currently draining stiky
      connections.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sv</b> (<i>class_server</i>) -- A <i>Server class</i>
      which indicates the manipulated server.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">a boolean</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Server.set_weight(sv, weight)</b></dt>
  <dd class="It-tag">Dynamically change the weight of the serveur. See the
      management socket documentation for more information about the format of
      the string.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sv</b> (<i>class_server</i>) -- A <i>Server class</i>
      which indicates the manipulated server.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>weight</b> (<i>string</i>) -- A string describing the
      server weight.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Server.get_weight(sv)</b></dt>
  <dd class="It-tag">This function returns an integer representing the serveur
      weight.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sv</b> (<i>class_server</i>) -- A <i>Server class</i>
      which indicates the manipulated server.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">an integer.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Server.set_addr(sv, addr)</b></dt>
  <dd class="It-tag">Dynamically change the address of the serveur. See the
      management socket documentation for more information about the format of
      the string.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sv</b> (<i>class_server</i>) -- A <i>Server class</i>
      which indicates the manipulated server.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>weight</b> (<i>string</i>) -- A string describing the
      server address.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Server.get_addr(sv)</b></dt>
  <dd class="It-tag">Returns a string describing the address of the
    serveur.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sv</b> (<i>class_server</i>) -- A <i>Server class</i>
      which indicates the manipulated server.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">A string</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Server.get_stats(sv)</b></dt>
  <dd class="It-tag">Returns server statistics.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sv</b> (<i>class_server</i>) -- A <i>Server class</i>
      which indicates the manipulated server.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">a key/value array containing stats</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Server.shut_sess(sv)</b></dt>
  <dd class="It-tag">Shutdown all the sessions attached to the server. See the
      management socket documentation for more information about this
    function.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sv</b> (<i>class_server</i>) -- A <i>Server class</i>
      which indicates the manipulated server.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Server.set_drain(sv)</b></dt>
  <dd class="It-tag">Drain sticky sessions. See the management socket
      documentation for more information about this function.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sv</b> (<i>class_server</i>) -- A <i>Server class</i>
      which indicates the manipulated server.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Server.set_maint(sv)</b></dt>
  <dd class="It-tag">Set maintenance mode. See the management socket
      documentation for more information about this function.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sv</b> (<i>class_server</i>) -- A <i>Server class</i>
      which indicates the manipulated server.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Server.set_ready(sv)</b></dt>
  <dd class="It-tag">Set normal mode. See the management socket documentation
      for more information about this function.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sv</b> (<i>class_server</i>) -- A <i>Server class</i>
      which indicates the manipulated server.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Server.check_enable(sv)</b></dt>
  <dd class="It-tag">Enable health checks. See the management socket
      documentation for more information about this function.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sv</b> (<i>class_server</i>) -- A <i>Server class</i>
      which indicates the manipulated server.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Server.check_disable(sv)</b></dt>
  <dd class="It-tag">Disable health checks. See the management socket
      documentation for more information about this function.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sv</b> (<i>class_server</i>) -- A <i>Server class</i>
      which indicates the manipulated server.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Server.check_force_up(sv)</b></dt>
  <dd class="It-tag">Force health-check up. See the management socket
      documentation for more information about this function.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sv</b> (<i>class_server</i>) -- A <i>Server class</i>
      which indicates the manipulated server.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Server.check_force_nolb(sv)</b></dt>
  <dd class="It-tag">Force health-check nolb mode. See the management socket
      documentation for more information about this function.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sv</b> (<i>class_server</i>) -- A <i>Server class</i>
      which indicates the manipulated server.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Server.check_force_down(sv)</b></dt>
  <dd class="It-tag">Force health-check down. See the management socket
      documentation for more information about this function.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sv</b> (<i>class_server</i>) -- A <i>Server class</i>
      which indicates the manipulated server.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Server.agent_enable(sv)</b></dt>
  <dd class="It-tag">Enable agent check. See the management socket documentation
      for more information about this function.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sv</b> (<i>class_server</i>) -- A <i>Server class</i>
      which indicates the manipulated server.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Server.agent_disable(sv)</b></dt>
  <dd class="It-tag">Disable agent check. See the management socket
      documentation for more information about this function.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sv</b> (<i>class_server</i>) -- A <i>Server class</i>
      which indicates the manipulated server.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Server.agent_force_up(sv)</b></dt>
  <dd class="It-tag">Force agent check up. See the management socket
      documentation for more information about this function.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sv</b> (<i>class_server</i>) -- A <i>Server class</i>
      which indicates the manipulated server.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Server.agent_force_down(sv)</b></dt>
  <dd class="It-tag">Force agent check down. See the management socket
      documentation for more information about this function.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sv</b> (<i>class_server</i>) -- A <i>Server class</i>
      which indicates the manipulated server.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Listener.get_stats(ls)</b></dt>
  <dd class="It-tag">Returns server statistics.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>ls</b> (<i>class_listener</i>) -- A <i>Listener
      class</i> which indicates the manipulated listener.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">a key/value array containing stats</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>class Concat()</b></dt>
  <dd class="It-tag">This class provides a fast way for string concatenation.
      The way using native Lua concatenation like the code below is slow for
      some reasons.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
str = &quot;string1&quot;
str = str .. &quot;, string2&quot;
str = str .. &quot;, string3&quot;
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">For each concatenation, Lua: * allocate memory
  for the result, * catenate the two string copying the strings in the new
  memory bloc, * free the old memory block containing the string whoch is no
  longer used. This process does many memory move, allocation and free. In
  addition, the memory is not really freed, it is just mark mark as unsused and
  wait for the garbage collector.
<div style="height: 1.00em;">&#x00A0;</div>
The Concat class provide an alternative way for catenating strings. It uses the
  internal Lua mechanism (it does not allocate memory), but it doesn't copy the
  data more than once.
<div style="height: 1.00em;">&#x00A0;</div>
On my computer, the following loops spends 0.2s for the Concat method and 18.5s
  for the pure Lua implementation. So, the Concat class is about 1000x faster
  than the embedded solution.</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
for j = 1, 100 do
  c = core.concat()
  for i = 1, 20000 do
    c:add(&quot;#####&quot;)
  end
end
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
for j = 1, 100 do
  c = &quot;&quot;
  for i = 1, 20000 do
    c = c .. &quot;#####&quot;
  end
end
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Concat.add(concat, string)</b></dt>
  <dd class="It-tag">This function adds a string to the current concatenated
      string.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>concat</b> (<i>class_concat</i>) -- A <i>Concat
      class</i> which contains the currently builded string.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>string</b> (<i>string</i>) -- A new string to
      concatenate to the current builded string.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Concat.dump(concat)</b></dt>
  <dd class="It-tag">This function returns the concanated string.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>concat</b> (<i>class_concat</i>) -- A <i>Concat
      class</i> which contains the currently builded string.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">the concatenated string</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>class Fetches()</b></dt>
  <dd class="It-tag">This class contains a lot of internal HAProxy sample
      fetches. See the HAProxy &quot;configuration.txt&quot; documentation for
      more information about her usage. they are the chapters 7.3.2 to 7.3.6.
    <div style="height: 1.00em;">&#x00A0;</div>
     <b>warning</b> some sample fetches are not available in some context. These
      limitations are specified in this documentation when theire useful.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">TXN.f</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">TXN.sf</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Fetches are useful for:
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">get system time,</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">get environment variable,</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">get random numbers,</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">known backend status like the number of users in queue or
      the number of connections established,</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">client information like ip source or destination,</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">deal with stick tables,</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Established SSL informations,</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">HTTP information like headers or method.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
function action(txn)
  -- Get source IP
  local clientip = txn.f:src()
end
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>class Converters()</b></dt>
  <dd class="It-tag">This class contains a lot of internal HAProxy sample
      converters. See the HAProxy documentation &quot;configuration.txt&quot;
      for more information about her usage. Its the chapter 7.3.1.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">TXN.c</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">TXN.sc</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Converters provides statefull transformation. They are useful for:
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">converting input to base64,</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">applying hash on input string (djb2, crc32, sdbm,
    wt6),</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">format date,</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">json escape,</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">extracting preferred language comparing two lists,</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">turn to lower or upper chars,</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">deal with stick tables.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>class Channel()</b></dt>
  <dd class="It-tag">HAProxy uses two buffers for the processing of the
      requests. The first one is used with the request data (from the client to
      the server) and the second is used for the response data (from the server
      to the client).
    <div style="height: 1.00em;">&#x00A0;</div>
    Each buffer contains two types of data. The first type is the incoming data
      waiting for a processing. The second part is the outgoing data already
      processed. Usually, the incoming data is processed, after it is tagged as
      outgoing data, and finally it is sent. The following functions provides
      tools for manipulating these data in a buffer.
    <div style="height: 1.00em;">&#x00A0;</div>
    The following diagram shows where the channel class function are applied.
    <div style="height: 1.00em;">&#x00A0;</div>
     <b>Warning</b>: It is not possible to read from the response in request
      action, and it is not possible to read for the request channel in response
      action.</dd>
</dl>
</div>
<br/>
[image]
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Channel.dup(channel)</b></dt>
  <dd class="It-tag">This function returns a string that contain the entire
      buffer. The data is not remove from the buffer and can be reprocessed
      later.
    <div style="height: 1.00em;">&#x00A0;</div>
    If the buffer cant receive more data, a 'nil' value is returned.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>channel</b> (<i>class_channel</i>) -- The manipulated
      Channel.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">a string containing all the available data or nil.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Channel.get(channel)</b></dt>
  <dd class="It-tag">This function returns a string that contain the entire
      buffer. The data is consumed from the buffer.
    <div style="height: 1.00em;">&#x00A0;</div>
    If the buffer cant receive more data, a 'nil' value is returned.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>channel</b> (<i>class_channel</i>) -- The manipulated
      Channel.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">a string containing all the available data or nil.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Channel.getline(channel)</b></dt>
  <dd class="It-tag">This function returns a string that contain the first line
      of the buffer. The data is consumed. If the data returned doesn't contains
      a final 'n' its assumed than its the last available data in the buffer.
    <div style="height: 1.00em;">&#x00A0;</div>
    If the buffer cant receive more data, a 'nil' value is returned.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>channel</b> (<i>class_channel</i>) -- The manipulated
      Channel.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">a string containing the available line or nil.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Channel.set(channel, string)</b></dt>
  <dd class="It-tag">This function replace the content of the buffer by the
      string. The function returns the copied length, otherwise, it returns -1.
    <div style="height: 1.00em;">&#x00A0;</div>
    The data set with this function are not send. They wait for the end of
      HAProxy processing, so the buffer can be full.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>channel</b> (<i>class_channel</i>) -- The manipulated
      Channel.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>string</b> (<i>string</i>) -- The data which will
    sent.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">an integer containing the amount of bytes copied or
    -1.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Channel.append(channel, string)</b></dt>
  <dd class="It-tag">This function append the string argument to the content of
      the buffer. The function returns the copied length, otherwise, it returns
      -1.
    <div style="height: 1.00em;">&#x00A0;</div>
    The data set with this function are not send. They wait for the end of
      HAProxy processing, so the buffer can be full.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>channel</b> (<i>class_channel</i>) -- The manipulated
      Channel.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>string</b> (<i>string</i>) -- The data which will
    sent.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">an integer containing the amount of bytes copied or
    -1.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Channel.send(channel, string)</b></dt>
  <dd class="It-tag">This function required immediate send of the data. Unless
      if the connection is close, the buffer is regularly flushed and all the
      string can be sent.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>channel</b> (<i>class_channel</i>) -- The manipulated
      Channel.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>string</b> (<i>string</i>) -- The data which will
    sent.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">an integer containing the amount of bytes copied or
    -1.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Channel.get_in_length(channel)</b></dt>
  <dd class="It-tag">This function returns the length of the input part of the
      buffer.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>channel</b> (<i>class_channel</i>) -- The manipulated
      Channel.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">an integer containing the amount of available bytes.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Channel.get_out_length(channel)</b></dt>
  <dd class="It-tag">This function returns the length of the output part of the
      buffer.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>channel</b> (<i>class_channel</i>) -- The manipulated
      Channel.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">an integer containing the amount of available bytes.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Channel.forward(channel, int)</b></dt>
  <dd class="It-tag">This function transfer bytes from the input part of the
      buffer to the output part.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>channel</b> (<i>class_channel</i>) -- The manipulated
      Channel.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>int</b> (<i>integer</i>) -- The amount of data which
      will be forwarded.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Channel.is_full(channel)</b></dt>
  <dd class="It-tag">This function returns true if the buffer channel is
    full.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">a boolean</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>class HTTP()</b></dt>
  <dd class="It-tag">This class contain all the HTTP manipulation
    functions.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTTP.req_get_headers(http)</b></dt>
  <dd class="It-tag">Returns an array containing all the request headers.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>http</b> (<i>class_http</i>) -- The related http
    object.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">array of headers.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">HTTP.res_get_headers()</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This is the form of the returned array:</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
HTTP:req_get_headers()['&lt;header-name&gt;'][&lt;header-index&gt;] = &quot;&lt;header-value&gt;&quot;
<div class="Pp"></div>
local hdr = HTTP:req_get_headers()
hdr[&quot;host&quot;][0] = &quot;www.test.com&quot;
hdr[&quot;accept&quot;][0] = &quot;audio/basic q=1&quot;
hdr[&quot;accept&quot;][1] = &quot;audio/*, q=0.2&quot;
hdr[&quot;accept&quot;][2] = &quot;*/*, q=0.1&quot;
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTTP.res_get_headers(http)</b></dt>
  <dd class="It-tag">Returns an array containing all the response headers.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>http</b> (<i>class_http</i>) -- The related http
    object.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">array of headers.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">HTTP.req_get_headers()</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This is the form of the returned array:</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
HTTP:res_get_headers()['&lt;header-name&gt;'][&lt;header-index&gt;] = &quot;&lt;header-value&gt;&quot;
<div class="Pp"></div>
local hdr = HTTP:req_get_headers()
hdr[&quot;host&quot;][0] = &quot;www.test.com&quot;
hdr[&quot;accept&quot;][0] = &quot;audio/basic q=1&quot;
hdr[&quot;accept&quot;][1] = &quot;audio/*, q=0.2&quot;
hdr[&quot;accept&quot;][2] = &quot;*.*, q=0.1&quot;
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTTP.req_add_header(http, name, value)</b></dt>
  <dd class="It-tag">Appends an HTTP header field in the request whose name is
      specified in &quot;name&quot; and whose value is defined in
      &quot;value&quot;.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>http</b> (<i>class_http</i>) -- The related http
    object.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>name</b> (<i>string</i>) -- The header name.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>value</b> (<i>string</i>) -- The header value.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">HTTP.res_add_header()</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTTP.res_add_header(http, name, value)</b></dt>
  <dd class="It-tag">appends an HTTP header field in the response whose name is
      specified in &quot;name&quot; and whose value is defined in
      &quot;value&quot;.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>http</b> (<i>class_http</i>) -- The related http
    object.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>name</b> (<i>string</i>) -- The header name.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>value</b> (<i>string</i>) -- The header value.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">HTTP.req_add_header()</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTTP.req_del_header(http, name)</b></dt>
  <dd class="It-tag">Removes all HTTP header fields in the request whose name is
      specified in &quot;name&quot;.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>http</b> (<i>class_http</i>) -- The related http
    object.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>name</b> (<i>string</i>) -- The header name.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">HTTP.res_del_header()</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTTP.res_del_header(http, name)</b></dt>
  <dd class="It-tag">Removes all HTTP header fields in the response whose name
      is specified in &quot;name&quot;.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>http</b> (<i>class_http</i>) -- The related http
    object.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>name</b> (<i>string</i>) -- The header name.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">HTTP.req_del_header()</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTTP.req_set_header(http, name, value)</b></dt>
  <dd class="It-tag">This variable replace all occurence of all header
      &quot;name&quot;, by only one containing the &quot;value&quot;.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>http</b> (<i>class_http</i>) -- The related http
    object.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>name</b> (<i>string</i>) -- The header name.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>value</b> (<i>string</i>) -- The header value.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">HTTP.res_set_header()</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This function does the same work as the folowwing code:</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
function fcn(txn)
   TXN.http:req_del_header(&quot;header&quot;)
   TXN.http:req_add_header(&quot;header&quot;, &quot;value&quot;)
end
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTTP.res_set_header(http, name, value)</b></dt>
  <dd class="It-tag">This variable replace all occurence of all header
      &quot;name&quot;, by only one containing the &quot;value&quot;.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>http</b> (<i>class_http</i>) -- The related http
    object.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>name</b> (<i>string</i>) -- The header name.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>value</b> (<i>string</i>) -- The header value.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">HTTP.req_rep_header()</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTTP.req_rep_header(http, name, regex, replace)</b></dt>
  <dd class="It-tag">Matches the regular expression in all occurrences of header
      field &quot;name&quot; according to &quot;regex&quot;, and replaces them
      with the &quot;replace&quot; argument. The replacement value can contain
      back references like 1, 2, ... This function works with the request.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>http</b> (<i>class_http</i>) -- The related http
    object.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>name</b> (<i>string</i>) -- The header name.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>regex</b> (<i>string</i>) -- The match regular
      expression.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>replace</b> (<i>string</i>) -- The replacement
    value.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">HTTP.res_rep_header()</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTTP.res_rep_header(http, name, regex, string)</b></dt>
  <dd class="It-tag">Matches the regular expression in all occurrences of header
      field &quot;name&quot; according to &quot;regex&quot;, and replaces them
      with the &quot;replace&quot; argument. The replacement value can contain
      back references like 1, 2, ... This function works with the request.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>http</b> (<i>class_http</i>) -- The related http
    object.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>name</b> (<i>string</i>) -- The header name.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>regex</b> (<i>string</i>) -- The match regular
      expression.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>replace</b> (<i>string</i>) -- The replacement
    value.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">HTTP.req_replace_header()</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTTP.req_set_method(http, method)</b></dt>
  <dd class="It-tag">Rewrites the request method with the parameter
      &quot;method&quot;.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>http</b> (<i>class_http</i>) -- The related http
    object.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>method</b> (<i>string</i>) -- The new method.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTTP.req_set_path(http, path)</b></dt>
  <dd class="It-tag">Rewrites the request path with the &quot;path&quot;
      parameter.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>http</b> (<i>class_http</i>) -- The related http
    object.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>path</b> (<i>string</i>) -- The new path.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTTP.req_set_query(http, query)</b></dt>
  <dd class="It-tag">Rewrites the request's query string which appears after the
      first question mark (&quot;?&quot;) with the parameter
    &quot;query&quot;.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>http</b> (<i>class_http</i>) -- The related http
    object.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>query</b> (<i>string</i>) -- The new query.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTTP.req_set_uri(http, uri)</b></dt>
  <dd class="It-tag">Rewrites the request URI with the parameter
      &quot;uri&quot;.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>http</b> (<i>class_http</i>) -- The related http
    object.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>uri</b> (<i>string</i>) -- The new uri.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>HTTP.res_set_status(http, status[, reason])</b></dt>
  <dd class="It-tag">Rewrites the response status code with the parameter
      &quot;code&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    If no custom reason is provided, it will be generated from the status.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>http</b> (<i>class_http</i>) -- The related http
    object.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>status</b> (<i>integer</i>) -- The new response status
      code.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>reason</b> (<i>string</i>) -- The new response reason
      (optional).</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>class TXN()</b></dt>
  <dd class="It-tag">The txn class contain all the functions relative to the
      http or tcp transaction (Note than a tcp stream is the same than a tcp
      transaction, but an HTTP transaction is not the same than a tcp stream).
    <div style="height: 1.00em;">&#x00A0;</div>
    The usage of this class permits to retrieve data from the requests, alter it
      and forward it.
    <div style="height: 1.00em;">&#x00A0;</div>
    All the functions provided by this class are available in the context
      <b>sample-fetches</b> and <b>actions</b>.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.c</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">An <i>Converters class</i>.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute contains a Converters class object.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.sc</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">An <i>Converters class</i>.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute contains a Converters class object. The functions of this object
  returns always a string.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.f</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">An <i>Fetches class</i>.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute contains a Fetches class object.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.sf</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">An <i>Fetches class</i>.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute contains a Fetches class object. The functions of this object
  returns always a string.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.req</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">An <i>Channel class</i>.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute contains a channel class object for the request buffer.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.res</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">An <i>Channel class</i>.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute contains a channel class object for the response buffer.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.http</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">An <i>HTTP class</i>.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute contains an HTTP class object. It is avalaible only if the proxy
  has the &quot;mode http&quot; enabled.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.log(TXN, loglevel, msg)</b></dt>
  <dd class="It-tag">This function sends a log. The log is sent, according with
      the HAProxy configuration file, on the default syslog server if it is
      configured and on the stderr if it is allowed.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>txn</b> (<i>class_txn</i>) -- The class txn object
      containing the data.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>loglevel</b> (<i>integer</i>) -- Is the log level
      asociated with the message. It is a number between 0 and 7.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>msg</b> (<i>string</i>) -- The log content.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">core.emerg, core.alert, core.crit, core.err, core.warning,
      core.notice, core.info, core.debug (log level definitions)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">TXN.deflog</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">TXN.Debug</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">TXN.Info</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">TXN.Warning</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">TXN.Alert</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.deflog(TXN, msg)</b></dt>
  <dd class="It-tag">Sends a log line with the default loglevel for the proxy
      ssociated with the transaction.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>txn</b> (<i>class_txn</i>) -- The class txn object
      containing the data.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>msg</b> (<i>string</i>) -- The log content.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">TXN.log</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.Debug(txn, msg)</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>txn</b> (<i>class_txn</i>) -- The class txn object
      containing the data.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>msg</b> (<i>string</i>) -- The log content.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">TXN.log</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Does the same job than:</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
function Debug(txn, msg)
  TXN.log(txn, core.debug, msg)
end
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.Info(txn, msg)</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>txn</b> (<i>class_txn</i>) -- The class txn object
      containing the data.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>msg</b> (<i>string</i>) -- The log content.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">TXN.log</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
function Debug(txn, msg)
  TXN.log(txn, core.info, msg)
end
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.Warning(txn, msg)</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>txn</b> (<i>class_txn</i>) -- The class txn object
      containing the data.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>msg</b> (<i>string</i>) -- The log content.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">TXN.log</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
function Debug(txn, msg)
  TXN.log(txn, core.warning, msg)
end
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.Alert(txn, msg)</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>txn</b> (<i>class_txn</i>) -- The class txn object
      containing the data.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>msg</b> (<i>string</i>) -- The log content.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">TXN.log</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
function Debug(txn, msg)
  TXN.log(txn, core.alert, msg)
end
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.get_priv(txn)</b></dt>
  <dd class="It-tag">Return Lua data stored in the current transaction (with the
      <i>TXN.set_priv()</i>) function. If no data are stored, it returns a nil
      value.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>txn</b> (<i>class_txn</i>) -- The class txn object
      containing the data.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">the opaque data previsously stored, or nil if nothing is
      avalaible.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.set_priv(txn, data)</b></dt>
  <dd class="It-tag">Store any data in the current HAProxy transaction. This
      action replace the old stored data.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>txn</b> (<i>class_txn</i>) -- The class txn object
      containing the data.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>data</b> (<i>opaque</i>) -- The data which is stored in
      the transaction.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.set_var(TXN, var, value)</b></dt>
  <dd class="It-tag">Converts a Lua type in a HAProxy type and store it in a
      variable &lt;var&gt;.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>txn</b> (<i>class_txn</i>) -- The class txn object
      containing the data.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>var</b> (<i>string</i>) -- The variable name according
      with the HAProxy variable syntax.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>value</b> (<i>type</i>) -- The value associated to the
      variable. The type can be string or integer.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.unset_var(TXN, var)</b></dt>
  <dd class="It-tag">Unset the variable &lt;var&gt;.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>txn</b> (<i>class_txn</i>) -- The class txn object
      containing the data.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>var</b> (<i>string</i>) -- The variable name according
      with the HAProxy variable syntax.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.get_var(TXN, var)</b></dt>
  <dd class="It-tag">Returns data stored in the variable &lt;var&gt; converter
      in Lua type.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>txn</b> (<i>class_txn</i>) -- The class txn object
      containing the data.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>var</b> (<i>string</i>) -- The variable name according
      with the HAProxy variable syntax.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.done(txn)</b></dt>
  <dd class="It-tag">This function terminates processing of the transaction and
      the associated session. It can be used when a critical error is detected
      or to terminate processing after some data have been returned to the
      client (eg: a redirect).
    <div style="height: 1.00em;">&#x00A0;</div>
     <i>Warning</i>: It not make sense to call this function from
      sample-fetches. In this case the behaviour of this one is the same than
      core.done(): it quit the Lua execution. The transaction is really aborted
      only from an action registered function.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>txn</b> (<i>class_txn</i>) -- The class txn object
      containing the data.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.set_loglevel(txn, loglevel)</b></dt>
  <dd class="It-tag">Is used to change the log level of the current request. The
      &quot;loglevel&quot; must be an integer between 0 and 7.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>txn</b> (<i>class_txn</i>) -- The class txn object
      containing the data.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>loglevel</b> (<i>integer</i>) -- The required log level.
      This variable can be one of</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">core.&lt;loglevel&gt;</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.set_tos(txn, tos)</b></dt>
  <dd class="It-tag">Is used to set the TOS or DSCP field value of packets sent
      to the client to the value passed in &quot;tos&quot; on platforms which
      support this.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>txn</b> (<i>class_txn</i>) -- The class txn object
      containing the data.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>tos</b> (<i>integer</i>) -- The new TOS os DSCP.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>TXN.set_mark(txn, mark)</b></dt>
  <dd class="It-tag">Is used to set the Netfilter MARK on all packets sent to
      the client to the value passed in &quot;mark&quot; on platforms which
      support it.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>txn</b> (<i>class_txn</i>) -- The class txn object
      containing the data.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>mark</b> (<i>integer</i>) -- The mark value.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>class Socket()</b></dt>
  <dd class="It-tag">This class must be compatible with the Lua Socket class.
      Only the 'client' functions are available. See the Lua Socket
      documentation:
    <div style="height: 1.00em;">&#x00A0;</div>
     <i>http://w3.impa.br/~diego/software/luasocket/tcp.html</i></dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Socket.close(socket)</b></dt>
  <dd class="It-tag">Closes a TCP object. The internal socket used by the object
      is closed and the local address to which the object was bound is made
      available to other applications. No further operations (except for further
      calls to the close method) are allowed on a closed Socket.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>socket</b> (<i>class_socket</i>) -- Is the manipulated
      Socket.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Note: It is important to close all used sockets once they are not needed, since,
  in many systems, each socket uses a file descriptor, which are limited system
  resources. Garbage-collected objects are automatically closed before
  destruction, though.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Socket.connect(socket, address[, port])</b></dt>
  <dd class="It-tag">Attempts to connect a socket object to a remote host.
    <div style="height: 1.00em;">&#x00A0;</div>
    In case of error, the method returns nil followed by a string describing the
      error. In case of success, the method returns 1.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>socket</b> (<i>class_socket</i>) -- Is the manipulated
      Socket.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>address</b> (<i>string</i>) -- can be an IP address or a
      host name. See below for more information.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>port</b> (<i>integer</i>) -- must be an integer number
      in the range [1..64K].</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">1 or nil.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
an address field extension permits to use the connect() function to connect to
  other stream than TCP. The syntax containing a simpleipv4 or ipv6 address is
  the basically expected format. This format requires the port.
<div style="height: 1.00em;">&#x00A0;</div>
Other format accepted are a socket path like &quot;/socket/path&quot;, it
  permits to connect to a socket. abstract namespaces are supported with the
  prefix &quot;abns@&quot;, and finaly a filedescriotr can be passed with the
  prefix &quot;fd@&quot;. The prefix &quot;ipv4@&quot;, &quot;ipv6@&quot; and
  &quot;unix@&quot; are also supported. The port can be passed int the string.
  The syntax &quot;127.0.0.1:1234&quot; is valid. in this case, the parameter
  <i>port</i> is ignored.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Socket.connect_ssl(socket, address, port)</b></dt>
  <dd class="It-tag">Same behavior than the function socket:connect, but uses
      SSL.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>socket</b> (<i>class_socket</i>) -- Is the manipulated
      Socket.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">1 or nil.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Socket.getpeername(socket)</b></dt>
  <dd class="It-tag">Returns information about the remote side of a connected
      client object.
    <div style="height: 1.00em;">&#x00A0;</div>
    Returns a string with the IP address of the peer, followed by the port
      number that peer is using for the connection. In case of error, the method
      returns nil.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>socket</b> (<i>class_socket</i>) -- Is the manipulated
      Socket.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">a string containing the server information.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Socket.getsockname(socket)</b></dt>
  <dd class="It-tag">Returns the local address information associated to the
      object.
    <div style="height: 1.00em;">&#x00A0;</div>
    The method returns a string with local IP address and a number with the
      port. In case of error, the method returns nil.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>socket</b> (<i>class_socket</i>) -- Is the manipulated
      Socket.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">a string containing the client information.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Socket.receive(socket[, pattern[, prefix]])</b></dt>
  <dd class="It-tag">Reads data from a client object, according to the specified
      read pattern. Patterns follow the Lua file I/O format, and the difference
      in performance between all patterns is negligible.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>socket</b> (<i>class_socket</i>) -- Is the manipulated
      Socket.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>pattern</b> (<i>string|integer</i>) -- Describe what is
      required (see below).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>prefix</b> (<i>string</i>) -- A string which will be
      prefix the returned data.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">a string containing the required data or nil.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Pattern can be any of the following:
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 2.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>`*a`</b>: reads from the socket until the connection is
    closed. No</dt>
  <dd class="It-tag">end-of-line translation is performed;</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 2.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>`*l`</b>: reads a line of text from the Socket. The line
    is terminated by a</dt>
  <dd class="It-tag">LF character (ASCII 10), optionally preceded by a CR
      character (ASCII 13). The CR and LF characters are not included in the
      returned line. In fact, all CR characters are ignored by the pattern. This
      is the default pattern.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 2.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>number</b>: causes the method to read a specified number
    of bytes from the</dt>
  <dd class="It-tag">Socket. Prefix is an optional string to be concatenated to
      the beginning of any received data before return.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>empty</b>: If the pattern is left empty, the default
      option is <i>*l</i>.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
If successful, the method returns the received pattern. In case of error, the
  method returns nil followed by an error message which can be the string
  'closed' in case the connection was closed before the transmission was
  completed or the string 'timeout' in case there was a timeout during the
  operation. Also, after the error message, the function returns the partial
  result of the transmission.
<div style="height: 1.00em;">&#x00A0;</div>
Important note: This function was changed severely. It used to support multiple
  patterns (but I have never seen this feature used) and now it doesn't anymore.
  Partial results used to be returned in the same way as successful results.
  This last feature violated the idea that all functions should return nil on
  error. Thus it was changed too.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Socket.send(socket, data[, start[, end]])</b></dt>
  <dd class="It-tag">Sends data through client object.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>socket</b> (<i>class_socket</i>) -- Is the manipulated
      Socket.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>data</b> (<i>string</i>) -- The data that will be
    sent.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>start</b> (<i>integer</i>) -- The start position in the
      buffer of the data which will be sent.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>end</b> (<i>integer</i>) -- The end position in the
      buffer of the data which will be sent.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">see below.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Data is the string to be sent. The optional arguments i and j work exactly like
  the standard string.sub Lua function to allow the selection of a substring to
  be sent.
<div style="height: 1.00em;">&#x00A0;</div>
If successful, the method returns the index of the last byte within [start, end]
  that has been sent. Notice that, if start is 1 or absent, this is effectively
  the total number of bytes sent. In case of error, the method returns nil,
  followed by an error message, followed by the index of the last byte within
  [start, end] that has been sent. You might want to try again from the byte
  following that. The error message can be 'closed' in case the connection was
  closed before the transmission was completed or the string 'timeout' in case
  there was a timeout during the operation.
<div style="height: 1.00em;">&#x00A0;</div>
Note: Output is not buffered. For small strings, it is always better to
  concatenate them in Lua (with the '..' operator) and send the result in one
  call instead of calling the method several times.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Socket.setoption(socket, option[, value])</b></dt>
  <dd class="It-tag">Just implemented for compatibility, this cal does
    nothing.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Socket.settimeout(socket, value[, mode])</b></dt>
  <dd class="It-tag">Changes the timeout values for the object. All I/O
      operations are blocking. That is, any call to the methods send, receive,
      and accept will block indefinitely, until the operation completes. The
      settimeout method defines a limit on the amount of time the I/O methods
      can block. When a timeout time has elapsed, the affected methods give up
      and fail with an error code.
    <div style="height: 1.00em;">&#x00A0;</div>
    The amount of time to wait is specified as the value parameter, in seconds.
    <div style="height: 1.00em;">&#x00A0;</div>
    The timeout modes are bot implemented, the only settable timeout is the
      inactivity time waiting for complete the internal buffer send or waiting
      for receive data.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>socket</b> (<i>class_socket</i>) -- Is the manipulated
      Socket.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>value</b> (<i>integer</i>) -- The timeout value.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>class Map()</b></dt>
  <dd class="It-tag">This class permits to do some lookup in HAProxy maps. The
      declared maps can be modified during the runtime throught the HAProxy
      management socket.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
default = &quot;usa&quot;
<div class="Pp"></div>
-- Create and load map
geo = Map.new(&quot;geo.map&quot;, Map.ip);
<div class="Pp"></div>
-- Create new fetch that returns the user country
core.register_fetches(&quot;country&quot;, function(txn)
  local src;
  local loc;
<div class="Pp"></div>
  src = txn.f:fhdr(&quot;x-forwarded-for&quot;);
  if (src == nil) then
    src = txn.f:src()
    if (src == nil) then
      return default;
    end
  end
<div class="Pp"></div>
  -- Perform lookup
  loc = geo:lookup(src);
<div class="Pp"></div>
  if (loc == nil) then
    return default;
  end
<div class="Pp"></div>
  return loc;
end);
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Map.int</b></dt>
  <dd class="It-tag">See the HAProxy configuration.txt file, chapter &quot;Using
      ACLs and fetching samples&quot; ans subchapter &quot;ACL basics&quot; to
      understand this pattern matching method.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Map.ip</b></dt>
  <dd class="It-tag">See the HAProxy configuration.txt file, chapter &quot;Using
      ACLs and fetching samples&quot; ans subchapter &quot;ACL basics&quot; to
      understand this pattern matching method.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Map.str</b></dt>
  <dd class="It-tag">See the HAProxy configuration.txt file, chapter &quot;Using
      ACLs and fetching samples&quot; ans subchapter &quot;ACL basics&quot; to
      understand this pattern matching method.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Map.beg</b></dt>
  <dd class="It-tag">See the HAProxy configuration.txt file, chapter &quot;Using
      ACLs and fetching samples&quot; ans subchapter &quot;ACL basics&quot; to
      understand this pattern matching method.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Map.sub</b></dt>
  <dd class="It-tag">See the HAProxy configuration.txt file, chapter &quot;Using
      ACLs and fetching samples&quot; ans subchapter &quot;ACL basics&quot; to
      understand this pattern matching method.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Map.dir</b></dt>
  <dd class="It-tag">See the HAProxy configuration.txt file, chapter &quot;Using
      ACLs and fetching samples&quot; ans subchapter &quot;ACL basics&quot; to
      understand this pattern matching method.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Map.dom</b></dt>
  <dd class="It-tag">See the HAProxy configuration.txt file, chapter &quot;Using
      ACLs and fetching samples&quot; ans subchapter &quot;ACL basics&quot; to
      understand this pattern matching method.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Map.end</b></dt>
  <dd class="It-tag">See the HAProxy configuration.txt file, chapter &quot;Using
      ACLs and fetching samples&quot; ans subchapter &quot;ACL basics&quot; to
      understand this pattern matching method.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Map.reg</b></dt>
  <dd class="It-tag">See the HAProxy configuration.txt file, chapter &quot;Using
      ACLs and fetching samples&quot; ans subchapter &quot;ACL basics&quot; to
      understand this pattern matching method.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Map.new(file, method)</b></dt>
  <dd class="It-tag">Creates and load a map.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>file</b> (<i>string</i>) -- Is the file containing the
      map.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>method</b> (<i>integer</i>) -- Is the map pattern
      matching method. See the attributes of the Map class.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">a class Map object.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>See</b></dt>
  <dd class="It-tag">The Map attributes.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Map.lookup(map, str)</b></dt>
  <dd class="It-tag">Perform a lookup in a map.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>map</b> (<i>class_map</i>) -- Is the class Map
    object.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>str</b> (<i>string</i>) -- Is the string used as
    key.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">a string containing the result or nil if no match.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Map.slookup(map, str)</b></dt>
  <dd class="It-tag">Perform a lookup in a map.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>map</b> (<i>class_map</i>) -- Is the class Map
    object.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>str</b> (<i>string</i>) -- Is the string used as
    key.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">a string containing the result or empty string if no
    match.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>class AppletHTTP()</b></dt>
  <dd class="It-tag">This class is used with applets that requires the 'http'
      mode. The http applet can be registered with the
      <i>core.register_service()</i> function. They are used for processing an
      http request like a server in back of HAProxy.
    <div style="height: 1.00em;">&#x00A0;</div>
    This is an hello world sample code:</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
core.register_service(&quot;hello-world&quot;, &quot;http&quot;, function(applet)
   local response = &quot;Hello World !&quot;
   applet:set_status(200)
   applet:add_header(&quot;content-length&quot;, string.len(response))
   applet:add_header(&quot;content-type&quot;, &quot;text/plain&quot;)
   applet:start_response()
   applet:send(response)
end)
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletHTTP.c</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">A <i>Converters class</i></dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute contains a Converters class object.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletHTTP.sc</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">A <i>Converters class</i></dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute contains a Converters class object. The functions of this object
  returns always a string.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletHTTP.f</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">A <i>Fetches class</i></dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute contains a Fetches class object. Note that the applet execution
  place cannot access to a valid HAProxy core HTTP transaction, so some sample
  fecthes related to the HTTP dependant values (hdr, path, ...) are not
  available.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletHTTP.sf</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">A <i>Fetches class</i></dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute contains a Fetches class object. The functions of this object
  returns always a string. Note that the applet execution place cannot access to
  a valid HAProxy core HTTP transaction, so some sample fecthes related to the
  HTTP dependant values (hdr, path, ...) are not available.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletHTTP.method</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">string</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The attribute method returns a string containing the HTTP method.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletHTTP.version</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">string</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The attribute version, returns a string containing the HTTP request
  version.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletHTTP.path</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">string</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The attribute path returns a string containing the HTTP request path.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletHTTP.qs</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">string</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The attribute qs returns a string containing the HTTP request query
  string.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletHTTP.length</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">integer</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The attribute length returns an integer containing the HTTP body length.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletHTTP.headers</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">array</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The attribute headers returns an array containing the HTTP headers. The header
  names are always in lower case. As the header name can be encountered more
  than once in each request, the value is indexed with 0 as first index value.
  The array have this form:</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
AppletHTTP.headers['&lt;header-name&gt;'][&lt;header-index&gt;] = &quot;&lt;header-value&gt;&quot;
<div class="Pp"></div>
AppletHTTP.headers[&quot;host&quot;][0] = &quot;www.test.com&quot;
AppletHTTP.headers[&quot;accept&quot;][0] = &quot;audio/basic q=1&quot;
AppletHTTP.headers[&quot;accept&quot;][1] = &quot;audio/*, q=0.2&quot;
AppletHTTP.headers[&quot;accept&quot;][2] = &quot;*/*, q=0.1&quot;
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletHTTP.set_status(applet, code[, reason])</b></dt>
  <dd class="It-tag">This function sets the HTTP status code for the response.
      The allowed code are from 100 to 599.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>applet</b> (<i>class_AppletHTTP</i>) -- An <i>AppletHTTP
      class</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>code</b> (<i>integer</i>) -- the status code returned to
      the client.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>reason</b> (<i>string</i>) -- the status reason returned
      to the client (optional).</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletHTTP.add_header(applet, name, value)</b></dt>
  <dd class="It-tag">This function add an header in the response. Duplicated
      headers are not collapsed. The special header <i>content-length</i> is
      used to determinate the response length. If it not exists, a
      <i>transfer-encoding: chunked</i> is set, and all the write from the
      funcion <i>AppletHTTP:send()</i> become a chunk.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>applet</b> (<i>class_AppletHTTP</i>) -- An <i>AppletHTTP
      class</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>name</b> (<i>string</i>) -- the header name</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>value</b> (<i>string</i>) -- the header value</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletHTTP.start_response(applet)</b></dt>
  <dd class="It-tag">This function indicates to the HTTP engine that it can
      process and send the response headers. After this called we cannot add
      headers to the response; We cannot use the <i>AppletHTTP:send()</i>
      function if the <i>AppletHTTP:start_response()</i> is not called.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>applet</b> (<i>class_AppletHTTP</i>) -- An <i>AppletHTTP
      class</i></dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletHTTP.getline(applet)</b></dt>
  <dd class="It-tag">This function returns a string containing one line from the
      http body. If the data returned doesn't contains a final '\n' its assumed
      than its the last available data before the end of stream.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>applet</b> (<i>class_AppletHTTP</i>) -- An <i>AppletHTTP
      class</i></dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">a string. The string can be empty if we reach the end of
      the stream.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletHTTP.receive(applet[, size])</b></dt>
  <dd class="It-tag">Reads data from the HTTP body, according to the specified
      read <i>size</i>. If the <i>size</i> is missing, the function tries to
      read all the content of the stream until the end. If the <i>size</i> is
      bigger than the http body, it returns the amount of data avalaible.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>applet</b> (<i>class_AppletHTTP</i>) -- An <i>AppletHTTP
      class</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>size</b> (<i>integer</i>) -- the required read
    size.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">always return a string,the string can be empty is the
      connexion is closed.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletHTTP.send(applet, msg)</b></dt>
  <dd class="It-tag">Send the message <i>msg</i> on the http request body.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>applet</b> (<i>class_AppletHTTP</i>) -- An <i>AppletHTTP
      class</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>msg</b> (<i>string</i>) -- the message to send.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletHTTP.get_priv(applet)</b></dt>
  <dd class="It-tag">Return Lua data stored in the current transaction (with the
      <i>AppletHTTP.set_priv()</i>) function. If no data are stored, it returns
      a nil value.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>applet</b> (<i>class_AppletHTTP</i>) -- An <i>AppletHTTP
      class</i></dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">the opaque data previsously stored, or nil if nothing is
      avalaible.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletHTTP.set_priv(applet, data)</b></dt>
  <dd class="It-tag">Store any data in the current HAProxy transaction. This
      action replace the old stored data.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>applet</b> (<i>class_AppletHTTP</i>) -- An <i>AppletHTTP
      class</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>data</b> (<i>opaque</i>) -- The data which is stored in
      the transaction.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>class AppletTCP()</b></dt>
  <dd class="It-tag">This class is used with applets that requires the 'tcp'
      mode. The tcp applet can be registered with the
      <i>core.register_service()</i> function. They are used for processing a
      tcp stream like a server in back of HAProxy.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletTCP.c</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">A <i>Converters class</i></dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute contains a Converters class object.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletTCP.sc</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">A <i>Converters class</i></dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute contains a Converters class object. The functions of this object
  returns always a string.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletTCP.f</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">A <i>Fetches class</i></dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute contains a Fetches class object.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletTCP.sf</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">A <i>Fetches class</i></dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This attribute contains a Fetches class object.</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletTCP.getline(applet)</b></dt>
  <dd class="It-tag">This function returns a string containing one line from the
      stream. If the data returned doesn't contains a final '\n' its assumed
      than its the last available data before the end of stream.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>applet</b> (<i>class_AppletTCP</i>) -- An <i>AppletTCP
      class</i></dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">a string. The string can be empty if we reach the end of
      the stream.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletTCP.receive(applet[, size])</b></dt>
  <dd class="It-tag">Reads data from the TCP stream, according to the specified
      read <i>size</i>. If the <i>size</i> is missing, the function tries to
      read all the content of the stream until the end.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>applet</b> (<i>class_AppletTCP</i>) -- An <i>AppletTCP
      class</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>size</b> (<i>integer</i>) -- the required read
    size.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">always return a string,the string can be empty is the
      connexion is closed.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletTCP.send(appletmsg)</b></dt>
  <dd class="It-tag">Send the message on the stream.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>applet</b> (<i>class_AppletTCP</i>) -- An <i>AppletTCP
      class</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>msg</b> (<i>string</i>) -- the message to send.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletTCP.get_priv(applet)</b></dt>
  <dd class="It-tag">Return Lua data stored in the current transaction (with the
      <i>AppletTCP.set_priv()</i>) function. If no data are stored, it returns a
      nil value.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>applet</b> (<i>class_AppletTCP</i>) -- An <i>AppletTCP
      class</i></dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">the opaque data previsously stored, or nil if nothing is
      avalaible.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>AppletTCP.set_priv(applet, data)</b></dt>
  <dd class="It-tag">Store any data in the current HAProxy transaction. This
      action replace the old stored data.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Arguments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>applet</b> (<i>class_AppletTCP</i>) -- An <i>AppletTCP
      class</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>data</b> (<i>opaque</i>) -- The data which is stored in
      the transaction.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
A lot of useful lua libraries can be found here:
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>https://lua-toolbox.com/</i></dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Redis acces:
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>https://github.com/nrk/redis-lua</i></dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This is an example about the usage of the Redis library with HAProxy. Note that
  each call of any function of this library can throw an error if the socket
  connection fails.
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
-- load the redis library
local redis = require(&quot;redis&quot;);
<div class="Pp"></div>
function do_something(txn)
<div class="Pp"></div>
   -- create and connect new tcp socket
   local tcp = core.tcp();
   tcp:settimeout(1);
   tcp:connect(&quot;127.0.0.1&quot;, 6379);
<div class="Pp"></div>
   -- use the redis library with this new socket
   local client = redis.connect({socket=tcp});
   client:ping();
<div class="Pp"></div>
end
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
OpenSSL:
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>http://mkottman.github.io/luacrypto/index.html</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>https://github.com/brunoos/luasec/wiki</i></dd>
</dl>
</div>
<br/>
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Thierry FOURNIER
<h1 class="Sh" title="Sh" id="COPYRIGHT"><a class="selflink" href="#COPYRIGHT">COPYRIGHT</a></h1>
2017, Thierry FOURNIER</div>
<table class="foot">
  <tr>
    <td class="foot-date">January 13, 2017</td>
    <td class="foot-os">1.0</td>
  </tr>
</table>
</body>
</html>
