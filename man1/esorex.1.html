<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:07:40 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>ESOREX(1) User Commands ESOREX(1)</p>

<p style="margin-top: 1em">NAME <br>
esorex - ESO Recipe Execution Tool</p>

<p style="margin-top: 1em">SYNOPSIS <br>
esorex [esorex-options] recipe [recipe-options] sof</p>

<p style="margin-top: 1em">DESCRIPTION <br>
EsoRex is the ESO Recipe Execution Tool. It can list,
configure and execute CPL-based recipes from the command
line.</p>

<p style="margin-top: 1em">One of the features provided by
the CPL is the ability to create data-reduction algorithms
that run as plugins (dynamic libraries). These are called
recipes and are one of the <br>
main aspects of the CPL data-reduction development
environment.</p>

<p style="margin-top: 1em">As these recipes are dynamic
libraries, it is not possible to run them directly from the
command line. However, ESO provides several tools to do
this, thus saving recipe develop&acirc; <br>
ers the need to write such an application themselves. One of
these is GASGANO (a GUI-based tool) and the other is EsoRex
(which runs from the command line) and is described
here.</p>

<p style="margin-top: 1em">OPTIONS</p>

<p style="margin-top: 1em">--help Display this help and
exit. If a recipe name is also given, then help will be
given for it as well. [TRUE]</p>

<p style="margin-top: 1em">--version <br>
Display version information and exit. [FALSE]</p>

<p style="margin-top: 1em">--check-sof-exist <br>
When TRUE, all the input files must exist and be readable
before calling the recipe. This option may also be set using
the environment variable ESOREX_CHECK_SOF_EXIST. <br>
[FALSE]</p>

<p style="margin-top: 1em">--config <br>
Configuration file to be used for EsoRex. This option may
also be set using the environment variable ESOREX_CONFIG.
[]</p>

<p style="margin-top: 1em">--create-config <br>
Creates a configuration file for Esorex. If set to TRUE a
config file &rsquo;esorex.rc&rsquo; is created in the
&rsquo;.esorex&rsquo; directory in $HOME of the user.If a
filename is specified, a <br>
config file will be created accordingly. If a recipe is
specified in the command line, then the configuration file
will be created for the recipe instead (called <br>
&rsquo;recipename.rc&rsquo;) Note that an existing file will
be overwritten, but a backup file will be copied to
&rsquo;filename.rc.bak&rsquo; in the same directory. If the
filename ends with <br>
extension .json then a machine-readable JSON format will be
used. This option may also be set using the environment
variable ESOREX_CREATE_CONFIG. [FALSE]</p>

<p style="margin-top: 1em">--link-dir <br>
The directory in which a symbolic link to each of the
product files should be written. The enable/disable switch
to control whether the link is actually made is the <br>
&rsquo;--suppress-link&rsquo; option. This option may also
be set using the environment variable ESOREX_LINK_DIR.
[/tmp]</p>

<p style="margin-top: 1em">--log-dir <br>
Directory where to place the logfile. This option may also
be set using the environment variable ESOREX_LOG_DIR.
[.]</p>

<p style="margin-top: 1em">--log-file <br>
Filename of logfile. This option may also be set using the
environment variable ESOREX_LOG_FILE. [esorex.log]</p>

<p style="margin-top: 1em">--log-level <br>
Controls the severity level of messages that will be printed
to the logfile. This option may also be set using the
environment variable ESOREX_LOG_LEVEL. &lt;debug | info |
<br>
warning | error | off&gt; [info]</p>

<p style="margin-top: 1em">--no-datamd5 <br>
Disables the computation of the MD5 data hash for FITS
product files. This option may also be set using the
environment variable ESOREX_NO_DATAMD5. [FALSE]</p>

<p style="margin-top: 1em">--no-checksum <br>
Disables the computation of the standard FITS product
checksums. This option may also be set using the environment
variable ESOREX_NO_CHECKSUM. [FALSE]</p>

<p style="margin-top: 1em">--man-page <br>
Display a manual page for the specified recipe, and then
exit. Note that this option only applies to recipes, and
that it does nothing for esorex by itself. See also the <br>
&rsquo;--help&rsquo; option. This option may also be set
using the environment variable ESOREX_MAN_PAGE. [FALSE]</p>

<p style="margin-top: 1em">--mem-check <br>
Report on memory status at completion of recipe execution.
This option may also be set using the environment variable
ESOREX_MEM_CHECK. [FALSE]</p>

<p style="margin-top: 1em">--msg-level <br>
Controls the severity level of messages that will be printed
to the terminal. This option may also be set using the
environment variable ESOREX_MSG_LEVEL. &lt;debug | info |
<br>
warning | error | off&gt; [info]</p>

<p style="margin-top: 1em">--output-dir <br>
The directory where the product files should be finally
moved to (all products are first created in the current
dir). This option may also be set using the environment <br>
variable ESOREX_OUTPUT_DIR. [.]</p>

<p style="margin-top: 1em">--output-prefix <br>
Prefix applied to any output file. For example, specifying
&rsquo;pre&rsquo; would translate
&rsquo;filename.fits&rsquo; to &rsquo;pre_0000.fits&rsquo;.
See also the &rsquo;--suppress-prefix&rsquo; option. This
option <br>
may also be set using the environment variable
ESOREX_OUTPUT_PREFIX. [out]</p>

<p style="margin-top: 1em">--output-readonly <br>
When TRUE, any existing product files in the specified
output directory will be set to read-only, for user, group
and other. If FALSE, then EsoRex will use the default <br>
permissions for that account/directory. destroy any
pre-existing files. This option exists for the Paranal
operations environment. This option can additionally be used
to <br>
prevent EsoRex from overwriting pre-existing files. This
option may also be set using the environment variable
ESOREX_OUTPUT_READONLY. [FALSE]</p>

<p style="margin-top: 1em">--paf-config <br>
Configuration file for creation of PAF files. This option
may also be set using the environment variable
ESOREX_PAF_CONFIG. []</p>

<p style="margin-top: 1em">--params <br>
List the input parameters and their current settings
(whether from the command line or a configuration file) for
the esorex application. Parameters are labelled using the
<br>
parameter&rsquo;s alias. If a recipe is also specified, then
the list of its parameters will also be generated in the
same way. This option may also be set using the environment
<br>
variable ESOREX_PARAMS. [FALSE]</p>

<p style="margin-top: 1em">--products-sof <br>
Output file which contains the FITS files created by the
recipe. If the filename ends with extension .json then a
machine-readable JSON formatwill be used. This option may
<br>
also be set using the environment variable
ESOREX_PRODUCTS_SOF. []</p>

<p style="margin-top: 1em">--recipes <br>
Display a list of all available recipes (that are available
in the directory tree specified with
&rsquo;--recipe-dir&rsquo;). This option may also be set
using the environment vari&acirc; <br>
able ESOREX_RECIPES. [FALSE]</p>

<p style="margin-top: 1em">--recipe-config <br>
Configuration file for any selected recipe. This option may
also be set using the environment variable
ESOREX_RECIPE_CONFIG. []</p>

<p style="margin-top: 1em">--recipe-dir <br>
Directory containing recipe libraries. Note that esorex will
recursively search not only the specified directory, but all
sub-directories below it as well. Multiple <br>
directory heads may be specified, by separating the starting
paths with colons (:). This option may also be set using the
environment variable ESOREX_PLUGIN_DIR. [.]</p>

<p style="margin-top: 1em">--suppress-link <br>
When TRUE, no symbolic link is created to the output
product. However, if FALSE, then a symbolic link is created
in the directory specified with the option
&rsquo;--link-dir&rsquo; <br>
for each product that is created by the recipe. This option
may also be set using the environment variable
ESOREX_SUPPRESS_LINK. [TRUE]</p>

<p style="margin-top: 1em">--suppress-prefix <br>
When TRUE, the original name of the output product, as
produced by the recipe, is maintained. If FALSE, then the
name of the output file is changed to the
&quot;prefix_number&quot; <br>
format. The prefix can be altered using the
&rsquo;--output-prefix&rsquo; option. This option may also
be set using the environment variable
ESOREX_SUPPRESS_PREFIX. [FALSE]</p>

<p style="margin-top: 1em">--time Measure and show the
recipe&rsquo;s execution time. This option may also be set
using the environment variable ESOREX_TIME. [FALSE]</p>

<p style="margin-top: 1em">--unload-plugin <br>
When TRUE, the plugin is unloaded after execution. If FALSE,
the plugin is not unloaded after processing, so that a
software like, e.g. valgrind, can be used for debugging <br>
the executed recipe. This option may also be set using the
environment variable ESOREX_UNLOAD_PLUGIN. [TRUE]</p>

<p style="margin-top: 1em">ENVIRONMENT <br>
All options can be set as environment parameters as well.
See the previous paragraph for details.</p>

<p style="margin-top: 1em">FILES <br>
/etc/esorex.rc $HOME/.esorex/esorex.rc <br>
Default configuration files</p>

<p style="margin-top: 1em">The configuration file contains
the EsoRex options, less the &lsquo;--&Acirc;&acute; switch,
but prefixed with &lsquo;esorex.caller.&Acirc;&acute;. Blank
lines are ignored and lines beginning with
&lsquo;#&Acirc;&acute; are <br>
treated as comments.</p>

<p style="margin-top: 1em">Here is an example configuration
file.</p>

<p style="margin-top: 1em"># Example EsoRex configuration
file <br>
# <br>
esorex.caller.recipe-dir=/home/username/EsoRex/Plugins <br>
esorex.caller.log-dir=. <br>
esorex.caller.log-file=esorex.log <br>
esorex.caller.log-file=esorex.log <br>
esorex.caller.output-dir=. <br>
esorex.caller.output-prefix=out_</p>

<p style="margin-top: 1em">filename.sof <br>
A sof file contains a list of the input data. This data is
specified in an sof file (which is just a text file), where
each input file is specified with its associated <br>
classification and category. The format of each line in the
sof file is as follows:</p>

<p style="margin-top: 1em">full-path-to-file
classification</p>

<p style="margin-top: 1em">Optionally, a third column may
be provided. Permitted values are either RAW or CALIB. This
is for when a recipe does not identify the type of input
file, but as all ESO <br>
recipes are required to do so, this column is typically not
needed.</p>

<p style="margin-top: 1em">An example sof file, for the
mythological &quot;ZIMOS&quot; instrument, might look like
this:</p>


<p style="margin-top: 1em">/data/mos/ZIMOS.03-12-26T01:05:06.fits
MOS_SCIENCE <br>
/data/mos/ZIMOS.03-12-26T01:26:00.fits MOS_SCIENCE <br>
/data/mos/ZIMOS.03-12-26T01:47:04.fits MOS_SCIENCE <br>
/data/cal/master_bias4.fits MASTER_BIAS <br>
/data/cal/grs_LR_red.3.tfits GRISM_TABLE <br>
/data/gasgano/extract_table2.fits EXTRACT_TABLE <br>
/data/cal/badpixel.3.tfits CCD_TABLE</p>

<p style="margin-top: 1em">For an concrete example for a
specific instrument, check the documentation for that
instrument.</p>

<p style="margin-top: 1em">HINTS <br>
File permissions <br>
When a recipe is used with the --suppress-prefix option, and
the --output-dir is set to the current working directory,
then the first execution of a recipe will work cor&acirc;
<br>
rectly, but subsequent executions may fail. This is due to
output products being given &lsquo;read-only&Acirc;&acute;
permission (to avoid the potential inadvertant loss of
products). The <br>
recipe itself is unable to modify the permissions, and thus
it fails when attempting to create the file. The solution
(other than using a different output directory or <br>
prefixes) is to change the permission of these output files
or delete them prior to any subsequent execution of that
recipe.</p>

<p style="margin-top: 1em">This problem is less likely to
occur in EsoRex v2+, due to the replacement of the
--output-overwrite option with the --output-readonly (which
is disabled by default). How&acirc; <br>
ever, a determined user can still reach this situation, in
which case the non-readable products must have their
permissions changed, as described above.</p>

<p style="margin-top: 1em">Configuration files <br>
When creating configuration files, if the the recipe is
provided on the command line, then EsoRex will generate the
configuration file for this recipe. If no recipe name <br>
is given, then EsoRex will generate a configuration file for
EsoRex itself. All configuration files are written in the
$HOME/.esorex/ directory.</p>

<p style="margin-top: 1em">Memory checking <br>
It is possible to get EsoRex to check for memory leaks in
the recipe that it is running, by enabling the --mem-check
option. Then, at the conclusion of the recipe execu&acirc;
<br>
tion, and after memory deallocation, a list of all remaining
allocated memory will be printed to screen. If there are no
memory leaks, then no addition output is dis&acirc; <br>
played.</p>

<p style="margin-top: 1em">AUTHOR <br>
Written by the CPL group (Pipeline System Department)
European Southern Observatory / SDD - Garching</p>

<p style="margin-top: 1em">REPORTING BUGS <br>
Report bugs to &lt;cpl-help@eso.org&gt;.</p>

<p style="margin-top: 1em">COPYRIGHT <br>
Copyright 2003-2012, European Southern Observatory.</p>

<p style="margin-top: 1em">esorex May 2016 ESOREX(1)</p>
<hr>
</body>
</html>
