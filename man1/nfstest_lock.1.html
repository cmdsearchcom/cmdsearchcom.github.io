<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:27:14 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>NFSTEST_LOCK(1) nfstest_lock 1.1 NFSTEST_LOCK(1)</p>

<p style="margin-top: 1em">NAME <br>
nfstest_lock - Locking tests</p>

<p style="margin-top: 1em">SYNOPSIS <br>
nfstest_lock --server &lt;server&gt; [--client
&lt;client&gt;] [options]</p>

<p style="margin-top: 1em">DESCRIPTION <br>
Basic locking tests verify that a lock is granted using
various arguments to fcntl. These include blocking and
non-blocking locks, read or write locks, where the file is
opened <br>
either for reading, writing or both. It also checks
different ranges including limit conditions.</p>

<p style="margin-top: 1em">Non-overlapping tests verity
that locks are granted on both the client under test and a
second process or a remote client when locking the same
file.</p>

<p style="margin-top: 1em">Overlapping tests verity that a
lock is granted on the client under test and a second
process or a remote client trying to lock the same file will
be denied if a non-blocking <br>
lock is issue or will be blocked if a blocking lock is issue
on the second process or remote client.</p>

<p style="margin-top: 1em">OPTIONS <br>
--version <br>
show program&rsquo;s version number and exit</p>

<p style="margin-top: 1em">-h, --help <br>
show this help message and exit</p>

<p style="margin-top: 1em">-f FILE, --file=FILE <br>
File where options are specified besides the system wide
file /etc/nfstest, user wide file $HOME/.nfstest or in the
current directory .nfstest file</p>

<p style="margin-top: 1em">NFS specific options: <br>
-s SERVER, --server=SERVER <br>
Server name or IP address</p>

<p style="margin-top: 1em">-e EXPORT, --export=EXPORT <br>
Exported file system to mount [default: &rsquo;/&rsquo;]</p>

<p style="margin-top: 1em">--nfsversion=NFSVERSION <br>
NFS version, e.g., 3, 4, 4.1, etc. [default: 4.1]</p>

<p style="margin-top: 1em">-m MTPOINT, --mtpoint=MTPOINT
<br>
Mount point [default: &rsquo;/mnt/t&rsquo;]</p>

<p style="margin-top: 1em">-p PORT, --port=PORT <br>
NFS server port [default: 2049]</p>

<p style="margin-top: 1em">--proto=PROTO <br>
NFS protocol name [default: &rsquo;tcp&rsquo;]</p>

<p style="margin-top: 1em">--sec=SEC <br>
Security flavor [default: &rsquo;sys&rsquo;]</p>

<p style="margin-top: 1em">-o MTOPTS, --mtopts=MTOPTS <br>
Mount options [default:
&rsquo;hard,rsize=4096,wsize=4096&rsquo;]</p>

<p style="margin-top: 1em">--datadir=DATADIR <br>
Data directory where files are created, directory is created
on the mount point [default: &rsquo;&rsquo;]</p>

<p style="margin-top: 1em">Logging options: <br>
-v VERBOSE, --verbose=VERBOSE <br>
Verbose level for debug messages [default:
&rsquo;none&rsquo;]</p>

<p style="margin-top: 1em">--tverbose=TVERBOSE <br>
Verbose level for test messages [default:
&rsquo;1&rsquo;]</p>

<p style="margin-top: 1em">--createlog <br>
Create log file</p>

<p style="margin-top: 1em">--warnings <br>
Display warnings</p>

<p style="margin-top: 1em">--tag=TAG <br>
Informational tag, it is displayed as an INFO message
[default: &rsquo;&rsquo;]</p>

<p style="margin-top: 1em">Packet trace options: <br>
--createtraces <br>
Create a packet trace for each test</p>

<p style="margin-top: 1em">--tbsize=TBSIZE <br>
Capture buffer size for tcpdump [default:
&rsquo;50000&rsquo;]</p>

<p style="margin-top: 1em">--trcdelay=TRCDELAY <br>
Seconds to delay before stopping packet trace [default:
0.0]</p>

<p style="margin-top: 1em">--keeptraces <br>
Do not remove any trace files [default: remove trace files
if no errors]</p>

<p style="margin-top: 1em">--rmtraces <br>
Remove trace files [default: remove trace files if no
errors]</p>

<p style="margin-top: 1em">-i INTERFACE,
--interface=INTERFACE <br>
Device interface [default: automatically selected]</p>

<p style="margin-top: 1em">--subtraces <br>
Create a packet trace for each sub-test. Use it with caution
since it will create a lot of packet traces. Use
--createtraces instead unless trying to get a packet trace
<br>
for a specific sub-test. Best if it is used in combination
with the --runtest option.</p>

<p style="margin-top: 1em">File options: <br>
--nfiles=NFILES <br>
Number of files to create [default: 2]</p>

<p style="margin-top: 1em">--filesize=FILESIZE <br>
File size to use for test files [default: 65536]</p>

<p style="margin-top: 1em">--rsize=RSIZE <br>
Read size to use when reading files [default: 4096]</p>

<p style="margin-top: 1em">--wsize=WSIZE <br>
Write size to use when writing files [default: 4096]</p>

<p style="margin-top: 1em">--iodelay=IODELAY <br>
Seconds to delay I/O operations [default: 0.1]</p>

<p style="margin-top: 1em">--offset-delta=OFFSET_DELTA <br>
Read/Write offset delta [default: 4096]</p>

<p style="margin-top: 1em">Path options: <br>
--sudo=SUDO <br>
Full path of binary for sudo [default:
&rsquo;/usr/bin/sudo&rsquo;]</p>

<p style="margin-top: 1em">--tcpdump=TCPDUMP <br>
Full path of binary for tcpdump [default:
&rsquo;/usr/sbin/tcpdump&rsquo;]</p>

<p style="margin-top: 1em">--iptables=IPTABLES <br>
Full path of binary for iptables [default:
&rsquo;/sbin/iptables&rsquo;]</p>

<p style="margin-top: 1em">--messages=MESSAGES <br>
Full path of log messages file [default:
&rsquo;/var/log/messages&rsquo;]</p>

<p style="margin-top: 1em">--tmpdir=TMPDIR <br>
Temporary directory [default: &rsquo;/tmp&rsquo;]</p>

<p style="margin-top: 1em">Debug options: <br>
--nocleanup <br>
Do not cleanup created files</p>

<p style="margin-top: 1em">--bugmsgs=BUGMSGS <br>
File containing test messages to mark as bugs if they
failed</p>

<p style="margin-top: 1em">--ignore <br>
Ignore all bugs given by bugmsgs</p>

<p style="margin-top: 1em">--nomount <br>
Do not mount server and run the tests on local disk
space</p>

<p style="margin-top: 1em">--basename=BASENAME <br>
Base name for all files and logs [default: automatically
generated]</p>

<p style="margin-top: 1em">--nfsdebug=NFSDEBUG <br>
Set NFS kernel debug flags and save log messages [default:
&rsquo;&rsquo;]</p>

<p style="margin-top: 1em">--rpcdebug=RPCDEBUG <br>
Set RPC kernel debug flags and save log messages [default:
&rsquo;&rsquo;]</p>

<p style="margin-top: 1em">Test options: <br>
--runtest=RUNTEST <br>
Comma separated list of tests to run, if list starts with a
&rsquo;^&rsquo; then all tests are run except the ones
listed [default: &rsquo;all&rsquo;]</p>

<p style="margin-top: 1em">--client=CLIENT <br>
Remote NFS client used for conflicting lock tests</p>

<p style="margin-top: 1em">--offset=OFFSET <br>
Offset of first lock granted [default: 4096]</p>

<p style="margin-top: 1em">--length=LENGTH <br>
Length of first lock granted [default: 4096]</p>

<p style="margin-top: 1em">--unlock-delay=UNLOCK_DELAY <br>
Time in seconds to unlock first lock [default: 2.0]</p>

<p style="margin-top: 1em">--lockw-timeout=LOCKW_TIMEOUT
<br>
Time in seconds to wait for blocked lock after conflicting
lock has been released [default: 30]</p>

<p style="margin-top: 1em">--opentype=OPENTYPE <br>
List of open types to test [default: read,write,rdwr]</p>

<p style="margin-top: 1em">--locktype=LOCKTYPE <br>
List of lock types to test [default: read,write]</p>

<p style="margin-top: 1em">--opentype2=OPENTYPE2 <br>
List of open types to test on remote client [default:
read,write,rdwr]</p>

<p style="margin-top: 1em">--locktype2=LOCKTYPE2 <br>
List of lock types to test on remote client [default:
read,write]</p>

<p style="margin-top: 1em">--setlock=SETLOCK <br>
List of set lock types to test [default:
immediate,block]</p>

<p style="margin-top: 1em">TESTS <br>
btest01 <br>
Basic locking tests <br>
These tests verify that a lock is granted using various
arguments <br>
to fcntl. These include blocking and non-blocking locks,
read or <br>
write locks, where the file is opened either for reading,
writing <br>
or both. It also checks different ranges including limit
conditions.</p>

<p style="margin-top: 1em">noverlap <br>
Run all non-overlapping locking tests: nptest01, nptest02,
nptest03, <br>
nptest04, nctest01, nctest02, nctest03, nctest04</p>

<p style="margin-top: 1em">nptest <br>
Run all non-overlapping locking tests using a second
process: nptest01, <br>
nptest02, nptest03, nptest04</p>

<p style="margin-top: 1em">nptest01 <br>
Locking non-overlapping range from a second process where
end2 &lt; start1 <br>
process1: |------------------| <br>
process2: |--------|</p>

<p style="margin-top: 1em">nptest02 <br>
Locking non-overlapping range from a second process where
end2 == start1 - 1 <br>
process1: |------------------| <br>
process2: |------------------|</p>

<p style="margin-top: 1em">nptest03 <br>
Locking non-overlapping range from a second process where
start2 &gt; end1 <br>
process1: |------------------| <br>
process2: |--------|</p>

<p style="margin-top: 1em">nptest04 <br>
Locking non-overlapping range from a second process where
start2 == end1 + 1 <br>
process1: |------------------| <br>
process2: |------------------|</p>

<p style="margin-top: 1em">nctest <br>
Run all non-overlapping locking tests using a second client:
nctest01, <br>
nctest02, nctest03, nctest04</p>

<p style="margin-top: 1em">nctest01 <br>
Locking non-overlapping range from a second client where
end2 &lt; start1 <br>
client1: |------------------| <br>
client2: |--------|</p>

<p style="margin-top: 1em">nctest02 <br>
Locking non-overlapping range from a second client where
end2 == start1 - 1 <br>
client1: |------------------| <br>
client2: |------------------|</p>

<p style="margin-top: 1em">nctest03 <br>
Locking non-overlapping range from a second client where
start2 &gt; end1 <br>
client1: |------------------| <br>
client2: |--------|</p>

<p style="margin-top: 1em">nctest04 <br>
Locking non-overlapping range from a second client where
start2 == end1 + 1 <br>
client1: |------------------| <br>
client2: |------------------|</p>

<p style="margin-top: 1em">overlap <br>
Run all overlapping locking tests: optest01, optest02,
optest03, <br>
optest04, optest05, optest06, optest07, optest08, octest01,
octest02, <br>
octest03, octest04, octest05, octest06, octest07,
octest08</p>

<p style="margin-top: 1em">optest <br>
Run all overlapping locking tests using a second process:
optest01, <br>
optest02, optest03, optest04, optest05, optest06, optest07,
optest08</p>

<p style="margin-top: 1em">optest01 <br>
Locking same range from a second process <br>
process1: |------------------| <br>
process2: |------------------|</p>

<p style="margin-top: 1em">optest02 <br>
Locking overlapping range from a second process where start2
&lt; start1 <br>
process1: |------------------| <br>
process2: |------------------|</p>

<p style="margin-top: 1em">optest03 <br>
Locking overlapping range from a second process where end2
&gt; end1 <br>
process1: |------------------| <br>
process2: |------------------|</p>

<p style="margin-top: 1em">optest04 <br>
Locking overlapping range from a second process where range2
is entirely within range1 <br>
process1: |------------------| <br>
process2: |--------|</p>

<p style="margin-top: 1em">optest05 <br>
Locking overlapping range from a second process where range1
is entirely within range2 <br>
process1: |------------------| <br>
process2: |----------------------------|</p>

<p style="margin-top: 1em">optest06 <br>
Locking full file range from a second process</p>

<p style="margin-top: 1em">optest07 <br>
Locking overlapping range from a second process where end2
== start1 <br>
process1: |------------------| <br>
process2: |------------------|</p>

<p style="margin-top: 1em">optest08 <br>
Locking overlapping range from a second process where start2
== end1 <br>
process1: |------------------| <br>
process2: |------------------|</p>

<p style="margin-top: 1em">octest <br>
Run all overlapping locking tests using a second client:
octest01, <br>
octest02, octest03, octest04, octest05, octest06, octest07,
octest08</p>

<p style="margin-top: 1em">octest01 <br>
Locking same range from a second client <br>
client1: |------------------| <br>
client2: |------------------|</p>

<p style="margin-top: 1em">octest02 <br>
Locking overlapping range from a second client where start2
&lt; start1 <br>
client1: |------------------| <br>
client2: |------------------|</p>

<p style="margin-top: 1em">octest03 <br>
Locking overlapping range from a second client where end2
&gt; end1 <br>
client1: |------------------| <br>
client2: |------------------|</p>

<p style="margin-top: 1em">octest04 <br>
Locking overlapping range from a second client where range2
is entirely within range1 <br>
client1: |------------------| <br>
client2: |--------|</p>

<p style="margin-top: 1em">octest05 <br>
Locking overlapping range from a second client where range1
is entirely within range2 <br>
client1: |------------------| <br>
client2: |----------------------------|</p>

<p style="margin-top: 1em">octest06 <br>
Locking full file range from a second client</p>

<p style="margin-top: 1em">octest07 <br>
Locking overlapping range from a second client where end2 ==
start1 <br>
client1: |------------------| <br>
client2: |------------------|</p>

<p style="margin-top: 1em">octest08 <br>
Locking overlapping range from a second client where start2
== end1 <br>
client1: |------------------| <br>
client2: |------------------|</p>

<p style="margin-top: 1em">NOTES <br>
The user id in the local host and the host specified by
--client must have access to run commands as root using the
&rsquo;sudo&rsquo; command without the need for a
password.</p>

<p style="margin-top: 1em">The user id must be able to
&rsquo;ssh&rsquo; to remote host without the need for a
password.</p>

<p style="margin-top: 1em">SEE ALSO <br>
nfstest.rexec(3), nfstest.test_util(3), nfstest_alloc(1),
nfstest_cache(1), nfstest_delegation(1), nfstest_dio(1),
nfstest_file(1), nfstest_interop(1), nfstest_io(1), <br>
nfstest_pkt(1), nfstest_pnfs(1), nfstest_posix(1),
nfstest_sparse(1), nfstest_xid(1)</p>

<p style="margin-top: 1em">BUGS <br>
No known bugs.</p>

<p style="margin-top: 1em">AUTHOR <br>
Jorge Mora (mora@netapp.com)</p>

<p style="margin-top: 1em">NFStest 2.1.1 23 November 2015
NFSTEST_LOCK(1)</p>
<hr>
</body>
</html>
