<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>NFSTEST_LOCK(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">NFSTEST_LOCK(1)</td>
    <td class="head-vol">nfstest_lock 1.1</td>
    <td class="head-rtitle">NFSTEST_LOCK(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
nfstest_lock - Locking tests
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
nfstest_lock --server &lt;server&gt; [--client &lt;client&gt;] [options]
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
Basic locking tests verify that a lock is granted using various arguments to
  fcntl. These include blocking and non-blocking locks, read or write locks,
  where the file is opened either for reading, writing or both. It also checks
  different ranges including limit conditions.
<div style="height: 1.00em;">&#x00A0;</div>
Non-overlapping tests verity that locks are granted on both the client under
  test and a second process or a remote client when locking the same file.
<div style="height: 1.00em;">&#x00A0;</div>
Overlapping tests verity that a lock is granted on the client under test and a
  second process or a remote client trying to lock the same file will be denied
  if a non-blocking lock is issue or will be blocked if a blocking lock is issue
  on the second process or remote client.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag">--version</dt>
  <dd class="It-tag">show program's version number and exit</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-h, --help</dt>
  <dd class="It-tag">show this help message and exit</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-f FILE, --file=FILE</dt>
  <dd class="It-tag">File where options are specified besides the system wide
      file /etc/nfstest, user wide file $HOME/.nfstest or in the current
      directory .nfstest file
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="NFS_specific_options:"><a class="selflink" href="#NFS_specific_options:">NFS
  specific options:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">-s SERVER, --server=SERVER</dt>
  <dd class="It-tag">Server name or IP address</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-e EXPORT, --export=EXPORT</dt>
  <dd class="It-tag">Exported file system to mount [default: '/']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--nfsversion=NFSVERSION</dt>
  <dd class="It-tag">NFS version, e.g., 3, 4, 4.1, etc. [default: 4.1]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-m MTPOINT, --mtpoint=MTPOINT</dt>
  <dd class="It-tag">Mount point [default: '/mnt/t']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-p PORT, --port=PORT</dt>
  <dd class="It-tag">NFS server port [default: 2049]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--proto=PROTO</dt>
  <dd class="It-tag">NFS protocol name [default: 'tcp']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--sec=SEC</dt>
  <dd class="It-tag">Security flavor [default: 'sys']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-o MTOPTS, --mtopts=MTOPTS</dt>
  <dd class="It-tag">Mount options [default: 'hard,rsize=4096,wsize=4096']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--datadir=DATADIR</dt>
  <dd class="It-tag">Data directory where files are created, directory is
      created on the mount point [default: '']
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="Logging_options:"><a class="selflink" href="#Logging_options:">Logging
  options:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">-v VERBOSE, --verbose=VERBOSE</dt>
  <dd class="It-tag">Verbose level for debug messages [default: 'none']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--tverbose=TVERBOSE</dt>
  <dd class="It-tag">Verbose level for test messages [default: '1']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--createlog</dt>
  <dd class="It-tag">Create log file</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--warnings</dt>
  <dd class="It-tag">Display warnings</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--tag=TAG</dt>
  <dd class="It-tag">Informational tag, it is displayed as an INFO message
      [default: '']
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="Packet_trace_options:"><a class="selflink" href="#Packet_trace_options:">Packet
  trace options:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">--createtraces</dt>
  <dd class="It-tag">Create a packet trace for each test</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--tbsize=TBSIZE</dt>
  <dd class="It-tag">Capture buffer size for tcpdump [default: '50000']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--trcdelay=TRCDELAY</dt>
  <dd class="It-tag">Seconds to delay before stopping packet trace [default:
      0.0]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--keeptraces</dt>
  <dd class="It-tag">Do not remove any trace files [default: remove trace files
      if no errors]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--rmtraces</dt>
  <dd class="It-tag">Remove trace files [default: remove trace files if no
      errors]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-i INTERFACE, --interface=INTERFACE</dt>
  <dd class="It-tag">Device interface [default: automatically selected]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--subtraces</dt>
  <dd class="It-tag">Create a packet trace for each sub-test. Use it with
      caution since it will create a lot of packet traces. Use --createtraces
      instead unless trying to get a packet trace for a specific sub-test. Best
      if it is used in combination with the --runtest option.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="File_options:"><a class="selflink" href="#File_options:">File
  options:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">--nfiles=NFILES</dt>
  <dd class="It-tag">Number of files to create [default: 2]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--filesize=FILESIZE</dt>
  <dd class="It-tag">File size to use for test files [default: 65536]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--rsize=RSIZE</dt>
  <dd class="It-tag">Read size to use when reading files [default: 4096]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--wsize=WSIZE</dt>
  <dd class="It-tag">Write size to use when writing files [default: 4096]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--iodelay=IODELAY</dt>
  <dd class="It-tag">Seconds to delay I/O operations [default: 0.1]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--offset-delta=OFFSET_DELTA</dt>
  <dd class="It-tag">Read/Write offset delta [default: 4096]
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="Path_options:"><a class="selflink" href="#Path_options:">Path
  options:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">--sudo=SUDO</dt>
  <dd class="It-tag">Full path of binary for sudo [default:
    '/usr/bin/sudo']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--tcpdump=TCPDUMP</dt>
  <dd class="It-tag">Full path of binary for tcpdump [default:
      '/usr/sbin/tcpdump']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--iptables=IPTABLES</dt>
  <dd class="It-tag">Full path of binary for iptables [default:
      '/sbin/iptables']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--messages=MESSAGES</dt>
  <dd class="It-tag">Full path of log messages file [default:
      '/var/log/messages']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--tmpdir=TMPDIR</dt>
  <dd class="It-tag">Temporary directory [default: '/tmp']
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="Debug_options:"><a class="selflink" href="#Debug_options:">Debug
  options:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">--nocleanup</dt>
  <dd class="It-tag">Do not cleanup created files</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--bugmsgs=BUGMSGS</dt>
  <dd class="It-tag">File containing test messages to mark as bugs if they
      failed</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--ignore</dt>
  <dd class="It-tag">Ignore all bugs given by bugmsgs</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--nomount</dt>
  <dd class="It-tag">Do not mount server and run the tests on local disk
    space</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--basename=BASENAME</dt>
  <dd class="It-tag">Base name for all files and logs [default: automatically
      generated]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--nfsdebug=NFSDEBUG</dt>
  <dd class="It-tag">Set NFS kernel debug flags and save log messages [default:
      '']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--rpcdebug=RPCDEBUG</dt>
  <dd class="It-tag">Set RPC kernel debug flags and save log messages [default:
      '']
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="Test_options:"><a class="selflink" href="#Test_options:">Test
  options:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">--runtest=RUNTEST</dt>
  <dd class="It-tag">Comma separated list of tests to run, if list starts with a
      '^' then all tests are run except the ones listed [default: 'all']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--client=CLIENT</dt>
  <dd class="It-tag">Remote NFS client used for conflicting lock tests</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--offset=OFFSET</dt>
  <dd class="It-tag">Offset of first lock granted [default: 4096]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--length=LENGTH</dt>
  <dd class="It-tag">Length of first lock granted [default: 4096]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--unlock-delay=UNLOCK_DELAY</dt>
  <dd class="It-tag">Time in seconds to unlock first lock [default: 2.0]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--lockw-timeout=LOCKW_TIMEOUT</dt>
  <dd class="It-tag">Time in seconds to wait for blocked lock after conflicting
      lock has been released [default: 30]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--opentype=OPENTYPE</dt>
  <dd class="It-tag">List of open types to test [default: read,write,rdwr]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--locktype=LOCKTYPE</dt>
  <dd class="It-tag">List of lock types to test [default: read,write]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--opentype2=OPENTYPE2</dt>
  <dd class="It-tag">List of open types to test on remote client [default:
      read,write,rdwr]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--locktype2=LOCKTYPE2</dt>
  <dd class="It-tag">List of lock types to test on remote client [default:
      read,write]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--setlock=SETLOCK</dt>
  <dd class="It-tag">List of set lock types to test [default:
    immediate,block]</dd>
</dl>
<h1 class="Sh" title="Sh" id="TESTS"><a class="selflink" href="#TESTS">TESTS</a></h1>
<h2 class="Ss" title="Ss" id="btest01"><a class="selflink" href="#btest01">btest01</a></h2>
<pre>
Basic locking tests
These tests verify that a lock is granted using various arguments
to fcntl. These include blocking and non-blocking locks, read or
write locks, where the file is opened either for reading, writing
or both. It also checks different ranges including limit conditions.
</pre>
<h2 class="Ss" title="Ss" id="noverlap"><a class="selflink" href="#noverlap">noverlap</a></h2>
<pre>
Run all non-overlapping locking tests: nptest01, nptest02, nptest03,
nptest04, nctest01, nctest02, nctest03, nctest04
</pre>
<h2 class="Ss" title="Ss" id="nptest"><a class="selflink" href="#nptest">nptest</a></h2>
<pre>
Run all non-overlapping locking tests using a second process: nptest01,
nptest02, nptest03, nptest04
</pre>
<h2 class="Ss" title="Ss" id="nptest01"><a class="selflink" href="#nptest01">nptest01</a></h2>
<pre>
Locking non-overlapping range from a second process where end2 &lt; start1
process1:                     |------------------|
process2: |--------|
</pre>
<h2 class="Ss" title="Ss" id="nptest02"><a class="selflink" href="#nptest02">nptest02</a></h2>
<pre>
Locking non-overlapping range from a second process where end2 == start1 - 1
process1:                     |------------------|
process2: |------------------|
</pre>
<h2 class="Ss" title="Ss" id="nptest03"><a class="selflink" href="#nptest03">nptest03</a></h2>
<pre>
Locking non-overlapping range from a second process where start2 &gt; end1
process1: |------------------|
process2:                               |--------|
</pre>
<h2 class="Ss" title="Ss" id="nptest04"><a class="selflink" href="#nptest04">nptest04</a></h2>
<pre>
Locking non-overlapping range from a second process where start2 == end1 + 1
process1: |------------------|
process2:                     |------------------|
</pre>
<h2 class="Ss" title="Ss" id="nctest"><a class="selflink" href="#nctest">nctest</a></h2>
<pre>
Run all non-overlapping locking tests using a second client: nctest01,
nctest02, nctest03, nctest04
</pre>
<h2 class="Ss" title="Ss" id="nctest01"><a class="selflink" href="#nctest01">nctest01</a></h2>
<pre>
Locking non-overlapping range from a second client where end2 &lt; start1
client1:                      |------------------|
client2:  |--------|
</pre>
<h2 class="Ss" title="Ss" id="nctest02"><a class="selflink" href="#nctest02">nctest02</a></h2>
<pre>
Locking non-overlapping range from a second client where end2 == start1 - 1
client1:                      |------------------|
client2:  |------------------|
</pre>
<h2 class="Ss" title="Ss" id="nctest03"><a class="selflink" href="#nctest03">nctest03</a></h2>
<pre>
Locking non-overlapping range from a second client where start2 &gt; end1
client1:  |------------------|
client2:                                |--------|
</pre>
<h2 class="Ss" title="Ss" id="nctest04"><a class="selflink" href="#nctest04">nctest04</a></h2>
<pre>
Locking non-overlapping range from a second client where start2 == end1 + 1
client1:  |------------------|
client2:                      |------------------|
</pre>
<h2 class="Ss" title="Ss" id="overlap"><a class="selflink" href="#overlap">overlap</a></h2>
<pre>
Run all overlapping locking tests: optest01, optest02, optest03,
optest04, optest05, optest06, optest07, optest08, octest01, octest02,
octest03, octest04, octest05, octest06, octest07, octest08
</pre>
<h2 class="Ss" title="Ss" id="optest"><a class="selflink" href="#optest">optest</a></h2>
<pre>
Run all overlapping locking tests using a second process: optest01,
optest02, optest03, optest04, optest05, optest06, optest07, optest08
</pre>
<h2 class="Ss" title="Ss" id="optest01"><a class="selflink" href="#optest01">optest01</a></h2>
<pre>
Locking same range from a second process
process1:                     |------------------|
process2:                     |------------------|
</pre>
<h2 class="Ss" title="Ss" id="optest02"><a class="selflink" href="#optest02">optest02</a></h2>
<pre>
Locking overlapping range from a second process where start2 &lt; start1
process1:                     |------------------|
process2:           |------------------|
</pre>
<h2 class="Ss" title="Ss" id="optest03"><a class="selflink" href="#optest03">optest03</a></h2>
<pre>
Locking overlapping range from a second process where end2 &gt; end1
process1:                     |------------------|
process2:                               |------------------|
</pre>
<h2 class="Ss" title="Ss" id="optest04"><a class="selflink" href="#optest04">optest04</a></h2>
<pre>
Locking overlapping range from a second process where range2 is entirely within range1
process1:                     |------------------|
process2:                          |--------|
</pre>
<h2 class="Ss" title="Ss" id="optest05"><a class="selflink" href="#optest05">optest05</a></h2>
<pre>
Locking overlapping range from a second process where range1 is entirely within range2
process1:                     |------------------|
process2:                |----------------------------|
</pre>
<h2 class="Ss" title="Ss" id="optest06"><a class="selflink" href="#optest06">optest06</a></h2>
<pre>
Locking full file range from a second process
</pre>
<h2 class="Ss" title="Ss" id="optest07"><a class="selflink" href="#optest07">optest07</a></h2>
<pre>
Locking overlapping range from a second process where end2 == start1
process1:                     |------------------|
process2:  |------------------|
</pre>
<h2 class="Ss" title="Ss" id="optest08"><a class="selflink" href="#optest08">optest08</a></h2>
<pre>
Locking overlapping range from a second process where start2 == end1
process1:  |------------------|
process2:                     |------------------|
</pre>
<h2 class="Ss" title="Ss" id="octest"><a class="selflink" href="#octest">octest</a></h2>
<pre>
Run all overlapping locking tests using a second client: octest01,
octest02, octest03, octest04, octest05, octest06, octest07, octest08
</pre>
<h2 class="Ss" title="Ss" id="octest01"><a class="selflink" href="#octest01">octest01</a></h2>
<pre>
Locking same range from a second client
client1:                      |------------------|
client2:                      |------------------|
</pre>
<h2 class="Ss" title="Ss" id="octest02"><a class="selflink" href="#octest02">octest02</a></h2>
<pre>
Locking overlapping range from a second client where start2 &lt; start1
client1:                      |------------------|
client2:            |------------------|
</pre>
<h2 class="Ss" title="Ss" id="octest03"><a class="selflink" href="#octest03">octest03</a></h2>
<pre>
Locking overlapping range from a second client where end2 &gt; end1
client1:                      |------------------|
client2:                                |------------------|
</pre>
<h2 class="Ss" title="Ss" id="octest04"><a class="selflink" href="#octest04">octest04</a></h2>
<pre>
Locking overlapping range from a second client where range2 is entirely within range1
client1:                      |------------------|
client2:                           |--------|
</pre>
<h2 class="Ss" title="Ss" id="octest05"><a class="selflink" href="#octest05">octest05</a></h2>
<pre>
Locking overlapping range from a second client where range1 is entirely within range2
client1:                      |------------------|
client2:                 |----------------------------|
</pre>
<h2 class="Ss" title="Ss" id="octest06"><a class="selflink" href="#octest06">octest06</a></h2>
<pre>
Locking full file range from a second client
</pre>
<h2 class="Ss" title="Ss" id="octest07"><a class="selflink" href="#octest07">octest07</a></h2>
<pre>
Locking overlapping range from a second client where end2 == start1
client1:                      |------------------|
client2:   |------------------|
</pre>
<h2 class="Ss" title="Ss" id="octest08"><a class="selflink" href="#octest08">octest08</a></h2>
<pre>
Locking overlapping range from a second client where start2 == end1
client1:   |------------------|
client2:                      |------------------|
</pre>
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
The user id in the local host and the host specified by --client must have
  access to run commands as root using the 'sudo' command without the need for a
  password.
<div style="height: 1.00em;">&#x00A0;</div>
The user id must be able to 'ssh' to remote host without the need for a
  password.
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>nfstest.rexec(3),</b> <b>nfstest.test_util(3),</b> <b>nfstest_alloc(1),</b>
  <b>nfstest_cache(1),</b> <b>nfstest_delegation(1),</b> <b>nfstest_dio(1),</b>
  <b>nfstest_file(1),</b> <b>nfstest_interop(1),</b> <b>nfstest_io(1),</b>
  <b>nfstest_pkt(1),</b> <b>nfstest_pnfs(1),</b> <b>nfstest_posix(1),</b>
  <b>nfstest_sparse(1),</b> <b>nfstest_xid(1)</b>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
No known bugs.
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Jorge Mora (mora@netapp.com)</div>
<table class="foot">
  <tr>
    <td class="foot-date">23 November 2015</td>
    <td class="foot-os">NFStest 2.1.1</td>
  </tr>
</table>
</body>
</html>
