<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>PUNGI(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">PUNGI(1)</td>
    <td class="head-vol">Pungi</td>
    <td class="head-rtitle">PUNGI(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
pungi - Pungi Documentation
<div style="height: 1.00em;">&#x00A0;</div>
Contents:
<h1 class="Sh" title="Sh" id="ABOUT_PUNGI"><a class="selflink" href="#ABOUT_PUNGI">ABOUT
  PUNGI</a></h1>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 2.50ex;">[image: Pungi Logo] [image]</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<i>Pungi</i> is a distribution compose tool.
<div style="height: 1.00em;">&#x00A0;</div>
Composes are release snapshots that contain release deliverables such as:
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">installation trees</dd>
</dl>
<div style="margin-left: 2.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">RPMs</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">repodata</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">comps</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">(bootable) ISOs</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">kickstart trees</dd>
</dl>
<div style="margin-left: 2.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">anaconda images</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">images for PXE boot</dd>
</dl>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Tool_overview"><a class="selflink" href="#Tool_overview">Tool
  overview</a></h2>
<i>Pungi</i> consists of multiple separate executables backed by a common
  library.
<div style="height: 1.00em;">&#x00A0;</div>
The main entry-point is the <b>pungi-koji</b> script. It loads the compose
  configuration and kicks off the process. Composing itself is done in phases.
  Each phase is responsible for generating some artifacts on disk and updating
  the <b>compose</b> object that is threaded through all the phases.
<div style="height: 1.00em;">&#x00A0;</div>
<i>Pungi</i> itself does not actually do that much. Most of the actual work is
  delegated to separate executables. <i>Pungi</i> just makes sure that all the
  commands are invoked in the appropriate order and with correct arguments. It
  also moves the artifacts to correct locations.
<h2 class="Ss" title="Ss" id="Links"><a class="selflink" href="#Links">Links</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Upstream GIT: <i>https://pagure.io/pungi/</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Issue tracker: <i>https://pagure.io/pungi/issues</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Questions can be asked on <i>#fedora-releng</i> IRC channel
      on FreeNode</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Origin_of_name"><a class="selflink" href="#Origin_of_name">Origin
  of name</a></h2>
The name <i>Pungi</i> comes from the instrument used to charm snakes.
  <i>Anaconda</i> being the software Pungi was manipulating, and anaconda being
  a snake, led to the referential naming.
<div style="height: 1.00em;">&#x00A0;</div>
The first name, which was suggested by Seth Vidal, was <i>FIST</i>,
  <i>Fedora</i> <i>Installation &lt;Something&gt; Tool</i>. That name was
  quickly discarded and replaced with Pungi.
<div style="height: 1.00em;">&#x00A0;</div>
There was also a bit of an inside joke that when said aloud, it could sound like
  punji, which is <i>a sharpened stick at the bottom of a</i> <i>trap</i>. Kind
  of like software&#x2026;
<h1 class="Sh" title="Sh" id="CONTRIBUTING_TO_PUNGI"><a class="selflink" href="#CONTRIBUTING_TO_PUNGI">CONTRIBUTING
  TO PUNGI</a></h1>
<h2 class="Ss" title="Ss" id="Set_up_development_environment"><a class="selflink" href="#Set_up_development_environment">Set
  up development environment</a></h2>
In order to work on <i>Pungi</i>, you should install recent version of
  <i>Fedora</i>. These packages will have to installed:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">createrepo</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">createrepo_c</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">cvs</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">genisoimage</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">gettext</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">git</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">isomd5sum</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">jigdo</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">kobo</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">kobo-rpmlib</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">koji</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">libselinux-python</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">lorax</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">python-jsonschema</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">python-kickstart</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">python-lockfile</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">python-lxml</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">python2-multilib</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">python-productmd</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">repoview</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">syslinux</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">yum</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">yum-utils</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
For running unit tests, these packages are recommended as well:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">python-mock</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">python-nose</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">python-nose-cov</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
While being difficult, it is possible to work on <i>Pungi</i> using
  <i>virtualenv</i>. Install <i>python-virtualenvwrapper</i> and use following
  steps. It will link system libraries into the virtual environment and install
  all packages preferably from PyPI or from tarball. You will still need to
  install all of the non-Python packages above as they are used by calling an
  executable.
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ mkvirtualenv pungienv
$ for pkg in koji rpm rpmUtils pykickstart selinux createrepo yum urlgrabber; do ln -vs &quot;$(deactivate &amp;&amp; python -c 'import os, '$pkg'; print os.path.dirname('$pkg'.__file__)')&quot; &quot;$(virtualenvwrapper_get_site_packages_dir)&quot;; done
$ for pkg in _selinux deltarpm _deltarpm krbV sqlitecachec _sqlitecache; do ln -vs &quot;$(deactivate &amp;&amp; python -c 'import os, '$pkg'; print '$pkg'.__file__')&quot; &quot;$(virtualenvwrapper_get_site_packages_dir)&quot;; done
$ PYCURL_SSL_LIBRARY=nss pip install pycurl --no-binary :all:
$ pip install lxml pyopenssl mock sphinx setuptools nose nose-cov productmd jsonschema requests lockfile python-multilib kobo
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Now you should be able to run all existing tests.
<h2 class="Ss" title="Ss" id="Developing"><a class="selflink" href="#Developing">Developing</a></h2>
Currently the development workflow for Pungi is on master branch:
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Make your own fork at <i>https://pagure.io/pungi</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Clone your fork locally (replacing $USERNAME with your
      own):</dd>
</dl>
<div style="margin-left: 2.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
git clone git@pagure.io:forks/$USERNAME/pungi.git
</pre>
</div>
<br/>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">cd into your local clone and add the remote upstream for
      rebasing:</dd>
</dl>
<div style="margin-left: 2.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
cd pungi
git remote add upstream git@pagure.io:pungi.git
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 2.00ex;">
<div style="margin-left: 3.50ex;">This workflow assumes that you never <b>git
  commit</b> directly to the master branch of your fork. This will make more
  sense when we cover rebasing below.</div>
<br/>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">create a topic branch based on master:</dd>
</dl>
<div style="margin-left: 2.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
git branch my_topic_branch master
git checkout my_topic_branch
</pre>
</div>
<br/>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Make edits, changes, add new features, etc. and then make
      sure to pull from upstream master and rebase before submitting a pull
      request:</dd>
</dl>
<div style="margin-left: 2.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
# lets just say you edited setup.py for sake of argument
git checkout my_topic_branch
<div class="Pp"></div>
# make changes to setup.py
git add setup.py
git commit -s -m &quot;added awesome feature to setup.py&quot;
<div class="Pp"></div>
# now we rebase
git checkout master
git pull --rebase upstream master
git push origin master
git push origin --tags
git checkout my_topic_branch
git rebase master
<div class="Pp"></div>
# resolve merge conflicts if any as a result of your development in
# your topic branch
git push origin my_topic_branch
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 2.00ex;">
<div style="margin-left: 3.50ex;">In order to for your commit to be merged, you
  must sign-off on it. Use <b>-s</b> option when running <b>git
  commit</b>.</div>
<br/>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Create pull request in the pagure.io web UI</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">For convenience, here is a bash shell function that can be
      placed in your ~/.bashrc and called such as <b>pullupstream
      pungi-4-devel</b> that will automate a large portion of the rebase steps
      from above:</dd>
</dl>
<div style="margin-left: 2.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
pullupstream () {
  if [[ -z &quot;$1&quot; ]]; then
    printf &quot;Error: must specify a branch name (e.g. - master, devel)\n&quot;
  else
    pullup_startbranch=$(git describe --contains --all HEAD)
    git checkout $1
    git pull --rebase upstream master
    git push origin $1
    git push origin --tags
    git checkout ${pullup_startbranch}
  fi
}
</pre>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Testing"><a class="selflink" href="#Testing">Testing</a></h2>
You must write unit tests for any new code (except for trivial changes). Any
  code without sufficient test coverage may not be merged.
<div style="height: 1.00em;">&#x00A0;</div>
To run all existing tests, suggested method is to use <i>nosetests</i>. With
  additional options, it can generate code coverage. To make sure even tests
  from executable files are run, don't forget to use the <b>--exe</b> option.
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ make test
$ make test-cover
<div class="Pp"></div>
# Running single test file
$ python tests/test_arch.py [TestCase...]
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
In the <b>tests/</b> directory there is a shell script <b>test_compose.sh</b>
  that you can use to try and create a miniature compose on dummy data. The
  actual data will be created by running <b>make test-data</b> in project root.
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ make test-data
$ make test-commpose
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This testing compose does not actually use all phases that are available, and
  there is no checking that the result is correct. It only tells you whether it
  crashed or not.
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">Even when it finishes successfully, it may
  print errors about <b>repoclosure</b> on <i>Server-Gluster.x86_64</i> in
  <i>test</i> phase. This is not a bug.</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Documenting"><a class="selflink" href="#Documenting">Documenting</a></h2>
You must write documentation for any new features and functional changes. Any
  code without sufficient documentation may not be merged.
<div style="height: 1.00em;">&#x00A0;</div>
To generate the documentation, run <b>make doc</b> in project root.
<h1 class="Sh" title="Sh" id="TESTING_PUNGI"><a class="selflink" href="#TESTING_PUNGI">TESTING
  PUNGI</a></h1>
<h2 class="Ss" title="Ss" id="Test_Data"><a class="selflink" href="#Test_Data">Test
  Data</a></h2>
Tests require test data and not all of it is available in git. You must create
  test repositories before running the tests:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
make test-data
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Requirements: createrepo_c, rpmbuild
<h2 class="Ss" title="Ss" id="Unit_Tests"><a class="selflink" href="#Unit_Tests">Unit
  Tests</a></h2>
Unit tests cover functionality of Pungi python modules. You can run all of them
  at once:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
make test
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
which is shortcut to:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
python2 setup.py test
python3 setup.py test
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
You can alternatively run individual tests:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
cd tests
./&lt;test&gt;.py [&lt;class&gt;[.&lt;test&gt;]]
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Functional_Tests"><a class="selflink" href="#Functional_Tests">Functional
  Tests</a></h2>
Because compose is quite complex process and not everything is covered with unit
  tests yet, the easiest way how to test if your changes did not break anything
  badly is to start a compose on a relatively small and well defined package
  set:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
cd tests
./test_compose.sh
</pre>
</div>
<br/>
</div>
<br/>
<h1 class="Sh" title="Sh" id="CONFIG_FILE_FORMAT"><a class="selflink" href="#CONFIG_FILE_FORMAT">CONFIG
  FILE FORMAT</a></h1>
The configuration file parser is provided by <i>kobo</i>
<div style="height: 1.00em;">&#x00A0;</div>
The file follows a Python-like format. It consists of a sequence of variables
  that have a value assigned to them.
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
variable = value
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The variable names must follow the same convention as Python code: start with a
  letter and consist of letters, digits and underscores only.
<div style="height: 1.00em;">&#x00A0;</div>
The values can be either an integer, float, boolean ( <b>True</b> or
  <b>False</b>), a string or <b>None</b>. Strings must be enclosed in either
  single or double quotes.
<div style="height: 1.00em;">&#x00A0;</div>
Complex types are supported as well.
<div style="height: 1.00em;">&#x00A0;</div>
A list is enclosed in square brackets and items are separated with commas. There
  can be a comma after the last item as well.
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
a_list = [1,
          2,
          3,
         ]
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
A tuple works like a list, but is enclosed in parenthesis.
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
a_tuple = (1, &quot;one&quot;)
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
A dictionary is wrapped in brackets, and consists of <b>key: value</b> pairs
  separated by commas. The keys can only be formed from basic types (int, float,
  string).
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
a_dict = {
    'foo': 'bar',
    1: None
}
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The value assigned to a variable can also be taken from another variable.
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
one = 1
another = one
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Anything on a line after a <b>#</b> symbol is ignored and functions as a
  comment.
<h2 class="Ss" title="Ss" id="Importing_other_files"><a class="selflink" href="#Importing_other_files">Importing
  other files</a></h2>
It is possible to include another configuration file. The files are looked up
  relative to the currently processed file.
<div style="height: 1.00em;">&#x00A0;</div>
The general structure of import is:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
from FILENAME import WHAT
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The <b>FILENAME</b> should be just the base name of the file without extension
  (which must be <b>.conf</b>). <b>WHAT</b> can either be a comma separated list
  of variables or <b>*</b>.
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
# Opens constants.conf and brings PI and E into current scope.
from constants import PI, E
<div class="Pp"></div>
# Opens common.conf and brings everything defined in that file into current
# file as well.
from common import *
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">Pungi will copy the configuration file given
  on command line into the <b>logs/</b> directory. Only this single file will be
  copied, not any included ones. (Copying included files requires a fix in kobo
  library.)
<div style="height: 1.00em;">&#x00A0;</div>
The JSON-formatted dump of configuration is correct though.</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Formatting_strings"><a class="selflink" href="#Formatting_strings">Formatting
  strings</a></h2>
String interpolation is available as well. It uses a <b>%</b>-encoded format.
  See Python documentation for more details.
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
joined = &quot;%s %s&quot; % (var_a, var_b)
<div class="Pp"></div>
a_dict = {
    &quot;fst&quot;: 1,
    &quot;snd&quot;: 2,
}
another = &quot;%(fst)s %(snd)s&quot; % a_dict
</pre>
</div>
<br/>
</div>
<br/>
<h1 class="Sh" title="Sh" id="CONFIGURATION"><a class="selflink" href="#CONFIGURATION">CONFIGURATION</a></h1>
Please read <i>productmd documentation</i> for <i>terminology</i> and other
  release and compose related details.
<h2 class="Ss" title="Ss" id="Minimal_Config_Example"><a class="selflink" href="#Minimal_Config_Example">Minimal
  Config Example</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
# RELEASE
release_name = &quot;Fedora&quot;
release_short = &quot;Fedora&quot;
release_version = &quot;23&quot;
<div class="Pp"></div>
# GENERAL SETTINGS
comps_file = &quot;comps-f23.xml&quot;
variants_file = &quot;variants-f23.xml&quot;
<div class="Pp"></div>
# KOJI
koji_profile = &quot;koji&quot;
runroot = False
<div class="Pp"></div>
# PKGSET
sigkeys = [None]
pkgset_source = &quot;koji&quot;
pkgset_koji_tag = &quot;f23&quot;
<div class="Pp"></div>
# CREATEREPO
createrepo_checksum = &quot;sha256&quot;
<div class="Pp"></div>
# GATHER
gather_source = &quot;comps&quot;
gather_method = &quot;deps&quot;
greedy_method = &quot;build&quot;
check_deps = False
<div class="Pp"></div>
# BUILDINSTALL
bootable = True
buildinstall_method = &quot;lorax&quot;
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Release"><a class="selflink" href="#Release">Release</a></h2>
Following <b>mandatory</b> options describe a release.
<h2 class="Ss" title="Ss" id="Options"><a class="selflink" href="#Options">Options</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>release_name</b> [mandatory]</dt>
  <dd class="It-tag">(<i>str</i>) -- release name</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>release_short</b> [mandatory]</dt>
  <dd class="It-tag">(<i>str</i>) -- release short name, without spaces and
      special characters</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>release_version</b> [mandatory]</dt>
  <dd class="It-tag">(<i>str</i>) -- release version</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>release_type</b> = &quot;ga&quot;</dt>
  <dd class="It-tag">(<i>str</i>) -- release type, &quot;ga&quot; or
      &quot;updates&quot;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>release_is_layered</b> = False</dt>
  <dd class="It-tag">(<i>bool</i>) -- typically False for an operating system,
      True otherwise</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>release_internal</b> = False</dt>
  <dd class="It-tag">(<i>bool</i>) -- whether the compose is meant for public
      consumption</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Example"><a class="selflink" href="#Example">Example</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
release_name = &quot;Fedora&quot;
release_short = &quot;Fedora&quot;
release_version = &quot;23&quot;
# release_type = &quot;ga&quot;
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Base_Product"><a class="selflink" href="#Base_Product">Base
  Product</a></h2>
Base product options are <b>optional</b> and we need to them only if we're
  composing a layered product built on another (base) product.
<h2 class="Ss" title="Ss" id="Options"><a class="selflink" href="#Options">Options</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>base_product_name</b></dt>
  <dd class="It-tag">(<i>str</i>) -- base product name</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>base_product_short</b></dt>
  <dd class="It-tag">(<i>str</i>) -- base product short name, without spaces and
      special characters</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>base_product_version</b></dt>
  <dd class="It-tag">(<i>str</i>) -- base product <b>major</b> version</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>base_product_type</b> = &quot;ga&quot;</dt>
  <dd class="It-tag">(<i>str</i>) -- base product type, &quot;ga&quot;,
      &quot;updates&quot; etc., for full list see documentation of
      <i>productmd</i>.</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Example"><a class="selflink" href="#Example">Example</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
release_name = &quot;RPM Fusion&quot;
release_short = &quot;rf&quot;
release_version = &quot;23.0&quot;
<div class="Pp"></div>
release_is_layered = True
<div class="Pp"></div>
base_product_name = &quot;Fedora&quot;
base_product_short = &quot;Fedora&quot;
base_product_version = &quot;23&quot;
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="General_Settings"><a class="selflink" href="#General_Settings">General
  Settings</a></h2>
<h2 class="Ss" title="Ss" id="Options"><a class="selflink" href="#Options">Options</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>comps_file</b> [mandatory]</dt>
  <dd class="It-tag">(<i>scm_dict</i>, <i>str</i> or None) -- reference to comps
      XML file with installation groups</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>variants_file</b> [mandatory]</dt>
  <dd class="It-tag">(<i>scm_dict</i> or <i>str</i>) -- reference to variants
      XML file that defines release variants and architectures</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>failable_deliverables</b> [optional]</dt>
  <dd class="It-tag">(<i>list</i>) -- list which deliverables on which variant
      and architecture can fail and not abort the whole compose. This only
      applies to <b>buildinstall</b> and <b>iso</b> parts. All other artifacts
      can be configured in their respective part of configuration.
    <div style="height: 1.00em;">&#x00A0;</div>
    Please note that <b>*</b> as a wildcard matches all architectures but
      <b>src</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>comps_filter_environments</b> [optional]</dt>
  <dd class="It-tag">(<i>bool</i>) -- When set to <b>False</b>, the comps files
      for variants will not have their environments filtered to match the
      variant.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>tree_arches</b></dt>
  <dd class="It-tag">([<i>str</i>]) -- list of architectures which should be
      included; if undefined, all architectures from variants.xml will be
      included</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>tree_variants</b></dt>
  <dd class="It-tag">([<i>str</i>]) -- list of variants which should be
      included; if undefined, all variants from variants.xml will be
    included</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>repoclosure_backend</b></dt>
  <dd class="It-tag">(<i>str</i>) -- Select which tool should be used to run
      repoclosure over created repositories. By default <b>yum</b> is used, but
      you can switch to <b>dnf</b>. Please note that when <b>dnf</b> is used,
      the build dependencies check is skipped.</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Example"><a class="selflink" href="#Example">Example</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
comps_file = {
    &quot;scm&quot;: &quot;git&quot;,
    &quot;repo&quot;: &quot;https://git.fedorahosted.org/git/comps.git&quot;,
    &quot;branch&quot;: None,
    &quot;file&quot;: &quot;comps-f23.xml.in&quot;,
}
<div class="Pp"></div>
variants_file = {
    &quot;scm&quot;: &quot;git&quot;,
    &quot;repo&quot;: &quot;https://pagure.io/pungi-fedora.git &quot;,
    &quot;branch&quot;: None,
    &quot;file&quot;: &quot;variants-fedora.xml&quot;,
}
<div class="Pp"></div>
failable_deliverables = [
    ('^.*$', {
        # Buildinstall can fail on any variant and any arch
        '*': ['buildinstall'],
        'src': ['buildinstall'],
        # Nothing on i386 blocks the compose
        'i386': ['buildinstall', 'iso', 'live'],
    })
]
<div class="Pp"></div>
tree_arches = [&quot;x86_64&quot;]
tree_variants = [&quot;Server&quot;]
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Image_Naming"><a class="selflink" href="#Image_Naming">Image
  Naming</a></h2>
Both image name and volume id are generated based on the configuration. Since
  the volume id is limited to 32 characters, there are more settings available.
  The process for generating volume id is to get a list of possible formats and
  try them sequentially until one fits in the length limit. If substitutions are
  configured, each attempted volume id will be modified by it.
<div style="height: 1.00em;">&#x00A0;</div>
For layered products, the candidate formats are first
  <b>image_volid_layered_product_formats</b> followed by
  <b>image_volid_formats</b>. Otherwise, only <b>image_volid_formats</b> are
  tried.
<div style="height: 1.00em;">&#x00A0;</div>
If no format matches the length limit, an error will be reported and compose
  aborted.
<h2 class="Ss" title="Ss" id="Options"><a class="selflink" href="#Options">Options</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>There a couple common format specifiers available for
    both the options:</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>compose_id</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>release_short</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>version</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>date</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>respin</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>type</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>type_suffix</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>label</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>label_major_version</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>variant</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>arch</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>disc_type</b></dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>image_name_format</b> [optional]</dt>
  <dd class="It-tag">(<i>str</i>) -- Python's format string to serve as template
      for image names
    <div style="height: 1.00em;">&#x00A0;</div>
    This format will be used for all phases generating images. Currently that
      means <b>createiso</b>, <b>live_images</b> and <b>buildinstall</b>.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Available extra keys are:</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>disc_num</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>suffix</b></dd>
</dl>
</div>
<br/>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>image_volid_formats</b> [optional]</dt>
  <dd class="It-tag">(<i>list</i>) -- A list of format strings for generating
      volume id.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>The extra available keys are:</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>base_product_short</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>base_product_version</b></dd>
</dl>
</div>
<br/>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>image_volid_layered_product_formats</b> [optional]</dt>
  <dd class="It-tag">(<i>list</i>) -- A list of format strings for generating
      volume id for layered products. The keys available are the same as for
      <b>image_volid_formats</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>volume_id_substitutions</b> [optional]</dt>
  <dd class="It-tag">(<i>dict</i>) -- A mapping of string replacements to
      shorten the volume id.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>disc_types</b> [optional]</dt>
  <dd class="It-tag">(<i>dict</i>) -- A mapping for customizing <b>disc_type</b>
      used in image names.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Available keys are:</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>boot</b> -- for <b>boot.iso</b> images created in
      <i>buildinstall</i> phase</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>live</b> -- for images created by <i>live_images</i>
      phase</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>dvd</b> -- for images created by <i>createiso</i>
    phase</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>ostree</b> -- for ostree installer images</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Default values are the same as the keys.</div>
<br/>
<h2 class="Ss" title="Ss" id="Example"><a class="selflink" href="#Example">Example</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
# Image name respecting Fedora's image naming policy
image_name_format = &quot;%(release_short)s-%(variant)s-%(disc_type)s-%(arch)s-%(version)s%(suffix)s&quot;
# Use the same format for volume id
image_volid_formats = [
    &quot;%(release_short)s-%(variant)s-%(disc_type)s-%(arch)s-%(version)s&quot;
]
# No special handling for layered products, use same format as for regular images
image_volid_layered_product_formats = []
# Replace &quot;Cloud&quot; with &quot;C&quot; in volume id etc.
volume_id_substitutions = {
    'Cloud': 'C',
    'Alpha': 'A',
    'Beta': 'B',
    'TC': 'T',
}
<div class="Pp"></div>
disc_types = {
    'boot': 'netinst',
    'live': 'Live',
    'dvd': 'DVD',
}
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Signing"><a class="selflink" href="#Signing">Signing</a></h2>
If you want to sign deliverables generated during pungi run like RPM wrapped
  images. You must provide few configuration options:
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>signing_command</b> [optional]</dt>
  <dd class="It-tag">(<i>str</i>) -- Command that will be run with a koji build
      as a single argument. This command must not require any user interaction.
      If you need to pass a password for a signing key to the command, do this
      via command line option of the command and use string formatting syntax
      <b>%(signing_key_password)s</b>. (See
    <b>signing_key_password_file</b>).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>signing_key_id</b> [optional]</dt>
  <dd class="It-tag">(<i>str</i>) -- ID of the key that will be used for the
      signing. This ID will be used when crafting koji paths to signed files (
      <b>kojipkgs.fedoraproject.org/packages/NAME/VER/REL/data/signed/KEYID/..</b>).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>signing_key_password_file</b> [optional]</dt>
  <dd class="It-tag">(<i>str</i>) -- Path to a file with password that will be
      formatted into <b>signing_command</b> string via
      <b>%(signing_key_password)s</b> string format syntax (if used). Because
      pungi config is usualy stored in git and is part of compose logs we don't
      want password to be included directly in the config. Note: If <b>-</b>
      string is used instead of a filename, then you will be asked for the
      password interactivelly right after pungi starts.</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Example"><a class="selflink" href="#Example">Example</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
signing_command = '~/git/releng/scripts/sigulsign_unsigned.py -vv --password=%(signing_key_password)s fedora-24'
signing_key_id = '81b46521'
signing_key_password_file = '~/password_for_fedora-24_key'
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Git_URLs"><a class="selflink" href="#Git_URLs">Git
  URLs</a></h2>
In multiple places the config requires URL of a Git repository to download some
  file from. This URL is passed on to <i>Koji</i>. It is possible to specify
  which commit to use using this syntax:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
git://git.example.com/git/repo-name.git?#&lt;rev_spec&gt;
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The <b>&lt;rev_spec&gt;</b> pattern can be replaced with actual commit SHA, a
  tag name, <b>HEAD</b> to indicate that tip of default branch should be used or
  <b>origin/&lt;branch_name&gt;</b> to use tip of arbitrary branch.
<div style="height: 1.00em;">&#x00A0;</div>
If the URL specifies a branch or <b>HEAD</b>, <i>Pungi</i> will replace it with
  the actual commit SHA. This will later show up in <i>Koji</i> tasks and help
  with tracing what particular inputs were used.
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">The <b>origin</b> must be specified because of
  the way <i>Koji</i> works with the repository. It will clone the repository
  then switch to requested state with <b>git reset --hard REF</b>. Since no
  local branches are created, we need to use full specification including the
  name of the remote.</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Createrepo_Settings"><a class="selflink" href="#Createrepo_Settings">Createrepo
  Settings</a></h2>
<h2 class="Ss" title="Ss" id="Options"><a class="selflink" href="#Options">Options</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>createrepo_checksum</b></dt>
  <dd class="It-tag">(<i>str</i>) -- specify checksum type for createrepo;
      expected values: <b>sha512</b>, <b>sha256</b>, <b>sha</b>. Defaults to
      <b>sha256</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>createrepo_c</b> = True</dt>
  <dd class="It-tag">(<i>bool</i>) -- use createrepo_c (True) or legacy
      createrepo (False)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>createrepo_deltas</b> = False</dt>
  <dd class="It-tag">(<i>bool</i>) -- generate delta RPMs against an older
      compose. This needs to be used together with <b>--old-composes</b> command
      line argument.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>createrepo_use_xz</b> = False</dt>
  <dd class="It-tag">(<i>bool</i>) -- whether to pass <b>--xz</b> to the
      createrepo command. This will cause the SQLite databases to be compressed
      with xz.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>product_id</b> = None</dt>
  <dd class="It-tag">(<i>scm_dict</i>) -- If specified, it should point to a
      directory with certificates <b>&lt;variant_uid&gt;-&lt;arch&gt;-*.pem</b>.
      This certificate will be injected into the repository.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>product_id_allow_missing</b> = False</dt>
  <dd class="It-tag">(<i>bool</i>) -- When <b>product_id</b> is used and a
      certificate for some variant is missing, an error will be reported by
      default. Use this option to instead ignore the missing certificate.</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Example"><a class="selflink" href="#Example">Example</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
createrepo_checksum = &quot;sha&quot;
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Package_Set_Settings"><a class="selflink" href="#Package_Set_Settings">Package
  Set Settings</a></h2>
<h2 class="Ss" title="Ss" id="Options"><a class="selflink" href="#Options">Options</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>sigkeys</b></dt>
  <dd class="It-tag">([<i>str</i> or None]) -- priority list of sigkeys,
      <i>None</i> means unsigned</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>pkgset_source</b> [mandatory]</dt>
  <dd class="It-tag">(<i>str</i>) -- &quot;koji&quot; (any koji instance) or
      &quot;repos&quot; (arbitrary yum repositories)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>pkgset_koji_tag</b> [mandatory]</dt>
  <dd class="It-tag">(<i>str|[str]</i>) -- tag(s) to read package set from</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>pkgset_koji_inherit</b> = True</dt>
  <dd class="It-tag">(<i>bool</i>) -- inherit builds from parent tags; we can
      turn it off only if we have all builds tagged in a single tag</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>pkgset_repos</b></dt>
  <dd class="It-tag">(<i>dict</i>) -- A mapping of architectures to repositories
      with RPMs: <b>{arch:</b> <b>[repo]}</b>. Only use when <b>pkgset_source =
      &quot;repos&quot;</b>.</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Example"><a class="selflink" href="#Example">Example</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
sigkeys = [None]
pkgset_source = &quot;koji&quot;
pkgset_koji_tag = &quot;f23&quot;
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Buildinstall_Settings"><a class="selflink" href="#Buildinstall_Settings">Buildinstall
  Settings</a></h2>
Script or process that creates bootable images with Anaconda installer is
  historically called <i>buildinstall</i>.
<h2 class="Ss" title="Ss" id="Options"><a class="selflink" href="#Options">Options</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>bootable</b></dt>
  <dd class="It-tag">(<i>bool</i>) -- whether to run the buildinstall phase</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>buildinstall_method</b></dt>
  <dd class="It-tag">(<i>str</i>) -- &quot;lorax&quot; (f16+, rhel7+) or
      &quot;buildinstall&quot; (older releases)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>buildinstall_upgrade_image</b> [deprecated]</dt>
  <dd class="It-tag">(<i>bool</i>) -- use <b>noupgrade</b> with
      <b>lorax_options</b> instead</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>lorax_options</b></dt>
  <dd class="It-tag">(<i>list</i>) -- special options passed on to <i>lorax</i>.
    <div style="height: 1.00em;">&#x00A0;</div>
    Format: <b>[(variant_uid_regex, {arch|*: {option: name}})]</b>.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Recognized options are:</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>bugurl</b> -- <i>str</i> (default <b>None</b>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>nomacboot</b> -- <i>bool</i> (default <b>True</b>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>noupgrade</b> -- <i>bool</i> (default <b>True</b>)</dd>
</dl>
</div>
<br/>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>buildinstall_kickstart</b></dt>
  <dd class="It-tag">(<i>scm_dict</i>) -- If specified, this kickstart file will
      be copied into each file and pointed to in boot configuration.</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Example"><a class="selflink" href="#Example">Example</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
bootable = True
buildinstall_method = &quot;lorax&quot;
<div class="Pp"></div>
# Enables macboot on x86_64 for all variants and builds upgrade images
# everywhere.
lorax_options = [
    (&quot;^.*$&quot;, {
        &quot;x86_64&quot;: {
            &quot;nomacboot&quot;: False
        }
        &quot;*&quot;: {
            &quot;noupgrade&quot;: False
        }
    })
]
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">It is advised to run buildinstall (lorax) in
  koji, i.e. with <b>runroot enabled</b> for clean build environments, better
  logging, etc.</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>WARNING:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">Lorax installs RPMs into a chroot. This
  involves running %post scriptlets and they frequently run executables in the
  chroot. If we're composing for multiple architectures, we <b>must</b> use
  runroot for this reason.</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Gather_Settings"><a class="selflink" href="#Gather_Settings">Gather
  Settings</a></h2>
<h2 class="Ss" title="Ss" id="Options"><a class="selflink" href="#Options">Options</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>gather_source</b> [mandatory]</dt>
  <dd class="It-tag">(<i>str</i>) -- from where to read initial package list;
      expected values: &quot;comps&quot;, &quot;none&quot;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gather_method</b> [mandatory]</dt>
  <dd class="It-tag">(<i>str</i>) -- Options are <b>deps</b> and <b>nodeps</b>.
      Specifies whether package dependencies should be pulled in as well.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gather_fulltree</b> = False</dt>
  <dd class="It-tag">(<i>bool</i>) -- When set to <b>True</b> all RPMs built
      from an SRPM will always be included. Only use when <b>gather_method =
      &quot;deps&quot;</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gather_selfhosting</b> = False</dt>
  <dd class="It-tag">(<i>bool</i>) -- When set to <b>True</b>, <i>Pungi</i> will
      build a self-hosting tree by following build dependencies. Only use when
      <b>gather_method = &quot;deps&quot;</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>greedy_method</b></dt>
  <dd class="It-tag">(<i>str</i>) -- This option controls how package
      requirements are satisfied in case a particular <b>Requires</b> has
      multiple candidates.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>none</b> -- the best packages is selected to satisfy the
      dependency and only that one is pulled into the compose</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>all</b> -- packages that provide the symbol are pulled
      in</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>build</b> -- the best package is selected, and then all
      packages from the same build that provide the symbol are pulled in</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">As an example let's work with this situation:
  a package in the compose has <b>Requires: foo</b>. There are three packages
  with <b>Provides: foo</b>: <b>pkg-a</b>, <b>pkg-b-provider-1</b> and
  <b>pkg-b-provider-2</b>. The <b>pkg-b-*</b> packages are build from the same
  source package. Best match determines <b>pkg-b-provider-1</b> as best matching
  package.
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">With <b>greedy_method = &quot;none&quot;</b> only
      <b>pkg-b-provider-1</b> will be pulled in.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">With <b>greedy_method = &quot;all&quot;</b> all three
      packages will be pulled in.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">With <b>greedy_method = &quot;build&quot;
      ``pkg-b-provider-1</b> and <b>pkg-b-provider-2</b> will be pulled in.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gather_backend</b> = <b>yum</b></dt>
  <dd class="It-tag">(<i>str</i>) -- Either <b>yum</b> or <b>dnf</b>. This
      changes the entire codebase doing dependency solving, so it can change the
      result in unpredictable ways.
    <div style="height: 1.00em;">&#x00A0;</div>
    Particularly the multilib work is performed differently by using
      <b>python-multilib</b> library. Please refer to <b>multilib</b> option to
      see the differences.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>multilib_methods</b> [deprecated]</dt>
  <dd class="It-tag">([<i>str</i>]) -- use <b>multilib</b> instead to configure
      this per-variant</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>multilib_arches</b> [deprecated]</dt>
  <dd class="It-tag">([<i>str</i>] or None) -- use <b>multilib</b> to implicitly
      configure this: if a variant on any arch has non-empty multilib methods,
      it is automatically eligible</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>multilib</b></dt>
  <dd class="It-tag">(<i>list</i>) -- mapping of variant regexes and arches to
      list of multilib methods</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Available methods are:</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>none</b> -- no package matches this method</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>all</b> -- all packages match this method</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>runtime</b> -- packages that install some shared object
      file ( <b>*.so.*</b>) will match.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>devel</b> -- packages whose name ends with <b>-devel</b>
      or <b>--static</b> suffix will be matched. When <b>dnf</b> is used, this
      method automatically enables <b>runtime</b> method as well. With
      <b>yum</b> backend this method also uses a hardcoded blacklist and
      whitelist.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>kernel</b> -- packages providing <b>kernel</b> or
      <b>kernel-devel</b> match this method (only in <b>yum</b> backend)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>yaboot</b> -- only <b>yaboot</b> package on <b>ppc</b>
      arch matches this (only in <b>yum</b> backend)</dd>
</dl>
</div>
<br/>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>additional_packages</b></dt>
  <dd class="It-tag">(<i>list</i>) -- additional packages to be included in a
      variant and architecture; format: <b>[(variant_uid_regex, {arch|*:
      [package_globs]})]</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>filter_packages</b></dt>
  <dd class="It-tag">(<i>list</i>) -- packages to be excluded from a variant and
      architecture; format: <b>[(variant_uid_regex, {arch|*:
      [package_globs]})]</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>filter_system_release_packages</b></dt>
  <dd class="It-tag">(<i>bool</i>) -- for each variant, figure out the best
      system release package and filter out all others. This will not work if a
      variant needs more than one system release package. In such case, set this
      option to <b>False</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gather_prepopulate</b> = None</dt>
  <dd class="It-tag">(<i>scm_dict</i>) -- If specified, you can use this to add
      additional packages. The format of the file pointed to by this option is a
      JSON mapping <b>{variant_uid: {arch: {build: [package]}}}</b>. Packages
      added through this option can not be removed by
    <b>filter_packages</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>multilib_blacklist</b></dt>
  <dd class="It-tag">(<i>dict</i>) -- multilib blacklist; format: <b>{arch|*:
      [package_globs]}</b>. The patterns are tested with <b>fnmatch</b>, so
      shell globbing is used (not regular expression).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>multilib_whitelist</b></dt>
  <dd class="It-tag">(<i>dict</i>) -- multilib blacklist; format: <b>{arch|*:
      [package_names]}</b>. The whitelist must contain exact package names;
      there are no wildcards or pattern matching.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gather_lookaside_repos</b> = []</dt>
  <dd class="It-tag">(<i>list</i>) -- lookaside repositories used for package
      gathering; format: <b>[(variant_uid_regex, {arch|*:
    [repo_urls]})]</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>hashed_directories</b> = False</dt>
  <dd class="It-tag">(<i>bool</i>) -- put packages into &quot;hashed&quot;
      directories, for example
      <b>Packages/k/kernel-4.0.4-301.fc22.x86_64.rpm</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>check_deps</b> = True</dt>
  <dd class="It-tag">(<i>bool</i>) -- Set to <b>False</b> if you don't want the
      compose to abort when some package has broken dependencies.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>gather_source_mapping</b></dt>
  <dd class="It-tag">(<i>str</i>) -- Only use when <b>gather_source =
      &quot;json&quot;</b>. The value should be a path to JSON file with
      following mapping: <b>{variant: {arch: {rpm_name:</b>
      <b>[rpm_arch|None]}}}</b>.</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Example"><a class="selflink" href="#Example">Example</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
gather_source = &quot;comps&quot;
gather_method = &quot;deps&quot;
greedy_method = &quot;build&quot;
check_deps = False
hashed_directories = True
<div class="Pp"></div>
additional_packages = [
    # bz#123456
    ('^(Workstation|Server)$', {
        '*': [
            'grub2',
            'kernel',
        ],
    }),
]
<div class="Pp"></div>
filter_packages = [
    # bz#111222
    ('^.*$', {
        '*': [
            'kernel-doc',
        ],
    }),
]
<div class="Pp"></div>
multilib = [
    ('^Server$', {
        'x86_64': ['devel', 'runtime']
    })
]
<div class="Pp"></div>
multilib_blacklist = {
    &quot;*&quot;: [
        &quot;gcc&quot;,
    ],
}
<div class="Pp"></div>
multilib_whitelist = {
    &quot;*&quot;: [
        &quot;alsa-plugins-*&quot;,
    ],
}
<div class="Pp"></div>
# gather_lookaside_repos = [
#     ('^.*$', {
#         'x86_64': [
#             &quot;https://dl.fedoraproject.org/pub/fedora/linux/releases/22/Everything/x86_64/os/&quot;,
#             &quot;https://dl.fedoraproject.org/pub/fedora/linux/releases/22/Everything/source/SRPMS/&quot;,
#         ]
#     }),
# ]
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">It is a good practice to attach bug/ticket
  numbers to additional_packages, filter_packages, multilib_blacklist and
  multilib_whitelist to track decisions.</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Koji_Settings"><a class="selflink" href="#Koji_Settings">Koji
  Settings</a></h2>
<h2 class="Ss" title="Ss" id="Options"><a class="selflink" href="#Options">Options</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>koji_profile</b></dt>
  <dd class="It-tag">(<i>str</i>) -- koji profile name</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>runroot</b> [mandatory]</dt>
  <dd class="It-tag">(<i>bool</i>) -- run some tasks such as buildinstall or
      createiso in koji build root (True) or locally (False)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>runroot_channel</b></dt>
  <dd class="It-tag">(<i>str</i>) -- name of koji channel</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>runroot_tag</b></dt>
  <dd class="It-tag">(<i>str</i>) -- name of koji <b>build</b> tag used for
      runroot</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>runroot_weights</b></dt>
  <dd class="It-tag">(<i>dict</i>) -- customize task weights for various runroot
      tasks. The values in the mapping should be integers, the keys can be
      selected from the following list. By default no weight is assigned and
      Koji picks the default one according to policy.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>buildinstall</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>createiso</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>ostree</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>ostree_installer</b></dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Example"><a class="selflink" href="#Example">Example</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
koji_profile = &quot;koji&quot;
runroot = True
runroot_channel = &quot;runroot&quot;
runroot_tag = &quot;f23-build&quot;
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Extra_Files_Settings"><a class="selflink" href="#Extra_Files_Settings">Extra
  Files Settings</a></h2>
<h2 class="Ss" title="Ss" id="Options"><a class="selflink" href="#Options">Options</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>extra_files</b></dt>
  <dd class="It-tag">(<i>list</i>) -- references to external files to be placed
      in os/ directory and media; format: [(variant_uid_regex, {arch|*:
      [scm_dicts]})]</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Example"><a class="selflink" href="#Example">Example</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
extra_files = [
    ('^.*$', {
        '*': [
            # GPG keys
            {
                &quot;scm&quot;: &quot;rpm&quot;,
                &quot;repo&quot;: &quot;fedora-repos&quot;,
                &quot;branch&quot;: None,
                &quot;file&quot;: [
                    &quot;/etc/pki/rpm-gpg/RPM-GPG-KEY-22-fedora&quot;,
                ],
                &quot;target&quot;: &quot;&quot;,
            },
            # GPL
            {
                &quot;scm&quot;: &quot;git&quot;,
                &quot;repo&quot;: &quot;https://pagure.io/pungi-fedora&quot;,
                &quot;branch&quot;: None,
                &quot;file&quot;: [
                    &quot;GPL&quot;,
                ],
                &quot;target&quot;: &quot;&quot;,
            },
        ],
    }),
]
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Extra_Files_Metadata"><a class="selflink" href="#Extra_Files_Metadata">Extra
  Files Metadata</a></h2>
If extra files are specified a metadata file, <b>extra_files.json</b>, is placed
  in the <b>os/</b> directory and media. The checksums generated are determined
  by <b>media_checksums</b> option. This metadata file is in the format:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
{
  &quot;header&quot;: {&quot;version&quot;: &quot;1.0},
  &quot;data&quot;: [
    {
      &quot;file&quot;: &quot;GPL&quot;,
      &quot;checksums&quot;: {
        &quot;sha256&quot;: &quot;8177f97513213526df2cf6184d8ff986c675afb514d4e68a404010521b880643&quot;
      },
      &quot;size&quot;: 18092
    },
    {
      &quot;file&quot;: &quot;release-notes/notes.html&quot;,
      &quot;checksums&quot;: {
        &quot;sha256&quot;: &quot;82b1ba8db522aadf101dca6404235fba179e559b95ea24ff39ee1e5d9a53bdcb&quot;
      },
      &quot;size&quot;: 1120
    }
  ]
}
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Productimg_Settings"><a class="selflink" href="#Productimg_Settings">Productimg
  Settings</a></h2>
Product images are placed on installation media and provide additional branding
  and Anaconda changes specific to product variants.
<h2 class="Ss" title="Ss" id="Options"><a class="selflink" href="#Options">Options</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>productimg</b> = False</dt>
  <dd class="It-tag">(<i>bool</i>) -- create product images; requires
      bootable=True</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>productimg_install_class</b></dt>
  <dd class="It-tag">(<i>scm_dict</i>, <i>str</i>) -- reference to install class
      <b>file</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>productimg_po_files</b></dt>
  <dd class="It-tag">(<i>scm_dict</i>, <i>str</i>) -- reference to a
      <b>directory</b> with po files for install class translations</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Example"><a class="selflink" href="#Example">Example</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
productimg = True
productimg_install_class = {
    &quot;scm&quot;: &quot;git&quot;,
    &quot;repo&quot;: &quot;http://git.example.com/productimg.git&quot;,
    &quot;branch&quot;: None,
    &quot;file&quot;: &quot;fedora23/%(variant_id)s.py&quot;,
}
productimg_po_files = {
    &quot;scm&quot;: &quot;git&quot;,
    &quot;repo&quot;: &quot;http://git.example.com/productimg.git&quot;,
    &quot;branch&quot;: None,
    &quot;dir&quot;: &quot;po&quot;,
}
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="CreateISO_Settings"><a class="selflink" href="#CreateISO_Settings">CreateISO
  Settings</a></h2>
<h2 class="Ss" title="Ss" id="Options"><a class="selflink" href="#Options">Options</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>createiso_skip</b> = False</dt>
  <dd class="It-tag">(<i>list</i>) -- mapping that defines which variants and
      arches to skip during createiso; format: [(variant_uid_regex, {arch|*:
      True})]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>create_jigdo</b> = True</dt>
  <dd class="It-tag">(<i>bool</i>) -- controls the creation of jigdo from
    ISO</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>create_optional_isos</b> = False</dt>
  <dd class="It-tag">(<i>bool</i>) -- when set to <b>True</b>, ISOs will be
      created even for <b>optional</b> variants. By default only variants with
      type <b>variant</b> or <b>layered-product</b> will get ISOs.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>iso_size</b> = 4700000000</dt>
  <dd class="It-tag">(<i>int|str</i>) -- size of ISO image. The value should
      either be an integer meaning size in bytes, or it can be a string with
      <b>k</b>, <b>M</b>, <b>G</b> suffix (using multiples of 1024).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>split_iso_reserve</b> = 10MiB</dt>
  <dd class="It-tag">(<i>int|str</i>) -- how much free space should be left on
      each disk. The format is the same as for <b>iso_size</b> option.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">Source architecture needs to be listed
  explicitly. Excluding '*' applies only on binary arches. Jigdo causes
  significant increase of time to ISO creation.</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Example"><a class="selflink" href="#Example">Example</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
createiso_skip = [
    ('^Workstation$', {
        '*': True,
        'src': True
    }),
]
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Automatic_generation_of_version_and_release"><a class="selflink" href="#Automatic_generation_of_version_and_release">Automatic
  generation of version and release</a></h2>
Version and release values for certain artifacts can be generated automatically
  based on release version, compose label, date, type and respin. This can be
  used to shorten the config and keep it the same for multiple uses.
<table class="tbl">
  <colgroup>
    <col style="width: 31.00ex;"/>
    <col style="width: 20.00ex;"/>
    <col style="width: 14.00ex;"/>
    <col style="width: 18.00ex;"/>
  </colgroup>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>Compose ID</td>
    <td>Label</td>
    <td>Version</td>
    <td>Release</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>F-Rawhide-20170406.n.0</b></td>
    <td><b>-</b></td>
    <td><b>Rawhide</b></td>
    <td><b>20170406.n.0</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>F-26-20170329.1</b></td>
    <td><b>Alpha-1.6</b></td>
    <td><b>26_Alpha</b></td>
    <td><b>1.6</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>F-Atomic-25-20170407.0</b></td>
    <td><b>RC-20170407.0</b></td>
    <td><b>25</b></td>
    <td><b>20170407.0</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>F-Atomic-25-20170407.0</b></td>
    <td><b>-</b></td>
    <td><b>25</b></td>
    <td><b>20170407.0</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
</table>
<div style="height: 1.00em;">&#x00A0;</div>
All non- <b>RC</b> milestones from label get appended to the version. For
  release either label is used or date, type and respin.
<h2 class="Ss" title="Ss" id="Common_options_for_Live_Images,_Live_Media_and_Image_Build"><a class="selflink" href="#Common_options_for_Live_Images,_Live_Media_and_Image_Build">Common
  options for Live Images, Live Media and Image Build</a></h2>
All images can have <b>ksurl</b>, <b>version</b>, <b>release</b> and
  <b>target</b> specified. Since this can create a lot of duplication, there are
  global options that can be used instead.
<div style="height: 1.00em;">&#x00A0;</div>
For each of the phases, if the option is not specified for a particular
  deliverable, an option named <b>&lt;PHASE_NAME&gt;_&lt;OPTION&gt;</b> is
  checked. If that is not specified either, the last fallback is
  <b>global_&lt;OPTION&gt;</b>. If even that is unset, the value is considered
  to not be specified.
<div style="height: 1.00em;">&#x00A0;</div>
The kickstart URL is configured by these options.
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>global_ksurl</b> -- global fallback setting</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>live_media_ksurl</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>image_build_ksurl</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>live_images_ksurl</b></dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Target is specified by these settings. For live images refer to
  <b>live_target</b>.
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>global_target</b> -- global fallback setting</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>live_media_target</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>image_build_target</b></dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Version is specified by these options. If no version is set, a default value
  will be provided according to <i>automatic versioning</i>.
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>global_version</b> -- global fallback setting</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>live_media_version</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>image_build_version</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>live_images_version</b></dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Release is specified by these options. If set to a magic value to
  <b>!RELEASE_FROM_LABEL_DATE_TYPE_RESPIN</b>, a value will be generated
  according to <i>automatic versioning</i>.
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>global_release</b> -- global fallback setting</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>live_media_release</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>image_build_release</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>live_images_release</b></dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Each configuration block can also optionally specify a <b>failable</b> key. For
  live images it should have a boolean value. For live media and image build it
  should be a list of strings containing architectures that are optional. If any
  deliverable fails on an optional architecture, it will not abort the whole
  compose. If the list contains only <b>&quot;*&quot;</b>, all arches will be
  substituted.
<h2 class="Ss" title="Ss" id="Live_Images_Settings"><a class="selflink" href="#Live_Images_Settings">Live
  Images Settings</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>live_target</b></dt>
  <dd class="It-tag">(<i>str</i>) -- Koji build target for which to build the
      images. This gets passed to <b>koji spin-livecd</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>live_images</b></dt>
  <dd class="It-tag">(<i>list</i>) -- Configuration for the particular image.
      The elements of the list should be tuples <b>(variant_uid_regex, {arch|*:
      config})</b>. The config should be a dict with these keys:</dd>
</dl>
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>kickstart</b> (<i>str</i>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>ksurl</b> (<i>str</i>) [optional] -- where to get the
      kickstart from</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>name</b> (<i>str</i>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>version</b> (<i>str</i>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>repo</b> (<i>str|[str]</i>) -- repos specified by URL or
      variant UID</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>specfile</b> (<i>str</i>) -- for images wrapped in
    RPM</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>scratch</b> (<i>bool</i>) -- only RPM-wrapped images can
      use scratch builds, but by default this is turned off</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>type</b> (<i>str</i>) -- what kind of task to start in
      Koji. Defaults to <b>live</b> meaning <b>koji spin-livecd</b> will be
      used. Alternative option is <b>appliance</b> corresponding to <b>koji
      spin-appliance</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sign</b> (<i>bool</i>) -- only RPM-wrapped images can be
      signed</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Deprecated options:
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>additional_repos</b> -- deprecated, use <b>repo</b>
      instead</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>repo_from</b> -- deprecated, use <b>repo</b>
    instead</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>live_images_no_rename</b></dt>
  <dd class="It-tag">(<i>bool</i>) -- When set to <b>True</b>, filenames
      generated by Koji will be used. When <b>False</b>, filenames will be
      generated based on <b>image_name_format</b> configuration option.</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Live_Media_Settings"><a class="selflink" href="#Live_Media_Settings">Live
  Media Settings</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>live_media</b></dt>
  <dd class="It-tag">(<i>dict</i>) -- configuration for <b>koji
      spin-livemedia</b>; format: <b>{variant_uid_regex: [{opt:value}]}</b>
    <div style="height: 1.00em;">&#x00A0;</div>
    Required options:</dd>
</dl>
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>name</b> (<i>str</i>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>version</b> (<i>str</i>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>target</b> (<i>str</i>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>arches</b> (<i>[str]</i>) -- what architectures to build
      the media for; by default uses all arches for the variant.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>kickstart</b> (<i>str</i>) -- name of the kickstart
    file</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Available options:
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>ksurl</b> (<i>str</i>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>ksversion</b> (<i>str</i>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>scratch</b> (<i>bool</i>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>release</b> (<i>str</i>) -- a string with the release,
      or <b>!RELEASE_FROM_LABEL_DATE_TYPE_RESPIN</b> to automatically generate a
      suitable value. See <i>automatic versioning</i> for details.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>skip_tag</b> (<i>bool</i>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>repo</b> (<i>str|[str]</i>) -- repos specified by URL or
      variant UID</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>title</b> (<i>str</i>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>install_tree_from</b> (<i>str</i>) -- variant to take
      install tree from</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Deprecated options:
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>repo_from</b> -- deprecated, use <b>repo</b>
    instead</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Image_Build_Settings"><a class="selflink" href="#Image_Build_Settings">Image
  Build Settings</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>image_build</b></dt>
  <dd class="It-tag">(<i>dict</i>) -- config for <b>koji image-build</b>;
      format: {variant_uid_regex: [{opt: value}]}
    <div style="height: 1.00em;">&#x00A0;</div>
    By default, images will be built for each binary arch valid for the variant.
      The config can specify a list of arches to narrow this down.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">Config can contain anything what is accepted
  by <b>koji image-build --config configfile.ini</b>
<div style="height: 1.00em;">&#x00A0;</div>
Repo can be specified either as a string or a list of strings. It will be
  automatically transformed into format suitable for <b>koji</b>. A repo for the
  currently built variant will be added as well.
<div style="height: 1.00em;">&#x00A0;</div>
If you explicitly set <b>release</b> to
  <b>!RELEASE_FROM_LABEL_DATE_TYPE_RESPIN</b>, it will be replaced with a value
  generated as described in <i>automatic versioning</i>.
<div style="height: 1.00em;">&#x00A0;</div>
Please don't set <b>install_tree</b>. This gets automatically set by
  <i>pungi</i> based on current variant. You can use <b>install_tree_from</b>
  key to use install tree from another variant.
<div style="height: 1.00em;">&#x00A0;</div>
The <b>format</b> attr is [('image_type', 'image_suffix'), ...]. See productmd
  documentation for list of supported types and suffixes.
<div style="height: 1.00em;">&#x00A0;</div>
If <b>ksurl</b> ends with <b>#HEAD</b>, Pungi will figure out the SHA1 hash of
  current HEAD and use that instead.
<div style="height: 1.00em;">&#x00A0;</div>
Setting <b>scratch</b> to <b>True</b> will run the koji tasks as scratch
  builds.</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Example"><a class="selflink" href="#Example">Example</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
image_build = {
    '^Server$': [
        {
            'image-build': {
                'format': [('docker', 'tar.gz'), ('qcow2', 'qcow2')]
                'name': 'fedora-qcow-and-docker-base',
                'target': 'koji-target-name',
                'ksversion': 'F23',     # value from pykickstart
                'version': '23',
                # correct SHA1 hash will be put into the URL below automatically
                'ksurl': 'https://git.fedorahosted.org/git/spin-kickstarts.git?somedirectoryifany#HEAD',
                'kickstart': &quot;fedora-docker-base.ks&quot;,
                'repo': [&quot;http://someextrarepos.org/repo&quot;, &quot;ftp://rekcod.oi/repo&quot;],
                'distro': 'Fedora-20',
                'disk_size': 3,
<div class="Pp"></div>
                # this is set automatically by pungi to os_dir for given variant
                # 'install_tree': 'http://somepath',
            },
            'factory-parameters': {
                'docker_cmd':  &quot;[ '/bin/bash' ]&quot;,
                'docker_env': &quot;[ 'PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin' ]&quot;,
                'docker_labels': &quot;{'Name': 'fedora-docker-base', 'License': u'GPLv2', 'RUN': 'docker run -it --rm ${OPT1} --privileged -v \`pwd\`:/atomicapp -v /run:/run -v /:/host --net=host --name ${NAME} -e NAME=${NAME} -e IMAGE=${IMAGE} ${IMAGE} -v ${OPT2} run ${OPT3} /atomicapp', 'Vendor': 'Fedora Project', 'Version': '23', 'Architecture': 'x86_64' }&quot;,
            }
        },
        {
            'image-build': {
                'format': [('docker', 'tar.gz'), ('qcow2', 'qcow2')]
                'name': 'fedora-qcow-and-docker-base',
                'target': 'koji-target-name',
                'ksversion': 'F23',     # value from pykickstart
                'version': '23',
                # correct SHA1 hash will be put into the URL below automatically
                'ksurl': 'https://git.fedorahosted.org/git/spin-kickstarts.git?somedirectoryifany#HEAD',
                'kickstart': &quot;fedora-docker-base.ks&quot;,
                'repo': [&quot;http://someextrarepos.org/repo&quot;, &quot;ftp://rekcod.oi/repo&quot;],
                'distro': 'Fedora-20',
                'disk_size': 3,
<div class="Pp"></div>
                # this is set automatically by pungi to os_dir for given variant
                # 'install_tree': 'http://somepath',
            }
        },
        {
            'image-build': {
                'format': [('qcow2','qcow2')]
                'name': 'fedora-qcow-base',
                'target': 'koji-target-name',
                'ksversion': 'F23',     # value from pykickstart
                'version': '23',
                'ksurl': 'https://git.fedorahosted.org/git/spin-kickstarts.git?somedirectoryifany#HEAD',
                'kickstart': &quot;fedora-docker-base.ks&quot;,
                'distro': 'Fedora-23',
<div class="Pp"></div>
                # only build this type of image on x86_64
                'arches': ['x86_64']
<div class="Pp"></div>
                # Use install tree and repo from Everything variant.
                'install_tree_from': 'Everything',
                'repo': ['Everything'],
<div class="Pp"></div>
                # Set release automatically.
                'release': '!RELEASE_FROM_LABEL_DATE_TYPE_RESPIN',
            }
        }
    ]
}
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="OSTree_Settings"><a class="selflink" href="#OSTree_Settings">OSTree
  Settings</a></h2>
The <b>ostree</b> phase of <i>Pungi</i> can create ostree repositories. This is
  done by running <b>rpm-ostree compose</b> in a Koji runroot environment. The
  ostree repository itself is not part of the compose and should be located in
  another directory. Any new packages in the compose will be added to the
  repository with a new commit.
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>ostree</b></dt>
  <dd class="It-tag">(<i>dict</i>) -- a variant/arch mapping of configuration.
      The format should be <b>[(variant_uid_regex, {arch|*: config_dict})]</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
    The configuration dict for each variant arch pair must have these keys:</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>treefile</b> -- (<i>str</i>) Filename of configuration
      for <b>rpm-ostree</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>config_url</b> -- (<i>str</i>) URL for Git repository
      with the <b>treefile</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>repo</b> -- (<i>str|dict|[str|dict]</i>) repos specified
      by URL or variant UID or a dict of repo options, <b>baseurl</b> is
      required in the dict.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>ostree_repo</b> -- (<i>str</i>) Where to put the ostree
      repository</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
These keys are optional:
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>keep_original_sources</b> -- (<i>bool</i>) Keep the
      existing source repos in the tree config file. If not enabled, all the
      original source repos will be removed from the tree config file.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>config_branch</b> -- (<i>str</i>) Git branch of the repo
      to use. Defaults to <b>master</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>failable</b> -- (<i>[str]</i>) List of architectures for
      which this deliverable is not release blocking.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>update_summary</b> -- (<i>bool</i>) Update summary
      metadata after tree composing. Defaults to <b>False</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>version</b> -- (<i>str</i>) Version string to be added
      as versioning metadata. If this option is set to
      <b>!OSTREE_VERSION_FROM_LABEL_DATE_TYPE_RESPIN</b>, a value will be
      generated automatically as <b>$VERSION.$RELEASE</b>. <i>See how those
      values are created</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>tag_ref</b> -- (<i>bool</i>, default <b>True</b>) If set
      to <b>False</b>, a git reference will not be created.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Deprecated options:
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>repo_from</b> -- Deprecated, use <b>repo</b>
    instead.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>source_repo_from</b> -- Deprecated, use <b>repo</b>
      instead.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>extra_source_repos</b> -- Deprecated, use <b>repo</b>
      instead.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Example_config"><a class="selflink" href="#Example_config">Example
  config</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
ostree = [
    (&quot;^Atomic$&quot;, {
        &quot;x86_64&quot;: {
            &quot;treefile&quot;: &quot;fedora-atomic-docker-host.json&quot;,
            &quot;config_url&quot;: &quot;https://git.fedorahosted.org/git/fedora-atomic.git&quot;,
            &quot;repo&quot;: [
                &quot;Server&quot;,
                &quot;http://example.com/repo/x86_64/os&quot;,
                {&quot;baseurl&quot;: &quot;Everything&quot;},
                {&quot;baseurl&quot;: &quot;http://example.com/linux/repo&quot;, &quot;exclude&quot;: &quot;systemd-container&quot;},
            ],
            &quot;keep_original_sources&quot;: True,
            &quot;ostree_repo&quot;: &quot;/mnt/koji/compose/atomic/Rawhide/&quot;,
            &quot;update_summary&quot;: True,
            # Automatically generate a reasonable version
            &quot;version&quot;: &quot;!OSTREE_VERSION_FROM_LABEL_DATE_TYPE_RESPIN&quot;,
        }
    })
]
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Ostree_Installer_Settings"><a class="selflink" href="#Ostree_Installer_Settings">Ostree
  Installer Settings</a></h2>
The <b>ostree_installer</b> phase of <i>Pungi</i> can produce installer image
  bundling an OSTree repository. This always runs in Koji as a <b>runroot</b>
  task.
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>ostree_installer</b></dt>
  <dd class="It-tag">(<i>dict</i>) -- a variant/arch mapping of configuration.
      The format should be <b>[(variant_uid_regex, {arch|*: config_dict})]</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
    The configuration dict for each variant arch pair must have this key:
    <div style="height: 1.00em;">&#x00A0;</div>
    These keys are optional:</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>repo</b> -- (<i>str|[str]</i>) repos specified by URL or
      variant UID</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>release</b> -- (<i>str</i>) Release value to set for the
      installer image. Set to <b>!RELEASE_FROM_LABEL_DATE_TYPE_RESPIN</b> to
      generate the value <i>automatically</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>failable</b> -- (<i>[str]</i>) List of architectures for
      which this deliverable is not release blocking.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
These optional keys are passed to <b>lorax</b> to customize the build.
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>installpkgs</b> -- (<i>[str]</i>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>add_template</b> -- (<i>[str]</i>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>add_arch_template</b> -- (<i>[str]</i>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>add_template_var</b> -- (<i>[str]</i>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>add_arch_template_var</b> -- (<i>[str]</i>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>rootfs_size</b> -- (<i>[str]</i>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>template_repo</b> -- (<i>str</i>) Git repository with
      extra templates.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>template_branch</b> -- (<i>str</i>) Branch to use from
      <b>template_repo</b>.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The templates can either be absolute paths, in which case they will be used as
  configured; or they can be relative paths, in which case <b>template_repo</b>
  needs to point to a Git repository from which to take the templates.
<div style="height: 1.00em;">&#x00A0;</div>
Deprecated options:
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>repo_from</b> -- Deprecated, use <b>repo</b>
    instead.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>source_repo_from</b> -- Deprecated, use <b>repo</b>
      instead.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Example_config"><a class="selflink" href="#Example_config">Example
  config</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
ostree_installer = [
    (&quot;^Atomic$&quot;, {
        &quot;x86_64&quot;: {
            &quot;repo&quot;: [
                &quot;Everything&quot;,
                &quot;https://example.com/extra-repo1.repo&quot;,
                &quot;https://example.com/extra-repo2.repo&quot;,
            ],
            &quot;release&quot;: &quot;!RELEASE_FROM_LABEL_DATE_TYPE_RESPIN&quot;,
            &quot;installpkgs&quot;: [&quot;fedora-productimg-atomic&quot;],
            &quot;add_template&quot;: [&quot;atomic-installer/lorax-configure-repo.tmpl&quot;],
            &quot;add_template_var&quot;: [
                &quot;ostree_osname=fedora-atomic&quot;,
                &quot;ostree_ref=fedora-atomic/Rawhide/x86_64/docker-host&quot;,
            ],
            &quot;add_arch_template&quot;: [&quot;atomic-installer/lorax-embed-repo.tmpl&quot;],
            &quot;add_arch_template_var&quot;: [
                &quot;ostree_repo=https://kojipkgs.fedoraproject.org/compose/atomic/Rawhide/&quot;,
                &quot;ostree_osname=fedora-atomic&quot;,
                &quot;ostree_ref=fedora-atomic/Rawhide/x86_64/docker-host&quot;,
            ]
            'template_repo': 'https://git.fedorahosted.org/git/spin-kickstarts.git',
            'template_branch': 'f24',
        }
    })
]
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="OSBS_Settings"><a class="selflink" href="#OSBS_Settings">OSBS
  Settings</a></h2>
<i>Pungi</i> can build docker images in OSBS. The build is initiated through
  Koji <b>container-build</b> plugin. The base image will be using RPMs from the
  current compose and a <b>Dockerfile</b> from specified Git repository.
<div style="height: 1.00em;">&#x00A0;</div>
Please note that the image is uploaded to a Docker v2 registry and not exported
  into compose directory. There will be a metadata file in
  <b>compose/metadata/osbs.json</b> with details about the built images
  (assuming they are not scratch builds).
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osbs</b></dt>
  <dd class="It-tag">(<i>dict</i>) -- a mapping from variant regexes to
      configuration blocks. The format should be <b>{variant_uid_regex:
      [config_dict]}</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
    The configuration for each image must have at least these keys:</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>url</b> -- (<i>str</i>) URL pointing to a Git repository
      with <b>Dockerfile</b>. Please see <i>Git URLs</i> section for more
      details.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>target</b> -- (<i>str</i>) A Koji target to build the
      image for.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>git_branch</b> -- (<i>str</i>) A branch in SCM for the
      <b>Dockerfile</b>. This is required by OSBS to avoid race conditions when
      multiple builds from the same repo are submitted at the same time. Please
      note that <b>url</b> should contain the branch or tag name as well, so
      that it can be resolved to a particular commit hash.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Optionally you can specify <b>failable</b>. If it has a truthy value, failure to
  create the image will not abort the whole compose.
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">Once OSBS gains support for multiple
  architectures, the usage of this option will most likely change to list
  architectures that are allowed to fail.</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The configuration will pass other attributes directly to the Koji task. This
  includes <b>name</b>, <b>version</b>, <b>scratch</b> and <b>priority</b>.
<div style="height: 1.00em;">&#x00A0;</div>
A value for <b>yum_repourls</b> will be created automatically and point at a
  repository in the current compose. You can add extra repositories with
  <b>repo</b> key having a list of urls pointing to <b>.repo</b> files or just
  variant uid, Pungi will create the .repo file for that variant. <b>gpgkey</b>
  can be specified to enable gpgcheck in repo files for variants.</div>
<br/>
<h2 class="Ss" title="Ss" id="Example_config"><a class="selflink" href="#Example_config">Example
  config</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
osbs = {
    &quot;^Server$&quot;: {
        # required
        &quot;url&quot;: &quot;git://example.com/dockerfiles.git?#HEAD&quot;,
        &quot;target&quot;: &quot;f24-docker-candidate&quot;,
        &quot;git_branch&quot;: &quot;f24-docker&quot;,
<div class="Pp"></div>
        # optional
        &quot;name&quot;: &quot;fedora-docker-base&quot;,
        &quot;version&quot;: &quot;24&quot;,
        &quot;repo&quot;: [&quot;Everything&quot;, &quot;https://example.com/extra-repo.repo&quot;],
        # This will result in three repo urls being passed to the task.
        # They will be in this order: Server, Everything, example.com/
        &quot;gpgkey&quot;: 'file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release',
    }
}
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Media_Checksums_Settings"><a class="selflink" href="#Media_Checksums_Settings">Media
  Checksums Settings</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>media_checksums</b></dt>
  <dd class="It-tag">(<i>list</i>) -- list of checksum types to compute, allowed
      values are anything supported by Python's <b>hashlib</b> module (see
      <i>documentation for details</i>).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>media_checksum_one_file</b></dt>
  <dd class="It-tag">(<i>bool</i>) -- when <b>True</b>, only one <b>CHECKSUM</b>
      file will be created per directory; this option requires
      <b>media_checksums</b> to only specify one type</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>media_checksum_base_filename</b></dt>
  <dd class="It-tag">(<i>str</i>) -- when not set, all checksums will be save to
      a file named either <b>CHECKSUM</b> or based on the digest type; this
      option allows adding any prefix to that name
    <div style="height: 1.00em;">&#x00A0;</div>
    It is possible to use format strings that will be replace by actual values.
      The allowed keys are:</dd>
</dl>
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>arch</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>compose_id</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>date</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>label</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>label_major_version</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>release_short</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>respin</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>type</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>type_suffix</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>version</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>version</b></dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
For example, for Fedora the prefix should be
  <b>%(release_short)s-%(variant)s-%(version)s-%(date)s%(type_suffix)s.%(respin)s</b>.</div>
<br/>
<h2 class="Ss" title="Ss" id="Translate_Paths_Settings"><a class="selflink" href="#Translate_Paths_Settings">Translate
  Paths Settings</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>translate_paths</b></dt>
  <dd class="It-tag">(<i>list</i>) -- list of paths to translate; format:
      <b>[(path, translated_path)]</b></dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">This feature becomes useful when you need to
  transform compose location into e.g. a HTTP repo which is can be passed to
  <b>koji image-build</b>. The <b>path</b> part is normalized via
  <b>os.path.normpath()</b>.</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Example_config"><a class="selflink" href="#Example_config">Example
  config</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
translate_paths = [
    (&quot;/mnt/a&quot;, &quot;http://b/dir&quot;),
]
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Example_usage"><a class="selflink" href="#Example_usage">Example
  usage</a></h2>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
&gt;&gt;&gt; from pungi.util import translate_paths
&gt;&gt;&gt; print translate_paths(compose_object_with_mapping, &quot;/mnt/a/c/somefile&quot;)
http://b/dir/c/somefile
</pre>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Miscelanous_Settings"><a class="selflink" href="#Miscelanous_Settings">Miscelanous
  Settings</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>paths_module</b></dt>
  <dd class="It-tag">(<i>str</i>) -- Name of Python module implementing the same
      interface as <b>pungi.paths</b>. This module can be used to override where
      things are placed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>link_type</b> = <b>hardlink-or-copy</b></dt>
  <dd class="It-tag">(<i>str</i>) -- Method of putting packages into compose
      directory.
    <div style="height: 1.00em;">&#x00A0;</div>
    Available options:</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>hardlink-or-copy</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>hardlink</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>copy</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>symlink</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>abspath-symlink</b></dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>skip_phases</b></dt>
  <dd class="It-tag">(<i>list</i>) -- List of phase names that should be
      skipped. The same functionality is available via a command line
    option.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>release_discinfo_description</b></dt>
  <dd class="It-tag">(<i>str</i>) -- Override description in <b>.discinfo</b>
      files. The value is a format string accepting <b>%(variant_name)s</b> and
      <b>%(arch)s</b> placeholders.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>symlink_isos_to</b></dt>
  <dd class="It-tag">(<i>str</i>) -- If set, the ISO files from
      <b>buildinstall</b>, <b>createiso</b> and <b>live_images</b> phases will
      be put into this destination, and a symlink pointing to this location will
      be created in actual compose directory.</dd>
</dl>
</div>
<br/>
<h1 class="Sh" title="Sh" id="PROGRESS_NOTIFICATION"><a class="selflink" href="#PROGRESS_NOTIFICATION">PROGRESS
  NOTIFICATION</a></h1>
<i>Pungi</i> has the ability to emit notification messages about progress and
  general status of the compose. These can be used to e.g. send messages to
  <i>fedmsg</i>. This is implemented by actually calling a separate script.
<div style="height: 1.00em;">&#x00A0;</div>
The script will be called with one argument describing action that just
  happened. A JSON-encoded object will be passed to standard input to provide
  more information about the event. At the very least, the object will contain a
  <b>compose_id</b> key.
<div style="height: 1.00em;">&#x00A0;</div>
The script is invoked in compose directory and can read other information there.
<div style="height: 1.00em;">&#x00A0;</div>
Currently these messages are sent:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>status-change</b> -- when composing starts, finishes or
      fails; a <b>status</b> key is provided to indicate details</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>phase-start</b> -- on start of a phase</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>phase-stop</b> -- when phase is finished</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>createiso-targets</b> -- with a list of images to be
      created</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>createiso-imagedone</b> -- when any single image is
      finished</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>createiso-imagefail</b> -- when any single image fails
      to create</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>fail-to-start</b> -- when there are incorrect CLI
      options or errors in configuration file; this message does not contain
      <b>compose_id</b> nor is it started in the compose directory (which does
      not exist yet)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>ostree</b> -- when a new commit is created, this message
      will announce its hash and the name of ref it is meant for.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
For phase related messages <b>phase_name</b> key is provided as well.
<div style="height: 1.00em;">&#x00A0;</div>
A <b>pungi-fedmsg-notification</b> script is provided and understands this
  interface.
<h2 class="Ss" title="Ss" id="Setting_it_up"><a class="selflink" href="#Setting_it_up">Setting
  it up</a></h2>
The script should be provided as a command line argument
  <b>--notification-script</b>.
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
--notification-script=pungi-fedmsg-notification
</pre>
</div>
<br/>
</div>
<br/>
<h1 class="Sh" title="Sh" id="PHASES"><a class="selflink" href="#PHASES">PHASES</a></h1>
Each invocation of <b>punji-koji</b> consists of a set of phases. [image: phase
  diagram] [image]
<div style="height: 1.00em;">&#x00A0;</div>
Most of the phases run sequentially (left-to-right in the diagram), but there
  are use cases where multiple phases run in parallel. This happens for phases
  whose main point is to wait for a Koji task to finish.
<h2 class="Ss" title="Ss" id="Init"><a class="selflink" href="#Init">Init</a></h2>
The first phase to ever run. Can not be skipped. It prepares the comps files for
  variants (by filtering out groups and packages that should not be there).
<h2 class="Ss" title="Ss" id="Pkgset"><a class="selflink" href="#Pkgset">Pkgset</a></h2>
This phase loads a set of packages that should be composed. It has two separate
  results: it prepares repos with packages in <b>work/</b> directory (one per
  arch) for further processing, and it returns a data structure with mapping of
  packages to architectures.
<h2 class="Ss" title="Ss" id="Buildinstall"><a class="selflink" href="#Buildinstall">Buildinstall</a></h2>
Spawns a bunch of threads, each of which runs either <b>lorax</b> or
  <b>buildinstall</b> command (the latter coming from <b>anaconda</b> package).
  The commands create <b>boot.iso</b> and other boot configuration files. The
  image is finally linked into the <b>compose/</b> directory as netinstall
  media.
<div style="height: 1.00em;">&#x00A0;</div>
The created images are also needed for creating live media or other images in
  later phases.
<div style="height: 1.00em;">&#x00A0;</div>
With <b>lorax</b> this phase runs one task per variant.arch combination. For
  <b>buildinstall</b> command there is only one task per architecture and
  <b>product.img</b> should be used to customize the results.
<h2 class="Ss" title="Ss" id="Gather"><a class="selflink" href="#Gather">Gather</a></h2>
This phase uses data collected by <b>pkgset</b> phase and figures out what
  packages should be in each variant. The basic mapping can come from comps
  file, a JSON mapping or <b>additional_packages</b> config option. This inputs
  can then be enriched by adding all dependencies. See gathering for details.
<div style="height: 1.00em;">&#x00A0;</div>
Once the mapping is finalized, the packages are linked to appropriate places and
  the <b>rpms.json</b> manifest is created.
<h2 class="Ss" title="Ss" id="ExtraFiles"><a class="selflink" href="#ExtraFiles">ExtraFiles</a></h2>
This phase collects extra files from the configuration and copies them to the
  compose directory. The files are described by a JSON file in the compose
  subtree where the files are copied. This metadata is meant to be distributed
  with the data (on ISO images).
<h2 class="Ss" title="Ss" id="Createrepo"><a class="selflink" href="#Createrepo">Createrepo</a></h2>
This phase creates RPM repositories for each variant.arch tree. It is actually
  reading the <b>rpms.json</b> manifest to figure out which packages should be
  included.
<h2 class="Ss" title="Ss" id="OSTree"><a class="selflink" href="#OSTree">OSTree</a></h2>
Updates an ostree repository with a new commit with packages from the compose.
  The repository lives outside of the compose and is updated immediately. If the
  compose fails in a later stage, the commit will not be reverted.
<div style="height: 1.00em;">&#x00A0;</div>
Implementation wise, this phase runs <b>rpm-ostree</b> command in Koji runroot
  (to allow running on different arches).
<h2 class="Ss" title="Ss" id="Productimg"><a class="selflink" href="#Productimg">Productimg</a></h2>
Creates <b>product.img</b> files for customizing the bootable media created in
  <b>buildinstall</b> phase.
<h2 class="Ss" title="Ss" id="Createiso"><a class="selflink" href="#Createiso">Createiso</a></h2>
Generates ISO files and accumulates enough metadata to be able to create
  <b>image.json</b> manifest. The file is however not created in this phase,
  instead it is dumped in the <b>pungi-koji</b> script itself.
<div style="height: 1.00em;">&#x00A0;</div>
The files include a repository with all RPMs from the variant. There will be
  multiple images if the packages do not fit on a single image.
<div style="height: 1.00em;">&#x00A0;</div>
The image will be bootable if <b>buildinstall</b> phase is enabled and the
  packages fit on a single image.
<div style="height: 1.00em;">&#x00A0;</div>
There can also be images with source repositories. These are never bootable.
<h2 class="Ss" title="Ss" id="LiveImages,_LiveMedia"><a class="selflink" href="#LiveImages,_LiveMedia">LiveImages,
  LiveMedia</a></h2>
Creates media in Koji with <b>koji spin-livecd</b>, <b>koji spin-appliance</b>
  or <b>koji spin-livemedia</b> command. When the media are finished, the images
  are copied into the <b>compose/</b> directory and metadata for images is
  updated.
<h2 class="Ss" title="Ss" id="ImageBuild"><a class="selflink" href="#ImageBuild">ImageBuild</a></h2>
This phase wraps up <b>koji image-build</b>. It also updates the metadata
  ultimately responsible for <b>images.json</b> manifest.
<h2 class="Ss" title="Ss" id="OSBS"><a class="selflink" href="#OSBS">OSBS</a></h2>
This phase builds docker base images in <i>OSBS</i>.
<div style="height: 1.00em;">&#x00A0;</div>
The finished images are available in registry provided by OSBS, but not
  downloaded directly into the compose. The is metadata about the created image
  in <b>compose/metadata/osbs.json</b>.
<h2 class="Ss" title="Ss" id="OSTreeInstaller"><a class="selflink" href="#OSTreeInstaller">OSTreeInstaller</a></h2>
Creates bootable media that carry an ostree repository as a payload. These
  images are created by running <b>lorax</b> with special templates. Again it
  runs in Koji runroot.
<h2 class="Ss" title="Ss" id="ImageChecksum"><a class="selflink" href="#ImageChecksum">ImageChecksum</a></h2>
Responsible for generating checksums for the images. The checksums are stored in
  image manifest as well as files on disk. The list of images to be processed is
  obtained from the image manifest. This way all images will get the same
  checksums irrespective of the phase that created them.
<h2 class="Ss" title="Ss" id="Test"><a class="selflink" href="#Test">Test</a></h2>
This phase is supposed to run some sanity checks on the finished compose.
<div style="height: 1.00em;">&#x00A0;</div>
The first test is to run <b>repoclosure</b> on each repository. However, even if
  it fails, the compose will still be considered a success. The actual error has
  to be looked up in the compose logs directory.
<div style="height: 1.00em;">&#x00A0;</div>
The other test is to check all images listed the metadata and verify that they
  look sane. For ISO files headers are checked to verify the format is correct,
  and for bootable media a check is run to verify they have properties that
  allow booting.
<h1 class="Sh" title="Sh" id="GATHERING_PACKAGES"><a class="selflink" href="#GATHERING_PACKAGES">GATHERING
  PACKAGES</a></h1>
A compose created by Pungi consists of one or more variants. A variant contains
  a subset of the content targeted at a particular use case.
<div style="height: 1.00em;">&#x00A0;</div>
There are different types of variants. The type affects how packages are
  gathered into the variant.
<div style="height: 1.00em;">&#x00A0;</div>
The inputs for gathering are defined by the <b>gather_source</b> option. It
  provides a list of package names, comps groups names and a list of packages
  that should be filtered out.
<div style="height: 1.00em;">&#x00A0;</div>
Next, <b>gather_method</b> defines how the list is processed. For <b>nodeps</b>,
  the results from source are used pretty much as is [1]. For <b>deps</b>
  method, a process will be launched to figure out what dependencies are needed
  and those will be pulled in.
<dl class="Bl-tag">
  <dt class="It-tag">[1]</dt>
  <dd class="It-tag">The lists are filtered based on what packages are available
      in the package set, but nothing else will be pulled in.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Variant_types"><a class="selflink" href="#Variant_types">Variant
  types</a></h2>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b><i>Variant</i></b></dt>
  <dd class="It-tag">is a base type that has no special behaviour.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><i>Addon</i></b></dt>
  <dd class="It-tag">is built on top of a regular variant. Any packages that
      should go to both the addon and its parent will be removed from addon.
      Packages that are only in addon but pulled in because of
      <b>gather_fulltree</b> option will be moved to parent.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><i>Integrated Layered Product</i></b></dt>
  <dd class="It-tag">works similarly to <i>addon</i>. Additionally, all packages
      from addons on the same parent variant are removed integrated layered
      products.
    <div style="height: 1.00em;">&#x00A0;</div>
    The main difference between an <i>addon</i> and <i>integrated layered
      product</i> is that <i>integrated layered product</i> has its own identity
      in the metadata (defined with product name and version).
    <div style="height: 1.00em;">&#x00A0;</div>
     <b>NOTE:</b></dd>
</dl>
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">There's also <i>Layered Product</i> as a term,
  but this is not related to variants. It's used to describe a product that is
  not a standalone operating system and is instead meant to be used on some
  other base system.</div>
<br/>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b><i>Optional</i></b></dt>
  <dd class="It-tag">contains packages that complete the base variants' package
      set. It always has <b>fulltree</b> and <b>selfhosting</b> enabled, so it
      contains build dependencies and packages which were not specifically
      requested for base variant.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Some configuration options are overridden for particular variant types.
<h2 class="Ss" title="Ss" id="Depsolving_configuration"><a class="selflink" href="#Depsolving_configuration">Depsolving
  configuration</a></h2>
<table class="tbl">
  <colgroup>
    <col style="width: 9.00ex;"/>
    <col style="width: 12.00ex;"/>
    <col style="width: 12.00ex;"/>
  </colgroup>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>Variant</td>
    <td>Fulltree</td>
    <td>Selfhosting</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>base</td>
    <td>configurable</td>
    <td>configurable</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>addon/ILP</td>
    <td>enabled</td>
    <td>disabled</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>optional</td>
    <td>enabled</td>
    <td>enabled</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
</table>
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Daniel Mach
<h1 class="Sh" title="Sh" id="COPYRIGHT"><a class="selflink" href="#COPYRIGHT">COPYRIGHT</a></h1>
2016, Red Hat, Inc.</div>
<table class="foot">
  <tr>
    <td class="foot-date">July 17, 2017</td>
    <td class="foot-os">4.1</td>
  </tr>
</table>
</body>
</html>
