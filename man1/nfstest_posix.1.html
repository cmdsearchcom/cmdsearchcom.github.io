<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>NFSTEST_POSIX(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">NFSTEST_POSIX(1)</td>
    <td class="head-vol">nfstest_posix 1.1</td>
    <td class="head-rtitle">NFSTEST_POSIX(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
nfstest_posix - POSIX file system level access tests
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
nfstest_posix --server &lt;server&gt; [options]
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
Verify POSIX file system level access over the specified path using positive and
  negative testing.
<div style="height: 1.00em;">&#x00A0;</div>
Valid for any version of NFS.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag">--version</dt>
  <dd class="It-tag">show program's version number and exit</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-h, --help</dt>
  <dd class="It-tag">show this help message and exit</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-f FILE, --file=FILE</dt>
  <dd class="It-tag">File where options are specified besides the system wide
      file /etc/nfstest, user wide file $HOME/.nfstest or in the current
      directory .nfstest file
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="NFS_specific_options:"><a class="selflink" href="#NFS_specific_options:">NFS
  specific options:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">-s SERVER, --server=SERVER</dt>
  <dd class="It-tag">Server name or IP address</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-e EXPORT, --export=EXPORT</dt>
  <dd class="It-tag">Exported file system to mount [default: '/']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--nfsversion=NFSVERSION</dt>
  <dd class="It-tag">NFS version, e.g., 3, 4, 4.1, etc. [default: 4.1]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-m MTPOINT, --mtpoint=MTPOINT</dt>
  <dd class="It-tag">Mount point [default: '/mnt/t']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-p PORT, --port=PORT</dt>
  <dd class="It-tag">NFS server port [default: 2049]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--proto=PROTO</dt>
  <dd class="It-tag">NFS protocol name [default: 'tcp']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--sec=SEC</dt>
  <dd class="It-tag">Security flavor [default: 'sys']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-o MTOPTS, --mtopts=MTOPTS</dt>
  <dd class="It-tag">Mount options [default: 'hard,rsize=4096,wsize=4096']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--datadir=DATADIR</dt>
  <dd class="It-tag">Data directory where files are created, directory is
      created on the mount point [default: '']
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="Logging_options:"><a class="selflink" href="#Logging_options:">Logging
  options:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">-v VERBOSE, --verbose=VERBOSE</dt>
  <dd class="It-tag">Verbose level for debug messages [default: 'none']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--tverbose=TVERBOSE</dt>
  <dd class="It-tag">Verbose level for test messages [default: '1']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--createlog</dt>
  <dd class="It-tag">Create log file</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--warnings</dt>
  <dd class="It-tag">Display warnings</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--tag=TAG</dt>
  <dd class="It-tag">Informational tag, it is displayed as an INFO message
      [default: '']
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="Packet_trace_options:"><a class="selflink" href="#Packet_trace_options:">Packet
  trace options:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">--createtraces</dt>
  <dd class="It-tag">Create a packet trace for each test</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--tbsize=TBSIZE</dt>
  <dd class="It-tag">Capture buffer size for tcpdump [default: '50000']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--trcdelay=TRCDELAY</dt>
  <dd class="It-tag">Seconds to delay before stopping packet trace [default:
      0.0]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--keeptraces</dt>
  <dd class="It-tag">Do not remove any trace files [default: remove trace files
      if no errors]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--rmtraces</dt>
  <dd class="It-tag">Remove trace files [default: remove trace files if no
      errors]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-i INTERFACE, --interface=INTERFACE</dt>
  <dd class="It-tag">Device interface [default: automatically selected]
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="File_options:"><a class="selflink" href="#File_options:">File
  options:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">--nfiles=NFILES</dt>
  <dd class="It-tag">Number of files to create [default: 2]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--filesize=FILESIZE</dt>
  <dd class="It-tag">File size to use for test files [default: 65536]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--rsize=RSIZE</dt>
  <dd class="It-tag">Read size to use when reading files [default: 4096]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--wsize=WSIZE</dt>
  <dd class="It-tag">Write size to use when writing files [default: 4096]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--iodelay=IODELAY</dt>
  <dd class="It-tag">Seconds to delay I/O operations [default: 0.1]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--offset-delta=OFFSET_DELTA</dt>
  <dd class="It-tag">Read/Write offset delta [default: 4096]
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="Path_options:"><a class="selflink" href="#Path_options:">Path
  options:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">--sudo=SUDO</dt>
  <dd class="It-tag">Full path of binary for sudo [default:
    '/usr/bin/sudo']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--tcpdump=TCPDUMP</dt>
  <dd class="It-tag">Full path of binary for tcpdump [default:
      '/usr/sbin/tcpdump']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--iptables=IPTABLES</dt>
  <dd class="It-tag">Full path of binary for iptables [default:
      '/sbin/iptables']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--messages=MESSAGES</dt>
  <dd class="It-tag">Full path of log messages file [default:
      '/var/log/messages']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--tmpdir=TMPDIR</dt>
  <dd class="It-tag">Temporary directory [default: '/tmp']
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="Debug_options:"><a class="selflink" href="#Debug_options:">Debug
  options:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">--nocleanup</dt>
  <dd class="It-tag">Do not cleanup created files</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--bugmsgs=BUGMSGS</dt>
  <dd class="It-tag">File containing test messages to mark as bugs if they
      failed</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--ignore</dt>
  <dd class="It-tag">Ignore all bugs given by bugmsgs</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--nomount</dt>
  <dd class="It-tag">Do not mount server and run the tests on local disk
    space</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--basename=BASENAME</dt>
  <dd class="It-tag">Base name for all files and logs [default: automatically
      generated]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--nfsdebug=NFSDEBUG</dt>
  <dd class="It-tag">Set NFS kernel debug flags and save log messages [default:
      '']</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--rpcdebug=RPCDEBUG</dt>
  <dd class="It-tag">Set RPC kernel debug flags and save log messages [default:
      '']
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="Test_options:"><a class="selflink" href="#Test_options:">Test
  options:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag">--runtest=RUNTEST</dt>
  <dd class="It-tag">Comma separated list of tests to run, if list starts with a
      '^' then all tests are run except the ones listed [default: 'all']</dd>
</dl>
<h1 class="Sh" title="Sh" id="TESTS"><a class="selflink" href="#TESTS">TESTS</a></h1>
<h2 class="Ss" title="Ss" id="access"><a class="selflink" href="#access">access</a></h2>
<pre>
Verify POSIX API access() on files with different modes.
</pre>
<h2 class="Ss" title="Ss" id="chdir"><a class="selflink" href="#chdir">chdir</a></h2>
<pre>
Verify POSIX API chdir() by changing to a newly created directory
and then by changing back to the original directory.
</pre>
<h2 class="Ss" title="Ss" id="close"><a class="selflink" href="#close">close</a></h2>
<pre>
Verify POSIX API close() works and that writing to a closed file
descriptor returns an error.
</pre>
<h2 class="Ss" title="Ss" id="closedir"><a class="selflink" href="#closedir">closedir</a></h2>
<pre>
Verify POSIX API closedir() works and that reading to a closed file
descriptor returns an error.
</pre>
<h2 class="Ss" title="Ss" id="creat"><a class="selflink" href="#creat">creat</a></h2>
<pre>
Verify POSIX API creat(path, mode) is equivalent to
open(path, O_WRONLY|O_CREAT|O_TRUNC, mode). First test with a path
that does not exist to verify the file was created and then test
with a path that does exist to verify that the file is truncated.
</pre>
<h2 class="Ss" title="Ss" id="fcntl"><a class="selflink" href="#fcntl">fcntl</a></h2>
<pre>
Verify the POSIX API fcntl() commands F_DUPFD, F_GETFD, F_SETFD,
F_GETFL, F_SETFL, and FD_CLOEXEC. The F_DUPFD command is tested
by performing operations on the original and dupped file descriptor
to ensure they behave correctly. The F_GETFD and F_SETFD commands
are tested by setting the FD_CLOEXEC flag and making sure it gets set.
The F_GETFL and F_SETFL commands are tested by setting the O_APPEND
flag and making sure it gets set.
Run the test for both 'read' and 'write'.
</pre>
<h2 class="Ss" title="Ss" id="fdatasync"><a class="selflink" href="#fdatasync">fdatasync</a></h2>
<pre>
Verify POSIX API fdatasync().
</pre>
<h2 class="Ss" title="Ss" id="fstat"><a class="selflink" href="#fstat">fstat</a></h2>
<pre>
Verify POSIX API fstat() by checking the mode on a file and that
it returns the expected structure members. Create a symlink and
verify that fstat returns information about the link.
</pre>
<h2 class="Ss" title="Ss" id="fstatvfs"><a class="selflink" href="#fstatvfs">fstatvfs</a></h2>
<pre>
Verify POSIX API fstatvfs() by making sure all the members of the
structure are returned.
</pre>
<h2 class="Ss" title="Ss" id="fsync"><a class="selflink" href="#fsync">fsync</a></h2>
<pre>
Verify POSIX API fsync().
</pre>
<h2 class="Ss" title="Ss" id="link"><a class="selflink" href="#link">link</a></h2>
<pre>
Verify POSIX API link(src, dst) creates a link and updates
st_ctime field for the file. Verify that link updates the
st_ctime and st_mtime for the directory. Verify st_link count
incremented by 1 for the file.
</pre>
<h2 class="Ss" title="Ss" id="lseek"><a class="selflink" href="#lseek">lseek</a></h2>
<pre>
Verify POSIX API lseek() with different offsets and whence
values including seeking past the end of the file.
</pre>
<h2 class="Ss" title="Ss" id="lstat"><a class="selflink" href="#lstat">lstat</a></h2>
<pre>
Verify POSIX API lstat() by checking the mode on a file and that
it returns the expected structure members. Create a symlink and
verify that lstat returns information about the link.
</pre>
<h2 class="Ss" title="Ss" id="mkdir"><a class="selflink" href="#mkdir">mkdir</a></h2>
<pre>
Verify POSIX API mkdir(). Verify that mkdir with a path of a symbolic
link fails. Verify that the st_ctime and st_mtime fields of the
parent directory are updated.
</pre>
<h2 class="Ss" title="Ss" id="mmap"><a class="selflink" href="#mmap">mmap</a></h2>
<pre>
Verify POSIX API mmap() by mapping a file and verifying I/O
operations. Verify mmap followed by memory read of existing
file works. Verify mmap followed by memory write to file works.
</pre>
<h2 class="Ss" title="Ss" id="munmap"><a class="selflink" href="#munmap">munmap</a></h2>
<pre>
Verify POSIX API munmap() by mapping a file and then unmapping
the file.
</pre>
<h2 class="Ss" title="Ss" id="opendir"><a class="selflink" href="#opendir">opendir</a></h2>
<pre>
Verify POSIX API opendir() on a directory.
</pre>
<h2 class="Ss" title="Ss" id="read"><a class="selflink" href="#read">read</a></h2>
<pre>
Verify POSIX API read() by reading data from a file. Verify that
the st_atime of the file is updated after the read. Verify a read
of 0 bytes returns 0.
</pre>
<h2 class="Ss" title="Ss" id="readdir"><a class="selflink" href="#readdir">readdir</a></h2>
<pre>
Verify POSIX API readdir() on a directory.
</pre>
<h2 class="Ss" title="Ss" id="readlink"><a class="selflink" href="#readlink">readlink</a></h2>
<pre>
Verify Test POSIX API readlink() by reading a symbolic link.
</pre>
<h2 class="Ss" title="Ss" id="rename"><a class="selflink" href="#rename">rename</a></h2>
<pre>
Verify POSIX API rename() by renaming a file, directory, and a
symbolic link. Verify that a rename from a file to a symbolic
link will cause the symbolic link to be removed.
</pre>
<h2 class="Ss" title="Ss" id="rewinddir"><a class="selflink" href="#rewinddir">rewinddir</a></h2>
<pre>
Verify POSIX API rewinddir() on a directory.
</pre>
<h2 class="Ss" title="Ss" id="rmdir"><a class="selflink" href="#rmdir">rmdir</a></h2>
<pre>
Verify POSIX API rmdir() by removing a directory. Verify that the
parent's st_ctime and st_mtime are updated.
</pre>
<h2 class="Ss" title="Ss" id="seekdir"><a class="selflink" href="#seekdir">seekdir</a></h2>
<pre>
Verify POSIX API seekdir() on a directory.
</pre>
<h2 class="Ss" title="Ss" id="stat"><a class="selflink" href="#stat">stat</a></h2>
<pre>
Verify POSIX API stat() by checking the mode on a file and that
it returns the expected structure members. Create a symlink and
verify that stat returns information about the file.
</pre>
<h2 class="Ss" title="Ss" id="statvfs"><a class="selflink" href="#statvfs">statvfs</a></h2>
<pre>
Verify POSIX API statvfs() by making sure all the members of the
structure are returned.
</pre>
<h2 class="Ss" title="Ss" id="symlink"><a class="selflink" href="#symlink">symlink</a></h2>
<pre>
Verify POSIX API symlink() by creating a symbolic link and verify
that the file type is slnk.
</pre>
<h2 class="Ss" title="Ss" id="sync"><a class="selflink" href="#sync">sync</a></h2>
<pre>
Verify POSIX API sync().
</pre>
<h2 class="Ss" title="Ss" id="telldir"><a class="selflink" href="#telldir">telldir</a></h2>
<pre>
Verify POSIX API telldir() on a directory.
</pre>
<h2 class="Ss" title="Ss" id="unlink"><a class="selflink" href="#unlink">unlink</a></h2>
<pre>
Verify POSIX API unlink() by unlinking a file and verify that it
was removed. Verify that the st_ctime and st_mtime fields of the
parent directory were updated. Then unlink a symbolic link and
verify that the symbolic link was removed but not the referenced
file. Then remove an opened file and verify that I/O still occurs
to the file after the unlink and that the file gets removed when
the file is closed. Create a file and then hard link to it so the
link count is greater than 1. Unlink the hard file and verify that
st_ctime field is updated.
</pre>
<h2 class="Ss" title="Ss" id="write"><a class="selflink" href="#write">write</a></h2>
<pre>
Verify POSIX API write() by writing 0 bytes and verifying 0
is returned. Write a pattern the file, seek +N, write another
pattern, and close the file. Open the file and read in both
written patterns and verify that it is the correct pattern.
Read in the data from the hole in the file and verify that it is 0.
</pre>
<h2 class="Ss" title="Ss" id="open"><a class="selflink" href="#open">open</a></h2>
<pre>
Verify POSIX API open() on a file. Verify file creation using
the O_CREAT flag and verifying the file mode is set to the
specified value. Verify the st_ctime and st_mtime are updated
on the parent directory after the file was created. Verify open
on existing file fails with the O_EXCL flag set. Verify write
succeeds and read fails if file was open with O_WRONLY. Verify
read succeeds and write fails if file was open with O_RDONLY.
Verify that all writes with O_APPEND set are to the end of the file.
Use O_DSYNC, O_RSYNC, and O_SYNC flags in open calls.
Verify file open with O_CREAT and O_TRUNC set will truncate an
existing file. Verify that it updates the file st_ctime and st_mtime.
</pre>
<h2 class="Ss" title="Ss" id="chmod"><a class="selflink" href="#chmod">chmod</a></h2>
<pre>
Verify POSIX API chmod() on a file and directory by trying all valid
combinations of modes. Verify that the st_ctime files is updated
for both the file and directory.
</pre>
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
The only required option is --server
<div>&#x00A0;</div>
$ nfstest_posix --server 192.168.0.11
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
The user id in the local host must have access to run commands as root using the
  'sudo' command without the need for a password.
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>nfstest.test_util(3),</b> <b>nfstest_alloc(1),</b> <b>nfstest_cache(1),</b>
  <b>nfstest_delegation(1),</b> <b>nfstest_dio(1),</b> <b>nfstest_file(1),</b>
  <b>nfstest_interop(1),</b> <b>nfstest_io(1),</b> <b>nfstest_lock(1),</b>
  <b>nfstest_pkt(1),</b> <b>nfstest_pnfs(1),</b> <b>nfstest_sparse(1),</b>
  <b>nfstest_xid(1)</b>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
No known bugs.
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Jorge Mora (mora@netapp.com)</div>
<table class="foot">
  <tr>
    <td class="foot-date">23 November 2015</td>
    <td class="foot-os">NFStest 2.1.1</td>
  </tr>
</table>
</body>
</html>
