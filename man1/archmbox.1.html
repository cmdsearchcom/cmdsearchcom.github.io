<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 15:50:03 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>archmbox(1) archmbox(1)</p>

<p style="margin-top: 1em">NAME <br>
archmbox - a simple email archiver</p>

<p style="margin-top: 1em">SYNOPSIS <br>
archmbox [ -h | --version ] <br>
archmbox MODE [ OPTIONS ] -d date mailbox [ mailbox ... ]
<br>
archmbox MODE [ OPTIONS ] -o days mailbox [ mailbox ...
]</p>

<p style="margin-top: 1em">DESCRIPTION <br>
Archmbox is a simple email archiver written in perl; it
parses one or more mailboxes, select some or all messages
and then perform specific actions on the selected
messages.</p>

<p style="margin-top: 1em">Four different MODES are
available:</p>

<p style="margin-top: 1em">&Acirc;&middot; list mode, which
is useful to list all selected messages before archmbox
performs the real operations (archiving or deleting)</p>

<p style="margin-top: 1em">&Acirc;&middot; kill mode, if
messages should be deleted from the mailbox(es) rather than
archived</p>

<p style="margin-top: 1em">&Acirc;&middot; archive mode, to
archive the selected messages in a different mailbox</p>

<p style="margin-top: 1em">&Acirc;&middot; copy mode, to
copy selected messages from a source mailbox(es) without
modifying it</p>

<p style="margin-top: 1em">Messages selection is based upon
a date criteria; an absolute date or a days offset can be
specified.</p>

<p style="margin-top: 1em">It is also possible to refine
the selection using perl regular expressions on the header
fields of the message. Keep in mind to quote the so called
metacharacters, which are <br>
reserved for use in perl&rsquo;s regex notation. The
metacharacters are</p>

<p style="margin-top: 1em">{}[]()^$.|*+? <br>
All archived messages are stored in a new mailbox with the
same name of the original one + .archived as extension (this
is the default, but can be changed); the archive mailbox
<br>
can be saved in gz or bz2 compressed format as well.</p>

<p style="margin-top: 1em">Please note that the archive
mailbox format is always mbox, regardless of original
mailbox format. Moreover, mailboxes must be specified using
the full path.</p>

<p style="margin-top: 1em">Messages are appended to the
archive mailbox to allow multiple executions of the script
against the same mailbox.</p>

<p style="margin-top: 1em">MODES <br>
-a, --archive <br>
Selected messages are archived in a different mailbox.</p>

<p style="margin-top: 1em">-k, --kill <br>
Selected messages are deleted rather than archived.</p>

<p style="margin-top: 1em">-l, --list <br>
List all selected messages. <br>
Warnings about skipped mailboxes (in use, empty ...) are
printed to stderr. So redirecting them to /dev/null
won&rsquo;t clutter your list.</p>

<p style="margin-top: 1em">-y, --copy <br>
Selected messages are copied from the source mailbox.</p>

<p style="margin-top: 1em">OPTIONS <br>
-b, --backup <br>
Creates a backup of the original mailbox before archmbox
execution. The mailbox is called mailbox.backup</p>

<p style="margin-top: 1em">--bzip2 <br>
Use bzip2 to compress the archive mailbox (use with -c).</p>

<p style="margin-top: 1em">-c, --compress <br>
Compress the archive mailbox after script execution.</p>

<p style="margin-top: 1em">-d, --date &lt;date&gt; <br>
Specifies the threshold date for messages. The date must be
supplied in the following format: yyyy-mm-dd</p>

<p style="margin-top: 1em">-D, --date-header <br>
Force the use of the &quot;Date:&quot; header to age a
message. If the header is somehow corrupt, the date/time
informations are gathered for the beginning line of the
message.</p>

<p style="margin-top: 1em">-e, --extension
&lt;extension&gt; <br>
Specifies the suffix for the archive mailbox; the default is
archived. If none is specified, no suffix will be used (use
carefully).</p>

<p style="margin-top: 1em">-f, --full-name <br>
Prepends the path of the mailbox to the name of the archive
mailbox. This option overrides -n.</p>

<p style="margin-top: 1em">--format <br>
Specifies the format of the mailboxes to parse. Legal values
are mbox and mbx. Defaults to &quot;mbox&quot;.</p>

<p style="margin-top: 1em">-h, --help <br>
Prints help.</p>

<p style="margin-top: 1em">-i, --ignore &lt;regexp&gt; <br>
Any mailbox/directory matching &lt;regexp&gt; will be
skipped while archiving.</p>

<p style="margin-top: 1em">--keep-flagged <br>
Flagged messages will not be archived.</p>

<p style="margin-top: 1em">--keep-unread <br>
Unread messages will not be archived.</p>

<p style="margin-top: 1em">-m, --minsize <br>
Specifies the minimum size of the mailbox to be archived.
Mailboxes smaller than &lt;minsize&gt; will not be parsed
for archiving.</p>

<p style="margin-top: 1em">-n, --archive-name <br>
Specifies the name of the archive file (default: mailbox
name)</p>

<p style="margin-top: 1em">--nosymlink <br>
Do not follow symbolic links when processing mailboxes.</p>

<p style="margin-top: 1em">--nowarnings <br>
Suppress mailbox related warnings. Use only if you know what
you&rsquo;re doing!</p>

<p style="margin-top: 1em">--omit-prefix &lt;prefix&gt;
<br>
Omit &lt;prefix&gt; from the name of the mailbox when full
name (option -f) is required.</p>

<p style="margin-top: 1em">-o, --offset &lt;days&gt; <br>
Specifies the offset (in days) from today for threshold date
of a message. This option replaces -d. If you specify -1,
archmbox will operate on all messages.</p>

<p style="margin-top: 1em">-p, --archive-path, --path
&lt;directory&gt; <br>
Specifies where to store the archive mailbox (default:
&quot;.&quot;). &lt;directory&gt; must be specified using
full path. The --path option is now deprecated and will be
dropped in <br>
future releases.</p>

<p style="margin-top: 1em">-r, --reverse <br>
Reverse the sense of offset or date value. It usually means
older than but with this switch, it means newer than.</p>

<p style="margin-top: 1em">-R, --recursive <br>
Act recursively on directories. If one or more directories
are specified on the command line, all mailboxes stored in
those directories will be parsed for archiving. <br>
Implies option -f.</p>

<p style="margin-top: 1em">-t, --tmpdir &lt;directory&gt;
<br>
Specify a temporary working directory. This value overrides
the default one, which will be set in descending order to
the first defined one of: the environment variables <br>
$TMPDIR and $TMP, the compiled in one and, as a fallback,
&rsquo;/tmp&rsquo;. <br>
To see the default value used by archmbox, do: archmbox
--help. <br>
&lt;directory&gt; must be specified using full path.</p>

<p style="margin-top: 1em">--time &lt;time&gt; <br>
Use &lt;time&gt; in conjunction with &lt;date&gt; (option
-d) to refine the threshold age for archiving. &lt;time&gt;
must be specified in the following format: hh:mm:ss.</p>

<p style="margin-top: 1em">--totals <br>
Prints an overall summary of the archiving operations. The
summary contains the number of parsed and skipped mailboxes,
the total number of messages parsed and saved, the <br>
total space used and saved.</p>

<p style="margin-top: 1em">-v, --verbose <br>
Verbosity level. Default is 1 (line per message) in --list
output. So, if set to 1 it only lists msgid, sender and
subject. With -v=2, it also prints date.</p>

<p style="margin-top: 1em">--version <br>
Prints version number.</p>

<p style="margin-top: 1em">-x, --regexp
&lt;header=regexp&gt; <br>
It is specified in form -x field=&rsquo;regexp&rsquo;, where
field can be any header. The header part is case sensitive.
The regexp part is case sensitive if the regexp contains at
<br>
least one upper case letter, and case insensitive otherwise.
<br>
If message satisfies date range, but does not satisfy regexp
match on specified field, it won&rsquo;t be archived. <br>
The option can be specified more than once; in this case,
the message is regexp matched against all the given rules,
and if it satisfies any, it will be archived.</p>

<p style="margin-top: 1em">-X, --Regexp
&lt;header=regexp&gt; <br>
Same as -x, --regexp except that for matching the regular
expressions a logical &rsquo;and&rsquo; mode is used for all
regexp including the regexp given by -x, --regexp.</p>

<p style="margin-top: 1em">CONFIGURATION <br>
Archmbox is completely written in perl, but it uses some
shell helpers to perform its job (fuser, rm, gzip/gunzip
etc.).</p>

<p style="margin-top: 1em">The correct path for the helpers
(both required and optional ones) is probed at installation
time. If one required helper is missing the installation
will not take place. If one <br>
optional helper is missing, the feature provided using that
helper will be unavailable, but the script will be installed
anyway.</p>

<p style="margin-top: 1em">All other relevant configuration
options can be specified at installation time or at run time
using the command line switches.</p>

<p style="margin-top: 1em">USAGE EXAMPLES <br>
A complete example:</p>

<p style="margin-top: 1em">archmbox -a -b -c -e 01 -f -d
2002-01-01 -p ~/mail-archive ~/Mail/personal-stuff</p>

<p style="margin-top: 1em">This will archive all messages
older than (received before...) Jan 1st 2002 from the
personal-stuff mailbox in the Mail directory. Archive
messages are saved in a mailbox called <br>
Mail-personal-stuff.01.gz in the ~/mail-archive directory.
After execution, you&rsquo;ll find a mailbox called
personal-stuff.backup in ~/Mail.</p>

<p style="margin-top: 1em">Complex examples, using perl
regular expressions:</p>

<p style="margin-top: 1em">archmbox -a -o 1 --keep-flagged
--keep-unread -x
From=&rsquo;(nagios|arpwatch|logcheck)@host.net&rsquo; -x
Subject=&rsquo;^(Security Events|Syslog Summary|)&rsquo;
~/Mail/inbox</p>

<p style="margin-top: 1em">This will archive all unflagged,
read messages older than 1 day where the sender address
matches nagios@host.net, arpwatch@host.net or
logcheck@host.net or whose subject field <br>
starts with either &rsquo;Security Events&rsquo; or
&rsquo;Syslog Summary&rsquo; or &rsquo;[SNORT]&rsquo; from
the mailbox ~/Mail/inbox. Messages will be saved in
inbox.archive in the current directory where archm&acirc;
<br>
box was started from.</p>

<p style="margin-top: 1em">archmbox --archive --offset 1
--keep-flagged --keep-unread --Regexp
From=&rsquo;@(host1|host2).example.com&rsquo; --regexp
Subject=&rsquo;^(Security Events|Syslog Summary|)&rsquo;
--archive-path ~/Mail/local-network.archive --archive-name
system-msgs --extension &rsquo;none&rsquo; ~/Mail/inbox</p>

<p style="margin-top: 1em">This will archive all unflagged,
read messages older than 1 day where the sender address
matches @host1.example.com or @host2.example.com and whose
subject field starts with <br>
either &rsquo;Security Events&rsquo; or &rsquo;Syslog
Summary&rsquo; or &rsquo;[SNORT]&rsquo; from the mailbox
~/Mail/inbox. Messages will be archived to the mbox
system-msgs in the directory ~/Mail/local-net&acirc; <br>
work.archive.</p>

<p style="margin-top: 1em">Some simpler examples:</p>

<p style="margin-top: 1em">archmbox -a -o 15
~/Mail/personal-stuff</p>

<p style="margin-top: 1em">This will archive all messages
older than 15 days in personal-stuff.archived (uncompressed
mailbox).</p>

<p style="margin-top: 1em">archmbox -a -r -o 15
~/Mail/personal-stuff</p>

<p style="margin-top: 1em">The same as above, but only
messages newer than 15 days will be archived.</p>

<p style="margin-top: 1em">archmbox -k -o 15
~/Mail/personal-stuff</p>

<p style="margin-top: 1em">This will delete all messages
older than 15 days from Mail/personal-stuff</p>

<p style="margin-top: 1em">archmbox -a -o 15 ~/Mail/*
-c</p>

<p style="margin-top: 1em">This will archive all messages
older than 15 days in every mailbox found in ~/Mail. All the
archive mailboxes will be compressed.</p>

<p style="margin-top: 1em">archmbox -l -r -c /tmp/mbox -o
20</p>

<p style="margin-top: 1em">List all messages in /tmp/mbox
which are newer than 20 days. Option -c is meaningless (and
so ignored...).</p>

<p style="margin-top: 1em">archmbox -l -r -c /tmp/mbox -o
20 -a --bzip2</p>

<p style="margin-top: 1em">Same as above, but archiving is
forced (-a) and bzip2 is used for compression.</p>

<p style="margin-top: 1em">archmbox -a -x
Subject=&rsquo;archmbox&rsquo; -o 7 ~/mbox</p>

<p style="margin-top: 1em">Select for archiving all
messages older than 7 days whose subject field satisfies
regexp match Subject =~ /archmbox/ (Subject is case
sensitive, archmbox is is case insensitive).</p>

<p style="margin-top: 1em">archmbox -l -x
Subject=&rsquo;archmbox&rsquo; -x From=&rsquo;fritz&rsquo;
-o 7 ~/mbox</p>

<p style="margin-top: 1em">Select for archiving all
messages older than 7 days whose subject field contains
archmbox or the sender is fritz (matches are case
insensitive).</p>

<p style="margin-top: 1em">archmbox -l -x
Subject=&rsquo;archmbox&rsquo; -X From=&rsquo;fritz&rsquo;
-o 7 ~/mbox</p>

<p style="margin-top: 1em">Select for archiving all
messages older than 7 days whose subject field contains
archmbox and the sender is fritz (matches are case
insensitive).</p>

<p style="margin-top: 1em">archmbox -a -o 5 -R /tmp/mbox
~/Mail</p>

<p style="margin-top: 1em">archmbox will archive all
messages older than five days in /tmp/mbox. It then start
parsing all mailboxes stored in ~/Mail (recursion is active,
and ~/Mail is a directory). If <br>
one or more directories will be found in ~/Mail, those
directories will be explored as well.</p>

<p style="margin-top: 1em">archmbox -a -o -1
~/Mail/my_mbx_mailbox --format mbx</p>

<p style="margin-top: 1em">archmbox archives all messages
stored in my_mbx_mailbox and puts them into
my_mbx_mailbox.archived. The source mailbox is a mbx mailbox
(--format mbx is used). The archive mail&acirc; <br>
box will be a mbox mailbox.</p>

<p style="margin-top: 1em">NOTES <br>
When the script has to decide if a message needs to be
selected from the mailbox, it looks for the header From
generated by the mail server (this is the first line of the
mes&acirc; <br>
sage) and doesn&rsquo;t care about the date specified by the
sender&rsquo;s mail client. This is useful to avoid removing
messages sent from misconfigured mail clients. This behavior
can be <br>
changed by forcing the use of the &quot;Date:&quot; header
(option -D).</p>

<p style="margin-top: 1em">Not all options are meaningfull
in all modes, ie compression is meaningless in list or kill
mode. If you specify a useless option for a particular mode,
archmbox simply ignores <br>
it.</p>

<p style="margin-top: 1em">Archmbox uses a working
directory to store temporary mailboxes. A default value for
that directory is hard coded in the script, but can be
changed during the configura&acirc; <br>
tion/installation process (see INSTALL for details). It
might happen that your mailboxes are too big for the
partition holding this temporary directory, or you might
want to <br>
perform archiving on too much mailboxes at the same time. In
other words, you may run out of space. Use the -t option to
specify a suitable working directory at runtime.</p>

<p style="margin-top: 1em">If you see some differences in
the mailbox&rsquo;s dimension (size/free space), keep in
mind that your mailbox may contain a special message (512
bytes in size) with internal informa&acirc; <br>
tion related to the mailbox. This message is meaningless for
you, though archmbox recognizes it and lets you be aware of
it. That message is left untouched in your source
mail&acirc; <br>
box.</p>

<p style="margin-top: 1em">A few words about locking. There
has been a discussion about archmbox handles file locking.
The answer is simple: no mailbox is ever locked. The reason
behind this behavior is <br>
that I want archmbox to be as least invasive as possible, so
other kind of checks are performed to ensure that no data is
lost (mailbox has changed/mailbox is in use by another <br>
program). I will surely add some locking mechanism in the
future.</p>

<p style="margin-top: 1em">You don&rsquo;t need to execute
archmbox as root... just take care to have write permissions
for the directories you use.</p>

<p style="margin-top: 1em">LINKS <br>
Archmbox can be downloaded from:</p>


<p style="margin-top: 1em">http://adc-archmbox.sourceforge.net</p>

<p style="margin-top: 1em">Archmbox is distributed under
the terms of the GPL</p>

<p style="margin-top: 1em">AUTHOR(S) <br>
Copyright (C) 2001-2005</p>

<p style="margin-top: 1em">Alessandro Dotti Contra
&lt;adotti@users.sourceforge.net&gt;</p>

<p style="margin-top: 1em">Parts of the code were
contributed by:</p>

<p style="margin-top: 1em">Alex Aminoff, Brian Medley, Buck
Holsinger, Davor Ocelic, Fabrice Noilhan, Jayanth Varma,
Juergen Edner, Laurent Cheylus, Nicolas Ecarnot, Paco
Regodon, Scott Thompson, Juergen <br>
Desher.</p>

<p style="margin-top: 1em">The FreeBSD port is maintained
by Talal Al-Dik. <br>
The OpenDarwin port is maintained by Markus Weissman. <br>
The Debian package is maintained by Alberto Furia
&lt;straluna@email.it&gt;</p>

<p style="margin-top: 1em">BUGS <br>
Please report bugs to
&lt;adotti@users.sourceforge.net&gt;</p>

<p style="margin-top: 1em">SEE ALSO <br>
PERLREQUICK(1), PERLRETUT(1), PERLRE(1)</p>
 
<p style="margin-top: 1em">archmbox(1)</p>
<hr>
</body>
</html>
