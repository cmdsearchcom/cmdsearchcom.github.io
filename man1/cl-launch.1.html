<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>CL-LAUNCH(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">CL-LAUNCH(1)</td>
    <td class="head-vol">Shell Scripting with Common Lisp</td>
    <td class="head-rtitle">CL-LAUNCH(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="Name"><a class="selflink" href="#Name">Name</a></h1>
cl-launch - shell wrapper for Common Lisp
<h1 class="Sh" title="Sh" id="Synopsis"><a class="selflink" href="#Synopsis">Synopsis</a></h1>
<pre>
<div class="Pp"></div>
cl [options] &#x00B4;(lisp (form) to evaluate)&#x00B4;
    evaluate specified form, print the results followed by newline
    as in: cl -l sbcl -sp my-system-and-package &#x00B4;(some form)&#x00B4;
<div class="Pp"></div>
cl [options] script-file arguments...
    run specified Lisp script, passing arguments, as in a script with
    #!/usr/bin/cl -sp my-system-and-package -E main
<div class="Pp"></div>
cl [options] [--execute] [options] [-- arguments...]
    run the specified software without generating a script (default)
<div class="Pp"></div>
cl [options] --output EXECUTABLE [options]
    generate an executable script or binary from the software specification
</pre>
<h1 class="Sh" title="Sh" id="Special_modes"><a class="selflink" href="#Special_modes">Special
  modes</a></h1>
<pre>
<div class="Pp"></div>
-h  or  -?  --help           display a short help message
-H          --more-help      show complete help (you may use a $PAGER)
-V          --version        display cl-launch version and configuration
-u FILE     --update FILE    update a cl-launch script to current version
</pre>
<h1 class="Sh" title="Sh" id="Software_specification"><a class="selflink" href="#Software_specification">Software
  specification</a></h1>
<pre>
<div class="Pp"></div>
-w CODE     --wrap CODE          shell wrapper CODE to run in cl-launch
-l LISP...  --lisp LISP...       try use these LISP implementations
-m IMAGE    --image IMAGE        build from Lisp image IMAGE
-f FILE     --file FILE          include lisp FILE while building
-L FILE     --load FILE          load lisp FILE while building
-S X        --source-registry X  override source registry of asdf systems
-s SYSTEM   --system SYSTEM      load asdf SYSTEM while building
            --load-system SYSTEM same as above (buildapp compatibility)
-p PACKAGE  --package PACKAGE    change current package to PACKAGE
-sp SP      --system-package SP  combination of -s SP and -p SP
-e FORM     --eval FORM          evaluate FORM while building
            --require MODULE     require MODULE while building
-DE N/F  --dispatched-entry N/F  if exec&#x00B4;ed as N, restart from (F argv)
-i FORM     --init FORM          evaluate FORM at restart
-ip FORM    --print FORM         evaluate and princ FORM at restart
-iw FORM    --write FORM         evaluate and write FORM at restart
-r FUNC     --restart FUNC       complete restart by calling (FUNC)
-E FUNC     --entry FUNC         complete restart by calling (FUNC argv)
-F FORM     --final FORM         evaluate FORM before dumping IMAGE
-I PATH     --include PATH       runtime PATH to cl-launch installation
+I          --no-include         disable cl-launch installation feature
-R          --rc                 try read /etc/cl-launchrc, ~/.cl-launchrc
+R          --no-rc              skip /etc/cl-launchrc, ~/.cl-launchrc
-Q          --quicklisp          use quicklisp (see --more-help)
+Q          --no-quicklisp       do not use quicklisp
-b          --clbuild            use clbuild (see --more-help)
+b          --no-clbuild         do not use clbuild
-v          --verbose            be quite noisy while building
-q          --quiet              be quite quiet while building (default)
</pre>
<h1 class="Sh" title="Sh" id="Output_options"><a class="selflink" href="#Output_options">Output
  options</a></h1>
<pre>
<div class="Pp"></div>
-x   -o !   --execute            run the specified software NOW (default)
-o FILE     --output FILE        create executable FILE
-d IMAGE    --dump IMAGE         dump IMAGE for faster startup
-X ... --   (see more help)      use #!/.../cl-launch as script interpreter
--          --                   end of arguments when using -x or -X
</pre>
<h1 class="Sh" title="Sh" id="Invocation_of_cl-launch"><a class="selflink" href="#Invocation_of_cl-launch">Invocation
  of cl-launch</a></h1>
<b>cl-launch</b> will evaluate Common Lisp code or create shell scripts or
  executable binaries that evaluate Common Lisp code. cl-launch follows the
  invocation conventions of both Unix script interpreters and Common Lisp
  implementations.
<div class="Pp"></div>
A suggested short-hand name for <b>cl-launch</b> is <b>cl</b> (you may create a
  symlink if it isn&#x00B4;t included in your operating system&#x00B4;s
  <b>cl-launch</b> package). We&#x00B4;d like to homestead the path
  <b>/usr/bin/cl</b> while we can, so that script authors can reasonably expect
  a script to work when it starts with:
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
    `#!/usr/bin/cl`
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
(See <i>Simple cl-launch scripts</i> below for caveats with <b>#!</b> scripts
  though.) Recent Linux kernels support a script interpreter itself being a
  script; BSD kernels don&#x00B4;t and require a small C program cl-shim to be
  compiled and installed as /usr/bin/cl to use cl-launch this way.
<div class="Pp"></div>
To work properly, <b>cl-launch</b> 4.1.4 depends on <b>ASDF</b> 3.1.2 or later,
  and on its portability layer <b>UIOP</b>, to manage compilation and image life
  cycle.
<div class="Pp"></div>
The software is specified as the evaluation of code in several phases; the
  distinction matters most for creating executable binaries, but understanding
  the evaluation model can avoid surprises in other cases too.
<div class="Pp"></div>
In the first phase, the Lisp image is initialized:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">optionally having your Lisp start from a Lisp <b>IMAGE</b>
      (option <b>-I --image</b>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">loading a small header of code that provides common
      <b>cl-launch</b> functionality</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">loading <b>ASDF3</b>. The <b>cl-launch</b> header will try
      hard to load <b>ASDF 3.1.2</b> or later. If your implementation does not
      provide it via <b>(require &quot;asdf&quot;)</b>, you can configure your
      implementation&#x00B4;s <b>ASDF</b> (if any) to find it. Or you can put it
      in your home, under <b>~/common-lip/asdf/</b> and <b>cl-launch</b> will
      find it. Or it may be installed in
      <b>/usr/share/common-lisp/source/cl-asdf/</b> in which case
      <b>cl-launch</b> will also find it. Failing any of the above,
      <b>cl-launch</b> will be unable to proceed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">optionally loading quicklisp
      <i>http://beta.quicklisp.org/</i> (option <b>-Q --quicklisp</b>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
In a second phase, your software is built, based on the following options, in
  order of appearance:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">evaluating one or several <b>FORMS</b> (option <b>-e
      --eval</b>) in the current package. The series of forms is evaluated as by
      <b>LOAD</b>, in a context where the <b>*package*</b> has been set to the
      current package (see below explanations on packages).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">compiling a <b>FILE</b> and load the fasl (option <b>-L
      --load</b>) Files are loaded with <b>*package*</b> bound to the current
      package (see below).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">including a <b>FILE</b>, compiling it and loading the fasl
      (option <b>-f --file</b>) The contents of the <b>FILE</b>, which will have
      be included in the output script, will be compiled and the fasl loaded as
      if by option <b>-L --load</b>. The difference matters mostly when creating
      an output script, as opposed to executing the code immediately or dumping
      an image. Only one file may be specified this way. If a filename specified
      with <b>-f --file</b> is <b>-</b> (after stripping quotes), then the
      standard input is used. You may thus concatenate several files and feed
      them to <b>cl-launch</b> through a pipe. To use a file named <b>-</b>,
      pass the argument <b>./-</b> (same trick as for <b>cat</b> and other Unix
      commands).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">A script file, as specified by <b>-X ... --</b> or by use
      of <b>#!</b> or by following options with an immediate filename that does
      not start with <b>(</b> or <b>-</b>, counts as if preceded by <b>--package
      cl-user --load</b> and followed by <b>--execute --</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">requiring an implementation-provided <b>MODULE</b> (option
      <b>--require</b>)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">having <b>ASDF3</b> compile and load a <b>SYSTEM</b>
      (option <b>-s --system --load-system</b>). Option <b>-sp
      --system-package</b> loads the <b>SYSTEM</b> like <b>-s --system</b> and
      also changes the current <b>*package*</b> like <b>-p --package</b> (see
      below on packages).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">optionally having your Lisp <b>DUMP</b> an image to restart
      from (option <b>-d --dump</b>), and just before evaluating one or several
      <b>FINAL</b> forms (option <b>-F --final</b>). See section <i>Dumping
      images</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
If you are creating a shell script with option <b>-o --output</b> but without
  using option <b>-d --dump</b>, then these first two phases only happen when
  the script is invoked. If you are using option <b>-d --dump</b>, then these
  two phases happen immediately, and no compilation happen when invoking the
  output. Note that compiled files are cached, so that the compilation only
  happens the first time a file is loaded via <b>--load of --system</b>, or if
  the source file has been modified. This may cause slower startup the first
  time over. The cache is controlled by <b>ASDF</b>&#x00B4;s
  <b>output-translations</b> mechanism. See your <b>ASDF</b> manual regarding
  the configuration of this cache, which is typically under
  <b>~/.cache/common-lisp/</b>
<div class="Pp"></div>
In a third phase, your software is run via <b>UIOP:RESTORE-IMAGE</b>. This
  happens immediately if using option <b>-x --execute</b> or calling
  <b>cl-launch</b> as a Unix interpreter on a script e.g. via <b>#!</b>; or it
  can happen later if you use option <b>-o --output</b> in combination with (or
  without) option <b>-d --dump</b> to dump an image (which gives you faster
  startup and single-file or double-file delivery, at the expense of disk
  space), at which point it happens when you invoke the executable output file:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Hooks from <b>ASDF3</b>&#x00B4;s
      <b>UIOP:*IMAGE-RESTORE-HOOK*</b> are called (in FIFO order).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">a series of <b>FORMS</b> specified via options <b>-i
      --init</b>, <b>-ip --print</b>, <b>-iw --write</b>, stored as a text
      string, are read and evaluated in order of appearance, each in the context
      of the package that was current at the time it was requested.
      (Concatenated together with separating whitespace, these forms constitute
      the <b>UIOP:*IMAGE-PRELUDE*</b> as handled by <b>RESTORE-IMAGE</b>).
      Arguments that start with an open parenthesis are assumed to be
      <b>FORMS</b> that follow an implicit <b>--print</b>. Loading from a stream
      means you don&#x00B4;t have to worry about nasty read-time issues; forms
      will be read by the fully built Lisp image; however it also means that if
      you care a lot about the very last drop of startup delay when invoking a
      dumped image, you&#x00B4;ll only use option <b>-r --restart</b> or <b>-E
      --entry</b> and avoid using <b>--init</b> and its variants. Option <b>-ip
      --print</b> specifies <b>FORMS</b> such that the result of the last form
      will be printed as if by <b>PRINC</b>, followed by a newline. Option
      <b>-iw --write</b> is similar to <b>--print</b>, using <b>WRITE</b>
      instead of <b>PRINC</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">An optional <b>FUNCTION</b> provided option <b>-r
      --restart</b> or <b>-E --entry</b> is invoked after all init forms. If the
      function was provided with option <b>-r --restart</b> (compatible with
      earlier versions of <b>cl-launch</b>), it will be called with no argument.
      If it was provided with option <b>-E --entry</b> (compatible with
      <b>buildapp</b>), it will be called with one argument, being the list of
      arguments passed to the program, not including <b>argv[0]</b>, which is
      available on most implementations via the function <b>uiop:argv0</b>
      (available in <b>ASDF</b> 3.1.2 and later). Using either option, the
      argument may be a function name or a lambda expression, that is read from
      the current package (see below option <b>-p --package</b> and <b>-sp
      --system-package</b>). Only one restart or entry function may be
      specified; if multiple are provided, the last one provided overrides
      previous ones. If you want several functions to be called, you may
      <b>DEFUN</b> one that calls them and use it as a restart, or you may use
      multiple init forms as below. See also below options <b>-DE
      --dispatch-entry</b>, <b>-sm --system-main</b>, <b>-Ds
      --dispatch-system</b> that behave as if <b>-E --entry</b> had been
      specified among other things.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">If neither restart nor entry function is provided, the
      program will exit with status <b>0</b> (success). If a function was
      provided, the program will exit after the function returns (if it
      returns), with status <b>0</b> if and only if the primary return value of
      result is generalized boolean true, and with status 1 if this value is
      <b>NIL</b>. See documentation for <b>UIOP:RESTORE-IMAGE</b> for
    details.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
The current package can be controlled by option <b>-p --package</b> and its
  variant <b>-sp --system-package</b> that also behaves like <b>-s --system</b>.
  All forms passed to <b>--eval</b>, <b>--init</b>, <b>--print</b>,
  <b>--write</b>, <b>--final</b>, <b>--restart</b>, <b>--entry</b>, etc., are
  read in the current package. Files specified with <b>-f --file --load</b> are
  read in the current package. Current means the package specified by the latest
  option <b>-p --package</b> or <b>-sp --system-package</b> preceding the option
  being processed, or <b>cl-user</b> if there was none. Note that multiple <b>-i
  --init</b> or <b>-F --final</b> forms may be evaluated consecutively after a
  package has been changed, and that if one of these form itself modifies the
  package, or some other syntax control mechanism such as the reader, it may
  adversely affect later forms in the same category, but not those in other
  categories (if reached).
<div class="Pp"></div>
The following derived options work as if by a combination of simpler options:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">As mentioned above, option <b>-sp --system-package</b>
      combines <b>--system</b> and <b>--package</b> in one option, so that given
      the argument <b>SYSTEM</b>, the system is loaded as if by <b>--system
      SYSTEM</b> that creates a package <b>SYSTEM</b> that then becomes the
      current package.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">If option <b>-DE --dispatch-entry</b> is used, then the
      next argument must follow the format <b>NAME/ENTRY</b>, where <b>NAME</b>
      is a name that the program may be invoked as (the basename of the
      <b>uiop:argv0</b> argument), and <b>ENTRY</b> is a function to be invoked
      as if by <b>--entry</b> when that is the case. If the <b>ENTRY</b> is left
      out, function <b>main</b> in current package is used. Support for option
      <b>-DE --dispatch-entry</b> is delegated to a dispatch library,
      distributed with <b>cl-launch</b> but not part of <b>cl-launch</b> itself,
      by (1) registering a dependency on the dispatch library as if by
      <b>--system cl-launch/dispatch</b> (if not already) (2) if neither
      <b>--restart</b> nor <b>--entry</b> was specified yet, registering a
      default entry function as if by <b>--entry
      cl-launch/dispatch:dispatch-entry</b>. (3) registering a build-form that
      registers the dispatch entry as if by <b>--eval
      &#x00B4;(cl-launch/dispatch:register-name/entry &quot;NAME/ENTRY&quot;
      :PACKAGE)&#x00B4;</b> where <b>PACKAGE</b> is the current package. See the
      documentation of said library for further details.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">If option <b>-Ds --dispatch-system</b> is used with
      <b>SYSTEM</b> as its argument, it is as if option <b>-s --system</b> had
      been used with the same argument, followed by option <b>-DE
      --dispatch-entry</b> for the basename of the system (last <b>/</b> (slash)
      separated component of the system name) and the function <b>main</b> in
      the package of the system, but without otherwise changing the current
      package.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">If option <b>-sm --system-main</b> is used with
      <b>SYSTEM</b> as its argument, it is as if option <b>-s --system</b> had
      been used with the same argument, followed by option <b>-E --entry</b>
      with the <b>main</b> function in the package of the system, but without
      otherwise changing the current package.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
General note on <b>cl-launch</b> invocation: options are processed from left to
  right; usually, repeated options accumulate their effects, with the earlier
  instances taking effect before latter instances. In case of conflicting or
  redundant options, the latter override the former.
<div class="Pp"></div>
<b>cl-launch</b> defines a package <b>cl-launch</b> that exports the following
  symbol: <b>compile-and-load-file</b> Runtime functionality formerly provided
  by <b>cl-launch</b> is now provided by <b>UIOP</b>, the portability layer
  provided by <b>ASDF3</b>. See below section <i>cl-launch runtime API</i>.
<div class="Pp"></div>
When the first non-recognized option is a filename, <b>cl-launch</b> will try to
  load this filename as a script, as if by <b>--load</b>, then execute it
  immediately as if by <b>--execute --</b>, with the rest of the command line
  passed as arguments. The file name may not start with the character <b>-</b>
  or a <b>(</b> --- To use a file with one of these (or something unknown) as a
  first character, prepend <b>./</b> to the filename. Note that it is a security
  risk to let adversaries control the names of files passed to cl-launch or
  other commands.
<div class="Pp"></div>
When option <b>--execute</b> is specified, the specified software is executed.
  Command-line arguments may be given to software being executed by putting them
  after a special marker <b>--</b>, that ends <b>cl-launch</b> option
  processing.
<div class="Pp"></div>
When option <b>--output FILE</b> is used, code will be generated into the
  specified <b>FILE</b>. The output file itself will be created atomically from
  complete generated contents and may thus have the same pathname as the input
  file. The restart function and init forms will not be evaluated, but kept for
  when the output file is executed. If <b>-</b> (after quoting) is specified,
  then the standard output is used. If <b>!</b> (after quoting) is specified,
  then option <b>--execute</b> is assumed.
<div class="Pp"></div>
When no <b>--output</b> file is specified, option <b>--execute</b> is implicitly
  assumed. The last <b>--output</b> or <b>--execute</b> option takes precedence
  over the previous ones.
<div class="Pp"></div>
If only one argument exists and it doesn&#x00B4;t start with <b>-</b> then the
  argument is considered as if given to option <b>-ip</b>, to be evaluated and
  printed immediately.
<div class="Pp"></div>
The <b>ASDF3</b> source-registry configuration can be overridden with option
  <b>--source-registry SOURCE_REGISTRY</b>. The provided configuration will take
  priority over anything provided by the environment or configuration files,
  though it may inherit from them as usual. See the <b>ASDF3</b> manual about
  that.
<div class="Pp"></div>
Options <b>-l --lisp</b> and <b>-w --wrap</b> may be used to control the way
  that a Common Lisp implementation is found when the software is run. Option
  <b>-l --lisp</b> specifies the list of implementations to try to use; the list
  is whitespace-separated, and consists in nicknames recognized by
  <b>cl-launch</b>. Option <b>-w --wrap</b> supplies arbitrary code to be
  evaluated by the shell wrapper, after it has read its configuration and
  defined its internal functions, but before it tries to find and run a Lisp
  implementation. Such wrapper code is typically used to modify the variables
  that control the run-time behaviour of generated scripts, as documented below.
  Use of other internals of <b>cl-launch</b> is possible, but not supported,
  which means that it is your responsibility to keep a copy of the specific
  version of cl-launch with which your code works and to update your code if you
  later make an upgrade to an incompatible <b>cl-launch</b>. For instance,
  <b>--lisp &quot;foo bar&quot;</b> is equivalent to <b>--wrap
  &#x00B4;LISPS=&quot;foo bar&quot;&#x00B4;</b>. See below the documentation
  section on <i>Lisp implementation invocation</i>.
<div class="Pp"></div>
Option <b>--no-include</b> specifies that cl-launch should generate a standalone
  script that includes the configuration, shell wrapper, Lisp header, and
  user-provided Lisp code (from <b>--file</b>). If you can rely on the presence
  of a recent Lisp implementation that provides <b>ASDF</b>, then the script is
  pretty much standalone indeed and may be moved around the filesystem and still
  used. However the size of the output will be the size of the user Lisp code
  plus about 36KiB.
<div class="Pp"></div>
Option <b>--include PATH</b> specifies that <b>cl-launch</b> should generate a
  very small script (typically under 1KiB) that when run will read the
  <b>cl-launch</b> shell wrapper and Lisp header from a specified installation
  directory <b>PATH</b>. Also, if option <b>--include</b> is used, and Lisp code
  is specified with <b>--file</b> and an absolute pathname starting with
  <b>/</b> as opposed to a relative pathname or to the standard input, then Lisp
  code will also be loaded from the specified location at runtime rather than
  embedded into the script at generation time. This option generates leaner
  scripts, but may not be applicable when the very same script is to used in a
  variety of situations that lack common coherent filesystem management.
<div class="Pp"></div>
Which of <b>--include</b> or <b>--no-include</b> is the default may depend on
  your cl-launch installation. The version of <b>cl-launch</b> distributed by
  the author uses <b>--no-include</b> by default, but the version of
  <b>cl-launch</b> available in your operating system distribution may rely on a
  well-managed include path (this is the case with debian for instance). You may
  query the configuration of an instance of <b>cl-launch</b> with option
  <b>--version</b>.
<div class="Pp"></div>
For instance, one may expect a debian version of cl-launch to use:
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
    `/usr/share/common-lisp/source/cl-launch/`
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
as a system-managed include path. One may also expect that Lisp implementations
  managed by the system would come with <b>cl-launch</b> precompiled in Lisp
  images. Since <b>cl-launch</b> provides feature <b>:cl-launch</b>, and since
  the <b>cl-launch</b> Lisp header is conditionalized to not be read with this
  feature, this would make <b>cl-launch</b> startup faster, while still allowing
  non-system-managed Lisp implementations to run fine.
<div class="Pp"></div>
You may create an installation of cl-launch with such a command as:
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
    cl-launch --include /usr/share/common-lisp/source/cl-launch \
            --lisp &#x00B4;sbcl ccl clisp&#x00B4; \
            --rc \
            --output /usr/bin/cl-launch -B install
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
You can use command <b>-B install_bin</b> if you only want to configure
  cl-launch (with a different default for <b>--lisp</b> but no <b>--include</b>,
  for instance), and command <b>-B install_path</b> if you only want to create
  support files. Note that the <b>--backdoor</b> option <b>-B</b> must come last
  in your invocation.
<div class="Pp"></div>
Option <b>+R --no-rc</b> specifies that <b>cl-launch</b> should not try to read
  resource files <b>/etc/cl-launchrc</b> and <b>~/.cl-launchrc</b>.
<div class="Pp"></div>
Option <b>-R --rc</b> specifies that cl-launch should try to read resource files
  <b>/etc/cl-launchrc</b> and <b>~/.cl-launchrc</b>. These files are notably
  useful to define override the value of <b>$LISP</b> depending on
  <b>$SOFTWARE_SYSTEM</b>. A shell function <b>system_preferred_lisps</b> is
  provided so that your <b>cl-launchrc</b> might contain lines as follows:
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
    system_preferred_lisps stumpwm cmucl sbcl clisp
    system_preferred_lisps exscribe clisp cmucl sbcl
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
Beware that for the sake of parsing option <b>--no-rc</b>, the resource files
  are run <i>after</i> options are processed, and that any overriding of
  internal variables will thus preempt user-specified options. A warning will be
  printed on the standard error output when such an override happens. Note that
  such overrides only happen at script-creation time. A script created by
  <b>cl-launch</b> will not try to read the <b>cl-launch</b> resource files.
<div class="Pp"></div>
Option <b>+Q --no-quicklisp</b> specifies that <b>cl-launch</b> should not use
  <b>quicklisp</b>. Option <b>-Q --quicklisp</b> specifies that <b>cl-launch</b>
  should use <b>quicklisp</b>. Which is the default depends on your
  installation. The default default is <b>+Q</b>. Quicklisp is loaded from
  <b>~/quicklisp/setup.lisp</b> if available, or else
  <b>~/.quicklisp/setup.lisp</b>.
<div class="Pp"></div>
Option <b>-b --clbuild</b> specifies that <b>cl-launch</b> should rely on
  <b>clbuild</b> to find and invoke the Common Lisp implementation. Option <b>+b
  --no-clbuild</b> specifies that <b>cl-launch</b> should not rely on
  <b>clbuild</b> to find and invoke the Common Lisp implementation. Which is the
  default depends on your installation. The default default is <b>+b</b>.
<div class="Pp"></div>
Files generated by <b>cl-launch</b> are made of several well-identifiable
  sections. These sections may thus be considered as distinct software, each
  available under its own regime of intellectual property (if any). In case of
  an accident, you may still retrieve the exact original code provided with
  option <b>--file</b> by stripping the wrapper, as delimited by well-identified
  markers. Search for the marker string <b>&quot;BEGINS HERE:&quot;</b>.
  Everything after it is not <b>cl-launch</b>. This can be done automatically
  with backdoor option <b>-B extract_lisp_content</b>. <b>cl-launch</b> uses
  this functionality implicitly when embedding a file specified with the option
  <b>--file</b>, so that you may process a script previously generated by
  <b>cl-launch</b> and change the options with which it wraps the embedded Lisp
  code into runnable software.
<div class="Pp"></div>
As an alternative, you may also upgrade a previously generated script to use the
  current version of <b>cl-launch</b> while preserving its original wrapping
  options with option <b>--update</b>. In this case, software specification
  options are ignored. Output options still apply. Specifying <b>-</b> (after
  quoting) as the file to update means to read the contents to be read from the
  standard input. This feature might not work with scripts generated by very
  early versions of the <b>cl-launch</b> utility. It should work with versions
  later than 1.47.
<h1 class="Sh" title="Sh" id="Supported_Lisp_implementations"><a class="selflink" href="#Supported_Lisp_implementations">Supported
  Lisp implementations</a></h1>
The implementations supported by current version of cl-launch are:
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
    abcl allegro ccl clisp cmucl ecl gcl lispworks sbcl scl xcl
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
Also defined are aliases:
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
    clozurecl gclcvs lisp openmcl
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
which are name variations for <b>ccl</b>, <b>gcl</b>, <b>cmucl</b> and
  <b>ccl</b> again respectively.
<div class="Pp"></div>
Fully supported, including standalone executables:
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
sbcl:  SBCL 1.2.2
clisp:  GNU CLISP 2.49
ecl:  ECL 13.5.1
cmucl:  CMUCL 20D
ccl:  ClozureCL 1.10
lispworks:  LispWorks Professional 7.0.0  (no personal ed, banner)
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
Fully supported, but no standalone executables:
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
gcl (GCL 2.7):  GCL 2.7.0 ansi mode  (get a very recent git checkout)
allegro:  Allegro 9.0  (also used to work with 5)
scl:  Scieneer CL 1.3.9
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
Incomplete support:
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
abcl:  ABCL 1.3.1 (no image dumping support, but you may use abcl-jar)
xcl:  XCL 0.0.0.291 (cannot dump an image) (get a recent checkout)
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
<b>GCL</b> is only supported in ANSI mode. <b>cl-launch</b> does export
  GCL_ANSI=t in the hope that the <b>gcl</b> wrapper script does the right thing
  as it does in Debian. Also <b>ASDF3</b> requires a very recent <b>GCL 2.7</b>.
  Note that <b>GCL</b> seems to not be very actively maintained anymore.
<div class="Pp"></div>
There are some issues regarding standalone executables on <b>CLISP</b>. See
  below in the section regarding <i>Standalone executables</i>.
<div class="Pp"></div>
<b>LispWorks</b> requires the Professional Edition; the Personal Edition
  isn&#x00B4;t supported as it won&#x00B4;t let you either control the command
  line or dump images. Dumped images will print a banner, unless you dump a
  standalone executable. To dump an image, make sure you have a license file in
  your target directory and/or to .../lispworks/lib/7-0-0-0/config/lwlicense (or
  use a trampoline shell script to <b>exec /path/to/lispworks
  &quot;$@&quot;</b>), create a build script with:
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
   echo &#x00B4;(hcl:save-image &quot;lispworks-console&quot; :environment nil)&#x00B4; &gt; si.lisp
   lispworks-7-0-0-x86-linux -siteinit - -init - -build si.lisp
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
There is no standard name for a console-only variant of LispWorks; older
  versions of cl-launch assume a default <b>lispworks</b>; since cl-launch
  4.1.2.1, <b>lispworks-console</b> is assumed instead, to avoid conflicts. You
  can control the name you use with the shell variable <b>$LISPWORKS</b>, or you
  can just leave <b>lispworks-console</b> in your path, and use a symlink, copy,
  shell alias or trivial wrapper script to enable your favorite shorter name
  <b>lispworks</b>, <b>lw</b>, <b>lwcon</b>, <b>lw-console</b>, etc.
<div class="Pp"></div>
Similarly, a mlisp image for allegro can be created as follows:
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
    alisp -e &#x00B4;(progn
               (build-lisp-image &quot;sys:mlisp.dxl&quot;
                :case-mode :case-sensitive-lower
                :include-ide nil :restart-app-function nil)
               (when (probe-file &quot;sys:mlisp&quot;) (delete-file &quot;sys:mlisp&quot;))
               (sys:copy-file &quot;sys:alisp&quot; &quot;sys:mlisp&quot;))&#x00B4;
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
Additionally, <b>cl-launch</b> supports the use of <b>clbuild</b> as a wrapper
  to invoke the Lisp implementation, with the <b>--clbuild</b> option.
<h1 class="Sh" title="Sh" id="Supported_shells"><a class="selflink" href="#Supported_shells">Supported
  shells</a></h1>
<b>cl-launch</b> was tested with all of <b>posh</b> 0.4.7, <b>bash</b> 2.05,
  <b>bash</b> 3.1, <b>zsh</b> 4.3.2, <b>dash</b> 0.5.3 and <b>busybox</b> 1.01
  <b>ash</b>.
<h1 class="Sh" title="Sh" id="Lisp_implementation_invocation"><a class="selflink" href="#Lisp_implementation_invocation">Lisp
  implementation invocation</a></h1>
When a <b>cl-launch</b> generated script is invoked, the <b>cl-launch</b> shell
  wrapper will try to execute the Lisp code with the first Common Lisp
  implementation it finds in a given list, which can be specified through option
  <b>--lisp</b>. The runtime behaviour of the <b>cl-launch</b> shell wrapper is
  very configurable through a series of environment variables. These variables
  can be controlled by the user by exporting them in his environment, or they
  can be restricted at the time of script generation by using cl-launch option
  <b>--wrap</b>.
<div class="Pp"></div>
If variable <b>LISP</b> is defined, the shell wrapper will first try the
  implementation named by variable <b>LISP</b>. If that fails, it will try the
  list of implementations provided at script generation time. The list of
  implementations generated will be the argument to option <b>--lisp</b> if
  specified. Otherwise, <b>cl-launch</b> will supply its default value. This
  default value for the current instance of <b>cl-launch</b> is:
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
    sbcl ccl clisp abcl allegro lispworks scl cmucl ecl mkcl gcl xcl
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
This <b>LISP</b> selection only happens at system preparation time. If you dump
  an image then the script will always use the Lisp implementation for which an
  image was dumped. If you don&#x00B4;t then the user may override the
  implementation.
<div class="Pp"></div>
Note that these are nicknames built into the <b>cl-launch</b> shell wrapper, and
  not necessarily names of actual binary. You may control the mapping of
  implementation nickname to actual binary pathname to call with an environment
  variable. For a given implementation nickname, the environment variable will
  be the capitalization of the given nickname. Hence, variable <b>$SBCL</b>
  controls where to look for the <b>sbcl</b> implementation, and variable
  <b>$CMUCL</b> controls where to look for the <b>cmucl</b> implementation. If a
  binary is found with a matching pathname (using the standard unix <b>$PATH</b>
  as required), then said implementation will be used, using proper command line
  options, that may be overridden with an environment variable similar to the
  previous but with <b>_OPTIONS</b> appended to its name. Hence,
  <b>$CMUCL_OPTIONS</b> for <b>cmucl</b>, <b>$CLISP_OPTIONS</b> for
  <b>clisp</b>, etc. Sensible defaults are provided for each implementation, so
  as to execute the software in non-interactive mode, with debugger disabled,
  without reading user-specific configuration files, etc.
<div class="Pp"></div>
If you want to insist on using a given implementation with given options, you
  may use option <b>--lisp</b> and <b>--wrap</b>, as follows:
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
--lisp &#x00B4;sbcl clisp&#x00B4; --wrap &#x00B4;
    LISP= # do not allow the user to specify his implementation
    SBCL=/usr/bin/sbcl # not any experimental thing by the user
    SBCL_OPTIONS=&quot;--noinform --sysinit /dev/null --userinit /dev/null \
    --disable-debugger&quot; # predictable Lisp state
    CLISP=/usr/bin/clisp # fall back on machines that lack SBCL
    CLISP_OPTIONS=&quot; -norc --quiet --quiet&quot;
    # configure ASDF:
    CL_SOURCE_REGISTRY=/usr/local/share/common-lisp/source//:
    # assuming precompiled fasls there:
    ASDF_OUTPUT_TRANSLATIONS=/my/cl/src:/my/fasl/cache:
    &#x00B4;
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
If you dump an image, you need not unset the <b>LISP</b> variable, but you might
  still want to override any user-specified <b>SBCL</b> and <b>SBCL_OPTIONS</b>
  (or corresponding variables for your selected implementation) from what the
  user may specify.
<div class="Pp"></div>
Note that you can use option <b>--wrap &quot;$(cat your_script)&quot;</b> to
  embed into your program a full fledged script from a file. Your script may do
  arbitrary computations before the shell wrapper is run. It may make some
  consistency checks and abort before to run Lisp. Or it may analyze invocation
  arguments and make according adjustments to Lisp implementation options. This
  can be useful for setting options that cannot be set from the Lisp code, such
  the path to a runtime image, interactive or non-interactive execution, size of
  heaps, locale settings for source file encoding, etc.
<div class="Pp"></div>
Reading the source code of <b>cl-launch</b> can be completely crazy. You may
  have great fun understanding why things are how they are and adding features
  without breaking anything! However, adding support for a new CL implementation
  should be straightforward enough: just search the sources for <b>clisp</b> or
  <b>sbcl</b> and mimic what I did for them. Be sure to send me what will get
  your favorite Lisp flavor of the month rolling.
<h1 class="Sh" title="Sh" id="Limited_clbuild_support"><a class="selflink" href="#Limited_clbuild_support">Limited
  clbuild support</a></h1>
<b>cl-launch</b> 2.12 and later support using <b>clbuild</b> as a wrapper to
  configure your Lisp implementation, with option <b>--clbuild</b> (which can be
  disabled with option <b>--no-clbuild</b> if it was enabled by default in your
  <b>cl-launch</b> installation).
<div class="Pp"></div>
Note that when you use <b>clbuild</b>, you can no longer override implementation
  options with say <b>SBCL_OPTIONS</b>, as clbuild takes care of the options for
  you. Any implementation banner will not be removed unless you instruct clbuild
  to do so. Also, you cannot use clbuild with a non-executable image different
  from <b>clbuild</b>&#x00B4;s, which precludes image dumping with <b>cmucl</b>
  or <b>allegro</b> (<b>allegro</b> could probably be updated, but I
  don&#x00B4;t have a recent licence to test and develop).
<div class="Pp"></div>
<b>clbuild</b> support is not fully tested at this point. Please report any bug.
<h1 class="Sh" title="Sh" id="Simple_cl-launch_scripts"><a class="selflink" href="#Simple_cl-launch_scripts">Simple
  cl-launch scripts</a></h1>
In simple cases, you may create a Common Lisp shell script with <b>cl-launch</b>
  without a script generation step, just because you&#x00B4;ll spend a lot of
  time editing the script and distributing it, and little time waiting for
  script startup time anyway. This notably is a good idea if you&#x00B4;re not
  spawning many instances of the same version of a script on a given computer.
  If that&#x00B4;s what you want, you may use <b>cl-launch</b> as a script
  interpret the following way (stripping leading spaces):
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
#!/path/to/cl-launch ...options...
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
For instance, you may write the following script (stripping leading spaces):
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
#!/usr/bin/cl --entry main
(defun main (argv)
  (format t &quot;Hello, World!~%~S~%&quot; argv))
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
On a recent Linux kernel, the options may include spaces, parentheses, etc.,
  provided they are quoted as in a shell script. Also, using <b>-X</b> as your
  very first option and <b>--</b> as your last will ensure that the script works
  even if its name starts with a <b>(</b> or a <b>-</b>, in addition to working
  with older versions of <b>cl-launch</b>.
<div class="Pp"></div>
Note however that Darwin (MacOS X) and other BSD kernels or old Linux kernels
  don&#x00B4;t like the <b>#!</b> interpreter to itself be interpreted. On these
  operating system kernels, the system administrator must compile and install a
  small shim written in C, <b>cl-shim.c</b>, that will handle the proper script
  invocation.
<div class="Pp"></div>
Most kernels have restrictions on how they handle arguments to a <b>#!</b>
  script, that prevent e.g. using <b>/usr/bin/env</b> as a trampoline; however,
  you may use the fully portable solution as follows, where the <b>&quot;:&quot;
  ;</b> ensures that the script should remain valid bilingual shell and Lisp
  code:
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
#!/bin/sh
&quot;:&quot; ; exec cl-launch -X -sp my-package -E main -- &quot;$0&quot; ${1+&quot;$@&quot;} || exit
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
(Actually <b>&quot;$@&quot;</b> instead of <b>${1+&quot;$@&quot;}</b> should
  work just fine, unless you have an antique shell.)
<div class="Pp"></div>
Note that if you don&#x00B4;t need Lisp code to be loaded from your script, with
  everything happening in the build specification, then you may instead use a
  simple <b>#!/bin/sh</b> shell script from which you:
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
exec /path/to/cl-launch -x ... -- &quot;$@&quot;.
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
Also, in case you can&#x00B4;t rely on <b>cl-launch</b> being at a fixed path,
  or if your shell and/or kernel combination doesn&#x00B4;t support using
  <b>cl-launch</b> as a script interpreter, then you may instead start your
  script with the following lines:
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
#!/bin/sh
&quot;:&quot; ; exec cl-launch -X -- &quot;$0&quot; &quot;$@&quot; || exit
(format t &quot;It works!~%&quot;)
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
Note that a mainline Linux kernel only supports the recursive <b>#!</b> implicit
  in <b>#!/usr/bin/cl-launch</b> since 2.6.27.9.
<h1 class="Sh" title="Sh" id="Dumping_images"><a class="selflink" href="#Dumping_images">Dumping
  images</a></h1>
You can dump an image (for static compilation and fast startup) with option
  <b>--dump IMAGE</b> where <b>IMAGE</b> specifies the path where the image will
  be dumped.
<div class="Pp"></div>
If you use option <b>--include PATH</b> then the image will be loaded back from
  that specified directory instead of the directory where you dumped it. This is
  useful if you&#x00B4;re preparing a script to be installed at another place
  maybe on another computer.
<div class="Pp"></div>
This option is currently supported on all CL implementations available with
  <b>cl-launch</b>.
<div class="Pp"></div>
As a limitation, <b>LispWorks</b> will print a banner on standard output, unless
  you use the standalone executable option below.
<div class="Pp"></div>
As another limitation, <b>ECL</b> will not be able to dump an image when running
  from a previously dumped image (with <b>--image</b>). This is because of the
  link model of ECL, whereby you&#x00B4;d need to be able to locate which object
  files were used in linking the original image, keep track of these files, and
  prepend the list of them to to the object files linked into the dump. This is
  not conceptually impossible and patches are welcome. However, we hope to
  support that someday with a real build system that does it for you, such as
  XCVB.
<h1 class="Sh" title="Sh" id="Standalone_executables"><a class="selflink" href="#Standalone_executables">Standalone
  executables</a></h1>
You can create standalone executables with the option <b>--dump
  &#x00B4;!&#x00B4;</b> (or by giving a <b>--dump</b> argument identical to the
  <b>--output</b> argument).
<div class="Pp"></div>
This option is currently only supported with <b>SBCL</b>, <b>ECL</b>,
  <b>CLISP</b>, <b>CMUCL</b>, <b>CCL</b> and <b>LispWorks</b> Professional.
  Moreover <b>CLISP</b> has the issues below.
<div class="Pp"></div>
<b>CLISP</b> standalone executables will react magically if invoked with options
  such as <b>--clisp-help</b> or <b>--clisp-x
  &#x00B4;(sys::main-loop)&#x00B4;</b>. That&#x00B4;s a pretty far-fetched thing
  to hit by mistake, and the <b>CLISP</b> maintainers consider it a feature (I
  don&#x00B4;t). Don&#x00B4;t use such executables as <b>setuid</b>, and
  don&#x00B4;t let untrusted users control arguments given to such executables
  that are run with extra privileges.
<h1 class="Sh" title="Sh" id="cl-launch_runtime_API"><a class="selflink" href="#cl-launch_runtime_API">cl-launch
  runtime API</a></h1>
<b>cl-launch</b> provides the following Lisp functions:
<div class="Pp"></div>
Function <b>cl-launch:compile-and-load-file</b> takes as an argument a source
  pathname designator, and keyword arguments <b>force-recompile</b> (default
  <b>NIL</b>) and <b>verbose</b> (default <b>NIL</b>). It will arrange to
  compile the specified source file if it is explicitly requested, or if the
  file doesn&#x00B4;t exist, or if the fasl is not up-to-date. It will compile
  and load with the specified verbosity. It will take use
  <b>uiop:compile-file-pathname*</b> to determine the fasl pathname.
<div class="Pp"></div>
The following variables and functions previously provided by <b>cl-launch</b>
  have the following replacement from <b>ASDF</b> and <b>UIOP</b>:
<div class="Pp"></div>
Variable <b>cl-launch:*arguments*</b> is replaced by
  <b>uiop:*command-line-arguments*</b>.
<div class="Pp"></div>
Function <b>cl-launch:getenv</b> is replaced by <b>uiop:getenv</b>.
<div class="Pp"></div>
Function <b>cl-launch:load-system</b> is replaced by <b>asdf:load-system</b>.
<div class="Pp"></div>
Function <b>cl-launch:quit</b> is replaced by <b>uiop:quit</b> (beware: the
  lambda-list is slightly different).
<div class="Pp"></div>
Additionally, environment variables <b>CL_LAUNCH_PID</b> and
  <b>CL_LAUNCH_FILE</b> will be set to the process ID and the script invocation
  filename respectively.
<h1 class="Sh" title="Sh" id="Verbose_output_mode"><a class="selflink" href="#Verbose_output_mode">Verbose
  output mode</a></h1>
If the shell variable <b>CL_LAUNCH_VERBOSE</b> is exported and non-<b>nil</b>,
  then <b>cl-launch</b> and the scripts it generates will produce an abundance
  of output, display such things as the Lisp invocation command, compiling and
  loading files with <b>:verbose t</b> and <b>:print t</b>, etc. This is only
  useful for debugging <b>cl-launch</b> and/or your build process. Option
  <b>--verbose</b> sets this variable, whereas option <b>--quiet</b> resets it.
<h1 class="Sh" title="Sh" id="Makefile_examples"><a class="selflink" href="#Makefile_examples">Makefile
  examples</a></h1>
<pre>
<div class="Pp"></div>
### Automatically download of the current version of cl-launch if not present
cl-launch.sh:
        wget -O cl-launch.sh http://fare.tunes.org/files/cl-launch/cl-launch.sh
        chmod a+x cl-launch.sh
<div class="Pp"></div>
### Making a shell script executable from a simple Lisp file named foo.lisp
foo.sh: cl-launch.sh foo.lisp
        ./cl-launch.sh --output foo.sh --file foo.lisp
<div class="Pp"></div>
### A more complex example using all options.
run-foo.sh: cl-launch.sh preamble.lisp
        ./cl-launch.sh --output run-foo.sh \
        --file preamble.lisp --system foo \
        --init &quot;(foo:main uiop:*command-line-arguments*)&quot; \
        --source-registry ${PREFIX}/cl-foo/systems: \
        --lisp &quot;ccl sbcl&quot; --wrap &#x00B4;SBCL=/usr/local/bin/sbcl-no-unicode&#x00B4; \
        --no-include
<div class="Pp"></div>
### An example with horrible nested makefile, shell and Lisp quoting
hello:
        opera=wORlD ; ./cl-launch.sh --execute --init \
        &quot;(format t \&quot;~25R~A~A~%\&quot; 6873049 #\\space &#x00B4;$$opera)&quot;
</pre>
<h1 class="Sh" title="Sh" id="Caveat_Lispor"><a class="selflink" href="#Caveat_Lispor">Caveat
  Lispor</a></h1>
<b>cl-launch</b> begins evaluation of your Lisp software in the <b>cl-user</b>
  package, or whichever package you specify. By the time your initialization
  forms are evaluated, the package may or may not have changed, depending on the
  fine-grained semantics of <b>load</b>. Be sure to use <b>in-package</b> if
  these things matter. If you change the readtable, even weirder things may
  happen.
<div class="Pp"></div>
There are lots of ways of making mistakes by improperly quoting things when you
  write shell commands. <b>cl-launch</b> does the right thing, but you still
  must be careful with the nested quoting mechanisms of <b>make</b>, shell, and
  Lisp.
<div class="Pp"></div>
Here is a simple example use of cl-launch to quickly compare the result of a
  same computation on a variety of systems:
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
for l in sbcl cmucl clisp gcl ccl ; do
  ./cl-launch.sh --lisp $l --execute --init \
    &#x00B4;(format t &quot;&#x00B4;$l&#x00B4; ~A~%&quot; most-positive-fixnum)&#x00B4; ; done
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
Internally, <b>cl-launch</b> includes many self-test functions. You may for
  instance try (from a directory where it may create junk):
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
./cl-launch.sh -l &#x00B4;sbcl cmucl clisp gclcvs&#x00B4; -B tests
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
Share and Enjoy!
<div class="Pp"></div>
See our web page on:
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
    &lt;http://www.cliki.net/cl-launch&gt;
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div class="Pp"></div>
Note: if this help is too long for you, you may scroll back, or use:
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <pre>
<div class="Pp"></div>
    cl --more-help | less
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag">
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">July 2015</td>
    <td class="foot-os">Francois-Rene Rideau</td>
  </tr>
</table>
</body>
</html>
