<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>MOGADM(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">MOGADM(1)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">MOGADM(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
mogadm - MogileFS admin tool
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>
 $ mogadm [config options] &lt;argument(s)&gt; [argument options]
 $ mogadm
   ....
   (prints contextual help, if missing command/arguments)
   ...
</pre>
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--lib=/path/to/lib</b></dt>
  <dd class="It-tag">Set this option to a path to include this directory in the
      module search path.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--trackers=10.0.0.117:7001,10.0.0.118:7001,...</b></dt>
  <dd class="It-tag">Use these MogileFS trackers for status information.</dd>
</dl>
<h1 class="Sh" title="Sh" id="ARGUMENTS"><a class="selflink" href="#ARGUMENTS">ARGUMENTS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>check</b></dt>
  <dd class="It-tag">Check to ensure that all of the MogileFS system components
      are functioning and that we can contact everybody. The quickest way of
      ensuring that the entire MogileFS system is functional from the current
      machine's point of view.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>host add &lt;host&gt; [host options]</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>host modify &lt;host&gt; [host options]</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>host mark &lt;host&gt; &lt;status&gt;</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>host delete &lt;host&gt;</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>host list</b></dt>
  <dd class="It-tag">Functions for manipulating hosts. For add and modify, host
      options is in the format of normal command line options and can include
      anything in the &quot;HOST OPTIONS&quot; section.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>device add &lt;host&gt; &lt;device id&gt;</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>device mark &lt;host&gt; &lt;device id&gt;
    &lt;status&gt;</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>device modify &lt;host&gt; &lt;device&gt; [device
    options]</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>device delete &lt;host&gt; &lt;device&gt;</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>device list</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>device next</b></dt>
  <dd class="It-tag">Functions for manipulating devices. For add and modify,
      device options are in the format of normal command line options and can
      include anything in the &quot;DEVICE OPTIONS&quot; section.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>domain add &lt;domain&gt;</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>domain delete &lt;domain&gt;</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>domain list</b></dt>
  <dd class="It-tag">Simple commands for managing MogileFS domains. Note that
      you cannot delete a domain unless it has no classes and is devoid of
      files.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>class add &lt;domain&gt; &lt;class&gt; [class
    options]</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>class modify &lt;domain&gt; &lt;class&gt; [class
    options]</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>class delete &lt;domain&gt; &lt;class&gt;</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>class list</b></dt>
  <dd class="It-tag">Commands for working with classes. Please see the
      &quot;CLASS OPTIONS&quot; section for the options to use with add/modify.
      Also, delete requires that the class have no files in it before it will
      allow the deletion.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>slave ...</b></dt>
  <dd class="It-tag">Add/remove slaves replicating from MogileFS master
      database.
    <div style="height: 1.00em;">&#x00A0;</div>
    TODO: detail this
    <div style="height: 1.00em;">&#x00A0;</div>
    Run <b>mogadm slave</b> by itself for contextual help.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>fsck printlog</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>fsck taillog</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>fsck clearlog</b></dt>
  <dd class="It-tag">Display or clear the log of fsck events.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>fsck reset [fsck options]</b></dt>
  <dd class="It-tag">Reset fsck position back to the beginning. Please see the
      &quot;FSCK OPTIONS&quot; section for options to use with fsck.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>fsck start</b></dt>
  <dd class="It-tag">Start (or resume) background fsck from the last checked
      fid. If you want to check every fid, you must call <b>fsck reset</b>
      before calling start.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>fsck status</b></dt>
  <dd class="It-tag">Show the status of the presently active (or last if none
      active) fsck. This includes what FIDs are being checked, time statistics,
      check type as well as a summary of problems encountered so far.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>fsck stop</b></dt>
  <dd class="It-tag">Stop (pause) background fsck</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>settings list</b></dt>
  <dd class="It-tag">Display all present MogileFS settings.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>settings set &lt;key&gt; &lt;value&gt;</b></dt>
  <dd class="It-tag">Set the server setting for 'key' to 'value'.
    <div style="height: 1.00em;">&#x00A0;</div>
    The current settings are &lt;enable_rebalance&gt; (set to 1 to start
      rebalance mode to move files to under-used devices) and
      &lt;memcache_servers&gt; (enable memcached caching in the tracker).</dd>
</dl>
<h1 class="Sh" title="Sh" id="HOST_OPTIONS"><a class="selflink" href="#HOST_OPTIONS">HOST
  OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ip=&lt;ip of host&gt;</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--port=&lt;port of mogstored on host&gt;</b></dt>
  <dd class="It-tag">Contact information for the host. This is the minimum set
      of information needed to setup a host.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--getport=&lt;alternate retrieval part on
    host&gt;</b></dt>
  <dd class="It-tag">If provided, causes the tracker to use this port for
      retrieving files. Uploads are still processed at the standard port.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--altip=&lt;alternate IP&gt;</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--altmask=&lt;mask to activate alternate IP&gt;</b></dt>
  <dd class="It-tag">If a client request comes in from an IP that matches the
      alternate mask, then the host IP is treated as the alternate IP instead of
      the standard IP. This can be used, for example, if you have two networks
      and you need to return one IP to reach the node on one network, but a
      second IP to reach it on the alternate network.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--status=&lt;host status&gt;</b></dt>
  <dd class="It-tag">Valid host statuses are one of: alive, down, dead.</dd>
</dl>
<h1 class="Sh" title="Sh" id="DEVICE_OPTIONS"><a class="selflink" href="#DEVICE_OPTIONS">DEVICE
  OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--status=&lt;device status&gt;</b></dt>
  <dd class="It-tag">Valid device statuses are one of: alive, dead, down, drain,
      readonly.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--weight=&lt;device weight&lt;gt</b>&gt;</dt>
  <dd class="It-tag">The weight used in calculation of preferred paths. It must
      be a positive integer.</dd>
</dl>
<h1 class="Sh" title="Sh" id="CLASS_OPTIONS"><a class="selflink" href="#CLASS_OPTIONS">CLASS
  OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--mindevcount=&lt;value&gt;</b></dt>
  <dd class="It-tag">Number of devices the files in this class should be
      replicated across. Can be set to anything &gt;= 1.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--replpolicy=&lt;value&gt;</b></dt>
  <dd class="It-tag">Stringified replication policy. ie
      &quot;<i>MultipleHosts</i>(3)&quot; is equivalent to a --mindevcount=3.
      See documentation or plugins on alternative policies.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--hashtype=&lt;value&gt;</b></dt>
  <dd class="It-tag">Name of the hash algorithm used for checksumming.
      &quot;MD5&quot; or &quot;NONE&quot; for no checksumming.</dd>
</dl>
<h1 class="Sh" title="Sh" id="FSCK_OPTIONS"><a class="selflink" href="#FSCK_OPTIONS">FSCK
  OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--policy-only</b></dt>
  <dd class="It-tag">Check replication policy (assumed locations) only; don't
      stat storage nodes for actual file presence.</dd>
</dl>
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
Host manipulation:
<div class="Pp"></div>
<pre>
    $ mogadm host list
    $ mogadm host add foo.local
    $ mogadm host add foo.local --status=down --ip=10.0.0.34 --port=7900
    $ mogadm host mark foo.local down
    $ mogadm host modify foo.local --port=7500
    $ mogadm host delete foo.local
</pre>
<div class="Pp"></div>
Device manipulation:
<div class="Pp"></div>
<pre>
    $ mogadm device list
    $ mogadm device summary
    $ mogadm device summary --status=dead,down
    $ mogadm device next
    $ mogadm device add foo.local 16
    $ mogadm device add foo.local 17 --status=alive
    $ mogadm device mark foo.local 17 down
    $ mogadm device modify foo.local 17 --status=alive --weight=10
    $ mogadm device delete foo.local 17
</pre>
<div class="Pp"></div>
Domain manipulation:
<div class="Pp"></div>
<pre>
    $ mogadm domain list
    $ mogadm domain add first.domain
    $ mogadm domain delete first.domain
</pre>
<div class="Pp"></div>
Class manipulation
<div class="Pp"></div>
<pre>
    $ mogadm class list
    $ mogadm class add first.domain my.class
    $ mogadm class add first.domain my.class --mindevcount=3
    $ mogadm class add first.domain my.class --replpolicy=&quot;MultipleHosts(3)&quot;
    $ mogadm class modify first.domain my.class --mindevcount=2
    $ mogadm class modify first.domain my.class --replpolicy=&quot;MultipleHosts(3)&quot;
    $ mogadm class delete first.domain my.class
</pre>
<div class="Pp"></div>
Check the status of your entire MogileFS system:
<div class="Pp"></div>
<pre>
    $ mogadm check
</pre>
<div class="Pp"></div>
Check every file in the entire MogileFS system:
<div class="Pp"></div>
<pre>
    $ mogadm fsck reset
    $ mogadm fsck start
    $ mogadm fsck status
    $ mogadm fsck printlog
</pre>
<div class="Pp"></div>
See all the things mogadm can do:
<div class="Pp"></div>
<pre>
    $ mogadm
</pre>
<div class="Pp"></div>
Get help on a sub-command:
<div class="Pp"></div>
<pre>
    $ mogadm device
</pre>
<h1 class="Sh" title="Sh" id="CONFIGURATION"><a class="selflink" href="#CONFIGURATION">CONFIGURATION</a></h1>
It is recommended that you create a configuration file such as
  &quot;/etc/mogilefs/mogilefs.conf&quot; (or at &quot;~/.mogilefs.conf&quot;)
  to be used for configuration information. Basically all you need is something
  like:
<div class="Pp"></div>
<pre>
    trackers = 10.0.0.23:7001, 10.0.0.15:7001
    # if MogileFS::Admin files aren't installed in standard places:
    lib = /home/mogilefs/cgi-bin
</pre>
<div class="Pp"></div>
Note that these can also be specified on the command line, as per above.
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Brad Fitzpatrick &lt;brad@danga.com&gt;
<div class="Pp"></div>
Mark Smith &lt;junior@danga.com&gt;
<div class="Pp"></div>
Leon Brocard &lt;acme@astray.com&gt;, open sourced permissions from Foxtons Ltd.
<div class="Pp"></div>
Robin H. Johnson &lt;robbat2@orbis-terrarum.net&gt;
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
Please report any on the MogileFS mailing list:
  &lt;http://groups.google.com/group/mogile/&gt;.
<h1 class="Sh" title="Sh" id="LICENSE"><a class="selflink" href="#LICENSE">LICENSE</a></h1>
Licensed for use and redistribution under the same terms as Perl itself.</div>
<table class="foot">
  <tr>
    <td class="foot-date">2014-12-16</td>
    <td class="foot-os">perl v5.24.1</td>
  </tr>
</table>
</body>
</html>
