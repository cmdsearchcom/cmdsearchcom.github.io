<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>r3.flow(1grass)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">r3.flow(1grass)</td>
    <td class="head-vol">Grass User's Manual</td>
    <td class="head-rtitle">r3.flow(1grass)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
<i></i><b>r3.flow</b> - Computes 3D flow lines and 3D flow accumulation.
<h1 class="Sh" title="Sh" id="KEYWORDS"><a class="selflink" href="#KEYWORDS">KEYWORDS</a></h1>
raster3d, hydrology, voxel
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>r3.flow</b>
<div>&#x00A0;</div>
<b>r3.flow --help</b>
<div>&#x00A0;</div>
<b>r3.flow</b> [-<b>a</b>] [<b>input</b>=<i>name</i>]
  [<b>vector_field</b>=<i>name</i>[, <i>name</i>,...]]
  [<b>seed_points</b>=<i>name</i>] [ <b>flowline</b>=<i>name</i>]
  [<b>flowaccumulation</b>= <i>name</i>] [<b>sampled</b>=<i>name</i>]
  [<b>unit</b>= <i>string</i>] [<b>step</b>=<i>float</i>]
  [<b>limit</b>=<i>integer</i>] [ <b>max_error</b>=<i>float</i>]
  [<b>skip</b>=<i>integer</i>[,<i>integer</i>,...]]
  [<b>direction</b>=<i>string</i>] [-- <b>overwrite</b>] [--<b>help</b>]
  [--<b>verbose</b>] [-- <b>quiet</b>] [--<b>ui</b>]
<h2 class="Ss" title="Ss" id="Flags:"><a class="selflink" href="#Flags:">Flags:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-a</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Create and fill attribute table</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--overwrite</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Allow output files to overwrite existing files</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--help</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Print usage summary</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--verbose</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Verbose module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--quiet</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Quiet module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ui</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Force launching GUI dialog</dd>
</dl>
<h2 class="Ss" title="Ss" id="Parameters:"><a class="selflink" href="#Parameters:">Parameters:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>input</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of input 3D raster map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>vector_field</b>=<i>name[,</i><i>name</i>,...]</dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Names of three 3D raster maps describing x, y, z components of vector
    field</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>seed_points</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of vector map with points from which flow lines are generated
    <div>&#x00A0;</div>
    If no map is provided, flow lines are generated from each cell of the input
      3D raster</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>flowline</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for vector map of flow lines</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>flowaccumulation</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output flowaccumulation 3D raster</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>sampled</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for 3D raster sampled by flowlines
    <div>&#x00A0;</div>
    Values of this 3D raster will be stored as attributes of flowlines
    segments</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>unit</b>=<i>string</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Unit of integration step
    <div>&#x00A0;</div>
    Default unit is cell
    <div>&#x00A0;</div>
    Options: <i>time, length, cell</i>
    <div>&#x00A0;</div>
    Default: <i>cell</i>
    <div>&#x00A0;</div>
     <b>time</b>: elapsed time
    <div>&#x00A0;</div>
     <b>length</b>: length in map units
    <div>&#x00A0;</div>
     <b>cell</b>: length in cells (voxels)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>step</b>=<i>float</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Integration step in selected unit
    <div>&#x00A0;</div>
    Default step is 0.25 cell
    <div>&#x00A0;</div>
    Default: <i>0.25</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>limit</b>=<i>integer</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Maximum number of steps
    <div>&#x00A0;</div>
    Default: <i>2000</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>max_error</b>=<i>float</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Maximum error of integration
    <div>&#x00A0;</div>
    Influences step, increase maximum error to allow bigger steps
    <div>&#x00A0;</div>
    Default: <i>1e-5</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>skip</b>=<i>integer[,</i><i>integer</i>,...]</dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Number of cells between flow lines in x, y and z direction</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>direction</b>=<i>string</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Compute flowlines upstream, downstream or in both direction.
    <div>&#x00A0;</div>
    Options: <i>up, down, both</i>
    <div>&#x00A0;</div>
    Default: <i>down</i></dd>
</dl>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
Module <i>r3.flow</i> computes 3D flow lines and 3D flow accumulation. It
  accepts either three 3D raster maps representing the vector field or one 3D
  raster map. In case of one map, it computes on-the-fly gradient field.
<h2 class="Ss" title="Ss" id="Flow_lines"><a class="selflink" href="#Flow_lines">Flow
  lines</a></h2>
Flow lines are computed either from points (seeds) provided in
  <b>seed_points</b> vector map, or if there are no seeds, it creates seeds in a
  regular grid in the center of voxels (3D raster cells). Parameter <b>skip</b>
  then controls the step between the regularly distributed seeds. If skip is not
  provided, r3.flow decides optimal skip for each dimension based on current 3D
  region as one tenth of the number of columns, rows, and depths. Flow lines can
  be computed in upstream direction (in the direction of gradient or vector
  field), in downstream direction or in both directions.
<h2 class="Ss" title="Ss" id="Flow_accumulation"><a class="selflink" href="#Flow_accumulation">Flow
  accumulation</a></h2>
Flow accumulation is computed as the number of flow lines traversing each voxel.
  Since the flow lines are computed for each voxel, the flow accumulation
  computation can be more demanding. Parameter skip does not influence the flow
  accumulation computation, parameter direction does.
<h2 class="Ss" title="Ss" id="Flow_line_integration"><a class="selflink" href="#Flow_line_integration">Flow
  line integration</a></h2>
Flow line integration can be influenced by several parameters. Option
  <b>step</b> controls the integration step and influences the precision and
  computational time. The unit of step can be defined either in terms of the
  size of the voxel (3D raster cell), length in map units, or as elapsed time.
  Option <b>limit</b> specifies the maximum number of steps of each flow line.
<h2 class="Ss" title="Ss" id="Attributes"><a class="selflink" href="#Attributes">Attributes</a></h2>
Without using flag <b>a</b>, no attribute table is created and each flow line is
  represented by one vector line with one category. With <b>a</b> flag, an
  attribute table is created and each category (record) represents one segment
  of a flowline, so that attributes specific for segments can be written. In
  case of <b>vector_field</b> input, only velocity is written, in case of
  <b>input</b> option, also values of the input 3D raster are written. Option
  <b>sampled</b> allows sampling (query) given 3D raster by flow lines (computed
  from different 3D raster) and write the values of the given 3D raster as
  attributes of the flow line segments. Note that using <b>a</b> flag results in
  longer computation time, so consider increasing <b>step</b> and
  <b>max_error</b> parameter.
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
r3.flow uses Runge-Kutta with adaptive step size (Cash-Karp method).
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
First we create input data using example 1 from r3.gwflow manual page:
<div>&#x00A0;</div>
<pre>
# set the region accordingly
g.region res=25 res3=25 t=100 b=0 n=1000 s=0 w=0 e=1000 -p3
# now create the input raster maps for a confined aquifer
r3.mapcalc expression=&quot;phead = if(row() == 1 &amp;&amp; depth() == 4, 50, 40)&quot;
r3.mapcalc expression=&quot;status = if(row() == 1 &amp;&amp; depth() == 4, 2, 1)&quot;
r3.mapcalc expression=&quot;well = if(row() == 20 &amp;&amp; col() == 20 &amp;&amp; depth() == 2, -0.25, 0)&quot;
r3.mapcalc expression=&quot;hydcond = 0.00025&quot;
r3.mapcalc expression=&quot;syield = 0.0001&quot;
r.mapcalc  expression=&quot;recharge = 0.0&quot;
r3.gwflow solver=cg phead=phead status=status hc_x=hydcond hc_y=hydcond  \
   hc_z=hydcond q=well s=syield r=recharge output=gwresult dt=8640000 vx=vx vy=vy vz=vz budget=budget
</pre>
Then we compute flow lines in both directions and downstream flowaccumulation.
<div>&#x00A0;</div>
<pre>
r3.flow vector_field=vx,vy,vz flowline=gw_flowlines skip=5,5,2 direction=both
r3.flow vector_field=vx,vy,vz flowaccumulation=gw_flowacc
</pre>
We can visualize the result in 3D view:
<div class="Pp"></div>
We can store velocity values (and values of the input 3D raster map if we use
  option <b>input</b>) for each segment of flow line in an attribute table.
<div>&#x00A0;</div>
<pre>
r3.flow -a vector_field=vx,vy,vz flowline=gw_flowlines skip=5,5,2 direction=both
v.colors map=flowlines_color@user1 use=attr column=velocity color=bcyr
</pre>
Again, we visualize the result in 3D view and we check &#x2019;use color for
  thematic rendering&#x2019; on 3D view vector page.
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<i></i> <i>r.flow,</i> <i>r3.gradient,</i> <i>r3.gwflow</i> <i></i>
<h1 class="Sh" title="Sh" id="AUTHORS"><a class="selflink" href="#AUTHORS">AUTHORS</a></h1>
Anna Petrasova, NCSU OSGeoREL, developed during GSoC 2014.
<div class="Pp"></div>
<i>Last changed: $Date: 2016-07-07 19:26:08 +0200 (Thu, 07 Jul 2016) $</i>
<h1 class="Sh" title="Sh" id="SOURCE_CODE"><a class="selflink" href="#SOURCE_CODE">SOURCE
  CODE</a></h1>
Available at: r3.flow source code (history)
<div class="Pp"></div>
Main index | 3D raster index | Topics index | Keywords index | Graphical index |
  Full index
<div class="Pp"></div>
&#x00A9; 2003-2016 GRASS Development Team, GRASS GIS 7.2.0 Reference
  Manual</div>
<table class="foot">
  <tr>
    <td class="foot-date"></td>
    <td class="foot-os">GRASS 7.2.0</td>
  </tr>
</table>
</body>
</html>
