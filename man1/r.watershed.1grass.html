<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>r.watershed(1grass)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">r.watershed(1grass)</td>
    <td class="head-vol">Grass User's Manual</td>
    <td class="head-rtitle">r.watershed(1grass)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
<i></i><b>r.watershed</b> - Calculates hydrological parameters and RUSLE
  factors.
<h1 class="Sh" title="Sh" id="KEYWORDS"><a class="selflink" href="#KEYWORDS">KEYWORDS</a></h1>
raster, hydrology, watershed
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>r.watershed</b>
<div>&#x00A0;</div>
<b>r.watershed --help</b>
<div>&#x00A0;</div>
<b>r.watershed</b> [-<b>s4mab</b>] <b>elevation</b>=<i>name</i>
  [<b>depression</b>= <i>name</i>] [<b>flow</b>=<i>name</i>]
  [<b>disturbed_land</b>= <i>name</i>] [<b>blocking</b>=<i>name</i>]
  [<b>threshold</b>= <i>integer</i>] [<b>max_slope_length</b>=<i>float</i>]
  [<b>accumulation</b>= <i>name</i>] [<b>tci</b>=<i>name</i>]
  [<b>spi</b>=<i>name</i>] [ <b>drainage</b>=<i>name</i>]
  [<b>basin</b>=<i>name</i>] [ <b>stream</b>=<i>name</i>]
  [<b>half_basin</b>=<i>name</i>] [ <b>length_slope</b>=<i>name</i>]
  [<b>slope_steepness</b>= <i>name</i>] [<b>convergence</b>=<i>integer</i>]
  [<b>memory</b>= <i>integer</i>] [--<b>overwrite</b>] [--<b>help</b>]
  [--<b>verbose</b>] [-- <b>quiet</b>] [--<b>ui</b>]
<h2 class="Ss" title="Ss" id="Flags:"><a class="selflink" href="#Flags:">Flags:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-s</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    SFD (D8) flow (default is MFD)
    <div>&#x00A0;</div>
    SFD: single flow direction, MFD: multiple flow direction</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-4</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Allow only horizontal and vertical flow of water</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-m</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Enable disk swap memory option: Operation is slow
    <div>&#x00A0;</div>
    Only needed if memory requirements exceed available RAM; see manual on how
      to calculate memory requirements</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-a</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Use positive flow accumulation even for likely underestimates
    <div>&#x00A0;</div>
    See manual for a detailed description of flow accumulation output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-b</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Beautify flat areas
    <div>&#x00A0;</div>
    Flow direction in flat areas is modified to look prettier</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--overwrite</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Allow output files to overwrite existing files</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--help</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Print usage summary</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--verbose</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Verbose module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--quiet</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Quiet module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ui</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Force launching GUI dialog</dd>
</dl>
<h2 class="Ss" title="Ss" id="Parameters:"><a class="selflink" href="#Parameters:">Parameters:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>elevation</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of input elevation raster map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>depression</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of input depressions raster map
    <div>&#x00A0;</div>
    All non-NULL and non-zero cells are considered as real depressions</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>flow</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of input raster representing amount of overland flow per cell</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>disturbed_land</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of input raster map percent of disturbed land
    <div>&#x00A0;</div>
    For USLE</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>blocking</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of input raster map blocking overland surface flow
    <div>&#x00A0;</div>
    For USLE. All non-NULL and non-zero cells are considered as blocking
      terrain.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>threshold</b>=<i>integer</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Minimum size of exterior watershed basin</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>max_slope_length</b>=<i>float</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Maximum length of surface flow in map units
    <div>&#x00A0;</div>
    For USLE</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>accumulation</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output accumulation raster map
    <div>&#x00A0;</div>
    Number of cells that drain through each cell</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>tci</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output topographic index ln(a / tan(b)) map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>spi</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Stream power index a * tan(b)
    <div>&#x00A0;</div>
    Name for output raster map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>drainage</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output drainage direction raster map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>basin</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output basins raster map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>stream</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output stream segments raster map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>half_basin</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output half basins raster map
    <div>&#x00A0;</div>
    Each half-basin is given a unique value</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>length_slope</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output slope length raster map
    <div>&#x00A0;</div>
    Slope length and steepness (LS) factor for USLE</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>slope_steepness</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output slope steepness raster map
    <div>&#x00A0;</div>
    Slope steepness (S) factor for USLE</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>convergence</b>=<i>integer</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Convergence factor for MFD (1-10)
    <div>&#x00A0;</div>
    1 = most diverging flow, 10 = most converging flow. Recommended: 5
    <div>&#x00A0;</div>
    Default: <i>5</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>memory</b>=<i>integer</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Maximum memory to be used with -m flag (in MB)
    <div>&#x00A0;</div>
    Default: <i>300</i></dd>
</dl>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<i>r.watershed</i> generates a set of maps indicating: 1) flow accumulation,
  drainage direction, the location of streams and watershed basins, and 2) the
  LS and S factors of the Revised Universal Soil Loss Equation (RUSLE).
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
Without flag <b>-m</b> set, the entire analysis is run in memory maintained by
  the operating system. This can be limiting, but is very fast. Setting this
  flag causes the program to manage memory on disk which allows very large maps
  to be processed but is slower.
<div class="Pp"></div>
Flag <b>-s</b> force the module to use single flow direction (SFD, D8) instead
  of multiple flow direction (MFD). MFD is enabled by default.
<div class="Pp"></div>
By <b>-4</b> flag the user allow only horizontal and vertical flow of water.
  Stream and slope lengths are approximately the same as outputs from default
  surface flow (allows horizontal, vertical, and diagonal flow of water). This
  flag will also make the drainage basins look more homogeneous.
<div class="Pp"></div>
When <b>-a</b> flag is specified the module will use positive flow accumulation
  even for likely underestimates. When this flag is not set, cells with a flow
  accumulation value that is likely to be an underestimate are converted to the
  negative. See below for a detailed description of flow accumulation output.
<div class="Pp"></div>
Option <b>convergence</b> specifies convergence factor for MFD. Lower values
  result in higher divergence, flow is more widely distributed. Higher values
  result in higher convergence, flow is less widely distributed, becoming more
  similar to SFD.
<div class="Pp"></div>
Option <b>elevation</b> specifies the elevation data on which entire analysis is
  based. NULL (nodata) cells are ignored, zero and negative values are valid
  elevation data. Gaps in the elevation map that are located within the area of
  interest must be filled beforehand, e.g. with <i>r.fillnulls</i>, to avoid
  distortions. The elevation map need not be sink-filled because the module uses
  a least-cost algorithm.
<div class="Pp"></div>
Option <b>depression</b> specifies the optional map of actual depressions or
  sinkholes in the landscape that are large enough to slow and store surface
  runoff from a storm event. All cells that are not NULL and not zero indicate
  depressions. Water will flow into but not out of depressions.
<div class="Pp"></div>
Raster <b>flow</b> map specifies amount of overland flow per cell. This map
  indicates the amount of overland flow units that each cell will contribute to
  the watershed basin model. Overland flow units represent the amount of
  overland flow each cell contributes to surface flow. If omitted, a value of
  one (1) is assumed.
<div class="Pp"></div>
Input Raster map or value containing the percent of disturbed land (i.e.,
  croplands, and construction sites) where the raster or input value of 17
  equals 17%. If no map or value is given, <i>r.watershed</i> assumes no
  disturbed land. This input is used for the RUSLE calculations.
<div class="Pp"></div>
Option <b>blocking</b> specifies terrain that will block overland surface flow.
  Blocking cells and streams stop the slope length for the RUSLE. All cells that
  are not NULL and not zero indicate blocking terrain.
<div class="Pp"></div>
Option <b>threshold</b> specifies the minimum size of an exterior watershed
  basin in cells, if no flow map is input, or overland flow units when a flow
  map is given. Warning: low threshold values will dramactically increase run
  time and generate difficult to read basin and half_basin results. This
  parameter also controls the level of detail in the <b>stream</b> segments map.
<div class="Pp"></div>
Value given by <b>max_slope_length</b> option indicates the maximum length of
  overland surface flow in meters. If overland flow travels greater than the
  maximum length, the program assumes the maximum length (it assumes that
  landscape characteristics not discernible in the digital elevation model exist
  that maximize the slope length). This input is used for the RUSLE calculations
  and is a sensitive parameter.
<div class="Pp"></div>
Output <b>accumulation</b> map contains the absolute value of each cell in this
  output map is the amount of overland flow that traverses the cell. This value
  will be the number of upland cells plus one if no overland flow map is given.
  If the overland flow map is given, the value will be in overland flow units.
  Negative numbers indicate that those cells possibly have surface runoff from
  outside of the current geographic region. Thus, any cells with negative values
  cannot have their surface runoff and sedimentation yields calculated
  accurately.
<div class="Pp"></div>
Output <b>tci</b> raster map contains topographic index TCI, computed as
  ln(&amp;#945; / tan(&amp;#946;)) where &amp;#945; is the cumulative upslope
  area draining through a point per unit contour length and tan(&amp;#946;) is
  the local slope angle. The TCI reflects the tendency of water to accumulate at
  any point in the catchment and the tendency for gravitational forces to move
  that water downslope (Quinn et al. 1991). This value will be negative if
  &amp;#945; / tan(&amp;#946;) &lt; 1.
<div class="Pp"></div>
Output <b>spi</b> raster map contains stream power index SPI, computed as
  &amp;#945; * tan(&amp;#946;) where &amp;#945; is the cumulative upslope area
  draining through a point per unit contour length and tan(&amp;#946;) is the
  local slope angle. The SPI reflects the power of water flow at any point in
  the catchment and the tendency for gravitational forces to move that water
  downslope (Moore et al. 1991). This value will be negative if &amp;#945; &lt;
  0, i.e. for cells with possible surface runoff from outside of the current
  geographic region.
<div class="Pp"></div>
Output <b>drainage</b> raster map contains drainage direction. Provides the
  &quot;aspect&quot; for each cell measured CCW from East. Multiplying positive
  values by 45 will give the direction in degrees that the surface runoff will
  travel from that cell. The value 0 (zero) indicates that the cell is a
  depression area (defined by the depression input map). Negative values
  indicate that surface runoff is leaving the boundaries of the current
  geographic region. The absolute value of these negative cells indicates the
  direction of flow. For MFD, drainage indicates the direction of maximum flow.
<div class="Pp"></div>
The output <b>basin</b> map contains unique label for each watershed basin. Each
  basin will be given a unique positive even integer. Areas along edges may not
  be large enough to create an exterior watershed basin. NULL values indicate
  that the cell is not part of a complete watershed basin in the current
  geographic region.
<div class="Pp"></div>
The output <b>stream</b> contains stream segments. Values correspond to the
  watershed basin values. Can be vectorized after thinning ( <i>r.thin</i>) with
  <i>r.to.vect</i>.
<div class="Pp"></div>
The output <b>half_basin</b> raster map stores each half-basin is given a unique
  value. Watershed basins are divided into left and right sides. The right-hand
  side cell of the watershed basin (looking upstream) are given even values
  corresponding to the values in basin. The left-hand side cells of the
  watershed basin are given odd values which are one less than the value of the
  watershed basin.
<div class="Pp"></div>
The output <b>length_slope</b> raster map stores slope length and steepness (LS)
  factor for the Revised Universal Soil Loss Equation (RUSLE). Equations taken
  from <i>Revised Universal Soil Loss</i> <i>Equation for Western Rangelands</i>
  (Weltz et al. 1987). Since the LS factor is a small number (usually less than
  one), the GRASS output map is of type DCELL.
<div class="Pp"></div>
The output <b>slope_steepness</b> raster map stores slope steepness (S) factor
  for the Universal Soil Loss Equation (RUSLE). Equations taken from article
  entitled <i>Revised Slope Steepness Factor for the Universal Soil</i> <i>Loss
  Equation</i> (McCool et al. 1987). Since the S factor is a small number
  (usually less than one), the GRASS output map is of type DCELL.
<h2 class="Ss" title="Ss" id="AT_least-cost_search_algorithm"><a class="selflink" href="#AT_least-cost_search_algorithm">AT
  least-cost search algorithm</a></h2>
<i>r.watershed</i> uses an AT least-cost search algorithm (see REFERENCES
  section) designed to minimize the impact of DEM data errors. Compared to
  <i>r.terraflow</i>, this algorithm provides more accurate results in areas of
  low slope as well as DEMs constructed with techniques that mistake canopy tops
  as the ground elevation. Kinner et al. (2005), for example, used SRTM and
  IFSAR DEMs to compare <i>r.watershed</i> against <i>r.terraflow</i> results in
  Panama. <i>r.terraflow</i> was unable to replicate stream locations in the
  larger valleys while <i>r.watershed</i> performed much better. Thus, if forest
  canopy exists in valleys, SRTM, IFSAR, and similar data products will cause
  major errors in <i>r.terraflow</i> stream output. Under similar conditions,
  <i>r.watershed</i> will generate better <b>stream</b> and <b>half_basin</b>
  results. If watershed divides contain flat to low slope, <i>r.watershed</i>
  will generate better basin results than <i>r.terraflow</i>.
  (<i>r.terraflow</i> uses the same type of algorithm as ESRI&#x2019;s ArcGIS
  watershed software which fails under these conditions.) Also, if watershed
  divides contain forest canopy mixed with uncanopied areas using SRTM, IFSAR,
  and similar data products, <i>r.watershed</i> will generate better basin
  results than <i>r.terraflow</i>. The algorithm produces results similar to
  those obtained when running <i>r.cost</i> and <i>r.drain</i> on every cell on
  the raster map.
<h2 class="Ss" title="Ss" id="Multiple_flow_direction_(MFD)"><a class="selflink" href="#Multiple_flow_direction_(MFD)">Multiple
  flow direction (MFD)</a></h2>
<i>r.watershed</i> offers two methods to calculate surface flow: single flow
  direction (SFD, D8) and multiple flow direction (MFD). With MFD, water flow is
  distributed to all neighbouring cells with lower elevation, using slope
  towards neighbouring cells as a weighing factor for proportional distribution.
  The AT least-cost path is always included. As a result, depressions and
  obstacles are traversed with a gracefull flow convergence before the overflow.
  The convergence factor causes flow accumulation to converge more strongly with
  higher values. The supported range is 1 to 10, recommended is a convergence
  factor of 5 (Holmgren, 1994). If many small sliver basins are created with
  MFD, setting the convergence factor to a higher value can reduce the amount of
  small sliver basins.
<h2 class="Ss" title="Ss" id="In-memory_mode_and_disk_swap_mode"><a class="selflink" href="#In-memory_mode_and_disk_swap_mode">In-memory
  mode and disk swap mode</a></h2>
There are two versions of this program: <i>ram</i> and <i>seg</i>. <i>ram</i> is
  used by default, <i>seg</i> can be used by setting the <b>-m</b> flag.
<div class="Pp"></div>
The <i>ram</i> version requires a maximum of 31 MB of RAM for 1 million cells.
  Together with the amount of system memory (RAM) available, this value can be
  used to estimate whether the current region can be processed with the
  <i>ram</i> version.
<div class="Pp"></div>
The <i>ram</i> version uses virtual memory managed by the operating system to
  store all the data structures and is faster than the <i>seg</i> version;
  <i>seg</i> uses the GRASS segmentation library which manages data in disk
  files. <i>seg</i> uses only as much system memory (RAM) as specified with the
  <b>memory</b> option, allowing other processes to operate on the same system,
  even when the current geographic region is huge.
<div class="Pp"></div>
Due to memory requirements of both programs, it is quite easy to run out of
  memory when working with huge map regions. If the <i>ram</i> version runs out
  of memory and the resolution size of the current geographic region cannot be
  increased, either more memory needs to be added to the computer, or the swap
  space size needs to be increased. If <i>seg</i> runs out of memory, additional
  disk space needs to be freed up for the program to run. The <i>r.terraflow</i>
  module was specifically designed with huge regions in mind and may be useful
  here as an alternative, although disk space requirements of <i>r.terraflow</i>
  are several times higher than of <i>seg</i>.
<h2 class="Ss" title="Ss" id="Large_regions_with_many_cells"><a class="selflink" href="#Large_regions_with_many_cells">Large
  regions with many cells</a></h2>
The upper limit of the <i>ram</i> version is 2 billion (231 - 1) cells, whereas
  the upper limit for the <i>seg</i> version is 9 billion-billion (263 - 1 =
  9.223372e+18) cells.
<div>&#x00A0;</div>
In some situations, the region size (number of cells) may be too large for the
  amount of time or memory available. Running <i>r.watershed</i> may then
  require use of a coarser resolution. To make the results more closely resemble
  the finer terrain data, create a map layer containing the lowest elevation
  values at the coarser resolution. This is done by: 1) Setting the current
  geographic region equal to the elevation map layer with <i>g.region</i>, and
  2) Use the <i>r.neighbors</i> or <i>r.resamp.stats</i> command to find the
  lowest value for an area equal in size to the desired resolution. For example,
  if the resolution of the elevation data is 30 meters and the resolution of the
  geographic region for <i>r.watershed</i> will be 90 meters: use the minimum
  function for a 3 by 3 neighborhood. After changing to the resolution at which
  <i>r.watershed</i> will be run, <i>r.watershed</i> should be run using the
  values from the <b>neighborhood</b> output map layer that represents the
  minimum elevation within the region of the coarser cell.
<h2 class="Ss" title="Ss" id="Basin_threshold"><a class="selflink" href="#Basin_threshold">Basin
  threshold</a></h2>
The minimum size of drainage basins, defined by the <b>threshold</b> parameter,
  is only relevant for those watersheds with a single stream having at least the
  <b>threshold</b> of cells flowing into it. (These watersheds are called
  exterior basins.) Interior drainage basins contain stream segments below
  multiple tributaries. Interior drainage basins can be of any size because the
  length of an interior stream segment is determined by the distance between the
  tributaries flowing into it.
<h2 class="Ss" title="Ss" id="MASK_and_no_data"><a class="selflink" href="#MASK_and_no_data">MASK
  and no data</a></h2>
The <i>r.watershed</i> program does not require the user to have the current
  geographic region filled with elevation values. Areas without elevation data
  (masked or NULL cells) are ignored. It is NOT necessary to create a raster map
  (or raster reclassification) named MASK for NULL cells. Areas without
  elevation data will be treated as if they are off the edge of the region. Such
  areas will reduce the memory necessary to run the program. Masking out
  unimportant areas can significantly reduce processing time if the watersheds
  of interest occupy a small percentage of the overall area.
<div class="Pp"></div>
Gaps (NULL cells) in the elevation map that are located within the area of
  interest will heavily influence the analysis: water will flow into but not out
  of these gaps. These gaps must be filled beforehand, e.g. with
  <i>r.fillnulls</i>.
<div class="Pp"></div>
Zero (0) and negative values will be treated as elevation data (not no_data).
<h2 class="Ss" title="Ss" id="Further_processing_of_output_layers"><a class="selflink" href="#Further_processing_of_output_layers">Further
  processing of output layers</a></h2>
Problem areas, i.e. those parts of a basin with a likely underestimate of flow
  accumulation, can be easily identified with e.g.
<div>&#x00A0;</div>
<pre>
  r.mapcalc &quot;problems = if(flow_acc &lt; 0, basin, null())&quot;
</pre>
If the region of interest contains such problem areas, and this is not desired,
  the computational region must be expanded until the catchment area for the
  region of interest is completely included.
<div class="Pp"></div>
To isolate an individual river network using the output of this module, a number
  of approaches may be considered.
<dl class="Bl-tag">
  <dt class="It-tag"><b>1</b></dt>
  <dd class="It-tag">Use a resample of the basins catchment raster map as a
      MASK.
    <div>&#x00A0;</div>
    The equivalent vector map method is similar using <i>v.select</i> or
      <i>v.overlay</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>2</b></dt>
  <dd class="It-tag">Use the <i>r.cost</i> module with a point in the river as a
      starting point.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>3</b></dt>
  <dd class="It-tag">Use the <i>v.net.iso</i> module with a node in the river as
      a starting point.</dd>
</dl>
<div class="Pp"></div>
All individual river networks in the stream segments output can be identified
  through their ultimate outlet points. These points are all cells in the stream
  segments output with negative drainage direction. These points can be used as
  start points for <i>r.water.outlet</i> or <i>v.net.iso</i>.
<div class="Pp"></div>
To create <i>river mile</i> segmentation from a vectorized streams map, try the
  <i>v.net.iso</i> or <i>v.lrs.segment</i> modules.
<div class="Pp"></div>
The stream segments output can be easily vectorized after thinning with
  <i>r.thin</i>. Each stream segment in the vector map will have the value of
  the associated basin. To isolate subbasins and streams for a larger basin, a
  MASK for the larger basin can be created with <i>r.water.outlet</i>. The
  stream segments output serves as a guide where to place the outlet point used
  as input to <i>r.water.outlet</i>. The basin threshold must have been
  sufficiently small to isolate a stream network and subbasins within the larger
  basin.
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
These examples use the Spearfish sample dataset.
<h2 class="Ss" title="Ss" id="Convert_r.watershed_streams_map_output_to_a_vector_map"><a class="selflink" href="#Convert_r.watershed_streams_map_output_to_a_vector_map">Convert
  <i>r.watershed</i> streams map output to a vector map</a></h2>
If you want a detailed stream network, set the threshold option small to create
  lots of catchment basins, as only one stream is presented per catchment. The
  r.to.vect -v flag preserves the catchment ID as the vector category number.
<div>&#x00A0;</div>
<pre>
  r.watershed elev=elevation.dem stream=rwater.stream
  r.to.vect -v in=rwater.stream out=rwater_stream
</pre>
<div class="Pp"></div>
Set a different color table for the accumulation map:
<div>&#x00A0;</div>
<pre>
  MAP=rwater.accum
  r.watershed elev=elevation.dem accum=$MAP
  eval `r.univar -g &quot;$MAP&quot;`
  stddev_x_2=`echo $stddev | awk &#x2019;{print $1 * 2}&#x2019;`
  stddev_div_2=`echo $stddev | awk &#x2019;{print $1 / 2}&#x2019;`
  r.colors $MAP col=rules &lt;&lt; EOF
    0% red
    -$stddev_x_2 red
    -$stddev yellow
    -$stddev_div_2 cyan
    -$mean_of_abs blue
    0 white
    $mean_of_abs blue
    $stddev_div_2 cyan
    $stddev yellow
    $stddev_x_2 red
    100% red
  EOF
</pre>
<div class="Pp"></div>
Create a more detailed stream map using the accumulation map and convert it to a
  vector output map. The accumulation cut-off, and therefore fractal dimension,
  is arbitrary; in this example we use the map&#x2019;s mean number of upstream
  catchment cells (calculated in the above example by <i>r.univar</i>) as the
  cut-off value. This only works with SFD, not with MFD.
<div>&#x00A0;</div>
<pre>
  r.watershed elev=elevation.dem accum=rwater.accum
  r.mapcalc &#x2019;MASK = if(!isnull(elevation.dem))&#x2019;
  r.mapcalc &quot;rwater.course = \
   if( abs(rwater.accum) &gt; $mean_of_abs, \
       abs(rwater.accum), \
       null() )&quot;
  r.colors -g rwater.course col=bcyr
  g.remove -f type=raster name=MASK
  #  <i>Thinning is required before converting raster lines to vector</i>
  r.thin in=rwater.course out=rwater.course.Thin
  r.colors -gn rwater.course.Thin color=grey
  r.to.vect in=rwater.course.Thin out=rwater_course type=line
  v.db.dropcolumn map=rwater_course column=label
</pre>
<h2 class="Ss" title="Ss" id="Create_watershed_basins_map_and_convert_to_a_vector_polygon_map"><a class="selflink" href="#Create_watershed_basins_map_and_convert_to_a_vector_polygon_map">Create
  watershed basins map and convert to a vector polygon map</a></h2>
<pre>
  r.watershed elev=elevation.dem basin=rwater.basin thresh=15000
  r.to.vect -s in=rwater.basin out=rwater_basins type=area
  v.db.dropcolumn map=rwater_basins column=label
  v.db.renamecolumn map=rwater_basins column=value,catchment
</pre>
<div class="Pp"></div>
Display output in a nice way
<div>&#x00A0;</div>
<pre>
  r.relief map=elevation.dem
  d.shade shade=elevation.dem.shade color=rwater.basin bright=40
  d.vect rwater_course color=orange
</pre>
<h1 class="Sh" title="Sh" id="REFERENCES"><a class="selflink" href="#REFERENCES">REFERENCES</a></h1>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Ehlschlaeger C. (1989). <i>Using the AT Search
      Algorithm</i> <i>to Develop Hydrologic Models from Digital Elevation
      Data</i>, <b>Proceedings of International Geographic Information Systems
      (IGIS)</b> <b>Symposium &#x2019;89</b>, pp 275-281 (Baltimore, MD, 18-19
      March 1989).
    <div>&#x00A0;</div>
    URL: http://chuck.ehlschlaeger.info/older/IGIS/paper.html</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Holmgren P. (1994). <i>Multiple flow direction algorithms
      for runoff</i> <i>modelling in grid based elevation models: An empirical
      evaluation.</i> <b>Hydrological Processes</b> Vol 8(4), 327-334.
    <div>&#x00A0;</div>
    DOI: 10.1002/hyp.3360080405</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Kinner D., Mitasova H., Harmon R., Toma L., Stallard R.
      (2005). <i>GIS-based Stream Network Analysis for The Chagres River
      Basin,</i> <i>Republic of Panama</i>. <b>The Rio Chagres: A
      Multidisciplinary Profile of</b> <b>a Tropical Watershed</b>, R. Harmon
      (Ed.), Springer/Kluwer, p.83-95.
    <div>&#x00A0;</div>
    URL: http://www4.ncsu.edu/~hmitaso/measwork/panama/panama.html</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">McCool et al. (1987). <i>Revised Slope Steepness Factor for
      the Universal</i> <i>Soil Loss Equation</i>, <b>Transactions of the
      ASAE</b> Vol 30(5).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Metz M., Mitasova H., Harmon R. (2011). <i>Efficient
      extraction of</i> <i>drainage networks from massive, radar-based elevation
      models with least</i> <i>cost path search</i>, <b>Hydrol. Earth Syst.
      Sci.</b> Vol 15, 667-678.
    <div>&#x00A0;</div>
    DOI: 10.5194/hess-15-667-2011</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Moore I.D., Grayson R.B., Ladson A.R. (1991). <i>Digital
      terrain</i> <i>modelling: a review of hydrogical, geomorphological, and
      biological</i> <i>applications</i>, <b>Hydrological Processes</b>, Vol
      5(1), 3-30
    <div>&#x00A0;</div>
    DOI: 10.1002/hyp.3360050103</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Quinn P., K. Beven K., Chevallier P., Planchon O. (1991).
      <i>The</i> <i>prediction of hillslope flow paths for distributed
      hydrological modelling</i> <i>using Digital Elevation Models</i>,
      <b>Hydrological Processes</b> Vol 5(1), p.59-79.
    <div>&#x00A0;</div>
    DOI: 10.1002/hyp.3360050106</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Weltz M. A., Renard K.G., Simanton J. R. (1987). <i>Revised
      Universal Soil</i> <i>Loss Equation for Western Rangelands</i>,
      <b>U.S.A./Mexico Symposium of</b> <b>Strategies for Classification and
      Management of Native Vegetation for</b> <b>Food Production In Arid
      Zones</b> (Tucson, AZ, 12-16 Oct. 1987).</dd>
</dl>
</div>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<i></i> <i>g.region,</i> <i>r.cost,</i> <i>r.drain,</i> <i>r.fillnulls,</i>
  <i>r.flow,</i> <i>r.mask,</i> <i>r.neighbors,</i> <i>r.param.scale,</i>
  <i>r.resamp.interp,</i> <i>r.terraflow,</i> <i>r.topidx,</i>
  <i>r.water.outlet,</i> <i>r.stream.extract</i> <i></i>
<h1 class="Sh" title="Sh" id="AUTHORS"><a class="selflink" href="#AUTHORS">AUTHORS</a></h1>
Original version: Charles Ehlschlaeger, U.S. Army Construction Engineering
  Research Laboratory
<div>&#x00A0;</div>
Faster sorting algorithm and MFD support: Markus Metz &lt;markus.metz.giswork at
  gmail.com&gt;
<div class="Pp"></div>
<i>Last changed: $Date: 2016-05-11 09:04:39 +0200 (Wed, 11 May 2016) $</i>
<h1 class="Sh" title="Sh" id="SOURCE_CODE"><a class="selflink" href="#SOURCE_CODE">SOURCE
  CODE</a></h1>
Available at: r.watershed source code (history)
<div class="Pp"></div>
Main index | Raster index | Topics index | Keywords index | Graphical index |
  Full index
<div class="Pp"></div>
&#x00A9; 2003-2016 GRASS Development Team, GRASS GIS 7.2.0 Reference
  Manual</div>
<table class="foot">
  <tr>
    <td class="foot-date"></td>
    <td class="foot-os">GRASS 7.2.0</td>
  </tr>
</table>
</body>
</html>
