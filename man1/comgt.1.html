<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>comgt(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">comgt(1)</td>
    <td class="head-vol">General Commands Manual</td>
    <td class="head-rtitle">comgt(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
comgt - Option GlobeTrotter GPRS/EDGE/3G/HSDPA and Vodafone 3G/GPRS datacard
  control tool
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>comgt</b> -d <i>device</i> -ehstvVx <i>script</i>
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
<br/>
<b>-d</b> <i>device</i>
<br/>
set the device to be used to communicate with the data-card. If not specified
  then comgt trys <i>/dev/noz2, /dev/ttyUSB2</i> and then <i>/dev/modem</i>
<div class="Pp"></div>
<br/>
<b>-e</b>
<br/>
turn on serial communications echo.
<div class="Pp"></div>
<br/>
<b>-h</b>
<br/>
display summary help and exit.
<div class="Pp"></div>
<br/>
<b>-s</b>
<br/>
don&#x00B4;t run the internal <i>default</i> script before an external script.
<div class="Pp"></div>
<br/>
<b>-t</b>
<br/>
change to an alternate line terminator (default &quot;0).
<div class="Pp"></div>
<br/>
<b>-v</b>
<br/>
run in verbose mode. This traces scripts as they are executed. It is intended to
  help in debugging scripts.
<div class="Pp"></div>
<br/>
<b>-V</b>
<br/>
Print Version information.
<div class="Pp"></div>
<br/>
<b>-x</b>
<br/>
for internal and external scripts, any reference to 115200 baud is converted to
  57600. This is useful for data cards that don't like 115200 baud such as the
  GlobeTrotter EDGE.
<div class="Pp"></div>
<br/>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<b>comgt</b> is a scripting language interpreter useful for establishing
  communications on serial lines and through PCMCIA modems as well as GPRS and
  3G datacards.
<div class="Pp"></div>
<b>comgt</b> has some features that are rarely found in other utilities of the
  same type.
<br/>
<h2 class="Ss" title="Ss" id="Features"><a class="selflink" href="#Features">Features</a></h2>
<pre>
- Pre-defined built-in scripts for 2G/3G datacard control
- Simple, BASIC-like script language.
- Command-line and file sourcing of script.
- Multi-response waitfor.
- waitquiet permits line stabilization.
- In-line text capture.
- Multi-process support: fork, wait, kill, exit.
- Debugging verbose and log output.
- logging to file.
- Flow control: goto, gosub, return, if, else.
- Low-impact on system resources.
- Time commands and functions.
- String manipulations.
- Environment manipulation: env(), putenv.
- External utilities system calls: system, exec.
</pre>
<h2 class="Ss" title="Ss" id="Supported_GPRS_and_3G_datacards"><a class="selflink" href="#Supported_GPRS_and_3G_datacards">Supported
  GPRS and 3G datacards</a></h2>
<b>comgt</b> has been tested against GlobeTrotter GPRS,EDGE, Combo EDGE, 3G, 3G
  EDGE, HSDPA and GlobeTrotter Fusion as well as Vodafone 3G. It can set the PIN
  and display information about datacards before a PPP connection is started.
  Additionally, because the GlobeTrotter and Vodafone 3G/GPRS datacard have a
  secondary serial interface, these datacards can be monitored while a PPP
  connection is in existence and transferring data.
<div class="Pp"></div>
<b>comgt</b> is primarily designed to work with the GlobeTrotter range of
  datacards but should be compatible with any other GPRS or 3G datacard provided
  its interface is implemented as one or more serial or USB serial devices and
  it is controlled and queried by an implementation of the Hayes command
  interface with the same AT command extensions used by the listed datacards.
<h2 class="Ss" title="Ss" id="Using_comgt"><a class="selflink" href="#Using_comgt">Using
  comgt</a></h2>
<b>comgt</b> has only one function: to run a script. This may be one of a number
  of &quot;standard&quot; internal scripts or an external script. Both types of
  script are invoked in the same way. The &quot;standard&quot; scripts are built
  into <b>comgt</b> and will work for serially connected modems, built-in
  modems, PCMCIA modems as well as the GlobeTrotter GPRS and the Vodafone
  3G/GPRS datacards. There is a search priority order for scripts - 1)internal,
  2)working directory, 3)/etc/comgt
<h2 class="Ss" title="Ss" id="Built-in_scripts"><a class="selflink" href="#Built-in_scripts">Built-in
  scripts</a></h2>
<br/>
<i>comgt</i>
<br/>
This runs the default internal script. Running <b>comgt</b> without any script
  specified, e.g., <i>comgt -d /dev/ttyS1</i> it will check for a PIN and prompt
  you if it is required. The next thing it does is wait for the device to
  register, it then reports the signal strength. If you don&#x00B4;t specify a
  port with the <b>-d</b> option then <i>/dev/modem</i> is assumed. If the -s
  switch is not used then this default script is run before any external script.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
<i>comgt help</i>
<br/>
Lists these and the other options available.
<div class="Pp"></div>
<br/>
<i>comgt info</i>
<br/>
Lists the datacard configuration.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
<i>comgt sig</i>
<br/>
Prints the signal strength.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
<i>comgt reg</i>
<br/>
Prints the registration state.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
<i>comgt 3G</i>
<br/>
Puts a GlobeTrotter 3G/Fusion and Vodafone 3G into 3G network only mode
  (UMTS/HSDPA).
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
<i>comgt 2G</i>
<br/>
Puts a GlobeTrotter 3G/Fusion and Vodafone 3G into 2G network only mode
  (GSM/GPRS/EDGE).
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
<i>comgt 3G2G</i>
<br/>
Puts a GlobeTrotter 3G/Fusion and Vodafone 3G into 3G preferred mode (UMTS/HSDPA
  and GSM/GPRS/EDGE).
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
<i>comgt GTEDGE</i>
<br/>
Use this command to initialise GlobeTrotter EDGE and GlobeTrotter Combo EDGE
  cards before doing anything else. (It switches on the radio).
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
<i>comgt USA</i>
<br/>
Switch to 900/1900 MHz band for USA operation. GlobeTrotter GPRS datacards only.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
<i>comgt EUROPE</i>
<br/>
Switch to 900/1800 MHz band for European operation. GlobeTrotter GPRS datacards
  only.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
<i>comgt PIN</i>
<br/>
Test the SIM PIN status and use the environment variable COMGTPIN as the value .
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
<i>comgt APN</i>
<br/>
Set the APN of the datacard to the value contained in the COMGTAPN environment
  variable.
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Custom_Scripts"><a class="selflink" href="#Custom_Scripts">Custom
  Scripts</a></h2>
As well as built in scripts you can make your own. The following script sets a
  Vodafone 3G datacard or Option Fusion card&#x00B4;s UMTS mode to GPRS:
<div class="Pp"></div>
<br/>
#Set GPRS only mode
<div>&#x00A0;</div>
set com 115200n81
<div>&#x00A0;</div>
set senddelay 0.05
<div>&#x00A0;</div>
waitquiet 1 0.2 send &quot;AT_OPSYS=0^m&quot;
<div>&#x00A0;</div>
print &quot;Setting GPRS only mode&quot;
<div class="Pp"></div>
If you saved the above script as GPRS you would call it like this:
<div class="Pp"></div>
<br/>
<i>comgt GPRS</i>
<br/>
<div class="Pp"></div>
If you needed to specify the port as well then do this:
<div class="Pp"></div>
<br/>
<i>comgt -d /dev/ttyS1 GPRS</i>
<br/>
<div class="Pp"></div>
You can also pass environment parameters to a <b>comgt</b> script via
  <i>$env().</i>
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Replacing_chat"><a class="selflink" href="#Replacing_chat">Replacing
  chat</a></h2>
<b>chat</b> is a utility that comes with the ppp package (for Linux, anyway)
  that, with a set of expect-send string couples, does enough to connect most
  people to ISPs and such. While chat&#x00B4;s use is very simple, it
  isn&#x00B4;t very flexible. That&#x00B4;s where <b>comgt</b> takes over.
<div class="Pp"></div>
<b>comgt</b> can be used in place of <b>chat</b> using the same strategy. For
  example, a pppd line reading:
<div class="Pp"></div>
<br/>
<pre>
pppd connect \ 
     &#x00B4;chat -v &quot;&quot; ATDT5551212 CONNECT &quot;&quot; ogin: ppp \
     word: whitewater&#x00B4; \
     /dev/cua1 38400 debug crtscts modem defaultroute
</pre>
<br/>
<div class="Pp"></div>
Would, using <b>comgt,</b> read:
<div class="Pp"></div>
<br/>
<pre>
pppd connect &#x00B4;comgt -s /root/scripts/isp.scr&#x00B4; /dev/cua1 38400 \
     debug crtscts modem defaultroute
</pre>
<br/>
<div class="Pp"></div>
And the isp.scr script would read:
<div class="Pp"></div>
<pre>
     send &quot;ATDT5551212^m&quot;
     waitfor 60 &quot;ogin:&quot;
     send &quot;ppp^m&quot;
     waitfor 60 &quot;word:&quot;
     send &quot;whitewater^m&quot;
</pre>
<div class="Pp"></div>
Of course it then becomes trivial to make this script a whole lot more
  functional by adding code for busy detect, re-dialing, etc...
<h2 class="Ss" title="Ss" id="Verbose_output"><a class="selflink" href="#Verbose_output">Verbose
  output</a></h2>
When the verbose option is turned on, <b>comgt</b> reports everthing on the
  standard error channel. If turned on from the command line (-v), the output
  contains 4 sections.
<div class="Pp"></div>
- Command line argument actions
<br/>
These are actions taken because they were specified from the command line, such
  as opening a communication device (-d), etc... For these to be output, you
  must specify -v as the first argument.
<br/>
<div class="Pp"></div>
- List of arguments
<br/>
The number and list of arguments passed. This is useful in case you have a bunch
  of environment variables or quotes, back-quotes, backslashes on the command
  line and you&#x00B4;re not sure what the script really sees.
<br/>
<div class="Pp"></div>
- Script list
<br/>
A list of the script to execute. This may be a concatenation of the default
  internal script, unless this is suppressed by the -s option, and a script
  file. Every line is listed with its line number and character position.
<br/>
<div class="Pp"></div>
- Execution output
<br/>
List of commands as they are executed. The parser prints the line its currently
  on, starting from the exact point where its at to the end of the line.
  Multiple command groups on a single line produce multiple output lines.
  Verbose output may be mixed with script output (print, eprint or lprint.)
<br/>
<div class="Pp"></div>
Here&#x00B4;s an example:
<div class="Pp"></div>
<br/>
<pre>
$ comgt -v -d/dev/cua1 -s blah.scr
comgt 00:18:46 -&gt; Verbose output enabled
comgt 00:18:46 -&gt; Script file: blah.scr
comgt 00:18:46 -&gt; argc:5
comgt 00:18:46 -&gt; argv[0]=comgt
comgt 00:18:46 -&gt; argv[1]=-v
comgt 00:18:46 -&gt; argv[2]=-d/dev/cua1
comgt 00:18:46 -&gt; argv[3]=-s
comgt 00:18:46 -&gt; argv[4]=blah.scr
comgt 00:18:46 -&gt;  ---Script---
<br/>
1@0000 set com 38400n81 let a=2
2@0025 print &quot;9x&quot;,a,&quot;=&quot;,9*a,&quot;\n&quot;
3@0051 sleep 5
4@0059 exit 0
<br/>
comgt 00:18:46 -&gt;  ---End of script---
comgt 00:18:46 -&gt; @0000 set com 38400n81 let a=2
comgt 00:18:46 -&gt; @0017 let a=2
comgt 00:18:46 -&gt; @0025 print &quot;9x&quot;,a,&quot;=&quot;,9*a,&quot;\n&quot;
9x2=18
comgt 00:18:46 -&gt; @0051 sleep 5
comgt 00:18:51 -&gt; @0059 exit 0
<br/>
</pre>
<h1 class="Sh" title="Sh" id="Programming_manual"><a class="selflink" href="#Programming_manual">Programming
  manual</a></h1>
<h2 class="Ss" title="Ss" id="Syntax"><a class="selflink" href="#Syntax">Syntax</a></h2>
The syntax used for <b>comgt</b> scripts is rather simple, somewhat BASIC-like.
  A script is a non-tokenized, pure ASCII text file containing lines terminated
  by newline characters (Unix standard.) Scripts can be created and/or modified
  using any standard text editor (vi, vim, joe, pico, emacs, ed, microEmacs)
  Lines in a <b>comgt</b> script read like so:
<pre>
<div class="Pp"></div>
 - Empty line
 - [indent]rem remark
 - [indent][[:|label] LABEL] [command [arguments]] rem remark
 - [indent][[:|label] LABEL] [command [arguments]] [command [arguments]]...
</pre>
<div class="Pp"></div>
<pre>
Characters used for indentation are the space and tabulation characters.
The rem command makes the script parser skip the rest of the line.
The rem command can also be written as &quot;#&quot; or &quot;//&quot;.
</pre>
<div class="Pp"></div>
<pre>
Labels consist of lowercase and uppercase letters and digits.
Case is ignored in labels.
</pre>
<div class="Pp"></div>
<pre>
Commands and their arguments are separated by spaces and/or tabs.
Command groups are separated by spaces, tabs, or newlines.
</pre>
<div class="Pp"></div>
<pre>
Expressions must not contain spaces or tabs.
This is ok : let n=x+76
This is not: let n= x + 76
  Because this space ^ would terminate the let command group.
</pre>
<h2 class="Ss" title="Ss" id="Error_reporting"><a class="selflink" href="#Error_reporting">Error
  reporting</a></h2>
When <b>comgt</b> detects a script error, it immediately turns on verbose mode,
  generates a dump (see the dump command), reports the error in three lines and
  stops the execution. The first line reported is the command group being
  executed, the second one shows where the parser got and the third line reports
  the character position of the program counter, the error and the exit code.
<div style="height: 1.00em;">&#x00A0;</div>
Here&#x00B4;s an example:
<div class="Pp"></div>
<br/>
<pre>
$ comgt -vs blar2.scr
</pre>
<br/>
<div class="Pp"></div>
Where the blar2.scr script is:
<div class="Pp"></div>
<pre>
<br/>
inc n 
dec d3 
let a=58/3 
let $d=&quot;fod&quot; 
let c=1/0 
let $y4=&quot;sdfgsdfgsdfg&quot;
<br/>
</pre>
<div class="Pp"></div>
The trace and error report looks like this:
<div class="Pp"></div>
<br/>
<pre>
comgt 11:20:15 -&gt; Verbose output enabled
comgt 11:20:15 -&gt; Script file: blar2.scr
comgt 11:20:15 -&gt; argc:3
comgt 11:20:15 -&gt; argv[0]=comgt
comgt 11:20:15 -&gt; argv[1]=-vs
comgt 11:20:15 -&gt; argv[2]=blar2.scr
comgt 11:20:15 -&gt;  ---Script---
<br/>
1@0000 inc n
2@0007 dec d3
3@0015 let a=58/3
4@0027 let $d=&quot;fod&quot;
5@0041 let c=1/0
6@0052 let $y4=&quot;sdfgsdfgsdfg&quot;
<br/>
comgt 11:20:15 -&gt;  ---End of script---
comgt 11:20:15 -&gt; @0000 inc n
comgt 11:20:15 -&gt; @0007 dec d3
comgt 11:20:15 -&gt; @0015 let a=58/3
comgt 11:20:15 -&gt; @0027 let $d=&quot;fod&quot;
comgt 11:20:15 -&gt; @0041 let c=1/0
comgt 11:20:15 -&gt; -- Error Report --
comgt 11:20:15 -&gt; ----&gt;         ^
comgt 11:20:15 -&gt; Error @49, line 5, Division by zero. (6)
</pre>
<br/>
<h2 class="Ss" title="Ss" id="Exit_codes"><a class="selflink" href="#Exit_codes">Exit
  codes</a></h2>
When <b>comgt</b> terminates, it does so with an &quot;exit code&quot;. That is
  a number passed back to the calling process to signify success or failures. In
  every-day Unix, 0 (zero) means success and everything else means whatever the
  author of the program wants it to mean. In a shell script, or directly on the
  command line, you may look at the content of <i>$?</i> after having called
  <b>comgt</b> to examine its exit code.
<div class="Pp"></div>
Example:
<div class="Pp"></div>
<br/>
<pre>
#!/bin/sh
comgt /root/bin/call-isp
if [ $? != 0 ]; then
  echo &quot;Oops! Something went wrong.&quot;
fi
</pre>
<br/>
<div class="Pp"></div>
Internal <b>comgt</b> error codes are as follows:
<div class="Pp"></div>
<br/>
<pre>
0 : No problems whatsoever.  Apparently.
1 : Communication device problems.
2 : Console (tty) device problems.
3 : Memory problems.
4 : File or pipe problems.
5 : Syntax errors.
6 : Division by zero.
7 : Variable mis-management.
8 : System problems.  (Couldn&#x00B4;t call /bin/sh or some such)
</pre>
<br/>
<h2 class="Ss" title="Ss" id="Commands"><a class="selflink" href="#Commands">Commands</a></h2>
<pre>
Command     : :   Alias: label
Description : Notes an anchor point for goto or gosub to branch to.
Syntax      : Keyword must not contain any special characters.
Note        : Must be first statement in a line.
See Also    : goto, gosub, return.
Example:
              :loop
              gosub bravo
              print &quot;The time is &quot;,$time(),&quot;\n&quot;
              sleep 1
              goto loop
              label bravo
              print &quot;Twonk!\n&quot;
              return
<div class="Pp"></div>
Command     : abort
Description : Causes comgt to call abort() and produce a core dump.
Syntax      : abort
See Also    : dump, exit.
<div class="Pp"></div>
<div class="Pp"></div>
Command     : cd
Description : Change directory.
Syntax      : cd directory
Notes       : -1 is returned in % if the change could not be made.
Notes       : directory is a string and thus could be a variable.
See Also    : $cwd().
Example:
              cd &quot;duh&quot;
              if % != 0 print &quot;Could not cd into duh.\n&quot;
<div class="Pp"></div>
<div class="Pp"></div>
Command     : close
Description : closes file previously opened with open.
Syntax      : close file
See Also    : open.
<div class="Pp"></div>
<div class="Pp"></div>
Command     : dec
Description : Decrements the content of an integer variable by 1.
Syntax      : dec x
Notes       : x is from a to z or a0 to z9.
Notes       : Note that &quot;let x=x-1&quot; also works.
See Also    : let, inc.
<div class="Pp"></div>
<div class="Pp"></div>
Command     : dump
Description : Lists all non-zero integer variables and modified string
Description : variables as log entries (standard error channel.)
Syntax      : dump
See Also    : abort, exit
<div class="Pp"></div>
<div class="Pp"></div>
Command     : else
Description : Alternatively execute commands if last &quot;if&quot; tested false.
Syntax      : else commands...
See Also    : if
Example:
              if w&lt;350 print &quot;Wow! Imagine that.\n&quot;
              else print &quot;Rush Limbaugh is a big fat bastard.\n&quot;
<div class="Pp"></div>
<div class="Pp"></div>
Command     : eprint
Description : print a comma-separated list of arguments on stderr.
Syntax      : eprint var,stringvar,&quot;text&quot;,...
Notes       : Like print but on the standard error file descriptor.  
Notes       : The error output can be re-directed with &quot;2&gt;file&quot; on 
Notes       : the command line.
See Also    : print.
<div class="Pp"></div>
<div class="Pp"></div>
Command     : exec
Description : Replaces current comgt process with another process.
Syntax      : exec &quot;command -args...&quot;
See Also    : system, fork.
Example:
              #Finished script, call cu.
              exec &quot;cu -l &quot;+$dev()+&quot; -s &quot;+$baud()
<div class="Pp"></div>
<div class="Pp"></div>
Command     : exit
Description : terminates script execution with exit code.
Syntax      : exit exit_code
See Also    : abort, dump.
Example:
              :error
              exit 1
              :smeggit
              exit 0
<div class="Pp"></div>
<div class="Pp"></div>
Command     : flash
Description : Toggles DTR on communication device for a specified time.
Syntax      : flash float_constant
Notes       : float_constant is precise down to 1/100th sec.
Notes       : Causes modem to drop carrier or go to command mode, 
Notes       : depending on modem settings.  Setting the baud rate to 0 
Notes       : for a time has the same effect.
See Also    : sleep, set com.
Example:
              :disconnect
              flash 0.5
              exit 0
<div class="Pp"></div>
<div class="Pp"></div>
Command     : fprint
Description : print a comma-separated list of arguments in a file.
Syntax      : fprint var,stringvar,&quot;text&quot;,...
Notes       : Like print but appended to a file previously opened 
Notes       : by open.
See Also    : print.
<div class="Pp"></div>
<div class="Pp"></div>
Command     : fork
Description : forks comgt process in two.  Both processes continue 
Description : executing the script.
Syntax      : fork
Notes       : % returns 0 for child process, new process ID for 
Notes       : parent or -1 for error.
See Also    : wait, kill, pid(), ppid().
Example:
              fork
              if % = -1 goto error
              if % = 0 goto child
              :parent
              ...
<div class="Pp"></div>
Command     : get
Description : get string from communication device.
Syntax      : get timeout &quot;terminators&quot; $string
Notes       : timeout is a float constant, terminators is a 
Notes       : list of characters that, when received, terminate 
Notes       : get.  Terminators are ignored when received first.
See Also    : waitfor.
Example:
              waitfor 60 &quot;connect&quot;
              if % != 0 goto error
              get 2 &quot; ^m&quot; $s
              print &quot;Connection parameters: &quot;,$s,&quot;\n&quot;
<div class="Pp"></div>
<div class="Pp"></div>
Command     : gosub
Description : calls a subroutine.
Syntax      : gosub label
Notes       : Currently, comgt only supports 128 levels of gosub 
Notes       : calls (enough!)
See Also    : :, goto, return.
Example:
              gosub routine
              sleep 1
              gosub routine
              goto end
              :routine
              print &quot;Flim-flam!\n&quot;
              return
<div class="Pp"></div>
<div class="Pp"></div>
Command     : goto
Description : Sends execution somewhere else in the script.
Syntax      : goto label
See Also    : :, gosub, return.
Example:
              :win95
              print &quot;Today I want to go and use Linux, thank you.\n&quot;
              goto win95
<div class="Pp"></div>
<div class="Pp"></div>
Command     : hset
Description : Set the hundreds timer.
Syntax      : hset value
Notes       : This command resets the hundreds of seconds timer to 
Notes       : a value for htime to start from.
See Also    : htime().
Example:
              hset 0
              :loop
              print &quot;Time in 1/100 of a sec.: &quot;,htime(),&quot;\n&quot;
              sleep 0.01
              goto loop
<div class="Pp"></div>
<div class="Pp"></div>
Command     : if
Description : tests a condition
Syntax      : if test_condition commands...
Notes       : Conditionnaly executes commands if test condition is true.
Notes       : Test operators are = (equal), != (not equal), 
Notes       : &lt;&gt; (not equal to) &lt; (less than), &gt; (greater than), 
Notes       : &lt;= (less or equal), &gt;= (greater or equal).  
Notes       : All operators can be used with integers and strings.  
Notes       : If test_condition is false, if skips to
Notes       : the next line.
See Also    : else.
Example:
              if n&gt;30 print &quot;Oh-ho! too many sheep!\n&quot; goto error
              if n=17 print &quot;Hurray! we&#x00B4;ve enough sheep\n&quot; goto party
              if n&lt;17 print &quot;Murray, get more sheep.\n&quot; goto getmore
              if $z &lt; &quot;Marmaluke&quot; goto ...
              if 3*a&gt;5+b goto ...
<div class="Pp"></div>
<div class="Pp"></div>
Command     : inc
Description : increments the content of an integer variable by 1.
Syntax      : inc x
Notes       : x is a-z or a0-z9.
See Also    : dec, let.
<div class="Pp"></div>
<div class="Pp"></div>
Command     : input
Description : input string from keyboard into string variable.
Syntax      : input $x
Notes       : input terminates entry only with the ENTER key.  
Notes       : Spaces, tabs and other funny characters are all 
Notes       : stored in the variable.
See Also    : set echo.
Example:
              print &quot;Enter your full name :&quot;
              input $n4
<div class="Pp"></div>
<div class="Pp"></div>
Command     : kill
Description : Sends a signal to a process.
Syntax      : kill signal processID
Notes       : Both signal and processID are integer values.  Same as 
Notes       : standard unix kill except that signal aliases are not 
Notes       : accepted and signal is not optional.
Notes       : 0 is returned in % if the signal could be sent, -1 
Notes       : otherwise.
Notes       : Signal 0 can be used to detect process existance.
See Also    : wait, pid(), ppid().
Example:
              fork
              let p=%
              if p = 0 goto child
              sleep 300
              kill 15 p
              sleep 1
              kill 0 p
              if % != 0 print &quot;Child terminated\n&quot; goto ok
              print &quot;Could not terminate child!\n&quot;
              kill 9 p
              sleep 1
              kill 0 p
              if % = 0 print &quot;Could not kill child!\n&quot; goto error
              print &quot;Child killed.\n&quot;
              :ok
              ...
<div class="Pp"></div>
<div class="Pp"></div>
Command     : let
Description : Does a variable assignment.
Syntax      : let x=content
Notes       : x is [$]a0-z9.
See Also    : inc, dec.
Example:
              let a=5
              let b=(time()-a)+5
              let y7=6809
              let z=0%11010111  #Binary
              let z=077324      #octal
              let z=0xf5b8      #hexadecimal
              let $c=&quot;Daniel &quot;
              let $d=$c+&quot; Chouinard&quot;
              let $s5=&quot;Frimpin&#x00B4; Jeosaphat!&quot;
<div class="Pp"></div>
<div class="Pp"></div>
Command     : lprint
Description : Print a comma-separated list of arguments to the log.
Syntax      : fprint var,stringvar,&quot;text&quot;,...
Notes       : Like print but printed like a log entry if verbose is on.
Notes       : logging is sent to stderr.
See Also    : print, eprint, fprint.
<div class="Pp"></div>
<div class="Pp"></div>
Command     : open
Description : Opens a file or a communication device.
Syntax      : open com device, open com (stdin), open file FILE
See Also    : close.
Example:
              open com /dev/cua1
              set com 38400n81
              open file &quot;/tmp/log&quot;
              fprintf &quot;This is a log\n&quot;
              close file
<div class="Pp"></div>
<div class="Pp"></div>
Command     : print
Description : print a comma-separated list of arguments.
Syntax      : print var,stringvar,&quot;text&quot;,...
Notes       : Spaces and newlines are not automatically added.
See Also    : eprint, fprint, lprint.
Example:
              let b=26
              let $c=&quot;text variables&quot;
              print &quot;Contstant text &quot;,b,&quot; &quot;,$c,&quot; time: &quot;,$time(),&quot;\n&quot;
<div class="Pp"></div>
<div class="Pp"></div>
Command     : putenv
Description : Sets an environment variable.
Syntax      : putenv &quot;var=content&quot;
Notes       : Environment variables are automatically exported, 
Notes       : never returned. Children processes inherit the 
Notes       : environment.
See Also    : $env().
Example:
              putenv &quot;SCRIPTDIR=/usr/lib/comgt/scripts&quot;
              system &quot;dothat&quot;  # dothat reads env. var. SCRIPTDIR...
<div class="Pp"></div>
<div class="Pp"></div>
Command     : rem  Aliases: #, //
Description : Remark.  Rest of line is ignored.
Syntax      : Note that a space must follow &quot;rem&quot;.
Example:
              #This is a remark
              // So is this
              rem This ain&#x00B4;t no disco.
<div class="Pp"></div>
<div class="Pp"></div>
Command     : return
Description : Returns from subroutine.
Syntax      : return
See Also    : gosub.
<div class="Pp"></div>
<div class="Pp"></div>
Command     : send
Description : sends a string to the communication line (modem usually).
Syntax      : send string
Notes       : Carriage return (ENTER) is not sent automatically 
Notes       : (use ^m).
Example:
              send &quot;atdt555-1212^m&quot;
              send $g+&quot;^m&quot;
              send &quot;The time is &quot;+$time()+&quot;^m^j&quot;
<div class="Pp"></div>
<div class="Pp"></div>
Command     : set
Description : sets working parameters.
Syntax      : set parameter value
Notes       :
<div class="Pp"></div>
Command                       Description
----------------------------- -------------------------------------------------
set echo on|off               Keyboard echo on-screen.
set comecho on|off            Received characters echoed on-screen.
set senddelay time_constant   In-between character delay for &quot;send&quot;
set ignorecase on|off         Case sensitivity for &quot;waitfor&quot;. 
                              Default=on.
set clocal on|off             clocal on = ignore modem signals
set umask mode                file mode creation defaults. 
                              See man umask.
set verbose on|off            verbose on = debug output enabled.
set com com_params            communication parameters. 
                                   ex.: 19200n81, 300e71
                                             baud |||
                                           Parity    |
                                        Data bits     |
                                        Stop bits      |
<div class="Pp"></div>
Example:
              set echo off
              print &quot;Password :&quot;
              input $p
              print &quot;\n&quot;
              set echo on
              set comecho on
              set clocal on
              set senddelay 0.1
              set ignorecase on
              set com 38400n81
              set umask 022 # Must be octal (leading zero)
              ...
<div class="Pp"></div>
Note on clocal:
  If want your script to keep working after the carrier detect 
  signal has dropped, set clocal on, otherwise, a CD drop causes 
  the device line to close (hang up).  This could happen if, 
  let&#x00B4;s say, your script calls and connects, then disconnects or 
  drops dtr (flash), then tries to re-connect again.
<div class="Pp"></div>
<div class="Pp"></div>
Command     : sleep
Description : Pauses execution.
Syntax      : sleep float_constant
Notes       : Float_constant is precise down to 1/100th sec, unless
Notes       : more than 100 seconds, in which case the precision 
Notes       : falls down to 1 sec.
<div class="Pp"></div>
Example:
              sleep 0.06
              sleep 3
              sleep 86400 /* A whole day */
<div class="Pp"></div>
<div class="Pp"></div>
Command     : system
Description : Calls a system (unix) command
Syntax      : system &quot;command&quot;
See Also    : exec.
Example:
              :dir
              print &quot;listing of directory &quot;,$cwd(),\n&quot;
              system &quot;ls -l |more&quot;
<div class="Pp"></div>
<div class="Pp"></div>
Command     : testkey
Description : Tests keyboard for keystroke, returns 1 in % if present.
Syntax      : testkey
Notes       : Can only test for ENTER key.  Future versions of comgt 
Notes       : will test for more and return keycodes in %.
See Also    : input.
Example:
              let n=1
              :loop
              print n,&quot; sheep... ZZZzzz...\n&quot;
              sleep n
              inc n
              testkey
              if % = 0 goto loop
<div class="Pp"></div>
<div class="Pp"></div>
Command     : wait
Description : Wait for a child process to terminate.
Syntax      : wait
Notes       : Process ID of terminated child is returned in %
See Also    : fork, kill.
Example:
              fork
              let p=%
              if p=0 goto child
              if p=-1 goto error
              print &quot;Waiting for child to finish...&quot;
              wait
              print &quot;\n&quot;
              if %!=p print &quot;Wait got wrong PID!\n&quot; goto error
              print &quot;Child is done.\n&quot;
<div class="Pp"></div>
<div class="Pp"></div>
Command     : waitfor
Description : Waits until one of a list of strings is received
Syntax      : waitfor timeout &quot;string1&quot;,&quot;string2&quot;,&quot;string3&quot;...
Notes       : Timeout is a floating time constant.  waitquiet returns
Notes       : 0 for the first string received, 1 for the second, etc...
Notes       : and -1 for a timeout.  Case is ignored by default unless
Notes       : ignorecase is set to off.
See Also    : get.
Example:
              :dial
              send &quot;atdt555-4411^m&quot;
              waitfor 60 &quot;no carrier&quot;,&quot;busy&quot;,&quot;no dial tone&quot;,&quot;connect&quot;
              if % = -1 goto timedout
              if % = 0 goto nocd
              if % = 1 goto redial
              if % = 2 goto error
              if % = 3 goto connected
<div class="Pp"></div>
<div class="Pp"></div>
Command     : waitquiet
Description : Waits until communication line stops receiving for a time.
Syntax      : waitquiet timeout quiettime
Notes       : Both timeout and quiettime are floating time constants
Notes       : with 1/100th sec. accuracy.  Usefull for &quot;swallowing&quot; 
Notes       : incoming characters for a while or waiting for an 
Notes       : unknown prompt.
Example:
              :closecon
              send &quot;logoff^m&quot;
              waitquiet 10 0.5
              send &quot;yes^m&quot;
</pre>
<h2 class="Ss" title="Ss" id="Integer_functions"><a class="selflink" href="#Integer_functions">Integer
  functions</a></h2>
<pre>
I-Function  : Access
Description : Verifies access rights to a file
Syntax      : let x=access(&quot;/tmp/file&quot;,&quot;frwx&quot;)
Notes       : The second string contains one or more of 
Notes       : &#x00B4;f&#x00B4;,&#x00B4;r&#x00B4;,&#x00B4;w&#x00B4;,&#x00B4;x&#x00B4; to repectively check 
Notes       : existence, read, write and execute permissions.  
Notes       : Under root id, the only useful check is &#x00B4;f&#x00B4;, as
Notes       : all others will return true.
Return Value: 0 if the file exists, is readable, writable, 
Return Value: executable, or -1 if not.
See Also    : man access(2)
<div class="Pp"></div>
I-Function  : baud
Description : Returns current baudrate of communication line.
Syntax      : let x=baud()
Notes       : Does not necessarily match the modem connection speed.
See Also    : $baud().
<div class="Pp"></div>
I-Function  : len
Description : Returns the length of a string.
Syntax      : let x=len($s)
Notes       : &quot;&quot; is zero.  Strings currently have a maximum length of
Notes       : 1024 characters. comgt doesn&#x00B4;t handle string overflow 
Notes       : at all.
<div class="Pp"></div>
I-Function  : htime
Description : Returns hundreds of seconds since start of script.
Syntax      : let x=htime()
Notes       : Set to a specific value with hset.
See Also    : hset.
<div class="Pp"></div>
I-Function  : pid
Description : Returns process ID number of current process (comgt)
Syntax      : let x=pid()
See Also    : ppid(), fork
<div class="Pp"></div>
I-Function  : ppid
Description : Returns process ID number of parent process.
Syntax      : let x=ppid()
Notes       : Can be used by forked child to detect parent 
Notes       : process.
<div class="Pp"></div>
I-Function  : time
Description : Returns time in seconds since Jan 1, 00:00:00 1970 GMT.
Syntax      : let x=time()
Notes       : Used to calculate time differences.
See Also    : $time()
<div class="Pp"></div>
<div class="Pp"></div>
I-Function  : val
Description : Returns value of string.
Syntax      : let x=val($x)
Notes       : String is not an expression; must only contain [0-9]
Notes       : characters. Future versions of comgt will be able to 
Notes       : evaluate expressions. (Maybe) (This was written 6 
Notes       : years ago.)
<div class="Pp"></div>
<div class="Pp"></div>
I-Function  : verbose
Description : Returns value of verbose setting.
Syntax      : let x=verbose()
Notes       : 0=off, 1=on.
</pre>
<h2 class="Ss" title="Ss" id="String_functions"><a class="selflink" href="#String_functions">String
  functions</a></h2>
<pre>
S-Function  : basename
Description : Returns basename part of path.
Syntax      : let $x=$basename($p)
Notes       : $basename(&quot;/usr/bin/more&quot;)=&quot;more&quot;
See Also    : $dirname().
<div class="Pp"></div>
S-Function  : baud
Description : Returns string representation of current baud rate.
Syntax      : let $x=$baud()
Notes       : Defined by &quot;set com&quot;
See Also    : baud(), set com.
<div class="Pp"></div>
S-Function  : cwd
Description : Returns current working directory pathname.
Syntax      : let $x=$cwd()
See Also    : cd.
<div class="Pp"></div>
S-Function  : dev
Description : Returns current communication device pathname.
Syntax      : let $x=$dev()
Notes       : defined by &quot;-d&quot; command line argument or &quot;open com&quot;
See Also    : open com.
<div class="Pp"></div>
S-Function  : dirname
Description : Returns directory name part of path.
Syntax      : let $x=$dirname($p)
Notes       : $dirname(&quot;/usr/bin/more&quot;)=&quot;/usr/bin&quot;
See Also    : $basename().
<div class="Pp"></div>
S-Function  : env
Description : Returns content of an environment variable
Syntax      : let $x=$env(&quot;HOME&quot;)
Notes       : Non-existant variables return an empty string.
See Also    : putenv.
<div class="Pp"></div>
S-Function  : hex
Description : Converts value to hexadecimal representation
Syntax      : let $x=$hex(x)
Notes       : Letters a-f in lowercase, no preceding &quot;0x&quot;
See Also    : $hexu(), $oct().
<div class="Pp"></div>
S-Function  : hexu
Description : Converts value to hexadecimal representation
Syntax      : let $x=$hex(x)
Notes       : Letters A-F in uppercase, no preceding &quot;0x&quot;
See Also    : $hex(), $oct().
<div class="Pp"></div>
S-Function  : hms
Description : Converts number of seconds into time string
Syntax      : let $x=$hms(x)
Notes       : Format is &quot;HH:MM:SS&quot;.  Useful for chronometer displays
Notes       : Use with &quot;time()&quot;, do not try to increment a variable 
Notes       : every second using &quot;sleep 1&quot;.  (See ISP script example)
Notes       : Format becomes &quot;HHH:MM:SS&quot; after 99 hours, 59 minutes, 
Notes       : 59s...
See Also    : time().
<div class="Pp"></div>
S-Function  : left
Description : Returns left portion of a string
Syntax      : let $x=$left($s,l)
Notes       : $s=Source string, l=length
Notes       : l must be less than the length of the string.
See Also    : $right(), $mid().
<div class="Pp"></div>
S-Function  : mid
Description : Returns midsection of a string.
Syntax      : let $x=$mid($s,s,l)
Notes       : $s=Source string, s=start, l=length
Notes       : s must be less than the length of the string, l can be
Notes       : some huge number (9999) to return the right side of a 
Notes       : string to the end.  the first character of a string is 
Notes       : position 0, not 1.
See Also    : $right(), $left().
<div class="Pp"></div>
S-Function  : oct
Description : Converts value to octal representation.
Syntax      : let $x=$oct(x)
See Also    : $hex(), $hexu().
<div class="Pp"></div>
S-Function  : right
Description : Returns right portion of a string.
Syntax      : let $x=$right($s,l)
Notes       : $s=Source string, l=length
Notes       : l must be less than the length of the string.
See Also    : $left(), $mid().
<div class="Pp"></div>
S-Function  : rpipe
Description : Returns the first line from a system piped command
Syntax      : let $x=$rpipe(&quot;/bin/ls |grep myfile&quot;)
Notes       : Not very useful unless used with head, tail, grep, 
Notes       : etc...
See Also    : system.
<div class="Pp"></div>
S-Function  : time
Description : Returns 24 character local time string
Syntax      : let $x=$time()
See Also    : time().
Notes       : Time is in this format: Mon Apr  8 14:21:22 1996
                                      012345678901234567890123
                                                1         2
<div class="Pp"></div>
S-Function  : tolower
Description : Returns lowercase&#x00B4;d string.
Syntax      : let $x=$tolower($y)
<div class="Pp"></div>
S-Function  : toupper
Description : Returns uppercase&#x00B4;d string.
Syntax      : let $x=$toupper($y)
</pre>
<h2 class="Ss" title="Ss" id="Test_operators"><a class="selflink" href="#Test_operators">Test
  operators</a></h2>
<pre>
Operator Description       Example       Result
=        equal             if 1+2=3      yes
!=       not equal         if 1+2!=3     no
&lt;&gt;       not equal         if 1+2&lt;&gt;3     no
&gt;        Greater than      if 1+3&gt;3      yes
&lt;        Less than         if 1+3&lt;3      no
&gt;=       Greater or equal  if 3&gt;=3       yes
&lt;=       Greater or equal  if 2&lt;=3       yes
</pre>
<div class="Pp"></div>
<pre>
Strings can be compared using the same operators.
</pre>
<div class="Pp"></div>
<pre>
&quot;aaa&quot; &lt; &quot;aab&quot;,  &quot;aaaa&quot; &gt; &quot;aaa&quot;, &quot;Test&quot; != &quot;test&quot;, &quot;One&quot; = &quot;One&quot;, 
&quot;A&quot; &gt; &quot;a&quot;, &quot;Fumble&quot; &lt;= &quot;Fumigate&quot;, &quot;Farsical&quot; &lt;&gt; &quot;Comedic&quot;
</pre>
<div class="Pp"></div>
<b>Note</b> that &quot;set ignorecase on&quot; does NOT apply to string
  comparisons.
<h2 class="Ss" title="Ss" id="Expression_operators"><a class="selflink" href="#Expression_operators">Expression
  operators</a></h2>
<pre>
Operator  Description      Example           Result
+         Addition         let a=2+2         4
+         Concatenation    let $b=&quot;aa&quot;+&quot;bb&quot;  &quot;aabb&quot;
-         Substraction     let e=2-5         -3
*         Multiplication   let f=11*2        22
/         Division         let g=34/11       3
&amp;         Bit-Wise AND     let h=42&amp;7        2
|         Bit-Wise OR      let a=42|5        47
^         Bit-Wise XOR     let a=42^7        45
</pre>
<div class="Pp"></div>
Mixed expression examples:
<div class="Pp"></div>
<pre>
#Returns number of seconds since 00:00:00
let $t=$time() #Take a snapshot.
let a=(val(mid$($t,11,2))*3600)+(val(mid$($t,14,2))*60)+val(mid$($t,17,2))
#Notice the extra sets of parenthesis because comgt&#x00B4;s expression 
#evaluator is brain-dead.
#For example, 5-2+1 should give you 4, right?  Well, according to 
#getvalue(), it actually gives 2, because it does it somewhat from 
#right to left.
#So to evaluate 5-2+1 correctly, use (5-2)+1.  If you&#x00B4;re using 
#simple, two-element calculations, don&#x00B4;t worry about it.  
#5-2 will give you 3.
</pre>
<div class="Pp"></div>
<pre>
#Concatenation  (Calls cu)
exec &quot;cu -l &quot;+$dev()+&quot; -s &quot;+$baud()&quot;
</pre>
<div class="Pp"></div>
<pre>
#In a test condition
if a+c &gt; strlen($c) goto toomuch
</pre>
<div class="Pp"></div>
<pre>
#String comparison
let $t=$mid($time(),11,8)
if $t &gt; &quot;19:59:59&quot; print &quot;Too late for that!\n&quot; goto toolate
if $t &lt; &quot;08:00:00&quot; print &quot;Too early!\n&quot; goto tooearly
if $t = &quot;00:00:00&quot; print &quot;Oh god!  It&#x00B4;s Twinkee time!\n&quot;
</pre>
<h1 class="Sh" title="Sh" id="KNOWN_FEATURES"><a class="selflink" href="#KNOWN_FEATURES">KNOWN
  FEATURES</a></h1>
The getvalue() parser. It makes me laugh so I think I&#x00B4;ll leave it that
  way. - Daniel.Chouinard@pwc.utc.com
<h1 class="Sh" title="Sh" id="ENVIRONMENT_VARIABLES"><a class="selflink" href="#ENVIRONMENT_VARIABLES">ENVIRONMENT
  VARIABLES</a></h1>
COMGTPIN - the 4 digit pin of the SIM for use by PIN script COMGTAPN - the APN
  to write to the data card, used by the APN script.
<h1 class="Sh" title="Sh" id="AUTHORS"><a class="selflink" href="#AUTHORS">AUTHORS</a></h1>
Daniel.Chouinard &lt;Daniel.Chouinard@pwc.utc.com&gt; wrote the original
  <b>dcon</b> utility.
<div class="Pp"></div>
Paul Hardwick &lt;paul@peck.org.uk&gt; updated it for the latest compilers,
  provided the built-in script functionality and tested it against GPRS and 3G
  datacards.
<div class="Pp"></div>
Martin Gregorie &lt;martin@gregorie.org&gt; wrote the original manpage for
  <b>comgt</b> from the <b>dcon</b> documentation and packaged <b>comgt</b> for
  distribution.
<h2 class="Ss" title="Ss" id="History"><a class="selflink" href="#History">History</a></h2>
Daniel Chouinard wrote most (90%) of <b>dcon</b> back in 1989 when he started
  doing Unix Apps tech support mostly by modem to customer systems. He was tired
  of typing all those passwords and funny call-charging codes everytime he used
  cu. Also, the company he worked for needed a system that would log call times
  and estimated costs. Thus <b>dcon</b> was born. Six or seven years later
  (1996) and he was using pppd to connect to his ISP site. He was more or less
  happy with <b>chat</b> but found it lacked flow control and multiple response
  checks from &quot;atdt...&quot;. He wanted it to do different things for
  &quot;no carrier&quot;, &quot;no dial tone&quot;, and &quot;busy&quot;.
  Although he thought that <b>chat</b> would probably be enhanced someday, when
  he found dcon.c on one of his old 45M tapes he tried compiling it on his Linux
  box and, lo and behold, it did. In the end, he added a few things to it (kill,
  fork, wait, 1/100 sec. times) and left it at that.
<div class="Pp"></div>
A couple of years ago Paul Hardwick found the program, <b>dcon 0.97,</b> last
  modified in 1996. The purpose of this program was to run scripts that would
  control Linux serial ports. The implementation was very similar to something
  he had written for Windows. Anyway, rather than reinvent he contacted the
  author, Daniel Chouinard, and asked his permission to reuse the code. Happily
  he gave permission and a basic but useful utility called <b>comgt</b> was
  created. Paul takes no credit for the engine, apart from making it compatible
  with todays compilers. It is basically <b>dcon</b> repackaged.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">20 October, 2006</td>
    <td class="foot-os"></td>
  </tr>
</table>
</body>
</html>
