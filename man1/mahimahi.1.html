<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>MAHIMAHI(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">MAHIMAHI(1)</td>
    <td class="head-vol">General Commands Manual</td>
    <td class="head-rtitle">MAHIMAHI(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
<b>mahimahi</b> - lightweight, composable network-emulation tools
<div style="height: 1.00em;">&#x00A0;</div>
link emulation: <b>mm-delay</b>, <b>mm-loss</b>, <b>mm-onoff</b>, <b>mm-link</b>
<div style="height: 1.00em;">&#x00A0;</div>
analysis scripts: <b>mm-throughput-graph</b>, <b>mm-delay-graph</b>
<div style="height: 1.00em;">&#x00A0;</div>
observation: <b>mm-meter</b>
<div style="height: 1.00em;">&#x00A0;</div>
record and replay multi-origin websites: <b>mm-webrecord</b>,
  <b>mm-webreplay</b>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<b>mahimahi</b> is a suite of user-space tools for network emulation and
  analysis.
<div style="height: 1.00em;">&#x00A0;</div>
Each mahimahi tool spawns a lightweight container, generally connected to the
  outside via a synthetic network device that observes packets in transit or
  emulates a desired behavior.
<div style="height: 1.00em;">&#x00A0;</div>
The tools are composable so that a series of emulated network effects can be
  chained together, with mahimahi containers nested inside each other. Each tool
  takes an optional command to execute, so it is possible to create a series of
  nested containers with one command line.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="LINK_EMULATION_TOOLS"><a class="selflink" href="#LINK_EMULATION_TOOLS">LINK
  EMULATION TOOLS</a></h1>
<i>delay</i> [<i>command...</i>]
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 5.00ex;">Every packet is delayed by the specified
  <i>delay</i> (in milliseconds) entering and leaving the container.</div>
<div style="height: 1.00em;">&#x00A0;</div>
uplink|downlink <i>rate</i> [<i>command...</i>]
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
Packets are lost at the given <i>rate</i> either when leaving (uplink) or
  entering (downlink) the container. <i>rate</i> is a number between 0 and
  1.</div>
<div style="height: 1.00em;">&#x00A0;</div>
uplink|downlink <i>mean-on-time</i> <i>mean-off-time</i> [<i>command...</i>]
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
The uplink or downlink will be intermittent and will switch between connected
  and disconnected states according to a Poisson point process with specified
  average durations spent &quot;on&quot; and &quot;off&quot;.</div>
<div style="height: 1.00em;">&#x00A0;</div>
[<span class="Op"><b>--uplink-log=<i>filename</i></b>]</span>
  [<span class="Op"><b>--downlink-log=<i>filename</i></b>]</span>
  [<span class="Op"><b>--meter-uplink</b>]</span>
  [<span class="Op"><b>--meter-uplink-delay</b>]</span>
  [<span class="Op"><b>--meter-downlink</b>]</span>
  [<span class="Op"><b>--meter-downlink-delay</b>]</span>
  [<span class="Op"><b>--once</b>]</span> <i>uplink-filename</i>
  <i>downlink-filename</i> [<i>command...</i>]
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
Emulates a throughput-limited link with a specified packet-delivery schedule and
  analyzes the resulting performance. See <b>mm-link</b>(1).</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="OBSERVATION_TOOLS"><a class="selflink" href="#OBSERVATION_TOOLS">OBSERVATION
  TOOLS</a></h1>
[<span class="Op"><b>--meter-uplink</b>]</span>
  [<span class="Op"><b>--meter-downlink</b>]</span> [<i>command...</i>]
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
Displays an animated live plot of the transfer rate entering or leaving the
  container.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="RECORD_AND_REPLAY_WEBSITES"><a class="selflink" href="#RECORD_AND_REPLAY_WEBSITES">RECORD
  AND REPLAY WEBSITES</a></h1>
<i>directory</i> [<i>command...</i>]
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
Transparently proxies outgoing HTTP and HTTPS connections, saving the requests,
  corresponding responses, and IP address of each Web server contacted in the
  given <i>directory</i>. <b>mm-webrecord</b> uses a self-signed TLS certificate
  in its HTTPS proxy, causing typical Web browsers to reject it. For testing or
  debugging purposes, this behavior can usually be turned off, e.g.: with the
  <b>--no-check-certificate</b> option to <b>wget</b>(1) or the
  <b>--ignore-certificate-errors</b> option to <b>chromium-browser</b>(1).</div>
<div style="height: 1.00em;">&#x00A0;</div>
<i>directory</i> [<i>command...</i>]
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
Replays a saved session from a previous run of <b>mm-webrecord</b>. Unlike most
  mahimahi tools, the <b>mm-webreplay</b> container does not have a network
  connection to the outside world. Instead, it has dummy network interfaces
  bound to each IP address on which a Web server in the saved session had
  answered a request. <b>mm-webreplay</b> runs an <b>apache2</b>(8) Web server
  bound to each such IP address inside the container. Each Web server emulates
  the corresponding server from the saved session. When receiving a request that
  matches one in the <i>directory</i>, the corresponding apache2 replies with
  the same reply as previously captured.
<div style="height: 1.00em;">&#x00A0;</div>
<b>mm-webreplay</b> can be used to measure the performance of Web browsers on
  complex websites and the effect of changes in Web protocols (e.g. HTTP,
  HTTP/2, SPDY, QUIC). Unlike tools like web-page-replay, <b>mm-webreplay</b>
  preserves the sharded structure of a website, binds to the actual IP addresses
  that the real website used, and serves requests from real Web servers.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="ENVIRONMENT"><a class="selflink" href="#ENVIRONMENT">ENVIRONMENT</a></h1>
The MAHIMAHI_BASE environment variable is set to an IP address of the host,
  outside any container. This can be used to conduct scripted measurements over
  a series of mahimahi containers chained together.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
To spawn a shell with a delayed, lossy link to the Internet:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 5.00ex;">
<pre>
<b>$</b> mm-delay 50 mm-loss uplink 0.2
<b>[delay 50 ms] [loss up=0.1] $</b>
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
To run ping over the same link:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 5.00ex;">
<pre>
<b>$</b> mm-delay 50 mm-loss uplink 0.2 sh -c 'ping -c 10 -n $MAHIMAHI_BASE'
PING 100.64.0.1 (100.64.0.1) 56(84) bytes of data.
64 bytes from 100.64.0.1: icmp_seq=1 ttl=63 time=101 ms
64 bytes from 100.64.0.1: icmp_seq=2 ttl=63 time=100 ms
64 bytes from 100.64.0.1: icmp_seq=4 ttl=63 time=101 ms
64 bytes from 100.64.0.1: icmp_seq=5 ttl=63 time=100 ms
64 bytes from 100.64.0.1: icmp_seq=7 ttl=63 time=101 ms
64 bytes from 100.64.0.1: icmp_seq=8 ttl=63 time=101 ms
64 bytes from 100.64.0.1: icmp_seq=9 ttl=63 time=101 ms
64 bytes from 100.64.0.1: icmp_seq=10 ttl=63 time=101 ms
<div class="Pp"></div>
--- 100.64.0.1 ping statistics ---
10 packets transmitted, 8 received, 20% packet loss, time 8999ms
rtt min/avg/max/mdev = 100.910/101.009/101.092/0.279 ms
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
To record a page load from <i>www.nytimes.com</i>:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 5.00ex;">
<pre>
<b>$</b> mm-webrecord /tmp/nytimes chromium-browser --ignore-certificate-errors --user-data-dir=/tmp/nonexistent$(date +%s%N) www.nytimes.com
</pre>
<div style="height: 1.00em;">&#x00A0;</div>
The use of <i>--user-data-dir=/tmp/nonexistent$(date +%s%N)</i> is to prevent
  the browser from reusing an existing chromium-browser process.</div>
<div style="height: 1.00em;">&#x00A0;</div>
To make Chrome retrieve the saved website over a delayed, lossy link whose
  throughput is limited to 1 full-sized packet per millisecond:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 5.00ex;">
<pre>
<b>$</b> mm-webreplay /tmp/nytimes mm-delay 50 mm-loss uplink 0.1 mm-link &lt;(echo 1) &lt;(echo 1) -- chromium-browser --ignore-certificate-errors --user-data-dir=/tmp/nonexistent$(date +%s%N) www.nytimes.com
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
To emulate a variable cellular network and visualize a process's use of the
  network:
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">
  <div class="Pp"></div>
  </dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 5.00ex;">
<pre>
<b>$</b> mm-delay 20 mm-link --meter-all /usr/share/mahimahi/traces/Verizon-LTE-short.up /usr/share/mahimahi/traces/Verizon-LTE-short.down
<b>[delay 20 ms] [link] $</b>
</pre>
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>mm-link</b>(1)
<div style="height: 1.00em;">&#x00A0;</div>
Project home page: <i>http://mahimahi.mit.edu</i>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Mahimahi was written by Ravi Netravali, Anirudh Sivaraman, Greg D. Hill, Deepak
  Narayanan, and Keith Winstein.
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
Please report bugs to <i>mahimahi@mit.edu</i>.</div>
<table class="foot">
  <tr>
    <td class="foot-date">March 2015</td>
    <td class="foot-os"></td>
  </tr>
</table>
</body>
</html>
