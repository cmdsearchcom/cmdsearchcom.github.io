<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:44:59 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>ZSHCONTRIB(1) General Commands Manual ZSHCONTRIB(1)</p>

<p style="margin-top: 1em">NAME <br>
zshcontrib - user contributions to zsh</p>

<p style="margin-top: 1em">DESCRIPTION <br>
The Zsh source distribution includes a number of items
contributed by the user community. These are not inherently
a part of the shell, and some may not be available in every
<br>
zsh installation. The most significant of these are
documented here. For documentation on other contributed
items such as shell functions, look for comments in the
function <br>
source files.</p>

<p style="margin-top: 1em">UTILITIES <br>
Accessing On-Line Help <br>
The key sequence ESC h is normally bound by ZLE to execute
the run-help widget (see zshzle(1)). This invokes the
run-help command with the command word from the current
input <br>
line as its argument. By default, run-help is an alias for
the man command, so this often fails when the command word
is a shell builtin or a user-defined function. By
redefin&acirc; <br>
ing the run-help alias, one can improve the on-line help
provided by the shell.</p>

<p style="margin-top: 1em">The helpfiles utility, found in
the Util directory of the distribution, is a Perl program
that can be used to process the zsh manual to produce a
separate help file for each <br>
shell builtin and for many other shell features as well. The
autoloadable run-help function, found in Functions/Misc,
searches for these helpfiles and performs several other <br>
tests to produce the most complete help possible for the
command.</p>

<p style="margin-top: 1em">There may already be a directory
of help files on your system; look in /usr/share/zsh or
/usr/local/share/zsh and subdirectories below those, or ask
your system administrator.</p>

<p style="margin-top: 1em">To create your own help files
with helpfiles, choose or create a directory where the
individual command help files will reside. For example, you
might choose ~/zsh_help. If you <br>
unpacked the zsh distribution in your home directory, you
would use the commands:</p>

<p style="margin-top: 1em">mkdir ~/zsh_help <br>
cd ~/zsh_help <br>
man zshall | colcrt - | perl ~/zsh-5.0.2/Util/helpfiles</p>

<p style="margin-top: 1em">Next, to use the run-help
function, you need to add lines something like the following
to your .zshrc or equivalent startup file:</p>

<p style="margin-top: 1em">unalias run-help <br>
autoload run-help <br>
HELPDIR=~/zsh_help</p>

<p style="margin-top: 1em">The HELPDIR parameter tells
run-help where to look for the help files. If your system
already has a help file directory installed, set HELPDIR to
the path of that directory <br>
instead.</p>

<p style="margin-top: 1em">Note that in order for
&lsquo;autoload run-help&rsquo; to work, the run-help file
must be in one of the directories named in your fpath array
(see zshparam(1)). This should already be the <br>
case if you have a standard zsh installation; if it is not,
copy Functions/Misc/run-help to an appropriate
directory.</p>

<p style="margin-top: 1em">Recompiling Functions <br>
If you frequently edit your zsh functions, or periodically
update your zsh installation to track the latest
developments, you may find that function digests compiled
with the <br>
zcompile builtin are frequently out of date with respect to
the function source files. This is not usually a problem,
because zsh always looks for the newest file when loading a
<br>
function, but it may cause slower shell startup and function
loading. Also, if a digest file is explicitly used as an
element of fpath, zsh won&rsquo;t check whether any of its
source <br>
files has changed.</p>

<p style="margin-top: 1em">The zrecompile autoloadable
function, found in Functions/Misc, can be used to keep
function digests up to date.</p>

<p style="margin-top: 1em">zrecompile [ -qt ] [ name ... ]
<br>
zrecompile [ -qt ] -p args [ -- args ... ] <br>
This tries to find *.zwc files and automatically re-compile
them if at least one of the original files is newer than the
compiled file. This works only if the names <br>
stored in the compiled files are full paths or are relative
to the directory that contains the .zwc file.</p>

<p style="margin-top: 1em">In the first form, each name is
the name of a compiled file or a directory containing *.zwc
files that should be checked. If no arguments are given, the
directories and <br>
*.zwc files in fpath are used.</p>

<p style="margin-top: 1em">When -t is given, no compilation
is performed, but a return status of zero (true) is set if
there are files that need to be re-compiled and non-zero
(false) otherwise. <br>
The -q option quiets the chatty output that describes what
zrecompile is doing.</p>

<p style="margin-top: 1em">Without the -t option, the
return status is zero if all files that needed
re-compilation could be compiled and non-zero if compilation
for at least one of the files <br>
failed.</p>

<p style="margin-top: 1em">If the -p option is given, the
args are interpreted as one or more sets of arguments for
zcompile, separated by &lsquo;--&rsquo;. For example:</p>

<p style="margin-top: 1em">zrecompile -p -R ~/.zshrc -- -M
~/.zcompdump -- ~/zsh/comp.zwc ~/zsh/Completion/*/_*</p>

<p style="margin-top: 1em">This compiles ~/.zshrc into
~/.zshrc.zwc if that doesn&rsquo;t exist or if it is older
than ~/.zshrc. The compiled file will be marked for reading
instead of mapping. The same <br>
is done for ~/.zcompdump and ~/.zcompdump.zwc, but this
compiled file is marked for mapping. The last line
re-creates the file ~/zsh/comp.zwc if any of the files
matching <br>
the given pattern is newer than it.</p>

<p style="margin-top: 1em">Without the -p option,
zrecompile does not create function digests that do not
already exist, nor does it add new functions to the
digest.</p>

<p style="margin-top: 1em">The following shell loop is an
example of a method for creating function digests for all
functions in your fpath, assuming that you have write
permission to the directories:</p>

<p style="margin-top: 1em">for ((i=1; i &lt;= $#fpath;
++i)); do <br>
dir=$fpath[i] <br>
zwc=${dir:t}.zwc <br>
if [[ $dir == (.|..) || $dir == (.|..)/* ]]; then <br>
continue <br>
fi <br>
files=($dir/*(N-.)) <br>
if [[ -w $dir:h &amp;&amp; -n $files ]]; then <br>
files=(${${(M)files%/*/*}#/}) <br>
if ( cd $dir:h &amp;&amp; <br>
zrecompile -p -U -z $zwc $files ); then <br>
fpath[i]=$fpath[i].zwc <br>
fi <br>
fi <br>
done</p>

<p style="margin-top: 1em">The -U and -z options are
appropriate for functions in the default zsh installation
fpath; you may need to use different options for your
personal function directories.</p>

<p style="margin-top: 1em">Once the digests have been
created and your fpath modified to refer to them, you can
keep them up to date by running zrecompile with no
arguments.</p>

<p style="margin-top: 1em">Keyboard Definition <br>
The large number of possible combinations of keyboards,
workstations, terminals, emulators, and window systems makes
it impossible for zsh to have built-in key bindings for
every <br>
situation. The zkbd utility, found in Functions/Misc, can
help you quickly create key bindings for your
configuration.</p>

<p style="margin-top: 1em">Run zkbd either as an autoloaded
function, or as a shell script:</p>

<p style="margin-top: 1em">zsh -f
~/zsh-5.0.2/Functions/Misc/zkbd</p>

<p style="margin-top: 1em">When you run zkbd, it first asks
you to enter your terminal type; if the default it offers is
correct, just press return. It then asks you to press a
number of different keys to <br>
determine characteristics of your keyboard and terminal;
zkbd warns you if it finds anything out of the ordinary,
such as a Delete key that sends neither ^H nor ^?.</p>

<p style="margin-top: 1em">The keystrokes read by zkbd are
recorded as a definition for an associative array named key,
written to a file in the subdirectory .zkbd within either
your HOME or ZDOTDIR direc&acirc; <br>
tory. The name of the file is composed from the TERM, VENDOR
and OSTYPE parameters, joined by hyphens.</p>

<p style="margin-top: 1em">You may read this file into your
.zshrc or another startup file with the &lsquo;source&rsquo;
or &lsquo;.&rsquo; commands, then reference the key
parameter in bindkey commands, like this:</p>

<p style="margin-top: 1em">source
${ZDOTDIR:-$HOME}/.zkbd/$TERM-$VENDOR-$OSTYPE <br>
[[ -n ${key[Left]} ]] &amp;&amp; bindkey
&quot;${key[Left]}&quot; backward-char <br>
[[ -n ${key[Right]} ]] &amp;&amp; bindkey
&quot;${key[Right]}&quot; forward-char <br>
# etc.</p>

<p style="margin-top: 1em">Note that in order for
&lsquo;autoload zkbd&rsquo; to work, the zkdb file must be
in one of the directories named in your fpath array (see
zshparam(1)). This should already be the case if <br>
you have a standard zsh installation; if it is not, copy
Functions/Misc/zkbd to an appropriate directory.</p>

<p style="margin-top: 1em">Dumping Shell State <br>
Occasionally you may encounter what appears to be a bug in
the shell, particularly if you are using a beta version of
zsh or a development release. Usually it is sufficient to
<br>
send a description of the problem to one of the zsh mailing
lists (see zsh(1)), but sometimes one of the zsh developers
will need to recreate your environment in order to track
<br>
the problem down.</p>

<p style="margin-top: 1em">The script named reporter, found
in the Util directory of the distribution, is provided for
this purpose. (It is also possible to autoload reporter, but
reporter is not <br>
installed in fpath by default.) This script outputs a
detailed dump of the shell state, in the form of another
script that can be read with &lsquo;zsh -f&rsquo; to
recreate that state.</p>

<p style="margin-top: 1em">To use reporter, read the script
into your shell with the &lsquo;.&rsquo; command and
redirect the output into a file:</p>

<p style="margin-top: 1em">. ~/zsh-5.0.2/Util/reporter &gt;
zsh.report</p>

<p style="margin-top: 1em">You should check the zsh.report
file for any sensitive information such as passwords and
delete them by hand before sending the script to the
developers. Also, as the output can <br>
be voluminous, it&rsquo;s best to wait for the developers to
ask for this information before sending it.</p>

<p style="margin-top: 1em">You can also use reporter to
dump only a subset of the shell state. This is sometimes
useful for creating startup files for the first time. Most
of the output from reporter is <br>
far more detailed than usually is necessary for a startup
file, but the aliases, options, and zstyles states may be
useful because they include only changes from the defaults.
<br>
The bindings state may be useful if you have created any of
your own keymaps, because reporter arranges to dump the
keymap creation commands as well as the bindings for every
<br>
keymap.</p>

<p style="margin-top: 1em">As is usual with automated
tools, if you create a startup file with reporter, you
should edit the results to remove unnecessary commands. Note
that if you&rsquo;re using the new com&acirc; <br>
pletion system, you should not dump the functions state to
your startup files with reporter; use the compdump function
instead (see zshcompsys(1)).</p>

<p style="margin-top: 1em">reporter [ state ... ] <br>
Print to standard output the indicated subset of the current
shell state. The state arguments may be one or more of:</p>

<p style="margin-top: 1em">all Output everything listed
below. <br>
aliases <br>
Output alias definitions. <br>
bindings <br>
Output ZLE key maps and bindings. <br>
completion <br>
Output old-style compctl commands. New completion is covered
by functions and zstyles. <br>
functions <br>
Output autoloads and function definitions. <br>
limits Output limit commands. <br>
options <br>
Output setopt commands. <br>
styles Same as zstyles. <br>
variables <br>
Output shell parameter assignments, plus export commands for
any environment variables. <br>
zstyles <br>
Output zstyle commands.</p>

<p style="margin-top: 1em">If the state is omitted, all is
assumed.</p>

<p style="margin-top: 1em">With the exception of
&lsquo;all&rsquo;, every state can be abbreviated by any
prefix, even a single letter; thus a is the same as aliases,
z is the same as zstyles, etc.</p>

<p style="margin-top: 1em">Manipulating Hook Functions <br>
add-zsh-hook [-dD] hook function <br>
Several functions are special to the shell, as described in
the section SPECIAL FUNCTIONS, see zshmisc(1), in that they
are automatic called at a specific point during <br>
shell execution. Each has an associated array consisting of
names of functions to be called at the same point; these are
so-called &lsquo;hook functions&rsquo;. The shell function
<br>
add-zsh-hook provides a simple way of adding or removing
functions from the array.</p>

<p style="margin-top: 1em">hook is one of chpwd, periodic,
precmd, preexec, zshaddhistory, zshexit, or
zsh_directory_name, the special functions in question. Note
that zsh_directory_name is called <br>
in a different way from the other functions, but may still
be manipulated as a hook.</p>

<p style="margin-top: 1em">function is name of an ordinary
shell function. If no options are given this will be added
to the array of functions to be executed in the given
context.</p>

<p style="margin-top: 1em">If the option -d is given, the
function is removed from the array of functions to be
executed.</p>

<p style="margin-top: 1em">If the option -D is given, the
function is treated as a pattern and any matching names of
functions are removed from the array of functions to be
executed.</p>

<p style="margin-top: 1em">The options -U, -z and -k are
passed as arguments to autoload for function. For functions
contributed with zsh, the options -Uz are appropriate.</p>

<p style="margin-top: 1em">REMEMBERING RECENT DIRECTORIES
<br>
The function cdr allows you to change the working directory
to a previous working directory from a list maintained
automatically. It is similar in concept to the directory
stack <br>
controlled by the pushd, popd and dirs builtins, but is more
configurable, and as it stores all entries in files it is
maintained across sessions and (by default) between
termi&acirc; <br>
nal emulators in the current session. (The pushd directory
stack is not actually modified or used by cdr unless you
configure it to do so as described in the configuration
sec&acirc; <br>
tion below.)</p>

<p style="margin-top: 1em">Installation <br>
The system works by means of a hook function that is called
every time the directory changes. To install the system,
autoload the required functions and use the add-zsh-hook
<br>
function described above:</p>

<p style="margin-top: 1em">autoload -Uz chpwd_recent_dirs
cdr add-zsh-hook <br>
add-zsh-hook chpwd chpwd_recent_dirs</p>

<p style="margin-top: 1em">Now every time you change
directly interactively, no matter which command you use, the
directory to which you change will be remembered in
most-recent-first order.</p>

<p style="margin-top: 1em">Use <br>
All direct user interaction is via the cdr function.</p>

<p style="margin-top: 1em">The argument to cdr is a number
N corresponding to the Nth most recently changed-to
directory. 1 is the immediately preceding directory; the
current directory is remembered but <br>
is not offered as a destination. Note that if you have
multiple windows open 1 may refer to a directory changed to
in another window; you can avoid this by having per-terminal
<br>
files for storing directory as described for the
recent-dirs-file style below.</p>

<p style="margin-top: 1em">If you set the
recent-dirs-default style described below cdr will behave
the same as cd if given a non-numeric argument, or more than
one argument. The recent directory list is <br>
updated just the same however you change directory.</p>

<p style="margin-top: 1em">If the argument is omitted, 1 is
assumed. This is similar to pushd&rsquo;s behaviour of
swapping the two most recent directories on the stack.</p>

<p style="margin-top: 1em">Completion for the argument to
cdr is available if compinit has been run; menu selection is
recommended, using:</p>

<p style="margin-top: 1em">zstyle
&rsquo;:completion:*:*:cdr:*:*&rsquo; menu selection</p>

<p style="margin-top: 1em">to allow you to cycle through
recent directories; the order is preserved, so the first
choice is the most recent directory before the current one.
The verbose style is also rec&acirc; <br>
ommended to ensure the directory is shown; this style is on
by default so no action is required unless you have changed
it.</p>

<p style="margin-top: 1em">Options <br>
The behaviour of cdr may be modified by the following
options.</p>

<p style="margin-top: 1em">-l lists the numbers and the
corresponding directories in abbreviated form (i.e. with ~
substitution reapplied), one per line. The directories here
are not quoted (this <br>
would only be an issue if a directory name contained a
newline). This is used by the completion system.</p>

<p style="margin-top: 1em">-r sets the variable reply to
the current set of directories. Nothing is printed and the
directory is not changed.</p>

<p style="margin-top: 1em">-e allows you to edit the list
of directories, one per line. The list can be edited to any
extent you like; no sanity checking is performed. Completion
is available. No <br>
quoting is necessary (except for newlines, where I have in
any case no sympathy); directories are in unabbreviated from
and contain an absolute path, i.e. they start with <br>
/. Usually the first entry should be left as the current
directory.</p>

<p style="margin-top: 1em">Configuration <br>
Configuration is by means of the styles mechanism that
should be familiar from completion; if not, see the
description of the zstyle command in see zshmodules(1). The
context <br>
for setting styles should be &rsquo;:chpwd:*&rsquo; in case
the meaning of the context is extended in future, for
example:</p>

<p style="margin-top: 1em">zstyle &rsquo;:chpwd:*&rsquo;
recent-dirs-max 0</p>

<p style="margin-top: 1em">sets the value of the
recent-dirs-max style to 0. In practice the style name is
specific enough that a context of &rsquo;*&rsquo; should be
fine.</p>

<p style="margin-top: 1em">An exception is
recent-dirs-insert, which is used exclusively by the
completion system and so has the usual completion system
context (&rsquo;:completion:*&rsquo; if nothing more
specific is <br>
needed), though again &rsquo;*&rsquo; should be fine in
practice.</p>

<p style="margin-top: 1em">recent-dirs-default <br>
If true, and the command is expecting a recent directory
index, and either there is more than one argument or the
argument is not an integer, then fall through to
&quot;cd&quot;. <br>
This allows the lazy to use only one command for directory
changing. Completion recognises this, too; see
recent-dirs-insert for how to control completion when this
<br>
option is in use.</p>

<p style="margin-top: 1em">recent-dirs-file <br>
The file where the list of directories is saved. The default
is ${ZDOTDIR:-$HOME}/.chpwd-recent-dirs, i.e. this is in
your home directory unless you have set the variable <br>
ZDOTDIR to point somewhere else. Directory names are saved
in $&rsquo;...&rsquo; quoted form, so each line in the file
can be supplied directly to the shell as an argument.</p>

<p style="margin-top: 1em">The value of this style may be
an array. In this case, the first file in the list will
always be used for saving directories while any other files
are left untouched. <br>
When reading the recent directory list, if there are fewer
than the maximum number of entries in the first file, the
contents of later files in the array will be appended <br>
with duplicates removed from the list shown. The contents of
the two files are not sorted together, i.e. all the entries
in the first file are shown first. The special <br>
value + can appear in the list to indicate the default file
should be read at that point. This allows effects like the
following:</p>

<p style="margin-top: 1em">zstyle &rsquo;:chpwd:*&rsquo;
recent-dirs-file ~/.chpwd-recent-dirs-${TTY##*/} +</p>

<p style="margin-top: 1em">Recent directories are read from
a file numbered according to the terminal. If there are
insufficient entries the list is supplemented from the
default file.</p>

<p style="margin-top: 1em">It is possible to use zstyle -e
to make the directory configurable at run time:</p>

<p style="margin-top: 1em">zstyle -e &rsquo;:chpwd:*&rsquo;
recent-dirs-file pick-recent-dirs-file <br>
pick-recent-dirs-file() { <br>
if [[ $PWD = ~/text/writing(|/*) ]]; then <br>
reply=(~/.chpwd-recent-dirs-writing) <br>
else <br>
reply=(+) <br>
fi <br>
}</p>

<p style="margin-top: 1em">In this example, if the current
directory is ~/text/writing or a directory under it, then
use a special file for saving recent directories, else use
the default.</p>

<p style="margin-top: 1em">recent-dirs-insert <br>
Used by completion. If recent-dirs-default is true, then
setting this to true causes the actual directory, rather
than its index, to be inserted on the command line; this
<br>
has the same effect as using the corresponding index, but
makes the history clearer and the line easier to edit. With
this setting, if part of an argument was already <br>
typed, normal directory completion rather than recent
directory completion is done; this is because recent
directory completion is expected to be done by cycling
through <br>
entries menu fashion.</p>

<p style="margin-top: 1em">If the value of the style is
always, then only recent directories will be completed; in
that case, use the cd command when you want to complete
other directories.</p>

<p style="margin-top: 1em">If the value is fallback, recent
directories will be tried first, then normal directory
completion is performed if recent directory completion
failed to find a match.</p>

<p style="margin-top: 1em">Finally, if the value is both
then both sets of completions are presented; the usual tag
mechanism can be used to distinguish results, with recent
directories tagged as <br>
recent-dirs. Note that the recent directories inserted are
abbreviated with directory names where appropriate.</p>

<p style="margin-top: 1em">recent-dirs-max <br>
The maximum number of directories to save to the file. If
this is zero or negative there is no maximum. The default is
20. Note this includes the current directory, <br>
which isn&rsquo;t offered, so the highest number of
directories you will be offered is one less than the
maximum.</p>

<p style="margin-top: 1em">recent-dirs-prune <br>
This style is an array determining what directories should
(or should not) be added to the recent list. Elements of the
array can include:</p>

<p style="margin-top: 1em">parent Prune parents (more
accurately, ancestors) from the recent list. If present,
changing directly down by any number of directories causes
the current directory to be <br>
overwritten. For example, changing from ~pws to
~pws/some/other/dir causes ~pws not to be left on the recent
directory stack. This only applies to direct changes <br>
to descendant directories; earlier directories on the list
are not pruned. For example, changing from ~pws/yet/another
to ~pws/some/other/dir does not cause ~pws <br>
to be pruned.</p>

<p style="margin-top: 1em">pattern:pattern <br>
Gives a zsh pattern for directories that should not be added
to the recent list (if not already there). This element can
be repeated to add different patterns. <br>
For example, &rsquo;pattern:/tmp(|/*)&rsquo; stops /tmp or
its descendants from being added. The EXTENDED_GLOB option
is always turned on for these patterns.</p>

<p style="margin-top: 1em">recent-dirs-pushd <br>
If set to true, cdr will use pushd instead of cd to change
the directory, so the directory is saved on the directory
stack. As the directory stack is completely separate <br>
from the list of files saved by the mechanism used in this
file there is no obvious reason to do this.</p>

<p style="margin-top: 1em">Use with dynamic directory
naming <br>
It is possible to refer to recent directories using the
dynamic directory name syntax by using the supplied function
zsh_directory_name_cdr a hook:</p>

<p style="margin-top: 1em">autoload -Uz add-zsh-hook <br>
add-zsh-hook -Uz zsh_directory_name
zsh_directory_name_cdr</p>

<p style="margin-top: 1em">When this is done, ~[1] will
refer to the most recent directory other than $PWD, and so
on. Completion after ~[... also works.</p>

<p style="margin-top: 1em">Details of directory handling
<br>
This section is for the curious or confused; most users will
not need to know this information.</p>

<p style="margin-top: 1em">Recent directories are saved to
a file immediately and hence are preserved across sessions.
Note currently no file locking is applied: the list is
updated immediately on inter&acirc; <br>
active commands and nowhere else (unlike history), and it is
assumed you are only going to change directory in one window
at once. This is not safe on shared accounts, but in <br>
any case the system has limited utility when someone else is
changing to a different set of directories behind your
back.</p>

<p style="margin-top: 1em">To make this a little safer,
only directory changes instituted from the command line,
either directly or indirectly through shell function calls
(but not through subshells, <br>
evals, traps, completion functions and the like) are saved.
Shell functions should use cd -q or pushd -q to avoid side
effects if the change to the directory is to be invisible
<br>
at the command line. See the contents of the function
chpwd_recent_dirs for more details.</p>

<p style="margin-top: 1em">GATHERING INFORMATION FROM
VERSION CONTROL SYSTEMS <br>
In a lot of cases, it is nice to automatically retrieve
information from version control systems (VCSs), such as
subversion, CVS or git, to be able to provide it to the
user; <br>
possibly in the user&rsquo;s prompt. So that you can
instantly tell which branch you are currently on, for
example.</p>

<p style="margin-top: 1em">In order to do that, you may use
the vcs_info function.</p>

<p style="margin-top: 1em">The following VCSs are
supported, showing the abbreviated name by which they are
referred to within the system: <br>
Bazaar (bzr) <br>
http://bazaar-vcs.org/ <br>
Codeville (cdv) <br>
http://codeville.org/ <br>
Concurrent Versioning System (cvs) <br>
http://www.nongnu.org/cvs/ <br>
Darcs (darcs) <br>
http://darcs.net/ <br>
Fossil (fossil) <br>
http://fossil-scm.org/ <br>
Git (git) <br>
http://git-scm.com/ <br>
GNU arch (tla) <br>
http://www.gnu.org/software/gnu-arch/ <br>
Mercurial (hg) <br>
http://mercurial.selenic.com/ <br>
Monotone (mtn) <br>
http://monotone.ca/ <br>
Perforce (p4) <br>
http://www.perforce.com/ <br>
Subversion (svn) <br>
http://subversion.tigris.org/ <br>
SVK (svk) <br>
http://svk.bestpractical.com/</p>

<p style="margin-top: 1em">There is also support for the
patch management system quilt
(http://savannah.nongnu.org/projects/quilt). See Quilt
Support below for details.</p>

<p style="margin-top: 1em">To load vcs_info:</p>

<p style="margin-top: 1em">autoload -Uz vcs_info</p>

<p style="margin-top: 1em">It can be used in any existing
prompt, because it does not require any $psvar entries to be
left available.</p>

<p style="margin-top: 1em">Quickstart <br>
To get this feature working quickly (including colors), you
can do the following (assuming, you loaded vcs_info properly
- see above):</p>

<p style="margin-top: 1em">zstyle &rsquo;:vcs_info:*&rsquo;
actionformats
&rsquo;%F{5}(%f%s%F{5})%F{3}-%F{5}[%F{2}%b%F{3}|%F{1}%a%F{5}]%f
&rsquo; <br>
zstyle &rsquo;:vcs_info:*&rsquo; formats
&rsquo;%F{5}(%f%s%F{5})%F{3}-%F{5}[%F{2}%b%F{5}]%f &rsquo;
<br>
zstyle &rsquo;:vcs_info:(sv[nk]|bzr):*&rsquo; branchformat
&rsquo;%b%F{1}:%F{3}%r&rsquo; <br>
precmd () { vcs_info } <br>
PS1=&rsquo;%F{5}[%F{2}%n%F{5}] %F{3}%3~
${vcs_info_msg_0_}%f%# &rsquo;</p>

<p style="margin-top: 1em">Obviously, the last two lines
are there for demonstration. You need to call vcs_info from
your precmd function. Once that is done you need a single
quoted &rsquo;${vcs_info_msg_0_}&rsquo; in <br>
your prompt.</p>

<p style="margin-top: 1em">To be able to use
&rsquo;${vcs_info_msg_0_}&rsquo; directly in your prompt
like this, you will need to have the PROMPT_SUBST option
enabled.</p>

<p style="margin-top: 1em">Now call the vcs_info_printsys
utility from the command line:</p>

<p style="margin-top: 1em">% vcs_info_printsys <br>
## list of supported version control backends: <br>
## disabled systems are prefixed by a hash sign (#) <br>
bzr <br>
cdv <br>
cvs <br>
darcs <br>
fossil <br>
git <br>
hg <br>
mtn <br>
p4 <br>
svk <br>
svn <br>
tla <br>
## flavours (cannot be used in the enable or disable styles;
they <br>
## are enabled and disabled with their master [git-svn -&gt;
git]) <br>
## they *can* be used in contexts:
&rsquo;:vcs_info:git-svn:*&rsquo;. <br>
git-p4 <br>
git-svn <br>
hg-git <br>
hg-hgsubversion <br>
hg-hgsvn</p>

<p style="margin-top: 1em">You may not want all of these
because there is no point in running the code to detect
systems you do not use. So there is a way to disable some
backends altogether:</p>

<p style="margin-top: 1em">zstyle &rsquo;:vcs_info:*&rsquo;
disable bzr cdv darcs mtn svk tla</p>

<p style="margin-top: 1em">You may also pick a few from
that list and enable only those:</p>

<p style="margin-top: 1em">zstyle &rsquo;:vcs_info:*&rsquo;
enable git cvs svn</p>

<p style="margin-top: 1em">If you rerun vcs_info_printsys
after one of these commands, you will see the backends
listed in the disable style (or backends not in the enable
style - if you used that) marked <br>
as disabled by a hash sign. That means the detection of
these systems is skipped completely. No wasted time
there.</p>

<p style="margin-top: 1em">Configuration <br>
The vcs_info feature can be configured via zstyle.</p>

<p style="margin-top: 1em">First, the context in which we
are working: <br>
:vcs_info:vcs-string:user-context:repo-root-name</p>

<p style="margin-top: 1em">vcs-string <br>
is one of: git, git-svn, git-p4, hg, hg-git,
hg-hgsubversion, hg-hgsvn, darcs, bzr, cdv, mtn, svn, cvs,
svk, tla, p4 or fossil. When hooks are active the hooks name
is <br>
added after a &lsquo;+&rsquo;. (See Hooks in vcs_info
below.)</p>

<p style="margin-top: 1em">user-context <br>
is a freely configurable string, assignable by the user as
the first argument to vcs_info (see its description
below).</p>

<p style="margin-top: 1em">repo-root-name <br>
is the name of a repository in which you want a style to
match. So, if you want a setting specific to /usr/src/zsh,
with that being a CVS checkout, you can set <br>
repo-root-name to zsh to make it so.</p>

<p style="margin-top: 1em">There are three special values
for vcs-string: The first is named -init-, that is in effect
as long as there was no decision what VCS backend to use.
The second is -preinit-; it <br>
is used before vcs_info is run, when initializing the data
exporting variables. The third special value is formats and
is used by the vcs_info_lastmsg for looking up its
styles.</p>

<p style="margin-top: 1em">The initial value of
repo-root-name is -all- and it is replaced with the actual
name, as soon as it is known. Only use this part of the
context for defining the formats, action&acirc; <br>
formats or branchformat styles, as it is guaranteed that
repo-root-name is set up correctly for these only. For all
other styles, just use &rsquo;*&rsquo; instead.</p>

<p style="margin-top: 1em">There are two pre-defined values
for user-context: <br>
default <br>
the one used if none is specified <br>
command <br>
used by vcs_info_lastmsg to lookup its styles</p>

<p style="margin-top: 1em">You can of course use
&rsquo;:vcs_info:*&rsquo; to match all VCSs in all
user-contexts at once.</p>

<p style="margin-top: 1em">This is a description of all
styles that are looked up.</p>

<p style="margin-top: 1em">formats <br>
A list of formats, used when actionformats is not used
(which is most of the time).</p>

<p style="margin-top: 1em">actionformats <br>
A list of formats, used if there is a special action going
on in your current repository; like an interactive rebase or
a merge conflict.</p>

<p style="margin-top: 1em">branchformat <br>
Some backends replace %b in the formats and actionformats
styles above, not only by a branch name but also by a
revision number. This style lets you modify how that string
<br>
should look.</p>

<p style="margin-top: 1em">nvcsformats <br>
These &quot;formats&quot; are exported when we didn&rsquo;t
detect a version control system for the current directory or
vcs_info was disabled. This is useful if you want vcs_info
to com&acirc; <br>
pletely take over the generation of your prompt. You would
do something like PS1=&rsquo;${vcs_info_msg_0_}&rsquo; to
accomplish that.</p>

<p style="margin-top: 1em">hgrevformat <br>
hg uses both a hash and a revision number to reference a
specific changeset in a repository. With this style you can
format the revision string (see branchformat) to <br>
include either or both. It&rsquo;s only useful when
get-revision is true. Note, the full 40-character revision
id is not available (except when using the use-simple
option) <br>
because executing hg more than once per prompt is too slow;
you may customize this behavior using hooks.</p>

<p style="margin-top: 1em">max-exports <br>
Defines the maximum number of vcs_info_msg_*_ variables
vcs_info will export.</p>

<p style="margin-top: 1em">enable A list of backends you
want to use. Checked in the -init- context. If this list
contains an item called NONE no backend is used at all and
vcs_info will do nothing. If <br>
this list contains ALL, vcs_info will use all known
backends. Only with ALL in enable will the disable style
have any effect. ALL and NONE are case insensitive.</p>

<p style="margin-top: 1em">disable <br>
A list of VCSs you don&rsquo;t want vcs_info to test for
repositories (checked in the -init- context, too). Only used
if enable contains ALL.</p>

<p style="margin-top: 1em">disable-patterns <br>
A list of patterns that are checked against $PWD. If a
pattern matches, vcs_info will be disabled. This style is
checked in the :vcs_info:-init-:*:-all- context.</p>

<p style="margin-top: 1em">Say, ~/.zsh is a directory under
version control, in which you do not want vcs_info to be
active, do: <br>
zstyle &rsquo;:vcs_info:*&rsquo; disable-patterns
&quot;$HOME/.zsh(|/*)&quot;</p>

<p style="margin-top: 1em">use-quilt <br>
If enabled, the quilt support code is active in
&lsquo;addon&rsquo; mode. See Quilt Support for details.</p>

<p style="margin-top: 1em">quilt-standalone <br>
If enabled, &lsquo;standalone&rsquo; mode detection is
attempted if no VCS is active in a given directory. See
Quilt Support for details.</p>

<p style="margin-top: 1em">quilt-patch-dir <br>
Overwrite the value of the $QUILT_PATCHES environment
variable. See Quilt Support for details.</p>

<p style="margin-top: 1em">quiltcommand <br>
When quilt itself is called in quilt support the value of
this style is used as the command name.</p>

<p style="margin-top: 1em">check-for-changes <br>
If enabled, this style causes the %c and %u format escapes
to show when the working directory has uncommitted changes.
The strings displayed by these escapes can be con&acirc;
<br>
trolled via the stagedstr and unstagedstr styles. The only
backends that currently support this option are git and hg
(hg only supports unstaged).</p>

<p style="margin-top: 1em">For this style to be evaluated
with the hg backend, the get-revision style needs to be set
and the use-simple style needs to be unset. The latter is
the default; the for&acirc; <br>
mer is not.</p>

<p style="margin-top: 1em">Note, the actions taken if this
style is enabled are potentially expensive (read: they may
be slow, depending on how big the current repository is).
Therefore, it is dis&acirc; <br>
abled by default.</p>

<p style="margin-top: 1em">stagedstr <br>
This string will be used in the %c escape if there are
staged changes in the repository.</p>

<p style="margin-top: 1em">unstagedstr <br>
This string will be used in the %u escape if there are
unstaged changes in the repository.</p>

<p style="margin-top: 1em">command <br>
This style causes vcs_info to use the supplied string as the
command to use as the VCS&rsquo;s binary. Note, that setting
this in &rsquo;:vcs_info:*&rsquo; is not a good idea.</p>

<p style="margin-top: 1em">If the value of this style is
empty (which is the default), the used binary name is the
name of the backend in use (e.g. svn is used in an svn
repository).</p>

<p style="margin-top: 1em">The repo-root-name part in the
context is always the default -all- when this style is
looked up.</p>

<p style="margin-top: 1em">For example, this style can be
used to use binaries from non-default installation
directories. Assume, git is installed in /usr/bin but your
sysadmin installed a newer <br>
version in /usr/bin/local. Instead of changing the order of
your $PATH parameter, you can do this: <br>
zstyle &rsquo;:vcs_info:git:*:-all-&rsquo; command
/usr/local/bin/git</p>

<p style="margin-top: 1em">use-server <br>
This is used by the Perforce backend (p4) to decide if it
should contact the Perforce server to find out if a
directory is managed by Perforce. This is the only reliable
<br>
way of doing this, but runs the risk of a delay if the
server name cannot be found. If the server (more
specifically, the host:port pair describing the server)
cannot be <br>
contacted, its name is put into the associative array
vcs_info_p4_dead_servers and is not contacted again during
the session until it is removed by hand. If you do not <br>
set this style, the p4 backend is only usable if you have
set the environment variable P4CONFIG to a file name and
have corresponding files in the root directories of each
<br>
Perforce client. See comments in the function
VCS_INFO_detect_p4 for more detail.</p>

<p style="margin-top: 1em">use-simple <br>
If there are two different ways of gathering information,
you can select the simpler one by setting this style to
true; the default is to use the not-that-simple code, <br>
which is potentially a lot slower but might be more accurate
in all possible cases. This style is used by the bzr and hg
backends. In the case of hg it will invoke the <br>
external hexdump program to parse the binary dirstate cache
file; this method will not return the local revision
number.</p>

<p style="margin-top: 1em">get-revision <br>
If set to true, vcs_info goes the extra mile to figure out
the revision of a repository&rsquo;s work tree (currently
for the git and hg backends, where this kind of information
<br>
is not always vital). For git, the hash value of the
currently checked out commit is available via the %i
expansion. With hg, the local revision number and the
correspond&acirc; <br>
ing global hash are available via %i.</p>

<p style="margin-top: 1em">get-mq If set to true, the hg
backend will look for a Mercurial Queue (mq) patch
directory. Information will be available via the
&lsquo;%m&rsquo; replacement.</p>

<p style="margin-top: 1em">get-bookmarks <br>
If set to true, the hg backend will try to get a list of
current bookmarks. They will be available via the
&lsquo;%m&rsquo; replacement.</p>

<p style="margin-top: 1em">use-prompt-escapes <br>
Determines if we assume that the assembled string from
vcs_info includes prompt escapes. (Used by
vcs_info_lastmsg.)</p>

<p style="margin-top: 1em">debug Enable debugging output to
track possible problems. Currently this style is only used
by vcs_info&rsquo;s hooks system.</p>

<p style="margin-top: 1em">hooks A list style that defines
hook-function names. See Hooks in vcs_info below for
details.</p>

<p style="margin-top: 1em">The default values for these
styles in all contexts are:</p>

<p style="margin-top: 1em">formats <br>
&quot; (%s)-[%b]%u%c-&quot; <br>
actionformats <br>
&quot; (%s)-[%b|%a]%u%c-&quot; <br>
branchformat <br>
&quot;%b:%r&quot; (for bzr, svn, svk and hg) <br>
nvcsformats <br>
&quot;&quot; <br>
hgrevformat <br>
&quot;%r:%h&quot; <br>
max-exports <br>
2 <br>
enable ALL <br>
disable <br>
(empty list) <br>
disable-patterns <br>
(empty list) <br>
check-for-changes <br>
false <br>
stagedstr <br>
(string: &quot;S&quot;) <br>
unstagedstr <br>
(string: &quot;U&quot;) <br>
command <br>
(empty string) <br>
use-server <br>
false <br>
use-simple <br>
false <br>
get-revision <br>
false <br>
get-mq true <br>
get-bookmarks <br>
false <br>
use-prompt-escapes <br>
true <br>
debug false <br>
hooks (empty list) <br>
use-quilt <br>
false <br>
quilt-standalone <br>
false <br>
quilt-patch-dir <br>
empty - use $QUILT_PATCHES <br>
quiltcommand <br>
quilt</p>

<p style="margin-top: 1em">In normal formats and
actionformats the following replacements are done:</p>

<p style="margin-top: 1em">%s The VCS in use (git, hg, svn,
etc.). <br>
%b Information about the current branch. <br>
%a An identifier that describes the action. Only makes sense
in actionformats. <br>
%i The current revision number or identifier. For hg the
hgrevformat style may be used to customize the output. <br>
%c The string from the stagedstr style if there are staged
changes in the repository. <br>
%u The string from the unstagedstr style if there are
unstaged changes in the repository. <br>
%R The base directory of the repository. <br>
%r The repository name. If %R is /foo/bar/repoXY, %r is
repoXY. <br>
%S A subdirectory within a repository. If $PWD is
/foo/bar/repoXY/beer/tasty, %S is beer/tasty. <br>
%m A &quot;misc&quot; replacement. It is at the discretion
of the backend to decide what this replacement expands to.
It is currently used by the hg and git backends to display
patch <br>
information from the mq and stgit extensions.</p>

<p style="margin-top: 1em">In branchformat these
replacements are done:</p>

<p style="margin-top: 1em">%b The branch name. <br>
%r The current revision number or the hgrevformat style for
hg.</p>

<p style="margin-top: 1em">In hgrevformat these
replacements are done:</p>

<p style="margin-top: 1em">%r The current local revision
number. <br>
%h The current global revision identifier.</p>

<p style="margin-top: 1em">In patch-format and
nopatch-format these replacements are done:</p>

<p style="margin-top: 1em">%p The name of the top-most
applied patch (applied-string). <br>
%u The number of unapplied patches (unapplied-string). <br>
%n The number of applied patches. <br>
%c The number of unapplied patches. <br>
%a The number of all patches. <br>
%g The names of active mq guards (hg backend). <br>
%G The number of active mq guards (hg backend).</p>

<p style="margin-top: 1em">Not all VCS backends have to
support all replacements. For nvcsformats no replacements
are performed at all, it is just a string.</p>

<p style="margin-top: 1em">Oddities <br>
If you want to use the %b (bold off) prompt expansion in
formats, which expands %b itself, use %%b. That will cause
the vcs_info expansion to replace %%b with %b, so that
zsh&rsquo;s <br>
prompt expansion mechanism can handle it. Similarly, to hand
down %b from branchformat, use %%%%b. Sorry for this
inconvenience, but it cannot be easily avoided. Luckily we
do <br>
not clash with a lot of prompt expansions and this only
needs to be done for those.</p>

<p style="margin-top: 1em">Quilt Support <br>
Quilt is not a version control system, therefore this is not
implemented as a backend. It can help keeping track of a
series of patches. People use it to keep a set of changes
<br>
they want to use on top of software packages (which is
tightly integrated into the package build process - the
Debian project does this for a large number of packages).
Quilt can <br>
also help individual developers keep track of their own
patches on top of real version control systems.</p>

<p style="margin-top: 1em">The vcs_info integration tries
to support both ways of using quilt by having two slightly
different modes of operation: &lsquo;addon&rsquo; mode and
&lsquo;standalone&rsquo; mode).</p>

<p style="margin-top: 1em">For &lsquo;addon&rsquo; mode to
become active vcs_info must have already detected a real
version control system controlling the directory. If that is
the case, a directory that holds quilt&rsquo;s <br>
patches needs to be found. That directory is configurable
via the &lsquo;QUILT_PATCHES&rsquo; environment variable. If
that variable exists its value is used, otherwise the value
&lsquo;patches&rsquo; <br>
is assumed. The value from $QUILT_PATCHES can be overwritten
using the &lsquo;quilt-patches&rsquo; style. (Note: you can
use vcs_info to keep the value of $QUILT_PATCHES correct all
the time <br>
via the post-quilt hook).</p>

<p style="margin-top: 1em">When the directory in question
is found, quilt is assumed to be active. To gather more
information, vcs_info looks for a directory called
&lsquo;.pc&rsquo;; Quilt uses that directory to <br>
track its current state. If this directory does not exist we
know that quilt has not done anything to the working
directory (read: no patches have been applied yet).</p>

<p style="margin-top: 1em">If patches are applied, vcs_info
will try to find out which. If you want to know which
patches of a series are not yet applied, you need to
activate the get-unapplied style in <br>
the appropriate context.</p>

<p style="margin-top: 1em">vcs_info allows for very
detailed control over how the gathered information is
presented (see the below sections, Styles and Hooks in
vcs_info), all of which are documented <br>
below. Note there are a number of other patch tracking
systems that work on top of a certain version control system
(like stgit for git, or mq for hg); the configuration for
sys&acirc; <br>
tems like that are generally configured the same way as the
quilt support.</p>

<p style="margin-top: 1em">If the quilt support is working
in &lsquo;addon&rsquo; mode, the produced string is
available as a simple format replacement (%Q to be precise),
which can be used in formats and actionfor&acirc; <br>
mats; see below for details).</p>

<p style="margin-top: 1em">If, on the other hand, the
support code is working in &lsquo;standalone&rsquo; mode,
vcs_info will pretend as if quilt were an actual version
control system. That means that the version con&acirc; <br>
trol system identifier (which otherwise would be something
like &lsquo;svn&rsquo; or &lsquo;cvs&rsquo;) will be set to
&lsquo;-quilt-&rsquo;. This has implications on the used
style context where this identifier is <br>
the second element. vcs_info will have filled in a proper
value for the &quot;repository&rsquo;s&quot; root directory
and the string containing the information about
quilt&rsquo;s state will be avail&acirc; <br>
able as the &lsquo;misc&rsquo; replacement (and %Q for
compatibility with &lsquo;addon&rsquo; mode.</p>

<p style="margin-top: 1em">What is left to discuss is how
&lsquo;standalone&rsquo; mode is detected. The detection
itself is a series of searches for directories. You can have
this detection enabled all the time in <br>
every directory that is not otherwise under version control.
If you know there is only a limited set of trees where you
would like vcs_info to try and look for Quilt in
&lsquo;stand&acirc; <br>
alone&rsquo; mode to minimise the amount of searching on
every call to vcs_info, there are a number of ways to do
that:</p>

<p style="margin-top: 1em">Essentially,
&lsquo;standalone&rsquo; mode detection is controlled by a
style called &lsquo;quilt-standalone&rsquo;. It is a string
style and its value can have different effects. The simplest
values <br>
are: &lsquo;always&rsquo; to run detection every time
vcs_info is run, and &lsquo;never&rsquo; to turn the
detection off entirely.</p>

<p style="margin-top: 1em">If the value of quilt-standalone
is something else, it is interpreted differently. If the
value is the name of a scalar variable the value of that
variable is checked and that <br>
value is used in the same
&lsquo;always&rsquo;/&lsquo;never&rsquo; way as described
above.</p>

<p style="margin-top: 1em">If the value of quilt-standalone
is an array, the elements of that array are used as
directory names under which you want the detection to be
active.</p>

<p style="margin-top: 1em">If quilt-standalone is an
associative array, the keys are taken as directory names
under which you want the detection to be active, but only if
the corresponding value is the <br>
string &lsquo;true&rsquo;.</p>

<p style="margin-top: 1em">Last, but not least, if the
value of quilt-standalone is the name of a function, the
function is called without arguments and the return value
decides whether detection should be <br>
active. A &lsquo;0&rsquo; return value is true; a non-zero
return value is interpreted as false.</p>

<p style="margin-top: 1em">Note, if there is both a
function and a variable by the name of quilt-standalone, the
function will take precedence.</p>

<p style="margin-top: 1em">Function Descriptions (Public
API) <br>
vcs_info [user-context] <br>
The main function, that runs all backends and assembles all
data into ${vcs_info_msg_*_}. This is the function you want
to call from precmd if you want to include <br>
up-to-date information in your prompt (see Variable
description below). If an argument is given, that string
will be used instead of default in the user-context field of
<br>
the style context.</p>

<p style="margin-top: 1em">vcs_info_hookadd <br>
Statically registers a number of functions to a given hook.
The hook needs to be given as the first argument; what
follows is a list of hook-function names to register to <br>
the hook. The &lsquo;+vi-&rsquo; prefix needs to be left out
here. See Hooks in vcs_info below for details.</p>

<p style="margin-top: 1em">vcs_info_hookdel <br>
Remove hook-functions from a given hook. The hook needs to
be given as the first non-option argument; what follows is a
list of hook-function names to un-register from the <br>
hook. If &lsquo;-a&rsquo; is used as the first argument, all
occurances of the functions are unregistered. Otherwise only
the last occurance is removed (if a function was registered
<br>
to a hook more than once) . The &lsquo;+vi-&rsquo; prefix
needs to be left out here. See Hooks in vcs_info below for
details.</p>

<p style="margin-top: 1em">vcs_info_lastmsg <br>
Outputs the last ${vcs_info_msg_*_} value. Takes into
account the value of the use-prompt-escapes style in
&rsquo;:vcs_info:formats:command:-all-&rsquo;. It also only
prints <br>
max-exports values.</p>

<p style="margin-top: 1em">vcs_info_printsys [user-context]
<br>
Prints a list of all supported version control systems.
Useful to find out possible contexts (and which of them are
enabled) or values for the disable style.</p>

<p style="margin-top: 1em">vcs_info_setsys <br>
Initializes vcs_info&rsquo;s internal list of available
backends. With this function, you can add support for new
VCSs without restarting the shell.</p>

<p style="margin-top: 1em">All functions named VCS_INFO_*
are for internal use only.</p>

<p style="margin-top: 1em">Variable Description <br>
${vcs_info_msg_N_} (Note the trailing underscore) <br>
Where N is an integer, e.g., vcs_info_msg_0_. These
variables are the storage for the informational message the
last vcs_info call has assembled. These are strongly
con&acirc; <br>
nected to the formats, actionformats and nvcsformats styles
described above. Those styles are lists. The first member of
that list gets expanded into ${vcs_info_msg_0_}, <br>
the second into ${vcs_info_msg_1_} and the Nth into
${vcs_info_msg_N-1_}. These parameters are exported into the
environment. (See the max-exports style above.)</p>

<p style="margin-top: 1em">All variables named VCS_INFO_*
are for internal use only.</p>

<p style="margin-top: 1em">Hooks in vcs_info <br>
Hooks are places in vcs_info where you can run your own
code. That code can communicate with the code that called it
and through that, change the system&rsquo;s behaviour.</p>

<p style="margin-top: 1em">For configuration, hooks change
the style context: <br>

:vcs_info:vcs-string+hook-name:user-context:repo-root-name</p>

<p style="margin-top: 1em">To register functions to a hook,
you need to list them in the hooks style in the appropriate
context.</p>

<p style="margin-top: 1em">Example: <br>
zstyle &rsquo;:vcs_info:*+foo:*&rsquo; hooks bar baz</p>

<p style="margin-top: 1em">This registers functions to the
hook &lsquo;foo&rsquo; for all backends. In order to avoid
namespace problems, all registered function names are
prepended by a &lsquo;+vi-&rsquo;, so the actual func&acirc;
<br>
tions called for the &lsquo;foo&rsquo; hook are
&lsquo;+vi-bar&rsquo; and &lsquo;+vi-baz&rsquo;.</p>

<p style="margin-top: 1em">If you would like to register a
function to a hook regardless of the current context, you
may use the vcs_info_hookadd function. To remove a function
that was added like that, <br>
the vcs_info_hookdel function can be used.</p>

<p style="margin-top: 1em">If something seems weird, you
can enable the &lsquo;debug&rsquo; boolean style in the
proper context and the hook-calling code will print what it
tried to execute and whether the function in <br>
question existed.</p>

<p style="margin-top: 1em">When you register more than one
function to a hook, all functions are executed one after
another until one function returns non-zero or until all
functions have been called. Con&acirc; <br>
text-sensitive hook functions are executed before statically
registered ones (the ones added by vcs_info_hookadd).</p>

<p style="margin-top: 1em">You may pass data between
functions via an associative array, user_data. For example:
<br>
+vi-git-myfirsthook(){ <br>
user_data[myval]=$myval <br>
} <br>
+vi-git-mysecondhook(){ <br>
# do something with ${user_data[myval]} <br>
}</p>

<p style="margin-top: 1em">There are a number of variables
that are special in hook contexts:</p>

<p style="margin-top: 1em">ret The return value that the
hooks system will return to the caller. The default is an
integer &lsquo;zero&rsquo;. If and how a changed ret value
changes the execution of the caller <br>
depends on the specific hook. See the hook documentation
below for details.</p>

<p style="margin-top: 1em">hook_com <br>
An associated array which is used for bidirectional
communication from the caller to hook functions. The used
keys depend on the specific hook.</p>

<p style="margin-top: 1em">context <br>
The active context of the hook. Functions that wish to
change this variable should make it local scope first.</p>

<p style="margin-top: 1em">vcs The current VCS after it was
detected. The same values as in the enable/disable style are
used. Available in all hooks except start-up.</p>

<p style="margin-top: 1em">Finally, the full list of
currently available hooks:</p>

<p style="margin-top: 1em">start-up <br>
Called after starting vcs_info but before the VCS in this
directory is determined. It can be used to deactivate
vcs_info temporarily if necessary. When ret is set to 1,
<br>
vcs_info aborts and does nothing; when set to 2, vcs_info
sets up everything as if no version control were active and
exits.</p>

<p style="margin-top: 1em">pre-get-data <br>
Same as start-up but after the VCS was detected.</p>

<p style="margin-top: 1em">gen-hg-bookmark-string <br>
Called in the Mercurial backend when a bookmark string is
generated; the get-revision and get-bookmarks styles must be
true.</p>

<p style="margin-top: 1em">This hook gets the names of the
Mercurial bookmarks that vcs_info collected from
&lsquo;hg&rsquo;.</p>

<p style="margin-top: 1em">When setting ret to non-zero,
the string in ${hook_com[hg-bookmark-string]} will be used
in the %m escape in formats and actionformats and will be
availabe in the global <br>
backend_misc array as ${backend_misc[bookmarks]}.</p>

<p style="margin-top: 1em">gen-applied-string <br>
Called in the git (with stgit), and hg (with mq) backends
and in quilt support when the applied-string is generated;
the use-quilt zstyle must be true for quilt (the mq <br>
and stgit backends are active by default).</p>

<p style="margin-top: 1em">This hook gets the names of all
applied patches which vcs_info collected so far in the
opposite order, which means that the first argument is the
top-most patch and so <br>
forth.</p>

<p style="margin-top: 1em">When setting ret to non-zero,
the string in ${hook_com[applied-string]} will be used in
the %m escape in formats and actionformats; it will be
available in the global <br>
backend_misc array as $backend_misc[patches]}; and it will
be available as %p in the patch-format and nopatch-format
styles.</p>

<p style="margin-top: 1em">gen-unapplied-string <br>
Called in the git (with stgit), and hg (with mq) backend and
in quilt support when the unapplied-string is generated; the
get-unapplied style must be true.</p>

<p style="margin-top: 1em">This hook gets the names of all
unapplied patches which vcs_info collected so far in the
opposite order, which mean that the first argument is the
patch next-in-line to be <br>
applied and so forth.</p>

<p style="margin-top: 1em">When setting ret to non-zero,
the string in ${hook_com[unapplied-string]} will be
available as %u in the patch-format and nopatch-format
styles.</p>

<p style="margin-top: 1em">gen-mqguards-string <br>
Called in the hg backend when guards-string is generated;
the get-mq style must be true (default).</p>

<p style="margin-top: 1em">This hook gets the names of any
active mq guards.</p>

<p style="margin-top: 1em">When setting ret to non-zero,
the string in ${hook_com[guards-string]} will be used in the
%g escape in the patch-format and nopatch-format styles.</p>

<p style="margin-top: 1em">no-vcs This hooks is called when
no version control system was detected.</p>

<p style="margin-top: 1em">The &lsquo;hook_com&rsquo;
parameter is not used.</p>

<p style="margin-top: 1em">post-quilt <br>
Called after the quilt support is done. The following
information is passed as arguments to the hook: 1. the
quilt-support mode (&lsquo;addon&rsquo; or
&lsquo;standalone&rsquo;); 2. the directory <br>
that contains the patch series; 3. the directory that holds
quilt&rsquo;s status information (the &lsquo;.pc&rsquo;
directory) or the string &quot;-nopc-&quot; if that
directory wasn&rsquo;t found.</p>

<p style="margin-top: 1em">The &lsquo;hook_com&rsquo;
parameter is not used.</p>

<p style="margin-top: 1em">set-branch-format <br>
Called before &lsquo;branchformat&rsquo; is set. The only
argument to the hook is the format that is configured at
this point.</p>

<p style="margin-top: 1em">The &lsquo;hook_com&rsquo; keys
considered are &lsquo;branch&rsquo; and
&lsquo;revision&rsquo;. They are set to the values figured
out so far by vcs_info and any change will be used directly
when the actual <br>
replacement is done.</p>

<p style="margin-top: 1em">If ret is set to non-zero, the
string in ${hook_com[branch-replace]} will be used unchanged
as the &lsquo;%b&rsquo; replacement in the variables set by
vcs_info.</p>

<p style="margin-top: 1em">set-hgrev-format <br>
Called before a &lsquo;hgrevformat&rsquo; is set. The only
argument to the hook is the format that is configured at
this point.</p>

<p style="margin-top: 1em">The &lsquo;hook_com&rsquo; keys
considered are &lsquo;hash&rsquo; and
&lsquo;localrev&rsquo;. They are set to the values figured
out so far by vcs_info and any change will be used directly
when the actual <br>
replacement is done.</p>

<p style="margin-top: 1em">If ret is set to non-zero, the
string in ${hook_com[rev-replace]} will be used unchanged as
the &lsquo;%i&rsquo; replacement in the variables set by
vcs_info.</p>

<p style="margin-top: 1em">set-message <br>
Called each time before a &lsquo;vcs_info_msg_N_&rsquo;
message is set. It takes two arguments; the first being the
&lsquo;N&rsquo; in the message variable name, the second is
the currently con&acirc; <br>
figured formats or actionformats.</p>

<p style="margin-top: 1em">There are a number of
&lsquo;hook_com&rsquo; keys, that are used here:
&lsquo;action&rsquo;, &lsquo;branch&rsquo;,
&lsquo;base&rsquo;, &lsquo;base-name&rsquo;,
&lsquo;subdir&rsquo;, &lsquo;staged&rsquo;,
&lsquo;unstaged&rsquo;, &lsquo;revision&rsquo;,
&lsquo;misc&rsquo;, &lsquo;vcs&rsquo; and one <br>
&lsquo;miscN&rsquo; entry for each backend-specific data
field (N starting at zero). They are set to the values
figured out so far by vcs_info and any change will be used
directly <br>
when the actual replacement is done.</p>

<p style="margin-top: 1em">Since this hook is triggered
multiple times (once for each configured formats or
actionformats), each of the &lsquo;hook_com&rsquo; keys
mentioned above (except for the miscN entries) <br>
has an &lsquo;_orig&rsquo; counterpart, so even if you
changed a value to your liking you can still get the
original value in the next run. Changing the
&lsquo;_orig&rsquo; values is probably not <br>
a good idea.</p>

<p style="margin-top: 1em">If ret is set to non-zero, the
string in ${hook_com[message]} will be used unchanged as the
message by vcs_info.</p>

<p style="margin-top: 1em">If all of this sounds rather
confusing, take a look at the Examples section below and
also in the Misc/vcs_info-examples file in the Zsh source.
They contain some explanatory <br>
code.</p>

<p style="margin-top: 1em">Examples <br>
Don&rsquo;t use vcs_info at all (even though it&rsquo;s in
your prompt): <br>
zstyle &rsquo;:vcs_info:*&rsquo; enable NONE</p>

<p style="margin-top: 1em">Disable the backends for bzr and
svk: <br>
zstyle &rsquo;:vcs_info:*&rsquo; disable bzr svk</p>

<p style="margin-top: 1em">Disable everything but bzr and
svk: <br>
zstyle &rsquo;:vcs_info:*&rsquo; enable bzr svk</p>

<p style="margin-top: 1em">Provide a special formats for
git: <br>
zstyle &rsquo;:vcs_info:git:*&rsquo; formats &rsquo; GIT,
BABY! [%b]&rsquo; <br>
zstyle &rsquo;:vcs_info:git:*&rsquo; actionformats &rsquo;
GIT ACTION! [%b|%a]&rsquo;</p>

<p style="margin-top: 1em">All %x expansion in all sorts of
formats (&quot;formats&quot;, &quot;actionformats&quot;,
branchformat, you name it) are done using the
&lsquo;zformat&rsquo; builtin from the
&lsquo;zsh/zutil&rsquo; module. That means you <br>
can do everything with these %x items what zformat supports.
In particular, if you want something that is really long to
have a fixed width, like a hash in a mercurial
branchfor&acirc; <br>
mat, you can do this: %12.12i. That&rsquo;ll shrink the 40
character hash to its 12 leading characters. The form is
actually &lsquo;%min.maxx&rsquo;. More is possible. See the
section &lsquo;The <br>
zsh/zutil Module&rsquo; in zshmodules(1) for details.</p>

<p style="margin-top: 1em">Use the quicker bzr backend <br>
zstyle &rsquo;:vcs_info:bzr:*&rsquo; use-simple true</p>

<p style="margin-top: 1em">If you do use use-simple, please
report if it does &lsquo;the-right-thing[tm]&rsquo;.</p>

<p style="margin-top: 1em">Display the revision number in
yellow for bzr and svn: <br>
zstyle &rsquo;:vcs_info:(svn|bzr):*&rsquo; branchformat
&rsquo;%b%{&rsquo;${fg[yellow]}&rsquo;%}:%r&rsquo;</p>

<p style="margin-top: 1em">If you want colors, make sure
you enclose the color codes in %{...%} if you want to use
the string provided by vcs_info in prompts.</p>

<p style="margin-top: 1em">Here is how to print the VCS
information as a command (not in a prompt): <br>
alias vcsi=&rsquo;vcs_info command;
vcs_info_lastmsg&rsquo;</p>

<p style="margin-top: 1em">This way, you can even define
different formats for output via vcs_info_lastmsg in the
&rsquo;:vcs_info:*:command:*&rsquo; namespace.</p>

<p style="margin-top: 1em">Now as promised, some code that
uses hooks: say, you&rsquo;d like to replace the string
&lsquo;svn&rsquo; by &lsquo;subversion&rsquo; in
vcs_info&rsquo;s %s formats replacement.</p>

<p style="margin-top: 1em">First, we will tell vcs_info to
call a function when populating the message variables with
the gathered information: <br>
zstyle &rsquo;:vcs_info:*+set-message:*&rsquo; hooks
svn2subversion</p>

<p style="margin-top: 1em">Nothing happens. Which is
reasonable, since we didn&rsquo;t define the actual function
yet. To see what the hooks subsystem is trying to do, enable
the &lsquo;debug&rsquo; style: <br>
zstyle &rsquo;:vcs_info:*+*:*&rsquo; debug true</p>

<p style="margin-top: 1em">That should give you an idea
what is going on. Specifically, the function that we are
looking for is &lsquo;+vi-svn2subversion&rsquo;. Note, the
&lsquo;+vi-&rsquo; prefix. So, everything is in order, <br>
just as documented. When you are done checking out the
debugging output, disable it again: <br>
zstyle &rsquo;:vcs_info:*+*:*&rsquo; debug false</p>

<p style="margin-top: 1em">Now, let&rsquo;s define the
function: <br>
function +vi-svn2subversion() { <br>
[[ ${hook_com[vcs_orig]} == svn ]] &amp;&amp;
hook_com[vcs]=subversion <br>
}</p>

<p style="margin-top: 1em">Simple enough. And it could have
even been simpler, if only we had registered our function in
a less generic context. If we do it only in the
&lsquo;svn&rsquo; backend&rsquo;s context, we don&rsquo;t
<br>
need to test which the active backend is: <br>
zstyle &rsquo;:vcs_info:svn+set-message:*&rsquo; hooks
svn2subversion <br>
function +vi-svn2subversion() { <br>
hook_com[vcs]=subversion <br>
}</p>

<p style="margin-top: 1em">And finally a little more
elaborate example, that uses a hook to create a customised
bookmark string for the hg backend.</p>

<p style="margin-top: 1em">Again, we start off by
registering a function: <br>
zstyle &rsquo;:vcs_info:hg+gen-hg-bookmark-string:*&rsquo;
hooks hgbookmarks</p>

<p style="margin-top: 1em">And then we define the
&lsquo;+vi-hgbookmarks function: <br>
function +vi-hgbookmarks() { <br>
# The default is to connect all bookmark names by <br>
# commas. This mixes things up a little. <br>
# Imagine, there&rsquo;s one type of bookmarks that is <br>
# special to you. Say, because it&rsquo;s *your* work. <br>
# Those bookmarks look always like this: &quot;sh/*&quot;
<br>
# (because your initials are sh, for example). <br>
# This makes the bookmarks string use only those <br>
# bookmarks. If there&rsquo;s more than one, it <br>
# concatenates them using commas. <br>
local s i <br>
# The bookmarks returned by &lsquo;hg&rsquo; are available
in <br>
# the functions positional parameters. <br>
(( $# == 0 )) &amp;&amp; return 0 <br>
for i in &quot;$@&quot;; do <br>
if [[ $i == sh/* ]]; then <br>
[[ -n $s ]] &amp;&amp; s=$s, <br>
s=${s}$i <br>
fi <br>
done <br>
# Now, the communication with the code that calls <br>
# the hook functions is done via the hook_com[] <br>
# hash. The key, at which the
&lsquo;gen-hg-bookmark-string&rsquo; <br>
# hook looks at is &lsquo;hg-bookmark-string&rsquo;. So:
<br>
hook_com[hg-bookmark-string]=$s <br>
# And to signal, that we want to use the sting we <br>
# just generated, set the special variable &lsquo;ret&rsquo;
to <br>
# something other than the default zero: <br>
ret=1 <br>
return 0 <br>
}</p>

<p style="margin-top: 1em">Some longer examples and code
snippets which might be useful are available in the examples
file located at Misc/vcs_info-examples in the Zsh source
directory.</p>

<p style="margin-top: 1em">This concludes our guided tour
through zsh&rsquo;s vcs_info.</p>

<p style="margin-top: 1em">PROMPT THEMES <br>
Installation <br>
You should make sure all the functions from the
Functions/Prompts directory of the source distribution are
available; they all begin with the string
&lsquo;prompt_&rsquo; except for the spe&acirc; <br>
cial function&lsquo;promptinit&rsquo;. You also need the
&lsquo;colors&rsquo; function from Functions/Misc. All of
these functions may already have been installed on your
system; if not, you will need <br>
to find them and copy them. The directory should appear as
one of the elements of the fpath array (this should already
be the case if they were installed), and at least the <br>
function promptinit should be autoloaded; it will autoload
the rest. Finally, to initialize the use of the system you
need to call the promptinit function. The following code
<br>
in your .zshrc will arrange for this; assume the functions
are stored in the directory ~/myfns:</p>

<p style="margin-top: 1em">fpath=(~/myfns $fpath) <br>
autoload -U promptinit <br>
promptinit</p>

<p style="margin-top: 1em">Theme Selection <br>
Use the prompt command to select your preferred theme. This
command may be added to your .zshrc following the call to
promptinit in order to start zsh with a theme already <br>
selected.</p>

<p style="margin-top: 1em">prompt [ -c | -l ] <br>
prompt [ -p | -h ] [ theme ... ] <br>
prompt [ -s ] theme [ arg ... ] <br>
Set or examine the prompt theme. With no options and a theme
argument, the theme with that name is set as the current
theme. The available themes are determined at run <br>
time; use the -l option to see a list. The special theme
&lsquo;random&rsquo; selects at random one of the available
themes and sets your prompt to that.</p>

<p style="margin-top: 1em">In some cases the theme may be
modified by one or more arguments, which should be given
after the theme name. See the help for each theme for
descriptions of these argu&acirc; <br>
ments.</p>

<p style="margin-top: 1em">Options are:</p>

<p style="margin-top: 1em">-c Show the currently selected
theme and its parameters, if any. <br>
-l List all available prompt themes. <br>
-p Preview the theme named by theme, or all themes if no
theme is given. <br>
-h Show help for the theme named by theme, or for the prompt
function if no theme is given. <br>
-s Set theme as the current theme and save state.</p>

<p style="margin-top: 1em">prompt_theme_setup <br>
Each available theme has a setup function which is called by
the prompt function to install that theme. This function may
define other functions as necessary to maintain <br>
the prompt, including functions used to preview the prompt
or provide help for its use. You should not normally call a
theme&rsquo;s setup function directly.</p>

<p style="margin-top: 1em">ZLE FUNCTIONS <br>
Widgets <br>
These functions all implement user-defined ZLE widgets (see
zshzle(1)) which can be bound to keystrokes in interactive
shells. To use them, your .zshrc should contain lines of
<br>
the form</p>

<p style="margin-top: 1em">autoload function <br>
zle -N function</p>

<p style="margin-top: 1em">followed by an appropriate
bindkey command to associate the function with a key
sequence. Suggested bindings are described below.</p>

<p style="margin-top: 1em">bash-style word functions <br>
If you are looking for functions to implement moving over
and editing words in the manner of bash, where only
alphanumeric characters are considered word characters, you
<br>
can use the functions described in the next section. The
following is sufficient:</p>

<p style="margin-top: 1em">autoload -U select-word-style
<br>
select-word-style bash</p>

<p style="margin-top: 1em">forward-word-match,
backward-word-match <br>
kill-word-match, backward-kill-word-match <br>
transpose-words-match, capitalize-word-match <br>
up-case-word-match, down-case-word-match <br>
select-word-style, match-word-context, match-words-by-style
<br>
The eight &lsquo;-match&rsquo; functions are drop-in
replacements for the builtin widgets without the suffix. By
default they behave in a similar way. However, by the use of
styles <br>
and the function select-word-style, the way words are
matched can be altered.</p>

<p style="margin-top: 1em">The simplest way of configuring
the functions is to use select-word-style, which can either
be called as a normal function with the appropriate
argument, or invoked as a <br>
user-defined widget that will prompt for the first character
of the word style to be used. The first time it is invoked,
the eight -match functions will automatically <br>
replace the builtin versions, so they do not need to be
loaded explicitly.</p>

<p style="margin-top: 1em">The word styles available are as
follows. Only the first character is examined.</p>

<p style="margin-top: 1em">bash Word characters are
alphanumeric characters only.</p>

<p style="margin-top: 1em">normal As in normal shell
operation: word characters are alphanumeric characters plus
any characters present in the string given by the parameter
$WORDCHARS.</p>

<p style="margin-top: 1em">shell Words are complete shell
command arguments, possibly including complete quoted
strings, or any tokens special to the shell.</p>

<p style="margin-top: 1em">whitespace <br>
Words are any set of characters delimited by whitespace.</p>

<p style="margin-top: 1em">default <br>
Restore the default settings; this is usually the same as
&lsquo;normal&rsquo;.</p>

<p style="margin-top: 1em">All but &lsquo;default&rsquo;
can be input as an upper case character, which has the same
effect but with subword matching turned on. In this case,
words with upper case characters <br>
are treated specially: each separate run of upper case
characters, or an upper case character followed by any
number of other characters, is considered a word. The style
<br>
subword-range can supply an alternative character range to
the default &lsquo;[:upper:]&rsquo;; the value of the style
is treated as the contents of a &lsquo;[...]&rsquo; pattern
(note that the <br>
outer brackets should not be supplied, only those
surrounding named ranges).</p>

<p style="margin-top: 1em">More control can be obtained
using the zstyle command, as described in zshmodules(1).
Each style is looked up in the context :zle:widget where
widget is the name of the <br>
user-defined widget, not the name of the function
implementing it, so in the case of the definitions supplied
by select-word-style the appropriate contexts are
:zle:for&acirc; <br>
ward-word, and so on. The function select-word-style itself
always defines styles for the context &lsquo;:zle:*&rsquo;
which can be overridden by more specific (longer) patterns
as <br>
well as explicit contexts.</p>

<p style="margin-top: 1em">The style word-style specifies
the rules to use. This may have the following values.</p>

<p style="margin-top: 1em">normal Use the standard shell
rules, i.e. alphanumerics and $WORDCHARS, unless overridden
by the styles word-chars or word-class.</p>

<p style="margin-top: 1em">specified <br>
Similar to normal, but only the specified characters, and
not also alphanumerics, are considered word characters.</p>

<p style="margin-top: 1em">unspecified <br>
The negation of specified. The given characters are those
which will not be considered part of a word.</p>

<p style="margin-top: 1em">shell Words are obtained by
using the syntactic rules for generating shell command
arguments. In addition, special tokens which are never
command arguments such as &lsquo;()&rsquo; <br>
are also treated as words.</p>

<p style="margin-top: 1em">whitespace <br>
Words are whitespace-delimited strings of characters.</p>

<p style="margin-top: 1em">The first three of those rules
usually use $WORDCHARS, but the value in the parameter can
be overridden by the style word-chars, which works in
exactly the same way as <br>
$WORDCHARS. In addition, the style word-class uses character
class syntax to group characters and takes precedence over
word-chars if both are set. The word-class style <br>
does not include the surrounding brackets of the character
class; for example, &lsquo;-:[:alnum:]&rsquo; is a valid
word-class to include all alphanumerics plus the characters
&lsquo;-&rsquo; and <br>
&lsquo;:&rsquo;. Be careful including &lsquo;]&rsquo;,
&lsquo;^&rsquo; and &lsquo;-&rsquo; as these are special
inside character classes.</p>

<p style="margin-top: 1em">word-style may also have
&lsquo;-subword&rsquo; appended to its value to turn on
subword matching, as described above.</p>

<p style="margin-top: 1em">The style skip-chars is mostly
useful for transpose-words and similar functions. If set, it
gives a count of characters starting at the cursor position
which will not be <br>
considered part of the word and are treated as space,
regardless of what they actually are. For example, if</p>

<p style="margin-top: 1em">zstyle
&rsquo;:zle:transpose-words&rsquo; skip-chars 1</p>

<p style="margin-top: 1em">has been set, and
transpose-words-match is called with the cursor on the X of
fooXbar, where X can be any character, then the resulting
expression is barXfoo.</p>

<p style="margin-top: 1em">Finer grained control can be
obtained by setting the style word-context to an array of
pairs of entries. Each pair of entries consists of a pattern
and a subcontext. The <br>
shell argument the cursor is on is matched against each
pattern in turn until one matches; if it does, the context
is extended by a colon and the corresponding subcontext.
<br>
Note that the test is made against the original word on the
line, with no stripping of quotes. Special handling is done
between words: the current context is examined and <br>
if it contains the string back, the word before the cursor
is considered, else the word after cursor is considered.
Some examples are given below.</p>

<p style="margin-top: 1em">The style skip-whitespace-first
is only used with the forward-word widget. If it is set to
true, then forward-word skips any non-word-characters,
followed by any <br>
non-word-characters: this is similar to the behaviour of
other word-orientated widgets, and also that used by other
editors, however it differs from the standard zsh be&acirc;
<br>
haviour. When using select-word-style the widget is set in
the context :zle:* to true if the word style is bash and
false otherwise. It may be overridden by setting it <br>
in the more specific context :zle:forward-word*.</p>

<p style="margin-top: 1em">Here are some examples of use of
the styles, actually taken from the simplified interface in
select-word-style:</p>

<p style="margin-top: 1em">zstyle &rsquo;:zle:*&rsquo;
word-style standard <br>
zstyle &rsquo;:zle:*&rsquo; word-chars &rsquo;&rsquo;</p>

<p style="margin-top: 1em">Implements bash-style word
handling for all widgets, i.e. only alphanumerics are word
characters; equivalent to setting the parameter WORDCHARS
empty for the given con&acirc; <br>
text.</p>

<p style="margin-top: 1em">style &rsquo;:zle:*kill*&rsquo;
word-style space</p>

<p style="margin-top: 1em">Uses space-delimited words for
widgets with the word &lsquo;kill&rsquo; in the name.
Neither of the styles word-chars nor word-class is used in
this case.</p>

<p style="margin-top: 1em">Here are some examples of use of
the word-context style to extend the context.</p>

<p style="margin-top: 1em">zstyle &rsquo;:zle:*&rsquo;
word-context &quot;*/*&quot; file &quot;[[:space:]]&quot;
whitespace <br>
zstyle &rsquo;:zle:transpose-words:whitespace&rsquo;
word-style shell <br>
zstyle &rsquo;:zle:transpose-words:filename&rsquo;
word-style normal <br>
zstyle &rsquo;:zle:transpose-words:filename&rsquo;
word-chars &rsquo;&rsquo;</p>

<p style="margin-top: 1em">This provides two different ways
of using transpose-words depending on whether the cursor is
on whitespace between words or on a filename, here any word
containing a /. <br>
On whitespace, complete arguments as defined by standard
shell rules will be transposed. In a filename, only
alphanumerics will be transposed. Elsewhere, words will be
<br>
transposed using the default style for
:zle:transpose-words.</p>

<p style="margin-top: 1em">The word matching and all the
handling of zstyle settings is actually implemented by the
function match-words-by-style. This can be used to create
new user-defined wid&acirc; <br>
gets. The calling function should set the local parameter
curcontext to :zle:widget, create the local parameter
matched_words and call match-words-by-style with no
argu&acirc; <br>
ments. On return, matched_words will be set to an array with
the elements: (1) the start of the line (2) the word before
the cursor (3) any non-word characters between <br>
that word and the cursor (4) any non-word character at the
cursor position plus any remaining non-word characters
before the next word, including all characters specified
<br>
by the skip-chars style, (5) the word at or following the
cursor (6) any non-word characters following that word (7)
the remainder of the line. Any of the elements may be <br>
an empty string; the calling function should test for this
to decide whether it can perform its function.</p>

<p style="margin-top: 1em">It is possible to pass options
with arguments to match-words-by-style to override the use
of styles. The options are: <br>
-w word-style <br>
-s skip-chars <br>
-c word-class <br>
-C word-chars <br>
-r subword-range</p>

<p style="margin-top: 1em">For example,
match-words-by-style -w shell -c 0 may be used to extract
the command argument around the cursor.</p>

<p style="margin-top: 1em">The word-context style is
implemented by the function match-word-context. This should
not usually need to be called directly.</p>

<p style="margin-top: 1em">copy-earlier-word <br>
This widget works like a combination of insert-last-word and
copy-prev-shell-word. Repeated invocations of the widget
retrieve earlier words on the relevant history line. <br>
With a numeric argument N, insert the Nth word from the
history line; N may be negative to count from the end of the
line.</p>

<p style="margin-top: 1em">If insert-last-word has been
used to retrieve the last word on a previous history line,
repeated invocations will replace that word with earlier
words from the same line.</p>

<p style="margin-top: 1em">Otherwise, the widget applies to
words on the line currently being edited. The widget style
can be set to the name of another widget that should be
called to retrieve <br>
words. This widget must accept the same three arguments as
insert-last-word.</p>

<p style="margin-top: 1em">cycle-completion-positions <br>
After inserting an unambiguous string into the command line,
the new function based completion system may know about
multiple places in this string where characters are <br>
missing or differ from at least one of the possible matches.
It will then place the cursor on the position it considers
to be the most interesting one, i.e. the one where <br>
one can disambiguate between as many matches as possible
with as little typing as possible.</p>

<p style="margin-top: 1em">This widget allows the cursor to
be easily moved to the other interesting spots. It can be
invoked repeatedly to cycle between all positions reported
by the completion <br>
system.</p>

<p style="margin-top: 1em">delete-whole-word-match <br>
This is another function which works like the -match
functions described immediately above, i.e. using styles to
decide the word boundaries. However, it is not a
replace&acirc; <br>
ment for any existing function.</p>

<p style="margin-top: 1em">The basic behaviour is to delete
the word around the cursor. There is no numeric prefix
handling; only the single word around the cursor is
considered. If the widget <br>
contains the string kill, the removed text will be placed in
the cutbuffer for future yanking. This can be obtained by
defining kill-whole-word-match as follows:</p>

<p style="margin-top: 1em">zle -N kill-whole-word-match
delete-whole-word-match</p>

<p style="margin-top: 1em">and then binding the widget
kill-whole-word-match.</p>

<p style="margin-top: 1em">up-line-or-beginning-search,
down-line-or-beginning-search <br>
These widgets are similar to the builtin functions
up-line-or-search and down-line-or-search: if in a multiline
buffer they move up or down within the buffer, otherwise
<br>
they search for a history line matching the start of the
current line. In this case, however, they search for a line
which matches the current line up to the current cur&acirc;
<br>
sor position, in the manner of
history-beginning-search-backward and -forward, rather than
the first word on the line.</p>

<p style="margin-top: 1em">edit-command-line <br>
Edit the command line using your visual editor, as in
ksh.</p>

<p style="margin-top: 1em">bindkey -M vicmd v
edit-command-line</p>

<p style="margin-top: 1em">history-search-end <br>
This function implements the widgets
history-beginning-search-backward-end and
history-beginning-search-forward-end. These commands work by
first calling the correspond&acirc; <br>
ing builtin widget (see &lsquo;History Control&rsquo; in
zshzle(1)) and then moving the cursor to the end of the
line. The original cursor position is remembered and
restored before <br>
calling the builtin widget a second time, so that the same
search is repeated to look farther through the history.</p>

<p style="margin-top: 1em">Although you autoload only one
function, the commands to use it are slightly different
because it implements two widgets.</p>

<p style="margin-top: 1em">zle -N
history-beginning-search-backward-end history-search-end
<br>
zle -N history-beginning-search-forward-end
history-search-end <br>
bindkey &rsquo;\^P&rsquo;
history-beginning-search-backward-end <br>
bindkey &rsquo;\^N&rsquo;
history-beginning-search-forward-end</p>

<p style="margin-top: 1em">history-beginning-search-menu
<br>
This function implements yet another form of history
searching. The text before the cursor is used to select
lines from the history, as for
history-beginning-search-back&acirc; <br>
ward except that all matches are shown in a numbered menu.
Typing the appropriate digits inserts the full history line.
Note that leading zeroes must be typed (they are <br>
only shown when necessary for removing ambiguity). The
entire history is searched; there is no distinction between
forwards and backwards.</p>

<p style="margin-top: 1em">With a prefix argument, the
search is not anchored to the start of the line; the string
typed by the use may appear anywhere in the line in the
history.</p>

<p style="margin-top: 1em">If the widget name contains
&lsquo;-end&rsquo; the cursor is moved to the end of the
line inserted. If the widget name contains
&lsquo;-space&rsquo; any space in the text typed is treated
as a <br>
wildcard and can match anything (hence a leading space is
equivalent to giving a prefix argument). Both forms can be
combined, for example:</p>

<p style="margin-top: 1em">zle -N
history-beginning-search-menu-space-end
history-beginning-search-menu</p>

<p style="margin-top: 1em">history-pattern-search <br>
The function history-pattern-search implements widgets which
prompt for a pattern with which to search the history
backwards or forwards. The pattern is in the usual zsh <br>
format, however the first character may be ^ to anchor the
search to the start of the line, and the last character may
be $ to anchor the search to the end of the line. <br>
If the search was not anchored to the end of the line the
cursor is positioned just after the pattern found.</p>

<p style="margin-top: 1em">The commands to create bindable
widgets are similar to those in the example immediately
above:</p>

<p style="margin-top: 1em">autoload -U
history-pattern-search <br>
zle -N history-pattern-search-backward
history-pattern-search <br>
zle -N history-pattern-search-forward
history-pattern-search</p>

<p style="margin-top: 1em">incarg Typing the keystrokes for
this widget with the cursor placed on or to the left of an
integer causes that integer to be incremented by one. With a
numeric prefix argument, <br>
the number is incremented by the amount of the argument
(decremented if the prefix argument is negative). The shell
parameter incarg may be set to change the default <br>
increment to something other than one.</p>

<p style="margin-top: 1em">bindkey &rsquo;^X+&rsquo;
incarg</p>

<p style="margin-top: 1em">incremental-complete-word <br>
This allows incremental completion of a word. After starting
this command, a list of completion choices can be shown
after every character you type, which you can delete <br>
with ^H or DEL. Pressing return accepts the completion so
far and returns you to normal editing (that is, the command
line is not immediately executed). You can hit TAB <br>
to do normal completion, ^G to abort back to the state when
you started, and ^D to list the matches.</p>

<p style="margin-top: 1em">This works only with the new
function based completion system.</p>

<p style="margin-top: 1em">bindkey &rsquo;^Xi&rsquo;
incremental-complete-word</p>

<p style="margin-top: 1em">insert-composed-char <br>
This function allows you to compose characters that
don&rsquo;t appear on the keyboard to be inserted into the
command line. The command is followed by two keys
corresponding <br>
to ASCII characters (there is no prompt). For accented
characters, the two keys are a base character followed by a
code for the accent, while for other special characters <br>
the two characters together form a mnemonic for the
character to be inserted. The two-character codes are a
subset of those given by RFC 1345 (see for example <br>
http://www.faqs.org/rfcs/rfc1345.html).</p>

<p style="margin-top: 1em">The function may optionally be
followed by up to two characters which replace one or both
of the characters read from the keyboard; if both characters
are supplied, no <br>
input is read. For example, insert-composed-char a: can be
used within a widget to insert an a with umlaut into the
command line. This has the advantages over use of a <br>
literal character that it is more portable.</p>

<p style="margin-top: 1em">For best results zsh should have
been built with support for multibyte characters (configured
with --enable-multibyte); however, the function works for
the limited range <br>
of characters available in single-byte character sets such
as ISO-8859-1.</p>

<p style="margin-top: 1em">The character is converted into
the local representation and inserted into the command line
at the cursor position. (The conversion is done within the
shell, using what&acirc; <br>
ever facilities the C library provides.) With a numeric
argument, the character and its code are previewed in the
status line</p>

<p style="margin-top: 1em">The function may be run outside
zle in which case it prints the character (together with a
newline) to standard output. Input is still read from
keystrokes.</p>

<p style="margin-top: 1em">See insert-unicode-char for an
alternative way of inserting Unicode characters using their
hexadecimal character number.</p>

<p style="margin-top: 1em">The set of accented characters
is reasonably complete up to Unicode character U+0180, the
set of special characters less so. However, it is very
sporadic from that point. <br>
Adding new characters is easy, however; see the function
define-composed-chars. Please send any additions to
zsh-workers@zsh.org.</p>

<p style="margin-top: 1em">The codes for the second
character when used to accent the first are as follows. Note
that not every character can take every accent. <br>
! Grave. <br>
&rsquo; Acute. <br>
&gt; Circumflex. <br>
? Tilde. (This is not ~ as RFC 1345 does not assume that
character is present on the keyboard.) <br>
- Macron. (A horizontal bar over the base character.) <br>
( Breve. (A shallow dish shape over the base character.)
<br>
. Dot above the base character, or in the case of i no dot,
or in the case of L and l a centered dot. <br>
: Diaeresis (Umlaut). <br>
c Cedilla. <br>
_ Underline, however there are currently no underlined
characters. <br>
/ Stroke through the base character. <br>
&quot; Double acute (only supported on a few letters). <br>
; Ogonek. (A little forward facing hook at the bottom right
of the character.) <br>
&lt; Caron. (A little v over the letter.) <br>
0 Circle over the base character. <br>
2 Hook over the base character. <br>
9 Horn over the base character.</p>

<p style="margin-top: 1em">The most common characters from
the Arabic, Cyrillic, Greek and Hebrew alphabets are
available; consult RFC 1345 for the appropriate sequences.
In addition, a set of two <br>
letter codes not in RFC 1345 are available for the
double-width characters corresponding to ASCII characters
from ! to ~ (0x21 to 0x7e) by preceding the character with
^, <br>
for example ^A for a double-width A.</p>

<p style="margin-top: 1em">The following other
two-character sequences are understood.</p>

<p style="margin-top: 1em">ASCII characters <br>
These are already present on most keyboards: <br>
&lt;( Left square bracket <br>
// Backslash (solidus) <br>
)&gt; Right square bracket <br>
(! Left brace (curly bracket) <br>
!! Vertical bar (pipe symbol) <br>
!) Right brace (curly bracket) <br>
&rsquo;? Tilde</p>

<p style="margin-top: 1em">Special letters <br>
Characters found in various variants of the Latin alphabet:
<br>
ss Eszett (scharfes S) <br>
D-, d- Eth <br>
TH, th Thorn <br>
kk Kra <br>
&rsquo;n &rsquo;n <br>
NG, ng Ng <br>
OI, oi Oi <br>
yr yr <br>
ED ezh</p>

<p style="margin-top: 1em">Currency symbols <br>
Ct Cent <br>
Pd Pound sterling (also lira and others) <br>
Cu Currency <br>
Ye Yen <br>
Eu Euro (N.B. not in RFC 1345)</p>

<p style="margin-top: 1em">Punctuation characters <br>
References to &quot;right&quot; quotes indicate the shape
(like a 9 rather than 6) rather than their grammatical use.
(For example, a &quot;right&quot; low double quote is used
to <br>
open quotations in German.) <br>
!I Inverted exclamation mark <br>
BB Broken vertical bar <br>
SE Section <br>
Co Copyright <br>
-a Spanish feminine ordinal indicator <br>
&lt;&lt; Left guillemet <br>
-- Soft hyphen <br>
Rg Registered trade mark <br>
PI Pilcrow (paragraph) <br>
-o Spanish masculine ordinal indicator <br>
&gt;&gt; Right guillemet <br>
?I Inverted question mark <br>
-1 Hyphen <br>
-N En dash <br>
-M Em dash <br>
-3 Horizontal bar <br>
:3 Vertical ellipsis <br>
.3 Horizontal midline ellipsis <br>
!2 Double vertical line <br>
=2 Double low line <br>
&rsquo;6 Left single quote <br>
&rsquo;9 Right single quote <br>
.9 &quot;Right&quot; low quote <br>
9&rsquo; Reversed &quot;right&quot; quote <br>
&quot;6 Left double quote <br>
&quot;9 Right double quote <br>
:9 &quot;Right&quot; low double quote <br>
9&quot; Reversed &quot;right&quot; double quote <br>
/- Dagger <br>
/= Double dagger</p>

<p style="margin-top: 1em">Mathematical symbols <br>
DG Degree <br>
-2, +-, -+ <br>
- sign, +/- sign, -/+ sign <br>
2S Superscript 2 <br>
3S Superscript 3 <br>
1S Superscript 1 <br>
My Micro <br>
.M Middle dot <br>
14 Quarter <br>
12 Half <br>
34 Three quarters <br>
*X Multiplication <br>
-: Division <br>
%0 Per mille <br>
FA, TE, /0 <br>
For all, there exists, empty set <br>
dP, DE, NB <br>
Partial derivative, delta (increment), del (nabla) <br>
(-, -) Element of, contains <br>
*P, +Z Product, sum <br>
*-, Ob, Sb <br>
Asterisk, ring, bullet <br>
RT, 0(, 00 <br>
Root sign, proportional to, infinity</p>

<p style="margin-top: 1em">Other symbols <br>
cS, cH, cD, cC <br>
Card suits: spades, hearts, diamonds, clubs <br>
Md, M8, M2, Mb, Mx, MX <br>
Musical notation: crotchet (quarter note), quaver (eighth
note), semiquavers (sixteenth notes), flag sign, natural
sign, sharp sign <br>
Fm, Ml Female, male</p>

<p style="margin-top: 1em">Accents on their own <br>
&rsquo;&gt; Circumflex (same as caret, ^) <br>
&rsquo;! Grave (same as backtick, &lsquo;) <br>
&rsquo;, Cedilla <br>
&rsquo;: Diaeresis (Umlaut) <br>
&rsquo;m Macron <br>
&rsquo;&rsquo; Acute</p>

<p style="margin-top: 1em">insert-files <br>
This function allows you type a file pattern, and see the
results of the expansion at each step. When you hit return,
all expansions are inserted into the command line.</p>

<p style="margin-top: 1em">bindkey &rsquo;^Xf&rsquo;
insert-files</p>

<p style="margin-top: 1em">insert-unicode-char <br>
When first executed, the user inputs a set of hexadecimal
digits. This is terminated with another call to
insert-unicode-char. The digits are then turned into the
corre&acirc; <br>
sponding Unicode character. For example, if the widget is
bound to ^XU, the character sequence &lsquo;^XU 4 c
^XU&rsquo; inserts L (Unicode U+004c).</p>

<p style="margin-top: 1em">See insert-composed-char for a
way of inserting characters using a two-character
mnemonic.</p>

<p style="margin-top: 1em">narrow-to-region [ -p pre ] [ -P
post ] <br>
[ -S statepm | -R statepm ] [ -n ] [ start end ]) <br>
narrow-to-region-invisible <br>
Narrow the editable portion of the buffer to the region
between the cursor and the mark, which may be in either
order. The region may not be empty.</p>

<p style="margin-top: 1em">narrow-to-region may be used as
a widget or called as a function from a user-defined widget;
by default, the text outside the editable area remains
visible. A recur&acirc; <br>
sive-edit is performed and the original widening status is
then restored. Various options and arguments are available
when it is called as a function.</p>

<p style="margin-top: 1em">The options -p pretext and -P
posttext may be used to replace the text before and after
the display for the duration of the function; either or both
may be an empty <br>
string.</p>

<p style="margin-top: 1em">If the option -n is also given,
pretext or posttext will only be inserted if there is text
before or after the region respectively which will be made
invisible.</p>

<p style="margin-top: 1em">Two numeric arguments may be
given which will be used instead of the cursor and mark
positions.</p>

<p style="margin-top: 1em">The option -S statepm is used to
narrow according to the other options while saving the
original state in the parameter with name statepm, while the
option -R statepm is <br>
used to restore the state from the parameter; note in both
cases the name of the parameter is required. In the second
case, other options and arguments are irrelevant. <br>
When this method is used, no recursive-edit is performed;
the calling widget should call this function with the option
-S, perform its own editing on the command line or <br>
pass control to the user via &lsquo;zle
recursive-edit&rsquo;, then call this function with the
option -R. The argument statepm must be a suitable name for
an ordinary parameter, <br>
except that parameters beginning with the prefix _ntr_ are
reserved for use within narrow-to-region. Typically the
parameter will be local to the calling function.</p>

<p style="margin-top: 1em">narrow-to-region-invisible is a
simple widget which calls narrow-to-region with arguments
which replace any text outside the region with
&lsquo;...&rsquo;.</p>

<p style="margin-top: 1em">The display is restored (and the
widget returns) upon any zle command which would usually
cause the line to be accepted or aborted. Hence an
additional such command is <br>
required to accept or abort the current line.</p>

<p style="margin-top: 1em">The return status of both
widgets is zero if the line was accepted, else non-zero.</p>

<p style="margin-top: 1em">Here is a trivial example of a
widget using this feature. <br>
local state <br>
narrow-to-region -p $&rsquo;Editing restricted region0 -P
&rsquo;&rsquo; -S state <br>
zle recursive-edit <br>
narrow-to-region -R state</p>

<p style="margin-top: 1em">predict-on <br>
This set of functions implements predictive typing using
history search. After predict-on, typing characters causes
the editor to look backward in the history for the <br>
first line beginning with what you have typed so far. After
predict-off, editing returns to normal for the line found.
In fact, you often don&rsquo;t even need to use pre&acirc;
<br>
dict-off, because if the line doesn&rsquo;t match something
in the history, adding a key performs standard completion,
and then inserts itself if no completions were found. <br>
However, editing in the middle of a line is liable to
confuse prediction; see the toggle style below.</p>

<p style="margin-top: 1em">With the function based
completion system (which is needed for this), you should be
able to type TAB at almost any point to advance the cursor
to the next &lsquo;&lsquo;interesting&rsquo;&rsquo; <br>
character position (usually the end of the current word, but
sometimes somewhere in the middle of the word). And of
course as soon as the entire line is what you want, <br>
you can accept with return, without needing to move the
cursor to the end first.</p>

<p style="margin-top: 1em">The first time predict-on is
used, it creates several additional widget functions:</p>

<p style="margin-top: 1em">delete-backward-and-predict <br>
Replaces the backward-delete-char widget. You do not need to
bind this yourself. <br>
insert-and-predict <br>
Implements predictive typing by replacing the self-insert
widget. You do not need to bind this yourself. <br>
predict-off <br>
Turns off predictive typing.</p>

<p style="margin-top: 1em">Although you autoload only the
predict-on function, it is necessary to create a keybinding
for predict-off as well.</p>

<p style="margin-top: 1em">zle -N predict-on <br>
zle -N predict-off <br>
bindkey &rsquo;^X^Z&rsquo; predict-on <br>
bindkey &rsquo;^Z&rsquo; predict-off</p>

<p style="margin-top: 1em">read-from-minibuffer <br>
This is most useful when called as a function from inside a
widget, but will work correctly as a widget in its own
right. It prompts for a value below the current command <br>
line; a value may be input using all of the standard zle
operations (and not merely the restricted set available when
executing, for example, execute-named-cmd). The <br>
value is then returned to the calling function in the
parameter $REPLY and the editing buffer restored to its
previous state. If the read was aborted by a keyboard break
<br>
(typically ^G), the function returns status 1 and $REPLY is
not set.</p>

<p style="margin-top: 1em">If one argument is supplied to
the function it is taken as a prompt, otherwise &lsquo;?
&rsquo; is used. If two arguments are supplied, they are the
prompt and the initial value of <br>
$LBUFFER, and if a third argument is given it is the initial
value of $RBUFFER. This provides a default value and
starting cursor placement. Upon return the entire buf&acirc;
<br>
fer is the value of $REPLY.</p>

<p style="margin-top: 1em">One option is available:
&lsquo;-k num&rsquo; specifies that num characters are to be
read instead of a whole line. The line editor is not invoked
recursively in this case, so <br>
depending on the terminal settings the input may not be
visible, and only the input keys are placed in $REPLY, not
the entire buffer. Note that unlike the read builtin <br>
num must be given; there is no default.</p>

<p style="margin-top: 1em">The name is a slight misnomer,
as in fact the shell&rsquo;s own minibuffer is not used.
Hence it is still possible to call executed-named-cmd and
similar functions while read&acirc; <br>
ing a value.</p>

<p style="margin-top: 1em">replace-string, replace-pattern
<br>
replace-string-again, replace-pattern-again <br>
The function replace-string implements three widgets. If
defined under the same name as the function, it prompts for
two strings; the first (source) string will be <br>
replaced by the second everywhere it occurs in the line
editing buffer.</p>

<p style="margin-top: 1em">If the widget name contains the
word &lsquo;pattern&rsquo;, for example by defining the
widget using the command &lsquo;zle -N replace-pattern
replace-string&rsquo;, then the matching is per&acirc; <br>
formed using zsh patterns. All zsh extended globbing
patterns can be used in the source string; note that unlike
filename generation the pattern does not need to match an
<br>
entire word, nor do glob qualifiers have any effect. In
addition, the replacement string can contain parameter or
command substitutions. Furthermore, a &lsquo;&amp;&rsquo; in
the <br>
replacement string will be replaced with the matched source
string, and a backquoted digit &lsquo;ill be replaced by the
Nth parenthesised expression matched. The form <br>
&lsquo;N}&rsquo; may be used to protect the digit from
following digits.</p>

<p style="margin-top: 1em">If the widget instead contains
the word &lsquo;regex&rsquo; (or &lsquo;regexp&rsquo;), then
the matching is performed using regular expressions,
respecting the setting of the option RE_MATCH_PCRE <br>
(see the description of the function regexp-replace below).
The special replacement facilities described above for
pattern matching are available.</p>

<p style="margin-top: 1em">By default the previous source
or replacement string will not be offered for editing.
However, this feature can be activated by setting the style
edit-previous in the <br>
context :zle:widget (for example, :zle:replace-string) to
true. In addition, a positive numeric argument forces the
previous values to be offered, a negative or zero <br>
argument forces them not to be.</p>

<p style="margin-top: 1em">The function
replace-string-again can be used to repeat the previous
replacement; no prompting is done. As with replace-string,
if the name of the widget contains the <br>
word &lsquo;pattern&rsquo; or &lsquo;regex&rsquo;, pattern
or regular expression matching is performed, else a literal
string replacement. Note that the previous source and
replacement text are <br>
the same whether pattern, regular expression or string
matching is used.</p>

<p style="margin-top: 1em">In addition, replace-string
shows the previous replacement above the prompt, so long as
there was one during the current session; if the source
string is empty, that <br>
replacement will be repeated without the widget prompting
for a replacement string.</p>

<p style="margin-top: 1em">For example, starting from the
line:</p>

<p style="margin-top: 1em">print This line contains fan and
fond</p>

<p style="margin-top: 1em">and invoking replace-pattern
with the source string &lsquo;f(?)n&rsquo; and the
replacement string &lsquo;c1r&rsquo; produces the not very
useful line:</p>

<p style="margin-top: 1em">print This line contains car and
cord</p>

<p style="margin-top: 1em">The range of the replacement
string can be limited by using the
narrow-to-region-invisible widget. One limitation of the
current version is that undo will cycle through <br>
changes to the replacement and source strings before undoing
the replacement itself.</p>

<p style="margin-top: 1em">send-invisible <br>
This is similar to read-from-minibuffer in that it may be
called as a function from a widget or as a widget of its
own, and interactively reads input from the keyboard. <br>
However, the input being typed is concealed and a string of
asterisks (&lsquo;*&rsquo;) is shown instead. The value is
saved in the parameter $INVISIBLE to which a reference is
<br>
inserted into the editing buffer at the restored cursor
position. If the read was aborted by a keyboard break
(typically ^G) or another escape from editing such as <br>
push-line, $INVISIBLE is set to empty and the original
buffer is restored unchanged.</p>

<p style="margin-top: 1em">If one argument is supplied to
the function it is taken as a prompt, otherwise
&lsquo;Non-echoed text: &rsquo; is used (as in emacs). If a
second and third argument are supplied they <br>
are used to begin and end the reference to $INVISIBLE that
is inserted into the buffer. The default is to open with ${,
then INVISIBLE, and close with }, but many other <br>
effects are possible.</p>

<p style="margin-top: 1em">smart-insert-last-word <br>
This function may replace the insert-last-word widget, like
so:</p>

<p style="margin-top: 1em">zle -N insert-last-word
smart-insert-last-word</p>

<p style="margin-top: 1em">With a numeric prefix, or when
passed command line arguments in a call from another widget,
it behaves like insert-last-word, except that words in
comments are ignored <br>
when INTERACTIVE_COMMENTS is set.</p>

<p style="margin-top: 1em">Otherwise, the rightmost
&lsquo;&lsquo;interesting&rsquo;&rsquo; word from the
previous command is found and inserted. The default
definition of &lsquo;&lsquo;interesting&rsquo;&rsquo; is
that the word contains at <br>
least one alphabetic character, slash, or backslash. This
definition may be overridden by use of the match style. The
context used to look up the style is the widget <br>
name, so usually the context is :insert-last-word. However,
you can bind this function to different widgets to use
different patterns:</p>

<p style="margin-top: 1em">zle -N insert-last-assignment
smart-insert-last-word <br>
zstyle :insert-last-assignment match
&rsquo;[[:alpha:]][][[:alnum:]]#=*&rsquo; <br>
bindkey &rsquo;\=&rsquo; insert-last-assignment</p>

<p style="margin-top: 1em">If no interesting word is found
and the auto-previous style is set to a true value, the
search continues upward through the history. When
auto-previous is unset or false <br>
(the default), the widget must be invoked repeatedly in
order to search earlier history lines.</p>

<p style="margin-top: 1em">transpose-lines <br>
Only useful with a multi-line editing buffer; the lines here
are lines within the current on-screen buffer, not history
lines. The effect is similar to the function of <br>
the same name in Emacs.</p>

<p style="margin-top: 1em">Transpose the current line with
the previous line and move the cursor to the start of the
next line. Repeating this (which can be done by providing a
positive numeric <br>
prefix argument) has the effect of moving the line above the
cursor down by a number of lines.</p>

<p style="margin-top: 1em">With a negative numeric prefix
argument, requires two lines above the cursor. These two
lines are transposed and the cursor moved to the start of
the previous line. <br>
Using a numeric prefix less than -1 has the effect of moving
the line above the cursor up by minus that number of
lines.</p>

<p style="margin-top: 1em">which-command <br>
This function is a drop-in replacement for the builtin
widget which-command. It has enhanced behaviour, in that it
correctly detects whether or not the command word needs <br>
to be expanded as an alias; if so, it continues tracing the
command word from the expanded alias until it reaches the
command that will be executed.</p>

<p style="margin-top: 1em">The style whence is available in
the context :zle:$WIDGET; this may be set to an array to
give the command and options that will be used to
investigate the command word <br>
found. The default is whence -c.</p>

<p style="margin-top: 1em">Utility Functions <br>
These functions are useful in constructing widgets. They
should be loaded with &lsquo;autoload -U function&rsquo; and
called as indicated from user-defined widgets.</p>

<p style="margin-top: 1em">split-shell-arguments <br>
This function splits the line currently being edited into
shell arguments and whitespace. The result is stored in the
array reply. The array contains all the parts of <br>
the line in order, starting with any whitespace before the
first argument, and finishing with any whitespace after the
last argument. Hence (so long as the option <br>
KSH_ARRAYS is not set) whitespace is given by odd indices in
the array and arguments by even indices. Note that no
stripping of quotes is done; joining together all the <br>
elements of reply in order is guaranteed to produce the
original line.</p>

<p style="margin-top: 1em">The parameter REPLY is set to
the index of the word in reply which contains the character
after the cursor, where the first element has index 1. The
parameter REPLY2 is <br>
set to the index of the character under the cursor in that
word, where the first character has index 1.</p>

<p style="margin-top: 1em">Hence reply, REPLY and REPLY2
should all be made local to the enclosing function.</p>

<p style="margin-top: 1em">See the function
modify-current-argument, described below, for an example of
how to call this function.</p>

<p style="margin-top: 1em">modify-current-argument
expr-using-$ARG <br>
This function provides a simple method of allowing
user-defined widgets to modify the command line argument
under the cursor (or immediately to the left of the cursor
if <br>
the cursor is between arguments). The argument should be an
expression which when evaluated operates on the shell
parameter ARG, which will have been set to the command <br>
line argument under the cursor. The expression should be
suitably quoted to prevent it being evaluated too early.</p>

<p style="margin-top: 1em">For example, a user-defined
widget containing the following code converts the characters
in the argument under the cursor into all upper case:</p>

<p style="margin-top: 1em">modify-current-argument
&rsquo;${(U)ARG}&rsquo;</p>

<p style="margin-top: 1em">The following strips any quoting
from the current word (whether backslashes or one of the
styles of quotes), and replaces it with single quoting
throughout:</p>

<p style="margin-top: 1em">modify-current-argument
&rsquo;${(qq)${(Q)ARG}}&rsquo;</p>

<p style="margin-top: 1em">Styles <br>
The behavior of several of the above widgets can be
controlled by the use of the zstyle mechanism. In
particular, widgets that interact with the completion system
pass along <br>
their context to any completions that they invoke.</p>

<p style="margin-top: 1em">break-keys <br>
This style is used by the incremental-complete-word widget.
Its value should be a pattern, and all keys matching this
pattern will cause the widget to stop incremental <br>
completion without the key having any further effect. Like
all styles used directly by incremental-complete-word, this
style is looked up using the context
&lsquo;:incremental&rsquo;.</p>

<p style="margin-top: 1em">completer <br>
The incremental-complete-word and insert-and-predict widgets
set up their top-level context name before calling
completion. This allows one to define different sets of <br>
completer functions for normal completion and for these
widgets. For example, to use completion, approximation and
correction for normal completion, completion and cor&acirc;
<br>
rection for incremental completion and only completion for
prediction one could use:</p>

<p style="margin-top: 1em">zstyle
&rsquo;:completion:*&rsquo; completer _complete _correct
_approximate <br>
zstyle &rsquo;:completion:incremental:*&rsquo; completer
_complete _correct <br>
zstyle &rsquo;:completion:predict:*&rsquo; completer
_complete</p>

<p style="margin-top: 1em">It is a good idea to restrict
the completers used in prediction, because they may be
automatically invoked as you type. The _list and _menu
completers should never be <br>
used with prediction. The _approximate, _correct, _expand,
and _match completers may be used, but be aware that they
may change characters anywhere in the word behind the <br>
cursor, so you need to watch carefully that the result is
what you intended.</p>

<p style="margin-top: 1em">cursor The insert-and-predict
widget uses this style, in the context
&lsquo;:predict&rsquo;, to decide where to place the cursor
after completion has been tried. Values are:</p>

<p style="margin-top: 1em">complete <br>
The cursor is left where it was when completion finished,
but only if it is after a character equal to the one just
inserted by the user. If it is after another <br>
character, this value is the same as &lsquo;key&rsquo;.</p>

<p style="margin-top: 1em">key The cursor is left after the
nth occurrence of the character just inserted, where n is
the number of times that character appeared in the word
before completion was <br>
attempted. In short, this has the effect of leaving the
cursor after the character just typed even if the completion
code found out that no other characters need <br>
to be inserted at that position.</p>

<p style="margin-top: 1em">Any other value for this style
unconditionally leaves the cursor at the position where the
completion code left it.</p>

<p style="margin-top: 1em">list When using the
incremental-complete-word widget, this style says if the
matches should be listed on every key press (if they fit on
the screen). Use the context prefix <br>
&lsquo;:completion:incremental&rsquo;.</p>

<p style="margin-top: 1em">The insert-and-predict widget
uses this style to decide if the completion should be shown
even if there is only one possible completion. This is done
if the value of this <br>
style is the string always. In this case the context is
&lsquo;:predict&rsquo; (not
&lsquo;:completion:predict&rsquo;).</p>

<p style="margin-top: 1em">match This style is used by
smart-insert-last-word to provide a pattern (using full
EXTENDED_GLOB syntax) that matches an interesting word. The
context is the name of the wid&acirc; <br>
get to which smart-insert-last-word is bound (see above).
The default behavior of smart-insert-last-word is equivalent
to:</p>

<p style="margin-top: 1em">zstyle :insert-last-word match
&rsquo;*[[:alpha:]/\]*&rsquo;</p>

<p style="margin-top: 1em">However, you might want to
include words that contain spaces:</p>

<p style="margin-top: 1em">zstyle :insert-last-word match
&rsquo;*[[:alpha:][:space:]/\]*&rsquo;</p>

<p style="margin-top: 1em">Or include numbers as long as
the word is at least two characters long:</p>

<p style="margin-top: 1em">zstyle :insert-last-word match
&rsquo;*([[:digit:]]?|[[:alpha:]/\])*&rsquo;</p>

<p style="margin-top: 1em">The above example causes
redirections like &quot;2&gt;&quot; to be included.</p>

<p style="margin-top: 1em">prompt The
incremental-complete-word widget shows the value of this
style in the status line during incremental completion. The
string value may contain any of the following <br>
substrings in the manner of the PS1 and other prompt
parameters:</p>

<p style="margin-top: 1em">%c Replaced by the name of the
completer function that generated the matches (without the
leading underscore).</p>

<p style="margin-top: 1em">%l When the list style is set,
replaced by &lsquo;...&rsquo; if the list of matches is too
long to fit on the screen and with an empty string
otherwise. If the list style is <br>
&lsquo;false&rsquo; or not set, &lsquo;%l&rsquo; is always
removed.</p>

<p style="margin-top: 1em">%n Replaced by the number of
matches generated.</p>

<p style="margin-top: 1em">%s Replaced by &lsquo;-no
match-&rsquo;, &lsquo;-no prefix-&rsquo;, or an empty string
if there is no completion matching the word on the line, if
the matches have no common prefix different <br>
from the word on the line, or if there is such a common
prefix, respectively.</p>

<p style="margin-top: 1em">%u Replaced by the unambiguous
part of all matches, if there is any, and if it is different
from the word on the line.</p>

<p style="margin-top: 1em">Like &lsquo;break-keys&rsquo;,
this uses the &lsquo;:incremental&rsquo; context.</p>

<p style="margin-top: 1em">stop-keys <br>
This style is used by the incremental-complete-word widget.
Its value is treated similarly to the one for the break-keys
style (and uses the same context: &lsquo;:incremen&acirc;
<br>
tal&rsquo;). However, in this case all keys matching the
pattern given as its value will stop incremental completion
and will then execute their usual function.</p>

<p style="margin-top: 1em">toggle This boolean style is
used by predict-on and its related widgets in the context
&lsquo;:predict&rsquo;. If set to one of the standard
&lsquo;true&rsquo; values, predictive typing is
automati&acirc; <br>
cally toggled off in situations where it is unlikely to be
useful, such as when editing a multi-line buffer or after
moving into the middle of a line and then deleting a <br>
character. The default is to leave prediction turned on
until an explicit call to predict-off.</p>

<p style="margin-top: 1em">verbose <br>
This boolean style is used by predict-on and its related
widgets in the context &lsquo;:predict&rsquo;. If set to one
of the standard &lsquo;true&rsquo; values, these widgets
display a message <br>
below the prompt when the predictive state is toggled. This
is most useful in combination with the toggle style. The
default does not display these messages.</p>

<p style="margin-top: 1em">widget This style is similar to
the command style: For widget functions that use zle to call
other widgets, this style can sometimes be used to override
the widget which is <br>
called. The context for this style is the name of the
calling widget (not the name of the calling function,
because one function may be bound to multiple widget
names).</p>

<p style="margin-top: 1em">zstyle :copy-earlier-word widget
smart-insert-last-word</p>

<p style="margin-top: 1em">Check the documentation for the
calling widget or function to determine whether the widget
style is used.</p>

<p style="margin-top: 1em">EXCEPTION HANDLING <br>
Two functions are provided to enable zsh to provide
exception handling in a form that should be familiar from
other languages.</p>

<p style="margin-top: 1em">throw exception <br>
The function throw throws the named exception. The name is
an arbitrary string and is only used by the throw and catch
functions. An exception is for the most part <br>
treated the same as a shell error, i.e. an unhandled
exception will cause the shell to abort all processing in a
function or script and to return to the top level in an <br>
interactive shell.</p>

<p style="margin-top: 1em">catch exception-pattern <br>
The function catch returns status zero if an exception was
thrown and the pattern exception-pattern matches its name.
Otherwise it returns status 1. exception-pattern is <br>
a standard shell pattern, respecting the current setting of
the EXTENDED_GLOB option. An alias catch is also defined to
prevent the argument to the function from matching <br>
filenames, so patterns may be used unquoted. Note that as
exceptions are not fundamentally different from other shell
errors it is possible to catch shell errors by using <br>
an empty string as the exception name. The shell variable
CAUGHT is set by catch to the name of the exception caught.
It is possible to rethrow an exception by calling <br>
the throw function again once an exception has been
caught.</p>

<p style="margin-top: 1em">The functions are designed to be
used together with the always construct described in
zshmisc(1). This is important as only this construct
provides the required support for <br>
exceptions. A typical example is as follows.</p>

<p style="margin-top: 1em">{ <br>
# &quot;try&quot; block <br>
# ... nested code here calls &quot;throw MyExcept&quot; <br>
} always { <br>
# &quot;always&quot; block <br>
if catch MyExcept; then <br>
print &quot;Caught exception MyExcept&quot; <br>
elif catch &rsquo;&rsquo;; then <br>
print &quot;Caught a shell error. Propagating...&quot; <br>
throw &rsquo;&rsquo; <br>
fi <br>
# Other exceptions are not handled but may be caught further
<br>
# up the call stack. <br>
}</p>

<p style="margin-top: 1em">If all exceptions should be
caught, the following idiom might be preferable.</p>

<p style="margin-top: 1em">{ <br>
# ... nested code here throws an exception <br>
} always { <br>
if catch *; then <br>
case $CAUGHT in <br>
(MyExcept) <br>
print &quot;Caught my own exception&quot; <br>
;; <br>
(*) <br>
print &quot;Caught some other exception&quot; <br>
;; <br>
esac <br>
fi <br>
}</p>

<p style="margin-top: 1em">In common with exception
handling in other languages, the exception may be thrown by
code deeply nested inside the &lsquo;try&rsquo; block.
However, note that it must be thrown inside the <br>
current shell, not in a subshell forked for a pipeline,
parenthesised current-shell construct, or some form of
command or process substitution.</p>

<p style="margin-top: 1em">The system internally uses the
shell variable EXCEPTION to record the name of the exception
between throwing and catching. One drawback of this scheme
is that if the exception <br>
is not handled the variable EXCEPTION remains set and may be
incorrectly recognised as the name of an exception if a
shell error subsequently occurs. Adding unset EXCEPTION at
<br>
the start of the outermost layer of any code that uses
exception handling will eliminate this problem.</p>

<p style="margin-top: 1em">MIME FUNCTIONS <br>
Three functions are available to provide handling of files
recognised by extension, for example to dispatch a file
text.ps when executed as a command to an appropriate
viewer.</p>

<p style="margin-top: 1em">zsh-mime-setup [ -fv ] [ -l [
suffix ... ] ] <br>
zsh-mime-handler [-l] command arguments ... <br>
These two functions use the files ~/.mime.types and
/etc/mime.types, which associate types and extensions, as
well as ~/.mailcap and /etc/mailcap files, which associate
<br>
types and the programs that handle them. These are provided
on many systems with the Multimedia Internet Mail
Extensions.</p>

<p style="margin-top: 1em">To enable the system, the
function zsh-mime-setup should be autoloaded and run. This
allows files with extensions to be treated as executable;
such files be completed by <br>
the function completion system. The function
zsh-mime-handler should not need to be called by the
user.</p>

<p style="margin-top: 1em">The system works by setting up
suffix aliases with &lsquo;alias -s&rsquo;. Suffix aliases
already installed by the user will not be overwritten.</p>

<p style="margin-top: 1em">For suffixes defined in lower
case, upper case variants will also automatically be handled
(e.g. PDF is automatically handled if handling for the
suffix pdf is defined), <br>
but not vice versa.</p>

<p style="margin-top: 1em">Repeated calls to zsh-mime-setup
do not override the existing mapping between suffixes and
executable files unless the option -f is given. Note,
however, that this does <br>
not override existing suffix aliases assigned to handlers
other than zsh-mime-handler.</p>

<p style="margin-top: 1em">Calling zsh-mime-setup with the
option -l lists the existing mappings without altering them.
Suffixes to list (which may contain pattern characters that
should be quoted <br>
from immediate interpretation on the command line) may be
given as additional arguments, otherwise all suffixes are
listed.</p>

<p style="margin-top: 1em">Calling zsh-mime-setup with the
option -v causes verbose output to be shown during the setup
operation.</p>

<p style="margin-top: 1em">The system respects the mailcap
flags needsterminal and copiousoutput, see mailcap(4).</p>

<p style="margin-top: 1em">The functions use the following
styles, which are defined with the zstyle builtin command
(see zshmodules(1)). They should be defined before
zsh-mime-setup is run. The <br>
contexts used all start with :mime:, with additional
components in some cases. It is recommended that a trailing
* (suitably quoted) be appended to style patterns in case
<br>
the system is extended in future. Some examples are given
below.</p>

<p style="margin-top: 1em">For files that have multiple
suffixes, e.g. .pdf.gz, where the context includes the
suffix it will be looked up starting with the longest
possible suffix until a match for <br>
the style is found. For example, if .pdf.gz produces a match
for the handler, that will be used; otherwise the handler
for .gz will be used. Note that, owing to the way <br>
suffix aliases work, it is always required that there be a
handler for the shortest possible suffix, so in this example
.pdf.gz can only be handled if .gz is also handled <br>
(though not necessarily in the same way). Alternatively, if
no handling for .gz on its own is needed, simply adding the
command</p>

<p style="margin-top: 1em">alias -s gz=zsh-mime-handler</p>

<p style="margin-top: 1em">to the initialisation code is
sufficient; .gz will not be handled on its own, but may be
in combination with other suffixes.</p>

<p style="margin-top: 1em">current-shell <br>
If this boolean style is true, the mailcap handler for the
context in question is run using the eval builtin instead of
by starting a new sh process. This is more <br>
efficient, but may not work in the occasional cases where
the mailcap handler uses strict POSIX syntax.</p>

<p style="margin-top: 1em">execute-as-is <br>
This style gives a list of patterns to be matched against
files passed for execution with a handler program. If the
file matches the pattern, the entire command <br>
line is executed in its current form, with no handler. This
is useful for files which might have suffixes but
nonetheless be executable in their own right. If the <br>
style is not set, the pattern *(*) *(/) is used; hence
executable files are executed directly and not passed to a
handler, and the option AUTO_CD may be used to <br>
change to directories that happen to have MIME suffixes.</p>

<p style="margin-top: 1em">file-path <br>
Used if the style find-file-in-path is true for the same
context. Set to an array of directories that are used for
searching for the file to be handled; the <br>
default is the command path given by the special parameter
path. The shell option PATH_DIRS is respected; if that is
set, the appropriate path will be searched <br>
even if the name of the file to be handled as it appears on
the command line contains a &lsquo;/&rsquo;. The full
context is :mime:.suffix:, as described for the style
han&acirc; <br>
dler.</p>

<p style="margin-top: 1em">find-file-in-path <br>
If set, allows files whose names do not contain absolute
paths to be searched for in the command path or the path
specified by the file-path style. If the file is <br>
not found in the path, it is looked for locally (whether or
not the current directory is in the path); if it is not
found locally, the handler will abort unless the <br>
handle-nonexistent style is set. Files found in the path are
tested as described for the style execute-as-is. The full
context is :mime:.suffix:, as described for <br>
the style handler.</p>

<p style="margin-top: 1em">flags Defines flags to go with a
handler; the context is as for the handler style, and the
format is as for the flags in mailcap.</p>

<p style="margin-top: 1em">handle-nonexistent <br>
By default, arguments that don&rsquo;t correspond to files
are not passed to the MIME handler in order to prevent it
from intercepting commands found in the path that <br>
happen to have suffixes. This style may be set to an array
of extended glob patterns for arguments that will be passed
to the handler even if they don&rsquo;t exist. If <br>
it is not explicitly set it defaults to [[:alpha:]]#:/*
which allows URLs to be passed to the MIME handler even
though they don&rsquo;t exist in that format in the file
<br>
system. The full context is :mime:.suffix:, as described for
the style handler.</p>

<p style="margin-top: 1em">handler <br>
Specifies a handler for a suffix; the suffix is given by the
context as :mime:.suffix:, and the format of the handler is
exactly that in mailcap. Note in particu&acirc; <br>
lar the &lsquo;.&rsquo; and trailing colon to distinguish
this use of the context. This overrides any handler
specified by the mailcap files. If the handler requires a
termi&acirc; <br>
nal, the flags style should be set to include the word
needsterminal, or if the output is to be displayed through a
pager (but not if the handler is itself a <br>
pager), it should include copiousoutput.</p>

<p style="margin-top: 1em">mailcap <br>
A list of files in the format of ~/.mailcap and /etc/mailcap
to be read during setup, replacing the default list which
consists of those two files. The context is <br>
:mime:. A + in the list will be replaced by the default
files.</p>

<p style="margin-top: 1em">mailcap-priorities <br>
This style is used to resolve multiple mailcap entries for
the same MIME type. It consists of an array of the following
elements, in descending order of priority; <br>
later entries will be used if earlier entries are unable to
resolve the entries being compared. If none of the tests
resolve the entries, the first entry encoun&acirc; <br>
tered is retained.</p>

<p style="margin-top: 1em">files The order of files
(entries in the mailcap style) read. Earlier files are
preferred. (Note this does not resolve entries in the same
file.)</p>

<p style="margin-top: 1em">priority <br>
The priority flag from the mailcap entry. The priority is an
integer from 0 to 9 with the default value being 5.</p>

<p style="margin-top: 1em">flags The test given by the
mailcap-prio-flags option is used to resolve entries.</p>

<p style="margin-top: 1em">place Later entries are
preferred; as the entries are strictly ordered, this test
always succeeds.</p>

<p style="margin-top: 1em">Note that as this style is
handled during initialisation, the context is always :mime:,
with no discrimination by suffix.</p>

<p style="margin-top: 1em">mailcap-prio-flags <br>
This style is used when the keyword flags is encountered in
the list of tests specified by the mailcap-priorities style.
It should be set to a list of patterns, <br>
each of which is tested against the flags specified in the
mailcap entry (in other words, the sets of assignments found
with some entries in the mailcap file). <br>
Earlier patterns in the list are preferred to later ones,
and matched patterns are preferred to unmatched ones.</p>

<p style="margin-top: 1em">mime-types <br>
A list of files in the format of ~/.mime.types and
/etc/mime.types to be read during setup, replacing the
default list which consists of those two files. The
con&acirc; <br>
text is :mime:. A + in the list will be replaced by the
default files.</p>

<p style="margin-top: 1em">never-background <br>
If this boolean style is set, the handler for the given
context is always run in the foreground, even if the flags
provided in the mailcap entry suggest it need not <br>
be (for example, it doesn&rsquo;t require a terminal).</p>

<p style="margin-top: 1em">pager If set, will be used
instead of $PAGER or more to handle suffixes where the
copiousoutput flag is set. The context is as for handler,
i.e. :mime:.suffix: for han&acirc; <br>
dling a file with the given suffix.</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">zstyle &rsquo;:mime:*&rsquo;
mailcap ~/.mailcap /usr/local/etc/mailcap <br>
zstyle &rsquo;:mime:.txt:&rsquo; handler less %s <br>
zstyle &rsquo;:mime:.txt:&rsquo; flags needsterminal</p>

<p style="margin-top: 1em">When zsh-mime-setup is
subsequently run, it will look for mailcap entries in the
two files given. Files of suffix .txt will be handled by
running &lsquo;less file.txt&rsquo;. The <br>
flag needsterminal is set to show that this program must run
attached to a terminal.</p>

<p style="margin-top: 1em">As there are several steps to
dispatching a command, the following should be checked if
attempting to execute a file by extension .ext does not have
the expected effect.</p>

<p style="margin-top: 1em">The command &lsquo;alias -s
ext&rsquo; should show &lsquo;ps=zsh-mime-handler&rsquo;. If
it shows something else, another suffix alias was already
installed and was not overwritten. If it shows <br>
nothing, no handler was installed: this is most likely
because no handler was found in the .mime.types and mailcap
combination for .ext files. In that case, appropriate <br>
handling should be added to ~/.mime.types and mailcap.</p>

<p style="margin-top: 1em">If the extension is handled by
zsh-mime-handler but the file is not opened correctly,
either the handler defined for the type is incorrect, or the
flags associated with it <br>
are in appropriate. Running zsh-mime-setup -l will show the
handler and, if there are any, the flags. A %s in the
handler is replaced by the file (suitably quoted if <br>
necessary). Check that the handler program listed lists and
can be run in the way shown. Also check that the flags
needsterminal or copiousoutput are set if the handler <br>
needs to be run under a terminal; the second flag is used if
the output should be sent to a pager. An example of a
suitable mailcap entry for such a program is:</p>

<p style="margin-top: 1em">text/html; /usr/bin/lynx
&rsquo;%s&rsquo;; needsterminal</p>

<p style="margin-top: 1em">Running &lsquo;zsh-mime-handler
-l command line&rsquo; prints the command line that would be
executed, simplified to remove the effect of any flags, and
quoted so that the output can <br>
be run as a complete zsh command line. This is used by the
completion system to decide how to complete after a file
handled by zsh-mime-setup.</p>

<p style="margin-top: 1em">pick-web-browser <br>
This function is separate from the two MIME functions
described above and can be assigned directly to a
suffix:</p>

<p style="margin-top: 1em">autoload -U pick-web-browser
<br>
alias -s html=pick-web-browser</p>

<p style="margin-top: 1em">It is provided as an intelligent
front end to dispatch a web browser. It may be run as either
a function or a shell script. The status 255 is returned if
no browser <br>
could be started.</p>

<p style="margin-top: 1em">Various styles are available to
customize the choice of browsers:</p>

<p style="margin-top: 1em">browser-style <br>
The value of the style is an array giving preferences in
decreasing order for the type of browser to use. The values
of elements may be</p>

<p style="margin-top: 1em">running <br>
Use a GUI browser that is already running when an X Window
display is available. The browsers listed in the x-browsers
style are tried in order until one is <br>
found; if it is, the file will be displayed in that browser,
so the user may need to check whether it has appeared. If no
running browser is found, one is <br>
not started. Browsers other than Firefox, Opera and
Konqueror are assumed to understand the Mozilla syntax for
opening a URL remotely.</p>

<p style="margin-top: 1em">x Start a new GUI browser when
an X Window display is available. Search for the
availability of one of the browsers listed in the x-browsers
style and start <br>
the first one that is found. No check is made for an already
running browser.</p>

<p style="margin-top: 1em">tty Start a terminal-based
browser. Search for the availability of one of the browsers
listed in the tty-browsers style and start the first one
that is found.</p>

<p style="margin-top: 1em">If the style is not set the
default running x tty is used.</p>

<p style="margin-top: 1em">x-browsers <br>
An array in decreasing order of preference of browsers to
use when running under the X Window System. The array
consists of the command name under which to start <br>
the browser. They are looked up in the context :mime: (which
may be extended in future, so appending &lsquo;*&rsquo; is
recommended). For example,</p>

<p style="margin-top: 1em">zstyle &rsquo;:mime:*&rsquo;
x-browsers opera konqueror firefox</p>

<p style="margin-top: 1em">specifies that pick-web-browser
should first look for a running instance of Opera, Konqueror
or Firefox, in that order, and if it fails to find any
should attempt <br>
to start Opera. The default is firefox mozilla netscape
opera konqueror.</p>

<p style="margin-top: 1em">tty-browsers <br>
An array similar to x-browsers, except that it gives
browsers to use when no X Window display is available. The
default is elinks links lynx.</p>

<p style="margin-top: 1em">command <br>
If it is set this style is used to pick the command used to
open a page for a browser. The context is
:mime:browser:new:$browser: to start a new browser or <br>
:mime:browser:running:$browser: to open a URL in a browser
already running on the current X display, where $browser is
the value matched in the x-browsers or <br>
tty-browsers style. The escape sequence %b in the
style&rsquo;s value will be replaced by the browser, while
%u will be replaced by the URL. If the style is not set,
<br>
the default for all new instances is equivalent to %b %u and
the defaults for using running browsers are equivalent to
the values kfmclient openURL %u for Kon&acirc; <br>
queror, firefox -new-tab %u for Firefox, opera -newpage %u
for Opera, and %b -remote &quot;openUrl(%u)&quot; for all
others.</p>

<p style="margin-top: 1em">MATHEMATICAL FUNCTIONS <br>
zcalc [ expression ... ] <br>
A reasonably powerful calculator based on zsh&rsquo;s
arithmetic evaluation facility. The syntax is similar to
that of formulae in most programming languages; see the
section <br>
&lsquo;Arithmetic Evaluation&rsquo; in zshmisc(1) for
details. The mathematical library zsh/mathfunc will be
loaded if it is available; see the section &lsquo;The
zsh/mathfunc Module&rsquo; in <br>
zshmodules(1). The mathematical functions correspond to the
raw system libraries, so trigonometric functions are
evaluated using radians, and so on.</p>

<p style="margin-top: 1em">Each line typed is evaluated as
an expression. The prompt shows a number, which corresponds
to a positional parameter where the result of that
calculation is stored. For <br>
example, the result of the calculation on the line preceded
by &lsquo;4&gt; &rsquo; is available as $4. The last value
calculated is available as ans. Full command line editing,
<br>
including the history of previous calculations, is
available; the history is saved in the file
~/.zcalc_history. To exit, enter a blank line or type
&lsquo;:q&rsquo; on its own (&lsquo;q&rsquo; <br>
is allowed for historical compatibility).</p>

<p style="margin-top: 1em">If arguments are given to zcalc
on start up, they are used to prime the first few positional
parameters. A visual indication of this is given when the
calculator starts.</p>

<p style="margin-top: 1em">The constants PI (3.14159...)
and E (2.71828...) are provided. Parameter assignment is
possible, but note that all parameters will be put into the
global namespace.</p>

<p style="margin-top: 1em">The output base can be
initialised by passing the option &lsquo;-#base&rsquo;, for
example &lsquo;zcalc -#16&rsquo; (the &lsquo;#&rsquo; may
have to be quoted, depending on the globbing options
set).</p>

<p style="margin-top: 1em">The prompt is configurable via
the parameter ZCALCPROMPT, which undergoes standard prompt
expansion. The index of the current entry is stored locally
in the first element <br>
of the array psvar, which can be referred to in ZCALCPROMPT
as &lsquo;%1v&rsquo;. The default prompt is &lsquo;%1v&gt;
&rsquo;.</p>

<p style="margin-top: 1em">A few special commands are
available; these are introduced by a colon. For backward
compatibility, the colon may be omitted for certain
commands. Completion is available <br>
if compinit has been run.</p>

<p style="margin-top: 1em">The output precision may be
specified within zcalc by special commands familiar from
many calculators. <br>
:norm The default output format. It corresponds to the
printf %g specification. Typically this shows six decimal
digits.</p>

<p style="margin-top: 1em">:sci digits <br>
Scientific notation, corresponding to the printf %g output
format with the precision given by digits. This produces
either fixed point or exponential notation <br>
depending on the value output.</p>

<p style="margin-top: 1em">:fix digits <br>
Fixed point notation, corresponding to the printf %f output
format with the precision given by digits.</p>

<p style="margin-top: 1em">:eng digits <br>
Exponential notation, corresponding to the printf %E output
format with the precision given by digits.</p>

<p style="margin-top: 1em">:raw Raw output: this is the
default form of the output from a math evaluation. This may
show more precision than the number actually possesses.</p>

<p style="margin-top: 1em">Other special commands: <br>
:!line... <br>
Execute line... as a normal shell command line. Note that it
is executed in the context of the function, i.e. with local
variables. Space is optional after :!.</p>

<p style="margin-top: 1em">:local arg ... <br>
Declare variables local to the function. Note that certain
variables are used by the function for its own purposes.
Other variables may be used, too, but they <br>
will be taken from or put into the global scope.</p>

<p style="margin-top: 1em">:function name [ body ] <br>
Define a mathematical function or (with no body) delete it.
The function is defined using zmathfuncdef, see below.</p>

<p style="margin-top: 1em">Note that zcalc takes care of
all quoting. Hence for example:</p>

<p style="margin-top: 1em">function cube $1 * $1 * $1</p>

<p style="margin-top: 1em">defines a function to cube the
sole argument.</p>

<p style="margin-top: 1em">[#base] <br>
This is not a special command, rather part of normal
arithmetic syntax; however, when this form appears on a line
by itself the default output radix is set to base. <br>
Use, for example, &lsquo;[#16]&rsquo; to display hexadecimal
output preceded by an indication of the base, or
&lsquo;[##16]&rsquo; just to display the raw number in the
given base. Bases <br>
themselves are always specified in decimal.
&lsquo;[#]&rsquo; restores the normal output format. Note
that setting an output base suppresses floating point
output; use &lsquo;[#]&rsquo; <br>
to return to normal operation.</p>

<p style="margin-top: 1em">See the comments in the function
for a few extra tips.</p>

<p style="margin-top: 1em">zmathfuncdef [ mathfunc [ body ]
] <br>
A convenient front end to functions -M.</p>

<p style="margin-top: 1em">With two arguments, define a
mathematical function named mathfunc which can be used in
any form of arithmetic evaluation. body is a mathematical
expression to implement <br>
the function. It may contain references to position
parameters $1, $2, ... to refer to mandatory parameters and
${1:-defvalue} ... to refer to optional parameters. <br>
Note that the forms must be strictly adhered to for the
function to calculate the correct number of arguments. The
implementation is held in a shell function named <br>
zsh_math_func_mathfunc; usually the user will not need to
refer to the shell function directly. Any existing function
of the same name is silently replaced.</p>

<p style="margin-top: 1em">With one argument, remove the
mathematical function mathfunc as well as the shell function
implementation.</p>

<p style="margin-top: 1em">With no arguments, list all
mathfunc functions in a form suitable for restoring the
definition. The functions have not necessarily been defined
by zmathfuncdef.</p>

<p style="margin-top: 1em">USER CONFIGURATION FUNCTIONS
<br>
The zsh/newuser module comes with a function to aid in
configuring shell options for new users. If the module is
installed, this function can also be run by hand. It is
avail&acirc; <br>
able even if the module&rsquo;s default behaviour, namely
running the function for a new user logging in without
startup files, is inhibited.</p>

<p style="margin-top: 1em">zsh-newuser-install [ -f ] <br>
The function presents the user with various options for
customizing their initialization scripts. Currently only
~/.zshrc is handled. $ZDOTDIR/.zshrc is used instead if <br>
the parameter ZDOTDIR is set; this provides a way for the
user to configure a file without altering an existing
.zshrc.</p>

<p style="margin-top: 1em">By default the function exits
immediately if it finds any of the files .zshenv, .zprofile,
.zshrc, or .zlogin in the appropriate directory. The option
-f is required in <br>
order to force the function to continue. Note this may
happen even if .zshrc itself does not exist.</p>

<p style="margin-top: 1em">As currently configured, the
function will exit immediately if the user has root
privileges; this behaviour cannot be overridden.</p>

<p style="margin-top: 1em">Once activated, the
function&rsquo;s behaviour is supposed to be
self-explanatory. Menus are present allowing the user to
alter the value of options and parameters. Sugges&acirc;
<br>
tions for improvements are always welcome.</p>

<p style="margin-top: 1em">When the script exits, the user
is given the opportunity to save the new file or not;
changes are not irreversible until this point. However, the
script is careful to <br>
restrict changes to the file only to a group marked by the
lines &lsquo;# Lines configured by
zsh-newuser-install&rsquo; and &lsquo;# End of lines
configured by zsh-newuser-install&rsquo;. In <br>
addition, the old version of .zshrc is saved to a file with
the suffix .zni appended.</p>

<p style="margin-top: 1em">If the function edits an
existing .zshrc, it is up to the user to ensure that the
changes made will take effect. For example, if control
usually returns early from the <br>
existing .zshrc the lines will not be executed; or a later
initialization file may override options or parameters, and
so on. The function itself does not attempt to <br>
detect any such conflicts.</p>

<p style="margin-top: 1em">OTHER FUNCTIONS <br>
There are a large number of helpful functions in the
Functions/Misc directory of the zsh distribution. Most are
very simple and do not require documentation here, but a few
are <br>
worthy of special mention.</p>

<p style="margin-top: 1em">Descriptions <br>
colors This function initializes several associative arrays
to map color names to (and from) the ANSI standard
eight-color terminal codes. These are used by the prompt
theme <br>
system (see above). You seldom should need to run colors
more than once.</p>

<p style="margin-top: 1em">The eight base colors are:
black, red, green, yellow, blue, magenta, cyan, and white.
Each of these has codes for foreground and background. In
addition there are eight <br>
intensity attributes: bold, faint, standout, underline,
blink, reverse, and conceal. Finally, there are six codes
used to negate attributes: none (reset all attributes to
<br>
the defaults), normal (neither bold nor faint), no-standout,
no-underline, no-blink, and no-reverse.</p>

<p style="margin-top: 1em">Some terminals do not support
all combinations of colors and intensities.</p>

<p style="margin-top: 1em">The associative arrays are:</p>

<p style="margin-top: 1em">color <br>
colour Map all the color names to their integer codes, and
integer codes to the color names. The eight base names map
to the foreground color codes, as do names prefixed <br>
with &lsquo;fg-&rsquo;, such as &lsquo;fg-red&rsquo;. Names
prefixed with &lsquo;bg-&rsquo;, such as
&lsquo;bg-blue&rsquo;, refer to the background codes. The
reverse mapping from code to color yields base name <br>
for foreground codes and the bg- form for backgrounds.</p>

<p style="margin-top: 1em">Although it is a misnomer to
call them &lsquo;colors&rsquo;, these arrays also map the
other fourteen attributes from names to codes and codes to
names.</p>

<p style="margin-top: 1em">fg <br>
fg_bold <br>
fg_no_bold <br>
Map the eight basic color names to ANSI terminal escape
sequences that set the corresponding foreground text
properties. The fg sequences change the color without <br>
changing the eight intensity attributes.</p>

<p style="margin-top: 1em">bg <br>
bg_bold <br>
bg_no_bold <br>
Map the eight basic color names to ANSI terminal escape
sequences that set the corresponding background properties.
The bg sequences change the color without <br>
changing the eight intensity attributes.</p>

<p style="margin-top: 1em">In addition, the scalar
parameters reset_color and bold_color are set to the ANSI
terminal escapes that turn off all attributes and turn on
bold intensity, respectively.</p>

<p style="margin-top: 1em">fned name <br>
Same as zed -f. This function does not appear in the zsh
distribution, but can be created by linking zed to the name
fned in some directory in your fpath.</p>

<p style="margin-top: 1em">is-at-least needed [ present ]
<br>
Perform a greater-than-or-equal-to comparison of two strings
having the format of a zsh version number; that is, a string
of numbers and text with segments separated by <br>
dots or dashes. If the present string is not provided,
$ZSH_VERSION is used. Segments are paired left-to-right in
the two strings with leading non-number parts ignored. <br>
If one string has fewer segments than the other, the missing
segments are considered zero.</p>

<p style="margin-top: 1em">This is useful in startup files
to set options and other state that are not available in all
versions of zsh.</p>

<p style="margin-top: 1em">is-at-least 3.1.6-15 &amp;&amp;
setopt NO_GLOBAL_RCS <br>
is-at-least 3.1.0 &amp;&amp; setopt HIST_REDUCE_BLANKS <br>
is-at-least 2.6-17 || print &quot;You can&rsquo;t use
is-at-least here.&quot;</p>

<p style="margin-top: 1em">nslookup [ arg ... ] <br>
This wrapper function for the nslookup command requires the
zsh/zpty module (see zshmodules(1)). It behaves exactly like
the standard nslookup except that it provides <br>
customizable prompts (including a right-side prompt) and
completion of nslookup commands, host names, etc. (if you
use the function-based completion system). Completion <br>
styles may be set with the context prefix
&lsquo;:completion:nslookup&rsquo;.</p>

<p style="margin-top: 1em">See also the pager, prompt and
rprompt styles below.</p>

<p style="margin-top: 1em">regexp-replace var regexp
replace <br>
Use regular expressions to perform a global search and
replace operation on a variable. If the option RE_MATCH_PCRE
is not set, POSIX extended regular expressions are <br>
used, else Perl-compatible regular expressions (this
requires the shell to be linked against the pcre
library).</p>

<p style="margin-top: 1em">var is the name of the variable
containing the string to be matched. The variable will be
modified directly by the function. The variables MATCH,
MBEGIN, MEND, match, <br>
mbegin, mend should be avoided as these are used by the
regular expression code.</p>

<p style="margin-top: 1em">regexp is the regular expression
to match against the string.</p>

<p style="margin-top: 1em">replace is the replacement text.
This can contain parameter, command and arithmetic
expressions which will be replaced: in particular, a
reference to $MATCH will be <br>
replaced by the text matched by the pattern.</p>

<p style="margin-top: 1em">The return status is 0 if at
least one match was performed, else 1.</p>

<p style="margin-top: 1em">run-help cmd <br>
This function is designed to be invoked by the run-help ZLE
widget, in place of the default alias. See &lsquo;Accessing
On-Line Help&rsquo; above for setup instructions.</p>

<p style="margin-top: 1em">In the discussion which follows,
if cmd is a file system path, it is first reduced to its
rightmost component (the file name).</p>

<p style="margin-top: 1em">Help is first sought by looking
for a file named cmd in the directory named by the HELPDIR
parameter. If no file is found, an assistant function,
alias, or command named <br>
run-help-cmd is sought. If found, the assistant is executed
with the rest of the current command line (everything after
the command name cmd) as its arguments. When nei&acirc; <br>
ther file nor assistant is found, the external command
&lsquo;man cmd&rsquo; is run.</p>

<p style="margin-top: 1em">An example assistant for the
&quot;ssh&quot; command:</p>

<p style="margin-top: 1em">run-help-ssh() { <br>
emulate -LR zsh <br>
local -a args <br>
# Delete the &quot;-l username&quot; option <br>
zparseopts -D -E -a args l: <br>
# Delete other options, leaving: host command <br>
args=(${@:#-*}) <br>
if [[ ${#args} -lt 2 ]]; then <br>
man ssh <br>
else <br>
run-help $args[2] <br>
fi <br>
}</p>

<p style="margin-top: 1em">Several of these assistants are
provided in the Functions/Misc directory. These must be
autoloaded, or placed as executable scripts in your search
path, in order to be <br>
found and used by run-help.</p>

<p style="margin-top: 1em">run-help-git <br>
run-help-svk <br>
run-help-svn <br>
Assistant functions for the git, svk, and svn commands.</p>

<p style="margin-top: 1em">tetris Zsh was once accused of
not being as complete as Emacs, because it lacked a Tetris
game. This function was written to refute this vicious
slander.</p>

<p style="margin-top: 1em">This function must be used as a
ZLE widget:</p>

<p style="margin-top: 1em">autoload -U tetris <br>
zle -N tetris <br>
bindkey keys tetris</p>

<p style="margin-top: 1em">To start a game, execute the
widget by typing the keys. Whatever command line you were
editing disappears temporarily, and your keymap is also
temporarily replaced by the <br>
Tetris control keys. The previous editor state is restored
when you quit the game (by pressing &lsquo;q&rsquo;) or when
you lose.</p>

<p style="margin-top: 1em">If you quit in the middle of a
game, the next invocation of the tetris widget will continue
where you left off. If you lost, it will start a new
game.</p>

<p style="margin-top: 1em">zargs [ option ... -- ] [ input
... ] [ -- command [ arg ... ] ] <br>
This function has a similar purpose to GNU xargs. Instead of
reading lines of arguments from the standard input, it takes
them from the command line. This is useful <br>
because zsh, especially with recursive glob operators, often
can construct a command line for a shell function that is
longer than can be accepted by an external command.</p>

<p style="margin-top: 1em">The option list represents
options of the zargs command itself, which are the same as
those of xargs. The input list is the collection of strings
(often file names) that <br>
become the arguments of the command, analogous to the
standard input of xargs. Finally, the arg list consists of
those arguments (usually options) that are passed to the
<br>
command each time it runs. The arg list precedes the
elements from the input list in each run. If no command is
provided, then no arg list may be provided, and in that <br>
event the default command is &lsquo;print&rsquo; with
arguments &lsquo;-r --&rsquo;.</p>

<p style="margin-top: 1em">For example, to get a long ls
listing of all plain files in the current directory or its
subdirectories:</p>

<p style="margin-top: 1em">autoload -U zargs <br>
zargs -- **/*(.) -- ls -l</p>

<p style="margin-top: 1em">Note that &lsquo;--&rsquo; is
used both to mark the end of the option list and to mark the
end of the input list, so it must appear twice whenever the
input list may be empty. If <br>
there is guaranteed to be at least one input and the first
input does not begin with a &lsquo;-&rsquo;, then the first
&lsquo;--&rsquo; may be omitted.</p>

<p style="margin-top: 1em">In the event that the string
&lsquo;--&rsquo; is or may be an input, the -e option may be
used to change the end-of-inputs marker. Note that this does
not change the end-of-options <br>
marker. For example, to use &lsquo;..&rsquo; as the
marker:</p>

<p style="margin-top: 1em">zargs -e.. -- **/*(.) .. ls
-l</p>

<p style="margin-top: 1em">This is a good choice in that
example because no plain file can be named &lsquo;..&rsquo;,
but the best end-marker depends on the circumstances.</p>

<p style="margin-top: 1em">The options -i, -I, -l, -L, and
-n differ slightly from their usage in xargs. There are no
input lines for zargs to count, so -l and -L count through
the input list, and <br>
-n counts the number of arguments passed to each execution
of command, including any arg list. Also, any time -i or -I
is used, each input is processed separately as if <br>
by &lsquo;-L 1&rsquo;.</p>

<p style="margin-top: 1em">For details of the other zargs
options, see xargs(1) (but note the difference in function
between zargs and xargs) or run zargs with the --help
option.</p>

<p style="margin-top: 1em">zed [ -f ] name <br>
zed -b This function uses the ZLE editor to edit a file or
function.</p>

<p style="margin-top: 1em">Only one name argument is
allowed. If the -f option is given, the name is taken to be
that of a function; if the function is marked for
autoloading, zed searches for it <br>
in the fpath and loads it. Note that functions edited this
way are installed into the current shell, but not written
back to the autoload file.</p>

<p style="margin-top: 1em">Without -f, name is the path
name of the file to edit, which need not exist; it is
created on write, if necessary.</p>

<p style="margin-top: 1em">While editing, the function sets
the main keymap to zed and the vi command keymap to
zed-vicmd. These will be copied from the existing main and
vicmd keymaps if they do <br>
not exist the first time zed is run. They can be used to
provide special key bindings used only in zed.</p>

<p style="margin-top: 1em">If it creates the keymap, zed
rebinds the return key to insert a line break and
&lsquo;^X^W&rsquo; to accept the edit in the zed keymap, and
binds &lsquo;ZZ&rsquo; to accept the edit in the <br>
zed-vicmd keymap.</p>

<p style="margin-top: 1em">The bindings alone can be
installed by running &lsquo;zed -b&rsquo;. This is suitable
for putting into a startup file. Note that, if rerun, this
will overwrite the existing zed and <br>
zed-vicmd keymaps.</p>

<p style="margin-top: 1em">Completion is available, and
styles may be set with the context prefix
&lsquo;:completion:zed&rsquo;.</p>

<p style="margin-top: 1em">A zle widget zed-set-file-name
is available. This can be called by name from within zed
using &lsquo;\x zed-set-file-name&rsquo; (note, however,
that because of zed&rsquo;s rebindings you <br>
will have to type ^j at the end instead of the return key),
or can be bound to a key in either of the zed or zed-vicmd
keymaps after &lsquo;zed -b&rsquo; has been run. When the
wid&acirc; <br>
get is called, it prompts for a new name for the file being
edited. When zed exits the file will be written under that
name and the original file will be left alone. The <br>
widget has no effect with &lsquo;zed -f&rsquo;.</p>

<p style="margin-top: 1em">While zed-set-file-name is
running, zed uses the keymap zed-normal-keymap, which is
linked from the main keymap in effect at the time zed
initialised its bindings. (This <br>
is to make the return key operate normally.) The result is
that if the main keymap has been changed, the widget
won&rsquo;t notice. This is not a concern for most
users.</p>

<p style="margin-top: 1em">zcp [ -finqQvwW ] srcpat dest
<br>
zln [ -finqQsvwW ] srcpat dest <br>
Same as zmv -C and zmv -L, respectively. These functions do
not appear in the zsh distribution, but can be created by
linking zmv to the names zcp and zln in some direc&acirc;
<br>
tory in your fpath.</p>

<p style="margin-top: 1em">zkbd See &lsquo;Keyboard
Definition&rsquo; above.</p>

<p style="margin-top: 1em">zmv [ -finqQsvwW ] [ -C | -L |
-M | -p program ] [ -o optstring ] srcpat dest <br>
Move (usually, rename) files matching the pattern srcpat to
corresponding files having names of the form given by dest,
where srcpat contains parentheses surrounding pat&acirc;
<br>
terns which will be replaced in turn by $1, $2, ... in dest.
For example,</p>

<p style="margin-top: 1em">zmv &rsquo;(*).lis&rsquo;
&rsquo;$1.txt&rsquo;</p>

<p style="margin-top: 1em">renames &lsquo;foo.lis&rsquo; to
&lsquo;foo.txt&rsquo;, &lsquo;my.old.stuff.lis&rsquo; to
&lsquo;my.old.stuff.txt&rsquo;, and so on.</p>

<p style="margin-top: 1em">The pattern is always treated as
an EXTENDED_GLOB pattern. Any file whose name is not changed
by the substitution is simply ignored. Any error (a
substitution resulted <br>
in an empty string, two substitutions gave the same result,
the destination was an existing regular file and -f was not
given) causes the entire function to abort without <br>
doing anything.</p>

<p style="margin-top: 1em">Options:</p>

<p style="margin-top: 1em">-f Force overwriting of
destination files. Not currently passed down to the mv/cp/ln
command due to vagaries of implementations (but you can use
-o-f to do that). <br>
-i Interactive: show each line to be executed and ask the
user whether to execute it. &lsquo;Y&rsquo; or
&lsquo;y&rsquo; will execute it, anything else will skip it.
Note that you just need <br>
to type one character. <br>
-n No execution: print what would happen, but don&rsquo;t do
it. <br>
-q Turn bare glob qualifiers off: now assumed by default, so
this has no effect. <br>
-Q Force bare glob qualifiers on. Don&rsquo;t turn this on
unless you are actually using glob qualifiers in a pattern.
<br>
-s Symbolic, passed down to ln; only works with -L. <br>
-v Verbose: print each command as it&rsquo;s being executed.
<br>
-w Pick out wildcard parts of the pattern, as described
above, and implicitly add parentheses for referring to them.
<br>
-W Just like -w, with the addition of turning wildcards in
the replacement pattern into sequential ${1} .. ${N}
references. <br>
-C <br>
-L <br>
-M Force cp, ln or mv, respectively, regardless of the name
of the function. <br>
-p program <br>
Call program instead of cp, ln or mv. Whatever it does, it
should at least understand the form &lsquo;program --
oldname newname&rsquo; where oldname and newname are
filenames <br>
generated by zmv. <br>
-o optstring <br>
The optstring is split into words and passed down verbatim
to the cp, ln or mv command called to perform the work. It
should probably begin with a &lsquo;-&rsquo;.</p>

<p style="margin-top: 1em">Further examples:</p>

<p style="margin-top: 1em">zmv -v &rsquo;(* *)&rsquo;
&rsquo;${1// /_}&rsquo;</p>

<p style="margin-top: 1em">For any file in the current
directory with at least one space in the name, replace every
space by an underscore and display the commands
executed.</p>

<p style="margin-top: 1em">For more complete examples and
other implementation details, see the zmv source file,
usually located in one of the directories named in your
fpath, or in Func&acirc; <br>
tions/Misc/zmv in the zsh distribution.</p>

<p style="margin-top: 1em">zrecompile <br>
See &lsquo;Recompiling Functions&rsquo; above.</p>

<p style="margin-top: 1em">zstyle+ context style value [ +
subcontext style value ... ] <br>
This makes defining styles a bit simpler by using a single
&lsquo;+&rsquo; as a special token that allows you to append
a context name to the previously used context name. Like
this:</p>

<p style="margin-top: 1em">zstyle+ &rsquo;:foo:bar&rsquo;
style1 value1 + &rsquo;:baz&rsquo; style2 value2 +
&rsquo;:frob&rsquo; style3 value3</p>

<p style="margin-top: 1em">This defines
&lsquo;style1&rsquo; with &lsquo;value1&rsquo; for the
context :foo:bar as usual, but it also defines
&lsquo;style2&rsquo; with &lsquo;value2&rsquo; for the
context :foo:bar:baz and &lsquo;style3&rsquo; with
&lsquo;value3&rsquo; <br>
for :foo:bar:frob. Any subcontext may be the empty string to
re-use the first context unchanged.</p>

<p style="margin-top: 1em">Styles <br>
insert-tab <br>
The zed function sets this style in context
&lsquo;:completion:zed:*&rsquo; to turn off completion when
TAB is typed at the beginning of a line. You may override
this by setting your <br>
own value for this context and style.</p>

<p style="margin-top: 1em">pager The nslookup function
looks up this style in the context &lsquo;:nslookup&rsquo;
to determine the program used to display output that does
not fit on a single screen.</p>

<p style="margin-top: 1em">prompt <br>
rprompt <br>
The nslookup function looks up this style in the context
&lsquo;:nslookup&rsquo; to set the prompt and the right-side
prompt, respectively. The usual expansions for the PS1 and
RPS1 <br>
parameters may be used (see EXPANSION OF PROMPT SEQUENCES in
zshmisc(1)).</p>

<p style="margin-top: 1em">zsh 5.0.2 December 21, 2012
ZSHCONTRIB(1)</p>
<hr>
</body>
</html>
