<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:01:32 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>CTDB(1) CTDB - clustered TDB database CTDB(1)</p>

<p style="margin-top: 1em">NAME <br>
ctdb - CTDB management utility</p>

<p style="margin-top: 1em">SYNOPSIS <br>
ctdb [OPTION...] {COMMAND} [COMMAND-ARGS]</p>

<p style="margin-top: 1em">DESCRIPTION <br>
ctdb is a utility to view and manage a CTDB cluster.</p>

<p style="margin-top: 1em">The following terms are used
when referring to nodes in a cluster:</p>

<p style="margin-top: 1em">PNN <br>
Physical Node Number. The physical node number is an integer
that describes the node in the cluster. The first node has
physical node number 0. in a cluster.</p>

<p style="margin-top: 1em">PNN-LIST <br>
This is either a single PNN, a comma-separate list of PNNs
or &quot;all&quot;.</p>

<p style="margin-top: 1em">Commands that reference a
database use the following terms:</p>

<p style="margin-top: 1em">DB <br>
This is either a database name, such as locking.tdb or a
database ID such as &quot;0x42fe72c5&quot;.</p>

<p style="margin-top: 1em">DB-LIST <br>
A space separated list of at least one DB.</p>

<p style="margin-top: 1em">OPTIONS <br>
-n PNN-LIST <br>
The nodes specified by PNN-LIST should be queried for the
requested information. Default is to query the daemon
running on the local host.</p>

<p style="margin-top: 1em">-Y <br>
Produce output in machine readable form for easier parsing
by scripts. This uses a field delimiter of &rsquo;:&rsquo;.
Not all commands support this option.</p>

<p style="margin-top: 1em">-x SEPARATOR <br>
Use SEPARATOR to delimit fields in machine readable output.
This implies -Y.</p>

<p style="margin-top: 1em">-X <br>
Produce output in machine readable form for easier parsing
by scripts. This uses a field delimiter of &rsquo;|&rsquo;.
Not all commands support this option.</p>

<p style="margin-top: 1em">This is equivalent to
&quot;-x|&quot; and avoids some shell quoting issues.</p>

<p style="margin-top: 1em">-t TIMEOUT <br>
Indicates that ctdb should wait up to TIMEOUT seconds for a
response to most commands sent to the CTDB daemon. The
default is 10 seconds.</p>

<p style="margin-top: 1em">-T TIMELIMIT <br>
Indicates that TIMELIMIT is the maximum run time (in
seconds) for the ctdb command. When TIMELIMIT is exceeded
the ctdb command will terminate with an error. The default
is <br>
120 seconds.</p>

<p style="margin-top: 1em">-? --help <br>
Print some help text to the screen.</p>

<p style="margin-top: 1em">--usage <br>
Print useage information to the screen.</p>

<p style="margin-top: 1em">-d --debug=DEBUGLEVEL <br>
Change the debug level for the command. Default is NOTICE
(2).</p>

<p style="margin-top: 1em">--socket=FILENAME <br>
Specify that FILENAME is the name of the Unix domain socket
to use when connecting to the local CTDB daemon. The default
is /var/run/ctdb/ctdbd.socket.</p>

<p style="margin-top: 1em">ADMINISTRATIVE COMMANDS <br>
These are commands used to monitor and administer a CTDB
cluster.</p>

<p style="margin-top: 1em">pnn <br>
This command displays the PNN of the current node.</p>

<p style="margin-top: 1em">xpnn <br>
This command displays the PNN of the current node without
contacting the CTDB daemon. It parses the nodes file
directly, so can produce unexpected output if the nodes file
has <br>
been edited but has not been reloaded.</p>

<p style="margin-top: 1em">status <br>
This command shows the current status of all CTDB nodes
based on information from the queried node.</p>

<p style="margin-top: 1em">Note: If the the queried node is
INACTIVE then the status might not be current.</p>

<p style="margin-top: 1em">Node status <br>
This includes the number of physical nodes and the status of
each node. See ctdb(7) for information about node
states.</p>

<p style="margin-top: 1em">Generation <br>
The generation id is a number that indicates the current
generation of a cluster instance. Each time a cluster goes
through a reconfiguration or a recovery its generation id
<br>
will be changed.</p>

<p style="margin-top: 1em">This number does not have any
particular meaning other than to keep track of when a
cluster has gone through a recovery. It is a random number
that represents the current <br>
instance of a ctdb cluster and its databases. The CTDB
daemon uses this number internally to be able to tell when
commands to operate on the cluster and the databases was
<br>
issued in a different generation of the cluster, to ensure
that commands that operate on the databases will not survive
across a cluster database recovery. After a recovery, <br>
all old outstanding commands will automatically become
invalid.</p>

<p style="margin-top: 1em">Sometimes this number will be
shown as &quot;INVALID&quot;. This only means that the ctdbd
daemon has started but it has not yet merged with the
cluster through a recovery. All nodes <br>
start with generation &quot;INVALID&quot; and are not
assigned a real generation id until they have successfully
been merged with a cluster through a recovery.</p>

<p style="margin-top: 1em">Virtual Node Number (VNN) map
<br>
Consists of the number of virtual nodes and mapping from
virtual node numbers to physical node numbers. Virtual nodes
host CTDB databases. Only nodes that are participating <br>
in the VNN map can become lmaster or dmaster for database
records.</p>

<p style="margin-top: 1em">Recovery mode <br>
This is the current recovery mode of the cluster. There are
two possible modes:</p>

<p style="margin-top: 1em">NORMAL - The cluster is fully
operational.</p>

<p style="margin-top: 1em">RECOVERY - The cluster databases
have all been frozen, pausing all services while the cluster
awaits a recovery process to complete. A recovery process
should finish within <br>
seconds. If a cluster is stuck in the RECOVERY state this
would indicate a cluster malfunction which needs to be
investigated.</p>

<p style="margin-top: 1em">Once the recovery master detects
an inconsistency, for example a node becomes
disconnected/connected, the recovery daemon will trigger a
cluster recovery process, where all <br>
databases are remerged across the cluster. When this process
starts, the recovery master will first &quot;freeze&quot;
all databases to prevent applications such as samba from
<br>
accessing the databases and it will also mark the recovery
mode as RECOVERY.</p>

<p style="margin-top: 1em">When the CTDB daemon starts up,
it will start in RECOVERY mode. Once the node has been
merged into a cluster and all databases have been recovered,
the node mode will change <br>
into NORMAL mode and the databases will be
&quot;thawed&quot;, allowing samba to access the databases
again.</p>

<p style="margin-top: 1em">Recovery master <br>
This is the cluster node that is currently designated as the
recovery master. This node is responsible of monitoring the
consistency of the cluster and to perform the actual <br>
recovery process when reqired.</p>

<p style="margin-top: 1em">Only one node at a time can be
the designated recovery master. Which node is designated the
recovery master is decided by an election process in the
recovery daemons running <br>
on each node.</p>

<p style="margin-top: 1em">Example <br>
# ctdb status <br>
Number of nodes:4 <br>
pnn:0 192.168.2.200 OK (THIS NODE) <br>
pnn:1 192.168.2.201 OK <br>
pnn:2 192.168.2.202 OK <br>
pnn:3 192.168.2.203 OK <br>
Generation:1362079228 <br>
Size:4 <br>
hash:0 lmaster:0 <br>
hash:1 lmaster:1 <br>
hash:2 lmaster:2 <br>
hash:3 lmaster:3 <br>
Recovery mode:NORMAL (0) <br>
Recovery master:0</p>

<p style="margin-top: 1em">nodestatus [PNN-LIST] <br>
This command is similar to the status command. It displays
the &quot;node status&quot; subset of output. The main
differences are:</p>

<p style="margin-top: 1em">&Acirc;&middot; The exit code is
the bitwise-OR of the flags for each specified node, while
ctdb status exits with 0 if it was able to retrieve status
for all nodes.</p>

<p style="margin-top: 1em">&Acirc;&middot; ctdb status
provides status information for all nodes. ctdb nodestatus
defaults to providing status for only the current node. If
PNN-LIST is provided then status is given <br>
for the indicated node(s).</p>

<p style="margin-top: 1em">A common invocation in scripts
is ctdb nodestatus all to check whether all nodes in a
cluster are healthy.</p>

<p style="margin-top: 1em">Example <br>
# ctdb nodestatus <br>
pnn:0 10.0.0.30 OK (THIS NODE)</p>

<p style="margin-top: 1em"># ctdb nodestatus all <br>
Number of nodes:2 <br>
pnn:0 10.0.0.30 OK (THIS NODE) <br>
pnn:1 10.0.0.31 OK</p>

<p style="margin-top: 1em">recmaster <br>
This command shows the pnn of the node which is currently
the recmaster.</p>

<p style="margin-top: 1em">Note: If the the queried node is
INACTIVE then the status might not be current.</p>

<p style="margin-top: 1em">uptime <br>
This command shows the uptime for the ctdb daemon. When the
last recovery or ip-failover completed and how long it took.
If the &quot;duration&quot; is shown as a negative number,
this <br>
indicates that there is a recovery/failover in progress and
it started that many seconds ago.</p>

<p style="margin-top: 1em">Example <br>
# ctdb uptime <br>
Current time of node : Thu Oct 29 10:38:54 2009 <br>
Ctdbd start time : (000 16:54:28) Wed Oct 28 17:44:26 2009
<br>
Time of last recovery/failover: (000 16:53:31) Wed Oct 28
17:45:23 2009 <br>
Duration of last recovery/failover: 2.248552 seconds</p>

<p style="margin-top: 1em">listnodes <br>
This command shows lists the ip addresses of all the nodes
in the cluster.</p>

<p style="margin-top: 1em">Example <br>
# ctdb listnodes <br>
192.168.2.200 <br>
192.168.2.201 <br>
192.168.2.202 <br>
192.168.2.203</p>

<p style="margin-top: 1em">natgwlist <br>
Show the current NAT gateway master and the status of all
nodes in the current NAT gateway group. See the NAT GATEWAY
section in ctdb(7) for more details.</p>

<p style="margin-top: 1em">Example <br>
# ctdb natgwlist <br>
0 192.168.2.200 <br>
Number of nodes:4 <br>
pnn:0 192.168.2.200 OK (THIS NODE) <br>
pnn:1 192.168.2.201 OK <br>
pnn:2 192.168.2.202 OK <br>
pnn:3 192.168.2.203 OK</p>

<p style="margin-top: 1em">ping <br>
This command will &quot;ping&quot; specified CTDB nodes in
the cluster to verify that they are running.</p>

<p style="margin-top: 1em">Example <br>
# ctdb ping <br>
response from 0 time=0.000054 sec (3 clients)</p>

<p style="margin-top: 1em">ifaces <br>
This command will display the list of network interfaces,
which could host public addresses, along with their
status.</p>

<p style="margin-top: 1em">Example <br>
# ctdb ifaces <br>
Interfaces on node 0 <br>
name:eth5 link:up references:2 <br>
name:eth4 link:down references:0 <br>
name:eth3 link:up references:1 <br>
name:eth2 link:up references:1</p>

<p style="margin-top: 1em"># ctdb -X ifaces <br>
|Name|LinkStatus|References| <br>
|eth5|1|2| <br>
|eth4|0|0| <br>
|eth3|1|1| <br>
|eth2|1|1|</p>

<p style="margin-top: 1em">ip <br>
This command will display the list of public addresses that
are provided by the cluster and which physical node is
currently serving this ip. By default this command will ONLY
<br>
show those public addresses that are known to the node
itself. To see the full list of all public ips across the
cluster you must use &quot;ctdb ip all&quot;.</p>

<p style="margin-top: 1em">Example <br>
# ctdb ip -v <br>
Public IPs on node 0 <br>
172.31.91.82 node[1] active[] available[eth2,eth3]
configured[eth2,eth3] <br>
172.31.91.83 node[0] active[eth3] available[eth2,eth3]
configured[eth2,eth3] <br>
172.31.91.84 node[1] active[] available[eth2,eth3]
configured[eth2,eth3] <br>
172.31.91.85 node[0] active[eth2] available[eth2,eth3]
configured[eth2,eth3] <br>
172.31.92.82 node[1] active[] available[eth5]
configured[eth4,eth5] <br>
172.31.92.83 node[0] active[eth5] available[eth5]
configured[eth4,eth5] <br>
172.31.92.84 node[1] active[] available[eth5]
configured[eth4,eth5] <br>
172.31.92.85 node[0] active[eth5] available[eth5]
configured[eth4,eth5]</p>

<p style="margin-top: 1em"># ctdb -X ip -v <br>
|Public
IP|Node|ActiveInterface|AvailableInterfaces|ConfiguredInterfaces|
<br>
|172.31.91.82|1||eth2,eth3|eth2,eth3| <br>
|172.31.91.83|0|eth3|eth2,eth3|eth2,eth3| <br>
|172.31.91.84|1||eth2,eth3|eth2,eth3| <br>
|172.31.91.85|0|eth2|eth2,eth3|eth2,eth3| <br>
|172.31.92.82|1||eth5|eth4,eth5| <br>
|172.31.92.83|0|eth5|eth5|eth4,eth5| <br>
|172.31.92.84|1||eth5|eth4,eth5| <br>
|172.31.92.85|0|eth5|eth5|eth4,eth5|</p>

<p style="margin-top: 1em">ipinfo IP <br>
This command will display details about the specified public
addresses.</p>

<p style="margin-top: 1em">Example <br>
# ctdb ipinfo 172.31.92.85 <br>
Public IP[172.31.92.85] info on node 0 <br>
IP:172.31.92.85 <br>
CurrentNode:0 <br>
NumInterfaces:2 <br>
Interface[1]: Name:eth4 Link:down References:0 <br>
Interface[2]: Name:eth5 Link:up References:2 (active)</p>

<p style="margin-top: 1em">scriptstatus <br>
This command displays which scripts where run in the
previous monitoring cycle and the result of each script. If
a script failed with an error, causing the node to become
<br>
unhealthy, the output from that script is also shown.</p>

<p style="margin-top: 1em">Example <br>
# ctdb scriptstatus <br>
7 scripts were executed last monitoring cycle <br>
00.ctdb Status:OK Duration:0.056 Tue Mar 24 18:56:57 2009
<br>
10.interface Status:OK Duration:0.077 Tue Mar 24 18:56:57
2009 <br>
11.natgw Status:OK Duration:0.039 Tue Mar 24 18:56:57 2009
<br>
20.multipathd Status:OK Duration:0.038 Tue Mar 24 18:56:57
2009 <br>
31.clamd Status:DISABLED <br>
40.vsftpd Status:OK Duration:0.045 Tue Mar 24 18:56:57 2009
<br>
41.httpd Status:OK Duration:0.039 Tue Mar 24 18:56:57 2009
<br>
50.samba Status:ERROR Duration:0.082 Tue Mar 24 18:56:57
2009 <br>
OUTPUT:ERROR: Samba tcp port 445 is not responding</p>

<p style="margin-top: 1em">disablescript SCRIPT <br>
This command is used to disable an eventscript.</p>

<p style="margin-top: 1em">This will take effect the next
time the eventscripts are being executed so it can take a
short while until this is reflected in
&rsquo;scriptstatus&rsquo;.</p>

<p style="margin-top: 1em">enablescript SCRIPT <br>
This command is used to enable an eventscript.</p>

<p style="margin-top: 1em">This will take effect the next
time the eventscripts are being executed so it can take a
short while until this is reflected in
&rsquo;scriptstatus&rsquo;.</p>

<p style="margin-top: 1em">listvars <br>
List all tuneable variables, except the values of the
obsolete tunables like VacuumMinInterval. The obsolete
tunables can be retrieved only explicitly with the
&quot;ctdb getvar&quot; <br>
command.</p>

<p style="margin-top: 1em">Example <br>
# ctdb listvars <br>
MaxRedirectCount = 3 <br>
SeqnumInterval = 1000 <br>
ControlTimeout = 60 <br>
TraverseTimeout = 20 <br>
KeepaliveInterval = 5 <br>
KeepaliveLimit = 5 <br>
RecoverTimeout = 20 <br>
RecoverInterval = 1 <br>
ElectionTimeout = 3 <br>
TakeoverTimeout = 9 <br>
MonitorInterval = 15 <br>
TickleUpdateInterval = 20 <br>
EventScriptTimeout = 30 <br>
MonitorTimeoutCount = 1 <br>
RecoveryGracePeriod = 120 <br>
RecoveryBanPeriod = 300 <br>
DatabaseHashSize = 100001 <br>
DatabaseMaxDead = 5 <br>
RerecoveryTimeout = 10 <br>
EnableBans = 1 <br>
DeterministicIPs = 0 <br>
LCP2PublicIPs = 1 <br>
ReclockPingPeriod = 60 <br>
NoIPFailback = 0 <br>
DisableIPFailover = 0 <br>
VerboseMemoryNames = 0 <br>
RecdPingTimeout = 60 <br>
RecdFailCount = 10 <br>
LogLatencyMs = 0 <br>
RecLockLatencyMs = 1000 <br>
RecoveryDropAllIPs = 120 <br>
VacuumInterval = 10 <br>
VacuumMaxRunTime = 30 <br>
RepackLimit = 10000 <br>
VacuumLimit = 5000 <br>
VacuumFastPathCount = 60 <br>
MaxQueueDropMsg = 1000000 <br>
UseStatusEvents = 0 <br>
AllowUnhealthyDBRead = 0 <br>
StatHistoryInterval = 1 <br>
DeferredAttachTO = 120 <br>
AllowClientDBAttach = 1 <br>
RecoverPDBBySeqNum = 0</p>

<p style="margin-top: 1em">getvar NAME <br>
Get the runtime value of a tuneable variable.</p>

<p style="margin-top: 1em">Example <br>
# ctdb getvar MaxRedirectCount <br>
MaxRedirectCount = 3</p>

<p style="margin-top: 1em">setvar NAME VALUE <br>
Set the runtime value of a tuneable variable.</p>

<p style="margin-top: 1em">Example: ctdb setvar
MaxRedirectCount 5</p>

<p style="margin-top: 1em">lvsmaster <br>
This command shows which node is currently the LVSMASTER.
The LVSMASTER is the node in the cluster which drives the
LVS system and which receives all incoming traffic from <br>
clients.</p>

<p style="margin-top: 1em">LVS is the mode where the entire
CTDB/Samba cluster uses a single ip address for the entire
cluster. In this mode all clients connect to one specific
node which will then <br>
multiplex/loadbalance the clients evenly onto the other
nodes in the cluster. This is an alternative to using public
ip addresses. See the manpage for ctdbd for more information
<br>
about LVS.</p>

<p style="margin-top: 1em">lvs <br>
This command shows which nodes in the cluster are currently
active in the LVS configuration. I.e. which nodes we are
currently loadbalancing the single ip address across.</p>

<p style="margin-top: 1em">LVS will by default only
loadbalance across those nodes that are both LVS capable and
also HEALTHY. Except if all nodes are UNHEALTHY in which
case LVS will loadbalance across <br>
all UNHEALTHY nodes as well. LVS will never use nodes that
are DISCONNECTED, STOPPED, BANNED or DISABLED.</p>

<p style="margin-top: 1em">Example output:</p>

<p style="margin-top: 1em">2:10.0.0.13 <br>
3:10.0.0.14</p>

<p style="margin-top: 1em">getcapabilities <br>
This command shows the capabilities of the current node. See
the CAPABILITIES section in ctdb(7) for more details.</p>

<p style="margin-top: 1em">Example output:</p>

<p style="margin-top: 1em">RECMASTER: YES <br>
LMASTER: YES <br>
LVS: NO</p>

<p style="margin-top: 1em">statistics <br>
Collect statistics from the CTDB daemon about how many calls
it has served. Information about various fields in
statistics can be found in ctdb-statistics(7).</p>

<p style="margin-top: 1em">Example <br>
# ctdb statistics <br>
CTDB version 1 <br>
num_clients 3 <br>
frozen 0 <br>
recovering 0 <br>
client_packets_sent 360489 <br>
client_packets_recv 360466 <br>
node_packets_sent 480931 <br>
node_packets_recv 240120 <br>
keepalive_packets_sent 4 <br>
keepalive_packets_recv 3 <br>
node <br>
req_call 2 <br>
reply_call 2 <br>
req_dmaster 0 <br>
reply_dmaster 0 <br>
reply_error 0 <br>
req_message 42 <br>
req_control 120408 <br>
reply_control 360439 <br>
client <br>
req_call 2 <br>
req_message 24 <br>
req_control 360440 <br>
timeouts <br>
call 0 <br>
control 0 <br>
traverse 0 <br>
total_calls 2 <br>
pending_calls 0 <br>
lockwait_calls 0 <br>
pending_lockwait_calls 0 <br>
memory_used 5040 <br>
max_hop_count 0 <br>
max_call_latency 4.948321 sec <br>
max_lockwait_latency 0.000000 sec</p>

<p style="margin-top: 1em">statisticsreset <br>
This command is used to clear all statistics counters in a
node.</p>

<p style="margin-top: 1em">Example: ctdb
statisticsreset</p>

<p style="margin-top: 1em">dbstatistics DB <br>
Display statistics about the database DB. Information about
various fields in dbstatistics can be found in
ctdb-statistics(7).</p>

<p style="margin-top: 1em">Example <br>
# ctdb dbstatistics locking.tdb <br>
DB Statistics: locking.tdb <br>
ro_delegations 0 <br>
ro_revokes 0 <br>
locks <br>
total 14356 <br>
failed 0 <br>
current 0 <br>
pending 0 <br>
hop_count_buckets: 28087 2 1 0 0 0 0 0 0 0 0 0 0 0 0 0 <br>
lock_buckets: 0 14188 38 76 32 19 3 0 0 0 0 0 0 0 0 0 <br>
locks_latency MIN/AVG/MAX 0.001066/0.012686/4.202292 sec out
of 14356 <br>
Num Hot Keys: 1 <br>
Count:8
Key:ff5bd7cb3ee3822edc1f0000000000000000000000000000</p>

<p style="margin-top: 1em">getreclock <br>
Show the name of the recovery lock file, if any.</p>

<p style="margin-top: 1em">Example output:</p>

<p style="margin-top: 1em">Reclock
file:/clusterfs/.ctdb/recovery.lock</p>

<p style="margin-top: 1em">setreclock [FILE] <br>
FILE specifies the name of the recovery lock file. If the
recovery lock file is changed at run-time then this will
cause a recovery, which in turn causes the recovery lock to
be <br>
retaken.</p>

<p style="margin-top: 1em">If no FILE is specified then a
recovery lock file will no longer be used.</p>

<p style="margin-top: 1em">This command only affects the
run-time setting of a single CTDB node. This setting must be
changed on all nodes simultaneously. For information about
configuring the recovery <br>
lock file please see the CTDB_RECOVERY_LOCK entry in
ctdbd.conf(5) and the --reclock entry in ctdbd(1). For
information about the recovery lock please see the RECOVERY
LOCK <br>
section in ctdb(7).</p>

<p style="margin-top: 1em">getdebug <br>
Get the current debug level for the node. the debug level
controls what information is written to the log file.</p>

<p style="margin-top: 1em">The debug levels are mapped to
the corresponding syslog levels. When a debug level is set,
only those messages at that level and higher levels will be
printed.</p>

<p style="margin-top: 1em">The list of debug levels from
highest to lowest are :</p>

<p style="margin-top: 1em">ERR WARNING NOTICE INFO
DEBUG</p>

<p style="margin-top: 1em">setdebug DEBUGLEVEL <br>
Set the debug level of a node. This controls what
information will be logged.</p>

<p style="margin-top: 1em">The debuglevel is one of ERR
WARNING NOTICE INFO DEBUG</p>

<p style="margin-top: 1em">getpid <br>
This command will return the process id of the ctdb
daemon.</p>

<p style="margin-top: 1em">disable <br>
This command is used to administratively disable a node in
the cluster. A disabled node will still participate in the
cluster and host clustered TDB records but its public ip
<br>
address has been taken over by a different node and it no
longer hosts any services.</p>

<p style="margin-top: 1em">enable <br>
Re-enable a node that has been administratively
disabled.</p>

<p style="margin-top: 1em">stop <br>
This command is used to administratively STOP a node in the
cluster. A STOPPED node is connected to the cluster but will
not host any public ip addresse, nor does it participate
<br>
in the VNNMAP. The difference between a DISABLED node and a
STOPPED node is that a STOPPED node does not host any parts
of the database which means that a recovery is required to
<br>
stop/continue nodes.</p>

<p style="margin-top: 1em">continue <br>
Re-start a node that has been administratively stopped.</p>

<p style="margin-top: 1em">addip IPADDR/mask IFACE <br>
This command is used to add a new public ip to a node during
runtime. This allows public addresses to be added to a
cluster without having to restart the ctdb daemons.</p>

<p style="margin-top: 1em">Note that this only updates the
runtime instance of ctdb. Any changes will be lost next time
ctdb is restarted and the public addresses file is re-read.
If you want this change <br>
to be permanent you must also update the public addresses
file manually.</p>

<p style="margin-top: 1em">delip IPADDR <br>
This command is used to remove a public ip from a node
during runtime. If this public ip is currently hosted by the
node it being removed from, the ip will first be failed over
<br>
to another node, if possible, before it is removed.</p>

<p style="margin-top: 1em">Note that this only updates the
runtime instance of ctdb. Any changes will be lost next time
ctdb is restarted and the public addresses file is re-read.
If you want this change <br>
to be permanent you must also update the public addresses
file manually.</p>

<p style="margin-top: 1em">moveip IPADDR PNN <br>
This command can be used to manually fail a public ip
address to a specific node.</p>

<p style="margin-top: 1em">In order to manually override
the &quot;automatic&quot; distribution of public ip
addresses that ctdb normally provides, this command only
works when you have changed the tunables for the <br>
daemon to:</p>

<p style="margin-top: 1em">DeterministicIPs = 0</p>

<p style="margin-top: 1em">NoIPFailback = 1</p>

<p style="margin-top: 1em">shutdown <br>
This command will shutdown a specific CTDB daemon.</p>

<p style="margin-top: 1em">setlmasterrole on|off <br>
This command is used ot enable/disable the LMASTER
capability for a node at runtime. This capability determines
whether or not a node can be used as an LMASTER for records
in the <br>
database. A node that does not have the LMASTER capability
will not show up in the vnnmap.</p>

<p style="margin-top: 1em">Nodes will by default have this
capability, but it can be stripped off nodes by the setting
in the sysconfig file or by using this command.</p>

<p style="margin-top: 1em">Once this setting has been
enabled/disabled, you need to perform a recovery for it to
take effect.</p>

<p style="margin-top: 1em">See also &quot;ctdb
getcapabilities&quot;</p>

<p style="margin-top: 1em">setrecmasterrole on|off <br>
This command is used ot enable/disable the RECMASTER
capability for a node at runtime. This capability determines
whether or not a node can be used as an RECMASTER for the
<br>
cluster. A node that does not have the RECMASTER capability
can not win a recmaster election. A node that already is the
recmaster for the cluster when the capability is stripped
<br>
off the node will remain the recmaster until the next
cluster election.</p>

<p style="margin-top: 1em">Nodes will by default have this
capability, but it can be stripped off nodes by the setting
in the sysconfig file or by using this command.</p>

<p style="margin-top: 1em">See also &quot;ctdb
getcapabilities&quot;</p>

<p style="margin-top: 1em">reloadnodes <br>
This command is used when adding new nodes, or removing
existing nodes from an existing cluster.</p>

<p style="margin-top: 1em">Procedure to add nodes:</p>

<p style="margin-top: 1em">1. To expand an existing
cluster, first ensure with ctdb status that all nodes are up
and running and that they are all healthy. Do not try to
expand a cluster unless it is <br>
completely healthy!</p>

<p style="margin-top: 1em">2. On all nodes, edit
/etc/ctdb/nodes and add the new nodes at the end of this
file.</p>

<p style="margin-top: 1em">3. Verify that all the nodes
have identical /etc/ctdb/nodes files after adding the new
nodes.</p>

<p style="margin-top: 1em">4. Run ctdb reloadnodes to force
all nodes to reload the nodes file.</p>

<p style="margin-top: 1em">5. Use ctdb status on all nodes
and verify that they now show the additional nodes.</p>

<p style="margin-top: 1em">6. Install and configure the new
node and bring it online.</p>

<p style="margin-top: 1em">Procedure to remove nodes:</p>

<p style="margin-top: 1em">1. To remove nodes from an
existing cluster, first ensure with ctdb status that all
nodes, except the node to be deleted, are up and running and
that they are all healthy. Do <br>
not try to remove nodes from a cluster unless the cluster is
completely healthy!</p>

<p style="margin-top: 1em">2. Shutdown and power off the
node to be removed.</p>

<p style="margin-top: 1em">3. On all other nodes, edit the
/etc/ctdb/nodes file and comment out the nodes to be
removed. Do not delete the lines for the deleted nodes, just
comment them out by adding a <br>
&rsquo;#&rsquo; at the beginning of the lines.</p>

<p style="margin-top: 1em">4. Run ctdb reloadnodes to force
all nodes to reload the nodes file.</p>

<p style="margin-top: 1em">5. Use ctdb status on all nodes
and verify that the deleted nodes are no longer listed.</p>

<p style="margin-top: 1em">reloadips [PNN-LIST] <br>
This command reloads the public addresses configuration file
on the specified nodes. When it completes addresses will be
reconfigured and reassigned across the cluster as <br>
necessary.</p>

<p style="margin-top: 1em">getdbmap <br>
This command lists all clustered TDB databases that the CTDB
daemon has attached to. Some databases are flagged as
PERSISTENT, this means that the database stores data <br>
persistently and the data will remain across reboots. One
example of such a database is secrets.tdb where information
about how the cluster was joined to the domain is
stored.</p>

<p style="margin-top: 1em">If a PERSISTENT database is not
in a healthy state the database is flagged as UNHEALTHY. If
there&rsquo;s at least one completely healthy node running
in the cluster, it&rsquo;s possible <br>
that the content is restored by a recovery run automaticly.
Otherwise an administrator needs to analyze the problem.</p>

<p style="margin-top: 1em">See also &quot;ctdb
getdbstatus&quot;, &quot;ctdb backupdb&quot;, &quot;ctdb
restoredb&quot;, &quot;ctdb dumpbackup&quot;, &quot;ctdb
wipedb&quot;, &quot;ctdb setvar AllowUnhealthyDBRead 1&quot;
and (if samba or tdb-utils are installed) <br>
&quot;tdbtool check&quot;.</p>

<p style="margin-top: 1em">Most databases are not
persistent and only store the state information that the
currently running samba daemons need. These databases are
always wiped when ctdb/samba starts and <br>
when a node is rebooted.</p>

<p style="margin-top: 1em">Example <br>
# ctdb getdbmap <br>
Number of databases:10 <br>
dbid:0x435d3410 name:notify.tdb
path:/var/lib/ctdb/notify.tdb.0 <br>
dbid:0x42fe72c5 name:locking.tdb
path:/var/lib/ctdb/locking.tdb.0 <br>
dbid:0x1421fb78 name:brlock.tdb
path:/var/lib/ctdb/brlock.tdb.0 <br>
dbid:0x17055d90 name:connections.tdb
path:/var/lib/ctdb/connections.tdb.0 <br>
dbid:0xc0bdde6a name:sessionid.tdb
path:/var/lib/ctdb/sessionid.tdb.0 <br>
dbid:0x122224da name:test.tdb path:/var/lib/ctdb/test.tdb.0
<br>
dbid:0x2672a57f name:idmap2.tdb
path:/var/lib/ctdb/persistent/idmap2.tdb.0 PERSISTENT <br>
dbid:0xb775fff6 name:secrets.tdb
path:/var/lib/ctdb/persistent/secrets.tdb.0 PERSISTENT <br>
dbid:0xe98e08b6 name:group_mapping.tdb
path:/var/lib/ctdb/persistent/group_mapping.tdb.0 PERSISTENT
<br>
dbid:0x7bbbd26c name:passdb.tdb
path:/var/lib/ctdb/persistent/passdb.tdb.0 PERSISTENT</p>

<p style="margin-top: 1em"># ctdb getdbmap # example for
unhealthy database <br>
Number of databases:1 <br>
dbid:0xb775fff6 name:secrets.tdb
path:/var/lib/ctdb/persistent/secrets.tdb.0 PERSISTENT
UNHEALTHY</p>

<p style="margin-top: 1em"># ctdb -X getdbmap <br>
|ID|Name|Path|Persistent|Unhealthy| <br>

|0x7bbbd26c|passdb.tdb|/var/lib/ctdb/persistent/passdb.tdb.0|1|0|</p>

<p style="margin-top: 1em">backupdb DB FILE <br>
Copy the contents of database DB to FILE. FILE can later be
read back using restoredb. This is mainly useful for backing
up persistent databases such as secrets.tdb and similar.</p>

<p style="margin-top: 1em">restoredb FILE [DB] <br>
This command restores a persistent database that was
previously backed up using backupdb. By default the data
will be restored back into the same database as it was
created from. <br>
By specifying dbname you can restore the data into a
different database.</p>

<p style="margin-top: 1em">setdbreadonly DB <br>
This command will enable the read-only record support for a
database. This is an experimental feature to improve
performance for contended records primarily in locking.tdb
and <br>
brlock.tdb. When enabling this feature you must set it on
all nodes in the cluster.</p>

<p style="margin-top: 1em">setdbsticky DB <br>
This command will enable the sticky record support for the
specified database. This is an experimental feature to
improve performance for contended records primarily in <br>
locking.tdb and brlock.tdb. When enabling this feature you
must set it on all nodes in the cluster.</p>

<p style="margin-top: 1em">INTERNAL COMMANDS <br>
Internal commands are used by CTDB&rsquo;s scripts and are
not required for managing a CTDB cluster. Their parameters
and behaviour are subject to change.</p>

<p style="margin-top: 1em">gettickles IPADDR <br>
Show TCP connections that are registered with CTDB to be
&quot;tickled&quot; if there is a failover.</p>

<p style="margin-top: 1em">gratiousarp IPADDR INTERFACE
<br>
Send out a gratious ARP for the specified interface through
the specified interface. This command is mainly used by the
ctdb eventscripts.</p>

<p style="margin-top: 1em">killtcp <br>
Read a list of TCP connections, one per line, from standard
input and terminate each connection. A connection is
specified as:</p>

<p style="margin-top: 1em">SRC-IPADDR:SRC-PORT
DST-IPADDR:DST-PORT</p>

<p style="margin-top: 1em">Each connection is terminated by
issuing a TCP RST to the SRC-IPADDR:SRC-PORT endpoint.</p>

<p style="margin-top: 1em">A single connection can be
specified on the command-line rather than on standard
input.</p>

<p style="margin-top: 1em">pdelete DB KEY <br>
Delete KEY from DB.</p>

<p style="margin-top: 1em">pfetch DB KEY <br>
Print the value associated with KEY in DB.</p>

<p style="margin-top: 1em">pstore DB KEY FILE <br>
Store KEY in DB with contents of FILE as the associated
value.</p>

<p style="margin-top: 1em">ptrans DB [FILE] <br>
Read a list of key-value pairs, one per line from FILE, and
store them in DB using a single transaction. An empty value
is equivalent to deleting the given key.</p>

<p style="margin-top: 1em">The key and value should be
separated by spaces or tabs. Each key/value should be a
printable string enclosed in double-quotes.</p>

<p style="margin-top: 1em">runstate
[setup|first_recovery|startup|running] <br>
Print the runstate of the specified node. Runstates are used
to serialise important state transitions in CTDB,
particularly during startup.</p>

<p style="margin-top: 1em">If one or more optional runstate
arguments are specified then the node must be in one of
these runstates for the command to succeed.</p>

<p style="margin-top: 1em">Example <br>
# ctdb runstate <br>
RUNNING</p>

<p style="margin-top: 1em">setifacelink IFACE up|down <br>
Set the internal state of network interface IFACE. This is
typically used in the 10.interface script in the
&quot;monitor&quot; event.</p>

<p style="margin-top: 1em">Example: ctdb setifacelink eth0
up</p>

<p style="margin-top: 1em">tickle SRC-IPADDR:SRC-PORT
DST-IPADDR:DST-PORT <br>
Send a TCP tickle to the source host for the specified TCP
connection. A TCP tickle is a TCP ACK packet with an invalid
sequence and acknowledge number and will when received by
<br>
the source host result in it sending an immediate correct
ACK back to the other end.</p>

<p style="margin-top: 1em">TCP tickles are useful to
&quot;tickle&quot; clients after a IP failover has occured
since this will make the client immediately recognize the
TCP connection has been disrupted and that <br>
the client will need to reestablish. This greatly speeds up
the time it takes for a client to detect and reestablish
after an IP failover in the ctdb cluster.</p>

<p style="margin-top: 1em">version <br>
Display the CTDB version.</p>

<p style="margin-top: 1em">DEBUGGING COMMANDS <br>
These commands are primarily used for CTDB development and
testing and should not be used for normal
administration.</p>

<p style="margin-top: 1em">OPTIONS <br>
--print-emptyrecords <br>
This enables printing of empty records when dumping
databases with the catdb, cattbd and dumpdbbackup commands.
Records with empty data segment are considered deleted by
ctdb <br>
and cleaned by the vacuuming mechanism, so this switch can
come in handy for debugging the vacuuming behaviour.</p>

<p style="margin-top: 1em">--print-datasize <br>
This lets database dumps (catdb, cattdb, dumpdbbackup) print
the size of the record data instead of dumping the data
contents.</p>

<p style="margin-top: 1em">--print-lmaster <br>
This lets catdb print the lmaster for each record.</p>

<p style="margin-top: 1em">--print-hash <br>
This lets database dumps (catdb, cattdb, dumpdbbackup) print
the hash for each record.</p>

<p style="margin-top: 1em">--print-recordflags <br>
This lets catdb and dumpdbbackup print the record flags for
each record. Note that cattdb always prints the flags.</p>

<p style="margin-top: 1em">process-exists PID <br>
This command checks if a specific process exists on the CTDB
host. This is mainly used by Samba to check if remote
instances of samba are still running or not.</p>

<p style="margin-top: 1em">getdbstatus DB <br>
This command displays more details about a database.</p>

<p style="margin-top: 1em">Example <br>
# ctdb getdbstatus test.tdb.0 <br>
dbid: 0x122224da <br>
name: test.tdb <br>
path: /var/lib/ctdb/test.tdb.0 <br>
PERSISTENT: no <br>
HEALTH: OK</p>

<p style="margin-top: 1em"># ctdb getdbstatus registry.tdb
# with a corrupted TDB <br>
dbid: 0xf2a58948 <br>
name: registry.tdb <br>
path: /var/lib/ctdb/persistent/registry.tdb.0 <br>
PERSISTENT: yes <br>
HEALTH: NO-HEALTHY-NODES - ERROR - Backup of corrupted TDB
in
&rsquo;/var/lib/ctdb/persistent/registry.tdb.0.corrupted.20091208091949.0Z&rsquo;</p>

<p style="margin-top: 1em">catdb DB <br>
Print a dump of the clustered TDB database DB.</p>

<p style="margin-top: 1em">cattdb DB <br>
Print a dump of the contents of the local TDB database
DB.</p>

<p style="margin-top: 1em">dumpdbbackup FILE <br>
Print a dump of the contents from database backup FILE,
similar to catdb.</p>

<p style="margin-top: 1em">wipedb DB <br>
Remove all contents of database DB.</p>

<p style="margin-top: 1em">recover <br>
This command will trigger the recovery daemon to do a
cluster recovery.</p>

<p style="margin-top: 1em">ipreallocate, sync <br>
This command will force the recovery master to perform a
full ip reallocation process and redistribute all ip
addresses. This is useful to &quot;reset&quot; the
allocations back to its <br>
default state if they have been changed using the
&quot;moveip&quot; command. While a &quot;recover&quot; will
also perform this reallocation, a recovery is much more
hevyweight since it will also <br>
rebuild all the databases.</p>

<p style="margin-top: 1em">getmonmode <br>
This command returns the monutoring mode of a node. The
monitoring mode is either ACTIVE or DISABLED. Normally a
node will continuously monitor that all other nodes that are
<br>
expected are in fact connected and that they respond to
commands.</p>

<p style="margin-top: 1em">ACTIVE - This is the normal
mode. The node is actively monitoring all other nodes, both
that the transport is connected and also that the node
responds to commands. If a node <br>
becomes unavailable, it will be marked as DISCONNECTED and a
recovery is initiated to restore the cluster.</p>

<p style="margin-top: 1em">DISABLED - This node is not
monitoring that other nodes are available. In this mode a
node failure will not be detected and no recovery will be
performed. This mode is useful <br>
when for debugging purposes one wants to attach GDB to a
ctdb process but wants to prevent the rest of the cluster
from marking this node as DISCONNECTED and do a
recovery.</p>

<p style="margin-top: 1em">setmonmode 0|1 <br>
This command can be used to explicitly disable/enable
monitoring mode on a node. The main purpose is if one wants
to attach GDB to a running ctdb daemon but wants to prevent
the <br>
other nodes from marking it as DISCONNECTED and issuing a
recovery. To do this, set monitoring mode to 0 on all nodes
before attaching with GDB. Remember to set monitoring mode
<br>
back to 1 afterwards.</p>

<p style="margin-top: 1em">attach DBNAME [persistent] <br>
Create a new CTDB database called DBNAME and attach to it on
all nodes.</p>

<p style="margin-top: 1em">detach DB-LIST <br>
Detach specified non-persistent database(s) from the
cluster. This command will disconnect specified database(s)
on all nodes in the cluster. This command should only be
used <br>
when none of the specified database(s) are in use.</p>

<p style="margin-top: 1em">All nodes should be active and
tunable AllowClientDBAccess should be disabled on all nodes
before detaching databases.</p>

<p style="margin-top: 1em">dumpmemory <br>
This is a debugging command. This command will make the ctdb
daemon to write a fill memory allocation map to standard
output.</p>

<p style="margin-top: 1em">rddumpmemory <br>
This is a debugging command. This command will dump the
talloc memory allocation tree for the recovery daemon to
standard output.</p>

<p style="margin-top: 1em">thaw <br>
Thaw a previously frozen node.</p>

<p style="margin-top: 1em">eventscript ARGUMENTS <br>
This is a debugging command. This command can be used to
manually invoke and run the eventscritps with arbitrary
arguments.</p>

<p style="margin-top: 1em">ban BANTIME <br>
Administratively ban a node for BANTIME seconds. The node
will be unbanned after BANTIME seconds have elapsed.</p>

<p style="margin-top: 1em">A banned node does not
participate in the cluster. It does not host any records for
the clustered TDB and does not host any public IP
addresses.</p>

<p style="margin-top: 1em">Nodes are automatically banned
if they misbehave. For example, a node may be banned if it
causes too many cluster recoveries.</p>

<p style="margin-top: 1em">To administratively exclude a
node from a cluster use the stop command.</p>

<p style="margin-top: 1em">unban <br>
This command is used to unban a node that has either been
administratively banned using the ban command or has been
automatically banned.</p>

<p style="margin-top: 1em">rebalancenode [PNN-LIST] <br>
This command marks the given nodes as rebalance targets in
the LCP2 IP allocation algorithm. The reloadips command will
do this as necessary so this command should not be
needed.</p>

<p style="margin-top: 1em">check_srvids SRVID ... <br>
This command checks whether a set of srvid message ports are
registered on the node or not. The command takes a list of
values to check.</p>

<p style="margin-top: 1em">Example <br>
# ctdb check_srvids 1 2 3 14765 <br>
Server id 0:1 does not exist <br>
Server id 0:2 does not exist <br>
Server id 0:3 does not exist <br>
Server id 0:14765 exists</p>

<p style="margin-top: 1em">SEE ALSO <br>
ctdbd(1), onnode(1), ctdb(7), ctdb-statistics(7),
ctdb-tunables(7), http://ctdb.samba.org/</p>

<p style="margin-top: 1em">AUTHOR <br>
This documentation was written by Ronnie Sahlberg, Amitay
Isaacs, Martin Schwenke</p>

<p style="margin-top: 1em">COPYRIGHT <br>
Copyright &Acirc;&copy; 2007 Andrew Tridgell, Ronnie
Sahlberg</p>

<p style="margin-top: 1em">This program is free software;
you can redistribute it and/or modify it under the terms of
the GNU General Public License as published by the Free
Software Foundation; either <br>
version 3 of the License, or (at your option) any later
version.</p>

<p style="margin-top: 1em">This program is distributed in
the hope that it will be useful, but WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or
FITNESS FOR A PARTICULAR <br>
PURPOSE. See the GNU General Public License for more
details.</p>

<p style="margin-top: 1em">You should have received a copy
of the GNU General Public License along with this program;
if not, see http://www.gnu.org/licenses.</p>

<p style="margin-top: 1em">ctdb 05/25/2017 CTDB(1)</p>
<hr>
</body>
</html>
