<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>CTDB(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">CTDB(1)</td>
    <td class="head-vol">CTDB - clustered TDB database</td>
    <td class="head-rtitle">CTDB(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
ctdb - CTDB management utility
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<div class="Pp" style="margin-left: 5.00ex; text-indent: -5.00ex;"><b>ctdb</b>
  [<i>OPTION</i>...] {<i>COMMAND</i>} [<i>COMMAND-ARGS</i>]</div>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
ctdb is a utility to view and manage a CTDB cluster.
<div class="Pp"></div>
The following terms are used when referring to nodes in a cluster:
<div class="Pp"></div>
PNN
<div style="margin-left: 4.00ex;">Physical Node Number. The physical node number
  is an integer that describes the node in the cluster. The first node has
  physical node number 0. in a cluster.</div>
<div class="Pp"></div>
PNN-LIST
<div style="margin-left: 4.00ex;">This is either a single PNN, a comma-separate
  list of PNNs or &quot;all&quot;.</div>
<div class="Pp"></div>
Commands that reference a database use the following terms:
<div class="Pp"></div>
DB
<div style="margin-left: 4.00ex;">This is either a database name, such as
  locking.tdb or a database ID such as &quot;0x42fe72c5&quot;.</div>
<div class="Pp"></div>
DB-LIST
<div style="margin-left: 4.00ex;">A space separated list of at least one
  <i>DB</i>.</div>
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
-n <i>PNN-LIST</i>
<div style="margin-left: 4.00ex;">The nodes specified by PNN-LIST should be
  queried for the requested information. Default is to query the daemon running
  on the local host.</div>
<div class="Pp"></div>
-Y
<div style="margin-left: 4.00ex;">Produce output in machine readable form for
  easier parsing by scripts. This uses a field delimiter of ':'. Not all
  commands support this option.</div>
<div class="Pp"></div>
-x <i>SEPARATOR</i>
<div style="margin-left: 4.00ex;">Use SEPARATOR to delimit fields in machine
  readable output. This implies -Y.</div>
<div class="Pp"></div>
-X
<div style="margin-left: 4.00ex;">Produce output in machine readable form for
  easier parsing by scripts. This uses a field delimiter of '|'. Not all
  commands support this option.
<div style="height: 1.00em;">&#x00A0;</div>
This is equivalent to &quot;-x|&quot; and avoids some shell quoting
  issues.</div>
<div class="Pp"></div>
-t <i>TIMEOUT</i>
<div style="margin-left: 4.00ex;">Indicates that ctdb should wait up to TIMEOUT
  seconds for a response to most commands sent to the CTDB daemon. The default
  is 10 seconds.</div>
<div class="Pp"></div>
-T <i>TIMELIMIT</i>
<div style="margin-left: 4.00ex;">Indicates that TIMELIMIT is the maximum run
  time (in seconds) for the ctdb command. When TIMELIMIT is exceeded the ctdb
  command will terminate with an error. The default is 120 seconds.</div>
<div class="Pp"></div>
-? --help
<div style="margin-left: 4.00ex;">Print some help text to the screen.</div>
<div class="Pp"></div>
--usage
<div style="margin-left: 4.00ex;">Print useage information to the screen.</div>
<div class="Pp"></div>
-d --debug= <i>DEBUGLEVEL</i>
<div style="margin-left: 4.00ex;">Change the debug level for the command.
  Default is NOTICE (2).</div>
<div class="Pp"></div>
--socket= <i>FILENAME</i>
<div style="margin-left: 4.00ex;">Specify that FILENAME is the name of the Unix
  domain socket to use when connecting to the local CTDB daemon. The default is
  /var/run/ctdb/ctdbd.socket.</div>
<h1 class="Sh" title="Sh" id="ADMINISTRATIVE_COMMANDS"><a class="selflink" href="#ADMINISTRATIVE_COMMANDS">ADMINISTRATIVE
  COMMANDS</a></h1>
These are commands used to monitor and administer a CTDB cluster.
<h2 class="Ss" title="Ss" id="pnn"><a class="selflink" href="#pnn">pnn</a></h2>
This command displays the PNN of the current node.
<h2 class="Ss" title="Ss" id="xpnn"><a class="selflink" href="#xpnn">xpnn</a></h2>
This command displays the PNN of the current node without contacting the CTDB
  daemon. It parses the nodes file directly, so can produce unexpected output if
  the nodes file has been edited but has not been reloaded.
<h2 class="Ss" title="Ss" id="status"><a class="selflink" href="#status">status</a></h2>
This command shows the current status of all CTDB nodes based on information
  from the queried node.
<div class="Pp"></div>
Note: If the the queried node is INACTIVE then the status might not be current.
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Node status</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div class="Pp"></div>
This includes the number of physical nodes and the status of each node. See
  <b>ctdb</b>(7) for information about node states.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Generation</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div class="Pp"></div>
The generation id is a number that indicates the current generation of a cluster
  instance. Each time a cluster goes through a reconfiguration or a recovery its
  generation id will be changed.
<div class="Pp"></div>
This number does not have any particular meaning other than to keep track of
  when a cluster has gone through a recovery. It is a random number that
  represents the current instance of a ctdb cluster and its databases. The CTDB
  daemon uses this number internally to be able to tell when commands to operate
  on the cluster and the databases was issued in a different generation of the
  cluster, to ensure that commands that operate on the databases will not
  survive across a cluster database recovery. After a recovery, all old
  outstanding commands will automatically become invalid.
<div class="Pp"></div>
Sometimes this number will be shown as &quot;INVALID&quot;. This only means that
  the ctdbd daemon has started but it has not yet merged with the cluster
  through a recovery. All nodes start with generation &quot;INVALID&quot; and
  are not assigned a real generation id until they have successfully been merged
  with a cluster through a recovery.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Virtual Node Number (VNN) map</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div class="Pp"></div>
Consists of the number of virtual nodes and mapping from virtual node numbers to
  physical node numbers. Virtual nodes host CTDB databases. Only nodes that are
  participating in the VNN map can become lmaster or dmaster for database
  records.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Recovery mode</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div class="Pp"></div>
This is the current recovery mode of the cluster. There are two possible modes:
<div class="Pp"></div>
NORMAL - The cluster is fully operational.
<div class="Pp"></div>
RECOVERY - The cluster databases have all been frozen, pausing all services
  while the cluster awaits a recovery process to complete. A recovery process
  should finish within seconds. If a cluster is stuck in the RECOVERY state this
  would indicate a cluster malfunction which needs to be investigated.
<div class="Pp"></div>
Once the recovery master detects an inconsistency, for example a node becomes
  disconnected/connected, the recovery daemon will trigger a cluster recovery
  process, where all databases are remerged across the cluster. When this
  process starts, the recovery master will first &quot;freeze&quot; all
  databases to prevent applications such as samba from accessing the databases
  and it will also mark the recovery mode as RECOVERY.
<div class="Pp"></div>
When the CTDB daemon starts up, it will start in RECOVERY mode. Once the node
  has been merged into a cluster and all databases have been recovered, the node
  mode will change into NORMAL mode and the databases will be
  &quot;thawed&quot;, allowing samba to access the databases again.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Recovery master</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div class="Pp"></div>
This is the cluster node that is currently designated as the recovery master.
  This node is responsible of monitoring the consistency of the cluster and to
  perform the actual recovery process when reqired.
<div class="Pp"></div>
Only one node at a time can be the designated recovery master. Which node is
  designated the recovery master is decided by an election process in the
  recovery daemons running on each node.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Example</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
# ctdb status
Number of nodes:4
pnn:0 192.168.2.200       OK (THIS NODE)
pnn:1 192.168.2.201       OK
pnn:2 192.168.2.202       OK
pnn:3 192.168.2.203       OK
Generation:1362079228
Size:4
hash:0 lmaster:0
hash:1 lmaster:1
hash:2 lmaster:2
hash:3 lmaster:3
Recovery mode:NORMAL (0)
Recovery master:0
	
</pre>
</div>
</div>
<h2 class="Ss" title="Ss" id="nodestatus_[PNN-LIST]"><a class="selflink" href="#nodestatus_[PNN-LIST]">nodestatus
  [ <i>PNN-LIST</i>]</a></h2>
This command is similar to the <b>status</b> command. It displays the &quot;node
  status&quot; subset of output. The main differences are:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;The exit code is the bitwise-OR of the
  flags for each specified node, while <b>ctdb status</b> exits with 0 if it was
  able to retrieve status for all nodes.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;<b>ctdb status</b> provides status
  information for all nodes. <b>ctdb nodestatus</b> defaults to providing status
  for only the current node. If PNN-LIST is provided then status is given for
  the indicated node(s).</div>
<div class="Pp"></div>
A common invocation in scripts is <b>ctdb nodestatus all</b> to check whether
  all nodes in a cluster are healthy.
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Example</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
# ctdb nodestatus
pnn:0 10.0.0.30        OK (THIS NODE)
<div class="Pp"></div>
# ctdb nodestatus all
Number of nodes:2
pnn:0 10.0.0.30        OK (THIS NODE)
pnn:1 10.0.0.31        OK
	
</pre>
</div>
</div>
<h2 class="Ss" title="Ss" id="recmaster"><a class="selflink" href="#recmaster">recmaster</a></h2>
This command shows the pnn of the node which is currently the recmaster.
<div class="Pp"></div>
Note: If the the queried node is INACTIVE then the status might not be current.
<h2 class="Ss" title="Ss" id="uptime"><a class="selflink" href="#uptime">uptime</a></h2>
This command shows the uptime for the ctdb daemon. When the last recovery or
  ip-failover completed and how long it took. If the &quot;duration&quot; is
  shown as a negative number, this indicates that there is a recovery/failover
  in progress and it started that many seconds ago.
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Example</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
# ctdb uptime
Current time of node          :                Thu Oct 29 10:38:54 2009
Ctdbd start time              : (000 16:54:28) Wed Oct 28 17:44:26 2009
Time of last recovery/failover: (000 16:53:31) Wed Oct 28 17:45:23 2009
Duration of last recovery/failover: 2.248552 seconds
	
</pre>
</div>
</div>
<h2 class="Ss" title="Ss" id="listnodes"><a class="selflink" href="#listnodes">listnodes</a></h2>
This command shows lists the ip addresses of all the nodes in the cluster.
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Example</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
# ctdb listnodes
192.168.2.200
192.168.2.201
192.168.2.202
192.168.2.203
	
</pre>
</div>
</div>
<h2 class="Ss" title="Ss" id="natgwlist"><a class="selflink" href="#natgwlist">natgwlist</a></h2>
Show the current NAT gateway master and the status of all nodes in the current
  NAT gateway group. See the NAT GATEWAY section in <b>ctdb</b>(7) for more
  details.
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Example</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
# ctdb natgwlist
0 192.168.2.200
Number of nodes:4
pnn:0 192.168.2.200       OK (THIS NODE)
pnn:1 192.168.2.201       OK
pnn:2 192.168.2.202       OK
pnn:3 192.168.2.203       OK
	
</pre>
</div>
</div>
<h2 class="Ss" title="Ss" id="ping"><a class="selflink" href="#ping">ping</a></h2>
This command will &quot;ping&quot; specified CTDB nodes in the cluster to verify
  that they are running.
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Example</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
# ctdb ping
response from 0 time=0.000054 sec  (3 clients)
	
</pre>
</div>
</div>
<h2 class="Ss" title="Ss" id="ifaces"><a class="selflink" href="#ifaces">ifaces</a></h2>
This command will display the list of network interfaces, which could host
  public addresses, along with their status.
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Example</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
# ctdb ifaces
Interfaces on node 0
name:eth5 link:up references:2
name:eth4 link:down references:0
name:eth3 link:up references:1
name:eth2 link:up references:1
<div class="Pp"></div>
# ctdb -X ifaces
|Name|LinkStatus|References|
|eth5|1|2|
|eth4|0|0|
|eth3|1|1|
|eth2|1|1|
	
</pre>
</div>
</div>
<h2 class="Ss" title="Ss" id="ip"><a class="selflink" href="#ip">ip</a></h2>
This command will display the list of public addresses that are provided by the
  cluster and which physical node is currently serving this ip. By default this
  command will ONLY show those public addresses that are known to the node
  itself. To see the full list of all public ips across the cluster you must use
  &quot;ctdb ip all&quot;.
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Example</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
# ctdb ip -v
Public IPs on node 0
172.31.91.82 node[1] active[] available[eth2,eth3] configured[eth2,eth3]
172.31.91.83 node[0] active[eth3] available[eth2,eth3] configured[eth2,eth3]
172.31.91.84 node[1] active[] available[eth2,eth3] configured[eth2,eth3]
172.31.91.85 node[0] active[eth2] available[eth2,eth3] configured[eth2,eth3]
172.31.92.82 node[1] active[] available[eth5] configured[eth4,eth5]
172.31.92.83 node[0] active[eth5] available[eth5] configured[eth4,eth5]
172.31.92.84 node[1] active[] available[eth5] configured[eth4,eth5]
172.31.92.85 node[0] active[eth5] available[eth5] configured[eth4,eth5]
<div class="Pp"></div>
# ctdb -X ip -v
|Public IP|Node|ActiveInterface|AvailableInterfaces|ConfiguredInterfaces|
|172.31.91.82|1||eth2,eth3|eth2,eth3|
|172.31.91.83|0|eth3|eth2,eth3|eth2,eth3|
|172.31.91.84|1||eth2,eth3|eth2,eth3|
|172.31.91.85|0|eth2|eth2,eth3|eth2,eth3|
|172.31.92.82|1||eth5|eth4,eth5|
|172.31.92.83|0|eth5|eth5|eth4,eth5|
|172.31.92.84|1||eth5|eth4,eth5|
|172.31.92.85|0|eth5|eth5|eth4,eth5|
	
</pre>
</div>
</div>
<h2 class="Ss" title="Ss" id="ipinfo_IP"><a class="selflink" href="#ipinfo_IP">ipinfo
  <i>IP</i></a></h2>
This command will display details about the specified public addresses.
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Example</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
# ctdb ipinfo 172.31.92.85
Public IP[172.31.92.85] info on node 0
IP:172.31.92.85
CurrentNode:0
NumInterfaces:2
Interface[1]: Name:eth4 Link:down References:0
Interface[2]: Name:eth5 Link:up References:2 (active)
	
</pre>
</div>
</div>
<h2 class="Ss" title="Ss" id="scriptstatus"><a class="selflink" href="#scriptstatus">scriptstatus</a></h2>
This command displays which scripts where run in the previous monitoring cycle
  and the result of each script. If a script failed with an error, causing the
  node to become unhealthy, the output from that script is also shown.
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Example</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
# ctdb scriptstatus
7 scripts were executed last monitoring cycle
00.ctdb              Status:OK    Duration:0.056 Tue Mar 24 18:56:57 2009
10.interface         Status:OK    Duration:0.077 Tue Mar 24 18:56:57 2009
11.natgw             Status:OK    Duration:0.039 Tue Mar 24 18:56:57 2009
20.multipathd        Status:OK    Duration:0.038 Tue Mar 24 18:56:57 2009
31.clamd             Status:DISABLED
40.vsftpd            Status:OK    Duration:0.045 Tue Mar 24 18:56:57 2009
41.httpd             Status:OK    Duration:0.039 Tue Mar 24 18:56:57 2009
50.samba             Status:ERROR    Duration:0.082 Tue Mar 24 18:56:57 2009
OUTPUT:ERROR: Samba tcp port 445 is not responding
      
</pre>
</div>
</div>
<h2 class="Ss" title="Ss" id="disablescript_SCRIPT"><a class="selflink" href="#disablescript_SCRIPT">disablescript
  <i>SCRIPT</i></a></h2>
This command is used to disable an eventscript.
<div class="Pp"></div>
This will take effect the next time the eventscripts are being executed so it
  can take a short while until this is reflected in 'scriptstatus'.
<h2 class="Ss" title="Ss" id="enablescript_SCRIPT"><a class="selflink" href="#enablescript_SCRIPT">enablescript
  <i>SCRIPT</i></a></h2>
This command is used to enable an eventscript.
<div class="Pp"></div>
This will take effect the next time the eventscripts are being executed so it
  can take a short while until this is reflected in 'scriptstatus'.
<h2 class="Ss" title="Ss" id="listvars"><a class="selflink" href="#listvars">listvars</a></h2>
List all tuneable variables, except the values of the obsolete tunables like
  VacuumMinInterval. The obsolete tunables can be retrieved only explicitly with
  the &quot;ctdb getvar&quot; command.
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Example</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
# ctdb listvars
MaxRedirectCount        = 3
SeqnumInterval          = 1000
ControlTimeout          = 60
TraverseTimeout         = 20
KeepaliveInterval       = 5
KeepaliveLimit          = 5
RecoverTimeout          = 20
RecoverInterval         = 1
ElectionTimeout         = 3
TakeoverTimeout         = 9
MonitorInterval         = 15
TickleUpdateInterval    = 20
EventScriptTimeout      = 30
MonitorTimeoutCount     = 1
RecoveryGracePeriod     = 120
RecoveryBanPeriod       = 300
DatabaseHashSize        = 100001
DatabaseMaxDead         = 5
RerecoveryTimeout       = 10
EnableBans              = 1
DeterministicIPs        = 0
LCP2PublicIPs           = 1
ReclockPingPeriod       = 60
NoIPFailback            = 0
DisableIPFailover       = 0
VerboseMemoryNames      = 0
RecdPingTimeout         = 60
RecdFailCount           = 10
LogLatencyMs            = 0
RecLockLatencyMs        = 1000
RecoveryDropAllIPs      = 120
VacuumInterval          = 10
VacuumMaxRunTime        = 30
RepackLimit             = 10000
VacuumLimit             = 5000
VacuumFastPathCount     = 60
MaxQueueDropMsg         = 1000000
UseStatusEvents         = 0
AllowUnhealthyDBRead    = 0
StatHistoryInterval     = 1
DeferredAttachTO        = 120
AllowClientDBAttach     = 1
RecoverPDBBySeqNum      = 0
	
</pre>
</div>
</div>
<h2 class="Ss" title="Ss" id="getvar_NAME"><a class="selflink" href="#getvar_NAME">getvar
  <i>NAME</i></a></h2>
Get the runtime value of a tuneable variable.
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Example</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
# ctdb getvar MaxRedirectCount
MaxRedirectCount    = 3
	
</pre>
</div>
</div>
<h2 class="Ss" title="Ss" id="setvar_NAME_VALUE"><a class="selflink" href="#setvar_NAME_VALUE">setvar
  <i>NAME</i> <i>VALUE</i></a></h2>
Set the runtime value of a tuneable variable.
<div class="Pp"></div>
Example: ctdb setvar MaxRedirectCount 5
<h2 class="Ss" title="Ss" id="lvsmaster"><a class="selflink" href="#lvsmaster">lvsmaster</a></h2>
This command shows which node is currently the LVSMASTER. The LVSMASTER is the
  node in the cluster which drives the LVS system and which receives all
  incoming traffic from clients.
<div class="Pp"></div>
LVS is the mode where the entire CTDB/Samba cluster uses a single ip address for
  the entire cluster. In this mode all clients connect to one specific node
  which will then multiplex/loadbalance the clients evenly onto the other nodes
  in the cluster. This is an alternative to using public ip addresses. See the
  manpage for ctdbd for more information about LVS.
<h2 class="Ss" title="Ss" id="lvs"><a class="selflink" href="#lvs">lvs</a></h2>
This command shows which nodes in the cluster are currently active in the LVS
  configuration. I.e. which nodes we are currently loadbalancing the single ip
  address across.
<div class="Pp"></div>
LVS will by default only loadbalance across those nodes that are both LVS
  capable and also HEALTHY. Except if all nodes are UNHEALTHY in which case LVS
  will loadbalance across all UNHEALTHY nodes as well. LVS will never use nodes
  that are DISCONNECTED, STOPPED, BANNED or DISABLED.
<div class="Pp"></div>
Example output:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
2:10.0.0.13
3:10.0.0.14
      
</pre>
</div>
<h2 class="Ss" title="Ss" id="getcapabilities"><a class="selflink" href="#getcapabilities">getcapabilities</a></h2>
This command shows the capabilities of the current node. See the CAPABILITIES
  section in <b>ctdb</b>(7) for more details.
<div class="Pp"></div>
Example output:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
RECMASTER: YES
LMASTER: YES
LVS: NO
      
</pre>
</div>
<h2 class="Ss" title="Ss" id="statistics"><a class="selflink" href="#statistics">statistics</a></h2>
Collect statistics from the CTDB daemon about how many calls it has served.
  Information about various fields in statistics can be found in
  <b>ctdb-statistics</b>(7).
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Example</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
# ctdb statistics
CTDB version 1
num_clients                        3
frozen                             0
recovering                         0
client_packets_sent           360489
client_packets_recv           360466
node_packets_sent             480931
node_packets_recv             240120
keepalive_packets_sent             4
keepalive_packets_recv             3
node
req_call                       2
reply_call                     2
req_dmaster                    0
reply_dmaster                  0
reply_error                    0
req_message                   42
req_control               120408
reply_control             360439
client
req_call                       2
req_message                   24
req_control               360440
timeouts
call                           0
control                        0
traverse                       0
total_calls                        2
pending_calls                      0
lockwait_calls                     0
pending_lockwait_calls             0
memory_used                     5040
max_hop_count                      0
max_call_latency                   4.948321 sec
max_lockwait_latency               0.000000 sec
	
</pre>
</div>
</div>
<h2 class="Ss" title="Ss" id="statisticsreset"><a class="selflink" href="#statisticsreset">statisticsreset</a></h2>
This command is used to clear all statistics counters in a node.
<div class="Pp"></div>
Example: ctdb statisticsreset
<h2 class="Ss" title="Ss" id="dbstatistics_DB"><a class="selflink" href="#dbstatistics_DB">dbstatistics
  <i>DB</i></a></h2>
Display statistics about the database DB. Information about various fields in
  dbstatistics can be found in <b>ctdb-statistics</b>(7).
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Example</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
# ctdb dbstatistics locking.tdb
DB Statistics: locking.tdb
 ro_delegations                     0
 ro_revokes                         0
 locks
     total                      14356
     failed                         0
     current                        0
     pending                        0
 hop_count_buckets: 28087 2 1 0 0 0 0 0 0 0 0 0 0 0 0 0
 lock_buckets: 0 14188 38 76 32 19 3 0 0 0 0 0 0 0 0 0
 locks_latency      MIN/AVG/MAX     0.001066/0.012686/4.202292 sec out of 14356
 Num Hot Keys:     1
     Count:8 Key:ff5bd7cb3ee3822edc1f0000000000000000000000000000
	
</pre>
</div>
</div>
<h2 class="Ss" title="Ss" id="getreclock"><a class="selflink" href="#getreclock">getreclock</a></h2>
Show the name of the recovery lock file, if any.
<div class="Pp"></div>
Example output:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
	Reclock file:/clusterfs/.ctdb/recovery.lock
      
</pre>
</div>
<h2 class="Ss" title="Ss" id="setreclock_[FILE]"><a class="selflink" href="#setreclock_[FILE]">setreclock
  [ <i>FILE</i>]</a></h2>
FILE specifies the name of the recovery lock file. If the recovery lock file is
  changed at run-time then this will cause a recovery, which in turn causes the
  recovery lock to be retaken.
<div class="Pp"></div>
If no FILE is specified then a recovery lock file will no longer be used.
<div class="Pp"></div>
This command only affects the run-time setting of a single CTDB node. This
  setting <i>must</i> be changed on all nodes simultaneously. For information
  about configuring the recovery lock file please see the CTDB_RECOVERY_LOCK
  entry in <b>ctdbd.conf</b>(5) and the --reclock entry in <b>ctdbd</b>(1). For
  information about the recovery lock please see the RECOVERY LOCK section in
  <b>ctdb</b>(7).
<h2 class="Ss" title="Ss" id="getdebug"><a class="selflink" href="#getdebug">getdebug</a></h2>
Get the current debug level for the node. the debug level controls what
  information is written to the log file.
<div class="Pp"></div>
The debug levels are mapped to the corresponding syslog levels. When a debug
  level is set, only those messages at that level and higher levels will be
  printed.
<div class="Pp"></div>
The list of debug levels from highest to lowest are :
<div class="Pp"></div>
ERR WARNING NOTICE INFO DEBUG
<h2 class="Ss" title="Ss" id="setdebug_DEBUGLEVEL"><a class="selflink" href="#setdebug_DEBUGLEVEL">setdebug
  <i>DEBUGLEVEL</i></a></h2>
Set the debug level of a node. This controls what information will be logged.
<div class="Pp"></div>
The debuglevel is one of ERR WARNING NOTICE INFO DEBUG
<h2 class="Ss" title="Ss" id="getpid"><a class="selflink" href="#getpid">getpid</a></h2>
This command will return the process id of the ctdb daemon.
<h2 class="Ss" title="Ss" id="disable"><a class="selflink" href="#disable">disable</a></h2>
This command is used to administratively disable a node in the cluster. A
  disabled node will still participate in the cluster and host clustered TDB
  records but its public ip address has been taken over by a different node and
  it no longer hosts any services.
<h2 class="Ss" title="Ss" id="enable"><a class="selflink" href="#enable">enable</a></h2>
Re-enable a node that has been administratively disabled.
<h2 class="Ss" title="Ss" id="stop"><a class="selflink" href="#stop">stop</a></h2>
This command is used to administratively STOP a node in the cluster. A STOPPED
  node is connected to the cluster but will not host any public ip addresse, nor
  does it participate in the VNNMAP. The difference between a DISABLED node and
  a STOPPED node is that a STOPPED node does not host any parts of the database
  which means that a recovery is required to stop/continue nodes.
<h2 class="Ss" title="Ss" id="continue"><a class="selflink" href="#continue">continue</a></h2>
Re-start a node that has been administratively stopped.
<h2 class="Ss" title="Ss" id="addip_IPADDR/mask_IFACE"><a class="selflink" href="#addip_IPADDR/mask_IFACE">addip
  <i>IPADDR</i>/<i>mask</i> <i>IFACE</i></a></h2>
This command is used to add a new public ip to a node during runtime. This
  allows public addresses to be added to a cluster without having to restart the
  ctdb daemons.
<div class="Pp"></div>
Note that this only updates the runtime instance of ctdb. Any changes will be
  lost next time ctdb is restarted and the public addresses file is re-read. If
  you want this change to be permanent you must also update the public addresses
  file manually.
<h2 class="Ss" title="Ss" id="delip_IPADDR"><a class="selflink" href="#delip_IPADDR">delip
  <i>IPADDR</i></a></h2>
This command is used to remove a public ip from a node during runtime. If this
  public ip is currently hosted by the node it being removed from, the ip will
  first be failed over to another node, if possible, before it is removed.
<div class="Pp"></div>
Note that this only updates the runtime instance of ctdb. Any changes will be
  lost next time ctdb is restarted and the public addresses file is re-read. If
  you want this change to be permanent you must also update the public addresses
  file manually.
<h2 class="Ss" title="Ss" id="moveip_IPADDR_PNN"><a class="selflink" href="#moveip_IPADDR_PNN">moveip
  <i>IPADDR</i> <i>PNN</i></a></h2>
This command can be used to manually fail a public ip address to a specific
  node.
<div class="Pp"></div>
In order to manually override the &quot;automatic&quot; distribution of public
  ip addresses that ctdb normally provides, this command only works when you
  have changed the tunables for the daemon to:
<div class="Pp"></div>
DeterministicIPs = 0
<div class="Pp"></div>
NoIPFailback = 1
<h2 class="Ss" title="Ss" id="shutdown"><a class="selflink" href="#shutdown">shutdown</a></h2>
This command will shutdown a specific CTDB daemon.
<h2 class="Ss" title="Ss" id="setlmasterrole_on|off"><a class="selflink" href="#setlmasterrole_on|off">setlmasterrole
  on|off</a></h2>
This command is used ot enable/disable the LMASTER capability for a node at
  runtime. This capability determines whether or not a node can be used as an
  LMASTER for records in the database. A node that does not have the LMASTER
  capability will not show up in the vnnmap.
<div class="Pp"></div>
Nodes will by default have this capability, but it can be stripped off nodes by
  the setting in the sysconfig file or by using this command.
<div class="Pp"></div>
Once this setting has been enabled/disabled, you need to perform a recovery for
  it to take effect.
<div class="Pp"></div>
See also &quot;ctdb getcapabilities&quot;
<h2 class="Ss" title="Ss" id="setrecmasterrole_on|off"><a class="selflink" href="#setrecmasterrole_on|off">setrecmasterrole
  on|off</a></h2>
This command is used ot enable/disable the RECMASTER capability for a node at
  runtime. This capability determines whether or not a node can be used as an
  RECMASTER for the cluster. A node that does not have the RECMASTER capability
  can not win a recmaster election. A node that already is the recmaster for the
  cluster when the capability is stripped off the node will remain the recmaster
  until the next cluster election.
<div class="Pp"></div>
Nodes will by default have this capability, but it can be stripped off nodes by
  the setting in the sysconfig file or by using this command.
<div class="Pp"></div>
See also &quot;ctdb getcapabilities&quot;
<h2 class="Ss" title="Ss" id="reloadnodes"><a class="selflink" href="#reloadnodes">reloadnodes</a></h2>
This command is used when adding new nodes, or removing existing nodes from an
  existing cluster.
<div class="Pp"></div>
Procedure to add nodes:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 1.To expand an existing cluster, first ensure
  with <b>ctdb status</b> that all nodes are up and running and that they are
  all healthy. Do not try to expand a cluster unless it is completely
  healthy!</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 2.On all nodes, edit /etc/ctdb/nodes and
  <i>add the new nodes at the end of this file</i>.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 3.Verify that all the nodes have identical
  /etc/ctdb/nodes files after adding the new nodes.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 4.Run <b>ctdb reloadnodes</b> to force all
  nodes to reload the nodes file.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 5.Use <b>ctdb status</b> on all nodes and
  verify that they now show the additional nodes.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 6.Install and configure the new node and
  bring it online.</div>
<div class="Pp"></div>
Procedure to remove nodes:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 1.To remove nodes from an existing cluster,
  first ensure with <b>ctdb status</b> that all nodes, except the node to be
  deleted, are up and running and that they are all healthy. Do not try to
  remove nodes from a cluster unless the cluster is completely healthy!</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 2.Shutdown and power off the node to be
  removed.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 3.On all other nodes, edit the
  /etc/ctdb/nodes file and <i>comment out</i> the nodes to be removed. <i>Do not
  delete the lines for the deleted nodes</i>, just comment them out by adding a
  '#' at the beginning of the lines.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 4.Run <b>ctdb reloadnodes</b> to force all
  nodes to reload the nodes file.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;"> 5.Use <b>ctdb status</b> on all nodes and
  verify that the deleted nodes are no longer listed.</div>
<h2 class="Ss" title="Ss" id="reloadips_[PNN-LIST]"><a class="selflink" href="#reloadips_[PNN-LIST]">reloadips
  [ <i>PNN-LIST</i>]</a></h2>
This command reloads the public addresses configuration file on the specified
  nodes. When it completes addresses will be reconfigured and reassigned across
  the cluster as necessary.
<h2 class="Ss" title="Ss" id="getdbmap"><a class="selflink" href="#getdbmap">getdbmap</a></h2>
This command lists all clustered TDB databases that the CTDB daemon has attached
  to. Some databases are flagged as PERSISTENT, this means that the database
  stores data persistently and the data will remain across reboots. One example
  of such a database is secrets.tdb where information about how the cluster was
  joined to the domain is stored.
<div class="Pp"></div>
If a PERSISTENT database is not in a healthy state the database is flagged as
  UNHEALTHY. If there's at least one completely healthy node running in the
  cluster, it's possible that the content is restored by a recovery run
  automaticly. Otherwise an administrator needs to analyze the problem.
<div class="Pp"></div>
See also &quot;ctdb getdbstatus&quot;, &quot;ctdb backupdb&quot;, &quot;ctdb
  restoredb&quot;, &quot;ctdb dumpbackup&quot;, &quot;ctdb wipedb&quot;,
  &quot;ctdb setvar AllowUnhealthyDBRead 1&quot; and (if samba or tdb-utils are
  installed) &quot;tdbtool check&quot;.
<div class="Pp"></div>
Most databases are not persistent and only store the state information that the
  currently running samba daemons need. These databases are always wiped when
  ctdb/samba starts and when a node is rebooted.
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Example</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
# ctdb getdbmap
Number of databases:10
dbid:0x435d3410 name:notify.tdb path:/var/lib/ctdb/notify.tdb.0
dbid:0x42fe72c5 name:locking.tdb path:/var/lib/ctdb/locking.tdb.0
dbid:0x1421fb78 name:brlock.tdb path:/var/lib/ctdb/brlock.tdb.0
dbid:0x17055d90 name:connections.tdb path:/var/lib/ctdb/connections.tdb.0
dbid:0xc0bdde6a name:sessionid.tdb path:/var/lib/ctdb/sessionid.tdb.0
dbid:0x122224da name:test.tdb path:/var/lib/ctdb/test.tdb.0
dbid:0x2672a57f name:idmap2.tdb path:/var/lib/ctdb/persistent/idmap2.tdb.0 PERSISTENT
dbid:0xb775fff6 name:secrets.tdb path:/var/lib/ctdb/persistent/secrets.tdb.0 PERSISTENT
dbid:0xe98e08b6 name:group_mapping.tdb path:/var/lib/ctdb/persistent/group_mapping.tdb.0 PERSISTENT
dbid:0x7bbbd26c name:passdb.tdb path:/var/lib/ctdb/persistent/passdb.tdb.0 PERSISTENT
<div class="Pp"></div>
# ctdb getdbmap  # example for unhealthy database
Number of databases:1
dbid:0xb775fff6 name:secrets.tdb path:/var/lib/ctdb/persistent/secrets.tdb.0 PERSISTENT UNHEALTHY
<div class="Pp"></div>
# ctdb -X getdbmap
|ID|Name|Path|Persistent|Unhealthy|
|0x7bbbd26c|passdb.tdb|/var/lib/ctdb/persistent/passdb.tdb.0|1|0|
	
</pre>
</div>
</div>
<h2 class="Ss" title="Ss" id="backupdb_DB_FILE"><a class="selflink" href="#backupdb_DB_FILE">backupdb
  <i>DB</i> <i>FILE</i></a></h2>
Copy the contents of database DB to FILE. FILE can later be read back using
  <b>restoredb</b>. This is mainly useful for backing up persistent databases
  such as secrets.tdb and similar.
<h2 class="Ss" title="Ss" id="restoredb_FILE_[DB]"><a class="selflink" href="#restoredb_FILE_[DB]">restoredb
  <i>FILE</i> [<i>DB</i>]</a></h2>
This command restores a persistent database that was previously backed up using
  backupdb. By default the data will be restored back into the same database as
  it was created from. By specifying dbname you can restore the data into a
  different database.
<h2 class="Ss" title="Ss" id="setdbreadonly_DB"><a class="selflink" href="#setdbreadonly_DB">setdbreadonly
  <i>DB</i></a></h2>
This command will enable the read-only record support for a database. This is an
  experimental feature to improve performance for contended records primarily in
  locking.tdb and brlock.tdb. When enabling this feature you must set it on all
  nodes in the cluster.
<h2 class="Ss" title="Ss" id="setdbsticky_DB"><a class="selflink" href="#setdbsticky_DB">setdbsticky
  <i>DB</i></a></h2>
This command will enable the sticky record support for the specified database.
  This is an experimental feature to improve performance for contended records
  primarily in locking.tdb and brlock.tdb. When enabling this feature you must
  set it on all nodes in the cluster.
<h1 class="Sh" title="Sh" id="INTERNAL_COMMANDS"><a class="selflink" href="#INTERNAL_COMMANDS">INTERNAL
  COMMANDS</a></h1>
Internal commands are used by CTDB's scripts and are not required for managing a
  CTDB cluster. Their parameters and behaviour are subject to change.
<h2 class="Ss" title="Ss" id="gettickles_IPADDR"><a class="selflink" href="#gettickles_IPADDR">gettickles
  <i>IPADDR</i></a></h2>
Show TCP connections that are registered with CTDB to be &quot;tickled&quot; if
  there is a failover.
<h2 class="Ss" title="Ss" id="gratiousarp_IPADDR_INTERFACE"><a class="selflink" href="#gratiousarp_IPADDR_INTERFACE">gratiousarp
  <i>IPADDR</i> <i>INTERFACE</i></a></h2>
Send out a gratious ARP for the specified interface through the specified
  interface. This command is mainly used by the ctdb eventscripts.
<h2 class="Ss" title="Ss" id="killtcp"><a class="selflink" href="#killtcp">killtcp</a></h2>
Read a list of TCP connections, one per line, from standard input and terminate
  each connection. A connection is specified as:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
	 <i>SRC-IPADDR</i>:<i>SRC-PORT</i> <i>DST-IPADDR</i>:<i>DST-PORT</i>
      
</pre>
</div>
<div class="Pp"></div>
Each connection is terminated by issuing a TCP RST to the SRC-IPADDR:SRC-PORT
  endpoint.
<div class="Pp"></div>
A single connection can be specified on the command-line rather than on standard
  input.
<h2 class="Ss" title="Ss" id="pdelete_DB_KEY"><a class="selflink" href="#pdelete_DB_KEY">pdelete
  <i>DB</i> <i>KEY</i></a></h2>
Delete KEY from DB.
<h2 class="Ss" title="Ss" id="pfetch_DB_KEY"><a class="selflink" href="#pfetch_DB_KEY">pfetch
  <i>DB</i> <i>KEY</i></a></h2>
Print the value associated with KEY in DB.
<h2 class="Ss" title="Ss" id="pstore_DB_KEY_FILE"><a class="selflink" href="#pstore_DB_KEY_FILE">pstore
  <i>DB</i> <i>KEY</i> <i>FILE</i></a></h2>
Store KEY in DB with contents of FILE as the associated value.
<h2 class="Ss" title="Ss" id="ptrans_DB_[FILE]"><a class="selflink" href="#ptrans_DB_[FILE]">ptrans
  <i>DB</i> [<i>FILE</i>]</a></h2>
Read a list of key-value pairs, one per line from FILE, and store them in DB
  using a single transaction. An empty value is equivalent to deleting the given
  key.
<div class="Pp"></div>
The key and value should be separated by spaces or tabs. Each key/value should
  be a printable string enclosed in double-quotes.
<h2 class="Ss" title="Ss" id="runstate_[setup|first_recovery|startup|running]"><a class="selflink" href="#runstate_[setup|first_recovery|startup|running]">runstate
  [setup|first_recovery|startup|running]</a></h2>
Print the runstate of the specified node. Runstates are used to serialise
  important state transitions in CTDB, particularly during startup.
<div class="Pp"></div>
If one or more optional runstate arguments are specified then the node must be
  in one of these runstates for the command to succeed.
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Example</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
# ctdb runstate
RUNNING
	
</pre>
</div>
</div>
<h2 class="Ss" title="Ss" id="setifacelink_IFACE_up|down"><a class="selflink" href="#setifacelink_IFACE_up|down">setifacelink
  <i>IFACE</i> up|down</a></h2>
Set the internal state of network interface IFACE. This is typically used in the
  10.interface script in the &quot;monitor&quot; event.
<div class="Pp"></div>
Example: ctdb setifacelink eth0 up
<h2 class="Ss" title="Ss" id="tickle_SRC-IPADDR:SRC-PORT_DST-IPADDR:DST-PORT"><a class="selflink" href="#tickle_SRC-IPADDR:SRC-PORT_DST-IPADDR:DST-PORT">tickle
  <i>SRC-IPADDR</i>:<i>SRC-PORT</i> <i>DST-IPADDR</i>:<i>DST-PORT</i></a></h2>
Send a TCP tickle to the source host for the specified TCP connection. A TCP
  tickle is a TCP ACK packet with an invalid sequence and acknowledge number and
  will when received by the source host result in it sending an immediate
  correct ACK back to the other end.
<div class="Pp"></div>
TCP tickles are useful to &quot;tickle&quot; clients after a IP failover has
  occured since this will make the client immediately recognize the TCP
  connection has been disrupted and that the client will need to reestablish.
  This greatly speeds up the time it takes for a client to detect and
  reestablish after an IP failover in the ctdb cluster.
<h2 class="Ss" title="Ss" id="version"><a class="selflink" href="#version">version</a></h2>
Display the CTDB version.
<h1 class="Sh" title="Sh" id="DEBUGGING_COMMANDS"><a class="selflink" href="#DEBUGGING_COMMANDS">DEBUGGING
  COMMANDS</a></h1>
These commands are primarily used for CTDB development and testing and should
  not be used for normal administration.
<h2 class="Ss" title="Ss" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h2>
--print-emptyrecords
<div style="margin-left: 4.00ex;">This enables printing of empty records when
  dumping databases with the catdb, cattbd and dumpdbbackup commands. Records
  with empty data segment are considered deleted by ctdb and cleaned by the
  vacuuming mechanism, so this switch can come in handy for debugging the
  vacuuming behaviour.</div>
<div class="Pp"></div>
--print-datasize
<div style="margin-left: 4.00ex;">This lets database dumps (catdb, cattdb,
  dumpdbbackup) print the size of the record data instead of dumping the data
  contents.</div>
<div class="Pp"></div>
--print-lmaster
<div style="margin-left: 4.00ex;">This lets catdb print the lmaster for each
  record.</div>
<div class="Pp"></div>
--print-hash
<div style="margin-left: 4.00ex;">This lets database dumps (catdb, cattdb,
  dumpdbbackup) print the hash for each record.</div>
<div class="Pp"></div>
--print-recordflags
<div style="margin-left: 4.00ex;">This lets catdb and dumpdbbackup print the
  record flags for each record. Note that cattdb always prints the flags.</div>
<h2 class="Ss" title="Ss" id="process-exists_PID"><a class="selflink" href="#process-exists_PID">process-exists
  <i>PID</i></a></h2>
This command checks if a specific process exists on the CTDB host. This is
  mainly used by Samba to check if remote instances of samba are still running
  or not.
<h2 class="Ss" title="Ss" id="getdbstatus_DB"><a class="selflink" href="#getdbstatus_DB">getdbstatus
  <i>DB</i></a></h2>
This command displays more details about a database.
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Example</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
# ctdb getdbstatus test.tdb.0
dbid: 0x122224da
name: test.tdb
path: /var/lib/ctdb/test.tdb.0
PERSISTENT: no
HEALTH: OK
<div class="Pp"></div>
# ctdb getdbstatus registry.tdb  # with a corrupted TDB
dbid: 0xf2a58948
name: registry.tdb
path: /var/lib/ctdb/persistent/registry.tdb.0
PERSISTENT: yes
HEALTH: NO-HEALTHY-NODES - ERROR - Backup of corrupted TDB in '/var/lib/ctdb/persistent/registry.tdb.0.corrupted.20091208091949.0Z'
	
</pre>
</div>
</div>
<h2 class="Ss" title="Ss" id="catdb_DB"><a class="selflink" href="#catdb_DB">catdb
  <i>DB</i></a></h2>
Print a dump of the clustered TDB database DB.
<h2 class="Ss" title="Ss" id="cattdb_DB"><a class="selflink" href="#cattdb_DB">cattdb
  <i>DB</i></a></h2>
Print a dump of the contents of the local TDB database DB.
<h2 class="Ss" title="Ss" id="dumpdbbackup_FILE"><a class="selflink" href="#dumpdbbackup_FILE">dumpdbbackup
  <i>FILE</i></a></h2>
Print a dump of the contents from database backup FILE, similar to <b>catdb</b>.
<h2 class="Ss" title="Ss" id="wipedb_DB"><a class="selflink" href="#wipedb_DB">wipedb
  <i>DB</i></a></h2>
Remove all contents of database DB.
<h2 class="Ss" title="Ss" id="recover"><a class="selflink" href="#recover">recover</a></h2>
This command will trigger the recovery daemon to do a cluster recovery.
<h2 class="Ss" title="Ss" id="ipreallocate,_sync"><a class="selflink" href="#ipreallocate,_sync">ipreallocate,
  sync</a></h2>
This command will force the recovery master to perform a full ip reallocation
  process and redistribute all ip addresses. This is useful to &quot;reset&quot;
  the allocations back to its default state if they have been changed using the
  &quot;moveip&quot; command. While a &quot;recover&quot; will also perform this
  reallocation, a recovery is much more hevyweight since it will also rebuild
  all the databases.
<h2 class="Ss" title="Ss" id="getmonmode"><a class="selflink" href="#getmonmode">getmonmode</a></h2>
This command returns the monutoring mode of a node. The monitoring mode is
  either ACTIVE or DISABLED. Normally a node will continuously monitor that all
  other nodes that are expected are in fact connected and that they respond to
  commands.
<div class="Pp"></div>
ACTIVE - This is the normal mode. The node is actively monitoring all other
  nodes, both that the transport is connected and also that the node responds to
  commands. If a node becomes unavailable, it will be marked as DISCONNECTED and
  a recovery is initiated to restore the cluster.
<div class="Pp"></div>
DISABLED - This node is not monitoring that other nodes are available. In this
  mode a node failure will not be detected and no recovery will be performed.
  This mode is useful when for debugging purposes one wants to attach GDB to a
  ctdb process but wants to prevent the rest of the cluster from marking this
  node as DISCONNECTED and do a recovery.
<h2 class="Ss" title="Ss" id="setmonmode_0|1"><a class="selflink" href="#setmonmode_0|1">setmonmode
  0|1</a></h2>
This command can be used to explicitly disable/enable monitoring mode on a node.
  The main purpose is if one wants to attach GDB to a running ctdb daemon but
  wants to prevent the other nodes from marking it as DISCONNECTED and issuing a
  recovery. To do this, set monitoring mode to 0 on all nodes before attaching
  with GDB. Remember to set monitoring mode back to 1 afterwards.
<h2 class="Ss" title="Ss" id="attach_DBNAME_[persistent]"><a class="selflink" href="#attach_DBNAME_[persistent]">attach
  <i>DBNAME</i> [persistent]</a></h2>
Create a new CTDB database called DBNAME and attach to it on all nodes.
<h2 class="Ss" title="Ss" id="detach_DB-LIST"><a class="selflink" href="#detach_DB-LIST">detach
  <i>DB-LIST</i></a></h2>
Detach specified non-persistent database(s) from the cluster. This command will
  disconnect specified database(s) on all nodes in the cluster. This command
  should only be used when none of the specified database(s) are in use.
<div class="Pp"></div>
All nodes should be active and tunable AllowClientDBAccess should be disabled on
  all nodes before detaching databases.
<h2 class="Ss" title="Ss" id="dumpmemory"><a class="selflink" href="#dumpmemory">dumpmemory</a></h2>
This is a debugging command. This command will make the ctdb daemon to write a
  fill memory allocation map to standard output.
<h2 class="Ss" title="Ss" id="rddumpmemory"><a class="selflink" href="#rddumpmemory">rddumpmemory</a></h2>
This is a debugging command. This command will dump the talloc memory allocation
  tree for the recovery daemon to standard output.
<h2 class="Ss" title="Ss" id="thaw"><a class="selflink" href="#thaw">thaw</a></h2>
Thaw a previously frozen node.
<h2 class="Ss" title="Ss" id="eventscript_ARGUMENTS"><a class="selflink" href="#eventscript_ARGUMENTS">eventscript
  <i>ARGUMENTS</i></a></h2>
This is a debugging command. This command can be used to manually invoke and run
  the eventscritps with arbitrary arguments.
<h2 class="Ss" title="Ss" id="ban_BANTIME"><a class="selflink" href="#ban_BANTIME">ban
  <i>BANTIME</i></a></h2>
Administratively ban a node for BANTIME seconds. The node will be unbanned after
  BANTIME seconds have elapsed.
<div class="Pp"></div>
A banned node does not participate in the cluster. It does not host any records
  for the clustered TDB and does not host any public IP addresses.
<div class="Pp"></div>
Nodes are automatically banned if they misbehave. For example, a node may be
  banned if it causes too many cluster recoveries.
<div class="Pp"></div>
To administratively exclude a node from a cluster use the <b>stop</b> command.
<h2 class="Ss" title="Ss" id="unban"><a class="selflink" href="#unban">unban</a></h2>
This command is used to unban a node that has either been administratively
  banned using the ban command or has been automatically banned.
<h2 class="Ss" title="Ss" id="rebalancenode_[PNN-LIST]"><a class="selflink" href="#rebalancenode_[PNN-LIST]">rebalancenode
  [ <i>PNN-LIST</i>]</a></h2>
This command marks the given nodes as rebalance targets in the LCP2 IP
  allocation algorithm. The <b>reloadips</b> command will do this as necessary
  so this command should not be needed.
<h2 class="Ss" title="Ss" id="check_srvids_SRVID_..."><a class="selflink" href="#check_srvids_SRVID_...">check_srvids
  <i>SRVID</i> ...</a></h2>
This command checks whether a set of srvid message ports are registered on the
  node or not. The command takes a list of values to check.
<div style="height: 1.00em;">&#x00A0;</div>
<div>&#x00A0;</div>
<b>Example</b>
<div>&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
# ctdb check_srvids 1 2 3 14765
Server id 0:1 does not exist
Server id 0:2 does not exist
Server id 0:3 does not exist
Server id 0:14765 exists
	
</pre>
</div>
</div>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>ctdbd</b>(1), <b>onnode</b>(1), <b>ctdb</b>(7), <b>ctdb-statistics</b>(7),
  <b>ctdb-tunables</b>(7), <b>http://ctdb.samba.org/</b>
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
This documentation was written by Ronnie Sahlberg, Amitay Isaacs, Martin
  Schwenke
<h1 class="Sh" title="Sh" id="COPYRIGHT"><a class="selflink" href="#COPYRIGHT">COPYRIGHT</a></h1>
Copyright &#x00A9; 2007 Andrew Tridgell, Ronnie Sahlberg
<div>&#x00A0;</div>
<div class="Pp"></div>
This program is free software; you can redistribute it and/or modify it under
  the terms of the GNU General Public License as published by the Free Software
  Foundation; either version 3 of the License, or (at your option) any later
  version.
<div class="Pp"></div>
This program is distributed in the hope that it will be useful, but WITHOUT ANY
  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
  A PARTICULAR PURPOSE. See the GNU General Public License for more details.
<div class="Pp"></div>
You should have received a copy of the GNU General Public License along with
  this program; if not, see <b>http://www.gnu.org/licenses</b>.
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">05/25/2017</td>
    <td class="foot-os">ctdb</td>
  </tr>
</table>
</body>
</html>
