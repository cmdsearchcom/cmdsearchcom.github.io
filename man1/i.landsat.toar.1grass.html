<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:18:24 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>i.landsat.toar(1grass) Grass User&rsquo;s Manual
i.landsat.toar(1grass)</p>

<p style="margin-top: 1em">NAME <br>
i.landsat.toar - Calculates top-of-atmosphere radiance or
reflectance and temperature for Landsat MSS/TM/ETM+/OLI</p>

<p style="margin-top: 1em">KEYWORDS <br>
imagery, radiometric conversion, radiance, reflectance,
brightness temperature, atmospheric correction, satellite,
Landsat</p>

<p style="margin-top: 1em">SYNOPSIS <br>
i.landsat.toar <br>
i.landsat.toar --help <br>
i.landsat.toar [-rnp] input=basename output=basename
[metfile=name] [sensor=string] [method=string]
[date=yyyy-mm-dd] [sun_elevation=float]
[product_date=yyyy-mm-dd] <br>
[gain=string] [percent=float] [pixel=integer]
[rayleigh=float] [lsatmet=string[,string,...]] [scale=float]
[--overwrite] [--help] [--verbose] [--quiet] [--ui]</p>

<p style="margin-top: 1em">Flags: <br>
-r <br>
Output at-sensor radiance instead of reflectance for all
bands</p>

<p style="margin-top: 1em">-n <br>
Input raster maps use as extension the number of the band
instead the code</p>

<p style="margin-top: 1em">-p <br>
Print output metadata info</p>

<p style="margin-top: 1em">--overwrite <br>
Allow output files to overwrite existing files</p>

<p style="margin-top: 1em">--help <br>
Print usage summary</p>

<p style="margin-top: 1em">--verbose <br>
Verbose module output</p>

<p style="margin-top: 1em">--quiet <br>
Quiet module output</p>

<p style="margin-top: 1em">--ui <br>
Force launching GUI dialog</p>

<p style="margin-top: 1em">Parameters: <br>
input=basename [required] <br>
Base name of input raster bands <br>
Example: &acirc;B.&acirc; for B.1, B.2, ...</p>

<p style="margin-top: 1em">output=basename [required] <br>
Prefix for output raster maps <br>
Example: &acirc;B.toar.&acirc; generates B.toar.1, B.toar.2,
...</p>

<p style="margin-top: 1em">metfile=name <br>
Name of Landsat metadata file (.met or MTL.txt)</p>

<p style="margin-top: 1em">sensor=string <br>
Spacecraft sensor <br>
Required only if &acirc;metfile&acirc; not given
(recommended for sanity) <br>
Options: mss1, mss2, mss3, mss4, mss5, tm4, tm5, tm7, oli8
<br>
mss1: Landsat-1 MSS <br>
mss2: Landsat-2 MSS <br>
mss3: Landsat-3 MSS <br>
mss4: Landsat-4 MSS <br>
mss5: Landsat-5 MSS <br>
tm4: Landsat-4 TM <br>
tm5: Landsat-5 TM <br>
tm7: Landsat-7 ETM+ <br>
oli8: Landsat_8 OLI/TIRS</p>

<p style="margin-top: 1em">method=string <br>
Atmospheric correction method <br>
Atmospheric correction method <br>
Options: uncorrected, dos1, dos2, dos2b, dos3, dos4 <br>
Default: uncorrected</p>

<p style="margin-top: 1em">date=yyyy-mm-dd <br>
Image acquisition date (yyyy-mm-dd) <br>
Required only if &acirc;metfile&acirc; not given</p>

<p style="margin-top: 1em">sun_elevation=float <br>
Sun elevation in degrees <br>
Required only if &acirc;metfile&acirc; not given</p>

<p style="margin-top: 1em">product_date=yyyy-mm-dd <br>
Image creation date (yyyy-mm-dd) <br>
Required only if &acirc;metfile&acirc; not given</p>

<p style="margin-top: 1em">gain=string <br>
Gain (H/L) of all Landsat ETM+ bands (1-5,61,62,7,8) <br>
Required only if &acirc;metfile&acirc; not given</p>

<p style="margin-top: 1em">percent=float <br>
Percent of solar radiance in path radiance <br>
Required only if &acirc;method&acirc; is any DOS <br>
Default: 0.01</p>

<p style="margin-top: 1em">pixel=integer <br>
Minimum pixels to consider digital number as dark object
<br>
Required only if &acirc;method&acirc; is any DOS <br>
Default: 1000</p>

<p style="margin-top: 1em">rayleigh=float <br>
Rayleigh atmosphere (diffuse sky irradiance) <br>
Required only if &acirc;method&acirc; is DOS3 <br>
Default: 0.0</p>

<p style="margin-top: 1em">lsatmet=string[,string,...] <br>
return value stored for a given metadata <br>
Required only if &acirc;metfile&acirc; and -p given <br>
Options: number, creation, date, sun_elev, sensor, bands,
sunaz, time <br>
number: Landsat Number <br>
creation: Creation timestamp <br>
date: Date <br>
sun_elev: Sun Elevation <br>
sensor: Sensor <br>
bands: Bands count <br>
sunaz: Sun Azimuth Angle <br>
time: Time</p>

<p style="margin-top: 1em">scale=float <br>
Scale factor for output <br>
Default: 1.0</p>

<p style="margin-top: 1em">DESCRIPTION <br>
i.landsat.toar is used to transform the calibrated digital
number of Landsat imagery products to top-of-atmosphere
radiance or top-of-atmosphere reflectance and temperature
(band <br>
6 of the sensors TM and ETM+). Optionally, it can be used to
calculate the at-surface radiance or reflectance with
atmospheric correction (DOS method).</p>

<p style="margin-top: 1em">Usually, to do so the production
date, the acquisition date, and the solar elevation are
needed. Moreover, for Landsat-7 ETM+ it is also needed the
gain (high or low) of the nine <br>
respective bands.</p>

<p style="margin-top: 1em">Optionally (recommended), the
data can be read from metadata file (.met or MTL.txt) for
all Landsat MSS, TM, ETM+ and OLI/TIRS. However, if the
solar elevation is given the value <br>
of the metadata file is overwritten. This is necessary when
the data in the .met file is incorrect or not accurate.
Also, if acquisition or production dates are not found in
the <br>
metadata file then the command line values are used.</p>

<p style="margin-top: 1em">Attention: Any null value or
smaller than QCALmin in the input raster is set to null in
the output raster and it is not included in the
equations.</p>

<p style="margin-top: 1em">Uncorrected at-sensor values
(method=uncorrected, default) <br>
The standard geometric and radiometric corrections result in
a calibrated digital number (QCAL = DN) images. To further
standardize the impact of illumination geometry, the QCAL
<br>
images are first converted first to at-sensor radiance and
then to at-sensor reflectance. The thermal band is first
converted from QCAL to at-sensor radiance, and then to
effec&acirc; <br>
tive at-sensor temperature in Kelvin degrees.</p>

<p style="margin-top: 1em">Radiometric calibration converts
QCAL to at-sensor radiance, a radiometric quantity measured
in W/(m&Acirc;&sup2; * sr * &Acirc;&micro;m) using the
equations:</p>

<p style="margin-top: 1em">&Acirc;&middot; gain = (Lmax -
Lmin) / (QCALmax - QCALmin)</p>

<p style="margin-top: 1em">&Acirc;&middot; bias = Lmin -
gain * QCALmin</p>

<p style="margin-top: 1em">&Acirc;&middot; radiance = gain
* QCAL + bias <br>
where, Lmax and Lmin are the calibration constants, and
QCALmax and QCALmin are the highest and the lowest points of
the range of rescaled radiance in QCAL.</p>

<p style="margin-top: 1em">Then, to calculate at-sensor
reflectance the equations are:</p>

<p style="margin-top: 1em">&Acirc;&middot; sun_radiance =
[Esun * sin(e)] / (PI * d^2)</p>

<p style="margin-top: 1em">&Acirc;&middot; reflectance =
radiance / sun_radiance <br>
where, d is the earth-sun distance in astronomical units, e
is the solar elevation angle, and Esun is the mean solar
exoatmospheric irradiance in W/(m&Acirc;&sup2; *
&Acirc;&micro;m).</p>

<p style="margin-top: 1em">Simplified at-surface values
(method=dos[1-4]) <br>
Atmospheric correction and reflectance calibration remove
the path radiance, i.e. the stray light from the atmosphere,
and the spectral effect of solar illumination. To output
<br>
these simple at-surface radiance and at-surface reflectance,
the equations are (not for thermal bands):</p>

<p style="margin-top: 1em">&Acirc;&middot; sun_radiance =
TAUv * [Esun * sin(e) * TAUz + Esky] / (PI * d^2)</p>

<p style="margin-top: 1em">&Acirc;&middot; radiance_path =
radiance_dark - percent * sun_radiance</p>

<p style="margin-top: 1em">&Acirc;&middot; radiance =
(at-sensor_radiance - radiance_path)</p>

<p style="margin-top: 1em">&Acirc;&middot; reflectance =
radiance / sun_radiance <br>
where, percent is a value between 0.0 and 1.0 (usually
0.01), Esky is the diffuse sky irradiance, TAUz is the
atmospheric transmittance along the path from the sun to the
ground <br>
surface, and TAUv is the atmospheric transmittance along the
path from the ground surface to the sensor. radiance_dark is
the at-sensor radiance calculated from the darkest <br>
object, i.e. DN with a least &acirc;dark_parameter&acirc;
(usually 1000) pixels for the entire image. The values
are,</p>

<p style="margin-top: 1em">&Acirc;&middot; DOS1: TAUv =
1.0, TAUz = 1.0 and Esky = 0.0</p>

<p style="margin-top: 1em">&Acirc;&middot; DOS2: TAUv =
1.0, Esky = 0.0, and TAUz = sin(e) for all bands with
maximum wave length less than 1. (i.e. bands 4-6 MSS, 1-4
TM, and 1-4 ETM+) other bands TAUz = 1.0</p>

<p style="margin-top: 1em">&Acirc;&middot; DOS3: TAUv =
exp[-t/cos(sat_zenith)], TAUz = exp[-t/sin(e)], Esky =
rayleigh</p>

<p style="margin-top: 1em">&Acirc;&middot; DOS4: TAUv =
exp[-t/cos(sat_zenith)], TAUz = exp[-t/sin(e)], Esky = PI *
radiance_dark <br>
Attention: Output radiance remain untouched (i.e. no set to
0.0 when it is negative) then they are possible negative
values. However, output reflectance is set to 0.0 when is
<br>
obtained a negative value.</p>

<p style="margin-top: 1em">NOTES <br>
The output raster cell values can be rescaled with the scale
parameter (e.g., with 100 in case of using reflectance
output in i.gensigset).</p>

<p style="margin-top: 1em">On Landsat-8 metadata file <br>
NASA reports a structure of the L1G Metadata file
(LDCM-DFCB-004.pdf) for Landsat Data Continuity Mission
(i.e. Landsat-8).</p>

<p style="margin-top: 1em">NASA retains in MIN_MAX_RADIANCE
group the necessary information to transform Digital Numbers
(DN) in radiance values. Then, i.landsat.toar replaces the
possible standard values <br>
with the metadata values. The results match with the values
reported by the metada file in RADIOMETRIC_RESCALING
group.</p>

<p style="margin-top: 1em">Also, NASA reports the same
values of reflectance for all bands in max-min values and in
gain-bias values. This is strange that all bands have the
same range of reflectance. <br>
Also, they wrote in the web page as to calculate reflectance
directly from DN, first with RADIOMETRIC_RESCALING values
and second divided by sin(sun_elevation).</p>

<p style="margin-top: 1em">This is a simple rescaling</p>

<p style="margin-top: 1em">&Acirc;&middot; reflectance =
radiance / sun_radiance = (DN * RADIANCE_MULT +
RADIANCE_ADD) / sun_radiance</p>

<p style="margin-top: 1em">&Acirc;&middot; now reflectance
= DN * REFLECTANCE_MULT + REFLECTANCE_ADD</p>

<p style="margin-top: 1em">&Acirc;&middot; then
REFLECTANCE_MULT = RADIANCE_MULT / sun_radiance</p>

<p style="margin-top: 1em">&Acirc;&middot; and
REFLECTANCE_ADD = RADIANCE_ADD / sun_radiance</p>

<p style="margin-top: 1em">The problem arises when we need
ESUN values (not provided) to compute sun_radiance and DOS.
We assume that REFLECTANCE_MAXIMUM corresponds to the
RADIANCE_MAXIMUM, then</p>

<p style="margin-top: 1em">&Acirc;&middot;
REFLECTANCE_MAXIMUM / sin(e) = RADIANCE_MAXIMUM /
sun_radiance</p>

<p style="margin-top: 1em">&Acirc;&middot; Esun = (PI *
d^2) * RADIANCE_MAXIMUM / REFLECTANCE_MAXIMUM <br>
where d is the earth-sun distance provided by metadata file
or computed inside the program.</p>

<p style="margin-top: 1em">The i.landsat.toar reverts back
the NASA rescaling to continue using Lmax, Lmin, and Esun
values to compute the constant to convert DN to radiance and
radiance to reflectance <br>
with the &quot;traditional&quot; equations and simple
atmospheric corrections. Attention: When MAXIMUM values are
not provided, i.landsat.toar tries to calculate Lmax, Lmin,
and Esun from <br>
RADIOMETRIC_RESCALING (in tests the results were the
same).</p>

<p style="margin-top: 1em">Calibration constants <br>
In verbose mode (flag --verbose), the program write basic
satellite data and the parameters used in the
transformations.</p>

<p style="margin-top: 1em">Production date is not an exact
value but it is necessary to apply correct calibration
constants, which were changed in the dates:</p>

<p style="margin-top: 1em">&Acirc;&middot; Landsat-1 MSS:
never</p>

<p style="margin-top: 1em">&Acirc;&middot; Landsat-2 MSS:
July 16, 1975</p>

<p style="margin-top: 1em">&Acirc;&middot; Landsat-3 MSS:
June 1, 1978</p>

<p style="margin-top: 1em">&Acirc;&middot; Landsat-4 MSS:
August 26, 1982 and April 1, 1983</p>

<p style="margin-top: 1em">&Acirc;&middot; Landsat-4 TM:
August 1, 1983 and January 15, 1984</p>

<p style="margin-top: 1em">&Acirc;&middot; Landsat-5 MSS:
April 6, 1984 and November 9, 1984</p>

<p style="margin-top: 1em">&Acirc;&middot; Landsat-5 TM:
May 4, 2003 and April, 2 2007</p>

<p style="margin-top: 1em">&Acirc;&middot; Landsat-7 ETM+:
July 1, 2000</p>

<p style="margin-top: 1em">&Acirc;&middot; Landsat-8
OLI/TIRS: launched in 2013</p>

<p style="margin-top: 1em">EXAMPLES <br>
Metadata file examples <br>
Transform digital numbers of Landsat-7 ETM+ in band rasters
203_30.1, 203_30.2 [...] to uncorrected at-sensor
reflectance in output files 203_30.1_toar, 203_30.2_toar
[...] and <br>
at-sensor temperature in output files 293_39.61_toar and
293_39.62_toar: <br>
i.landsat.toar input=203_30. output=_toar
metfile=p203r030_7x20010620.met <br>
or <br>
i.landsat.toar input=L5121060_06020060714.
output=L5121060_06020060714_toar
metfile=L5121060_06020060714_MTL.txt <br>
or <br>
i.landsat.toar input=LC80160352013134LGN03_B output=toar
metfile=LC80160352013134LGN03_MTL.txt sensor=oli8
date=2013-05-14</p>

<p style="margin-top: 1em">DOS1 example <br>
DN to reflectance using DOS1: <br>
# rename channels or make a copy to match
i.landsat.toar&acirc;s input scheme: <br>
g.copy raster=lsat7_2002_10,lsat7_2002.1 <br>
g.copy raster=lsat7_2002_20,lsat7_2002.2 <br>
g.copy raster=lsat7_2002_30,lsat7_2002.3 <br>
g.copy raster=lsat7_2002_40,lsat7_2002.4 <br>
g.copy raster=lsat7_2002_50,lsat7_2002.5 <br>
g.copy raster=lsat7_2002_61,lsat7_2002.61 <br>
g.copy raster=lsat7_2002_62,lsat7_2002.62 <br>
g.copy raster=lsat7_2002_70,lsat7_2002.7 <br>
g.copy raster=lsat7_2002_80,lsat7_2002.8 <br>
Calculation of reflectance values from DN using DOS1
(metadata obtained from p016r035_7x20020524.met.gz): <br>
i.landsat.toar input=lsat7_2002. output=lsat7_2002_toar.
sensor=tm7 method=dos1 date=2002-05-24
sun_elevation=64.7730999 product_date=2004-02-12
gain=HHHLHLHHL <br>
The resulting Landsat channels are names lsat7_2002_toar.1
.. lsat7_2002_toar.8.</p>

<p style="margin-top: 1em">REFERENCES <br>
&Acirc;&middot; Chander G., B.L. Markham and D.L. Helder,
2009: Remote Sensing of Environment, vol. 113</p>

<p style="margin-top: 1em">&Acirc;&middot; Chander G.H. and
B. Markham, 2003.: IEEE Transactions On Geoscience And
Remote Sensing, vol. 41, no. 11.</p>

<p style="margin-top: 1em">&Acirc;&middot; Chavez P.S., jr.
1996. Image-based atmospheric corrections - Revisited and
Improved. Photogrammetric Engineering and Remote Sensing
62(9): 1025-1036.</p>

<p style="margin-top: 1em">&Acirc;&middot; Huang et al:
At-Satellite Reflectance, 2002: A First Order Normalization
Of Landsat 7 ETM+ Images.</p>

<p style="margin-top: 1em">&Acirc;&middot; R. Irish:
Landsat 7. Science Data Users Handbook. February 17, 2007;
15 May 2011.</p>

<p style="margin-top: 1em">&Acirc;&middot; Markham B.L. and
J.L. Barker, 1986: Landsat MSS and TM Post-Calibration
Dynamic Ranges, Exoatmospheric Reflectances and At-Satellite
Temperatures. EOSAT Landsat Technical <br>
Notes, No. 1.</p>

<p style="margin-top: 1em">&Acirc;&middot; Moran M.S., R.D.
Jackson, P.N. Slater and P.M. Teillet, 1992: Remote Sensing
of Environment, vol. 41.</p>

<p style="margin-top: 1em">&Acirc;&middot; Song et al,
2001: Classification and Change Detection Using Landsat TM
Data, When and How to Correct Atmospheric Effects? Remote
Sensing of Environment, vol. 75.</p>

<p style="margin-top: 1em">SEE ALSO <br>
i.atcorr, r.mapcalc, r.in.gdal</p>

<p style="margin-top: 1em">Landsat Data Dictionary by
USGS</p>

<p style="margin-top: 1em">AUTHOR <br>
E. Jorge Tizado (ej.tizado unileon es), Dept. Biodiversity
and Environmental Management, University of
Le&Atilde;&sup3;n, Spain</p>

<p style="margin-top: 1em">Last changed: $Date: 2015-12-30
14:00:44 +0100 (Wed, 30 Dec 2015) $</p>

<p style="margin-top: 1em">SOURCE CODE <br>
Available at: i.landsat.toar source code (history)</p>

<p style="margin-top: 1em">Main index | Imagery index |
Topics index | Keywords index | Graphical index | Full
index</p>

<p style="margin-top: 1em">&Acirc;&copy; 2003-2016 GRASS
Development Team, GRASS GIS 7.2.0 Reference Manual</p>

<p style="margin-top: 1em">GRASS 7.2.0
i.landsat.toar(1grass)</p>
<hr>
</body>
</html>
