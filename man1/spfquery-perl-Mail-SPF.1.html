<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>SPFQUERY(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">SPFQUERY(1)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">SPFQUERY(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
spfquery - (Mail::SPF) - Checks if a given set of e-mail parameters matches a
  domain's SPF policy
<h1 class="Sh" title="Sh" id="VERSION"><a class="selflink" href="#VERSION">VERSION</a></h1>
2.501
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Preferred usage:</b></dt>
  <dd class="It-tag"><b>spfquery</b> [<b>--versions</b>|<b>-v</b>
      <b>1</b>|<b>2</b>| <b>1,2</b>] [<b>--scope</b>|<b>-s</b>
      <b>helo</b>|<b>mfrom</b>| <b>pra</b>] <b>--identity</b>|<b>--id</b>
      <i>identity</i> <b>--ip-address</b>|<b>--ip</b> <i>ip-address</i> [
      <b>--helo-identity</b>| <b>--helo-id</b> <i>helo-identity</i>]
      [<i>OPTIONS</i>]
    <div style="height: 1.00em;">&#x00A0;</div>
     <b>spfquery</b> [<b>--versions</b>|<b>-v</b> <b>1</b>|<b>2</b>|<b>1,2</b>]
      [ <b>--scope</b>|<b>-s</b> <b>helo</b>|<b>mfrom</b>|<b>pra</b>]
      <b>--file</b>| <b>-f</b> <i>filename</i>|<b>-</b> [<i>OPTIONS</i>]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Legacy usage:</b></dt>
  <dd class="It-tag"><b>spfquery</b> <b>--helo</b> <i>helo-identity</i>
      <b>--ip-address</b>| <b>--ip</b> <i>ip-address</i> [<i>OPTIONS</i>]
    <div style="height: 1.00em;">&#x00A0;</div>
     <b>spfquery</b> <b>--mfrom</b> <i>mfrom-identity</i>
      <b>--ip-address</b>|<b>--ip</b> <i>ip-address</i> [ <b>--helo</b>
      <i>helo-identity</i>] [ <i>OPTIONS</i>]
    <div style="height: 1.00em;">&#x00A0;</div>
     <b>spfquery</b> <b>--pra</b> <i>pra-identity</i>
      <b>--ip-address</b>|<b>--ip</b> <i>ip-address</i> [<i>OPTIONS</i>]</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Other usage:</b></dt>
  <dd class="It-tag"><b>spfquery</b> <b>--version</b>|<b>-V</b>
    <div style="height: 1.00em;">&#x00A0;</div>
     <b>spfquery</b> <b>--help</b></dd>
</dl>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<b>spfquery</b> checks if a given set of e-mail parameters (e.g., the SMTP
  sender's IP address) matches the responsible domain's Sender Policy Framework
  (SPF) policy. For more information on SPF see &lt;http://www.openspf.org&gt;.
<h2 class="Ss" title="Ss" id="Preferred_Usage"><a class="selflink" href="#Preferred_Usage">Preferred
  Usage</a></h2>
The following usage forms are preferred over the legacy forms used by older
  <b>spfquery</b> versions:
<div class="Pp"></div>
The <b>--identity</b> form checks if the given <i>ip-address</i> is an
  authorized SMTP sender for the given &quot;helo&quot; hostname,
  &quot;mfrom&quot; envelope sender e-mail address, or &quot;pra&quot;
  (so-called purported resonsible address) e-mail address, depending on the
  value of the <b>--scope</b> option (which defaults to <b>mfrom</b> if
  omitted).
<div class="Pp"></div>
The <b>--file</b> form reads &quot;<i>ip-address</i> <i>identity</i>
  [<i>helo-identity</i>]&quot; tuples from the file with the specified
  <i>filename</i>, or from standard input if <i>filename</i> is <b>-</b>, and
  checks them against the specified scope ( <b>mfrom</b> by default).
<div class="Pp"></div>
Both forms support an optional <b>--versions</b> option, which specifies a
  comma-separated list of the SPF version numbers of SPF records that may be
  used. <b>1</b> means that &quot;v=spf1&quot; records should be used. <b>2</b>
  means that &quot;spf2.0&quot; records should be used. Defaults to <b>1,2</b>,
  i.e., uses any SPF records that are available. Records of a higher version are
  preferred.
<h2 class="Ss" title="Ss" id="Legacy_Usage"><a class="selflink" href="#Legacy_Usage">Legacy
  Usage</a></h2>
<b>spfquery</b> versions before 2.500 featured the following usage forms, which
  are discouraged but still supported for backwards compatibility:
<div class="Pp"></div>
The <b>--helo</b> form checks if the given <i>ip-address</i> is an authorized
  SMTP sender for the &quot;HELO&quot; hostname given as the <i>identity</i>
  (so-called &quot;HELO&quot; check).
<div class="Pp"></div>
The <b>--mfrom</b> form checks if the given <i>ip-address</i> is an authorized
  SMTP sender for the envelope sender email-address (or domain) given as the
  <i>identity</i> (so-called &quot;MAIL FROM&quot; check). If a domain is given
  instead of an e-mail address, &quot;postmaster&quot; will be substituted for
  the localpart.
<div class="Pp"></div>
The <b>--pra</b> form checks if the given <i>ip-address</i> is an authorized
  SMTP sender for the PRA (Purported Responsible Address) e-mail address given
  as the identity.
<h2 class="Ss" title="Ss" id="Other_Usage"><a class="selflink" href="#Other_Usage">Other
  Usage</a></h2>
The <b>--version</b> form prints version information of spfquery. The
  <b>--help</b> form prints usage information for spfquery.
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
<h2 class="Ss" title="Ss" id="Standard_Options"><a class="selflink" href="#Standard_Options">Standard
  Options</a></h2>
The preferred and legacy forms optionally take any of the following
  <i>OPTIONS</i>:
<dl class="Bl-tag">
  <dt class="It-tag"><b>--default-explanation</b> <i>string</i></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--def-exp</b> <i>string</i></dt>
  <dd class="It-tag">Use the specified <i>string</i> as the default explanation
      if the authority domain does not specify an explanation string of its
    own.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--hostname</b> <i>hostname</i></dt>
  <dd class="It-tag">Use <i>hostname</i> as the host name of the local system
      instead of auto-detecting it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--keep-comments</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--no-keep-comments</b></dt>
  <dd class="It-tag">Do (not) print any comments found when reading from a file
      or from standard input.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sanitize</b> (currently ignored)</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--no-sanitize</b> (currently ignored)</dt>
  <dd class="It-tag">Do (not) sanitize the output by condensing consecutive
      white-space into a single space and replacing non-printable characters
      with question marks. Enabled by default.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--debug</b> (currently ignored)</dt>
  <dd class="It-tag">Print out debug information.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Black_Magic_Options"><a class="selflink" href="#Black_Magic_Options">Black
  Magic Options</a></h2>
Several options that were supported by earlier versions of <b>spfquery</b> are
  considered black magic (i.e. potentially dangerous for the innocent user) and
  are thus disabled by default. If the <b>Mail::SPF::BlackMagic</b> Perl module
  is installed, they may be enabled by specifying <b>--enable-black-magic</b>.
<dl class="Bl-tag">
  <dt class="It-tag"><b>--max-dns-interactive-terms</b> <i>n</i></dt>
  <dd class="It-tag">Evaluate a maximum of <i>n</i> DNS-interactive mechanisms
      and modifiers per SPF check. Defaults to <b>10</b>. Do <i>not</i> override
      the default unless you know what you are doing!</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--max-name-lookups-per-term</b> <i>n</i></dt>
  <dd class="It-tag">Perform a maximum of <i>n</i> DNS name look-ups per
      mechanism or modifier. Defaults to <b>10</b>. Do <i>not</i> override the
      default unless you know what you are doing!</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--authorize-mxes-for</b>
    <i>email-address</i>|<i>domain</i> <b>,</b>...</dt>
  <dd class="It-tag">Consider all the MXes of the comma-separated list of
      <i>email-address</i>es and <i>domain</i>s as inherently authorized.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--tfwl</b></dt>
  <dd class="It-tag">Perform &quot;trusted-forwarder.org&quot; accreditation
      checking.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--guess</b> <i>spf-terms</i></dt>
  <dd class="It-tag">Use <i>spf-terms</i> as a default record if no SPF record
      is found.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--local</b> <i>spf-terms</i></dt>
  <dd class="It-tag">Process <i>spf-terms</i> as local policy before resorting
      to a default result (the implicit or explicit &quot;all&quot; mechanism at
      the end of the domain's SPF record). For example, this could be used for
      white-listing one's secondary MXes:
    &quot;mx:mydomain.example.org&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--override</b>
    <i>domain</i><b>=</b><i>spf-record</i></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--fallback</b>
    <i>domain</i><b>=</b><i>spf-record</i></dt>
  <dd class="It-tag">Set overrides and fallbacks. Each option can be specified
      multiple times. For example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    --override example.org='v=spf1 -all'
    --override '*.example.net'='v=spf1 a mx -all'
    --fallback example.com='v=spf1 -all'
    </pre>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="RESULT_CODES"><a class="selflink" href="#RESULT_CODES">RESULT
  CODES</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>pass</b></dt>
  <dd class="It-tag">The specified IP address is an authorized SMTP sender for
      the identity.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>fail</b></dt>
  <dd class="It-tag">The specified IP address is not an authorized SMTP sender
      for the identity.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>softfail</b></dt>
  <dd class="It-tag">The specified IP address is not an authorized SMTP sender
      for the identity, however the authority domain is still testing out its
      SPF policy.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>neutral</b></dt>
  <dd class="It-tag">The identity's authority domain makes no assertion about
      the status of the IP address.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>permerror</b></dt>
  <dd class="It-tag">A permanent error occurred while evaluating the authority
      domain's policy (e.g., a syntax error in the SPF record). Manual
      intervention is required from the authority domain.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>temperror</b></dt>
  <dd class="It-tag">A temporary error occurred while evaluating the authority
      domain's policy (e.g., a DNS error). Try again later.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>none</b></dt>
  <dd class="It-tag">There is no applicable SPF policy for the identity
    domain.</dd>
</dl>
<h1 class="Sh" title="Sh" id="EXIT_CODES"><a class="selflink" href="#EXIT_CODES">EXIT
  CODES</a></h1>
<pre>
  Result    | Exit code
 -----------+-----------
  pass      |     0
  fail      |     1
  softfail  |     2
  neutral   |     3
  permerror |     4
  temperror |     5
  none      |     6
</pre>
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
<pre>
    spfquery --scope mfrom --id user@example.com --ip 1.2.3.4
    spfquery --file test_data
    echo &quot;127.0.0.1 user@example.com helohost.example.com&quot; | spfquery -f -
</pre>
<h1 class="Sh" title="Sh" id="COMPATIBILITY"><a class="selflink" href="#COMPATIBILITY">COMPATIBILITY</a></h1>
<b>spfquery</b> has undergone the following interface changes compared to
  earlier versions:
<dl class="Bl-tag">
  <dt class="It-tag"><b>2.500</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">A new preferred usage style for performing individual SPF
      checks has been introduced. The new style accepts a unified
      <b>--identity</b> option and an optional <b>--scope</b> option that
      specifies the type (scope) of the identity. In contrast, the legacy usage
      style requires a separate usage form for every supported scope. See
      &quot;Preferred usage&quot; and &quot;Legacy usage&quot; for details.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The former &quot;unknown&quot; and &quot;error&quot; result
      codes have been renamed to &quot;permerror&quot; and
      &quot;temperror&quot;, respectively, in order to comply with RFC 4408
      terminology.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">SPF checks with an empty identity are no longer supported.
      In the case of an empty &quot;MAIL FROM&quot; SMTP transaction parameter,
      perform a check with the &quot;helo&quot; scope directly.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The <b>--debug</b> and <b>--(no-)sanitize</b> options are
      currently ignored by this version of <b>spfquery</b>. They will again be
      supported in the future.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Several features that were supported by earlier versions of
      <b>spfquery</b> are considered black magic and thus are now disabled by
      default. See &quot;Black Magic Options&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Several option names have been deprecated. This is a list
      of them and their preferred synonyms:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  Deprecated options  | Preferred options
 ---------------------+-----------------------------
  --sender, -s        | --mfrom
  --ipv4, -i          | --ip-address, --ip
  --name              | --hostname
  --max-lookup-count, | --max-dns-interactive-terms
    --max-lookup      |
  --rcpt-to, -r       | --authorize-mxes-for
  --trusted           | --tfwl
    </pre>
  </dd>
</dl>
</div>
<div style="margin-left: 4.00ex;"></div>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
Mail::SPF, <i>spfd</i>(8)
<div class="Pp"></div>
&lt;http://tools.ietf.org/html/rfc4408&gt;
<h1 class="Sh" title="Sh" id="AUTHORS"><a class="selflink" href="#AUTHORS">AUTHORS</a></h1>
This version of <b>spfquery</b> is a complete rewrite by Julian Mehnle
  &lt;julian@mehnle.net&gt;, based on an earlier version written by Meng Weng
  Wong &lt;mengwong+spf@pobox.com&gt; and Wayne Schlitt
  &lt;wayne@schlitt.net&gt;.</div>
<table class="foot">
  <tr>
    <td class="foot-date">2017-05-30</td>
    <td class="foot-os">perl v5.24.1</td>
  </tr>
</table>
</body>
</html>
