<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>virt-builder(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">virt-builder(1)</td>
    <td class="head-vol">Virtualization Support</td>
    <td class="head-rtitle">virt-builder(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
virt-builder - Build virtual machine images quickly
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>
 virt-builder os-version
    [-o|--output DISKIMAGE] [--size SIZE] [--format raw|qcow2]
    [--arch ARCHITECTURE] [--attach ISOFILE]
    [--chmod PERMISSIONS:FILE] [--commands-from-file FILENAME]
    [--copy SOURCE:DEST] [--copy-in LOCALPATH:REMOTEDIR]
    [--delete PATH] [--edit FILE:EXPR] [--firstboot SCRIPT]
    [--firstboot-command 'CMD+ARGS'] [--firstboot-install PKG,PKG..]
    [--hostname HOSTNAME] [--install PKG,PKG..]
    [--link TARGET:LINK[:LINK..]] [--mkdir DIR] [--move SOURCE:DEST]
    [--password USER:SELECTOR] [--root-password SELECTOR]
    [--run SCRIPT] [--run-command 'CMD+ARGS'] [--scrub FILE]
    [--sm-attach SELECTOR] [--sm-register] [--sm-remove]
    [--sm-unregister] [--ssh-inject USER[:SELECTOR]] [--truncate FILE]
    [--truncate-recursive PATH] [--timezone TIMEZONE] [--touch FILE]
    [--uninstall PKG,PKG..] [--update] [--upload FILE:DEST]
    [--write FILE:CONTENT] [--no-logfile]
    [--password-crypto md5|sha256|sha512] [--selinux-relabel]
    [--sm-credentials SELECTOR]
 virt-builder -l|--list [--long] [--list-format short|long|json]
 virt-builder --notes os-version
 virt-builder --print-cache
 virt-builder --cache-all-templates
 virt-builder --delete-cache
 virt-builder --get-kernel DISKIMAGE
    [--format raw|qcow2] [--output OUTPUTDIR]
</pre>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
Virt-builder is a tool for quickly building new virtual machines. You can build
  a variety of VMs for local or cloud use, usually within a few minutes or less.
  Virt-builder also has many ways to customize these VMs. Everything is run from
  the command line and nothing requires root privileges, so automation and
  scripting is simple.
<div class="Pp"></div>
Note that virt-builder does not install guests from scratch. It takes cleanly
  prepared, digitally signed OS templates and customizes them. This approach is
  used because it is much faster, but if you need to do fresh installs you may
  want to look at <i>virt-install</i>(1) and <i>oz-install</i>(1).
<div class="Pp"></div>
The easiest way to get started is by looking at the examples in the next
  section.
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
<h2 class="Ss" title="Ss" id="List_the_virtual_machines_available"><a class="selflink" href="#List_the_virtual_machines_available">List
  the virtual machines available</a></h2>
<pre>
 virt-builder --list
</pre>
<div class="Pp"></div>
will list out the operating systems available to install. A selection of freely
  redistributable OSes is available as standard. You can add your own too (see
  below).
<div class="Pp"></div>
After choosing a guest from the list, you may want to see if there are any
  installation notes:
<div class="Pp"></div>
<pre>
 virt-builder --notes fedora-20
</pre>
<h2 class="Ss" title="Ss" id="Build_a_virtual_machine"><a class="selflink" href="#Build_a_virtual_machine">Build
  a virtual machine</a></h2>
<pre>
 virt-builder fedora-20
</pre>
<div class="Pp"></div>
will build a Fedora 20 image for the same architecture as virt-builder (so
  running it from an i386 installation will try to build an i386 image, if
  available). This will have all default configuration (minimal size, no user
  accounts, random root password, only the bare minimum installed software,
  etc.).
<div class="Pp"></div>
You <i>do not</i> need to run this command as root.
<div class="Pp"></div>
The first time this runs it has to download the template over the network, but
  this gets cached (see &quot;CACHING&quot;).
<div class="Pp"></div>
The name of the output file is derived from the template name, so above it will
  be <i>fedora-20.img</i>. You can change the output filename using the
  <i>-o</i> option:
<div class="Pp"></div>
<pre>
 virt-builder fedora-20 -o mydisk.img
</pre>
<div class="Pp"></div>
You can also use the <i>-o</i> option to write to existing devices or logical
  volumes.
<div class="Pp"></div>
<pre>
 virt-builder fedora-20 --format qcow2
</pre>
<div class="Pp"></div>
As above, but write the output in qcow2 format to <i>fedora-20.qcow2</i>.
<div class="Pp"></div>
<pre>
 virt-builder fedora-20 --size 20G
</pre>
<div class="Pp"></div>
As above, but the output size will be 20 GB. The guest OS is resized as it is
  copied to the output (automatically, using <i>virt-resize</i>(1)).
<div class="Pp"></div>
<pre>
 virt-builder fedora-20 --arch i386
</pre>
<div class="Pp"></div>
As above, but using an i386 template, if available.
<h2 class="Ss" title="Ss" id="Setting_the_root_password"><a class="selflink" href="#Setting_the_root_password">Setting
  the root password</a></h2>
<pre>
 virt-builder fedora-20 --root-password file:/tmp/rootpw
</pre>
<div class="Pp"></div>
Create a Fedora 20 image. The root password is taken from the file
  <i>/tmp/rootpw</i>.
<div class="Pp"></div>
Note if you <i>don't</i> set <i>--root-password</i> then the guest is given a
  <i>random</i> root password.
<div class="Pp"></div>
You can also create user accounts. See &quot;USERS AND PASSWORDS&quot; below.
<h2 class="Ss" title="Ss" id="Set_the_hostname"><a class="selflink" href="#Set_the_hostname">Set
  the hostname</a></h2>
<pre>
 virt-builder fedora-20 --hostname virt.example.com
</pre>
<div class="Pp"></div>
Set the hostname to &quot;virt.example.com&quot;.
<h2 class="Ss" title="Ss" id="Installing_software"><a class="selflink" href="#Installing_software">Installing
  software</a></h2>
To install packages from the ordinary (guest) software repository (eg. yum or
  apt):
<div class="Pp"></div>
<pre>
 virt-builder fedora-20 --install &quot;inkscape,@Xfce Desktop&quot;
</pre>
<div class="Pp"></div>
(In Fedora, &quot;@&quot; is used to install groups of packages. On Debian you
  would install a meta-package instead.)
<div class="Pp"></div>
To update the core packages to the latest version:
<div class="Pp"></div>
<pre>
 virt-builder debian-7 --update
</pre>
<div class="Pp"></div>
For guests which use SELinux, like Fedora and Red Hat Enterprise Linux, you may
  need to do SELinux relabelling after installing or updating packages (see
  &quot;SELINUX&quot; below):
<div class="Pp"></div>
<pre>
 virt-builder fedora-20 --update --selinux-relabel
</pre>
<h2 class="Ss" title="Ss" id="Customizing_the_installation"><a class="selflink" href="#Customizing_the_installation">Customizing
  the installation</a></h2>
There are many options that let you customize the installation. These include:
  <i>--run</i>/<i>--run-command</i>, which run a shell script or command while
  the disk image is being generated and lets you add or edit files that go into
  the disk image. <i>--firstboot</i>/<i>--firstboot-command</i>, which let you
  add scripts/commands that are run the first time the guest boots.
  <i>--edit</i> to edit files. <i>--upload</i> to upload files.
<div class="Pp"></div>
For example:
<div class="Pp"></div>
<pre>
 cat &lt;&lt;'EOF' &gt; /tmp/yum-update.sh
 yum -y update
 EOF
 
 virt-builder fedora-20 --firstboot /tmp/yum-update.sh
</pre>
<div class="Pp"></div>
or simply:
<div class="Pp"></div>
<pre>
 virt-builder fedora-20 --firstboot-command 'yum -y update'
</pre>
<div class="Pp"></div>
which makes the <i>yum</i>(8) &quot;update&quot; command run once the first time
  the guest boots.
<div class="Pp"></div>
Or:
<div class="Pp"></div>
<pre>
 virt-builder fedora-20 \
   --edit '/etc/yum.conf:
             s/gpgcheck=1/gpgcheck=0/'
</pre>
<div class="Pp"></div>
which edits <i>/etc/yum.conf</i> inside the disk image (during disk image
  creation, long before boot).
<div class="Pp"></div>
You can combine these options, and have multiple options of all types.
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--help</b></dt>
  <dd class="It-tag">Display help.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--arch</b> ARCHITECTURE</dt>
  <dd class="It-tag">Use the specified architecture for the output image. This
      means there must be sources providing the requested template for the
      requested architecture.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also &quot;ARCHITECTURE&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--attach</b> ISOFILE</dt>
  <dd class="It-tag">During the customization phase, the given disk is attached
      to the libguestfs appliance. This is used to provide extra software
      repositories or other data for customization.
    <div style="height: 1.00em;">&#x00A0;</div>
    You probably want to ensure the volume(s) or filesystems in the attached
      disks are labelled (or use an ISO volume name) so that you can mount them
      by label in your run-scripts:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 mkdir /tmp/mount
 mount LABEL=EXTRA /tmp/mount
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    You can have multiple <i>--attach</i> options, and the format can be any
      disk format (not just an ISO).
    <div style="height: 1.00em;">&#x00A0;</div>
    See also: <i>--run</i>, &quot;Installing packages at build time from a side
      repository&quot;, <i>genisoimage</i>(1), <i>virt-make-fs</i>(1).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--attach-format</b> FORMAT</dt>
  <dd class="It-tag">Specify the disk format for the next <i>--attach</i>
      option. The &quot;FORMAT&quot; is usually &quot;raw&quot; or
      &quot;qcow2&quot;. Use &quot;raw&quot; for ISOs.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--cache</b> DIR</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--no-cache</b></dt>
  <dd class="It-tag"><i>--cache</i> DIR sets the directory to use/check for
      cached template files. If not set, defaults to either
      <i></i><i>$XDG_CACHE_HOME</i> <i>/virt-builder/</i> or
      <i></i><i>$HOME</i><i>/.cache/virt-builder/</i>.
    <div style="height: 1.00em;">&#x00A0;</div>
     <i>--no-cache</i> disables template caching.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--cache-all-templates</b></dt>
  <dd class="It-tag">Download all templates to the cache and then exit. See
      &quot;CACHING&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note this doesn't cache everything. More templates might be uploaded. Also
      this doesn't cache packages (the <i>--install</i>, <i>--update</i>
      options).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--check-signature</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--no-check-signature</b></dt>
  <dd class="It-tag">Check/don't check the digital signature of the OS template.
      The default is to check the signature and exit if it is not correct. Using
      <i>--no-check-signature</i> bypasses this check.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also <i>--fingerprint</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--colors</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--colours</b></dt>
  <dd class="It-tag">Use ANSI colour sequences to colourize messages. This is
      the default when the output is a tty. If the output of the program is
      redirected to a file, ANSI colour sequences are disabled unless you use
      this option.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--curl</b> CURL</dt>
  <dd class="It-tag">Specify an alternate <i>curl</i>(1) binary. You can also
      use this to add curl parameters, for example to disable https certificate
      checks:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 virt-builder --curl &quot;curl --insecure&quot; [...]
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--delete-cache</b></dt>
  <dd class="It-tag">Delete the template cache. See &quot;CACHING&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--no-delete-on-failure</b></dt>
  <dd class="It-tag">Don't delete the output file on failure to build. You can
      use this to debug failures to run scripts. See &quot;DEBUGGING
      BUILDS&quot; for ways to debug images.
    <div style="height: 1.00em;">&#x00A0;</div>
    The default is to delete the output file if virt-builder fails (or, for
      example, some script that it runs fails).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--fingerprint</b> 'AAAA BBBB ...'</dt>
  <dd class="It-tag">Check that the index and templates are signed by the key
      with the given fingerprint. (The fingerprint is a long string, usually
      written as 10 groups of 4 hexadecimal digits).
    <div style="height: 1.00em;">&#x00A0;</div>
    You can give this option multiple times. If you have multiple source URLs,
      then you can have either no fingerprint, one fingerprint or multiple
      fingerprints. If you have multiple, then each must correspond 1-1 with a
      source URL.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--format</b> qcow2</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--format</b> raw</dt>
  <dd class="It-tag">For ordinary builds, this selects the output format. The
      default is <i>raw</i>.
    <div style="height: 1.00em;">&#x00A0;</div>
    With <i>--get-kernel</i> this specifies the input format.
    <div style="height: 1.00em;">&#x00A0;</div>
    To create an old-style qcow2 file (for compatibility with RHEL 6 or very old
      qemu &lt; 1.1), after running virt-builder, use this command:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 qemu-img amend -f qcow2 -o compat=0.10 output.qcow2
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--get-kernel</b> IMAGE</dt>
  <dd class="It-tag">This option extracts the kernel and initramfs from a
      previously built disk image called &quot;IMAGE&quot; (in fact it works for
      any VM disk image, not just ones built using virt-builder).
    <div style="height: 1.00em;">&#x00A0;</div>
    The kernel and initramfs are written to the current directory, unless you
      also specify the <i>--output</i> &quot;outputdir&quot; <b>directory</b>
      name.
    <div style="height: 1.00em;">&#x00A0;</div>
    The format of the disk image is automatically detected unless you specify it
      by using the <i>--format</i> option.
    <div style="height: 1.00em;">&#x00A0;</div>
    In the case where the guest contains multiple kernels, the one with the
      highest version number is chosen. To extract arbitrary kernels from the
      disk image, see <i>guestfish</i>(1). To extract the entire <i>/boot</i>
      directory of a guest, see <i>virt-copy-out</i>(1).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--gpg</b> GPG</dt>
  <dd class="It-tag">Specify an alternate <i>gpg</i>(1) (GNU Privacy Guard)
      binary. You can also use this to add gpg parameters, for example to
      specify an alternate home directory:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 virt-builder --gpg &quot;gpg --homedir /tmp&quot; [...]
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-l</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--list</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--list --list-format</b> format</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--list --long</b></dt>
  <dd class="It-tag">List available templates.
    <div style="height: 1.00em;">&#x00A0;</div>
    It is possible to choose with <i>--list-format</i> the output format for the
      list templates:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>short</b></dt>
  <dd class="It-tag">The default format, prints only the template identifier
      and, next to it, its short description.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>long</b></dt>
  <dd class="It-tag">Prints a textual list with the details of the available
      sources, followed by the details of the available templates.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>json</b></dt>
  <dd class="It-tag">Prints a JSON object with the details of the available
      sources and the details of the available templates.
    <div style="height: 1.00em;">&#x00A0;</div>
    The &quot;version&quot; key in the main object represents the
      &quot;compatibility version&quot;, and it is bumped every time the
      resulting JSON output is incompatible with the previous versions (for
      example the structure has changed, or non-optional keys are no more
      present).</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<i>--long</i> is a shorthand for the &quot;long&quot; format.
<div style="height: 1.00em;">&#x00A0;</div>
See also: <i>--source</i>, <i>--notes</i>, &quot;SOURCES OF
  TEMPLATES&quot;.</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--machine-readable</b></dt>
  <dd class="It-tag">This option is used to make the output more machine
      friendly when being parsed by other programs. See &quot;MACHINE READABLE
      OUTPUT&quot; below.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-m</b> MB</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--memsize</b> MB</dt>
  <dd class="It-tag">Change the amount of memory allocated to <i>--run</i>
      scripts. Increase this if you find that <i>--run</i> scripts or the
      <i>--install</i> option are running out of memory.
    <div style="height: 1.00em;">&#x00A0;</div>
    The default can be found with this command:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 guestfish get-memsize
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--network</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--no-network</b></dt>
  <dd class="It-tag">Enable or disable network access from the guest during the
      installation.
    <div style="height: 1.00em;">&#x00A0;</div>
    Enabled is the default. Use <i>--no-network</i> to disable access.
    <div style="height: 1.00em;">&#x00A0;</div>
    The network only allows outgoing connections and has other minor
      limitations. See &quot;NETWORK&quot; in <i>virt-rescue</i>(1).
    <div style="height: 1.00em;">&#x00A0;</div>
    If you use <i>--no-network</i> then certain other options such as
      <i>--install</i> will not work.
    <div style="height: 1.00em;">&#x00A0;</div>
    This does not affect whether the guest can access the network once it has
      been booted, because that is controlled by your hypervisor or cloud
      environment and has nothing to do with virt-builder.
    <div style="height: 1.00em;">&#x00A0;</div>
    Generally speaking you should <i>not</i> use <i>--no-network</i>. But here
      are some reasons why you might want to:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">1.</dt>
  <dd class="It-tag">Because the libguestfs backend that you are using doesn't
      support the network. (See: &quot;BACKEND&quot; in <i>guestfs</i>(3)).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">2.</dt>
  <dd class="It-tag">Any software you need to install comes from an attached
      ISO, so you don't need the network.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">3.</dt>
  <dd class="It-tag">You don't want untrusted guest code trying to access your
      host network when running virt-builder. This is particularly an issue when
      you don't trust the source of the operating system templates. (See
      &quot;SECURITY&quot; below).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">4.</dt>
  <dd class="It-tag">You don't have a host network (eg. in secure/restricted
      environments).</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;"></div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--no-sync</b></dt>
  <dd class="It-tag">Do not sync the output file on exit.
    <div style="height: 1.00em;">&#x00A0;</div>
    Virt-builder fsync's the output file or disk image when it exits.
    <div style="height: 1.00em;">&#x00A0;</div>
    The reason is that qemu/KVM's default caching mode is &quot;none&quot; or
      &quot;directsync&quot;, both of which bypass the host page cache.
      Therefore these would not work correctly if you immediately started the
      guest after running virt-builder - they would not see the complete output
      file. (Note that you should not use these caching modes - they are
      fundamentally broken for this and other reasons.)
    <div style="height: 1.00em;">&#x00A0;</div>
    If you are not using these broken caching modes, you can use
      <i>--no-sync</i> to avoid this unnecessary sync and gain considerable
      extra performance.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--notes</b> os-version</dt>
  <dd class="It-tag">List any notes associated with this guest, then exit (this
      does not do the install).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-o</b> filename</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--output</b> filename</dt>
  <dd class="It-tag">Write the output to <i>filename</i>. If you don't specify
      this option, then the output filename is generated by taking the
      &quot;os-version&quot; string and adding &quot;.img&quot; (for raw format)
      or &quot;.qcow2&quot; (for qcow2 format).
    <div style="height: 1.00em;">&#x00A0;</div>
    Note that the output filename could be a device, partition or logical
      volume.
    <div style="height: 1.00em;">&#x00A0;</div>
    When used with <i>--get-kernel</i>, this option specifies the output
      directory.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--print-cache</b></dt>
  <dd class="It-tag">Print information about the template cache. See
      &quot;CACHING&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-q</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--quiet</b></dt>
  <dd class="It-tag">Don't print ordinary progress messages.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--size</b> SIZE</dt>
  <dd class="It-tag">Select the size of the output disk, where the size can be
      specified using common names such as &quot;32G&quot; (32 gigabytes) etc.
    <div style="height: 1.00em;">&#x00A0;</div>
    Virt-builder will resize filesystems inside the disk image automatically.
    <div style="height: 1.00em;">&#x00A0;</div>
    If the size is not specified, then one of two things happens. If the output
      is a file, then the size is the same as the template. If the output is a
      device, partition, etc then the size of that device is used.
    <div style="height: 1.00em;">&#x00A0;</div>
    To specify size in bytes, the number must be followed by the lowercase
      letter <i>b</i>, eg: &quot;--size&#x00A0;10737418240b&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--smp</b> N</dt>
  <dd class="It-tag">Enable N &#x2265; 2 virtual CPUs for <i>--run</i> scripts
      to use.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--source</b> URL</dt>
  <dd class="It-tag">Set the source URL to look for indexes.
    <div style="height: 1.00em;">&#x00A0;</div>
    You can give this option multiple times to specify multiple sources.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also &quot;SOURCES OF TEMPLATES&quot; below.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note that you should not point <i>--source</i> to sources that you don't
      trust (unless the source is signed by someone you do trust). See also the
      <i>--no-network</i> option.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--no-warn-if-partition</b></dt>
  <dd class="It-tag">Do not emit a warning if the output device is a partition.
      This warning avoids a common user error when writing to a USB key or
      external drive, when you should normally write to the whole device (
      <i>--output&#x00A0;/dev/sdX</i>), not to a partition on the device (
      <i>--output&#x00A0;/dev/sdX1</i>). Use this option to <i>suppress</i> this
      warning.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-v</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--verbose</b></dt>
  <dd class="It-tag">Enable debug messages and/or produce verbose output.
    <div style="height: 1.00em;">&#x00A0;</div>
    When reporting bugs, use this option and attach the complete output to your
      bug report.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-V</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--version</b></dt>
  <dd class="It-tag">Display version number and exit.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-x</b></dt>
  <dd class="It-tag">Enable tracing of libguestfs API calls.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Customization_options"><a class="selflink" href="#Customization_options">Customization
  options</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--chmod</b> PERMISSIONS:FILE</dt>
  <dd class="It-tag">Change the permissions of &quot;FILE&quot; to
      &quot;PERMISSIONS&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
     <i>Note</i>: &quot;PERMISSIONS&quot; by default would be decimal, unless
      you prefix it with 0 to get octal, ie. use 0700 not 700.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--commands-from-file</b> FILENAME</dt>
  <dd class="It-tag">Read the customize commands from a file, one (and its
      arguments) each line.
    <div style="height: 1.00em;">&#x00A0;</div>
    Each line contains a single customization command and its arguments, for
      example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 delete /some/file
 install some-package
 password some-user:password:its-new-password
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Empty lines are ignored, and lines starting with &quot;#&quot; are comments
      and are ignored as well. Furthermore, arguments can be spread across
      multiple lines, by adding a &quot;\&quot; (continuation character) at the
      of a line, for example
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 edit /some/file:\
   s/^OPT=.*/OPT=ok/
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    The commands are handled in the same order as they are in the file, as if
      they were specified as <i>--delete /some/file</i> on the command
    line.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--copy</b> SOURCE:DEST</dt>
  <dd class="It-tag">Copy files or directories recursively inside the guest.
    <div style="height: 1.00em;">&#x00A0;</div>
    Wildcards cannot be used.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--copy-in</b> LOCALPATH:REMOTEDIR</dt>
  <dd class="It-tag">Copy local files or directories recursively into the disk
      image, placing them in the directory &quot;REMOTEDIR&quot; (which must
      exist).
    <div style="height: 1.00em;">&#x00A0;</div>
    Wildcards cannot be used.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--delete</b> PATH</dt>
  <dd class="It-tag">Delete a file from the guest. Or delete a directory (and
      all its contents, recursively).
    <div style="height: 1.00em;">&#x00A0;</div>
    You can use shell glob characters in the specified path. Be careful to
      escape glob characters from the host shell, if that is required. For
      example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 virt-customize --delete '/var/log/*.log'.
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    See also: <i>--upload</i>, <i>--scrub</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--edit</b> FILE:EXPR</dt>
  <dd class="It-tag">Edit &quot;FILE&quot; using the Perl expression
      &quot;EXPR&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    Be careful to properly quote the expression to prevent it from being altered
      by the shell.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note that this option is only available when Perl 5 is installed.
    <div style="height: 1.00em;">&#x00A0;</div>
    See &quot;NON-INTERACTIVE EDITING&quot; in <i>virt-edit</i>(1).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--firstboot</b> SCRIPT</dt>
  <dd class="It-tag">Install &quot;SCRIPT&quot; inside the guest, so that when
      the guest first boots up, the script runs (as root, late in the boot
      process).
    <div style="height: 1.00em;">&#x00A0;</div>
    The script is automatically chmod +x after installation in the guest.
    <div style="height: 1.00em;">&#x00A0;</div>
    The alternative version <i>--firstboot-command</i> is the same, but it
      conveniently wraps the command up in a single line script for you.
    <div style="height: 1.00em;">&#x00A0;</div>
    You can have multiple <i>--firstboot</i> options. They run in the same order
      that they appear on the command line.
    <div style="height: 1.00em;">&#x00A0;</div>
    Please take a look at &quot;FIRST BOOT SCRIPTS&quot; for more information
      and caveats about the first boot scripts.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also <i>--run</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--firstboot-command</b> 'CMD+ARGS'</dt>
  <dd class="It-tag">Run command (and arguments) inside the guest when the guest
      first boots up (as root, late in the boot process).
    <div style="height: 1.00em;">&#x00A0;</div>
    You can have multiple <i>--firstboot</i> options. They run in the same order
      that they appear on the command line.
    <div style="height: 1.00em;">&#x00A0;</div>
    Please take a look at &quot;FIRST BOOT SCRIPTS&quot; for more information
      and caveats about the first boot scripts.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also <i>--run</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--firstboot-install</b> PKG,PKG..</dt>
  <dd class="It-tag">Install the named packages (a comma-separated list). These
      are installed when the guest first boots using the guest's package manager
      (eg. apt, yum, etc.) and the guest's network connection.
    <div style="height: 1.00em;">&#x00A0;</div>
    For an overview on the different ways to install packages, see
      &quot;INSTALLING PACKAGES&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--hostname</b> HOSTNAME</dt>
  <dd class="It-tag">Set the hostname of the guest to &quot;HOSTNAME&quot;. You
      can use a dotted hostname.domainname (FQDN) if you want.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--install</b> PKG,PKG..</dt>
  <dd class="It-tag">Install the named packages (a comma-separated list). These
      are installed during the image build using the guest's package manager
      (eg. apt, yum, etc.) and the host's network connection.
    <div style="height: 1.00em;">&#x00A0;</div>
    For an overview on the different ways to install packages, see
      &quot;INSTALLING PACKAGES&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also <i>--update</i>, <i>--uninstall</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--link</b> TARGET:LINK[:LINK..]</dt>
  <dd class="It-tag">Create symbolic link(s) in the guest, starting at
      &quot;LINK&quot; and pointing at &quot;TARGET&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--mkdir</b> DIR</dt>
  <dd class="It-tag">Create a directory in the guest.
    <div style="height: 1.00em;">&#x00A0;</div>
    This uses &quot;mkdir&#x00A0;-p&quot; so any intermediate directories are
      created, and it also works if the directory already exists.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--move</b> SOURCE:DEST</dt>
  <dd class="It-tag">Move files or directories inside the guest.
    <div style="height: 1.00em;">&#x00A0;</div>
    Wildcards cannot be used.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--no-logfile</b></dt>
  <dd class="It-tag">Scrub &quot;builder.log&quot; (log file from build
      commands) from the image after building is complete. If you don't want to
      reveal precisely how the image was built, use this option.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also: &quot;LOG FILE&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--password</b> USER:SELECTOR</dt>
  <dd class="It-tag">Set the password for &quot;USER&quot;. (Note this option
      does <i>not</i> create the user account).
    <div style="height: 1.00em;">&#x00A0;</div>
    See &quot;USERS AND PASSWORDS&quot; for the format of the
      &quot;SELECTOR&quot; field, and also how to set up user accounts.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--password-crypto</b> md5|sha256|sha512</dt>
  <dd class="It-tag">When the virt tools change or set a password in the guest,
      this option sets the password encryption of that password to
      &quot;md5&quot;, &quot;sha256&quot; or &quot;sha512&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    &quot;sha256&quot; and &quot;sha512&quot; require glibc &#x2265; 2.7 (check
      <i>crypt</i>(3) inside the guest).
    <div style="height: 1.00em;">&#x00A0;</div>
    &quot;md5&quot; will work with relatively old Linux guests (eg. RHEL 3), but
      is not secure against modern attacks.
    <div style="height: 1.00em;">&#x00A0;</div>
    The default is &quot;sha512&quot; unless libguestfs detects an old guest
      that didn't have support for SHA-512, in which case it will use
      &quot;md5&quot;. You can override libguestfs by specifying this option.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note this does not change the default password encryption used by the guest
      when you create new user accounts inside the guest. If you want to do
      that, then you should use the <i>--edit</i> option to modify
      &quot;/etc/sysconfig/authconfig&quot; (Fedora, RHEL) or
      &quot;/etc/pam.d/common-password&quot; (Debian, Ubuntu).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--root-password</b> SELECTOR</dt>
  <dd class="It-tag">Set the root password.
    <div style="height: 1.00em;">&#x00A0;</div>
    See &quot;USERS AND PASSWORDS&quot; for the format of the
      &quot;SELECTOR&quot; field, and also how to set up user accounts.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note: In virt-builder, if you <i>don't</i> set <i>--root-password</i> then
      the guest is given a <i>random</i> root password.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--run</b> SCRIPT</dt>
  <dd class="It-tag">Run the shell script (or any program) called
      &quot;SCRIPT&quot; on the disk image. The script runs virtualized inside a
      small appliance, chrooted into the guest filesystem.
    <div style="height: 1.00em;">&#x00A0;</div>
    The script is automatically chmod +x.
    <div style="height: 1.00em;">&#x00A0;</div>
    If libguestfs supports it then a limited network connection is available but
      it only allows outgoing network connections. You can also attach data
      disks (eg. ISO files) as another way to provide data (eg. software
      packages) to the script without needing a network connection (
      <i>--attach</i>). You can also upload data files ( <i>--upload</i>).
    <div style="height: 1.00em;">&#x00A0;</div>
    You can have multiple <i>--run</i> options. They run in the same order that
      they appear on the command line.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also: <i>--firstboot</i>, <i>--attach</i>, <i>--upload</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--run-command</b> 'CMD+ARGS'</dt>
  <dd class="It-tag">Run the command and arguments on the disk image. The
      command runs virtualized inside a small appliance, chrooted into the guest
      filesystem.
    <div style="height: 1.00em;">&#x00A0;</div>
    If libguestfs supports it then a limited network connection is available but
      it only allows outgoing network connections. You can also attach data
      disks (eg. ISO files) as another way to provide data (eg. software
      packages) to the script without needing a network connection (
      <i>--attach</i>). You can also upload data files ( <i>--upload</i>).
    <div style="height: 1.00em;">&#x00A0;</div>
    You can have multiple <i>--run-command</i> options. They run in the same
      order that they appear on the command line.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also: <i>--firstboot</i>, <i>--attach</i>, <i>--upload</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--scrub</b> FILE</dt>
  <dd class="It-tag">Scrub a file from the guest. This is like <i>--delete</i>
      except that:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">It scrubs the data so a guest could not recover it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">It cannot delete directories, only regular files.</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;"></div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--selinux-relabel</b></dt>
  <dd class="It-tag">Relabel files in the guest so that they have the correct
      SELinux label.
    <div style="height: 1.00em;">&#x00A0;</div>
    This will attempt to relabel files immediately, but if the operation fails
      this will instead touch <i>/.autorelabel</i> on the image to schedule a
      relabel operation for the next time the image boots.
    <div style="height: 1.00em;">&#x00A0;</div>
    You should only use this option for guests which support SELinux.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sm-attach</b> SELECTOR</dt>
  <dd class="It-tag">Attach to a pool using &quot;subscription-manager&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    See &quot;SUBSCRIPTION-MANAGER&quot; for the format of the
      &quot;SELECTOR&quot; field.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sm-credentials</b> SELECTOR</dt>
  <dd class="It-tag">Set the credentials for &quot;subscription-manager&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    See &quot;SUBSCRIPTION-MANAGER&quot; for the format of the
      &quot;SELECTOR&quot; field.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sm-register</b></dt>
  <dd class="It-tag">Register the guest using &quot;subscription-manager&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    This requires credentials being set using <i>--sm-credentials</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sm-remove</b></dt>
  <dd class="It-tag">Remove all the subscriptions from the guest using
      &quot;subscription-manager&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sm-unregister</b></dt>
  <dd class="It-tag">Unregister the guest using
      &quot;subscription-manager&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ssh-inject</b> USER[:SELECTOR]</dt>
  <dd class="It-tag">Inject an ssh key so the given &quot;USER&quot; will be
      able to log in over ssh without supplying a password. The &quot;USER&quot;
      must exist already in the guest.
    <div style="height: 1.00em;">&#x00A0;</div>
    See &quot;SSH KEYS&quot; for the format of the &quot;SELECTOR&quot; field.
    <div style="height: 1.00em;">&#x00A0;</div>
    You can have multiple <i>--ssh-inject</i> options, for different users and
      also for more keys for each user.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--timezone</b> TIMEZONE</dt>
  <dd class="It-tag">Set the default timezone of the guest to
      &quot;TIMEZONE&quot;. Use a location string like
    &quot;Europe/London&quot;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--touch</b> FILE</dt>
  <dd class="It-tag">This command performs a <i>touch</i>(1)-like operation on
      &quot;FILE&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--truncate</b> FILE</dt>
  <dd class="It-tag">This command truncates &quot;FILE&quot; to a zero-length
      file. The file must exist already.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--truncate-recursive</b> PATH</dt>
  <dd class="It-tag">This command recursively truncates all files under
      &quot;PATH&quot; to zero-length.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--uninstall</b> PKG,PKG..</dt>
  <dd class="It-tag">Uninstall the named packages (a comma-separated list).
      These are removed during the image build using the guest's package manager
      (eg. apt, yum, etc.). Dependent packages may also need to be uninstalled
      to satisfy the request.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also <i>--install</i>, <i>--update</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--update</b></dt>
  <dd class="It-tag">Do the equivalent of &quot;yum update&quot;, &quot;apt-get
      upgrade&quot;, or whatever command is required to update the packages
      already installed in the template to their latest versions.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also <i>--install</i>, <i>--uninstall</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--upload</b> FILE:DEST</dt>
  <dd class="It-tag">Upload local file &quot;FILE&quot; to destination
      &quot;DEST&quot; in the disk image. File owner and permissions from the
      original are preserved, so you should set them to what you want them to be
      in the disk image.
    <div style="height: 1.00em;">&#x00A0;</div>
    &quot;DEST&quot; could be the final filename. This can be used to rename the
      file on upload.
    <div style="height: 1.00em;">&#x00A0;</div>
    If &quot;DEST&quot; is a directory name (which must already exist in the
      guest) then the file is uploaded into that directory, and it keeps the
      same name as on the local filesystem.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also: <i>--mkdir</i>, <i>--delete</i>, <i>--scrub</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--write</b> FILE:CONTENT</dt>
  <dd class="It-tag">Write &quot;CONTENT&quot; to &quot;FILE&quot;.</dd>
</dl>
<h1 class="Sh" title="Sh" id="REFERENCE"><a class="selflink" href="#REFERENCE">REFERENCE</a></h1>
<h2 class="Ss" title="Ss" id="INSTALLING_PACKAGES"><a class="selflink" href="#INSTALLING_PACKAGES">INSTALLING
  PACKAGES</a></h2>
There are several approaches to installing packages or applications in the guest
  which have different trade-offs.
<div class="Pp"></div>
<i>Installing packages at build time</i>
<div class="Pp"></div>
If the guest OS you are installing is similar to the host OS (eg. both are
  Linux), and if libguestfs supports network connections, then you can use
  <i>--install</i> to install packages like this:
<div class="Pp"></div>
<pre>
 virt-builder fedora-20 --install inkscape
</pre>
<div class="Pp"></div>
This uses the guest's package manager and the host's network connection.
<div class="Pp"></div>
<i>Updating packages at build time</i>
<div class="Pp"></div>
To update the core set of packages in the template at build time:
<div class="Pp"></div>
<pre>
 virt-builder fedora-20 --update
</pre>
<div class="Pp"></div>
Most of the templates that ship with virt-builder come with a very minimal
  selection of packages (known as a &quot;JEOS&quot; or &quot;Just Enough
  Operating System&quot;), which are up to date at the time the template is
  created, but could be out of date by the time you come to install an OS from
  the template. This option updates those template packages.
<div class="Pp"></div>
<i>Installing packages at first boot</i>
<div class="Pp"></div>
Another option is to install the packages when the guest first boots:
<div class="Pp"></div>
<pre>
 virt-builder fedora-20 --firstboot-install inkscape
</pre>
<div class="Pp"></div>
This uses the guest's package manager and the guest's network connection.
<div class="Pp"></div>
The downsides are that it will take the guest a lot longer to boot first time,
  and there's nothing much you can do if package installation fails (eg. if a
  network problem means the guest can't reach the package repositories).
<div class="Pp"></div>
<i>Installing packages at build time from a side repository</i>
<div class="Pp"></div>
If the software you want to install is not available in the main package
  repository of the guest, then you can add a side repository. Usually this is
  presented as an ISO (CD disk image) file containing extra packages.
<div class="Pp"></div>
You can create the disk image using either <i>genisoimage</i>(1) or
  <i>virt-make-fs</i>(1). For genisoimage, use a command like this:
<div class="Pp"></div>
<pre>
 genisoimage -o extra-packages.iso -R -J -V EXTRA cdcontents/
</pre>
<div class="Pp"></div>
Create a script that mounts the ISO and sets up the repository. For yum, create
  /tmp/install.sh containing:
<div class="Pp"></div>
<pre>
 mkdir /tmp/mount
 mount LABEL=EXTRA /tmp/mount
 
 cat &lt;&lt;'EOF' &gt; /etc/yum.repos.d/extra.repo
 [extra]
 name=extra
 baseurl=file:///tmp/mount
 enabled=1
 EOF
 
 yum -y install famousdatabase
</pre>
<div class="Pp"></div>
For apt, create /tmp/install.sh containing:
<div class="Pp"></div>
<pre>
 mkdir /tmp/mount
 mount LABEL=EXTRA /tmp/mount
 
 apt-cdrom -d=/tmp/mount add
 apt-get -y install famousdatabase
</pre>
<div class="Pp"></div>
Use the <i>--attach</i> option to attach the CD / disk image and the
  <i>--run</i> option to run the script:
<div class="Pp"></div>
<pre>
 virt-builder fedora-20 \
   --attach extra-packages.iso \
   --run /tmp/install.sh
</pre>
<h2 class="Ss" title="Ss" id="USERS_AND_PASSWORDS"><a class="selflink" href="#USERS_AND_PASSWORDS">USERS
  AND PASSWORDS</a></h2>
The <i>--root-password</i> option is used to change the root password (otherwise
  a random password is used). This option takes a password &quot;SELECTOR&quot;
  in one of the following formats:
<dl class="Bl-tag">
  <dt class="It-tag"><b>--root-password</b> file:FILENAME</dt>
  <dd class="It-tag">Read the root password from &quot;FILENAME&quot;. The whole
      first line of this file is the replacement password. Any other lines are
      ignored. You should create the file with mode 0600 to ensure no one else
      can read it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--root-password</b> password:PASSWORD</dt>
  <dd class="It-tag">Set the root password to the literal string
      &quot;PASSWORD&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
     <b>Note: this is not secure</b> since any user on the same machine can see
      the cleartext password using <i>ps</i>(1).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--root-password</b> random</dt>
  <dd class="It-tag">Choose a random password, which is printed on stdout. The
      password has approximately 120 bits of randomness.
    <div style="height: 1.00em;">&#x00A0;</div>
    This is the default.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--root-password</b> disabled</dt>
  <dd class="It-tag">The root account password is disabled. This is like putting
      &quot;*&quot; in the password field.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--root-password</b> locked:file:FILENAME</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--root-password</b> locked:password:PASSWORD</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--root-password</b> locked:random</dt>
  <dd class="It-tag">The root account is locked, but a password is placed on the
      account. If first unlocked (using &quot;passwd -u&quot;) then logins will
      use the given password.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--root-password</b> locked</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--root-password</b> locked:disabled</dt>
  <dd class="It-tag">The root account is locked <i>and</i> password is
    disabled.</dd>
</dl>
<div class="Pp"></div>
<i>Creating user accounts</i>
<div class="Pp"></div>
To create user accounts, use the <i>useradd</i>(8) command with
  --firstboot-command like this:
<div class="Pp"></div>
<pre>
 virt-builder --firstboot-command \
    'useradd -m -p &quot;&quot; rjones ; chage -d 0 rjones'
</pre>
<div class="Pp"></div>
The above command will create an &quot;rjones&quot; account with no password,
  and force the user to set a password when they first log in. There are other
  ways to manage passwords, see <i>useradd</i>(8) for details.
<h2 class="Ss" title="Ss" id="KEYBOARD_LAYOUT"><a class="selflink" href="#KEYBOARD_LAYOUT">KEYBOARD
  LAYOUT</a></h2>
Because there are so many different ways to set the keyboard layout in Linux
  distributions, virt-builder does not yet attempt to have a simple command line
  option. This section describes how to set the keyboard for some common Linux
  distributions.
<div class="Pp"></div>
<i>Keyboard layout with systemd</i>
<div class="Pp"></div>
For distros that use systemd &quot;localectl&quot;, use a command like this:
<div class="Pp"></div>
<pre>
 virt-builder fedora-20 \
   --firstboot-command 'localectl set-keymap uk'
</pre>
<div class="Pp"></div>
See <i>localectl</i>(1) and
  https://www.happyassassin.net/2013/11/23/keyboard-layouts-in-fedora-20-and-previously/
  for more details.
<div class="Pp"></div>
<i>Keyboard layout using </i><i>/etc/sysconfig/keyboard</i><i></i>
<div class="Pp"></div>
For RHEL &#x2264; 6, Fedora &#x2264; 18 and similar, upload or modify the
  keyboard configuration file using the <i>--upload</i>, <i>--write</i> or
  <i>--edit</i> options. For example:
<div class="Pp"></div>
<pre>
 virt-builder centos-6 \
   --edit '/etc/sysconfig/keyboard: s/^KEYTABLE=.*/KEYTABLE=&quot;uk&quot;/'
</pre>
<div class="Pp"></div>
The format of this file can be found documented in many places online.
<div class="Pp"></div>
<i>Keyboard layout with Debian-derived distros</i>
<div class="Pp"></div>
For Debian-derived distros using <i>/etc/default/keyboard</i>, upload or modify
  the keyboard file using the <i>--upload</i>, <i>--write</i> or <i>--edit</i>
  options. For example:
<div class="Pp"></div>
<pre>
 virt-builder debian-7 \
   --edit '/etc/default/keyboard: s/^XKBLAYOUT=.*/XKBLAYOUT=&quot;gb&quot;/'
</pre>
<div class="Pp"></div>
See https://wiki.debian.org/Keyboard.
<h2 class="Ss" title="Ss" id="LANGUAGE"><a class="selflink" href="#LANGUAGE">LANGUAGE</a></h2>
Most Linux distributions support multiple locale settings so that you can have
  guest messages printed in another language such as Russian.
<div class="Pp"></div>
However there is no single setting which controls this, since extra packages may
  need to be installed to support console and X fonts, and keyboard input
  methods. The packages required, and their configuration is highly
  distro-specific, and it is outside the scope of virt-builder to do this.
<div class="Pp"></div>
This section contains examples for some common Linux distributions.
<div class="Pp"></div>
<i>Setting Japanese in Fedora 20</i>
<div class="Pp"></div>
<pre>
 virt-builder fedora-20 \
   --size 20G \
   --update \
   --install @japanese-support \
   --install @xfce \
   --install xorg-x11-server-Xorg,xorg-x11-drivers,rsyslog \
   --link /usr/lib/systemd/system/graphical.target:/etc/systemd/system/default.target \
   --firstboot-command 'localectl set-locale LANG=ja_JP.utf8' \
   --firstboot-command 'localectl set-keymap jp' \
   --firstboot-command 'systemctl isolate graphical.target'
</pre>
<div class="Pp"></div>
<i>Setting Japanese in Debian 7 (Wheezy)</i>
<div class="Pp"></div>
Note that although this enables Japanese in the text console too, it is unlikely
  that you will see properly rendered Japanese there. However Japanese is
  properly rendered in X applications and terminals.
<div class="Pp"></div>
<pre>
 pkgs=locales,xfce4,\
 ibus,ibus-anthy,\
 ttf-sazanami-gothic,ttf-sazanami-mincho,\
 fonts-takao-mincho,\
 xfonts-intl-japanese,xfonts-intl-japanese-big,\
 iceweasel-l10n-ja,manpages-ja
 
 virt-builder debian-7 \
   --size 20G \
   --install $pkgs \
   --edit '/etc/inittab: s,^#([1-9].*respawn.*/sbin/getty.*),$1,' \
   --edit '/etc/locale.gen: s,^#\s*ja,ja,' \
   --write '/etc/default/locale:LANG=&quot;ja_JP.UTF-8&quot;' \
   --run-command &quot;locale-gen&quot;
</pre>
<h2 class="Ss" title="Ss" id="LOG_FILE"><a class="selflink" href="#LOG_FILE">LOG
  FILE</a></h2>
Scripts and package installation that runs at build time ( <i>--run</i>,
  <i>--run-command</i>, <i>--install</i>, <i>--update</i>, but <i>not</i>
  firstboot) is logged in one of the following locations:
<dl class="Bl-tag">
  <dt class="It-tag"><i>/tmp/builder.log</i></dt>
  <dd class="It-tag">On Linux, BSD and other guests.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>C:\Temp\builder.log</i></dt>
  <dd class="It-tag">On Windows, DOS guests.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>/builder.log</i></dt>
  <dd class="It-tag">If <i>/tmp</i> or <i>C:\Temp</i> is missing.</dd>
</dl>
<div class="Pp"></div>
If you don't want the log file to appear in the final image, then use the
  <i>--no-logfile</i> command line option.
<h2 class="Ss" title="Ss" id="SSH_KEYS"><a class="selflink" href="#SSH_KEYS">SSH
  KEYS</a></h2>
The <i>--ssh-inject</i> option is used to inject ssh keys for users in the
  guest, so they can login without supplying a password.
<div class="Pp"></div>
The &quot;SELECTOR&quot; part of the option value is optional; in this case,
  <i>--ssh-inject</i> &quot;USER&quot; means that we look in the <i>current</i>
  user's <i>~/.ssh</i> directory to find the default public ID file. That key is
  uploaded. &quot;default public ID&quot; is the <i>default_ID_file</i> file
  described in <i>ssh-copy-id</i>(1).
<div class="Pp"></div>
If specified, the &quot;SELECTOR&quot; can be in one of the following formats:
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ssh-inject</b> USER:file:FILENAME</dt>
  <dd class="It-tag">Read the ssh key from <i>FILENAME</i>. <i>FILENAME</i> is
      usually a <i>.pub</i> file.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ssh-inject</b> USER:string:KEY_STRING</dt>
  <dd class="It-tag">Use the specified &quot;KEY_STRING&quot;.
      &quot;KEY_STRING&quot; is usually a public string like <i>ssh-rsa AAAA....
      user@localhost</i>.</dd>
</dl>
<div class="Pp"></div>
In any case, the <i>~USER/.ssh</i> directory and the
  <i>~USER/.ssh/authorized_keys</i> file will be created if not existing
  already.
<h2 class="Ss" title="Ss" id="FIRST_BOOT_SCRIPTS"><a class="selflink" href="#FIRST_BOOT_SCRIPTS">FIRST
  BOOT SCRIPTS</a></h2>
The <i>--firstboot</i> and <i>--firstboot-command</i> options allow you to
  execute commands at the first boot of the guest. To do so, an init script for
  the guest init system is installed, which takes care of running all the added
  scripts and commands.
<div class="Pp"></div>
Supported operating systems are:
<dl class="Bl-tag">
  <dt class="It-tag">Linux</dt>
  <dd class="It-tag">Init systems supported are: systemd, System-V init (known
      also as sysvinit), and Upstart (using the System-V scripts).
    <div style="height: 1.00em;">&#x00A0;</div>
    Note that usually init scripts run as root, but with a more limited
      environment than what could be available from a normal shell: for example,
      $HOME may be unset or empty.
    <div style="height: 1.00em;">&#x00A0;</div>
    The output of the first boot scripts is available in the guest as
      <i>~root/virt-sysprep-firstboot.log</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Windows</dt>
  <dd class="It-tag"><i>rhsrvany.exe</i>, available from sources at
      https://github.com/rwmjones/rhsrvany, is installed to run the first boot
      scripts. It is required, and the setup of first boot scripts will fail if
      it is not present.
    <div style="height: 1.00em;">&#x00A0;</div>
     <i>rhsrvany.exe</i> is copied from the location pointed to by the
      &quot;VIRT_TOOLS_DATA_DIR&quot; environment variable; if not set, a
      compiled-in default will be used (something like
      <i>/usr/share/virt-tools</i>).
    <div style="height: 1.00em;">&#x00A0;</div>
    The output of the first boot scripts is available in the guest as
      <i>C:\Program Files\Red Hat\Firstboot\log.txt</i>.</dd>
</dl>
<h2 class="Ss" title="Ss" id="SUBSCRIPTION-MANAGER"><a class="selflink" href="#SUBSCRIPTION-MANAGER">SUBSCRIPTION-MANAGER</a></h2>
It is possible to automate the registration and attaching of the system using
  &quot;subscription-manager&quot;. This is typical on Red Hat Enterprise Linux
  guests. There are few options which ease this process, avoid executing
  commands manually and exposing passwords on command line.
<div class="Pp"></div>
<i>--sm-register</i> starts the registration process, and requires
  <i>--sm-credentials</i> to be specified; the format of the
  &quot;SELECTOR&quot; of <i>--sm-credentials</i> is one of the following
  formats:
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sm-credentials</b> USER:file:FILENAME</dt>
  <dd class="It-tag">Read the password for the specified &quot;USER&quot; from
      <i>FILENAME</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sm-credentials</b> USER:password:PASSWORD</dt>
  <dd class="It-tag">Use the literal string &quot;PASSWORD&quot; for the
      specified &quot;USER&quot;.</dd>
</dl>
<div class="Pp"></div>
<i>--sm-attach</i> attaches the system to subscriptions; the format of its
  &quot;SELECTOR&quot; is one of the following:
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sm-attach</b> auto</dt>
  <dd class="It-tag">&quot;subscription-manager&quot; attaches to the
      best-fitting subscriptions for the system.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sm-attach</b> file:FILENAME</dt>
  <dd class="It-tag">Read the pool ID from <i>FILENAME</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sm-attach</b> pool:POOL</dt>
  <dd class="It-tag">Use the literal string &quot;POOL&quot; as pool ID.</dd>
</dl>
<div class="Pp"></div>
<i>--sm-remove</i> removes all the subscriptions from the guest, while
  <i>--sm-unregister</i> completely unregister the system.
<h2 class="Ss" title="Ss" id="INSTALLATION_PROCESS"><a class="selflink" href="#INSTALLATION_PROCESS">INSTALLATION
  PROCESS</a></h2>
When you invoke virt-builder, installation proceeds as follows:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The template image is downloaded.
    <div style="height: 1.00em;">&#x00A0;</div>
    If the template image is present in the cache, the cached version is used
      instead. (See &quot;CACHING&quot;).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The template signature is checked.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The template is uncompressed to a tmp file.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The template image is resized into the destination, using
      <i>virt-resize</i>(1).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Extra disks are attached (<i>--attach</i>).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">A new random seed is generated for the guest.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Guest customization is performed, in the order specified on
      the command line.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">SELinux relabelling is done
    (<i>--selinux-relabel</i>).</dd>
</dl>
<h2 class="Ss" title="Ss" id="IMPORTING_THE_DISK_IMAGE"><a class="selflink" href="#IMPORTING_THE_DISK_IMAGE">IMPORTING
  THE DISK IMAGE</a></h2>
<i>Importing into libvirt</i>
<div class="Pp"></div>
Import the disk image into libvirt using <i>virt-install</i>(1) <i>--import</i>
  option.
<div class="Pp"></div>
<pre>
 virt-install --import \
   --name guest --ram 2048 \
   --disk path=disk.img,format=raw --os-variant fedora20
</pre>
<div class="Pp"></div>
Notes:
<dl class="Bl-tag">
  <dt class="It-tag">1.</dt>
  <dd class="It-tag">You <i>must</i> specify the correct format. The format is
      &quot;raw&quot; unless you used virt-builder's <i>--format</i>
    option.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">2.</dt>
  <dd class="It-tag"><i>--os-variant</i> is highly recommended, because it will
      present optimum devices to enable the guest to run most efficiently. To
      get a list of all variants, do:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 osinfo-query os
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    The above tool is provided by libosinfo package.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">3.</dt>
  <dd class="It-tag">You can run virt-install as root or non-root. Each works
      slightly differently because libvirt manages a different set of virtual
      machines for each user. In particular virt-manager normally shows the
      root-owned VMs, whereas Boxes shows the user-owned VMs, and other tools
      probably work differently as well.</dd>
</dl>
<div class="Pp"></div>
<i>Importing into OpenStack</i>
<div class="Pp"></div>
Import the image into Glance (the OpenStack image store) by doing:
<div class="Pp"></div>
<pre>
 glance image-create --name fedora-20-image --file fedora-20.img \
   --disk-format raw --container-format bare \
   --is-public True
</pre>
<div class="Pp"></div>
The <i>--file</i> parameter is the virt-builder-generated disk image. It should
  match virt-builder's <i>--output</i> option. The <i>--disk-format</i>
  parameter should match virt-builder's <i>--format</i> option (or
  &quot;raw&quot; if you didn't use that option). The <i>--container-format</i>
  should always be &quot;bare&quot; since virt-builder doesn't put images into
  containers.
<div class="Pp"></div>
You can use the &quot;glance&#x00A0;image-show&#x00A0;
  <i>fedora-20-image</i>&quot; command to display the properties of the image.
<div class="Pp"></div>
To boot up an instance of your image on a Nova compute node, do:
<div class="Pp"></div>
<pre>
 nova boot fedora-20-server --image fedora-20-image \
   --flavor m1.medium
</pre>
<div class="Pp"></div>
Use &quot;nova&#x00A0;flavor-list&quot; to list possible machine flavors. Use
  &quot;nova&#x00A0;list&quot; to list running instances.
<div class="Pp"></div>
<i>Booting directly using qemu or KVM</i>
<div class="Pp"></div>
The qemu command line is not very stable or easy to use, hence libvirt should be
  used if possible. However a command line similar to the following could be
  used to boot the virtual machine:
<div class="Pp"></div>
<pre>
 qemu-system-x86_64 \
   -machine accel=kvm:tcg \
   -cpu host \
   -m 2048 \
   -drive file=disk.img,format=raw,if=virtio
</pre>
<div class="Pp"></div>
As with libvirt, it is very important that the correct format is chosen. It will
  be &quot;raw&quot; unless the <i>--format</i> option was used.
<h2 class="Ss" title="Ss" id="CONFIGURATION_MANAGEMENT"><a class="selflink" href="#CONFIGURATION_MANAGEMENT">CONFIGURATION
  MANAGEMENT</a></h2>
<i>Puppet</i>
<div class="Pp"></div>
To enable the Puppet agent in a guest, install the package, point the
  configuration at your Puppetmaster, and ensure the agent runs at boot.
<div class="Pp"></div>
A typical virt-builder command would be:
<div class="Pp"></div>
<pre>
 virt-builder fedora-20 \
   --hostname client.example.com \
   --update \
   --install puppet \
   --edit '/etc/puppet/puppet.conf:
       s/^\[agent\]/[agent]\n  server = puppetmaster.example.com/' \
   --run-command 'systemctl enable puppet' \
   --selinux-relabel
</pre>
<div class="Pp"></div>
The precise instructions vary according to the Linux distro. For further
  information see: http://docs.puppetlabs.com/guides/installation.htm
<h2 class="Ss" title="Ss" id="DEBUGGING_BUILDS"><a class="selflink" href="#DEBUGGING_BUILDS">DEBUGGING
  BUILDS</a></h2>
If virt-builder itself fails, then enable debugging ( <i>-v</i>) and report a
  bug (see &quot;BUGS&quot; below).
<div class="Pp"></div>
If virt-builder fails because some script or package it is installing fails, try
  using <i>--no-delete-on-failure</i> to preserve the output file, and continue
  reading this section.
<div class="Pp"></div>
If virt-builder is successful but the image doesn't work, here are some things
  to try:
<dl class="Bl-tag">
  <dt class="It-tag">Use virt-rescue</dt>
  <dd class="It-tag">Run <i>virt-rescue</i>(1) on the disk image:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 virt-rescue -a disk.img
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This gives you a rescue shell. You can mount the filesystems from the disk
      image on <i>/sysroot</i> and examine them using ordinary Linux commands.
      You can also chroot into the guest to reinstall the bootloader. The
      virt-rescue man page has a lot more information and examples.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Use guestfish</dt>
  <dd class="It-tag">Run <i>guestfish</i>(1) on the disk image:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 guestfish -a disk.img -i
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Use guestfish commands like &quot;ll /directory&quot; and &quot;cat
      /file&quot; to examine directories and files.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Use guestmount</dt>
  <dd class="It-tag">Mount the disk image safely on the host using FUSE and
      <i>guestmount</i>(1):
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 mkdir /tmp/mp
 guestmount -a disk.img -i /tmp/mp
 cd /tmp/mp
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    To unmount the disk image do:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 fusermount -u /tmp/mp
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Add a serial console</dt>
  <dd class="It-tag">If the guest hangs during boot, it can be helpful to add a
      serial console to the guest, and direct kernel messages to the serial
      console. Adding the serial console will involve looking at the
      documentation for your hypervisor. To direct kernel messages to the serial
      console, add the following on the kernel command line:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 console=tty0 console=ttyS0,115200
    </pre>
  </dd>
</dl>
<h2 class="Ss" title="Ss" id="SOURCES_OF_TEMPLATES"><a class="selflink" href="#SOURCES_OF_TEMPLATES">SOURCES
  OF TEMPLATES</a></h2>
virt-builder reads the available sources from configuration files, with the
  <i>.conf</i> extension and located in the following paths:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">$XDG_CONFIG_HOME/virt-builder/repos.d/ ($XDG_CONFIG_HOME is
      <i></i><i>$HOME</i><i>/.config</i> if not set).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">$XDG_CONFIG_DIRS/virt-builder/repos.d/ (where
      $XDG_CONFIG_DIRS means any of the directories in that environment
      variable, or just <i>/etc/xdg</i> if not set)</dd>
</dl>
<div class="Pp"></div>
Each <i>.conf</i> file in those paths has a simple text format like the
  following:
<div class="Pp"></div>
<pre>
 [libguestfs.org]
 uri=http://libguestfs.org/download/builder/index.asc
 gpgkey=file:///etc/xdg/virt-builder/repos.d/libguestfs.gpg
</pre>
<div class="Pp"></div>
The part in square brackets is the repository identifier, which is used as
  unique identifier.
<div class="Pp"></div>
The following fields can appear:
<dl class="Bl-tag">
  <dt class="It-tag">&quot;uri=URI&quot;</dt>
  <dd class="It-tag">The URI of the index file which this repository refers to.
    <div style="height: 1.00em;">&#x00A0;</div>
    This field is required.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;gpgkey=URI&quot;</dt>
  <dd class="It-tag">This optional field represents the URI (although only
      <i>file://</i> URIs are accepted) of the key used to sign the index file.
      If not present, the index file referred by <i>uri=..</i> is not
    signed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;proxy=MODE&quot;</dt>
  <dd class="It-tag">This optional field specifies the proxy mode, to be used
      when downloading the index file of this repository. The possible values
      are:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>no</b>, <b>off</b></dt>
  <dd class="It-tag">No proxy is being used at all, even overriding the system
      configuration.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>system</b></dt>
  <dd class="It-tag">The proxy used is the system one.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>anything else</i></dt>
  <dd class="It-tag">Specifies the actual proxy configuration to be used,
      overriding the system configuration.</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
If not present, the assumed value is to respect the proxy settings of the system
  (i.e. as if <b>system</b> would be specified).</div>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;format=FORMAT&quot;</dt>
  <dd class="It-tag">This optional field specifies the format of the repository.
      The possible values are:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>native</b></dt>
  <dd class="It-tag">The native format of the &quot;virt-builder&quot;
      repository. See also &quot;Creating and signing the index file&quot;
      below.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>simplestreams</b></dt>
  <dd class="It-tag">The URI represents the root of a Simple Streams v1.0 tree
      of metadata.
    <div style="height: 1.00em;">&#x00A0;</div>
    For more information about Simple Streams, see also
      https://launchpad.net/simplestreams.</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
If not present, the assumed value is &quot;native&quot;.</div>
<div class="Pp"></div>
For serious virt-builder use, you may want to create your own repository of
  templates.
<div class="Pp"></div>
<i>Libguestfs.org repository</i>
<div class="Pp"></div>
Out of the box, virt-builder downloads the file
  http://libguestfs.org/download/builder/index.asc which is an index of
  available templates plus some information about each one, wrapped up in a
  digital signature. The command &quot;virt-builder --list&quot; lists out the
  information in this index file.
<div class="Pp"></div>
The templates hosted on libguestfs.org were created using shell scripts,
  kickstart files and preseed files which can be found in the libguestfs source
  tree, in &quot;builder/website&quot;.
<div class="Pp"></div>
<i>Setting up the repository</i>
<div class="Pp"></div>
You can set up your own site containing an index file and some templates, and
  then point virt-builder at the site by creating a <i>.conf</i> file pointing
  to it.
<div class="Pp"></div>
Note that if your index is signed, you will need to properly fill
  <i>gpgkey=..</i> in your <i>.conf</i> file, making sure to deploy also the GPG
  key file.
<div class="Pp"></div>
<pre>
 virt-builder --source https://example.com/builder/index.asc \
    --fingerprint 'AAAA BBBB ...' \
    --list
</pre>
<div class="Pp"></div>
You can host this on any web or FTP server, or a local or network filesystem.
<div class="Pp"></div>
<i>Setting up a GPG key</i>
<div class="Pp"></div>
If you don't have a GnuPG key, you will need to set one up. (Strictly speaking
  this is optional, but if your index and template files are not signed then
  virt-builder users will have to use the <i>--no-check-signature</i> flag every
  time they use virt-builder.)
<div class="Pp"></div>
To create a key, see the GPG manual http://www.gnupg.org/gph/en/manual.html.
<div class="Pp"></div>
Export your GPG public key:
<div class="Pp"></div>
<pre>
 gpg --export -a &quot;you@example.com&quot; &gt; pubkey
</pre>
<div class="Pp"></div>
<i>Create the templates</i>
<div class="Pp"></div>
There are many ways to create the templates. For example you could clone
  existing guests (see <i>virt-sysprep</i>(1)), or you could install a guest by
  hand ( <i>virt-install</i>(1)). To see how the templates were created for
  virt-builder, look at the scripts in &quot;builder/website&quot;
<div class="Pp"></div>
For best results when compressing the templates, use the following xz options
  (see <i>nbdkit-xz-plugin</i>(1) for further explanation):
<div class="Pp"></div>
<pre>
 xz --best --block-size=16777216 disk
</pre>
<div class="Pp"></div>
<i>Creating and signing the index file</i>
<div class="Pp"></div>
The index file has a simple text format (shown here without the digital
  signature):
<div class="Pp"></div>
<pre>
 [fedora-18]
 name=Fedora&#x00AE; 18
 osinfo=fedora18
 arch=x86_64
 file=fedora-18.xz
 checksum[sha512]=...
 format=raw
 size=6442450944
 compressed_size=148947524
 expand=/dev/sda3
 
 [fedora-19]
 name=Fedora&#x00AE; 19
 osinfo=fedora19
 arch=x86_64
 file=fedora-19.xz
 checksum[sha512]=...
 revision=3
 format=raw
 size=4294967296
 compressed_size=172190964
 expand=/dev/sda3
</pre>
<div class="Pp"></div>
The part in square brackets is the &quot;os-version&quot;, which is the same
  string that is used on the virt-builder command line to build that OS.
<div class="Pp"></div>
After preparing the &quot;index&quot; file in the correct format, clearsign it
  using the following command:
<div class="Pp"></div>
<pre>
 gpg --clearsign --armor index
</pre>
<div class="Pp"></div>
This will create the final file called <i>index.asc</i> which can be uploaded to
  the server (and is the <i>uri=..</i> URL). As noted above, signing the index
  file is optional, but recommended.
<div class="Pp"></div>
The following fields can appear:
<dl class="Bl-tag">
  <dt class="It-tag">&quot;name=NAME&quot;</dt>
  <dd class="It-tag">The user-friendly name of this template. This is displayed
      in the <i>--list</i> output but is otherwise not significant.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;osinfo=ID&quot;</dt>
  <dd class="It-tag">This optional field maps the operating system to the
      associated libosinfo ID. Virt-builder does not use it (yet).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;arch=ARCH&quot;</dt>
  <dd class="It-tag">The architecture of the operating system installed within
      the template. This field is required.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;file=PATH&quot;</dt>
  <dd class="It-tag">The path (relative to the index) of the xz-compressed
      template.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note that absolute paths or URIs are <b>not</b> permitted here. This is
      because virt-builder has a &quot;same origin&quot; policy for templates so
      they cannot come from other servers.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;sig=PATH&quot;</dt>
  <dd class="It-tag"><b>This option is deprecated</b>. Use the checksum field
      instead.
    <div style="height: 1.00em;">&#x00A0;</div>
    The path (relative to the index) of the GPG detached signature of the xz
      file.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note that absolute paths or URIs are <b>not</b> permitted here. This is
      because virt-builder has a &quot;same origin&quot; policy for templates so
      they cannot come from other servers.
    <div style="height: 1.00em;">&#x00A0;</div>
    The file can be created as follows:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 gpg --detach-sign --armor -o disk.xz.sig disk.xz
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;checksum[sha512]=7b882fe9b82eb0fef...&quot;</dt>
  <dd class="It-tag">The SHA-512 checksum of the <b>compressed</b> file is
      checked after it is downloaded. To work out the signature, do:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 sha512sum disk.xz
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Note if you use this, you don't need to sign the file, ie. don't use
      &quot;sig&quot;. This option overrides &quot;sig&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;checksum=7b882fe9b82eb0fef...&quot;</dt>
  <dd class="It-tag">&quot;checksum&quot; is an alias for
      &quot;checksum[sha512]&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you need to interoperate with virt-builder = 1.24.0 then you have to use
      &quot;checksum&quot; because that version would give a parse error with
      square brackets and numbers in the key of a field. This is fixed in
      virt-builder &#x2265; 1.24.1.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;revision=N&quot;</dt>
  <dd class="It-tag">The revision is an integer which is used to control the
      template cache. Increasing the revision number causes clients to download
      the template again even if they have a copy in the cache.
    <div style="height: 1.00em;">&#x00A0;</div>
    The revision number is optional. If omitted it defaults to 1.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;format=raw&quot;</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;format=qcow2&quot;</dt>
  <dd class="It-tag">Specify the format of the disk image (before it was
      compressed). If not given, the format is autodetected, but generally it is
      better to be explicit about the intended format.
    <div style="height: 1.00em;">&#x00A0;</div>
    Note this is the source format, which is different from the <i>--format</i>
      option (requested output format). Virt-builder does on-the-fly conversion
      from the source format to the requested output format.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;size=NNN&quot;</dt>
  <dd class="It-tag">The virtual size of the image in bytes. This is the size of
      the image when uncompressed. If using a non-raw format such as qcow2 then
      it means the virtual disk size, not the size of the qcow2 file.
    <div style="height: 1.00em;">&#x00A0;</div>
    This field is required.
    <div style="height: 1.00em;">&#x00A0;</div>
    Virt-builder also uses this as the minimum size that users can request via
      the <i>--size</i> option, or as the default size if there is no
      <i>--size</i> option.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;compressed_size=NNN&quot;</dt>
  <dd class="It-tag">The compressed size of the disk image in bytes. This is
      just used for information (when using <i>--list --long</i>).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;expand=/dev/sdaX&quot;</dt>
  <dd class="It-tag">When expanding the image to its final size, instruct
      <i>virt-resize</i>(1) to expand the named partition in the guest image to
      fill up all available space. This works like the virt-resize
      <i>--expand</i> option.
    <div style="height: 1.00em;">&#x00A0;</div>
    You should usually put the device name of the guest's root filesystem here.
    <div style="height: 1.00em;">&#x00A0;</div>
    It's a good idea to use this, but not required. If the field is omitted then
      virt-resize will create an extra partition at the end of the disk to cover
      the free space, which is much less user-friendly.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;lvexpand=/dev/VolGroup/LogVol&quot;</dt>
  <dd class="It-tag">When expanding the image to its final size, instruct
      <i>virt-resize</i>(1) to expand the named logical volume in the guest
      image to fill up all available space. This works like the virt-resize
      <i>--lv-expand</i> option.
    <div style="height: 1.00em;">&#x00A0;</div>
    If the guest uses LVM2 you should usually put the LV of the guest's root
      filesystem here. If the guest does not use LVM2 or its root filesystem is
      not on an LV, don't use this option.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;notes=NOTES&quot;</dt>
  <dd class="It-tag">Any notes that go with this image, especially notes
      describing what packages are in the image, how the image was prepared, and
      licensing information.
    <div style="height: 1.00em;">&#x00A0;</div>
    This information is shown in the <i>--notes</i> and <i>--list</i>
      <i>--long</i> modes.
    <div style="height: 1.00em;">&#x00A0;</div>
    You can use multi-line notes here by indenting each new line with at least
      one character of whitespace (even on blank lines):
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 notes=This image was prepared using
  the following kickstart script:
                                &lt;-- one space at beginning of line
  part /boot --fstype ext3
  ...
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;hidden=true&quot;</dt>
  <dd class="It-tag">Using the hidden flag prevents the template from being
      listed by the <i>--list</i> option (but it is still installable). This is
      used for test images.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;aliases=ALIAS1 ALIAS2 ...&quot;</dt>
  <dd class="It-tag">This optional field specifies a list of aliases, separated
      by spaces, for the image. For example, an alias could be used to always
      point to the latest version of a certain image, leaving the old versions
      available in the index instead of updating the same image (see the
      &quot;revision&quot; field).</dd>
</dl>
<div class="Pp"></div>
<i>Running virt-builder against multiple sources</i>
<div class="Pp"></div>
It is possible to use multiple sources with virt-builder. The recommended way is
  to deploy <i>.conf</i> files pointing to the index files. Another way is to
  specify the sources using multiple <i>--source</i> and/or <i>--fingerprint</i>
  options:
<div class="Pp"></div>
<pre>
 virt-builder \
   --source http://example.com/s1/index.asc \
   --source http://example.com/s2/index.asc
</pre>
<div class="Pp"></div>
You can provide N or 1 fingerprints. In the case where you provide N
  fingerprints, N = number of sources and there is a 1-1 correspondence between
  each source and each fingerprint:
<div class="Pp"></div>
<pre>
 virt-builder \
   --source http://example.com/s1/index.asc --fingerprint '0123 ...' \
   --source http://example.com/s2/index.asc --fingerprint '9876 ...'
</pre>
<div class="Pp"></div>
In the case where you provide 1 fingerprint, the same fingerprint is used for
  all sources.
<div class="Pp"></div>
You &quot;must&quot; provide at least 1 fingerprint.
<div class="Pp"></div>
<i>Licensing of templates</i>
<div class="Pp"></div>
You should be aware of the licensing of images that you distribute. For open
  source guests, provide a link to the source code in the &quot;notes&quot;
  field and comply with other requirements (eg. around trademarks).
<div class="Pp"></div>
<i>Formal specification of the index file</i>
<div class="Pp"></div>
The index file format has a formal specification defined by the flex scanner and
  bison parser used to parse the file. This can be found in the following files
  in the libguestfs source tree:
<div class="Pp"></div>
<pre>
 builder/index-scan.l
 builder/index-parse.y
</pre>
<div class="Pp"></div>
A tool called <i>virt-index-validate</i>(1) is available to validate the index
  file to ensure it is correct.
<div class="Pp"></div>
Note that the parser and tool can work on either the signed or unsigned index
  file (ie. <i>index</i> or <i>index.asc</i>).
<div class="Pp"></div>
The index is always encoded in UTF-8.
<h2 class="Ss" title="Ss" id="CACHING"><a class="selflink" href="#CACHING">CACHING</a></h2>
<i>Caching templates</i>
<div class="Pp"></div>
Since the templates are usually very large, downloaded templates are cached in
  the user's home directory.
<div class="Pp"></div>
The location of the cache is <i></i><i>$XDG_CACHE_HOME</i><i>/virt-builder/</i>
  or <i></i><i>$HOME</i><i>/.cache/virt-builder</i>.
<div class="Pp"></div>
You can print out information about the cache directory, including which guests
  are currently cached, by doing:
<div class="Pp"></div>
<pre>
 virt-builder --print-cache
</pre>
<div class="Pp"></div>
The cache can be deleted if you want to save space by doing:
<div class="Pp"></div>
<pre>
 virt-builder --delete-cache
</pre>
<div class="Pp"></div>
You can download all (current) templates to the local cache by doing:
<div class="Pp"></div>
<pre>
 virt-builder --cache-all-templates
</pre>
<div class="Pp"></div>
To disable the template cache, use <i>--no-cache</i>.
<div class="Pp"></div>
Only templates are cached. The index and detached digital signatures are not
  cached.
<div class="Pp"></div>
<i>Caching packages</i>
<div class="Pp"></div>
Virt-builder uses <i>curl</i>(1) to download files and it also uses the current
  &quot;http_proxy&quot; (etc) settings when installing packages (
  <i>--install</i>, <i>--update</i>).
<div class="Pp"></div>
You may therefore want to set those environment variables in order to maximize
  the amount of local caching that happens. See &quot;ENVIRONMENT
  VARIABLES&quot; and <i>curl</i>(1).
<div class="Pp"></div>
<i>Local mirrors</i>
<div class="Pp"></div>
To increase both speed and reliability of installing packages, you can set up a
  local mirror of the target distribution, and point the guest package manager
  at that.
<div class="Pp"></div>
Because of the order in which each phase of installation happens, you cannot use
  <i>--write</i> (to point the package manager at a repo) followed by
  <i>--install</i> (to install from that repo). The <i>--write</i> and
  <i>--install</i> steps run in the opposite order, regardless of their order on
  the command line. You have to do this using <i>--run-command</i> instead of
  <i>--install</i>.
<div class="Pp"></div>
Using a local mirror with Fedora
<div class="Pp"></div>
To install a Fedora guest using a local mirror:
<div class="Pp"></div>
<pre>
 virt-builder fedora-20 \
   --edit '/etc/yum.repos.d/fedora.repo:
       s{.*baseurl=.*}{baseurl=http://example.com/mirror/};
       s{.*metalink=.*}{};
   ' \
   --edit '/etc/yum.repos.d/fedora-updates.repo:
       s{.*baseurl=.*}{baseurl=http://example.com/mirror-updates/};
       s{.*metalink=.*}{};
   ' \
   --run-command 'yum -y update' \
   --run-command 'yum -y install pkg1 pkg2 ...'
</pre>
<div class="Pp"></div>
Using a local mirror with Debian
<div class="Pp"></div>
Assuming that you are using &quot;apt-proxy&quot; to mirror the repository, you
  should create a new <i>sources.list</i> file to point to your proxy (see
  https://help.ubuntu.com/community/AptProxy) and then do:
<div class="Pp"></div>
<pre>
 virt-builder debian-7 \
   --upload sources.list:/etc/apt/sources.list \
   --run-command 'apt-get -y update' \
   --run-command 'apt-get -y install pkg1 pkg2 ...'
</pre>
<h2 class="Ss" title="Ss" id="DIGITAL_SIGNATURES"><a class="selflink" href="#DIGITAL_SIGNATURES">DIGITAL
  SIGNATURES</a></h2>
Virt-builder uses GNU Privacy Guard (GnuPG or gpg) to verify that the index and
  templates have not been tampered with.
<div class="Pp"></div>
The source points to an index file, which is optionally signed.
<div class="Pp"></div>
Virt-builder downloads the index and checks that the signature is valid and the
  signer's fingerprint matches the specified fingerprint (ie. the one specified
  in <i>gpgkey=..</i> in the <i>.conf</i>, or with <i>--fingerprint</i>, in that
  order).
<div class="Pp"></div>
For checking against the built-in public key/fingerprint, this requires
  importing the public key into the user's local gpg keyring (that's just the
  way that gpg works).
<div class="Pp"></div>
When a template is downloaded, its signature is checked in the same way.
<div class="Pp"></div>
Although the signatures are optional, if you don't have them then virt-builder
  users will have to use <i>--no-check-signature</i> on the command line. This
  prevents an attacker from replacing the signed index file with an unsigned
  index file and having virt-builder silently work without checking the
  signature. In any case it is highly recommended that you always create signed
  index and templates.
<h2 class="Ss" title="Ss" id="ARCHITECTURE"><a class="selflink" href="#ARCHITECTURE">ARCHITECTURE</a></h2>
Virt-builder can build a guest for any architecture no matter what the host
  architecture is. For example an x86-64 guest on an ARM host.
<div class="Pp"></div>
However certain options may not work, specifically options that require running
  commands in the guest during the build process: <i>--install</i>,
  <i>--update</i>, <i>--run</i>, <i>--run-command</i>. You may need to replace
  these with their firstboot-equivalents.
<div class="Pp"></div>
An x86-64 host building 32 bit i686 guests should work without any special
  steps.
<h2 class="Ss" title="Ss" id="SECURITY"><a class="selflink" href="#SECURITY">SECURITY</a></h2>
Virt-builder does not need to run as root (in fact, should not be run as root),
  and doesn't use setuid, &quot;sudo&quot; or any similar mechanism.
<div class="Pp"></div>
<i>--install</i>, <i>--update</i>, <i>--run</i> and <i>--run-command</i> are
  implemented using an appliance (a small virtual machine) so these commands do
  not run on the host. If you are using the libguestfs libvirt backend and have
  SELinux enabled then the virtual machine is additionally encapsulated in an
  SELinux container (sVirt).
<div class="Pp"></div>
However these options will have access to the host's network and since the
  template may contain untrusted code, the code might try to access host network
  resources which it should not. You can use <i>--no-network</i> to prevent
  this.
<div class="Pp"></div>
Firstboot commands run in the context of the guest when it is booted, and so the
  security of your hypervisor / cloud should be considered.
<div class="Pp"></div>
Virt-builder injects a random seed into every guest which it builds. This helps
  to ensure that TCP sequence numbers, UUIDs, ssh host keys etc are truly random
  when the guest boots.
<div class="Pp"></div>
You should check digital signatures and not ignore any signing errors.
<h2 class="Ss" title="Ss" id="CLONES"><a class="selflink" href="#CLONES">CLONES</a></h2>
If you wish to create many new guests of the same type, it is tempting to run
  virt-builder once and then copy the output file. You should <b>not</b> do
  this. You should run virt-builder once for each new guest you need.
<div class="Pp"></div>
The reason is that each clone needs to have (at least) a separate random seed,
  and possibly other unique features (such as filesystem UUIDs) in future
  versions of virt-builder.
<div class="Pp"></div>
Another thing you should <i>not</i> do is to boot the guest, then clone the
  booted disk image. The reason is that some guests create unique machine IDs,
  SSH host keys and so on at first boot, and you would not want clones to have
  duplicate identities.
<div class="Pp"></div>
See also: <i>virt-sysprep</i>(1).
<h2 class="Ss" title="Ss" id="PERFORMANCE"><a class="selflink" href="#PERFORMANCE">PERFORMANCE</a></h2>
The most important aspect of getting good performance is caching. Templates gets
  downloaded into the cache the first time they are used, or if you use the
  <i>--cache-all-templates</i> option. See &quot;CACHING&quot; above for further
  information.
<div class="Pp"></div>
Packages required for the <i>--install</i> and <i>--update</i> options are
  downloaded using the host network connection. Setting the
  &quot;http_proxy&quot;, &quot;https_proxy&quot; and &quot;ftp_proxy&quot;
  environment variables to point to a local web cache may ensure they only need
  to be downloaded once. You can also try using a local package repository,
  although this can be complex to set up and varies according to which Linux
  distro you are trying to install.
<div class="Pp"></div>
<i>Using </i><i>--no-sync</i><i></i>
<div class="Pp"></div>
Use <i>--no-sync</i>. However read the caveats in the &quot;OPTIONS&quot;
  section above, since this can cause disk corruption if not used correctly.
<div class="Pp"></div>
<i>Skipping virt-resize</i>
<div class="Pp"></div>
Virt-builder can skip the virt-resize step under certain conditions. This makes
  virt-builder much faster. The conditions are:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">the output must be a regular file (not a block device),
      <b>and</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">the user did <b>not</b> use the <i>--size</i> option,
      <b>and</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">the output format is the same as the template format
      (usually raw).</dd>
</dl>
<div class="Pp"></div>
<i>pxzcat</i>
<div class="Pp"></div>
Virt-builder uses an internal implementation of pxzcat (parallel xzcat) if
  liblzma was found at build time. If liblzma was not found at build time,
  regular &quot;xzcat&quot; is used which is single-threaded.
<div class="Pp"></div>
<i>User-Mode Linux</i>
<div class="Pp"></div>
You can use virt-builder with the User-Mode Linux (UML) backend. This may be
  faster when running virt-builder inside a virtual machine (eg. in the cloud).
<div class="Pp"></div>
To enable the UML backend, read the instructions in &quot;USER-MODE LINUX
  BACKEND&quot; in <i>guestfs</i>(3).
<div class="Pp"></div>
Currently you have to use the <i>--no-network</i> option. This should be fixed
  in a future version.
<div class="Pp"></div>
The qcow2 output format is not supported by UML. You can only create raw-format
  guests.
<h2 class="Ss" title="Ss" id="SELINUX"><a class="selflink" href="#SELINUX">SELINUX</a></h2>
Guests which use SELinux (such as Fedora and Red Hat Enterprise Linux) require
  that each file has a correct SELinux label.
<div class="Pp"></div>
Virt-builder does not know how to give new files a label, so there are two
  possible strategies it can use to ensure correct labelling:
<dl class="Bl-tag">
  <dt class="It-tag">Using <i>--selinux-relabel</i></dt>
  <dd class="It-tag">This runs <i>setfiles</i>(8) just before finalizing the
      guest, which sets SELinux labels correctly in the disk image.
    <div style="height: 1.00em;">&#x00A0;</div>
    This is the recommended method.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>--touch</i> <i>/.autorelabel</i></dt>
  <dd class="It-tag">Guest templates may already contain a file called
      <i>/.autorelabel</i> or you may touch it.
    <div style="height: 1.00em;">&#x00A0;</div>
    For guests that use SELinux, this causes <i>restorecon</i>(8) to run at
      first boot. Guests will reboot themselves once the first time you use
      them, which is normal and harmless.</dd>
</dl>
<div class="Pp"></div>
Please note that if your guest uses SELinux, and you are doing operations on it
  which might create new files or change existing ones, you are recommended to
  use <i>--selinux-relabel</i>. This will help in making sure that files have
  the right SELinux labels.
<h1 class="Sh" title="Sh" id="MACHINE_READABLE_OUTPUT"><a class="selflink" href="#MACHINE_READABLE_OUTPUT">MACHINE
  READABLE OUTPUT</a></h1>
The <i>--machine-readable</i> option can be used to make the output more machine
  friendly, which is useful when calling virt-builder from other programs, GUIs
  etc.
<div class="Pp"></div>
Use the option on its own to query the capabilities of the virt-builder binary.
  Typical output looks like this:
<div class="Pp"></div>
<pre>
 $ virt-builder --machine-readable
 virt-builder
 arch
 config-file
 customize
 json-list
 pxzcat
</pre>
<div class="Pp"></div>
A list of features is printed, one per line, and the program exits with status
  0.
<h1 class="Sh" title="Sh" id="ENVIRONMENT_VARIABLES"><a class="selflink" href="#ENVIRONMENT_VARIABLES">ENVIRONMENT
  VARIABLES</a></h1>
For other environment variables which affect all libguestfs programs, see
  &quot;ENVIRONMENT VARIABLES&quot; in <i>guestfs</i>(3).
<dl class="Bl-tag">
  <dt class="It-tag">&quot;http_proxy&quot;</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;https_proxy&quot;</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;no_proxy&quot;</dt>
  <dd class="It-tag">Set the proxy for downloads. These environment variables
      (and more) are actually interpreted by <i>curl</i>(1), not
    virt-builder.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;HOME&quot;</dt>
  <dd class="It-tag">Used to determine the location of the template cache, and
      the location of the user' sources. See &quot;CACHING&quot; and
      &quot;SOURCES OF TEMPLATES&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;VIRT_TOOLS_DATA_DIR&quot;</dt>
  <dd class="It-tag">This can point to the directory containing data files used
      for Windows firstboot installation.
    <div style="height: 1.00em;">&#x00A0;</div>
    Normally you do not need to set this. If not set, a compiled-in default will
      be used (something like <i>/usr/share/virt-tools</i>).
    <div style="height: 1.00em;">&#x00A0;</div>
    This directory may contain the following files:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><i>rhsrvany.exe</i></dt>
  <dd class="It-tag">This is the RHSrvAny Windows binary, used to install a
      &quot;firstboot&quot; script in Windows guests. It is required if you
      intend to use the <i>--firstboot</i> or <i>--firstboot-command</i> options
      with Windows guests.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also: &quot;https://github.com/rwmjones/rhsrvany&quot;</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;"></div>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;XDG_CACHE_HOME&quot;</dt>
  <dd class="It-tag">Used to determine the location of the template cache. See
      &quot;CACHING&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;XDG_CONFIG_HOME&quot;</dt>
  <dd class="It-tag">Used to determine the location of the user' sources. See
      &quot;SOURCES OF TEMPLATES&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;XDG_CONFIG_DIRS&quot;</dt>
  <dd class="It-tag">Used to determine the location of the system sources. See
      &quot;SOURCES OF TEMPLATES&quot;.</dd>
</dl>
<h1 class="Sh" title="Sh" id="EXIT_STATUS"><a class="selflink" href="#EXIT_STATUS">EXIT
  STATUS</a></h1>
This program returns 0 if successful, or non-zero if there was an error.
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<i>guestfs</i>(3), <i>guestfish</i>(1), <i>guestmount</i>(1),
  <i>virt-copy-out</i>(1), <i>virt-customize</i>(1), <i>virt-install</i>(1),
  <i>virt-rescue</i>(1), <i>virt-resize</i>(1), <i>virt-sysprep</i>(1),
  <i>oz-install</i>(1), <i>gpg</i>(1), <i>curl</i>(1), <i>virt-make-fs</i>(1),
  <i>genisoimage</i>(1), http://libguestfs.org/.
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Richard W.M. Jones http://people.redhat.com/~rjones/
<h1 class="Sh" title="Sh" id="COPYRIGHT"><a class="selflink" href="#COPYRIGHT">COPYRIGHT</a></h1>
Copyright (C) 2013 Red Hat Inc.
<h1 class="Sh" title="Sh" id="LICENSE"><a class="selflink" href="#LICENSE">LICENSE</a></h1>
This program is free software; you can redistribute it and/or modify it under
  the terms of the GNU General Public License as published by the Free Software
  Foundation; either version 2 of the License, or (at your option) any later
  version.
<div class="Pp"></div>
This program is distributed in the hope that it will be useful, but WITHOUT ANY
  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
  A PARTICULAR PURPOSE. See the GNU General Public License for more details.
<div class="Pp"></div>
You should have received a copy of the GNU General Public License along with
  this program; if not, write to the Free Software Foundation, Inc., 51 Franklin
  Street, Fifth Floor, Boston, MA 02110-1301 USA.
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
To get a list of bugs against libguestfs, use this link:
  https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&amp;product=Virtualization+Tools
<div class="Pp"></div>
To report a new bug against libguestfs, use this link:
  https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&amp;product=Virtualization+Tools
<div class="Pp"></div>
When reporting a bug, please supply:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The version of libguestfs.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Where you got libguestfs (eg. which Linux distro, compiled
      from source, etc)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Describe the bug accurately and give a way to reproduce
    it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Run <i>libguestfs-test-tool</i>(1) and paste the
      <b>complete, unedited</b> output into the bug report.</dd>
</dl>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2016-08-08</td>
    <td class="foot-os">libguestfs-1.32.7</td>
  </tr>
</table>
</body>
</html>
