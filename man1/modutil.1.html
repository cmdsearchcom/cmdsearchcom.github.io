<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>MODUTIL(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">MODUTIL(1)</td>
    <td class="head-vol">NSS Security Tools</td>
    <td class="head-rtitle">MODUTIL(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
modutil - Manage PKCS #11 module information within the security module
  database.
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<div class="Pp" style="margin-left: 8.00ex; text-indent: -8.00ex;"><b>modutil</b>
  [ <i>options</i>] [[<i>arguments</i>]]</div>
<h1 class="Sh" title="Sh" id="STATUS"><a class="selflink" href="#STATUS">STATUS</a></h1>
This documentation is still work in progress. Please contribute to the initial
  review in <b>Mozilla NSS bug 836477</b>[1]
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
The Security Module Database Tool, <b>modutil</b>, is a command-line utility for
  managing PKCS #11 module information both within secmod.db files and within
  hardware tokens. <b>modutil</b> can add and delete PKCS #11 modules, change
  passwords on security databases, set defaults, list module contents, enable or
  disable slots, enable or disable FIPS 140-2 compliance, and assign default
  providers for cryptographic operations. This tool can also create certificate,
  key, and module security database files.
<div class="Pp"></div>
The tasks associated with security module database management are part of a
  process that typically also involves managing key databases and certificate
  databases.
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
Running <b>modutil</b> always requires one (and only one) option to specify the
  type of module operation. Each option may take arguments, anywhere from none
  to multiple arguments.
<div class="Pp"></div>
<b>Options</b>
<div class="Pp"></div>
-add modulename
<div style="margin-left: 4.00ex;">Add the named PKCS #11 module to the database.
  Use this option with the <b>-libfile</b>, <b>-ciphers</b>, and
  <b>-mechanisms</b> arguments.</div>
<div class="Pp"></div>
-changepw tokenname
<div style="margin-left: 4.00ex;">Change the password on the named token. If the
  token has not been initialized, this option initializes the password. Use this
  option with the <b>-pwfile</b> and <b>-newpwfile</b> arguments. A
  <i>password</i> is equivalent to a personal identification number (PIN).</div>
<div class="Pp"></div>
-chkfips
<div style="margin-left: 4.00ex;">Verify whether the module is in the given FIPS
  mode. <b>true</b> means to verify that the module is in FIPS mode, while
  <b>false</b> means to verify that the module is not in FIPS mode.</div>
<div class="Pp"></div>
-create
<div style="margin-left: 4.00ex;">Create new certificate, key, and module
  databases. Use the <b>-dbdir</b> directory argument to specify a directory. If
  any of these databases already exist in a specified directory, <b>modutil</b>
  returns an error message.</div>
<div class="Pp"></div>
-default modulename
<div style="margin-left: 4.00ex;">Specify the security mechanisms for which the
  named module will be a default provider. The security mechanisms are specified
  with the <b>-mechanisms</b> argument.</div>
<div class="Pp"></div>
-delete modulename
<div style="margin-left: 4.00ex;">Delete the named module. The default NSS PKCS
  #11 module cannot be deleted.</div>
<div class="Pp"></div>
-disable modulename
<div style="margin-left: 4.00ex;">Disable all slots on the named module. Use the
  <b>-slot</b> argument to disable a specific slot.
<div style="height: 1.00em;">&#x00A0;</div>
The internal NSS PKCS #11 module cannot be disabled.</div>
<div class="Pp"></div>
-enable modulename
<div style="margin-left: 4.00ex;">Enable all slots on the named module. Use the
  <b>-slot</b> argument to enable a specific slot.</div>
<div class="Pp"></div>
-fips [true | false]
<div style="margin-left: 4.00ex;">Enable (true) or disable (false) FIPS 140-2
  compliance for the default NSS module.</div>
<div class="Pp"></div>
-force
<div style="margin-left: 4.00ex;">Disable <b>modutil</b>'s interactive prompts
  so it can be run from a script. Use this option only after manually testing
  each planned operation to check for warnings and to ensure that bypassing the
  prompts will cause no security lapses or loss of database integrity.</div>
<div class="Pp"></div>
-jar JAR-file
<div style="margin-left: 4.00ex;">Add a new PKCS #11 module to the database
  using the named JAR file. Use this command with the <b>-installdir</b> and
  <b>-tempdir</b> arguments. The JAR file uses the NSS PKCS #11 JAR format to
  identify all the files to be installed, the module's name, the mechanism
  flags, and the cipher flags, as well as any files to be installed on the
  target machine, including the PKCS #11 module library file and other files
  such as documentation. This is covered in the JAR installation file section in
  the man page, which details the special script needed to perform an
  installation through a server or with <b>modutil</b>.</div>
<div class="Pp"></div>
-list [modulename]
<div style="margin-left: 4.00ex;">Display basic information about the contents
  of the secmod.db file. Specifying a <i>modulename</i> displays detailed
  information about a particular module and its slots and tokens.</div>
<div class="Pp"></div>
-rawadd
<div style="margin-left: 4.00ex;">Add the module spec string to the secmod.db
  database.</div>
<div class="Pp"></div>
-rawlist
<div style="margin-left: 4.00ex;">Display the module specs for a specified
  module or for all loadable modules.</div>
<div class="Pp"></div>
-undefault modulename
<div style="margin-left: 4.00ex;">Specify the security mechanisms for which the
  named module will not be a default provider. The security mechanisms are
  specified with the <b>-mechanisms</b> argument.</div>
<div class="Pp"></div>
<b>Arguments</b>
<div class="Pp"></div>
MODULE
<div style="margin-left: 4.00ex;">Give the security module to access.</div>
<div class="Pp"></div>
MODULESPEC
<div style="margin-left: 4.00ex;">Give the security module spec to load into the
  security database.</div>
<div class="Pp"></div>
-ciphers cipher-enable-list
<div style="margin-left: 4.00ex;">Enable specific ciphers in a module that is
  being added to the database. The <i>cipher-enable-list</i> is a
  colon-delimited list of cipher names. Enclose this list in quotation marks if
  it contains spaces.</div>
<div class="Pp"></div>
-dbdir [sql:]directory
<div style="margin-left: 4.00ex;">Specify the database directory in which to
  access or create security module database files.
<div style="height: 1.00em;">&#x00A0;</div>
<b>modutil</b> supports two types of databases: the legacy security databases
  (cert8.db, key3.db, and secmod.db) and new SQLite databases (cert9.db,
  key4.db, and pkcs11.txt). If the prefix <b>sql:</b> is not used, then the tool
  assumes that the given databases are in the old format.</div>
<div class="Pp"></div>
--dbprefix prefix
<div style="margin-left: 4.00ex;">Specify the prefix used on the database files,
  such as my_ for my_cert8.db. This option is provided as a special case.
  Changing the names of the certificate and key databases is not
  recommended.</div>
<div class="Pp"></div>
-installdir root-installation-directory
<div style="margin-left: 4.00ex;">Specify the root installation directory
  relative to which files will be installed by the <b>-jar</b> option. This
  directory should be one below which it is appropriate to store dynamic library
  files, such as a server's root directory.</div>
<div class="Pp"></div>
-libfile library-file
<div style="margin-left: 4.00ex;">Specify a path to a library file containing
  the implementation of the PKCS #11 interface module that is being added to the
  database.</div>
<div class="Pp"></div>
-mechanisms mechanism-list
<div style="margin-left: 4.00ex;">Specify the security mechanisms for which a
  particular module will be flagged as a default provider. The
  <i>mechanism-list</i> is a colon-delimited list of mechanism names. Enclose
  this list in quotation marks if it contains spaces.
<div style="height: 1.00em;">&#x00A0;</div>
The module becomes a default provider for the listed mechanisms when those
  mechanisms are enabled. If more than one module claims to be a particular
  mechanism's default provider, that mechanism's default provider is undefined.
<div style="height: 1.00em;">&#x00A0;</div>
<b>modutil</b> supports several mechanisms: RSA, DSA, RC2, RC4, RC5, AES, DES,
  DH, SHA1, SHA256, SHA512, SSL, TLS, MD5, MD2, RANDOM (for random number
  generation), and FRIENDLY (meaning certificates are publicly readable).</div>
<div class="Pp"></div>
-newpwfile new-password-file
<div style="margin-left: 4.00ex;">Specify a text file containing a token's new
  or replacement password so that a password can be entered automatically with
  the <b>-changepw</b> option.</div>
<div class="Pp"></div>
-nocertdb
<div style="margin-left: 4.00ex;">Do not open the certificate or key databases.
  This has several effects:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;With the <b>-create</b> command, only
  a module security file is created; certificate and key databases are not
  created.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;With the <b>-jar</b> command,
  signatures on the JAR file are not checked.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;With the <b>-changepw</b> command, the
  password on the NSS internal module cannot be set or changed, since this
  password is stored in the key database.</div>
</div>
<div class="Pp"></div>
-pwfile old-password-file
<div style="margin-left: 4.00ex;">Specify a text file containing a token's
  existing password so that a password can be entered automatically when the
  <b>-changepw</b> option is used to change passwords.</div>
<div class="Pp"></div>
-secmod secmodname
<div style="margin-left: 4.00ex;">Give the name of the security module database
  (like secmod.db) to load.</div>
<div class="Pp"></div>
-slot slotname
<div style="margin-left: 4.00ex;">Specify a particular slot to be enabled or
  disabled with the <b>-enable</b> or <b>-disable</b> options.</div>
<div class="Pp"></div>
-string CONFIG_STRING
<div style="margin-left: 4.00ex;">Pass a configuration string for the module
  being added to the database.</div>
<div class="Pp"></div>
-tempdir temporary-directory
<div style="margin-left: 4.00ex;">Give a directory location where temporary
  files are created during the installation by the <b>-jar</b> option. If no
  temporary directory is specified, the current directory is used.</div>
<h1 class="Sh" title="Sh" id="USAGE_AND_EXAMPLES"><a class="selflink" href="#USAGE_AND_EXAMPLES">USAGE
  AND EXAMPLES</a></h1>
<b>Creating Database Files</b>
<div class="Pp"></div>
Before any operations can be performed, there must be a set of security
  databases available. <b>modutil</b> can be used to create these files. The
  only required argument is the database that where the databases will be
  located.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
modutil -create -dbdir [sql:]directory
</pre>
</div>
<div class="Pp"></div>
<b>Adding a Cryptographic Module</b>
<div class="Pp"></div>
Adding a PKCS #11 module means submitting a supporting library file, enabling
  its ciphers, and setting default provider status for various security
  mechanisms. This can be done by supplying all of the information through
  <b>modutil</b> directly or by running a JAR file and install script. For the
  most basic case, simply upload the library:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
modutil -add modulename -libfile library-file [-ciphers cipher-enable-list] [-mechanisms mechanism-list] 
</pre>
</div>
<div class="Pp"></div>
For example:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
modutil -dbdir sql:/home/my/sharednssdb -add &quot;Example PKCS #11 Module&quot; -libfile &quot;/tmp/crypto.so&quot; -mechanisms RSA:DSA:RC2:RANDOM 
<div class="Pp"></div>
Using database directory ... 
Module &quot;Example PKCS #11 Module&quot; added to database.
</pre>
</div>
<div class="Pp"></div>
<b>Installing a Cryptographic Module from a JAR File</b>
<div class="Pp"></div>
PKCS #11 modules can also be loaded using a JAR file, which contains all of the
  required libraries and an installation script that describes how to install
  the module. The JAR install script is described in more detail in the section
  called &#x201C;JAR INSTALLATION FILE FORMAT&#x201D;.
<div class="Pp"></div>
The JAR installation script defines the setup information for each platform that
  the module can be installed on. For example:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
Platforms { 
   Linux:5.4.08:x86 { 
      ModuleName { &quot;Example PKCS #11 Module&quot; } 
      ModuleFile { crypto.so } 
      DefaultMechanismFlags{0x0000} 
      CipherEnableFlags{0x0000} 
      Files { 
         crypto.so { 
            Path{ /tmp/crypto.so } 
         } 
         setup.sh { 
            Executable 
            Path{ /tmp/setup.sh } 
         } 
      } 
   } 
   Linux:6.0.0:x86 { 
      EquivalentPlatform { Linux:5.4.08:x86 } 
   } 
} 
</pre>
</div>
<div class="Pp"></div>
Both the install script and the required libraries must be bundled in a JAR
  file, which is specified with the <b>-jar</b> argument.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
modutil -dbdir sql:/home/mt&quot;jar-install-filey/sharednssdb -jar install.jar -installdir sql:/home/my/sharednssdb
<div class="Pp"></div>
This installation JAR file was signed by: 
---------------------------------------------- 
<div class="Pp"></div>
**SUBJECT NAME** 
<div class="Pp"></div>
C=US, ST=California, L=Mountain View, CN=Cryptorific Inc., OU=Digital ID
Class 3 - Netscape Object Signing, OU=&quot;www.verisign.com/repository/CPS
Incorp. by Ref.,LIAB.LTD(c)9 6&quot;, OU=www.verisign.com/CPS Incorp.by Ref
. LIABILITY LTD.(c)97 VeriSign, OU=VeriSign Object Signing CA - Class 3
Organization, OU=&quot;VeriSign, Inc.&quot;, O=VeriSign Trust Network **ISSUER
NAME**, OU=www.verisign.com/CPS Incorp.by Ref. LIABILITY LTD.(c)97
VeriSign, OU=VeriSign Object Signing CA - Class 3 Organization,
OU=&quot;VeriSign, Inc.&quot;, O=VeriSign Trust Network 
---------------------------------------------- 
<div class="Pp"></div>
Do you wish to continue this installation? (y/n) y 
Using installer script &quot;installer_script&quot; 
Successfully parsed installation script 
Current platform is Linux:5.4.08:x86 
Using installation parameters for platform Linux:5.4.08:x86 
Installed file crypto.so to /tmp/crypto.so
Installed file setup.sh to ./pk11inst.dir/setup.sh 
Executing &quot;./pk11inst.dir/setup.sh&quot;... 
&quot;./pk11inst.dir/setup.sh&quot; executed successfully 
Installed module &quot;Example PKCS #11 Module&quot; into module database 
<div class="Pp"></div>
Installation completed successfully 
</pre>
</div>
<div class="Pp"></div>
<b>Adding Module Spec</b>
<div class="Pp"></div>
Each module has information stored in the security database about its
  configuration and parameters. These can be added or edited using the
  <b>-rawadd</b> command. For the current settings or to see the format of the
  module spec in the database, use the <b>-rawlist</b> option.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
modutil -rawadd modulespec
</pre>
</div>
<div class="Pp"></div>
<b>Deleting a Module</b>
<div class="Pp"></div>
A specific PKCS #11 module can be deleted from the secmod.db database:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
modutil -delete modulename -dbdir [sql:]directory 
</pre>
</div>
<div class="Pp"></div>
<b>Displaying Module Information</b>
<div class="Pp"></div>
The secmod.db database contains information about the PKCS #11 modules that are
  available to an application or server to use. The list of all modules,
  information about specific modules, and database configuration specs for
  modules can all be viewed.
<div class="Pp"></div>
To simply get a list of modules in the database, use the <b>-list</b> command.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
modutil -list [modulename] -dbdir [sql:]directory 
</pre>
</div>
<div class="Pp"></div>
Listing the modules shows the module name, their status, and other associated
  security databases for certificates and keys. For example:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
modutil -list -dbdir sql:/home/my/sharednssdb 
<div class="Pp"></div>
Listing of PKCS #11 Modules
-----------------------------------------------------------
  1. NSS Internal PKCS #11 Module
         slots: 2 slots attached
        status: loaded
<div class="Pp"></div>
         slot: NSS Internal Cryptographic Services                            
        token: NSS Generic Crypto Services
<div class="Pp"></div>
         slot: NSS User Private Key and Certificate Services                  
        token: NSS Certificate DB
-----------------------------------------------------------
</pre>
</div>
<div class="Pp"></div>
Passing a specific module name with the <b>-list</b> returns details information
  about the module itself, like supported cipher mechanisms, version numbers,
  serial numbers, and other information about the module and the token it is
  loaded on. For example:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
 modutil -list &quot;NSS Internal PKCS #11 Module&quot; -dbdir sql:/home/my/sharednssdb
<div class="Pp"></div>
-----------------------------------------------------------
Name: NSS Internal PKCS #11 Module
Library file: **Internal ONLY module**
Manufacturer: Mozilla Foundation              
Description: NSS Internal Crypto Services    
PKCS #11 Version 2.20
Library Version: 3.11
Cipher Enable Flags: None
Default Mechanism Flags: RSA:RC2:RC4:DES:DH:SHA1:MD5:MD2:SSL:TLS:AES
<div class="Pp"></div>
  Slot: NSS Internal Cryptographic Services                            
  Slot Mechanism Flags: RSA:RC2:RC4:DES:DH:SHA1:MD5:MD2:SSL:TLS:AES
  Manufacturer: Mozilla Foundation              
  Type: Software
  Version Number: 3.11
  Firmware Version: 0.0
  Status: Enabled
  Token Name: NSS Generic Crypto Services     
  Token Manufacturer: Mozilla Foundation              
  Token Model: NSS 3           
  Token Serial Number: 0000000000000000
  Token Version: 4.0
  Token Firmware Version: 0.0
  Access: Write Protected
  Login Type: Public (no login required)
  User Pin: NOT Initialized
<div class="Pp"></div>
  Slot: NSS User Private Key and Certificate Services                  
  Slot Mechanism Flags: None
  Manufacturer: Mozilla Foundation              
  Type: Software
  Version Number: 3.11
  Firmware Version: 0.0
  Status: Enabled
  Token Name: NSS Certificate DB              
  Token Manufacturer: Mozilla Foundation              
  Token Model: NSS 3           
  Token Serial Number: 0000000000000000
  Token Version: 8.3
  Token Firmware Version: 0.0
  Access: NOT Write Protected
  Login Type: Login required
  User Pin: Initialized
</pre>
</div>
<div class="Pp"></div>
A related command, <b>-rawlist</b> returns information about the database
  configuration for the modules. (This information can be edited by loading new
  specs using the <b>-rawadd</b> command.)
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
 modutil -rawlist -dbdir sql:/home/my/sharednssdb
 name=&quot;NSS Internal PKCS #11 Module&quot; parameters=&quot;configdir=. certPrefix= keyPrefix= secmod=secmod.db flags=readOnly &quot; NSS=&quot;trustOrder=75 cipherOrder=100 slotParams={0x00000001=[slotFlags=RSA,RC4,RC2,DES,DH,SHA1,MD5,MD2,SSL,TLS,AES,RANDOM askpw=any timeout=30 ] }  Flags=internal,critical&quot;
</pre>
</div>
<div class="Pp"></div>
<b>Setting a Default Provider for Security Mechanisms</b>
<div class="Pp"></div>
Multiple security modules may provide support for the same security mechanisms.
  It is possible to set a specific security module as the default provider for a
  specific security mechanism (or, conversely, to prohibit a provider from
  supplying those mechanisms).
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
modutil -default modulename -mechanisms mechanism-list 
</pre>
</div>
<div class="Pp"></div>
To set a module as the default provider for mechanisms, use the <b>-default</b>
  command with a colon-separated list of mechanisms. The available mechanisms
  depend on the module; NSS supplies almost all common mechanisms. For example:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
modutil -default &quot;NSS Internal PKCS #11 Module&quot; -dbdir -mechanisms RSA:DSA:RC2 
<div class="Pp"></div>
Using database directory c:\databases...
<div class="Pp"></div>
Successfully changed defaults.
</pre>
</div>
<div class="Pp"></div>
Clearing the default provider has the same format:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
modutil -undefault &quot;NSS Internal PKCS #11 Module&quot; -dbdir -mechanisms MD2:MD5
</pre>
</div>
<div class="Pp"></div>
<b>Enabling and Disabling Modules and Slots</b>
<div class="Pp"></div>
Modules, and specific slots on modules, can be selectively enabled or disabled
  using <b>modutil</b>. Both commands have the same format:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
modutil -enable|-disable modulename [-slot slotname] 
</pre>
</div>
<div class="Pp"></div>
For example:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
modutil -enable &quot;NSS Internal PKCS #11 Module&quot; -slot &quot;NSS Internal Cryptographic Services                            &quot; -dbdir .
<div class="Pp"></div>
Slot &quot;NSS Internal Cryptographic Services                            &quot; enabled.
</pre>
</div>
<div class="Pp"></div>
Be sure that the appropriate amount of trailing whitespace is after the slot
  name. Some slot names have a significant amount of whitespace that must be
  included, or the operation will fail.
<div class="Pp"></div>
<b>Enabling and Verifying FIPS Compliance</b>
<div class="Pp"></div>
The NSS modules can have FIPS 140-2 compliance enabled or disabled using
  <b>modutil</b> with the <b>-fips</b> option. For example:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
modutil -fips true -dbdir sql:/home/my/sharednssdb/
<div class="Pp"></div>
FIPS mode enabled.
</pre>
</div>
<div class="Pp"></div>
To verify that status of FIPS mode, run the <b>-chkfips</b> command with either
  a true or false flag (it doesn't matter which). The tool returns the current
  FIPS setting.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
modutil -chkfips false -dbdir sql:/home/my/sharednssdb/
<div class="Pp"></div>
FIPS mode enabled.
</pre>
</div>
<div class="Pp"></div>
<b>Changing the Password on a Token</b>
<div class="Pp"></div>
Initializing or changing a token's password:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
modutil -changepw tokenname [-pwfile old-password-file] [-newpwfile new-password-file] 
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
modutil -dbdir sql:/home/my/sharednssdb -changepw &quot;NSS Certificate DB&quot; 
<div class="Pp"></div>
Enter old password: 
Incorrect password, try again... 
Enter old password: 
Enter new password: 
Re-enter new password: 
Token &quot;Communicator Certificate DB&quot; password changed successfully.
</pre>
</div>
<h1 class="Sh" title="Sh" id="JAR_INSTALLATION_FILE_FORMAT"><a class="selflink" href="#JAR_INSTALLATION_FILE_FORMAT">JAR
  INSTALLATION FILE FORMAT</a></h1>
When a JAR file is run by a server, by <b>modutil</b>, or by any program that
  does not interpret JavaScript, a special information file must be included to
  install the libraries. There are several things to keep in mind with this
  file:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;It must be declared in the JAR
  archive's manifest file.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;The script can have any name.</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;The metainfo tag for this is
  <b>Pkcs11_install_script</b>. To declare meta-information in the manifest
  file, put it in a file that is passed to <b>signtool</b>.</div>
<div class="Pp"></div>
<b>Sample Script</b>
<div class="Pp"></div>
For example, the PKCS #11 installer script could be in the file pk11install. If
  so, the metainfo file for <b>signtool</b> includes a line such as this:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
+ Pkcs11_install_script: pk11install
</pre>
</div>
<div class="Pp"></div>
The script must define the platform and version number, the module name and
  file, and any optional information like supported ciphers and mechanisms.
  Multiple platforms can be defined in a single install file.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
ForwardCompatible { IRIX:6.2:mips SUNOS:5.5.1:sparc }
Platforms {
   WINNT::x86 {
      ModuleName { &quot;Example Module&quot; }
      ModuleFile { win32/fort32.dll }
      DefaultMechanismFlags{0x0001}
      DefaultCipherFlags{0x0001}
      Files {
         win32/setup.exe {
            Executable
            RelativePath { %temp%/setup.exe }
         }
         win32/setup.hlp {
            RelativePath { %temp%/setup.hlp }
         }
         win32/setup.cab {
            RelativePath { %temp%/setup.cab }
         }
      }
   }
   WIN95::x86 {
      EquivalentPlatform {WINNT::x86}
   }
   SUNOS:5.5.1:sparc {
      ModuleName { &quot;Example UNIX Module&quot; }
      ModuleFile { unix/fort.so }
      DefaultMechanismFlags{0x0001}
      CipherEnableFlags{0x0001}
      Files {
         unix/fort.so {
            RelativePath{%root%/lib/fort.so}
            AbsolutePath{/usr/local/netscape/lib/fort.so}
            FilePermissions{555}
         }
         xplat/instr.html {
            RelativePath{%root%/docs/inst.html}
            AbsolutePath{/usr/local/netscape/docs/inst.html}
            FilePermissions{555}
         }
      }
   }
   IRIX:6.2:mips {
      EquivalentPlatform { SUNOS:5.5.1:sparc }
   }
}
</pre>
</div>
<div class="Pp"></div>
<b>Script Grammar</b>
<div class="Pp"></div>
The script is basic Java, allowing lists, key-value pairs, strings, and
  combinations of all of them.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
--&gt; valuelist
<div class="Pp"></div>
valuelist --&gt; value valuelist
               &lt;null&gt;
<div class="Pp"></div>
value ---&gt; key_value_pair
            string
<div class="Pp"></div>
key_value_pair --&gt; key { valuelist }
<div class="Pp"></div>
key --&gt; string
<div class="Pp"></div>
string --&gt; simple_string
            &quot;complex_string&quot;
<div class="Pp"></div>
simple_string --&gt; [^ \t\n\&quot;&quot;{&quot;&quot;}&quot;]+ 
<div class="Pp"></div>
complex_string --&gt; ([^\&quot;\\\r\n]|(\\\&quot;)|(\\\\))+ 
</pre>
</div>
<div class="Pp"></div>
Quotes and backslashes must be escaped with a backslash. A complex string must
  not include newlines or carriage returns.Outside of complex strings, all white
  space (for example, spaces, tabs, and carriage returns) is considered equal
  and is used only to delimit tokens.
<div class="Pp"></div>
<b>Keys</b>
<div class="Pp"></div>
The Java install file uses keys to define the platform and module information.
<div class="Pp"></div>
<b>ForwardCompatible</b> gives a list of platforms that are forward compatible.
  If the current platform cannot be found in the list of supported platforms,
  then the <b>ForwardCompatible</b> list is checked for any platforms that have
  the same OS and architecture in an earlier version. If one is found, its
  attributes are used for the current platform.
<div class="Pp"></div>
<b>Platforms</b> (required) Gives a list of platforms. Each entry in the list is
  itself a key-value pair: the key is the name of the platform and the value
  list contains various attributes of the platform. The platform string is in
  the format <i>system name:OS release:architecture</i>. The installer obtains
  these values from NSPR. OS release is an empty string on non-Unix operating
  systems. NSPR supports these platforms:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;AIX (rs6000)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;BSDI (x86)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;FREEBSD (x86)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;HPUX (hppa1.1)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;IRIX (mips)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;LINUX (ppc, alpha, x86)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;MacOS (PowerPC)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;NCR (x86)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;NEC (mips)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;OS2 (x86)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;OSF (alpha)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;ReliantUNIX (mips)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;SCO (x86)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;SOLARIS (sparc)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;SONY (mips)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;SUNOS (sparc)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;UnixWare (x86)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;WIN16 (x86)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;WIN95 (x86)</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;WINNT (x86)</div>
<div class="Pp"></div>
For example:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
IRIX:6.2:mips
SUNOS:5.5.1:sparc
Linux:2.0.32:x86
WIN95::x86
</pre>
</div>
<div class="Pp"></div>
The module information is defined independently for each platform in the
  <b>ModuleName</b>, <b>ModuleFile</b>, and <b>Files</b> attributes. These
  attributes must be given unless an <b>EquivalentPlatform</b> attribute is
  specified.
<div class="Pp"></div>
<b>Per-Platform Keys</b>
<div class="Pp"></div>
Per-platform keys have meaning only within the value list of an entry in the
  <b>Platforms</b> list.
<div class="Pp"></div>
<b>ModuleName</b> (required) gives the common name for the module. This name is
  used to reference the module by servers and by the <b>modutil</b> tool.
<div class="Pp"></div>
<b>ModuleFile</b> (required) names the PKCS #11 module file for this platform.
  The name is given as the relative path of the file within the JAR archive.
<div class="Pp"></div>
<b>Files</b> (required) lists the files that need to be installed for this
  module. Each entry in the file list is a key-value pair. The key is the path
  of the file in the JAR archive, and the value list contains attributes of the
  file. At least <b>RelativePath</b> or <b>AbsolutePath</b> must be specified
  for each file.
<div class="Pp"></div>
<b>DefaultMechanismFlags</b> specifies mechanisms for which this module is the
  default provider; this is equivalent to the <b>-mechanism</b> option with the
  <b>-add</b> command. This key-value pair is a bitstring specified in
  hexadecimal (0x) format. It is constructed as a bitwise OR. If the
  DefaultMechanismFlags entry is omitted, the value defaults to 0x0.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
RSA:                   0x00000001
DSA:                   0x00000002
RC2:                   0x00000004
RC4:                   0x00000008
DES:                   0x00000010
DH:                    0x00000020
FORTEZZA:              0x00000040
RC5:                   0x00000080
SHA1:                  0x00000100
MD5:                   0x00000200
MD2:                   0x00000400
RANDOM:                0x08000000
FRIENDLY:              0x10000000
OWN_PW_DEFAULTS:       0x20000000
DISABLE:               0x40000000
</pre>
</div>
<div class="Pp"></div>
<b>CipherEnableFlags</b> specifies ciphers that this module provides that NSS
  does not provide (so that the module enables those ciphers for NSS). This is
  equivalent to the <b>-cipher</b> argument with the <b>-add</b> command. This
  key is a bitstring specified in hexadecimal (0x) format. It is constructed as
  a bitwise OR. If the <b>CipherEnableFlags</b> entry is omitted, the value
  defaults to 0x0.
<div class="Pp"></div>
<b>EquivalentPlatform</b> specifies that the attributes of the named platform
  should also be used for the current platform. This makes it easier when more
  than one platform uses the same settings.
<div class="Pp"></div>
<b>Per-File Keys</b>
<div class="Pp"></div>
Some keys have meaning only within the value list of an entry in a <b>Files</b>
  list.
<div class="Pp"></div>
Each file requires a path key the identifies where the file is. Either
  <b>RelativePath</b> or <b>AbsolutePath</b> must be specified. If both are
  specified, the relative path is tried first, and the absolute path is used
  only if no relative root directory is provided by the installer program.
<div class="Pp"></div>
<b>RelativePath</b> specifies the destination directory of the file, relative to
  some directory decided at install time. Two variables can be used in the
  relative path: <b>%root%</b> and <b>%temp%</b>. <b>%root%</b> is replaced at
  run time with the directory relative to which files should be installed; for
  example, it may be the server's root directory. The <b>%temp%</b> directory is
  created at the beginning of the installation and destroyed at the end. The
  purpose of <b>%temp%</b> is to hold executable files (such as setup programs)
  or files that are used by these programs. Files destined for the temporary
  directory are guaranteed to be in place before any executable file is run;
  they are not deleted until all executable files have finished.
<div class="Pp"></div>
<b>AbsolutePath</b> specifies the destination directory of the file as an
  absolute path.
<div class="Pp"></div>
<b>Executable</b> specifies that the file is to be executed during the course of
  the installation. Typically, this string is used for a setup program provided
  by a module vendor, such as a self-extracting setup executable. More than one
  file can be specified as executable, in which case the files are run in the
  order in which they are specified in the script file.
<div class="Pp"></div>
<b>FilePermissions</b> sets permissions on any referenced files in a string of
  octal digits, according to the standard Unix format. This string is a bitwise
  OR.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
user read:                0400
user write:               0200
user execute:             0100
group read:               0040
group write:              0020
group execute:            0010
other read:               0004
other write:              0002
other execute:            0001
</pre>
</div>
<div class="Pp"></div>
Some platforms may not understand these permissions. They are applied only
  insofar as they make sense for the current platform. If this attribute is
  omitted, a default of 777 is assumed.
<h1 class="Sh" title="Sh" id="NSS_DATABASE_TYPES"><a class="selflink" href="#NSS_DATABASE_TYPES">NSS
  DATABASE TYPES</a></h1>
NSS originally used BerkeleyDB databases to store security information. The last
  versions of these <i>legacy</i> databases are:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;cert8.db for certificates</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;key3.db for keys</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;secmod.db for PKCS #11 module
  information</div>
<div class="Pp"></div>
BerkeleyDB has performance limitations, though, which prevent it from being
  easily used by multiple applications simultaneously. NSS has some flexibility
  that allows applications to use their own, independent database engine while
  keeping a shared database and working around the access issues. Still, NSS
  requires more flexibility to provide a truly shared security database.
<div class="Pp"></div>
In 2009, NSS introduced a new set of databases that are SQLite databases rather
  than BerkleyDB. These new databases provide more accessibility and
  performance:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;cert9.db for certificates</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;key4.db for keys</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;pkcs11.txt, which is listing of all of
  the PKCS #11 modules contained in a new subdirectory in the security databases
  directory</div>
<div class="Pp"></div>
Because the SQLite databases are designed to be shared, these are the
  <i>shared</i> database type. The shared database type is preferred; the legacy
  format is included for backward compatibility.
<div class="Pp"></div>
By default, the tools ( <b>certutil</b>, <b>pk12util</b>, <b>modutil</b>) assume
  that the given security databases follow the more common legacy type. Using
  the SQLite databases must be manually specified by using the <b>sql:</b>
  prefix with the given security directory. For example:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
modutil -create -dbdir sql:/home/my/sharednssdb
</pre>
</div>
<div class="Pp"></div>
To set the shared database type as the default type for the tools, set the
  <b>NSS_DEFAULT_DB_TYPE</b> environment variable to <b>sql</b>:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
export NSS_DEFAULT_DB_TYPE=&quot;sql&quot;
</pre>
</div>
<div class="Pp"></div>
This line can be added to the ~/.bashrc file to make the change permanent for
  the user.
<div class="Pp"></div>
Most applications do not use the shared database by default, but they can be
  configured to use them. For example, this how-to article covers how to
  configure Firefox and Thunderbird to use the new shared NSS databases:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;https://wiki.mozilla.org/NSS_Shared_DB_Howto</div>
<div class="Pp"></div>
For an engineering draft on the changes in the shared NSS databases, see the NSS
  project wiki:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;https://wiki.mozilla.org/NSS_Shared_DB</div>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
certutil (1)
<div class="Pp"></div>
pk12util (1)
<div class="Pp"></div>
signtool (1)
<div class="Pp"></div>
The NSS wiki has information on the new database design and how to configure
  applications to use it.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;https://wiki.mozilla.org/NSS_Shared_DB_Howto</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">&#x2022;https://wiki.mozilla.org/NSS_Shared_DB</div>
<h1 class="Sh" title="Sh" id="ADDITIONAL_RESOURCES"><a class="selflink" href="#ADDITIONAL_RESOURCES">ADDITIONAL
  RESOURCES</a></h1>
For information about NSS and other tools related to NSS (like JSS), check out
  the NSS project wiki at
  <b>http://www.mozilla.org/projects/security/pki/nss/</b>. The NSS site relates
  directly to NSS code changes and releases.
<div class="Pp"></div>
Mailing lists: https://lists.mozilla.org/listinfo/dev-tech-crypto
<div class="Pp"></div>
IRC: Freenode at #dogtag-pki
<h1 class="Sh" title="Sh" id="AUTHORS"><a class="selflink" href="#AUTHORS">AUTHORS</a></h1>
The NSS tools were written and maintained by developers with Netscape, Red Hat,
  Sun, Oracle, Mozilla, and Google.
<div class="Pp"></div>
Authors: Elio Maldonado &lt;emaldona@redhat.com&gt;, Deon Lackey
  &lt;dlackey@redhat.com&gt;.
<h1 class="Sh" title="Sh" id="LICENSE"><a class="selflink" href="#LICENSE">LICENSE</a></h1>
Licensed under the Mozilla Public License, v. 2.0. If a copy of the MPL was not
  distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"> 1.</dt>
  <dd class="It-tag">Mozilla NSS bug 836477</dd>
</dl>
<div style="margin-left: 4.00ex;">https://bugzilla.mozilla.org/show_bug.cgi?id=836477</div>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">5 June 2014</td>
    <td class="foot-os">nss-tools</td>
  </tr>
</table>
</body>
</html>
