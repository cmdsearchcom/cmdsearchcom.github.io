<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:00:15 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>CONFIGSMOKE(1) User Contributed Perl Documentation
CONFIGSMOKE(1)</p>

<p style="margin-top: 1em">NAME <br>
configsmoke.pl - Create a configuration for
tssmokeperl.pl</p>

<p style="margin-top: 1em">SYNOPSIS <br>
$ perl configsmoke.pl -p &lt;prefix&gt;[ -d
&lt;defaultsprefix&gt;]</p>

<p style="margin-top: 1em">or regenerate from previous
_config:</p>

<p style="margin-top: 1em">$ perl configsmoke.pl -p
&lt;prefix&gt; -des</p>

<p style="margin-top: 1em">OPTIONS <br>
Current options:</p>

<p style="margin-top: 1em">-d dfvalsprefix Set prefix for a
_dfconfig file (&lt;prefix&gt;) <br>
-c configprefix When ommited &rsquo;perlcurrent&rsquo; is
used <br>
-j jclprefix When ommited &rsquo;perlcurrent&rsquo; is used
<br>
-l logprefix When ommited &rsquo;perlcurrent&rsquo; is used
<br>
-p prefix Set -c and -j and -l at once</p>

<p style="margin-top: 1em">-des confirm all answers (needs
previous _config)</p>

<p style="margin-top: 1em">DESCRIPTION <br>
Test::Smoke is the symbolic name for a set of scripts and
modules that try to run the perl core tests on as many
configurations as possible and combine the results into an
easy <br>
to read report.</p>

<p style="margin-top: 1em">The main script is
tssmokeperl.pl, and this uses a configuration file that is
created by this program (configsmoke.pl). There is no
default configuration as some actions can be <br>
rather destructive, so you will need to create your own
configuration by running this program!</p>

<p style="margin-top: 1em">By default the configuration
file created is called smokecurrent_config, this can be
changed by specifying the &quot;-c &lt;prefix&gt;&quot; or
&quot;-p &lt;prefix&gt;&quot; switch at the command line
(&quot;-c&quot; <br>
will override &quot;-p&quot; when both are specified).</p>

<p style="margin-top: 1em">$ perl configsmoke.pl -c
mysmoke</p>

<p style="margin-top: 1em">will create mysmoke_config as
the configuration file.</p>

<p style="margin-top: 1em">After you are done configuring,
a small job command list is written. For MSWin32 this is
called smokecurrent.cmd otherwise this is called
smokecurrent.sh. Again the default <br>
prefix can be overridden by specifying the &quot;-j
&lt;prefix&gt;&quot; or &quot;-p &lt;prefix&gt;&quot;
switch.</p>

<p style="margin-top: 1em">All output (stdout, stderr) from
tssmokeperl.pl and its sub-processes is redirected to a
logfile called smokecurrent.log by the small jcl. (Use
&quot;-l &lt;prefix&gt;&quot; or &quot;-p
&lt;prefix&gt;&quot; to <br>
override).</p>

<p style="margin-top: 1em">There are two additional
configuration default files smoke562_dfconfig and
smoke58x_dfconfig to help you configure Test::Smoke for
these two maintenance branches of the source- <br>
tree.</p>

<p style="margin-top: 1em">To create a configuration for
the perl 5.8.x branch:</p>

<p style="margin-top: 1em">$ perl configsmoke.pl -p
smoke58x</p>

<p style="margin-top: 1em">This will read additional
defaults from smoke58x_dfconfig and create smoke58x_config
and smoke58x.sh/smoke58x.cmd and logfile will be
smoke58x.log.</p>

<p style="margin-top: 1em">To create another configuration
for the same branch (and have the right defaults) you can
add the &quot;-d&quot; option:</p>

<p style="margin-top: 1em">$ perl configsmokepl -p snap58x
-d smoke58x</p>

<p style="margin-top: 1em">To create a configuration for
the perl 5.6.2 brach:</p>

<p style="margin-top: 1em">$ perl configsmoke.pl -p
smoke562</p>

<p style="margin-top: 1em">CONFIGURATION <br>
Use of the program:</p>

<p style="margin-top: 1em">&Acirc;&middot; Values in
angled-brackets (&lt;&gt;) are alternatives (none other
allowed)</p>

<p style="margin-top: 1em">&Acirc;&middot; Values in
square-brackets ([]) are default values (&lt;Enter&gt;
confirms)</p>

<p style="margin-top: 1em">&Acirc;&middot; Use single space
to clear a value</p>

<p style="margin-top: 1em">Here is a description of the
configuration sections.</p>

<p style="margin-top: 1em">perl_version <br>
&quot;perl_version&quot; sets a number of default_values.
This makes the smoke5?x_dfconfig files almost obsolete,
although they still provide a nice way to set the prefix and
set the <br>
perl_version.</p>

<p style="margin-top: 1em">ddir <br>
&quot;ddir&quot; is the destination directory. This is used
to put the source-tree in and build perl. If a source-tree
appears to be there you will need to confirm your
choice.</p>

<p style="margin-top: 1em">cfg &quot;cfg&quot; is the path
to the file that holds the build-configurations. There are
several build-cfg files provided with the distribution:</p>

<p style="margin-top: 1em">perlcurrent.cfg for 5.11.x+ on
unixy systems <br>
perl510x.cfg for 5.10.x (MAINT) on unixy systems <br>
perl58x.cfg for 5.8.x (MAINT) on unixy systems <br>
w32current.cfg for 5.8.x+ on MSWin32 <br>
vmsperl.cfg for 5.8.x+ on OpenVMS <br>
Nick Clark hardlink forest <br>
Here is how Nick described it to me:</p>

<p style="margin-top: 1em">My plan is to use a few more
directories, and avoid make distclean:</p>

<p style="margin-top: 1em">1. rsync as before, but to a
master directory. this directory is only used for rsyncing
from the server</p>

<p style="margin-top: 1em">2. copy that directory (as a
hardlink forest) - gnu cp can do it as cp -lr, and I have a
perl script to replicate that (which works nicely on
FreeBSD) as a clean master <br>
source directory for this smoke session</p>

<p style="margin-top: 1em">3. run the regen headers script
(which 5.9.0 now has as a distinct script) rather than just
a Makefile target</p>

<p style="margin-top: 1em">I now have a clean, up-to-date
source tree with accurate headers. For each smoking
configuration</p>

<p style="margin-top: 1em">4. copy that directory (hard
links again)</p>

<p style="margin-top: 1em">5. in the copy directory.
Configure, build and test</p>

<p style="margin-top: 1em">6. delete the copy directory</p>

<p style="margin-top: 1em">deleting a directory seems to be
faster than make distclean.</p>

<p style="margin-top: 1em">sync_type (fsync) <br>
&quot;sync_type&quot; (or &quot;fsync&quot; if you
want_forest) can be one of four:</p>

<p style="margin-top: 1em">rsync <br>
This will use the rsync program to sync up with the
repository. configsmoke.pl checks to see if it can find
rsync in your path.</p>

<p style="margin-top: 1em">The default switches passed to
rsync are: -az&Acirc;&nbsp;--delete</p>

<p style="margin-top: 1em">snapshot <br>
This will use Net::FTP to try to find the latest snapshot on
&lt;ftp://ftp.funet.fi/languages/perl/snap/&gt;.</p>

<p style="margin-top: 1em">You can also get the perl-5.8.x
snapshots (and others) via HTTP if you have LWP installed.
There are two things you should remember:</p>

<p style="margin-top: 1em">1. start the server-name http://
<br>
2. the snapshot-file must be specified.</p>

<p style="margin-top: 1em">Snapshots are not in sync with
the repository, so if you have a working patch program, you
can choose to &quot;upgrade&quot; your snapshot by fetching
all the seperate patches from <br>
the repository and applying them.</p>

<p style="margin-top: 1em">copy <br>
This will use File::Copy and File::Find to just copy from a
local source directory.</p>

<p style="margin-top: 1em">hardlink <br>
This will use File::Find and the link function to copy from
a local source directory. (This is also used if you choose
&quot;forest&quot;.)</p>

<p style="margin-top: 1em">See also Test::Smoke::Syncer</p>

<p style="margin-top: 1em">pfile <br>
&quot;pfile&quot; is the path to a textfile that holds the
names of patches to be applied before smoking. This can be
used to run a smoke test on proposed patches that have not
been <br>
applied (yet) or to see the effect of reversing an already
applied patch. The file format is simple:</p>

<p style="margin-top: 1em">&Acirc;&middot; one patchfile
per line</p>

<p style="margin-top: 1em">&Acirc;&middot; optionally
followed by &rsquo;;&rsquo; and options to pass to patch</p>

<p style="margin-top: 1em">&Acirc;&middot; optionally
followed by &rsquo;;&rsquo; and a description for the
patch</p>

<p style="margin-top: 1em">If the file does not exist yet,
a skeleton version will be created for you.</p>

<p style="margin-top: 1em">You will need a working patch
program to use this feature.</p>

<p style="margin-top: 1em">TODO: There is an issue when
using the &quot;forest&quot; sync, but I will look into
that.</p>

<p style="margin-top: 1em">skip_tests <br>
This is a MANIFEST-like file with the paths to tests that
should be skipped for this smoke.</p>

<p style="margin-top: 1em">The process involves on the fly
modification of MANIFEST for tests in lib/ and ext/ and
renaming of core-tests in t/.</p>

<p style="margin-top: 1em">user_note <br>
This gives you a way of adding personal information to the
report.</p>

<p style="margin-top: 1em">un_file is the filename where
the text to insert into the report is set.</p>

<p style="margin-top: 1em">user_note is the old way to add
this text.</p>

<p style="margin-top: 1em">un_position specify if you want
the user_note on TOP or at the BOTTOM of te report.</p>

<p style="margin-top: 1em">force_c_locale <br>
&quot;force_c_locale&quot; is passed as a switch to
mktest.pl to indicate that $ENV{LC_ALL} should be forced to
&quot;C&quot; during make test.</p>

<p style="margin-top: 1em">defaultenv <br>
&quot;defaultenv&quot;, when set will make Test::Smoke
remove $ENV{PERLIO} and only do a single pass
&quot;make&Acirc;&nbsp;test&quot;.</p>

<p style="margin-top: 1em">locale <br>
&quot;locale&quot; and its value are passed to mktest.pl and
its value is passed to mkovz.pl. mktest.pl will do an extra
pass of make test with $ENV{LC_ALL} set to that locale (and
<br>
&quot;$ENV{PERL_UNICODE} = &quot;&quot;;&quot;,
&quot;$ENV{PERLIO} = &quot;perlio&quot;;&quot;). This
feature should only be used with UTF8 locales, that is why
this is checked (by regex only).</p>

<p style="margin-top: 1em">If you know of a way to get the
utf8 locales on your system, which is not coverd here,
please let me know!</p>

<p style="margin-top: 1em">smokedb_url
[http://perl5.test-smoke.org] <br>
Instead of flooding a mailing list, reposts should be sent
to the SmokeDB. The option to mail yourself a copy of the
report still exists. The SmokeDB however offers a <br>
central point of view to the smoke results.</p>

<p style="margin-top: 1em">send_log
&lt;always|on_fail|never&gt; [on_fail] <br>
Please send in the smoke-logfile for failures.</p>

<p style="margin-top: 1em">send_out
&lt;always|on_fail|never&gt; [never] <br>
mail <br>
&quot;{mail}&quot; will set the new default for
tssmokeperl.pl</p>

<p style="margin-top: 1em">mail_type <br>
See Test::Smoke::Mailer and mailrpt.pl</p>

<p style="margin-top: 1em">w32args <br>
For MSWin32 we need some extra information that is passed to
Test::Smoke::Smoker in order to compensate for the lack of
Configure.</p>

<p style="margin-top: 1em">See &quot;Configure_win32(
)&quot; in Test::Smoke::Util and W32Configure.pl</p>

<p style="margin-top: 1em">vmsmake <br>
Get the make program to use for VMS (MMS or MMK). Start with
the one this perl was build with.</p>

<p style="margin-top: 1em">make finetuning <br>
Two different config options to accomodate the same thing:
parallel build and serial testing</p>

<p style="margin-top: 1em">* makeopt =&gt; used by
Test::Smoke::Smoker::_make() <br>
* testmake =&gt; use a different binary for &quot;make
_test&quot;</p>

<p style="margin-top: 1em">harnessonly <br>
&quot;harnessonly&quot; indicates that &quot;make test&quot;
is replaced by &quot;make test_harness&quot;.</p>

<p style="margin-top: 1em">hasharness3 <br>
&quot;hasharness3&quot; is automagically set for perl
version &gt;= 5.11</p>

<p style="margin-top: 1em">harness3opts <br>
&quot;harness3opts&quot; are passed to
&quot;HARNESS_OPTIONS&quot; for the &quot;make
test_harness&quot; step.</p>

<p style="margin-top: 1em">umask <br>
&quot;umask&quot; will be set in the shell-script that
starts the smoke.</p>

<p style="margin-top: 1em">renice <br>
&quot;renice&quot; will add a line in the shell-script that
starts the smoke.</p>

<p style="margin-top: 1em">v The verbosity level:</p>

<p style="margin-top: 1em">0: Be as quiet as possible <br>
1: Give moderate information <br>
2: Be as loud as possible</p>

<p style="margin-top: 1em">Every module has its own
verbosity control and these are not verry consistent at the
moment.</p>

<p style="margin-top: 1em">smartsmoke <br>
&quot;smartsmoke&quot; indicates that the smoke need not
happen if the patchlevel is the same after syncing the
source-tree.</p>

<p style="margin-top: 1em">killtime <br>
When $Config{d_alarm} is found we can use
&quot;alarm()&quot; to abort long running smokes. Leave this
value empty to keep the old behaviour.</p>

<p style="margin-top: 1em">07:30 =&gt;
F&lt;tssmokeperl.pl&gt; is aborted on 7:30 localtime <br>
+23:45 =&gt; F&lt;tssmokeperl.pl&gt; is aborted after 23
hours and 45 minutes</p>

<p style="margin-top: 1em">Thank you Jarkko for donating
this suggestion.</p>

<p style="margin-top: 1em">adir <br>
The smokereports are lost after a new SYNCTREE step, it
might be handy to archive them along with the logfile.</p>

<p style="margin-top: 1em">If you want this then set the
directory where you want the stored (empty value means no
archiving).</p>

<p style="margin-top: 1em">delay_report <br>
Some filesystems do not support opening an already opened
file. This makes it hard to scan the logfile for compiler
messages. We can delay the creation of the report and call
<br>
mailrpt.pl after tssmokeperl.pl. VMS might benefit.</p>

<p style="margin-top: 1em">PERL5LIB <br>
If you have a value for PERL5LIB set in the config
environment, you could have it transferred tho the
jcl-wrapperscript. Do not bother asking if it is not
there.</p>

<p style="margin-top: 1em">PERL5OPT <br>
If you have a value for PERL5OPT set in the config
environment, you could have it transferred tho the
jcl-wrapperscript. Do not bother asking if it is not
there.</p>

<p style="margin-top: 1em">schedule stuff <br>
cron/crontab <br>
We try to detect &rsquo;crontab&rsquo; or
&rsquo;cron&rsquo;, read the contents of crontab -l, detect
ourself and comment us out. Then we add an new entry.</p>

<p style="margin-top: 1em">MSWin32 at.exe <br>
We only add a new entry, you will need to remove existing
entries, as at.exe has not got a way comment-out
entries.</p>

<p style="margin-top: 1em">Supporting subs <br>
save_config() <br>
&quot;save_config()&quot; writes the configuration data to
disk. If
&quot;Data::Dumper-&gt;can(&rsquo;Sortkeys&rsquo;)&quot; it
will order the keys.</p>

<p style="margin-top: 1em">sort_configkeys() <br>
&quot;sort_configkeys()&quot; is the hook for
Data::Dumper</p>

<p style="margin-top: 1em">Order and grouping by Merijn,
thanks!</p>

<p style="margin-top: 1em">write_sh() <br>
&quot;write_sh()&quot; creates the shell-script.</p>

<p style="margin-top: 1em">write_bat() <br>
&quot;write_bat()&quot; writes the batch-file. It uses the
&quot;.cmd&quot; extension because it uses commands that are
not supported by COMMAND.COM</p>

<p style="margin-top: 1em">write_com <br>
Write a simple DCL script that helps running the smoke
suite.</p>

<p style="margin-top: 1em">default_buildcfg( $file_name,
$pversion ) <br>
Check to see if $file_name exists. If not, copy the default
config for $pversion to $file_name.</p>

<p style="margin-top: 1em">check_buildcfg <br>
We will try to check the build configurations file to see if
we should comment some options out.</p>

<p style="margin-top: 1em">finish_cfgcheck <br>
&quot;finish_cfgcheck()&quot; will create a backup of the
original file and write the new one in its place.</p>

<p style="margin-top: 1em">_perl_numeric_version( $dotted )
<br>
Normalize the dotted version to a numeric version.</p>

<p style="margin-top: 1em">TODO <br>
Schedule, logfile optional</p>

<p style="margin-top: 1em">REVISION <br>
In case I forget to update the $VERSION:</p>

<p style="margin-top: 1em">$Id$</p>

<p style="margin-top: 1em">COPYRIGHT <br>
(c) 2002-2003, All rights reserved.</p>

<p style="margin-top: 1em">* Abe Timmerman
&lt;abeltje@cpan.org&gt;</p>

<p style="margin-top: 1em">This library is free software;
you can redistribute it and/or modify it under the same
terms as Perl itself.</p>

<p style="margin-top: 1em">See:</p>

<p style="margin-top: 1em">&Acirc;&middot;
&lt;http://www.perl.com/perl/misc/Artistic.html&gt;</p>

<p style="margin-top: 1em">&Acirc;&middot;
&lt;http://www.gnu.org/copyleft/gpl.html&gt;</p>

<p style="margin-top: 1em">This program is distributed in
the hope that it will be useful, but WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or
FITNESS FOR A PARTICULAR <br>
PURPOSE.</p>

<p style="margin-top: 1em">perl v5.24.1 2016-04-21
CONFIGSMOKE(1)</p>
<hr>
</body>
</html>
