<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>SEM(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">SEM(1)</td>
    <td class="head-vol">parallel</td>
    <td class="head-rtitle">SEM(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
sem - semaphore for executing shell command lines in parallel
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>sem</b> [--fg] [--id &lt;id&gt;] [--semaphoretimeout &lt;secs&gt;] [-j
  &lt;num&gt;] [--wait] command
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
GNU <b>sem</b> is an alias for GNU <b>parallel --semaphore</b>.
<div class="Pp"></div>
GNU <b>sem</b> acts as a counting semaphore. When GNU <b>sem</b> is called with
  command it starts the command in the background. When <i>num</i> number of
  commands are running in the background, GNU <b>sem</b> waits for one of these
  to complete before starting the command.
<div class="Pp"></div>
GNU <b>sem</b> does not read any arguments to build the command (no -a, :::, and
  ::::). It simply waits for a semaphore to become available and then runs the
  command given.
<div class="Pp"></div>
Before looking at the options you may want to check out the examples after the
  list of options. That will give you an idea of what GNU <b>sem</b> is capable
  of.
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><i>command</i></dt>
  <dd class="It-tag">Command to execute. The command may be followed by
      arguments for the command.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--bg</b></dt>
  <dd class="It-tag">Run command in background thus GNU <b>sem</b> will not wait
      for completion of the command before exiting. This is the default.
    <div style="height: 1.00em;">&#x00A0;</div>
    In toilet analogy: GNU <b>sem</b> waits for a toilet to be available, gives
      the toilet to a person, and exits immediately.
    <div style="height: 1.00em;">&#x00A0;</div>
    See also: <b>--fg</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--jobs</b> <i>N</i></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-j</b> <i>N</i></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--max-procs</b> <i>N</i></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-P</b> <i>N</i></dt>
  <dd class="It-tag">Run up to N commands in parallel. Default is 1 thus acting
      like a mutex.
    <div style="height: 1.00em;">&#x00A0;</div>
    In toilet analogy: <b>-j</b> is the number of toilets.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--jobs</b> <i>+N</i></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-j</b> <i>+N</i></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--max-procs</b> <i>+N</i></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-P</b> <i>+N</i></dt>
  <dd class="It-tag">Add N to the number of CPU cores. Run up to this many jobs
      in parallel. For compute intensive jobs <b>-j</b> +0 is useful as it will
      run number-of-cpu-cores jobs simultaneously.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--jobs</b> <i>-N</i></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-j</b> <i>-N</i></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--max-procs</b> <i>-N</i></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-P</b> <i>-N</i></dt>
  <dd class="It-tag">Subtract N from the number of CPU cores. Run up to this
      many jobs in parallel. If the evaluated number is less than 1 then 1 will
      be used. See also <b>--use-cpus-instead-of-cores</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--jobs</b> <i>N</i>%</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-j</b> <i>N</i>%</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--max-procs</b> <i>N</i>%</dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-P</b> <i>N</i>%</dt>
  <dd class="It-tag">Multiply N% with the number of CPU cores. Run up to this
      many jobs in parallel. If the evaluated number is less than 1 then 1 will
      be used. See also <b>--use-cpus-instead-of-cores</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--jobs</b> <i>procfile</i></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-j</b> <i>procfile</i></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--max-procs</b> <i>procfile</i></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-P</b> <i>procfile</i></dt>
  <dd class="It-tag">Read parameter from file. Use the content of
      <i>procfile</i> as parameter for <i>-j</i>. E.g. <i>procfile</i> could
      contain the string 100% or +2 or 10.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--semaphorename</b> <i>name</i></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--id</b> <i>name</i></dt>
  <dd class="It-tag">Use <b>name</b> as the name of the semaphore. Default is
      the name of the controlling tty (output from <b>tty</b>).
    <div style="height: 1.00em;">&#x00A0;</div>
    The default normally works as expected when used interactively, but when
      used in a script <i>name</i> should be set. <i>$$</i> or
      <i>my_task_name</i> are often a good value.
    <div style="height: 1.00em;">&#x00A0;</div>
    The semaphore is stored in ~/.parallel/semaphores/
    <div style="height: 1.00em;">&#x00A0;</div>
    In toilet analogy the name corresponds to different types of toilets: e.g.
      male, female, customer, staff.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--fg</b></dt>
  <dd class="It-tag">Do not put command in background.
    <div style="height: 1.00em;">&#x00A0;</div>
    In toilet analogy: GNU <b>sem</b> waits for a toilet to be available, takes
      a person to the toilet, waits for the person to finish, and exits.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--semaphoretimeout</b> <i>secs</i></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--st</b> <i>secs</i></dt>
  <dd class="It-tag">If <i>secs</i> &gt; 0: If the semaphore is not released
      within <i>secs</i> seconds, take it anyway.
    <div style="height: 1.00em;">&#x00A0;</div>
    If <i>secs</i> &lt; 0: If the semaphore is not released within <i>secs</i>
      seconds, exit.
    <div style="height: 1.00em;">&#x00A0;</div>
    In toilet analogy: <i>secs</i> &gt; 0: If no toilet becomes available within
      <i>secs</i> seconds, pee on the floor. <i>secs</i> &lt; 0: If no toilet
      becomes available within <i>secs</i> seconds, exit without doing
    anything.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--wait</b></dt>
  <dd class="It-tag">Wait for all commands to complete.
    <div style="height: 1.00em;">&#x00A0;</div>
    In toilet analogy: Wait until all toilets are empty, then exit.</dd>
</dl>
<h1 class="Sh" title="Sh" id="UNDERSTANDING_A_SEMAPHORE"><a class="selflink" href="#UNDERSTANDING_A_SEMAPHORE">UNDERSTANDING
  A SEMAPHORE</a></h1>
Try the following example:
<div class="Pp"></div>
<pre>
  sem -j 2 'sleep 1;echo 1 finished';   echo sem 1 exited
  sem -j 2 'sleep 2;echo 2 finished';   echo sem 2 exited
  sem -j 2 'sleep 3;echo 3 finished';   echo sem 3 exited
  sem -j 2 'sleep 4;echo 4 finished';   echo sem 4 exited
  sem --wait; echo sem --wait done
</pre>
<div class="Pp"></div>
In toilet analogy this uses 2 toilets ( <b>-j 2</b>). GNU <b>sem</b> takes '1'
  to a toilet, and exits immediately. While '1' is sleeping, another GNU
  <b>sem</b> takes '2' to a toilet, and exits immediately.
<div class="Pp"></div>
While '1' and '2' are sleeping, another GNU <b>sem</b> waits for a free toilet.
  When '1' finishes, a toilet becomes available, and this GNU <b>sem</b> stops
  waiting, and takes '3' to a toilet, and exits immediately.
<div class="Pp"></div>
While '2' and '3' are sleeping, another GNU <b>sem</b> waits for a free toilet.
  When '2' finishes, a toilet becomes available, and this GNU <b>sem</b> stops
  waiting, and takes '4' to a toilet, and exits immediately.
<div class="Pp"></div>
Finally another GNU <b>sem</b> waits for all toilets to become free.
<h1 class="Sh" title="Sh" id="EXAMPLE:_Gzipping_*.log"><a class="selflink" href="#EXAMPLE:_Gzipping_*.log">EXAMPLE:
  Gzipping *.log</a></h1>
Run one gzip process per CPU core. Block until a CPU core becomes available.
<div class="Pp"></div>
<pre>
  for i in *.log ; do
    echo $i
    sem -j+0 gzip $i &quot;;&quot; echo done
  done
  sem --wait
</pre>
<h1 class="Sh" title="Sh" id="EXAMPLE:_Protecting_pod2html_from_itself"><a class="selflink" href="#EXAMPLE:_Protecting_pod2html_from_itself">EXAMPLE:
  Protecting pod2html from itself</a></h1>
pod2html creates two files: pod2htmd.tmp and pod2htmi.tmp which it does not
  clean up. It uses these two files for a short time. But if you run multiple
  pod2html in parallel (e.g. in a Makefile with make -j) there is a risk that
  two different instances of pod2html will write to the files at the same time:
<div class="Pp"></div>
<pre>
  # This may fail due to shared pod2htmd.tmp/pod2htmi.tmp files
  foo.html:
          pod2html foo.pod --outfile foo.html
  bar.html:
          pod2html bar.pod --outfile bar.html
  $ make -j foo.html bar.html
</pre>
<div class="Pp"></div>
You need to protect pod2html from running twice at the same time. <b>sem</b>
  running as a mutex will make sure only one runs:
<div class="Pp"></div>
<pre>
  foo.html:
          sem --id pod2html pod2html foo.pod --outfile foo.html
  bar.html:
          sem --id pod2html pod2html bar.pod --outfile bar.html
  clean: foo.html bar.html
          sem --id pod2html --wait
          rm -f pod2htmd.tmp pod2htmi.tmp
  $ make -j foo.html bar.html clean
</pre>
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
None known.
<h1 class="Sh" title="Sh" id="REPORTING_BUGS"><a class="selflink" href="#REPORTING_BUGS">REPORTING
  BUGS</a></h1>
Report bugs to &lt;bug-parallel@gnu.org&gt;.
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Copyright (C) 2010,2011,2012,2013 Ole Tange, http://ole.tange.dk and Free
  Software Foundation, Inc.
<h1 class="Sh" title="Sh" id="LICENSE"><a class="selflink" href="#LICENSE">LICENSE</a></h1>
Copyright (C) 2010,2011,2012,2013 Free Software Foundation, Inc.
<div class="Pp"></div>
This program is free software; you can redistribute it and/or modify it under
  the terms of the GNU General Public License as published by the Free Software
  Foundation; either version 3 of the License, or at your option any later
  version.
<div class="Pp"></div>
This program is distributed in the hope that it will be useful, but WITHOUT ANY
  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
  A PARTICULAR PURPOSE. See the GNU General Public License for more details.
<div class="Pp"></div>
You should have received a copy of the GNU General Public License along with
  this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.
<h2 class="Ss" title="Ss" id="Documentation_license_I"><a class="selflink" href="#Documentation_license_I">Documentation
  license I</a></h2>
Permission is granted to copy, distribute and/or modify this documentation under
  the terms of the GNU Free Documentation License, Version 1.3 or any later
  version published by the Free Software Foundation; with no Invariant Sections,
  with no Front-Cover Texts, and with no Back-Cover Texts. A copy of the license
  is included in the file fdl.txt.
<h2 class="Ss" title="Ss" id="Documentation_license_II"><a class="selflink" href="#Documentation_license_II">Documentation
  license II</a></h2>
You are free:
<dl class="Bl-tag">
  <dt class="It-tag"><b>to Share</b></dt>
  <dd class="It-tag">to copy, distribute and transmit the work</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>to Remix</b></dt>
  <dd class="It-tag">to adapt the work</dd>
</dl>
<div class="Pp"></div>
Under the following conditions:
<dl class="Bl-tag">
  <dt class="It-tag"><b>Attribution</b></dt>
  <dd class="It-tag">You must attribute the work in the manner specified by the
      author or licensor (but not in any way that suggests that they endorse you
      or your use of the work).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Share Alike</b></dt>
  <dd class="It-tag">If you alter, transform, or build upon this work, you may
      distribute the resulting work only under the same, similar or a compatible
      license.</dd>
</dl>
<div class="Pp"></div>
With the understanding that:
<dl class="Bl-tag">
  <dt class="It-tag"><b>Waiver</b></dt>
  <dd class="It-tag">Any of the above conditions can be waived if you get
      permission from the copyright holder.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Public Domain</b></dt>
  <dd class="It-tag">Where the work or any of its elements is in the public
      domain under applicable law, that status is in no way affected by the
      license.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Other Rights</b></dt>
  <dd class="It-tag">In no way are any of the following rights affected by the
      license:</dd>
</dl>
<div style="margin-left: 9.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Your fair dealing or fair use rights, or other applicable
      copyright exceptions and limitations;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The author's moral rights;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Rights other persons may have either in the work itself or
      in how the work is used, such as publicity or privacy rights.</dd>
</dl>
</div>
<div style="margin-left: 9.00ex;"></div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Notice</b></dt>
  <dd class="It-tag">For any reuse or distribution, you must make clear to
      others the license terms of this work.</dd>
</dl>
<div class="Pp"></div>
A copy of the full license is included in the file as cc-by-sa.txt.
<h1 class="Sh" title="Sh" id="DEPENDENCIES"><a class="selflink" href="#DEPENDENCIES">DEPENDENCIES</a></h1>
GNU <b>sem</b> uses Perl, and the Perl modules Getopt::Long, Symbol, Fcntl.
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>parallel</b>(1)</div>
<table class="foot">
  <tr>
    <td class="foot-date">2016-01-23</td>
    <td class="foot-os">20160122</td>
  </tr>
</table>
</body>
</html>
