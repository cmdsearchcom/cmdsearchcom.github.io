<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>DOVEADM-DIRECTOR(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">DOVEADM-DIRECTOR(1)</td>
    <td class="head-vol">Dovecot</td>
    <td class="head-rtitle">DOVEADM-DIRECTOR(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
doveadm-director - Manage Dovecot directors
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>doveadm</b> [<b>-Dv</b>] <b>director add</b> [ <b>-a</b>
  <i>director_socket_path</i>] <i>host</i> [<i>vhost_count</i>]
<div>&#x00A0;</div>
<b>doveadm</b> [<b>-Dv</b>] <b>director flush</b> [ <b>-a</b>
  <i>director_socket_path</i>] <i>host</i>|<b>all</b>
<div>&#x00A0;</div>
<b>doveadm</b> [<b>-Dv</b>] <b>director map</b> [ <b>-a</b>
  <i>director_socket_path</i>] [ <b>-f</b> <i>users_file</i>] [<i>host</i>]
<div>&#x00A0;</div>
<b>doveadm</b> [<b>-Dv</b>] <b>director remove</b> [ <b>-a</b>
  <i>director_socket_path</i>] <i>host</i>
<div>&#x00A0;</div>
<b>doveadm</b> [<b>-Dv</b>] <b>director dump</b> [ <b>-a</b>
  <i>director_socket_path</i>]
<div>&#x00A0;</div>
<b>doveadm</b> [<b>-Dv</b>] <b>director status</b> [ <b>-a</b>
  <i>director_socket_path</i>] [<i>user</i>]
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<b>doveadm director</b> can be used to manage and query the status of the list
  of backend mail servers where Dovecot proxy can redirect connections to.
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
Global <b>doveadm</b>(1) <i>options</i>:
<dl class="Bl-tag">
  <dt class="It-tag"><b>-D</b></dt>
  <dd class="It-tag">Enables verbosity and debug messages.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-v</b></dt>
  <dd class="It-tag">Enables verbosity, including progress counter.</dd>
</dl>
<div class="Pp"></div>
Command specific <i>options</i>:
<dl class="Bl-tag">
  <dt class="It-tag"><b>-a&#x00A0;</b><i>director_socket_path</i></dt>
  <dd class="It-tag">This option is used to specify an alternative socket. The
      option's argument is either an absolute path to a local UNIX domain
      socket, or a hostname and port (<i>hostname</i>:<i>port</i>), in order to
      connect a remote host via a TCP socket.
    <div style="height: 1.00em;">&#x00A0;</div>
    By default <b>doveadm</b>(1) will use the socket
      <i>/var/run/dovecot/director-admin</i>. The socket may be located in
      another directory, when the default <i>base_dir</i> setting was overridden
      in <i>/etc/dovecot/dovecot.conf</i>.</dd>
</dl>
<h1 class="Sh" title="Sh" id="ARGUMENTS"><a class="selflink" href="#ARGUMENTS">ARGUMENTS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><i>host</i></dt>
  <dd class="It-tag">A mail server's hostname or IP address.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>user</i></dt>
  <dd class="It-tag">Is a <i>user</i>'s login name. Depending on the
      configuration, a login name may be for example <b>jane</b> or
      <b>john@example.com</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>vhost_count</i></dt>
  <dd class="It-tag">The number of &quot;virtual hosts&quot; to assign to this
      server. The higher the number is relative to other servers, the more
      connections it gets. The default is 100.</dd>
</dl>
<h1 class="Sh" title="Sh" id="COMMANDS"><a class="selflink" href="#COMMANDS">COMMANDS</a></h1>
<h2 class="Ss" title="Ss" id="director_add"><a class="selflink" href="#director_add">director
  add</a></h2>
<b>doveadm director add</b> [ <b>-a</b> <i>director_socket_path</i>] <i>host</i>
  [<i>vhost_count</i>]
<div class="Pp"></div>
The command's tasks are:
<dl class="Bl-tag">
  <dt class="It-tag">*</dt>
  <dd class="It-tag">assign a new mail server to the director.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">*</dt>
  <dd class="It-tag">increase/decrease the <i>vhost_count</i> of an already
      assigned server.</dd>
</dl>
<h2 class="Ss" title="Ss" id="director_flush"><a class="selflink" href="#director_flush">director
  flush</a></h2>
<b>doveadm director flush</b> [ <b>-a</b> <i>director_socket_path</i>]
  <i>host</i>| <b>all</b>
<div class="Pp"></div>
<b>doveadm director flush</b> drops all user associations either from the given
  <i>host</i> or <b>all</b> hosts. This command is intended mainly for testing
  purposes.
<h2 class="Ss" title="Ss" id="director_map"><a class="selflink" href="#director_map">director
  map</a></h2>
<b>doveadm director map</b> [ <b>-a</b> <i>director_socket_path</i>] [ <b>-f</b>
  <i>users_file</i>] [<i>host</i>]
<div class="Pp"></div>
The command <b>doveadm director map</b> is used to list current
  <i>user</i>&#x00A0;&#x2192;&#x00A0;<i>host</i> mappings. Note that the
  director works using 32bit hashes which makes collisions quite likely, so this
  command can't reliably list exactly which users have recently logged in.
<dl class="Bl-tag">
  <dt class="It-tag"><b>-f&#x00A0;</b><i>users_file</i></dt>
  <dd class="It-tag">Path to a file containing all user names (one per line).
      When given no <i>userdb</i> lookup will be performed. This may be a
      helpful alternative when for example the network connection to the LDAP or
      SQL server is slow.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>host</i></dt>
  <dd class="It-tag">Specify a server's IP address or hostname, to list only
      mappings of the given <i>host</i>.</dd>
</dl>
<h2 class="Ss" title="Ss" id="director_remove"><a class="selflink" href="#director_remove">director
  remove</a></h2>
<b>doveadm director remove</b> [ <b>-a</b> <i>director_socket_path</i>]
  <i>host</i>
<div class="Pp"></div>
Use this command in order to remove the given <i>host</i> from the director.
<h2 class="Ss" title="Ss" id="director_dump"><a class="selflink" href="#director_dump">director
  dump</a></h2>
<b>doveadm director dump</b> [ <b>-a</b> <i>director_socket_path</i>]
<div class="Pp"></div>
Dump the current host configuration as doveadm commands. These commands can be
  easily run after a full director cluster restart to get back to the dumped
  state.
<h2 class="Ss" title="Ss" id="director_status"><a class="selflink" href="#director_status">director
  status</a></h2>
<b>doveadm director status</b> [ <b>-a</b> <i>director_socket_path</i>]
  [<i>user</i>]
<div class="Pp"></div>
This command is used to show the current usage of all assigned mail servers.
<div>&#x00A0;</div>
When a user name is given, this command shows which server the <i>user</i> is
  currently assigned to, where the user will be assigned after the current saved
  assignment gets removed and where the user would be assigned to if the whole
  proxy cluster was restarted fresh.
<h1 class="Sh" title="Sh" id="FILES"><a class="selflink" href="#FILES">FILES</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><i>/etc/dovecot/dovecot.conf</i></dt>
  <dd class="It-tag">Dovecot's main configuration file.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>/etc/dovecot/conf.d/10-director.conf</i></dt>
  <dd class="It-tag">Director specific settings.</dd>
</dl>
<h1 class="Sh" title="Sh" id="EXAMPLE"><a class="selflink" href="#EXAMPLE">EXAMPLE</a></h1>
Add a director with vhost count 150 (or change existing one's vhost count to
  150):
<div class="Pp"></div>
<pre>
<b>doveadm -v director add x1357.imap.ha.example.net 150</b>
2001:db8:543:6861:143::1357: OK
</pre>
<div class="Pp"></div>
Remove a director:
<div class="Pp"></div>
<pre>
<b>doveadm director remove x1357.imap.ha.example.net</b>
</pre>
<div class="Pp"></div>
Query the status of mail hosts in a director:
<div class="Pp"></div>
<pre>
<b>doveadm director status</b>
mail server ip       vhosts  users
192.168.10.1            100    125
192.168.10.2            100    144
192.168.10.3            100    115
</pre>
<div class="Pp"></div>
Query the status of a user's assignment:
<div class="Pp"></div>
<pre>
<b>doveadm director status user@example.com</b>
Current: 192.168.10.1 (expires 2010-06-18 20:17:04)
Hashed: 192.168.10.2
Initial config: 192.168.10.3
</pre>
<div class="Pp"></div>
This means that the user is currently assigned to mail server on IP
  192.168.10.1. After all of user's connections have logged out, the assignment
  will be removed (currently it looks like at 20:17:04, but that may be
  increased). After the assignment has expired, the user will next time be
  redirected to 192.168.10.2 (assuming no changes to director settings). If the
  entire Dovecot proxy cluster was restarted, so that all of the director
  configuration would revert back to its initial values, the user would be
  redirected to 192.168.10.3.
<h1 class="Sh" title="Sh" id="REPORTING_BUGS"><a class="selflink" href="#REPORTING_BUGS">REPORTING
  BUGS</a></h1>
Report bugs, including <i>doveconf -n</i> output, to the Dovecot Mailing List
  &lt;dovecot@dovecot.org&gt;. Information about reporting bugs is available at:
  http://dovecot.org/bugreport.html
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>doveadm</b>(1)</div>
<table class="foot">
  <tr>
    <td class="foot-date">2013-07-12</td>
    <td class="foot-os">Dovecot v2.2</td>
  </tr>
</table>
</body>
</html>
