<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 15:59:49 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>COLMUX(1) colmux COLMUX(1)</p>

<p style="margin-top: 1em">NAME <br>
colmux - multiplex communications to multiple systems
running collectl from a single system</p>

<p style="margin-top: 1em">SYNOPSIS <br>
colmux [-command &quot;collectl-switches... [-p
filespec]]&quot; [-address addr1[,addr2,...]|-addr filename]
[-cols col1[,col2...]] | [-column num]</p>

<p style="margin-top: 1em">DESCRIPTION <br>
This utility gathers up data generated by collectl from
multiple systems and multiplexes it into a single
consolidated format. It runs in essentially 2 distinct
modes, the first <br>
is known as real-time, because data is retrieved and
displayed in real time. The second is playback mode because
data is played back from existing collectl data files.</p>

<p style="margin-top: 1em">There are also 2 general formats
for the data being displayed. The first is a multi-line
display in which the data is displayed in the native form
that collectl displays it, <br>
except it is sorted by a distint column, essentially
allowing one to see the TOP producers of that data. The
second format is a single line display in which one or more
distinct <br>
data elements from each source is displayed on the same
line. This latter format is never sorted, but rather
positionally organized by the name of the system that
generated it.</p>

<p style="margin-top: 1em">Collectl will be then be
executed, using any optional switches specified by -command,
on each of the systems specified by -address OR read those
addresses from a file it the tar&acirc; <br>
get of that switch is a filename rather than a list of hosts
OR on the local system if -address is not specified. See
collectl for details of the various switches. In some <br>
cases certain collectl switches will not make sense in a
colmux environment and if chosen will generate an error.
Further, if hosts are specified with -address, they should
be a <br>
individual addresses or hostnames separated by commas. In
turn, any of them can be in what those familiar with pdsh
would recognize as -w format.</p>

<p style="margin-top: 1em">Colmux will then execute the
collectl command, gather the results from all sources for a
particular interval and display them one result per line,
sorted by the specified column <br>
OR all on the same line in groups specified by -cols. The
number of lines displayed is set to the size of the terminal
window by default, but can be changed using -lines. The <br>
one exception is the use of -nosort which only applies to
the playback of existing collectl raw files. In this mode
all records for a particular interval will be displayed and
<br>
the sorting bypassed, making this a speedy and convenient
mechanism for gathering all data from all systems in one
place for potential further processing.</p>

<p style="margin-top: 1em">Colmux will never modify the
size of the terminal window so to see more or wider lines
either expand the window or override the number of display
lines and run it again. If the <br>
number display lines is set greater then the terminal height
or 0, colmux will no longer overlay the previous window and
simply run in a continuous scrolling mode.</p>

<p style="margin-top: 1em">Common Switches</p>

<p style="margin-top: 1em">-address list|pdsh|filename <br>
Specify any combination of addresses as hostnames OR in pdsh
-w format OR a filename containing a list of
hostnames/addresses, 1 per line. You MUST have passwordless
ssh <br>
access to these nodes. If a different username is required,
be sure to specify addresses in username@host format noting
you do not have to have the same username on each <br>
host. If specified, these usernames will override those
specified with the -username switch. rsh access is not
supported.</p>

<p style="margin-top: 1em">-command switches <br>
One can specify virtually any collectl command here, both in
real-time or playback mode. Some switches may only be used
during one mode or the other and colmux will usu&acirc; <br>
ally let you know if you specify an invalid combination or
an otherwise restricted switch. Only those directly
affecting colmux are listed below:</p>

<p style="margin-top: 1em">--from, --thru <br>
Limit the timeframe for data being played back, noting you
can include both the from and thru times with the --from
switch if you separate then with a hyphen.</p>

<p style="margin-top: 1em">-o time-format <br>
This is a &quot;magic&quot; switch in that it not only tells
collectl how to display dates/times (no other options are
permitted using -o other than those from the set <br>
[dDTm]), it also tells colmux how to display dates/times
too.</p>

<p style="margin-top: 1em">In single line mode, the
timestamp will either come from the host system in real-time
mode OR the first host when run in playback mode. This is
the most common <br>
use/need for this switch. But be careful in choosing column
numbers with -cols as the position of the data shifts by 1
when time is included and by 2 if date and <br>
time are. Using -test will correctly show the shifted
positions but only if you include -o with the command at the
same time you use -test.</p>

<p style="margin-top: 1em">In real-time/top mode this
switch is not allowed since colmux simply reports the
current time of the system it is running on.</p>

<p style="margin-top: 1em">When playing back data
multi-line formatted data from one or more files, a
timestamp for each interval is reported, consisting of the
time of that interval. When <br>
this switch is included, each line will be tagged with an
appropriate timestamp since on rare occasions they may not
necessarily all be identical.</p>

<p style="margin-top: 1em">-p playback-file <br>
This switch tells colmux to run in playback mode. The
filename should include the directory location and is
usually specified with wild cards, limiting the <br>
selected file(s) to a specific date. When those files are on
the same host (-address is not specified), they may be for
multiple hosts, but when the files are on <br>
remote hosts they must all be for be that unique host. If
the file specification includes the string TODAY or
YESTERDAY they will be replaced with *yyyymmdd* for <br>
that date.</p>

<p style="margin-top: 1em">-P <br>
Run collectl in plot-format. This allows one to specify just
about any combination of subsystems since all data is always
displayed on a single line. However, due <br>
to the lack of formatting, this also makes no sense for
multi-line displays and is therefore only supported in
single-line format.</p>

<p style="margin-top: 1em">-help <br>
Show a brief help message and exit.</p>

<p style="margin-top: 1em">-hostwidth n <br>
By default, colmux set the hostwidth to 8, unless it sees
something wider and for most situations this is sufficient.
However, if one specifies hostnames that are aliases <br>
of the longer hostname, colmux has no way of knowing the
real hostlengths until after it starts receiving data from
collectl and the formatting will be off if the host&acirc;
<br>
names are longer than the default. To overcome this problem,
use this switch to force the hostname to be wider.</p>

<p style="margin-top: 1em">-lines <br>
Change the number of lines that are displayed for each
interval in multi-line mode. The default will be determined
by the terminal size returned by the linux resize com&acirc;
<br>
mand if present. If that command is not present, the size
will be initially set to 24. If -lines is greater than the
terminal size or 0, top-like behavior will not be <br>
used when in real-time mode.</p>

<p style="margin-top: 1em">Single-line format controls the
number of lines displayed between headers. A value of 0 will
only display the header one time.</p>

<p style="margin-top: 1em">-noescape <br>
Colmux uses brute-force screen formatting, that is it
generates its own VT100 escape sequences to clear lines
and/or move the cursor. On some occasions you may want to
<br>
disable this sequences if you wish to recode the output and
do your own post-processing of it. This switch will do just
that.</p>

<p style="margin-top: 1em">-port <br>
Sometimes a remote version of collectl is already using the
default socket. This allows one to start another instance
and override that value.</p>

<p style="margin-top: 1em">-test <br>
This tells colmux to execute the specified collectl command
either locally or on the first remote system specified by
-address, print the associated header with the <br>
selected column(s) highlighted and also include each column
name along with its ordinal number, making it fairly easy to
make sure you&rsquo;ve selected the right column(s).</p>

<p style="margin-top: 1em">-username name <br>
Use this username for ALL ssh commands. It can be overridden
for specific hosts by specifying them with the -address
switch with the desired hostnames.</p>

<p style="margin-top: 1em">-version <br>
Display the version and exit. It will also report if
Term::ReadKey is installed and if so what its version number
is.</p>

<p style="margin-top: 1em">Playback Mode Specific</p>

<p style="margin-top: 1em">The following additional
switches only apply to playback mode. There are no real-time
mode specific switches.</p>

<p style="margin-top: 1em">-delay seconds <br>
Introduce a delay between intervals in seconds. You can
specify fractional values. Not using this switch will cause
the output to be displayed as fast as it can be ren&acirc;
<br>
dered.</p>

<p style="margin-top: 1em">-home <br>
Move the cursor to the home position (upper left-hand
corner) of the display to use a top-like display format.
This ONLY applies to multi-line mode when in playback mode
<br>
and provides a mechanism for displaying recorded data in a
top-like fashion.</p>

<p style="margin-top: 1em">-hostfilter addr[,addr] <br>
When playing back files for multiple hosts on the local
system, sometimes you do not want to play back ALL the host
files. This filter allows you to specify only those <br>
hosts which you want to process. The format of the list of
addresses is specified in the same way as -address except
that you cannot specify a filename.</p>

<p style="margin-top: 1em">-nosort <br>
Intended primarily for output that would be redirected to a
file, do not sort or include any escape sequences in the
output.</p>

<p style="margin-top: 1em">Multi-Line Format</p>

<p style="margin-top: 1em">When there is more output then
will fit on the screen, colmux includes the text: <br>
Displaying: lines xx thru yy out of zz <br>
on the right-side of the top line of the display, where xx
is typically 1.</p>

<p style="margin-top: 1em">However, once colmux is running,
one might want to look at subsequent lines, ie those below
the bottom of the screen and therefore invisible. If the
ReadKey module is <br>
installed, one can simply use the PageDown key to move down
the display and the PageUp key to move in the other
direction. If ReadKey is not installed, typing the multi-
<br>
key sequences pd&lt;ENTER&gt; or pu&lt;ENTER&gt; will cause
the same thing to happen.</p>

<p style="margin-top: 1em">-colhelp <br>
When you wish to change the sort column and the arrow keys
aren&rsquo;t available to you, it may be cumbersome to
identify the number of the column to type in followed by
<br>
RETURN. This tells colmux to display the numbers over each
column eliminating the need to manually count them and find
the one you want.</p>

<p style="margin-top: 1em">-column num <br>
Set the sort column to this number. The column numbering is
determined by the columns returned by collectl for the
requested command. Since date/time columns are <br>
optional for non-plot data, their inclusion will change the
numbering of the columns so if you are not sure you selected
the correct column, you should first execute your <br>
command with -test included.</p>

<p style="margin-top: 1em">You can also change the column
number interactively with the RIGHT/LEFT arrow keys IF the
ReadKey module is installed (see colmux -version) OR simply
type it in followed <br>
by the &lt;ENTER&gt; key.</p>

<p style="margin-top: 1em">-finalcr <br>
There is a real odd case in which you might want to pipe
colmux real-time output to a script for further processing.
However, if you do this you can&rsquo;t read the final line
<br>
with a routine that expects a terminating CR, like
python&rsquo;s readline(). Rather, that last line and the
one that follows will be returned as one long string. This
switch <br>
tell colmux to insert that final CR, which WILL mess up the
screen under normal operations, so be forewarned.</p>

<p style="margin-top: 1em">-hostformat char:pos <br>
There are times one has long hostnames which can either take
up valuable screen real estate or are simply painful to look
at. This switch may evolve over time and is cur&acirc; <br>
rently targetted as hostnames that have repeating parts
along with a unique part, separated by a character such as a
hyphen. This switch allows you to specify a single <br>
character followed by the piece of the hostname you&rsquo;d
like to see displayed. For example, if you have a hostname
like aaa-bbbb-cccc-dddd, -hostformat -:3 will cause the <br>
cccc piece to be displayed.</p>

<p style="margin-top: 1em">-nobold <br>
Do not highlight the selected column. This may be useful
when redirecting output to a file and you do not want the
associated escape sequences to be written to it.</p>

<p style="margin-top: 1em">-reverse <br>
Reverse the default sort order. You can also change the
direction of the sort interactively with the UP/DOWN arrow
keys IF the ReadKey module is installed (see colmux <br>
-version) <br>
OR simply type the r key and &lt;ENTER&gt;.</p>

<p style="margin-top: 1em">-zero <br>
Do not display any rows with 0 in the sort column. You can
also type z&lt;ENTER&gt;interactively.</p>

<p style="margin-top: 1em">Single-Line Format</p>

<p style="margin-top: 1em">-col1000 <br>
Divide each column by 1000 before display</p>

<p style="margin-top: 1em">-colk <br>
Divide each column by 1024 before display</p>

<p style="margin-top: 1em">-collog10 <br>
Remap large numbers to a smaller number of values by taking
the log10 of them and further transforming by the followign
mapping: 0,1 to 0, 10 to 10, 100 to 20, 1000 to 30, <br>
10000 to 40, ... 1e9 to 90.</p>

<p style="margin-top: 1em">-cols num,... <br>
Group all data together for each host by column number(s).
As with -column, you can confirm the correct column(s) have
been selected by first running with -test.</p>

<p style="margin-top: 1em">-colnodet <br>
Do not show data for individual hosts, just display the
totals.</p>

<p style="margin-top: 1em">-colnodiv num,... <br>
Do not divide the specified column numbers by 1000 or 1024
when col1000 or colk or apply the colllog10 transformation
when specified. A typical usage is if you want to <br>
look at cpu loads as well as network or disk stats in which
case you may want to divide the latter by 1024 but not the
cpu.</p>

<p style="margin-top: 1em">-colnoinst <br>
Do no include instance portion (and surrounding brackets) in
totals column headers.</p>

<p style="margin-top: 1em">-coltotal <br>
Include the totals for each column to the right.</p>

<p style="margin-top: 1em">-colwidth <br>
Set the output columns to this width, typically used in
conjunction with -col1000 or colk to allow more hosts to fit
onto the same line. It can also be used if the host <br>
names are too narrow for column headers and you have room to
display wider names.</p>

<p style="margin-top: 1em">Exception Reporting Specific</p>

<p style="margin-top: 1em">In single-line format, rather
than wait for all hosts to report their data, colmux simply
reports the last data seen when the time to generate a line
of output has come. In most <br>
cases, these do reflect the most recent data values but in
times of load, the data may be late getting to colmux and so
a previous value may be reported. If the age of that data
<br>
exceeds a defined number of intervals, the default is
currently 2, an exception value will be reported of -1. At
other times it has been seen where kernel/driver bugs may
cause <br>
incorrect values to be reported as negative numbers and
those values are also reported as -1. Both the age and
exception values can be changed with the following
switches.</p>

<p style="margin-top: 1em">-age number <br>
When initially starting up and all hosts have not yet
reported any data, colmux will display a -1 to indicate no
data has been seen yet. If during processing a host fails
<br>
to report in -age intervals, the default is 2, colmux will
also report a -1 indicating the data is stale.</p>

<p style="margin-top: 1em">-negdataval val <br>
In some cases, there could be erroneous data reported as
negative numbers (though sometimes negative numbers are
valid). When specified, replace any negative numbers with
<br>
this value.</p>

<p style="margin-top: 1em">-nodataval val <br>
This switch allows you to change the -1 that is normally
reported for missing or stale data to the specified value,
most commonly 0.</p>

<p style="margin-top: 1em">Diagnostics</p>

<p style="margin-top: 1em">The following switches are
intended more for diagnostic purposes than normal operation,
though are also worth using on appropriate occasions.</p>

<p style="margin-top: 1em">-debug val <br>
This switch is for generating diagnostic information at
various levels. It is actually a bit mask, whose values are
listed in the beginning on colmux itself. Perhaps the <br>
most useful value is 1 as it will cause colmux to display
all the remote commands issues to each host in the address
list and can often reveal problems when things don&rsquo;t
<br>
seem to be working correctly</p>

<p style="margin-top: 1em">-nocheck <br>
This switch was initially included in an earlier version
when remote host checking was causing problem in some cases
and by skipping those checks, colmux would run more <br>
reliably. While it is felt that as of V3.2.0 these
reachability checks are now reliable and should not be
skipped, this switch has been left in place.</p>

<p style="margin-top: 1em">-quiet <br>
By default and when -nocheck not specified, colmux checks
the versions of all collectl instances against that of the
first node found to be running collectl and if differ&acirc;
<br>
ent, reports the mismatch. This switch suppresses that
warning.</p>

<p style="margin-top: 1em">When a connection is received
from an unexpected address, a warning is also reported and
the request promptly ignored. This switch also suppresses
those messages as well. <br>
For more information on problems connecting, see CONNECTION
PROBLEMS.</p>

<p style="margin-top: 1em">-reachable <br>
By default, when a node is found to not be reachable, colmux
will remove it from its list of hosts and continue
execution. This switch will tell colmux to exit when all
<br>
hosts are not reachable.</p>

<p style="margin-top: 1em">Miscellaneous</p>

<p style="margin-top: 1em">There are 2 switches whose
descriptions don&rsquo;t really fit anywhere else:</p>

<p style="margin-top: 1em">-colbin path <br>
On rare occasions, such as testing a patch to collectl in a
copy NOT in /usr/bin, you may want to tell colmux to use
that copy instead of the standard one. Use this <br>
switch to point to that copy. Naturally that copy must exist
in that location on all systems.</p>

<p style="margin-top: 1em">-keepalive secs <br>
Colmux uses ssh to start collectl on each remote machine and
then communications between collectl and colmux occur over a
socket. Normally, ssh is configured to timeout <br>
after an interval of inactivity, such as 30 minutes, which
means a long-running colmux session will begin to lose
connections when this interval is reached. By specifying
<br>
a keepalive interval, you&rsquo;re telling the ssh to send a
periodic keepalive to the other end so that connection
doesn&rsquo;t get dropped.</p>

<p style="margin-top: 1em">-retaddr addr <br>
Tell remote collectls to open a socket on this address
instead of the preselected one. For more details on this,
see CONNECTION PROBLEMS.</p>

<p style="margin-top: 1em">-timeout secs <br>
By default, collectl waits up to 10 seconds for remote
instances of collectl to connect back. On slower networks or
when a very large number of instances have been <br>
started, they may fail to connect back in time. This switch
will extend that timeout, but it also requires collectl
V3.6.4 be used because earlier version do not support <br>
this feature.</p>

<p style="margin-top: 1em">-timerange secs <br>
When colmux starts up and checks the connectivity to all the
machines specified by -addr, it also gets their current
date/time and using that computes the range of system <br>
times across all nodes. If that time is found to be more
then -timerange seconds, colmux generates a warning as this
difference could cause reporting probems. One can <br>
increase the range to get rid of the message (not
recommended unless other factors are preventing nodes from
responding quickly enough to the date command) OR suppress
the <br>
warning with -quiet.</p>

<p style="margin-top: 1em">PLAYBACK MODE RESTRICTIONS <br>
All logs being played back must have been collected using
the same interval as colmux only looks at the first
file/host to determine the appropriate value.</p>

<p style="margin-top: 1em">It is assumed all clocks are
reasonably well synchronized as colmux uses time to
determine which data is to be displayed as a set.</p>

<p style="margin-top: 1em">All files must be in the same
directory on all systems and that directory must be included
in the playback file specification</p>

<p style="margin-top: 1em">All files on a remote host must
be for that host only</p>

<p style="margin-top: 1em">EXAMPLES <br>
Run collectl on 3 nodes, showing CPU, Disk and Network
statistics once a second and sorted by column 1, which
happens to be total cpu.</p>

<p style="margin-top: 1em">colmux -addr abc,def,xyz</p>

<p style="margin-top: 1em">Dynamically display top
processes on nodes n1-n10 of a cluster once a second, sorted
by column 5.</p>

<p style="margin-top: 1em">colmux -addr n[1-10] -command
&quot;-sZ :1&quot; -column 5</p>

<p style="margin-top: 1em">Do the same for yesterday,
between the hours of 5AM and 6AM, being sure to stall for
1/2 second between intervals. Note, if you leave off -addr
you could put all the logs into <br>
/var/log/collectl on the local host and play them back from
there.</p>

<p style="margin-top: 1em">colmux -addr n[1-10] -command
&quot;-sZ -p/var/log/collectl/YESTERDAY -from
05:00-06:00&quot; -column 5 -delay .5</p>

<p style="margin-top: 1em">Look at the amount of mapped and
slab memory consumed on nodes n1-n10 and n15 in real-time,
every 2 seconds using single-line format. Include totals and
preface each line with <br>
the time. Since memory sizes tend to be rather large, divide
each by 1024 so we see MB rather than KB. Note that the
columns numbers are always displayed are ascending order
<br>
regardless of their order in -cols. To be sure, first test
the column numbers.</p>

<p style="margin-top: 1em">colmux -addr n[1-10,15] -command
&quot;-sm -i2 -oT&quot; -cols 6,7 -coltot -colk -test <br>
colmux -addr n[1-10,15] -command &quot;-sm -i2 -oT&quot;
-cols 6,7 -coltot -colk</p>

<p style="margin-top: 1em">Display most active disks, based
on KB written, on nodes n1, n4 and n5.</p>

<p style="margin-top: 1em">colmux -addr n1,n4,n5 -command
&quot;-sD&quot; -column 6</p>

<p style="margin-top: 1em">Here is a cool trick. Collectl
currently lets you look at top processes with the --top
switch and even choose a sort column by name. However, if
you want to change the column <br>
you need to exit, then rerun collectl with a different sort
column name. But if you run it like this example, you get
the power of colmux to dynamically change the sort columns
<br>
with the arrow keys! You can also use this technique to have
collectl dynamically sort any local multi-line data such as
slabs or even detail data like CPU, Disk, Lustre and <br>
Networks too! Naturally this technique works just as well
with playing back data as well.</p>

<p style="margin-top: 1em">colmux -command &quot;-sZ
-i:1&quot;</p>

<p style="margin-top: 1em">RESTRICTIONS <br>
colmux requires passwordless ssh between the node it is
running on those it is monitoring. also be sure the port you
are using for communications, the default is 2655, if
open</p>

<p style="margin-top: 1em">CONNECTION PROBLEMS <br>
The way colmux works is to choose an address it wants to
communicate over and starts up one or more remote copies of
collectl, telling them to connect back to colmux using that
<br>
address. The easiest way to see this, is to run colmux with
-noesc, which tells it NOT to issue any escape sequences and
therefore not to run in full screen mode. The addional <br>
switch of -debug 1 tells it to show the remote collectl
startup command. When there is a communications problem you
will typically see &rsquo;connection timed out&rsquo;
messages displayed.</p>

<p style="margin-top: 1em">There are actually a couple of
possibilities here, one of which is a firewall is preventing
connections and the easiest way to test this is run collectl
on the local machine like <br>
this: collectl -Aserver. This tells collectl run as a
server, listening for connections just like colmux. Then log
into a remote machine and run /usr/share/col&acirc; <br>
lectl/util/client.pl addr-of-server which tells client.pl to
open a socket to that copy of collectl. It should fail just
like when it was run via colmux, so try opening the <br>
firewall and try it again. If it fixes the problem, it was
indeed the firewall blocking things and colmux should now
work just fine.</p>

<p style="margin-top: 1em">Sometimes there are multiple
interfaces defined on the machine hosting colmux and in some
cases only some addresses will allow socket connections.
Again, using client.pl on the <br>
remote machine try connecting back to collectl over
different addresses and when you find one that works, tell
colmux to use that address for communication via the
-retaddr <br>
switch.</p>

<p style="margin-top: 1em">AUTHOR <br>
This program was written by Mark Seger (mark.seger@hp.com).
<br>
Copyright 2015 Hewlett-Packard Development Company, L.P.</p>

<p style="margin-top: 1em">SEE ALSO <br>
http://collectl-utils.sourceforge.net/colmux.html</p>

<p style="margin-top: 1em">LOCAL DECEMBER 2010
COLMUX(1)</p>
<hr>
</body>
</html>
