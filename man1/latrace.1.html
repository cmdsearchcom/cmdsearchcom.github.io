<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:21:22 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>LATRACE(1) LATRACE(1)</p>

<p style="margin-top: 1em">NAME <br>
latrace - LD_AUDIT 2.4+ libc frontend</p>

<p style="margin-top: 1em">SYNOPSIS <br>
latrace [-snltfvhiBdISbcCyYLpoaNADVTFERq] command [arg ...
]</p>

<p style="margin-top: 1em">DESCRIPTION <br>
The latrace tracer is able to run a command and display its
dynamic library calls using a LD_AUDIT libc feature,
available from libc version 2.4 onward. It is also capable
to <br>
measure and display various statistics of dynamic calls. See
the section called &acirc;DISCUSSION&acirc; for more
details.</p>

<p style="margin-top: 1em">If the header file with
functions&rsquo; declarations is provided, latrace will
display functions&acirc;s arguments. The header file file
syntax is similar to the C language, with several <br>
exceptions See the section called &acirc;HEADERS&acirc; for
more details.</p>

<p style="margin-top: 1em">The latrace by default fully
operates inside of the traced program. However another
&quot;pipe mode&quot; is available to move the main work to
the tracer - the latrace binary. See the <br>
section called &acirc;PIPE mode&acirc; for more details.</p>

<p style="margin-top: 1em">The latrace use is similar to
strace(1) and ltrace(1).</p>

<p style="margin-top: 1em">OPTIONS <br>
-l, --libs lib1[,lib2,...] <br>
audit from and to lib1, lib2 ...</p>

<p style="margin-top: 1em">-t, --libs-to lib1[,lib2,...]
<br>
audit to lib1, lib2 ...</p>

<p style="margin-top: 1em">-f, --libs-from lib1[,lib2,...]
<br>
audit from lib1, lib2 ...</p>

<p style="margin-top: 1em">-s, --sym sym1[,sym2,...] <br>
audit symbols sym1, sym2 ...</p>

<p style="margin-top: 1em">-n, --sym-omit sym1[,sym2,...]
<br>
omit symbols sym1, sym2 ...</p>

<p style="margin-top: 1em">-L, --lib-subst s1[,s2,...] <br>
objsearch LD_AUDIT interface (See the section called
&acirc;OBJSEARCH&acirc;)</p>

<p style="margin-top: 1em">-c, --counts <br>
display statistics counts of symbols - implies pipe mode
(see the section called &acirc;PIPE mode&acirc;) an no
symbol output is displayed</p>

<p style="margin-top: 1em">-C, --sort-counts stat <br>
implies -c, plus sort the statistics by stat with following
values: time,per,call,ucall,lib,sym (default is call)</p>

<p style="margin-top: 1em">-p, --pipe <br>
use pipe to latrace process to send audit data (see the
section called &acirc;PIPE mode&acirc;)</p>

<p style="margin-top: 1em">-N, --conf <br>
config file (see the section called
&acirc;CONFIG&acirc;)</p>

<p style="margin-top: 1em">-A, --enable-args <br>
enable arguments output (definitions from
/etc/latrace.conf)</p>

<p style="margin-top: 1em">-D, --detail-args <br>
display struct arguments in more detail</p>

<p style="margin-top: 1em">-a, --args file <br>
specify arguments definition file, implies -A (without the
default definition file of course)</p>

<p style="margin-top: 1em">-y, --framesize number <br>
framesize for storing the stack before pltexit (default
100)</p>

<p style="margin-top: 1em">-Y, --no-framesize-check <br>
disable framesize check</p>

<p style="margin-top: 1em">-F, --no-follow-fork <br>
dont follow fork calls (childs). This is just supressing the
latrace output from new childs. The nature of the LD_AUDIT
feature prevents to disable it completely.</p>

<p style="margin-top: 1em">-E, --no-follow-exec <br>
dont follow exec calls</p>

<p style="margin-top: 1em">-S, --timestamp <br>
display timestamp for each symbol</p>

<p style="margin-top: 1em">-b, --flow-below sym1[,sym2,...]
<br>
display flow for sym1, sym2 ...</p>

<p style="margin-top: 1em">-I, --no-indent-sym <br>
do no indent symbols based on the their stack depth</p>

<p style="margin-top: 1em">-i, --indent-sym indent_size
<br>
indent size specification in indent_size</p>

<p style="margin-top: 1em">-B, --braces <br>
allways display {} for the around the symbol body</p>

<p style="margin-top: 1em">-d, --demangle <br>
C++ demangle symbols on the output</p>

<p style="margin-top: 1em">-T, --hide-tid <br>
dont display thread id</p>

<p style="margin-top: 1em">-o, --output file <br>
store output to file</p>

<p style="margin-top: 1em">-R, --ctl-config <br>
controled config feature</p>

<p style="margin-top: 1em">-q, --disable <br>
run with disabled auditing</p>

<p style="margin-top: 1em">-v, --verbose <br>
verbose output</p>

<p style="margin-top: 1em">-V, --version <br>
display version</p>

<p style="margin-top: 1em">-h, --help <br>
display help</p>

<p style="margin-top: 1em">EXAMPLES <br>
&Acirc;&middot; The simplest way to run latrace is like
this:</p>

<p style="margin-top: 1em">latrace cat</p>

<p style="margin-top: 1em">&Acirc;&middot; To see the
argument values specified by default config file run:</p>

<p style="margin-top: 1em">latrace -A cat</p>

<p style="margin-top: 1em">&Acirc;&middot; Same as above
but using the pipe mode to get all the end symbols
printed:</p>

<p style="margin-top: 1em">latrace -Ap cat</p>

<p style="margin-top: 1em">&Acirc;&middot; To see the
argument values specified by specified config file run:</p>

<p style="margin-top: 1em">latrace -a latrace.conf cat</p>

<p style="margin-top: 1em">&Acirc;&middot; To get output
only for specified symbol (eg. read and write) run:</p>

<p style="margin-top: 1em">latrace -A -s read,write cat</p>

<p style="margin-top: 1em">&Acirc;&middot; To get flow
under the specified symbol (eg. sysconf) run:</p>

<p style="margin-top: 1em">latrace -b sysconf kill</p>

<p style="margin-top: 1em">&Acirc;&middot; To get output
only for specified library (eg. libproc) run:</p>

<p style="margin-top: 1em">latrace -Al libproc w</p>

<p style="margin-top: 1em">&Acirc;&middot; To get symbol
statistics run:</p>

<p style="margin-top: 1em">latrace -c ls</p>

<p style="margin-top: 1em">&Acirc;&middot; To get symbol
statistics sorted by time run:</p>

<p style="margin-top: 1em">latrace -C time ls</p>

<p style="margin-top: 1em">&Acirc;&middot; To get output
stored to the text file run:</p>

<p style="margin-top: 1em">latrace -o output.latrace ls</p>

<p style="margin-top: 1em">&Acirc;&middot; To change the
libkrava1.so dependency to the libkrava2.so run one of
these:</p>

<p style="margin-top: 1em">latrace -L krava1%krava2 ex</p>

<p style="margin-top: 1em">latrace -L krava1~libkrava2.so
ex</p>

<p style="margin-top: 1em">latrace -L
libkrava1.so=libkrava2.so ex</p>

<p style="margin-top: 1em">DISCUSSION <br>
NAMES CHECK <br>
For options &quot;-l -t -f -s -n -b&quot; the * symbol can
be used to switch to the substring search. If it is not
specified, the exact search for the name is done.</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">-s &quot;*krava&quot; checks for
symbols with &quot;krava&quot; substring.</p>

<p style="margin-top: 1em">-s &quot;krava&quot; checks only
for &quot;krava&quot; symbol</p>

<p style="margin-top: 1em">LD_AUDIT <br>
This is just a brief and vague description of the LD_AUDIT
feature. For more information look to rtld-audit(7) man done
by Petr Baudis or study the glibc/latrace source code. <br>
Very brief explanation follows.</p>

<p style="margin-top: 1em">The libc dynamic linker audit
feature allows to trace/audit program&acirc;s
symbols/libraries. The feature is enabled by the LD_AUDIT
environment variable. This variable must contain <br>
path to the audit shared library. This audit library needs
to follow specific interface. The interface functions will
be then called by the dynamic linker appropriatelly.</p>

<p style="margin-top: 1em">The audit library needs to
export following symbols (the &quot;la_PLTENTER&quot; and
&quot;la_PLTEXIT&quot; names are architecture
dependent).</p>

<p style="margin-top: 1em">&quot;la_activity&quot; <br>
&quot;la_objsearch&quot; <br>
&quot;la_objopen&quot; <br>
&quot;la_preinit&quot; <br>
&quot;la_symbind32&quot; <br>
&quot;la_symbind64&quot; <br>
&quot;la_PLTENTER&quot; <br>
&quot;la_PLTEXIT&quot; <br>
&quot;la_objclose&quot;</p>

<p style="margin-top: 1em">As for the latrace package the
audit shared library is called libltaudit.so.</p>

<p style="margin-top: 1em">OBJSEARCH <br>
The objsearch LD_AUDIT interface provide means for changing
traced program shared object names/locations. The -L option
argument should have following form:</p>

<p style="margin-top: 1em">-L s1[,s2,...] where sN is src
[=%~] dst</p>

<p style="margin-top: 1em">The src is the source
pattern/name and dst is the destination name/pattern.</p>

<p style="margin-top: 1em">= Comparing src with the library
name. If matched, replace the <br>
library name with dst. <br>
library name - /lib/krava1.so <br>
src - /lib/krava1.so <br>
dst - /lib/krava2.so</p>

<p style="margin-top: 1em">final library name -
/lib/krava2.so</p>

<p style="margin-top: 1em">% Looking for the src in the
library name. If found, replace the <br>
src with dst part. <br>
library name - /lib/krava1.so <br>
src - krava1 <br>
dst - krava2</p>

<p style="margin-top: 1em">final library name -
/lib/krava2.so</p>

<p style="margin-top: 1em">~ Looking for the src in the
library name. If found, replace the <br>
library name with dst. <br>
library name - /lib/krava1.so <br>
src - krava1 <br>
dst - /lib/krava2.so</p>

<p style="margin-top: 1em">final library name -
/lib/krava2.so</p>

<p style="margin-top: 1em">PIPE mode <br>
The latrace can work in two modes. The first one native does
does the output directly in the traced program process. The
other one, pipe mode use the IPC fifo mechanism to send <br>
the data from the traced process to the latrace process. The
latrace process is then responsible for the output. Using
the pipe mode you loose the traced program standard output
<br>
context with printed symbols.</p>

<p style="margin-top: 1em">By using the pipe mode, the
latrace is not dependent on the trace program
usage/manipulation of the standard output descriptor. Also
the symbol statistics counts -c, -C options <br>
use the pipe mode to transfer symbol information to the
latrace binary, and the latrace binary does the counts at
the end.</p>

<p style="margin-top: 1em">CONFIG <br>
The latrace provide possibility to enable/disable some of
the options by means of configuration file. Some of the
options are linked to the command line arguments some of
them <br>
are not. When latrace starts the global configuration file
is read. This file is usually being placed in here:</p>

<p style="margin-top: 1em">/etc/latrace.d/latrace.conf</p>

<p style="margin-top: 1em">Having default values read from
this file, user can overload any of them by command line
options or by supling another config file via -N, --conf
option.</p>

<p style="margin-top: 1em">The configuration file syntax is
roughly:</p>

<p style="margin-top: 1em">INCLUDE
&lt;anotherconfigfile&gt;</p>

<p style="margin-top: 1em">OPTIONS { <br>
OPTION1 = VALUE <br>
OPTION2 = YES|NO <br>
... <br>
OPTIONN = VALUE <br>
}</p>

<p style="margin-top: 1em"># comment</p>

<p style="margin-top: 1em">Configuration file options</p>

<p style="margin-top: 1em">HEADERS = FILE <br>
-a, --args</p>

<p style="margin-top: 1em">INDENT_SYM = VALUE <br>
-i, --indent-sym</p>

<p style="margin-top: 1em">PIPE = BOOL <br>
-p, --pipe</p>

<p style="margin-top: 1em">TIMESTAMP = BOOL <br>
-S, --timestamp</p>

<p style="margin-top: 1em">FRAMESIZE = VALUE <br>
-y, --framesize</p>

<p style="margin-top: 1em">FRAMESIZE_CHECK = BOOL <br>
-Y, --no-framesize-check</p>

<p style="margin-top: 1em">HIDE_TID = BOOL <br>
-T, --hide-tid</p>

<p style="margin-top: 1em">FOLLOW_FORK = BOOL <br>
-F, --no-follow-fork</p>

<p style="margin-top: 1em">FOLLOW_EXEC = BOOL <br>
-E, --no-follow-exec</p>

<p style="margin-top: 1em">DEMANGLE = BOOL <br>
-d, --demangle</p>

<p style="margin-top: 1em">BRACES = BOOL <br>
-B, --braces</p>

<p style="margin-top: 1em">ENABLE_ARGS = BOOL <br>
-A, --enable-args</p>

<p style="margin-top: 1em">DETAIL_ARGS = BOOL <br>
-D, --detail-args</p>

<p style="margin-top: 1em">OUTPUT_TTY = FILE</p>

<p style="margin-top: 1em">&Acirc;&middot; stores tracee
terminal output to the file</p>

<p style="margin-top: 1em">LIBS = LIB1[,LIB2,...] <br>
-l, --libs</p>

<p style="margin-top: 1em">LIBS_TO = LIB1[,LIB2,...] <br>
-t, --libs-to</p>

<p style="margin-top: 1em">LIBS_FROM = LIB1[,LIB2,...] <br>
-f, --libs-from</p>

<p style="margin-top: 1em">SYM = SYM1[,SYM2,...] <br>
-s, --sym</p>

<p style="margin-top: 1em">SYM_OMIT = SYM1[,SYM2,...] <br>
-n, --sym-omit</p>

<p style="margin-top: 1em">SYM_BELOW = SYM1[,SYM2,...] <br>
-b, --flow-below</p>

<p style="margin-top: 1em">SYM_NOEXIT = SYM1[,SYM2,...]</p>

<p style="margin-top: 1em">&Acirc;&middot; symbols which do
no run exit callback (plt_exit)</p>

<p style="margin-top: 1em">ARGS_STRING_POINTER_LENGTH =
BOOL</p>

<p style="margin-top: 1em">&Acirc;&middot; function
arguments - display string length and pointer value</p>

<p style="margin-top: 1em">HEADERS <br>
The latrace header file allows user to define symbols as an
classic C functions with arguments. Argument names will be
displayed together with values as the latrace output. The
<br>
more arguments are defined, the more performance and memory
penalties should be expected.</p>

<p style="margin-top: 1em">The package is delivered with
several predefined header files for the most commonly used
functions. List of the glibc header files used follows (the
list mostly follows the <br>
ltrace header files list, and author is willing to update it
according to the needs)</p>

<p style="margin-top: 1em">ctype.h dirent.h dlfcn.h fcntl.h
getopt.h inet.h ioctl.h <br>
libintl.h libio.h locale.h misc.h mman.h ncurses.h netdb.h
<br>
pthread.h pwd.h resource.h signal.h socket.h stat.h stdio.h
<br>
stdlib.h string.h syslog.h term.h termios.h time.h
typedefs.h <br>
unistd.h utmp.h wait.h</p>

<p style="margin-top: 1em">The latrace header files are
usually stored under directory:</p>

<p style="margin-top: 1em">/etc/latrace.d/headers/</p>

<p style="margin-top: 1em">User can specify single header
file using command line option or configuration file. This
file then can include other needed headers. As already
mentioned, the latrace config <br>
file syntax lightly follows the C language syntax. Following
part describes the latrace config file language.</p>

<p style="margin-top: 1em">&Acirc;&middot; Several POD
types (plain old data), are hardcoded in latrace. Size of
those arguments is determined by the sizeof macro. The list
follows.</p>

<p style="margin-top: 1em">void <br>
char u_char <br>
short u_short <br>
int u_int <br>
long u_long <br>
llong u_llong # (long long) <br>
float double</p>

<p style="margin-top: 1em">&Acirc;&middot; The typedef
keyword allows to specify new type based on the already
existing one (POD or typedefed). Eventhough there&acirc;s a
way for multiple pointer layers in the type <br>
definition (*), only one is taken.</p>

<p style="margin-top: 1em">typedef base_type new_type; <br>
typedef base_type * new_type; <br>
typedef base_type ** new_type;</p>

<p style="margin-top: 1em">&Acirc;&middot; Comments follow
the C style / logic.</p>

<p style="margin-top: 1em">/comments</p>

<p style="margin-top: 1em">&Acirc;&middot; The include
keyword allows to include another config file.</p>

<p style="margin-top: 1em">#include
&quot;filename&quot;</p>

<p style="margin-top: 1em">&Acirc;&middot; The struct
keyword allows to define the structure. The syntax folows
following grammar rules.</p>

<p style="margin-top: 1em">START:: struct NAME { STRUCT_DEF
}; <br>
STRUCT_DEF:: DEF | EMPTY <br>
DEF:: NAME NAME | <br>
NAME &rsquo;*&rsquo; NAME | <br>
struct NAME NAME | <br>
struct NAME &rsquo;*&rsquo; NAME <br>
NAME:: [-0-9a-zA-Z_]+</p>

<p style="margin-top: 1em">&Acirc;&middot; The function
definition follows following syntax (DEF and NAME are the
same as for struct definition).</p>

<p style="margin-top: 1em">START:: DEF &rsquo;(&rsquo; ARGS
&rsquo;)&rsquo; &rsquo;;&rsquo; <br>
ARGS:: ARGS &rsquo;,&rsquo; DEF | DEF | EMPTY</p>

<p style="margin-top: 1em">&Acirc;&middot; The enum
definition follows following syntax (NAME is same as for
struct definition).</p>

<p style="margin-top: 1em">START:: ENUM NAME
&rsquo;{&rsquo; ENUM_DEF &rsquo;}&rsquo; &rsquo;;&rsquo;
<br>
ENUM_DEF:: ENUM_DEF &rsquo;,&rsquo; ENUM_ELEM | ENUM_ELEM
<br>
ENUM_ELEM:: NAME &rsquo;=&rsquo; NAME | NAME</p>

<p style="margin-top: 1em">&Acirc;&middot; Example of a
simple latrace config file.</p>

<p style="margin-top: 1em">---[ cut here
]----------------------------- <br>
enum krava { <br>
krava1 = 1, <br>
krava2, <br>
krava3 = 100 <br>
};</p>

<p style="margin-top: 1em">#include
&quot;krava.conf&quot;</p>

<p style="margin-top: 1em">typedef u_int pid_t;</p>

<p style="margin-top: 1em">struct ex_st { <br>
pid_t p; <br>
int cnt; <br>
char *name; <br>
};</p>

<p style="margin-top: 1em">int f1(pid_t p, struct ex_st
*k); <br>
int f2(char* name, struct ex_st k, int k = krava); <br>
struct ex_st* f3(pid_t *p, struct ex_st k); <br>
---[ cut here ]-----------------------------</p>

<p style="margin-top: 1em">&Acirc;&middot; Arrays are not
supported yet, so there&acirc;s no way to define some
structures. For such a structures use void* type where the
structure argu- ment is passed by pointer. If it is <br>
passed by value, there&acirc;s no workaround so far (aside
from filling the structure body with POD types up to the
actual length of the structure :).</p>

<p style="margin-top: 1em">&Acirc;&middot; Variable
argument lists (va_list/...) are not supported yet. The
function definition needs to stop before the first variable
argument list argument.</p>

<p style="margin-top: 1em">PORTS <br>
The latrace should work on any glibc system with LD_AUDIT
support. However arguments details are architecture specific
and need special support inside latrace itself.</p>

<p style="margin-top: 1em">Author is willing to port the
latrace to any architecture, as long as he got an access to
corresponding system. Currently functional ports are:</p>

<p style="margin-top: 1em">x86 ok</p>

<p style="margin-top: 1em">x86_64 ok</p>

<p style="margin-top: 1em">arm ok</p>

<p style="margin-top: 1em">BUGS <br>
MANY, plz report bugs to
&lt;latrace@lists.fedorahosted.org[1]&gt; or
&lt;olsajiri@gmail.com[2]&gt;.</p>

<p style="margin-top: 1em">You can also visit the
http://people.redhat.com/jolsa/latrace/ page to see the
latest release notes information.</p>

<p style="margin-top: 1em">LD_AUDIT related glibc bugs:</p>

<p style="margin-top: 1em">&Acirc;&middot; Bug 7055 (no
longer reproducible)</p>

<p style="margin-top: 1em">&Acirc;&middot; Bug 9893 (FIXED
in 2.10)</p>

<p style="margin-top: 1em">&Acirc;&middot; Bug 3924 (FIXED
in 2.7-2)</p>

<p style="margin-top: 1em">AUTHOR <br>
Jiri Olsa &lt;olsajiri@gmail.com[2]&gt;</p>

<p style="margin-top: 1em">CONTRIBUTORS <br>
&Acirc;&middot; Nix &lt;nix@esperi.org.uk[3]&gt;</p>

<p style="margin-top: 1em">&Acirc;&middot; Akos Pasztory
&lt;akos.pasztory@gmail.com[4]&gt;</p>

<p style="margin-top: 1em">&Acirc;&middot; Artur Skawina
&lt;art.08.09@gmail.com[5]&gt;</p>

<p style="margin-top: 1em">&Acirc;&middot; Dr. David Alan
Gilbert &lt;david.gilbert@linaro.org[6]&gt;</p>

<p style="margin-top: 1em">&Acirc;&middot; Sebastian
Pipping &lt;sping@gentoo.org[7]&gt;</p>

<p style="margin-top: 1em">LICENSE <br>
This is free software, distributed under the GPLv3
license.</p>

<p style="margin-top: 1em">SEE ALSO <br>
strace(1), ltrace(1)</p>

<p style="margin-top: 1em">AUTHOR <br>
Jiri Olsa &lt;olsajiri@gmail.com&gt; <br>
Author.</p>

<p style="margin-top: 1em">NOTES <br>
1. latrace@lists.fedorahosted.org <br>
mailto:latrace@lists.fedorahosted.org</p>

<p style="margin-top: 1em">2. olsajiri@gmail.com <br>
mailto:olsajiri@gmail.com</p>

<p style="margin-top: 1em">3. nix@esperi.org.uk <br>
mailto:nix@esperi.org.uk</p>

<p style="margin-top: 1em">4. akos.pasztory@gmail.com <br>
mailto:akos.pasztory@gmail.com</p>

<p style="margin-top: 1em">5. art.08.09@gmail.com <br>
mailto:art.08.09@gmail.com</p>

<p style="margin-top: 1em">6. david.gilbert@linaro.org <br>
mailto:david.gilbert@linaro.org</p>

<p style="margin-top: 1em">7. sping@gentoo.org <br>
mailto:sping@gentoo.org</p>

<p style="margin-top: 1em">0.5.11 November 2015
LATRACE(1)</p>
<hr>
</body>
</html>
