<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>PMIE(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">PMIE(1)</td>
    <td class="head-vol">General Commands Manual</td>
    <td class="head-rtitle">PMIE(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
<b>pmie</b> - inference engine for performance metrics
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>pmie</b> [ <b>-bCdefHqVvWxz</b>] [ <b>-A</b> <i>align</i>] [ <b>-a</b>
  <i>archive</i>] [ <b>-c</b> <i>filename</i>] [ <b>-h</b> <i>host</i>] [
  <b>-l</b> <i>logfile</i>] [ <b>-j</b> <i>stompfile</i>] [ <b>-n</b>
  <i>pmnsfile</i>] [ <b>-O</b> <i>offset</i>] [ <b>-S</b> <i>starttime</i>] [
  <b>-T</b> <i>endtime</i>] [ <b>-t</b> <i>interval</i>] [ <b>-U</b>
  <i>username</i>] [ <b>-Z</b> <i>timezone</i>] [ <i>filename ...</i>]
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<b>pmie</b> accepts a collection of arithmetic, logical, and rule expressions to
  be evaluated at specified frequencies. The base data for the expressions
  consists of performance metrics values delivered in real-time from any host
  running the Performance Metrics Collection Daemon (PMCD), or using historical
  data from Performance Co-Pilot (PCP) archive logs.
<div class="Pp"></div>
As well as computing arithmetic and logical values, <b>pmie</b> can execute
  actions (popup alarms, write system log messages, and launch programs) in
  response to specified conditions. Such actions are extremely useful in
  detecting, monitoring and correcting performance related problems.
<div class="Pp"></div>
The expressions to be evaluated are read from configuration files specified by
  one or more <i>filename</i> arguments. In the absence of any <i>filename</i>,
  expressions are read from standard input.
<div class="Pp"></div>
A description of the command line options specific to <b>pmie</b> follows:
<dl class="Bl-tag">
  <dt class="It-tag"><b>-a</b></dt>
  <dd class="It-tag"><i>archive</i> which is a comma-separated list of names,
      each of which may be the base name of an archive or the name of a
      directory containing one or more archives written by <b>pmlogger</b>(1).
      Multiple instances of the <b>-a</b> flag may appear on the command line to
      specify a list of sets of archives. In this case, it is required that only
      one set of archives be present for any one host. Also, any explicit host
      names occurring in a <b>pmie</b> expression must match the host name
      recorded in one of the archive labels. In the case of multiple sets of
      archives, timestamps recorded in the archives are used to ensure temporal
      consistency.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-b</b></dt>
  <dd class="It-tag">Output will be line buffered and standard output is
      attached to standard error. This is most useful for background execution
      in conjunction with the <b>-l</b> option. The <b>-b</b> option is always
      used for <b>pmie</b> instances launched from <b>pmie_check</b>(1).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-C</b></dt>
  <dd class="It-tag">Parse the configuration file(s) and exit before performing
      any evaluations. Any errors in the configuration file are reported.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-c</b></dt>
  <dd class="It-tag">An alternative to specifying <i>filename</i> at the end of
      the command line.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-d</b></dt>
  <dd class="It-tag">Normally <b>pmie</b> would be launched as a non-interactive
      process to monitor and manage the performance of one or more hosts. Given
      the <b>-d</b> flag however, execution is interactive and the user is
      presented with a menu of options. Interactive mode is useful mainly for
      debugging new expressions.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-e</b></dt>
  <dd class="It-tag">When used with <b>-V</b>, <b>-v</b> or <b>-W</b>, this
      option forces timestamps to be reported with each expression. The
      timestamps are in <b>ctime</b>(3) format, enclosed in parenthesis and
      appear after the expression name and before the expression value, e.g.
    <pre>
	expr_1 (Tue Feb  6 19:55:10 2001): 12
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-f</b></dt>
  <dd class="It-tag">If the <b>-l</b> option is specified and there is no
      <b>-a</b> option (ie. real-time monitoring) then <b>pmie</b> is run as a
      daemon in the background (in all other cases foreground is the default).
      The <b>-f</b> option forces <b>pmie</b> to be run in the foreground,
      independent of any other options.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-h</b></dt>
  <dd class="It-tag">By default performance data is fetched from the local host
      (in real-time mode) or the host for the first named set of archives on the
      command line (in archive mode). The <i>host</i> argument overrides this
      default. It does not override hosts explicitly named in the expressions
      being evaluated. The <i>host</i> argument is interpreted as a connection
      specification for <i>pmNewContext</i>, and is later mapped to the remote
      pmcd's self-reported host name for reporting purposes. See also the %h vs.
      %c substitutions in rule action strings below.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-l</b></dt>
  <dd class="It-tag">Standard error is sent to <i>logfile</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-j</b></dt>
  <dd class="It-tag">An alternative STOMP protocol configuration is loaded from
      <i>stompfile</i>. If this option is not used, and the <i>stomp</i> action
      is used in any rule, the default location
      <i>$PCP_SYSCONF_DIR/pmie/config/stomp</i> will be used.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-n</b></dt>
  <dd class="It-tag">An alternative Performance Metrics Name Space (PMNS) is
      loaded from the file <i>pmnsfile</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-q</b></dt>
  <dd class="It-tag">Suppresses diagnostic messages that would be printed to
      standard output by default, especially the &quot;evaluator exiting&quot;
      message as this can confuse scripts.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-t</b></dt>
  <dd class="It-tag">The <i>interval</i> argument follows the syntax described
      in <b>PCPIntro</b>(1), and in the simplest form may be an unsigned integer
      (the implied units in this case are seconds). The value is used to
      determine the sample interval for expressions that do not explicitly set
      their sample interval using the <b>pmie</b> variable delta described
      below. The default is 10.0 seconds.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-U</b> <i>username</i></dt>
  <dd class="It-tag">User account under which to run <b>pmie</b>. The default is
      the current user account for interactive use. When run as a daemon, the
      unprivileged &quot;pcp&quot; account is used in current versions of PCP,
      but in older versions the superuser account (&quot;root&quot;) was used by
      default.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-v</b></dt>
  <dd class="It-tag">Unless one of the verbose options <b>-V</b>, <b>-v</b> or
      <b>-W</b> appears on the command line, expressions are evaluated silently,
      the only output is as a result of any actions being executed. In the
      verbose mode, specified using the <b>-v</b> flag, the value of each
      expression is printed as it is evaluated. The values are in canonical
      units; bytes in the dimension of ``space'', seconds in the dimension of
      ``time'' and events in the dimension of ``count''. See
      <b>pmLookupDesc</b>(3) for details of the supported dimension and scaling
      mechanisms for performance metrics. The verbose mode is useful in
      monitoring the value of given expressions, evaluating derived performance
      metrics, passing these values on to other tools for further processing and
      in debugging new expressions.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-V</b></dt>
  <dd class="It-tag">This option has the same effect as the <b>-v</b> option,
      except that the name of the host and instance (if applicable) are printed
      as well as expression values.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-W</b></dt>
  <dd class="It-tag">This option has the same effect as the <b>-V</b> option
      described above, except that for boolean expressions, only those names and
      values that make the expression true are printed. These are the same names
      and values accessible to rule actions as the %h, %i, %c and %v bindings,
      as described below.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-x</b></dt>
  <dd class="It-tag">Execute in domain agent mode. This mode is used within the
      Performance Co-Pilot product to derive values for summary metrics, see
      <b>pmdasummary</b>(1). Only restricted functionality is available in this
      mode (expressions with actions may <b>not</b> be used).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-Z</b></dt>
  <dd class="It-tag">Change the reporting timezone to <i>timezone</i> in the
      format of the environment variable <b>TZ</b> as described in
      <b>environ</b>(7).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-z</b></dt>
  <dd class="It-tag">Change the reporting timezone to the timezone of the host
      that is the source of the performance metrics, as identified via either
      the <b>-h</b> option or the first named set of archives (as described
      above for the <b>-a</b> option).</dd>
</dl>
<div class="Pp"></div>
The <b>-S</b>, <b>-T</b>, <b>-O</b>, and <b>-A</b> options may be used to define
  a time window to restrict the samples retrieved, set an initial origin within
  the time window, or specify a ``natural'' alignment of the sample times; refer
  to <b>PCPIntro</b>(1) for a complete description of these options.
<div class="Pp"></div>
Output from <b>pmie</b> is directed to standard output and standard error as
  follows:
<dl class="Bl-tag">
  <dt class="It-tag"><b>stdout</b></dt>
  <dd class="It-tag">Expression values printed in the verbose <b>-v</b> mode and
      the output of <b>print</b> actions.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>stderr</b></dt>
  <dd class="It-tag">Error and warning messages for any syntactic or semantic
      problems during expression parsing, and any semantic or performance
      metrics availability problems during expression evaluation.</dd>
</dl>
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
The following example expressions demonstrate some of the capabilities of the
  inference engine.
<div class="Pp"></div>
The directory <i>$PCP_DEMOS_DIR/pmie</i> contains a number of other annotated
  examples of <b>pmie</b> expressions.
<div class="Pp"></div>
The variable delta controls expression evaluation frequency. Specify that
  subsequent expressions be evaluated once a second, until further notice:
<div class="Pp"></div>
<pre>
<br/>
delta = 1 sec;
<br/>
</pre>
<div class="Pp"></div>
If the total context switch rate exceeds 10000 per second per CPU, then display
  an alarm notifier:
<div class="Pp"></div>
<pre>
<br/>
kernel.all.pswitch / hinv.ncpu &gt; 10000 count/sec
-&gt; alarm &quot;high context switch rate %v&quot;;
<br/>
</pre>
<div class="Pp"></div>
If the high context switch rate is sustained for 10 consecutive samples, then
  launch <b>top</b>(1) in an <b>xterm</b>(1) window to monitor processes, but do
  this at most once every 5 minutes:
<div class="Pp"></div>
<pre>
<br/>
all_sample (
    kernel.all.pswitch @0..9 &gt; 10 Kcount/sec * hinv.ncpu
) -&gt; shell 5 min &quot;xterm -e 'top'&quot;;
<br/>
</pre>
<div class="Pp"></div>
The following rules are evaluated once every 20 seconds:
<div class="Pp"></div>
<pre>
<br/>
delta = 20 sec;
<br/>
</pre>
<div class="Pp"></div>
If any disk is performing more than 60 I/Os per second, then print a message
  identifying the busy disk to standard output and launch <b>dkvis</b>(1):
<div class="Pp"></div>
<pre>
<br/>
some_inst (
    disk.dev.total &gt; 60 count/sec
) -&gt; print &quot;busy disks:&quot; &quot; %i&quot; &amp;
     shell 5 min &quot;dkvis&quot;;
<br/>
</pre>
<div class="Pp"></div>
Refine the preceding rule to apply only between the hours of 9am and 5pm, and to
  require 3 of 4 consecutive samples to exceed the threshold before executing
  the action:
<div class="Pp"></div>
<pre>
<br/>
$hour &gt;= 9 &amp;&amp; $hour &lt;= 17 &amp;&amp;
some_inst (
  75 %_sample (
    disk.dev.total @0..3 &gt; 60 count/sec
  )
) -&gt; print &quot;disks busy for 20 sec:&quot; &quot; [%h]%i&quot;;
<br/>
</pre>
<div class="Pp"></div>
The following two rules are evaluated once every 10 minutes:
<div class="Pp"></div>
<pre>
<br/>
delta = 10 min;
<br/>
</pre>
<div class="Pp"></div>
If either the / or the /usr filesystem is more than 95% full, display an alarm
  popup, but not if it has already been displayed during the last 4 hours:
<div class="Pp"></div>
<pre>
<br/>
filesys.free #'/dev/root' /
    filesys.capacity #'/dev/root' &lt; 0.05
-&gt; alarm 4 hour &quot;root filesystem (almost) full&quot;;
<div class="Pp"></div>
filesys.free #'/dev/usr' /
    filesys.capacity #'/dev/usr' &lt; 0.05
-&gt; alarm 4 hour &quot;/usr filesystem (almost) full&quot;;
<br/>
</pre>
<div class="Pp"></div>
The following rule requires a machine that supports the PCP environment metrics.
  If the machine environment temperature rises more than 2 degrees over a 10
  minute interval, write an entry in the system log:
<div class="Pp"></div>
<pre>
<br/>
environ.temp @0 - environ.temp @1 &gt; 2
-&gt; alarm &quot;temperature rising fast&quot; &amp;
   syslog &quot;machine room temperature rise alarm&quot;;
<br/>
</pre>
<div class="Pp"></div>
And something interesting if you have performance problems with your Oracle
  database:
<div class="Pp"></div>
<pre>
<br/>
// back to 30sec evaluations
delta = 30 sec;
sid = &quot;ptg1&quot;;		# $ORACLE_SID setting
lid = &quot;223&quot;;		# latch ID from v$latch
lru = &quot;#'$sid/$lid cache buffers lru chain'&quot;;
host = &quot;:moomba.melbourne.sgi.com&quot;;
gets = &quot;oracle.latch.gets $host $lru&quot;;
total = &quot;oracle.latch.gets $host $lru +
         oracle.latch.misses $host $lru +
         oracle.latch.immisses $host $lru&quot;;
<div class="Pp"></div>
$total &gt; 100 &amp;&amp; $gets / $total &lt; 0.2
-&gt; alarm &quot;high lru latch contention in database $sid&quot;;
<br/>
</pre>
<div class="Pp"></div>
The following <b>ruleset</b> will emit exactly one message depending on the
  availability and value of the 1-minute load average.
<div class="Pp"></div>
<pre>
<br/>
delta = 1 minute;
ruleset
     kernel.all.load #'1 minute' &gt; 10 * hinv.ncpu -&gt;
         print &quot;extreme load average %v&quot;
else kernel.all.load #'1 minute' &gt; 2 * hinv.ncpu -&gt;
         print &quot;moderate load average %v&quot;
unknown -&gt;
         print &quot;load average unavailable&quot;
otherwise -&gt;
         print &quot;load average OK&quot;
;
<br/>
</pre>
<div class="Pp"></div>
The following rule will emit a message when some filesystem is more than 75%
  full and is filling at a rate that if sustained would fill the filesystem to
  100% in less than 30 minutes.
<div class="Pp"></div>
<pre>
<br/>
some_inst (
    100 * filesys.used / filesys.capacity &gt; 75 &amp;&amp;
    filesys.used + 30min * (rate filesys.used) &gt; filesys.capacity
) -&gt; print &quot;filesystem will be full within 30 mins:&quot; &quot; %i&quot;;
<br/>
</pre>
<div class="Pp"></div>
If the metric mypmda.errors counts errors then the following rule will emit a
  message if the rate of errors exceeds 1 per second provided the error count is
  less than 100.
<div class="Pp"></div>
<pre>
<br/>
mypmda.errors &gt; 1 &amp;&amp; instant mypmda.errors &lt; 100
-&gt; print &quot;high error rate: %v&quot;;
<br/>
</pre>
<h1 class="Sh" title="Sh" id="QUICK_START"><a class="selflink" href="#QUICK_START">QUICK
  START</a></h1>
The <b>pmie</b> specification language is powerful and large.
<div class="Pp"></div>
To expedite rapid development of <b>pmie</b> rules, the <b>pmieconf</b>(1) tool
  provides a facility for generating a <b>pmie</b> configuration file from a set
  of generalized <b>pmie</b> rules. The supplied set of rules covers a wide
  range of performance scenarios.
<div class="Pp"></div>
The <i>Performance Co-Pilot User's and Administrator's Guide</i> provides a
  detailed tutorial-style chapter covering <b>pmie</b>.
<h1 class="Sh" title="Sh" id="EXPRESSION_SYNTAX"><a class="selflink" href="#EXPRESSION_SYNTAX">EXPRESSION
  SYNTAX</a></h1>
This description is terse and informal. For a more comprehensive description see
  the <i>Performance Co-Pilot User's and Administrator's Guide</i>.
<div class="Pp"></div>
A <b>pmie</b> specification is a sequence of semicolon terminated expressions.
<div class="Pp"></div>
Basic operators are modeled on the arithmetic, relational and Boolean operators
  of the C programming language. Precedence rules are as expected, although the
  use of parentheses is encouraged to enhance readability and remove ambiguity.
<div class="Pp"></div>
Operands are performance metric names (see <b>pmns</b>(5)) and the normal
  literal constants.
<div class="Pp"></div>
Operands involving performance metrics may produce sets of values, as a result
  of enumeration in the dimensions of <b>hosts</b>, <b>instances</b> and
  <b>time</b>. Special qualifiers may appear after a performance metric name to
  define the enumeration in each dimension. For example,
<div class="Pp"></div>
<br/>
kernel.percpu.cpu.user :foo :bar #cpu0 @0..2
<br/>
<div class="Pp"></div>
defines 6 values corresponding to the time spent executing in user mode on CPU 0
  on the hosts ``foo'' and ``bar'' over the last 3 consecutive samples. The
  default interpretation in the absence of <b>:</b> (host), <b>#</b> (instance)
  and <b>@</b> (time) qualifiers is all instances at the most recent sample time
  for the default source of PCP performance metrics.
<div class="Pp"></div>
Host and instance names that do not follow the rules for variables in
  programming languages, ie. alphabetic optionally followed by alphanumerics,
  should be enclosed in single quotes.
<div class="Pp"></div>
Expression evaluation follows the law of ``least surprises''. Where performance
  metrics have the semantics of a counter, <b>pmie</b> will automatically
  convert to a rate based upon consecutive samples and the time interval between
  these samples. All expressions are evaluated in double precision, and where
  appropriate, automatically scaled into canonical units of ``bytes'',
  ``seconds'' and ``counts''.
<div class="Pp"></div>
A <b>rule</b> is a special form of expression that specifies a condition or
  logical expression, a special operator (<b>-&gt;</b>) and actions to be
  performed when the condition is found to be true.
<div class="Pp"></div>
The following table summarizes the basic <b>pmie</b> operators:
<table class="tbl">
  <colgroup>
    <col style="width: 15.00ex;"/>
    <col style="width: 46.00ex;"/>
  </colgroup>
  <tr>
    <td>Operators</td>
    <td>Explanation</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>+ - * /</td>
    <td>Arithmetic</td>
  </tr>
  <tr>
    <td>&lt; &lt;= == &gt;= &gt; !=</td>
    <td>Relational (value comparison)</td>
  </tr>
  <tr>
    <td>! &amp;&amp; ||</td>
    <td>Boolean</td>
  </tr>
  <tr>
    <td>-&gt;</td>
    <td>Rule</td>
  </tr>
  <tr>
    <td><b>rising</b></td>
    <td>Boolean, false to true transition</td>
  </tr>
  <tr>
    <td><b>falling</b></td>
    <td>Boolean, true to false transition</td>
  </tr>
  <tr>
    <td><b>rate</b></td>
    <td>Explicit rate conversion (rarely required)</td>
  </tr>
  <tr>
    <td><b>instant</b></td>
    <td>No automatic rate conversion (rarely required)</td>
  </tr>
</table>
<div class="Pp"></div>
The <b>rate</b> and <b>instant</b> operators are the logical inverse of one
  another, so an arithmetic expression <i>expr</i> is equal to <b>rate
  instant</b> <i>expr</i>. The more useful cases involve using <b>rate</b> with
  a metric that is not a counter to determine the rate of change over time or
  <b>instant</b> with a metric that is a counter to determine if the current
  value is above or below some threshold.
<div class="Pp"></div>
Aggregate operators may be used to aggregate or summarize along one dimension of
  a set-valued expression. The following aggregate operators map from a logical
  expression to a logical expression of lower dimension.
<table class="tbl">
  <colgroup>
    <col style="width: 58.00ex;"/>
    <col style="width: 11.00ex;"/>
    <col style="width: 84.00ex;"/>
  </colgroup>
  <tr>
    <td>Operators</td>
    <td>Type</td>
    <td>Explanation</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>some_inst some_host some_sample</td>
    <td>Existential</td>
    <td>True if at least one set member is true in the associated dimension</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>all_inst all_host all_sample</td>
    <td>Universal</td>
    <td>True if all set members are true in the associated dimension</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>N<b>%_inst </b>N<b>%_host </b>N<b>%_sample</b></td>
    <td>Percentile</td>
    <td>True if at least <i>N</i> percent of set members are true in the
      associated dimension</td>
  </tr>
</table>
<div class="Pp"></div>
The following instantial operators may be used to filter or limit a set-valued
  logical expression, based on regular expression matching of instance names.
  The logical expression must be a set involving the dimension of instances, and
  the regular expression is of the form used by <b>egrep</b>(1) or the Extended
  Regular Expressions of <b>regcomp</b>(3).
<table class="tbl">
  <colgroup>
    <col style="width: 12.00ex;"/>
    <col style="width: 194.00ex;"/>
  </colgroup>
  <tr>
    <td>Operators</td>
    <td>Explanation</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>match_inst</td>
    <td>For each value of the logical expression that is ``true'', the result is
      ``true'' if the associated instance name matches the regular expression.
      Otherwise the result is ``false''.</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>nomatch_inst</td>
    <td>For each value of the logical expression that is ``true'', the result is
      ``true'' if the associated instance name does <b>not</b> match the regular
      expression. Otherwise the result is ``false''.</td>
  </tr>
</table>
<div class="Pp"></div>
For example, the expression below will be ``true'' for disks attached to
  controllers 2 or 3 performing more than 20 operations per second:
<pre>
<br/>
match_inst &quot;^dks[23]d&quot; disk.dev.total &gt; 20;
<br/>
</pre>
<div class="Pp"></div>
The following aggregate operators map from an arithmetic expression to an
  arithmetic expression of lower dimension.
<table class="tbl">
  <colgroup>
    <col style="width: 28.00ex;"/>
    <col style="width: 9.00ex;"/>
    <col style="width: 64.00ex;"/>
  </colgroup>
  <tr>
    <td>Operators</td>
    <td>Type</td>
    <td>Explanation</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>min_inst min_host min_sample</td>
    <td>Extrema</td>
    <td>Minimum value across all set members in the associated dimension</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>max_inst max_host max_sample</td>
    <td>Extrema</td>
    <td>Maximum value across all set members in the associated dimension</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>sum_inst sum_host sum_sample</td>
    <td>Aggregate</td>
    <td>Sum of values across all set members in the associated dimension</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>avg_inst avg_host avg_sample</td>
    <td>Aggregate</td>
    <td>Average value across all set members in the associated dimension</td>
  </tr>
</table>
<div class="Pp"></div>
The aggregate operators count_inst, count_host and count_sample map from a
  logical expression to an arithmetic expression of lower dimension by counting
  the number of set members for which the expression is true in the associated
  dimension.
<div class="Pp"></div>
For action rules, the following actions are defined:
<table class="tbl">
  <colgroup>
    <col style="width: 9.00ex;"/>
    <col style="width: 44.00ex;"/>
  </colgroup>
  <tr>
    <td>Operators</td>
    <td>Explanation</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>alarm</td>
    <td>Raise a visible alarm with <b>xconfirm</b>(1)</td>
  </tr>
  <tr>
    <td>print</td>
    <td>Display on standard output</td>
  </tr>
  <tr>
    <td>shell</td>
    <td>Execute with <b>sh</b>(1)</td>
  </tr>
  <tr>
    <td>stomp</td>
    <td>Send a STOMP message to a JMS server</td>
  </tr>
  <tr>
    <td>syslog</td>
    <td>Append a message to system log file</td>
  </tr>
</table>
<div class="Pp"></div>
Multiple actions may be separated by the &amp; and | operators to specify
  respectively sequential execution (both actions are executed) and alternate
  execution (the second action will only be executed if the execution of the
  first action returns a non-zero error status.
<div class="Pp"></div>
Arguments to actions are an optional suppression time, and then one or more
  expressions (a string is an expression in this context). Strings appearing as
  arguments to an action may include the following special selectors that will
  be replaced at the time the action is executed.
<dl class="Bl-tag">
  <dt class="It-tag"><b>%h</b></dt>
  <dd class="It-tag">Host name(s) that make the left-most top-level expression
      in the condition true.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>%c</b></dt>
  <dd class="It-tag">Connection specification string(s) or files for a PCP tool
      to reach the hosts or archives that make the left-most top-level
      expression in the condition true.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>%i</b></dt>
  <dd class="It-tag">Instance(s) that make the left-most top-level expression in
      the condition true.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>%v</b></dt>
  <dd class="It-tag">One value from the left-most top-level expression in the
      condition for each host and instance pair that makes the condition
    true.</dd>
</dl>
<div class="Pp"></div>
Note that expansion of the special selectors is done by repeating the whole
  argument once for each unique binding to any of the qualifying special
  selectors. For example if a rule were true for the host <b>mumble</b> with
  instances <b>grunt</b> and <b>snort</b>, and for host <b>fumble</b> the
  instance <b>puff</b> makes the rule true, then the action
<pre>
<br/>
...
-&gt; shell myscript &quot;Warning: %h:%i busy &quot;;
<br/>
</pre>
will execute <b>myscript</b> with the argument string &quot;Warning:
  mumble:grunt busy Warning: mumble:snort busy Warning: fumble:puff busy&quot;.
<div class="Pp"></div>
By comparison, if the action
<pre>
<br/>
...
-&gt; shell myscript &quot;Warning! busy:&quot; &quot; %h:%i&quot;;
<br/>
</pre>
were executed under the same circumstances, then <b>myscript</b> would be
  executed with the argument string &quot;Warning! busy: mumble:grunt
  mumble:snort fumble:puff&quot;.
<div class="Pp"></div>
The semantics of the expansion of the special selectors leads to a common usage
  pattern in an action, where one argument is a constant (contains no special
  selectors) the second argument contains the desired special selectors with
  minimal separator characters, and an optional third argument provides a
  constant postscript (e.g. to terminate any argument quoting from the first
  argument). If necessary post-processing (eg. in <b>myscript</b>) can provide
  the necessary enumeration over each unique expansion of the string containing
  just the special selectors.
<div class="Pp"></div>
For complex conditions, the bindings to these selectors is not obvious. It is
  strongly recommended that <b>pmie</b> be used in the debugging mode (specify
  the <b>-W</b> command line option in particular) during rule development.
<h1 class="Sh" title="Sh" id="BOOLEAN_EXPRESSIONS"><a class="selflink" href="#BOOLEAN_EXPRESSIONS">BOOLEAN
  EXPRESSIONS</a></h1>
<b>pmie</b> expressions that have the semantics of a Boolean, e.g. foo.bar &gt;
  10 or <b>some_inst</b> ( my.table &lt; 0 ) are assigned the values <b>true</b>
  or <b>false</b> or <b>unknown</b>. A value is <b>unknown</b> if one or more of
  the underlying metric values is unavailable, e.g. <b>pmcd</b>(1) on the host
  cannot be contacted, the metric is not in the PCP archive, no values are
  currently available, insufficient values have been fetched to allow a rate
  converted value to be computed or insufficient values have been fetched to
  instantiate the required number of samples in the temporal domain.
<div class="Pp"></div>
Boolean operators follow the normal rules of Kleene logic (aka 3-valued logic)
  when combining values that include <b>unknown</b>:
<table class="tbl">
  <colgroup>
    <col style="width: 15.00ex;"/>
    <col style="width: 15.00ex;"/>
    <col style="width: 15.00ex;"/>
    <col style="width: 13.00ex;"/>
    <col style="width: 15.00ex;"/>
  </colgroup>
  <tr>
    <td>A <b>and</b> B</td>
    <td></td>
    <td>B</td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td>_</td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td><b>true</b></td>
    <td><b>false</b></td>
    <td><b>unknown</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>A</td>
    <td><b>true</b></td>
    <td><b>true</b></td>
    <td><b>false</b></td>
    <td><b>unknown</b></td>
  </tr>
  <tr>
    <td></td>
    <td>_</td>
    <td>_</td>
    <td>_</td>
    <td>_</td>
  </tr>
  <tr>
    <td></td>
    <td><b>false</b></td>
    <td><b>false</b></td>
    <td><b>false</b></td>
    <td><b>false</b></td>
  </tr>
  <tr>
    <td></td>
    <td>_</td>
    <td>_</td>
    <td>_</td>
    <td>_</td>
  </tr>
  <tr>
    <td></td>
    <td><b>unknown</b></td>
    <td><b>unknown</b></td>
    <td><b>false</b></td>
    <td><b>unknown</b></td>
  </tr>
</table>
<table class="tbl">
  <colgroup>
    <col style="width: 14.00ex;"/>
    <col style="width: 15.00ex;"/>
    <col style="width: 12.00ex;"/>
    <col style="width: 15.00ex;"/>
    <col style="width: 15.00ex;"/>
  </colgroup>
  <tr>
    <td>A <b>or</b> B</td>
    <td></td>
    <td>B</td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td>_</td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td><b>true</b></td>
    <td><b>false</b></td>
    <td><b>unknown</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>A</td>
    <td><b>true</b></td>
    <td><b>true</b></td>
    <td><b>true</b></td>
    <td><b>true</b></td>
  </tr>
  <tr>
    <td></td>
    <td>_</td>
    <td>_</td>
    <td>_</td>
    <td>_</td>
  </tr>
  <tr>
    <td></td>
    <td><b>false</b></td>
    <td><b>true</b></td>
    <td><b>false</b></td>
    <td><b>unknown</b></td>
  </tr>
  <tr>
    <td></td>
    <td>_</td>
    <td>_</td>
    <td>_</td>
    <td>_</td>
  </tr>
  <tr>
    <td></td>
    <td><b>unknown</b></td>
    <td><b>true</b></td>
    <td><b>unknown</b></td>
    <td><b>unknown</b></td>
  </tr>
</table>
<table class="tbl">
  <colgroup>
    <col style="width: 15.00ex;"/>
    <col style="width: 15.00ex;"/>
  </colgroup>
  <tr>
    <td>A</td>
    <td><b>not</b> A</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>true</b></td>
    <td><b>false</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>false</b></td>
    <td><b>true</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>unknown</b></td>
    <td><b>unknown</b></td>
  </tr>
</table>
<h1 class="Sh" title="Sh" id="RULESETS"><a class="selflink" href="#RULESETS">RULESETS</a></h1>
The <b>ruleset</b> clause is used to define a set of rules and actions that are
  evaluated in order until some action is executed, at which point the remaining
  rules and actions are skipped until the <b>ruleset</b> is again scheduled for
  evaluation. The keyword <b>else</b> is used to separate rules. After one or
  more regular rules (with a predicate and an action), a <b>ruleset</b> may
  include an optional
<div>&#x00A0;</div>
<b>unknown</b> -&gt; action
<div>&#x00A0;</div>
clause, optionally followed by a
<div>&#x00A0;</div>
<b>otherwise</b> -&gt; action
<div>&#x00A0;</div>
clause.
<div class="Pp"></div>
If all of the predicates in the rules evaluate to <b>unknown</b> and an
  <b>unknown</b> clause has been specified then action associated with the
  <b>unknown</b> clause will be executed.
<div class="Pp"></div>
If no rule predicate is <b>true</b> and the <b>unknown</b> action is either not
  specified or not executed and an <b>otherwise</b> clause has been specified,
  then the action associated with the <b>otherwise</b> clause will be executed.
<h1 class="Sh" title="Sh" id="SCALE_FACTORS"><a class="selflink" href="#SCALE_FACTORS">SCALE
  FACTORS</a></h1>
Scale factors may be appended to arithmetic expressions and force linear scaling
  of the value to canonical units. Simple scale factors are constructed from the
  keywords: <b>nanosecond</b>, <b>nanosec</b>, <b>nsec</b>, <b>microsecond</b>,
  <b>microsec</b>, <b>usec</b>, <b>millisecond</b>, <b>millisec</b>,
  <b>msec</b>, <b>second</b>, <b>sec</b>, <b>minute</b>, <b>min</b>,
  <b>hour</b>, <b>byte</b>, <b>Kbyte</b>, <b>Mbyte</b>, <b>Gbyte</b>,
  <b>Tbyte</b>, <b>count</b>, <b>Kcount</b> and <b>Mcount</b>, and the operator
  /, for example `` <b>Kbytes / hour</b>''.
<h1 class="Sh" title="Sh" id="MACROS"><a class="selflink" href="#MACROS">MACROS</a></h1>
Macros are defined using expressions of the form:
<div class="Pp"></div>
<br/>
<i>name</i> = <i>constexpr</i>;
<br/>
<div class="Pp"></div>
Where <i>name</i> follows the normal rules for variables in programming
  languages, ie. alphabetic optionally followed by alphanumerics.
  <i>constexpr</i> must be a constant expression, either a string (enclosed in
  double quotes) or an arithmetic expression optionally followed by a scale
  factor.
<div class="Pp"></div>
Macros are expanded when their name, prefixed by a dollar ($) appears in an
  expression, and macros may be nested within a <i>constexpr</i> string.
<div class="Pp"></div>
The following reserved macro names are understood.
<dl class="Bl-tag">
  <dt class="It-tag"><b>minute</b></dt>
  <dd class="It-tag">Current minute of the hour.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>hour</b></dt>
  <dd class="It-tag">Current hour of the day, in the range 0 to 23.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>day</b></dt>
  <dd class="It-tag">Current day of the month, in the range 1 to 31.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>month</b></dt>
  <dd class="It-tag">Current month of the year, in the range 0 (January) to 11
      (December).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>year</b></dt>
  <dd class="It-tag">Current year.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>day_of_week</b></dt>
  <dd class="It-tag">Current day of the week, in the range 0 (Sunday) to 6
      (Saturday).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>delta</b></dt>
  <dd class="It-tag">Sample interval in effect for this expression.</dd>
</dl>
<div class="Pp"></div>
Dates and times are presented in the reporting time zone (see description of
  <b>-Z</b> and <b>-z</b> command line options above).
<h1 class="Sh" title="Sh" id="AUTOMATIC_RESTART"><a class="selflink" href="#AUTOMATIC_RESTART">AUTOMATIC
  RESTART</a></h1>
It is often useful for <b>pmie</b> processes to be started and stopped when the
  local host is booted or shutdown, or when they have been detected as no longer
  running (when they have unexpectedly exited for some reason). Refer to
  <b>pmie_check</b>(1) for details on automating this process.
<h1 class="Sh" title="Sh" id="EVENT_MONITORING"><a class="selflink" href="#EVENT_MONITORING">EVENT
  MONITORING</a></h1>
It is common for production systems to be monitored in a central location.
  Traditionally on UNIX systems this has been performed by the system log
  facilities - see <b>logger</b>(1), and <b>syslogd</b>(1). On Windows,
  communication with the system event log is handled by <b>pcp-eventlog</b>(1).
<div class="Pp"></div>
<b>pmie</b> fits into this model when rules use the <i>syslog</i> action. Note
  that if the action string begins with -p (priority) and/or -t (tag) then these
  are extracted from the string and treated in the same way as in
  <b>logger</b>(1) and <b>pcp-eventlog</b>(1).
<div class="Pp"></div>
However, it is common to have other event monitoring frameworks also, into which
  you may wish to incorporate performance events from <b>pmie</b>. You can often
  use the <i>shell</i> action to send events to these frameworks, as they
  usually provide their a program for injecting events into the framework from
  external sources.
<div class="Pp"></div>
A final option is use of the <i>stomp</i> (Streaming Text Oriented Messaging
  Protocol) action, which allows <b>pmie</b> to connect to a central JMS (Java
  Messaging System) server and send events to the PMIE topic. Tools can be
  written to extract these text messages and present them to operations people
  (via desktop popup windows, etc). Use of the <i>stomp</i> action requires a
  stomp configuration file to be setup, which specifies the location of the JMS
  server host, port number, and username/password.
<div class="Pp"></div>
The format of this file is as follows:
<div class="Pp"></div>
<pre>
<br/>
host=messages.sgi.com   # this is the JMS server (required)
port=61616              # and its listening here (required)
timeout=2               # seconds to wait for server (optional)
username=joe            # (required)
password=j03ST0MP       # (required)
topic=PMIE              # JMS topic for pmie messages (optional)
<br/>
</pre>
<div class="Pp"></div>
The timeout value specifies the time (in seconds) that <b>pmie</b> should wait
  for acknowledgements from the JMS server after sending a message (as required
  by the STOMP protocol). Note that on startup, <b>pmie</b> will wait
  indefinitely for a connection, and will not begin rule evaluation until that
  initial connection has been established. Should the connection to the JMS
  server be lost at any time while <b>pmie</b> is running, <b>pmie</b> will
  attempt to reconnect on each subsequent truthful evaluation of a rule with a
  <i>stomp</i> action, but not more than once per minute. This is to avoid
  contributing to network congestion. In this situation, where the STOMP
  connection to the JMS server has been severed, the <i>stomp</i> action will
  return a non-zero error value.
<h1 class="Sh" title="Sh" id="FILES"><a class="selflink" href="#FILES">FILES</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>$PCP_DEMOS_DIR/pmie/</b><i>*</i></dt>
  <dd class="It-tag">annotated example rules</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>$PCP_VAR_DIR/pmns/</b><i>*</i></dt>
  <dd class="It-tag">default PMNS specification files</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>$PCP_TMP_DIR/pmie</b></dt>
  <dd class="It-tag"><b>pmie</b> maintains files in this directory to identify
      the running <b>pmie</b> instances and to export runtime information about
      each instance - this data forms the basis of the pmcd.pmie performance
      metrics</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>$PCP_PMIECONTROL_PATH</b></dt>
  <dd class="It-tag">the default set of <b>pmie</b> instances to start at boot
      time - refer to <b>pmie_check</b>(1) for details</dd>
</dl>
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
The lexical scanner and parser will attempt to recover after an error in the
  input expressions. Parsing resumes after skipping input up to the next
  semi-colon (;), however during this skipping process the scanner is ignorant
  of comments and strings, so an embedded semi-colon may cause parsing to resume
  at an unexpected place. This behavior is largely benign, as until the initial
  syntax error is corrected, <b>pmie</b> will not attempt any expression
  evaluation.
<h1 class="Sh" title="Sh" id="PCP_ENVIRONMENT"><a class="selflink" href="#PCP_ENVIRONMENT">PCP
  ENVIRONMENT</a></h1>
Environment variables with the prefix <b>PCP_</b> are used to parameterize the
  file and directory names used by PCP. On each installation, the file
  <i>/etc/pcp.conf</i> contains the local values for these variables. The
  <b>$PCP_CONF</b> variable may be used to specify an alternative configuration
  file, as described in <b>pcp.conf</b>(5).
<div class="Pp"></div>
When executing shell actions, <b>pmie</b> overrides two variables - IFS and PATH
  - in the environment of the child process. IFS is set to &quot;\t\n&quot;. The
  PATH is set to a combination of a default path for all platforms
  (&quot;/usr/sbin:/sbin:/usr/bin:/usr/sbin&quot;) and several configurable
  components. These are (in this order): <b>$PCP_BIN_DIR</b>,
  <b>$PCP_BINADM_DIR</b> and <b>$PCP_PLATFORM_PATHS</b>.
<div class="Pp"></div>
When executing popup alarm actions, <b>pmie</b> will use the value of
  <b>$PCP_XCONFIRM_PROG</b> as the visual notification program to run. This is
  typically set to <b>pmconfirm</b>(1), a cross-platform dialog box.
<h1 class="Sh" title="Sh" id="UNIX_SEE_ALSO"><a class="selflink" href="#UNIX_SEE_ALSO">UNIX
  SEE ALSO</a></h1>
<b>logger</b>(1).
<h1 class="Sh" title="Sh" id="WINDOWS_SEE_ALSO"><a class="selflink" href="#WINDOWS_SEE_ALSO">WINDOWS
  SEE ALSO</a></h1>
<b>pcp-eventlog</b>(1).
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>PCPIntro</b>(1), <b>pmcd</b>(1), <b>pmconfirm</b>(1), <b>pmdumplog</b>(1),
  <b>pmieconf</b>(1), <b>pmie_check</b>(1), <b>pminfo</b>(1),
  <b>pmlogger</b>(1), <b>pmval</b>(1), <b>PMAPI</b>(3), <b>pcp.conf</b>(5) and
  <b>pcp.env</b>(5).
<h1 class="Sh" title="Sh" id="USER_GUIDE"><a class="selflink" href="#USER_GUIDE">USER
  GUIDE</a></h1>
For a more complete description of the <b>pmie</b> language, refer to the
  <b>Performance Co-Pilot Users and Administrators Guide</b>. This is available
  online from:
<br/>
<pre>
http://www.pcp.io/doc/pcp-users-and-administrators-guide.pdf
</pre>
<br/>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">PCP</td>
    <td class="foot-os">Performance Co-Pilot</td>
  </tr>
</table>
</body>
</html>
