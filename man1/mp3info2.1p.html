<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>MP3INFO2(1p)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">MP3INFO2(1p)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">MP3INFO2(1p)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
mp3info2 - get/set MP3 tags; uses MP3::Tag to get default values.
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>
  # Print the information in tags and autodeduced info
  mp3info2 *.mp3
  # In addition, set the year field to 1981
  mp3info2 -y 1981 *.mp3
  # Same without printout of info, recursively in the current directory
  mp3info2 -R -p &quot;&quot; -y 1981 .
  # Do not deduce any field, print (normalized) info from the tags only
  mp3info2 -C autoinfo=ID3v2,ID3v1 *.mp3
  # As above, but without normalization/autofill, the raw information in tags
  mp3info2 -N *.mp3
  # As above, but only with ID2v1 tag read
  mp3info2 -NC autoinfo=ID3v1 *.mp3
  # Get artist from CDDB_File, autodeduce other info, write it to tags
  mp3info2 -C artist=CDDB_File -u *.mp3
  # For title, prefer information from .inf file; autodeduce rest, update
  mp3info2 -C title=Inf,ID3v2,ID3v1,filename -u *.mp3
  # Same, and get the artist from CDDB file
  mp3info2 -C title=Inf,ID3v2,ID3v1,filename -C artist=CDDB_File -u *.mp3
  # Write a script for conversion of .wav to .mp3, autodeducing tags
  mp3info2 -p &quot;lame -h --vbr-new --tt '%t' --tn %n --ta '%a' --tc '%c' --tl '%l' --ty '%y' '%f'\n&quot; *.wav &gt;xxx.sh
</pre>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
The program prints a message summarizing tag info (obtained via MP3::Tag module)
  for specified files.
<div class="Pp"></div>
It may also update the information in ID3 tags. This happens in three different
  cases.
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">If the information supplied in command-line options &quot;t
      a l y g c n&quot; differs from the content of the corresponding ID3 tags
      (or there is no corresponding ID3 tags).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">If options &quot;-d&quot; or &quot;-F&quot; were
    given.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">if &quot;MP3::Tag&quot; obtains the info from other means
      than MP3 tags, and &quot;-u&quot; forces the update of the ID3 tags.</dd>
</dl>
<div class="Pp"></div>
(All these ways are disabled by &quot;-D&quot; option.) ID3v2 tag is written if
  needed, or if &quot;-2&quot; option is given. (Automatic fill-in of deduceable
  fields (via the method <i>id3v2_frames_autofill()</i>) is performed unless
  &quot;-d&quot; or &quot;-N&quot; options are given.)
<div class="Pp"></div>
The option &quot;-u&quot; writes (&quot;u&quot;pdates) the fetched information
  to the MP3 ID3 tags. This option is assumed if there are command-line options
  which explicitly set tag elements (&quot;-a&quot;, &quot;-t&quot; etc., and
  &quot;-F&quot;, &quot;-d&quot;). (Effects of this option may be overridden by
  giving &quot;-D&quot; option.) If &quot;-2&quot; option is also given, forces
  write of ID3v2 tag even if the info fits the ID3v1 tag (in addition, this
  option enables auto-update of &quot;personal name&quot; fields, and
  corresponding titles according to values of &quot;translate_person&quot;,
  &quot;person_frames&quot; etc. configuration settings; see &quot;Normalization
  of fields&quot;). This option is ignored if no change to tags is detected;
  however, one can force an update by repeating this option (useful if you
  expect the change the &quot;format&quot; of the tag, as opposed to its
  &quot;content&quot;).
<div class="Pp"></div>
The option &quot;-p&quot; prints a message using the next argument as format (by
  default &quot;\\&quot;, &quot;\t&quot;, &quot;\n&quot; are replaced by
  backslash, tab and newline; governed by the value of &quot;-E&quot; option);
  see &quot;interpolate&quot; in MP3::Tag for details of the format of
  <i>sprintf()</i>-like escapes. If no option &quot;-p&quot; is given, message
  in default format will be emitted. The value of option &quot;-e&quot; is the
  encoding used for the output; if the value is a number, system-specific
  encoding is guessed (and used for the output if bit 0x1 is set); if bit 0x2 is
  set, then, command line options are assumed to be in the guessed encoding; if
  bit 0x4 is set, then, command line arguments are assumed to be in the guessed
  encoding. Use the value &quot;binary&quot; to do binary output.
<div class="Pp"></div>
With option &quot;-D&quot; (dry run) no update is performed, no matter what the
  other options are. With this option, no parsing of tags is performed unless
  needed.
<div class="Pp"></div>
Use options
<div class="Pp"></div>
<pre>
  t a l y g c n
</pre>
<div class="Pp"></div>
to overwrite the information (title artist album year genre comment
  track-number) obtained via &quot;MP3::Tag&quot; heuristics (&quot;-u&quot;
  switch is implied if any one of these arguments differs from what would be
  found otherwise; use &quot;-D&quot; switch to disable auto-update). By
  default, the values of these options are not &quot;%&quot;-interpolated; this
  may be changed by &quot;-E&quot; option.
<div class="Pp"></div>
The option &quot;-d&quot; should contain the comma-separated list of ID3v2
  frames to delete. A frame specification is the same as what might be given to
  &quot;%{...}&quot; frame interpolation command, e.g., &quot;TIT3&quot;,
  &quot;COMM03&quot;, &quot;COMM(fra)[short title]&quot;; the difference with
  modify-access is that <b>ALL</b> (and not the <b>first</b> of) matching frames
  are deleted. (Option -d may be repeated.)
<div class="Pp"></div>
For example, &quot;-d APIC&quot; would remove all picture frames. In addition,
  if the list contains &quot;ID3v1&quot; or &quot;ID3v2&quot;, whole tags will
  be deleted.
<div class="Pp"></div>
Likewise, the option &quot;-F&quot; allows setting of arbitrary
  &quot;ID3v2&quot; frames: if one needs to set one frame, use the directive
  &quot;FRAME_spec=VALUE&quot;:
<div class="Pp"></div>
<pre>
  -F TIT2=The_new_Title
</pre>
<div class="Pp"></div>
Again, on modify, <b>ALL</b> matching frames are deleted first, so be carefull
  with
<div class="Pp"></div>
<pre>
  -F COMM=MyComment
</pre>
<div class="Pp"></div>
Option &quot;-F&quot; may be repeated to set more than one frame. If
  configuration variable &quot;empty-F-deletes&quot; is TRUE (default), empty
  arguments will delete the frame.
<div class="Pp"></div>
One can replace &quot;FRAME_spec=VALUE&quot; by &quot;FRAME_spec &lt;
  FILE&quot;; in this case the value to set is read from the file named
  <i>FILE</i>; if the frame is text-only (meaning: at most &quot;[encoded]Text
  URL Language Description&quot; fields are present), the file is read in text
  mode (and with starting/trailing whitespace stripped), otherwise it is read in
  binary mode. (Whitespace is required about the &quot;&lt;&quot; signs.) If
  &quot;&lt;&quot; is replaced by &quot;?&lt;&quot;, the value is set only if
  frame is not yet present, and if the file exists; if replaced by
  &quot;&gt;&quot;, the value (if present) is written to <i>FILE</i> (creation
  of intermediate directories is controlled by configuration option
  &quot;frames_write_creates_dirs&quot;, the default is FALSE).
<div class="Pp"></div>
Additionally, &quot;FRAME_spec&quot; may be one of &quot;ID3v1&quot; or
  &quot;ID3v2&quot; or &quot;TAGS&quot;; in this case, whole tags are written or
  read. For example, for &quot;TAGS &lt; FILE&quot;, &quot;title artist album
  year genre comment track&quot; info is calculated from <i>FILE</i>, which may
  be raw tags, as produced with &quot;&gt;&quot;, or a valid MP3 file; if
  Image::ExifTool is present, the data may be read from arbitrary multimedia
  file. (Likewise, for &quot;ID3v1 &lt; FILE&quot;, the same info is extracted
  from &quot;ID3v1&quot; tag only.) After this, in case of &quot;ID3v2&quot; or
  &quot;TAGS&quot;, &quot;ID3v2&quot; frames are copied from the
  &quot;ID3v2&quot; tag one-by-one. (With suitable modifications for
  &quot;?&lt;&quot;.)
<div class="Pp"></div>
By default, the &quot;VALUE&quot; for &quot;-F&quot; is
  &quot;%&quot;-interpolated; this can be changed by option &quot;-E&quot;. For
  user convenience, human-friendlier forms &quot;composer, text_by, orchestra,
  conductor, disk_n&quot; can be used instead of &quot;TCOM, TEXT, TPE2, TPE3,
  TPOS&quot;.
<div class="Pp"></div>
The option &quot;-P RECIPE&quot; is a very powerful generalization of what can
  be done by options &quot;-F&quot;, &quot;-d&quot;, and &quot;-t -a -l -y -g -c
  -n&quot;. It may be repeated; the values should contain the parse recipes.
  They become the configuration item &quot;parse_data&quot; of
  &quot;MP3::Tag&quot;; eventually this information is processed by
  MP3::Tag::ParseData module (if the latter is present in the chain of
  heuristics; see option &quot;-C&quot;). The &quot;RECIPE&quot; is split into
  &quot;$flags, $string, @patterns&quot; on its first non-alphanumeric
  character; the first of @patterns which matches $string is going to be
  executed (for side effects). (See examples: &quot;EXAMPLES: parse
  rules&quot;.)
<div class="Pp"></div>
If option &quot;-G&quot; is specified, the file names on the command line are
  considered as glob patterns. This may be useful if the maximal command-line
  length is too low. With the option &quot;-R&quot; arguments can be
  directories, which are searched recursively for audio (default <i>*.mp3</i>)
  files to process; use option &quot;-r&quot; to reset the regular expression to
  look for (the default is &quot;(?i:\.mp3$)&quot;).
<div class="Pp"></div>
The option &quot;-E&quot; controls expansion of escape characters. It should
  contain the letters of the command-line options where &quot;\\, \n, \t&quot;
  are interpolated; one can append the letters of &quot;t a l y g c n F&quot;
  options requiring &quot;%&quot;-interpolation after the separator
  &quot;/i:&quot; (for &quot;-F&quot;, only the values are interpolated). The
  default value is &quot;p/i:Fp&quot;: only &quot;-p&quot; is
  &quot;\&quot;-interpolated, and only &quot;-F&quot; and &quot;-p&quot; are
  subject to &quot;%&quot;-interpolation. If all one wants is to <i>add</i> to
  the defaults, preceed the value of &quot;-E&quot; (containing added options)
  by &quot;+&quot;. (Some parts of the value of option &quot;-P&quot; are
  interpolated, but this should be governed by flags, not &quot;-E&quot;; do
  <i>NOT</i> put &quot;P&quot; into the &quot;%&quot;-interpolated part of
  &quot;-E&quot;.)
<div class="Pp"></div>
If the option &quot;-@&quot; is given, all characters &quot;@&quot; in the
  options are replaced by &quot;%&quot;. This may be convenient if the shell
  treats &quot;%&quot; specially (e.g., DOSISH shells).
<div class="Pp"></div>
If option &quot;-I&quot; is given, no guessworking for <i>artist</i> field is
  performed on typeout.
<div class="Pp"></div>
The option &quot;-C CONFIG_OPT=VALUE1,VALUE2...&quot; sets &quot;MP3::Tag&quot;
  configuration data the same way as &quot;MP3::Tag-&quot; <i>config()</i>&gt;
  would do (recall that the value is an array; separate elements by commas if
  more than one). The option may be repeated to set more than one value. Note
  that since &quot;ParseData&quot; is used to process &quot;-P&quot; parse
  recipes, it should be better be kept in the &quot;autoinfo&quot; configuration
  (and related fields &quot;author&quot; etc) in presence of &quot;-P&quot;.
<div class="Pp"></div>
If the option &quot;-x&quot; is given, the technical information about the audio
  file is printed (MP3 level, duration, number of frames, padding, copyright,
  and the list of ID3v2 frame names in format suitable to &quot;%{...}&quot;
  escapes). If &quot;-x&quot; is repeated, content of frames is also printed out
  (may output non-printable chars, if it is repeated more than twice).
<div class="Pp"></div>
If option &quot;-N&quot; is given, all the &quot;smarts&quot; are disabled - no
  normalization of fields happens, and (by default) no attempt to deduce the
  values of fields from non-ID3 information is done. This option is (currently)
  equivalent to having &quot;-C autoinfo=ParseData,ID3v2,ID3v1&quot; as the
  first directive, to having no <i>Normalize::Text::Music_Fields.pm</i> present
  on @INC path, and not calling <i>autofill()</i> method.
<h1 class="Sh" title="Sh" id="Normalization_of_fields"><a class="selflink" href="#Normalization_of_fields">Normalization
  of fields</a></h1>
(The loading of normalization module and all subsequent operations may be
  disabled by the option &quot;-N&quot;, or by setting the environment variable
  &quot;MP3TAG_NORMALIZE_FIELDS&quot; to be FALSE. If not prohibited, the module
  is attempted to be loaded if directory <i>~/.music_fields</i> is present, or
  &quot;MP3TAG_NORMALIZE_FIELDS&quot; is set and TRUE.)
<div class="Pp"></div>
If loading of the module &quot;Normalize::Text::Music_Fields&quot; is
  successful, the following is applicable:
<div class="Pp"></div>
If the value of &quot;MP3TAG_NORMALIZE_FIELDS&quot; is defined and not 1, this
  value is broken into directories as a PATH, and load path of
  &quot;Normalize::Text::Music_Fields&quot; is set to be this list of
  directories. Then MP3::Tag is instructed (via corresponding configuration
  settings) to use &quot;normalize_artist&quot; (etc.) methods defined by this
  module. These methods may normalize certain tag data. The current version
  defines methods for &quot;normalization&quot; of personal names, and titles
  (based on the composer). This normalization is driven through user-editable
  configuration tables.
<div class="Pp"></div>
In addition to automatical normalization of MP3 tag data, one can use &quot;fake
  MP3 files&quot; to manually access some features of this module. For this, use
  an empty file name, and &quot;-D&quot; option. E.g,
<div class="Pp"></div>
<pre>
  mp3info2 -D -a beethoven                       -p &quot;%a\n&quot;         &quot;&quot;
  mp3info2 -D -a beethoven                       -p &quot;%{shP[%a]}\n&quot; &quot;&quot;
  mp3info2 -D -a beethoven -t &quot;sonata #28&quot;       -p &quot;%t\n&quot;         &quot;&quot;
  mp3info2 -D -a beethoven -t &quot;allegretto, Bes&quot; -@p &quot;@t\n&quot;         &quot;&quot;
  mp3info2 -D -a beethoven -t &quot;op93&quot;            -@p &quot;@t\n&quot;         &quot;&quot;
</pre>
<div class="Pp"></div>
will print the normalized person-name for &quot;beethoven&quot;, the
  corresponding normalized short person-name, and the normalized title for
  &quot;sonata #28&quot; of composer &quot;beethoven&quot;. E.g., with the
  shipped normalization tables, it will print
<div class="Pp"></div>
<pre>
  Ludwig van Beethoven (1770-1827)
  L. van Beethoven
  Piano Sonata No. 28 in A major; Op. 101 (1816)
  Allegretto for Piano Trio in B flat major; WoO 39 (1812)
  Symphony No. 8 in F major; Op. 93 (comp. 1812, f.p. Vienna, 1814-02-27, cond. Beethoven; pubd. 1816)
</pre>
<h1 class="Sh" title="Sh" id="The_order_of_operation"><a class="selflink" href="#The_order_of_operation">The
  order of operation</a></h1>
Currently, the operations are done in the following order
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Deletion of ID3v1 or ID3v2 as a whole via &quot;-d&quot;
      option;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Recipies of &quot;-P&quot; option are set up (to be
      triggered by interpolation);</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The setting done via &quot;-a/-t/-l/-y/-g/-c/-n&quot;
      options;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">The settings done via &quot;-F&quot; option;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Deletion of individual frames via &quot;-d&quot;
    option;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">autofill of ID3v2 (id) frames;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Emit info based on &quot;-p&quot; and &quot;-x&quot;
      options;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Trigger recipies of &quot;-P&quot; (if not triggered by
      interpolation);</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Update tags if needed.</dd>
</dl>
<h1 class="Sh" title="Sh" id="Usage_strategy:_escalation_of_complexity"><a class="selflink" href="#Usage_strategy:_escalation_of_complexity">Usage
  strategy: escalation of complexity</a></h1>
The purpose of this script is to to make handling of ID3 tags as simple <i>as
  possible</i>.
<div class="Pp"></div>
On one end of the scale, one can perform arbitrarily complex manipulations with
  tags using &quot;MP3::Tag&quot; Perl module.
<div class="Pp"></div>
On the other end, it is much more convenient to handle simplest manipulations
  with tags using this script's options &quot;-t -a -l -y -g -c -n&quot; and
  &quot;-p -F -d&quot;. For slightly more complicated tasks, one may need to use
  the more elaborate method of <i>parse rules</i>, provided to this script by
  the option &quot;-P&quot;; the rules depend heavily on <i>interpolation</i>,
  see &quot;interpolate&quot; in MP3::Tag, &quot;interpolate_with_flags&quot; in
  MP3::Tag.
<div class="Pp"></div>
To simplify upgrade from &quot;simplest manipulations&quot; to &quot;more
  elaborate ones&quot;, here we provide &quot;parse rule&quot; <i>synonyms</i>
  to the simplest options. So if you start with &quot;-t -a -l -y -g -c -n&quot;
  and &quot;-p -F -d&quot; options which &quot;almost work&quot; for you, you
  have a good chance to be able to fully achieve your aim by modifying the
  synonyms described below.
<div class="Pp"></div>
(Below we assume that &quot;-E&quot; option is set to its default value, so
  &quot;-F -p&quot; are &quot;%&quot;-interpolated, other options are not. Note
  also that if your TTY's encoding is recognized by Perl, it is highly
  recommended to set &quot;-e 3&quot; option; on DOSISH shells, better use
  &quot;-@&quot;, and replace &quot;%&quot;'s by &quot;@&quot;'s below.)
<dl class="Bl-tag">
  <dt class="It-tag">&quot;-t VALUE&quot;</dt>
  <dd class="It-tag">
    <pre>
  -P &quot;mz/VALUE/%t&quot;
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;-a -l -y -g -c -n&quot;</dt>
  <dd class="It-tag">Likewise.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;-F&quot; &quot;TIT2=VALUE&quot;</dt>
  <dd class="It-tag">
    <pre>
  -P &quot;mzi/VALUE/%{TIT2}&quot;
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;-F&quot; &quot;APIC[myDescr] &lt; FILE&quot;</dt>
  <dd class="It-tag">
    <pre>
  -F &quot;APIC[myDescr]=%{I(fimbB)FILE}&quot;
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    or
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  -P &quot;mzi/%{I(fimbB)FILE}/%{APIC[myDescr]}&quot;
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    (remove &quot;bB&quot; for text-only frames).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;-F&quot; &quot;APIC[myDescr] &gt; FILE&quot;</dt>
  <dd class="It-tag">
    <pre>
  -P &quot;bOi,%{APIC[myDescr]},FILE&quot;
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    (remove &quot;b&quot; for text-only frames); or use &quot;-e binary -p
      &quot;%{APIC[myDescr]}&quot;&quot; with redirection, see &quot;EXAMPLES:
      parse rules&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;-d&quot; TIT2</dt>
  <dd class="It-tag">
    <pre>
  -P &quot;m//%{TIT2}&quot;
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&quot;-F&quot; &quot;TIT2 ?&lt; FILE&quot;</dt>
  <dd class="It-tag">Very tricky. This won't set distinguish empty file and
      non-existing one:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  -P &quot;mzi/%{TIT2:1}0%{I(fFim)FILE}/10/10%{TIT2}/0%{U1}&quot;
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    (add &quot;bB&quot; to &quot;fFim&quot; for non-text-only frames); the last
      part may be omitted if one omits the flag &quot;m&quot; - it is present to
      catch misprints only.</dd>
</dl>
<div class="Pp"></div>
For details on &quot;parse rules&quot;, see &quot;EXAMPLES: parse rules&quot;
  and &quot;DESCRIPTION&quot; in MP3::Tag::ParseData.
<h1 class="Sh" title="Sh" id="EXAMPLES:_parse_rules"><a class="selflink" href="#EXAMPLES:_parse_rules">EXAMPLES:
  parse rules</a></h1>
Only the &quot;-P&quot; option is complicated enough to deserve comments... For
  full details on <i>parse rules</i>, see &quot;DESCRIPTION&quot; in
  MP3::Tag::ParseData; for full details on interpolation, see
  &quot;interpolate&quot; in MP3::Tag, &quot;interpolate_with_flags&quot; in
  MP3::Tag.
<div class="Pp"></div>
For a (silly) example, one can replace &quot;-a Homer -t Iliad&quot; by
<div class="Pp"></div>
<pre>
  -P mz=Homer=%a -P mz=Iliad=%t
</pre>
<div class="Pp"></div>
A less silly example is forcing a particular way of parsing a file name via
<div class="Pp"></div>
<pre>
  -P &quot;im=%{d0}/%f=%a/%n %t.%e&quot;
</pre>
<div class="Pp"></div>
It is broken into
<div class="Pp"></div>
<pre>
 flags          string          pattern1
 &quot;im&quot;           &quot;%{d0}/%f&quot;      &quot;%a/%n %t.%e&quot;
</pre>
<div class="Pp"></div>
The flag letters stand for <i>interpolate</i>, <i>must_match</i>. This
  interpolates the string &quot;%{d0}/%f&quot; and parses the result (which is
  the file name with one level of the directory part preserved) using the given
  pattern; thus the directory name becomes the artist, the leading numeric part
  - the track number, and the rest of the file name (without extension) - the
  title. Note that since multiple patterns are allowed, one can similarly allow
  for multiple formats of the names, e.g.
<div class="Pp"></div>
<pre>
  -P &quot;im=%{d0}/%f=%a/%n %t.%e=%a/%t (%y).%e&quot;
</pre>
<div class="Pp"></div>
allows for the file basename to be also of the form &quot;TITLE (YEAR)&quot;. An
  alternative way to obtain the same results is
<div class="Pp"></div>
<pre>
  -P &quot;im=%{d0}=%a&quot; -P &quot;im=%f=%n %t.%e=%t (%y).%e&quot;
</pre>
<div class="Pp"></div>
which corresponds to two recipies:
<div class="Pp"></div>
<pre>
 flags          string          pattern1        pattern2
 &quot;im&quot;           &quot;%{d0}&quot;         &quot;%a&quot;
 &quot;im&quot;           &quot;%f&quot;            &quot;%n %t.%e&quot;      &quot;%t (%y).%e&quot;
</pre>
<div class="Pp"></div>
Of course, one could use
<div class="Pp"></div>
<pre>
 &quot;im&quot;           &quot;%B&quot;            &quot;%n %t&quot;         &quot;%t (%y)&quot;
</pre>
<div class="Pp"></div>
as a replacement for the second one.
<div class="Pp"></div>
Note that it may be more readable to set <i>artist</i> to &quot;%{d0}&quot; by
  an explicit asignment, with arguments similar to
<div class="Pp"></div>
<pre>
  -E &quot;p/i:Fpa&quot; -a &quot;%{d0}&quot;
</pre>
<div class="Pp"></div>
(this value of &quot;-E&quot; requests &quot;%&quot;-interpolation of the option
  &quot;-a&quot; in addition to the default &quot;\&quot;-interpolation of
  &quot;-p&quot;, and &quot;%&quot;-interpolation of &quot;-F&quot; and
  &quot;-p&quot;; one can shortcut it with &quot;-E +/i:a&quot;).
<div class="Pp"></div>
To give more examples,
<div class="Pp"></div>
<pre>
  -P &quot;if=%D/.comment=%c&quot;
</pre>
<div class="Pp"></div>
will read comment from the file <i>.comment</i> in the directory of the audio
  file;
<div class="Pp"></div>
<pre>
  -P &quot;ifn=%D/.comment=%c&quot;
</pre>
<div class="Pp"></div>
has similar effect if the file <i>.comment</i> has one-line comments, one per
  track (this assumes the the track number can be found by other means).
<div class="Pp"></div>
Suppose that a file <i>Parts</i> in a directory of MP3 files has the following
  format: it has a preamble, then has a short paragraph of information per audio
  file, preceded by the track number and dot:
<div class="Pp"></div>
<pre>
   ...
   12. Rezitativ.
   (Pizarro, Rocco)
   13. Duett: jetzt, Alter, jetzt hat es Eile, (Pizarro, Rocco)
   ...
</pre>
<div class="Pp"></div>
The following command puts this info into the title of the ID3 tag (provided the
  audio file names are informative enough so that MP3::Tag can deduce the track
  number):
<div class="Pp"></div>
<pre>
 mp3info2 -u -C parse_split='\n(?=\d+\.)' -P 'fl;Parts;%=n. %t'
</pre>
<div class="Pp"></div>
If this paragraph of information has the form &quot;TITLE (COMMENT)&quot; with
  the &quot;COMMENT&quot; part being optional, then use
<div class="Pp"></div>
<pre>
 mp3info2 -u -C parse_split='\n(?=\d+\.)' -P 'fl;Parts;%=n. %t (%c);%=n. %t'
</pre>
<div class="Pp"></div>
If you want to remove a dot or a comma got into the end of the title, use
<div class="Pp"></div>
<pre>
 mp3info2 -u -C parse_split='\n(?=\d+\.)' \
   -P 'fl;Parts;%=n. %t (%c);%=n. %t' -P 'iR;%t;%t[.,]$'
</pre>
<div class="Pp"></div>
The second pattern of this invocation is converted to
<div class="Pp"></div>
<pre>
  ['iR', '%t' =&gt; '%t[.,]$']
</pre>
<div class="Pp"></div>
which essentially applies the substitution &quot;s/(.*)[.,]$/$1/s&quot; to the
  title.
<div class="Pp"></div>
Now suppose that in addition to <i>Parts</i>, we have a text file <i>Comment</i>
  with additional info; we want to put this info into the comment field
  <i>after</i> what is extracted from &quot;TITLE (COMMENT)&quot;; separate
  these two parts of the comment by an empty line:
<div class="Pp"></div>
<pre>
 mp3info2 -E C -C 'parse_split=\n(?=\d+\.)' -C 'parse_join=\n\n' \
  -P 'f;Comment;%c'           -P 'fl;Parts;%=n. %t'              \
  -P 'i;%t///%c;%t (%c)///%c' -P 'iR;%t;%t[.,]$'
</pre>
<div class="Pp"></div>
This assumes that the title and the comment do not contain '///' as a substring.
  Explanation: the first pattern of &quot;-P&quot;,
<div class="Pp"></div>
<pre>
  ['f', 'Comment' =&gt; '%c'],
</pre>
<div class="Pp"></div>
reads comment from the file &quot;Comment&quot; into the comment field; the
  second,
<div class="Pp"></div>
<pre>
  ['fl', 'Parts'  =&gt; '%=n. %t'],
</pre>
<div class="Pp"></div>
reads a chunk of &quot;Parts&quot; into the title field. The third one
<div class="Pp"></div>
<pre>
  ['i', '%t///%c' =&gt; '%t (%c)///%c']
</pre>
<div class="Pp"></div>
rearranges the title and comment <i>provided</i> the title is of the form
  &quot;TITLE (COMMENT)&quot;. (The configuration option &quot;parse_join&quot;
  takes care of separating two chunks of comment corresponding to two occurences
  of %c on the right hand side.)
<div class="Pp"></div>
Finally, the fourth pattern is the same as in the preceding example; it removes
  spurious punctuation at the end of the title.
<div class="Pp"></div>
More examples: removing string &quot;with violin&quot; from the start of the
  comment field (removing comment altogether if nothing remains):
<div class="Pp"></div>
<pre>
  mp3info2 -u -P 'iz;%c;with violin%c' *.mp3
</pre>
<div class="Pp"></div>
setting the artist field without letting auto-update feature deduce other fields
  from other sources;
<div class="Pp"></div>
<pre>
  mp3info2 -C autoinfo=ParseData -a &quot;A. U. Thor&quot; *.mp3
</pre>
<div class="Pp"></div>
setting a comment field unless it it already present:
<div class="Pp"></div>
<pre>
  mp3info2 -u -P 'i;%c///with piano;///%c' *.mp3
</pre>
<div class="Pp"></div>
The last example shows how to actually write &quot;programs&quot; in the
  language of the &quot;-P&quot; option: the example gives a conditional
  assignment. With user variables (as in &quot;%{U8}&quot;) for temporaries, and
  a possibility to use regular expressions, one could provide arbitrary
  programmatic logic. Of course, at some level of complexity one should better
  switch to direct interfacing with &quot;MP3::Tag&quot; Perl module (use the
  code of this Perl script as an example!).
<div class="Pp"></div>
Here is a typical task setting &quot;advanced&quot; id3v2 frames: composer
  (&quot;TCOM&quot;), orchestra (&quot;TPE2&quot;), conductor
  (&quot;TPE3&quot;). We assume a directory tree which contains MP3 files tagged
  with the following conventions: &quot;artist&quot; is actually a composer;
  &quot;comment&quot; is of one of two forms:
<div class="Pp"></div>
<pre>
  Performers; Orchestra; Conductor
  Orchestra; Conductor
</pre>
<div class="Pp"></div>
To set the specific MP3 frames via &quot;-P&quot; rules, use
<div class="Pp"></div>
<pre>
  mp3info2 -@P &quot;mi/@a/@{TCOM}&quot; \
    -P &quot;mi/@c/@{U1}; @{TPE2}; @{TPE3}/@{TPE2}; @{TPE3}&quot; -R .
</pre>
<div class="Pp"></div>
With &quot;-F&quot; options, this can be simplified as
<div class="Pp"></div>
<pre>
  mp3info2 -@F &quot;TCOM=@a&quot; -P &quot;mi/@c/@{U1}; @{TPE2}; @{TPE3}/@{TPE2}; @{TPE3}&quot; -R .
</pre>
<div class="Pp"></div>
or
<div class="Pp"></div>
<pre>
  mp3info2 -@F &quot;composer=@a&quot; -P &quot;mi/@c/@{U1}; @{TPE2}; @{TPE3}/@{TPE2}; @{TPE3}&quot; -R .
</pre>
<div class="Pp"></div>
To copy ID3 tags of MP3 files in the current directory to files in directory
  <i>/tmp/mp3</i> with the extension <i>.tag</i> (and print &quot;progress
  report&quot;), use
<div class="Pp"></div>
<pre>
  mp3info2 -p &quot;@N@E\n&quot; -@P &quot;bODi,@{ID3v2}@{ID3v1},/tmp/mp3/@N.tag&quot; -DNR .
</pre>
<div class="Pp"></div>
Since we did not use &quot;z&quot; flag, MP3 files without tags are skipped.
<div class="Pp"></div>
Now suppose that there are two parallel file hierarchies of audio files, and of
  lyrics: audio files are in <i>audio/dir_name/audio_name.mp3</i> with
  corresponding lyrics file in <i>text/dir_name/audio_name.mp3</i>. To attach
  lyrics to MP3 files (in &quot;COMM&quot; frame with description
  &quot;lyrics&quot; in language &quot;eng&quot; - <i>this is a non-standard
  location, see below!</i>), call
<div class="Pp"></div>
<pre>
  mp3info2 -@P &quot;fim;../text/@{d0}/@B.txt;@{COMM(eng)[lyrics]}&quot; -Ru .
</pre>
<div class="Pp"></div>
inside the directory <i>audio</i>. (Change &quot;fim&quot; to &quot;Ffim&quot;
  to ignore the audio files for which the corresponding text file does not
  exist.) (Of course, to follow the specifications, one should have used the
  field &quot;%{USLT(eng)[]}&quot; instead of &quot;%{COMM(eng)[lyrics]}&quot;;
  see below for variations).
<div class="Pp"></div>
Finish by a very simple example: all what the pattern
<div class="Pp"></div>
<pre>
  -P 'i;%t;%t'
</pre>
<div class="Pp"></div>
does is removal of trailing and leading blanks from the title (which is deduced
  by other means).
<h1 class="Sh" title="Sh" id="More_examples"><a class="selflink" href="#More_examples">More
  examples</a></h1>
With &quot;-F&quot; option, one could set the &quot;USLT&quot; frame as
<div class="Pp"></div>
<pre>
  mp3info2 -@F &quot;USLT(eng)[] &lt; ../text/@{d0}/@B.txt&quot; -Ru .
</pre>
<div class="Pp"></div>
Print out such a frame (in any language) with
<div class="Pp"></div>
<pre>
  mp3info2 -@p &quot;@{USLT[]}\n&quot; file.mp3
</pre>
<div class="Pp"></div>
Similarly, to print out the APIC frame with empty description, use
<div class="Pp"></div>
<pre>
  mp3info2 -e binary -@p &quot;@{APIC[]}&quot; file.mp3 &gt; output_picture_file
</pre>
<div class="Pp"></div>
or (with description &quot;cover&quot;)
<div class="Pp"></div>
<pre>
  mp3info2 -@P &quot;bOi,@{APIC[cover]},output_picture_file.jpg&quot; audio_07.mp3
</pre>
<div class="Pp"></div>
To set such a frame from file <i>xxx.gif</i> (with the default &quot;Picture
  Type&quot;, &quot;Cover (front)&quot;, and empty description), do one of
<div class="Pp"></div>
<pre>
  mp3info2 -F  &quot;APIC  &lt;          xxx.gif&quot;  file.mp3
  mp3info2 -@F &quot;APIC[]=@{I(fimbB)xxx.gif}&quot; file.mp3
</pre>
<div class="Pp"></div>
The difference of &quot;APIC&quot; and &quot;APIC[]&quot; is that the first
  removes all &quot;APIC&quot; frames first, and the second removes only all
  &quot;APIC&quot; frames with empty description - but arbitrary image type. So
  it may be more suitable to use the full specification, as in &quot;APIC(Cover
  (front))[]&quot;.
<div class="Pp"></div>
To remove &quot;APIC&quot; frames with empty descriptions, arbitrary
  &quot;Picture Type&quot;s (and &quot;MIME type&quot;s which may be correctly
  calculated by <i>mp3info2</i>, e.g., &quot;TIFF/JPEG/GIF/PNG&quot;), use
<div class="Pp"></div>
<pre>
  mp3info2 -d &quot;APIC[]&quot; file.mp3
</pre>
<div class="Pp"></div>
(note that this wouldn't free disk space, unless &quot;shrink&quot; is forced by
  configuration variables). To do the same with the &quot;Conductor&quot;
  picture type only, do
<div class="Pp"></div>
<pre>
  mp3info2 -d &quot;APIC(Conductor)[]&quot; file.mp3
</pre>
<div class="Pp"></div>
To scan through subdirectories, and add file <i>cover.jpg</i> from the directory
  of the file as a &quot;default&quot; &quot;APIC&quot; frame, but only if there
  is no &quot;APIC&quot; frame, and a file exists, do
<div class="Pp"></div>
<pre>
  mp3info2 -@F &quot;APIC ?&lt; @D/cover.jpg&quot; -R .
</pre>
<div class="Pp"></div>
This deletes empty frames for date, &quot;TCOP, TENC, WXXX[], COMM(eng)[]&quot;,
  and removes the leading 0 from track number from MP3 file in current
  directory:
<div class="Pp"></div>
<pre>
  mp3info2 -@ -E +/i:y -F &quot;TCOP=@{TCOP}&quot; -F &quot;TENC=@{TENC}&quot;
    -F &quot;WXXX[]=@{WXXX[]}&quot; -F &quot;COMM(eng)[]=@{COMM(eng)[]}&quot;
    -y &quot;@y&quot; -P &quot;mi/@n/0@n/@n&quot; *.mp3
</pre>
<h1 class="Sh" title="Sh" id="Examples_on_dealing_with_broken_encodings"><a class="selflink" href="#Examples_on_dealing_with_broken_encodings">Examples
  on dealing with broken encodings</a></h1>
One of principal weaknesses of ID3 specification was that it required that data
  is provided in &quot;latin-1&quot; encoding. Since most languages in the world
  are not expressible in &quot;latin-1&quot;, this lead to (majority?) of ID3
  tags being not standard-conforming. Newer versions of the specs fixed this
  shortcoming, but the damage was already done. Fortunately, this script can use
  abilities of &quot;MP3::Tag&quot; to convert from non-conforming content to a
  conforming one.
<div class="Pp"></div>
The following example converts ID3v2 tags which were written in
  (non-standard-conforming) encoding &quot;cp1251&quot; to be in
  standard-conforming encoding. For the purpose of this example, assume that
  ID3v1 tags are in the same encoding (and that one wants to leave them in the
  encoding &quot;cp1251&quot;); the files to process are found in the current
  directory and (recursively) in its subdirectories (&quot;set&quot; syntax for
  DOSISH shells):
<div class="Pp"></div>
<pre>
  set MP3TAG_DECODE_V1_DEFAULT=cp1251
  set MP3TAG_DECODE_V2_DEFAULT=cp1251
  mp3info2 -C id3v2_fix_encoding_on_write=1 -u2R .
</pre>
<div class="Pp"></div>
For more information, see &quot;ENVIRONMENT&quot; in MP3::Tag,
  &quot;config&quot; in MP3::Tag, and &quot;CUSTOMIZATION&quot; in MP3::Tag.
<h1 class="Sh" title="Sh" id="INCOMPATIBILITIES_with_mp3info"><a class="selflink" href="#INCOMPATIBILITIES_with_mp3info">INCOMPATIBILITIES
  with <i>mp3info</i></a></h1>
This tool is loosely modeled on the program <i>mp3info</i>; it is
  &quot;mostly&quot; backward compatible (especially when in &quot;naive&quot;
  mode via &quot;-N&quot;), and allows a very significant superset of
  functionality. Known backward incompatibilities are:
<div class="Pp"></div>
<pre>
  -G -h -r -d -x
</pre>
<div class="Pp"></div>
Missing functionality:
<div class="Pp"></div>
<pre>
  -f -F -i
</pre>
<div class="Pp"></div>
Incompatible &quot;%&quot;- <i>escapes</i>:
<div class="Pp"></div>
<pre>
  %e %E         - absolutely different semantic
  %v            - has no trailing 0s
  %q            - has fractional part
  %r            - is a number, not a word &quot;Variable&quot; for VBR
  %u            - is one less (in presence of descriptor frame only?)
</pre>
<div class="Pp"></div>
Missing &quot;%&quot;- <i>escapes</i>:
<div class="Pp"></div>
<pre>
  %b %G
</pre>
<div class="Pp"></div>
Backslash escapes: only &quot;\\&quot;, &quot;\n&quot;, &quot;\t&quot;
  supported.
<div class="Pp"></div>
&quot;-x&quot; prints data in a different format, not all fields are present,
  and ID3v2 tag names are output.
<h1 class="Sh" title="Sh" id="ENVIRONMENT"><a class="selflink" href="#ENVIRONMENT">ENVIRONMENT</a></h1>
With &quot;-e&quot; 1, 2 or 3, this script may consult environment variables
  &quot;LC_CTYPE, LC_ALL, LANG&quot; to deduce the current encoding. No other
  environment variables are directly read by this script.
<div class="Pp"></div>
Note however, that MP3::Tag module has a rich set of defaults for encoding
  settings settable by environment variables; see &quot;ENVIRONMENT&quot; in
  MP3::Tag. So these variables affect (indirectly) how this script works.
<h1 class="Sh" title="Sh" id="OBSOLETE_INTERFACE"><a class="selflink" href="#OBSOLETE_INTERFACE">OBSOLETE
  INTERFACE</a></h1>
If you do not understand what it is about, it is safe to ignore this
  announcement:
<div class="Pp"></div>
The old, pre-version=1.05 way (by triplication of a separator, without
  repetition of options) to provide multiple commands to &quot;-F&quot; and
  &lt;-P&gt; options is still supported, but is strongly discouraged. (It does
  not conflict with the current interface.)
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Ilya Zakharevich &lt;cpan@ilyaz.org&gt;.
<h1 class="Sh" title="Sh" id="Utilities_to_create_CDDB_file"><a class="selflink" href="#Utilities_to_create_CDDB_file">Utilities
  to create CDDB file</a></h1>
Good CD reapers (e.g., <i>cdda2wav</i> with option &quot;cddb=0&quot;) create a
  CDDB file with fetched information - as far as an Internet connection is
  present. However, if not available, other options exist.
<div class="Pp"></div>
The scripts (supplied with the distribution in <i>./examples</i>) can create a
  &quot;stub&quot; CDDB file basing on:
<dl class="Bl-tag">
  <dt class="It-tag"><i>fulltoc2fake_cddb.pl</i></dt>
  <dd class="It-tag">a dump of a full TOC of a CD; create one, e.g., by
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  readcd -fulltoc dev=0,1,0 -f=audiocd
    </pre>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>inf2fake_cddb.pl</i></dt>
  <dd class="It-tag">directory of <i>*.inf</i> files (e.g., created by
      <i>cdda2wav</i> without Internet connection);</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><i>dir_mp3_2fake_cddb.pl</i></dt>
  <dd class="It-tag">a directory of MP3 files ripped from a CD (via some
      guesswork).</dd>
</dl>
<div class="Pp"></div>
Passing this stub to the script <i>cddb2cddb.pl</i>, it can be transformed to a
  &quot;filled&quot; CDDB file via a connection to some online database. Use
  &quot;-r&quot; option if multiple records in the database match the CD
  signature.
<div class="Pp"></div>
<pre>
  fulltoc2fake_cddb audiocd.toc | cddb2cddb     &gt; audio.cddb
  inf_2fake_cddb                | cddb2cddb     &gt; audio.cddb
  dir_mp3_2fake_cddb            | cddb2cddb -r3 &gt; audio.cddb # 3rd record
</pre>
<div class="Pp"></div>
When such a CDDB file is present, it will be used by MP3::Tag module to deduce
  the information about an audio file. This information is (by default,
  transparently) used by this script.
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
MP3::Tag, MP3::Tag::ParseData, audio_rename, typeset_audio_dir</div>
<table class="foot">
  <tr>
    <td class="foot-date">2010-03-07</td>
    <td class="foot-os">perl v5.14.2</td>
  </tr>
</table>
</body>
</html>
