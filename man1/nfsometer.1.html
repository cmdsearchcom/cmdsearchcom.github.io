<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>man(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">man(1)</td>
    <td class="head-vol">General Commands Manual</td>
    <td class="head-rtitle">man(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
nfsometer - NFS performance measurement tool
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
nfsometer [options] [mode] [[&lt;server:path&gt;] [workloads...]]
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
nfsometer is a performance measurement framework for running workloads and
  reporting results across NFS protocol versions, NFS options and Linux NFS
  client implementations
<h1 class="Sh" title="Sh" id="MODES"><a class="selflink" href="#MODES">MODES</a></h1>
Basic usage (no mode specified):
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <b>nfsometer &lt;server:path&gt; [workloads...]</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 This will fetch needed files, run traces, and generate reports,
<br/>
 same as running the the 'fetch', 'trace' and 'report' stages.
<div style="height: 1.00em;">&#x00A0;</div>
Advanced usage (specify modes):
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <b>nfsometer list</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 List the contents of the results directory.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <b>nfsometer workloads</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 List available and unavailable workloads.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <b>nfsometer notes</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 Edit the notes file of the results directory. These notes will
<br/>
 be displayed in report headers.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <b>nfsometer loadgen &lt;server:path&gt; &lt;workload&gt;</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 Run in loadgen mode: don't record any stats, just loop over
<br/>
 &lt;workload&gt; against &lt;server:path&gt;. Only one -o option is allowed.
<br/>
 Use the -n option to run multuple instances of the loadgen workload.
<br/>
 When running more than one instance, the intial start times are
<br/>
 staggered.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <b>nfsometer fetch [workloads...]</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 Fetch all needed files for the specified workload(s). If no
<br/>
 workloads are specified, all workloads are fetched.
<br/>
 Fetched files are only downloaded once and are cached for
<br/>
 future runs.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <b>nfsometer trace &lt;server:path&gt; [workloads...]</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 Run traces against &lt;server:path&gt;. The traces run will be:
<br/>
 (options + always options + tags) X (workloads) X (num runs)
<br/>
 This will only run traces that don't already exist in the results
<br/>
 directory.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <b>nfsometer report</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 Generate all reports available from the results directory.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <b>nfsometer example</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 Show examples from man page
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b> <b>-r &lt;dir&gt;</b>, <b>--resultdir=&lt;dir&gt;</b>
    </b></dt>
  <dd class="It-tag">The directory used to save results. default:
      '/home/dros/nfsometer_results'
    <div style="height: 1.00em;">&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b> <b>-o &lt;mount.nfs options&gt;</b>,
    <b>--options=&lt;mount.nfs options&gt;</b> </b></dt>
  <dd class="It-tag">Mount options to iterate through. This option may be used
      multiple times. Each mount option must have a version specified.
    <div style="height: 1.00em;">&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b> <b>-a &lt;mount.nfs options&gt;</b>,
    <b>--always-options=&lt;mount.nfs options&gt;</b> </b></dt>
  <dd class="It-tag">Options added to every trace. This option may be used
      multiple times.
    <div style="height: 1.00em;">&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b> <b>-t &lt;tags&gt;</b>, <b>--tag=&lt;tags&gt;</b>
    </b></dt>
  <dd class="It-tag">Tag all new traces with 'tags'. This option may be used
      multiple times.
    <div style="height: 1.00em;">&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b> <b>-n &lt;num runs&gt;</b>, <b>--num-runs=&lt;num
    runs&gt;</b> </b></dt>
  <dd class="It-tag">Number of runs for each trace of &lt;options&gt; X
      &lt;tags&gt; X &lt;workloads&gt; default: 1
    <div style="height: 1.00em;">&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b> <b>--serial-graphs</b> </b></dt>
  <dd class="It-tag">Generate graphs inline while generating reports. Useful for
      debugging graphing issues.
    <div style="height: 1.00em;">&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b> <b>--rand</b> </b></dt>
  <dd class="It-tag">Randomize the order of traces
    <div style="height: 1.00em;">&#x00A0;</div>
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b> <b>-h</b>, <b>--help</b> </b></dt>
  <dd class="It-tag">Show the help message</dd>
</dl>
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
Example 1: See what workloads are available
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <b>$ nfsometer workloads</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 This command lists available workloads and will tell you why
<br/>
 workloads are unavailable (if any exist).
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
Example 2: Compare cthon, averaged over 3 runs,
<br/>
 across nfs protocol versions
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <b>nfsometer -n 3 server:/export cthon</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 This example uses the default for -o: &quot;-o v3 -o v4 -o v4.1&quot;.
<br/>
 To see the results, open results/index.html in a web browser.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
Example 3: Compare cthon, averaged over 3 runs,
<br/>
 between v3 and v4.0 only
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <b>nfsometer -n 3 -o v3 -o v4 server:/export cthon</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 This example specifies v3 and v4 only.
<br/>
 To see the results, open results/index.html in a web browser.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
Example 4: Compare two kernels running iozone workload, averaged
<br/>
 over 2 runs, across all nfs protocol versions
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 nfsometer can compare two (or more) kernel versions, but
<br/>
 has no way of building, installing or booting new kernels.
<br/>
 It's up to the user to install new kernels.
<br/>
 In order for these kernels to be differentiated, 'uname -a'
<br/>
 must be different.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 1) boot into kernel #1
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 2) <b>nfsometer -n 2 server:/export iozone</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 3) boot into kernel #2
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 4) <b>nfsometer -n 2 server:/export iozone</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 5) open results/index.html in a web browser
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 To see the results, open results/index.html in a web browser.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
Example 5: Using tags
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 Tags (the -t option) can be used to mark nfsometer runs as
<br/>
 occurring with some configuration not captured by mount options
<br/>
 or detectable tags, such as different sysctl settings (client side),
<br/>
 different server side options, or different network conditions.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 1) set server value foo to 2.3
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 2) <b>nfsometer -o v4 -o v4.1 -t foo=2.3</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 3) set server value foo to 10
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 4) <b>nfsometer -o v4 -o v4.1 -t foo=10</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 What is passed to -t is entirely up to the user - it will not be
<br/>
 interpreted or checked by nfsometer at all, so be careful!
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 To see the results, open results/index.html in a web browser.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
Example 6: Always options
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 The -o flag specifies distinct option sets to run, but sometimes
<br/>
 there are options that should be present in each. Instead of
<br/>
 writing each one out, you can use the -a option:
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <b>nfsometer -o v3 -o v4 -a sec=krb5 server:/export iozone</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 this is equivalent to:
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <b>nfsometer -o v3,sec=krb5 -o v4,sec=krb5 server:/export iozone</b>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
Example 7: Using the &quot;custom&quot; workload
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 A main use case of nfsometer is the &quot;custom&quot; workload - it allows
<br/>
 the user to specify the command that nfsometer is to run.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 NOTE: the command's cwd (current working directory) is the runroot
<br/>
 created on the server.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <b>export NFSOMETER_CMD=&quot;echo foo &gt; bar&quot;</b>
<br/>
 <b>export NFSOMETER_NAME=&quot;echo&quot;</b>
<br/>
 <b>export NFSOMETER_DESC=&quot;Writes 4 bytes to a file&quot;</b>
<br/>
 <b>nfsometer server:/export custom</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 This will run 3 traces (v3, v4, v4.1) against server:/export of
<br/>
 the command: <b>echo foo &gt; bar</b>.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
Example 8: Using the loadgen mode
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 Loadgen runs several instances of a workload without capturing
<br/>
 traces. The idea is that you use several clients to generate
<br/>
 load, then another client to measure performance of a loaded
<br/>
 server. The &quot;real&quot; run of nfsometer (not loadgen) should mark
<br/>
 the traces using the -t option.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 1) On client A, run the cthon workload to get a baseline of
<br/>
 a server without any load.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <b>nfsometer trace server:/export cthon</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 2) When that's done, start loadgen on client B:
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <b>nfsometer -n 10 loadgen server:/export dd_100m_1k</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 This runs 10 instances of dd_100m_1k workload on server:/export.
<br/>
 It can take several minutes to start in an attempt to stagger
<br/>
 all the workload instances.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 3) once all instances are started, run the &quot;real&quot; nfsometer
<br/>
 trace on client A. Use the -t option to mark the traces
<br/>
 as having run under load conditions:
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <b>nfsometer -t &quot;10_dd&quot; trace server:/export cthon</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 4) Explain how the tests were set up in the result notes.
<br/>
 This should be run on client A (which has the traces:
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <b>nfsometer notes</b>
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 5) Now generate the reports:
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 <b>nfsometer report</b>
<div style="height: 1.00em;">&#x00A0;</div>
Example 8: Long running nfsometer trace
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 The nfsometer.py script currently runs in the foreground. As
<br/>
 such, it will be killed if the tty gets a hangup or the connection
<br/>
 to the client is closed.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 For the time being, nfsometer should be run in a screen
<br/>
 session, or run with nohup and the output redirected to a file.
<div style="height: 1.00em;">&#x00A0;</div>
<br/>
 1) <b>screen -RD</b>
<br/>
 2) <b>nfsometer -n 2 server:/export iozone</b>
<br/>
 3) close terminal window (or ^A^D)
<br/>
 ...
<br/>
 4) reattach later with <b>screen -RD</b>
<br/>
 5) once nfsometer.py is done, results will be in results/index.html
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
mountstats, nfsstats
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
No known bugs.
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Weston Andros Adamson (dros@netapp.com)</div>
<table class="foot">
  <tr>
    <td class="foot-date">1.7</td>
    <td class="foot-os">nfsometer</td>
  </tr>
</table>
</body>
</html>
