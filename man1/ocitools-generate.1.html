<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>OCI(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">OCI(1)</td>
    <td class="head-vol">APRIL 2016</td>
    <td class="head-rtitle">OCI(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
ocitools-generate - Generate a config.json for an OCI container
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>ocitools generate</b> [ <b>--arch</b>[=<i>[]</i>] [
  <b>--apparmor</b>[=<i>[]</i>]] [ <b>--args</b>[=<i>[]</i>]] [
  <b>--bind</b>[=<i>[]</i>]] [ <b>--cap-add</b>[=<i>[]</i>]] [
  <b>--cap-drop</b>[= <i>[]</i>]] [ <b>--cwd</b>[=<i>[]</i>]] [
  <b>--env</b>[=<i>[]</i>]] [ <b>--gid</b>[=<i>GID</i>]] [
  <b>--gidmappings</b>[= <i>[]</i>]]] [ <b>--groups</b>[=<i>[]</i>]] [
  <b>--hostname</b>[= <i>[]</i>]] [ <b>--help</b>] [ <b>--ipc</b>] [
  <b>--network</b>] [ <b>--no-new-privileges</b>] [ <b>--mount</b>] [
  <b>--mount-cgroups</b>] [ <b>--os</b>[=<i>[]</i>]] [ <b>--pid</b>] [
  <b>--poststart</b>[= <i>[]</i>]] [ <b>--poststop</b>[=<i>[]</i>]] [
  <b>--prestart</b>[= <i>[]</i>]] [ <b>--privileged</b>] [ <b>--read-only</b>] [
  <b>--root-propagation</b>[=<i>[]</i>]] [ <b>--rootfs</b>[=<i>[]</i>]] [
  <b>--seccomp-default</b>[= <i>[]</i>]] [ <b>--seccomp-arch</b>[=<i>[]</i>]] [
  <b>--seccomp-syscalls</b>[=<i>[]</i>]] [ <b>--selinux-label</b>[=<i>[]</i>]] [
  <b>--sysctl</b>[=<i>[]</i>]] [ <b>--tmpfs</b>[=<i>[]</i>]] [
  <b>--uid</b>[=<i>[]</i>]] [ <b>--uidmappings</b>[=<i>[]</i>]] [ <b>--uts</b>]
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<b>ocitools generate</b> is used to generate a config.json (OCI spec file) to be
  used to instantiate an OCI container. This config.json file can be placed into
  a directory and used by an OCI compatable runtime like <b>runc</b> to run a
  container.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
<b>--apparmor</b>=&quot;PROFILE&quot;
<br/>
 Specifies the the apparmor profile for the container
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--arch</b>=&quot;ARCH&quot;
<br/>
 Architecture used within the container.
<br/>
 &quot;amd64&quot;
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--args</b>=OPTION
<br/>
 Arguments to run within the container. Can be specified multiple times.
<br/>
 If you were going to run a command with multiple options, you would need to
  specify the command and each argument in order.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
--args &quot;/usr/bin/httpd&quot; --args &quot;-D&quot; --args
  &quot;FOREGROUND&quot;
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--bind</b>=[=<i>[[HOST-DIR:CONTAINER-DIR][:OPTIONS]]</i>] Bind mount
<br/>
 directories src:dest:(rw,ro) If you specify, <b></b>--bind
<br/>
 /HOST-DIR:/CONTAINER-DIR, runc bind mounts <b></b>/HOST-DIR in the host
<br/>
 to <b></b>/CONTAINER-DIR in the OCI container. The <b></b>OPTIONS are a comma
<br/>
 delimited list and can be: [rw|ro] The <b></b>HOST_DIR and
<br/>
 <b></b>CONTAINER-DIR must be absolute paths such as <b></b>/src/docs. You
<br/>
 can add <b></b>:ro or <b></b>:rw suffix to a volume to mount it read-only or
<br/>
 read-write mode, respectively. By default, the volumes are mounted
<br/>
 read-write.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--cap-add</b>=[]
<br/>
 Add Linux capabilities
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--cap-drop</b>=[]
<br/>
 Drop Linux capabilities
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--cwd</b>=PATH
<br/>
 Current working directory for the process
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--env</b>=[]
<br/>
 Set environment variables
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
This option allows you to specify arbitrary environment variables that are
  available for the process that will be launched inside of the container.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--hostname</b>=&quot;&quot;
<br/>
 Container host name
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
Sets the container host name that is available inside the container.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--help</b>
<br/>
 Print usage statement
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--gid</b>=GID
<br/>
 Gid for the process inside of container
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--groups</b>=GROUP
<br/>
 Supplementary groups for the processes inside of container
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--gidmappings</b>=GIDMAPPINGS
<br/>
 Add GIDMappings e.g HostID:ContainerID:Size for use with User Namespace
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--ipc</b>
<br/>
 Use ipc namespace
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--network</b>
<br/>
 Use network namespace
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--no-new-privileges</b>
<br/>
 Set no new privileges bit for the container process. Setting this flag
<br/>
 will block the container processes from gaining any additional privileges
<br/>
 using tools like setuid apps. It is a good idea to run unprivileged
<br/>
 containers with this flag.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--mount</b>
<br/>
 Use a mount namespace
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--mount-cgroups</b>
<br/>
 Mount cgroups (rw,ro,no)
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--os</b>=OS
<br/>
 Operating system used within the container
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--pid</b>
<br/>
 Use a pid namespace
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--poststart</b>=CMD
<br/>
 Path to command to run in poststart hooks. This command will be run before
<br/>
 the container process gets launched but after the container environment and
<br/>
 main process has been created.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--poststop</b>=CMD
<br/>
 Path to command to run in poststop hooks. This command will be run after the
<br/>
 container completes but before the container process is destroyed
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--prestart</b>=CMD
<br/>
 Path to command to run in prestart hooks. This command will be run before
<br/>
 the container process gets launched but after the container environment.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--privileged</b>=<i>true</i>|<i>false</i>
<br/>
 Give extended privileges to this container. The default is <i>false</i>.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
By default, OCI containers are &#x201C;unprivileged&#x201D; (=false) and cannot
  do some of the things a normal root process can do.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
When the operator executes <b>ocitools generate --privileged</b>, OCI will
  enable access to all devices on the host as well as disable some of the
  confinement mechanisms like AppArmor, SELinux, and seccomp from blocking
  access to privileged processes. This gives the container processes nearly all
  the same access to the host as processes generating outside of a container on
  the host.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--read-only</b>=<i>true</i>|<i>false</i>
<br/>
 Mount the container's root filesystem as read only.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
By default a container will have its root filesystem writable allowing processes
  to write files anywhere. By specifying the <b></b>--read-only flag the
  container will have its root filesystem mounted as read only prohibiting any
  writes.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--root-propagation</b>=PROPOGATIONMODE
<br/>
 Mount propagation for root filesystem.
<br/>
 Values are &quot;SHARED, RSHARED, PRIVATE, RPRIVATE, SLAVE, RSLAVE&quot;
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--rootfs</b>=&quot;<i>ROOTFSPATH</i>&quot;
<br/>
 Path to the rootfs
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--sysctl</b>=SYSCTLSETTING
<br/>
 Add sysctl settings e.g net.ipv4.forward=1, only allowed if the syctl is
<br/>
 namespaced.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--seccomp-default</b>=ACTION
<br/>
 Specifies the the defaultaction of Seccomp syscall restrictions
<br/>
 Values: KILL,ERRNO,TRACE,ALLOW
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--seccomp-arch</b>=ARCH
<br/>
 Specifies Additional architectures permitted to be used for system calls.
<br/>
 By default if you turn on seccomp, only the host architecture will be allowed.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--seccomp-syscalls</b>=SYSCALLS
<br/>
 Specifies Additional syscalls permitted to be used for system calls,
<br/>
 e.g Name:Action:Arg1_index/Arg1_value/Arg1_valuetwo/Arg1_op,
  Arg2_index/Arg2_value/Arg2_valuetwo/Arg2_op
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--selinux-label</b>=[=<i>SELINUXLABEL</i>]]
<br/>
 SELinux Label
<br/>
 Depending on your SELinux policy, you would specify a label that looks like
<br/>
 this:
<br/>
 &quot;system_u:system_r:svirt_lxc_net_t:s0:c1,c2&quot;
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
Note you would want your ROOTFS directory to be labeled with a context that
this process type can use.
<div class="Pp"></div>
  &quot;system_u:object_r:usr_t:s0&quot; might be a good label for a readonly container,
  &quot;system_u:system_r:svirt_sandbox_file_t:s0:c1,c2&quot; for a read/write container.
<div class="Pp"></div>
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--tmpfs</b>=[] Create a tmpfs mount
<br/>
 Mount a temporary filesystem ( <b></b>tmpfs) mount into a container, for
  example:
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ ocitools generate -d --tmpfs /tmp:rw,size=787448k,mode=1777 my_image
<div class="Pp"></div>
This command mounts a `tmpfs` at `/tmp` within the container.  The supported mount options are the same as the Linux default `mount` flags. If you do not specify any options, the systems uses the following options:
`rw,noexec,nosuid,nodev,size=65536k`.
<div class="Pp"></div>
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--uid</b>=UID
<br/>
 Sets the UID used within the container.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--uidmappings</b>
<br/>
 Add UIDMappings e.g HostUID:ContainerID:Size for use with User Namespace
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<b>--uts</b>
<br/>
 Use the uts namespace
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
<h1 class="Sh" title="Sh" id="Generating_container_in_read-only_mode"><a class="selflink" href="#Generating_container_in_read-only_mode">Generating
  container in read-only mode</a></h1>
During container image development, containers often need to write to the image
  content. Installing packages into /usr, for example. In production,
  applications seldom need to write to the image. Container applications write
  to volumes if they need to write to file systems at all. Applications can be
  made more secure by generating them in read-only mode using the --read-only
  switch. This protects the containers image from modification. Read only
  containers may still need to write temporary data. The best way to handle this
  is to mount tmpfs directories on /generate and /tmp.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
# ocitools generate --read-only --tmpfs /generate --tmpfs /tmp --tmpfs /run  --rootfs /var/lib/containers/fedora /bin/bash
<div class="Pp"></div>
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="Exposing_log_messages_from_the_container_to_the_host's_log"><a class="selflink" href="#Exposing_log_messages_from_the_container_to_the_host's_log">Exposing
  log messages from the container to the host's log</a></h1>
If you want messages that are logged in your container to show up in the host's
  syslog/journal then you should bind mount the /dev/log directory as follows.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
# ocitools generate --bind /dev/log:/dev/log  --rootfs /var/lib/containers/fedora /bin/bash
<div class="Pp"></div>
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
From inside the container you can test this by sending a message to the log.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
(bash)# logger &quot;Hello from my container&quot;
<div class="Pp"></div>
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
Then exit and check the journal.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
# exit
<div class="Pp"></div>
# journalctl -b | grep Hello
<div class="Pp"></div>
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
This should list the message sent to logger.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="Bind_Mounting_External_Volumes"><a class="selflink" href="#Bind_Mounting_External_Volumes">Bind
  Mounting External Volumes</a></h1>
To mount a host directory as a container volume, specify the absolute path to
  the directory and the absolute path for the container directory separated by a
  colon:
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
# ocitools generate --bind /var/db:/data1  --rootfs /var/lib/containers/fedora --args bash
<div class="Pp"></div>
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="Using_SELinux"><a class="selflink" href="#Using_SELinux">Using
  SELinux</a></h1>
You can use SELinux to add security to the container. You must specify the
  process label to run the init process inside of the container using the
  --selinux-label.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
# ocitools generate --bind /var/db:/data1 --selinux-label
  system_u:system_r:svirt_lxc_net_t:s0:c1,c2 --rootfs /var/lib/containers/fedora
  --args bash
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
Not in the above example we used a type of svirt_lxc_net_t and an MCS Label of
  s0:c1,c2. If you want to guarantee separation between containers, you need to
  make sure that each container gets launched with a different MCS Label pair.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
Also the underlying rootfs must be labeled with a matching label. For the
  example above, you would execute a command like:
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
# chcon -R system_u:object_r:svirt_sandbox_file_t:s0:c1,c2
  /var/lib/containers/fedora
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
This will set up the labeling of the rootfs so that the process launched would
  be able to write to the container. If you wanted to only allow it to
  read/execute the content in rootfs, you could execute:
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
# chcon -R system_u:object_r:usr_t:s0 /var/lib/containers/fedora
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
When using SELinux, be aware that the host has no knowledge of container SELinux
  policy. Therefore, in the above example, if SELinux policy is enforced, the
  <b></b>/var/db directory is not writable to the container. A &quot;Permission
  Denied&quot; message will occur and an avc: message in the host's syslog.
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
To work around this, the following command needs to be generate in order for the
  proper SELinux policy type label to be attached to the host directory:
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
# chcon -Rt svirt_sandbox_file_t -l s0:c1,c2 /var/db
<div class="Pp"></div>
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div class="Pp"></div>
Now, writing to the /data1 volume in the container will be allowed and the
  changes will also be reflected on the host in /var/db.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>runc</b>(1), <b>ocitools</b>(1)
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="HISTORY"><a class="selflink" href="#HISTORY">HISTORY</a></h1>
April 2016, Originally compiled by Dan Walsh (dwalsh at redhat dot com)</div>
<table class="foot">
  <tr>
    <td class="foot-date"> OCI User Manuals</td>
    <td class="foot-os">OCI Community</td>
  </tr>
</table>
</body>
</html>
