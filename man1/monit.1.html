<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:25:59 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>MONIT(1) User Commands MONIT(1)</p>

<p style="margin-top: 1em">NAME <br>
Monit - utility for monitoring services on a Unix system</p>

<p style="margin-top: 1em">SYNOPSIS <br>
monit [options] {arguments}</p>

<p style="margin-top: 1em">DESCRIPTION <br>
Monit is a utility for managing and monitoring processes,
programs, files, directories and filesystems on a Unix
system. Monit conducts automatic maintenance and repair and
can <br>
execute meaningful causal actions in error situations. E.g.
Monit can start a process if it does not run, restart a
process if it does not respond and stop a process if it uses
<br>
too much resources. You can use Monit to monitor files,
directories and filesystems for changes, such as timestamps
changes, checksum changes or size changes.</p>

<p style="margin-top: 1em">Monit is controlled via an easy
to configure control file based on a free-format,
token-oriented syntax. Monit logs to syslog or to its own
log file and notifies you about error <br>
conditions via customizable alert messages. Monit can
perform various TCP/IP network checks, protocol checks and
can utilize SSL for such checks. Monit provides a http(s)
<br>
interface and you may use a browser to access the Monit
program.</p>

<p style="margin-top: 1em">WHAT TO MONITOR? <br>
You can use Monit to monitor daemon processes or similar
programs running on localhost. Monit is particularly useful
for monitoring daemon processes, such as those started at
<br>
system boot time. For instance sendmail, sshd, apache and
mysql. In contrast to many other monitoring systems, Monit
can act if an error situation should occur, e.g.; if
sendmail <br>
is not running, monit can start sendmail again automatically
or if apache is using too many resources (e.g. if a DoS
attack is in progress) Monit can stop or restart apache and
<br>
send you an alert message. Monit can also monitor process
characteristics, such as how much memory or cpu cycles a
process is using.</p>

<p style="margin-top: 1em">You can also use Monit to
monitor files, directories and filesystems on localhost.
Monit can monitor these items for changes, such as
timestamps changes, checksum changes or size <br>
changes. This is also useful for security reasons - you can
monitor the md5 or sha1 checksum of files that should not
change and get an alert or perform an action if they should
<br>
change.</p>

<p style="margin-top: 1em">Monit can monitor network
connections to various servers, either on localhost or on
remote hosts. TCP, UDP and Unix Domain Sockets are
supported. Network test can be performed on <br>
a protocol level; Monit has built-in tests for the main
Internet protocols, such as HTTP, SMTP etc. Even if a
protocol is not supported you can still test the server
because you <br>
can configure Monit to send any data and test the response
from the server.</p>

<p style="margin-top: 1em">Monit can be used to test
programs or scripts at certain times, much like cron, but in
addition, you can test the exit value of a program and
perform an action or send an alert <br>
if the exit value indicates an error. This means that you
can use Monit to perform any type of check you can write a
script for.</p>

<p style="margin-top: 1em">Finally, Monit can be used to
monitor general system resources on localhost such as
overall CPU usage, Memory and System Load.</p>

<p style="margin-top: 1em">GENERAL OPERATION <br>
The behavior of Monit is controlled by command-line options
and a run control file, monitrc, the syntax of which we
describe in a later section. Command-line options override
<br>
.monitrc declarations.</p>

<p style="margin-top: 1em">The default location for monitrc
is ~/.monitrc. If this file does not exist, Monit will try
/etc/monitrc and a few other places. See FILES for details.
You can also specify the <br>
control file directly by using the -c command-line switch to
monit. For instance,</p>

<p style="margin-top: 1em">$ monit -c
/var/monit/monitrc</p>

<p style="margin-top: 1em">Before Monit is started the
first time, you can test the control file for syntax
errors:</p>

<p style="margin-top: 1em">$ monit -t <br>
$ Control file syntax OK</p>

<p style="margin-top: 1em">If there was an error, Monit
will print an error message to the console, including the
line number in the control file from where the error was
found.</p>

<p style="margin-top: 1em">Once you have a working Monit
control file, simply start Monit from the console, like
so:</p>

<p style="margin-top: 1em">$ monit</p>

<p style="margin-top: 1em">You can change some
configuration directives via command-line switches, but for
simplicity it is recommended that you put these in the
control file.</p>

<p style="margin-top: 1em">Monit will detach from the
terminal and run as a background process, i.e. as a daemon
process. As a daemon, Monit runs in cycles; It monitor
services, then goes to sleep for a <br>
configured period, then wakes up and start monitoring again
in an endless loop.</p>

<p style="margin-top: 1em">Options <br>
The following options are recognized by Monit. However, it
is recommended that you set options (when applicable)
directly in the .monitrc control file.</p>

<p style="margin-top: 1em">-c file <br>
Use this control file</p>

<p style="margin-top: 1em">-d n <br>
Run Monit as a daemon once per n seconds. Or use &quot;set
<br>
daemon&quot; in monitrc.</p>

<p style="margin-top: 1em">-g name <br>
Set group name for start, stop, restart, monitor, unmonitor,
<br>
status and summary action.</p>

<p style="margin-top: 1em">-l logfile <br>
Print log information to this file. Or use &quot;set
logfile&quot; <br>
in monitrc.</p>

<p style="margin-top: 1em">-p pidfile <br>
Use this lock file in daemon mode. Or use &quot;set
pidfile&quot; <br>
in monitrc.</p>

<p style="margin-top: 1em">-s statefile <br>
Write state information to this file. Or use &quot;set <br>
statefile&quot; in monitrc.</p>

<p style="margin-top: 1em">-I <br>
Do not run in background (needed for run from init)</p>

<p style="margin-top: 1em">-i <br>
Print Monit&rsquo;s unique ID</p>

<p style="margin-top: 1em">-r <br>
Reset Monit&rsquo;s unique ID. Use with caution</p>

<p style="margin-top: 1em">-t <br>
Run syntax check for the control file</p>

<p style="margin-top: 1em">-v <br>
Verbose mode, work noisy (diagnostic output)</p>

<p style="margin-top: 1em">-vv <br>
Very verbose mode, same as -v plus log stack-trace on
error</p>

<p style="margin-top: 1em">-H [filename] <br>
Print MD5 and SHA1 hashes of the file or of stdin if the
<br>
filename is omitted; Monit will exit afterwards</p>

<p style="margin-top: 1em">-V <br>
Print version number and patch level</p>

<p style="margin-top: 1em">-h <br>
Print a help text</p>

<p style="margin-top: 1em">Arguments <br>
Once you have Monit running as a daemon process, you can
call Monit with one of the following arguments. Monit will
then connect to the Monit daemon (on TCP port 127.0.0.1:2812
<br>
by default) and ask the Monit daemon to perform the
requested action. In other words; calling monit without
arguments starts the Monit daemon, and calling monit with
arguments <br>
enables you to communicate with the Monit daemon
process.</p>

<p style="margin-top: 1em">start all <br>
Start all services listed in the control file and enable
monitoring for them. If the group option is set (-g), only
start and enable monitoring of services in the named group
<br>
(&quot;all&quot; is not required in this case).</p>

<p style="margin-top: 1em">start name <br>
Start the named service and enable monitoring for it. The
name is a service entry name from the monitrc file.</p>

<p style="margin-top: 1em">stop all <br>
Stop all services listed in the control file and disable
their monitoring. If the group option is set, only stop and
disable monitoring of the services in the named group <br>
(all&quot; is not required in this case).</p>

<p style="margin-top: 1em">stop name <br>
Stop the named service and disable its monitoring. The name
is a service entry name from the monitrc file.</p>

<p style="margin-top: 1em">restart all <br>
Stop and start all services. If the group option is set,
only restart the services in the named group
(&quot;all&quot; is not required in this case).</p>

<p style="margin-top: 1em">restart name <br>
Restart the named service. The name is a service entry name
from the monitrc file.</p>

<p style="margin-top: 1em">monitor all <br>
Enable monitoring of all services listed in the control
file. If the group option is set, only start monitoring of
services in the named group (&quot;all&quot; is not required
in this <br>
case).</p>

<p style="margin-top: 1em">monitor name <br>
Enable monitoring of the named service. The name is a
service entry name from the monitrc file. Monit will also
enable monitoring of all services this service depends
on.</p>

<p style="margin-top: 1em">unmonitor all <br>
Disable monitoring of all services listed in the control
file. If the group option is set, only disable monitoring of
services in the named group (&quot;all&quot; is not required
in <br>
this case).</p>

<p style="margin-top: 1em">unmonitor name <br>
Disable monitoring of the named service. The name is a
service entry name from the monitrc file. Monit will also
disable monitoring of all services that depends on this <br>
service.</p>

<p style="margin-top: 1em">status [name] <br>
Print service status information.</p>

<p style="margin-top: 1em">summary [name] <br>
Print a short status summary.</p>

<p style="margin-top: 1em">reload <br>
Reinitialize a running Monit daemon, the daemon will reread
its configuration, close and reopen log files.</p>

<p style="margin-top: 1em">quit <br>
Kill the Monit daemon process</p>

<p style="margin-top: 1em">validate <br>
Check all services listed in the control file. This action
is also the default behavior when Monit runs in daemon
mode.</p>

<p style="margin-top: 1em">procmatch regex <br>
Allows for easy testing of pattern for process match check.
The command takes regular expression as an argument and
displays all running processes matching the pattern.</p>

<p style="margin-top: 1em">THE MONIT CONTROL FILE <br>
Monit is configured and controlled via a control file called
monitrc. The default location for this file is ~/.monitrc.
If this file does not exist, Monit will try /etc/monitrc,
<br>
then @sysconfdir@/monitrc and finally ./monitrc. If you
build Monit from source, the value of @sysconfdir@ can be
given at configure time as ./configure --sysconfdir. For
<br>
instance, using ./configure --sysconfdir /var/monit/etc will
make Monit search for monitrc in /var/monit/etc</p>

<p style="margin-top: 1em">To protect the security of your
control file and passwords the control file must have
read-write permissions no more than 0700 (u=xrw,g=,o=);
Monit will complain and exit <br>
otherwise.</p>

<p style="margin-top: 1em">When there is a conflict between
the command-line arguments and the arguments in this file,
the command-line arguments takes precedence.</p>

<p style="margin-top: 1em">Monit uses its own Domain
Specific Language (DSL); The control file consists of a
series of service entries and global option statements.</p>

<p style="margin-top: 1em">Comments begin with a
&rsquo;#&rsquo; and extend through the end of the line.
Otherwise the file consists of a series of service entries
or global option statements in a free-format, token- <br>
oriented syntax.</p>

<p style="margin-top: 1em">You can use noise keywords like
&rsquo;if&rsquo;, &rsquo;and&rsquo;, &rsquo;with(in)&rsquo;,
&rsquo;has&rsquo;, &rsquo;us(ing|e)&rsquo;,
&rsquo;on(ly)&rsquo;, &rsquo;then&rsquo;, &rsquo;for&rsquo;,
&rsquo;of&rsquo; anywhere in an entry to make it resemble
English. They&rsquo;re ignored, but <br>
can make entries much easier to read at a glance. Keywords
are case insensitive.</p>

<p style="margin-top: 1em">There are three kinds of tokens:
grammar, numbers (i.e. decimal digit sequences) and strings.
Strings can be either quoted or unquoted. A quoted string is
bounded by double <br>
quotes and may contain whitespace (and quoted digits are
treated as a string). An unquoted string is any
whitespace-delimited token, containing characters and/or
numbers.</p>

<p style="margin-top: 1em">On a semantic level, the control
file consists of three types of entries:</p>

<p style="margin-top: 1em">1. Global set-statements <br>
A global set-statement starts with the keyword
&quot;set&quot; and the item to configure.</p>

<p style="margin-top: 1em">2. Global include-statement <br>
The include statement consists of the keyword
&quot;include&quot; and a glob string. This statement is
used to include configure directives from separate
files.</p>

<p style="margin-top: 1em">3. One or more service entry
statements. <br>
Each service entry consists of the keywords
&quot;check&quot;, followed by the service type. Each entry
requires a unique descriptive name, which may be freely
chosen. This name is <br>
used by Monit to refer to the service internally and in all
interactions with the user.</p>

<p style="margin-top: 1em">Currently, nine types of check
statements are supported:</p>

<p style="margin-top: 1em">1. CHECK PROCESS &lt;unique
name&gt; &lt;PIDFILE &lt;path&gt; | MATCHING
&lt;regex&gt;&gt; <br>
&lt;path&gt; is the absolute path to the program&rsquo;s
pid-file. A pid-file is a file, containing a Process&rsquo;s
unique ID. If the pid-file does not exist or does not
contain the PID <br>
number of a running process, Monit will call the
entry&rsquo;s start method if defined.</p>

<p style="margin-top: 1em">&lt;regex&gt; is an alternative
to using PID files and uses process name pattern matching to
find the process to monitor. The first match is used so this
form of check is most <br>
useful if the process name is unique. Pid-file should be
used where possible as it defines expected pid exactly
(pattern matching won&rsquo;t be useful for processes which
start a <br>
child process using fork/clone as the child will match the
same pattern temporarily). You can test if a process match a
pattern from the command-line using &quot;monit procmatch
<br>
&quot;regex-pattern&quot;&quot;. This will lists all
processes matching or not, the regex-pattern.</p>

<p style="margin-top: 1em">2. CHECK FILE &lt;unique
name&gt; PATH &lt;path&gt; <br>
&lt;path&gt; is the absolute path to the file. If the file
does not exist, Monit will call the entry&rsquo;s start
method if defined, if &lt;path&gt; does not point to a
regular file type (for <br>
instance a directory), Monit will disable monitoring of this
entry. If Monit runs in passive mode or the start methods is
not defined, Monit will just send an alert on error.</p>

<p style="margin-top: 1em">3. CHECK FIFO &lt;unique
name&gt; PATH &lt;path&gt; <br>
&lt;path&gt; is the absolute path to the fifo. If the fifo
does not exist, Monit will call the entry&rsquo;s start
method if defined, if &lt;path&gt; does not point to a fifo
type (for <br>
instance a directory), Monit will disable monitoring of this
entry. If Monit runs in passive mode or the start methods is
not defined, Monit will just send an alert on error.</p>

<p style="margin-top: 1em">4. CHECK FILESYSTEM &lt;unique
name&gt; PATH &lt;path&gt; <br>
&lt;path&gt; is the path to the device/disk, mount point,
file or a directory which is part of a filesystem. It is
recommended to use a block special file directly (for
example <br>
/dev/hda1 on Linux or /dev/dsk/c0t0d0s1 on Solaris, etc.) If
you use a mount point (for example /data), note if the
filesystem is unmounted the test will still be true <br>
because the mount point exist.</p>

<p style="margin-top: 1em">If the filesystem becomes
unavailable, Monit will call the entry&rsquo;s start method
if defined. if &lt;path&gt; does not point to a filesystem,
Monit will disable monitoring of this <br>
entry. If Monit runs in passive mode or the start methods is
not defined, Monit will just send an alert on error.</p>

<p style="margin-top: 1em">5. CHECK DIRECTORY &lt;unique
name&gt; PATH &lt;path&gt; <br>
&lt;path&gt; is the absolute path to the directory. If the
directory does not exist, Monit will call the entry&rsquo;s
start method if defined. If &lt;path&gt; does not point to a
directory, <br>
monit will disable monitoring of this entry. If Monit runs
in passive mode or the start methods is not defined, Monit
will just send an alert on error.</p>

<p style="margin-top: 1em">6. CHECK HOST &lt;unique
name&gt; ADDRESS &lt;host address&gt; <br>
The host address can be specified as a hostname string or as
an IP-address string on a dotted decimal format. Such as,
tildeslash.com or &quot;64.87.72.95&quot;.</p>

<p style="margin-top: 1em">7. CHECK SYSTEM &lt;unique
name&gt; <br>
The unique name is usually the local host name, but any
descriptive name can be used. If you use the variable $HOST
as the name, it will expand to the hostname. This check <br>
allows one to monitor general system resources such as CPU
usage, total memory usage or load average. The unique name
is used as the system hostname in mail alerts and as the
<br>
initial name of the host entry in M/Monit.</p>

<p style="margin-top: 1em">8. CHECK PROGRAM &lt;unique
name&gt; PATH &lt;executable file&gt; [TIMEOUT
&lt;number&gt; SECONDS] <br>
&lt;path&gt; is the absolute path to the executable program
or script. The status test allows one to check the
program&rsquo;s exit status. If the program does not finish
executing <br>
within &lt;number&gt; seconds, Monit will terminate it. The
default program timeout is 300 seconds (5 minutes). The
output of the program is recorded and made available in the
User <br>
Interface and in alerts (up to 1kB).</p>

<p style="margin-top: 1em">9. CHECK NETWORK &lt;unique
name&gt; &lt;ADDRESS &lt;ipaddress&gt; | INTERFACE
&lt;name&gt;&gt; <br>
&lt;ipaddress&gt; is the IPv4 or IPv6 address of the
monitored network interface. It is also possible to use
interface name, such as &quot;eth0&quot; on Linux.</p>

<p style="margin-top: 1em">LOGGING <br>
Monit will log status and error messages to a log file. Use
the set logfile statement in the monitrc control file. To
setup Monit to log to its own logfile, use e.g. set logfile
<br>
/var/log/monit.log. If syslog is given as a value for the
&quot;-l&quot; command-line switch (or the keyword set
logfile syslog is found in the control file) Monit will use
the syslog <br>
system daemon to log messages with a priority assigned to
each message based on the context. To turn off logging,
simply do not set the logfile in the control file (and of
<br>
course, do not use the -l switch)</p>

<p style="margin-top: 1em">The format for logfile is:</p>

<p style="margin-top: 1em">[date] priority : message</p>

<p style="margin-top: 1em">for example:</p>

<p style="margin-top: 1em">[CET Jan 5 18:49:29] info :
&rsquo;mymachine&rsquo; Monit started</p>

<p style="margin-top: 1em">DAEMON MODE <br>
Use</p>

<p style="margin-top: 1em">set daemon n (where n is a
number in seconds)</p>

<p style="margin-top: 1em">to specify Monit&rsquo;s poll
cycle length and run Monit in daemon mode. You must specify
a numeric argument which is a polling interval in seconds.
In daemon mode, Monit detaches from <br>
the console, puts itself in the background and runs
continuously, monitoring each specified service and then
goes to sleep for the given poll interval, wakes up and
start <br>
monitoring again in an endless cycle.</p>

<p style="margin-top: 1em">Alternatively, you can use the
&quot;-d&quot; command line switch to set the poll interval,
but it is strongly recommended to set the poll interval in
your ~/.monitrc file, by using set <br>
daemon.</p>

<p style="margin-top: 1em">Monit will then always start in
daemon mode. If you do not use this statement and do not
start monit with the -d option, Monit will just run through
the service checks once and <br>
then exit. This might be useful in some situations, but
Monit is primarily designed to run as a daemon process.</p>

<p style="margin-top: 1em">Calling &quot;monit&quot; with a
Monit daemon running in the background sends a wake-up
signal to the daemon, forcing it to check services
immediately. Calling &quot;monit&quot; with the quit <br>
argument will kill a running Monit daemon process instead of
waking it up.</p>

<p style="margin-top: 1em">INIT SUPPORT <br>
The &quot;set init&quot; statement prevents Monit from
transforming itself into a daemon process. Instead Monit
will run as a foreground process. (You should still use
&quot;set daemon&quot; to <br>
specify the poll cycle).</p>

<p style="margin-top: 1em">This is required to run Monit
from init. Using init to start Monit is probably the best
way to run Monit if you want to be certain that you always
have a running Monit daemon on <br>
your system. Another option is to run Monit from crontab. In
any case, you should make sure that the control file does
not have any syntax errors before you start Monit from init
<br>
or crontab (use &quot;monit -t&quot; to check).</p>

<p style="margin-top: 1em">To setup Monit to run from init,
you can either use the &quot;set init&quot; statement in
Monit&rsquo;s control file or use the &quot;-I&quot; option
from the command line. Here is what you must add to <br>
&quot;/etc/inittab&quot;:</p>

<p style="margin-top: 1em"># Run Monit in standard
run-levels <br>
mo:2345:respawn:/usr/local/bin/monit -Ic /etc/monitrc</p>

<p style="margin-top: 1em">After you have modified
init&rsquo;s configuration file, you can run the following
command to re-examine /etc/inittab and start Monit:</p>

<p style="margin-top: 1em">telinit q</p>

<p style="margin-top: 1em">For systems without telinit:</p>

<p style="margin-top: 1em">kill -1 1</p>

<p style="margin-top: 1em">If Monit is used to monitor
services that are also started at boot time (e.g. services
started via SYSV init rc scripts or via inittab) then, in
some cases, a race condition <br>
could occur. That is; if a service is slow to start, Monit
can assume that the service is not running and possibly try
to start it and raise an alert, while, in fact the service
<br>
is already about to start or already in its startup
sequence. Please see the FAQ for a solution to this problem.
The short version is to start Monit on a higher run-level
after <br>
system processes.</p>

<p style="margin-top: 1em">INCLUDE FILES <br>
The Monit control file, &quot;monitrc&quot;, can include
additional configuration files. This feature helps one to
organize configuration into separate files instead of having
everything <br>
in one file, if you like this kind of thing. Include
statements can be placed at virtually any place in
&quot;monitrc&quot; though the convention is at the bottom.
The syntax is the <br>
following:</p>

<p style="margin-top: 1em">include globstring</p>

<p style="margin-top: 1em">The globstring is any kind of
string as defined in glob(7). Thus, you can refer to a
single file or you can load several files at once. If you
want to use whitespace in your <br>
string the globstring needs to be embedded into quotes
(&rsquo;) or double quotes (&quot;). If the globstring
matches a directory instead of a file, it is silently
ignored.</p>

<p style="margin-top: 1em">Any include statements in an
included file are parsed as in the main control file.</p>

<p style="margin-top: 1em">If the globstring matches
several results, the files are included in a non sorted
manner. If you need to rely on a certain order, you should
avoid wild-card globbing and instead <br>
specify the full path of files included.</p>

<p style="margin-top: 1em">An example,</p>

<p style="margin-top: 1em">include /etc/monit.d/*.cfg</p>

<p style="margin-top: 1em">This will load any file matching
the globstring. That is, all files in /etc/monit.d that ends
with the prefix .cfg.</p>

<p style="margin-top: 1em">MONIT HTTPD <br>
If specified in the control file, Monit will start with http
support. You can then use Monit CLI to start and stop
services, disable or enable service monitoring as well as
view <br>
the status of each service.</p>

<p style="margin-top: 1em">If http support is enabled over
TCP rather than over a Unix Socket, you can also view
Monit&rsquo;s informative dashboard in your web browser.</p>

<p style="margin-top: 1em">Note that if HTTP support is
disabled, the Monit CLI interface will have reduced
functionality, as most CLI commands (such as &quot;monit
status&quot;) need to communicate with the Monit <br>
background process via the the HTTP interface. We strongly
recommend having HTTP support enabled. If security is a
concern, bind the HTTP interface to local host only or use
<br>
Unix Socket so Monit is not accessible from the outside.</p>

<p style="margin-top: 1em">Syntax for TCP port:</p>

<p style="margin-top: 1em">SET HTTPD PORT &lt;number&gt;
[ADDRESS &lt;hostname | IP-address&gt;] <br>
[SSL &lt;ENABLE | DISABLE&gt;] <br>
[PEMFILE &lt;path&gt;] <br>
[CLIENTPEMFILE &lt;path&gt;] <br>
[ALLOWSELFCERTIFICATION] <br>
[SIGNATURE &lt;ENABLE | DISABLE&gt;] <br>
ALLOW &lt;user:password | IP-address | IP-range&gt;+</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">set httpd port 2812 <br>
allow username:password</p>

<p style="margin-top: 1em">You can now use
&lt;http://localhost:2812/&gt; to access Monit&rsquo;s web
interface from a browser, after you have entered username
and password as credentials.</p>

<p style="margin-top: 1em">Syntax for Unix Socket:</p>

<p style="margin-top: 1em">SET HTTPD UNIXSOCKET
&lt;path&gt; <br>
ALLOW &lt;user:password&gt;+</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">set httpd unixsocket
/var/run/monit.sock <br>
allow username:password</p>

<p style="margin-top: 1em">Options:</p>

<p style="margin-top: 1em">UNIXSOCKET set the path to the
Unix Socket Monit should bind to and listen on.</p>

<p style="margin-top: 1em">PORT set the port Monit should
bind to and listen on. Monit is usually setup on port
2812.</p>

<p style="margin-top: 1em">ADDRESS make Monit listen on a
specific interface only. For example if you don&rsquo;t want
to expose Monit&rsquo;s web interface to the network, bind
it to localhost only. Monit will accept <br>
connections on any address by default (if ADDRESS option is
missing).</p>

<p style="margin-top: 1em">For example to limit the web
interface to localhost only:</p>

<p style="margin-top: 1em">set httpd <br>
port 2812 <br>
use address 127.0.0.1 <br>
allow username:password</p>

<p style="margin-top: 1em">SSL enable TLS for Monit&rsquo;s
web interface. The PEMFILE option holds both the
server&rsquo;s private key and certificate. This file should
be stored in a safe place on the filesystem and <br>
should have strict permissions, no more than 0700.</p>

<p style="margin-top: 1em">For example:</p>

<p style="margin-top: 1em">set httpd <br>
port 2812 <br>
ssl enable <br>
pemfile /etc/certs/monit.pem <br>
allow myuser:mypassword</p>

<p style="margin-top: 1em">You can now use
&lt;https://localhost:2812/&gt; to access the Monit web
server over a TLS encrypted connection.</p>

<p style="margin-top: 1em">OpenSSL FIPS is supported. To
enable FIPS mode (provided your OpenSSL library supports
it), add this statement to Monit control file:</p>

<p style="margin-top: 1em">SET FIPS</p>

<p style="margin-top: 1em">CLIENTPEMFILE client certificate
based authentication. A connecting client has to provide a
certificate known to Monit in order to connect. This file
also needs to have all <br>
necessary CA certificates. By default self-signed client
certificates are not allowed. If you want to use a self
signed certificate from a client it has to be allowed
explicitly <br>
with the ALLOWSELFCERTIFICATION statement.</p>

<p style="margin-top: 1em">For example:</p>

<p style="margin-top: 1em">set httpd <br>
port 2812 <br>
ssl enable <br>
pemfile /etc/certs/monit.pem <br>
clientpemfile /etc/certs/monit-client.pem</p>

<p style="margin-top: 1em">SIGNATURE can be used to hide
Monit version from the HTTP response header and error pages.
For example:</p>

<p style="margin-top: 1em">set httpd <br>
port 2812 <br>
signature disable <br>
allow myuser:mypassword</p>

<p style="margin-top: 1em">Authentication <br>
Access to the Monit web interface is controlled primarily
via the ALLOW option which is used to specify authentication
and authorize only specific clients to connect.</p>

<p style="margin-top: 1em">If the Monit command line
interface is being used, at least one cleartext password is
necessary (see bellow), otherwise the Monit command line
interface will not be able to <br>
connect to the Monit web interface.</p>

<p style="margin-top: 1em">Clients trying to connect to
Monit, but submit a wrong username and/or password are
logged with their IP-address.</p>

<p style="margin-top: 1em">Client certificates</p>

<p style="margin-top: 1em">This authentication method is a
strong authentication mechanism and employ HTTPS client
certificates to verify the authenticity of a connecting
client. Clients must posses a <br>
Public Key Certificate known by Monit. The client must
connect to Monit over SSL and Monit ask the client to send
its certificate. Upon receiving the certificate Monit
compares <br>
the certificate to certificates located in the CLIENTPEMFILE
file. Access is granted if the client certificate is in this
file. See CLIENTPEMFILE above for details.</p>

<p style="margin-top: 1em">Host and network allow list</p>

<p style="margin-top: 1em">Monit maintains an
access-control list of hosts and networks allowed to
connect. You can add as many hosts as you want to, but only
hosts with a valid domain name or its IP <br>
address are allowed.</p>

<p style="margin-top: 1em">Monit will query a name server
to check any hosts trying to connect. If a host (client) is
trying to connect, but cannot be found in the access list or
cannot be resolved, Monit <br>
will shutdown the connection to the client promptly.</p>

<p style="margin-top: 1em">Control file example:</p>

<p style="margin-top: 1em">set httpd port 2812 <br>
allow localhost <br>
allow my.other.work.machine.com <br>
allow 10.1.1.1 <br>
allow 192.168.1.0/255.255.255.0 <br>
allow 10.0.0.0/8</p>

<p style="margin-top: 1em">Clients, not mentioned in the
allow list, trying to connect to Monit will be denied access
and are logged with their IP-address.</p>

<p style="margin-top: 1em">Basic Authentication</p>

<p style="margin-top: 1em">Monit supports Basic
Authentication as described in RFC 2617.</p>

<p style="margin-top: 1em">In short; a server challenge a
client (e.g. a Browser) to send authentication information
(username and password) and if accepted, the server will
allow the client access to the <br>
requested document.</p>

<p style="margin-top: 1em">The biggest weakness with Basic
Authentication is that username and password is sent in
clear-text over the network (i.e. base64 encoded). It is
therefor recommended that you do <br>
not use this authentication method unless you run Monit with
ssl support. With ssl, it is safe to use Basic
Authentication since all http data, including Basic
Authentication <br>
headers will be encrypted.</p>

<p style="margin-top: 1em">Cleartext user and password</p>

<p style="margin-top: 1em">Monit will use Basic
Authentication if an allow statement contains a username and
a password separated with a single &rsquo;:&rsquo;
character. Special characters can be used, but for non- <br>
alphanumerics the password has to be quoted.</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">ALLOW
&lt;username&gt;:&lt;password&gt;</p>

<p style="margin-top: 1em">PAM</p>

<p style="margin-top: 1em">PAM is supported on platforms
which provide PAM (such as Linux, Mac OS X, FreeBSD,
NetBSD).</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">ALLOW @&lt;group&gt;</p>

<p style="margin-top: 1em">where &quot;group&quot; is the
group name allowed to access Monit&rsquo;s web interface.
Monit uses a PAM service called monit for PAM
authentication, see the PAM manual page for detailed <br>
instructions on how to set the PAM service and PAM
authentication plugins.</p>

<p style="margin-top: 1em">Sample PAM service for Monit on
Mac OS X (store as &quot;/etc/pam.d/monit&quot; file):</p>

<p style="margin-top: 1em"># monit: auth account password
session <br>
auth sufficient pam_securityserver.so <br>
auth sufficient pam_unix.so <br>
auth required pam_deny.so <br>
account required pam_permit.so</p>

<p style="margin-top: 1em">And monitrc config which only
allows group &quot;admin&quot; authenticated via PAM to
access the web interface:</p>

<p style="margin-top: 1em">set httpd <br>
port 2812 <br>
allow @admin</p>

<p style="margin-top: 1em">htpasswd file</p>

<p style="margin-top: 1em">Alternatively you can use files
in &quot;htpasswd&quot; format (one user:passwd entry per
line), like so: allow [cleartext|crypt|md5] /path [users].
By default cleartext passwords are <br>
read. In case the passwords are digested it is necessary to
specify the cryptographic method. If you do not want all
users in the password file to have access to Monit you can
<br>
specify only those users that should have access, in the
allow statement. Otherwise all users are added.</p>

<p style="margin-top: 1em">Example1:</p>

<p style="margin-top: 1em">set httpd port 2812 <br>
allow hauk:password <br>
allow md5 /etc/httpd/htpasswd john paul ringo george</p>

<p style="margin-top: 1em">If you use this method together
with a host list, then only clients from the listed hosts
will be allowed to connect to the Monit http server and each
client will be asked to <br>
provide a username and a password.</p>

<p style="margin-top: 1em">Example2:</p>

<p style="margin-top: 1em">set httpd port 2812 <br>
allow localhost <br>
allow 10.1.1.1 <br>
allow hauk:&quot;passw@rd&quot;</p>

<p style="margin-top: 1em">If you only want to use Basic
Authentication, then just provide allow entries with
username and password or password files as in example 1
above.</p>

<p style="margin-top: 1em">Read-only users</p>

<p style="margin-top: 1em">Finally it is possible to define
some users as read-only. A read-only user can read the Monit
web pages but will not get access to push-buttons and cannot
change a service from <br>
the web interface.</p>

<p style="margin-top: 1em">set httpd port 2812 <br>
allow admin:password <br>
allow hauk:password read-only <br>
allow @admins <br>
allow @users read-only</p>

<p style="margin-top: 1em">A user is set to read-only by
using the read-only keyword after username:password. In the
above example the user hauk is defined as a read-only user,
while the admin user has all <br>
access rights.</p>

<p style="margin-top: 1em">ALERT MESSAGES <br>
Monit will raise an alert in the following situations:</p>

<p style="margin-top: 1em">o A service does not exist (e.g.
process is not running) <br>
o Cannot read service data (e.g. cannot get filesystem
usage) <br>
o Execution of a service related script failed (e.g. start
failed) <br>
o Invalid service type (e.g. if path points to directory
instead of file) <br>
o Custom test script returned error <br>
o Ping test failed <br>
o TCP/UDP connection and/or port test failed <br>
o Resource usage test failed (e.g. cpu usage too high) <br>
o Checksum mismatch or change (e.g. file changed) <br>
o File size test failed (e.g. file too large) <br>
o Timestamp test failed (e.g. file is older then expected)
<br>
o Permission test failed (e.g. file mode doesn&rsquo;t
match) <br>
o An UID test failed (e.g. file owned by different user)
<br>
o A GID test failed (e.g. file owned by different group)
<br>
o A process&rsquo; PID changed out of Monit&rsquo;s control
<br>
o A process&rsquo; PPID changed out of Monit control <br>
o Too many service recovery attempts failed <br>
o A file content test found a match <br>
o Filesystem flags changed <br>
o A service action was performed by administrator <br>
o A network link failed <br>
o A network link capacity changed <br>
o A network link saturation failed <br>
o A network link upload/download rate failed <br>
o Monit was started, stopped or reloaded</p>

<p style="margin-top: 1em">To get an alert via e-mail, set
the alert target using the global &quot;set alert&quot;
statement (for all services) or the &quot;alert&quot;
statement in the context of a service entry (for a <br>
single service).</p>

<p style="margin-top: 1em">Setting an alert recipient <br>
If an event occurs, Monit will send an alert. There are two
kinds of alert statement: global and local.</p>

<p style="margin-top: 1em">Global syntax:</p>

<p style="margin-top: 1em">SET ALERT mail-address [[NOT]
{event, ...}] [REMINDER cycles]</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">set alert foo@bar</p>

<p style="margin-top: 1em">will send a default email to the
address foo@bar whenever any event occurs on any
service.</p>

<p style="margin-top: 1em">If you want to send alert
messages to more email addresses, add a &quot;set alert
&rsquo;email&rsquo;&quot; statement for each address.</p>

<p style="margin-top: 1em">It is also possible to use the
local alert statement in the context of a service check to
enable alert for the given service only:</p>

<p style="margin-top: 1em">ALERT mail-address [[NOT]
{event, ...}] [REMINDER cycles]</p>

<p style="margin-top: 1em">Local alert example:</p>

<p style="margin-top: 1em">check host myhost with address
1.2.3.4 <br>
if failed port 3306 protocol mysql then alert <br>
if failed port 80 protocol http then alert <br>
alert foo@baz # Local service alert</p>

<p style="margin-top: 1em">You can combine global and local
alert statements. If there is a conflict, the local alert
has precedence and overrides the global statement.</p>

<p style="margin-top: 1em">Setting an event filter</p>

<p style="margin-top: 1em">If you only want an alert
message sent for certain events, list them in an
&quot;{event, ...}&quot; block, e.g.:</p>

<p style="margin-top: 1em">set alert foo@bar only on {
timeout, nonexist }</p>

<p style="margin-top: 1em">The event list can also be
negated to send alerts for all events except those which are
listed, by prepending the list with the word
&quot;not&quot;. For example, to receive all alerts <br>
except notification about Monit program start and stop:</p>

<p style="margin-top: 1em">set alert foo@bar but not on {
instance }</p>

<p style="margin-top: 1em">Here is a list of all possible
event types emitted by Monit. Values from the first column
can be used in the event filter list mentioned above:</p>

<p style="margin-top: 1em">Event: | Failure state: |
Success state: <br>

---------------------------------------------------------------------
<br>
action | &quot;Action done&quot; | &quot;Action done&quot;
<br>
checksum | &quot;Checksum failed&quot; | &quot;Checksum
succeeded&quot; <br>
bytein | &quot;Download bytes exceeded&quot; |
&quot;Download bytes ok&quot; <br>
byteout | &quot;Upload bytes exceeded&quot; | &quot;Upload
bytes ok&quot; <br>
connection | &quot;Connection failed&quot; |
&quot;Connection succeeded&quot; <br>
content | &quot;Content failed&quot;, | &quot;Content
succeeded&quot; <br>
data | &quot;Data access error&quot; | &quot;Data access
succeeded&quot; <br>
exec | &quot;Execution failed&quot; | &quot;Execution
succeeded&quot; <br>
fsflags | &quot;Filesystem flags failed&quot; |
&quot;Filesystem flags succeeded&quot; <br>
gid | &quot;GID failed&quot; | &quot;GID succeeded&quot;
<br>
icmp | &quot;Ping failed&quot; | &quot;Ping succeeded&quot;
<br>
instance | &quot;Monit instance changed&quot; | &quot;Monit
instance changed not&quot; <br>
invalid | &quot;Invalid type&quot; | &quot;Type
succeeded&quot; <br>
link | &quot;Link down&quot; | &quot;Link up&quot; <br>
nonexist | &quot;Does not exist&quot; | &quot;Exists&quot;
<br>
packetin | &quot;Download packets exceeded&quot; |
&quot;Download packets ok&quot; <br>
packetout | &quot;Upload packets exceeded&quot; |
&quot;Upload packets ok&quot; <br>
permission | &quot;Permission failed&quot; |
&quot;Permission succeeded&quot; <br>
pid | &quot;PID failed&quot; | &quot;PID succeeded&quot;
<br>
ppid | &quot;PPID failed&quot; | &quot;PPID succeeded&quot;
<br>
resource | &quot;Resource limit matched&quot; |
&quot;Resource limit succeeded&quot; <br>
saturation | &quot;Saturation exceeded&quot; |
&quot;Saturation ok&quot; <br>
size | &quot;Size failed&quot; | &quot;Size succeeded&quot;
<br>
speed | &quot;Speed failed&quot; | &quot;Speed ok&quot; <br>
status | &quot;Status failed&quot; | &quot;Status
succeeded&quot; <br>
timeout | &quot;Timeout&quot; | &quot;Timeout recovery&quot;
<br>
timestamp | &quot;Timestamp failed&quot; | &quot;Timestamp
succeeded&quot; <br>
uid | &quot;UID failed&quot; | &quot;UID succeeded&quot;
<br>
uptime | &quot;Uptime failed&quot; | &quot;Uptime
succeeded&quot;</p>

<p style="margin-top: 1em">Each alert recipient can have
it&rsquo;s own filter, for example:</p>

<p style="margin-top: 1em">set alert foo@bar { nonexist,
timeout, resource, icmp, connection } <br>
set alert security@bar on { checksum, permission, uid, gid }
<br>
set alert admin@bar</p>

<p style="margin-top: 1em">Setting an error reminder</p>

<p style="margin-top: 1em">Monit by default sends just one
notification if a service failed and another when/if it
recover. If you want to be notified that the service is
still in a failed state, you can <br>
use the reminder option in the alert statement:</p>

<p style="margin-top: 1em">SET ALERT mail-address [WITH]
REMINDER [ON] number [CYCLES]</p>

<p style="margin-top: 1em">For example if you want to be
notified each tenth cycle if a service remains in a failed
state, you can use:</p>

<p style="margin-top: 1em">alert foo@bar with reminder on
10 cycles</p>

<p style="margin-top: 1em">Likewise if you want to be
notified on each failed cycle, you can use:</p>

<p style="margin-top: 1em">alert foo@bar with reminder on 1
cycle</p>

<p style="margin-top: 1em">Disabling alerts for some
service <br>
To suppress alerts for some user and service, add the
&quot;noalert&quot; statement in the context of a service
check.</p>

<p style="margin-top: 1em">NOALERT mail-address</p>

<p style="margin-top: 1em">Example (send all alerts to
foo@bar except for service p3):</p>

<p style="margin-top: 1em">set alert foo@bar</p>

<p style="margin-top: 1em">check process p1 with pidfile
/var/run/p1.pid</p>

<p style="margin-top: 1em">check process p2 with pidfile
/var/run/p2.pid</p>

<p style="margin-top: 1em">check process p3 with pidfile
/var/run/p3.pid <br>
noalert foo@bar</p>

<p style="margin-top: 1em">Message format <br>
The alert message format can be modified by using the
&quot;set mail-format&quot; statement:</p>

<p style="margin-top: 1em">SET MAIL-FORMAT
{mail-format}</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">set mail-format { <br>
from: monit@foo.bar <br>
reply-to: support@domain.com <br>
subject: $SERVICE $EVENT at $DATE <br>
message: Monit $ACTION $SERVICE at $DATE on $HOST:
$DESCRIPTION. <br>
Yours sincerely, <br>
monit <br>
}</p>

<p style="margin-top: 1em">The from: option is the
sender&rsquo;s email address. That is, the email address
Monit will pretend it is sending alerts from. It does not
have to be a real email-address only a proper <br>
formatted address.</p>

<p style="margin-top: 1em">The reply-to: option can be used
to set the reply-to mail header.</p>

<p style="margin-top: 1em">The subject: option sets the
message subject and must be on only one line.</p>

<p style="margin-top: 1em">The message: option sets the
mail body. This option should always be the last in a
mail-format statement. The mail body can be as long as
needed, but must not contain the block- <br>
closing &rsquo;}&rsquo; character.</p>

<p style="margin-top: 1em">You need not use all options,
only the option which you want to override. For example to
globally change the senders address only:</p>

<p style="margin-top: 1em">set mail-format { from:
bofh@foo.bar }</p>

<p style="margin-top: 1em">The subject and body may contain
$NAME variables, which are expanded by Monit. Here is a list
of variables that can be used when composing an alert
message.</p>

<p style="margin-top: 1em">&Acirc;&middot; $EVENT</p>

<p style="margin-top: 1em">A string describing the event
that occurred.</p>

<p style="margin-top: 1em">&Acirc;&middot; $SERVICE</p>

<p style="margin-top: 1em">The service name</p>

<p style="margin-top: 1em">&Acirc;&middot; $DATE</p>

<p style="margin-top: 1em">The current time and date (RFC
822 date style).</p>

<p style="margin-top: 1em">&Acirc;&middot; $HOST</p>

<p style="margin-top: 1em">The name of the host Monit is
running on</p>

<p style="margin-top: 1em">&Acirc;&middot; $ACTION</p>

<p style="margin-top: 1em">The name of the action which was
done by Monit.</p>

<p style="margin-top: 1em">&Acirc;&middot; $DESCRIPTION</p>

<p style="margin-top: 1em">The description of the error
condition</p>

<p style="margin-top: 1em">Setting a mail server for alert
delivery <br>
The mail server Monit should use to send alert messages is
defined with a &quot;set mailserver&quot; statement:</p>

<p style="margin-top: 1em">SET MAILSERVER
&lt;hostname|ip-address [PORT number] [USERNAME string] <br>
[PASSWORD string] [using
SSLAUTO|SSLV2|SSLV3|TLSV1|TLSV11|TLSV12] <br>
[CERTMD5 checksum]&gt;, ... <br>
[with TIMEOUT X SECONDS] <br>
[using HOSTNAME hostname]</p>

<p style="margin-top: 1em">Multiple mail servers can be set
by using a comma separated list. If Monit cannot connect to
the first server, it will try the next in the list and so
on.</p>

<p style="margin-top: 1em">The port statement allows to
override the default SMTP port (465 for SSL, or 25 for TLS
and non secure connection).</p>

<p style="margin-top: 1em">Monit supports AUTH PLAIN and
AUTH LOGIN for SMTP authentication. You can set a username
and a password using the USERNAME and PASSWORD options.</p>

<p style="margin-top: 1em">You can enable SSL or TLS with
optional certificate checksum.</p>

<p style="margin-top: 1em">The default connection timeout
is 5 seconds. You can rise this limit using the TIMEOUT
option.</p>

<p style="margin-top: 1em">Example (setting two mail
servers for failover):</p>

<p style="margin-top: 1em">set mailserver smtp.gmail.com,
smtp.other.host</p>

<p style="margin-top: 1em">By default, Monit uses the local
host name in SMTP HELO/EHLO and in the Message-ID header.
You can override this using the HOSTNAME option.</p>

<p style="margin-top: 1em">Event queue <br>
If no mail server is available, Monit can queue events in
the local file-system for retry until the mail server
recovers.</p>

<p style="margin-top: 1em">If Monit is used with M/Monit,
the event queue provides a safe event store for M/Monit in
the case of temporary problems.</p>

<p style="margin-top: 1em">The event queue is persistent
across Monit restarts and provided that the back-end
filesystem is persistent, across system restart as well.</p>

<p style="margin-top: 1em">By default, the queue is
disabled and if the alert handler fails, Monit will simply
drop the alert message.</p>

<p style="margin-top: 1em">To enable the event queue, add
the following statement:</p>

<p style="margin-top: 1em">SET EVENTQUEUE BASEDIR
&lt;path&gt; [SLOTS &lt;number&gt;]</p>

<p style="margin-top: 1em">The &lt;path&gt; is the path to
the directory where events will be stored.</p>

<p style="margin-top: 1em">Optionally if you want to limit
the queue size, use the slots option to only store up to
number event messages.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">set eventqueue basedir
/var/monit slots 5000</p>

<p style="margin-top: 1em">If you are running more then one
Monit instance on the same machine, you must use separated
event queue directories.</p>

<p style="margin-top: 1em">SERVICE METHODS <br>
Each service can have associated start, stop and restart
methods which Monit can use to execute action on the
service.</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">&lt;START | STOP | RESTART&gt;
[PROGRAM] = &quot;program&quot; <br>
[[AS] UID &lt;number | string&gt;] <br>
[[AS] GID &lt;number | string&gt;] <br>
[[WITH] TIMEOUT &lt;number&gt; SECOND(S)]</p>

<p style="margin-top: 1em">If the &quot;program&quot; is a
shell script it must begin with &quot;#!&quot; and the
remainder of the first line must specify an interpreter for
the program. e.g. &quot;#!/bin/sh&quot;</p>

<p style="margin-top: 1em">The &quot;program&quot; must
also be executable (for example mode 0755).</p>

<p style="margin-top: 1em">It&rsquo;s possible to write
scripts directly into the program this way:</p>

<p style="margin-top: 1em">stop = &quot;/bin/bash -c
&rsquo;kill -s SIGTERM &lsquo;cat
/var/run/process.pid&lsquo;&rsquo;&quot;</p>

<p style="margin-top: 1em">By default the program is
executed as the user under which Monit is running. If Monit
is running as root, you may optionally specify the UID and
GID the executed program should <br>
switch to.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">check process mmonit with
pidfile /usr/local/mmonit/mmonit/logs/mmonit.pid <br>
start program = &quot;/usr/local/mmonit/bin/mmonit&quot; as
uid &quot;mmonit&quot; and gid &quot;mmonit&quot; <br>
stop program = &quot;/usr/local/mmonit/bin/mmonit stop&quot;
as uid &quot;mmonit&quot; and gid &quot;mmonit&quot;</p>

<p style="margin-top: 1em">In the case of a process check,
Monit will wait up to 30 seconds for the start/stop action
to finish before giving up and report an error. You can
override this timeout using <br>
the TIMEOUT option.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">check process foobar with
pidfile /var/run/foobar.pid <br>
start program = &quot;/etc/init.d/foobar start&quot; with
timeout 60 seconds <br>
stop program = &quot;/etc/init.d/foobar stop&quot;</p>

<p style="margin-top: 1em">SERVICE POLL TIME <br>
Services are checked in regular intervals by the &quot;set
daemon n&quot; statement. Checks are performed in the same
order as they are written in the &quot;.monitrc&quot; file,
except if <br>
dependencies are setup between services.</p>

<p style="margin-top: 1em">It is possible to modify a
service check schedule by using the &quot;every&quot;
statement.</p>

<p style="margin-top: 1em">There are three variants:</p>

<p style="margin-top: 1em">1. custom interval based on a
poll cycle multiple <br>
EVERY [number] CYCLES</p>

<p style="margin-top: 1em">2. check is schedule based on a
cron-style string <br>
EVERY [cron]</p>

<p style="margin-top: 1em">3. do-not-check schedule based
on a cron-style string <br>
NOT EVERY [cron]</p>

<p style="margin-top: 1em">A cron-style string, consist of
5 fields separated with white-space. All fields are
required:</p>

<p style="margin-top: 1em">Name: | Allowed values: |
Special characters: <br>

---------------------------------------------------------------
<br>
Minutes | 0-59 | * - , <br>
Hours | 0-23 | * - , <br>
Day of month | 1-31 | * - , <br>
Month | 1-12 (1=jan, 12=dec) | * - , <br>
Day of week | 0-6 (0=sunday, 6=saturday) | * - ,</p>

<p style="margin-top: 1em">The special characters:</p>

<p style="margin-top: 1em">Character: | Description: <br>

---------------------------------------------------------------
<br>
* (asterisk) | The asterisk indicates that the expression
will <br>
| match for all values of the field; e.g., using <br>
| an asterisk in the 4th field (month) would <br>
| indicate every month. <br>
- (hyphen) | Hyphens are used to define ranges. For example,
<br>
| 8-9 in the hour field indicate between 8AM and <br>
| 9AM. Note that range is from start time until and <br>
| including end time. That is, from 8AM and until <br>
| 10AM unless minutes are set. Another example, <br>
| 1-5 in the weekday field, specify from monday to <br>
| friday (including friday). <br>
, (comma) | Comma are used to specify a sequence. For
example <br>
| 17,18 in the day field indicate the 17th and 18th <br>
| day of the month. A sequence can also include <br>
| ranges. For example, using 1-5,0 in the weekday <br>
| field indicate monday to friday and sunday.</p>

<p style="margin-top: 1em">Example 1: Check once per two
cycles</p>

<p style="margin-top: 1em">check process nginx with pidfile
/var/run/nginx.pid <br>
every 2 cycles</p>

<p style="margin-top: 1em">Example 2: Check every workday
8AM-7PM</p>

<p style="margin-top: 1em">check program
checkOracleDatabase <br>
with path /var/monit/programs/checkoracle.pl <br>
every &quot;* 8-19 * * 1-5&quot;</p>

<p style="margin-top: 1em">Example 3: Do not run the check
in the backup window on Sunday 0AM-3AM</p>

<p style="margin-top: 1em">check process mysqld with
pidfile /var/run/mysqld.pid <br>
not every &quot;* 0-3 * * 0&quot;</p>

<p style="margin-top: 1em">Limitations:</p>

<p style="margin-top: 1em">The current scheduler is poll
cycle based. When a service check is constraint with the
every cron statement, Monit will check whether the current
time match the cron-string <br>
pattern. If it does, the check is performed, otherwise it is
skipped. The cron specification thus does not guarantee when
exactly the test will run, this depends on the default <br>
poll time and the length of the check cycle. In other words,
we cannot guarantee that Monit will run on a specific time.
Therefor we strongly recommend to use an asterix in the <br>
minute field or at minimum a range, e..g. 0-15. Never use a
specific minute as Monit may not run on that minute.</p>

<p style="margin-top: 1em">We will address this limitation
in a future release and convert the scheduler from serial
polling into a parallel non-blocking scheduler where checks
are guaranteed to run on <br>
time and with seconds resolution.</p>

<p style="margin-top: 1em">SERVICE GROUPS <br>
Service entries in the control file, monitrc, can be grouped
together by the group statement. The syntax is simply
(keyword in capital):</p>

<p style="margin-top: 1em">GROUP groupname</p>

<p style="margin-top: 1em">With this statement it is
possible to group similar service entries together and
manage them as a whole. Monit provides functions to start,
stop, restart, monitor and unmonitor a <br>
group of services, like so:</p>

<p style="margin-top: 1em">To start a group of services
from the console:</p>

<p style="margin-top: 1em">monit -g &lt;groupname&gt;
start</p>

<p style="margin-top: 1em">To stop a group of services:</p>

<p style="margin-top: 1em">monit -g &lt;groupname&gt;
stop</p>

<p style="margin-top: 1em">To restart a group of
services:</p>

<p style="margin-top: 1em">monit -g &lt;groupname&gt;
restart</p>

<p style="margin-top: 1em">A service can be added to
multiple groups by using more than one group statement:</p>

<p style="margin-top: 1em">group www <br>
group filesystem</p>

<p style="margin-top: 1em">SERVICE MONITORING MODE <br>
Monit supports three monitoring modes per service: active,
passive and manual.</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">MODE &lt;ACTIVE | PASSIVE |
MANUAL&gt;</p>

<p style="margin-top: 1em">In active mode (the default),
Monit will pro-actively monitor a service and in case of
problems raise alerts and/or restart the service.</p>

<p style="margin-top: 1em">In passive mode, Monit will
passively monitor a service and will raise alerts, but will
not try to fix a problem by executing start, stop or
restart.</p>

<p style="margin-top: 1em">In manual mode, Monit will enter
active mode only if a service was started via Monit:</p>

<p style="margin-top: 1em">monit start
&lt;servicename&gt;</p>

<p style="margin-top: 1em">Use &quot;monit stop
&lt;servicename&gt;&quot; to stop the service and take it
out of Monit&rsquo;s control. The manual mode can be used to
build a simple cluster with active/passive HA-services.</p>

<p style="margin-top: 1em">A service&rsquo;s monitoring
state is persistent across Monit restart.</p>

<p style="margin-top: 1em">If you use Monit in a HA-cluster
you should place the Monit state file in a temporary
filesystem so if the machine which runs HA-services should
crash and the stand-by machine <br>
take over its services, the HA-services won&rsquo;t be
started after the crashed node will boot again:</p>

<p style="margin-top: 1em">set statefile
/tmp/monit.state</p>

<p style="margin-top: 1em">SERVICE RESTART LIMIT <br>
Monit provides a restart limit mechanism for situations
where a service simply refuses to start or respond over a
longer period.</p>

<p style="margin-top: 1em">The restart limit mechanism is
based on number of service restarts and number of
poll-cycles. For example, if a service had x restarts within
y poll-cycles (where x &lt;= y) then <br>
Monit will perform an action (for example unmonitor the
service). If a timeout occurs, Monit will send an alert
message if you have register interest for this event.</p>

<p style="margin-top: 1em">The syntax for the timeout
statement is as follows (keywords are in capital):</p>

<p style="margin-top: 1em">IF &lt;number&gt; RESTART
&lt;number&gt; CYCLE(S) THEN &lt;action&gt;</p>

<p style="margin-top: 1em">The action value is either one
of common actions or TIMEOUT (for backward compatibility,
equals to UNMONITOR action).</p>

<p style="margin-top: 1em">Here is an example where Monit
will unmonitor the service if it was restarted 2 times
within 3 cycles:</p>

<p style="margin-top: 1em">if 2 restarts within 3 cycles
then unmonitor</p>

<p style="margin-top: 1em">To have Monit check the service
again after monitoring was disabled, run &quot;monit monitor
servicename&quot; from the command line.</p>

<p style="margin-top: 1em">Example for setting custom exec
on timeout:</p>

<p style="margin-top: 1em">if 5 restarts within 5 cycles
then exec &quot;/foo/bar&quot;</p>

<p style="margin-top: 1em">Example for stopping the
service:</p>

<p style="margin-top: 1em">if 7 restarts within 10 cycles
then stop</p>

<p style="margin-top: 1em">SERVICE DEPENDENCIES <br>
If specified in the control file, Monit can do dependency
checking before start, stop, monitoring or unmonitoring of
services. The dependency statement may be used within any
<br>
service entries in the Monit control file.</p>

<p style="margin-top: 1em">The syntax for the depend
statement is simply:</p>

<p style="margin-top: 1em">DEPENDS on service[, service
[,...]]</p>

<p style="margin-top: 1em">Where service is a check service
entry name used in your &quot;.monitrc&quot; file, for
instance apache or datafs.</p>

<p style="margin-top: 1em">You may add more than one
service name of any type or use more than one depend
statement in an entry.</p>

<p style="margin-top: 1em">Services specified in a depend
statement will be checked during
stop/start/monitor/unmonitor operations. If a service is
stopped or unmonitored it will stop/unmonitor any <br>
services that depends on itself. Likewise, if a service is
started, it will first stop any services that depends on
itself and after it is started, start all depending services
<br>
again. If the service is to be monitored (enable
monitoring), all services which this service depends on will
be monitored before enabling monitoring of this service.</p>

<p style="margin-top: 1em">Here is an example where we set
up an apache service entry to depend on the underlying
apache binary. If the binary should change an alert is sent
and apache is not monitored <br>
anymore. The rationale is security and that Monit should not
execute a possibly cracked apache binary.</p>

<p style="margin-top: 1em">(1) check process apache <br>
(2) with pidfile
&quot;/usr/local/apache/logs/httpd.pid&quot; <br>
(3) ... <br>
(4) depends on httpd <br>
(5) <br>
(6) check file httpd with path /usr/local/apache/bin/httpd
<br>
(7) if failed checksum then unmonitor</p>

<p style="margin-top: 1em">The first entry is the process
entry for apache (abbreviated for clarity). The fourth line
sets up a dependency between this entry and the service
entry named httpd in line 6. A <br>
dependency tree works as follows, if an action is conducted
in a lower branch it will propagate upward in the tree and
for every dependent entry execute the same action. In this
<br>
case, if the checksum should fail in line 7 then an
unmonitor action is executed and the apache binary is not
checked anymore. But since the apache process entry depends
on the <br>
httpd entry this entry will also execute the unmonitor
action. In short, if the checksum test for the httpd binary
file should fail, both the check file httpd entry and the
check <br>
process apache entry is set in un-monitoring mode.</p>

<p style="margin-top: 1em">A dependency tree is a general
construct and can be used between all types of service
entries and span many levels and propagate any supported
action (except the exec action <br>
which will not propagate upward in a dependency tree for
obvious reasons).</p>

<p style="margin-top: 1em">Here is another different
example. Consider the following common server setup:</p>

<p style="margin-top: 1em">WEB-SERVER -&gt;
APPLICATION-SERVER -&gt; DATABASE -&gt; FILESYSTEM <br>
(a) (b) (c) (d)</p>

<p style="margin-top: 1em">You can set dependencies so that
the web-server depends on the application server to run
before the web-server starts and the application server
depends on the database server <br>
and the database depends on the file-system to be mounted
before it starts. See also the example section below for
examples using the depend statement.</p>

<p style="margin-top: 1em">Here we describe how Monit will
function with the above dependencies:</p>

<p style="margin-top: 1em">If no servers are running <br>
Monit will start the servers in the following order: d, c,
b, a</p>

<p style="margin-top: 1em">If all servers are running <br>
When you run &rsquo;Monit stop all&rsquo; this is the stop
order: a, b, c, d. If you run &rsquo;Monit stop d&rsquo;
then a, b and c are also stopped because they depend on d
and finally d is <br>
stopped.</p>

<p style="margin-top: 1em">If a does not run <br>
When Monit runs it will start a</p>

<p style="margin-top: 1em">If b does not run <br>
When Monit runs it will first stop a then start b and
finally start a again.</p>

<p style="margin-top: 1em">If c does not run <br>
When Monit runs it will first stop a and b then start c and
finally start b then a.</p>

<p style="margin-top: 1em">If d does not run <br>
When Monit runs it will first stop a, b and c then start d
and finally start c, b then a.</p>

<p style="margin-top: 1em">If the control file contains a
depend loop. <br>
A depend loop is for example; a-&gt;b and b-&gt;a or
a-&gt;b-&gt;c-&gt;a.</p>

<p style="margin-top: 1em">When Monit starts it will check
for such loops and complain and exit if a loop was found. It
will also exit with a complaint if a depend statement was
used that does not <br>
point to a service in the control file.</p>

<p style="margin-top: 1em">SERVICE TESTS <br>
GENERAL SYNTAX</p>

<p style="margin-top: 1em">Monit provides several tests you
can use in a &rsquo;check&rsquo; statement to test a
service.</p>

<p style="margin-top: 1em">You can test either for some
expected value or range and take actions if the value
changed.</p>

<p style="margin-top: 1em">General syntax for testing a
specific value or range:</p>

<p style="margin-top: 1em">IF &lt;TEST&gt; THEN ACTION
[ELSE IF SUCCEEDED THEN ACTION]</p>

<p style="margin-top: 1em">The action is evaluated each
time the &lt;TEST&gt; condition is true. Success action is
optional and executed only when the state changes from
failure to success. If success action is <br>
not set, Monit will send a recovery alert by default.</p>

<p style="margin-top: 1em">General syntax for a value
change test:</p>

<p style="margin-top: 1em">IF CHANGED &lt;TEST&gt; THEN
ACTION</p>

<p style="margin-top: 1em">The action is executed each time
the value changes. Monit will remember the new value and
will trigger event if the value change again.</p>

<p style="margin-top: 1em">ACTION</p>

<p style="margin-top: 1em">In each test you must select the
action to be executed from this list:</p>

<p style="margin-top: 1em">&Acirc;&middot; ALERT sends the
user an alert event on each state change.</p>

<p style="margin-top: 1em">&Acirc;&middot; RESTART restarts
the service and send an alert. Restart is performed by
calling the service&rsquo;s registered restart method or by
first calling the stop method followed by the <br>
start method if restart is not set.</p>

<p style="margin-top: 1em">&Acirc;&middot; START starts the
service by calling the service&rsquo;s registered start
method and send an alert.</p>

<p style="margin-top: 1em">&Acirc;&middot; STOP stops the
service by calling the service&rsquo;s registered stop
method and send an alert. If Monit stops a service it will
not be checked by Monit anymore nor restarted again <br>
later. To reactivate monitoring of the service again you
must explicitly enable monitoring from the web interface or
from the console.</p>

<p style="margin-top: 1em">&Acirc;&middot; EXEC can be used
to execute an arbitrary program and send an alert. If you
choose this action you must state the program to be executed
and if the program require arguments <br>
you must enclose the program and its arguments in a quoted
string. You may optionally specify the uid and gid the
executed program should switch to upon start. For
instance:</p>

<p style="margin-top: 1em">exec
&quot;/usr/local/tomcat/bin/startup.sh&quot; <br>
as uid nobody and gid nobody</p>

<p style="margin-top: 1em">Remember, if Monit is run by
root, then all programs executed by Monit will be started
with superuser privileges unless the uid and gid extension
is used.</p>

<p style="margin-top: 1em">&Acirc;&middot; UNMONITOR will
disable monitoring of the service and send an alert. The
service will not be checked by Monit anymore nor restarted
again later. To reactivate monitoring of <br>
the service you must explicitly enable monitoring from the
web interface or from the console.</p>

<p style="margin-top: 1em">FAILURE TOLERANCE</p>

<p style="margin-top: 1em">By default the action is
executed if it matches and the service set in an error
state. However, you can require a test to fail more than
once before the error event is triggered <br>
and the service state changed to failed. This is useful to
avoid getting alerts on spurious errors, which can happen,
especially with network tests.</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">FOR &lt;X&gt; CYCLES ...</p>

<p style="margin-top: 1em">or:</p>

<p style="margin-top: 1em">&lt;X&gt; [TIMES WITHIN]
&lt;Y&gt; CYCLES ...</p>

<p style="margin-top: 1em">The condition can be used both
for failure and success action.</p>

<p style="margin-top: 1em">The first, simpler and
recommended format requires &quot;X&quot; consecutive events
before switching the state:</p>

<p style="margin-top: 1em">if failed <br>
port 80 <br>
for 3 cycles <br>
then alert</p>

<p style="margin-top: 1em">The second format is more
advanced and allows to tolerate intermittent issues, but
still catch excessive problems, where the service is
flapping between error and success states <br>
frequently.</p>

<p style="margin-top: 1em">For example if every second
cycle fails (1-0-1-0-1-0-...), then &quot;for 2 cycles&quot;
condition will never match, despite the service having
problems. The following statement will catch <br>
such a state:</p>

<p style="margin-top: 1em">if failed <br>
port 80 <br>
for 3 times within 5 cycles <br>
then alert</p>

<p style="margin-top: 1em">Example which sets multiple
error levels and actions:</p>

<p style="margin-top: 1em">check filesystem rootfs with
path /dev/hda1 <br>
if space usage &gt; 80% for 5 times within 15 cycles then
alert <br>
if space usage &gt; 90% for 5 cycles then exec
&rsquo;/try/to/free/the/space&rsquo;</p>

<p style="margin-top: 1em">Note: the maximum value for
cycles is 64.</p>

<p style="margin-top: 1em">EXISTENCE TESTING <br>
This test is always active for the process, file, directory
and fifo checks and is if not defined, it defaults to a
restart action.</p>

<p style="margin-top: 1em">You can override the default
action with the following statement:</p>

<p style="margin-top: 1em">IF [DOES] NOT EXIST THEN
action</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">check file with path
/cifs/mydata <br>
if does not exist then exec
&quot;/usr/bin/mount_cifs.sh&quot;</p>

<p style="margin-top: 1em">RESOURCE TESTING <br>
Monit can examine how much system resources a service is
using. This test can only be used within a system or process
service entry in the Monit control file.</p>

<p style="margin-top: 1em">Depending on system or process
characteristics, services can be stopped or restarted and
alerts can be generated. Thus it is possible to utilize
systems which are idle and to <br>
spare system under high load.</p>

<p style="margin-top: 1em">The full syntax for a
resource-statement used for resource testing is as follows
(keywords are in capital and optional statements in
[brackets]),</p>

<p style="margin-top: 1em">IF resource operator value THEN
action</p>

<p style="margin-top: 1em">resource is a choice of
&quot;CPU&quot;, &quot;TOTAL CPU&quot;,
&quot;CPU([user|system|wait])&quot;, &quot;MEMORY&quot;,
&quot;SWAP&quot;, &quot;CHILDREN&quot;, &quot;TOTAL
MEMORY&quot;, &quot;LOADAVG([1min|5min|15min])&quot;. Some
resource tests can be used <br>
inside a check system entry, some in a check process entry
and some in both:</p>

<p style="margin-top: 1em">System only resource tests:</p>

<p style="margin-top: 1em">CPU([user|system|wait]) is the
percent of time the system spend in user or kernel space and
I/O. The user/system/wait modifier is optional, if not used,
the total system cpu <br>
usage is tested.</p>

<p style="margin-top: 1em">SWAP is the swap usage of the
system in either percent (of the systems total) or as an
amount (Byte, kB, MB, GB).</p>

<p style="margin-top: 1em">Process only resource tests:</p>

<p style="margin-top: 1em">CPU is the CPU usage of the
process itself (percent).</p>

<p style="margin-top: 1em">TOTAL CPU is the total CPU usage
of the process and its children in (percent). You will want
to use TOTAL CPU typically for services like Apache web
server where one master <br>
process forks child processes as workers.</p>

<p style="margin-top: 1em">CHILDREN is the number of child
processes of the process.</p>

<p style="margin-top: 1em">TOTAL MEMORY is the memory usage
of the process and its child processes in either percent or
as an amount (Byte, kB, MB, GB).</p>

<p style="margin-top: 1em">System and process resource
tests:</p>

<p style="margin-top: 1em">MEMORY is the memory usage of
the system or of a process (without children) in either
percent (of the systems total) or as an amount (Byte, kB,
MB, GB).</p>

<p style="margin-top: 1em">LOADAVG([1min|5min|15min])
refers to the system&rsquo;s load average. The load average
is the number of processes in the system run queue, averaged
over the specified time period.</p>

<p style="margin-top: 1em">operator is a choice of
&quot;&lt;&quot;, &quot;&gt;&quot;, &quot;!=&quot;,
&quot;==&quot; in C notation, &quot;gt&quot;,
&quot;lt&quot;, &quot;eq&quot;, &quot;ne&quot; in shell sh
notation and &quot;greater&quot;, &quot;less&quot;,
&quot;equal&quot;, &quot;notequal&quot; in human readable
form (if not <br>
specified, default is EQUAL).</p>

<p style="margin-top: 1em">value is either an integer or a
real number (except for CHILDREN). For CPU, TOTAL CPU,
MEMORY and TOTAL MEMORY you need to specify a unit. This
could be &quot;%&quot; or if applicable &quot;B&quot; <br>
(Byte), &quot;kB&quot; (1024 Byte), &quot;MB&quot; (1024
KiloByte) or &quot;GB&quot; (1024 MegaByte).</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">To calculate the cycles, a
counter is raised whenever the expression above is true and
it is lowered whenever it is false (but not below 0). All
counters are reset in case of a <br>
restart.</p>

<p style="margin-top: 1em">The following is an example to
check that the CPU usage of a service is not going beyond
50% during five poll cycles. If it does, Monit will restart
the service:</p>

<p style="margin-top: 1em">if cpu is greater than 50% for 5
cycles then restart</p>

<p style="margin-top: 1em">FILE CHECKSUM TESTING <br>
The checksum statement may only be used in a file service
entry and can be used to check the file&rsquo;s MD5 or SHA1
checksum.</p>

<p style="margin-top: 1em">Check specific checksum:</p>

<p style="margin-top: 1em">IF FAILED [MD5|SHA1] CHECKSUM
[EXPECT checksum] THEN action</p>

<p style="margin-top: 1em">Check any file changes:</p>

<p style="margin-top: 1em">IF CHANGED [MD5|SHA1] CHECKSUM
THEN action</p>

<p style="margin-top: 1em">The choice of MD5 or SHA1 is
optional. MD5 features a 128 bits checksum (32 bytes hex
encoded string) and SHA1 a 160 bits checksum (40 bytes hex
encoded string). If this option <br>
is omitted, Monit will try to guess the method from the
EXPECT string or use MD5 as the default checksum.</p>

<p style="margin-top: 1em">&quot;expect&quot; is optional
and if used, specifies the md5 or sha1 string Monit should
expect when testing a file&rsquo;s checksum. Monit will then
not compute an initial checksum for the <br>
file, but instead use the string you submit. For
example:</p>

<p style="margin-top: 1em">if failed <br>
checksum expect 8f7f419955cefa0b33a2ba316cba3659 <br>
then alert</p>

<p style="margin-top: 1em">You can, for example, use the
GNU utility md5sum(1) or sha1sum(1) to create a checksum
string for a file and use this string in the
expect-statement.</p>

<p style="margin-top: 1em">Reloading a server if its
configuration file was changed:</p>

<p style="margin-top: 1em">check file apache_conf with path
/etc/apache/httpd.conf <br>
if changed checksum then exec &quot;/usr/bin/apachectl
graceful&quot;</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">TIMESTAMP TESTING <br>
The timestamp statement may only be used in a file, fifo or
directory service entry.</p>

<p style="margin-top: 1em">Specific timestamp syntax:</p>

<p style="margin-top: 1em">IF TIMESTAMP [[operator] value
[unit]] THEN action</p>

<p style="margin-top: 1em">Timestamp changed syntax:</p>

<p style="margin-top: 1em">IF CHANGED TIMESTAMP THEN
action</p>

<p style="margin-top: 1em">operator is a choice of
&quot;&lt;&quot;, &quot;&gt;&quot;, &quot;!=&quot;,
&quot;==&quot; in C notation, &quot;GT&quot;,
&quot;LT&quot;, &quot;EQ&quot;, &quot;NE&quot; in shell sh
notation and &quot;GREATER&quot;, &quot;LESS&quot;,
&quot;EQUAL&quot;, &quot;NOTEQUAL&quot; in human readable
form (if not <br>
specified, default is EQUAL).</p>

<p style="margin-top: 1em">value is a time watermark.</p>

<p style="margin-top: 1em">unit is either
&quot;SECOND(S)&quot;, &quot;MINUTE(S)&quot;,
&quot;HOUR(S)&quot; or &quot;DAY(S)&quot;.</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">For example to reload apache if
the configuration file timestamp changed:</p>

<p style="margin-top: 1em">check file apache_conf with path
/etc/apache/httpd.conf <br>
if changed timestamp then exec &quot;/usr/bin/apachectl
graceful&quot;</p>

<p style="margin-top: 1em">For example testing directory
for file addition or removal:</p>

<p style="margin-top: 1em">check directory bar path
/foo/bar <br>
if timestamp &lt; 1 hour then alert</p>

<p style="margin-top: 1em">FILE SIZE TESTING <br>
The size statement may only be used in a check file service
entry. If specified in the control file, Monit will compute
a size for a file.</p>

<p style="margin-top: 1em">Testing specific size or
range:</p>

<p style="margin-top: 1em">IF SIZE [[operator] value
[unit]] THEN action</p>

<p style="margin-top: 1em">Testing size changes:</p>

<p style="margin-top: 1em">IF CHANGED SIZE THEN action</p>

<p style="margin-top: 1em">operator is a choice of
&quot;&lt;&quot;, &quot;&gt;&quot;, &quot;!=&quot;,
&quot;==&quot; in C notation, &quot;GT&quot;,
&quot;LT&quot;, &quot;EQ&quot;, &quot;NE&quot; in shell sh
notation and &quot;GREATER&quot;, &quot;LESS&quot;,
&quot;EQUAL&quot;, &quot;NOTEQUAL&quot; in human readable
form (if not <br>
specified, default is EQUAL).</p>

<p style="margin-top: 1em">value is a size watermark.</p>

<p style="margin-top: 1em">unit is a choice of
&quot;B&quot;,&quot;KB&quot;,&quot;MB&quot;,&quot;GB&quot;
or long alternatives &quot;byte&quot;, &quot;kilobyte&quot;,
&quot;megabyte&quot;, &quot;gigabyte&quot;. If it is not
specified, &quot;byte&quot; unit is assumed by default.</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">For example to send an alert if
the file is too large:</p>

<p style="margin-top: 1em">check file mydb with path
/data/mydatabase.db <br>
if size &gt; 1 GB then alert</p>

<p style="margin-top: 1em">FILE CONTENT TESTING <br>
The match statement can be used to incrementally test the
content of a text file by using regular expressions.</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">IF [NOT] MATCH {regex|path} THEN
action</p>

<p style="margin-top: 1em">regex is a string containing the
extended regular expression. See also regex(7).</p>

<p style="margin-top: 1em">path is an absolute path to a
file containing extended regular expression on every line.
See also regex(7).</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">You can use the NOT statement to
invert a match.</p>

<p style="margin-top: 1em">On startup the read position is
set to the end of the file and Monit continues to scan to
the end of the file on each cycle.</p>

<p style="margin-top: 1em">If the file size should decrease
or inode changed, the read position is set to the start of
the file.</p>

<p style="margin-top: 1em">Only lines ending with a newline
character are inspected.</p>

<p style="margin-top: 1em">Only the first 511 characters of
a line are inspected.</p>

<p style="margin-top: 1em">IGNORE [NOT] MATCH
{regex|path}</p>

<p style="margin-top: 1em">Lines matching an IGNORE are not
inspected during later evaluations. IGNORE MATCH has always
precedence over IF MATCH.</p>

<p style="margin-top: 1em">All IGNORE MATCH statements are
evaluated first, in the order of their appearance.
Thereafter, all the IF MATCH statements are evaluated.</p>

<p style="margin-top: 1em">For example:</p>

<p style="margin-top: 1em">check file syslog with path
/var/log/syslog <br>
ignore match &quot;^monit&quot; <br>
if match &quot;^mrcoffee&quot; then alert</p>

<p style="margin-top: 1em">FILESYSTEM FLAGS TESTING <br>
Monit can test the flags of a filesystem for changes. This
test is implicit and Monit will send alert in case of
failure by default.</p>

<p style="margin-top: 1em">This test is useful for
detecting changes of filesystem flags such as if the
filesystem become read-only (on disk error) or mount flags
were changed (such as nosuid).</p>

<p style="margin-top: 1em">The syntax for the fsflags
statement is:</p>

<p style="margin-top: 1em">IF CHANGED FSFLAGS THEN
action</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">check filesystem rootfs with
path / <br>
if changed fsflags then exec &quot;/my/script&quot;</p>

<p style="margin-top: 1em">SPACE TESTING <br>
Monit can test a filesystem or a disk for space usage. This
test may only be used in the context of a filesystem service
type.</p>

<p style="margin-top: 1em">Filesystems usually have some
space reserved for the root user (ca. 1-5%), so
non-superusers cannot write to a nearly full filesystem. If
you set a limit for the filesystem <br>
which is used by non-root users you might want to consider
these reserved blocks when setting the limit. You can use
Monit itself to view the reserved blocks percentage by using
<br>
the CLI status command or the HTTP interface for the given
filesystem.</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">IF SPACE operator value unit
THEN action</p>

<p style="margin-top: 1em">or:</p>

<p style="margin-top: 1em">IF SPACE FREE operator value
unit THEN action</p>

<p style="margin-top: 1em">operator is a choice of
&quot;&lt;&quot;,&quot;&gt;&quot;,&quot;!=&quot;,&quot;==&quot;
in c notation, &quot;gt&quot;, &quot;lt&quot;,
&quot;eq&quot;, &quot;ne&quot; in shell sh notation and
&quot;greater&quot;, &quot;less&quot;, &quot;equal&quot;,
&quot;notequal&quot; in human readable form (if not <br>
specified, default is EQUAL).</p>

<p style="margin-top: 1em">unit is a choice of
&quot;B&quot;,&quot;KB&quot;,&quot;MB&quot;,&quot;GB&quot;,
&quot;%&quot; or long alternatives &quot;byte&quot;,
&quot;kilobyte&quot;, &quot;megabyte&quot;,
&quot;gigabyte&quot;, &quot;percent&quot;.</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">check filesystem rootfs with
path / <br>
if space usage &gt; 90% then alert</p>

<p style="margin-top: 1em">INODE TESTING <br>
Monit can test filesystem inode usage. This test may only be
used in the context of a filesystem service type.</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">IF INODE(S) operator value
[unit] THEN action</p>

<p style="margin-top: 1em">or:</p>

<p style="margin-top: 1em">IF INODE(S) FREE operator value
[unit] THEN action</p>

<p style="margin-top: 1em">operator is a choice of
&quot;&lt;&quot;,&quot;&gt;&quot;,&quot;!=&quot;,&quot;==&quot;
in c notation, &quot;gt&quot;, &quot;lt&quot;,
&quot;eq&quot;, &quot;ne&quot; in shell sh notation and
&quot;greater&quot;, &quot;less&quot;, &quot;equal&quot;,
&quot;notequal&quot; in human readable form (if not <br>
specified, default is EQUAL).</p>

<p style="margin-top: 1em">unit is optional. If not
specified, the value is an absolute count of inodes. You can
use the &quot;%&quot; character or the longer alternative
&quot;percent&quot; as a unit.</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">check filesystem rootfs with
path / <br>
if inode usage &gt; 90% then alert</p>

<p style="margin-top: 1em">PERMISSION TESTING <br>
Monit can test the permissions of file objects. This test
may only be used in the context of a file, fifo, directory
or filesystem service types.</p>

<p style="margin-top: 1em">Syntax for testing specific
permissions:</p>

<p style="margin-top: 1em">IF FAILED PERM(ISSION)
octalnumber THEN action</p>

<p style="margin-top: 1em">Syntax for testing any
permission change:</p>

<p style="margin-top: 1em">IF CHANGED PERM(ISSION) THEN
action</p>

<p style="margin-top: 1em">octalnumber defines permissions
for a file, a directory or a filesystem as four octal digits
(0-7). Valid range is 0000 - 7777 (you can omit the leading
zeros, Monit will add the <br>
zeros to the left. For example, &quot;640&quot; is a valid
value and matches &quot;0640&quot;).</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">check file shadow with path
/etc/shadow <br>
if failed permission 0640 then alert</p>

<p style="margin-top: 1em">UID TESTING <br>
Monit can monitor the owner user id (uid) of a file, fifo,
directory or owner and effective user of a process.</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">IF FAILED [E]UID user THEN
action</p>

<p style="margin-top: 1em">user defines a user id either in
numeric or in string form.</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">check file shadow with path
/etc/shadow <br>
if failed uid root then alert</p>

<p style="margin-top: 1em">GID TESTING <br>
Monit can monitor the owner group id (gid) of a file, fifo,
directory or process.</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">IF FAILED GID group THEN
action</p>

<p style="margin-top: 1em">group defines a group id either
in numeric or in string form.</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">check file shadow with path
/etc/shadow <br>
if failed gid shadow then alert</p>

<p style="margin-top: 1em">PID TESTING <br>
Monit can test the process&rsquo; PID. This test is implicit
and Monit will send an alert in case the PID changed outside
of Monit&rsquo;s control.</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">IF CHANGED PID THEN action</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">This test is useful to detect
possible process restarts which has occurred in the
timeframe between two Monit testing cycles.</p>

<p style="margin-top: 1em">For example if someone changes
sshd configuration and did sshd restart outside of
Monit&rsquo;s control you will be notified that the process
was replaced by a new instance:</p>

<p style="margin-top: 1em">check process sshd with pidfile
/var/run/sshd.pid <br>
if changed pid then alert</p>

<p style="margin-top: 1em">PPID TESTING <br>
Monit can test the process&rsquo; parent PID (PPID) for
changes. This test is implicit and Monit will send alert in
the case that the PPID changed outside of Monit control.</p>

<p style="margin-top: 1em">The syntax for the ppid
statement is:</p>

<p style="margin-top: 1em">IF CHANGED PPID THEN action</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">check process myproc with
pidfile /var/run/myproc.pid <br>
if changed ppid then exec &quot;/my/script&quot;</p>

<p style="margin-top: 1em">PROCESS UPTIME TESTING <br>
The uptime statement may only be used in a process service
type context.</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">IF UPTIME [[operator] value
[unit]] THEN action</p>

<p style="margin-top: 1em">operator is a choice of
&quot;&lt;&quot;, &quot;&gt;&quot;, &quot;!=&quot;,
&quot;==&quot; in C notation, &quot;GT&quot;,
&quot;LT&quot;, &quot;EQ&quot;, &quot;NE&quot; in shell sh
notation and &quot;GREATER&quot;, &quot;LESS&quot;,
&quot;EQUAL&quot;, &quot;NOTEQUAL&quot; in human readable
form (if not <br>
specified, default is EQUAL).</p>

<p style="margin-top: 1em">value is a uptime watermark.</p>

<p style="margin-top: 1em">unit is either
&quot;SECOND&quot;, &quot;MINUTE&quot;, &quot;HOUR&quot; or
&quot;DAY&quot; (it is also possible to use
&quot;SECONDS&quot;, &quot;MINUTES&quot;, &quot;HOURS&quot;,
or &quot;DAYS&quot;).</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">Example of restarting the
process every three days:</p>

<p style="margin-top: 1em">check process myapp with pidfile
/var/run/myapp.pid <br>
start program = &quot;/etc/init.d/myapp start&quot; <br>
stop program = &quot;/etc/init.d/myapp stop&quot; <br>
if uptime &gt; 3 days then restart</p>

<p style="margin-top: 1em">PROGRAM STATUS TESTING <br>
You can check the exit status of a program or a script. This
test may only be used within a check program service entry
in the Monit control file.</p>

<p style="margin-top: 1em">Syntax for testing specific exit
value:</p>

<p style="margin-top: 1em">IF STATUS operator value THEN
action</p>

<p style="margin-top: 1em">Syntax for testing any exit
value change:</p>

<p style="margin-top: 1em">IF CHANGED STATUS THEN
action</p>

<p style="margin-top: 1em">operator is a choice of
&quot;&lt;&quot;,&quot;&gt;&quot;,&quot;!=&quot;,&quot;==&quot;
in c notation, &quot;gt&quot;, &quot;lt&quot;,
&quot;eq&quot;, &quot;ne&quot; in shell sh notation and
&quot;greater&quot;, &quot;less&quot;, &quot;equal&quot;,
&quot;notequal&quot; in human readable form (if not <br>
specified, default is EQUAL).</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">check program myscript with path
/usr/local/bin/myscript.sh <br>
if status != 0 then alert</p>

<p style="margin-top: 1em">Sample script for the above
example (/usr/local/bin/myscript.sh):</p>

<p style="margin-top: 1em">#!/bin/bash <br>
echo test <br>
exit $?</p>

<p style="margin-top: 1em">You can also send parameters
with the program:</p>

<p style="margin-top: 1em">check program list-files with
path &quot;/bin/ls -lrt /tmp/&quot; <br>
if status != 0 then alert</p>

<p style="margin-top: 1em">Arguments to the program or
script is a sequence of whitespace separated strings. In the
above example the strings &rsquo;-lrt&rsquo; and
&rsquo;/tmp/&rsquo; are arguments to the program
&rsquo;/bin/ls&rsquo;. If <br>
arguments are used, it is recommended to use quotes &quot;
to enclose the string, otherwise, if no arguments are used,
quotes are not needed.</p>

<p style="margin-top: 1em">Notes: If the program is a
script, the interpreter is required in the first line. The
program or script must also be executable.</p>

<p style="margin-top: 1em">If Monit is run as the super
user, you can optionally run the program as a different user
and/or group. In this example we run the ls program as user
www and as group staff:</p>

<p style="margin-top: 1em">check program ls with path
&quot;/bin/ls /tmp&quot; as uid &quot;www&quot; <br>
and gid &quot;staff&quot; <br>
if status != 0 then alert</p>

<p style="margin-top: 1em">Monit will execute the program
periodically and if the exit status of the program does not
match the expected result, Monit can perform an action. In
the example above, Monit <br>
will raise an alert if the exit value is different from 0.
By convention, 0 means the program exited normally.</p>

<p style="margin-top: 1em">Program checks are asynchronous.
Meaning that Monit will not wait for the program to exit,
but instead, Monit will start the program in the background
and immediately continue <br>
checking the next service entry in monitrc. At the next
cycle, Monit will check if the program has finished and if
so, collect the program&rsquo;s exit status. If the status
indicate a <br>
failure, Monit will raise an alert message containing the
program&rsquo;s error (stderr) output, if any. If the
program has not exited after the first cycle, Monit will
wait another <br>
cycle and so on. If the program is still running after 5
minutes, Monit will kill it and generate a program timeout
event. It is possible to override the default timeout (see
the <br>
syntax below).</p>

<p style="margin-top: 1em">The asynchronous nature of the
program check allows for non-blocking behavior in the
current Monit design, but it comes with a side-effect: when
the program has finished <br>
executing and is waiting for Monit to collect the result, it
becomes a so-called &quot;zombie&quot; process. A zombie
process does not consume any system resources (only the PID
remains in <br>
use) and it is under Monit&rsquo;s control and the zombie
process is removed from the system as soon as Monit collects
the exit status. This means that every &quot;check
program&quot; will be <br>
associated with either a running process or a temporary
zombie. This unwanted zombie side-effect will be removed in
a later release of Monit.</p>

<p style="margin-top: 1em">Multiple status tests can be
used, for example:</p>

<p style="margin-top: 1em">check program hwtest with path
/usr/local/bin/hwtest.sh <br>
with timeout 500 seconds <br>
if status = 1 then alert <br>
if status = 3 for 5 cycles then exec
&quot;/usr/local/bin/emergency.sh&quot;</p>

<p style="margin-top: 1em">NETWORK LINK STATUS TEST <br>
You can check the network link state. This test may only be
used within a check network service entry in the Monit
control file.</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">IF FAILED LINK THEN action</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">The test will fail if the
link/interface is down or link errors were detected.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">check network eth0 with
interface eth0 <br>
if failed link then alert</p>

<p style="margin-top: 1em">In case a link failed you can
add a start and stop program to automatically restart the
interface which might help. (Substitute with the relevant
network commands for your <br>
system)</p>

<p style="margin-top: 1em">check network eth0 with
interface eth0 <br>
start program = &rsquo;/sbin/ipup eth0&rsquo; <br>
stop program = &rsquo;/sbin/ipdown eth0&rsquo; <br>
if failed link then restart</p>

<p style="margin-top: 1em">NETWORK LINK CAPACITY TEST <br>
You can check the network link mode capacity for changes.
This test may only be used within a check network service
entry in the Monit control file.</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">IF CHANGED LINK [CAPACITY] THEN
action</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">The test will match if the link
mode has changed (e.g. maximum speed dropped) or if the
duplex mode has changed.</p>

<p style="margin-top: 1em">NOTE: not all interface types
allow for capacity monitoring. Pseudo interfaces such as
loopback device or VMWare interfaces does not have a speed
attribute.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">check network eth0 with
interface eth0 <br>
if changed link capacity then alert</p>

<p style="margin-top: 1em">NETWORK SATURATION TEST <br>
You can check the network link saturation. Monit then
computes the link utilization based on the current transfer
rate vs. link capacity. This test may only be used within a
<br>
check network service entry in the Monit control file.</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">IF SATURATION operator value%
THEN action</p>

<p style="margin-top: 1em">operator is a choice of
&quot;&lt;&quot;,&quot;&gt;&quot;,&quot;!=&quot;,&quot;==&quot;
in c notation, &quot;gt&quot;, &quot;lt&quot;,
&quot;eq&quot;, &quot;ne&quot; in shell sh notation and
&quot;greater&quot;, &quot;less&quot;, &quot;equal&quot;,
&quot;notequal&quot; in human readable form (if not <br>
specified, default is EQUAL).</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">NOTE: this test depends on the
availability of the speed attribute and not all interface
types have this attribute. See the LINK SPEED test
description.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">check network eth0 with
interface eth0 <br>
if saturation &gt; 90% then alert</p>

<p style="margin-top: 1em">NETWORK BANDWIDTH TEST <br>
You can check a network link upload and download bandwidth
usage, current transfer rate and total data transferred in
the last 24 hours. This test may only be used within a check
<br>
network service entry in the Monit control file.</p>

<p style="margin-top: 1em">Warning: this test requires
monit poll time to be at maximum 30 seconds.</p>

<p style="margin-top: 1em">Current upload bandwidth rate
test syntax:</p>

<p style="margin-top: 1em">IF UPLOAD operator value unit
THEN action</p>

<p style="margin-top: 1em">Current download bandwidth rate
test syntax:</p>

<p style="margin-top: 1em">IF DOWNLOAD operator value unit
THEN action</p>

<p style="margin-top: 1em">Total upload test syntax:</p>

<p style="margin-top: 1em">IF TOTAL UPLOAD operator value
unit IN LAST number time-unit THEN action</p>

<p style="margin-top: 1em">Total download test syntax:</p>

<p style="margin-top: 1em">IF TOTAL DOWNLOAD operator value
unit IN LAST number time-unit THEN action</p>

<p style="margin-top: 1em">operator is a choice of
&quot;&lt;&quot;,&quot;&gt;&quot;,&quot;!=&quot;,&quot;==&quot;
in c notation, &quot;gt&quot;, &quot;lt&quot;,
&quot;eq&quot;, &quot;ne&quot; in shell sh notation and
&quot;greater&quot;, &quot;less&quot;, &quot;equal&quot;,
&quot;notequal&quot; in human readable form (if not <br>
specified, default is EQUAL).</p>

<p style="margin-top: 1em">unit is a choice of
&quot;B&quot;,&quot;KB&quot;,&quot;MB&quot;,&quot;GB&quot;
or long alternatives &quot;byte&quot;, &quot;kilobyte&quot;,
&quot;megabyte&quot;, &quot;gigabyte&quot;.</p>

<p style="margin-top: 1em">time-unit is a choice of
&quot;MINUTE(S)&quot;, &quot;HOUR(S)&quot;, &quot;DAY&quot;.
NOTE: Monit maintains a rolling count of total uploaded and
downloaded bytes for the last 24 hours only. The value of
<br>
time-unit can therefor not specify a range wider than one
day.</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">check network eth0 with
interface eth0 <br>
if upload &gt; 500 kB/s then alert <br>
if total download &gt; 1 GB in last 2 hours then alert <br>
if total download &gt; 10 GB in last day then alert</p>

<p style="margin-top: 1em">NETWORK PACKETS TEST <br>
You can check the network link upload and download packets
count, current transfer rate and total data transferred in
last 24 hours. This test may only be used within a check
<br>
network service entry in the Monit control file.</p>

<p style="margin-top: 1em">Warning: this test requires
monit poll time to be at maximum 30 seconds.</p>

<p style="margin-top: 1em">Current upload bandwidth rate
test syntax:</p>

<p style="margin-top: 1em">IF UPLOAD operator value
PACKETS/S THEN action</p>

<p style="margin-top: 1em">Current download bandwidth rate
test syntax:</p>

<p style="margin-top: 1em">IF DOWNLOAD operator value
PACKETS/S THEN action</p>

<p style="margin-top: 1em">Total upload test syntax:</p>

<p style="margin-top: 1em">IF TOTAL UPLOAD operator value
PACKETS IN LAST number time-unit THEN action</p>

<p style="margin-top: 1em">Total download test syntax:</p>

<p style="margin-top: 1em">IF TOTAL DOWNLOAD operator value
PACKETS IN LAST number time-unit THEN action</p>

<p style="margin-top: 1em">operator is a choice of
&quot;&lt;&quot;,&quot;&gt;&quot;,&quot;!=&quot;,&quot;==&quot;
in c notation, &quot;gt&quot;, &quot;lt&quot;,
&quot;eq&quot;, &quot;ne&quot; in shell sh notation and
&quot;greater&quot;, &quot;less&quot;, &quot;equal&quot;,
&quot;notequal&quot; in human readable form (if not <br>
specified, default is EQUAL).</p>

<p style="margin-top: 1em">time-unit is a choice of
&quot;MINUTE(S)&quot;, &quot;HOUR(S)&quot;, &quot;DAY&quot;.
NOTE: Monit keeps total upload/download statistics only for
the last 24 hours. The time-unit value cannot therefor span
<br>
more than one day.</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">check network eth0 with
interface eth0 <br>
if upload &gt; 1000 packets/s then alert <br>
if total upload &gt; 900000 packets in last hour then
alert</p>

<p style="margin-top: 1em">NETWORK PING TEST <br>
Monit can perform a network ping test by sending ICMP echo
request datagram packets to a host and wait for the reply.
This test can only be used within a check host statement.
<br>
Monit must also run as the root user in order to be able to
perform the ping test (because the ping test must use raw
sockets which usually only the super user is allowed
to).</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">IF FAILED PING[4|6] <br>
[COUNT number] [WITH] [TIMEOUT number SECONDS] <br>
THEN action</p>

<p style="margin-top: 1em">If a DNS host name was used in
the check host statement and the host name resolve to
several addresses (either IPv4 or IPv6), Monit will ping the
first available address and <br>
continue with the next address until one connection succeed
or until there are no more addresses left to try. You can
force Monit to only ping IPv4 or IPv6 addresses by using the
<br>
PING4 or the PING6 keyword instead of PING.</p>

<p style="margin-top: 1em">The COUNT parameter specifies
how many consecutive ping requests will be sent to the host
in one cycle. If no reply arrive within TIMEOUT seconds,
Monit reports an error. If at <br>
least one reply was received, the ping test is considered a
success. Monit will, by default, send three ping request
packets in one cycle to prevent false alarm (i.e. up to 66%
<br>
packet loss is tolerated). You can set the COUNT option to a
value between 1 and 20 to send more or fewer packets. If you
require 100% ping success, set the count to 1 (i.e. just
<br>
one request will be sent, and if the packet was lost an
error will be reported).</p>

<p style="margin-top: 1em">Note that many ISPs have started
to filter out ping or ICMP packets now, in which case there
will be no reply from the host.</p>

<p style="margin-top: 1em">If a ping test is used in a
check host entry, this test is run first and if the test
should fail, we assume that the connection to the host is
down and Monit will not continue <br>
with any subsequent port tests.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">check host mmonit.com with
address mmonit.com <br>
if failed ping then alert # IPv4 or IPv6</p>

<p style="margin-top: 1em">check host mmonit.com with
address 62.109.39.247 <br>
if failed ping then alert # Address is IPv4 so IPv4 is
preferred</p>

<p style="margin-top: 1em">or test that the system is
explicit accessible via IPv4 and IPv6:</p>

<p style="margin-top: 1em">check host mmonit.com with
address mmonit.com <br>
if failed ping4 then alert # IPv4 only <br>
if failed ping6 then alert # IPv6 only</p>

<p style="margin-top: 1em">or with all parameters; Send 5
pings to mmonit.com and wait for up to 10 seconds for a
reply</p>

<p style="margin-top: 1em">check host mmonit.com with
address mmonit.com <br>
if failed ping count 5 with timeout 10 seconds then
alert</p>

<p style="margin-top: 1em">CONNECTION TESTING <br>
Monit can perform connection testing via network ports or
via Unix sockets. A connection test may only be used within
a process or host service type context.</p>

<p style="margin-top: 1em">If a service listens on one or
more sockets, Monit can connect to the port (using TCP or
UDP) and verify that the service will accept a connection
and that it is possible to <br>
write and read from the socket. If a connection is not
accepted or if there is a problem with socket I/O, Monit
will execute a specified action.</p>

<p style="margin-top: 1em">TCP/UDP port test syntax:</p>

<p style="margin-top: 1em">IF FAILED <br>
[host] <br>
&lt;port&gt; <br>
[ipversion] <br>
[type] <br>
[protocol | {send/expect}+] <br>
[timeout] <br>
[retry] <br>
THEN action</p>

<p style="margin-top: 1em">Unix socket test syntax:</p>

<p style="margin-top: 1em">IF FAILED <br>
&lt;unixsocket&gt; <br>
[type] <br>
[protocol | {send/expect}+] <br>
[timeout] <br>
[retry] <br>
THEN action</p>

<p style="margin-top: 1em">Examples:</p>

<p style="margin-top: 1em">if failed port 80 then alert</p>

<p style="margin-top: 1em">if failed port 53 type udp
protocol dns then alert</p>

<p style="margin-top: 1em">if failed unixsocket
/var/run/sophie then alert</p>

<p style="margin-top: 1em">Options:</p>

<p style="margin-top: 1em">host: HOST hostname. Optionally
specify the host to connect to. If the host is not given
then localhost is assumed if this test is used inside a
process entry. If this test is <br>
used inside a remote host entry then the entry&rsquo;s
remote host is assumed.</p>

<p style="margin-top: 1em">port: PORT number. The port
number to connect to</p>

<p style="margin-top: 1em">unixsocket: UNIXSOCKET path.
Specifies the path to a Unix socket (local machine
only).</p>

<p style="margin-top: 1em">ipversion: IPV4 | IPV6 .
Optionally specify the IP version Monit should use when
trying to connect to the port. If not used, Monit will try
to connect to the first available <br>
address (IPv4 or IPv6). If multiple addresses are available
and connection to one address failed, Monit will try the
next address and so on until a connection succeed or until
<br>
there are no more addresses left to try.</p>

<p style="margin-top: 1em">type: TYPE {TCP|UDP|TCPSSL}.
Optionally specify the socket type Monit should use when
trying to connect to the port. The different socket types
are; TCP, UDP or TCPSSL, where TCP <br>
is a regular stream based socket, UDP is a datagram socket
and TCPSSL specifies that Monit should use a TCP socket with
SSL when connecting to a port. The default socket type is
<br>
TCP. If TCPSSL is used you may optionally specify the
SSL/TLS protocol to be used and the MD5 checksum of the
server&rsquo;s certificate.</p>

<p style="margin-top: 1em">The TCPSSL options are:</p>

<p style="margin-top: 1em">TCPSSL
[SSLAUTO|SSLV2|SSLV3|TLSV1|TLSV11|TLSV12] [CERTMD5
md5sum]</p>

<p style="margin-top: 1em">The default mode is SSLAUTO and
it will select the method automatically, but for security
reasons only TLS is used, not SSL. If you need SSLv2 or
SSLv3 you have to explicitly <br>
select that method using SSLV2 or SSLV3 option.</p>

<p style="margin-top: 1em">protocol: PROTO(COL) protocol.
Optionally specify the protocol Monit should speak when a
connection is established. At the moment Monit knows how to
speak: <br>
APACHE-STATUS <br>
DNS <br>
DWP <br>
FTP <br>
GPS <br>
HTTP <br>
HTTPS <br>
IMAP <br>
IMAPS <br>
CLAMAV <br>
LDAP2 <br>
LDAP3 <br>
LMTP <br>
MEMCACHE <br>
MONGODB <br>
MYSQL <br>
NNTP <br>
NTP3 <br>
PGSQL <br>
POP <br>
POPS <br>
POSTFIX-POLICY <br>
RADIUS <br>
RDATE <br>
REDIS <br>
RSYNC <br>
SIEVE <br>
SIP <br>
SMTP <br>
SMTPS <br>
SSH <br>
TNS <br>
WEBSOCKET</p>

<p style="margin-top: 1em">If the target server&rsquo;s
protocol is not found in this list, simply do not specify
the protocol and Monit will use a default connection
test.</p>

<p style="margin-top: 1em">timeout: [WITH] TIMEOUT number
SECONDS. Optionally specifies the connect and read timeout
for the connection. If Monit cannot connect to the server
within this time it will <br>
assume that the connection failed and execute the specified
action. The default connect timeout is 5 seconds.</p>

<p style="margin-top: 1em">retry: RETRY number. Optionally
specifies the number of consecutive retries within the same
testing cycle in the case that the connection failed. The
default is fail on first <br>
error.</p>

<p style="margin-top: 1em">action is a choice of
&quot;ALERT&quot;, &quot;RESTART&quot;, &quot;START&quot;,
&quot;STOP&quot;, &quot;EXEC&quot; or
&quot;UNMONITOR&quot;.</p>

<p style="margin-top: 1em">Specific protocol test
options</p>

<p style="margin-top: 1em">GENERIC (SEND/EXPECT)</p>

<p style="margin-top: 1em">If Monit does not support the
protocol spoken by the server, you can write your own
protocol-test using send and expect strings. The SEND
statement sends a string to the server <br>
port and the EXPECT statement compares a string read from
the server with the string given in the expect
statement.</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">[{SEND|EXPECT}
&quot;string&quot;]+</p>

<p style="margin-top: 1em">Monit will send a string as it
is, and you must remember to include CR and LF in the string
sent to the server if the protocol expects such characters
to terminate a string (most <br>
text based protocols used over Internet do).</p>

<p style="margin-top: 1em">Monit will by default read up to
255 bytes from the server and use this string when comparing
the EXPECT string. You can override the default value by
using this statement at the <br>
top of the Monit configuration file:</p>

<p style="margin-top: 1em">SET EXPECTBUFFER &lt;number&gt;
[&quot;b&quot;|&quot;kb&quot;]</p>

<p style="margin-top: 1em">Max value for the expect buffer
is 100 kb. For example, to set the expect buffer to read 10
kilobytes:</p>

<p style="margin-top: 1em">set expectbuffer 10 kb</p>

<p style="margin-top: 1em">You can use non-printable
characters in a SEND string if needed. Use the hex notation,
xHEXHEX to send any char in the range x00- xFF, that is,
0-255 in decimal. For <br>
example, to test a Quake 3 server:</p>

<p style="margin-top: 1em">send &quot; xFF xFF xFF
xFFgetstatus&quot; <br>
expect &quot;sv_floodProtect|sv_maxPing&quot;</p>

<p style="margin-top: 1em">If your system supports POSIX
regular expressions, you can use regular expressions in the
EXPECT string, see regex(7) to learn more about the types of
regular expressions you can <br>
use in an expect string.</p>

<p style="margin-top: 1em">Since both regex and string
compare operates on a zero terminated string, you cannot
test for &rsquo; &rsquo; in an EXPECT buffer since this
character marks the end of the buffer. However, <br>
we escape &rsquo; &rsquo; in the expect buffer as &quot;
&quot; which you can test for. That is, &rsquo;&acute;
followed by the ascii value for 0. For instance, here is how
to test for an expect string that <br>
starts with zero followed by any number of characters.</p>

<p style="margin-top: 1em">expect &quot;^[\]0.*&quot;</p>

<p style="margin-top: 1em">Here is a simple SMTP protocol
example:</p>

<p style="margin-top: 1em">if failed <br>
port 25 and <br>
expect &quot;^220.*&quot; 0 <br>
send &quot;HELO localhost.localdomain <br>
expect &quot;^250.*&quot;0 <br>
send &quot;QUIT <br>
then alert</p>

<p style="margin-top: 1em">SEND/EXPECT can be used with any
socket type, such as TCP sockets, UNIX sockets and UDP
sockets.</p>

<p style="margin-top: 1em">HTTP</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">PROTO(COL) HTTP <br>
[REQUEST &quot;string&quot;] <br>
[STATUS operator number] <br>
[CHECKSUM checksum] <br>
[HTTP HEADERS list of headers] <br>
[CONTENT {= | != } STRING]</p>

<p style="margin-top: 1em">REQUEST option can set an URL
string specifying a document on the HTTP server. If the
request statement isn&rsquo;t specified, the default
&quot;/&quot; page will be requested.</p>

<p style="margin-top: 1em">For example:</p>

<p style="margin-top: 1em">if failed <br>
port 80 <br>
protocol http <br>
request &quot;/data/show?a=b&amp;c=d&quot; <br>
then restart</p>

<p style="margin-top: 1em">STATUS option can be used to
explicitly test the HTTP status code returned by the HTTP
server. If not used, the http protocol test will fail if the
status code returned is <br>
greater than or equal to 400. You can override this
behaviour by using the status qualifier.</p>

<p style="margin-top: 1em">For example to test that a page
does not exist (the HTTP server should return 404 in this
case):</p>

<p style="margin-top: 1em">if failed <br>
port 80 <br>
protocol http <br>
request &quot;/non/existent.php&quot; <br>
status = 404 <br>
then alert</p>

<p style="margin-top: 1em">CHECKSUM You can test the
checksum of documents returned by a HTTP server. Either MD5
or SHA1 hash can be used. Monit will not test the checksum
for a document if the server does <br>
not set the HTTP Content-Length header. A HTTP server should
set this header when it server a static document (i.e. a
file). There are no limitation on the document size, but
<br>
keep in mind that Monit will use time to download the
document over the network to compute the checksum.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">if failed <br>
port 80 <br>
protocol http <br>
request &quot;/page.html&quot; <br>
checksum 8f7f419955cefa0b33a2ba316cba3659 <br>
then alert</p>

<p style="margin-top: 1em">HTTP HEADERS can be used to send
a list of any HTTP headers with a http protocol test. For
instance, the host header. If the host header is not set,
Monit will use the hostname <br>
or IP-address of the host as specified in the check host
statement. Specifying a host header is useful if you want to
connect to and test a name-based virtual host. The syntax
<br>
for setting HTTP headers is</p>

<p style="margin-top: 1em">http headers [name:value,
name:value,..]</p>

<p style="margin-top: 1em">where each name:value pair is
separated with &rsquo;,&rsquo;. If you need to use
&rsquo;:&rsquo; in the value string, for instance to set
port number for a host header, you must enclose the value in
<br>
quotes. For example,</p>

<p style="margin-top: 1em">http headers [Host:
&quot;mmonit.com:443&quot;]</p>

<p style="margin-top: 1em">In a check host context, using
this statement might look like</p>

<p style="margin-top: 1em">check host mmonit.com with
address mmonit.com <br>
if failed <br>
port 80 protocol http <br>
with http headers [Host: mmonit.com, Cache-Control:
no-cache, <br>
Cookie: csrftoken=nj1bI3CnMCaiNv4beqo8ZaCfAQQvpgLH] <br>
and request /monit/ with content = &quot;Monit [0-9.]+&quot;
<br>
then alert</p>

<p style="margin-top: 1em">Setting http headers is
associated with the http protocol test and must come before
request as in the example above.</p>

<p style="margin-top: 1em">CONTENT option sets the pattern
which is expected in the data returned by the server. If the
pattern doesn&rsquo;t match, event is triggered.</p>

<p style="margin-top: 1em">For example:</p>

<p style="margin-top: 1em">if failed <br>
port 80 <br>
protocol http <br>
content = &quot;foobar [0-9.]+&quot; <br>
then alert</p>

<p style="margin-top: 1em">APACHE-STATUS</p>

<p style="margin-top: 1em">The APACHE-STATUS test allows to
check server performance by examination of the status page
generated by Apache&rsquo;s mod_status, which is expected to
be at its default address of <br>
http://www.example.com/server-status.</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">PROTOCOL APACHE-STATUS &lt;limit
operator number&gt;+</p>

<p style="margin-top: 1em">limit is acronym for child
status:</p>

<p style="margin-top: 1em">(1) logging (loglimit) <br>
(2) closing connections (closelimit) <br>
(3) performing DNS lookups (dnslimit) <br>
(4) in keepalive with a client (keepalivelimit) <br>
(5) replying to a client (replylimit) <br>
(6) receiving a request (requestlimit) <br>
(7) initialising (startlimit) <br>
(8) waiting for incoming connections (waitlimit) <br>
(9) gracefully closing down (gracefullimit) <br>
(10) performing cleanup procedures (cleanuplimit)</p>

<p style="margin-top: 1em">operator is one of
&quot;&lt;&quot;, &quot;=&quot;, &quot;&gt;&quot;.</p>

<p style="margin-top: 1em">number is percentile numeric
limit.</p>

<p style="margin-top: 1em">Each of these limits can be
compared against a value relative to the total number of
active Apache child processes.</p>

<p style="margin-top: 1em">You can combine all of these
tests into one expression or you can choose to test a
certain limit only. If you combine the limits you must
connect them together using the OR <br>
keyword.</p>

<p style="margin-top: 1em">Example:</p>

<p style="margin-top: 1em">if failed port 80 protocol
apache-status <br>
loglimit &gt; 10% or <br>
dnslimit &gt; 50% or <br>
waitlimit &lt; 20% <br>
then alert</p>

<p style="margin-top: 1em">SIP</p>

<p style="margin-top: 1em">The SIP protocol is used by
communication platform servers such as Asterisk and
FreeSWITCH.</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">PROTOCOL SIP [TARGET valid@uri]
[MAXFORWARD n]</p>

<p style="margin-top: 1em">TARGET you may specify an
alternative recipient for the message, by adding a valid sip
uri after this keyword.</p>

<p style="margin-top: 1em">MAXFORWARD Limit the number of
proxies or gateways that can forward the request to the next
server. It&rsquo;s value is an integer in the range 0-255,
set by default to 70. If max- <br>
forward = 0, the next server may respond 200 OK (test
succeeded) or send a 483 Too Many Hops (test failed)</p>

<p style="margin-top: 1em">For example:</p>

<p style="margin-top: 1em">check host openser_all with
address 127.0.0.1 <br>
if failed <br>
port 5060 type udp protocol sip <br>
with target &quot;localhost:5060&quot; and maxforward 6 <br>
then alert</p>

<p style="margin-top: 1em">RADIUS</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">PROTOCOL RADIUS [SECRET
string]</p>

<p style="margin-top: 1em">SECRET you may specify an
alternative secret, default is &quot;testing123&quot;.</p>

<p style="margin-top: 1em">For example:</p>

<p style="margin-top: 1em">check process radiusd with
pidfile /var/run/radiusd.pid <br>
start program = &quot;/etc/init.d/freeradius start&quot;
<br>
stop program = &quot;/etc/init.d/freeradius stop&quot; <br>
if failed <br>
host 127.0.0.1 port 1812 type udp protocol radius <br>
secret pingpong <br>
then alert</p>

<p style="margin-top: 1em">MYSQL</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">PROTOCOL MYSQL [USERNAME string
PASSWORD string]</p>

<p style="margin-top: 1em">USERNAME MySQL username (maximum
16 characters).</p>

<p style="margin-top: 1em">PASSWORD MySQL password.</p>

<p style="margin-top: 1em">The credentials are optional. If
no credentials are set, Monit will perform the test using
anonymous login. That may cause authentication error to be
logged in your MySQL log for <br>
higher MySQL log levels.</p>

<p style="margin-top: 1em">If credentials are set, Monit
will login and perform MySQL ping. Monit doesn&rsquo;t
require any database privileges, it needs just database
user, we recommend to create standalone <br>
user for Monit testing, for example:</p>

<p style="margin-top: 1em">CREATE USER
&rsquo;monit&rsquo;@&rsquo;host_from_which_monit_performs_testing&rsquo;
IDENTIFIED BY &rsquo;mysecretpassword&rsquo;; <br>
FLUSH PRIVILEGES;</p>

<p style="margin-top: 1em">For example:</p>

<p style="margin-top: 1em">check process mysql with pidfile
/var/run/mysqld/mysqld.pid <br>
start program = &quot;/sbin/start mysql&quot; <br>
stop program = &quot;/sbin/stop mysql&quot; <br>
if failed <br>
port 3306 <br>
protocol mysql username foo password bar <br>
then alert</p>

<p style="margin-top: 1em">or with unix-socket and OS X
start/stop commands</p>

<p style="margin-top: 1em">check process mysql with pidfile
/var/run/mysqld/mysqld.pid <br>
start program =
&quot;/usr/local/mysql/support-files/mysql.server
start&quot; <br>
stop program =
&quot;/usr/local/mysql/support-files/mysql.server stop&quot;
<br>
if failed <br>
unixsocket /tmp/mysql.sock <br>
protocol mysql username foo password bar <br>
then alert</p>

<p style="margin-top: 1em">WEBSOCKET</p>

<p style="margin-top: 1em">Syntax:</p>

<p style="margin-top: 1em">PROTOCOL WEBSOCKET <br>
[REQUEST string] <br>
[HOST string] <br>
[ORIGIN string] <br>
[VERSION number]</p>

<p style="margin-top: 1em">HOST you may specify an
alternative Host header</p>

<p style="margin-top: 1em">REQUEST you may specify an
alternative request, default is &quot;/&quot;</p>

<p style="margin-top: 1em">ORIGIN you may specify an
alternative origin, default is
&quot;http://www.mmonit.com&quot;</p>

<p style="margin-top: 1em">VERSION you may specify an
alternative version, default is &quot;0&quot;</p>

<p style="margin-top: 1em">For example:</p>

<p style="margin-top: 1em">check host websocket.org with
address &quot;echo.websocket.org&quot; <br>
if failed <br>
port 80 protocol websocket <br>
host &quot;echo.websocket.org&quot; <br>
request &quot;/&quot; <br>
origin &rsquo;http://websocket.com&rsquo; <br>
version 13 <br>
then alert</p>

<p style="margin-top: 1em">CONFIGURATION EXAMPLES <br>
The simplest form is just the check statement. In this
example we check to see if our web server is running and log
a message if not:</p>

<p style="margin-top: 1em">check process nginx with pidfile
/var/run/nginx.pid</p>

<p style="margin-top: 1em">To have Monit start the server
if it&rsquo;s not running, add a start statement:</p>

<p style="margin-top: 1em">check process nginx with pidfile
/var/run/nginx.pid <br>
start program = &quot;/etc/init.d/nginx start&quot;</p>

<p style="margin-top: 1em">Here&rsquo;s a more advanced
example for monitoring an apache web-server listening on the
default port number for HTTP and HTTPS. In this example
Monit will restart apache if it&rsquo;s not <br>
accepting connections at the port numbers. The method Monit
use for restart is to first execute the stop-program, then
wait (up to 30s) for the process to stop and then execute
<br>
the start-program and wait (30s) for it to start. The length
of start or stop wait can be overridden using the
&rsquo;timeout&rsquo; option. If Monit was unable to stop or
start the service <br>
a failed alert message will be sent if you have requested
alert messages to be sent.</p>

<p style="margin-top: 1em">check process apache with
pidfile /var/run/httpd.pid <br>
start program = &quot;/etc/init.d/httpd start&quot; with
timeout 60 seconds <br>
stop program = &quot;/etc/init.d/httpd stop&quot; <br>
if failed port 80 for 2 cycles then restart <br>
if failed port 443 for 2 cycles then restart</p>

<p style="margin-top: 1em">This example demonstrate how you
can run a program as a specified user (uid) and with a
specified group (gid). Many daemon programs can do the uid
and gid switch by themselves, <br>
but for those programs that does not (e.g. Java programs),
monit&rsquo;s ability to start a program as a certain user
can be very useful. In this example we start the Tomcat Java
<br>
Servlet Engine as the standard nobody user and group. Please
note that Monit can only switch uid and gid for the program
if the super-user is running Monit, otherwise Monit will
<br>
simply ignore the request to change uid and gid.</p>

<p style="margin-top: 1em">check process tomcat with
pidfile /var/run/tomcat.pid <br>
start program = &quot;/etc/init.d/tomcat start&quot; <br>
as uid nobody and gid nobody <br>
stop program = &quot;/etc/init.d/tomcat stop&quot; <br>
# You can also use id numbers instead and write: <br>
as uid 99 and with gid 99 <br>
if failed port 8080 then alert</p>

<p style="margin-top: 1em">In this example we use udp for
connection testing to check if the name-server is
running:</p>

<p style="margin-top: 1em">check process named with pidfile
/var/run/named.pid <br>
start program = &quot;/etc/init.d/named start&quot; <br>
stop program = &quot;/etc/init.d/named stop&quot; <br>
if failed port 53 use type udp protocol dns then restart</p>

<p style="margin-top: 1em">The following example
illustrates how to check if the service &rsquo;sophie&rsquo;
is answering connections on its Unix domain socket:</p>

<p style="margin-top: 1em">check process sophie with
pidfile /var/run/sophie.pid <br>
start program = &quot;/etc/init.d/sophie start&quot; <br>
stop program = &quot;/etc/init.d/sophie stop&quot; <br>
if failed unix /var/run/sophie then restart</p>

<p style="margin-top: 1em">In this example we check an
apache web-server running on localhost which answers for
several IP-based virtual hosts or vhosts, hence the host
statement before port:</p>

<p style="margin-top: 1em">check process apache with
pidfile /var/run/httpd.pid <br>
start &quot;/etc/init.d/httpd start&quot; <br>
stop &quot;/etc/init.d/httpd stop&quot; <br>
if failed host www.sol.no port 80 then alert <br>
if failed host shop.sol.no port 443 then alert <br>
if failed host chat.sol.no port 80 then alert</p>

<p style="margin-top: 1em">To make sure that Monit is
communicating with a http server a protocol test can be
added:</p>

<p style="margin-top: 1em">check process apache with
pidfile /var/run/httpd.pid <br>
start &quot;/etc/init.d/httpd start&quot; <br>
stop &quot;/etc/init.d/httpd stop&quot; <br>
if failed <br>
host www.sol.no port 80 protocol http <br>
then alert</p>

<p style="margin-top: 1em">This example demonstrate a
different way to check a web-server using the send/expect
mechanism:</p>

<p style="margin-top: 1em">check process apache with
pidfile /var/run/httpd.pid <br>
start &quot;/etc/init.d/httpd start&quot; <br>
stop &quot;/etc/init.d/httpd stop&quot; <br>
if failed <br>
host www.sol.no port 80 and 0r0 0ost: www.sol.no <br>
send &quot;GET / HTTP/1.1 <br>
expect &quot;HTTP/[0-9.]{3} 200.*&quot; <br>
then alert</p>

<p style="margin-top: 1em">Here we ping a remote host to
check if it is up and if not, send an alert:</p>

<p style="margin-top: 1em">check host www.tildeslash.com
with address www.tildeslash.com <br>
if failed ping then alert</p>

<p style="margin-top: 1em">In the following example we ask
Monit to compute and verify the checksum for the underlying
apache binary used by the start and stop programs. If the
the checksum test should <br>
fail, monitoring will be disabled to prevent possibly
restarting a compromised binary:</p>

<p style="margin-top: 1em">check process apache with
pidfile /var/run/httpd.pid <br>
start program = &quot;/etc/init.d/httpd start&quot; <br>
stop program = &quot;/etc/init.d/httpd stop&quot; <br>
if failed host www.tildeslash.com port 80 then restart <br>
depends on apache_bin</p>

<p style="margin-top: 1em">check file apache_bin with path
/usr/local/apache/bin/httpd <br>
if failed checksum then unmonitor</p>

<p style="margin-top: 1em">In this example we ask Monit to
test a document&rsquo;s checksum on a remote server. If the
checksum was changed we send an alert:</p>

<p style="margin-top: 1em">check host mmonit.com with
address mmonit.com <br>
if failed <br>
port 80 protocol http and <br>
request &quot;/monit/dist/monit-5.7.tar.gz&quot; <br>
with checksum f9d26b8393736b5dfad837bb13780786 <br>
then alert</p>

<p style="margin-top: 1em">Here are a couple of tests for
some popular communication servers, using the SIP protocol.
First we test a FreeSWITCH server and then an Asterisk
server</p>

<p style="margin-top: 1em">check process freeswitch <br>
with pidfile /usr/local/freeswitch/log/freeswitch.pid <br>
start program = &quot;/usr/local/freeswitch/bin/freeswitch
-nc -hp&quot; <br>
stop program = &quot;/usr/local/freeswitch/bin/freeswitch
-stop&quot; <br>
if total memory &gt; 1000.0 MB for 5 cycles then alert <br>
if total memory &gt; 1500.0 MB for 5 cycles then alert <br>
if total memory &gt; 2000.0 MB for 5 cycles then restart
<br>
if cpu &gt; 60% for 5 cycles then alert <br>
if failed <br>
port 5060 type udp protocol SIP <br>
target me@foo.bar and maxforward 10 <br>
then restart</p>

<p style="margin-top: 1em">check process asterisk <br>
with pidfile /var/run/asterisk/asterisk.pid <br>
start program = &quot;/usr/sbin/asterisk&quot; <br>
stop program = &quot;/usr/sbin/asterisk -r -x
&rsquo;shutdown now&rsquo;&quot; <br>
if total memory &gt; 1000.0 MB for 5 cycles then alert <br>
if total memory &gt; 1500.0 MB for 5 cycles then alert <br>
if total memory &gt; 2000.0 MB for 5 cycles then restart
<br>
if cpu &gt; 60% for 5 cycles then alert <br>
if failed <br>
port 5060 type udp protocol SIP <br>
and target me@foo.bar maxforward 10 <br>
then restart</p>

<p style="margin-top: 1em">Some servers are slow starters,
like for example Java based Application Servers. If we want
to keep the poll-cycle low (i.e. &lt; 60 seconds) but allow
some services to take its <br>
time to start, the every statement is handy:</p>

<p style="margin-top: 1em">check process dynamo with
pidfile /etc/dynamo.pid every 2 cycles <br>
start program = &quot;/etc/init.d/dynamo start&quot; <br>
stop program = &quot;/etc/init.d/dynamo stop&quot; <br>
if failed port 8840 then alert</p>

<p style="margin-top: 1em">Here is an example where we
group together two database entries so you can manage them
together, e.g.; &rsquo;Monit -g database start all&rsquo;.
The mode statement is also illustrated in <br>
the first entry and have the effect that Monit will not try
to (re)start this service if it is not running:</p>

<p style="margin-top: 1em">check process sybase with
pidfile /var/run/sybase.pid <br>
start = &quot;/etc/init.d/sybase start&quot; <br>
stop = &quot;/etc/init.d/sybase stop&quot; <br>
mode passive <br>
group database</p>

<p style="margin-top: 1em">check process oracle with
pidfile /var/run/oracle.pid <br>
start program = &quot;/etc/init.d/oracle start&quot; <br>
stop program = &quot;/etc/init.d/oracle stop&quot; <br>
if failed <br>
port 9001 protocol tns <br>
then restart <br>
group database</p>

<p style="margin-top: 1em">This resource checks example
will send an alert if CPU usage of the Apache&rsquo;s http
daemon and its child processes goes beyond 60% for two
cycles. Apache is restarted if the CPU <br>
usage is over 80% for five cycles or the memory usage is
over 100Mb for five cycles or if the machines load average
is more than 10 for 8 cycles:</p>

<p style="margin-top: 1em">check process apache with
pidfile /var/run/httpd.pid <br>
start program = &quot;/etc/init.d/httpd start&quot; <br>
stop program = &quot;/etc/init.d/httpd stop&quot; <br>
if cpu &gt; 40% for 2 cycles then alert <br>
if total cpu &gt; 60% for 2 cycles then alert <br>
if total cpu &gt; 80% for 5 cycles then restart <br>
if mem &gt; 100 MB for 5 cycles then stop <br>
if loadavg(5min) greater than 10.0 for 8 cycles then
stop</p>

<p style="margin-top: 1em">This examples demonstrate the
timestamp statement with exec and how you may restart apache
if its configuration file was changed.</p>

<p style="margin-top: 1em">check file httpd.conf with path
/etc/httpd/httpd.conf <br>
if changed timestamp <br>
then exec &quot;/etc/init.d/httpd graceful&quot;</p>

<p style="margin-top: 1em">In this example we demonstrate
usage of the extended alert statement and a file check
dependency:</p>

<p style="margin-top: 1em">check process apache with
pidfile /var/run/httpd.pid <br>
start = &quot;/etc/init.d/httpd start&quot; <br>
stop = &quot;/etc/init.d/httpd stop&quot; <br>
alert admin@bar on {nonexist, timeout} <br>
with mail-format { <br>
from: bofh@$HOST <br>
subject: apache $EVENT - $ACTION <br>
message: This event occurred on $HOST at $DATE. <br>
Your faithful employee, <br>
monit <br>
} <br>
if failed host www.tildeslash.com port 80 then restart <br>
depend httpd_bin <br>
group apache</p>

<p style="margin-top: 1em">check file httpd_bin with path
/usr/local/apache/bin/httpd <br>
alert security@bar on {checksum, timestamp, <br>
permission, uid, gid} <br>
with mail-format {subject: Alaaarrm! on $HOST} <br>
if failed checksum <br>
and expect 8f7f419955cefa0b33a2ba316cba3659 <br>
then unmonitor <br>
if failed permission 755 then unmonitor <br>
if failed uid root then unmonitor <br>
if failed gid root then unmonitor <br>
if changed timestamp then alert <br>
group apache</p>

<p style="margin-top: 1em">In this example, we demonstrate
usage of the depend statement. In this case, we want to
start oracle and apache. However, we&rsquo;ve set up apache
to use oracle as a back end, and if <br>
oracle is restarted, apache must be restarted as well.</p>

<p style="margin-top: 1em">check process apache with
pidfile /var/run/httpd.pid <br>
start = &quot;/etc/init.d/httpd start&quot; <br>
stop = &quot;/etc/init.d/httpd stop&quot; <br>
depends on oracle</p>

<p style="margin-top: 1em">check process oracle with
pidfile /var/run/oracle.pid <br>
start = &quot;/etc/init.d/oracle start&quot; <br>
stop = &quot;/etc/init.d/oracle stop&quot; <br>
if failed port 9001 for 5 cycles then restart</p>

<p style="margin-top: 1em">Next, we have 2 services,
oracle-import and oracle-export that need to be restarted if
oracle is restarted, but are independent of each other.</p>

<p style="margin-top: 1em">check process oracle with
pidfile /var/run/oracle.pid <br>
start = &quot;/etc/init.d/oracle start&quot; <br>
stop = &quot;/etc/init.d/oracle stop&quot; <br>
if failed port 9001 for 3 cycles then restart</p>

<p style="margin-top: 1em">check process oracle-import <br>
with pidfile /var/run/oracle-import.pid <br>
start = &quot;/etc/init.d/oracle-import start&quot; <br>
stop = &quot;/etc/init.d/oracle-import stop&quot; <br>
depends on oracle</p>

<p style="margin-top: 1em">check process oracle-export <br>
with pidfile /var/run/oracle-export.pid <br>
start = &quot;/etc/init.d/oracle-export start&quot; <br>
stop = &quot;/etc/init.d/oracle-export stop&quot; <br>
depends on oracle</p>

<p style="margin-top: 1em">FILES <br>
~/.monitrc <br>
Default run control file</p>

<p style="margin-top: 1em">/etc/monitrc <br>
If the control file is not found in the default <br>
location and /etc contains a monitrc file, this <br>
file will be used instead.</p>

<p style="margin-top: 1em">./monitrc <br>
If the control file is not found in either of the <br>
previous two locations, and the current working <br>
directory contains a monitrc file, this file is <br>
used instead.</p>

<p style="margin-top: 1em">~/.monit.pid <br>
Lock file to help prevent concurrent runs (non-root <br>
mode).</p>

<p style="margin-top: 1em">/run/monit.pid <br>
Lock file to help prevent concurrent runs (root mode, <br>
Linux systems, if /run directory is available).</p>

<p style="margin-top: 1em">/var/run/monit.pid <br>
Lock file to help prevent concurrent runs (root mode, <br>
Linux systems).</p>

<p style="margin-top: 1em">/etc/monit.pid <br>
Lock file to help prevent concurrent runs (root mode, <br>
systems without /var/run).</p>

<p style="margin-top: 1em">~/.monit.state <br>
Monit saves its state to this file and utilizes <br>
information found in this file to recover from <br>
a crash. This is a binary file and its content is <br>
only of interest to monit. You may set the location <br>
of this file in the Monit control file or by using <br>
the -s switch when Monit is started.</p>

<p style="margin-top: 1em">~/.monit.id <br>
Monit save its unique id to this file.</p>

<p style="margin-top: 1em">ENVIRONMENT <br>
No environment variables are used by Monit. However, when
Monit execute a script or a program Monit will set several
environment variables which can be utilized by the <br>
executable. The following and only the following environment
variables are available:</p>

<p style="margin-top: 1em">MONIT_EVENT <br>
The event that occurred on the service</p>

<p style="margin-top: 1em">MONIT_DESCRIPTION <br>
A description of the error condition</p>

<p style="margin-top: 1em">MONIT_SERVICE <br>
The name of the service (from monitrc) on which the event
occurred.</p>

<p style="margin-top: 1em">MONIT_DATE <br>
The time and date (RFC 822 style) the event occurred</p>

<p style="margin-top: 1em">MONIT_HOST <br>
The host the event occurred on</p>

<p style="margin-top: 1em">The following environment
variables are only available for process service
entries:</p>

<p style="margin-top: 1em">MONIT_PROCESS_PID <br>
The process pid. This may be 0 if the process was
(re)started,</p>

<p style="margin-top: 1em">MONIT_PROCESS_MEMORY <br>
Process memory. This may be 0 if the process was
(re)started,</p>

<p style="margin-top: 1em">MONIT_PROCESS_CHILDREN <br>
Process children. This may be 0 if the process was
(re)started,</p>

<p style="margin-top: 1em">MONIT_PROCESS_CPU_PERCENT <br>
Process cpu%. This may be 0 if the process was
(re)started,</p>

<p style="margin-top: 1em">SIGNALS <br>
If a Monit daemon is running, SIGUSR1 wakes it up from its
sleep phase and forces a poll of all services. SIGTERM and
SIGINT will gracefully terminate a Monit daemon. The SIGTERM
<br>
signal is sent to a Monit daemon if Monit is started with
the quit action argument.</p>

<p style="margin-top: 1em">Sending a SIGHUP signal to a
running Monit daemon will force the daemon to reinitialize
itself, specifically it will reread configuration, close and
reopen log files.</p>

<p style="margin-top: 1em">Running Monit in foreground
while a background Monit daemon is running will wake up the
daemon.</p>

<p style="margin-top: 1em">NOTES <br>
This is a very silent program. Use the -v switch if you want
to see what Monit is doing, and tail -f the logfile.
Optionally for testing purposes; you can start Monit with
the <br>
-Iv switch. Monit will then print debug information to the
console, to stop monit in this mode, simply press CTRL^C
(i.e. SIGINT) in the same console.</p>

<p style="margin-top: 1em">The syntax (and parser) of the
control file was inspired by Eric S. Raymond et al.
excellent fetchmail program. Some portions of this man page
also receive inspiration from the <br>
same authors.</p>

<p style="margin-top: 1em">COPYRIGHT <br>
Copyright (C) 2001-2015 by Tildeslash Ltd. All Rights
Reserved. This product is distributed in the hope that it
will be useful, but WITHOUT any warranty; without even the
<br>
implied warranty of MERCHANTABILITY or FITNESS for a
particular purpose.</p>

<p style="margin-top: 1em">SEE ALSO <br>
GNU text utilities; md5sum(1); sha1sum(1); openssl(1);
glob(7); regex(7); http://www.mmonit.com/</p>

<p style="margin-top: 1em">June 09. 2015 www.mmonit.com
MONIT(1)</p>
<hr>
</body>
</html>
