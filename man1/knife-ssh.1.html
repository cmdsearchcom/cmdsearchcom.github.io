<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>KNIFE-SSH(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">KNIFE-SSH(1)</td>
    <td class="head-vol">knife ssh</td>
    <td class="head-rtitle">KNIFE-SSH(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
knife-ssh - The man page for the knife ssh subcommand.
<div style="height: 1.00em;">&#x00A0;</div>
The <b>knife ssh</b> subcommand is used to invoke SSH commands (in parallel) on
  a subset of nodes within an organization, based on the results of a <i>search
  query</i> made to the Chef server.
<div style="height: 1.00em;">&#x00A0;</div>
<b>Syntax</b>
<div style="height: 1.00em;">&#x00A0;</div>
This subcommand has the following syntax:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ knife ssh SEARCH_QUERY SSH_COMMAND (options)
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>Options</b>
<div style="height: 1.00em;">&#x00A0;</div>
This subcommand has the following options:
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-a SSH_ATTR</b>, <b>--attribute SSH_ATTR</b></b></dt>
  <dd class="It-tag">The attribute that is used when opening the SSH connection.
      The default attribute is the FQDN of the host. Other possible values
      include a public IP address, a private IP address, or a hostname.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-A</b>, <b>--forward-agent</b></b></dt>
  <dd class="It-tag">Use to enable SSH agent forwarding.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-c CONFIG_FILE</b>, <b>--config
    CONFIG_FILE</b></b></dt>
  <dd class="It-tag">The configuration file to use.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-C NUM</b>, <b>--concurrency NUM</b></b></dt>
  <dd class="It-tag">The number of allowed concurrent connections.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--chef-zero-port PORT</b></b></dt>
  <dd class="It-tag">The port on which chef-zero will listen.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--[no-]color</b></b></dt>
  <dd class="It-tag">Use to view colored output.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-d</b>, <b>--disable-editing</b></b></dt>
  <dd class="It-tag">Use to prevent the $EDITOR from being opened and to accept
      data as-is.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--defaults</b></b></dt>
  <dd class="It-tag">Use to have knife use the default value instead of asking a
      user to provide one.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-e EDITOR</b>, <b>--editor EDITOR</b></b></dt>
  <dd class="It-tag">The $EDITOR that is used for all interactive commands.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-E ENVIRONMENT</b>, <b>--environment
    ENVIRONMENT</b></b></dt>
  <dd class="It-tag">The name of the environment. When this option is added to a
      command, the command will run only against the named environment.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-F FORMAT</b>, <b>--format FORMAT</b></b></dt>
  <dd class="It-tag">The output format: <b>summary</b> (default), <b>text</b>,
      <b>json</b>, <b>yaml</b>, and <b>pp</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-G GATEWAY</b>, <b>--ssh-gateway GATEWAY</b></b></dt>
  <dd class="It-tag">The SSH tunnel or gateway that is used to run a bootstrap
      action on a machine that is not accessible from the workstation.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-h</b>, <b>--help</b></b></dt>
  <dd class="It-tag">Shows help for the command.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-i IDENTITY_FILE</b>, <b>--identity-file
    IDENTIFY_FILE</b></b></dt>
  <dd class="It-tag">The SSH identity file used for authentication. Key-based
      authentication is recommended.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-k KEY</b>, <b>--key KEY</b></b></dt>
  <dd class="It-tag">The private key that knife will use to sign requests made
      by the API client to the Chef server.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-m</b>, <b>--manual-list</b></b></dt>
  <dd class="It-tag">Use to define a search query as a space-separated list of
      servers. If there is more than one item in the list, put quotes around the
      entire list. For example: <b>--manual-list &quot;server01 server 02 server
      03&quot;</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--[no-]host-key-verify</b></b></dt>
  <dd class="It-tag">Use <b>--no-host-key-verify</b> to disable host key
      verification. Default setting: <b>--host-key-verify</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>OTHER</b></b></dt>
  <dd class="It-tag">The shell type. Possible values: <b>interactive</b>,
      <b>screen</b>, <b>tmux</b>, <b>macterm</b>, or <b>cssh</b>. (<b>csshx</b>
      is deprecated in favor of <b>cssh</b>.)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-p PORT</b>, <b>--ssh-port PORT</b></b></dt>
  <dd class="It-tag">The SSH port.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-P PASSWORD</b>, <b>--ssh-password
    PASSWORD</b></b></dt>
  <dd class="It-tag">The SSH password. This can be used to pass the password
      directly on the command line. If this option is not specified (and a
      password is required) knife will prompt for the password.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--print-after</b></b></dt>
  <dd class="It-tag">Use to show data after a destructive operation.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-s URL</b>, <b>--server-url URL</b></b></dt>
  <dd class="It-tag">The URL for the Chef server.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>SEARCH_QUERY</b></b></dt>
  <dd class="It-tag">The search query used to return a list of servers to be
      accessed using SSH and the specified <b>SSH_COMMAND</b>. This option uses
      the same syntax as the search sub-command.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>SSH_COMMAND</b></b></dt>
  <dd class="It-tag">The command that will be run against the results of a
      search query.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-u USER</b>, <b>--user USER</b></b></dt>
  <dd class="It-tag">The user name used by knife to sign requests made by the
      API client to the Chef server. Authentication will fail if the user name
      does not match the private key.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-v</b>, <b>--version</b></b></dt>
  <dd class="It-tag">The version of the chef-client.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-V</b>, <b>--verbose</b></b></dt>
  <dd class="It-tag">Set for more verbose outputs. Use <b>-VV</b> for maximum
      verbosity.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-x USER_NAME</b>, <b>--ssh-user
    USER_NAME</b></b></dt>
  <dd class="It-tag">The SSH user name.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-y</b>, <b>--yes</b></b></dt>
  <dd class="It-tag">Use to respond to all confirmation prompts with
      &quot;Yes&quot;. knife will not ask for confirmation.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-z</b>, <b>--local-mode</b></b></dt>
  <dd class="It-tag">Use to run the chef-client in local mode. This allows all
      commands that work against the Chef server to also work against the local
      chef-repo.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>Examples</b>
<div style="height: 1.00em;">&#x00A0;</div>
To find the uptime of all of web servers running Ubuntu on the Amazon EC2
  platform, enter:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ knife ssh &quot;role:web&quot; &quot;uptime&quot; -x ubuntu -a ec2.public_hostname
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
to return something like:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
ec2-174-129-127-206.compute-1.amazonaws.com  13:50:47 up 1 day, 23:26,  1 user,  load average: 0.25, 0.18, 0.11
ec2-67-202-63-102.compute-1.amazonaws.com    13:50:47 up 1 day, 23:33,  1 user,  load average: 0.12, 0.13, 0.10
ec2-184-73-9-250.compute-1.amazonaws.com     13:50:48 up 16:45,  1 user,  load average: 0.30, 0.22, 0.13
ec2-75-101-240-230.compute-1.amazonaws.com   13:50:48 up 1 day, 22:59,  1 user,  load average: 0.24, 0.17, 0.11
ec2-184-73-60-141.compute-1.amazonaws.com    13:50:48 up 1 day, 23:30,  1 user,  load average: 0.32, 0.17, 0.15
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ knife ssh 'name:*' 'sudo chef-client'
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
To force a chef-client run on all of the web servers running Ubuntu on the
  Amazon EC2 platform, enter:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ knife ssh &quot;role:web&quot; &quot;sudo chef-client&quot; -x ubuntu -a ec2.public_hostname
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
to return something like:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
ec2-67-202-63-102.compute-1.amazonaws.com   [Fri, 22 Oct 2010 14:18:37 +0000] INFO: Starting Chef Run (Version 0.9.10)
ec2-174-129-127-206.compute-1.amazonaws.com [Fri, 22 Oct 2010 14:18:37 +0000] INFO: Starting Chef Run (Version 0.9.10)
ec2-184-73-9-250.compute-1.amazonaws.com    [Fri, 22 Oct 2010 14:18:38 +0000] INFO: Starting Chef Run (Version 0.9.10)
ec2-75-101-240-230.compute-1.amazonaws.com  [Fri, 22 Oct 2010 14:18:38 +0000] INFO: Starting Chef Run (Version 0.9.10)
ec2-184-73-60-141.compute-1.amazonaws.com   [Fri, 22 Oct 2010 14:18:38 +0000] INFO: Starting Chef Run (Version 0.9.10)
ec2-174-129-127-206.compute-1.amazonaws.com [Fri, 22 Oct 2010 14:18:39 +0000] INFO: Chef Run complete in 1.419243 seconds
ec2-174-129-127-206.compute-1.amazonaws.com [Fri, 22 Oct 2010 14:18:39 +0000] INFO: cleaning the checksum cache
ec2-174-129-127-206.compute-1.amazonaws.com [Fri, 22 Oct 2010 14:18:39 +0000] INFO: Running report handlers
ec2-174-129-127-206.compute-1.amazonaws.com [Fri, 22 Oct 2010 14:18:39 +0000] INFO: Report handlers complete
ec2-67-202-63-102.compute-1.amazonaws.com   [Fri, 22 Oct 2010 14:18:39 +0000] INFO: Chef Run complete in 1.578265 seconds
ec2-67-202-63-102.compute-1.amazonaws.com   [Fri, 22 Oct 2010 14:18:39 +0000] INFO: cleaning the checksum cache
ec2-67-202-63-102.compute-1.amazonaws.com   [Fri, 22 Oct 2010 14:18:39 +0000] INFO: Running report handlers
ec2-67-202-63-102.compute-1.amazonaws.com   [Fri, 22 Oct 2010 14:18:39 +0000] INFO: Report handlers complete
ec2-184-73-9-250.compute-1.amazonaws.com    [Fri, 22 Oct 2010 14:18:40 +0000] INFO: Chef Run complete in 1.638884 seconds
ec2-184-73-9-250.compute-1.amazonaws.com    [Fri, 22 Oct 2010 14:18:40 +0000] INFO: cleaning the checksum cache
ec2-184-73-9-250.compute-1.amazonaws.com    [Fri, 22 Oct 2010 14:18:40 +0000] INFO: Running report handlers
ec2-184-73-9-250.compute-1.amazonaws.com    [Fri, 22 Oct 2010 14:18:40 +0000] INFO: Report handlers complete
ec2-75-101-240-230.compute-1.amazonaws.com  [Fri, 22 Oct 2010 14:18:40 +0000] INFO: Chef Run complete in 1.540257 seconds
ec2-75-101-240-230.compute-1.amazonaws.com  [Fri, 22 Oct 2010 14:18:40 +0000] INFO: cleaning the checksum cache
ec2-75-101-240-230.compute-1.amazonaws.com  [Fri, 22 Oct 2010 14:18:40 +0000] INFO: Running report handlers
ec2-75-101-240-230.compute-1.amazonaws.com  [Fri, 22 Oct 2010 14:18:40 +0000] INFO: Report handlers complete
ec2-184-73-60-141.compute-1.amazonaws.com   [Fri, 22 Oct 2010 14:18:40 +0000] INFO: Chef Run complete in 1.502489 seconds
ec2-184-73-60-141.compute-1.amazonaws.com   [Fri, 22 Oct 2010 14:18:40 +0000] INFO: cleaning the checksum cache
ec2-184-73-60-141.compute-1.amazonaws.com   [Fri, 22 Oct 2010 14:18:40 +0000] INFO: Running report handlers
ec2-184-73-60-141.compute-1.amazonaws.com   [Fri, 22 Oct 2010 14:18:40 +0000] INFO: Report handlers complete
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
To query for all nodes that have the <b>webserver</b> role and then use SSH to
  run the command <b>sudo chef-client</b>, enter:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ knife ssh &quot;role:webserver&quot; &quot;sudo chef-client&quot;
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ knife ssh name:* &quot;sudo aptitude upgrade -y&quot;
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
To specify the shell type used on the nodes returned by a search query:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ knife ssh roles:opscode-omnitruck macterm
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
where <b>screen</b> is one of the following values: <b>cssh</b>,
  <b>interactive</b>, <b>macterm</b>, <b>screen</b>, or <b>tmux</b>. If the node
  does not have the shell type installed, knife will return an error similar to
  the following:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
you need the rb-appscript gem to use knife ssh macterm.
`(sudo) gem    install rb-appscript` to install
ERROR: LoadError: cannot load such file -- appscript
</pre>
</div>
<br/>
</div>
<br/>
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Chef</div>
<table class="foot">
  <tr>
    <td class="foot-date">Chef 12.0</td>
    <td class="foot-os"></td>
  </tr>
</table>
</body>
</html>
