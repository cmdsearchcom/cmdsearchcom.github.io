<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>OSRF_PYCOMMON(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">OSRF_PYCOMMON(1)</td>
    <td class="head-vol">osrf_pycommon</td>
    <td class="head-rtitle">OSRF_PYCOMMON(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
osrf_pycommon - osrf_pycommon Documentation
<div style="height: 1.00em;">&#x00A0;</div>
<b>osrf_pycommon</b> is a python package which contains commonly used Python
  boilerplate code and patterns. Things like ansi terminal coloring, capturing
  colored output from programs using subprocess, or even a simple logging system
  which provides some nice functionality over the built-in Python logging
  system.
<div style="height: 1.00em;">&#x00A0;</div>
The functionality provided here should be generic enough to be reused in
  arbitrary scenarios and should avoid bringing in dependencies which are not
  part of the standard Python library. Where possible Windows and Linux/OS X
  should be supported, and where it cannot it should be gracefully degrading.
  Code should be pure Python as well as Python 2 and Python 3 bilingual.
<div style="height: 1.00em;">&#x00A0;</div>
Contents:
<h1 class="Sh" title="Sh" id="THE_CLI_UTILS_MODULE"><a class="selflink" href="#THE_CLI_UTILS_MODULE">THE
  CLI_UTILS MODULE</a></h1>
This module provides functions and patterns for creating Command Line Interface
  (CLI) tools.
<h2 class="Ss" title="Ss" id="Common_CLI_Functions"><a class="selflink" href="#Common_CLI_Functions">Common
  CLI Functions</a></h2>
Commonly used, CLI related functions.
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.cli_utils.common.extract_argument_group(args,
    delimiting_option)</b></dt>
  <dd class="It-tag">Extract a group of arguments from a list of arguments using
      a delimiter.
    <div style="height: 1.00em;">&#x00A0;</div>
    Here is an example:</dd>
</dl>
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
&gt;&gt;&gt; extract_argument_group(['foo', '--args', 'bar', '--baz'], '--args')
(['foo'], ['bar', '--baz'])
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The group can always be ended using the double hyphen <b>--</b>. In order to
  pass a double hyphen as arguments, use three hyphens <b>---</b>. Any set of
  hyphens encountered after the delimiter, and up to <b>--</b>, which have three
  or more hyphens and are isolated, will be captured and reduced by one hyphen.
<div style="height: 1.00em;">&#x00A0;</div>
For example:
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
&gt;&gt; extract_argument_group(['foo',
                           '--args', 'bar', '--baz', '---', '--',
                           '--foo-option'], '--args')
(['foo', '--foo-option'], ['bar', '--baz', '--'])
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
In the result the <b>--</b> comes from the <b>---</b> in the input. The
  <b>--args</b> and the corresponding <b>--</b> are removed entirely.
<div style="height: 1.00em;">&#x00A0;</div>
The delimiter and <b>--</b> terminator combination can also happen multiple
  times, in which case the bodies of arguments are combined and returned in the
  order they appeared.
<div style="height: 1.00em;">&#x00A0;</div>
For example:
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
&gt;&gt; extract_argument_group(['foo',
                           '--args', 'ping', '--',
                           'bar',
                           '--args', 'pong', '--',
                           'baz',
                           '--args', '--'], '--args')
(['foo', 'bar', 'baz'], ['ping', 'pong'])
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Note: <b>--</b> cannot be used as the <b>delimiting_option</b>.
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Parameters</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>args</b> (<i>list</i>) -- list of strings which are
      ordered arguments.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>delimiting_option</b> (<i>str</i>) -- option which
      denotes where to split the args.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">tuple of arguments before and after the delimiter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Return type</b></dt>
  <dd class="It-tag">tuple</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Raises</b></dt>
  <dd class="It-tag">ValueError if the delimiting_option is <b>--</b>.</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.cli_utils.common.extract_jobs_flags(arguments)</b></dt>
  <dd class="It-tag">Extracts make job flags from a list of other make flags,
      i.e. -j8 -l8
    <div style="height: 1.00em;">&#x00A0;</div>
    The input arguments are given as a string separated by whitespace. Make job
      flags are matched and removed from the arguments, and the Make job flags
      and what is left over from the input arguments are returned.
    <div style="height: 1.00em;">&#x00A0;</div>
    If no job flags are encountered, then an empty string is returned as the
      first element of the returned tuple.
    <div style="height: 1.00em;">&#x00A0;</div>
    Examples:</dd>
</dl>
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
&gt;&gt; extract_jobs_flags('-j8 -l8')
('-j8 -l8', '')
&gt;&gt; extract_jobs_flags('-j8 ')
('-j8', ' ')
&gt;&gt; extract_jobs_flags('target -j8 -l8 --some-option')
('-j8 -l8', 'target --some-option')
&gt;&gt; extract_jobs_flags('target --some-option')
('', 'target --some-option')
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Parameters</b></dt>
  <dd class="It-tag"><b>arguments</b> (<i>str</i>) -- string of space separated
      arguments which may or may not contain make job flags</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">tuple of make jobs flags as a space separated string and
      leftover arguments as a space separated string</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Return type</b></dt>
  <dd class="It-tag">tuple</dd>
</dl>
</div>
<br/>
</div>
<br/>
<h2 class="Ss" title="Ss" id="The_Verb_Pattern"><a class="selflink" href="#The_Verb_Pattern">The
  Verb Pattern</a></h2>
The verb pattern is a pattern where a single command aggregates multiple related
  commands by taking a required positional argument which is the
  &quot;verb&quot; for the action you want to perform. For example, <b>catkin
  build</b> is an example of a <b>command</b> and <b>verb</b> pair, where
  <b>catkin</b> is the command and <b>build</b> is the verb. In this example,
  the <b>catkin</b> command groups &quot;actions&quot; which are related to
  catkin together using verbs like <b>build</b> which will build a workspace of
  catkin packages.
<h2 class="Ss" title="Ss" id="Command_Boilerplate"><a class="selflink" href="#Command_Boilerplate">Command
  Boilerplate</a></h2>
This is an example boilerplate of a command which will use verbs:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
from __future__ import print_function
<div class="Pp"></div>
import argparse
import sys
<div class="Pp"></div>
from osrf_pycommon.cli_utils.verb_pattern import create_subparsers
from osrf_pycommon.cli_utils.verb_pattern import list_verbs
from osrf_pycommon.cli_utils.verb_pattern import split_arguments_by_verb
<div class="Pp"></div>
COMMAND_NAME = '&lt;INSERT COMMAND NAME HERE&gt;'
<div class="Pp"></div>
VERBS_ENTRY_POINT = '{0}.verbs'.format(COMMAND_NAME)
<div class="Pp"></div>
<div class="Pp"></div>
def main(sysargs=None):
    # Assign sysargs if not set
    sysargs = sys.argv[1:] if sysargs is None else sysargs
<div class="Pp"></div>
    # Create a top level parser
    parser = argparse.ArgumentParser(
        description=&quot;{0} command&quot;.format(COMMAND_NAME)
    )
<div class="Pp"></div>
    # Generate a list of verbs available
    verbs = list_verbs(VERBS_ENTRY_POINT)
<div class="Pp"></div>
    # Create the subparsers for each verb and collect the arg preprocessors
    argument_preprocessors, verb_subparsers = create_subparsers(
        parser,
        COMMAND_NAME,
        verbs,
        VERBS_ENTRY_POINT,
        sysargs,
    )
<div class="Pp"></div>
    # Determine the verb, splitting arguments into pre and post verb
    verb, pre_verb_args, post_verb_args = split_arguments_by_verb(sysargs)
<div class="Pp"></div>
    # Short circuit -h and --help
    if '-h' in pre_verb_args or '--help' in pre_verb_args:
        parser.print_help()
        sys.exit(0)
<div class="Pp"></div>
    # Error on no verb provided
    if verb is None:
        print(parser.format_usage())
        sys.exit(&quot;Error: No verb provided.&quot;)
    # Error on unknown verb provided
    if verb not in verbs:
        print(parser.format_usage())
        sys.exit(&quot;Error: Unknown verb '{0}' provided.&quot;.format(verb))
<div class="Pp"></div>
    # Short circuit -h and --help for verbs
    if '-h' in post_verb_args or '--help' in post_verb_args:
        verb_subparsers[verb].print_help()
        sys.exit(0)
<div class="Pp"></div>
    # First allow the verb's argument preprocessor to strip any args
    # and return any &quot;extra&quot; information it wants as a dict
    processed_post_verb_args, extras = \
        argument_preprocessors[verb](post_verb_args)
    # Then allow argparse to process the left over post-verb arguments along
    # with the pre-verb arguments and the verb itself
    args = parser.parse_args(pre_verb_args + [verb] + processed_post_verb_args)
    # Extend the argparse result with the extras from the preprocessor
    for key, value in extras.items():
        setattr(args, key, value)
<div class="Pp"></div>
    # Finally call the subparser's main function with the processed args
    # and the extras which the preprocessor may have returned
    sys.exit(args.main(args) or 0)
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This function is mostly boilerplate in that it will likely not change much
  between commands of different types, but it would also be less transparent to
  have this function created for you. If you are using this boilerplate to
  implement your command, then you should be careful to update
  <b>COMMAND_NAME</b> to reflect your command's name.
<div style="height: 1.00em;">&#x00A0;</div>
This line defines the <b>entry_point</b> group for your command's verbs:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
VERBS_ENTRY_POINT = '{0}.verbs'.format(COMMAND_NAME)
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
In the case that your command is called <b>foo</b> then this would become
  <b>foo.verbs</b>. This name is important because it is how verbs for this
  command can be provided by your Python package or others. For example, each
  verb for your command <b>foo</b> will need entry in the <b>setup.py</b> of its
  containing package, like this:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
setup(
    ...
    entry_points={
        ...
        'foo.verbs': [
            'bar = foo.verbs.bar:entry_point_data',
        ],
    }
)
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
You can see here that you are defining <b>bar</b> to be a an entry_point of type
  <b>foo.verbs</b> which in turn points to a module and reference
  <b>foo.verbs.bar</b> and <b>entry_point_data</b>. At run time this verb
  pattern will let your command lookup all things defined as <b>foo.verbs</b>
  and load up the reference to which they point.
<h2 class="Ss" title="Ss" id="Adding_Verbs"><a class="selflink" href="#Adding_Verbs">Adding
  Verbs</a></h2>
In order to add a verb to your command, a few things must happen.
<div style="height: 1.00em;">&#x00A0;</div>
First you must have an entry in the <b>setup.py</b> as described above. This
  allows the command to find the <b>entry_point</b> for your verb at run time.
  The <b>entry_point</b> for these verbs should point to a dictionary which
  describes the verb being added.
<div style="height: 1.00em;">&#x00A0;</div>
This is an example of an <b>entry_point_data</b> dictionary for a verb:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
entry_point_data = dict(
    verb='build',
    description='Builds a workspace of packages',
    # Called for execution, given parsed arguments object
    main=main,
    # Called first to setup argparse, given argparse parser
    prepare_arguments=prepare_arguments,
    # Called after prepare_arguments, but before argparse.parse_args
    argument_preprocessor=argument_preprocessor,
)
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
As you can see this dictionary describes the verb and gives references to
  functions which allow the command to describe the verb, hook into argparse
  parameter creation for the verb, and to execute the verb. The <b>verb</b>,
  <b>description</b>, <b>main</b>, and <b>prepare_arguments</b> keys of the
  dictionary are required, but the <b>argument_preprocessor</b> key is optional.
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>verb</b>: This is the name of the verb, and is how the
      command knows which verb implementation to match to a verb on the command
      line.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>description</b>: This is used by the argument parsing to
      describe the verb in <b>--help</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>prepare_arguments</b>: This function gets called to
      allow the verb to setup it's own argparse options. This function should
      always take one parameter which is the <b>argparse.ArgumentParser</b> for
      this verb, to which arguments can be added. It can optionally take a
      second parameter which are the current command line arguments. This is not
      always needed, but can be useful in some cases. This function should
      always return the parser.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>argument_preprocessor</b>: This function is optional,
      but allows your verb an opportunity to process the raw arguments before
      they are passed to argparse's <b>parse_args</b> function. This can be
      useful when argparse is not capable of processing the options
    correctly.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>main</b>: This is the implementation of the verb, it
      gets called last and is passed the parsed arguments. The return type of
      this function is used for <b>sys.exit</b>, a return type of <b>None</b> is
      interpreted as <b>0</b>.</dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Here is an invented example of <b>main</b>, <b>prepare_arguments</b>, and
  <b>argument_preprocessor</b>:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
def prepare_arguments(parser):
    parser.add_argument('--some-argument', action='store_true', default=False)
    return parser
<div class="Pp"></div>
def argument_preprocessor(args):
    extras = {}
<div class="Pp"></div>
    if '-strange-argument' in args:
        args.remove('-strange-argument')
        extras['strange_argument'] = True
<div class="Pp"></div>
    return args, extras
<div class="Pp"></div>
def main(options):
    print('--some-argument:', options.some_argument)
    print('-strange-argument:', options.strange_argument)
    if options.strange_argument:
        return 1
    return 0
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
The above example is simply to illustrate the signature of these functions and
  how they might be used.
<h2 class="Ss" title="Ss" id="Verb_Pattern_API"><a class="selflink" href="#Verb_Pattern_API">Verb
  Pattern API</a></h2>
API for implementing commands and verbs which used the verb pattern.
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.cli_utils.verb_pattern.call_prepare_arguments(func,
    parser, sysargs=None)</b></dt>
  <dd class="It-tag">Call a prepare_arguments function with the correct number
      of parameters.
    <div style="height: 1.00em;">&#x00A0;</div>
    The <b>prepare_arguments</b> function of a verb can either take one
      parameter, <b>parser</b>, or two parameters <b>parser</b> and <b>args</b>,
      where <b>args</b> are the current arguments being processed.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Parameters</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>func</b> (<i>Callabe</i>) -- Callable
      <b>prepare_arguments</b> function.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>parser</b> (<b>argparse.ArgumentParser</b>) -- parser
      which is always passed to the function</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sysargs</b> (<i>list</i>) -- arguments to optionally
      pass to the function, if needed</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">return value of function or the parser if the function
      returns None.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Return type</b></dt>
  <dd class="It-tag"><b>argparse.ArgumentParser</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Raises</b></dt>
  <dd class="It-tag">ValueError if a function with the wrong number of
      parameters is given</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.cli_utils.verb_pattern.create_subparsers(parser,
    cmd_name, verbs, group, sysargs, title=None)</b></dt>
  <dd class="It-tag">Creates argparse subparsers for each verb which can be
      discovered.
    <div style="height: 1.00em;">&#x00A0;</div>
    Using the <b>verbs</b> parameter, the availble verbs are iterated through.
      For each verb a subparser is created for it using the <b>parser</b>
      parameter. The <b>cmd_name</b> is used to fill the title and description
      of the <b>add_subparsers</b> function call. The <b>group</b> parameter is
      used with each verb to load the verb's <b>description</b>,
      <b>prepare_arguments</b> function, and the verb's
      <b>argument_preprocessors</b> if available. Each verb's
      <b>prepare_arguments</b> function is called, allowing them to add
      arguments. Finally a list of <b>argument_preprocessors</b> functions and
      verb subparsers are returned, one for each verb.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Parameters</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>parser</b> (<b>argparse.ArgumentParser</b>) -- parser
      for this command</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>cmd_name</b> (<i>str</i>) -- name of the command to
      which the verbs are being added</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>verbs</b> (<i>list</i>) -- list of verbs (by name as a
      string)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>group</b> (<i>str</i>) -- name of the <b>entry_point</b>
      group for the verbs</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>sysargs</b> (<i>list</i>) -- list of system
    arguments</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>title</b> (<i>str</i>) -- optional custom title for the
      command</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">tuple of argument_preprocessors and verb subparsers</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Return type</b></dt>
  <dd class="It-tag">tuple</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.cli_utils.verb_pattern.default_argument_preprocessor(args)</b></dt>
  <dd class="It-tag">Return unmodifed args and an empty dict for extras</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.cli_utils.verb_pattern.list_verbs(group)</b></dt>
  <dd class="It-tag">List verbs available for a given <b>entry_point</b>
    group.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Parameters</b></dt>
  <dd class="It-tag"><b>group</b> (<i>str</i>) -- <b>entry_point</b> group name
      for the verbs to list</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">list of verb names for the given <b>entry_point</b>
    group</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Return type</b></dt>
  <dd class="It-tag">list of str</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.cli_utils.verb_pattern.load_verb_description(verb_name,
    group)</b></dt>
  <dd class="It-tag">Load description of a verb in a given group by name.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Parameters</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>verb_name</b> (<i>str</i>) -- name of the verb to load,
      as a string</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>group</b> (<i>str</i>) -- <b>entry_point</b> group name
      which the verb is in</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">verb description</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Return type</b></dt>
  <dd class="It-tag">dict</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.cli_utils.verb_pattern.split_arguments_by_verb(arguments)</b></dt>
  <dd class="It-tag">Split arguments by verb.
    <div style="height: 1.00em;">&#x00A0;</div>
    Given a list of arguments (list of strings), the verb, the pre verb
      arguments, and the post verb arugments are returned.
    <div style="height: 1.00em;">&#x00A0;</div>
    For example:</dd>
</dl>
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
&gt;&gt;&gt; args = ['--command-arg1', 'verb', '--verb-arg1', '--verb-arg2']
&gt;&gt;&gt; split_arguments_by_verb(args)
('verb', ['--command-arg1'], ['--verb-arg1', '--verb-arg2'])
</pre>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Parameters</b></dt>
  <dd class="It-tag"><b>arguments</b> (<i>list</i>) -- list of system
    arguments</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">the verb (str), pre verb args (list), and post verb args
      (list)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Return type</b></dt>
  <dd class="It-tag">tuple</dd>
</dl>
</div>
<br/>
</div>
<br/>
<h1 class="Sh" title="Sh" id="THE_PROCESS_UTILS_MODULE"><a class="selflink" href="#THE_PROCESS_UTILS_MODULE">THE
  PROCESS_UTILS MODULE</a></h1>
This module provides functions for doing process management.
<div style="height: 1.00em;">&#x00A0;</div>
These are the main sections of this module:
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>Asynchronous Process Utilities</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>Synchronous Process Utilities</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>Utility Functions</i></dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Asynchronous_Process_Utilities"><a class="selflink" href="#Asynchronous_Process_Utilities">Asynchronous
  Process Utilities</a></h2>
There is a function and class which can be used together with your custom
  <i>Tollius</i> or <i>asyncio</i> run loop.
<div style="height: 1.00em;">&#x00A0;</div>
The <i>osrf_pycommon.process_utils.async_execute_process()</i> function is a
  <i>coroutine</i> which allows you to run a process and get the output back bit
  by bit in real-time, either with stdout and stderr separated or combined. This
  function also allows you to emulate the terminal using a pty simply by
  toggling a flag in the parameters.
<div style="height: 1.00em;">&#x00A0;</div>
Along side this coroutine is a <i>Protocol</i> class,
  <i>osrf_pycommon.process_utils.AsyncSubprocessProtocol</i>, from which you can
  inherit in order to customize how the yielded output is handled.
<div style="height: 1.00em;">&#x00A0;</div>
Because this coroutine is built on the <b>trollius</b>/<b>asyncio</b>
  framework's subprocess functions, it is portable and should behave the same on
  all major OS's. (including on Windows where an IOCP implementation is used)
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.process_utils.async_execute_process(protocol_class,
    cmd=None, cwd=None, env=None, shell=False, emulate_tty=False,
    stderr_to_stdout=True)</b></dt>
  <dd class="It-tag">Coroutine to execute a subprocess and yield the output back
      asynchronously.
    <div style="height: 1.00em;">&#x00A0;</div>
    This function is meant to be used with the Python <b>asyncio</b> module,
      which is available via pip with Python 3.3 and built-in to Python 3.4. On
      Python &gt;= 2.6 you can use the <b>trollius</b> module to get the same
      functionality, but without using the new <b>yield from</b> syntax.
    <div style="height: 1.00em;">&#x00A0;</div>
    Here is an example of how to use this function:</dd>
</dl>
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
import asyncio
from osrf_pycommon.process_utils import async_execute_process
from osrf_pycommon.process_utils import AsyncSubprocessProtocol
from osrf_pycommon.process_utils import get_loop
<div class="Pp"></div>
<div class="Pp"></div>
@asyncio.coroutine
def setup():
    transport, protocol = yield from async_execute_process(
        AsyncSubprocessProtocol, ['ls', '/usr'])
    returncode = yield from protocol.complete
    return returncode
<div class="Pp"></div>
retcode = get_loop().run_until_complete(setup())
get_loop().close()
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
That same example using <b>trollius</b> would look like this:
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
import trollius as asyncio
from osrf_pycommon.process_utils import async_execute_process
from osrf_pycommon.process_utils import AsyncSubprocessProtocol
from osrf_pycommon.process_utils import get_loop
<div class="Pp"></div>
<div class="Pp"></div>
@asyncio.coroutine
def setup():
    transport, protocol = yield asyncio.From(async_execute_process(
        AsyncSubprocessProtocol, ['ls', '/usr']))
    returncode = yield asyncio.From(protocol.complete)
    raise asyncio.Return(returncode)
<div class="Pp"></div>
retcode = get_loop().run_until_complete(setup())
get_loop().close()
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This difference is required because in Python &lt; 3.3 the <b>yield from</b>
  syntax is not valid.
<div style="height: 1.00em;">&#x00A0;</div>
In both examples, the first argument is the default
  <b>AsyncSubprocessProtocol</b> protocol class, which simply prints output from
  stdout to stdout and output from stderr to stderr.
<div style="height: 1.00em;">&#x00A0;</div>
If you want to capture and do something with the output or write to the stdin,
  then you need to subclass from the <b>AsyncSubprocessProtocol</b> class, and
  override the <b>on_stdout_received</b>, <b>on_stderr_received</b>, and
  <b>on_process_exited</b> functions.
<div style="height: 1.00em;">&#x00A0;</div>
See the documentation for the <b>AsyncSubprocessProtocol</b> class for more
  details, but here is an example which uses asyncio from Python 3.4:
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
import asyncio
from osrf_pycommon.process_utils import async_execute_process
from osrf_pycommon.process_utils import AsyncSubprocessProtocol
from osrf_pycommon.process_utils import get_loop
<div class="Pp"></div>
<div class="Pp"></div>
class MyProtocol(AsyncSubprocessProtocol):
    def __init__(self, file_name, **kwargs):
        self.fh = open(file_name, 'w')
        AsyncSubprocessProtocol.__init__(self, **kwargs)
<div class="Pp"></div>
    def on_stdout_received(self, data):
        # Data has line endings intact, but is bytes in Python 3
        self.fh.write(data.decode('utf-8'))
<div class="Pp"></div>
    def on_stderr_received(self, data):
        self.fh.write(data.decode('utf-8'))
<div class="Pp"></div>
    def on_process_exited(self, returncode):
        self.fh.write(&quot;Exited with return code: {0}&quot;.format(returncode))
        self.fh.close()
<div class="Pp"></div>
<div class="Pp"></div>
@asyncio.coroutine
def log_command_to_file(cmd, file_name):
<div class="Pp"></div>
    def create_protocol(**kwargs):
        return MyProtocol(file_name, **kwargs)
<div class="Pp"></div>
    transport, protocol = yield from async_execute_process(
        create_protocol, cmd)
    returncode = yield from protocol.complete
    return returncode
<div class="Pp"></div>
get_loop().run_until_complete(
    log_command_to_file(['ls', '/'], '/tmp/out.txt'))
get_loop().close()
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
See the <b>subprocess.Popen</b> class for more details on some of the parameters
  to this function like <b>cwd</b>, <b>env</b>, and <b>shell</b>.
<div style="height: 1.00em;">&#x00A0;</div>
See the <i>osrf_pycommon.process_utils.execute_process()</i> function for more
  details on the <b>emulate_tty</b> parameter.
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Parameters</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>protocol_class</b> (<b>AsyncSubprocessProtocol</b> or a
      subclass) -- Protocol class which handles subprocess callbacks</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>cmd</b> (<i>list</i>) -- list of arguments where the
      executable is the first item</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>cwd</b> (<i>str</i>) -- directory in which to run the
      command</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>env</b> (<i>dict</i>) -- a dictionary of environment
      variable names to values</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>shell</b> (<i>bool</i>) -- if True, the <b>cmd</b>
      variable is interpreted by a the shell</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>emulate_tty</b> (<i>bool</i>) -- if True, pty's are
      passed to the subprocess for stdout and stderr, see
      <i>osrf_pycommon.process_utils.execute_process()</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>stderr_to_stdout</b> (<i>bool</i>) -- if True, stderr is
      directed to stdout, so they are not captured separately.</dd>
</dl>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>class
    osrf_pycommon.process_utils.AsyncSubprocessProtocol(stdin=None, stdout=None,
    stderr=None)</b></dt>
  <dd class="It-tag">Protocol to subclass to get events from
      <b>async_execute_process()</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
    When subclassing this Protocol class, you should override these
    functions:</dd>
</dl>
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
def on_stdout_received(self, data):
    # ...
<div class="Pp"></div>
def on_stderr_received(self, data):
    # ...
<div class="Pp"></div>
def on_process_exited(self, returncode):
    # ...
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
By default these functions just print the data received from stdout and stderr
  and does nothing when the process exits.
<div style="height: 1.00em;">&#x00A0;</div>
Data received by the <b>on_stdout_received</b> and <b>on_stderr_received</b>
  functions is always in bytes ( <b>str</b> in Python2 and <b>bytes</b> in
  Python3). Therefore, it may be necessary to call <b>.decode()</b> on the data
  before printing to the screen.
<div style="height: 1.00em;">&#x00A0;</div>
Additionally, the data received will not be stripped of new lines, so take that
  into consideration when printing the result.
<div style="height: 1.00em;">&#x00A0;</div>
You can also override these less commonly used functions:
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
def on_stdout_open(self):
    # ...
<div class="Pp"></div>
def on_stdout_close(self, exc):
    # ...
<div class="Pp"></div>
def on_stderr_open(self):
    # ...
<div class="Pp"></div>
def on_stderr_close(self, exc):
    # ...
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
These functions are called when stdout/stderr are opened and closed, and can be
  useful when using pty's for example. The <b>exc</b> parameter of the
  <b>*_close</b> functions is None unless there was an exception.
<div style="height: 1.00em;">&#x00A0;</div>
In addition to the overridable functions this class has a few useful public
  attributes. The <b>stdin</b> attribute is a reference to the PipeProto which
  follows the <b>asyncio.WriteTransport</b> interface. The <b>stdout</b> and
  <b>stderr</b> attributes also reference their PipeProto. The <b>complete</b>
  attribute is a <b>asyncio.Future</b> which is set to complete when the process
  exits and its result is the return code.
<div style="height: 1.00em;">&#x00A0;</div>
The <b>complete</b> attribute can be used like this:
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
import asyncio
from osrf_pycommon.process_utils import async_execute_process
from osrf_pycommon.process_utils import AsyncSubprocessProtocol
from osrf_pycommon.process_utils import get_loop
<div class="Pp"></div>
<div class="Pp"></div>
@asyncio.coroutine
def setup():
    transport, protocol = yield from async_execute_process(
        AsyncSubprocessProtocol, ['ls', '-G', '/usr'])
    retcode = yield from protocol.complete
    print(&quot;Exited with&quot;, retcode)
<div class="Pp"></div>
# This will block until the protocol.complete Future is done.
get_loop().run_until_complete(setup())
get_loop().close()
</pre>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
In addtion to these functions, there is a utility function for getting the
  correct <b>asyncio</b> event loop:
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.process_utils.get_loop()</b></dt>
  <dd class="It-tag">This function will return the proper event loop for the
      subprocess async calls.
    <div style="height: 1.00em;">&#x00A0;</div>
    On Unix this just returns <b>asyncio.get_event_loop()</b>, but on Windows it
      will set and return a <b>asyncio.ProactorEventLoop</b> instead.</dd>
</dl>
</div>
<br/>
<h2 class="Ss" title="Ss" id="Treatment_of_File_Descriptors"><a class="selflink" href="#Treatment_of_File_Descriptors">Treatment
  of File Descriptors</a></h2>
Unlike <b>subprocess.Popen</b>, all of the <b>process_utils</b> functions behave
  the same way on Python versions 2.7 through 3.4, and they do not close
  <i>inheritable
  &lt;https://docs.python.org/3.4/library/os.html#fd-inheritance&gt;</i>. file
  descriptors before starting subprocesses. This is equivalent to passing
  <b>close_fds=False</b> to <b>subprocess.Popen</b> on all Python versions.
<div style="height: 1.00em;">&#x00A0;</div>
In Python 3.2, the <b>subprocess.Popen</b> default for the <b>close_fds</b>
  option changed from <b>False</b> to <b>True</b> so that file descriptors
  opened by the parent process were closed before spawning the child process. In
  Python 3.4, <i>PEP 0446</i> additionally made it so even when
  <b>close_fds=False</b> file descriptors which are <i>non-inheritable</i> are
  still closed before spawning the subprocess.
<div style="height: 1.00em;">&#x00A0;</div>
If you want to be able to pass file descriptors to subprocesses in Python 3.4 or
  higher, you will need to make sure they are <i>inheritable
  &lt;https://docs.python.org/3.4/library/os.html#fd-inheritance&gt;</i>.
<h2 class="Ss" title="Ss" id="Synchronous_Process_Utilities"><a class="selflink" href="#Synchronous_Process_Utilities">Synchronous
  Process Utilities</a></h2>
For synchronous execution and output capture of subprocess, there are two
  functions:
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>osrf_pycommon.process_utils.execute_process()</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><i>osrf_pycommon.process_utils.execute_process_split()</i></dd>
</dl>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
These functions are not yet using the <b>trollius</b>/<b>asyncio</b> framework
  as a back-end and therefore on Windows will not stream the data from the
  subprocess as it does on Unix machines. Instead data will not be yielded until
  the subprocess is finished and all output is buffered (the normal warnings
  about long running programs with lots of output apply).
<div style="height: 1.00em;">&#x00A0;</div>
The streaming of output does not work on Windows because on Windows the
  <b>select.select()</b> method only works on sockets and not file-like objects
  which are used with subprocess pipes. <b>asyncio</b> implements Windows
  subprocess support by implementing a Proactor event loop based on Window's
  IOCP API. One future option will be to implement this synchronous style method
  using IOCP in this module, but another option is to just make synchronous the
  asynchronous calls, but there are issues with that as well. In the mean time,
  if you need streaming of output in both Windows and Unix, use the asynchronous
  calls.
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.process_utils.execute_process(cmd,
    cwd=None, env=None, shell=False, emulate_tty=False)</b></dt>
  <dd class="It-tag">Executes a command with arguments and returns output line
      by line.
    <div style="height: 1.00em;">&#x00A0;</div>
    All arguments, except <b>emulate_tty</b>, are passed directly to
      <b>subprocess.Popen</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
     <b>execute_process</b> returns a generator which yields the output, line by
      line, until the subprocess finishes at which point the return code is
      yielded.
    <div style="height: 1.00em;">&#x00A0;</div>
    This is an example of how this function should be used:</dd>
</dl>
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
from __future__ import print_function
from osrf_pycommon.process_utils import execute_process
<div class="Pp"></div>
cmd = ['ls', '-G']
for line in execute_process(cmd, cwd='/usr'):
    if isinstance(line, int):
        # This is a return code, the command has exited
        print(&quot;'{0}' exited with: {1}&quot;.format(' '.join(cmd), line))
        continue  # break would also be appropriate here
    # In Python 3, it will be a bytes array which needs to be decoded
    if not isinstance(line, str):
        line = line.decode('utf-8')
    # Then print it to the screen
    print(line, end='')
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>stdout</b> and <b>stderr</b> are always captured together and returned line
  by line through the returned generator. New line characters are preserved in
  the output, so if re-printing the data take care to use <b>end=''</b> or first
  <b>rstrip</b> the output lines.
<div style="height: 1.00em;">&#x00A0;</div>
When <b>emulate_tty</b> is used on Unix systems, commands will identify that
  they are on a tty and should output color to the screen as if you were running
  it on the terminal, and therefore there should not be any need to pass
  arguments like <b>-c color.ui=always</b> to commands like <b>git</b>.
  Additionally, programs might also behave differently in when
  <b>emulate_tty</b> is being used, for example, Python will default to
  unbuffered output when it detects a tty.
<div style="height: 1.00em;">&#x00A0;</div>
<b>emulate_tty</b> works by using psuedo-terminals on Unix machines, and so if
  you are running this command many times in parallel (like hundreds of times)
  then you may get one of a few different <b>OSError</b>'s. For example,
  &quot;OSError: [Errno 24] Too many open files: '/dev/ttyp0'&quot; or
  &quot;OSError: out of pty devices&quot;. You should also be aware that you
  share pty devices with the rest of the system, so even if you are not using a
  lot, it is possible to get this error. You can catch this error before getting
  data from the generator, so when using <b>emulate_tty</b> you might want to do
  something like this:
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
from __future__ import print_function
from osrf_pycommon.process_utils import execute_process
<div class="Pp"></div>
cmd = ['ls', '-G', '/usr']
try:
    output = execute_process(cmd, emulate_tty=True)
except OSError:
    output = execute_process(cmd, emulate_tty=False)
for line in output:
    if isinstance(line, int):
        print(&quot;'{0}' exited with: {1}&quot;.format(' '.join(cmd), line))
        continue
    # In Python 3, it will be a bytes array which needs to be decoded
    if not isinstance(line, str):
        line = line.decode('utf-8')
    print(line, end='')
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This way if a pty cannot be opened in order to emulate the tty then you can try
  again without emulation, and any other <b>OSError</b> should raise again with
  <b>emulate_tty</b> set to <b>False</b>. Obviously, you only want to do this if
  emulating the tty is non-critical to your processing, like when you are using
  it to capture color.
<div style="height: 1.00em;">&#x00A0;</div>
Any color information that the command outputs as ANSI escape sequences is
  captured by this command. That way you can print the output to the screen and
  preserve the color formatting.
<div style="height: 1.00em;">&#x00A0;</div>
If you do not want color to be in the output, then try setting
  <b>emulate_tty</b> to <b>False</b>, but that does not guarantee that there is
  no color in the output, instead it only will cause called processes to
  identify that they are not being run in a terminal. Most well behaved programs
  will not output color if they detect that they are not being executed in a
  terminal, but you shouldn't rely on that.
<div style="height: 1.00em;">&#x00A0;</div>
If you want to ensure there is no color in the output from an executed process,
  then use this function:
<div style="height: 1.00em;">&#x00A0;</div>
<b>osrf_pycommon.terminal_color.remove_ansi_escape_senquences()</b>
<div style="height: 1.00em;">&#x00A0;</div>
Exceptions can be raised by functions called by the implementation, for example,
  <b>subprocess.Popen</b> can raise an <b>OSError</b> when the given command is
  not found. If you want to check for the existence of an executable on the
  path, see: <b>which()</b>. However, this function itself does not raise any
  special exceptions.
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Parameters</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>cmd</b> (<i>list</i>) -- list of strings with the first
      item being a command and subsequent items being any arguments to that
      command; passed directly to <b>subprocess.Popen</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>cwd</b> (<i>str</i>) -- path in which to run the
      command, defaults to None which means <b>os.getcwd()</b> is used; passed
      directly to <b>subprocess.Popen</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>env</b> (<i>dict</i>) -- environment dictionary to use
      for executing the command, default is None which uses the
      <b>os.environ</b> environment; passed directly to
    <b>subprocess.Popen</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>shell</b> (<i>bool</i>) -- If True the system shell is
      used to evaluate the command, default is False; passed directly to
      <b>subprocess.Popen</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>emulate_tty</b> (<i>bool</i>) -- If True attempts to use
      a pty to convince subprocess's that they are being run in a terminal.
      Typically this is useful for capturing colorized output from commands.
      This does not work on Windows (no pty's), so it is considered False even
      when True. Defaults to False.</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">a generator which yields output from the command line by
      line</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Return type</b></dt>
  <dd class="It-tag">generator which yields strings</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Availability: Unix (streaming), Windows (blocking)
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.process_utils.execute_process_split(cmd,
    cwd=None, env=None, shell=False, emulate_tty=False)</b></dt>
  <dd class="It-tag"><b>execute_process()</b>, except <b>stderr</b> is returned
      separately.
    <div style="height: 1.00em;">&#x00A0;</div>
    Instead of yielding output line by line until yielding a return code, this
      function always a triplet of <b>stdout</b>, <b>stderr</b>, and return
      code. Each time only one of the three will not be None. Once you receive a
      non-None return code (type will be int) there will be no more
      <b>stdout</b> or <b>stderr</b>. Therefore you can use the command like
      this:</dd>
</dl>
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
from __future__ import print_function
import sys
from osrf_pycommon.process_utils import execute_process_split
<div class="Pp"></div>
cmd = ['time', 'ls', '-G']
for out, err, ret in execute_process_split(cmd, cwd='/usr'):
    # In Python 3, it will be a bytes array which needs to be decoded
    out = out.decode('utf-8') if out is not None else None
    err = err.decode('utf-8') if err is not None else None
    if ret is not None:
        # This is a return code, the command has exited
        print(&quot;'{0}' exited with: {1}&quot;.format(' '.join(cmd), ret))
        break
    if out is not None:
        print(out, end='')
    if err is not None:
        print(err, end='', file=sys.stderr)
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
When using this, it is possible that the <b>stdout</b> and <b>stderr</b> data
  can be returned in a different order than what would happen on the terminal.
  This is due to the fact that the subprocess is given different buffers for
  <b>stdout</b> and <b>stderr</b> and so there is a race condition on the
  subprocess writing to the different buffers and this command reading the
  buffers. This can be avoided in most scenarios by using <b>emulate_tty</b>,
  because of the use of <b>pty</b>'s, though the ordering can still not be
  guaranteed and the number of <b>pty</b>'s is finite as explained in the
  documentation for <b>execute_process()</b>. For situations where output
  ordering between <b>stdout</b> and <b>stderr</b> are critical, they should not
  be returned separately and instead should share one buffer, and so
  <b>execute_process()</b> should be used.
<div style="height: 1.00em;">&#x00A0;</div>
For all other parameters and documentation see: <b>execute_process()</b></div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Availability: Unix (streaming), Windows (blocking)
<h2 class="Ss" title="Ss" id="Utility_Functions"><a class="selflink" href="#Utility_Functions">Utility
  Functions</a></h2>
Currently there is only one utility function, a Python implementation of the
  <b>which</b> shell command.
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.process_utils.which(cmd, mode=1,
    path=None, **kwargs)</b></dt>
  <dd class="It-tag">Given a command, mode, and a PATH string, return the path
      which conforms to the given mode on the PATH, or None if there is no such
      file.
    <div style="height: 1.00em;">&#x00A0;</div>
     <i>mode</i> defaults to <b>os.F_OK | os.X_OK</b>. <i>path</i> defaults to
      the result of <b>os.environ.get(&quot;PATH&quot;)</b>, or can be
      overridden with a custom search path.
    <div style="height: 1.00em;">&#x00A0;</div>
    Backported from <b>shutil.which()</b> (
      <i>https://docs.python.org/3.3/library/shutil.html#shutil.which</i>),
      available in Python 3.3.</dd>
</dl>
</div>
<br/>
<h1 class="Sh" title="Sh" id="THE_TERMINAL_COLOR_MODULE"><a class="selflink" href="#THE_TERMINAL_COLOR_MODULE">THE
  TERMINAL_COLOR MODULE</a></h1>
This module provides tools for colorizing terminal output.
<div style="height: 1.00em;">&#x00A0;</div>
This module defines the ansi escape sequences used for colorizing the output
  from terminal programs in Linux. You can access the ansi escape sequences
  using the <i>ansi()</i> function:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
&gt;&gt;&gt; from osrf_pycommon.terminal_color import ansi
&gt;&gt;&gt; print([&quot;This is &quot;, ansi('red'), &quot;red&quot;, ansi('reset'), &quot;.&quot;])
['This is ', '\x1b[31m', 'red', '\x1b[0m', '.']
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
You can also use <i>format_color()</i> to do in-line substitution of keys
  wrapped in <b>@{}</b> markers for their ansi escape sequences:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
&gt;&gt;&gt; from osrf_pycommon.terminal_color import format_color
&gt;&gt;&gt; print(format_color(&quot;This is @{bf}blue@{reset}.&quot;).split())
['This', 'is', '\x1b[34mblue\x1b[0m.']
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This is a list of all of the available substitutions:
<table class="tbl">
  <colgroup>
    <col style="width: 19.00ex;"/>
    <col style="width: 11.00ex;"/>
    <col style="width: 15.00ex;"/>
  </colgroup>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td>Long Form</td>
    <td>Shorter</td>
    <td>Value</td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{blackf}</b></td>
    <td><b>@{kf}</b></td>
    <td><b>\033[30m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{redf}</b></td>
    <td><b>@{rf}</b></td>
    <td><b>\033[31m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{greenf}</b></td>
    <td><b>@{gf}</b></td>
    <td><b>\033[32m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{yellowf}</b></td>
    <td><b>@{yf}</b></td>
    <td><b>\033[33m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{bluef}</b></td>
    <td><b>@{bf}</b></td>
    <td><b>\033[34m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{purplef}</b></td>
    <td><b>@{pf}</b></td>
    <td><b>\033[35m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{cyanf}</b></td>
    <td><b>@{cf}</b></td>
    <td><b>\033[36m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{whitef}</b></td>
    <td><b>@{wf}</b></td>
    <td><b>\033[37m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{blackb}</b></td>
    <td><b>@{kb}</b></td>
    <td><b>\033[40m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{redb}</b></td>
    <td><b>@{rb}</b></td>
    <td><b>\033[41m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{greenb}</b></td>
    <td><b>@{gb}</b></td>
    <td><b>\033[42m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{yellowb}</b></td>
    <td><b>@{yb}</b></td>
    <td><b>\033[43m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{blueb}</b></td>
    <td><b>@{bb}</b></td>
    <td><b>\033[44m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{purpleb}</b></td>
    <td><b>@{pb}</b></td>
    <td><b>\033[45m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{cyanb}</b></td>
    <td><b>@{cb}</b></td>
    <td><b>\033[46m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{whiteb}</b></td>
    <td><b>@{wb}</b></td>
    <td><b>\033[47m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{escape}</b></td>
    <td></td>
    <td><b>\033</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{reset}</b></td>
    <td><b>@|</b></td>
    <td><b>\033[0m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{boldon}</b></td>
    <td><b>@!</b></td>
    <td><b>\033[1m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{italicson}</b></td>
    <td><b>@/</b></td>
    <td><b>\033[3m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{ulon}</b></td>
    <td><b>@_</b></td>
    <td><b>\033[4m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{invon}</b></td>
    <td></td>
    <td><b>\033[7m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{boldoff}</b></td>
    <td></td>
    <td><b>\033[22m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{italicsoff}</b></td>
    <td></td>
    <td><b>\033[23m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{uloff}</b></td>
    <td></td>
    <td><b>\033[24m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
  <tr>
    <td><b>@{invoff}</b></td>
    <td></td>
    <td><b>\033[27m</b></td>
  </tr>
  <tr>
    <td colspan="0"></td>
  </tr>
</table>
<div style="height: 1.00em;">&#x00A0;</div>
These substitution's values come from the ANSI color escape sequences, see:
  <i>http://en.wikipedia.org/wiki/ANSI_escape_code</i>
<div style="height: 1.00em;">&#x00A0;</div>
Also for any of the keys which have a trailing <b>f</b>, you can safely drop the
  trailing <b>f</b> and get the same thing.
<div style="height: 1.00em;">&#x00A0;</div>
For example, <b>format_color(&quot;@{redf}&quot;)</b> and
  <b>format_color(&quot;@{red}&quot;)</b> are functionally equivalent.
<div style="height: 1.00em;">&#x00A0;</div>
Also, many of the substitutions have shorten forms for convenience, such that
  <b>@{redf}</b>, <b>@{rf}</b>, <b>@{red}</b>, and <b>@{r}</b> are all the same.
<div style="height: 1.00em;">&#x00A0;</div>
Note that a trailing <b>b</b> is always required when specifying a background.
<div style="height: 1.00em;">&#x00A0;</div>
Some of the most common non-color sequences have <b>{}</b>'less versions.
<div style="height: 1.00em;">&#x00A0;</div>
For example, <b>@{boldon}</b>'s shorter form is <b>@!</b>.
<div style="height: 1.00em;">&#x00A0;</div>
By default, the substitutions (and calls to <i>ansi()</i>) resolve to escape
  sequences, but if you call <i>disable_ansi_color_substitution_globally()</i>
  then they will resolve to empty strings.
<div style="height: 1.00em;">&#x00A0;</div>
This allows you to always use the substitution strings and disable them globally
  when desired.
<div style="height: 1.00em;">&#x00A0;</div>
On Windows the substitutions are always resolved to empty strings as the ansi
  escape sequences do not work on Windows. Instead strings annotated with
  <b>@{}</b> style substitutions or raw <b>\x1b[xxm</b> style ansi escape
  sequences must be passed to <i>print_color()</i> in order for colors to be
  displayed on windows. Also the <i>print_ansi_color_win32()</i> function can be
  used on strings which only contain ansi escape sequences.
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">There are existing Python modules like
  <i>colorama</i> which provide ansi colorization on multiple platforms, so a
  valid question is: &quot;why write this module?&quot;. The reason for writing
  this module is to provide the color annotation of strings and functions for
  removing or replacing ansi escape sequences which are not provided by modules
  like colorama. This module could have depended on colorama for colorization on
  Windows, but colorama works by replacing the built-in <b>sys.stdout</b> and
  <b>sys.stderr</b>, which we did not want and it has extra functionality that
  we do not need. So, instead of depending on colorama, the Windows color
  printing code was used as the inspiration for the Windows color printing in
  the <b>windows.py</b> module in this <b>terminal_color</b> package. The
  colorama license was placed in the header of that file and the colorama
  license is compatible with this package's license.</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.terminal_color.ansi(key)</b></dt>
  <dd class="It-tag">Returns the escape sequence for a given ansi color
    key.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.terminal_color.disable_ansi_color_substitution_globally()</b></dt>
  <dd class="It-tag">Causes <i>format_color()</i> to replace color annotations
      with empty strings.
    <div style="height: 1.00em;">&#x00A0;</div>
    It also affects <i>ansi()</i>.
    <div style="height: 1.00em;">&#x00A0;</div>
    This is not the case by default, so if you want to make all substitutions
      given to either function mentioned above return empty strings then call
      this function.
    <div style="height: 1.00em;">&#x00A0;</div>
    The default behavior can be restored by calling
      <i>enable_ansi_color_substitution_globally()</i>.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.terminal_color.enable_ansi_color_substitution_globally()</b></dt>
  <dd class="It-tag">Causes <i>format_color()</i> to replace color annotations
      with ansi esacpe sequences.
    <div style="height: 1.00em;">&#x00A0;</div>
    It also affects <i>ansi()</i>.
    <div style="height: 1.00em;">&#x00A0;</div>
    This is the case by default, so there is no need to call this everytime.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you have previously caused all substitutions to evaluate to an empty
      string by calling <i>disable_ansi_color_substitution_globally()</i>, then
      you can restore the escape sequences for substitutions by calling this
      function.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.terminal_color.format_color(msg)</b></dt>
  <dd class="It-tag">Replaces color annotations with ansi escape sequences.
    <div style="height: 1.00em;">&#x00A0;</div>
    See this module's documentation for the list of available substitutions.
    <div style="height: 1.00em;">&#x00A0;</div>
    If <i>disable_ansi_color_substitution_globally()</i> has been called then
      all color annotations will be replaced by empty strings.
    <div style="height: 1.00em;">&#x00A0;</div>
    Also, on Windows all color annotations will be replaced with empty strings.
      If you want colorization on Windows, you must pass annotated strings to
      <i>print_color()</i>.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Parameters</b></dt>
  <dd class="It-tag"><b>msg</b> (<i>str</i>) -- string message to be
    colorized</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">colorized string</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Return type</b></dt>
  <dd class="It-tag">str</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.terminal_color.get_ansi_dict()</b></dt>
  <dd class="It-tag">Returns a copy of the dictionary of keys and ansi escape
      sequences.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.terminal_color.print_ansi_color_win32(*args,
    **kwargs)</b></dt>
  <dd class="It-tag">Prints color string containing ansi escape sequences to
      console in Windows.
    <div style="height: 1.00em;">&#x00A0;</div>
    If called on a non-Windows system, a <b>NotImplementedError</b> occurs.
    <div style="height: 1.00em;">&#x00A0;</div>
    Does not respect <i>disable_ansi_color_substitution_globally()</i>.
    <div style="height: 1.00em;">&#x00A0;</div>
    Does not substitute color annotations like <b>@{r}</b> or <b>@!</b>, the
      string must already contain the <b>\033[1m</b> style ansi escape
      sequences.
    <div style="height: 1.00em;">&#x00A0;</div>
    Works by splitting each argument up by ansi escape sequence, printing the
      text between the sequences, and doing the corresponding win32 action for
      each ansi sequence encountered.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.terminal_color.print_color(*args,
    **kwargs)</b></dt>
  <dd class="It-tag">Colorizes and prints with an implicit ansi reset at the end
    <div style="height: 1.00em;">&#x00A0;</div>
    Calls <i>format_color()</i> on each positional argument and then sends all
      positional and keyword arguments to <b>print</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
    If the <b>end</b> keyword argument is not present then the default end value
      <b>ansi('reset') + '\n'</b> is used and passed to <b>print</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
     <b>os.linesep</b> is used to determine the actual value for <b>\n</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
    Therefore, if you use the <b>end</b> keyword argument be sure to include an
      ansi reset escape sequence if necessary.
    <div style="height: 1.00em;">&#x00A0;</div>
    On Windows the substituted arguments and keyword arguments are passed to
      <i>print_ansi_color_win32()</i> instead of just <b>print</b>.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.terminal_color.remove_ansi_escape_senquences(string)</b></dt>
  <dd class="It-tag">Removes any ansi escape sequences found in the given string
      and returns it.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.terminal_color.sanitize(msg)</b></dt>
  <dd class="It-tag">Sanitizes the given string to prevent <i>format_color()</i>
      from substituting content.
    <div style="height: 1.00em;">&#x00A0;</div>
    For example, when the string <b>'Email: {user}@{org}'</b> is passed to
      <i>format_color()</i> the <b>@{org}</b> will be incorrectly recognized as
      a colorization annotation and it will fail to substitute with a
      <b>KeyError</b>: <b>org</b>.
    <div style="height: 1.00em;">&#x00A0;</div>
    In order to prevent this, you can first &quot;sanatize&quot; the string, add
      color annotations, and then pass the whole string to
      <i>format_color()</i>.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you give this function the string <b>'Email: {user}@{org}'</b>, then it
      will return <b>'Email: {{user}}@@{{org}}'</b>. Then if you pass that to
      <i>format_color()</i> it will return <b>'Email: {user}@{org}'</b>. In this
      way <i>format_color()</i> is the reverse of this function and so it is
      safe to call this function on any incoming data if it will eventually be
      passed to <i>format_color()</i>.
    <div style="height: 1.00em;">&#x00A0;</div>
    In addition to expanding <b>{</b> =&gt; <b>{{</b>, <b>}</b> =&gt; <b>}}</b>,
      and <b>@</b> =&gt; <b>@@</b>, this function will also replace any
      instances of <b>@!</b>, <b>@/</b>, <b>@_</b>, and <b>@|</b> with
      <b>@{atexclimation}</b>, <b>@{atfwdslash}</b>, <b>@{atunderscore}</b>, and
      <b>@{atbar}</b> respectively. And then there are corresponding keys in the
      ansi dict to convert them back.
    <div style="height: 1.00em;">&#x00A0;</div>
    For example, if you pass the string <b>'|@ Notice @|'</b> to this function
      it will return <b>'|@@ Notice @{atbar}'</b>. And since
      <b>ansi('atbar')</b> always returns <b>@|</b>, even when
      <i>disable_ansi_color_substitution_globally()</i> has been called, the
      result of passing that string to <i>format_color()</i> will be <b>'|@
      Notice @|'</b> again.
    <div style="height: 1.00em;">&#x00A0;</div>
    There are two main strategies for constructing strings which use both the
      Python <b>str.format()</b> function and the colorization annotations.
    <div style="height: 1.00em;">&#x00A0;</div>
    One way is to just build each piece and concatenate the result:</dd>
</dl>
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
print_color(&quot;@{r}&quot;, &quot;{error}&quot;.format(error=error_str))
# Or using print (remember to include an ansi reset)
print(format_color(&quot;@{r}&quot; + &quot;{error}&quot;.format(error=error_str) + &quot;@|&quot;))
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Another way is to use this function on the format string, concatenate to the
  annotations, pass the whole string to <i>format_color()</i>, and then format
  the whole thing:
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
print(format_color(&quot;@{r}&quot; + sanitize(&quot;{error}&quot;) + &quot;@|&quot;)
      .format(error=error_str))
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
However, the most common use for this function is to sanitize incoming strings
  which may have unknown content:
<div style="margin-left: 7.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
def my_func(user_content):
    print_color(&quot;@{y}&quot; + sanitize(user_content))
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This function is not intended to be used on strings with color annotations.
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Parameters</b></dt>
  <dd class="It-tag"><b>msg</b> (<i>str</i>) -- string message to be
    sanitized</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">sanitized string</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Return type</b></dt>
  <dd class="It-tag">str</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.terminal_color.split_by_ansi_escape_sequence(string,
    include_delimiters=False)</b></dt>
  <dd class="It-tag">Splits a string into a list using any ansi escape sequence
      as a delimiter.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Parameters</b></dt>
  <dd class="It-tag"></dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>string</b> (<i>str</i>) -- string to be split</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag"><b>include_delimiters</b> (<i>bool</i>) -- If True include
      matched escape sequences in the list (default: False)</dd>
</dl>
</div>
<br/>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">list of strings, split from original string by escape
      sequences</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Return type</b></dt>
  <dd class="It-tag">list</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.terminal_color.test_colors(file=None)</b></dt>
  <dd class="It-tag">Prints a color testing block using
    <i>print_color()</i></dd>
</dl>
</div>
<br/>
<h1 class="Sh" title="Sh" id="THE_TERMINAL_UTILS_MODULE"><a class="selflink" href="#THE_TERMINAL_UTILS_MODULE">THE
  TERMINAL_UTILS MODULE</a></h1>
This module has a miscellaneous set of functions for working with terminals.
<div style="height: 1.00em;">&#x00A0;</div>
You can use the <i>get_terminal_dimensions()</i> to get the width and height of
  the terminal as a tuple.
<div style="height: 1.00em;">&#x00A0;</div>
You can also use the <i>is_tty()</i> function to determine if a given object is
  a tty.
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>exception
    osrf_pycommon.terminal_utils.GetTerminalDimensionsError</b></dt>
  <dd class="It-tag">Raised when the terminal dimensions cannot be
    determined.</dd>
</dl>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.terminal_utils.get_terminal_dimensions()</b></dt>
  <dd class="It-tag">Returns the width and height of the terminal.</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">width and height in that order as a tuple</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Return type</b></dt>
  <dd class="It-tag">tuple</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Raises</b></dt>
  <dd class="It-tag">GetTerminalDimensionsError when the terminal dimensions
      cannot be determined</dd>
</dl>
</div>
<br/>
</div>
<br/>
<div style="margin-left: 0.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>osrf_pycommon.terminal_utils.is_tty(stream)</b></dt>
  <dd class="It-tag">Returns True if the given stream is a tty, else False</dd>
</dl>
<div style="margin-left: 7.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag"><b>Parameters</b></dt>
  <dd class="It-tag"><b>stream</b> -- object to be checked for being a tty</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Returns</b></dt>
  <dd class="It-tag">True if the given object is a tty, otherwise False</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Return type</b></dt>
  <dd class="It-tag">bool</dd>
</dl>
</div>
<br/>
</div>
<br/>
<h1 class="Sh" title="Sh" id="INSTALLING_FROM_SOURCE"><a class="selflink" href="#INSTALLING_FROM_SOURCE">INSTALLING
  FROM SOURCE</a></h1>
Given that you have a copy of the source code, you can install
  <b>osrf_pycommon</b> like this:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ python setup.py install
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">If you are installing to a system Python you
  may need to use <b>sudo</b>.</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
If you do not want to install <b>osrf_pycommon</b> into your system Python, or
  you don't have access to <b>sudo</b>, then you can use a <i>virtualenv</i>.
<h1 class="Sh" title="Sh" id="HACKING"><a class="selflink" href="#HACKING">HACKING</a></h1>
Because <b>osrf_pycommon</b> uses <i>setuptools</i> you can (and should) use the
  <i>develop</i> feature:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ python setup.py develop
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">If you are developing against the system
  Python, you may need <b>sudo</b>.</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
This will &quot;install&quot; <b>osrf_pycommon</b> to your Python path, but
  rather than copying the source files, it will instead place a marker file in
  the <b>PYTHONPATH</b> redirecting Python to your source directory. This allows
  you to use it as if it were installed but where changes to the source code
  take immediate affect.
<div style="height: 1.00em;">&#x00A0;</div>
When you are done with develop mode you can (and should) undo it like this:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ python setup.py develop -u
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
<b>NOTE:</b>
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">If you are developing against the system
  Python, you may need <b>sudo</b>.</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
That will &quot;uninstall&quot; the hooks into the <b>PYTHONPATH</b> which point
  to your source directory, but you should be wary that sometimes console
  scripts do not get removed from the bin folder.
<h1 class="Sh" title="Sh" id="TESTING"><a class="selflink" href="#TESTING">TESTING</a></h1>
In order to run the tests you will need to install <i>nosetests</i>,
  <i>flake8</i>, and <i>Mock</i>.
<div style="height: 1.00em;">&#x00A0;</div>
Once you have installed those, then run <b>nosetest</b> in the root of the
  <b>osrf_pycommon</b> source directory:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ nosetests
</pre>
</div>
<br/>
</div>
<br/>
<h1 class="Sh" title="Sh" id="BUILDING_THE_DOCUMENTATION"><a class="selflink" href="#BUILDING_THE_DOCUMENTATION">BUILDING
  THE DOCUMENTATION</a></h1>
In order to build the docs you will need to first install <i>Sphinx</i>.
<div style="height: 1.00em;">&#x00A0;</div>
You can build the documentation by invoking the Sphinx provided make target in
  the <b>docs</b> folder:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ # In the docs folder
$ make html
$ open _build/html/index.html
</pre>
</div>
<br/>
</div>
<br/>
<div style="height: 1.00em;">&#x00A0;</div>
Sometimes Sphinx does not pickup on changes to modules in packages which utilize
  the <b>__all__</b> mechanism, so on repeat builds you may need to clean the
  docs first:
<div style="margin-left: 0.00ex;">
<div style="margin-left: 3.50ex;">
<div style="height: 1.00em;">&#x00A0;</div>
<pre>
$ # In the docs folder
$ make clean
$ make html
$ open _build/html/index.html
</pre>
</div>
<br/>
</div>
<br/>
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
William Woodall
<h1 class="Sh" title="Sh" id="COPYRIGHT"><a class="selflink" href="#COPYRIGHT">COPYRIGHT</a></h1>
2014, Open Source Robotics Foundation</div>
<table class="foot">
  <tr>
    <td class="foot-date">February 11, 2017</td>
    <td class="foot-os">0.0</td>
  </tr>
</table>
</body>
</html>
