<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:31:41 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>PK12UTIL(1) NSS Security Tools PK12UTIL(1)</p>

<p style="margin-top: 1em">NAME <br>
pk12util - Export and import keys and certificate to or from
a PKCS #12 file and the NSS database</p>

<p style="margin-top: 1em">SYNOPSIS <br>
pk12util [-i p12File|-l p12File|-o p12File] [-d
[sql:]directory] [-h tokenname] [-P dbprefix] [-r] [-v] [-k
slotPasswordFile|-K slotPassword] <br>
[-w p12filePasswordFile|-W p12filePassword]</p>

<p style="margin-top: 1em">STATUS <br>
This documentation is still work in progress. Please
contribute to the initial review in Mozilla NSS bug
836477[1]</p>

<p style="margin-top: 1em">DESCRIPTION <br>
The PKCS #12 utility, pk12util, enables sharing certificates
among any server that supports PKCS#12. The tool can import
certificates and keys from PKCS#12 files into security <br>
databases, export certificates, and list certificates and
keys.</p>

<p style="margin-top: 1em">OPTIONS AND ARGUMENTS <br>
Options</p>

<p style="margin-top: 1em">-i p12file <br>
Import keys and certificates from a PKCS#12 file into a
security database.</p>

<p style="margin-top: 1em">-l p12file <br>
List the keys and certificates in PKCS#12 file.</p>

<p style="margin-top: 1em">-o p12file <br>
Export keys and certificates from the security database to a
PKCS#12 file.</p>

<p style="margin-top: 1em">Arguments</p>

<p style="margin-top: 1em">-c keyCipher <br>
Specify the key encryption algorithm.</p>

<p style="margin-top: 1em">-C certCipher <br>
Specify the key cert (overall package) encryption
algorithm.</p>

<p style="margin-top: 1em">-d [sql:]directory <br>
Specify the database directory into which to import to or
export from certificates and keys.</p>

<p style="margin-top: 1em">pk12util supports two types of
databases: the legacy security databases (cert8.db, key3.db,
and secmod.db) and new SQLite databases (cert9.db, key4.db,
and pkcs11.txt). If <br>
the prefix sql: is not used, then the tool assumes that the
given databases are in the old format.</p>

<p style="margin-top: 1em">-h tokenname <br>
Specify the name of the token to import into or export
from.</p>

<p style="margin-top: 1em">-k slotPasswordFile <br>
Specify the text file containing the slot&rsquo;s
password.</p>

<p style="margin-top: 1em">-K slotPassword <br>
Specify the slot&rsquo;s password.</p>

<p style="margin-top: 1em">-m | --key-len keyLength <br>
Specify the desired length of the symmetric key to be used
to encrypt the private key.</p>

<p style="margin-top: 1em">-n | --cert-key-len
certKeyLength <br>
Specify the desired length of the symmetric key to be used
to encrypt the certificates and other meta-data.</p>

<p style="margin-top: 1em">-n certname <br>
Specify the nickname of the cert and private key to
export.</p>

<p style="margin-top: 1em">-P prefix <br>
Specify the prefix used on the certificate and key
databases. This option is provided as a special case.
Changing the names of the certificate and key databases is
not <br>
recommended.</p>

<p style="margin-top: 1em">-r <br>
Dumps all of the data in raw (binary) form. This must be
saved as a DER file. The default is to return information in
a pretty-print ASCII format, which displays the <br>
information about the certificates and public keys in the
p12 file.</p>

<p style="margin-top: 1em">-v <br>
Enable debug logging when importing.</p>

<p style="margin-top: 1em">-w p12filePasswordFile <br>
Specify the text file containing the pkcs #12 file
password.</p>

<p style="margin-top: 1em">-W p12filePassword <br>
Specify the pkcs #12 file password.</p>

<p style="margin-top: 1em">RETURN CODES <br>
&Acirc;&middot; 0 - No error</p>

<p style="margin-top: 1em">&Acirc;&middot; 1 - User
Cancelled</p>

<p style="margin-top: 1em">&Acirc;&middot; 2 - Usage
error</p>

<p style="margin-top: 1em">&Acirc;&middot; 6 - NLS init
error</p>

<p style="margin-top: 1em">&Acirc;&middot; 8 - Certificate
DB open error</p>

<p style="margin-top: 1em">&Acirc;&middot; 9 - Key DB open
error</p>

<p style="margin-top: 1em">&Acirc;&middot; 10 - File
initialization error</p>

<p style="margin-top: 1em">&Acirc;&middot; 11 - Unicode
conversion error</p>

<p style="margin-top: 1em">&Acirc;&middot; 12 - Temporary
file creation error</p>

<p style="margin-top: 1em">&Acirc;&middot; 13 - PKCS11 get
slot error</p>

<p style="margin-top: 1em">&Acirc;&middot; 14 - PKCS12
decoder start error</p>

<p style="margin-top: 1em">&Acirc;&middot; 15 - error read
from import file</p>

<p style="margin-top: 1em">&Acirc;&middot; 16 - pkcs12
decode error</p>

<p style="margin-top: 1em">&Acirc;&middot; 17 - pkcs12
decoder verify error</p>

<p style="margin-top: 1em">&Acirc;&middot; 18 - pkcs12
decoder validate bags error</p>

<p style="margin-top: 1em">&Acirc;&middot; 19 - pkcs12
decoder import bags error</p>

<p style="margin-top: 1em">&Acirc;&middot; 20 - key db
conversion version 3 to version 2 error</p>

<p style="margin-top: 1em">&Acirc;&middot; 21 - cert db
conversion version 7 to version 5 error</p>

<p style="margin-top: 1em">&Acirc;&middot; 22 - cert and
key dbs patch error</p>

<p style="margin-top: 1em">&Acirc;&middot; 23 - get default
cert db error</p>

<p style="margin-top: 1em">&Acirc;&middot; 24 - find cert
by nickname error</p>

<p style="margin-top: 1em">&Acirc;&middot; 25 - create
export context error</p>

<p style="margin-top: 1em">&Acirc;&middot; 26 - PKCS12 add
password itegrity error</p>

<p style="margin-top: 1em">&Acirc;&middot; 27 - cert and
key Safes creation error</p>

<p style="margin-top: 1em">&Acirc;&middot; 28 - PKCS12 add
cert and key error</p>

<p style="margin-top: 1em">&Acirc;&middot; 29 - PKCS12
encode error</p>

<p style="margin-top: 1em">EXAMPLES <br>
Importing Keys and Certificates</p>

<p style="margin-top: 1em">The most basic usage of pk12util
for importing a certificate or key is the PKCS#12 input file
(-i) and some way to specify the security database being
accessed (either -d for a <br>
directory or -h for a token).</p>

<p style="margin-top: 1em">pk12util -i p12File [-h
tokenname] [-v] [-d [sql:]directory] [-P dbprefix] [-k
slotPasswordFile|-K slotPassword] [-w p12filePasswordFile|-W
p12filePassword]</p>

<p style="margin-top: 1em">For example:</p>

<p style="margin-top: 1em"># pk12util -i
/tmp/cert-files/users.p12 -d sql:/home/my/sharednssdb</p>

<p style="margin-top: 1em">Enter a password which will be
used to encrypt your keys. <br>
The password should be at least 8 characters long, <br>
and should contain at least one non-alphabetic
character.</p>

<p style="margin-top: 1em">Enter new password: <br>
Re-enter password: <br>
Enter password for PKCS12 file: <br>
pk12util: PKCS12 IMPORT SUCCESSFUL</p>

<p style="margin-top: 1em">Exporting Keys and
Certificates</p>

<p style="margin-top: 1em">Using the pk12util command to
export certificates and keys requires both the name of the
certificate to extract from the database (-n) and the
PKCS#12-formatted output file to <br>
write to. There are optional parameters that can be used to
encrypt the file to protect the certificate material.</p>

<p style="margin-top: 1em">pk12util -o p12File -n certname
[-c keyCipher] [-C certCipher] [-m|--key_len keyLen]
[-n|--cert_key_len certKeyLen] [-d [sql:]directory] [-P
dbprefix] [-k slotPasswordFile|-K <br>
slotPassword] [-w p12filePasswordFile|-W
p12filePassword]</p>

<p style="margin-top: 1em">For example:</p>

<p style="margin-top: 1em"># pk12util -o certs.p12 -n
Server-Cert -d sql:/home/my/sharednssdb <br>
Enter password for PKCS12 file: <br>
Re-enter password:</p>

<p style="margin-top: 1em">Listing Keys and
Certificates</p>

<p style="margin-top: 1em">The information in a .p12 file
are not human-readable. The certificates and keys in the
file can be printed (listed) in a human-readable
pretty-print format that shows <br>
information for every certificate and any public keys in the
.p12 file.</p>

<p style="margin-top: 1em">pk12util -l p12File [-h
tokenname] [-r] [-d [sql:]directory] [-P dbprefix] [-k
slotPasswordFile|-K slotPassword] [-w p12filePasswordFile|-W
p12filePassword]</p>

<p style="margin-top: 1em">For example, this prints the
default ASCII output:</p>

<p style="margin-top: 1em"># pk12util -l certs.p12</p>

<p style="margin-top: 1em">Enter password for PKCS12 file:
<br>
Key(shrouded): <br>
Friendly Name: Thawte Freemail Member&rsquo;s Thawte
Consulting (Pty) Ltd. ID</p>

<p style="margin-top: 1em">Encryption algorithm: PKCS #12
V2 PBE With SHA-1 And 3KEY Triple DES-CBC <br>
Parameters: <br>
Salt: <br>
45:2e:6a:a0:03:4d:7b:a1:63:3c:15:ea:67:37:62:1f <br>
Iteration Count: 1 (0x1) <br>
Certificate: <br>
Data: <br>
Version: 3 (0x2) <br>
Serial Number: 13 (0xd) <br>
Signature Algorithm: PKCS #1 SHA-1 With RSA Encryption <br>
Issuer: &quot;E=personal-freemail@thawte.com,CN=Thawte
Personal Freemail C <br>
A,OU=Certification Services Division,O=Thawte
Consulting,L=Cape T <br>
own,ST=Western Cape,C=ZA&quot;</p>

<p style="margin-top: 1em">Alternatively, the -r prints the
certificates and then exports them into separate DER binary
files. This allows the certificates to be fed to another
application that supports <br>
.p12 files. Each certificate is written to a
sequentially-number file, beginning with file0001.der and
continuing through file000N.der, incrementing the number for
every <br>
certificate:</p>

<p style="margin-top: 1em">pk12util -l test.p12 -r <br>
Enter password for PKCS12 file: <br>
Key(shrouded): <br>
Friendly Name: Thawte Freemail Member&rsquo;s Thawte
Consulting (Pty) Ltd. ID</p>

<p style="margin-top: 1em">Encryption algorithm: PKCS #12
V2 PBE With SHA-1 And 3KEY Triple DES-CBC <br>
Parameters: <br>
Salt: <br>
45:2e:6a:a0:03:4d:7b:a1:63:3c:15:ea:67:37:62:1f <br>
Iteration Count: 1 (0x1) <br>
Certificate Friendly Name: Thawte Personal Freemail Issuing
CA - Thawte Consulting</p>

<p style="margin-top: 1em">Certificate Friendly Name:
Thawte Freemail Member&rsquo;s Thawte Consulting (Pty) Ltd.
ID</p>

<p style="margin-top: 1em">PASSWORD ENCRYPTION <br>
PKCS#12 provides for not only the protection of the private
keys but also the certificate and meta-data associated with
the keys. Password-based encryption is used to protect <br>
private keys on export to a PKCS#12 file and, optionally,
the entire package. If no algorithm is specified, the tool
defaults to using PKCS12 V2 PBE with SHA1 and 3KEY Triple
<br>
DES-cbc for private key encryption. PKCS12 V2 PBE with SHA1
and 40 Bit RC4 is the default for the overall package
encryption when not in FIPS mode. When in FIPS mode, there
is <br>
no package encryption.</p>

<p style="margin-top: 1em">The private key is always
protected with strong encryption by default.</p>

<p style="margin-top: 1em">Several types of ciphers are
supported.</p>

<p style="margin-top: 1em">Symmetric CBC ciphers for PKCS#5
V2</p>

<p style="margin-top: 1em">&Acirc;&middot; DES-CBC</p>

<p style="margin-top: 1em">&Acirc;&middot; RC2-CBC</p>

<p style="margin-top: 1em">&Acirc;&middot; RC5-CBCPad</p>

<p style="margin-top: 1em">&Acirc;&middot; DES-EDE3-CBC
(the default for key encryption)</p>

<p style="margin-top: 1em">&Acirc;&middot; AES-128-CBC</p>

<p style="margin-top: 1em">&Acirc;&middot; AES-192-CBC</p>

<p style="margin-top: 1em">&Acirc;&middot; AES-256-CBC</p>

<p style="margin-top: 1em">&Acirc;&middot;
CAMELLIA-128-CBC</p>

<p style="margin-top: 1em">&Acirc;&middot;
CAMELLIA-192-CBC</p>

<p style="margin-top: 1em">&Acirc;&middot;
CAMELLIA-256-CBC</p>

<p style="margin-top: 1em">PKCS#12 PBE ciphers</p>

<p style="margin-top: 1em">&Acirc;&middot; PKCS #12 PBE
with Sha1 and 128 Bit RC4</p>

<p style="margin-top: 1em">&Acirc;&middot; PKCS #12 PBE
with Sha1 and 40 Bit RC4</p>

<p style="margin-top: 1em">&Acirc;&middot; PKCS #12 PBE
with Sha1 and Triple DES CBC</p>

<p style="margin-top: 1em">&Acirc;&middot; PKCS #12 PBE
with Sha1 and 128 Bit RC2 CBC</p>

<p style="margin-top: 1em">&Acirc;&middot; PKCS #12 PBE
with Sha1 and 40 Bit RC2 CBC</p>

<p style="margin-top: 1em">&Acirc;&middot; PKCS12 V2 PBE
with SHA1 and 128 Bit RC4</p>

<p style="margin-top: 1em">&Acirc;&middot; PKCS12 V2 PBE
with SHA1 and 40 Bit RC4 (the default for non-FIPS mode)</p>

<p style="margin-top: 1em">&Acirc;&middot; PKCS12 V2 PBE
with SHA1 and 3KEY Triple DES-cbc</p>

<p style="margin-top: 1em">&Acirc;&middot; PKCS12 V2 PBE
with SHA1 and 2KEY Triple DES-cbc</p>

<p style="margin-top: 1em">&Acirc;&middot; PKCS12 V2 PBE
with SHA1 and 128 Bit RC2 CBC</p>

<p style="margin-top: 1em">&Acirc;&middot; PKCS12 V2 PBE
with SHA1 and 40 Bit RC2 CBC</p>

<p style="margin-top: 1em">PKCS#5 PBE ciphers</p>

<p style="margin-top: 1em">&Acirc;&middot; PKCS #5 Password
Based Encryption with MD2 and DES CBC</p>

<p style="margin-top: 1em">&Acirc;&middot; PKCS #5 Password
Based Encryption with MD5 and DES CBC</p>

<p style="margin-top: 1em">&Acirc;&middot; PKCS #5 Password
Based Encryption with SHA1 and DES CBC</p>

<p style="margin-top: 1em">With PKCS#12, the crypto
provider may be the soft token module or an external
hardware module. If the cryptographic module does not
support the requested algorithm, then the next <br>
best fit will be selected (usually the default). If no
suitable replacement for the desired algorithm can be found,
the tool returns the error no security module can perform
the <br>
requested operation.</p>

<p style="margin-top: 1em">NSS DATABASE TYPES <br>
NSS originally used BerkeleyDB databases to store security
information. The last versions of these legacy databases
are:</p>

<p style="margin-top: 1em">&Acirc;&middot; cert8.db for
certificates</p>

<p style="margin-top: 1em">&Acirc;&middot; key3.db for
keys</p>

<p style="margin-top: 1em">&Acirc;&middot; secmod.db for
PKCS #11 module information</p>

<p style="margin-top: 1em">BerkeleyDB has performance
limitations, though, which prevent it from being easily used
by multiple applications simultaneously. NSS has some
flexibility that allows applications <br>
to use their own, independent database engine while keeping
a shared database and working around the access issues.
Still, NSS requires more flexibility to provide a truly
shared <br>
security database.</p>

<p style="margin-top: 1em">In 2009, NSS introduced a new
set of databases that are SQLite databases rather than
BerkleyDB. These new databases provide more accessibility
and performance:</p>

<p style="margin-top: 1em">&Acirc;&middot; cert9.db for
certificates</p>

<p style="margin-top: 1em">&Acirc;&middot; key4.db for
keys</p>

<p style="margin-top: 1em">&Acirc;&middot; pkcs11.txt,
which is listing of all of the PKCS #11 modules contained in
a new subdirectory in the security databases directory</p>

<p style="margin-top: 1em">Because the SQLite databases are
designed to be shared, these are the shared database type.
The shared database type is preferred; the legacy format is
included for backward <br>
compatibility.</p>

<p style="margin-top: 1em">By default, the tools (certutil,
pk12util, modutil) assume that the given security databases
follow the more common legacy type. Using the SQLite
databases must be manually <br>
specified by using the sql: prefix with the given security
directory. For example:</p>

<p style="margin-top: 1em"># pk12util -i
/tmp/cert-files/users.p12 -d sql:/home/my/sharednssdb</p>

<p style="margin-top: 1em">To set the shared database type
as the default type for the tools, set the
NSS_DEFAULT_DB_TYPE environment variable to sql:</p>

<p style="margin-top: 1em">export
NSS_DEFAULT_DB_TYPE=&quot;sql&quot;</p>

<p style="margin-top: 1em">This line can be set added to
the ~/.bashrc file to make the change permanent.</p>

<p style="margin-top: 1em">Most applications do not use the
shared database by default, but they can be configured to
use them. For example, this how-to article covers how to
configure Firefox and <br>
Thunderbird to use the new shared NSS databases:</p>

<p style="margin-top: 1em">&Acirc;&middot;
https://wiki.mozilla.org/NSS_Shared_DB_Howto</p>

<p style="margin-top: 1em">For an engineering draft on the
changes in the shared NSS databases, see the NSS project
wiki:</p>

<p style="margin-top: 1em">&Acirc;&middot;
https://wiki.mozilla.org/NSS_Shared_DB</p>

<p style="margin-top: 1em">SEE ALSO <br>
certutil (1)</p>

<p style="margin-top: 1em">modutil (1)</p>

<p style="margin-top: 1em">The NSS wiki has information on
the new database design and how to configure applications to
use it.</p>

<p style="margin-top: 1em">&Acirc;&middot;
https://wiki.mozilla.org/NSS_Shared_DB_Howto</p>

<p style="margin-top: 1em">&Acirc;&middot;
https://wiki.mozilla.org/NSS_Shared_DB</p>

<p style="margin-top: 1em">ADDITIONAL RESOURCES <br>
For information about NSS and other tools related to NSS
(like JSS), check out the NSS project wiki at
http://www.mozilla.org/projects/security/pki/nss/. The NSS
site relates <br>
directly to NSS code changes and releases.</p>

<p style="margin-top: 1em">Mailing lists:
https://lists.mozilla.org/listinfo/dev-tech-crypto</p>

<p style="margin-top: 1em">IRC: Freenode at #dogtag-pki</p>

<p style="margin-top: 1em">AUTHORS <br>
The NSS tools were written and maintained by developers with
Netscape, Red Hat, Sun, Oracle, Mozilla, and Google.</p>

<p style="margin-top: 1em">Authors: Elio Maldonado
&lt;emaldona@redhat.com&gt;, Deon Lackey
&lt;dlackey@redhat.com&gt;.</p>

<p style="margin-top: 1em">LICENSE <br>
Licensed under the Mozilla Public License, v. 2.0. If a copy
of the MPL was not distributed with this file, You can
obtain one at http://mozilla.org/MPL/2.0/.</p>

<p style="margin-top: 1em">NOTES <br>
1. Mozilla NSS bug 836477 <br>
https://bugzilla.mozilla.org/show_bug.cgi?id=836477</p>

<p style="margin-top: 1em">nss-tools 5 June 2014
PK12UTIL(1)</p>
<hr>
</body>
</html>
