<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>AS31(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">AS31(1)</td>
    <td class="head-vol">General Commands Manual</td>
    <td class="head-rtitle">AS31(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
as31 - An Intel 8031/8051 assembler
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>as31</b> [-h] [-l] [-s] [-v] [-Aarg] [-Ffmt] [-Ofile] <b>infile.asm</b>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<i>As31</i> assembles <i>infile.asm</i> into one of several different output
  formats. The output will be in a file called infile.obj. The .asm extenstion
  is required.
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
The options must appear before the input file name. Both options are optional.
  The text of each flag must appear on the same argument as the flag. For
  example, &quot;-Fod&quot; is a valid argument, but &quot;-F od&quot; is not.
<dl class="Bl-tag">
  <dt class="It-tag"><b>-h</b></dt>
  <dd class="It-tag">This causes the assembler to print out a verbose message
      describing its options. The message is written to the standard error.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-l</b></dt>
  <dd class="It-tag">This option tells the assembler to also generate a listing
      file. A listing will be placed in the file infile.lst. Where 'infile' is
      the file that is being assembled. This option may appear anywhere before
      infile.asm. The option must occur isolated on the command line.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">The listing file shows the assembler generated code in hex,
      and up to 60 characters are retained from the source file.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-s</b></dt>
  <dd class="It-tag">This causes the assembler to write output to standard
      output.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-v</b></dt>
  <dd class="It-tag">This causes the assembler to print a version number to the
      standard output.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-Aarg</b></dt>
  <dd class="It-tag">This option specifies a format specific string which is
      passed to the format generator. Both format &quot;tdr&quot; and the
      srecord formats use this option.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-Fformat</b></dt>
  <dd class="It-tag">This options specifies the output format that is to be
      used.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">Currently the only options available for this are:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">hex</dt>
  <dd class="It-tag">This format is the Intel HEX format which is expected by a
      number of EPROM programmers and the PAULMON debugger. For use with some
      programmers, the output file's extension may have to be changed to .HEX to
      be recognized by the programmer. No -A option is used. This format should
      be the default if no -F option is used.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">tdr</dt>
  <dd class="It-tag">This format generates an asci file of hex digits formatted
      in such a way, so that they can be read by tdr's debugger. An argument can
      be specified (See -A option) which will pass a format specific string to
      the format generator. In this case, the argument string represents an
      offset to add to the location counter. This offset is specified in decimal
      and defaults to 64*1024 (0x10000). To specify and offset of 100, you would
      need &quot;-Ftdr -A100&quot; when invoking the assembler.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">byte</dt>
  <dd class="It-tag">This format is simply an address and a byte on each line,
      in ascii. No -A option is used.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">od</dt>
  <dd class="It-tag">This format is similar to the output from od(1). The format
      consists of an address followed by sixteen hexadecimal bytes, followed by
      the equivilant ASCII. No -A option is used.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">srec2, srec3, srec4</dt>
  <dd class="It-tag">The srecord generator is capable of generating output with
      any one of 2, 3, or 4 byte addresses. The -A option can be used to set the
      base address offset, the default here is 0x0000 (unlike <b>tdr</b>).</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">NOTE: This assembler allows for the output formats to be
      expanded to include many different output formats.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-Ofile</b></dt>
  <dd class="It-tag">This option tells the assembler to write the output to a
      file.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="ASSEMBLER_INSTRUCTIONS"><a class="selflink" href="#ASSEMBLER_INSTRUCTIONS">ASSEMBLER
  INSTRUCTIONS</a></h1>
This assembler accepts standard 8031/8051 instruction formats. Below is a list
  of instructions and addressing modes.
<div style="margin-left: 5.00ex;">
<pre>
INSTRUCTION		BYTES	CYCLES
-----------		-----	------
ACALL	addr11		2	24
ADD	A, #data8		2	12
ADD	A, @Ri		1	12
ADD	A, Rn		1	12
ADD	A, direct		2	12
ADDC	A, #data8		2	12
ADDC	A, @Ri		1	12
ADDC	A, Rn		1	12
ADDC	A, direct		2	12
AJMP	addr11		2	24
ANL	A, #data8		2	12
ANL	A, @Ri		1	12
ANL	A, Rn		1	12
ANL	A, direct		2	12
ANL	C, /bit		2	24
ANL	C, !bit		2	24
ANL	C, bit		2	24
ANL	direct, #data8		3	24
ANL	direct, A		2	12
CJNE	@Ri, #data8, rel		3	24
CJNE	A, #data8, rel		3	24
CJNE	A, direct, rel		3	24
CJNE	Rn, #data8, rel		3	24
CLR	A		1	12
CLR	C		1	12
CLR	bit		2	12
CPL	A		1	12
CPL	C		1	12
CPL	bit		2	12
DA	A		1	12
DEC	@Ri		1	12
DEC	A		1	12
DEC	DPTR		1	12
DEC	Rn		1	12
DEC	direct		2	12
DIV	AB		1	48
DJNZ	Rn, rel		2	24
DJNZ	direct, rel		3	24
INC	@Ri		1	12
INC	A		1	12
INC	DPTR		1	24
INC	Rn		1	12
INC	direct		2	12
JB	bit, rel		3	24
JBC	bit, rel		3	24
JC	relative		2	24
JMP	@A + DPTR		1	24
JMP	@DPTR + A		1	24
JNB	bit, rel		3	24
JNC	relative		2	24
JNZ	relative		2	24
JZ	relative		2	24
LCALL	addr16		3	24
LJMP	addr16		3	24
MOV	@Ri, #data8		2	12
MOV	@Ri, A		1	12
MOV	@Ri, direct		2	24
MOV	A, #data8		2	12
MOV	A, @Ri		1	12
MOV	A, Rn		1	12
MOV	A, direct		2	12
MOV	C, bit		2	12
MOV	DPTR, #data16		3	24
MOV	Rn, #data8		2	12
MOV	Rn, A		1	12
MOV	Rn, direct		2	24
MOV	bit, C		2	24
MOV	direct, #data8		3	24
MOV	direct, @Ri		2	24
MOV	direct, A		2	12
MOV	direct, Rn		2	24
MOV	direct, direct		3	24
MOVC	A, @A + DPTR		1	24
MOVC	A, @A + PC		1	24
MOVC	A, @DPTR + A		1	24
MOVC	A, @PC + A		1	24
MOVX	@DPTR, A		1	12
MOVX	@Ri, A		1	24
MOVX	A, @DPTR		1	24
MOVX	A, @Ri		1	24
MUL	AB		1	48
NOP			1	12
ORL	A, #data8		2	12
ORL	A, @Ri		1	12
ORL	A, Rn		1	12
ORL	A, direct		2	12
ORL	C, /bit		2	24
ORL	C, !bit		2	24
ORL	C, bit		2	24
ORL	direct, #data8		3	24
ORL	direct, A		2	12
POP	direct		2	24
PUSH	direct		2	24
RET			1	24
RETI			1	24
RL	A		1	12
RLC	A		1	12
RR	A		1	12
RRC	A		1	12
SETB	A		1	12
SETB	bit		2	12
SJMP	relative		2	24
SUBB	A, #data8		2	12
SUBB	A, @Ri		1	12
SUBB	A, Rn		1	12
SUBB	A, direct		2	12
SWAP	A		1	12
XCH	A, #data8		2	12
XCH	A, @Ri		1	12
XCH	A, Rn		1	12
XCH	A, direct		2	12
XCHD	A, #data8		2	12
XCHD	A, @Ri		1	12
XCHD	A, Rn		1	12
XCHD	A, direct		2	12
XRL	A, #data8		2	12
XRL	A, @Ri		1	12
XRL	A, Rn		1	12
XRL	A, direct		2	12
XRL	direct, #data8		3	12
XRL	direct, A		2	12
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h1 class="Sh" title="Sh" id="ASSEMBLER_DIRECTIVES"><a class="selflink" href="#ASSEMBLER_DIRECTIVES">ASSEMBLER
  DIRECTIVES</a></h1>
As31 includes the following assembler directives:
<dl class="Bl-tag">
  <dt class="It-tag">.ORG expr</dt>
  <dd class="It-tag">Start assembling at the address specified by the expression
      expr. An error occurs if the assembler starts assembling over an address
      space that has previously been assembled into.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">.EQU symbol, expr</dt>
  <dd class="It-tag">Set symbol to the value of expr. The value for expr must be
      known during the first pass, when the line containing the .EQU is
      encountered.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">.BYTE expr, expr, ...</dt>
  <dd class="It-tag">Assemble the bytes specified by the expression into memory.
      A string may also be specified with this directive.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">.WORD expr, expr, ...</dt>
  <dd class="It-tag">Assemble the words specified by the expression into memory.
      The byte ordering used, is that used by the 8031.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">.FLAG symbol1, symbol.[0-7]</dt>
  <dd class="It-tag">Sets symbol1 to the bit address specified by the
      symbol.[0-7] expression. Where [0-7] denotes a character between 0 and 7.
      The resulting bit address is checked to see if it is a valid bit address.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">.END</dt>
  <dd class="It-tag">This directive is ignored.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">.SKIP expr</dt>
  <dd class="It-tag">Adds the value of expr to the location counter. Used to
      reserve a block of uninitialized data. Expr should be in bytes.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="LEXICAL_CONVENTIONS"><a class="selflink" href="#LEXICAL_CONVENTIONS">LEXICAL
  CONVENTIONS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag">-</dt>
  <dd class="It-tag">All characters following a semi-colon are ignored until a
      newline is encountered.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-</dt>
  <dd class="It-tag">All numbers default to decimal, unless the number starts
      with one of the following:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">0x or 0X</dt>
  <dd class="It-tag">This indicates a hexadecimal number. ie. 0x00ff</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">0b or 0B</dt>
  <dd class="It-tag">This indicates a binary number. (1's and 0's). ie.
      0b1100110010</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">0</dt>
  <dd class="It-tag">This indicates an octal number. ie. 0377</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag">-</dt>
  <dd class="It-tag">All numbers default to decimal, unless the number ends with
      one of the following characters:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">b or B</dt>
  <dd class="It-tag">This indicates a binary number. Unless 0x was used above.
      ie. 1010101b</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">h or H</dt>
  <dd class="It-tag">This always indicates a hex number, However the if the
      first character is non-numerical, then either 0x or 0 must be specified.
      This avoids confusing the assembler into thinking a hex number is a
      symbol. For example: 0ffh, 0xffh, 0XffH, 20h, 0x20 and 020h are means to
      specify a valid hexdigit. But the following are not: ffh, 0ff.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">d or D</dt>
  <dd class="It-tag">This forces a number to decimal. Unless 0X was used. ie.
      129d</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">o or O</dt>
  <dd class="It-tag">This causes the number to be interpreted as octal. ie.
    377o</dd>
</dl>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<dl class="Bl-tag">
  <dt class="It-tag">-</dt>
  <dd class="It-tag">A character constant can be entered as 'c' where c is some
      character. \b, \n, \r, \t, \' \0 are also valid. A character constant can
      be used anywhere that an integer value can.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-</dt>
  <dd class="It-tag">A string is entered as a set of characters enclosed in
      double quotes &quot;&quot;. A string is only valid with the .BYTE
      directive. \b, \n, \r, \t, \&quot; are also valid escapes. However \0 is
      not.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-</dt>
  <dd class="It-tag">Instructions, directives, and the symbols: R0, R1, R2, R3,
      R4, R5, R6, R7, A, AB, and C can be entered in upper or lower case without
      assembler confusion. These words however cannot be defined as a user
      symbol. Any user symbol may be used, and case will be preserved. So the
      user symbols &quot;foo&quot; and &quot;Foo&quot; are different, but
      &quot;addc&quot; is the same as &quot;aDdC&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-</dt>
  <dd class="It-tag">A symbol can be any alpha numerical character plus the
      underscore ('_').
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-</dt>
  <dd class="It-tag">Expressions are accepted in most places where a value or a
      symbol is needed. An expression consists of the following operators. All
      operators evaulate to integer objects (higher precedence opertors listed
      first):</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">-</dt>
  <dd class="It-tag">Unary minus</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&amp;</dt>
  <dd class="It-tag">Bit-wise AND.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">|</dt>
  <dd class="It-tag">Bit-Wise OR.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">*</dt>
  <dd class="It-tag">Integer multiplication.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">/</dt>
  <dd class="It-tag">Integer division</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">%</dt>
  <dd class="It-tag">Integer modulus</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">+</dt>
  <dd class="It-tag">Integer addition.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">-</dt>
  <dd class="It-tag">Integer subtraction.</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag">-</dt>
  <dd class="It-tag">In addition to these operators, a special symbol '*' may be
      used to represent the current location counter.
    <div style="height: 1.00em;">&#x00A0;</div>
  </dd>
</dl>
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"></dt>
  <dd class="It-tag">Below is a sample assembly program.</dd>
</dl>
<div style="margin-left: 5.00ex;">
<pre>
<div class="Pp"></div>
                .org    0
start:          mov     P3, #0xff       ; use alternate fns on P3
                                        ; leds on P1 are inverted.
                setb    F0              ; climbing up
                mov     A, #0x01        ; initial bit
<div class="Pp"></div>
write:          cpl     A               ; write it
                mov     P1, A
                cpl     A
                acall   delay
                jb      F0, climbup     ; climbing which way?
<div class="Pp"></div>
climbdn:        rr      A               ; down - shift right
                jnb     ACC.0, write    ; back for more
                setb    F0
                ajmp    write
<div class="Pp"></div>
climbup:        rl      A               ; up - shift left
                jnb     ACC.7, write    ; back for more
                clr     F0
                ajmp    write
                .end                    ; this directive ignored.
</pre>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="height: 1.00em;">&#x00A0;</div>
</div>
<h1 class="Sh" title="Sh" id="AUTHORS"><a class="selflink" href="#AUTHORS">AUTHORS</a></h1>
Ken Stauffer (University of Calgary) &lt;stauffer@cpsc.ucalgary.ca&gt;
<div>&#x00A0;</div>
Martin Langer &lt;martin-langer@gmx.de&gt;</div>
<table class="foot">
  <tr>
    <td class="foot-date"></td>
    <td class="foot-os"></td>
  </tr>
</table>
</body>
</html>
