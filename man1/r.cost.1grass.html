<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>r.cost(1grass)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">r.cost(1grass)</td>
    <td class="head-vol">Grass User's Manual</td>
    <td class="head-rtitle">r.cost(1grass)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
<i></i><b>r.cost</b> - Creates a raster map showing the cumulative cost of
  moving between different geographic locations on an input raster map whose
  cell category values represent cost.
<h1 class="Sh" title="Sh" id="KEYWORDS"><a class="selflink" href="#KEYWORDS">KEYWORDS</a></h1>
raster, cost surface, cumulative costs, cost allocation
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>r.cost</b>
<div>&#x00A0;</div>
<b>r.cost --help</b>
<div>&#x00A0;</div>
<b>r.cost</b> [-<b>knri</b>] <b>input</b>=<i>name</i> <b>output</b>=<i>name</i>
  [ <b>nearest</b>=<i>name</i>] [<b>outdir</b>=<i>name</i>]
  [<b>start_points</b>= <i>name</i>] [<b>stop_points</b>=<i>name</i>]
  [<b>start_raster</b>= <i>name</i>]
  [<b>start_coordinates</b>=<i>east,north</i>[, <i>east,north</i>,...]]
  [<b>stop_coordinates</b>= <i>east,north</i>[,<i>east,north</i>,...]]
  [<b>max_cost</b>= <i>value</i>] [<b>null_cost</b>=<i>value</i>]
  [<b>memory</b>= <i>value</i>] [--<b>overwrite</b>] [--<b>help</b>]
  [--<b>verbose</b>] [-- <b>quiet</b>] [--<b>ui</b>]
<h2 class="Ss" title="Ss" id="Flags:"><a class="selflink" href="#Flags:">Flags:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-k</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Use the &#x2019;Knight&#x2019;s move&#x2019;; slower, but more accurate</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-n</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Keep null values in output raster map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-r</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Start with values in raster map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-i</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Print info about disk space and memory requirements and exit</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--overwrite</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Allow output files to overwrite existing files</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--help</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Print usage summary</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--verbose</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Verbose module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--quiet</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Quiet module output</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ui</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Force launching GUI dialog</dd>
</dl>
<h2 class="Ss" title="Ss" id="Parameters:"><a class="selflink" href="#Parameters:">Parameters:</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>input</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of input raster map containing grid cell cost information</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>output</b>=<i>name</i> <b>[required]</b></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output raster map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>nearest</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output raster map with nearest start point</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>outdir</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name for output raster map to contain movement directions</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>start_points</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of starting vector points map
    <div>&#x00A0;</div>
    Or data source for direct OGR access</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>stop_points</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of stopping vector points map
    <div>&#x00A0;</div>
    Or data source for direct OGR access</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>start_raster</b>=<i>name</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Name of starting raster points map</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>start_coordinates</b>=<i>east,north[,</i><i>east,north</i>,...]</dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Coordinates of starting point(s) (E,N)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>stop_coordinates</b>=<i>east,north[,</i><i>east,north</i>,...]</dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Coordinates of stopping point(s) (E,N)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>max_cost</b>=<i>value</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Maximum cumulative cost
    <div>&#x00A0;</div>
    Default: <i>0</i></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>null_cost</b>=<i>value</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Cost assigned to null cells. By default, null cells are excluded</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>memory</b>=<i>value</i></dt>
  <dd class="It-tag">
    <div>&#x00A0;</div>
    Maximum memory to be used in MB
    <div>&#x00A0;</div>
    Default: <i>300</i></dd>
</dl>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<i>r.cost</i> determines the cumulative cost of moving to each cell on a <i>cost
  surface</i> (the <b>input</b> raster map) from other user-specified cell(s)
  whose locations are specified by their geographic coordinate(s). Each cell in
  the original cost surface map will contain a category value which represents
  the cost of traversing that cell. <i>r.cost</i> will produce 1) an
  <b>output</b> raster map in which each cell contains the lowest total cost of
  traversing the space between each cell and the user-specified points (diagonal
  costs are multiplied by a factor that depends on the dimensions of the cell)
  and 2) a second raster map layer showing the movement direction to the next
  cell on the path back to the start point (see Movement Direction). This module
  uses the current geographic region settings. The <b>output</b> map will be of
  the same data format as the <b>input</b> map, integer or floating point.
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
The <b>input</b> <i>name</i> is the name of a raster map whose category values
  represent the surface cost. The <b>output</b> <i>name</i> is the name of the
  resultant raster map of cumulative cost. The <b>outdir</b> <i>name</i> is the
  name of the resultant raster map of movement directions (see Movement
  Direction).
<div class="Pp"></div>
<i>r.cost</i> can be run with three different methods of identifying the
  starting point(s). One or more points (geographic coordinate pairs) can be
  provided as specified <b>start_coordinates</b> on the command line, from a
  vector points file, or from a raster map. All non-NULL cells are considered to
  be starting points.
<div class="Pp"></div>
Each <i>x,y</i> <b>start_coordinates</b> pair gives the geographic location of a
  point from which the transportation cost should be figured. As many points as
  desired can be entered by the user. These starting points can also be read
  from a vector points file through the <b>start_points</b> option or from a
  raster map through the <b>start_raster</b> option.
<div class="Pp"></div>
<i>r.cost</i> will stop cumulating costs when either <b>max_cost</b> is reached,
  or one of the stop points given with <b>stop_coordinates</b> is reached.
  Alternatively, the stop points can be read from a vector points file with the
  <b>stop_points</b> option. During execution, once the cumulative cost to all
  stopping points has been determined, processing stops.
<div>&#x00A0;</div>
Both sites read from a vector points file and those given on the command line
  will be processed.
<div class="Pp"></div>
The null cells in the <b>input</b> map can be assigned a (positive floating
  point) cost with the <b>null_cost</b> option.
<div>&#x00A0;</div>
When input map null cells are given a cost with the <b>null_cost</b> option, the
  corresponding cells in the output map are no longer null cells. By using the
  <b>-n</b> flag, the null cells of the input map are retained as null cells in
  the output map.
<div class="Pp"></div>
As <i>r.cost</i> can run for a very long time, it can be useful to use the
  <b>--v</b> verbose flag to track progress.
<div class="Pp"></div>
The Knight&#x2019;s move ( <b>-k</b> flag) may be used to improve the accuracy
  of the output. In the diagram below, the center location (O) represents a grid
  cell from which cumulative distances are calculated. Those neighbors marked
  with an X are always considered for cumulative cost updates. With the
  <b>-k</b> option, the neighbors marked with a K are also considered.
<div>&#x00A0;</div>
<pre>
 . . . . . . . . . . . . . . .
 .   .   . K .   . K .   .   .
 . . . . . . . . . . . . . . .
 .   . K . X . X . X . K .   .
 . . . . . . . . . . . . . . .
 .   .   . X . O . X .   .   .
 . . . . . . . . . . . . . . .
 .   . K . X . X . X . K .   .
 . . . . . . . . . . . . . . .
 .   .   . K .   . K .   .   .
 . . . . . . . . . . . . . . .
</pre>
<div class="Pp"></div>
Knight&#x2019;s move example:
<div>&#x00A0;</div>
<table class="tbl">
  <colgroup>
    <col style="width: 60.00ex;"/>
  </colgroup>
  <tr>
    <td><i>Flat cost surface without (left pane) and with the knight&#x2019;s
      move (right pane). The default is to grow the cost outwards in 8
      directions. Using the knight&#x2019;s move grows it outwards in 16
      directions.</i></td>
  </tr>
</table>
<div class="Pp"></div>
If the <i>nearest</i> output parameter is specified, the module will calculate
  for each cell its nearest starting point based on the minimized accumulative
  cost while moving over the cost map.
<h1 class="Sh" title="Sh" id="NULL_CELLS"><a class="selflink" href="#NULL_CELLS">NULL
  CELLS</a></h1>
By default null cells in the input raster map are excluded from the algorithm,
  and thus retained in the output map.
<div class="Pp"></div>
If one wants <b>r.cost</b> to transparently cross any region of null cells, the
  <b>null_cost</b>=0.0 option should be used. Then null cells just propagate the
  adjacent costs. These cells can be retained as null cells in the output map by
  using the <b>-n</b> flag.
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
Sometimes, when the differences among integer cell category values in the
  <i>r.cost</i> cumulative cost surface output are small, this cumulative cost
  output cannot accurately be used as input to <i>r.drain</i> ( <i>r.drain</i>
  will output bad results). This problem can be circumvented by making the
  differences between cell category values in the cumulative cost output bigger.
  It is recommended that, if the output from <i>r.cost</i> is to be used as
  input to <i>r.drain</i>, the user multiply the input cost surface map to
  <i>r.cost</i> by the value of the map&#x2019;s cell resolution, before running
  <i>r.cost</i>. This can be done using <i>r.mapcalc</i>. The map resolution can
  be found using <i>g.region</i>. This problem doesn&#x2019;t arise with
  floating point maps.
<h2 class="Ss" title="Ss" id="Algorithm_notes"><a class="selflink" href="#Algorithm_notes">Algorithm
  notes</a></h2>
The fundamental approach to calculating minimum travel cost is as follows:
<div class="Pp"></div>
The user generates a raster map indicating the cost of traversing each cell in
  the north-south and east-west directions. This map, along with a set of
  starting points are submitted to <i>r.cost</i>. The starting points are put
  into a list cells from which costs to the adjacent cells are to be calculated.
  The cell on the list with the lowest cumulative cost is selected for computing
  costs to the neighboring cells. Costs are computed and those cells are put on
  the list and the originating cell is finalized. This process of selecting the
  lowest cumulative cost cell, computing costs to the neighbors, putting the
  neighbors on the list and removing the originating cell from the list
  continues until the list is empty.
<div class="Pp"></div>
The most time consuming aspect of this algorithm is the management of the list
  of cells for which cumulative costs have been at least initially computed.
  <i>r.cost</i> uses a binary tree with an linked list at each node in the tree
  for efficiently holding cells with identical cumulative costs.
<div class="Pp"></div>
<i>r.cost</i>, like most all GRASS raster programs, is also made to be run on
  maps larger that can fit in available computer memory. As the algorithm works
  through the dynamic list of cells it can move almost randomly around the
  entire area. <i>r.cost</i> divides the entire area into a number of pieces and
  swaps these pieces in and out of memory (to and from disk) as needed. This
  provides a virtual memory approach optimally designed for 2-D raster maps. The
  amount of memory to be used by <i>r.cost</i> can be controlled with the
  <b>memory</b> option, default is 300 MB. For systems with less memory this
  value will have to be set to a lower value.
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
Consider the following example:
<div>&#x00A0;</div>
<pre>
       Input:
         COST SURFACE
       . . . . . . . . . . . . . . .
       . 2 . 2 . 1 . 1 . 5 . 5 . 5 .
       . . . . . . . . . . . . . . .
       . 2 . 2 . 8 . 8 . 5 . 2 . 1 .
       . . . . . . . . . . . . . . .
       . 7 . 1 . 1 . 8 . 2 . 2 . 2 .
       . . . . . . . . . . . . . . .
       . 8 . 7 . 8 . 8 . 8 . 8 . 5 .
       . . . . . . . . . . _____ . .
       . 8 . 8 . 1 . 1 . 5 |  <b>3</b> | 9 .
       . . . . . . . . . . |___| . .
       . 8 . 1 . 1 . 2 . 5 . 3 . 9 .
       . . . . . . . . . . . . . . .
Output (using -k):                Output (not using -k):
   CUMULATIVE COST SURFACE           CUMULATIVE COST SURFACE
 . . . . . . . . . . . . . . .     . . . .  <b>* * * * *</b> . . . . . .
 . 21. 21. 20. 19. 17. 15. 14.     . 22. 21 <b>* 21* 20*</b> 17. 15. 14.
 . . . . . . . . . . . . . . .     . . . .  <b>* * * * *</b> . . . . . .
 . 20. 19. 22. 19. 15. 12. 11.     . 20. 19. 22 <b>* 20*</b> 15. 12. 11.
 . . . . . . . . . . . . . . .     . . . . . .  <b>* * * * *</b> . . . .
 . 22. 18. 17. 17. 12. 11.  9.     . 22. 18. 17 <b>* 18* 13*</b> 11.  9.
 . . . . . . . . . . . . . . .     . . . . . .  <b>* * * * *</b> . . . .
 . 21. 14. 13. 12.  8.  6.  6.     . 21. 14. 13. 12.  8.  6.  6.
 . . . . . . . . . .  _____. .     . . . . . . . . . . . . . . .
 . 16. 13.  8.  7.  4 |  <b>0</b> | 6.     . 16. 13.  8. 7 .  4.  0.  6.
 . . . . . . . . . .  |___|. .     . . . . . . . . . . . . . . .
 . 14.  9.  8.  9.  6.  3.  8.     . 14.  9.  8. 9 .  6.  3.  8.
 . . . . . . . . . . . . . . .     . . . . . . . . . . . . . . .
</pre>
<div class="Pp"></div>
The user-provided starting location in the above example is the boxed <b>3</b>
  in the above input map. The costs in the output map represent the total cost
  of moving from each box (&quot;cell&quot;) to one or more (here, only one)
  starting location(s). Cells surrounded by asterisks are those that are
  different between operations using and not using the Knight&#x2019;s move (
  <b>-k</b>) option.
<h2 class="Ss" title="Ss" id="Output_analysis"><a class="selflink" href="#Output_analysis">Output
  analysis</a></h2>
The output map can be viewed, for example, as an elevation model in which the
  starting location(s) is/are the lowest point(s). Outputs from <i>r.cost</i>
  can be used as inputs to <i>r.drain</i> with the direction flag <b>-d</b>, in
  order to trace the least-cost path given by this model between any given cell
  and the <i>r.cost</i> starting location(s). The two programs, when used
  together, generate least-cost paths or corridors between any two map locations
  (cells).
<h2 class="Ss" title="Ss" id="Shortest_distance_surfaces"><a class="selflink" href="#Shortest_distance_surfaces">Shortest
  distance surfaces</a></h2>
The <i>r.cost</i> module allows for computing the shortest distance of each
  pixel from raster lines, such as determining the shortest distances of
  households to the nearby road. For this cost surfaces with cost value 1 are
  used. The calculation is done with <i>r.cost</i> as follows (example for
  Spearfish region):
<div>&#x00A0;</div>
<pre>
  g.region raster=roads -p
  r.mapcalc &quot;area.one = 1&quot;
  r.cost -k input=area.one output=distance start_raster=roads
  d.rast distance
  d.rast.num distance
  #transform to metric distance from cell distance using the raster resolution:
  r.mapcalc &quot;dist_meters = distance * (ewres()+nsres())/2.&quot;
  d.rast dist_meters
</pre>
<h1 class="Sh" title="Sh" id="Movement_Direction"><a class="selflink" href="#Movement_Direction">Movement
  Direction</a></h1>
The movement direction surface is created to record the sequence of movements
  that created the cost accumulation surface. Without it <i>r.drain</i> would
  not correctly create a path from an end point back to the start point. The
  direction of each cell points towards the next cell. The directions are
  recorded as degrees CCW from East:
<div>&#x00A0;</div>
<pre>
       112.5      67.5         i.e. a cell with the value 135
157.5  135   90   45   22.5    means the next cell is to the north-west
       180   x   360
202.5  225  270  315  337.5
       247.5     292.5
</pre>
<h2 class="Ss" title="Ss" id="Cost_allocation"><a class="selflink" href="#Cost_allocation">Cost
  allocation</a></h2>
Example: calculation of the cost allocation map &quot;costalloc&quot; and the
  cumulative cost map &quot;costsurf&quot; for given starting points (map
  &quot;sources&quot;) and given cost raster map &quot;costs&quot;:
<div>&#x00A0;</div>
<pre>
r.cost input=costs start_raster=sources output=costsurf nearest=costalloc
</pre>
<h2 class="Ss" title="Ss" id="Find_the_minimum_cost_path"><a class="selflink" href="#Find_the_minimum_cost_path">Find
  the minimum cost path</a></h2>
Once <i>r.cost</i> computes the cumulative cost map, <i>r.drain</i> can be used
  to find the minimum cost path. Make sure to use the <b>-d</b> flag and the
  movement direction raster map when running r.drain to ensure the path is
  computed according to the proper movement directions.
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<i></i> <i>r.drain,</i> <i>r.walk,</i> <i>r.in.ascii,</i> <i>r.mapcalc,</i>
  <i>r.out.ascii</i> <i></i>
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Antony Awaida, Intelligent Engineering Systems Laboratory, M.I.T.
<div>&#x00A0;</div>
James Westervelt, U.S.Army Construction Engineering Research Laboratory
<div>&#x00A0;</div>
Updated for Grass 5 by Pierre de Mouveaux (pmx@audiovu.com)
<div class="Pp"></div>
<i>Last changed: $Date: 2015-01-23 20:38:50 +0100 (Fri, 23 Jan 2015) $</i>
<h1 class="Sh" title="Sh" id="SOURCE_CODE"><a class="selflink" href="#SOURCE_CODE">SOURCE
  CODE</a></h1>
Available at: r.cost source code (history)
<div class="Pp"></div>
Main index | Raster index | Topics index | Keywords index | Graphical index |
  Full index
<div class="Pp"></div>
&#x00A9; 2003-2016 GRASS Development Team, GRASS GIS 7.2.0 Reference
  Manual</div>
<table class="foot">
  <tr>
    <td class="foot-date"></td>
    <td class="foot-os">GRASS 7.2.0</td>
  </tr>
</table>
</body>
</html>
