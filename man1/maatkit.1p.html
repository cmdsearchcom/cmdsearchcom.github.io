<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>MAATKIT(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">MAATKIT(1)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">MAATKIT(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
maatkit - Essential command-line utilities for MySQL.
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
Maatkit is a collection of command-line utilities that provide missing
  functionality for MySQL. Some of the tools implement lacking server
  functionality, such as online consistency checks for master/slave replication;
  others are client-side utilities such as a query profiler.
<div class="Pp"></div>
The following tools are included:
<div class="Pp"></div>
<pre>
   $Revision: 7540 $
mk-archiver 1.0.27
mk-config-diff 1.0.0
mk-deadlock-logger 1.0.21
mk-duplicate-key-checker 1.2.15
mk-error-log 1.0.3
mk-fifo-split 1.0.7
mk-find 0.9.23
mk-heartbeat 1.0.23
mk-index-usage 0.9.4
mk-kill 0.9.10
mk-loadavg 0.9.7
mk-log-player 1.0.9
mk-parallel-dump 1.0.28
mk-parallel-restore 1.0.24
mk-purge-logs 0.9.0
mk-query-advisor 1.0.4
mk-query-digest 0.9.29
mk-query-profiler 1.1.22
mk-show-grants 1.0.23
mk-slave-delay 1.0.23
mk-slave-find 1.0.16
mk-slave-move 0.9.12
mk-slave-prefetch 1.0.21
mk-slave-restart 1.0.22
mk-table-checksum 1.2.23
mk-table-sync 1.0.31
mk-table-usage 1.0.1
mk-tcp-model 1.0.1
mk-upgrade 0.9.8
mk-variable-advisor 1.0.2
mk-visual-explain 1.0.22
</pre>
<dl class="Bl-tag">
  <dt class="It-tag">mk-archiver</dt>
  <dd class="It-tag">Archive rows from a MySQL table into another table or a
      file. See mk-archiver.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-checksum-filter</dt>
  <dd class="It-tag">Filter checksums from mk-table-checksum. See
      mk-checksum-filter.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-config-diff</dt>
  <dd class="It-tag">Diff MySQL configuration files and server variables. See
      mk-config-diff.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-deadlock-logger</dt>
  <dd class="It-tag">Extract and log MySQL deadlock information. See
      mk-deadlock-logger.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-duplicate-key-checker</dt>
  <dd class="It-tag">Find duplicate indexes and foreign keys on MySQL tables.
      See mk-duplicate-key-checker.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-error-log</dt>
  <dd class="It-tag">Find new and different MySQL error log entries. See
      mk-error-log.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-fifo-split</dt>
  <dd class="It-tag">Split files and pipe lines to a fifo without really
      splitting. See mk-fifo-split.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-find</dt>
  <dd class="It-tag">Find MySQL tables and execute actions, like GNU find. See
      mk-find.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-heartbeat</dt>
  <dd class="It-tag">Monitor MySQL replication delay. See mk-heartbeat.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-index-usage</dt>
  <dd class="It-tag">Read queries from a log and analyze how they use indexes.
      See mk-index-usage.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-kill</dt>
  <dd class="It-tag">Kill MySQL queries that match certain criteria. See
      mk-kill.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-loadavg</dt>
  <dd class="It-tag">Watch MySQL load and take action when it gets too high. See
      mk-loadavg.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-log-player</dt>
  <dd class="It-tag">Replay MySQL query logs. See mk-log-player.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-merge-mqd-results</dt>
  <dd class="It-tag">Merge multiple mk-query-digest reports into one. See
      mk-merge-mqd-results.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-parallel-dump</dt>
  <dd class="It-tag">(DEPRECATED) Dump MySQL tables in parallel. See
      mk-parallel-dump.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-parallel-restore</dt>
  <dd class="It-tag">(DEPRECATED) Load files into MySQL in parallel. See
      mk-parallel-restore.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-profile-compact</dt>
  <dd class="It-tag">Compact the output from mk-query-profiler. See
      mk-profile-compact.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-purge-logs</dt>
  <dd class="It-tag">Purge binary logs on a master based on purge rules. See
      mk-purge-logs.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-query-advisor</dt>
  <dd class="It-tag">Analyze queries and advise on possible problems. See
      mk-query-advisor.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-query-digest</dt>
  <dd class="It-tag">Analyze query execution logs and generate a query report,
      filter, replay, or transform queries for MySQL, PostgreSQL, memcached, and
      more. See mk-query-digest.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-query-profiler</dt>
  <dd class="It-tag">Execute SQL statements and print statistics, or measure
      activity caused by other processes. See mk-query-profiler.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-show-grants</dt>
  <dd class="It-tag">Canonicalize and print MySQL grants so you can effectively
      replicate, compare and version-control them. See mk-show-grants.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-slave-delay</dt>
  <dd class="It-tag">Make a MySQL slave server lag behind its master. See
      mk-slave-delay.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-slave-find</dt>
  <dd class="It-tag">Find and print replication hierarchy tree of MySQL slaves.
      See mk-slave-find.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-slave-move</dt>
  <dd class="It-tag">Move a MySQL slave around in the replication hierarchy. See
      mk-slave-move.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-slave-prefetch</dt>
  <dd class="It-tag">Pipeline relay logs on a MySQL slave to pre-warm caches.
      See mk-slave-prefetch.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-slave-restart</dt>
  <dd class="It-tag">Watch and restart MySQL replication after errors. See
      mk-slave-restart.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-table-checksum</dt>
  <dd class="It-tag">Perform an online replication consistency check, or
      checksum MySQL tables efficiently on one or many servers. See
      mk-table-checksum.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-table-sync</dt>
  <dd class="It-tag">Synchronize MySQL table data efficiently. See
      mk-table-sync.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-table-usage</dt>
  <dd class="It-tag">Read queries from a log and analyze how they use tables.
      See mk-table-usage.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-tcp-model</dt>
  <dd class="It-tag">Transform tcpdump into metrics that permit performance and
      scalability modeling. See mk-tcp-model.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-upgrade</dt>
  <dd class="It-tag">Execute queries on multiple servers and check for
      differences. See mk-upgrade.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-variable-advisor</dt>
  <dd class="It-tag">Analyze MySQL variables and advise on possible problems.
      See mk-variable-advisor.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">mk-visual-explain</dt>
  <dd class="It-tag">Format EXPLAIN output as a tree. See
    mk-visual-explain.</dd>
</dl>
<h1 class="Sh" title="Sh" id="INSTALLATION"><a class="selflink" href="#INSTALLATION">INSTALLATION</a></h1>
Strictly speaking these tools require no installation; you should be able to run
  them stand-alone. However, on UNIX-ish systems you can use the standard Perl
  installation sequence:
<div class="Pp"></div>
<pre>
   cd &lt;package directory&gt;
   perl Makefile.PL
   make install
</pre>
<h1 class="Sh" title="Sh" id="CONFIGURATION"><a class="selflink" href="#CONFIGURATION">CONFIGURATION</a></h1>
Maatkit tools can read options from configuration files. The configuration file
  syntax is simple and direct, and bears some resemblances to the MySQL
  command-line client tools. The configuration files all follow the same
  conventions.
<div class="Pp"></div>
Internally, what actually happens is that the lines are read from the file and
  then added as command-line options and arguments to the Maatkit tool, so just
  think of the configuration files as a way to write your command lines.
<h2 class="Ss" title="Ss" id="SYNTAX"><a class="selflink" href="#SYNTAX">SYNTAX</a></h2>
The syntax of the files is as follows:
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Whitespace followed by a hash (#) sign signifies that the
      rest of the line is a comment. This is deleted.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Whitespace is stripped from the beginning and end of all
      lines.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Empty lines are ignored.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Each line is permitted to be in either of the following
      formats:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  option
  option=value
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Whitespace around the equals sign is deleted during processing.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Only long options are recognized.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">A line containing only two hyphens signals the end of
      option parsing. Any further lines are interpreted as additional arguments
      (not options) to the program.</dd>
</dl>
<h2 class="Ss" title="Ss" id="FILES"><a class="selflink" href="#FILES">FILES</a></h2>
The tools read several configuration files in order:
<dl class="Bl-tag">
  <dt class="It-tag">1.</dt>
  <dd class="It-tag">The global Maatkit configuration file,
      /etc/maatkit/maatkit.conf. All tools read this file, so you should only
      add options to it that you want to apply to all Maatkit tools.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">2.</dt>
  <dd class="It-tag">The global tool configuration file,
      /etc/maatkit/[toolname].conf. This file is named after the specific tool
      you're using, so you can add options that apply only to that tool.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">3.</dt>
  <dd class="It-tag">The user's own Maatkit configuration file,
      $HOME/.maatkit.conf. All tools read this file, so you should only add
      options to it that you want to apply to all Maatkit tools.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">4.</dt>
  <dd class="It-tag">The user's tool configuration file, $HOME/.[toolname].conf.
      This file is named after the specific tool you're using, so you can add
      options that apply only to that tool.</dd>
</dl>
<h2 class="Ss" title="Ss" id="SPECIFYING_CONFIGURATION_FILES"><a class="selflink" href="#SPECIFYING_CONFIGURATION_FILES">SPECIFYING
  CONFIGURATION FILES</a></h2>
There is a special --config option, which lets you specify which configuration
  files Maatkit should read. You specify a comma-separated list of files.
  However, its behavior is not like other command-line options. It must be given
  <b>first</b> on the command line, before any other options. If you try to
  specify it anywhere else, it will cause an error. Also, you cannot specify
  --config=/path/to/file; you must specify the option and the path to the
  file(s) separated by whitespace, without an equals-sign between them, e.g.
<div class="Pp"></div>
<pre>
  --config /path/to/file
</pre>
<div class="Pp"></div>
If you don't want any configuration files at all, specify &quot;--config
  ''&quot; to provide an empty list of files.
<h1 class="Sh" title="Sh" id="DSN_(DATA_SOURCE_NAME)_SPECIFICATIONS"><a class="selflink" href="#DSN_(DATA_SOURCE_NAME)_SPECIFICATIONS">DSN
  (DATA SOURCE NAME) SPECIFICATIONS</a></h1>
Maatkit uses DSNs to specify how to create a DBD connection to a MySQL server.
  The maatkit tools that have command-line arguments such as -u or -p use them
  to create a DSN behind the scenes, then use the DSN to connect to MySQL.
<div class="Pp"></div>
A DSN is a string of key=value parts separated by commas. The possible keys are
  shown later in this document. You can also get a quick synopsis from the
  --help output of many of the maatkit tools.
<h2 class="Ss" title="Ss" id="PARTS"><a class="selflink" href="#PARTS">PARTS</a></h2>
Many of the tools add more parts to DSNs for special purposes, and sometimes
  override parts to make them do something slightly different. However, all the
  tools support at least the following:
<dl class="Bl-tag">
  <dt class="It-tag">A</dt>
  <dd class="It-tag">Specifies the default character set for the connection.
    <div style="height: 1.00em;">&#x00A0;</div>
    Enables character set settings in Perl and MySQL. If the value is
      &quot;utf8&quot;, sets Perl's binmode on STDOUT to utf8, passes the
      &quot;mysql_enable_utf8&quot; option to DBD::mysql, and runs &quot;SET
      NAMES UTF8&quot; after connecting to MySQL. Any other value sets binmode
      on STDOUT without the utf8 layer, and runs &quot;SET NAMES&quot; after
      connecting to MySQL.
    <div style="height: 1.00em;">&#x00A0;</div>
    Unfortunately, there is no way from within Perl itself to specify the client
      library's character set. &quot;SET NAMES&quot; only affects the server; if
      the client library's settings don't match, there could be problems. You
      can use the defaults file to specify the client library's character set,
      however. See the description of the F part below.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">D</dt>
  <dd class="It-tag">Specifies the connection's default database.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">F</dt>
  <dd class="It-tag">Specifies a defaults file the mysql client library (the C
      client library used by DBD::mysql, <i>not maatkit itself</i>) should read.
      The maatkit tools all read the [client] section within the defaults file.
      If you omit this, the standard defaults files will be read in the usual
      order. &quot;Standard&quot; varies from system to system, because the
      filenames to read are compiled into the client library. On Debian systems,
      for example, it's usually /etc/mysql/my.cnf then ~/.my.cnf. If you place
      the following into ~/.my.cnf, maatkit will Do The Right Thing:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
 [client]
 user=your_user_name
 pass=secret
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Omitting the F part is usually the right thing to do. As long as you have
      configured your ~/.my.cnf correctly, that will result in maatkit
      connecting automatically without needing a username or password.
    <div style="height: 1.00em;">&#x00A0;</div>
    You can also specify a default character set in the defaults file. Unlike
      the &quot;A&quot; part described above, this will actually instruct the
      client library (DBD::mysql) to change the character set it uses
      internally, which cannot be accomplished any other way as far as I know,
      except for &quot;utf8&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">P</dt>
  <dd class="It-tag">Port number to use for the connection. Note that the usual
      special-case behaviors apply: if you specify &quot;localhost&quot; as your
      hostname on Unix systems, the connection actually uses a socket file, not
      a TCP/IP connection, and thus ignores the port.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">S</dt>
  <dd class="It-tag">Socket file to use for the connection (on Unix
    systems).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">h</dt>
  <dd class="It-tag">Hostname or IP address for the connection.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">p</dt>
  <dd class="It-tag">Password to use when connecting.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">u</dt>
  <dd class="It-tag">User for login if not current user.</dd>
</dl>
<h2 class="Ss" title="Ss" id="BAREWORD"><a class="selflink" href="#BAREWORD">BAREWORD</a></h2>
Many of the tools will let you specify a DSN as a single word, without any
  key=value syntax. This is called a 'bareword'. How this is handled is
  tool-specific, but it is usually interpreted as the &quot;h&quot; part. The
  tool's --help output will tell you the behavior for that tool.
<h2 class="Ss" title="Ss" id="DEFAULT_PROPAGATION"><a class="selflink" href="#DEFAULT_PROPAGATION">DEFAULT
  PROPAGATION</a></h2>
Many tools will let you propagate values from one DSN to the next, so you don't
  have to specify all the parts for each DSN. For example, if you want to
  specify a username and password for each DSN, you can connect to three hosts
  as follows:
<div class="Pp"></div>
<pre>
 h=host1,u=fred,p=wilma host2 host3
</pre>
<div class="Pp"></div>
This is tool-specific.
<h1 class="Sh" title="Sh" id="SYSTEM_REQUIREMENTS"><a class="selflink" href="#SYSTEM_REQUIREMENTS">SYSTEM
  REQUIREMENTS</a></h1>
You need Perl, DBI, DBD::mysql, and some core packages that ought to be
  installed in any reasonably new version of Perl.
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
If you find bugs, need features, etc please use the bug tracker, forums, and
  mailing lists at http://code.google.com/p/maatkit/
<h1 class="Sh" title="Sh" id="COPYRIGHT,_LICENSE_AND_WARRANTY"><a class="selflink" href="#COPYRIGHT,_LICENSE_AND_WARRANTY">COPYRIGHT,
  LICENSE AND WARRANTY</a></h1>
This program is copyright (c) 2007 Baron Schwartz and others. Feedback and
  improvements are welcome.
<div class="Pp"></div>
THIS PROGRAM IS PROVIDED &quot;AS IS&quot; AND WITHOUT ANY EXPRESS OR IMPLIED
  WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF
  MERCHANTIBILITY AND FITNESS FOR A PARTICULAR PURPOSE.
<div class="Pp"></div>
This program is free software; you can redistribute it and/or modify it under
  the terms of the GNU General Public License as published by the Free Software
  Foundation, version 2; OR the Perl Artistic License. On UNIX and similar
  systems, you can issue `man perlgpl' or `man perlartistic' to read these
  licenses.
<div class="Pp"></div>
You should have received a copy of the GNU General Public License along with
  this program; if not, write to the Free Software Foundation, Inc., 59 Temple
  Place, Suite 330, Boston, MA 02111-1307 USA.
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
See the individual program's documentation for details.
<h1 class="Sh" title="Sh" id="VERSION"><a class="selflink" href="#VERSION">VERSION</a></h1>
This manual page documents Distrib 7540 $Revision: 534 $.</div>
<table class="foot">
  <tr>
    <td class="foot-date">2011-06-08</td>
    <td class="foot-os">perl v5.24.1</td>
  </tr>
</table>
</body>
</html>
