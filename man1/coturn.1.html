<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>TURN(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">TURN(1)</td>
    <td class="head-vol"></td>
    <td class="head-rtitle">TURN(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="GENERAL_INFORMATION"><a class="selflink" href="#GENERAL_INFORMATION">GENERAL
  INFORMATION</a></h1>
The <b>TURN Server</b> project contains the source code of a TURN server and
  TURN client messaging library. Also, some extra programs provided, for
  testing-only purposes.
<div class="Pp"></div>
See the INSTALL file for the building instructions.
<div class="Pp"></div>
After the build, you will have the following binary images:
<dl class="Bl-tag">
  <dt class="It-tag"><b>1.</b></dt>
  <dd class="It-tag"><i>turnserver</i>: <b>TURN Server</b> relay. The compiled
      binary image of the <b>TURN Server</b> program is located in bin/
      sub-directory.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>2.</b></dt>
  <dd class="It-tag"><i>turnadmin</i>: TURN administration tool. See
      README.turnadmin and <i>turnadmin</i> man page.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>3.</b></dt>
  <dd class="It-tag">turnutils_uclient. See README.turnutils and
      <i>turnutils</i> man page.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>4.</b></dt>
  <dd class="It-tag">turnutils_peer. See README.turnutils and <i>turnutils</i>
      man page.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>5.</b></dt>
  <dd class="It-tag">turnutils_stunclient. See README.turnutils and
      <i>turnutils</i> man page.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>6.</b></dt>
  <dd class="It-tag">turnutils_rfc5769check. See README.turnutils and
      <i>turnutils</i> man page.</dd>
</dl>
<div class="Pp"></div>
In the &quot;examples/scripts&quot; sub-directory, you will find the examples of
  command lines to be used to run the programs. The scripts are meant to be run
  from examples/ sub-directory, for example:
<div class="Pp"></div>
$ cd examples $ ./scripts/secure_relay.sh
<h1 class="Sh" title="Sh" id="RUNNING_THE_TURN_SERVER"><a class="selflink" href="#RUNNING_THE_TURN_SERVER">RUNNING
  THE TURN SERVER</a></h1>
Options note: <i>turnserver</i> has long and short option names, for most
  options. Some options have only long form, some options have only short form.
  Their syntax somewhat different, if an argument is required:
<div class="Pp"></div>
The short form must be used as this (for example):
<div class="Pp"></div>
<pre>
  $ turnserver -L 12.34.56.78
<div class="Pp"></div>
</pre>
The long form equivalent must use the &quot;=&quot; character:
<div class="Pp"></div>
<pre>
  $ turnserver --listening-ip=12.34.56.78
<div class="Pp"></div>
</pre>
If this is a flag option (no argument required) then their usage are the same,
  for example:
<div class="Pp"></div>
<pre>
 $ turnserver -a
<div class="Pp"></div>
</pre>
is equivalent to:
<div class="Pp"></div>
<pre>
 $ turnserver --lt-cred-mech
<div class="Pp"></div>
</pre>
=====================================
<h2 class="Ss" title="Ss" id="NAME"><a class="selflink" href="#NAME">NAME</a></h2>
<b></b> <b></b><b>turnserver </b><b>- a TURN relay server implementation.</b>
  <b></b><b></b>
<h2 class="Ss" title="Ss" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h2>
<pre>
<div class="Pp"></div>
$  <i>turnserver</i> [<b>-n</b> | <b>-c</b> &lt;config-file&gt; ] [<i>flags</i>] [ <b>--userdb</b>=&lt;userdb-file&gt; | <b>--psql-userdb</b>=&lt;db-conn-string&gt; | <b>--mysql-userdb</b>=&lt;db-conn-string&gt;  | <b>--mongo-userdb</b>=&lt;db-conn-string&gt;  | <b>--redis-userdb</b>=&lt;db-conn-string&gt; ] [<b>-z</b> | <b>--no-auth</b> | <b>-a</b> | <b>--lt-cred-mech</b> ] [<i>options</i>]
$  <i>turnserver</i> <b>-h</b>
<div class="Pp"></div>
</pre>
<h2 class="Ss" title="Ss" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Config file settings:</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-n</b></b></dt>
  <dd class="It-tag">Do not use configuration file, use only command line
      parameters.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-c</b></b></dt>
  <dd class="It-tag">Configuration file name (default - turnserver.conf). The
      format of config file can be seen in the supplied
      examples/etc/turnserver.conf example file. Long names of the
      <i>options</i> are used as the configuration items names in the file. If
      not an absolute path is supplied, then the file is searched in the
      following directories:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">current directory</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">current directory etc/ sub-directory</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">upper directory level etc/</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">/etc/</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">/usr/local/etc/</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">installation directory /etc</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>User database settings:</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-b</b>, <b>--db</b>, <b>--userdb</b></b></dt>
  <dd class="It-tag">SQLite user database file name (default - /var/db/turndb or
      /usr/local/var/db/turndb or /var/lib/turn/turndb).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-e</b>, <b>--psql-userdb</b></b></dt>
  <dd class="It-tag">User database connection string for PostgreSQL. This
      database can be used for long-term credentials mechanism, and it can store
      the secret value for secret-based timed authentication in TURN RESP API.
      The connection string format is like that:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
&quot;host=&lt;host&gt; dbname=&lt;dbname&gt; user=&lt;db-user&gt;
  password=&lt;db-user-password&gt; connect_timeout=&lt;seconds&gt;&quot; (for
  8.x or newer Postgres).
<div class="Pp"></div>
Or:
<div class="Pp"></div>
&quot;postgresql://username:password@hostname:port/databasename&quot; (for 9.x
  or newer Postgres).
<div class="Pp"></div>
See the INSTALL file for more explanations and examples.
<div class="Pp"></div>
Also, see http://www.PostgreSQL.org for full PostgreSQL documentation.</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-M</b>, <b>--mysql-userdb</b></b></dt>
  <dd class="It-tag">User database connection string for MySQL or MariaDB. This
      database can be used for long-term credentials mechanism, and it can store
      the secret value for secret-based timed authentication in TURN RESP API.
      The connection string format is like that:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
&quot;host=&lt;host&gt; dbname=&lt;dbname&gt; user=&lt;db-user&gt;
  password=&lt;db-user-password&gt; connect_timeout=&lt;seconds&gt;
  read_timeout=&lt;seconds&gt;&quot;
<div class="Pp"></div>
See the INSTALL file for more explanations and examples.
<div class="Pp"></div>
Also, see http://www.mysql.org or http://mariadb.org for full MySQL
  documentation.
<div class="Pp"></div>
Optional connection string parameters for the secure communications (SSL): ca,
  capath, cert, key, cipher (see
  http://dev.mysql.com/doc/refman/5.1/en/ssl-options.html for the command
  <i>options</i> description).</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-J</b>, <b>--mongo-userdb</b></b></dt>
  <dd class="It-tag">User database connection string for MongoDB. This database
      can be used for long-term credentials mechanism, and it can store the
      secret value for secret-based timed authentication in TURN RESP API. The
      connection string format is like that:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
&quot;mongodb://username:password@host:port/database? <i>options</i>&quot;
<div class="Pp"></div>
See the INSTALL file for more explanations and examples.
<div class="Pp"></div>
Also, see http://docs.mongodb.org/manual/ for full MongoDB documentation.</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-N</b>, <b>--redis-userdb</b></b></dt>
  <dd class="It-tag">User database connection string for Redis. This database
      can be used for long-term credentials mechanism, and it can store the
      secret value for secret-based timed authentication in TURN RESP API. The
      connection string format is like that:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<div class="Pp"></div>
&quot;ip=&lt;ip-addr&gt; dbname=&lt;db-number&gt; password=&lt;db-password&gt;
  connect_timeout=&lt;seconds&gt;&quot;
<div class="Pp"></div>
See the INSTALL file for more explanations and examples.
<div class="Pp"></div>
Also, see http://redis.io for full Redis documentation.</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Flags:</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-v</b>, <b>--verbose</b></b></dt>
  <dd class="It-tag">Moderate verbose mode.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-V</b>, <b>--Verbose</b></b></dt>
  <dd class="It-tag">Extra verbose mode, very annoying and not recommended.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-o</b>, <b>--daemon</b></b></dt>
  <dd class="It-tag">Run server as daemon.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-f</b>, <b>--fingerprint</b></b></dt>
  <dd class="It-tag">Use fingerprints in the TURN messages. If an incoming
      request contains a fingerprint, then TURN server will always add
      fingerprints to the messages in this session, regardless of the per-server
      setting.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-a</b>, <b>--lt-cred-mech</b></b></dt>
  <dd class="It-tag">Use long-term credentials mechanism (this one you need for
      WebRTC usage).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-z</b>, <b>--no-auth</b></b></dt>
  <dd class="It-tag">Do not use any credentials mechanism, allow anonymous
      access. Opposite to <b>-a</b> and <b>-A</b> <i>options</i>. This is
      default option when no authentication-related <i>options</i> are set. By
      default, no credential mechanism is used - any user is allowed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--use-auth-secret</b></b></dt>
  <dd class="It-tag">TURN REST API flag. Flag that sets a special WebRTC
      authorization option that is based upon authentication secret. The feature
      purpose is to support &quot; <b>TURN Server</b> REST API&quot; as
      described in the TURN REST API section below. This option uses timestamp
      as part of combined username: usercombo -&gt;
      &quot;timestamp:username&quot;, turn user -&gt; usercombo, turn password
      -&gt; <b>base64</b>(hmac(input_buffer = usercombo, key = shared-secret)).
      This allows TURN credentials to be accounted for a specific user id. If
      you don't have a suitable id, the timestamp alone can be used. This option
      is just turns on secret-based authentication. The actual value of the
      secret is defined either by option static-auth-secret, or can be found in
      the turn_secret table in the database.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--oauth</b></b></dt>
  <dd class="It-tag">Support oAuth authentication, as in the third-party
      STUN/TURN RFC 7635.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--dh566</b></b></dt>
  <dd class="It-tag">Use 566 bits predefined DH TLS key. Default size of the key
      is 1066.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--dh2066</b></b></dt>
  <dd class="It-tag">Use 2066 bits predefined DH TLS key. Default size of the
      key is 1066.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--no-tlsv1</b></b></dt>
  <dd class="It-tag">Do not allow TLSv1/DTLSv1 protocol.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--no-tlsv1_1</b></b></dt>
  <dd class="It-tag">Do not allow TLSv1.1 protocol.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--no-tlsv1_2</b></b></dt>
  <dd class="It-tag">Do not allow TLSv1.2/DTLSv1.2 protocol.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--no-udp</b></b></dt>
  <dd class="It-tag">Do not start UDP client listeners.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--no-tcp</b></b></dt>
  <dd class="It-tag">Do not start TCP client listeners.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--no-tls</b></b></dt>
  <dd class="It-tag">Do not start TLS client listeners.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--no-dtls</b></b></dt>
  <dd class="It-tag">Do not start DTLS client listeners.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--no-udp-relay</b></b></dt>
  <dd class="It-tag">Do not allow UDP relay endpoints defined in RFC 5766, use
      only TCP relay endpoints as defined in RFC 6062.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--no-tcp-relay</b></b></dt>
  <dd class="It-tag">Do not allow TCP relay endpoints defined in RFC 6062, use
      only UDP relay endpoints as defined in RFC 5766.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--no-stdout-log</b></b></dt>
  <dd class="It-tag">Flag to prevent stdout log messages. By default, all log
      messages are going to both stdout and to the configured log file. With
      this option everything will be going to the log file only (unless the log
      file itself is stdout).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--syslog</b></b></dt>
  <dd class="It-tag">With this flag, all log will be redirected to the system
      log (syslog).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--simple-log</b></b></dt>
  <dd class="It-tag">This flag means that no log file rollover will be used, and
      the log file name will be constructed as-is, without PID and date
      appendage. This option can be used, for example, together with the
      logrotate tool.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--secure-stun</b></b></dt>
  <dd class="It-tag">Require authentication of the STUN Binding request. By
      default, the clients are allowed anonymous access to the STUN Binding
      functionality.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-S</b>, <b>--stun-only</b></b></dt>
  <dd class="It-tag">Run as STUN server only, all TURN requests will be ignored.
      Option to suppress TURN functionality, only STUN requests will be
      processed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--no-stun</b></b></dt>
  <dd class="It-tag">Run as TURN server only, all STUN requests will be ignored.
      Option to suppress STUN functionality, only TURN requests will be
      processed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--no-loopback-peers</b></b></dt>
  <dd class="It-tag">Disallow peers on the loopback addresses (127.x.x.x and
      ::1).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--no-multicast-peers</b></b></dt>
  <dd class="It-tag">Disallow peers on well-known broadcast addresses (224.0.0.0
      and above, and FFXX:*).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--mobility</b></b></dt>
  <dd class="It-tag">Mobility with ICE (MICE) specs support.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--no-cli</b></b></dt>
  <dd class="It-tag">Turn OFF the CLI support. By default it is always ON. See
      also <i>options</i> <b>--cli-ip</b> and <b>--cli-port</b>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--server-relay</b></b></dt>
  <dd class="It-tag">Server relay. NON-STANDARD AND DANGEROUS OPTION. Only for
      those applications when we want to run server applications on the relay
      endpoints. This option eliminates the IP permissions check on the packets
      incoming to the relay endpoints. See
      http://tools.ietf.org/search/rfc5766#section-17.2.3 .</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--udp-self-balance</b></b></dt>
  <dd class="It-tag">(recommended for older Linuxes only) Automatically balance
      UDP traffic over auxiliary servers (if configured). The load balancing is
      using the ALTERNATE-SERVER mechanism. The TURN client must support 300
      ALTERNATE-SERVER response for this functionality.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--check-origin-consistency</b></b></dt>
  <dd class="It-tag">The flag that sets the origin consistency check: across the
      session, all requests must have the same main ORIGIN attribute value (if
      the ORIGIN was initially used by the session).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-h</b></b></dt>
  <dd class="It-tag">Help.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>Options with values:</b></dt>
  <dd class="It-tag"></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--stale-nonce</b>[=&lt;value&gt;]</b></dt>
  <dd class="It-tag">Use extra security with nonce value having limited
      lifetime, in seconds (default 600 secs).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--max-allocate-lifetime</b></b></dt>
  <dd class="It-tag">Set the maximum value for the allocation lifetime. Default
      to 3600 secs.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--channel-lifetime</b></b></dt>
  <dd class="It-tag">Set the lifetime for channel binding, default to 600 secs.
      This value MUST not be changed for production purposes.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--permission-lifetime</b></b></dt>
  <dd class="It-tag">Set the value for the lifetime of the permission. Default
      to 300 secs. This MUST not be changed for production purposes.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-d</b>, <b>--listening-device</b></b></dt>
  <dd class="It-tag">Listener interface device. (NOT RECOMMENDED. Optional
      functionality, Linux only). The <i>turnserver</i> process must have root
      privileges to bind the listening endpoint to a device. If
      <i>turnserver</i> must run as a process without root privileges, then just
      do not use this setting.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-L</b>, <b>--listening-ip</b></b></dt>
  <dd class="It-tag">Listener IP address of relay server. Multiple listeners can
      be specified, for example: <b>-L</b> ip1 <b>-L</b> ip2 <b>-L</b> ip3 If no
      <b>IP</b>(s) specified, then all IPv4 and IPv6 system IPs will be used for
      listening. The same <b>ip</b>(s) can be used as both listening and relay
      <b>ip</b>(s).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-p</b>, <b>--listening-port</b></b></dt>
  <dd class="It-tag">TURN listener port for UDP and TCP listeners (Default:
      3478). Note: actually, TLS &amp; DTLS sessions can connect to the
      &quot;plain&quot; TCP &amp; UDP <b>port</b>(s), too - if allowed by
      configuration.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--tls-listening-port</b></b></dt>
  <dd class="It-tag">TURN listener port for TLS and DTLS listeners (Default:
      5349). Note: actually, &quot;plain&quot; TCP &amp; UDP sessions can
      connect to the TLS &amp; DTLS <b>port</b>(s), too - if allowed by
      configuration. The TURN server &quot;automatically&quot; recognizes the
      type of traffic. Actually, two listening endpoints (the &quot;plain&quot;
      one and the &quot;tls&quot; one) are equivalent in terms of functionality;
      but we keep both endpoints to satisfy the RFC 5766 specs. For secure TCP
      connections, we currently support SSL version 3 and TLS versions 1.0, 1.1,
      1.2. For secure UDP connections, we support DTLS version 1.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--alt-listening-port</b></b></dt>
  <dd class="It-tag">Alternative listening port for UDP and TCP listeners;
      default (or zero) value means &quot;listening port plus one&quot;. This is
      needed for STUN CHANGE_REQUEST - in RFC 5780 sense or in old RFC 3489
      sense - for NAT behavior discovery). The <b>TURN Server</b> supports
      CHANGE_REQUEST only if it is started with more than one listening IP
      address of the same family (IPv4 or IPv6). The CHANGE_REQUEST is only
      supported by UDP protocol, other protocols are listening on that endpoint
      only for &quot;symmetry&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--alt-tls-listening-port</b></b></dt>
  <dd class="It-tag">Alternative listening port for TLS and DTLS protocols.
      Default (or zero) value means &quot;TLS listening port plus
    one&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--aux-server</b></b></dt>
  <dd class="It-tag">Auxiliary STUN/TURN server listening endpoint. Aux servers
      have almost full TURN and STUN functionality. The (minor) limitations
    are:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">1)</dt>
  <dd class="It-tag">Auxiliary servers do not have alternative ports and they do
      not support STUN RFC 5780 functionality (CHANGE REQUEST).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">2)</dt>
  <dd class="It-tag">Auxiliary servers also are never returning
      ALTERNATIVE-SERVER reply.</dd>
</dl>
</div>
<div class="Pp"></div>
Valid formats are 1.2.3.4:5555 for IPv4 and [1:2::3:4]:5555 for IPv6. There may
  be multiple aux-server <i>options</i>, each will be used for listening to
  client requests.
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-i</b>, <b>--relay-device</b></b></dt>
  <dd class="It-tag">Relay interface device for relay sockets (NOT RECOMMENDED.
      Optional, Linux only).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-E</b>, <b>--relay-ip</b></b></dt>
  <dd class="It-tag">Relay address (the local IP address that will be used to
      relay the packets to the peer). Multiple relay addresses may be used:
      <b>-E</b> ip1 <b>-E</b> ip2 <b>-E</b> ip3 The same <b>IP</b>(s) can be
      used as both listening <b>IP</b>(s) and relay <b>IP</b>(s). If no relay
      <b>IP</b>(s) specified, then the <i>turnserver</i> will apply the default
      policy: it will decide itself which relay addresses to be used, and it
      will always be using the client socket IP address as the relay IP address
      of the TURN session (if the requested relay address family is the same as
      the family of the client socket).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-X</b>, <b>--external-ip</b></b></dt>
  <dd class="It-tag"><b>TURN Server</b> public/private address mapping, if the
      server is behind NAT. In that situation, if a <b>-X</b> is used in form
      &quot; <b>-X</b> &lt;ip&gt;&quot; then that ip will be reported as relay
      IP address of all allocations. This scenario works only in a simple case
      when one single relay address is be used, and no CHANGE_REQUEST
      functionality is required. That single relay address must be mapped by NAT
      to the 'external' IP. The &quot;external-ip&quot; value, if not empty, is
      returned in XOR-RELAYED-ADDRESS field. For that 'external' IP, NAT must
      forward ports directly (relayed port 12345 must be always mapped to the
      same 'external' port 12345). In more complex case when more than one IP
      address is involved, that option must be used several times, each entry
      must have form &quot; <b>-X</b> &lt;public-ip/private-ip&gt;&quot;, to map
      all involved addresses. CHANGE_REQUEST (RFC5780 or RFC3489) NAT discovery
      STUN functionality will work correctly, if the addresses are mapped
      properly, even when the TURN server itself is behind A NAT. By default,
      this value is empty, and no address mapping is used.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-m</b>, <b>--relay-threads</b></b></dt>
  <dd class="It-tag">Number of the relay threads to handle the established
      connections (in addition to authentication thread and the listener
      thread). If explicitly set to 0 then application runs relay process in a
      single thread, in the same thread with the listener process (the
      authentication thread will still be a separate thread). If not set, then a
      default optimal algorithm will be employed (OS-dependent). In the older
      Linux systems (before Linux kernel 3.9), the number of UDP threads is
      always one threads per network listening endpoint - unless &quot;
      <b>-m</b> 0&quot; or &quot; <b>-m</b> 1&quot; is set.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--min-port</b></b></dt>
  <dd class="It-tag">Lower bound of the UDP port range for relay endpoints
      allocation. Default value is 49152, according to RFC 5766.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--max-port</b></b></dt>
  <dd class="It-tag">Upper bound of the UDP port range for relay endpoints
      allocation. Default value is 65535, according to RFC 5766.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-u</b>, <b>--user</b></b></dt>
  <dd class="It-tag">Long-term security mechanism credentials user account, in
      the column-separated form username:key. Multiple user accounts may be used
      in the command line. The key is either the user password, or the key is
      generated by <i>turnadmin</i> command. In the second case, the key must be
      prepended with 0x symbols. The key is calculated over the user name, the
      user realm, and the user password. This setting may not be used with TURN
      REST API.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-r</b>, <b>--realm</b></b></dt>
  <dd class="It-tag">The default realm to be used for the users when no explicit
      origin/realm relationship was found in the database, or if the TURN server
      is not using any database (just the commands-line settings and the userdb
      file). Must be used with long-term credentials mechanism or with TURN REST
      API.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-C</b>, <b>--rest-api-separator</b></b></dt>
  <dd class="It-tag">This is the timestamp/username separator symbol (character)
      in TURN REST API. The default value is :.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-q</b>, <b>--user-quota</b></b></dt>
  <dd class="It-tag">Per-user allocations quota: how many concurrent allocations
      a user can create. This option can also be set through the database, for a
      particular realm.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-Q</b>, <b>--total-quota</b></b></dt>
  <dd class="It-tag">Total allocations quota: global limit on concurrent
      allocations. This option can also be set through the database, for a
      particular realm.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-s</b>, <b>--max-bps</b></b></dt>
  <dd class="It-tag">Max bytes-per-second bandwidth a TURN session is allowed to
      handle (input and output network streams are treated separately). Anything
      above that limit will be dropped or temporary suppressed (within the
      available buffer limits). This option can also be set through the
      database, for a particular realm.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-B</b>, <b>--bps-capacity</b></b></dt>
  <dd class="It-tag">Maximum server capacity. Total bytes-per-second bandwidth
      the TURN server is allowed to allocate for the sessions, combined (input
      and output network streams are treated separately).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--static-auth-secret</b></b></dt>
  <dd class="It-tag">Static authentication secret value (a string) for TURN REST
      API only. If not set, then the turn server will try to use the dynamic
      value in turn_secret table in user database (if present). The
      database-stored value can be changed on-the-fly by a separate program, so
      this is why that other mode is dynamic. Multiple shared secrets can be
      used (both in the database and in the &quot;static&quot; fashion).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--server-name</b></b></dt>
  <dd class="It-tag">Server name used for the oAuth authentication purposes. The
      default value is the realm name.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--cert</b></b></dt>
  <dd class="It-tag">Certificate file, PEM format. Same file search rules
      applied as for the configuration file. If both <b>--no-tls</b> and
      <b>--no-dtls</b> <i>options</i> are specified, then this parameter is not
      needed. Default value is turn_server_cert.pem.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--pkey</b></b></dt>
  <dd class="It-tag">Private key file, PEM format. Same file search rules
      applied as for the configuration file. If both <b>--no-tls</b> and
      <b>--no-dtls</b> <i>options</i> are specified, then this parameter is not
      needed. Default value is turn_server_pkey.pem.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--pkey-pwd</b></b></dt>
  <dd class="It-tag">If the private key file is encrypted, then this password to
      be used.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--cipher-list</b></b></dt>
  <dd class="It-tag">Allowed OpenSSL cipher list for TLS/DTLS connections.
      Default value is &quot;DEFAULT&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--CA-file</b></b></dt>
  <dd class="It-tag">CA file in OpenSSL format. Forces TURN server to verify the
      client SSL certificates. By default, no CA is set and no client
      certificate check is performed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--ec-curve-name</b></b></dt>
  <dd class="It-tag">Curve name for EC ciphers, if supported by OpenSSL library
      (TLS and DTLS). The default value is prime256v1, if pre-OpenSSL 1.0.2 is
      used. With OpenSSL 1.0.2+, an optimal curve will be automatically
      calculated, if not defined by this option.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--dh-file</b></b></dt>
  <dd class="It-tag">Use custom DH TLS key, stored in PEM format in the file.
      Flags <b>--dh566</b> and <b>--dh2066</b> are ignored when the DH key is
      taken from a file.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-l</b>, <b>--log-file</b></b></dt>
  <dd class="It-tag">Option to set the full path name of the log file. By
      default, the <i>turnserver</i> tries to open a log file in /var/log/
      <i>turnserver</i>, /var/log, /var/tmp, /tmp and . (current) directories
      (which file open operation succeeds first that file will be used). With
      this option you can set the definite log file name. The special names are
      &quot;stdout&quot; and &quot;-&quot; - they will force everything to the
      stdout. Also, &quot;syslog&quot; name will redirect everything into the
      system log (syslog), as if the option &quot; <b>--syslog</b>&quot; was
      set. In the runtime, the logfile can be reset with the SIGHUP signal to
      the <i>turnserver</i> process.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--alternate-server</b></b></dt>
  <dd class="It-tag">Option to set the &quot;redirection&quot; mode. The value
      of this option will be the address of the alternate server for UDP &amp;
      TCP service in form of &lt;ip&gt;[:&lt;port&gt;]. The server will send
      this value in the attribute ALTERNATE-SERVER, with error 300, on ALLOCATE
      request, to the client. Client will receive only values with the same
      address family as the client network endpoint address family. See RFC 5389
      and RFC 5766 for ALTERNATE-SERVER functionality description. The client
      must use the obtained value for subsequent TURN communications. If more
      than one <b>--alternate-server</b> <i>options</i> are provided, then the
      functionality can be more accurately described as
      &quot;load-balancing&quot; than a mere &quot;redirection&quot;. If the
      port number is omitted, then the default port number 3478 for the UDP/TCP
      protocols will be used. Colon (:) characters in IPv6 addresses may
      conflict with the syntax of the option. To alleviate this conflict,
      literal IPv6 addresses are enclosed in square brackets in such resource
      identifiers, for example: [2001:db8:85a3:8d3:1319:8a2e:370:7348]:3478 .
      Multiple alternate servers can be set. They will be used in the
      round-robin manner. All servers in the pool are considered of equal weight
      and the load will be distributed equally. For example, if we have 4
      alternate servers, then each server will receive 25% of ALLOCATE requests.
      An alternate TURN server address can be used more than one time with the
      alternate-server option, so this can emulate &quot;weighting&quot; of the
      servers.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--tls-alternate-server</b></b></dt>
  <dd class="It-tag">Option to set alternative server for TLS &amp; DTLS
      services in form of &lt;ip&gt;:&lt;port&gt;. If the port number is
      omitted, then the default port number 5349 for the TLS/DTLS protocols will
      be used. See the previous option for the functionality description.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>-O</b>, <b>--redis-statsdb</b></b></dt>
  <dd class="It-tag">Redis status and statistics database connection string, if
      used (default - empty, no Redis stats DB used). This database keeps
      allocations status information, and it can be also used for publishing and
      delivering traffic and allocation event notifications. This database
      option can be used independently of <b>--redis-userdb</b> option, and
      actually Redis can be used for status/statistics and SQLite or MySQL or
      MongoDB or PostgreSQL can be used for the user database. The connection
      string has the same parameters as redis-userdb connection string.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--max-allocate-timeout</b></b></dt>
  <dd class="It-tag">Max time, in seconds, allowed for full allocation
      establishment. Default is 60 seconds.</dd>
</dl>
<div class="Pp"></div>
<b>--denied-peer-ip</b>=&lt;IPaddr[<b>-IPaddr</b>]&gt;
<div class="Pp"></div>
<b>--allowed-peer-ip</b>=&lt;IPaddr[<b>-IPaddr</b>]&gt; Options to ban or allow
  specific ip addresses or ranges of ip addresses. If an ip address is specified
  as both allowed and denied, then the ip address is considered to be allowed.
  This is useful when you wish to ban a range of ip addresses, except for a few
  specific ips within that range. This can be used when you do not want users of
  the turn server to be able to access machines reachable by the turn server,
  but would otherwise be unreachable from the internet (e.g. when the turn
  server is sitting behind a NAT). The 'white&quot; and &quot;black&quot; peer
  IP ranges can also be dynamically changed in the database. The allowed/denied
  addresses (white/black lists) rules are very simple:
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">1)</dt>
  <dd class="It-tag">If there is no rule for an address, then it is
    allowed;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">2)</dt>
  <dd class="It-tag">If there is an &quot;allowed&quot; rule that fits the
      address then it is allowed - no matter what;</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">3)</dt>
  <dd class="It-tag">If there is no &quot;allowed&quot; rule that fits the
      address, and if there is a &quot;denied&quot; rule that fits the address,
      then it is denied.</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--pidfile</b></b></dt>
  <dd class="It-tag">File name to store the pid of the process. Default is
      /var/run/turnserver.pid (if superuser account is used) or
      /var/tmp/turnserver.pid .</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--proc-user</b></b></dt>
  <dd class="It-tag">User name to run the process. After the initialization, the
      <i>turnserver</i> process will make an attempt to change the current user
      ID to that user.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--proc-group</b></b></dt>
  <dd class="It-tag">Group name to run the process. After the initialization,
      the <i>turnserver</i> process will make an attempt to change the current
      group ID to that group.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--cli-ip</b></b></dt>
  <dd class="It-tag">Local system IP address to be used for CLI management
      interface. The <i>turnserver</i> process can be accessed for management
      with telnet, at this IP address and on the CLI port (see the next
      parameter). Default value is 127.0.0.1. You can use telnet or putty (in
      telnet mode) to access the CLI management interface.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--cli-port</b></b></dt>
  <dd class="It-tag">CLI management interface listening port. Default is
    5766.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--cli-password</b></b></dt>
  <dd class="It-tag">CLI access password. Default is empty (no password). For
      the security reasons, it is recommended to use the encrypted form of the
      password (see the <b>-P</b> command in the <i>turnadmin</i> utility). The
      dollar signs in the encrypted form must be escaped.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--cli-max-output-sessions</b></b></dt>
  <dd class="It-tag">Maximum number of output sessions in ps CLI command. This
      value can be changed on-the-fly in CLI. The default value is 256.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b><b>--ne</b>=[1|2|3]</b></dt>
  <dd class="It-tag">Set network engine type for the process (for internal
      purposes).</dd>
</dl>
<div class="Pp"></div>
==================================
<h1 class="Sh" title="Sh" id="LOAD_BALANCE_AND_PERFORMANCE_TUNING"><a class="selflink" href="#LOAD_BALANCE_AND_PERFORMANCE_TUNING">LOAD
  BALANCE AND PERFORMANCE TUNING</a></h1>
This topic is covered in the wiki page:
<div class="Pp"></div>
https://github.com/coturn/coturn/wiki/turn_performance_and_load_balance
<div class="Pp"></div>
===================================
<h1 class="Sh" title="Sh" id="WEBRTC_USAGE"><a class="selflink" href="#WEBRTC_USAGE">WEBRTC
  USAGE</a></h1>
This is a set of notes for the WebRTC users:
<dl class="Bl-tag">
  <dt class="It-tag">1)</dt>
  <dd class="It-tag">WebRTC uses long-term authentication mechanism, so you have
      to use <b>-a</b> option (or <b>--lt-cred-mech</b>). WebRTC relaying will
      not work with anonymous access. With <b>-a</b> option, do not forget to
      set the default realm ( <b>-r</b> option). You will also have to set up
      the user accounts, for that you have a number of <i>options</i>:</dd>
</dl>
<div class="Pp"></div>
<pre>
        a) command-line options (-u).
<div class="Pp"></div>
        b) a database table (SQLite or PostgreSQL or MySQL or MongoDB). You will have to 
        set keys with turnadmin utility (see docs and wiki for turnadmin). 
        You cannot use open passwords in the database.
<div class="Pp"></div>
        c) Redis key/value pair(s), if Redis is used. You key use either keys or 
        open passwords with Redis; see turndb/testredisdbsetup.sh file.  
<div class="Pp"></div>
        d) You also can use the TURN REST API. You will need shared secret(s) set
        either  through the command line option, or through the config file, or through
        the database table or Redis key/value pairs.  
<div class="Pp"></div>
</pre>
<dl class="Bl-tag">
  <dt class="It-tag">2)</dt>
  <dd class="It-tag">Usually WebRTC uses fingerprinting (<b>-f</b>).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">3)</dt>
  <dd class="It-tag"><b>-v</b> option may be nice to see the connected
    clients.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">4)</dt>
  <dd class="It-tag"><b>-X</b> is needed if you are running your TURN server
      behind a NAT.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">5)</dt>
  <dd class="It-tag"><b>--min-port</b> and <b>--max-port</b> may be needed if
      you want to limit the relay endpoints ports number range.</dd>
</dl>
<div class="Pp"></div>
===================================
<h1 class="Sh" title="Sh" id="TURN_REST_API"><a class="selflink" href="#TURN_REST_API">TURN
  REST API</a></h1>
In WebRTC, the browser obtains the TURN connection information from the web
  server. This information is a secure information - because it contains the
  necessary TURN credentials. As these credentials are transmitted over the
  public networks, we have a potential security breach.
<div class="Pp"></div>
If we have to transmit a valuable information over the public network, then this
  information has to have a limited lifetime. Then the guy who obtains this
  information without permission will be able to perform only limited damage.
<div class="Pp"></div>
This is how the idea of TURN REST API - time-limited TURN credentials -
  appeared. This security mechanism is based upon the long-term credentials
  mechanism. The main idea of the REST API is that the web server provides the
  credentials to the client, but those credentials can be used only limited time
  by an application that has to create a TURN server connection.
<div class="Pp"></div>
The &quot;classic&quot; long-term credentials mechanism (LTCM) is described
  here:
<div class="Pp"></div>
http://tools.ietf.org/html/rfc5389#section-10.2
<div class="Pp"></div>
http://tools.ietf.org/html/rfc5389#section-15.4
<div class="Pp"></div>
For authentication, each user must know two things: the username and the
  password. Optionally, the user must supply the ORIGIN value, so that the
  server can figure out the realm to be used for the user. The nonce and the
  realm values are supplied by the TURN server. But LTCM is not saying anything
  about the nature and about the persistence of the username and of the
  password; and this is used by the REST API.
<div class="Pp"></div>
In the TURN REST API, there is no persistent passwords for users. A user has
  just the username. The password is always temporary, and it is generated by
  the web server on-demand, when the user accesses the WebRTC page. And,
  actually, a temporary one-time session only, username is provided to the user,
  too.
<div class="Pp"></div>
The temporary user is generated as:
<div class="Pp"></div>
temporary-username=&quot;timestamp&quot; + &quot;:&quot; + &quot;username&quot;
<div class="Pp"></div>
where username is the persistent user name, and the timestamp format is just
  seconds sinse 1970 - the same value as <b>time</b>(NULL) function returns.
<div class="Pp"></div>
The temporary password is obtained as HMAC-SHA1 function over the temporary
  username, with shared secret as the HMAC key, and then the result is encoded:
<div class="Pp"></div>
temporary-password = <b>base64_encode</b>(hmac-sha1(shared-secret,
  temporary-username))
<div class="Pp"></div>
Both the TURN server and the web server know the same shared secret. How the
  shared secret is distributed among the involved entities is left to the WebRTC
  deployment details - this is beyond the scope of the TURN REST API.
<div class="Pp"></div>
So, a timestamp is used for the temporary password calculation, and this
  timestamp can be retrieved from the temporary username. This information is
  valuable, but only temporary, while the timestamp is not expired. Without
  knowledge of the shared secret, a new temporary password cannot be generated.
<div class="Pp"></div>
This is all formally described in Justin's Uberti TURN REST API document that
  can be obtained following the link &quot;TURN REST API&quot; in the <b>TURN
  Server</b> project's page https://github.com/coturn/coturn/.
<div class="Pp"></div>
Once the temporary username and password are obtained by the client (browser)
  application, then the rest is just 'classic&quot; long-term credentials
  mechanism. For developers, we are going to describe it step-by-step below:
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">a new TURN client sends a request command to the TURN
      server. Optionally, it adds the ORIGIN field to it.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">TURN server sees that this is a new client and the message
      is not authenticated.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">the TURN server generates a random nonce string, and return
      the error 401 to the client, with nonce and realm included. If the ORIGIN
      field was present in the client request, it may affect the realm value
      that the server chooses for the client.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">the client sees the 401 error and it extracts two values
      from the error response: the nonce and the realm.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">the client uses username, realm and password to produce a
      key:</dd>
</dl>
<div class="Pp"></div>
<pre>
         key = MD5(username &quot;:&quot; realm &quot;:&quot; SASLprep(password))
</pre>
(SASLprep is described here: http://tools.ietf.org/html/rfc4013)
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">the client forms a new request, adds username, realm and
      nonce to the request. Then, the client calculates and adds the integrity
      field to the request. This is the trickiest part of the process, and it is
      described in the end of section 15.4:
      http://tools.ietf.org/html/rfc5389#section-15.4</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">the client, optionally, adds the fingerprint field. This
      may be also a tricky procedure, described in section 15.5 of the same
      document. WebRTC usually uses fingerprinted TURN messages.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">the TURN server receives the request, reads the
    username.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">then the TURN server checks that the nonce and the realm in
      the request are the valid ones.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">then the TURN server calculates the key.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">then the TURN server calculates the integrity field.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">then the TURN server compares the calculated integrity
      field with the received one - they must be the same. If the integrity
      fields differ, then the request is rejected.</dd>
</dl>
</div>
<div class="Pp"></div>
In subsequent communications, the client may go with exactly the same sequence,
  but for optimization usually the client, having already information about
  realm and nonce, pre-calculates the integrity string for each request, so that
  the 401 error response becomes unnecessary. The TURN server may use &quot;
  <b>--stale-nonce</b>&quot; option for extra security: in some time, the nonce
  expires and the client will obtain 438 error response with the new nonce, and
  the client will have to start using the new nonce.
<div class="Pp"></div>
In subsequent communications, the sever and the client will always assume the
  same password - the original password becomes the session parameter and is
  never expiring. So the password is not changing while the session is valid and
  unexpired. So, if the session is properly maintained, it may go forever, even
  if the user password has been already changed (in the database). The session
  simply is using the old password. Once the session got disconnected, the
  client will have to use the new password to re-connect (if the password has
  been changed).
<div class="Pp"></div>
An example when a new shared secret is generated every hour by the TURN server
  box and then supplied to the web server, remotely, is provided in the script
  examples/scripts/restapi/shared_secret_maintainer.pl .
<div class="Pp"></div>
A very important thing is that the nonce must be totally random and it must be
  different for different clients and different sessions.
<div class="Pp"></div>
===================================
<h1 class="Sh" title="Sh" id="DATABASES"><a class="selflink" href="#DATABASES">DATABASES</a></h1>
For the user database, the <i>turnserver</i> has the following <i>options</i>:
<dl class="Bl-tag">
  <dt class="It-tag">1)</dt>
  <dd class="It-tag">Users can be set in the command line, with multiple
      <b>-u</b> or <b>--user</b> <i>options</i>. Obviously, only a few users can
      be set that way, and their credentials are fixed for the <i>turnserver</i>
      process lifetime.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">2)</dt>
  <dd class="It-tag">Users can be stored in SQLite DB. The default SQLite
      database file is /var/db/turndb or /usr/local/var/db/turndb or
      /var/lib/turn/turndb.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">3)</dt>
  <dd class="It-tag">Users can be stored in PostgreSQL database, if the
      <i>turnserver</i> was compiled with PostgreSQL support. Each time
      <i>turnserver</i> checks user credentials, it reads the database
      (asynchronously, of course, so that the current flow of packets is not
      delayed in any way), so any change in the database content is immediately
      visible by the <i>turnserver</i>. This is the way if you need the best
      scalability. The schema for the database can be found in schema.sql file.
      For long-term credentials, you have to set the &quot;keys&quot; for the
      users; the &quot;keys&quot; are generated by the <i>turnadmin</i> utility.
      For the key generation, you need username, password and the realm. All
      users in the database must use the same realm value; if down the road you
      will decide to change the realm name, then you will have to re-generate
      all user keys (that can be done in a batch script). See the file
      turndb/testsqldbsetup.sql as an example.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">4)</dt>
  <dd class="It-tag">The same is true for MySQL database. The same schema file
      is applicable. The same considerations are applicable.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">5)</dt>
  <dd class="It-tag">The same is true for the Redis database, but the Redis
      database has aa different schema - it can be found (in the form of
      explanation) in schema.userdb.redis. Also, in Redis you can store both
      &quot;keys&quot; and open passwords (for long term credentials) - the
      &quot;open password&quot; option is less secure but more convenient for
      low-security environments. See the file turndb/testredisdbsetup.sh as an
      example.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">6)</dt>
  <dd class="It-tag">If a database is used, then users can be divided into
      multiple independent realms. Each realm can be administered separately,
      and each realm can have its own set of users and its own performance
      <i>options</i> (max-bps, user-quota, total-quota).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">7)</dt>
  <dd class="It-tag">If you use MongoDB, the database will be setup for you
      automatically.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">8)</dt>
  <dd class="It-tag">Of course, the <i>turnserver</i> can be used in non-secure
      mode, when users are allowed to establish sessions anonymously. But in
      most cases (like WebRTC) that will not work.</dd>
</dl>
<div class="Pp"></div>
For the status and statistics database, there are two choices:
<dl class="Bl-tag">
  <dt class="It-tag">1)</dt>
  <dd class="It-tag">The simplest choice is not to use it. Do not set
      <b>--redis-statsdb</b> option, and this functionality will be simply
      ignored.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">2)</dt>
  <dd class="It-tag">If you choose to use it, then set the
      <b>--redis-statsdb</b> option. This may be the same database as in
      <b>--redis-userdb</b> option, or it may be a different database. You may
      want to use different database for security or convenience reasons. Also,
      you can use different database management systems for the user database
      and for the ststus and statistics database. For example, you can use MySQL
      as the user database, and you can use redis for the statistics. Or you can
      use Redis for both.</dd>
</dl>
<div class="Pp"></div>
So, we have 6 choices for the user management, and 2 choices for the statistics
  management. These two are totally independent. So, you have overall 6*2=12
  ways to handle persistent information, choose any for your convenience.
<div class="Pp"></div>
You do not have to handle the database information &quot;manually&quot; - the
  <i>turnadmin</i> program can handle everything for you. For PostgreSQL and
  MySQL you will just have to create an empty database with schema.sql SQL
  script. With Redis, you do not have to do even that - just run
  <i>turnadmin</i> and it will set the users for you (see the <i>turnadmin</i>
  manuals). If you are using SQLite, then the <i>turnserver</i> or
  <i>turnadmin</i> will initialize the empty database, for you, when started.
  The TURN server installation process creates an empty initialized SQLite
  database in the default location (/var/db/turndb or /usr/local/var/db/turndb
  or /var/lib/turn/turndb, depending on the system).
<div class="Pp"></div>
=================================
<h1 class="Sh" title="Sh" id="ALPN"><a class="selflink" href="#ALPN">ALPN</a></h1>
The server supports ALPNs &quot;stun.turn&quot; and
  &quot;stun.nat-discovery&quot;, when compiled with OpenSSL 1.0.2 or newer. If
  the server receives a TLS/DTLS ClientHello message that contains one or both
  of those ALPNs, then the server chooses the first stun.* label and sends it
  back (in the ServerHello) in the ALPN extension field. If no stun.* label is
  found, then the server does not include the ALPN information into the
  ServerHello.
<div class="Pp"></div>
=================================
<h1 class="Sh" title="Sh" id="LIBRARIES"><a class="selflink" href="#LIBRARIES">LIBRARIES</a></h1>
In the lib/ sub-directory the build process will create TURN client messaging
  library. In the include/ sub-directory, the necessary include files will be
  placed. The C++ wrapper for the messaging functionality is located in
  TurnMsgLib.h header. An example of C++ code can be found in stunclient.c file.
<div class="Pp"></div>
=================================
<h1 class="Sh" title="Sh" id="DOCS"><a class="selflink" href="#DOCS">DOCS</a></h1>
After installation, run the command:
<div class="Pp"></div>
$ man <i>turnserver</i>
<div class="Pp"></div>
or in the project root directory:
<div class="Pp"></div>
$ man <b>-M</b> man <i>turnserver</i>
<div class="Pp"></div>
to see the man page.
<div class="Pp"></div>
In the docs/html subdirectory of the original archive tree, you will find the
  client library reference. After the installation, it will be placed in
  PREFIX/share/doc/ <i>turnserver</i>/html.
<div class="Pp"></div>
=================================
<h1 class="Sh" title="Sh" id="LOGS"><a class="selflink" href="#LOGS">LOGS</a></h1>
When the <b>TURN Server</b> starts, it makes efforts to create a log file
  turn_&lt;pid&gt;.log in the following directories:
<div style="margin-left: 5.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">/var/log</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">/log/</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">/var/tmp</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">/tmp</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">current directory</dd>
</dl>
</div>
<div class="Pp"></div>
If all efforts failed (due to the system permission settings) then all log
  messages are sent only to the standard output of the process.
<div class="Pp"></div>
This behavior can be controlled by <b>--log-file</b>, <b>--syslog</b> and
  <b>--no-stdout-log</b> <i>options</i>.
<div class="Pp"></div>
=================================
<h1 class="Sh" title="Sh" id="HTTPS_MANAGEMENT_INTERFACE"><a class="selflink" href="#HTTPS_MANAGEMENT_INTERFACE">HTTPS
  MANAGEMENT INTERFACE</a></h1>
The <i>turnserver</i> process provides an HTTPS Web access as statistics and
  basic management interface. The <i>turnserver</i> listens to incoming HTTPS
  admin connections on the same ports as the main TURN/STUN listener. The Web
  admin pages are basic and self-explanatory.
<div class="Pp"></div>
To make the HTTPS interface active, the database table admin_user must be
  populated with the admin user <b>account</b>(s). An admin user can be a
  superuser (if not assigned to a particular realm) or a restricted user (if
  assigned to a realm). The restricted admin users can perform only limited
  actions, within their corresponding realms.
<div class="Pp"></div>
=================================
<h1 class="Sh" title="Sh" id="TELNET_CLI"><a class="selflink" href="#TELNET_CLI">TELNET
  CLI</a></h1>
The <i>turnserver</i> process provides a telnet CLI access as statistics and
  basic management interface. By default, the <i>turnserver</i> starts a telnet
  CLI listener on IP 127.0.0.1 and port 5766. That can be changed by the
  command-cline <i>options</i> of the <i>turnserver</i> process (see
  <b>--cli-ip</b> and <b>--cli-port</b> <i>options</i>). The full list of telnet
  CLI commands is provided in &quot;help&quot; command output in the telnet CLI.
<div class="Pp"></div>
=================================
<h1 class="Sh" title="Sh" id="CLUSTERS"><a class="selflink" href="#CLUSTERS">CLUSTERS</a></h1>
<b>TURN Server</b> can be a part of the cluster installation. But, to support
  the &quot;even port&quot; functionality (RTP/RTCP streams pairs) the client
  requests from a particular IP must be delivered to the same <b>TURN Server</b>
  instance, so it requires some networking setup massaging for the cluster. The
  reason is that the RTP and RTCP relaying endpoints must be allocated on the
  same relay IP. It would be possible to design a scheme with the
  application-level requests forwarding (and we may do that later) but it would
  affect the performance.
<div class="Pp"></div>
=================================
<h1 class="Sh" title="Sh" id="FILES"><a class="selflink" href="#FILES">FILES</a></h1>
/etc/turnserver.conf
<div class="Pp"></div>
/var/db/turndb
<div class="Pp"></div>
/usr/local/var/db/turndb
<div class="Pp"></div>
/var/lib/turn/turndb
<div class="Pp"></div>
/usr/local/etc/turnserver.conf
<div class="Pp"></div>
=================================
<h1 class="Sh" title="Sh" id="DIRECTORIES"><a class="selflink" href="#DIRECTORIES">DIRECTORIES</a></h1>
/usr/local/share/ <i>turnserver</i>
<div class="Pp"></div>
/usr/local/share/doc/ <i>turnserver</i>
<div class="Pp"></div>
/usr/local/share/examples/ <i>turnserver</i>
<div class="Pp"></div>
=================================
<h1 class="Sh" title="Sh" id="STANDARDS"><a class="selflink" href="#STANDARDS">STANDARDS</a></h1>
obsolete STUN RFC 3489
<div class="Pp"></div>
new STUN RFC 5389
<div class="Pp"></div>
TURN RFC 5766
<div class="Pp"></div>
TURN-TCP extension RFC 6062
<div class="Pp"></div>
TURN IPv6 extension RFC 6156
<div class="Pp"></div>
STUN/TURN test vectors RFC 5769
<div class="Pp"></div>
STUN NAT behavior discovery RFC 5780
<div class="Pp"></div>
=================================
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<i>turnadmin</i>, <i>turnutils</i>
<div class="Pp"></div>
======================================
<h2 class="Ss" title="Ss" id="WEB_RESOURCES"><a class="selflink" href="#WEB_RESOURCES">WEB
  RESOURCES</a></h2>
project page:
<div class="Pp"></div>
https://github.com/coturn/coturn/
<div class="Pp"></div>
Wiki page:
<div class="Pp"></div>
https://github.com/coturn/coturn/wiki
<div class="Pp"></div>
forum:
<div class="Pp"></div>
https://groups.google.com/forum/?fromgroups=#!forum/turn-server-project-rfc5766-turn-server
<div class="Pp"></div>
======================================
<h2 class="Ss" title="Ss" id="AUTHORS"><a class="selflink" href="#AUTHORS">AUTHORS</a></h2>
Oleg Moskalenko &lt;mom040267@gmail.com&gt;
<div class="Pp"></div>
Gabor Kovesdan http://kovesdan.org/
<div class="Pp"></div>
Daniel Pocock http://danielpocock.com/
<div class="Pp"></div>
John Selbie (jselbie@gmail.com)
<div class="Pp"></div>
Lee Sylvester &lt;lee@designrealm.co.uk&gt;
<div class="Pp"></div>
Erik Johnston &lt;erikj@openmarket.com&gt;
<div class="Pp"></div>
Roman Lisagor &lt;roman@demonware.net&gt;
<div class="Pp"></div>
Vladimir Tsanev &lt;tsachev@gmail.com&gt;
<div class="Pp"></div>
Po-sheng Lin &lt;personlin118@gmail.com&gt;
<div class="Pp"></div>
Peter Dunkley &lt;peter.dunkley@acision.com&gt;
<div class="Pp"></div>
Mutsutoshi Yoshimoto &lt;mutsutoshi.yoshimoto@mixi.co.jp&gt;
<div class="Pp"></div>
Federico Pinna &lt;fpinna@vivocha.com&gt;
<div class="Pp"></div>
Bradley T. Hughes &lt;bradleythughes@fastmail.fm&gt;
<div class="Pp"></div>
Mihaly Meszaros &lt;bakfitty@gmail.com&gt;</div>
<table class="foot">
  <tr>
    <td class="foot-date">25 September 2016</td>
    <td class="foot-os"></td>
  </tr>
</table>
</body>
</html>
