<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>BLHC(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">BLHC(1)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">BLHC(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
blhc - build log hardening check, checks build logs for missing hardening flags
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<b>blhc</b> [<i>options</i>] <i>&lt;dpkg-buildpackage build log file&gt;..</i>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
blhc is a small tool which checks build logs for missing hardening flags. It's
  licensed under the GPL 3 or later.
<div class="Pp"></div>
It's designed to check build logs generated by Debian's dpkg-buildpackage (or
  tools using dpkg-buildpackage like pbuilder or sbuild (which is used for the
  official buildd build logs)) to help maintainers detect missing hardening
  flags in their packages.
<div class="Pp"></div>
Only gcc is detected as compiler at the moment. If other compilers support
  hardening flags as well, please report them.
<div class="Pp"></div>
If there's no output, no flags are missing and the build log is fine.
<div class="Pp"></div>
See <i>README</i> for details about performed checks, auto-detection and
  limitations.
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--all</b></dt>
  <dd class="It-tag">Force check for all +all (+pie, +bindnow) hardening flags.
      By default it's auto detected.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--arch</b> <i>architecture</i></dt>
  <dd class="It-tag">Set the specific architecture (e.g. amd64, armel, etc.),
      automatically disables hardening flags not available on this architecture.
      Is detected automatically if dpkg-buildpackage is used.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--bindnow</b></dt>
  <dd class="It-tag">Force check for all +bindnow hardening flags. By default
      it's auto detected.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--buildd</b></dt>
  <dd class="It-tag">Special mode for buildds when automatically parsing log
      files. The following changes are in effect:</dd>
</dl>
<div style="margin-left: 8.00ex;">
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Print tags instead of normal warnings, see &quot;BUILDD
      TAGS&quot; for a list of possible tags.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Don't check hardening flags in old log files (if dpkg-dev
      &lt;&lt; 1.16.1 is detected).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Don't require Term::ANSIColor.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">Return exit code 0, unless there was a error (-I, -W
      messages don't count as error).</dd>
</dl>
</div>
<div style="margin-left: 8.00ex;"></div>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--color</b></dt>
  <dd class="It-tag">Use colored (ANSI) output for warning messages.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ignore-arch</b> <i>arch</i></dt>
  <dd class="It-tag">Ignore build logs from architectures matching <i>arch</i>.
      <i>arch</i> is a string.
    <div style="height: 1.00em;">&#x00A0;</div>
    Used to prevent false positives. This option can be specified multiple
      times.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ignore-arch-flag</b> <i>arch</i>:<i>flag</i></dt>
  <dd class="It-tag">Like <b>--ignore-flag</b>, but only ignore flag on
      <i>arch</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ignore-arch-line</b> <i>arch</i>:<i>line</i></dt>
  <dd class="It-tag">Like <b>--ignore-line</b>, but only ignore line on
      <i>arch</i>.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ignore-flag</b> <i>flag</i></dt>
  <dd class="It-tag">Don't print an error when the specific flag is missing in a
      compiler line. <i>flag</i> is a string.
    <div style="height: 1.00em;">&#x00A0;</div>
    Used to prevent false positives. This option can be specified multiple
      times.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--ignore-line</b> <i>regex</i></dt>
  <dd class="It-tag">Ignore lines matching the given Perl regex. <i>regex</i> is
      automatically anchored at the beginning and end of the line to prevent
      false negatives.
    <div style="height: 1.00em;">&#x00A0;</div>
     <b>NOTE</b>: Not the input lines are checked, but the lines which are
      displayed in warnings (which have line continuation resolved).
    <div style="height: 1.00em;">&#x00A0;</div>
    Used to prevent false positives. This option can be specified multiple
      times.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--pie</b></dt>
  <dd class="It-tag">Force check for all +pie hardening flags. By default it's
      auto detected.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-h -? --help</b></dt>
  <dd class="It-tag">Print available options.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--version</b></dt>
  <dd class="It-tag">Print version number and license.</dd>
</dl>
<div class="Pp"></div>
Auto detection for <b>--pie</b> and <b>--bindnow</b> only works if at least one
  command uses the required hardening flag (e.g. -fPIE). Then it's required for
  all other commands as well.
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
Normal usage, parse a single log file.
<div class="Pp"></div>
<pre>
    blhc path/to/log/file
</pre>
<div class="Pp"></div>
If there's no output, no flags are missing and the build log is fine.
<div class="Pp"></div>
Parse multiple log files. The exit code is ORed over all files.
<div class="Pp"></div>
<pre>
    blhc path/to/directory/with/log/files/*
</pre>
<div class="Pp"></div>
Don't treat missing &quot;-g&quot; as error:
<div class="Pp"></div>
<pre>
    blhc --ignore-flag -g path/to/log/file
</pre>
<div class="Pp"></div>
Don't treat missing &quot;-pie&quot; on kfreebsd-amd64 as error:
<div class="Pp"></div>
<pre>
    blhc --ignore-arch-flag kfreebsd-amd64:-pie path/to/log/file
</pre>
<div class="Pp"></div>
Ignore lines consisting exactly of &quot;./script gcc file&quot; which would
  cause a false positive.
<div class="Pp"></div>
<pre>
    blhc --ignore-line '\./script gcc file' path/to/log/file
</pre>
<div class="Pp"></div>
Ignore lines matching &quot;./script gcc file&quot; somewhere in the line.
<div class="Pp"></div>
<pre>
    blhc --ignore-line '.*\./script gcc file.*' path/to/log/file
</pre>
<div class="Pp"></div>
Use blhc with pbuilder.
<div class="Pp"></div>
<pre>
    pbuilder path/to/package.dsc | tee path/log/file
    blhc path/to/file || echo flags missing
</pre>
<h1 class="Sh" title="Sh" id="BUILDD_TAGS"><a class="selflink" href="#BUILDD_TAGS">BUILDD
  TAGS</a></h1>
The following tags are used in <i>--buildd</i> mode. In braces the additional
  data which is displayed.
<dl class="Bl-tag">
  <dt class="It-tag"><b>I-hardening-wrapper-used</b></dt>
  <dd class="It-tag">The package uses hardening-wrapper which intercepts calls
      to gcc and adds hardening flags. The build log doesn't contain any
      hardening flags and thus can't be checked by blhc.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>W-compiler-flags-hidden</b> (summary of hidden
    lines)</dt>
  <dd class="It-tag">Build log contains lines which hide the real compiler
      flags. For example:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
    CC test-a.c
    CC test-b.c
    CC test-c.c
    LD test
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    Most of the time either &quot;export V=1&quot; or &quot;export
      verbose=1&quot; in <i>debian/rules</i> fixes builds with hidden compiler
      flags. Sometimes &quot;.SILENT&quot; in a <i>Makefile</i> must be removed.
      And as last resort the <i>Makefile</i> must be patched to remove the
      &quot;@&quot;s hiding the real compiler commands.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>W-dpkg-buildflags-missing</b> (summary of missing
    flags)</dt>
  <dd class="It-tag">CPPFLAGS, CFLAGS, CXXFLAGS, LDFLAGS missing.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>I-invalid-cmake-used</b> (version)</dt>
  <dd class="It-tag">By default CMake ignores CPPFLAGS thus missing those
      hardening flags. Debian patched CMake in versions 2.8.7-1 and 2.8.7-2 to
      respect CPPFLAGS, but this patch was rejected by upstream and later
      reverted in Debian. Thus those two versions show correct usage of CPPFLAGS
      even if the package doesn't correctly handle them (for example by passing
      them to CFLAGS). To prevent false negatives just blacklist those two
      versions.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>I-no-compiler-commands</b></dt>
  <dd class="It-tag">No compiler commands were detected. Either the log contains
      none or they were not correctly detected by blhc (please report the bug in
      this case).</dd>
</dl>
<h1 class="Sh" title="Sh" id="EXIT_STATUS"><a class="selflink" href="#EXIT_STATUS">EXIT
  STATUS</a></h1>
The exit status is a &quot;bit mask&quot;, each listed status is ORed when the
  error condition occurs to get the result.
<dl class="Bl-tag">
  <dt class="It-tag"><b>0</b></dt>
  <dd class="It-tag">Success.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>1</b></dt>
  <dd class="It-tag">No compiler commands were found.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>2</b></dt>
  <dd class="It-tag">Invalid arguments/options given to blhc.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>4</b></dt>
  <dd class="It-tag">Non verbose build.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>8</b></dt>
  <dd class="It-tag">Missing hardening flags.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>16</b></dt>
  <dd class="It-tag">Hardening wrapper detected, no tests performed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>32</b></dt>
  <dd class="It-tag">Invalid CMake version used. See <b>I-invalid-cmake-used</b>
      under &quot;BUILDD TAGS&quot; for a detailed explanation.</dd>
</dl>
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Simon Ruderich, &lt;simon@ruderich.org&gt;
<div class="Pp"></div>
Thanks to to Bernhard R. Link &lt;brlink@debian.org&gt; and Jaria Alto
  &lt;jari.aalto@cante.net&gt; for their valuable input and suggestions.
<h1 class="Sh" title="Sh" id="LICENSE_AND_COPYRIGHT"><a class="selflink" href="#LICENSE_AND_COPYRIGHT">LICENSE
  AND COPYRIGHT</a></h1>
Copyright (C) 2012-2016 by Simon Ruderich
<div class="Pp"></div>
This program is free software: you can redistribute it and/or modify it under
  the terms of the GNU General Public License as published by the Free Software
  Foundation, either version 3 of the License, or (at your option) any later
  version.
<div class="Pp"></div>
This program is distributed in the hope that it will be useful, but WITHOUT ANY
  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
  A PARTICULAR PURPOSE. See the GNU General Public License for more details.
<div class="Pp"></div>
You should have received a copy of the GNU General Public License along with
  this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<i>hardening-check</i>(1), <i>dpkg-buildflags</i>(1)</div>
<table class="foot">
  <tr>
    <td class="foot-date">2017-01-08</td>
    <td class="foot-os">perl v5.24.1</td>
  </tr>
</table>
</body>
</html>
