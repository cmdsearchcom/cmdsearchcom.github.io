<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>DACSAUTH(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">DACSAUTH(1)</td>
    <td class="head-vol">DACS Commands Manual</td>
    <td class="head-rtitle">DACSAUTH(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
dacsauth - authentication check
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<div class="Pp" style="margin-left: 9.00ex; text-indent: -9.00ex;"><b>dacsauth</b>
  [ <b>-m&#x00A0;</b><b></b><i>auth-module-spec</i>] [...]
  [<b>-r&#x00A0;</b><b></b> <i>roles-module-spec</i>] [...]
  [<b>-D</b><b></b><i>directive</i> <b>=</b><b></b><i>value</i>] [<b>-aux</b>]
<div>&#x00A0;</div>
[ <b>-fj&#x00A0;</b><b></b><i>jurname</i>]
  [<b>-fn&#x00A0;</b><b></b><i>fedname</i>] [ <b>-h</b> | <b>-help</b>]
  [<b>-id</b>] [ <b>-ll&#x00A0;</b><b></b><i>log_level</i>]
  [<b>-p&#x00A0;</b><b></b><i>password</i>]
<div>&#x00A0;</div>
[ <b>-pf&#x00A0;</b><b></b><i>file</i>] [<b>-prompt</b>]
  [<b>-promptwith&#x00A0;</b> <b></b><i>prompt</i>] [<b>-q</b>]
  [{<b>-u</b>&#x00A0;|&#x00A0; <b>-user</b>}&#x00A0;<i>username</i>]
  [<b>-v</b>]</div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 9.00ex; text-indent: -9.00ex;"><b>dacsauth</b>
  <b>-modules</b></div>
<div class="Pp"></div>
<div class="Pp" style="margin-left: 9.00ex; text-indent: -9.00ex;"><b>dacsauth</b>
  <b>--version</b></div>
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
This program is part of the <b>DACS</b> suite.
<div class="Pp"></div>
The <b>dacsauth</b> utility tests whether given authentication material
  satisfies authentication requirements and indicates the outcome through the
  process's exit status. It is similar to <b>dacs_authenticate(8)</b>[1] and
  <b>dacscred(1)</b>[2].
<div class="Pp"></div>
<b>dacsauth</b> provides a way for scripts and other programs to leverage the
  <b>DACS</b> authentication infrastructure. They might use successful
  authentication as a coarse form of authorization; only a user that provides a
  correct password might be allowed to run the program, for instance. Or they
  might return some type of credentials after successful authentication, or
  perhaps use <b>dacs_auth_agent(8)</b>[3] to return <b>DACS</b> credentials.
<div class="Pp"></div>
<b>dacsauth</b> can also be used to retrieve role information associated with a
  given user.
<div class="Pp"></div>
<b>dacsauth</b> does not read any <b>DACS</b> configuration files. Everything
  needed to perform the test must be specified as an argument.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>Tip</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
<div class="Pp"></div>
If <b>dacsauth</b> uses a built-in module to perform authentication, or look up
  roles, <i>no server component is required</i>. This means that you can use
  <b>dacsauth</b> without having to access or even configure a web server,
  including Apache.
<div style="height: 0.50em;">&#x00A0;</div>
</div>
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
The following command line flags are recognized. At least one <b>-m</b> flag (to
  perform authentication testing), or at least one <b>-r</b> flag must be
  specified (to form a role descriptor string for the identity and print it to
  stdout). A combination of both flags is allowed, in which case a role
  descriptor string is output only if the authentication test is successful.
<div class="Pp"></div>
<b>-D</b><b></b><i>directive</i><b>=</b><b></b><i>value</i>
<div style="margin-left: 4.00ex;">This is equivalent to setting
  <i>directive</i>, a general <b>DACS</b> configuration directive, to
  <i>value</i>. See <b>dacs.conf(5)</b>[4].</div>
<div class="Pp"></div>
<b>-aux</b>
<div style="margin-left: 4.00ex;">The next string provided by the <b>-p</b>,
  <b>-pf</b>, <b>-prompt</b>, or <b>-promptwith</b> flag will be the value of
  the <i>AUXILIARY</i> authentication argument. This provides a secure way to
  pass sensitive auxiliary information, such as a PIN, to the program. A flag to
  obtain the password, if any, must precede this flag on the command line.</div>
<div class="Pp"></div>
<b>-fj</b> <i>jurname</i>
<div style="margin-left: 4.00ex;">Use <i>jurname</i>, which must be
  syntactically valid, as the jurisdiction name. If required but not provided, a
  value derived from the host's domain name will be used.</div>
<div class="Pp"></div>
<b>-fn</b> <i>fedname</i>
<div style="margin-left: 4.00ex;">Use <i>fedname</i>, which must be
  syntactically valid, as the federation name. If required but not provided, a
  value derived from the host's domain name will be used.</div>
<div class="Pp"></div>
<b>-h</b>
<div>&#x00A0;</div>
<b>-help</b>
<div style="margin-left: 4.00ex;">Display a help message and exit.</div>
<div class="Pp"></div>
<b>-id</b>
<div style="margin-left: 4.00ex;">If successful, print the authenticated
  <b>DACS</b> identity to the standard output.</div>
<div class="Pp"></div>
<b>-ll</b> <i>log_level</i>
<div style="margin-left: 4.00ex;">Set the debugging output level to
  <i>log_level</i> (see <b>dacs(1)</b>[5]). The default level is warn.</div>
<div class="Pp"></div>
<b>-m</b> <i>auth-module-spec</i>
<div style="margin-left: 4.00ex;">Each type of authentication test that is
  required is described by an <i>auth-module-spec</i> that immediately follows
  the <b>-m</b> flag. Each <i>auth-module-spec</i> is essentially an alternate
  representation of an <b>Auth clause</b>[6] and its directives, which are used
  by <b>dacs_authenticate(8)</b>[1]. Just as the order in which Auth clauses
  appear in a <b>DACS</b> configuration file, the order in which the <b>-m</b>
  flags appear may be significant, depending on the <i>control</i> keywords.
  During processing, successive <b>-m</b> components are automatically assigned
  names, auth_module_1, auth_module_2, and so on, mainly for error reporting
  purposes.
<div style="height: 1.00em;">&#x00A0;</div>
An <i>auth-module-spec</i> has the following syntax:
<div class="Pp"></div>
<div class="Pp" style="margin-left: 1.00ex; text-indent: -1.00ex;">
<div style="height: 1.00em;">&#x00A0;</div>
The <i>module</i> begins with either the name of a built-in module, or a valid
  abbreviation thereof, or the (absolute) URL of an external authentication
  module (equivalent to the <b>URL</b>[7] directive). Next must appear a
  recognized authentication style keyword specifier (equivalent to the
  <b>STYLE</b>[8] directive). Next, the <i>control</i> keyword follows, which is
  identical to the <b>CONTROL</b>[9] directive in the Auth clause. After the
  <i>control</i> keyword, the flags described below may follow, in any order.
<div style="height: 1.00em;">&#x00A0;</div>
An <i>auth-module-spec</i> ends when the first invalid flag (or the end of
  flags) is encountered.
<div style="height: 1.00em;">&#x00A0;</div>
The <b>-O</b> flag is equivalent to an <b>OPTION</b>[10] directive.
<div style="height: 1.00em;">&#x00A0;</div>
The <b>-Of</b> flag is followed by the name of a file from which to read
  options, one per line, in the format <i>name</i>=<i>value</i>. Blank lines and
  lines beginning with a '#' are ignored. These lines do not begin with
  &quot;-O&quot; and quotes are simply copied and not interpreted. A line can be
  continued by ending it with a backslash. The <b>-Of</b> flag can be used to
  avoid putting passwords on the command line and makes it easier to write
  expressions that would otherwise have to be carefully escaped to prevent
  interpretation by the shell.
<div style="height: 1.00em;">&#x00A0;</div>
The <b>-expr</b> flag is equivalent to the <b>EXPR</b>[11] directive. The
  <b>-vfs</b> flag is used to configure <b>VFS</b>[12] directives required by
  this module.</div>
</div>
<div class="Pp"></div>
<b>-modules</b>
<div style="margin-left: 4.00ex;">Display a list of built-in authentication
  modules and roles modules, one per line, and then exit. The canonical module
  name is printed, followed by zero or more equivalent abbreviations. For
  authentication modules, the authentication style is shown. To list the
  available modules, run the command:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
% dacsauth -modules
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
The set of available (enabled) built-in authentication and roles modules is
  determined when <b>DACS</b> is built.</div>
<div class="Pp"></div>
<b>-p </b><b></b><i>password</i>
<div style="margin-left: 4.00ex;">Specify the password to use (equivalent to the
  <i>PASSWORD</i> argument to <b>dacs_authenticate</b>).
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>Security</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
A password given on the command line may be visible to other users on the same
  system.
<div style="height: 0.50em;">&#x00A0;</div>
</div>
</div>
<div class="Pp"></div>
<b>-pf </b><b></b><i>file</i>
<div style="margin-left: 4.00ex;">Read the password to use from <i>file</i>
  (equivalent to the <i>PASSWORD</i> argument to <b>dacs_authenticate</b>). If
  <i>file</i> is &quot;-&quot;, then the password is read from the standard
  input without prompting.</div>
<div class="Pp"></div>
<b>-prompt</b>
<div style="margin-left: 4.00ex;">Prompt for the password and read it from stdin
  (equivalent to the <i>PASSWORD</i> argument to <b>dacs_authenticate</b>). The
  password is not echoed.</div>
<div class="Pp"></div>
<b>-promptwith </b><b></b><i>prompt</i>
<div style="margin-left: 4.00ex;">Prompt for the password using the given string
  ( <i>prompt</i>) and read it from stdin (equivalent to the <i>PASSWORD</i>
  argument to <b>dacs_authenticate</b>). The password is not echoed.</div>
<div class="Pp"></div>
<b>-q</b>
<div style="margin-left: 4.00ex;">Be more quiet by reducing the debugging output
  level.</div>
<div class="Pp"></div>
<b>-r</b> <i>role-module-spec</i>
<div style="margin-left: 4.00ex;">Roles for <i>username</i> can be determined by
  giving this flag, which is immediately followed by a <i>roles-module-spec</i>.
  The <b>-r</b> flag may be repeated, and the resulting roles are combined. Each
  <i>roles-module-spec</i> is essentially an alternate representation of a Roles
  clause that is used by <b>dacs_authenticate(8)</b>[13]. Successive <b>-r</b>
  components are assigned names, roles_module_1, roles_module_2, and so on,
  mainly for error reporting purposes.
<div style="height: 1.00em;">&#x00A0;</div>
A <i>roles-module-spec</i> has the following syntax:
<div class="Pp"></div>
<div class="Pp" style="margin-left: 1.00ex; text-indent: -1.00ex;">The
  <i>module</i> component is equivalent to the Roles clause's <b>URL</b>[14]
  directive and is either the name of an available built-in roles module, a
  valid abbreviation thereof, or the (absolute) URL of an external roles module.
<div style="height: 1.00em;">&#x00A0;</div>
Flags may follow the <i>module</i> component, in any order. A
  <i>roles-module-spec</i> ends when the first invalid flag (or the end of
  flags) is encountered.
<div style="height: 1.00em;">&#x00A0;</div>
The <b>-O</b> flag is equivalent to an <b>OPTION</b>[10] directive.
<div style="height: 1.00em;">&#x00A0;</div>
The <b>-Of</b> flag is followed by an argument that is the name of a file from
  which to read options, one per line, in the format <i>name</i>=<i>value</i>.
  Blank lines and lines beginning with a '#' are ignored; note that these lines
  do not begin with &quot;-O&quot; and quotes are simply copied and not
  interpreted. The <b>-Of</b> flag can be used to avoid putting passwords on the
  command line and makes it easier to write expressions that would otherwise
  have to be carefully escaped to prevent interpretation by the shell, for
  example.
<div style="height: 1.00em;">&#x00A0;</div>
The <b>-expr</b> flag is equivalent to the <b>EXPR</b>[11] directive. The
  <b>-vfs</b> flag is used to configure <b>VFS</b>[12] directives required by
  <i>module</i>.</div>
</div>
<div class="Pp"></div>
<b>-u </b><b></b><i>username</i>
<div>&#x00A0;</div>
<b>-user </b><b></b><i>username</i>
<div style="margin-left: 4.00ex;">The username to authenticate against
  (equivalent to the <i>USERNAME</i> argument to <b>dacs_authenticate</b>). This
  username is implicitly associated with the effective federation and
  jurisdiction (see the <b>-fn</b>[15] and <b>-fj</b>[16] flags).</div>
<div class="Pp"></div>
<b>-v</b>
<div style="margin-left: 4.00ex;">The <b>-v</b> flag bumps the debugging output
  level to debug or (if repeated) trace.</div>
<div class="Pp"></div>
<b>--version</b>
<div style="margin-left: 4.00ex;">Display the program's version information and
  then exit.</div>
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="selflink" href="#EXAMPLES">EXAMPLES</a></h1>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>Security</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
<div class="Pp"></div>
If <b>dacsauth</b> uses a built-in module to perform authentication, it must run
  setuid or setgid to obtain sufficient privileges to access the required
  password file (the same is true for built-in roles modules). If it uses an
  external module, that module will need to execute with sufficient privileges
  to access <b>DACS</b> cryptographic keys, specifically federation_keys and
  possibly <b>DACS</b> or system password files; the external module will then
  need to execute with sufficient privileges to access any files it requires.
<div class="Pp"></div>
Be sure to use the federation_keys that are correct for your federation.
  Referencing authentication modules in two or more federations will probably
  not work.
<div class="Pp"></div>
<b>dacsauth</b> should therefore not ordinarily run as the UID of the user that
  invokes it (unless that happens to be root) because it will not be able to
  access the information it requires. This will also prevent a user from
  &quot;cheating&quot; (e.g., by attaching to the running module with a
  debugger).
<div style="height: 0.50em;">&#x00A0;</div>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>Note</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
<div class="Pp"></div>
Examples in this section that involve NTLM and LDAP were tested against Windows
  Server 2012. Names and URLs will likely be different on your system. Refer to
  the descriptions of <b>local_ldap_authenticate</b>[17] and
  <b>local_ldap_roles</b>[18] for additional information.
<div style="height: 0.50em;">&#x00A0;</div>
</div>
<div class="Pp"></div>
This example authenticates user &quot;bobo&quot; with password &quot;test&quot;
  against the <b>DACS</b> password file /usr/local/dacs/conf/passwd:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
% dacsauth -m passwd passwd required
  -vfs &quot;[passwds]dacs-kwv-fs:/usr/local/dacs/conf/passwd&quot; -q -u bobo -p test
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
If the command's exit status is zero, the authentication test succeeded,
  otherwise it failed.
<div class="Pp"></div>
The following example attempts to authenticate &quot;bobo&quot; against her Unix
  password file. The program prompts for the password. It will probably need to
  be run as root.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
% sudo dacsauth -m unix passwd required -u bobo -prompt
</pre>
</div>
<div class="Pp"></div>
In the next example, <b>dacsauth</b> attempts to authenticate &quot;bobo&quot;
  via NTLM on winders.example.com:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
% dacsauth -m ntlm passwd suff -OSAMBA_SERVER=&quot;winders.example.com&quot; \
    -prompt -u bobo
</pre>
</div>
<div class="Pp"></div>
This example is similar to the previous one, except that an external
  authentication module is used and the password is read from a file. Because of
  the external module, additional configuration must be provided; in particular,
  the location of federation_keys and the federation and jurisdiction names must
  be specified.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
% dacsauth -m https://example.example.com/cgi-bin/dacs/local_ntlm_authenticate \
   passwd sufficient -OSAMBA_SERVER=&quot;winders.example.com&quot; \
  -fn EXAMPLE -fj FEDROOT -u bobo -pf mypass \
  -DVFS=&quot;[federation_keys]dacs-fs:/usr/local/dacs/federations/example/federation_keys&quot;
</pre>
</div>
<div class="Pp"></div>
To authenticate against the <b>Google</b>[19] account nobody@gmail.com, one
  might use:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
% dacsauth -m http passwd suff \
  -OAUTH_URL=&quot;https://www.google.com/accounts/ClientLogin&quot; \
  -OUSERNAME_PARAMETER=Email -OPASSWORD_PARAMETER=Passwd \
  -Oservice=xapi -Osource=DSS-DACS-1.4 -prompt -u nobody@gmail.com
</pre>
</div>
<div class="Pp"></div>
In the following example, an expression is evaluated to determine whether
  authentication should succeed. The user (&quot;bobo&quot;) is prompted for a
  password. Only if the string &quot;foo&quot; is given will authentication
  succeed. A more realistic example might call another program to help make the
  determination, for instance.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
% dacsauth -m expr expr suffi \
 -expr '${Args::PASSWORD} eq &quot;foo&quot; ? ${Args::USERNAME} : &quot;&quot;' \
    -user bobo -prompt
</pre>
</div>
<div class="Pp"></div>
Authentication against an Apache <b>htdigest</b> password file is performed in
  the following example, where the password is read from stdin:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
% echo &quot;test&quot; | dacsauth -m apache digest sufficient \
  -OAUTH_MODULE=mod_auth_digest \
  -OAUTH_FILE=/usr/local/apache2/conf/passwords.digest \
  -OAUTH_REALM=&quot;DACS Digest Auth Area&quot; \
  -u bobo -pf -
</pre>
</div>
<div class="Pp"></div>
Authentication via the PAM module works differently than the other modules - and
  is more complicated to use - because <b>dacsauth</b> may need to be run
  several times, depending on what information PAM requires. Instead of
  returning a yes/no decision, <b>dacsauth</b> may print prompts for more
  information to stdout. Please review the operational details presented in
  <b>dacs_authenticate(8)</b>[20] and <b>pamd(8)</b>[21] before attempting to
  use this module.
<div class="Pp"></div>
The following example demonstrates use of the module from the command line. Once
  the basic ideas are understood, it should be apparent how to write a script to
  performed the necessary iterations. Details in the example, such as paths, may
  need to be adjusted for your environment. Note that in this example the
  username is not specified the first time <b>dacsauth</b> is run, although it
  could be if it were known.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
% dacsauth -m pam prompted suffic \
 -vfs &quot;[federation_keys]dacs-fs:/usr/local/dacs/federations/dss/federation_keys&quot; \
 -OPAMD_HOST=localhost -OPAMD_PORT=dacs-pamd -fj EXAMPLE -fn TEST
AUTH_PROMPT_VAR1=&quot;Login:&quot;
AUTH_TRANSID=&quot;10.0.0.124:57849:85748:9997c5588a6239e3&quot;
% dacsauth -m pam prompted suffic \
 -vfs &quot;[federation_keys]dacs-fs:/usr/local/dacs/federations/dss/federation_keys&quot; \
 -OAUTH_PROMPT_VAR1=&quot;bobo&quot; \
 -OAUTH_TRANSID=&quot;10.0.0.124:57849:85748:9997c5588a6239e3&quot;-fj EXAMPLE -fn TEST
AUTH_PROMPT_VAR2=&quot;Password:&quot;
AUTH_TRANSID=&quot;10.0.0.124:52188:88417:5ffb0015f21ea546&quot;
% dacsauth -m pam prompted suffic \
 -vfs &quot;[federation_keys]dacs-fs:/usr/local/dacs/federations/dss/federation_keys&quot; \
 -OAUTH_PROMPT_VAR2=&quot;apassword&quot; \
 -OAUTH_TRANSID=&quot;10.0.0.124:57849:85748:9997c5588a6239e3&quot;-fj EXAMPLE -fn TEST
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
The first time <b>dacsauth</b> is run in the example it returns a prompt for the
  username (&quot;Login:&quot;) that is associated with the transaction variable
  <i>AUTH_PROMPT_VAR1</i> and a transaction identifier ( <i>AUTH_TRANSID</i>).
  The latter must be passed to the subsequent executions of <b>dacsauth</b>. The
  second run of <b>dacsauth</b> passes the username (&quot;bobo&quot;) and
  returns another prompt (&quot;Password:&quot;) that is associated with the
  transaction variable <i>AUTH_PROMPT_VAR2</i>. The third run passes the
  password (&quot;apassword&quot;) but no prompt is returned, indicating that
  the session is complete and the program's exit status reflects the outcome of
  authentication.
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<div>&#x00A0;</div>
<b>Tip</b>
<div>&#x00A0;</div>
<div>&#x00A0;</div>
<div class="Pp"></div>
Whether <b>dacsauth</b> requires a password to retrieve roles depends on the
  particular roles module being used. For example, a password is not required by
  <b>local_unix_roles</b>[22] or <b>local_roles</b>[23] to obtain roles, but
  <b>local_ldap_roles</b>[18] will probably need a password to bind to the
  directory and obtain roles.
<div style="height: 0.50em;">&#x00A0;</div>
</div>
<div class="Pp"></div>
This example prints the role string for user &quot;bobo&quot; by calling the
  built-in <b>local_unix_roles</b>[22] module:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
% dacsauth -r unix -u bobo
bobo,wheel,www,users
</pre>
</div>
<div class="Pp"></div>
The next example is similar to the previous one, except an external roles module
  is used:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
% dacsauth -r https://example.example.com/cgi-bin/dacs/local_unix_roles \
  -DVFS=&quot;[federation_keys]dacs-fs:/usr/local/dacs/federations/federation_keys&quot; \
  -fn EXAMPLE -u bobo
bobo,wheel,www,users
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
The external roles module might be executed on a different host than the one
  running <b>dacsauth</b>. Provided <b>dacsauth</b> has been installed and a
  matching federation_keys file is available on the local host, the local host
  need not be a <b>DACS</b> jurisdiction or have any other <b>DACS</b>
  configuration.
<div class="Pp"></div>
The following example prints the <b>role string</b>[24] for user
  &quot;bobo&quot; (sAMAccountName), known within the directory by the Common
  Name &quot;Bobo Baggins&quot;, using the (external)
  <b>local_ldap_roles</b>[18] module and the &quot;direct&quot; binding method:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
% dacsauth -r https://example.example.com/cgi-bin/dacs/local_ldap_roles \
    -Of /usr/local/dacs/ldap_roles_options_direct -u &quot;bobo&quot; \
    -DVFS=&quot;[federation_keys]dacs-fs:/usr/local/dacs/federations/federation_keys&quot; \
     -fn EXAMPLE -fj FEDROOT -prompt
Password?
RA_AllowMediaAccess,WSSUsers,RA_AllowHomePageLinks,RA_AllowAddInAccess,RA_AllowComputerAccess,RA_AllowRemoteAccess
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
Because there would be a lot of flags to place on the command line, the options
  that are needed in this example are instead read from a file that is specified
  using the <b>-Of</b> flag. This is also a more secure way to pass passwords to
  the program. Ensure that access to the file is restricted appropriately. In
  this example, the file /usr/local/dacs/ldap_roles_options_direct might contain
  configuration such as this:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
LDAP_BIND_METHOD=direct
LDAP_USERNAME_URL*=&quot;ldap://example.com/cn=&quot; . encode(url, ${Args::DACS_USERNAME}) . &quot;,cn=Users,dc=Example,dc=local&quot;
LDAP_USERNAME_EXPR*=&quot;${LDAP::sAMAccountName}&quot;
<div class="Pp"></div>
LDAP_ROLES_SELECTOR*=&quot;${LDAP::attrname}&quot; eq &quot;memberOf&quot; ? strtr(ldap(rdn_attrvalue, \
    ldap(dn_index, &quot;${LDAP::attrvalue}&quot;, 1)), &quot; &quot;, &quot;_&quot;) : &quot;&quot;
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
Notice that in this context the variable that denotes an authenticated username
  is referenced ( <i>${Args::DACS_USERNAME}</i>) rather than the variable that
  denotes a purported username ( <i>${Args::USERNAME}</i>).
<div class="Pp"></div>
The following example is like the previous one, except that it uses the
  &quot;indirect&quot; binding method and therefore is not given the specific
  URL for the user:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
% dacsauth -r https://example.example.com/cgi-bin/dacs/local_ldap_roles \
    -Of /usr/local/dacs/ldap_roles_options_indirect -u bobo \
    -DVFS=&quot;[federation_keys]dacs-fs:/usr/local/dacs/federations/federation_keys&quot; \
     -fn EXAMPLE -fj FEDROOT -p bobospassword
RA_AllowMediaAccess,WSSUsers,RA_AllowHomePageLinks,RA_AllowAddInAccess,RA_AllowComputerAccess,RA_AllowRemoteAccess
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
The file /usr/local/dacs/ldap_roles_options_indirect might contain configuration
  similar to this:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
LDAP_BIND_METHOD=indirect
LDAP_ADMIN_URL=ldap://example.com/cn=admin,cn=Users,dc=Example,dc=local
LDAP_ADMIN_PASSWORD=thESecreTAdmiNPassworD
<div class="Pp"></div>
# Search under Users...
LDAP_SEARCH_ROOT_DN=cn=Users,dc=Example,dc=local
<div class="Pp"></div>
LDAP_SEARCH_FILTER*=&quot;(userPrincipalName=${Args::DACS_USERNAME}@Example.local)&quot;
<div class="Pp"></div>
LDAP_ROLES_SELECTOR*=&quot;${LDAP::attrname}&quot; eq &quot;memberOf&quot; ? strtr(ldap(rdn_attrvalue, \
    ldap(dn_index, &quot;${LDAP::attrvalue}&quot;, 1)), &quot; &quot;, &quot;_&quot;) : &quot;&quot;
</pre>
</div>
<div class="Pp"></div>
Suppose one wanted to use <b>dacsauth</b> to authenticate a user via LDAP in a
  way analogous to this dacs.conf configuration:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
&lt;Auth id=&quot;ldap&quot;&gt;
URL &quot;http://example.example.com/cgi-bin/dacs/local_ldap_authenticate&quot;
STYLE &quot;password,add_roles&quot;
CONTROL &quot;required&quot;
LDAP_BIND_METHOD &quot;direct&quot;
LDAP_USERNAME_URL* '&quot;ldap://winders.example.com/cn=&quot; . encode(url, ${Args::USERNAME}) . &quot;,cn=Users,dc=example,dc=local&quot;'
LDAP_USERNAME_EXPR* '&quot;${LDAP::sAMAccountName}&quot;'
LDAP_ROLES_SELECTOR* '&quot;${LDAP::attrname}&quot; eq &quot;memberOf&quot; \
    ? strtr(ldap(rdn_attrvalue, ldap(dn_index, &quot;${LDAP::attrvalue}&quot;, 1)), &quot; &quot;, &quot;_&quot;) : &quot;&quot;'
&lt;/Auth&gt;
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
A file like this (e.g., /usr/local/dacs/ldap_auth_options_direct) would contain
  the following directives:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
LDAP_BIND_METHOD=direct
LDAP_USERNAME_URL*=&quot;ldap://winders.example.com/cn=&quot; . encode(url, ${Args::USERNAME}) . &quot;,cn=Users,dc=example,dc=local&quot;
LDAP_USERNAME_EXPR*=&quot;${LDAP::sAMAccountName}&quot;
LDAP_ROLES_SELECTOR*=&quot;${LDAP::attrname}&quot; eq &quot;memberOf&quot; \
    ? strtr(ldap(rdn_attrvalue, ldap(dn_index, &quot;${LDAP::attrvalue}&quot;, 1)), &quot; &quot;, &quot;_&quot;) : &quot;&quot;
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
Authentication could then be performed using a command like this:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
% dacsauth -fj FEDROOT \
  -m http://example.example.com/cgi-bin/dacs/local_ldap_authenticate passwd suff \
  -Of /usr/local/dacs/ldap_auth_options_direct \
  -DVFS=&quot;[federation_keys]dacs-fs:/usr/local/dacs/federations/federation_keys&quot; \
  -fn EXAMPLE -u bobo -prompt
</pre>
</div>
<div class="Pp"></div>
For indirect authentication, a configuration file similar to this could be used:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">
<pre>
LDAP_BIND_METHOD=indirect
LDAP_USERNAME_EXPR*=regsub(${LDAP::userPrincipalName},&quot;@.*&quot;,&quot;&quot;)
<div class="Pp"></div>
LDAP_ADMIN_URL=ldap://winders.example.com/cn=admin,cn=Users,dc=example,dc=local
LDAP_ADMIN_PASSWORD=MySecretAdminPasswordGoesHere
LDAP_SEARCH_ROOT_DN=cn=Users,dc=Example,dc=local
LDAP_SEARCH_FILTER*=&quot;(userPrincipalName=${Args::USERNAME}@Example.local)&quot;
<div class="Pp"></div>
LDAP_ROLES_SELECTOR*=&quot;${LDAP::attrname}&quot; eq &quot;memberOf&quot; \
? strtr(ldap(rdn_attrvalue, ldap(dn_index, &quot;${LDAP::attrvalue}&quot;, 1)), &quot; &quot;, &quot;_&quot;) : &quot;&quot;
</pre>
</div>
<div style="height: 1.00em;">&#x00A0;</div>
<h2 class="Ss" title="Ss" id="Enhancing_SSH_Security"><a class="selflink" href="#Enhancing_SSH_Security">Enhancing
  SSH Security</a></h2>
The OpenSSH SSH daemon <b>sshd(8)</b>[25] provides a hook, executed after normal
  authentication, that allows an arbitrary command to be executed rather than
  the user's shell. Refer to the description of the ForceCommand and Match
  keywords in <b>sshd_config(5)</b>[26]. This feature can be used to insert
  <b>DACS</b> authentication capabilities into <b>sshd</b> for users that sign
  on through <b>ssh</b>. To do this, the ForceCommand keyword names a small
  program that runs <b>dacsauth</b>, which might prompt the user for an
  additional password or codeword, validate it, and return the result of
  authentication through its exit status. Depending on the result of
  authentication, the small program can execute the user's shell or other
  program. In a similar way, <b>dacscheck(1)</b>[27] can be called by the small
  program to consult <b>DACS</b> access control rules. Note that it seems that
  in some contexts the program run by ForceCommand cannot disable keyboard echo,
  which might make this approach inappropriate sometimes.
<h1 class="Sh" title="Sh" id="DIAGNOSTICS"><a class="selflink" href="#DIAGNOSTICS">DIAGNOSTICS</a></h1>
The program exits 0 if authentication was successful or with 1 if authentication
  failed or an error occurred.
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
This command only supplies partial support for interacting with
  <b>dacs_authenticate</b>. It may not be possible for an authentication module
  to return role information, as can be done by <b>dacs_authenticate</b>.
<div class="Pp"></div>
It would be better if the <b>-m</b> flag were instead <b>-a</b> (for
  &quot;authenticate&quot;).
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="selflink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<b>dacscred(1)</b>[2], <b>dacs_authenticate(8)</b>[1], <b>dacs.exprs(5)</b>[28]
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Distributed Systems Software ( <b>www.dss.ca</b>[29])
<h1 class="Sh" title="Sh" id="COPYING"><a class="selflink" href="#COPYING">COPYING</a></h1>
Copyright2003-2016 Distributed Systems Software. See the <b>LICENSE</b>[30] file
  that accompanies the distribution for licensing information.
<h1 class="Sh" title="Sh" id="NOTES"><a class="selflink" href="#NOTES">NOTES</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"> 1.</dt>
  <dd class="It-tag">dacs_authenticate(8)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_authenticate.8.html</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 2.</dt>
  <dd class="It-tag">dacscred(1)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacscred.1.html</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 3.</dt>
  <dd class="It-tag">dacs_auth_agent(8)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_auth_agent.8.html</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 4.</dt>
  <dd class="It-tag">dacs.conf(5)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.conf.5.html</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 5.</dt>
  <dd class="It-tag">dacs(1)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.1.html</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 6.</dt>
  <dd class="It-tag">Auth clause</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_authenticate.8.html#auth_clause</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 7.</dt>
  <dd class="It-tag">URL</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_authenticate.8.html#URL</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 8.</dt>
  <dd class="It-tag">STYLE</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_authenticate.8.html#STYLE</div>
<dl class="Bl-tag">
  <dt class="It-tag"> 9.</dt>
  <dd class="It-tag">CONTROL</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_authenticate.8.html#CONTROL</div>
<dl class="Bl-tag">
  <dt class="It-tag">10.</dt>
  <dd class="It-tag">OPTION</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_authenticate.8.html#OPTION</div>
<dl class="Bl-tag">
  <dt class="It-tag">11.</dt>
  <dd class="It-tag">EXPR</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_authenticate.8.html#EXPR</div>
<dl class="Bl-tag">
  <dt class="It-tag">12.</dt>
  <dd class="It-tag">VFS</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.conf.5.html#VFS</div>
<dl class="Bl-tag">
  <dt class="It-tag">13.</dt>
  <dd class="It-tag">dacs_authenticate(8)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_authenticate.8.html#roles_clause</div>
<dl class="Bl-tag">
  <dt class="It-tag">14.</dt>
  <dd class="It-tag">URL</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_authenticate.8.html#r_URL</div>
<dl class="Bl-tag">
  <dt class="It-tag">15.</dt>
  <dd class="It-tag">-fn</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/#fn_flag</div>
<dl class="Bl-tag">
  <dt class="It-tag">16.</dt>
  <dd class="It-tag">-fj</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/#fj_flag</div>
<dl class="Bl-tag">
  <dt class="It-tag">17.</dt>
  <dd class="It-tag">local_ldap_authenticate</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_authenticate.8.html#local_ldap_authenticate</div>
<dl class="Bl-tag">
  <dt class="It-tag">18.</dt>
  <dd class="It-tag">local_ldap_roles</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_authenticate.8.html#local_ldap_roles</div>
<dl class="Bl-tag">
  <dt class="It-tag">19.</dt>
  <dd class="It-tag">Google</dd>
</dl>
<div style="margin-left: 4.00ex;">http://www.google.com</div>
<dl class="Bl-tag">
  <dt class="It-tag">20.</dt>
  <dd class="It-tag">dacs_authenticate(8)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_authenticate.8.html#local_pam_authenticate</div>
<dl class="Bl-tag">
  <dt class="It-tag">21.</dt>
  <dd class="It-tag">pamd(8)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/pamd.8.html</div>
<dl class="Bl-tag">
  <dt class="It-tag">22.</dt>
  <dd class="It-tag">local_unix_roles</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_authenticate.8.html#local_unix_roles</div>
<dl class="Bl-tag">
  <dt class="It-tag">23.</dt>
  <dd class="It-tag">local_roles</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs_authenticate.8.html#local_roles</div>
<dl class="Bl-tag">
  <dt class="It-tag">24.</dt>
  <dd class="It-tag">role string</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.1.html#roles</div>
<dl class="Bl-tag">
  <dt class="It-tag">25.</dt>
  <dd class="It-tag">sshd(8)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://www.freebsd.org/cgi/man.cgi?query=sshd&amp;apropos=0&amp;sektion=8&amp;manpath=FreeBSD+10.3-RELEASE&amp;format=html</div>
<dl class="Bl-tag">
  <dt class="It-tag">26.</dt>
  <dd class="It-tag">sshd_config(5)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://www.freebsd.org/cgi/man.cgi?query=sshd_config&amp;apropos=0&amp;sektion=5&amp;manpath=FreeBSD+10.3-RELEASE&amp;format=html</div>
<dl class="Bl-tag">
  <dt class="It-tag">27.</dt>
  <dd class="It-tag">dacscheck(1)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacscheck.1.html</div>
<dl class="Bl-tag">
  <dt class="It-tag">28.</dt>
  <dd class="It-tag">dacs.exprs(5)</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/dacs.exprs.5.html</div>
<dl class="Bl-tag">
  <dt class="It-tag">29.</dt>
  <dd class="It-tag">www.dss.ca</dd>
</dl>
<div style="margin-left: 4.00ex;">http://www.dss.ca</div>
<dl class="Bl-tag">
  <dt class="It-tag">30.</dt>
  <dd class="It-tag">LICENSE</dd>
</dl>
<div style="margin-left: 4.00ex;">http://dacs.dss.ca/man/../misc/LICENSE</div>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">01/12/2017</td>
    <td class="foot-os">DACS 1.4.38a</td>
  </tr>
</table>
</body>
</html>
