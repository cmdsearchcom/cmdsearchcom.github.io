<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>TRACEVIEW(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">TRACEVIEW(1)</td>
    <td class="head-vol">Android SDK Tools</td>
    <td class="head-rtitle">TRACEVIEW(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
traceview - a graphical viewer for execution logs saved by Android application.
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
traceview [-r] trace
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
Traceview is a graphical viewer for execution logs that you create by using the
  Debug class to log tracing information in your code. Traceview can help you
  debug your application and profile its performance.
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt class="It-tag"><b>-r</b></dt>
  <dd class="It-tag">regression only</dd>
</dl>
<h1 class="Sh" title="Sh" id="TRACEVIEW_LAYOUT"><a class="selflink" href="#TRACEVIEW_LAYOUT">TRACEVIEW
  LAYOUT</a></h1>
When you have a trace log file (generated by adding tracing code to your
  application or by DDMS), you can have Traceview load the log files and display
  their data in a window visualizes your application in two panels:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">A timeline panel - describes when each thread
  and method started and stopped.
<div style="height: 1.00em;">&#x00A0;</div>
A profile panel - provides a summary of what happened inside a method.</div>
<div class="Pp"></div>
The sections below provide addition information about the traceview output
  panes.
<h2 class="Ss" title="Ss" id="Timeline_Panel"><a class="selflink" href="#Timeline_Panel">Timeline
  Panel</a></h2>
Each thread's execution is shown in its own row, with time increasing to the
  right. Each method is shown in another color (colors are reused in a
  round-robin fashion starting with the methods that have the most inclusive
  time). The thin lines underneath the first row show the extent (entry to exit)
  of all the calls to the selected method. The method in this case is
  LoadListener. <i>nativeFinished()</i> and it was selected in the profile view.
<h2 class="Ss" title="Ss" id="Profile_Panel"><a class="selflink" href="#Profile_Panel">Profile
  Panel</a></h2>
This view shows a summary of all the time spent in a method. The table shows
  both the inclusive and exclusive times (as well as the percentage of the total
  time). Exclusive time is the time spent in the method. Inclusive time is the
  time spent in the method plus the time spent in any called functions. We refer
  to calling methods as &quot;parents&quot; and called methods as
  &quot;children.&quot; When a method is selected (by clicking on it), it
  expands to show the parents and children. Parents are shown with a purple
  background and children with a yellow background. The last column in the table
  shows the number of calls to this method plus the number of recursive calls.
  The last column shows the number of calls out of the total number of calls
  made to that method. In this view, we can see that there were 14 calls to
  LoadListener. <i>nativeFinished()</i>; looking at the timeline panel shows
  that one of those calls took an unusually long time.
<h1 class="Sh" title="Sh" id="TRACEVIEW_FILE_FORMAT"><a class="selflink" href="#TRACEVIEW_FILE_FORMAT">TRACEVIEW
  FILE FORMAT</a></h1>
Tracing creates two distinct pieces of output: a data file, which holds the
  trace data, and a key file, which provides a mapping from binary identifiers
  to thread and method names. The files are concatenated when tracing completes,
  into a single .trace file.
<div class="Pp"></div>
<b>Note:</b> The previous version of Traceview did not concatenate these files
  for you. If you have old key and data files that you'd still like to trace,
  you can concatenate them yourself with cat mytrace.key mytrace.data &gt;
  mytrace.trace.
<h2 class="Ss" title="Ss" id="Data_File_Format"><a class="selflink" href="#Data_File_Format">Data
  File Format</a></h2>
The data file is binary, structured as follows (all values are stored in little
  endian order):
<div class="Pp"></div>
<pre>
  * File format:
  * header
  * record 0
  * record 1
  * ...
  *
  * Header format:
  * u4 magic 0x574f4c53 ('SLOW')
  * u2 version
  * u2 offset to data
  * u8 start date/time in usec
  *
  * Record format:
  * u1 thread ID
  * u4 method ID | method action
  * u4 time delta since start, in usec
</pre>
<div class="Pp"></div>
The application is expected to parse all of the header fields, then seek to
  &quot;offset to data&quot; from the start of the file. From there it just
  reads 9-byte records until EOF is reached.
<div class="Pp"></div>
u8 start date/time in usec is the output from <i>gettimeofday()</i>. It's mainly
  there so that you can tell if the output was generated yesterday or three
  months ago.
<div class="Pp"></div>
method action sits in the two least-significant bits of the method word. The
  currently defined meanings are:
<div class="Pp"></div>
<pre>
  0 - method entry
  1 - method exit
  2 - method &quot;exited&quot; when unrolled by exception handling
  3 - (reserved)
</pre>
<div class="Pp"></div>
An unsigned 32-bit integer can hold about 70 minutes of time in microseconds.
<h2 class="Ss" title="Ss" id="Key_File_Format"><a class="selflink" href="#Key_File_Format">Key
  File Format</a></h2>
The key file is a plain text file divided into three sections. Each section
  starts with a keyword that begins with '*'. If you see a '*' at the start of a
  line, you have found the start of a new section.
<div class="Pp"></div>
An example file might look like this:
<div class="Pp"></div>
<pre>
  *version
  1
  clock=global
  *threads
  1 main
  6 JDWP Handler
  5 Async GC
  4 Reference Handler
  3 Finalizer
  2 Signal Handler
  *methods
  0x080f23f8 java/io/PrintStream write ([BII)V
  0x080f25d4 java/io/PrintStream print (Ljava/lang/String;)V
  0x080f27f4 java/io/PrintStream println (Ljava/lang/String;)V
  0x080da620 java/lang/RuntimeException   &lt;init&gt;    ()V
  [...]
  0x080f630c android/os/Debug startMethodTracing ()V
  0x080f6350 android/os/Debug startMethodTracing (Ljava/lang/String;Ljava/lang/String;I)V
  *end
</pre>
<div class="Pp"></div>
The following list describes the major sections of a key file:
<dl class="Bl-tag">
  <dt class="It-tag">version section</dt>
  <dd class="It-tag">The first line is the file version number, currently 1. The
      second line, clock=global, indicates that we use a common clock across all
      threads. A future version may use per-thread CPU time counters that are
      independent for every thread.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">threads section</dt>
  <dd class="It-tag">One line per thread. Each line consists of two parts: the
      thread ID, followed by a tab, followed by the thread name. There are few
      restrictions on what a valid thread name is, so include everything to the
      end of the line.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">methods section</dt>
  <dd class="It-tag">One line per method entry or exit. A line consists of four
      pieces, separated by tab marks: method-ID [TAB] class-name [TAB]
      method-name [TAB] signature. Only the methods that were actually entered
      or exited are included in the list. Note that all three identifiers are
      required to uniquely identify a method.</dd>
</dl>
<div class="Pp"></div>
Neither the threads nor methods sections are sorted.
<h1 class="Sh" title="Sh" id="CREATING_TRACE_FILES"><a class="selflink" href="#CREATING_TRACE_FILES">CREATING
  TRACE FILES</a></h1>
To use Traceview, you need to generate log files containing the trace
  information you want to analyze.
<div class="Pp"></div>
There are two ways to generate trace logs:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">Include the Debug class in your code and call
  its methods to start and stop logging of trace information to disk. This
  method is very precise because you can specify in your code exactly where to
  start and stop logging trace data.
<div style="height: 1.00em;">&#x00A0;</div>
Use the method profiling feature of DDMS to generate trace logs. This method is
  less precise since you do not modify code, but rather specify when to start
  and stop logging with a DDMS. Although you have less control on exactly where
  the data is logged, this method is useful if you don't have access to the
  application's code, or if you do not need the precision of the first
  method.</div>
<div class="Pp"></div>
Before you start generating trace logs, be aware of the following restrictions:
<div style="height: 1.00em;">&#x00A0;</div>
<div style="margin-left: 4.00ex;">If you are using the Debug class, your device
  or emulator must have an SD card and your application must have permission to
  write to the SD card.
<div style="height: 1.00em;">&#x00A0;</div>
If you are using DDMS, Android 1.5 devices are not supported.
<div style="height: 1.00em;">&#x00A0;</div>
If you are using DDMS, Android 2.1 and earlier devices must have an SD card
  present and your application must have permission to write to the SD card.
<div style="height: 1.00em;">&#x00A0;</div>
If you are using DDMS, Android 2.2 and later devices do not need an SD card. The
  trace log files are streamed directly to your development machine.</div>
<div class="Pp"></div>
To create the trace files, include the Debug class and call one of the
  <i>startMethodTracing()</i> methods. In the call, you specify a base name for
  the trace files that the system generates. To stop tracing, call
  <i>stopMethodTracing()</i>. These methods start and stop method tracing across
  the entire virtual machine. For example, you could call
  <i>startMethodTracing()</i> in your activity's <i>onCreate()</i> method, and
  call <i>stopMethodTracing()</i> in that activity's <i>onDestroy()</i> method.
<div class="Pp"></div>
<pre>
  // start tracing to &quot;/sdcard/calc.trace&quot;
  Debug.startMethodTracing(&quot;calc&quot;);
  // ...
  // stop tracing
  Debug.stopMethodTracing();
</pre>
<div class="Pp"></div>
When your application calls <i>startMethodTracing()</i>, the system creates a
  file called &lt;trace-base-name&gt;.trace. This contains the binary method
  trace data and a mapping table with thread and method names.
<div class="Pp"></div>
The system then begins buffering the generated trace data, until your
  application calls <i>stopMethodTracing()</i>, at which time it writes the
  buffered data to the output file. If the system reaches the maximum buffer
  size before <i>stopMethodTracing()</i> is called, the system stops tracing and
  sends a notification to the console.
<div class="Pp"></div>
Interpreted code will run more slowly when profiling is enabled. Don't try to
  generate absolute timings from the profiler results (i.e. &quot;function X
  takes 2.5 seconds to run&quot;). The times are only useful in relation to
  other profile output, so you can see if changes have made the code faster or
  slower.
<div class="Pp"></div>
When using the Android emulator, you must specify an SD card when you create
  your AVD because the trace files are written to the SD card. Your application
  must have permission to write to the SD card as well.
<h1 class="Sh" title="Sh" id="COPYING_TRACE_FILES_TO_A_HOST_MACHINE"><a class="selflink" href="#COPYING_TRACE_FILES_TO_A_HOST_MACHINE">COPYING
  TRACE FILES TO A HOST MACHINE</a></h1>
After your application has run and the system has created your trace files
  &lt;trace-base-name&gt;.trace on a device or emulator, you must copy those
  files to your development computer. You can use adb pull to copy the files.
  Here's an example that shows how to copy an example file, calc.trace, from the
  default location on the emulator to the /tmp directory on the emulator host
  machine:
<div class="Pp"></div>
<pre>
  adb pull /sdcard/calc.trace /tmp
</pre>
<h1 class="Sh" title="Sh" id="COPYRIGHT"><a class="selflink" href="#COPYRIGHT">COPYRIGHT</a></h1>
This manual page is licensed under the Apache License, Version 2.0.
<div class="Pp"></div>
Copyright (C) 2013 Android Open Source Project
<div class="Pp"></div>
Copyright (C) 2013 Jakub Adam &lt;jakub.adam@ktknet.cz&gt;</div>
<table class="foot">
  <tr>
    <td class="foot-date">2017-01-19</td>
    <td class="foot-os">Debian</td>
  </tr>
</table>
</body>
</html>
