<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:31:45 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>pki-key(1) PKI Key Management Commands pki-key(1)</p>

<p style="margin-top: 1em">NAME <br>
pki-key - Command-Line Interface for managing Certificate
System keys.</p>

<p style="margin-top: 1em">SYNOPSIS <br>
pki [CLI options] &lt;subsystem&gt;-key <br>
pki [CLI options] &lt;subsystem&gt;-key-find [command
options] <br>
pki [CLI options] &lt;subsystem&gt;-key-show &lt;Key ID&gt;
[command options] <br>
pki [CLI options] &lt;subsystem&gt;-key-request-find
[command options] <br>
pki [CLI options] &lt;subsystem&gt;-key-request-show
&lt;Request ID&gt; [command options] <br>
pki [CLI options] &lt;subsystem&gt;-key-mod &lt;Key ID&gt;
[command options] <br>
pki [CLI options] &lt;subsystem&gt;-key-template-find
[command options] <br>
pki [CLI options] &lt;subsystem&gt;-key-template-show
&lt;Template ID&gt; [command options] <br>
pki [CLI options] &lt;subsystem&gt;-key-archive [command
options] <br>
pki [CLI options] &lt;subsystem&gt;-key-retrieve [command
options] <br>
pki [CLI options] &lt;subsystem&gt;-key-generate &lt;Client
Key ID&gt; --key-algorithm &lt;algorithm&gt; [command
options] <br>
pki [CLI options] &lt;subsystem&gt;-key-recover [command
options] <br>
pki [CLI options] &lt;subsystem&gt;-key-request-review
&lt;Request ID&gt; --action &lt;action&gt;[command
options]</p>

<p style="margin-top: 1em">DESCRIPTION <br>
The pki-key commands provide command-line interfaces to
manage keys on the KRA.</p>

<p style="margin-top: 1em">The only valid subsystem is kra.
The kra- prefix may be omitted.</p>

<p style="margin-top: 1em">pki [CLI options]
&lt;subsystem&gt;-key <br>
This command is to list available key commands.</p>

<p style="margin-top: 1em">pki [CLI options]
&lt;subsystem&gt;-key-find [command options] <br>
This command is to list keys.</p>

<p style="margin-top: 1em">pki [CLI options]
&lt;subsystem&gt;-key-show &lt;Key ID&gt; [command options]
<br>
This command is to view the details of a key in the KRA.</p>

<p style="margin-top: 1em">pki [CLI options]
&lt;subsystem&gt;-key-request-find [command options] <br>
This command is to list key requests.</p>

<p style="margin-top: 1em">pki [CLI options]
&lt;subsystem&gt;-key-request-show &lt;Request ID&gt;
[command options] <br>
This command is to view the details of a key request
submitted to the KRA.</p>

<p style="margin-top: 1em">pki [CLI options]
&lt;subsystem&gt;-key-mod &lt;Key ID&gt; --status
&lt;status&gt;[command options] <br>
This command is to modify the status of a particular key in
the KRA.</p>

<p style="margin-top: 1em">pki [CLI options]
&lt;subsystem&gt;-key-template-find [command options] <br>
This command is to list the templates for all types of
requests in the system.</p>

<p style="margin-top: 1em">pki [CLI options]
&lt;subsystem&gt;-key-template-show &lt;Template ID&gt;
[command options] <br>
This command is to view details of the template of a
specific key request.</p>

<p style="margin-top: 1em">pki [CLI options]
&lt;subsystem&gt;-key-archive [command options] <br>
This command is to archive a secret in the DRM.</p>

<p style="margin-top: 1em">pki [CLI options]
&lt;subsystem&gt;-key-retrieve [command options] <br>
This command is to retrieve a secret stored in the DRM.</p>

<p style="margin-top: 1em">pki [CLI options]
&lt;subsystem&gt;-key-generate &lt;Client Key ID&gt;
--key-algorithm &lt;algorithm&gt; [command options] <br>
This command is to generate a key in the DRM.</p>

<p style="margin-top: 1em">pki [CLI options]
&lt;subsystem&gt;-key-recover [command options] <br>
This command is to recover details of a key in the DRM.</p>

<p style="margin-top: 1em">pki [CLI options]
&lt;subsystem&gt;-key-request-review [command options] <br>
This command is to review a key request submitted ot the
DRM.</p>

<p style="margin-top: 1em">OPTIONS <br>
The CLI options are described in pki(1).</p>

<p style="margin-top: 1em">OPERATIONS <br>
To view available key commands, type pki
&lt;subsystem&gt;-key. To view each command&rsquo;s usage,
type pki &lt;subsystem&gt;-key-&lt;command&gt; --help.</p>

<p style="margin-top: 1em">All the key commands require
agent authentication.</p>

<p style="margin-top: 1em">Viewing the keys <br>
To view the keys stored in DRM:</p>

<p style="margin-top: 1em">pki &lt;agent authentication&gt;
key-find</p>

<p style="margin-top: 1em">To view all active keys for a
specific client key ID:</p>

<p style="margin-top: 1em">pki &lt;agent authentication&gt;
key-find --clientKeyID &lt;Client Key ID&gt; --status
active</p>

<p style="margin-top: 1em">To view details of a specific
key:</p>

<p style="margin-top: 1em">pki &lt;agent authentication&gt;
key-show &lt;KeyID&gt;</p>

<p style="margin-top: 1em">Archiving a key <br>
To archive a passphrase in the DRM:</p>

<p style="margin-top: 1em">pki &lt;agent authentication&gt;
key-archive --clientKeyID &lt;Client Key ID&gt; --passphrase
&lt;Passphrase&gt;</p>

<p style="margin-top: 1em">A symmetric key can be archived
using the &quot;archiveKey&quot; request template.</p>

<p style="margin-top: 1em">To archive a secret using the
request template stored in a file:</p>

<p style="margin-top: 1em">pki &lt;agent authentication&gt;
key-archive --input &lt;path to the template file&gt;</p>

<p style="margin-top: 1em">Retrieving a key <br>
To retrieve a key using the key ID:</p>

<p style="margin-top: 1em">pki &lt;agent authentication&gt;
key-retrieve --keyID &lt;Key Identifier&gt;</p>

<p style="margin-top: 1em">To retrieve a key using a
recovery request template:</p>

<p style="margin-top: 1em">pki &lt;agent authentication&gt;
key-retrieve --input &lt;path_to_the_template_file&gt;</p>

<p style="margin-top: 1em">To retrieve a key encrypted in a
custom password:</p>

<p style="margin-top: 1em">pki &lt;agent authentication&gt;
key-retrieve --keyID &lt;Key Identifier&gt; --passphrase
&lt;passphrase&gt;</p>

<p style="margin-top: 1em">The returned output contains the
secret wrapped in the provided passphrase, using DES3
algorithm, and the nonce used for encryption.</p>

<p style="margin-top: 1em">To store the key information to
an output file, use the --output option for the command.</p>

<p style="margin-top: 1em">Recovering a key <br>
To initiate a key recovery:</p>

<p style="margin-top: 1em">pki &lt;agent authentication&gt;
key-recover --keyID &lt;Key Identifier&gt;</p>

<p style="margin-top: 1em">The request ID returned by this
operation must be approved using the key-request-review
command before the actual key retrieval.</p>

<p style="margin-top: 1em">This step is performed
internally by the key-retrieve command.</p>

<p style="margin-top: 1em">Generating a Symmetric Key <br>
To generate a symmetric key using the DES3 algorithm:</p>

<p style="margin-top: 1em">pki &lt;agent authentication&gt;
key-generate &lt;Client Key ID&gt; --key-algorithm DES3
--usages wrap,unwrap</p>

<p style="margin-top: 1em">There are other algorithms to
generate symmetric keys such as the AES, DES, DESede, RC2,
RC4.</p>

<p style="margin-top: 1em">In case of using any of the
AES/RC2/RC4 algorithms, the key size has to be specified
using the key-size option of the command.</p>

<p style="margin-top: 1em">Generation of asymmetric keys is
currently not implemented.</p>

<p style="margin-top: 1em">Reviewing a key request <br>
To approve a key request:</p>

<p style="margin-top: 1em">pki &lt;agent authentication&gt;
key-request-review &lt;Request ID&gt; --action approve</p>

<p style="margin-top: 1em">On successful authentication,
the request with the given request ID will be approved.</p>

<p style="margin-top: 1em">There other actions that can be
performed by an agent are reject/cancel.</p>

<p style="margin-top: 1em">Viewing a request template <br>
To list all the key request templates:</p>

<p style="margin-top: 1em">pki &lt;agent authentication&gt;
key-template-find</p>

<p style="margin-top: 1em">To view a key archival request
template:</p>

<p style="margin-top: 1em">pki &lt;agent authentication&gt;
key-template-show archiveKey</p>

<p style="margin-top: 1em">EXAMPLES <br>
The following pki client examples show the usage of the
above operations for a basic CA and KRA server
installation.</p>

<p style="margin-top: 1em">A basic installation of CA and
KRA servers can be done by running pkispawn in interactive
mode and selecting the default parameters (see the section
INTERACTIVE MODE in <br>
pkispawn(8))</p>

<p style="margin-top: 1em">or using a configuration file
with basic parameters(see the section EXAMPLES in
pkispawn(8)).</p>

<p style="margin-top: 1em">Only an agent can perform
operations on the key resource. An agent certificate must be
used for authentication. This can be done by importing an
agent certificate into an NSS <br>
database and passing the values to relevant options provided
by the pki CLI framework.</p>

<p style="margin-top: 1em">Running the following commands
will set up the NSS database for use by a pki client and
import the agent&rsquo;s certificate into the database and
list information( including the nick&acirc; <br>
name) of the certificate stored in the database.</p>

<p style="margin-top: 1em">- certutil -N -d
&lt;CERT_DB_DIR_PATH&gt;</p>

<p style="margin-top: 1em">- pk12util -i
&lt;Agent_Cert_P12_FILE_PATH&gt; -d
&lt;CERT_DB_DIR_PATH&gt;</p>

<p style="margin-top: 1em">- certutil -L -d
&lt;CERT_DB_DIR_PATH&gt;</p>

<p style="margin-top: 1em">The first command creates an NSS
database. It asks to enter a password for the database. The
second command imports the agent certificate in a PKCS12
format into the database. <br>
It prompts for the passwords of the PKCS12 file and the NSS
database. The third command shows the information about the
imported certificate.(including the nickname)</p>

<p style="margin-top: 1em">For demonstration purposes, the
administrator certificate can be used to perform agent
authentication. In a basic installation setup, the admin
cert can be found at /root/.dog&acirc; <br>
tag/pki-tomcat/ca_admin_cert.p12. Since the installation can
only be performed by a root user, this file must be copied
to a location where other users can access it, with valid
<br>
permissions.</p>

<p style="margin-top: 1em">On completion of the setup, and,
when issuing the first command using the authentication
parameters, a user may be greeted with a warning message
which indicates that an <br>
untrusted issuer was encountered. Simply reply
&rsquo;Y&rsquo; to import the CA certificate, and, presuming
that the displayed CA server URI is valid, press the
carriage return.</p>

<p style="margin-top: 1em">To list all the keys and key
requests stored in KRA:</p>

<p style="margin-top: 1em">pki -d &lt;CERT_DB_DIR_PATH&gt;
-c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt;
key-find</p>

<p style="margin-top: 1em">pki -d &lt;CERT_DB_DIR_PATH&gt;
-c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt;
key-request-find</p>

<p style="margin-top: 1em">To view information of a
specific key or a key request stored in KRA:</p>

<p style="margin-top: 1em">pki -d &lt;CERT_DB_DIR_PATH&gt;
-c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt;
key-show &lt;Key ID&gt;</p>

<p style="margin-top: 1em">pki -d &lt;CERT_DB_DIR_PATH&gt;
-c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt;
key-request-show &lt;Request ID&gt;</p>

<p style="margin-top: 1em">Creating a request for
archiving/retrieving/recovering a key</p>

<p style="margin-top: 1em">pki -d &lt;CERT_DB_DIR_PATH&gt;
-c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt;
key-archive --clientKeyID vek12345 --passphrase
SampleSecret</p>

<p style="margin-top: 1em">pki -d &lt;CERT_DB_DIR_PATH&gt;
-c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt;
key-retrieve --keyID &lt;Key ID of the archived
secret&gt;</p>

<p style="margin-top: 1em">pki -d &lt;CERT_DB_DIR_PATH&gt;
-c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt;
key-recover --keyID &lt;Key ID of the archived
secret&gt;</p>

<p style="margin-top: 1em">Generating a symmetric key</p>

<p style="margin-top: 1em">pki -d &lt;CERT_DB_DIR_PATH&gt;
-c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt;
key-generate vek123456 --key-algorithm DES3 --usages
encrypt,decrypt</p>

<p style="margin-top: 1em">Reviewing a key request</p>

<p style="margin-top: 1em">pki -d &lt;CERT_DB_DIR_PATH&gt;
-c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt;
key-request-review &lt;Request ID&gt; --action
&lt;approve/reject/cancel&gt;</p>

<p style="margin-top: 1em">Using templates for creating
requests (for advanced users) <br>
The messages for communication between the CLI framework and
KRA for accessing the key resource are always encrypted.</p>

<p style="margin-top: 1em">In the case of the above
mentioned examples, the encryption and decryption of the
secrets is done internally by the Dogtag client API.</p>

<p style="margin-top: 1em">But, applications using the CLI
framework to create various requests and also use local
encryption, so the xml templates can be used to supply data
to the create a request.</p>

<p style="margin-top: 1em">All the templates can be listed
by executing:</p>

<p style="margin-top: 1em">pki key-template-find</p>

<p style="margin-top: 1em">Creating a key-archival request
<br>
To fetch the template for key archival:</p>

<p style="margin-top: 1em">pki key-template-show archiveKey
--output &lt;output file&gt;</p>

<p style="margin-top: 1em">This command gets the template
for a key archival request and stores it in an output
file.</p>

<p style="margin-top: 1em">Following is the description of
the various parameters in the key archival template:</p>

<p style="margin-top: 1em">-- clientKeyID - Unique
identifier for the secret. <br>
-- dataType - Type of the data to be stored which can be
passphrase/symmetricKey/asymmetricKey. <br>
-- keyAlgorithm - Algorithm used to create a symmetric key.
(Not required if the dataType is passphrase) <br>
-- keySize - Size used to generate the symmetric key. (Not
required if the dataType is passphrase) <br>
-- algorithmOID - Key Algorithm object identifier <br>
-- symmetricAlgorithmParams - Base64 encoded nonce data.
Nonce used while encrypting the secret. <br>
-- wrappedPrivateData - Secret encrypted using a session
key(A symmetric key) encoded using Base64. This entity
contains the secret which is encrypted using a session key.
<br>
-- transWrappedSessionKey - The session key used to encrypt
the secret, wrapped using the DRM transport key, and encoded
in Base64 format. <br>
-- pkiArchiveOptions - An object of type PKIArchiveOptions
provided by the NSS/JSS library to securely transport a
secret encoded in Base64 format.</p>

<p style="margin-top: 1em">To create an archival request
using the template file:</p>

<p style="margin-top: 1em">pki -d &lt;CERT_DB_DIR_PATH&gt;
-c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt;
key-archive --input &lt;Path_to_template_file&gt;</p>

<p style="margin-top: 1em">Creating a key-retrieval request
<br>
To fetch the template for key retrieval:</p>

<p style="margin-top: 1em">pki key-template-show
retrieveKey --output &lt;output file&gt;</p>

<p style="margin-top: 1em">This command gets the template
for a key retrieval request and stores it in an output
file.</p>

<p style="margin-top: 1em">Following is the description of
the various parameters in the key retrieval template:</p>

<p style="margin-top: 1em">-- keyID - Key identifier <br>
-- requestID - Key request identifier <br>
-- nonceData - Base64 encoded string of nonce used during
encryption <br>
-- passphrase - passphrase to encrypt the secret with/
passphrase for the PKCS12 file returned <br>
-- sessionWrappedpassphrase - Base64 encoded string of -
Passphrase encrypted with a session key. <br>
-- transWrapedSessionKey - Base64 encoded string of -
session key encrypted with KRA&rsquo;s transport key. <br>
-- certificate - Base64 encoded certificate for recovering
the key.</p>

<p style="margin-top: 1em">To create a retrieval request
using the template file:</p>

<p style="margin-top: 1em">pki -d &lt;CERT_DB_DIR_PATH&gt;
-c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt;
key-retrieve --input &lt;Path_to_template_file&gt;</p>

<p style="margin-top: 1em">Creating a symmetric key
generation request <br>
To fetch the template for symmetric key generation:</p>

<p style="margin-top: 1em">pki key-template-show
generateKey --output &lt;output file&gt;</p>

<p style="margin-top: 1em">This command gets the template
for a symmetric key generation request and stores it in an
output file.</p>

<p style="margin-top: 1em">Following is the description of
the various parameters in the key retrieval template:</p>

<p style="margin-top: 1em">-- clientKeyID - Client
specified unique key identifier <br>
-- keyAlgorithm - Algorithm to be used to generate key
(AES/DES/DES3/DESede/RC2/RC4) <br>
-- keySize - Value for the size of the key to be generated.
<br>
-- keyUsage - usages of the generated key <br>
useful for Symmetric Keys (DES3,AES,etc)
(wrap,unwrap,encrypt,decrypt) <br>
useful for Asymmetric Keys (RSA, EC,etc)
(wrap,unwrap,encrypt,decrypt,sign,verify,sign_recover,verify_recover)</p>

<p style="margin-top: 1em">To create a key generation
request using the template file:</p>

<p style="margin-top: 1em">pki -d &lt;CERT_DB_DIR_PATH&gt;
-c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt;
key-generate --input &lt;Path_to_template_file&gt;</p>

<p style="margin-top: 1em">AUTHORS <br>
Ade Lee &lt;alee@redhat.com&gt;, Endi Dewata
&lt;edewata@redhat.com&gt;, Matthew Harmsen
&lt;mharmsen@redhat.com&gt; and Abhishek Koneru
&lt;akoneru@redhat.com&gt;.</p>

<p style="margin-top: 1em">COPYRIGHT <br>
Copyright (c) 2014 Red Hat, Inc. This is licensed under the
GNU General Public License, version 2 (GPLv2). A copy of
this license is available at
http://www.gnu.org/licenses/old- <br>
licenses/gpl-2.0.txt.</p>

<p style="margin-top: 1em">SEE ALSO <br>
pkispawn(8), pki(1)</p>

<p style="margin-top: 1em">version 10.2 May 5, 2014
pki-key(1)</p>
<hr>
</body>
</html>
