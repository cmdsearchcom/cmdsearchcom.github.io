<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>imagemath(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">imagemath(1)</td>
    <td class="head-vol">The Computational Morphometry Toolkit</td>
    <td class="head-rtitle">imagemath(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
imagemath - Image operations
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
Perform operations on images using stack-based postfix notation.
<div style="height: 1.00em;">&#x00A0;</div>
Images can be read from files and pushed onto the stack. Images on the stack can
  be processed and combined via different operators. Results of all operations
  are put back onto the stack, where they can be further processed or written
  back to image files.
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
<h2 class="Ss" title="Ss" id="Global_Toolkit_Options_(these_are_shared_by_all_CMTK_tools)"><a class="selflink" href="#Global_Toolkit_Options_(these_are_shared_by_all_CMTK_tools)">Global
  Toolkit Options (these are shared by all CMTK tools)</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--help</b></dt>
  <dd class="It-tag">Write list of basic command line options to standard
      output.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--help-all</b></dt>
  <dd class="It-tag">Write complete list of basic and advanced command line
      options to standard output.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--wiki</b></dt>
  <dd class="It-tag">Write list of command line options to standard output in
      MediaWiki markup.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--man</b></dt>
  <dd class="It-tag">Write man page source in 'nroff' markup to standard
    output.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--version</b></dt>
  <dd class="It-tag">Write toolkit version to standard output.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--echo</b></dt>
  <dd class="It-tag">Write the current command line to standard output.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--verbose-level</b> <i>&lt;integer&gt;</i></dt>
  <dd class="It-tag">Set verbosity level.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--verbose</b>, <b>-v</b></dt>
  <dd class="It-tag">Increment verbosity level by 1 (deprecated; supported for
      backward compatibility).</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--threads</b> <i>&lt;integer&gt;</i></dt>
  <dd class="It-tag">Set maximum number of parallel threads (for POSIX threads
      and OpenMP).</dd>
</dl>
<h2 class="Ss" title="Ss" id="Input/output_operations"><a class="selflink" href="#Input/output_operations">Input/output
  operations</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--in</b> <i>&lt;string-vector&gt;</i></dt>
  <dd class="It-tag">Read input image(s) to top of stack</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--out</b> <i>&lt;string&gt;</i></dt>
  <dd class="It-tag">Write output image from top of stack (but leave it on the
      stack)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--set-padding-value</b> <i>&lt;double&gt;</i></dt>
  <dd class="It-tag">Set the value that is interpreted as padding value in
      subsequently read images.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--unset-padding</b></dt>
  <dd class="It-tag">Disable padding. All values in subsequently read images
      will be interpreted as actual data.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Internal_settings"><a class="selflink" href="#Internal_settings">Internal
  settings</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--float</b></dt>
  <dd class="It-tag">Use single precision for computations and results <b>[This
      is the default]</b></dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--double</b></dt>
  <dd class="It-tag">Use double precision for computations and results</dd>
</dl>
<h2 class="Ss" title="Ss" id="Stack_operations"><a class="selflink" href="#Stack_operations">Stack
  operations</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--pop</b></dt>
  <dd class="It-tag">Pop (discard) top image from stack.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--dup</b></dt>
  <dd class="It-tag">Duplicate image on top of the stack.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--all</b></dt>
  <dd class="It-tag">Apply next single-image operation to all images on the
      stack.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Single-image_operators"><a class="selflink" href="#Single-image_operators">Single-image
  operators</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--fill</b> <i>&lt;double&gt;</i></dt>
  <dd class="It-tag">Fill top image with constant value (i.e., assign value to
      all pixels)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--abs</b></dt>
  <dd class="It-tag">Apply abs() function to top image</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--log</b></dt>
  <dd class="It-tag">Apply log() function to top image</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--logit</b></dt>
  <dd class="It-tag">Apply log(x/(1-x)) function to top image</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--logistic</b></dt>
  <dd class="It-tag">Apply 1/(1+exp(-x)) function to top image</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--exp</b></dt>
  <dd class="It-tag">Apply exp() function to top image</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sqr</b></dt>
  <dd class="It-tag">Apply square operator to top image</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sqrt</b></dt>
  <dd class="It-tag">Apply square root operator to top image</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--trunc</b></dt>
  <dd class="It-tag">Truncate all values in top image to integer</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--one-over</b></dt>
  <dd class="It-tag">For each pixel, replace its value x with 1.0/x</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--scalar-mul</b> <i>&lt;double&gt;</i></dt>
  <dd class="It-tag">Multiply top image with a scalar value</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--scalar-add</b> <i>&lt;double&gt;</i></dt>
  <dd class="It-tag">Add a scalar to each pixel of the top image</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--scalar-xor</b> <i>&lt;integer&gt;</i></dt>
  <dd class="It-tag">Bitwise exclusive-or between top level and given scalar
      value</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--scalar-and</b> <i>&lt;integer&gt;</i></dt>
  <dd class="It-tag">Bitwise and operation between top level and given scalar
      value</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--thresh-below</b> <i>&lt;double&gt;</i></dt>
  <dd class="It-tag">Set values below given threshold to threshold.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--thresh-above</b> <i>&lt;double&gt;</i></dt>
  <dd class="It-tag">Set values above given threshold to threshold.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Image_pair_operators"><a class="selflink" href="#Image_pair_operators">Image
  pair operators</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--add</b></dt>
  <dd class="It-tag">Add top and second image, place result on stack</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--mul</b></dt>
  <dd class="It-tag">Multiply top and second image, place result on stack</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--div</b></dt>
  <dd class="It-tag">Divide top image by second image, place result on
    stack</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--atan2</b></dt>
  <dd class="It-tag">Compute atan2() function from tup two image pixel pairs,
      place result on stack</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--match-histograms</b></dt>
  <dd class="It-tag">Scale intensities in one image to match intensities of
      another. The last image pushed onto the stack provides the reference
      intensity distribution, the preceding image will be modified. Both input
      images are removed from the stack and the modified image is pushed onto
      the stack.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--match-mean-sdev</b></dt>
  <dd class="It-tag">Scale intensities of one image to match mean and standard
      deviation of another. The last image pushed onto the stack provides the
      reference intensity distribution, the preceding image will be modified.
      Both input images are removed from the stack and the modified image is
      pushed onto the stack.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--match-mean-sdev3</b></dt>
  <dd class="It-tag">Scale intensities of an image by a factor and offset
      computed from two other images to match their mean and standard
      deviations. The last image pushed onto the stack provides the reference
      intensity distribution, the preceding image provides the intensity
      distribution to match to the reference image's, and the third image on the
      stack will be modified. All three input images are removed from the stack
      and the modified image is pushed onto the stack.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--mask-average</b></dt>
  <dd class="It-tag">Mask averaging: the top image is taken as a multi-label
      mask. The pixels in the second image are averaged by mask labels, and then
      replaced with the average value for each mask label.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Complex_Arithmetic"><a class="selflink" href="#Complex_Arithmetic">Complex
  Arithmetic</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--complex-div</b></dt>
  <dd class="It-tag">Complex division, (a+ib)/(c+id), assuming four values were
      put on the stack in order a, b, c, d. Place result on stack, real first,
      imaginary second (i.e., imaginary is top).</dd>
</dl>
<h2 class="Ss" title="Ss" id="Operators_that_contract_the_entire_stack_into_a_single_image"><a class="selflink" href="#Operators_that_contract_the_entire_stack_into_a_single_image">Operators
  that contract the entire stack into a single image</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--sum</b></dt>
  <dd class="It-tag">Sum all images on stack, place result on stack</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--product</b></dt>
  <dd class="It-tag">Compute product of all images on stack, place result on
      stack</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--average</b></dt>
  <dd class="It-tag">Average all images on stack, place result on stack</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--variance</b></dt>
  <dd class="It-tag">For each pixel, compute variance over all images on stack,
      place result on stack</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--combine-pca</b></dt>
  <dd class="It-tag">Combine images using PCA by projecting onto direction of
      largest correlation</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--max-value</b></dt>
  <dd class="It-tag">For each pixel, compute maximum VALUE over all images,
      place result on stack</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--min-value</b></dt>
  <dd class="It-tag">For each pixel, compute minimum VALUE over all images,
      place result on stack</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--max-index</b></dt>
  <dd class="It-tag">For each pixel, compute INDEX of image with maximum value,
      place result on stack</dd>
</dl>
<h2 class="Ss" title="Ss" id="Operators_that_contract_a_stack_of_label_images_into_a_single_label_image"><a class="selflink" href="#Operators_that_contract_a_stack_of_label_images_into_a_single_label_image">Operators
  that contract a stack of label images into a single label image</a></h2>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--vote</b></dt>
  <dd class="It-tag">Merge all images on stack with voting, place result on
      stack</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--staple</b> <i>&lt;integer&gt;</i></dt>
  <dd class="It-tag">Combine binary maps on the stack using [arg] iterations of
      the STAPLE algorithm. The result of this operation is the spatial map of
      'weights' W, which are the probabilities of image foreground at each
      pixel. In 'verbose' mode, estimated expert parameters p (sensitivity) and
      q (specificity) are also written to standard output.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--contract-labels</b></dt>
  <dd class="It-tag">Contract multiple label maps into one by selecting the
      first (over all images on the stack) non-zero label at each pixel</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--mstaple</b> <i>&lt;integer&gt;</i></dt>
  <dd class="It-tag">Combine multi-label maps on the stack using [arg]
      iterations of the multi-class STAPLE algorithm.The result of this
      operation is the combined maximum-likeliood multi-label map.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--mstaple-disputed</b> <i>&lt;integer&gt;</i></dt>
  <dd class="It-tag">Like previous operation, apply multi-class STAPLE
      algorithm, but restrict computation to 'disputed'voxels, i.e., those where
      the input label maps disagree. This often improves results by reducing,
      e.g., background effects.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag"><b>--stack-entropy-labels</b></dt>
  <dd class="It-tag">Compute stack entropy at each pixel from integer (label)
      input images</dd>
</dl>
<h1 class="Sh" title="Sh" id="AUTHORS"><a class="selflink" href="#AUTHORS">AUTHORS</a></h1>
Torsten Rohlfing, with contributions from Michael P. Hasak, Greg Jefferis,
  Calvin R. Maurer, Daniel B. Russakoff, and Yaroslav Halchenko
<h1 class="Sh" title="Sh" id="LICENSE"><a class="selflink" href="#LICENSE">LICENSE</a></h1>
http://www.fsf.org/licensing/licenses/gpl.html
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
Report bugs at http://nitrc.org/projects/cmtk/
<h1 class="Sh" title="Sh" id="ACKNOWLEDGMENTS"><a class="selflink" href="#ACKNOWLEDGMENTS">ACKNOWLEDGMENTS</a></h1>
CMTK is developed with support from the NIAAA under Grant AA021697, National
  Consortium on Alcohol and Neurodevelopment in Adolescence (N-CANDA): Data
  Integration Component. From April 2009 through September 2011, CMTK
  development and maintenance was supported by the NIBIB under Grant
  EB008381.</div>
<table class="foot">
  <tr>
    <td class="foot-date">Jan 13 2017</td>
    <td class="foot-os">CMTK 3.3.1</td>
  </tr>
</table>
</body>
</html>
