<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Sun Aug 27 16:25:41 2017 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>

<hr>


<p>MK-TABLE-SYNC(1) User Contributed Perl Documentation
MK-TABLE-SYNC(1)</p>

<p style="margin-top: 1em">NAME <br>
mk-table-sync - Synchronize MySQL table data
efficiently.</p>

<p style="margin-top: 1em">SYNOPSIS <br>
Usage: mk-table-sync [OPTION...] DSN [DSN...]</p>

<p style="margin-top: 1em">mk-table-sync synchronizes data
efficiently between MySQL tables.</p>

<p style="margin-top: 1em">This tool changes data, so for
maximum safety, you should back up your data before you use
it. When synchronizing a server that is a replication slave
with the --replicate or <br>
--sync-to-master methods, it always makes the changes on the
replication master, never the replication slave directly.
This is in general the only safe way to bring a replica <br>
back in sync with its master; changes to the replica are
usually the source of the problems in the first place.
However, the changes it makes on the master should be no-op
<br>
changes that set the data to their current values, and
actually affect only the replica. Please read the detailed
documentation that follows to learn more about this.</p>

<p style="margin-top: 1em">Sync db.tbl on host1 to
host2:</p>

<p style="margin-top: 1em">mk-table-sync --execute
h=host1,D=db,t=tbl h=host2</p>

<p style="margin-top: 1em">Sync all tables on host1 to
host2 and host3:</p>

<p style="margin-top: 1em">mk-table-sync --execute host1
host2 host3</p>

<p style="margin-top: 1em">Make slave1 have the same data
as its replication master:</p>

<p style="margin-top: 1em">mk-table-sync --execute
--sync-to-master slave1</p>

<p style="margin-top: 1em">Resolve differences that
mk-table-checksum found on all slaves of master1:</p>

<p style="margin-top: 1em">mk-table-sync --execute
--replicate test.checksum master1</p>

<p style="margin-top: 1em">Same as above but only resolve
differences on slave1:</p>

<p style="margin-top: 1em">mk-table-sync --execute
--replicate test.checksum --sync-to-master slave1</p>

<p style="margin-top: 1em">Sync master2 in a master-master
replication configuration, where master2&rsquo;s copy of
db.tbl is known or suspected to be incorrect:</p>

<p style="margin-top: 1em">mk-table-sync --execute
--sync-to-master h=master2,D=db,t=tbl</p>

<p style="margin-top: 1em">Note that in the master-master
configuration, the following will NOT do what you want,
because it will make changes directly on master2, which will
then flow through replication <br>
and change master1&rsquo;s data:</p>

<p style="margin-top: 1em"># Don&rsquo;t do this in a
master-master setup! <br>
mk-table-sync --execute h=master1,D=db,t=tbl master2</p>

<p style="margin-top: 1em">RISKS <br>
The following section is included to inform users about the
potential risks, whether known or unknown, of using this
tool. The two main categories of risks are those created by
<br>
the nature of the tool (e.g. read-only tools vs. read-write
tools) and those created by bugs.</p>

<p style="margin-top: 1em">With great power comes great
responsibility! This tool changes data, so it is a good idea
to back up your data. It is also very powerful, which means
it is very complex, so you <br>
should run it with the &quot;--dry-run&quot; option to see
what it will do, until you&rsquo;re familiar with its
operation. If you want to see which rows are different,
without changing any <br>
data, use &quot;--print&quot; instead of
&quot;--execute&quot;.</p>

<p style="margin-top: 1em">Be careful when using
mk-table-sync in any master-master setup. Master-master
replication is inherently tricky, and it&rsquo;s easy to
make mistakes. You need to be sure you&rsquo;re using <br>
the tool correctly for master-master replication. See the
&quot;SYNOPSIS&quot; for the overview of the correct
usage.</p>

<p style="margin-top: 1em">Also be careful with tables that
have foreign key constraints with &quot;ON DELETE&quot; or
&quot;ON UPDATE&quot; definitions because these might cause
unintended changes on the child tables.</p>

<p style="margin-top: 1em">In general, this tool is best
suited when your tables have a primary key or unique index.
Although it can synchronize data in tables lacking a primary
key or unique index, it <br>
might be best to synchronize that data by another means.</p>

<p style="margin-top: 1em">At the time of this release,
there is a potential bug using &quot;--lock-and-rename&quot;
with MySQL 5.1, a bug detecting certain differences, a bug
using ROUND() across different <br>
platforms, and a bug mixing collations.</p>

<p style="margin-top: 1em">The authoritative source for
updated information is always the online issue tracking
system. Issues that affect this tool will be marked as such.
You can see a list of such <br>
issues at the following URL:
&lt;http://www.maatkit.org/bugs/mk-table-sync&gt;.</p>

<p style="margin-top: 1em">See also &quot;BUGS&quot; for
more information on filing bugs and getting help.</p>

<p style="margin-top: 1em">DESCRIPTION <br>
mk-table-sync does one-way and bidirectional synchronization
of table data. It does not synchronize table structures,
indexes, or any other schema objects. The following <br>
describes one-way synchronization. &quot;BIDIRECTIONAL
SYNCING&quot; is described later.</p>

<p style="margin-top: 1em">This tool is complex and
functions in several different ways. To use it safely and
effectively, you should understand three things: the purpose
of &quot;--replicate&quot;, finding <br>
differences, and specifying hosts. These three concepts are
closely related and determine how the tool will run. The
following is the abbreviated logic:</p>

<p style="margin-top: 1em">if DSN has a t part, sync only
that table: <br>
if 1 DSN: <br>
if --sync-to-master: <br>
The DSN is a slave. Connect to its master and sync. <br>
if more than 1 DSN: <br>
The first DSN is the source. Sync each DSN in turn. <br>
else if --replicate: <br>
if --sync-to-master: <br>
The DSN is a slave. Connect to its master, find records <br>
of differences, and fix. <br>
else: <br>
The DSN is the master. Find slaves and connect to each, <br>
find records of differences, and fix. <br>
else: <br>
if only 1 DSN and --sync-to-master: <br>
The DSN is a slave. Connect to its master, find tables and
<br>
filter with --databases etc, and sync each table to the
master. <br>
else: <br>
find tables, filtering with --databases etc, and sync each
<br>
DSN to the first.</p>

<p style="margin-top: 1em">mk-table-sync can run in one of
two ways: with &quot;--replicate&quot; or without. The
default is to run without &quot;--replicate&quot; which
causes mk-table-sync to automatically find differences <br>
efficiently with one of several algorithms (see
&quot;ALGORITHMS&quot;). Alternatively, the value of
&quot;--replicate&quot;, if specified, causes mk-table-sync
to use the differences already found <br>
by having previously ran mk-table-checksum with its own
&quot;--replicate&quot; option. Strictly speaking, you
don&rsquo;t need to use &quot;--replicate&quot; because
mk-table-sync can find differences, <br>
but many people use &quot;--replicate&quot; if, for example,
they checksum regularly using mk-table-checksum then fix
differences as needed with mk-table-sync. If you&rsquo;re
unsure, read each <br>
tool&rsquo;s documentation carefully and decide for
yourself, or consult with an expert.</p>

<p style="margin-top: 1em">Regardless of whether
&quot;--replicate&quot; is used or not, you need to specify
which hosts to sync. There are two ways: with
&quot;--sync-to-master&quot; or without. Specifying <br>
&quot;--sync-to-master&quot; makes mk-table-sync expect one
and only slave DSN on the command line. The tool will
automatically discover the slave&rsquo;s master and sync it
so that its data is <br>
the same as its master. This is accomplished by making
changes on the master which then flow through replication
and update the slave to resolve its differences. Be careful
<br>
though: although this option specifies and syncs a single
slave, if there are other slaves on the same master, they
will receive via replication the changes intended for the
<br>
slave that you&rsquo;re trying to sync.</p>

<p style="margin-top: 1em">Alternatively, if you do not
specify &quot;--sync-to-master&quot;, the first DSN given on
the command line is the source host. There is only ever one
source host. If you do not also <br>
specify &quot;--replicate&quot;, then you must specify at
least one other DSN as the destination host. There can be
one or more destination hosts. Source and destination hosts
must be <br>
independent; they cannot be in the same replication
topology. mk-table-sync will die with an error if it detects
that a destination host is a slave because changes are
written <br>
directly to destination hosts (and it&rsquo;s not safe to
write directly to slaves). Or, if you specify
&quot;--replicate&quot; (but not
&quot;--sync-to-master&quot;) then mk-table-sync expects one
and <br>
only one master DSN on the command line. The tool will
automatically discover all the master&rsquo;s slaves and
sync them to the master. This is the only way to sync
several (all) <br>
slaves at once (because &quot;--sync-to-master&quot; only
specifies one slave).</p>

<p style="margin-top: 1em">Each host on the command line is
specified as a DSN. The first DSN (or only DSN for cases
like &quot;--sync-to-master&quot;) provides default values
for other DSNs, whether those other <br>
DSNs are specified on the command line or auto-discovered by
the tool. So in this example,</p>

<p style="margin-top: 1em">mk-table-sync --execute
h=host1,u=msandbox,p=msandbox h=host2</p>

<p style="margin-top: 1em">the host2 DSN inherits the
&quot;u&quot; and &quot;p&quot; DSN parts from the host1
DSN. Use the &quot;--explain-hosts&quot; option to see how
mk-table-sync will interpret the DSNs given on the command
line.</p>

<p style="margin-top: 1em">OUTPUT <br>
If you specify the &quot;--verbose&quot; option,
you&rsquo;ll see information about the differences between
the tables. There is one row per table. Each server is
printed separately. For <br>
example,</p>

<p style="margin-top: 1em"># Syncing h=host1,D=test,t=test1
<br>
# DELETE REPLACE INSERT UPDATE ALGORITHM START END EXIT
DATABASE.TABLE <br>
# 0 0 3 0 Chunk 13:00:00 13:00:17 2 test.test1</p>

<p style="margin-top: 1em">Table test.test1 on host1
required 3 &quot;INSERT&quot; statements to synchronize and
it used the Chunk algorithm (see &quot;ALGORITHMS&quot;).
The sync operation for this table started at 13:00:00 <br>
and ended 17 seconds later (times taken from
&quot;NOW()&quot; on the source host). Because differences
were found, its &quot;EXIT STATUS&quot; was 2.</p>

<p style="margin-top: 1em">If you specify the
&quot;--print&quot; option, you&rsquo;ll see the actual SQL
statements that the script uses to synchronize the table if
&quot;--execute&quot; is also specified.</p>

<p style="margin-top: 1em">If you want to see the SQL
statements that mk-table-sync is using to select chunks,
nibbles, rows, etc., then specify &quot;--print&quot; once
and &quot;--verbose&quot; twice. Be careful though: <br>
this can print a lot of SQL statements.</p>

<p style="margin-top: 1em">There are cases where no
combination of &quot;INSERT&quot;, &quot;UPDATE&quot; or
&quot;DELETE&quot; statements can resolve differences
without violating some unique key. For example, suppose
there&rsquo;s a <br>
primary key on column a and a unique key on column b. Then
there is no way to sync these two tables with
straightforward UPDATE statements:</p>

<p style="margin-top: 1em">+---+---+ +---+---+ <br>
| a | b | | a | b | <br>
+---+---+ +---+---+ <br>
| 1 | 2 | | 1 | 1 | <br>
| 2 | 1 | | 2 | 2 | <br>
+---+---+ +---+---+</p>

<p style="margin-top: 1em">The tool rewrites queries to
&quot;DELETE&quot; and &quot;REPLACE&quot; in this case.
This is automatically handled after the first index
violation, so you don&rsquo;t have to worry about it.</p>

<p style="margin-top: 1em">REPLICATION SAFETY <br>
Synchronizing a replication master and slave safely is a
non-trivial problem, in general. There are all sorts of
issues to think about, such as other processes changing
data, <br>
trying to change data on the slave, whether the destination
and source are a master-master pair, and much more.</p>

<p style="margin-top: 1em">In general, the safe way to do
it is to change the data on the master, and let the changes
flow through replication to the slave like any other
changes. However, this works only <br>
if it&rsquo;s possible to REPLACE into the table on the
master. REPLACE works only if there&rsquo;s a unique index
on the table (otherwise it just acts like an ordinary
INSERT).</p>

<p style="margin-top: 1em">If your table has unique keys,
you should use the &quot;--sync-to-master&quot; and/or
&quot;--replicate&quot; options to sync a slave to its
master. This will generally do the right thing. When <br>
there is no unique key on the table, there is no choice but
to change the data on the slave, and mk-table-sync will
detect that you&rsquo;re trying to do so. It will complain
and die <br>
unless you specify &quot;--no-check-slave&quot; (see
&quot;--[no]check-slave&quot;).</p>

<p style="margin-top: 1em">If you&rsquo;re syncing a table
without a primary or unique key on a master-master pair, you
must change the data on the destination server. Therefore,
you need to specify <br>
&quot;--no-bin-log&quot; for safety (see
&quot;--[no]bin-log&quot;). If you don&rsquo;t, the changes
you make on the destination server will replicate back to
the source server and change the data there!</p>

<p style="margin-top: 1em">The generally safe thing to do
on a master-master pair is to use the
&quot;--sync-to-master&quot; option so you don&rsquo;t
change the data on the destination server. You will also
need to <br>
specify &quot;--no-check-slave&quot; to keep mk-table-sync
from complaining that it is changing data on a slave.</p>

<p style="margin-top: 1em">ALGORITHMS <br>
mk-table-sync has a generic data-syncing framework which
uses different algorithms to find differences. The tool
automatically chooses the best algorithm for each table
based on <br>
indexes, column types, and the algorithm preferences
specified by &quot;--algorithms&quot;. The following
algorithms are available, listed in their default order of
preference:</p>

<p style="margin-top: 1em">Chunk <br>
Finds an index whose first column is numeric (including date
and time types), and divides the column&rsquo;s range of
values into chunks of approximately &quot;--chunk-size&quot;
rows. <br>
Syncs a chunk at a time by checksumming the entire chunk. If
the chunk differs on the source and destination, checksums
each chunk&rsquo;s rows individually to find the rows that
<br>
differ.</p>

<p style="margin-top: 1em">It is efficient when the column
has sufficient cardinality to make the chunks end up about
the right size.</p>

<p style="margin-top: 1em">The initial per-chunk checksum
is quite small and results in minimal network traffic and
memory consumption. If a chunk&rsquo;s rows must be
examined, only the primary key columns <br>
and a checksum are sent over the network, not the entire
row. If a row is found to be different, the entire row will
be fetched, but not before.</p>

<p style="margin-top: 1em">Nibble <br>
Finds an index and ascends the index in fixed-size nibbles
of &quot;--chunk-size&quot; rows, using a non-backtracking
algorithm (see mk-archiver for more on this algorithm). It
is <br>
very similar to &quot;Chunk&quot;, but instead of
pre-calculating the boundaries of each piece of the table
based on index cardinality, it uses &quot;LIMIT&quot; to
define each nibble&rsquo;s upper <br>
limit, and the previous nibble&rsquo;s upper limit to define
the lower limit.</p>

<p style="margin-top: 1em">It works in steps: one query
finds the row that will define the next nibble&rsquo;s upper
boundary, and the next query checksums the entire nibble. If
the nibble differs between <br>
the source and destination, it examines the nibble
row-by-row, just as &quot;Chunk&quot; does.</p>

<p style="margin-top: 1em">GroupBy <br>
Selects the entire table grouped by all columns, with a
COUNT(*) column added. Compares all columns, and if
they&rsquo;re the same, compares the COUNT(*) column&rsquo;s
value to <br>
determine how many rows to insert or delete into the
destination. Works on tables with no primary key or unique
index.</p>

<p style="margin-top: 1em">Stream <br>
Selects the entire table in one big stream and compares all
columns. Selects all columns. Much less efficient than the
other algorithms, but works when there is no suitable <br>
index for them to use.</p>

<p style="margin-top: 1em">Future Plans <br>
Possibilities for future algorithms are TempTable (what I
originally called bottom-up in earlier versions of this
tool), DrillDown (what I originally called top-down), and
<br>
GroupByPrefix (similar to how SqlYOG Job Agent works). Each
algorithm has strengths and weaknesses. If you&rsquo;d like
to implement your favorite technique for finding <br>
differences between two sources of data on possibly
different servers, I&rsquo;m willing to help. The algorithms
adhere to a simple interface that makes it pretty easy to
write <br>
your own.</p>

<p style="margin-top: 1em">BIDIRECTIONAL SYNCING <br>
Bidirectional syncing is a new, experimental feature. To
make it work reliably there are a number of strict
limitations:</p>

<p style="margin-top: 1em">* only works when syncing one
server to other independent servers <br>
* does not work in any way with replication <br>
* requires that the table(s) are chunkable with the Chunk
algorithm <br>
* is not N-way, only bidirectional between two servers at a
time <br>
* does not handle DELETE changes</p>

<p style="margin-top: 1em">For example, suppose we have
three servers: c1, r1, r2. c1 is the central server, a
pseudo-master to the other servers (viz. r1 and r2 are not
slaves to c1). r1 and r2 are <br>
remote servers. Rows in table foo are updated and inserted
on all three servers and we want to synchronize all the
changes between all the servers. Table foo has columns:</p>

<p style="margin-top: 1em">id int PRIMARY KEY <br>
ts timestamp auto updated <br>
name varchar</p>

<p style="margin-top: 1em">Auto-increment offsets are used
so that new rows from any server do not create conflicting
primary key (id) values. In general, newer rows, as
determined by the ts column, take <br>
precedence when a same but differing row is found during the
bidirectional sync. &quot;Same but differing&quot; means
that two rows have the same primary key (id) value but
different <br>
values for some other column, like the name column in this
example. Same but differing conflicts are resolved by a
&quot;conflict&quot;. A conflict compares some column of the
competing <br>
rows to determine a &quot;winner&quot;. The winning row
becomes the source and its values are used to update the
other row.</p>

<p style="margin-top: 1em">There are subtle differences
between three columns used to achieve bidirectional syncing
that you should be familiar with: chunk column
(&quot;--chunk-column&quot;), comparison column(s) <br>
(&quot;--columns&quot;), and conflict column
(&quot;--conflict-column&quot;). The chunk column is only
used to chunk the table; e.g. &quot;WHERE id &gt;= 5 AND id
&lt; 10&quot;. Chunks are checksummed and when <br>
chunk checksums reveal a difference, the tool selects the
rows in that chunk and checksums the &quot;--columns&quot;
for each row. If a column checksum differs, the rows have
one or more <br>
conflicting column values. In a traditional unidirectional
sync, the conflict is a moot point because it can be
resolved simply by updating the entire destination row with
the <br>
source row&rsquo;s values. In a bidirectional sync, however,
the &quot;--conflict-column&quot; (in accordance with other
&quot;--conflict-*&quot; options list below) is compared to
determine which row is <br>
&quot;correct&quot; or &quot;authoritative&quot;; this row
becomes the &quot;source&quot;.</p>

<p style="margin-top: 1em">To sync all three servers
completely, two runs of mk-table-sync are required. The
first run syncs c1 and r1, then syncs c1 and r2 including
any changes from r1. At this point <br>
c1 and r2 are completely in sync, but r1 is missing any
changes from r2 because c1 didn&rsquo;t have these changes
when it and r1 were synced. So a second run is needed which
syncs <br>
the servers in the same order, but this time when c1 and r1
are synced r1 gets r2&rsquo;s changes.</p>

<p style="margin-top: 1em">The tool does not sync N-ways,
only bidirectionally between the first DSN given on the
command line and each subsequent DSN in turn. So the tool in
this example would be ran <br>
twice like:</p>

<p style="margin-top: 1em">mk-table-sync --bidirectional
h=c1 h=r1 h=r2</p>

<p style="margin-top: 1em">The &quot;--bidirectional&quot;
option enables this feature and causes various sanity checks
to be performed. You must specify other options that tell
mk-table-sync how to resolve <br>
conflicts for same but differing rows. These options
are:</p>

<p style="margin-top: 1em">*
L&lt;&quot;--conflict-column&quot;&gt; <br>
* L&lt;&quot;--conflict-comparison&quot;&gt; <br>
* L&lt;&quot;--conflict-value&quot;&gt; <br>
* L&lt;&quot;--conflict-threshold&quot;&gt; <br>
* L&lt;&quot;--conflict-error&quot;&gt; (optional)</p>

<p style="margin-top: 1em">Use &quot;--print&quot; to test
this option before &quot;--execute&quot;. The printed SQL
statements will have comments saying on which host the
statement would be executed if you used
&quot;--execute&quot;.</p>

<p style="margin-top: 1em">Technical side note: the first
DSN is always the &quot;left&quot; server and the other DSNs
are always the &quot;right&quot; server. Since either server
can become the source or destination it&rsquo;s <br>
confusing to think of them as &quot;src&quot; and
&quot;dst&quot;. Therefore, they&rsquo;re generically
referred to as left and right. It&rsquo;s easy to remember
this because the first DSN is always to the <br>
left of the other server DSNs on the command line.</p>

<p style="margin-top: 1em">EXIT STATUS <br>
The following are the exit statuses (also called return
values, or return codes) when mk-table-sync finishes and
exits.</p>

<p style="margin-top: 1em">STATUS MEANING <br>
======
======================================================= <br>
0 Success. <br>
1 Internal error. <br>
2 At least one table differed on the destination. <br>
3 Combination of 1 and 2.</p>

<p style="margin-top: 1em">OPTIONS <br>
Specify at least one of &quot;--print&quot;,
&quot;--execute&quot;, or &quot;--dry-run&quot;.</p>

<p style="margin-top: 1em">&quot;--where&quot; and
&quot;--replicate&quot; are mutually exclusive.</p>

<p style="margin-top: 1em">This tool accepts additional
command-line arguments. Refer to the &quot;SYNOPSIS&quot;
and usage information for details.</p>

<p style="margin-top: 1em">--algorithms <br>
type: string; default: Chunk,Nibble,GroupBy,Stream</p>

<p style="margin-top: 1em">Algorithm to use when comparing
the tables, in order of preference.</p>

<p style="margin-top: 1em">For each table, mk-table-sync
will check if the table can be synced with the given
algorithms in the order that they&rsquo;re given. The first
algorithm that can sync the table is <br>
used. See &quot;ALGORITHMS&quot;.</p>

<p style="margin-top: 1em">--ask-pass <br>
Prompt for a password when connecting to MySQL.</p>

<p style="margin-top: 1em">--bidirectional <br>
Enable bidirectional sync between first and subsequent
hosts.</p>

<p style="margin-top: 1em">See &quot;BIDIRECTIONAL
SYNCING&quot; for more information.</p>

<p style="margin-top: 1em">--[no]bin-log <br>
default: yes</p>

<p style="margin-top: 1em">Log to the binary log (&quot;SET
SQL_LOG_BIN=1&quot;).</p>

<p style="margin-top: 1em">Specifying
&quot;--no-bin-log&quot; will &quot;SET
SQL_LOG_BIN=0&quot;.</p>

<p style="margin-top: 1em">--buffer-in-mysql <br>
Instruct MySQL to buffer queries in its memory.</p>

<p style="margin-top: 1em">This option adds the
&quot;SQL_BUFFER_RESULT&quot; option to the comparison
queries. This causes MySQL to execute the queries and place
them in a temporary table internally before <br>
sending the results back to mk-table-sync. The advantage of
this strategy is that mk-table-sync can fetch rows as
desired without using a lot of memory inside the Perl <br>
process, while releasing locks on the MySQL table (to reduce
contention with other queries). The disadvantage is that it
uses more memory on the MySQL server instead.</p>

<p style="margin-top: 1em">You probably want to leave
&quot;--[no]buffer-to-client&quot; enabled too, because
buffering into a temp table and then fetching it all into
Perl&rsquo;s memory is probably a silly thing to <br>
do. This option is most useful for the GroupBy and Stream
algorithms, which may fetch a lot of data from the
server.</p>

<p style="margin-top: 1em">--[no]buffer-to-client <br>
default: yes</p>

<p style="margin-top: 1em">Fetch rows one-by-one from MySQL
while comparing.</p>

<p style="margin-top: 1em">This option enables
&quot;mysql_use_result&quot; which causes MySQL to hold the
selected rows on the server until the tool fetches them.
This allows the tool to use less memory but <br>
may keep the rows locked on the server longer.</p>

<p style="margin-top: 1em">If this option is disabled by
specifying &quot;--no-buffer-to-client&quot; then
&quot;mysql_store_result&quot; is used which causes MySQL to
send all selected rows to the tool at once. This may <br>
result in the results &quot;cursor&quot; being held open for
a shorter time on the server, but if the tables are large,
it could take a long time anyway, and use all your
memory.</p>

<p style="margin-top: 1em">For most non-trivial data sizes,
you want to leave this option enabled.</p>

<p style="margin-top: 1em">This option is disabled when
&quot;--bidirectional&quot; is used.</p>

<p style="margin-top: 1em">--charset <br>
short form: -A; type: string</p>

<p style="margin-top: 1em">Default character set. If the
value is utf8, sets Perl&rsquo;s binmode on STDOUT to utf8,
passes the mysql_enable_utf8 option to DBD::mysql, and runs
SET NAMES UTF8 after <br>
connecting to MySQL. Any other value sets binmode on STDOUT
without the utf8 layer, and runs SET NAMES after connecting
to MySQL.</p>

<p style="margin-top: 1em">--[no]check-master <br>
default: yes</p>

<p style="margin-top: 1em">With
&quot;--sync-to-master&quot;, try to verify that the
detected master is the real master.</p>

<p style="margin-top: 1em">--[no]check-privileges <br>
default: yes</p>

<p style="margin-top: 1em">Check that user has all
necessary privileges on source and destination table.</p>

<p style="margin-top: 1em">--[no]check-slave <br>
default: yes</p>

<p style="margin-top: 1em">Check whether the destination
server is a slave.</p>

<p style="margin-top: 1em">If the destination server is a
slave, it&rsquo;s generally unsafe to make changes on it.
However, sometimes you have to; &quot;--replace&quot;
won&rsquo;t work unless there&rsquo;s a unique index, for
<br>
example, so you can&rsquo;t make changes on the master in
that scenario. By default mk-table-sync will complain if you
try to change data on a slave. Specify
&quot;--no-check-slave&quot; <br>
to disable this check. Use it at your own risk.</p>

<p style="margin-top: 1em">--[no]check-triggers <br>
default: yes</p>

<p style="margin-top: 1em">Check that no triggers are
defined on the destination table.</p>

<p style="margin-top: 1em">Triggers were introduced in
MySQL v5.0.2, so for older versions this option has no
effect because triggers will not be checked.</p>

<p style="margin-top: 1em">--chunk-column <br>
type: string</p>

<p style="margin-top: 1em">Chunk the table on this
column.</p>

<p style="margin-top: 1em">--chunk-index <br>
type: string</p>

<p style="margin-top: 1em">Chunk the table using this
index.</p>

<p style="margin-top: 1em">--chunk-size <br>
type: string; default: 1000</p>

<p style="margin-top: 1em">Number of rows or data size per
chunk.</p>

<p style="margin-top: 1em">The size of each chunk of rows
for the &quot;Chunk&quot; and &quot;Nibble&quot; algorithms.
The size can be either a number of rows, or a data size.
Data sizes are specified with a suffix of <br>
k=kibibytes, M=mebibytes, G=gibibytes. Data sizes are
converted to a number of rows by dividing by the average row
length.</p>

<p style="margin-top: 1em">--columns <br>
short form: -c; type: array</p>

<p style="margin-top: 1em">Compare this comma-separated
list of columns.</p>

<p style="margin-top: 1em">--config <br>
type: Array</p>

<p style="margin-top: 1em">Read this comma-separated list
of config files; if specified, this must be the first option
on the command line.</p>

<p style="margin-top: 1em">--conflict-column <br>
type: string</p>

<p style="margin-top: 1em">Compare this column when rows
conflict during a &quot;--bidirectional&quot; sync.</p>

<p style="margin-top: 1em">When a same but differing row is
found the value of this column from each row is compared
according to &quot;--conflict-comparison&quot;,
&quot;--conflict-value&quot; and
&quot;--conflict-threshold&quot; <br>
to determine which row has the correct data and becomes the
source. The column can be any type for which there is an
appropriate &quot;--conflict-comparison&quot; (this is
almost all <br>
types except, for example, blobs).</p>

<p style="margin-top: 1em">This option only works with
&quot;--bidirectional&quot;. See &quot;BIDIRECTIONAL
SYNCING&quot; for more information.</p>

<p style="margin-top: 1em">--conflict-comparison <br>
type: string</p>

<p style="margin-top: 1em">Choose the
&quot;--conflict-column&quot; with this property as the
source.</p>

<p style="margin-top: 1em">The option affects how the
&quot;--conflict-column&quot; values from the conflicting
rows are compared. Possible comparisons are one of these
MAGIC_comparisons:</p>


<p style="margin-top: 1em">newest|oldest|greatest|least|equals|matches</p>

<p style="margin-top: 1em">COMPARISON CHOOSES ROW WITH <br>
==========
=========================================================
<br>
newest Newest temporal
L&lt;&quot;--conflict-column&quot;&gt; value <br>
oldest Oldest temporal
L&lt;&quot;--conflict-column&quot;&gt; value <br>
greatest Greatest numerical
L&lt;&quot;--conflict-column&quot;&gt; value <br>
least Least numerical L&lt;&quot;--conflict-column&quot;&gt;
value <br>
equals L&lt;&quot;--conflict-column&quot;&gt; value equal to
L&lt;&quot;--conflict-value&quot;&gt; <br>
matches L&lt;&quot;--conflict-column&quot;&gt; value
matching Perl regex pattern <br>
L&lt;&quot;--conflict-value&quot;&gt;</p>

<p style="margin-top: 1em">This option only works with
&quot;--bidirectional&quot;. See &quot;BIDIRECTIONAL
SYNCING&quot; for more information.</p>

<p style="margin-top: 1em">--conflict-error <br>
type: string; default: warn</p>

<p style="margin-top: 1em">How to report unresolvable
conflicts and conflict errors</p>

<p style="margin-top: 1em">This option changes how the user
is notified when a conflict cannot be resolved or causes
some kind of error. Possible values are:</p>

<p style="margin-top: 1em">* warn: Print a warning to
STDERR about the unresolvable conflict <br>
* die: Die, stop syncing, and print a warning to STDERR</p>

<p style="margin-top: 1em">This option only works with
&quot;--bidirectional&quot;. See &quot;BIDIRECTIONAL
SYNCING&quot; for more information.</p>

<p style="margin-top: 1em">--conflict-threshold <br>
type: string</p>

<p style="margin-top: 1em">Amount by which one
&quot;--conflict-column&quot; must exceed the other.</p>

<p style="margin-top: 1em">The
&quot;--conflict-threshold&quot; prevents a conflict from
being resolved if the absolute difference between the two
&quot;--conflict-column&quot; values is less than this
amount. For <br>
example, if two &quot;--conflict-column&quot; have timestamp
values &quot;2009-12-01 12:00:00&quot; and &quot;2009-12-01
12:05:00&quot; the difference is 5 minutes. If
&quot;--conflict-threshold&quot; is set to <br>
&quot;5m&quot; the conflict will be resolved, but if
&quot;--conflict-threshold&quot; is set to &quot;6m&quot;
the conflict will fail to resolve because the difference is
not greater than or equal to 6 <br>
minutes. In this latter case, &quot;--conflict-error&quot;
will report the failure.</p>

<p style="margin-top: 1em">This option only works with
&quot;--bidirectional&quot;. See &quot;BIDIRECTIONAL
SYNCING&quot; for more information.</p>

<p style="margin-top: 1em">--conflict-value <br>
type: string</p>

<p style="margin-top: 1em">Use this value for certain
&quot;--conflict-comparison&quot;.</p>

<p style="margin-top: 1em">This option gives the value for
&quot;equals&quot; and &quot;matches&quot;
&quot;--conflict-comparison&quot;.</p>

<p style="margin-top: 1em">This option only works with
&quot;--bidirectional&quot;. See &quot;BIDIRECTIONAL
SYNCING&quot; for more information.</p>

<p style="margin-top: 1em">--databases <br>
short form: -d; type: hash</p>

<p style="margin-top: 1em">Sync only this comma-separated
list of databases.</p>

<p style="margin-top: 1em">A common request is to sync
tables from one database with tables from another database
on the same or different server. This is not yet possible.
&quot;--databases&quot; will not do <br>
it, and you can&rsquo;t do it with the D part of the DSN
either because in the absence of a table name it assumes the
whole server should be synced and the D part controls only
the <br>
connection&rsquo;s default database.</p>

<p style="margin-top: 1em">--defaults-file <br>
short form: -F; type: string</p>

<p style="margin-top: 1em">Only read mysql options from the
given file. You must give an absolute pathname.</p>

<p style="margin-top: 1em">--dry-run <br>
Analyze, decide the sync algorithm to use, print and
exit.</p>

<p style="margin-top: 1em">Implies &quot;--verbose&quot; so
you can see the results. The results are in the same output
format that you&rsquo;ll see from actually running the tool,
but there will be zeros for rows <br>
affected. This is because the tool actually executes, but
stops before it compares any data and just returns zeros.
The zeros do not mean there are no changes to be made.</p>

<p style="margin-top: 1em">--engines <br>
short form: -e; type: hash</p>

<p style="margin-top: 1em">Sync only this comma-separated
list of storage engines.</p>

<p style="margin-top: 1em">--execute <br>
Execute queries to make the tables have identical data.</p>

<p style="margin-top: 1em">This option makes mk-table-sync
actually sync table data by executing all the queries that
it created to resolve table differences. Therefore, the
tables will be changed! <br>
And unless you also specify &quot;--verbose&quot;, the
changes will be made silently. If this is not what you want,
see &quot;--print&quot; or &quot;--dry-run&quot;.</p>

<p style="margin-top: 1em">--explain-hosts <br>
Print connection information and exit.</p>

<p style="margin-top: 1em">Print out a list of hosts to
which mk-table-sync will connect, with all the various
connection options, and exit.</p>

<p style="margin-top: 1em">--float-precision <br>
type: int</p>

<p style="margin-top: 1em">Precision for &quot;FLOAT&quot;
and &quot;DOUBLE&quot; number-to-string conversion. Causes
FLOAT and DOUBLE values to be rounded to the specified
number of digits after the decimal point, with <br>
the ROUND() function in MySQL. This can help avoid checksum
mismatches due to different floating-point representations
of the same values on different MySQL versions and <br>
hardware. The default is no rounding; the values are
converted to strings by the CONCAT() function, and MySQL
chooses the string representation. If you specify a value of
<br>
2, for example, then the values 1.008 and 1.009 will be
rounded to 1.01, and will checksum as equal.</p>

<p style="margin-top: 1em">--[no]foreign-key-checks <br>
default: yes</p>

<p style="margin-top: 1em">Enable foreign key checks
(&quot;SET FOREIGN_KEY_CHECKS=1&quot;).</p>

<p style="margin-top: 1em">Specifying
&quot;--no-foreign-key-checks&quot; will &quot;SET
FOREIGN_KEY_CHECKS=0&quot;.</p>

<p style="margin-top: 1em">--function <br>
type: string</p>

<p style="margin-top: 1em">Which hash function you&rsquo;d
like to use for checksums.</p>

<p style="margin-top: 1em">The default is
&quot;CRC32&quot;. Other good choices include
&quot;MD5&quot; and &quot;SHA1&quot;. If you have installed
the &quot;FNV_64&quot; user-defined function,
&quot;mk-table-sync&quot; will detect it and prefer to <br>
use it, because it is much faster than the built-ins. You
can also use MURMUR_HASH if you&rsquo;ve installed that
user-defined function. Both of these are distributed with
<br>
Maatkit. See mk-table-checksum for more information and
benchmarks.</p>

<p style="margin-top: 1em">--help <br>
Show help and exit.</p>

<p style="margin-top: 1em">--[no]hex-blob <br>
default: yes</p>

<p style="margin-top: 1em">&quot;HEX()&quot;
&quot;BLOB&quot;, &quot;TEXT&quot; and &quot;BINARY&quot;
columns.</p>

<p style="margin-top: 1em">When row data from the source is
fetched to create queries to sync the data (i.e. the queries
seen with &quot;--print&quot; and executed by
&quot;--execute&quot;), binary columns are wrapped in <br>
HEX() so the binary data does not produce an invalid SQL
statement. You can disable this option but you probably
shouldn&rsquo;t.</p>

<p style="margin-top: 1em">--host <br>
short form: -h; type: string</p>

<p style="margin-top: 1em">Connect to host.</p>

<p style="margin-top: 1em">--ignore-columns <br>
type: Hash</p>

<p style="margin-top: 1em">Ignore this comma-separated list
of column names in comparisons.</p>

<p style="margin-top: 1em">This option causes columns not
to be compared. However, if a row is determined to differ
between tables, all columns in that row will be synced,
regardless. (It is not <br>
currently possible to exclude columns from the sync process
itself, only from the comparison.)</p>

<p style="margin-top: 1em">--ignore-databases <br>
type: Hash</p>

<p style="margin-top: 1em">Ignore this comma-separated list
of databases.</p>

<p style="margin-top: 1em">--ignore-engines <br>
type: Hash; default: FEDERATED,MRG_MyISAM</p>

<p style="margin-top: 1em">Ignore this comma-separated list
of storage engines.</p>

<p style="margin-top: 1em">--ignore-tables <br>
type: Hash</p>

<p style="margin-top: 1em">Ignore this comma-separated list
of tables.</p>

<p style="margin-top: 1em">Table names may be qualified
with the database name.</p>

<p style="margin-top: 1em">--[no]index-hint <br>
default: yes</p>

<p style="margin-top: 1em">Add FORCE/USE INDEX hints to the
chunk and row queries.</p>

<p style="margin-top: 1em">By default
&quot;mk-table-sync&quot; adds a FORCE/USE INDEX hint to
each SQL statement to coerce MySQL into using the index
chosen by the sync algorithm or specified by <br>
&quot;--chunk-index&quot;. This is usually a good thing, but
in rare cases the index may not be the best for the query so
you can suppress the index hint by specifying <br>
&quot;--no-index-hint&quot; and let MySQL choose the
index.</p>

<p style="margin-top: 1em">This does not affect the queries
printed by &quot;--print&quot;; it only affects the chunk
and row queries that &quot;mk-table-sync&quot; uses to
select and compare rows.</p>

<p style="margin-top: 1em">--lock <br>
type: int</p>

<p style="margin-top: 1em">Lock tables: 0=none, 1=per sync
cycle, 2=per table, or 3=globally.</p>

<p style="margin-top: 1em">This uses &quot;LOCK
TABLES&quot;. This can help prevent tables being changed
while you&rsquo;re examining them. The possible values are
as follows:</p>

<p style="margin-top: 1em">VALUE MEANING <br>
=====
======================================================= <br>
0 Never lock tables. <br>
1 Lock and unlock one time per sync cycle (as implemented
<br>
by the syncing algorithm). This is the most granular <br>
level of locking available. For example, the Chunk <br>
algorithm will lock each chunk of C&lt;N&gt; rows, and then
<br>
unlock them if they are the same on the source and the <br>
destination, before moving on to the next chunk. <br>
2 Lock and unlock before and after each table. <br>
3 Lock and unlock once for every server (DSN) synced, with
<br>
C&lt;FLUSH TABLES WITH READ LOCK&gt;.</p>

<p style="margin-top: 1em">A replication slave is never
locked if &quot;--replicate&quot; or
&quot;--sync-to-master&quot; is specified, since in theory
locking the table on the master should prevent any changes
from <br>
taking place. (You are not changing data on your slave,
right?) If &quot;--wait&quot; is given, the master (source)
is locked and then the tool waits for the slave to catch up
to the <br>
master before continuing.</p>

<p style="margin-top: 1em">If &quot;--transaction&quot; is
specified, &quot;LOCK TABLES&quot; is not used. Instead,
lock and unlock are implemented by beginning and committing
transactions. The exception is if &quot;--lock&quot; <br>
is 3.</p>

<p style="margin-top: 1em">If &quot;--no-transaction&quot;
is specified, then &quot;LOCK TABLES&quot; is used for any
value of &quot;--lock&quot;. See
&quot;--[no]transaction&quot;.</p>

<p style="margin-top: 1em">--lock-and-rename <br>
Lock the source and destination table, sync, then swap
names. This is useful as a less-blocking ALTER TABLE, once
the tables are reasonably in sync with each other (which
<br>
you may choose to accomplish via any number of means,
including dump and reload or even something like
mk-archiver). It requires exactly two DSNs and assumes they
are on the <br>
same server, so it does no waiting for replication or the
like. Tables are locked with LOCK TABLES.</p>

<p style="margin-top: 1em">--password <br>
short form: -p; type: string</p>

<p style="margin-top: 1em">Password to use when
connecting.</p>

<p style="margin-top: 1em">--pid <br>
type: string</p>

<p style="margin-top: 1em">Create the given PID file. The
file contains the process ID of the script. The PID file is
removed when the script exits. Before starting, the script
checks if the PID <br>
file already exists. If it does not, then the script creates
and writes its own PID to it. If it does, then the script
checks the following: if the file contains a PID and <br>
a process is running with that PID, then the script dies;
or, if there is no process running with that PID, then the
script overwrites the file with its own PID and starts; <br>
else, if the file contains no PID, then the script dies.</p>

<p style="margin-top: 1em">--port <br>
short form: -P; type: int</p>

<p style="margin-top: 1em">Port number to use for
connection.</p>

<p style="margin-top: 1em">--print <br>
Print queries that will resolve differences.</p>

<p style="margin-top: 1em">If you don&rsquo;t trust
&quot;mk-table-sync&quot;, or just want to see what it will
do, this is a good way to be safe. These queries are valid
SQL and you can run them yourself if you want <br>
to sync the tables manually.</p>

<p style="margin-top: 1em">--recursion-method <br>
type: string</p>

<p style="margin-top: 1em">Preferred recursion method used
to find slaves.</p>

<p style="margin-top: 1em">Possible methods are:</p>

<p style="margin-top: 1em">METHOD USES <br>
=========== ================ <br>
processlist SHOW PROCESSLIST <br>
hosts SHOW SLAVE HOSTS</p>

<p style="margin-top: 1em">The processlist method is
preferred because SHOW SLAVE HOSTS is not reliable. However,
the hosts method is required if the server uses a
non-standard port (not 3306). <br>
Usually mk-table-sync does the right thing and finds the
slaves, but you may give a preferred method and it will be
used first. If it doesn&rsquo;t find any slaves, the other
<br>
methods will be tried.</p>

<p style="margin-top: 1em">--replace <br>
Write all &quot;INSERT&quot; and &quot;UPDATE&quot;
statements as &quot;REPLACE&quot;.</p>

<p style="margin-top: 1em">This is automatically switched
on as needed when there are unique index violations.</p>

<p style="margin-top: 1em">--replicate <br>
type: string</p>

<p style="margin-top: 1em">Sync tables listed as different
in this table.</p>

<p style="margin-top: 1em">Specifies that
&quot;mk-table-sync&quot; should examine the specified table
to find data that differs. The table is exactly the same as
the argument of the same name to mk-table- <br>
checksum. That is, it contains records of which tables (and
ranges of values) differ between the master and slave.</p>

<p style="margin-top: 1em">For each table and range of
values that shows differences between the master and slave,
&quot;mk-table-checksum&quot; will sync that table, with the
appropriate &quot;WHERE&quot; clause, to its <br>
master.</p>

<p style="margin-top: 1em">This automatically sets
&quot;--wait&quot; to 60 and causes changes to be made on
the master instead of the slave.</p>

<p style="margin-top: 1em">If &quot;--sync-to-master&quot;
is specified, the tool will assume the server you specified
is the slave, and connect to the master as usual to
sync.</p>

<p style="margin-top: 1em">Otherwise, it will try to use
&quot;SHOW PROCESSLIST&quot; to find slaves of the server
you specified. If it is unable to find any slaves via
&quot;SHOW PROCESSLIST&quot;, it will inspect &quot;SHOW
<br>
SLAVE HOSTS&quot; instead. You must configure each
slave&rsquo;s &quot;report-host&quot;,
&quot;report-port&quot; and other options for this to work
right. After finding slaves, it will inspect the <br>
specified table on each slave to find data that needs to be
synced, and sync it.</p>

<p style="margin-top: 1em">The tool examines the
master&rsquo;s copy of the table first, assuming that the
master is potentially a slave as well. Any table that shows
differences there will NOT be synced on <br>
the slave(s). For example, suppose your replication is set
up as A-&gt;B, B-&gt;C, B-&gt;D. Suppose you use this
argument and specify server B. The tool will examine server
B&rsquo;s <br>
copy of the table. If it looks like server B&rsquo;s data in
table &quot;test.tbl1&quot; is different from server
A&rsquo;s copy, the tool will not sync that table on servers
C and D.</p>

<p style="margin-top: 1em">--set-vars <br>
type: string; default: wait_timeout=10000</p>

<p style="margin-top: 1em">Set these MySQL variables.
Immediately after connecting to MySQL, this string will be
appended to SET and executed.</p>

<p style="margin-top: 1em">--socket <br>
short form: -S; type: string</p>

<p style="margin-top: 1em">Socket file to use for
connection.</p>

<p style="margin-top: 1em">--sync-to-master <br>
Treat the DSN as a slave and sync it to its master.</p>

<p style="margin-top: 1em">Treat the server you specified
as a slave. Inspect &quot;SHOW SLAVE STATUS&quot;, connect
to the server&rsquo;s master, and treat the master as the
source and the slave as the destination. <br>
Causes changes to be made on the master. Sets
&quot;--wait&quot; to 60 by default, sets &quot;--lock&quot;
to 1 by default, and disables &quot;--[no]transaction&quot;
by default. See also &quot;--replicate&quot;, <br>
which changes this option&rsquo;s behavior.</p>

<p style="margin-top: 1em">--tables <br>
short form: -t; type: hash</p>

<p style="margin-top: 1em">Sync only this comma-separated
list of tables.</p>

<p style="margin-top: 1em">Table names may be qualified
with the database name.</p>

<p style="margin-top: 1em">--timeout-ok <br>
Keep going if &quot;--wait&quot; fails.</p>

<p style="margin-top: 1em">If you specify
&quot;--wait&quot; and the slave doesn&rsquo;t catch up to
the master&rsquo;s position before the wait times out, the
default behavior is to abort. This option makes the tool
keep <br>
going anyway. Warning: if you are trying to get a consistent
comparison between the two servers, you probably don&rsquo;t
want to keep going after a timeout.</p>

<p style="margin-top: 1em">--[no]transaction <br>
Use transactions instead of &quot;LOCK TABLES&quot;.</p>

<p style="margin-top: 1em">The granularity of beginning and
committing transactions is controlled by &quot;--lock&quot;.
This is enabled by default, but since &quot;--lock&quot; is
disabled by default, it has no effect.</p>

<p style="margin-top: 1em">Most options that enable locking
also disable transactions by default, so if you want to use
transactional locking (via &quot;LOCK IN SHARE MODE&quot;
and &quot;FOR UPDATE&quot;, you must <br>
specify &quot;--transaction&quot; explicitly.</p>

<p style="margin-top: 1em">If you don&rsquo;t specify
&quot;--transaction&quot; explicitly
&quot;mk-table-sync&quot; will decide on a per-table basis
whether to use transactions or table locks. It currently
uses transactions <br>
on InnoDB tables, and table locks on all others.</p>

<p style="margin-top: 1em">If &quot;--no-transaction&quot;
is specified, then &quot;mk-table-sync&quot; will not use
transactions at all (not even for InnoDB tables) and locking
is controlled by &quot;--lock&quot;.</p>

<p style="margin-top: 1em">When enabled, either explicitly
or implicitly, the transaction isolation level is set
&quot;REPEATABLE READ&quot; and transactions are started
&quot;WITH CONSISTENT SNAPSHOT&quot;.</p>

<p style="margin-top: 1em">--trim <br>
&quot;TRIM()&quot; &quot;VARCHAR&quot; columns in
&quot;BIT_XOR&quot; and &quot;ACCUM&quot; modes. Helps when
comparing MySQL 4.1 to &gt;= 5.0.</p>

<p style="margin-top: 1em">This is useful when you
don&rsquo;t care about the trailing space differences
between MySQL versions which vary in their handling of
trailing spaces. MySQL 5.0 and later all retain <br>
trailing spaces in &quot;VARCHAR&quot;, while previous
versions would remove them.</p>

<p style="margin-top: 1em">--[no]unique-checks <br>
default: yes</p>

<p style="margin-top: 1em">Enable unique key checks
(&quot;SET UNIQUE_CHECKS=1&quot;).</p>

<p style="margin-top: 1em">Specifying
&quot;--no-unique-checks&quot; will &quot;SET
UNIQUE_CHECKS=0&quot;.</p>

<p style="margin-top: 1em">--user <br>
short form: -u; type: string</p>

<p style="margin-top: 1em">User for login if not current
user.</p>

<p style="margin-top: 1em">--verbose <br>
short form: -v; cumulative: yes</p>

<p style="margin-top: 1em">Print results of sync
operations.</p>

<p style="margin-top: 1em">See &quot;OUTPUT&quot; for more
details about the output.</p>

<p style="margin-top: 1em">--version <br>
Show version and exit.</p>

<p style="margin-top: 1em">--wait <br>
short form: -w; type: time</p>

<p style="margin-top: 1em">How long to wait for slaves to
catch up to their master.</p>

<p style="margin-top: 1em">Make the master wait for the
slave to catch up in replication before comparing the
tables. The value is the number of seconds to wait before
timing out (see also <br>
&quot;--timeout-ok&quot;). Sets &quot;--lock&quot; to 1 and
&quot;--[no]transaction&quot; to 0 by default. If you see an
error such as the following,</p>

<p style="margin-top: 1em">MASTER_POS_WAIT returned -1</p>

<p style="margin-top: 1em">It means the timeout was
exceeded and you need to increase it.</p>

<p style="margin-top: 1em">The default value of this option
is influenced by other options. To see what value is in
effect, run with &quot;--help&quot;.</p>

<p style="margin-top: 1em">To disable waiting entirely
(except for locks), specify &quot;--wait&quot; 0. This helps
when the slave is lagging on tables that are not being
synced.</p>

<p style="margin-top: 1em">--where <br>
type: string</p>

<p style="margin-top: 1em">&quot;WHERE&quot; clause to
restrict syncing to part of the table.</p>

<p style="margin-top: 1em">--[no]zero-chunk <br>
default: yes</p>

<p style="margin-top: 1em">Add a chunk for rows with zero
or zero-equivalent values. The only has an effect when
&quot;--chunk-size&quot; is specified. The purpose of the
zero chunk is to capture a potentially <br>
large number of zero values that would imbalance the size of
the first chunk. For example, if a lot of negative numbers
were inserted into an unsigned integer column causing <br>
them to be stored as zeros, then these zero values are
captured by the zero chunk instead of the first chunk and
all its non-zero values.</p>

<p style="margin-top: 1em">DSN OPTIONS <br>
These DSN options are used to create a DSN. Each option is
given like &quot;option=value&quot;. The options are
case-sensitive, so P and p are not the same option. There
cannot be <br>
whitespace before or after the &quot;=&quot; and if the
value contains whitespace it must be quoted. DSN options are
comma-separated. See the maatkit manpage for full
details.</p>

<p style="margin-top: 1em">&Acirc;&middot; A</p>

<p style="margin-top: 1em">dsn: charset; copy: yes</p>

<p style="margin-top: 1em">Default character set.</p>

<p style="margin-top: 1em">&Acirc;&middot; D</p>

<p style="margin-top: 1em">dsn: database; copy: yes</p>

<p style="margin-top: 1em">Database containing the table to
be synced.</p>

<p style="margin-top: 1em">&Acirc;&middot; F</p>

<p style="margin-top: 1em">dsn: mysql_read_default_file;
copy: yes</p>

<p style="margin-top: 1em">Only read default options from
the given file</p>

<p style="margin-top: 1em">&Acirc;&middot; h</p>

<p style="margin-top: 1em">dsn: host; copy: yes</p>

<p style="margin-top: 1em">Connect to host.</p>

<p style="margin-top: 1em">&Acirc;&middot; p</p>

<p style="margin-top: 1em">dsn: password; copy: yes</p>

<p style="margin-top: 1em">Password to use when
connecting.</p>

<p style="margin-top: 1em">&Acirc;&middot; P</p>

<p style="margin-top: 1em">dsn: port; copy: yes</p>

<p style="margin-top: 1em">Port number to use for
connection.</p>

<p style="margin-top: 1em">&Acirc;&middot; S</p>

<p style="margin-top: 1em">dsn: mysql_socket; copy: yes</p>

<p style="margin-top: 1em">Socket file to use for
connection.</p>

<p style="margin-top: 1em">&Acirc;&middot; t</p>

<p style="margin-top: 1em">copy: yes</p>

<p style="margin-top: 1em">Table to be synced.</p>

<p style="margin-top: 1em">&Acirc;&middot; u</p>

<p style="margin-top: 1em">dsn: user; copy: yes</p>

<p style="margin-top: 1em">User for login if not current
user.</p>

<p style="margin-top: 1em">DOWNLOADING <br>
You can download Maatkit from Google Code at
&lt;http://code.google.com/p/maatkit/&gt;, or you can get
any of the tools easily with a command like the
following:</p>

<p style="margin-top: 1em">wget
http://www.maatkit.org/get/toolname <br>
or <br>
wget http://www.maatkit.org/trunk/toolname</p>

<p style="margin-top: 1em">Where &quot;toolname&quot; can
be replaced with the name (or fragment of a name) of any of
the Maatkit tools. Once downloaded, they&rsquo;re ready to
run; no installation is needed. The first <br>
URL gets the latest released version of the tool, and the
second gets the latest trunk code from Subversion.</p>

<p style="margin-top: 1em">ENVIRONMENT <br>
The environment variable MKDEBUG enables verbose debugging
output in all of the Maatkit tools:</p>

<p style="margin-top: 1em">MKDEBUG=1 mk-....</p>

<p style="margin-top: 1em">SYSTEM REQUIREMENTS <br>
You need Perl, DBI, DBD::mysql, and some core packages that
ought to be installed in any reasonably new version of
Perl.</p>

<p style="margin-top: 1em">BUGS <br>
For a list of known bugs see:
&lt;http://www.maatkit.org/bugs/mk-table-sync&gt;.</p>

<p style="margin-top: 1em">Please use Google Code Issues
and Groups to report bugs or request support:
&lt;http://code.google.com/p/maatkit/&gt;. You can also join
#maatkit on Freenode to discuss Maatkit.</p>

<p style="margin-top: 1em">Please include the complete
command-line used to reproduce the problem you are seeing,
the version of all MySQL servers involved, the complete
output of the tool when run with <br>
&quot;--version&quot;, and if possible, debugging output
produced by running with the &quot;MKDEBUG=1&quot;
environment variable.</p>

<p style="margin-top: 1em">COPYRIGHT, LICENSE AND WARRANTY
<br>
This program is copyright 2007-2011 Baron Schwartz. Feedback
and improvements are welcome.</p>

<p style="margin-top: 1em">THIS PROGRAM IS PROVIDED
&quot;AS IS&quot; AND WITHOUT ANY EXPRESS OR IMPLIED
WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A <br>
PARTICULAR PURPOSE.</p>

<p style="margin-top: 1em">This program is free software;
you can redistribute it and/or modify it under the terms of
the GNU General Public License as published by the Free
Software Foundation, version 2; <br>
OR the Perl Artistic License. On UNIX and similar systems,
you can issue &lsquo;man perlgpl&rsquo; or &lsquo;man
perlartistic&rsquo; to read these licenses.</p>

<p style="margin-top: 1em">You should have received a copy
of the GNU General Public License along with this program;
if not, write to the Free Software Foundation, Inc., 59
Temple Place, Suite 330, <br>
Boston, MA 02111-1307 USA.</p>

<p style="margin-top: 1em">AUTHOR <br>
Baron Schwartz</p>

<p style="margin-top: 1em">ABOUT MAATKIT <br>
This tool is part of Maatkit, a toolkit for power users of
MySQL. Maatkit was created by Baron Schwartz; Baron and
Daniel Nichter are the primary code contributors. Both are
<br>
employed by Percona. Financial support for Maatkit
development is primarily provided by Percona and its
clients.</p>

<p style="margin-top: 1em">HISTORY AND ACKNOWLEDGMENTS <br>
My work is based in part on Giuseppe Maxia&rsquo;s work on
distributed databases,
&lt;http://www.sysadminmag.com/articles/2004/0408/&gt; and
code derived from that article. There is more <br>
explanation, and a link to the code, at
&lt;http://www.perlmonks.org/?node_id=381053&gt;.</p>

<p style="margin-top: 1em">Another programmer extended
Maxia&rsquo;s work even further. Fabien Coelho changed and
generalized Maxia&rsquo;s technique, introducing symmetry
and avoiding some problems that might have <br>
caused too-frequent checksum collisions. This work grew into
pg_comparator, &lt;http://www.coelho.net/pg_comparator/&gt;.
Coelho also explained the technique further in a paper <br>
titled &quot;Remote Comparison of Database Tables&quot;
(&lt;http://cri.ensmp.fr/classement/doc/A-375.pdf&gt;).</p>

<p style="margin-top: 1em">This existing literature mostly
addressed how to find the differences between the tables,
not how to resolve them once found. I needed a tool that
would not only find them <br>
efficiently, but would then resolve them. I first began
thinking about how to improve the technique further with my
article
&lt;http://tinyurl.com/mysql-data-diff-algorithm&gt;, where
<br>
I discussed a number of problems with the Maxia/Coelho
&quot;bottom-up&quot; algorithm. After writing that article,
I began to write this tool. I wanted to actually implement
their <br>
algorithm with some improvements so I was sure I understood
it completely. I discovered it is not what I thought it was,
and is considerably more complex than it appeared to me <br>
at first. Fabien Coelho was kind enough to address some
questions over email.</p>

<p style="margin-top: 1em">The first versions of this tool
implemented a version of the Coelho/Maxia algorithm, which I
called &quot;bottom-up&quot;, and my own, which I called
&quot;top-down.&quot; Those algorithms are <br>
considerably more complex than the current algorithms and I
have removed them from this tool, and may add them back
later. The improvements to the bottom-up algorithm are my
<br>
original work, as is the top-down algorithm. The techniques
to actually resolve the differences are also my own
work.</p>

<p style="margin-top: 1em">Another tool that can
synchronize tables is the SQLyog Job Agent from webyog.
Thanks to Rohit Nadhani, SJA&rsquo;s author, for the
conversations about the general techniques. There <br>
is a comparison of mk-table-sync and SJA at
&lt;http://tinyurl.com/maatkit-vs-sqlyog&gt;</p>

<p style="margin-top: 1em">Thanks to the following people
and organizations for helping in many ways:</p>

<p style="margin-top: 1em">The Rimm-Kaufman Group
&lt;http://www.rimmkaufman.com/&gt;, MySQL AB
&lt;http://www.mysql.com/&gt;, Blue Ridge InternetWorks
&lt;http://www.briworks.com/&gt;, Percona
&lt;http://www.percona.com/&gt;, <br>
Fabien Coelho, Giuseppe Maxia and others at MySQL AB,
Kristian Koehntopp (MySQL AB), Rohit Nadhani (WebYog), The
helpful monks at Perlmonks, And others too numerous to
mention.</p>

<p style="margin-top: 1em">VERSION <br>
This manual page documents Ver 1.0.31 Distrib 7540
$Revision: 7476 $.</p>

<p style="margin-top: 1em">perl v5.24.1 2011-06-08
MK-TABLE-SYNC(1)</p>
<hr>
</body>
</html>
