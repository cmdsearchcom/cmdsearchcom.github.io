<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
  </style>
  <title>MK-TABLE-SYNC(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">MK-TABLE-SYNC(1)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">MK-TABLE-SYNC(1)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="selflink" href="#NAME">NAME</a></h1>
mk-table-sync - Synchronize MySQL table data efficiently.
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="selflink" href="#SYNOPSIS">SYNOPSIS</a></h1>
Usage: mk-table-sync [OPTION...] DSN [DSN...]
<div class="Pp"></div>
mk-table-sync synchronizes data efficiently between MySQL tables.
<div class="Pp"></div>
This tool changes data, so for maximum safety, you should back up your data
  before you use it. When synchronizing a server that is a replication slave
  with the --replicate or --sync-to-master methods, it <b>always</b> makes the
  changes on the replication master, <b>never</b> the replication slave
  directly. This is in general the only safe way to bring a replica back in sync
  with its master; changes to the replica are usually the source of the problems
  in the first place. However, the changes it makes on the master should be
  no-op changes that set the data to their current values, and actually affect
  only the replica. Please read the detailed documentation that follows to learn
  more about this.
<div class="Pp"></div>
Sync db.tbl on host1 to host2:
<div class="Pp"></div>
<pre>
  mk-table-sync --execute h=host1,D=db,t=tbl h=host2
</pre>
<div class="Pp"></div>
Sync all tables on host1 to host2 and host3:
<div class="Pp"></div>
<pre>
  mk-table-sync --execute host1 host2 host3
</pre>
<div class="Pp"></div>
Make slave1 have the same data as its replication master:
<div class="Pp"></div>
<pre>
  mk-table-sync --execute --sync-to-master slave1
</pre>
<div class="Pp"></div>
Resolve differences that mk-table-checksum found on all slaves of master1:
<div class="Pp"></div>
<pre>
  mk-table-sync --execute --replicate test.checksum master1
</pre>
<div class="Pp"></div>
Same as above but only resolve differences on slave1:
<div class="Pp"></div>
<pre>
  mk-table-sync --execute --replicate test.checksum \
    --sync-to-master slave1
</pre>
<div class="Pp"></div>
Sync master2 in a master-master replication configuration, where master2's copy
  of db.tbl is known or suspected to be incorrect:
<div class="Pp"></div>
<pre>
  mk-table-sync --execute --sync-to-master h=master2,D=db,t=tbl
</pre>
<div class="Pp"></div>
Note that in the master-master configuration, the following will NOT do what you
  want, because it will make changes directly on master2, which will then flow
  through replication and change master1's data:
<div class="Pp"></div>
<pre>
  # Don't do this in a master-master setup!
  mk-table-sync --execute h=master1,D=db,t=tbl master2
</pre>
<h1 class="Sh" title="Sh" id="RISKS"><a class="selflink" href="#RISKS">RISKS</a></h1>
The following section is included to inform users about the potential risks,
  whether known or unknown, of using this tool. The two main categories of risks
  are those created by the nature of the tool (e.g. read-only tools vs.
  read-write tools) and those created by bugs.
<div class="Pp"></div>
With great power comes great responsibility! This tool changes data, so it is a
  good idea to back up your data. It is also very powerful, which means it is
  very complex, so you should run it with the &quot;--dry-run&quot; option to
  see what it will do, until you're familiar with its operation. If you want to
  see which rows are different, without changing any data, use
  &quot;--print&quot; instead of &quot;--execute&quot;.
<div class="Pp"></div>
Be careful when using mk-table-sync in any master-master setup. Master-master
  replication is inherently tricky, and it's easy to make mistakes. You need to
  be sure you're using the tool correctly for master-master replication. See the
  &quot;SYNOPSIS&quot; for the overview of the correct usage.
<div class="Pp"></div>
Also be careful with tables that have foreign key constraints with &quot;ON
  DELETE&quot; or &quot;ON UPDATE&quot; definitions because these might cause
  unintended changes on the child tables.
<div class="Pp"></div>
In general, this tool is best suited when your tables have a primary key or
  unique index. Although it can synchronize data in tables lacking a primary key
  or unique index, it might be best to synchronize that data by another means.
<div class="Pp"></div>
At the time of this release, there is a potential bug using
  &quot;--lock-and-rename&quot; with MySQL 5.1, a bug detecting certain
  differences, a bug using <i>ROUND()</i> across different platforms, and a bug
  mixing collations.
<div class="Pp"></div>
The authoritative source for updated information is always the online issue
  tracking system. Issues that affect this tool will be marked as such. You can
  see a list of such issues at the following URL:
  &lt;http://www.maatkit.org/bugs/mk-table-sync&gt;.
<div class="Pp"></div>
See also &quot;BUGS&quot; for more information on filing bugs and getting help.
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="selflink" href="#DESCRIPTION">DESCRIPTION</a></h1>
mk-table-sync does one-way and bidirectional synchronization of table data. It
  does <b>not</b> synchronize table structures, indexes, or any other schema
  objects. The following describes one-way synchronization. &quot;BIDIRECTIONAL
  SYNCING&quot; is described later.
<div class="Pp"></div>
This tool is complex and functions in several different ways. To use it safely
  and effectively, you should understand three things: the purpose of
  &quot;--replicate&quot;, finding differences, and specifying hosts. These
  three concepts are closely related and determine how the tool will run. The
  following is the abbreviated logic:
<div class="Pp"></div>
<pre>
   if DSN has a t part, sync only that table:
      if 1 DSN:
         if --sync-to-master:
            The DSN is a slave.  Connect to its master and sync.
      if more than 1 DSN:
         The first DSN is the source.  Sync each DSN in turn.
   else if --replicate:
      if --sync-to-master:
         The DSN is a slave.  Connect to its master, find records
         of differences, and fix.
      else:
         The DSN is the master.  Find slaves and connect to each,
         find records of differences, and fix.
   else:
      if only 1 DSN and --sync-to-master:
         The DSN is a slave.  Connect to its master, find tables and
         filter with --databases etc, and sync each table to the master.
      else:
         find tables, filtering with --databases etc, and sync each
         DSN to the first.
</pre>
<div class="Pp"></div>
mk-table-sync can run in one of two ways: with &quot;--replicate&quot; or
  without. The default is to run without &quot;--replicate&quot; which causes
  mk-table-sync to automatically find differences efficiently with one of
  several algorithms (see &quot;ALGORITHMS&quot;). Alternatively, the value of
  &quot;--replicate&quot;, if specified, causes mk-table-sync to use the
  differences already found by having previously ran mk-table-checksum with its
  own &quot;--replicate&quot; option. Strictly speaking, you don't need to use
  &quot;--replicate&quot; because mk-table-sync can find differences, but many
  people use &quot;--replicate&quot; if, for example, they checksum regularly
  using mk-table-checksum then fix differences as needed with mk-table-sync. If
  you're unsure, read each tool's documentation carefully and decide for
  yourself, or consult with an expert.
<div class="Pp"></div>
Regardless of whether &quot;--replicate&quot; is used or not, you need to
  specify which hosts to sync. There are two ways: with
  &quot;--sync-to-master&quot; or without. Specifying
  &quot;--sync-to-master&quot; makes mk-table-sync expect one and only slave DSN
  on the command line. The tool will automatically discover the slave's master
  and sync it so that its data is the same as its master. This is accomplished
  by making changes on the master which then flow through replication and update
  the slave to resolve its differences. <b>Be careful though</b>: although this
  option specifies and syncs a single slave, if there are other slaves on the
  same master, they will receive via replication the changes intended for the
  slave that you're trying to sync.
<div class="Pp"></div>
Alternatively, if you do not specify &quot;--sync-to-master&quot;, the first DSN
  given on the command line is the source host. There is only ever one source
  host. If you do not also specify &quot;--replicate&quot;, then you must
  specify at least one other DSN as the destination host. There can be one or
  more destination hosts. Source and destination hosts must be independent; they
  cannot be in the same replication topology. mk-table-sync will die with an
  error if it detects that a destination host is a slave because changes are
  written directly to destination hosts (and it's not safe to write directly to
  slaves). Or, if you specify &quot;--replicate&quot; (but not
  &quot;--sync-to-master&quot;) then mk-table-sync expects one and only one
  master DSN on the command line. The tool will automatically discover all the
  master's slaves and sync them to the master. This is the only way to sync
  several (all) slaves at once (because &quot;--sync-to-master&quot; only
  specifies one slave).
<div class="Pp"></div>
Each host on the command line is specified as a DSN. The first DSN (or only DSN
  for cases like &quot;--sync-to-master&quot;) provides default values for other
  DSNs, whether those other DSNs are specified on the command line or
  auto-discovered by the tool. So in this example,
<div class="Pp"></div>
<pre>
  mk-table-sync --execute h=host1,u=msandbox,p=msandbox h=host2
</pre>
<div class="Pp"></div>
the host2 DSN inherits the &quot;u&quot; and &quot;p&quot; DSN parts from the
  host1 DSN. Use the &quot;--explain-hosts&quot; option to see how mk-table-sync
  will interpret the DSNs given on the command line.
<h1 class="Sh" title="Sh" id="OUTPUT"><a class="selflink" href="#OUTPUT">OUTPUT</a></h1>
If you specify the &quot;--verbose&quot; option, you'll see information about
  the differences between the tables. There is one row per table. Each server is
  printed separately. For example,
<div class="Pp"></div>
<pre>
  # Syncing h=host1,D=test,t=test1
  # DELETE REPLACE INSERT UPDATE ALGORITHM START    END      EXIT DATABASE.TABLE
  #      0       0      3      0 Chunk     13:00:00 13:00:17 2    test.test1
</pre>
<div class="Pp"></div>
Table test.test1 on host1 required 3 &quot;INSERT&quot; statements to
  synchronize and it used the Chunk algorithm (see &quot;ALGORITHMS&quot;). The
  sync operation for this table started at 13:00:00 and ended 17 seconds later
  (times taken from &quot;NOW()&quot; on the source host). Because differences
  were found, its &quot;EXIT STATUS&quot; was 2.
<div class="Pp"></div>
If you specify the &quot;--print&quot; option, you'll see the actual SQL
  statements that the script uses to synchronize the table if
  &quot;--execute&quot; is also specified.
<div class="Pp"></div>
If you want to see the SQL statements that mk-table-sync is using to select
  chunks, nibbles, rows, etc., then specify &quot;--print&quot; once and
  &quot;--verbose&quot; twice. Be careful though: this can print a lot of SQL
  statements.
<div class="Pp"></div>
There are cases where no combination of &quot;INSERT&quot;, &quot;UPDATE&quot;
  or &quot;DELETE&quot; statements can resolve differences without violating
  some unique key. For example, suppose there's a primary key on column a and a
  unique key on column b. Then there is no way to sync these two tables with
  straightforward UPDATE statements:
<div class="Pp"></div>
<pre>
 +---+---+  +---+---+
 | a | b |  | a | b |
 +---+---+  +---+---+
 | 1 | 2 |  | 1 | 1 |
 | 2 | 1 |  | 2 | 2 |
 +---+---+  +---+---+
</pre>
<div class="Pp"></div>
The tool rewrites queries to &quot;DELETE&quot; and &quot;REPLACE&quot; in this
  case. This is automatically handled after the first index violation, so you
  don't have to worry about it.
<h1 class="Sh" title="Sh" id="REPLICATION_SAFETY"><a class="selflink" href="#REPLICATION_SAFETY">REPLICATION
  SAFETY</a></h1>
Synchronizing a replication master and slave safely is a non-trivial problem, in
  general. There are all sorts of issues to think about, such as other processes
  changing data, trying to change data on the slave, whether the destination and
  source are a master-master pair, and much more.
<div class="Pp"></div>
In general, the safe way to do it is to change the data on the master, and let
  the changes flow through replication to the slave like any other changes.
  However, this works only if it's possible to REPLACE into the table on the
  master. REPLACE works only if there's a unique index on the table (otherwise
  it just acts like an ordinary INSERT).
<div class="Pp"></div>
If your table has unique keys, you should use the &quot;--sync-to-master&quot;
  and/or &quot;--replicate&quot; options to sync a slave to its master. This
  will generally do the right thing. When there is no unique key on the table,
  there is no choice but to change the data on the slave, and mk-table-sync will
  detect that you're trying to do so. It will complain and die unless you
  specify &quot;--no-check-slave&quot; (see &quot;--[no]check-slave&quot;).
<div class="Pp"></div>
If you're syncing a table without a primary or unique key on a master-master
  pair, you must change the data on the destination server. Therefore, you need
  to specify &quot;--no-bin-log&quot; for safety (see
  &quot;--[no]bin-log&quot;). If you don't, the changes you make on the
  destination server will replicate back to the source server and change the
  data there!
<div class="Pp"></div>
The generally safe thing to do on a master-master pair is to use the
  &quot;--sync-to-master&quot; option so you don't change the data on the
  destination server. You will also need to specify &quot;--no-check-slave&quot;
  to keep mk-table-sync from complaining that it is changing data on a slave.
<h1 class="Sh" title="Sh" id="ALGORITHMS"><a class="selflink" href="#ALGORITHMS">ALGORITHMS</a></h1>
mk-table-sync has a generic data-syncing framework which uses different
  algorithms to find differences. The tool automatically chooses the best
  algorithm for each table based on indexes, column types, and the algorithm
  preferences specified by &quot;--algorithms&quot;. The following algorithms
  are available, listed in their default order of preference:
<dl class="Bl-tag">
  <dt class="It-tag">Chunk</dt>
  <dd class="It-tag">Finds an index whose first column is numeric (including
      date and time types), and divides the column's range of values into chunks
      of approximately &quot;--chunk-size&quot; rows. Syncs a chunk at a time by
      checksumming the entire chunk. If the chunk differs on the source and
      destination, checksums each chunk's rows individually to find the rows
      that differ.
    <div style="height: 1.00em;">&#x00A0;</div>
    It is efficient when the column has sufficient cardinality to make the
      chunks end up about the right size.
    <div style="height: 1.00em;">&#x00A0;</div>
    The initial per-chunk checksum is quite small and results in minimal network
      traffic and memory consumption. If a chunk's rows must be examined, only
      the primary key columns and a checksum are sent over the network, not the
      entire row. If a row is found to be different, the entire row will be
      fetched, but not before.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Nibble</dt>
  <dd class="It-tag">Finds an index and ascends the index in fixed-size nibbles
      of &quot;--chunk-size&quot; rows, using a non-backtracking algorithm (see
      mk-archiver for more on this algorithm). It is very similar to
      &quot;Chunk&quot;, but instead of pre-calculating the boundaries of each
      piece of the table based on index cardinality, it uses &quot;LIMIT&quot;
      to define each nibble's upper limit, and the previous nibble's upper limit
      to define the lower limit.
    <div style="height: 1.00em;">&#x00A0;</div>
    It works in steps: one query finds the row that will define the next
      nibble's upper boundary, and the next query checksums the entire nibble.
      If the nibble differs between the source and destination, it examines the
      nibble row-by-row, just as &quot;Chunk&quot; does.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">GroupBy</dt>
  <dd class="It-tag">Selects the entire table grouped by all columns, with a
      COUNT(*) column added. Compares all columns, and if they're the same,
      compares the COUNT(*) column's value to determine how many rows to insert
      or delete into the destination. Works on tables with no primary key or
      unique index.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Stream</dt>
  <dd class="It-tag">Selects the entire table in one big stream and compares all
      columns. Selects all columns. Much less efficient than the other
      algorithms, but works when there is no suitable index for them to
    use.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">Future Plans</dt>
  <dd class="It-tag">Possibilities for future algorithms are TempTable (what I
      originally called bottom-up in earlier versions of this tool), DrillDown
      (what I originally called top-down), and GroupByPrefix (similar to how
      SqlYOG Job Agent works). Each algorithm has strengths and weaknesses. If
      you'd like to implement your favorite technique for finding differences
      between two sources of data on possibly different servers, I'm willing to
      help. The algorithms adhere to a simple interface that makes it pretty
      easy to write your own.</dd>
</dl>
<h1 class="Sh" title="Sh" id="BIDIRECTIONAL_SYNCING"><a class="selflink" href="#BIDIRECTIONAL_SYNCING">BIDIRECTIONAL
  SYNCING</a></h1>
Bidirectional syncing is a new, experimental feature. To make it work reliably
  there are a number of strict limitations:
<div class="Pp"></div>
<pre>
  * only works when syncing one server to other independent servers
  * does not work in any way with replication
  * requires that the table(s) are chunkable with the Chunk algorithm
  * is not N-way, only bidirectional between two servers at a time
  * does not handle DELETE changes
</pre>
<div class="Pp"></div>
For example, suppose we have three servers: c1, r1, r2. c1 is the central
  server, a pseudo-master to the other servers (viz. r1 and r2 are not slaves to
  c1). r1 and r2 are remote servers. Rows in table foo are updated and inserted
  on all three servers and we want to synchronize all the changes between all
  the servers. Table foo has columns:
<div class="Pp"></div>
<pre>
  id    int PRIMARY KEY
  ts    timestamp auto updated
  name  varchar
</pre>
<div class="Pp"></div>
Auto-increment offsets are used so that new rows from any server do not create
  conflicting primary key (id) values. In general, newer rows, as determined by
  the ts column, take precedence when a same but differing row is found during
  the bidirectional sync. &quot;Same but differing&quot; means that two rows
  have the same primary key (id) value but different values for some other
  column, like the name column in this example. Same but differing conflicts are
  resolved by a &quot;conflict&quot;. A conflict compares some column of the
  competing rows to determine a &quot;winner&quot;. The winning row becomes the
  source and its values are used to update the other row.
<div class="Pp"></div>
There are subtle differences between three columns used to achieve bidirectional
  syncing that you should be familiar with: chunk column
  (&quot;--chunk-column&quot;), comparison column(s) (&quot;--columns&quot;),
  and conflict column (&quot;--conflict-column&quot;). The chunk column is only
  used to chunk the table; e.g. &quot;WHERE id &gt;= 5 AND id &lt; 10&quot;.
  Chunks are checksummed and when chunk checksums reveal a difference, the tool
  selects the rows in that chunk and checksums the &quot;--columns&quot; for
  each row. If a column checksum differs, the rows have one or more conflicting
  column values. In a traditional unidirectional sync, the conflict is a moot
  point because it can be resolved simply by updating the entire destination row
  with the source row's values. In a bidirectional sync, however, the
  &quot;--conflict-column&quot; (in accordance with other
  &quot;--conflict-*&quot; options list below) is compared to determine which
  row is &quot;correct&quot; or &quot;authoritative&quot;; this row becomes the
  &quot;source&quot;.
<div class="Pp"></div>
To sync all three servers completely, two runs of mk-table-sync are required.
  The first run syncs c1 and r1, then syncs c1 and r2 including any changes from
  r1. At this point c1 and r2 are completely in sync, but r1 is missing any
  changes from r2 because c1 didn't have these changes when it and r1 were
  synced. So a second run is needed which syncs the servers in the same order,
  but this time when c1 and r1 are synced r1 gets r2's changes.
<div class="Pp"></div>
The tool does not sync N-ways, only bidirectionally between the first DSN given
  on the command line and each subsequent DSN in turn. So the tool in this
  example would be ran twice like:
<div class="Pp"></div>
<pre>
  mk-table-sync --bidirectional h=c1 h=r1 h=r2
</pre>
<div class="Pp"></div>
The &quot;--bidirectional&quot; option enables this feature and causes various
  sanity checks to be performed. You must specify other options that tell
  mk-table-sync how to resolve conflicts for same but differing rows. These
  options are:
<div class="Pp"></div>
<pre>
  * L&lt;&quot;--conflict-column&quot;&gt;
  * L&lt;&quot;--conflict-comparison&quot;&gt;
  * L&lt;&quot;--conflict-value&quot;&gt;
  * L&lt;&quot;--conflict-threshold&quot;&gt;
  * L&lt;&quot;--conflict-error&quot;&gt;  (optional)
</pre>
<div class="Pp"></div>
Use &quot;--print&quot; to test this option before &quot;--execute&quot;. The
  printed SQL statements will have comments saying on which host the statement
  would be executed if you used &quot;--execute&quot;.
<div class="Pp"></div>
Technical side note: the first DSN is always the &quot;left&quot; server and the
  other DSNs are always the &quot;right&quot; server. Since either server can
  become the source or destination it's confusing to think of them as
  &quot;src&quot; and &quot;dst&quot;. Therefore, they're generically referred
  to as left and right. It's easy to remember this because the first DSN is
  always to the left of the other server DSNs on the command line.
<h1 class="Sh" title="Sh" id="EXIT_STATUS"><a class="selflink" href="#EXIT_STATUS">EXIT
  STATUS</a></h1>
The following are the exit statuses (also called return values, or return codes)
  when mk-table-sync finishes and exits.
<div class="Pp"></div>
<pre>
   STATUS  MEANING
   ======  =======================================================
   0       Success.
   1       Internal error.
   2       At least one table differed on the destination.
   3       Combination of 1 and 2.
</pre>
<h1 class="Sh" title="Sh" id="OPTIONS"><a class="selflink" href="#OPTIONS">OPTIONS</a></h1>
Specify at least one of &quot;--print&quot;, &quot;--execute&quot;, or
  &quot;--dry-run&quot;.
<div class="Pp"></div>
&quot;--where&quot; and &quot;--replicate&quot; are mutually exclusive.
<div class="Pp"></div>
This tool accepts additional command-line arguments. Refer to the
  &quot;SYNOPSIS&quot; and usage information for details.
<dl class="Bl-tag">
  <dt class="It-tag">--algorithms</dt>
  <dd class="It-tag">type: string; default: Chunk,Nibble,GroupBy,Stream
    <div style="height: 1.00em;">&#x00A0;</div>
    Algorithm to use when comparing the tables, in order of preference.
    <div style="height: 1.00em;">&#x00A0;</div>
    For each table, mk-table-sync will check if the table can be synced with the
      given algorithms in the order that they're given. The first algorithm that
      can sync the table is used. See &quot;ALGORITHMS&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--ask-pass</dt>
  <dd class="It-tag">Prompt for a password when connecting to MySQL.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--bidirectional</dt>
  <dd class="It-tag">Enable bidirectional sync between first and subsequent
      hosts.
    <div style="height: 1.00em;">&#x00A0;</div>
    See &quot;BIDIRECTIONAL SYNCING&quot; for more information.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--[no]bin-log</dt>
  <dd class="It-tag">default: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    Log to the binary log (&quot;SET SQL_LOG_BIN=1&quot;).
    <div style="height: 1.00em;">&#x00A0;</div>
    Specifying &quot;--no-bin-log&quot; will &quot;SET SQL_LOG_BIN=0&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--buffer-in-mysql</dt>
  <dd class="It-tag">Instruct MySQL to buffer queries in its memory.
    <div style="height: 1.00em;">&#x00A0;</div>
    This option adds the &quot;SQL_BUFFER_RESULT&quot; option to the comparison
      queries. This causes MySQL to execute the queries and place them in a
      temporary table internally before sending the results back to
      mk-table-sync. The advantage of this strategy is that mk-table-sync can
      fetch rows as desired without using a lot of memory inside the Perl
      process, while releasing locks on the MySQL table (to reduce contention
      with other queries). The disadvantage is that it uses more memory on the
      MySQL server instead.
    <div style="height: 1.00em;">&#x00A0;</div>
    You probably want to leave &quot;--[no]buffer-to-client&quot; enabled too,
      because buffering into a temp table and then fetching it all into Perl's
      memory is probably a silly thing to do. This option is most useful for the
      GroupBy and Stream algorithms, which may fetch a lot of data from the
      server.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--[no]buffer-to-client</dt>
  <dd class="It-tag">default: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    Fetch rows one-by-one from MySQL while comparing.
    <div style="height: 1.00em;">&#x00A0;</div>
    This option enables &quot;mysql_use_result&quot; which causes MySQL to hold
      the selected rows on the server until the tool fetches them. This allows
      the tool to use less memory but may keep the rows locked on the server
      longer.
    <div style="height: 1.00em;">&#x00A0;</div>
    If this option is disabled by specifying &quot;--no-buffer-to-client&quot;
      then &quot;mysql_store_result&quot; is used which causes MySQL to send all
      selected rows to the tool at once. This may result in the results
      &quot;cursor&quot; being held open for a shorter time on the server, but
      if the tables are large, it could take a long time anyway, and use all
      your memory.
    <div style="height: 1.00em;">&#x00A0;</div>
    For most non-trivial data sizes, you want to leave this option enabled.
    <div style="height: 1.00em;">&#x00A0;</div>
    This option is disabled when &quot;--bidirectional&quot; is used.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--charset</dt>
  <dd class="It-tag">short form: -A; type: string
    <div style="height: 1.00em;">&#x00A0;</div>
    Default character set. If the value is utf8, sets Perl's binmode on STDOUT
      to utf8, passes the mysql_enable_utf8 option to DBD::mysql, and runs SET
      NAMES UTF8 after connecting to MySQL. Any other value sets binmode on
      STDOUT without the utf8 layer, and runs SET NAMES after connecting to
      MySQL.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--[no]check-master</dt>
  <dd class="It-tag">default: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    With &quot;--sync-to-master&quot;, try to verify that the detected master is
      the real master.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--[no]check-privileges</dt>
  <dd class="It-tag">default: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    Check that user has all necessary privileges on source and destination
      table.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--[no]check-slave</dt>
  <dd class="It-tag">default: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    Check whether the destination server is a slave.
    <div style="height: 1.00em;">&#x00A0;</div>
    If the destination server is a slave, it's generally unsafe to make changes
      on it. However, sometimes you have to; &quot;--replace&quot; won't work
      unless there's a unique index, for example, so you can't make changes on
      the master in that scenario. By default mk-table-sync will complain if you
      try to change data on a slave. Specify &quot;--no-check-slave&quot; to
      disable this check. Use it at your own risk.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--[no]check-triggers</dt>
  <dd class="It-tag">default: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    Check that no triggers are defined on the destination table.
    <div style="height: 1.00em;">&#x00A0;</div>
    Triggers were introduced in MySQL v5.0.2, so for older versions this option
      has no effect because triggers will not be checked.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--chunk-column</dt>
  <dd class="It-tag">type: string
    <div style="height: 1.00em;">&#x00A0;</div>
    Chunk the table on this column.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--chunk-index</dt>
  <dd class="It-tag">type: string
    <div style="height: 1.00em;">&#x00A0;</div>
    Chunk the table using this index.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--chunk-size</dt>
  <dd class="It-tag">type: string; default: 1000
    <div style="height: 1.00em;">&#x00A0;</div>
    Number of rows or data size per chunk.
    <div style="height: 1.00em;">&#x00A0;</div>
    The size of each chunk of rows for the &quot;Chunk&quot; and
      &quot;Nibble&quot; algorithms. The size can be either a number of rows, or
      a data size. Data sizes are specified with a suffix of k=kibibytes,
      M=mebibytes, G=gibibytes. Data sizes are converted to a number of rows by
      dividing by the average row length.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--columns</dt>
  <dd class="It-tag">short form: -c; type: array
    <div style="height: 1.00em;">&#x00A0;</div>
    Compare this comma-separated list of columns.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--config</dt>
  <dd class="It-tag">type: Array
    <div style="height: 1.00em;">&#x00A0;</div>
    Read this comma-separated list of config files; if specified, this must be
      the first option on the command line.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--conflict-column</dt>
  <dd class="It-tag">type: string
    <div style="height: 1.00em;">&#x00A0;</div>
    Compare this column when rows conflict during a &quot;--bidirectional&quot;
      sync.
    <div style="height: 1.00em;">&#x00A0;</div>
    When a same but differing row is found the value of this column from each
      row is compared according to &quot;--conflict-comparison&quot;,
      &quot;--conflict-value&quot; and &quot;--conflict-threshold&quot; to
      determine which row has the correct data and becomes the source. The
      column can be any type for which there is an appropriate
      &quot;--conflict-comparison&quot; (this is almost all types except, for
      example, blobs).
    <div style="height: 1.00em;">&#x00A0;</div>
    This option only works with &quot;--bidirectional&quot;. See
      &quot;BIDIRECTIONAL SYNCING&quot; for more information.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--conflict-comparison</dt>
  <dd class="It-tag">type: string
    <div style="height: 1.00em;">&#x00A0;</div>
    Choose the &quot;--conflict-column&quot; with this property as the source.
    <div style="height: 1.00em;">&#x00A0;</div>
    The option affects how the &quot;--conflict-column&quot; values from the
      conflicting rows are compared. Possible comparisons are one of these
      MAGIC_comparisons:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  newest|oldest|greatest|least|equals|matches
  COMPARISON  CHOOSES ROW WITH
  ==========  =========================================================
  newest      Newest temporal L&lt;&quot;--conflict-column&quot;&gt; value
  oldest      Oldest temporal L&lt;&quot;--conflict-column&quot;&gt; value
  greatest    Greatest numerical L&lt;&quot;--conflict-column&quot;&gt; value
  least       Least numerical L&lt;&quot;--conflict-column&quot;&gt; value
  equals      L&lt;&quot;--conflict-column&quot;&gt; value equal to L&lt;&quot;--conflict-value&quot;&gt;
  matches     L&lt;&quot;--conflict-column&quot;&gt; value matching Perl regex pattern
              L&lt;&quot;--conflict-value&quot;&gt;
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This option only works with &quot;--bidirectional&quot;. See
      &quot;BIDIRECTIONAL SYNCING&quot; for more information.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--conflict-error</dt>
  <dd class="It-tag">type: string; default: warn
    <div style="height: 1.00em;">&#x00A0;</div>
    How to report unresolvable conflicts and conflict errors
    <div style="height: 1.00em;">&#x00A0;</div>
    This option changes how the user is notified when a conflict cannot be
      resolved or causes some kind of error. Possible values are:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  * warn: Print a warning to STDERR about the unresolvable conflict
  * die:  Die, stop syncing, and print a warning to STDERR
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    This option only works with &quot;--bidirectional&quot;. See
      &quot;BIDIRECTIONAL SYNCING&quot; for more information.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--conflict-threshold</dt>
  <dd class="It-tag">type: string
    <div style="height: 1.00em;">&#x00A0;</div>
    Amount by which one &quot;--conflict-column&quot; must exceed the other.
    <div style="height: 1.00em;">&#x00A0;</div>
    The &quot;--conflict-threshold&quot; prevents a conflict from being resolved
      if the absolute difference between the two &quot;--conflict-column&quot;
      values is less than this amount. For example, if two
      &quot;--conflict-column&quot; have timestamp values &quot;2009-12-01
      12:00:00&quot; and &quot;2009-12-01 12:05:00&quot; the difference is 5
      minutes. If &quot;--conflict-threshold&quot; is set to &quot;5m&quot; the
      conflict will be resolved, but if &quot;--conflict-threshold&quot; is set
      to &quot;6m&quot; the conflict will fail to resolve because the difference
      is not greater than or equal to 6 minutes. In this latter case,
      &quot;--conflict-error&quot; will report the failure.
    <div style="height: 1.00em;">&#x00A0;</div>
    This option only works with &quot;--bidirectional&quot;. See
      &quot;BIDIRECTIONAL SYNCING&quot; for more information.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--conflict-value</dt>
  <dd class="It-tag">type: string
    <div style="height: 1.00em;">&#x00A0;</div>
    Use this value for certain &quot;--conflict-comparison&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    This option gives the value for &quot;equals&quot; and &quot;matches&quot;
      &quot;--conflict-comparison&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    This option only works with &quot;--bidirectional&quot;. See
      &quot;BIDIRECTIONAL SYNCING&quot; for more information.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--databases</dt>
  <dd class="It-tag">short form: -d; type: hash
    <div style="height: 1.00em;">&#x00A0;</div>
    Sync only this comma-separated list of databases.
    <div style="height: 1.00em;">&#x00A0;</div>
    A common request is to sync tables from one database with tables from
      another database on the same or different server. This is not yet
      possible. &quot;--databases&quot; will not do it, and you can't do it with
      the D part of the DSN either because in the absence of a table name it
      assumes the whole server should be synced and the D part controls only the
      connection's default database.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--defaults-file</dt>
  <dd class="It-tag">short form: -F; type: string
    <div style="height: 1.00em;">&#x00A0;</div>
    Only read mysql options from the given file. You must give an absolute
      pathname.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--dry-run</dt>
  <dd class="It-tag">Analyze, decide the sync algorithm to use, print and exit.
    <div style="height: 1.00em;">&#x00A0;</div>
    Implies &quot;--verbose&quot; so you can see the results. The results are in
      the same output format that you'll see from actually running the tool, but
      there will be zeros for rows affected. This is because the tool actually
      executes, but stops before it compares any data and just returns zeros.
      The zeros do not mean there are no changes to be made.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--engines</dt>
  <dd class="It-tag">short form: -e; type: hash
    <div style="height: 1.00em;">&#x00A0;</div>
    Sync only this comma-separated list of storage engines.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--execute</dt>
  <dd class="It-tag">Execute queries to make the tables have identical data.
    <div style="height: 1.00em;">&#x00A0;</div>
    This option makes mk-table-sync actually sync table data by executing all
      the queries that it created to resolve table differences. Therefore,
      <b>the</b> <b>tables will be changed!</b> And unless you also specify
      &quot;--verbose&quot;, the changes will be made silently. If this is not
      what you want, see &quot;--print&quot; or &quot;--dry-run&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--explain-hosts</dt>
  <dd class="It-tag">Print connection information and exit.
    <div style="height: 1.00em;">&#x00A0;</div>
    Print out a list of hosts to which mk-table-sync will connect, with all the
      various connection options, and exit.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--float-precision</dt>
  <dd class="It-tag">type: int
    <div style="height: 1.00em;">&#x00A0;</div>
    Precision for &quot;FLOAT&quot; and &quot;DOUBLE&quot; number-to-string
      conversion. Causes FLOAT and DOUBLE values to be rounded to the specified
      number of digits after the decimal point, with the <i>ROUND()</i> function
      in MySQL. This can help avoid checksum mismatches due to different
      floating-point representations of the same values on different MySQL
      versions and hardware. The default is no rounding; the values are
      converted to strings by the <i>CONCAT()</i> function, and MySQL chooses
      the string representation. If you specify a value of 2, for example, then
      the values 1.008 and 1.009 will be rounded to 1.01, and will checksum as
      equal.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--[no]foreign-key-checks</dt>
  <dd class="It-tag">default: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    Enable foreign key checks (&quot;SET FOREIGN_KEY_CHECKS=1&quot;).
    <div style="height: 1.00em;">&#x00A0;</div>
    Specifying &quot;--no-foreign-key-checks&quot; will &quot;SET
      FOREIGN_KEY_CHECKS=0&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--function</dt>
  <dd class="It-tag">type: string
    <div style="height: 1.00em;">&#x00A0;</div>
    Which hash function you'd like to use for checksums.
    <div style="height: 1.00em;">&#x00A0;</div>
    The default is &quot;CRC32&quot;. Other good choices include &quot;MD5&quot;
      and &quot;SHA1&quot;. If you have installed the &quot;FNV_64&quot;
      user-defined function, &quot;mk-table-sync&quot; will detect it and prefer
      to use it, because it is much faster than the built-ins. You can also use
      MURMUR_HASH if you've installed that user-defined function. Both of these
      are distributed with Maatkit. See mk-table-checksum for more information
      and benchmarks.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--help</dt>
  <dd class="It-tag">Show help and exit.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--[no]hex-blob</dt>
  <dd class="It-tag">default: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    &quot;HEX()&quot; &quot;BLOB&quot;, &quot;TEXT&quot; and &quot;BINARY&quot;
      columns.
    <div style="height: 1.00em;">&#x00A0;</div>
    When row data from the source is fetched to create queries to sync the data
      (i.e. the queries seen with &quot;--print&quot; and executed by
      &quot;--execute&quot;), binary columns are wrapped in <i>HEX()</i> so the
      binary data does not produce an invalid SQL statement. You can disable
      this option but you probably shouldn't.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--host</dt>
  <dd class="It-tag">short form: -h; type: string
    <div style="height: 1.00em;">&#x00A0;</div>
    Connect to host.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--ignore-columns</dt>
  <dd class="It-tag">type: Hash
    <div style="height: 1.00em;">&#x00A0;</div>
    Ignore this comma-separated list of column names in comparisons.
    <div style="height: 1.00em;">&#x00A0;</div>
    This option causes columns not to be compared. However, if a row is
      determined to differ between tables, all columns in that row will be
      synced, regardless. (It is not currently possible to exclude columns from
      the sync process itself, only from the comparison.)</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--ignore-databases</dt>
  <dd class="It-tag">type: Hash
    <div style="height: 1.00em;">&#x00A0;</div>
    Ignore this comma-separated list of databases.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--ignore-engines</dt>
  <dd class="It-tag">type: Hash; default: FEDERATED,MRG_MyISAM
    <div style="height: 1.00em;">&#x00A0;</div>
    Ignore this comma-separated list of storage engines.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--ignore-tables</dt>
  <dd class="It-tag">type: Hash
    <div style="height: 1.00em;">&#x00A0;</div>
    Ignore this comma-separated list of tables.
    <div style="height: 1.00em;">&#x00A0;</div>
    Table names may be qualified with the database name.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--[no]index-hint</dt>
  <dd class="It-tag">default: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    Add FORCE/USE INDEX hints to the chunk and row queries.
    <div style="height: 1.00em;">&#x00A0;</div>
    By default &quot;mk-table-sync&quot; adds a FORCE/USE INDEX hint to each SQL
      statement to coerce MySQL into using the index chosen by the sync
      algorithm or specified by &quot;--chunk-index&quot;. This is usually a
      good thing, but in rare cases the index may not be the best for the query
      so you can suppress the index hint by specifying
      &quot;--no-index-hint&quot; and let MySQL choose the index.
    <div style="height: 1.00em;">&#x00A0;</div>
    This does not affect the queries printed by &quot;--print&quot;; it only
      affects the chunk and row queries that &quot;mk-table-sync&quot; uses to
      select and compare rows.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--lock</dt>
  <dd class="It-tag">type: int
    <div style="height: 1.00em;">&#x00A0;</div>
    Lock tables: 0=none, 1=per sync cycle, 2=per table, or 3=globally.
    <div style="height: 1.00em;">&#x00A0;</div>
    This uses &quot;LOCK TABLES&quot;. This can help prevent tables being
      changed while you're examining them. The possible values are as follows:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  VALUE  MEANING
  =====  =======================================================
  0      Never lock tables.
  1      Lock and unlock one time per sync cycle (as implemented
         by the syncing algorithm).  This is the most granular
         level of locking available.  For example, the Chunk
         algorithm will lock each chunk of C&lt;N&gt; rows, and then
         unlock them if they are the same on the source and the
         destination, before moving on to the next chunk.
  2      Lock and unlock before and after each table.
  3      Lock and unlock once for every server (DSN) synced, with
         C&lt;FLUSH TABLES WITH READ LOCK&gt;.
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    A replication slave is never locked if &quot;--replicate&quot; or
      &quot;--sync-to-master&quot; is specified, since in theory locking the
      table on the master should prevent any changes from taking place. (You are
      not changing data on your slave, right?) If &quot;--wait&quot; is given,
      the master (source) is locked and then the tool waits for the slave to
      catch up to the master before continuing.
    <div style="height: 1.00em;">&#x00A0;</div>
    If &quot;--transaction&quot; is specified, &quot;LOCK TABLES&quot; is not
      used. Instead, lock and unlock are implemented by beginning and committing
      transactions. The exception is if &quot;--lock&quot; is 3.
    <div style="height: 1.00em;">&#x00A0;</div>
    If &quot;--no-transaction&quot; is specified, then &quot;LOCK TABLES&quot;
      is used for any value of &quot;--lock&quot;. See
      &quot;--[no]transaction&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--lock-and-rename</dt>
  <dd class="It-tag">Lock the source and destination table, sync, then swap
      names. This is useful as a less-blocking ALTER TABLE, once the tables are
      reasonably in sync with each other (which you may choose to accomplish via
      any number of means, including dump and reload or even something like
      mk-archiver). It requires exactly two DSNs and assumes they are on the
      same server, so it does no waiting for replication or the like. Tables are
      locked with LOCK TABLES.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--password</dt>
  <dd class="It-tag">short form: -p; type: string
    <div style="height: 1.00em;">&#x00A0;</div>
    Password to use when connecting.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--pid</dt>
  <dd class="It-tag">type: string
    <div style="height: 1.00em;">&#x00A0;</div>
    Create the given PID file. The file contains the process ID of the script.
      The PID file is removed when the script exits. Before starting, the script
      checks if the PID file already exists. If it does not, then the script
      creates and writes its own PID to it. If it does, then the script checks
      the following: if the file contains a PID and a process is running with
      that PID, then the script dies; or, if there is no process running with
      that PID, then the script overwrites the file with its own PID and starts;
      else, if the file contains no PID, then the script dies.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--port</dt>
  <dd class="It-tag">short form: -P; type: int
    <div style="height: 1.00em;">&#x00A0;</div>
    Port number to use for connection.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--print</dt>
  <dd class="It-tag">Print queries that will resolve differences.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you don't trust &quot;mk-table-sync&quot;, or just want to see what it
      will do, this is a good way to be safe. These queries are valid SQL and
      you can run them yourself if you want to sync the tables manually.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--recursion-method</dt>
  <dd class="It-tag">type: string
    <div style="height: 1.00em;">&#x00A0;</div>
    Preferred recursion method used to find slaves.
    <div style="height: 1.00em;">&#x00A0;</div>
    Possible methods are:
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  METHOD       USES
  ===========  ================
  processlist  SHOW PROCESSLIST
  hosts        SHOW SLAVE HOSTS
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    The processlist method is preferred because SHOW SLAVE HOSTS is not
      reliable. However, the hosts method is required if the server uses a
      non-standard port (not 3306). Usually mk-table-sync does the right thing
      and finds the slaves, but you may give a preferred method and it will be
      used first. If it doesn't find any slaves, the other methods will be
      tried.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--replace</dt>
  <dd class="It-tag">Write all &quot;INSERT&quot; and &quot;UPDATE&quot;
      statements as &quot;REPLACE&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    This is automatically switched on as needed when there are unique index
      violations.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--replicate</dt>
  <dd class="It-tag">type: string
    <div style="height: 1.00em;">&#x00A0;</div>
    Sync tables listed as different in this table.
    <div style="height: 1.00em;">&#x00A0;</div>
    Specifies that &quot;mk-table-sync&quot; should examine the specified table
      to find data that differs. The table is exactly the same as the argument
      of the same name to mk-table-checksum. That is, it contains records of
      which tables (and ranges of values) differ between the master and slave.
    <div style="height: 1.00em;">&#x00A0;</div>
    For each table and range of values that shows differences between the master
      and slave, &quot;mk-table-checksum&quot; will sync that table, with the
      appropriate &quot;WHERE&quot; clause, to its master.
    <div style="height: 1.00em;">&#x00A0;</div>
    This automatically sets &quot;--wait&quot; to 60 and causes changes to be
      made on the master instead of the slave.
    <div style="height: 1.00em;">&#x00A0;</div>
    If &quot;--sync-to-master&quot; is specified, the tool will assume the
      server you specified is the slave, and connect to the master as usual to
      sync.
    <div style="height: 1.00em;">&#x00A0;</div>
    Otherwise, it will try to use &quot;SHOW PROCESSLIST&quot; to find slaves of
      the server you specified. If it is unable to find any slaves via
      &quot;SHOW PROCESSLIST&quot;, it will inspect &quot;SHOW SLAVE HOSTS&quot;
      instead. You must configure each slave's &quot;report-host&quot;,
      &quot;report-port&quot; and other options for this to work right. After
      finding slaves, it will inspect the specified table on each slave to find
      data that needs to be synced, and sync it.
    <div style="height: 1.00em;">&#x00A0;</div>
    The tool examines the master's copy of the table first, assuming that the
      master is potentially a slave as well. Any table that shows differences
      there will <b>NOT</b> be synced on the slave(s). For example, suppose your
      replication is set up as A-&gt;B, B-&gt;C, B-&gt;D. Suppose you use this
      argument and specify server B. The tool will examine server B's copy of
      the table. If it looks like server B's data in table &quot;test.tbl1&quot;
      is different from server A's copy, the tool will not sync that table on
      servers C and D.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--set-vars</dt>
  <dd class="It-tag">type: string; default: wait_timeout=10000
    <div style="height: 1.00em;">&#x00A0;</div>
    Set these MySQL variables. Immediately after connecting to MySQL, this
      string will be appended to SET and executed.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--socket</dt>
  <dd class="It-tag">short form: -S; type: string
    <div style="height: 1.00em;">&#x00A0;</div>
    Socket file to use for connection.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--sync-to-master</dt>
  <dd class="It-tag">Treat the DSN as a slave and sync it to its master.
    <div style="height: 1.00em;">&#x00A0;</div>
    Treat the server you specified as a slave. Inspect &quot;SHOW SLAVE
      STATUS&quot;, connect to the server's master, and treat the master as the
      source and the slave as the destination. Causes changes to be made on the
      master. Sets &quot;--wait&quot; to 60 by default, sets &quot;--lock&quot;
      to 1 by default, and disables &quot;--[no]transaction&quot; by default.
      See also &quot;--replicate&quot;, which changes this option's
    behavior.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--tables</dt>
  <dd class="It-tag">short form: -t; type: hash
    <div style="height: 1.00em;">&#x00A0;</div>
    Sync only this comma-separated list of tables.
    <div style="height: 1.00em;">&#x00A0;</div>
    Table names may be qualified with the database name.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--timeout-ok</dt>
  <dd class="It-tag">Keep going if &quot;--wait&quot; fails.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you specify &quot;--wait&quot; and the slave doesn't catch up to the
      master's position before the wait times out, the default behavior is to
      abort. This option makes the tool keep going anyway. <b>Warning</b>: if
      you are trying to get a consistent comparison between the two servers, you
      probably don't want to keep going after a timeout.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--[no]transaction</dt>
  <dd class="It-tag">Use transactions instead of &quot;LOCK TABLES&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    The granularity of beginning and committing transactions is controlled by
      &quot;--lock&quot;. This is enabled by default, but since
      &quot;--lock&quot; is disabled by default, it has no effect.
    <div style="height: 1.00em;">&#x00A0;</div>
    Most options that enable locking also disable transactions by default, so if
      you want to use transactional locking (via &quot;LOCK IN SHARE MODE&quot;
      and &quot;FOR UPDATE&quot;, you must specify &quot;--transaction&quot;
      explicitly.
    <div style="height: 1.00em;">&#x00A0;</div>
    If you don't specify &quot;--transaction&quot; explicitly
      &quot;mk-table-sync&quot; will decide on a per-table basis whether to use
      transactions or table locks. It currently uses transactions on InnoDB
      tables, and table locks on all others.
    <div style="height: 1.00em;">&#x00A0;</div>
    If &quot;--no-transaction&quot; is specified, then &quot;mk-table-sync&quot;
      will not use transactions at all (not even for InnoDB tables) and locking
      is controlled by &quot;--lock&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    When enabled, either explicitly or implicitly, the transaction isolation
      level is set &quot;REPEATABLE READ&quot; and transactions are started
      &quot;WITH CONSISTENT SNAPSHOT&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--trim</dt>
  <dd class="It-tag">&quot;TRIM()&quot; &quot;VARCHAR&quot; columns in
      &quot;BIT_XOR&quot; and &quot;ACCUM&quot; modes. Helps when comparing
      MySQL 4.1 to &gt;= 5.0.
    <div style="height: 1.00em;">&#x00A0;</div>
    This is useful when you don't care about the trailing space differences
      between MySQL versions which vary in their handling of trailing spaces.
      MySQL 5.0 and later all retain trailing spaces in &quot;VARCHAR&quot;,
      while previous versions would remove them.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--[no]unique-checks</dt>
  <dd class="It-tag">default: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    Enable unique key checks (&quot;SET UNIQUE_CHECKS=1&quot;).
    <div style="height: 1.00em;">&#x00A0;</div>
    Specifying &quot;--no-unique-checks&quot; will &quot;SET
      UNIQUE_CHECKS=0&quot;.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--user</dt>
  <dd class="It-tag">short form: -u; type: string
    <div style="height: 1.00em;">&#x00A0;</div>
    User for login if not current user.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--verbose</dt>
  <dd class="It-tag">short form: -v; cumulative: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    Print results of sync operations.
    <div style="height: 1.00em;">&#x00A0;</div>
    See &quot;OUTPUT&quot; for more details about the output.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--version</dt>
  <dd class="It-tag">Show version and exit.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--wait</dt>
  <dd class="It-tag">short form: -w; type: time
    <div style="height: 1.00em;">&#x00A0;</div>
    How long to wait for slaves to catch up to their master.
    <div style="height: 1.00em;">&#x00A0;</div>
    Make the master wait for the slave to catch up in replication before
      comparing the tables. The value is the number of seconds to wait before
      timing out (see also &quot;--timeout-ok&quot;). Sets &quot;--lock&quot; to
      1 and &quot;--[no]transaction&quot; to 0 by default. If you see an error
      such as the following,
    <div style="height: 1.00em;">&#x00A0;</div>
    <pre>
  MASTER_POS_WAIT returned -1
    </pre>
    <div style="height: 1.00em;">&#x00A0;</div>
    It means the timeout was exceeded and you need to increase it.
    <div style="height: 1.00em;">&#x00A0;</div>
    The default value of this option is influenced by other options. To see what
      value is in effect, run with &quot;--help&quot;.
    <div style="height: 1.00em;">&#x00A0;</div>
    To disable waiting entirely (except for locks), specify &quot;--wait&quot;
      0. This helps when the slave is lagging on tables that are not being
      synced.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--where</dt>
  <dd class="It-tag">type: string
    <div style="height: 1.00em;">&#x00A0;</div>
    &quot;WHERE&quot; clause to restrict syncing to part of the table.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">--[no]zero-chunk</dt>
  <dd class="It-tag">default: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    Add a chunk for rows with zero or zero-equivalent values. The only has an
      effect when &quot;--chunk-size&quot; is specified. The purpose of the zero
      chunk is to capture a potentially large number of zero values that would
      imbalance the size of the first chunk. For example, if a lot of negative
      numbers were inserted into an unsigned integer column causing them to be
      stored as zeros, then these zero values are captured by the zero chunk
      instead of the first chunk and all its non-zero values.</dd>
</dl>
<h1 class="Sh" title="Sh" id="DSN_OPTIONS"><a class="selflink" href="#DSN_OPTIONS">DSN
  OPTIONS</a></h1>
These DSN options are used to create a DSN. Each option is given like
  &quot;option=value&quot;. The options are case-sensitive, so P and p are not
  the same option. There cannot be whitespace before or after the &quot;=&quot;
  and if the value contains whitespace it must be quoted. DSN options are
  comma-separated. See the maatkit manpage for full details.
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">A
    <div style="height: 1.00em;">&#x00A0;</div>
    dsn: charset; copy: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    Default character set.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">D
    <div style="height: 1.00em;">&#x00A0;</div>
    dsn: database; copy: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    Database containing the table to be synced.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">F
    <div style="height: 1.00em;">&#x00A0;</div>
    dsn: mysql_read_default_file; copy: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    Only read default options from the given file</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">h
    <div style="height: 1.00em;">&#x00A0;</div>
    dsn: host; copy: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    Connect to host.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">p
    <div style="height: 1.00em;">&#x00A0;</div>
    dsn: password; copy: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    Password to use when connecting.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">P
    <div style="height: 1.00em;">&#x00A0;</div>
    dsn: port; copy: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    Port number to use for connection.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">S
    <div style="height: 1.00em;">&#x00A0;</div>
    dsn: mysql_socket; copy: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    Socket file to use for connection.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">t
    <div style="height: 1.00em;">&#x00A0;</div>
    copy: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    Table to be synced.</dd>
</dl>
<dl class="Bl-tag">
  <dt class="It-tag">&#x2022;</dt>
  <dd class="It-tag">u
    <div style="height: 1.00em;">&#x00A0;</div>
    dsn: user; copy: yes
    <div style="height: 1.00em;">&#x00A0;</div>
    User for login if not current user.</dd>
</dl>
<h1 class="Sh" title="Sh" id="DOWNLOADING"><a class="selflink" href="#DOWNLOADING">DOWNLOADING</a></h1>
You can download Maatkit from Google Code at
  &lt;http://code.google.com/p/maatkit/&gt;, or you can get any of the tools
  easily with a command like the following:
<div class="Pp"></div>
<pre>
   wget http://www.maatkit.org/get/toolname
   or
   wget http://www.maatkit.org/trunk/toolname
</pre>
<div class="Pp"></div>
Where &quot;toolname&quot; can be replaced with the name (or fragment of a name)
  of any of the Maatkit tools. Once downloaded, they're ready to run; no
  installation is needed. The first URL gets the latest released version of the
  tool, and the second gets the latest trunk code from Subversion.
<h1 class="Sh" title="Sh" id="ENVIRONMENT"><a class="selflink" href="#ENVIRONMENT">ENVIRONMENT</a></h1>
The environment variable MKDEBUG enables verbose debugging output in all of the
  Maatkit tools:
<div class="Pp"></div>
<pre>
   MKDEBUG=1 mk-....
</pre>
<h1 class="Sh" title="Sh" id="SYSTEM_REQUIREMENTS"><a class="selflink" href="#SYSTEM_REQUIREMENTS">SYSTEM
  REQUIREMENTS</a></h1>
You need Perl, DBI, DBD::mysql, and some core packages that ought to be
  installed in any reasonably new version of Perl.
<h1 class="Sh" title="Sh" id="BUGS"><a class="selflink" href="#BUGS">BUGS</a></h1>
For a list of known bugs see: &lt;http://www.maatkit.org/bugs/mk-table-sync&gt;.
<div class="Pp"></div>
Please use Google Code Issues and Groups to report bugs or request support:
  &lt;http://code.google.com/p/maatkit/&gt;. You can also join #maatkit on
  Freenode to discuss Maatkit.
<div class="Pp"></div>
Please include the complete command-line used to reproduce the problem you are
  seeing, the version of all MySQL servers involved, the complete output of the
  tool when run with &quot;--version&quot;, and if possible, debugging output
  produced by running with the &quot;MKDEBUG=1&quot; environment variable.
<h1 class="Sh" title="Sh" id="COPYRIGHT,_LICENSE_AND_WARRANTY"><a class="selflink" href="#COPYRIGHT,_LICENSE_AND_WARRANTY">COPYRIGHT,
  LICENSE AND WARRANTY</a></h1>
This program is copyright 2007-2011 Baron Schwartz. Feedback and improvements
  are welcome.
<div class="Pp"></div>
THIS PROGRAM IS PROVIDED &quot;AS IS&quot; AND WITHOUT ANY EXPRESS OR IMPLIED
  WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF
  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
<div class="Pp"></div>
This program is free software; you can redistribute it and/or modify it under
  the terms of the GNU General Public License as published by the Free Software
  Foundation, version 2; OR the Perl Artistic License. On UNIX and similar
  systems, you can issue `man perlgpl' or `man perlartistic' to read these
  licenses.
<div class="Pp"></div>
You should have received a copy of the GNU General Public License along with
  this program; if not, write to the Free Software Foundation, Inc., 59 Temple
  Place, Suite 330, Boston, MA 02111-1307 USA.
<h1 class="Sh" title="Sh" id="AUTHOR"><a class="selflink" href="#AUTHOR">AUTHOR</a></h1>
Baron Schwartz
<h1 class="Sh" title="Sh" id="ABOUT_MAATKIT"><a class="selflink" href="#ABOUT_MAATKIT">ABOUT
  MAATKIT</a></h1>
This tool is part of Maatkit, a toolkit for power users of MySQL. Maatkit was
  created by Baron Schwartz; Baron and Daniel Nichter are the primary code
  contributors. Both are employed by Percona. Financial support for Maatkit
  development is primarily provided by Percona and its clients.
<h1 class="Sh" title="Sh" id="HISTORY_AND_ACKNOWLEDGMENTS"><a class="selflink" href="#HISTORY_AND_ACKNOWLEDGMENTS">HISTORY
  AND ACKNOWLEDGMENTS</a></h1>
My work is based in part on Giuseppe Maxia's work on distributed databases,
  &lt;http://www.sysadminmag.com/articles/2004/0408/&gt; and code derived from
  that article. There is more explanation, and a link to the code, at
  &lt;http://www.perlmonks.org/?node_id=381053&gt;.
<div class="Pp"></div>
Another programmer extended Maxia's work even further. Fabien Coelho changed and
  generalized Maxia's technique, introducing symmetry and avoiding some problems
  that might have caused too-frequent checksum collisions. This work grew into
  pg_comparator, &lt;http://www.coelho.net/pg_comparator/&gt;. Coelho also
  explained the technique further in a paper titled &quot;Remote Comparison of
  Database Tables&quot; (&lt;http://cri.ensmp.fr/classement/doc/A-375.pdf&gt;).
<div class="Pp"></div>
This existing literature mostly addressed how to find the differences between
  the tables, not how to resolve them once found. I needed a tool that would not
  only find them efficiently, but would then resolve them. I first began
  thinking about how to improve the technique further with my article
  &lt;http://tinyurl.com/mysql-data-diff-algorithm&gt;, where I discussed a
  number of problems with the Maxia/Coelho &quot;bottom-up&quot; algorithm.
  After writing that article, I began to write this tool. I wanted to actually
  implement their algorithm with some improvements so I was sure I understood it
  completely. I discovered it is not what I thought it was, and is considerably
  more complex than it appeared to me at first. Fabien Coelho was kind enough to
  address some questions over email.
<div class="Pp"></div>
The first versions of this tool implemented a version of the Coelho/Maxia
  algorithm, which I called &quot;bottom-up&quot;, and my own, which I called
  &quot;top-down.&quot; Those algorithms are considerably more complex than the
  current algorithms and I have removed them from this tool, and may add them
  back later. The improvements to the bottom-up algorithm are my original work,
  as is the top-down algorithm. The techniques to actually resolve the
  differences are also my own work.
<div class="Pp"></div>
Another tool that can synchronize tables is the SQLyog Job Agent from webyog.
  Thanks to Rohit Nadhani, SJA's author, for the conversations about the general
  techniques. There is a comparison of mk-table-sync and SJA at
  &lt;http://tinyurl.com/maatkit-vs-sqlyog&gt;
<div class="Pp"></div>
Thanks to the following people and organizations for helping in many ways:
<div class="Pp"></div>
The Rimm-Kaufman Group &lt;http://www.rimmkaufman.com/&gt;, MySQL AB
  &lt;http://www.mysql.com/&gt;, Blue Ridge InternetWorks
  &lt;http://www.briworks.com/&gt;, Percona &lt;http://www.percona.com/&gt;,
  Fabien Coelho, Giuseppe Maxia and others at MySQL AB, Kristian Koehntopp
  (MySQL AB), Rohit Nadhani (WebYog), The helpful monks at Perlmonks, And others
  too numerous to mention.
<h1 class="Sh" title="Sh" id="VERSION"><a class="selflink" href="#VERSION">VERSION</a></h1>
This manual page documents Ver 1.0.31 Distrib 7540 $Revision: 7476 $.</div>
<table class="foot">
  <tr>
    <td class="foot-date">2011-06-08</td>
    <td class="foot-os">perl v5.24.1</td>
  </tr>
</table>
</body>
</html>
